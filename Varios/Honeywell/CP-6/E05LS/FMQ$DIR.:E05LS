VERSION E05

PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:1    
        1        1        /*M*  FMQ$DIR - Routines to manipulate directories */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8        /*X* DDA */
        9        9        /*P*   NAME:   FMQ$DIR
       10       10        *      PURPOSE:  Routines to search, build and add entries to
       11       11        *                file and account directories                                */
       12       12        %EJECT;
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:2    
       13       13        /*F*   NAME:   FMQ$SRCHFD
       14       14        *      PURPOSE:  Search file directory for a given file name entry           */
       15       15                                                /*                                    */
       16       16                                                /*                                    */
       17       17                                                /*                                    */
       18       18        /*D*   NAME:   FMQ$SRCHFD
       19       19        *      CALL:   CALL FMQ$SRCHFD(KEYIN$,KEY$,SEG$,ACCT$,FPT$) ALTRET(LOC);
       20       20        *      INTERFACE:  FMD$REDBUF,FMG$LOCKEY,FMG$NXTKEY,FMG$CURKEY
       21       21        *      INPUT:  KEYIN$ - Ptr to the key to find
       22       22        *              ACCT$ - Ptr to account block
       23       23        *              FPT$ - Ptr to FPT (may be NIL)
       24       24        *      OUTPUT: KEY$ - Ptr to key found, or next highest
       25       25        *              SEG$ - Ptr to segment area associated with KEY$
       26       26        *      DESCRIPTION:  The current FD granule is read.  If no FPT
       27       27        *        or if the FPT does not say NXTF, FMG$LOCKEY is called to
       28       28        *        find the desired key.  Return if found and not deleted,
       29       29        *        altret if not found or if deleted.
       30       30        *        If NXTF is specified, call FMG$LOCKEY to locate the desired
       31       31        *        key.  If found and THISF specified, skip next step.
       32       32        *        Find next key using FMG$NXTKEY or FMG$CURKEY.  If SRCHCOND
       33       33        *        specified, check if this file qualifies, else check if it
       34       34        *        is deleted.  If don't want this one, loop back to find
       35       35        *        next file.
       36       36        *        When done, whether or not anything was found, set current
       37       37        *        disk address in cfu account block to the disk address of
       38       38        *        the last granule read.
       39       39        */
       40       40        /**/
       41       41        FMQ$SRCHFD: PROC(KEYIN$,KEY$,SEG$,ACCT$,FPT$) ALTRET;
       42       42        /* PARAMETERS */
       43       43    1   DCL KEYIN$ PTR;
       44       44    1   DCL KEY$ PTR;
       45       45    1   DCL SEG$ PTR;
       46       46    1   DCL ACCT$ PTR;
       47       47    1   DCL FPT$ PTR;
       48       48        /* LOCAL AUTOMATIC STORAGE */
       49       49    1   DCL DA SBIN;
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:3    
       50       50    1   DCL LCDA SBIN;
       51       51    1   DCL EFLG SBIN;
       52       52    1   DCL JDCB$ PTR;
       53       53    1   DCL BUF$ PTR;
       54       54        /* INCLUDE FILES */
       55       55        %INCLUDE F$JIT_C;
       56      485        %INCLUDE FM$MACROS;
       57      860        %INCLUDE F_ERRORS_C;
       58     1100        %INCLUDE F$CP6V_C;
       59     1326        %MACRO F$DCB(BASED=BASED);
       60     1327        %INCLUDE F$DCB;
       61     1376        %MEND;
       62     1377        /* EXTERNAL DATA */
       63     1378    1   DCL B$JIT$ PTR SYMREF;
       64     1379        /* EXTERNAL ROUTINES */
       65     1380    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
       66     1381    1   DCL FMD$FLSHBUF ENTRY(1);
       67     1382    1   DCL FMG$CURKEY ENTRY(3) ALTRET;
       68     1383    1   DCL FMG$FINDKEY ENTRY(4) ALTRET;
       69     1384    1   DCL FMG$NXTKEY ENTRY(3) ALTRET;
       70     1385        /* BASED STRUCTURES */
       71     1386        %F$DCB (BASED="BASED(JDCB$)");
       72     1436        %FM$CFUA (BASED="BASED(ACCT$)");
       73     1442        %FM$KEYENT (BASED="BASED(KEY$)");
       74     1445        %FM$FDSEG  (BASED="BASED(SEG$)");
       75     1449        %FPT$OPEN_V (BASED="BASED(FPT$)");
       76     1464        /* CONSTANT STORAGE */
       77     1465        %SUB TRUE='1'B;
       78     1466        %SUB FCG#='0615'O;
       79     1467        %SUB MID#='21'O;
       80     1468        %ERRCODE (NAME=ERRNOKEY,COD#=%E$NOKEY);
       81     1472        /**/
       82     1473    1           JDCB$=B$JIT.DCB$;
       83     1474    1           F$DCB.GTYP=FMGTFD;              /* PREPARE TO READ FILE DIRECTORY     */
       84     1475    2           IF F$DCB.STARF THEN DO;         /* STAR FIE DIRECTORY                 */
       85     1476    2              DA=B$JIT.STAR.DA(0);         /* FDA OF STAR FD                     */
       86     1477    2              LCDA=0;
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:4    
       87     1478    2              EFLG=0;                      /* NO FAST PATH HERE                  */
       88     1479    2              END;
       89     1480    2           ELSE DO;
       90     1481    2              DA=FM$CFUA.FDCSDA;           /* LAST FD GRAN READ                  */
       91     1482    2              LCDA=-1;                     /* DON'T KNOW GRAN FOR LINK CHECK     */
       92     1483    2              EFLG=1;                      /* FAST PATH                          */
       93     1484    2              END;
       94     1485        /**/
       95     1486    1   READ:   CALL FMD$REDBUF(BUF$,1,DA,,LCDA,EFLG) ALTRET(ERR1);
       96     1487        /**/
       97     1488    1           IF FPT$~=ADDR(NIL) THEN         /* THERE IS AN FPT                    */
       98     1489    1              IF FPT$OPEN_V.OPER.NXTF THEN /* WANT NEXT FILE                     */
       99     1490    1                 GOTO NXTF;
      100     1491        /**/
      101     1492        /* Want the named file */
      102     1493        /**/
      103     1494    1              CALL FMG$FINDKEY(SEG$,DA,KEY$,KEYIN$) ALTRET(NOKEY);
      104     1495        /**/
      105     1496    2           IF FM$KEYENT.D THEN DO;         /* ENTRY IS DELETED                   */
      106     1497    2              B$JIT.ERR=ERRNOKEY;
      107     1498    2              GOTO DONENOKEY;
      108     1499    2              END;
      109     1500    1           GOTO DONE;
      110     1501        /**/
      111     1502    1   NOKEY:  IF B$JIT.ERR.CODE=%E$NOKEY THEN
      112     1503    1              GOTO DONENOKEY;              /* EVERYTHING OK                      */
      113     1504    1           ELSE
      114     1505    1              GOTO ERR;                    /* FILE INCONSISTENCY                 */
      115     1506        /**/
      116     1507        /**/
      117     1508        /**/
      118     1509    1   NXTF:   CALL FMG$FINDKEY(SEG$,DA,KEY$,KEYIN$) ALTRET(NXTF40);
      119     1510        /**/
      120     1511    1           IF FPT$OPEN_V.OPER.THISF THEN   /* WANT THE NAMED FILE, NOT NEXT      */
      121     1512    1              GOTO NXTF30;
      122     1513        /**/
      123     1514    2   NXTF20: DO WHILE(TRUE);
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:5    
      124     1515    3              IF FPT$OPEN_V.SRCHCOND.REV THEN DO; /* BACK UP                     */
      125     1516    3                 F$DCB.RPOS='1'B;
      126     1517    3                 CALL FMG$CURKEY(SEG$,DA,KEY$) ALTRET(CHKBOF);
      127     1518    3                 END;
      128     1519    2              ELSE                         /* GO FORWARD                         */
      129     1520    2              CALL FMG$NXTKEY(SEG$,DA,KEY$) ALTRET(CHKEOF);
      130     1521        /**/
      131     1522        /* Decide if this file is wanted */
      132     1523        /**/
      133     1524    3   NXTF30:    IF FPT$OPEN_V.SRCHCOND&'777776'O THEN DO; /* SPECIAL SEARCH        */
      134     1525    3                 IF FPT$OPEN_V.SRCHCOND.ANYF THEN /* WANT ALL FILES              */
      135     1526    3                    GOTO DONE;
      136     1527    3                 IF FPT$OPEN_V.SRCHCOND&FM$FDSEG.DESC THEN
      137     1528    3                    GOTO DONE;
      138     1529    3                 END;
      139     1530    2              ELSE     /* NO SPECIAL SEARCH CONDITIONS - IGNORE DELETED FILES    */
      140     1531    2                 IF NOT FM$KEYENT.D THEN
      141     1532    2                    GOTO DONE;
      142     1533    2              END;
      143     1534        /**/
      144     1535    2   NXTF40: IF B$JIT.ERR.CODE=%E$NOKEY THEN DO; /* Named file doesn't exist       */
      145     1536    2              B$JIT.ERR='0'B;              /* Get rid of spurious error          */
      146     1537    2              GOTO NXTF20;
      147     1538    2              END;
      148     1539    1   ERR:    CALL FMD$FLSHBUF(1);
      149     1540    1           ALTRETURN;
      150     1541        /**/
      151     1542    1   CHKBOF: IF B$JIT.ERR.CODE=%E$BOF THEN
      152     1543    1              GOTO DONENOKEY;
      153     1544    1           ELSE
      154     1545    1              GOTO ERR;
      155     1546    1   CHKEOF: IF B$JIT.ERR.CODE=%E$EOF THEN
      156     1547    1              GOTO DONENOKEY;
      157     1548    1           ELSE
      158     1549    1              GOTO ERR;
      159     1550        /**/
      160     1551        /**/
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:6    
      161     1552        /**/
      162     1553    1   DONE:   IF NOT F$DCB.STARF THEN
      163     1554    1              FM$CFUA.FDCSDA=F$DCB.BFR.DA(1); /* REMEMBER CURRENT GRAN           */
      164     1555    1           B$JIT.ERR='0'B;
      165     1556    1           RETURN;
      166     1557        /**/
      167     1558    1   DONENOKEY: IF NOT F$DCB.STARF THEN
      168     1559    1              FM$CFUA.FDCSDA=F$DCB.BFR.DA(1);
      169     1560    1           ALTRETURN;
      170     1561        /**/
      171     1562        /**/
      172     1563        /**/
      173     1564    2   ERR1:   IF EFLG~=0 THEN DO;             /* GOT ERROR ON FAST PATH             */
      174     1565    2              DA=FM$CFUA.FDFITSDA;         /* START FROM BEGINNING               */
      175     1566    2              EFLG=0;                      /* DON'T COME HERE AGAIN              */
      176     1567    2              LCDA=0;
      177     1568    2              FM$CFUA.FDCSDA=DA;           /* MAKE SURE GOOD DISK ADDR HERE      */
      178     1569    2              B$JIT.ERR='0'B;              /* FORGET ABOUT ERROR                 */
      179     1570    2              GOTO READ;
      180     1571    2              END;
      181     1572    1           GOTO ERR;
      182     1573        /**/
      183     1574    1   END FMQ$SRCHFD;
      184     1575        %EOD;

PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:7    
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$SRCHFD.

   Procedure FMQ$SRCHFD requires 204 words for executable code.
   Procedure FMQ$SRCHFD requires 20 words of local(AUTO) storage.

PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:8    

 Object Unit name= FMQ$SRCHFD                                 File name= FMQ$DIR.:E05TOU
 UTS= JUL 29 '97 16:59:47.84 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  FMQ$SRCHFD
    1   Proc  even  none   204    314  FMQ$SRCHFD
    2  RoData even  none     2      2  FMQ$SRCHFD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        5  FMQ$SRCHFD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       6 FMD$REDBUF
 yes     yes           Std       4 FMG$FINDKEY
 yes     yes           Std       3 FMG$NXTKEY
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       3 FMG$CURKEY
                       nStd      0 X66_AUTO_5
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:9    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:10   


        1        1        /*M*  FMQ$DIR - Routines to manipulate directories */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8        /*X* DDA */
        9        9        /*P*   NAME:   FMQ$DIR
       10       10        *      PURPOSE:  Routines to search, build and add entries to
       11       11        *                file and account directories                                */
       12       12        %EJECT;
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:11   
       13       13        /*F*   NAME:   FMQ$SRCHFD
       14       14        *      PURPOSE:  Search file directory for a given file name entry           */
       15       15                                                /*                                    */
       16       16                                                /*                                    */
       17       17                                                /*                                    */
       18       18        /*D*   NAME:   FMQ$SRCHFD
       19       19        *      CALL:   CALL FMQ$SRCHFD(KEYIN$,KEY$,SEG$,ACCT$,FPT$) ALTRET(LOC);
       20       20        *      INTERFACE:  FMD$REDBUF,FMG$LOCKEY,FMG$NXTKEY,FMG$CURKEY
       21       21        *      INPUT:  KEYIN$ - Ptr to the key to find
       22       22        *              ACCT$ - Ptr to account block
       23       23        *              FPT$ - Ptr to FPT (may be NIL)
       24       24        *      OUTPUT: KEY$ - Ptr to key found, or next highest
       25       25        *              SEG$ - Ptr to segment area associated with KEY$
       26       26        *      DESCRIPTION:  The current FD granule is read.  If no FPT
       27       27        *        or if the FPT does not say NXTF, FMG$LOCKEY is called to
       28       28        *        find the desired key.  Return if found and not deleted,
       29       29        *        altret if not found or if deleted.
       30       30        *        If NXTF is specified, call FMG$LOCKEY to locate the desired
       31       31        *        key.  If found and THISF specified, skip next step.
       32       32        *        Find next key using FMG$NXTKEY or FMG$CURKEY.  If SRCHCOND
       33       33        *        specified, check if this file qualifies, else check if it
       34       34        *        is deleted.  If don't want this one, loop back to find
       35       35        *        next file.
       36       36        *        When done, whether or not anything was found, set current
       37       37        *        disk address in cfu account block to the disk address of
       38       38        *        the last granule read.
       39       39        */
       40       40        /**/
       41       41        FMQ$SRCHFD: PROC(KEYIN$,KEY$,SEG$,ACCT$,FPT$) ALTRET;

     41  1 000000   000000 700200 xent  FMQ$SRCHFD   TSX0  ! X66_AUTO_5
         1 000001   000024 000005                    ZERO    20,5

       42       42        /* PARAMETERS */
       43       43    1   DCL KEYIN$ PTR;
       44       44    1   DCL KEY$ PTR;
       45       45    1   DCL SEG$ PTR;
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:12   
       46       46    1   DCL ACCT$ PTR;
       47       47    1   DCL FPT$ PTR;
       48       48        /* LOCAL AUTOMATIC STORAGE */
       49       49    1   DCL DA SBIN;
       50       50    1   DCL LCDA SBIN;
       51       51    1   DCL EFLG SBIN;
       52       52    1   DCL JDCB$ PTR;
       53       53    1   DCL BUF$ PTR;
       54       54        /* INCLUDE FILES */
       55       55        %INCLUDE F$JIT_C;
       56      485        %INCLUDE FM$MACROS;
       57      860        %INCLUDE F_ERRORS_C;
       58     1100        %INCLUDE F$CP6V_C;
       59     1326        %MACRO F$DCB(BASED=BASED);
       60     1327        %INCLUDE F$DCB;
       61     1376        %MEND;
       62     1377        /* EXTERNAL DATA */
       63     1378    1   DCL B$JIT$ PTR SYMREF;
       64     1379        /* EXTERNAL ROUTINES */
       65     1380    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
       66     1381    1   DCL FMD$FLSHBUF ENTRY(1);
       67     1382    1   DCL FMG$CURKEY ENTRY(3) ALTRET;
       68     1383    1   DCL FMG$FINDKEY ENTRY(4) ALTRET;
       69     1384    1   DCL FMG$NXTKEY ENTRY(3) ALTRET;
       70     1385        /* BASED STRUCTURES */
       71     1386        %F$DCB (BASED="BASED(JDCB$)");
       72     1436        %FM$CFUA (BASED="BASED(ACCT$)");
       73     1442        %FM$KEYENT (BASED="BASED(KEY$)");
       74     1445        %FM$FDSEG  (BASED="BASED(SEG$)");
       75     1449        %FPT$OPEN_V (BASED="BASED(FPT$)");
       76     1464        /* CONSTANT STORAGE */
       77     1465        %SUB TRUE='1'B;
       78     1466        %SUB FCG#='0615'O;
       79     1467        %SUB MID#='21'O;
       80     1468        %ERRCODE (NAME=ERRNOKEY,COD#=%E$NOKEY);
       81     1472        /**/
       82     1473    1           JDCB$=B$JIT.DCB$;
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:13   

   1473  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200013 756100                    STQ     JDCB$,,AUTO

       83     1474    1           F$DCB.GTYP=FMGTFD;              /* PREPARE TO READ FILE DIRECTORY     */

   1474  1 000005   200013 471500                    LDP1    JDCB$,,AUTO
         1 000006   100064 236100                    LDQ     52,,PR1
         1 000007   000000 376000 2                  ANQ     0
         1 000010   020000 276003                    ORQ     8192,DU
         1 000011   100064 756100                    STQ     52,,PR1

       84     1475    2           IF F$DCB.STARF THEN DO;         /* STAR FIE DIRECTORY                 */

   1475  1 000012   100064 236100                    LDQ     52,,PR1
         1 000013   200000 316003                    CANQ    65536,DU
         1 000014   000022 600000 1                  TZE     s:1481

       85     1476    2              DA=B$JIT.STAR.DA(0);         /* FDA OF STAR FD                     */

   1476  1 000015   000222 235100                    LDA     146,,PR0
         1 000016   200010 755100                    STA     DA,,AUTO

       86     1477    2              LCDA=0;

   1477  1 000017   200011 450100                    STZ     LCDA,,AUTO

       87     1478    2              EFLG=0;                      /* NO FAST PATH HERE                  */

   1478  1 000020   200012 450100                    STZ     EFLG,,AUTO

       88     1479    2              END;

   1479  1 000021   000032 710000 1                  TRA     READ

       89     1480    2           ELSE DO;
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:14   

       90     1481    2              DA=FM$CFUA.FDCSDA;           /* LAST FD GRAN READ                  */

   1481  1 000022   200006 473500                    LDP3    @ACCT$,,AUTO
         1 000023   300000 474500                    LDP4    0,,PR3
         1 000024   400003 235100                    LDA     3,,PR4
         1 000025   200010 755100                    STA     DA,,AUTO

       91     1482    2              LCDA=-1;                     /* DON'T KNOW GRAN FOR LINK CHECK     */

   1482  1 000026   000001 335007                    LCA     1,DL
         1 000027   200011 755100                    STA     LCDA,,AUTO

       92     1483    2              EFLG=1;                      /* FAST PATH                          */

   1483  1 000030   000001 235007                    LDA     1,DL
         1 000031   200012 755100                    STA     EFLG,,AUTO

       93     1484    2              END;

       94     1485        /**/
       95     1486    1   READ:   CALL FMD$REDBUF(BUF$,1,DA,,LCDA,EFLG) ALTRET(ERR1);

   1486  1 000032   200012 630500       READ         EPPR0   EFLG,,AUTO
         1 000033   200023 450500                    STP0    BUF$+7,,AUTO
         1 000034   200011 631500                    EPPR1   LCDA,,AUTO
         1 000035   200022 451500                    STP1    BUF$+6,,AUTO
         1 000036   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000037   200021 756100                    STQ     BUF$+5,,AUTO
         1 000040   200010 633500                    EPPR3   DA,,AUTO
         1 000041   200020 453500                    STP3    BUF$+4,,AUTO
         1 000042   000001 236000 2                  LDQ     1
         1 000043   200017 756100                    STQ     BUF$+3,,AUTO
         1 000044   200014 634500                    EPPR4   BUF$,,AUTO
         1 000045   200016 454500                    STP4    BUF$+2,,AUTO
         1 000046   200016 630500                    EPPR0   BUF$+2,,AUTO
         1 000047   000024 631400 xsym               EPPR1   B_VECTNIL+20
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:15   
         1 000050   000000 701000 xent               TSX1    FMD$REDBUF
         1 000051   000276 702000 1                  TSX2    ERR1

       96     1487        /**/
       97     1488    1           IF FPT$~=ADDR(NIL) THEN         /* THERE IS AN FPT                    */

   1488  1 000052   200007 470500                    LDP0    @FPT$,,AUTO
         1 000053   000000 236100                    LDQ     0,,PR0
         1 000054   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000055   000062 600000 1                  TZE     s:1494

       98     1489    1              IF FPT$OPEN_V.OPER.NXTF THEN /* WANT NEXT FILE                     */

   1489  1 000056   000000 471500                    LDP1    0,,PR0
         1 000057   100000 236100                    LDQ     0,,PR1
         1 000060   004000 316007                    CANQ    2048,DL
         1 000061   000114 601000 1                  TNZ     NXTF

       99     1490    1                 GOTO NXTF;
      100     1491        /**/
      101     1492        /* Want the named file */
      102     1493        /**/
      103     1494    1              CALL FMG$FINDKEY(SEG$,DA,KEY$,KEYIN$) ALTRET(NOKEY);

   1494  1 000062   200003 236100                    LDQ     @KEYIN$,,AUTO
         1 000063   200004 235100                    LDA     @KEY$,,AUTO
         1 000064   200020 757100                    STAQ    BUF$+4,,AUTO
         1 000065   200010 631500                    EPPR1   DA,,AUTO
         1 000066   200017 451500                    STP1    BUF$+3,,AUTO
         1 000067   200005 236100                    LDQ     @SEG$,,AUTO
         1 000070   200016 756100                    STQ     BUF$+2,,AUTO
         1 000071   200016 630500                    EPPR0   BUF$+2,,AUTO
         1 000072   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000073   000000 701000 xent               TSX1    FMG$FINDKEY
         1 000074   000106 702000 1                  TSX2    NOKEY

      104     1495        /**/
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:16   
      105     1496    2           IF FM$KEYENT.D THEN DO;         /* ENTRY IS DELETED                   */

   1496  1 000075   200004 470500                    LDP0    @KEY$,,AUTO
         1 000076   000000 471500                    LDP1    0,,PR0
         1 000077   100000 234100                    SZN     0,,PR1
         1 000100   000105 605000 1                  TPL     s:1500

      106     1497    2              B$JIT.ERR=ERRNOKEY;

   1497  1 000101   000000 236000 0                  LDQ     ERRNOKEY
         1 000102   000000 473400 xsym               LDP3    B$JIT$
         1 000103   300012 756100                    STQ     10,,PR3

      107     1498    2              GOTO DONENOKEY;

   1498  1 000104   000264 710000 1                  TRA     DONENOKEY

      108     1499    2              END;
      109     1500    1           GOTO DONE;

   1500  1 000105   000250 710000 1                  TRA     DONE

      110     1501        /**/
      111     1502    1   NOKEY:  IF B$JIT.ERR.CODE=%E$NOKEY THEN

   1502  1 000106   000000 470400 xsym  NOKEY        LDP0    B$JIT$
         1 000107   000012 236100                    LDQ     10,,PR0
         1 000110   377770 376007                    ANQ     131064,DL
         1 000111   001020 116007                    CMPQ    528,DL
         1 000112   000264 600000 1                  TZE     DONENOKEY

      112     1503    1              GOTO DONENOKEY;              /* EVERYTHING OK                      */
      113     1504    1           ELSE
      114     1505    1              GOTO ERR;                    /* FILE INCONSISTENCY                 */

   1505  1 000113   000227 710000 1                  TRA     ERR

PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:17   
      115     1506        /**/
      116     1507        /**/
      117     1508        /**/
      118     1509    1   NXTF:   CALL FMG$FINDKEY(SEG$,DA,KEY$,KEYIN$) ALTRET(NXTF40);

   1509  1 000114   200003 236100       NXTF         LDQ     @KEYIN$,,AUTO
         1 000115   200004 235100                    LDA     @KEY$,,AUTO
         1 000116   200020 757100                    STAQ    BUF$+4,,AUTO
         1 000117   200010 631500                    EPPR1   DA,,AUTO
         1 000120   200017 451500                    STP1    BUF$+3,,AUTO
         1 000121   200005 236100                    LDQ     @SEG$,,AUTO
         1 000122   200016 756100                    STQ     BUF$+2,,AUTO
         1 000123   200016 630500                    EPPR0   BUF$+2,,AUTO
         1 000124   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000125   000000 701000 xent               TSX1    FMG$FINDKEY
         1 000126   000220 702000 1                  TSX2    NXTF40

      119     1510        /**/
      120     1511    1           IF FPT$OPEN_V.OPER.THISF THEN   /* WANT THE NAMED FILE, NOT NEXT      */

   1511  1 000127   200007 470500                    LDP0    @FPT$,,AUTO
         1 000130   000000 471500                    LDP1    0,,PR0
         1 000131   100000 236100                    LDQ     0,,PR1
         1 000132   002000 316007                    CANQ    1024,DL
         1 000133   000171 601000 1                  TNZ     NXTF30

      121     1512    1              GOTO NXTF30;
      122     1513        /**/
      123     1514    2   NXTF20: DO WHILE(TRUE);

   1514  1 000134                       NXTF20       null
      124     1515    3              IF FPT$OPEN_V.SRCHCOND.REV THEN DO; /* BACK UP                     */

   1515  1 000134   200007 470500                    LDP0    @FPT$,,AUTO
         1 000135   000000 471500                    LDP1    0,,PR0
         1 000136   100001 236100                    LDQ     1,,PR1
         1 000137   000001 316003                    CANQ    1,DU
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:18   
         1 000140   000157 600000 1                  TZE     s:1520

      125     1516    3                 F$DCB.RPOS='1'B;

   1516  1 000141   200013 473500                    LDP3    JDCB$,,AUTO
         1 000142   010000 236007                    LDQ     4096,DL
         1 000143   300064 256100                    ORSQ    52,,PR3

      126     1517    3                 CALL FMG$CURKEY(SEG$,DA,KEY$) ALTRET(CHKBOF);

   1517  1 000144   200004 236100                    LDQ     @KEY$,,AUTO
         1 000145   200020 756100                    STQ     BUF$+4,,AUTO
         1 000146   200010 631500                    EPPR1   DA,,AUTO
         1 000147   200017 451500                    STP1    BUF$+3,,AUTO
         1 000150   200005 236100                    LDQ     @SEG$,,AUTO
         1 000151   200016 756100                    STQ     BUF$+2,,AUTO
         1 000152   200016 630500                    EPPR0   BUF$+2,,AUTO
         1 000153   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000154   000000 701000 xent               TSX1    FMG$CURKEY
         1 000155   000234 702000 1                  TSX2    CHKBOF

      127     1518    3                 END;

   1518  1 000156   000171 710000 1                  TRA     NXTF30

      128     1519    2              ELSE                         /* GO FORWARD                         */
      129     1520    2              CALL FMG$NXTKEY(SEG$,DA,KEY$) ALTRET(CHKEOF);

   1520  1 000157   200004 236100                    LDQ     @KEY$,,AUTO
         1 000160   200020 756100                    STQ     BUF$+4,,AUTO
         1 000161   200010 631500                    EPPR1   DA,,AUTO
         1 000162   200017 451500                    STP1    BUF$+3,,AUTO
         1 000163   200005 236100                    LDQ     @SEG$,,AUTO
         1 000164   200016 756100                    STQ     BUF$+2,,AUTO
         1 000165   200016 630500                    EPPR0   BUF$+2,,AUTO
         1 000166   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000167   000000 701000 xent               TSX1    FMG$NXTKEY
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:19   
         1 000170   000242 702000 1                  TSX2    CHKEOF

      130     1521        /**/
      131     1522        /* Decide if this file is wanted */
      132     1523        /**/
      133     1524    3   NXTF30:    IF FPT$OPEN_V.SRCHCOND&'777776'O THEN DO; /* SPECIAL SEARCH        */

   1524  1 000171   200007 470500       NXTF30       LDP0    @FPT$,,AUTO
         1 000172   000000 471500                    LDP1    0,,PR0
         1 000173   100001 220100                    LDX0    1,,PR1
         1 000174   777776 360003                    ANX0    -2,DU
         1 000175   000213 600000 1                  TZE     s:1531

      134     1525    3                 IF FPT$OPEN_V.SRCHCOND.ANYF THEN /* WANT ALL FILES              */

   1525  1 000176   100001 236100                    LDQ     1,,PR1
         1 000177   000400 316003                    CANQ    256,DU
         1 000200   000250 601000 1                  TNZ     DONE

      135     1526    3                    GOTO DONE;
      136     1527    3                 IF FPT$OPEN_V.SRCHCOND&FM$FDSEG.DESC THEN

   1527  1 000201   200005 473500                    LDP3    @SEG$,,AUTO
         1 000202   300000 474500                    LDP4    0,,PR3
         1 000203   400000 236100                    LDQ     0,,PR4
         1 000204   777000 376003                    ANQ     -512,DU
         1 000205   200016 756100                    STQ     BUF$+2,,AUTO
         1 000206   100001 236100                    LDQ     1,,PR1
         1 000207   777777 376003                    ANQ     -1,DU
         1 000210   200016 376100                    ANQ     BUF$+2,,AUTO
         1 000211   000250 601000 1                  TNZ     DONE

      137     1528    3                    GOTO DONE;
      138     1529    3                 END;

   1529  1 000212   000134 710000 1                  TRA     NXTF20

PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:20   
      139     1530    2              ELSE     /* NO SPECIAL SEARCH CONDITIONS - IGNORE DELETED FILES    */
      140     1531    2                 IF NOT FM$KEYENT.D THEN

   1531  1 000213   200004 473500                    LDP3    @KEY$,,AUTO
         1 000214   300000 474500                    LDP4    0,,PR3
         1 000215   400000 234100                    SZN     0,,PR4
         1 000216   000250 605000 1                  TPL     DONE

      141     1532    2                    GOTO DONE;
      142     1533    2              END;

   1533  1 000217   000134 710000 1                  TRA     NXTF20

      143     1534        /**/
      144     1535    2   NXTF40: IF B$JIT.ERR.CODE=%E$NOKEY THEN DO; /* Named file doesn't exist       */

   1535  1 000220   000000 470400 xsym  NXTF40       LDP0    B$JIT$
         1 000221   000012 236100                    LDQ     10,,PR0
         1 000222   377770 376007                    ANQ     131064,DL
         1 000223   001020 116007                    CMPQ    528,DL
         1 000224   000227 601000 1                  TNZ     ERR

      145     1536    2              B$JIT.ERR='0'B;              /* Get rid of spurious error          */

   1536  1 000225   000012 450100                    STZ     10,,PR0

      146     1537    2              GOTO NXTF20;

   1537  1 000226   000134 710000 1                  TRA     NXTF20

      147     1538    2              END;
      148     1539    1   ERR:    CALL FMD$FLSHBUF(1);

   1539  1 000227   000001 630400 2     ERR          EPPR0   1
         1 000230   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000231   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000232   000000 011000                    NOP     0
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:21   

      149     1540    1           ALTRETURN;

   1540  1 000233   000000 702200 xent               TSX2  ! X66_AALT

      150     1541        /**/
      151     1542    1   CHKBOF: IF B$JIT.ERR.CODE=%E$BOF THEN

   1542  1 000234   000000 470400 xsym  CHKBOF       LDP0    B$JIT$
         1 000235   000012 236100                    LDQ     10,,PR0
         1 000236   377770 376007                    ANQ     131064,DL
         1 000237   000040 116007                    CMPQ    32,DL
         1 000240   000264 600000 1                  TZE     DONENOKEY

      152     1543    1              GOTO DONENOKEY;
      153     1544    1           ELSE
      154     1545    1              GOTO ERR;

   1545  1 000241   000227 710000 1                  TRA     ERR

      155     1546    1   CHKEOF: IF B$JIT.ERR.CODE=%E$EOF THEN

   1546  1 000242   000000 470400 xsym  CHKEOF       LDP0    B$JIT$
         1 000243   000012 236100                    LDQ     10,,PR0
         1 000244   377770 376007                    ANQ     131064,DL
         1 000245   000060 116007                    CMPQ    48,DL
         1 000246   000264 600000 1                  TZE     DONENOKEY

      156     1547    1              GOTO DONENOKEY;
      157     1548    1           ELSE
      158     1549    1              GOTO ERR;

   1549  1 000247   000227 710000 1                  TRA     ERR

      159     1550        /**/
      160     1551        /**/
      161     1552        /**/
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:22   
      162     1553    1   DONE:   IF NOT F$DCB.STARF THEN

   1553  1 000250   200013 470500       DONE         LDP0    JDCB$,,AUTO
         1 000251   000064 236100                    LDQ     52,,PR0
         1 000252   200000 316003                    CANQ    65536,DU
         1 000253   000261 601000 1                  TNZ     s:1555

      163     1554    1              FM$CFUA.FDCSDA=F$DCB.BFR.DA(1); /* REMEMBER CURRENT GRAN           */

   1554  1 000254   200006 471500                    LDP1    @ACCT$,,AUTO
         1 000255   100000 473500                    LDP3    0,,PR1
         1 000256   000116 236100                    LDQ     78,,PR0
         1 000257   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000260   300003 756100                    STQ     3,,PR3

      164     1555    1           B$JIT.ERR='0'B;

   1555  1 000261   000000 471400 xsym               LDP1    B$JIT$
         1 000262   100012 450100                    STZ     10,,PR1

      165     1556    1           RETURN;

   1556  1 000263   000000 702200 xent               TSX2  ! X66_ARET

      166     1557        /**/
      167     1558    1   DONENOKEY: IF NOT F$DCB.STARF THEN

   1558  1 000264   200013 470500       DONENOKEY    LDP0    JDCB$,,AUTO
         1 000265   000064 236100                    LDQ     52,,PR0
         1 000266   200000 316003                    CANQ    65536,DU
         1 000267   000275 601000 1                  TNZ     s:1560

      168     1559    1              FM$CFUA.FDCSDA=F$DCB.BFR.DA(1);

   1559  1 000270   200006 471500                    LDP1    @ACCT$,,AUTO
         1 000271   100000 473500                    LDP3    0,,PR1
         1 000272   000116 236100                    LDQ     78,,PR0
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:23   
         1 000273   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000274   300003 756100                    STQ     3,,PR3

      169     1560    1           ALTRETURN;

   1560  1 000275   000000 702200 xent               TSX2  ! X66_AALT

      170     1561        /**/
      171     1562        /**/
      172     1563        /**/
      173     1564    2   ERR1:   IF EFLG~=0 THEN DO;             /* GOT ERROR ON FAST PATH             */

   1564  1 000276   200012 235100       ERR1         LDA     EFLG,,AUTO
         1 000277   000313 600000 1                  TZE     s:1572

      174     1565    2              DA=FM$CFUA.FDFITSDA;         /* START FROM BEGINNING               */

   1565  1 000300   200006 470500                    LDP0    @ACCT$,,AUTO
         1 000301   000000 471500                    LDP1    0,,PR0
         1 000302   100004 235100                    LDA     4,,PR1
         1 000303   200010 755100                    STA     DA,,AUTO

      175     1566    2              EFLG=0;                      /* DON'T COME HERE AGAIN              */

   1566  1 000304   200012 450100                    STZ     EFLG,,AUTO

      176     1567    2              LCDA=0;

   1567  1 000305   200011 450100                    STZ     LCDA,,AUTO

      177     1568    2              FM$CFUA.FDCSDA=DA;           /* MAKE SURE GOOD DISK ADDR HERE      */

   1568  1 000306   000000 471500                    LDP1    0,,PR0
         1 000307   100003 755100                    STA     3,,PR1

      178     1569    2              B$JIT.ERR='0'B;              /* FORGET ABOUT ERROR                 */

PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:24   
   1569  1 000310   000000 471400 xsym               LDP1    B$JIT$
         1 000311   100012 450100                    STZ     10,,PR1

      179     1570    2              GOTO READ;

   1570  1 000312   000032 710000 1                  TRA     READ

      180     1571    2              END;
      181     1572    1           GOTO ERR;

   1572  1 000313   000227 710000 1                  TRA     ERR

ERRNOKEY
 Sect OctLoc
   0     000   061521 001022                                                    1...

(unnamed)
 Sect OctLoc
   2     000   743777 777777   000003 006000                                    ........
      182     1573        /**/
      183     1574    1   END FMQ$SRCHFD;
      184     1575        %EOD;

PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:25   
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$SRCHFD.
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:26   

 **** Variables and constants ****

  ****  Section 000 RoData FMQ$SRCHFD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 ERRNOKEY

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w PTR         r     1 @ACCT$                     7-0-0/w PTR         r     1 @FPT$
     4-0-0/w PTR         r     1 @KEY$                      3-0-0/w PTR         r     1 @KEYIN$
     5-0-0/w PTR         r     1 @SEG$                     *0-0-0/w PTR         r     1 ACCT$
    14-0-0/w PTR         r     1 BUF$                      10-0-0/w SBIN        r     1 DA
    12-0-0/w SBIN        r     1 EFLG                      *0-0-0/w PTR         r     1 FPT$
    13-0-0/w PTR         r     1 JDCB$                     *0-0-0/w PTR         r     1 KEY$
    *0-0-0/w PTR         r     1 KEYIN$                    11-0-0/w SBIN        r     1 LCDA
    *0-0-0/w PTR         r     1 SEG$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFUA                    0-0-0/w STRC        r     1 FM$FDSEG
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:27   
     0-0-0/w ASTR(9)     r     1 FM$KEYENT                  0-0-0/d STRC(756)   r     1 FPT$OPEN_V


   Procedure FMQ$SRCHFD requires 204 words for executable code.
   Procedure FMQ$SRCHFD requires 20 words of local(AUTO) storage.
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:28   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:29   
          MINI XREF LISTING

ACCT$
        46**DCL        41--PROC     1437--IMP-PTR  1481>>ASSIGN   1554>>ASSIGN   1559>>ASSIGN   1565>>ASSIGN
      1568>>ASSIGN
B$JIT.DCB$
       472**DCL      1473>>ASSIGN
B$JIT.ERR
       382**DCL      1497<<ASSIGN   1536<<ASSIGN   1555<<ASSIGN   1569<<ASSIGN
B$JIT.ERR.CODE
       383**DCL      1502>>IF       1535>>IF       1542>>IF       1546>>IF
B$JIT.ERR.MID
       383**DCL       383--REDEF
B$JIT.STAR.DA
       472**DCL      1476>>ASSIGN
B$JIT$
      1378**DCL       377--IMP-PTR  1473>>ASSIGN   1476>>ASSIGN   1497>>ASSIGN   1502>>IF       1535>>IF
      1536>>ASSIGN   1542>>IF       1546>>IF       1555>>ASSIGN   1569>>ASSIGN
BUF$
        53**DCL      1486<>CALL
CHKBOF
      1542**LABEL    1517--CALLALT
CHKEOF
      1546**LABEL    1520--CALLALT
DA
        49**DCL      1476<<ASSIGN   1481<<ASSIGN   1486<>CALL     1494<>CALL     1509<>CALL     1517<>CALL
      1520<>CALL     1565<<ASSIGN   1568>>ASSIGN
DONE
      1553**LABEL    1500--GOTO     1526--GOTO     1528--GOTO     1532--GOTO
DONENOKEY
      1558**LABEL    1498--GOTO     1503--GOTO     1543--GOTO     1547--GOTO
EFLG
        51**DCL      1478<<ASSIGN   1483<<ASSIGN   1486<>CALL     1564>>IF       1566<<ASSIGN
ERR
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:30   
      1539**LABEL    1505--GOTO     1545--GOTO     1549--GOTO     1572--GOTO
ERR1
      1564**LABEL    1486--CALLALT
ERRNOKEY
      1469**DCL      1497>>ASSIGN
F$DCB.ACTPOS
      1412**DCL      1412--REDEF
F$DCB.ARS
      1387**DCL      1387--REDEF
F$DCB.ATTR
      1405**DCL      1406--REDEF
F$DCB.BFR.DA
      1432**DCL      1554>>ASSIGN   1559>>ASSIGN
F$DCB.BORROW
      1420**DCL      1420--REDEF    1420--REDEF    1420--REDEF
F$DCB.DCBNAME.L
      1434**DCL      1434--IMP-SIZ
F$DCB.EOMCHAR
      1391**DCL      1391--REDEF
F$DCB.FLDID
      1415**DCL      1415--REDEF
F$DCB.FORM$
      1409**DCL      1409--REDEF
F$DCB.FSECT
      1425**DCL      1425--REDEF
F$DCB.FSN
      1402**DCL      1402--REDEF    1402--REDEF    1403--REDEF
F$DCB.GTYP
      1416**DCL      1474<<ASSIGN
F$DCB.HEADER$
      1408**DCL      1408--REDEF
F$DCB.IXTNSIZE
      1406**DCL      1406--REDEF
F$DCB.LASTSTA$
      1396**DCL      1396--REDEF
F$DCB.LVL
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:31   
      1421**DCL      1421--REDEF
F$DCB.NAME.C
      1396**DCL      1396--REDEF
F$DCB.NOEOF
      1417**DCL      1417--REDEF
F$DCB.NRECS
      1407**DCL      1407--REDEF
F$DCB.NRECX
      1426**DCL      1426--REDEF
F$DCB.OHDR
      1418**DCL      1418--REDEF
F$DCB.ORG
      1401**DCL      1401--REDEF
F$DCB.PRECNO
      1424**DCL      1424--REDEF
F$DCB.RCSZ
      1429**DCL      1429--REDEF
F$DCB.RES
      1397**DCL      1397--REDEF
F$DCB.RPOS
      1418**DCL      1516<<ASSIGN
F$DCB.SETX
      1409**DCL      1409--REDEF
F$DCB.STARF
      1416**DCL      1475>>IF       1553>>IF       1558>>IF
F$DCB.TAB$
      1408**DCL      1409--REDEF
F$DCB.TDA
      1423**DCL      1423--REDEF
F$DCB.WSN
      1398**DCL      1398--REDEF
FM$CFUA.FDCSDA
      1437**DCL      1481>>ASSIGN   1554<<ASSIGN   1559<<ASSIGN   1568<<ASSIGN
FM$CFUA.FDFITSDA
      1437**DCL      1565>>ASSIGN
FM$FDSEG.DESC
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:32   
      1446**DCL      1527>>IF
FM$KEYENT.D
      1443**DCL      1496>>IF       1531>>IF
FM$KEYENT.KLB
      1443**DCL      1443--IMP-SIZ
FMD$FLSHBUF
      1381**DCL-ENT  1539--CALL
FMD$REDBUF
      1380**DCL-ENT  1486--CALL
FMG$CURKEY
      1382**DCL-ENT  1517--CALL
FMG$FINDKEY
      1383**DCL-ENT  1494--CALL     1509--CALL
FMG$NXTKEY
      1384**DCL-ENT  1520--CALL
FPT$
        47**DCL        41--PROC     1450--IMP-PTR  1488>>IF       1489>>IF       1511>>IF       1515>>IF
      1524>>IF       1525>>IF       1527>>IF
FPT$OPEN_V.FSN
      1460**DCL      1460--REDEF    1461--REDEF
FPT$OPEN_V.OPER.NXTF
      1451**DCL      1489>>IF
FPT$OPEN_V.OPER.THISF
      1451**DCL      1511>>IF
FPT$OPEN_V.SRCHCOND
      1452**DCL      1524>>IF       1527>>IF
FPT$OPEN_V.SRCHCOND.ANYF
      1453**DCL      1525>>IF
FPT$OPEN_V.SRCHCOND.REV
      1453**DCL      1515>>IF
JDCB$
        52**DCL      1387--IMP-PTR  1473<<ASSIGN   1474>>ASSIGN   1475>>IF       1516>>ASSIGN   1553>>IF
      1554>>ASSIGN   1558>>IF       1559>>ASSIGN
KEY$
        44**DCL        41--PROC     1443--IMP-PTR  1494<>CALL     1496>>IF       1509<>CALL     1517<>CALL
      1520<>CALL     1531>>IF
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:33   
KEYIN$
        43**DCL        41--PROC     1494<>CALL     1509<>CALL
LCDA
        50**DCL      1477<<ASSIGN   1482<<ASSIGN   1486<>CALL     1567<<ASSIGN
NOKEY
      1502**LABEL    1494--CALLALT
NXTF
      1509**LABEL    1490--GOTO
NXTF20
      1514**LABEL    1537--GOTO
NXTF30
      1524**LABEL    1512--GOTO
NXTF40
      1535**LABEL    1509--CALLALT
READ
      1486**LABEL    1570--GOTO
SEG$
        45**DCL        41--PROC     1446--IMP-PTR  1494<>CALL     1509<>CALL     1517<>CALL     1520<>CALL
      1527>>IF
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:34   
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FMQ$SRCHFD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 16:59 Page:35   
              MINI UREF LISTING

FMQ$SRCHFD      41**PROC

PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:36   
      185        1        /*T***********************************************************/
      186        2        /*T*                                                         */
      187        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      188        4        /*T*                                                         */
      189        5        /*T***********************************************************/
      190        6        /*F*   NAME:   FMQ$SRCHAD
      191        7        *      PURPOSE:  Search an account directory                                 */
      192        8                                                                                  /*
      193        9                                                                                   *
      194       10                                                                                     */
      195       11        /*D*   NAME:   FMQ$SRCHAD
      196       12        *      CALL:   CALL FMQ$SRCHAD(KEY$,FPT$) ALTRET(LOC);
      197       13        *      INPUT:  DCB.ACCT - The account to search for.
      198       14        *              DCB.SETX - 0 to search MAD, else SETX of the set
      199       15        *                 whose PAD is to be searched.
      200       16        *              FPT$ - Ptr to FPT (may be NIL)
      201       17        *      OUTPUT: KEY$ - Ptr to the key found
      202       18        *      DESCRIPTION:  The directory must already be reserved.
      203       19        *        The first granule of the MAD or PAD is read.  If no FPT is
      204       20        *        specified or if NXTA is not requested, FMG$FINDKEY is called
      205       21        *        to find the desried account.  Return if found, altret if not.
      206       22        *        If NXTA is requested, call FMG$LOCKEY.  Call FMG$NXTKEY or
      207       23        *        FMG$CURKEY to locate the next entry in either forward or
      208       24        *        reverse direction (reverse if SRCHCOND.REV is set).
      209       25        *        Altret if no more entries.
      210       26        */
      211       27        /**/
      212       28        FMQ$SRCHAD: PROC(KEY$,FPT$) ALTRET;
      213       29        /* PARAMETERS */
      214       30    1   DCL KEY$ PTR;
      215       31    1   DCL FPT$ PTR;
      216       32        /* LOCAL AUTOMATIC STORAGE */
      217       33    1   DCL JDCB$ PTR;
      218       34    1   DCL DA SBIN WORD;
      219       35    1   DCL BUF$ PTR;
      220       36    1   DCL ACCT$ PTR;
      221       37    1   DCL PACKACCT CHAR(8);
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:37   
      222       38        /* INCLUDE FILES */
      223       39        %MACRO F$DCB(BASED="BASED(JDCB$)");
      224       40        %INCLUDE F$DCB;
      225       89        %MEND;
      226       90        %INCLUDE FM$GRAN;
      227      159        %INCLUDE F$JIT_C;
      228      589        %INCLUDE F_ERRORS_C;
      229      829        %INCLUDE F$CP6V_C;
      230     1055        /* BASED STRUCTURES */
      231     1056        %FPT$OPEN_V (BASED="BASED(FPT$)");
      232     1071        %F$DCB;
      233     1121        /* EXTERNAL DATA */
      234     1122    1   DCL B$JIT$ PTR SYMREF;
      235     1123    1   DCL FM_MADSDA UBIN SYMREF;
      236     1124    1   DCL FM_PADSDA UBIN SYMREF;
      237     1125    1   DCL FM_SYSSETX UBIN SYMREF;
      238     1126        /* EXTERNAL ROUTINES */
      239     1127    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
      240     1128    1   DCL FMG$CURKEY ENTRY(3) ALTRET;
      241     1129    1   DCL FMG$FINDKEY ENTRY(4) ALTRET;
      242     1130    1   DCL FMG$NXTKEY ENTRY(3) ALTRET;
      243     1131    1   DCL FMO$PACKACCT ENTRY(2);
      244     1132        /**/
      245     1133    1           JDCB$=B$JIT.DCB$;
      246     1134    2           IF F$DCB.SETX=0 THEN DO;
      247     1135    2              DA=FM_MADSDA;                /* READ MAD                           */
      248     1136    2              F$DCB.GTYP=FMGTMAD;
      249     1137    2              F$DCB.SETX=FM_SYSSETX;       /* SYSTEM PACK SET INDEX              */
      250     1138    2              END;
      251     1139    2           ELSE DO;
      252     1140    2              DA=FM_PADSDA;
      253     1141    2              F$DCB.GTYP=FMGTPAD;
      254     1142    2              END;
      255     1143    1           ACCT$=ADDR(PACKACCT);
      256     1144    1           CALL FMO$PACKACCT(JDCB$,ACCT$);
      257     1145    1           CALL FMD$REDBUF(BUF$,1,DA,0,0) ALTRET(ERR);
      258     1146        /**/
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:38   
      259     1147    1           IF FPT$~=ADDR(NIL) THEN         /* THERE IS AN FPT                    */
      260     1148    2              IF FPT$OPEN_V.OPER.NXTA THEN DO; /* WANT NEXT ACCOUNT              */
      261     1149    2                 CALL FMG$FINDKEY(DA,DA,KEY$,ACCT$) ALTRET(NOKNXT);
      262     1150    3   NXTA:         IF FPT$OPEN_V.SRCHCOND.REV THEN DO; /* WANT PREV                */
      263     1151    3                    F$DCB.RPOS='1'B;
      264     1152    3                    CALL FMG$CURKEY(DA,DA,KEY$) ALTRET(ERR);
      265     1153    3                    END;
      266     1154    2                 ELSE
      267     1155    2                 CALL FMG$NXTKEY(DA,DA,KEY$) ALTRET(ERR);
      268     1156    2                 GOTO DONE;
      269     1157        /**/
      270     1158    3   NOKNXT:       IF B$JIT.ERR.CODE=%E$NOKEY THEN DO;
      271     1159    3                    B$JIT.ERR='0'B;        /* Get rid of spurious error          */
      272     1160    3                    GOTO NXTA;
      273     1161    3                    END;
      274     1162    2                 ELSE
      275     1163    2                    GOTO ERR;
      276     1164    2                 END;
      277     1165        /**/
      278     1166        /**/
      279     1167    1              CALL FMG$FINDKEY(DA,DA,KEY$,ACCT$) ALTRET(ERR);
      280     1168        /**/
      281     1169    1   DONE:      B$JIT.ERR='0'B;
      282     1170    1              RETURN;
      283     1171    1   ERR:       ;
      284     1172    1              ALTRETURN;
      285     1173        /**/
      286     1174    1   END FMQ$SRCHAD;
      287     1175        %EOD;

PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:39   
--  Include file information  --

   F$CP6V_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   FM$GRAN.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
      No diagnostics issued in procedure FMQ$SRCHAD.

   Procedure FMQ$SRCHAD requires 119 words for executable code.
   Procedure FMQ$SRCHAD requires 18 words of local(AUTO) storage.

PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:40   

 Object Unit name= FMQ$SRCHAD                                 File name= FMQ$DIR.:E05TOU
 UTS= JUL 29 '97 17:00:10.72 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   119    167  FMQ$SRCHAD
    1  RoData even  none     3      3  FMQ$SRCHAD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        2  FMQ$SRCHAD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 FMO$PACKACCT
 yes     yes           Std       4 FMG$FINDKEY
 yes     yes           Std       3 FMG$NXTKEY
 yes     yes           Std       3 FMG$CURKEY
 yes     yes           Std       6 FMD$REDBUF
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:41   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                FM_MADSDA                             FM_PADSDA
     FM_SYSSETX                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:42   


      185        1        /*T***********************************************************/
      186        2        /*T*                                                         */
      187        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      188        4        /*T*                                                         */
      189        5        /*T***********************************************************/
      190        6        /*F*   NAME:   FMQ$SRCHAD
      191        7        *      PURPOSE:  Search an account directory                                 */
      192        8                                                                                  /*
      193        9                                                                                   *
      194       10                                                                                     */
      195       11        /*D*   NAME:   FMQ$SRCHAD
      196       12        *      CALL:   CALL FMQ$SRCHAD(KEY$,FPT$) ALTRET(LOC);
      197       13        *      INPUT:  DCB.ACCT - The account to search for.
      198       14        *              DCB.SETX - 0 to search MAD, else SETX of the set
      199       15        *                 whose PAD is to be searched.
      200       16        *              FPT$ - Ptr to FPT (may be NIL)
      201       17        *      OUTPUT: KEY$ - Ptr to the key found
      202       18        *      DESCRIPTION:  The directory must already be reserved.
      203       19        *        The first granule of the MAD or PAD is read.  If no FPT is
      204       20        *        specified or if NXTA is not requested, FMG$FINDKEY is called
      205       21        *        to find the desried account.  Return if found, altret if not.
      206       22        *        If NXTA is requested, call FMG$LOCKEY.  Call FMG$NXTKEY or
      207       23        *        FMG$CURKEY to locate the next entry in either forward or
      208       24        *        reverse direction (reverse if SRCHCOND.REV is set).
      209       25        *        Altret if no more entries.
      210       26        */
      211       27        /**/
      212       28        FMQ$SRCHAD: PROC(KEY$,FPT$) ALTRET;

     28  0 000000   000000 700200 xent  FMQ$SRCHAD   TSX0  ! X66_AUTO_2
         0 000001   000022 000002                    ZERO    18,2

      213       29        /* PARAMETERS */
      214       30    1   DCL KEY$ PTR;
      215       31    1   DCL FPT$ PTR;
      216       32        /* LOCAL AUTOMATIC STORAGE */
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:43   
      217       33    1   DCL JDCB$ PTR;
      218       34    1   DCL DA SBIN WORD;
      219       35    1   DCL BUF$ PTR;
      220       36    1   DCL ACCT$ PTR;
      221       37    1   DCL PACKACCT CHAR(8);
      222       38        /* INCLUDE FILES */
      223       39        %MACRO F$DCB(BASED="BASED(JDCB$)");
      224       40        %INCLUDE F$DCB;
      225       89        %MEND;
      226       90        %INCLUDE FM$GRAN;
      227      159        %INCLUDE F$JIT_C;
      228      589        %INCLUDE F_ERRORS_C;
      229      829        %INCLUDE F$CP6V_C;
      230     1055        /* BASED STRUCTURES */
      231     1056        %FPT$OPEN_V (BASED="BASED(FPT$)");
      232     1071        %F$DCB;
      233     1121        /* EXTERNAL DATA */
      234     1122    1   DCL B$JIT$ PTR SYMREF;
      235     1123    1   DCL FM_MADSDA UBIN SYMREF;
      236     1124    1   DCL FM_PADSDA UBIN SYMREF;
      237     1125    1   DCL FM_SYSSETX UBIN SYMREF;
      238     1126        /* EXTERNAL ROUTINES */
      239     1127    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
      240     1128    1   DCL FMG$CURKEY ENTRY(3) ALTRET;
      241     1129    1   DCL FMG$FINDKEY ENTRY(4) ALTRET;
      242     1130    1   DCL FMG$NXTKEY ENTRY(3) ALTRET;
      243     1131    1   DCL FMO$PACKACCT ENTRY(2);
      244     1132        /**/
      245     1133    1           JDCB$=B$JIT.DCB$;

   1133  0 000002   000000 470400 xsym               LDP0    B$JIT$
         0 000003   000232 236100                    LDQ     154,,PR0
         0 000004   200005 756100                    STQ     JDCB$,,AUTO

      246     1134    2           IF F$DCB.SETX=0 THEN DO;

   1134  0 000005   200005 471500                    LDP1    JDCB$,,AUTO
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:44   
         0 000006   100051 720100                    LXL0    41,,PR1
         0 000007   000021 601000 0                  TNZ     s:1140

      247     1135    2              DA=FM_MADSDA;                /* READ MAD                           */

   1135  0 000010   000000 235000 xsym               LDA     FM_MADSDA
         0 000011   200006 755100                    STA     DA,,AUTO

      248     1136    2              F$DCB.GTYP=FMGTMAD;

   1136  0 000012   100064 236100                    LDQ     52,,PR1
         0 000013   000000 376000 1                  ANQ     0
         0 000014   010000 276003                    ORQ     4096,DU
         0 000015   100064 756100                    STQ     52,,PR1

      249     1137    2              F$DCB.SETX=FM_SYSSETX;       /* SYSTEM PACK SET INDEX              */

   1137  0 000016   000000 721000 xsym               LXL1    FM_SYSSETX
         0 000017   100051 441100                    SXL1    41,,PR1

      250     1138    2              END;

   1138  0 000020   000027 710000 0                  TRA     s:1143

      251     1139    2           ELSE DO;

      252     1140    2              DA=FM_PADSDA;

   1140  0 000021   000000 235000 xsym               LDA     FM_PADSDA
         0 000022   200006 755100                    STA     DA,,AUTO

      253     1141    2              F$DCB.GTYP=FMGTPAD;

   1141  0 000023   100064 236100                    LDQ     52,,PR1
         0 000024   000000 376000 1                  ANQ     0
         0 000025   014000 276003                    ORQ     6144,DU
         0 000026   100064 756100                    STQ     52,,PR1
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:45   

      254     1142    2              END;

      255     1143    1           ACCT$=ADDR(PACKACCT);

   1143  0 000027   200011 633500                    EPPR3   PACKACCT,,AUTO
         0 000030   200010 453500                    STP3    ACCT$,,AUTO

      256     1144    1           CALL FMO$PACKACCT(JDCB$,ACCT$);

   1144  0 000031   200010 634500                    EPPR4   ACCT$,,AUTO
         0 000032   200015 454500                    STP4    PACKACCT+4,,AUTO
         0 000033   200005 635500                    EPPR5   JDCB$,,AUTO
         0 000034   200014 455500                    STP5    PACKACCT+3,,AUTO
         0 000035   200014 630500                    EPPR0   PACKACCT+3,,AUTO
         0 000036   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000037   000000 701000 xent               TSX1    FMO$PACKACCT
         0 000040   000000 011000                    NOP     0

      257     1145    1           CALL FMD$REDBUF(BUF$,1,DA,0,0) ALTRET(ERR);

   1145  0 000041   000001 236000 1                  LDQ     1
         0 000042   200020 756100                    STQ     PACKACCT+7,,AUTO
         0 000043   200017 756100                    STQ     PACKACCT+6,,AUTO
         0 000044   200006 630500                    EPPR0   DA,,AUTO
         0 000045   200016 450500                    STP0    PACKACCT+5,,AUTO
         0 000046   000002 236000 1                  LDQ     2
         0 000047   200015 756100                    STQ     PACKACCT+4,,AUTO
         0 000050   200007 631500                    EPPR1   BUF$,,AUTO
         0 000051   200014 451500                    STP1    PACKACCT+3,,AUTO
         0 000052   200014 630500                    EPPR0   PACKACCT+3,,AUTO
         0 000053   000023 631400 xsym               EPPR1   B_VECTNIL+19
         0 000054   000000 701000 xent               TSX1    FMD$REDBUF
         0 000055   000166 702000 0                  TSX2    ERR

      258     1146        /**/
      259     1147    1           IF FPT$~=ADDR(NIL) THEN         /* THERE IS AN FPT                    */
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:46   

   1147  0 000056   200004 470500                    LDP0    @FPT$,,AUTO
         0 000057   000000 236100                    LDQ     0,,PR0
         0 000060   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000061   000147 600000 0                  TZE     s:1167

      260     1148    2              IF FPT$OPEN_V.OPER.NXTA THEN DO; /* WANT NEXT ACCOUNT              */

   1148  0 000062   000000 471500                    LDP1    0,,PR0
         0 000063   100000 236100                    LDQ     0,,PR1
         0 000064   010000 316007                    CANQ    4096,DL
         0 000065   000147 600000 0                  TZE     s:1167

      261     1149    2                 CALL FMG$FINDKEY(DA,DA,KEY$,ACCT$) ALTRET(NOKNXT);

   1149  0 000066   200010 633500                    EPPR3   ACCT$,,AUTO
         0 000067   200017 453500                    STP3    PACKACCT+6,,AUTO
         0 000070   200003 236100                    LDQ     @KEY$,,AUTO
         0 000071   200016 756100                    STQ     PACKACCT+5,,AUTO
         0 000072   200006 631500                    EPPR1   DA,,AUTO
         0 000073   200015 451500                    STP1    PACKACCT+4,,AUTO
         0 000074   200006 634500                    EPPR4   DA,,AUTO
         0 000075   200014 454500                    STP4    PACKACCT+3,,AUTO
         0 000076   200014 630500                    EPPR0   PACKACCT+3,,AUTO
         0 000077   000022 631400 xsym               EPPR1   B_VECTNIL+18
         0 000100   000000 701000 xent               TSX1    FMG$FINDKEY
         0 000101   000140 702000 0                  TSX2    NOKNXT

      262     1150    3   NXTA:         IF FPT$OPEN_V.SRCHCOND.REV THEN DO; /* WANT PREV                */

   1150  0 000102   200004 470500       NXTA         LDP0    @FPT$,,AUTO
         0 000103   000000 471500                    LDP1    0,,PR0
         0 000104   100001 236100                    LDQ     1,,PR1
         0 000105   000001 316003                    CANQ    1,DU
         0 000106   000125 600000 0                  TZE     s:1155

      263     1151    3                    F$DCB.RPOS='1'B;
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:47   

   1151  0 000107   200005 473500                    LDP3    JDCB$,,AUTO
         0 000110   010000 236007                    LDQ     4096,DL
         0 000111   300064 256100                    ORSQ    52,,PR3

      264     1152    3                    CALL FMG$CURKEY(DA,DA,KEY$) ALTRET(ERR);

   1152  0 000112   200003 236100                    LDQ     @KEY$,,AUTO
         0 000113   200016 756100                    STQ     PACKACCT+5,,AUTO
         0 000114   200006 631500                    EPPR1   DA,,AUTO
         0 000115   200015 451500                    STP1    PACKACCT+4,,AUTO
         0 000116   200006 634500                    EPPR4   DA,,AUTO
         0 000117   200014 454500                    STP4    PACKACCT+3,,AUTO
         0 000120   200014 630500                    EPPR0   PACKACCT+3,,AUTO
         0 000121   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000122   000000 701000 xent               TSX1    FMG$CURKEY
         0 000123   000166 702000 0                  TSX2    ERR

      265     1153    3                    END;

   1153  0 000124   000137 710000 0                  TRA     s:1156

      266     1154    2                 ELSE
      267     1155    2                 CALL FMG$NXTKEY(DA,DA,KEY$) ALTRET(ERR);

   1155  0 000125   200003 236100                    LDQ     @KEY$,,AUTO
         0 000126   200016 756100                    STQ     PACKACCT+5,,AUTO
         0 000127   200006 631500                    EPPR1   DA,,AUTO
         0 000130   200015 451500                    STP1    PACKACCT+4,,AUTO
         0 000131   200006 633500                    EPPR3   DA,,AUTO
         0 000132   200014 453500                    STP3    PACKACCT+3,,AUTO
         0 000133   200014 630500                    EPPR0   PACKACCT+3,,AUTO
         0 000134   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000135   000000 701000 xent               TSX1    FMG$NXTKEY
         0 000136   000166 702000 0                  TSX2    ERR

      268     1156    2                 GOTO DONE;
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:48   

   1156  0 000137   000163 710000 0                  TRA     DONE

      269     1157        /**/
      270     1158    3   NOKNXT:       IF B$JIT.ERR.CODE=%E$NOKEY THEN DO;

   1158  0 000140   000000 470400 xsym  NOKNXT       LDP0    B$JIT$
         0 000141   000012 236100                    LDQ     10,,PR0
         0 000142   377770 376007                    ANQ     131064,DL
         0 000143   001020 116007                    CMPQ    528,DL
         0 000144   000166 601000 0                  TNZ     ERR

      271     1159    3                    B$JIT.ERR='0'B;        /* Get rid of spurious error          */

   1159  0 000145   000012 450100                    STZ     10,,PR0

      272     1160    3                    GOTO NXTA;

   1160  0 000146   000102 710000 0                  TRA     NXTA

      273     1161    3                    END;
      274     1162    2                 ELSE
      275     1163    2                    GOTO ERR;
      276     1164    2                 END;
      277     1165        /**/
      278     1166        /**/
      279     1167    1              CALL FMG$FINDKEY(DA,DA,KEY$,ACCT$) ALTRET(ERR);

   1167  0 000147   200010 631500                    EPPR1   ACCT$,,AUTO
         0 000150   200017 451500                    STP1    PACKACCT+6,,AUTO
         0 000151   200003 236100                    LDQ     @KEY$,,AUTO
         0 000152   200016 756100                    STQ     PACKACCT+5,,AUTO
         0 000153   200006 633500                    EPPR3   DA,,AUTO
         0 000154   200015 453500                    STP3    PACKACCT+4,,AUTO
         0 000155   200006 634500                    EPPR4   DA,,AUTO
         0 000156   200014 454500                    STP4    PACKACCT+3,,AUTO
         0 000157   200014 630500                    EPPR0   PACKACCT+3,,AUTO
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:49   
         0 000160   000022 631400 xsym               EPPR1   B_VECTNIL+18
         0 000161   000000 701000 xent               TSX1    FMG$FINDKEY
         0 000162   000166 702000 0                  TSX2    ERR

      280     1168        /**/
      281     1169    1   DONE:      B$JIT.ERR='0'B;

   1169  0 000163   000000 470400 xsym  DONE         LDP0    B$JIT$
         0 000164   000012 450100                    STZ     10,,PR0

      282     1170    1              RETURN;

   1170  0 000165   000000 702200 xent               TSX2  ! X66_ARET

   1160  0 000166                       ERR          null
      283     1171    1   ERR:       ;
      284     1172    1              ALTRETURN;

   1172  0 000166   000000 702200 xent               TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
   1     000   743777 777777   000002 006000   000003 006000                    ............
      285     1173        /**/
      286     1174    1   END FMQ$SRCHAD;
      287     1175        %EOD;

PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:50   
--  Include file information  --

   F$CP6V_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   FM$GRAN.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
      No diagnostics issued in procedure FMQ$SRCHAD.
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:51   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @FPT$                      3-0-0/w PTR         r     1 @KEY$
    10-0-0/w PTR         r     1 ACCT$                      7-0-0/w PTR         r     1 BUF$
     6-0-0/w SBIN        r     1 DA                        *0-0-0/w PTR         r     1 FPT$
     5-0-0/w PTR         r     1 JDCB$                     *0-0-0/w PTR         r     1 KEY$
    11-0-0/c CHAR(8)     r     1 PACKACCT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w UBIN        r     1 FM_MADSDA
     0-0-0/w UBIN        r     1 FM_PADSDA                  0-0-0/w UBIN        r     1 FM_SYSSETX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/d STRC(756)   r     1 FPT$OPEN_V


   Procedure FMQ$SRCHAD requires 119 words for executable code.
   Procedure FMQ$SRCHAD requires 18 words of local(AUTO) storage.
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:52   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:53   
          MINI XREF LISTING

ACCT$
        36**DCL      1143<<ASSIGN   1144<>CALL     1149<>CALL     1167<>CALL
B$JIT.DCB$
       576**DCL      1133>>ASSIGN
B$JIT.ERR
       486**DCL      1159<<ASSIGN   1169<<ASSIGN
B$JIT.ERR.CODE
       487**DCL      1158>>IF
B$JIT.ERR.MID
       487**DCL       487--REDEF
B$JIT$
      1122**DCL       481--IMP-PTR  1133>>ASSIGN   1158>>IF       1159>>ASSIGN   1169>>ASSIGN
BUF$
        35**DCL      1145<>CALL
DA
        34**DCL      1135<<ASSIGN   1140<<ASSIGN   1145<>CALL     1149<>CALL     1149<>CALL     1152<>CALL
      1152<>CALL     1155<>CALL     1155<>CALL     1167<>CALL     1167<>CALL
DONE
      1169**LABEL    1156--GOTO
ERR
      1160**LABEL    1145--CALLALT  1152--CALLALT  1155--CALLALT  1163--GOTO     1167--CALLALT
F$DCB.ACTPOS
      1097**DCL      1097--REDEF
F$DCB.ARS
      1072**DCL      1072--REDEF
F$DCB.ATTR
      1090**DCL      1091--REDEF
F$DCB.BORROW
      1105**DCL      1105--REDEF    1105--REDEF    1105--REDEF
F$DCB.DCBNAME.L
      1119**DCL      1119--IMP-SIZ
F$DCB.EOMCHAR
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:54   
      1076**DCL      1076--REDEF
F$DCB.FLDID
      1100**DCL      1100--REDEF
F$DCB.FORM$
      1094**DCL      1094--REDEF
F$DCB.FSECT
      1110**DCL      1110--REDEF
F$DCB.FSN
      1087**DCL      1087--REDEF    1087--REDEF    1088--REDEF
F$DCB.GTYP
      1101**DCL      1136<<ASSIGN   1141<<ASSIGN
F$DCB.HEADER$
      1093**DCL      1093--REDEF
F$DCB.IXTNSIZE
      1091**DCL      1091--REDEF
F$DCB.LASTSTA$
      1081**DCL      1081--REDEF
F$DCB.LVL
      1106**DCL      1106--REDEF
F$DCB.NAME.C
      1081**DCL      1081--REDEF
F$DCB.NOEOF
      1102**DCL      1102--REDEF
F$DCB.NRECS
      1092**DCL      1092--REDEF
F$DCB.NRECX
      1111**DCL      1111--REDEF
F$DCB.OHDR
      1103**DCL      1103--REDEF
F$DCB.ORG
      1086**DCL      1086--REDEF
F$DCB.PRECNO
      1109**DCL      1109--REDEF
F$DCB.RCSZ
      1114**DCL      1114--REDEF
F$DCB.RES
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:55   
      1082**DCL      1082--REDEF
F$DCB.RPOS
      1103**DCL      1151<<ASSIGN
F$DCB.SETX
      1094**DCL      1094--REDEF    1134>>IF       1137<<ASSIGN
F$DCB.TAB$
      1093**DCL      1094--REDEF
F$DCB.TDA
      1108**DCL      1108--REDEF
F$DCB.WSN
      1083**DCL      1083--REDEF
FMD$REDBUF
      1127**DCL-ENT  1145--CALL
FMG$CURKEY
      1128**DCL-ENT  1152--CALL
FMG$FINDKEY
      1129**DCL-ENT  1149--CALL     1167--CALL
FMG$NXTKEY
      1130**DCL-ENT  1155--CALL
FMO$PACKACCT
      1131**DCL-ENT  1144--CALL
FM_MADSDA
      1123**DCL      1135>>ASSIGN
FM_PADSDA
      1124**DCL      1140>>ASSIGN
FM_SYSSETX
      1125**DCL      1137>>ASSIGN
FPT$
        31**DCL        28--PROC     1057--IMP-PTR  1147>>IF       1148>>IF       1150>>IF
FPT$OPEN_V.FSN
      1067**DCL      1067--REDEF    1068--REDEF
FPT$OPEN_V.OPER.NXTA
      1058**DCL      1148>>IF
FPT$OPEN_V.SRCHCOND.REV
      1060**DCL      1150>>IF
JDCB$
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:56   
        33**DCL      1072--IMP-PTR  1133<<ASSIGN   1134>>IF       1136>>ASSIGN   1137>>ASSIGN   1141>>ASSIGN
      1144<>CALL     1151>>ASSIGN
KEY$
        30**DCL        28--PROC     1149<>CALL     1152<>CALL     1155<>CALL     1167<>CALL
NOKNXT
      1158**LABEL    1149--CALLALT
NXTA
      1150**LABEL    1160--GOTO
PACKACCT
        37**DCL      1143--ASSIGN
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:57   
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FMQ$SRCHAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:00 Page:58   
              MINI UREF LISTING

FMQ$SRCHAD      28**PROC

PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:59   
      288        1        /*T***********************************************************/
      289        2        /*T*                                                         */
      290        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      291        4        /*T*                                                         */
      292        5        /*T***********************************************************/
      293        6        /*F*   NAME:   FMQ$BLDFD
      294        7        *      PURPOSE:  Create a new file directory                                 */
      295        8                                                                                  /*
      296        9                                                                                   *
      297       10                                                                                  */
      298       11        /*D*   NAME:   FMQ$BLDFD
      299       12        *      CALL:   CALL FMQ$BLDFD(FM$CFUA) ALTRET(LOC);
      300       13        *      INPUT:  FM$CFUA - Account block
      301       14        *      OUTPUT: FM$CFUA.FLAGS.EXIST and NEW changed, FDFITSDA changed.
      302       15        *      DESCRIPTION:  If not the * file directory the PAD is read
      303       16        *        since the PAD FIT is same as FD FIT.  The PAD granule is
      304       17        *        modified to remove all but the FIT, a granule is allocated,
      305       18        *        and buffer is written.  If this is the * directory, it is
      306       19        *        cataloged in JIT and routine exits.  For other directories,
      307       20        *        the FD disk addr is placed in the CFU account block, the
      308       21        *        account directory is reserved for write and searched to
      309       22        *        find the place to insert new name.  Name is inserted via
      310       23        *        FMG$ADDKEY, disk addr is placed in entry, and PAD is written.
      311       24        *        CFU account block flags are changed and PAD reservation
      312       25        *        is released.
      313       26        */
      314       27        /**/
      315       28        FMQ$BLDFD: PROC(FM$CFUA) ALTRET;
      316       29        /* LOCAL AUTOMATIC STORAGE */
      317       30    1   DCL JDCB$ PTR;
      318       31    1   DCL DA SBIN;
      319       32    1   DCL ACN$ PTR;
      320       33    1   DCL BUF$ PTR;
      321       34    1   DCL SEG$ PTR;
      322       35    1   DCL I REDEF SEG$ UBIN;
      323       36    1   DCL PACKACCT CHAR(8);
      324       37    1   DCL PACKACCTB REDEF PACKACCT BIT(72);
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:60   
      325       38    1   DCL KEY$ PTR;
      326       39    1   DCL PAD$ PTR;
      327       40        /* EXTERNAL ROUTINES */
      328       41    1   DCL FMD$FLSHBUF ENTRY(1);
      329       42    1   DCL FMD$GETBUF ENTRY(3);
      330       43    1   DCL FMD$REDBUFBC ENTRY(6) ALTRET;
      331       44    1   DCL FMO$FDHASH ENTRY(2);
      332       45    1   DCL FMO$LOCCODE ENTRY(2)ALTRET;
      333       46    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
      334       47    1   DCL FMQ$SRCHAD ENTRY(2) ALTRET;
      335       48    1   DCL FMO$PACKACCT ENTRY(2);
      336       49    1   DCL FMG$ADDKEY ENTRY(4) ALTRET;
      337       50    1   DCL FMD$WRTBUF ENTRY(1);
      338       51    1   DCL FAG$G1DIR ENTRY(1) ALTRET;
      339       52    1   DCL SSS$SYSTIME ENTRY(1);
      340       53    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      341       54    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      342       55    1   DCL SC_FMQ81 ENTRY CONV(2,0);
      343       56    1   DCL SC_FMQ83 ENTRY CONV(2,0);
      344       57    1   DCL SC_FMQ94 ENTRY CONV(2,0);
      345       58        /* INCLUDE FILES */
      346       59        %INCLUDE F$JIT_C;
      347      489        %INCLUDE F_ERRORS_C;
      348      729        %INCLUDE FM$MACROS;
      349     1104        %INCLUDE CP_6_SUBS;
      350     1644        %MACRO F$DCB(BASED=BASED);
      351     1645        %INCLUDE F$DCB;
      352     1694        %MEND;
      353     1695        /* PARAMETERS */
      354     1696        %FM$CFUA (BASED=PARAM);
      355     1702        /* EXTERNAL DATA */
      356     1703    1   DCL B$JIT$ PTR SYMREF;
      357     1704    1   DCL FM$BUF$(0:0) PTR SYMREF;
      358     1705    1   DCL FM_PADSDA SBIN SYMREF;
      359     1706    1   DCL FM$SET$ PTR SYMREF;
      360     1707        /* BASED STRUCTURES */
      361     1708        %F$DCB (BASED="BASED(JDCB$)");
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:61   
      362     1758        %FM$GRAN (BASED="BASED(BUF$)");
      363     1762        %FM$SET  (BASED="BASED(FM$SET$)");
      364     1767        %FM$ADKEY (BASED="BASED(KEY$)");
      365     1770        %FM$KEYTBL;
      366     1773        %CODE04(BASED="BASED(SEG$)");
      367     1781        %CODE14(BASED="BASED(PAD$)");
      368     1791        %FM$FIT(BASED="BASED(BUF$)");
      369     1794    1   DCL 1 WRDS20 BASED ALIGNED,
      370     1795    1         2 *(0:19) UBIN;
      371     1796        /* CONSTANTS */
      372     1797    1   DCL 1 INITKEYTBL CONSTANT,
      373     1798    1         2 * UBIN(9) UNAL INIT(SIZEC(FM$KEYTBL));
      374     1799        /**/
      375     1800    1           JDCB$=B$JIT.DCB$;
      376     1801        /**/
      377     1802        /* SCREECH IF DCB AND CFU ACCOUNTS DIFFER */
      378     1803    1           IF NOT F$DCB.STARF THEN
      379     1804    1              IF FM$CFUA.ACCT~=F$DCB.ACCT THEN
      380     1805    1              CALL SC_FMQ83;
      381     1806        /*S*    SCREECH_CODE:   FMQ-S$FM83
      382     1807        *      TYPE:   SUA
      383     1808        *      MESSAGE:  Account in CFU differs from DCB */
      384     1809        /**/
      385     1810    2           IF F$DCB.STARF THEN DO;         /* STAR DIRECTORY                     */
      386     1811    2              CALL FMD$FLSHBUF(0);
      387     1812    2              CALL FMD$GETBUF(0,1,ACN$);
      388     1813    2              BUF$=ACN$;
      389     1814    2              BUF$->WRDS20='0'B;           /* Clear header and a few more words  */
      390     1815    2              FM$GRAN.FCEX=SIZEW(FM$GRAN);
      391     1816    2              END;
      392     1817    2           ELSE DO;                        /* REGULAR DIRECTORY                  */
      393     1818    2              F$DCB.GTYP=FMGTPAD;          /* READ PAD TO GET FIT                */
      394     1819    2              CALL FMD$REDBUFBC(ACN$,0,FM_PADSDA,,0) ALTRET(ERR1);
      395     1820    2              BUF$=ACN$;
      396     1821    2              FM$GRAN.KEYCNT=0;            /* NO KEYS HERE                       */
      397     1822    2              END;
      398     1823    1           CALL FAG$G1DIR(DA) ALTRET(ERR1); /* ALLOCATE A GRANULE                */
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:62   
      399     1824    1           CALL FMO$FDHASH(B$JIT.DCB$,FM$GRAN.STAMP.HASH);
              1824                    /* CALC HASH               */
      400     1825    1           FM$GRAN.STAMP.GMOD=DA;
      401     1826    1           FM$GRAN.HDR='1'B;
      402     1827    1           FM$GRAN.LVL=FMGTFD;
      403     1828    1           FM$GRAN.NAVX=FM$GRAN.FCEX+SIZEW(FM$KEYTBL);
      404     1829    1           FM$GRAN.AVAIL=1024-FM$GRAN.NAVX;
      405     1830    1           FM$GRAN.FLINK=0;
      406     1831    1           FM$GRAN.BLINK=0;
      407     1832    1           PAD$=PINCRW(BUF$,SIZEW(FM$GRAN));
      408     1833    1           ACN$=PAD$;
      409     1834    1           CALL FMO$LOCCODP(ACN$,4)ALTRET(NOTIMES);
      410     1835    1           SEG$=ACN$;
      411     1836    1           CODE04='0'B;
      412     1837    1           CODE04.CREATOR.NAME=B$JIT.UNAME;
      413     1838    1           CODE04.CREATOR.ACCT=B$JIT.ACCN;
      414     1839    1           CALL SSS$SYSTIME(CODE04.CREATION);
      415     1840    1           CODE04.MODIFY=CODE04.CREATION;
      416     1841    1   NOTIMES:;
      417     1842    1           I=14;
      418     1843    1           CALL FMO$LOCCODE(PAD$,I)ALTRET(NO14);
      419     1844    1           FM$FIT.CODES.NDW(I+SIZEW(FM$GRAN))=SIZEW(CODE14);/*STRIP OWNERS*/
      420     1845    1           CODE14.OWNER.ACCT(0)=' ';
      421     1846    1   NO14:   ;
      422     1847    1           PINCRW(BUF$,FM$GRAN.FCEX)->FM$KEYTBL=INITKEYTBL;
      423     1848    1           F$DCB.BFR.DA(0)=DA;
      424     1849    1           F$DCB.BFR.SCRUB(0)='1'B;
      425     1850    1           CALL FMD$WRTBUF(0);             /* WRITE IT OUT                       */
      426     1851        /**/
      427     1852        /* CATALOG THE FILE DIRECTORY JUST BUILT */
      428     1853        /**/
      429     1854    2           IF F$DCB.STARF THEN DO;
      430     1855    2              B$JIT.STAR.DA(0)=DA;
      431     1856    2              RETURN;
      432     1857    2              END;
      433     1858        /**/
      434     1859    1           PAD$=ADDR(FM$SET(F$DCB.SETX));  /* SET TABLE ADDR                     */
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:63   
      435     1860        /* RESERVE ACCOUNT DIRECTORY FOR WRITE */
      436     1861    1           CALL UQB$MENQX(PAD$)ALTRET(ENQERR);
      437     1862    1           CALL FMQ$SRCHAD(KEY$,ADDR(NIL)) ALTRET(NOFD);
      438     1863    2           IF FM$ADKEY.D THEN DO;
      439     1864    2              FM$ADKEY.D='0'B;
      440     1865    2              GOTO OLDFD;
      441     1866    2              END;
      442     1867    1           CALL SC_FMQ81;                  /* SCREECH IF ALREADY CATALOGED       */
      443     1868        /*S*    SCREECH_CODE:   FMQ-S$FM81
      444     1869        *       TYPE:   SUA
      445     1870        *       MESSAGE:  FD already exists but CFU block says it is new
      446     1871        */
      447     1872        /**/
      448     1873    1   NOFD:   ACN$=ADDR(PACKACCT);
      449     1874    1           CALL FMO$PACKACCT(B$JIT.DCB$,ACN$); /* CREATE ACCOUNT KEY                 */
      450     1875    1           CALL FMG$ADDKEY(SEG$,SIZEW(FM$ADKEY)-2,KEY$,ACN$) ALTRET(ERR);
      451     1876    1   OLDFD:  ;
      452     1877    1           FM$ADKEY.FDSDA=DA;
      453     1878    1           CALL FMD$WRTBUF(1);
      454     1879        /**/
      455     1880    1           FM$CFUA.FDFITSDA=DA;
      456     1881    1           FM$CFUA.FDCSDA=DA;
      457     1882    1           FM$CFUA.FLAGS.EXIST='1'B;
      458     1883    1           FM$CFUA.FLAGS.NEW='0'B;
      459     1884        /* RELEASE AD RESERVATION */
      460     1885    1           CALL UQB$MDEQ(PAD$);
      461     1886    1           RETURN;
      462     1887                                                /*                                    */
      463     1888    1   ERR:    CALL UQB$MDEQ(PAD$);
      464     1889    1   ERR1:   ALTRETURN;
      465     1890                                                /*                                    */
      466     1891    1   ENQERR: ;
      467     1892    1           CALL SC_FMQ94;
      468     1893        /*S*    SCREECH_CODE:   FMQ-S$FM94
      469     1894        *      TYPE:   SUA
      470     1895        *      MESSAGE:  Error attempting to ENQ or DEQ account directory */
      471     1896    1   END FMQ$BLDFD;
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:64   
      472     1897        %EOD;

PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:65   
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$BLDFD.

   Procedure FMQ$BLDFD requires 266 words for executable code.
   Procedure FMQ$BLDFD requires 20 words of local(AUTO) storage.

PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:66   

 Object Unit name= FMQ$BLDFD                                  File name= FMQ$DIR.:E05TOU
 UTS= JUL 29 '97 17:00:30.20 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  FMQ$BLDFD
    1   Proc  even  none   266    412  FMQ$BLDFD
    2  RoData even  none    11     13  FMQ$BLDFD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  FMQ$BLDFD
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:67   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       2 FMO$LOCCODP
         yes           Std       1 SSS$SYSTIME
         yes           Std       3 FMD$GETBUF
         yes           Std       1 FMD$WRTBUF
 yes     yes           Std       2 FMQ$SRCHAD
         yes           Std       2 FMO$FDHASH
 yes     yes           Std       2 FMO$LOCCODE
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       4 FMG$ADDKEY
 yes     yes           Std       1 UQB$MDEQ
         yes           Std       2 FMO$PACKACCT
 yes     yes           Std       6 FMD$REDBUFBC
 yes     yes           Std       1 FAG$G1DIR
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_FMQ83                              SC_FMQ81                              SC_FMQ94
     B$JIT$                                FM_PADSDA                             FM$SET$
     B_VECTNIL
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:68   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:69   


      288        1        /*T***********************************************************/
      289        2        /*T*                                                         */
      290        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      291        4        /*T*                                                         */
      292        5        /*T***********************************************************/
      293        6        /*F*   NAME:   FMQ$BLDFD
      294        7        *      PURPOSE:  Create a new file directory                                 */
      295        8                                                                                  /*
      296        9                                                                                   *
      297       10                                                                                  */
      298       11        /*D*   NAME:   FMQ$BLDFD
      299       12        *      CALL:   CALL FMQ$BLDFD(FM$CFUA) ALTRET(LOC);
      300       13        *      INPUT:  FM$CFUA - Account block
      301       14        *      OUTPUT: FM$CFUA.FLAGS.EXIST and NEW changed, FDFITSDA changed.
      302       15        *      DESCRIPTION:  If not the * file directory the PAD is read
      303       16        *        since the PAD FIT is same as FD FIT.  The PAD granule is
      304       17        *        modified to remove all but the FIT, a granule is allocated,
      305       18        *        and buffer is written.  If this is the * directory, it is
      306       19        *        cataloged in JIT and routine exits.  For other directories,
      307       20        *        the FD disk addr is placed in the CFU account block, the
      308       21        *        account directory is reserved for write and searched to
      309       22        *        find the place to insert new name.  Name is inserted via
      310       23        *        FMG$ADDKEY, disk addr is placed in entry, and PAD is written.
      311       24        *        CFU account block flags are changed and PAD reservation
      312       25        *        is released.
      313       26        */
      314       27        /**/
      315       28        FMQ$BLDFD: PROC(FM$CFUA) ALTRET;

     28  1 000000   000000 700200 xent  FMQ$BLDFD    TSX0  ! X66_AUTO_1
         1 000001   000024 000001                    ZERO    20,1

      316       29        /* LOCAL AUTOMATIC STORAGE */
      317       30    1   DCL JDCB$ PTR;
      318       31    1   DCL DA SBIN;
      319       32    1   DCL ACN$ PTR;
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:70   
      320       33    1   DCL BUF$ PTR;
      321       34    1   DCL SEG$ PTR;
      322       35    1   DCL I REDEF SEG$ UBIN;
      323       36    1   DCL PACKACCT CHAR(8);
      324       37    1   DCL PACKACCTB REDEF PACKACCT BIT(72);
      325       38    1   DCL KEY$ PTR;
      326       39    1   DCL PAD$ PTR;
      327       40        /* EXTERNAL ROUTINES */
      328       41    1   DCL FMD$FLSHBUF ENTRY(1);
      329       42    1   DCL FMD$GETBUF ENTRY(3);
      330       43    1   DCL FMD$REDBUFBC ENTRY(6) ALTRET;
      331       44    1   DCL FMO$FDHASH ENTRY(2);
      332       45    1   DCL FMO$LOCCODE ENTRY(2)ALTRET;
      333       46    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
      334       47    1   DCL FMQ$SRCHAD ENTRY(2) ALTRET;
      335       48    1   DCL FMO$PACKACCT ENTRY(2);
      336       49    1   DCL FMG$ADDKEY ENTRY(4) ALTRET;
      337       50    1   DCL FMD$WRTBUF ENTRY(1);
      338       51    1   DCL FAG$G1DIR ENTRY(1) ALTRET;
      339       52    1   DCL SSS$SYSTIME ENTRY(1);
      340       53    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      341       54    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      342       55    1   DCL SC_FMQ81 ENTRY CONV(2,0);
      343       56    1   DCL SC_FMQ83 ENTRY CONV(2,0);
      344       57    1   DCL SC_FMQ94 ENTRY CONV(2,0);
      345       58        /* INCLUDE FILES */
      346       59        %INCLUDE F$JIT_C;
      347      489        %INCLUDE F_ERRORS_C;
      348      729        %INCLUDE FM$MACROS;
      349     1104        %INCLUDE CP_6_SUBS;
      350     1644        %MACRO F$DCB(BASED=BASED);
      351     1645        %INCLUDE F$DCB;
      352     1694        %MEND;
      353     1695        /* PARAMETERS */
      354     1696        %FM$CFUA (BASED=PARAM);
      355     1702        /* EXTERNAL DATA */
      356     1703    1   DCL B$JIT$ PTR SYMREF;
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:71   
      357     1704    1   DCL FM$BUF$(0:0) PTR SYMREF;
      358     1705    1   DCL FM_PADSDA SBIN SYMREF;
      359     1706    1   DCL FM$SET$ PTR SYMREF;
      360     1707        /* BASED STRUCTURES */
      361     1708        %F$DCB (BASED="BASED(JDCB$)");
      362     1758        %FM$GRAN (BASED="BASED(BUF$)");
      363     1762        %FM$SET  (BASED="BASED(FM$SET$)");
      364     1767        %FM$ADKEY (BASED="BASED(KEY$)");
      365     1770        %FM$KEYTBL;
      366     1773        %CODE04(BASED="BASED(SEG$)");
      367     1781        %CODE14(BASED="BASED(PAD$)");
      368     1791        %FM$FIT(BASED="BASED(BUF$)");
      369     1794    1   DCL 1 WRDS20 BASED ALIGNED,
      370     1795    1         2 *(0:19) UBIN;
      371     1796        /* CONSTANTS */
      372     1797    1   DCL 1 INITKEYTBL CONSTANT,
      373     1798    1         2 * UBIN(9) UNAL INIT(SIZEC(FM$KEYTBL));
      374     1799        /**/
      375     1800    1           JDCB$=B$JIT.DCB$;

   1800  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200004 756100                    STQ     JDCB$,,AUTO

      376     1801        /**/
      377     1802        /* SCREECH IF DCB AND CFU ACCOUNTS DIFFER */
      378     1803    1           IF NOT F$DCB.STARF THEN

   1803  1 000005   200004 471500                    LDP1    JDCB$,,AUTO
         1 000006   100064 236100                    LDQ     52,,PR1
         1 000007   200000 316003                    CANQ    65536,DU
         1 000010   000020 601000 1                  TNZ     s:1810

      379     1804    1              IF FM$CFUA.ACCT~=F$DCB.ACCT THEN

   1804  1 000011   200003 473500                    LDP3    @FM$CFUA,,AUTO
         1 000012   040100 106500                    CMPC    fill='040'O
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:72   
         1 000013   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
         1 000014   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         1 000015   000020 600000 1                  TZE     s:1810

      380     1805    1              CALL SC_FMQ83;

   1805  1 000016   000000 713400 xsym               CLIMB   SC_FMQ83
         1 000017   000000 600000 xsid               climb   nvectors=         0

      381     1806        /*S*    SCREECH_CODE:   FMQ-S$FM83
      382     1807        *      TYPE:   SUA
      383     1808        *      MESSAGE:  Account in CFU differs from DCB */
      384     1809        /**/
      385     1810    2           IF F$DCB.STARF THEN DO;         /* STAR DIRECTORY                     */

   1810  1 000020   200004 470500                    LDP0    JDCB$,,AUTO
         1 000021   000064 236100                    LDQ     52,,PR0
         1 000022   200000 316003                    CANQ    65536,DU
         1 000023   000051 600000 1                  TZE     s:1818

      386     1811    2              CALL FMD$FLSHBUF(0);

   1811  1 000024   000000 630400 2                  EPPR0   0
         1 000025   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000026   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000027   000000 011000                    NOP     0

      387     1812    2              CALL FMD$GETBUF(0,1,ACN$);

   1812  1 000030   200006 630500                    EPPR0   ACN$,,AUTO
         1 000031   200020 450500                    STP0    PAD$+4,,AUTO
         1 000032   000002 237000 2                  LDAQ    2
         1 000033   200016 757100                    STAQ    PAD$+2,,AUTO
         1 000034   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000035   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000036   000000 701000 xent               TSX1    FMD$GETBUF
         1 000037   000000 011000                    NOP     0
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:73   

      388     1813    2              BUF$=ACN$;

   1813  1 000040   200006 236100                    LDQ     ACN$,,AUTO
         1 000041   200007 756100                    STQ     BUF$,,AUTO

      389     1814    2              BUF$->WRDS20='0'B;           /* Clear header and a few more words  */

   1814  1 000042   200007 470500                    LDP0    BUF$,,AUTO
         1 000043   000100 100400                    MLR     fill='000'O
         1 000044   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000045   000000 000120                    ADSC9   0,,PR0                   cn=0,n=80

      390     1815    2              FM$GRAN.FCEX=SIZEW(FM$GRAN);

   1815  1 000046   000005 220003                    LDX0    5,DU
         1 000047   000002 740100                    STX0    2,,PR0

      391     1816    2              END;

   1816  1 000050   000076 710000 1                  TRA     s:1823

      392     1817    2           ELSE DO;                        /* REGULAR DIRECTORY                  */

      393     1818    2              F$DCB.GTYP=FMGTPAD;          /* READ PAD TO GET FIT                */

   1818  1 000051   000004 376000 2                  ANQ     4
         1 000052   014000 276003                    ORQ     6144,DU
         1 000053   000064 756100                    STQ     52,,PR0

      394     1819    2              CALL FMD$REDBUFBC(ACN$,0,FM_PADSDA,,0) ALTRET(ERR1);

   1819  1 000054   000000 236000 2                  LDQ     0
         1 000055   200022 756100                    STQ     PAD$+6,,AUTO
         1 000056   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000057   000005 235000 2                  LDA     5
         1 000060   200020 757100                    STAQ    PAD$+4,,AUTO
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:74   
         1 000061   000000 236000 2                  LDQ     0
         1 000062   200017 756100                    STQ     PAD$+3,,AUTO
         1 000063   200006 631500                    EPPR1   ACN$,,AUTO
         1 000064   200016 451500                    STP1    PAD$+2,,AUTO
         1 000065   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000066   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000067   000000 701000 xent               TSX1    FMD$REDBUFBC
         1 000070   000406 702000 1                  TSX2    ERR1

      395     1820    2              BUF$=ACN$;

   1820  1 000071   200006 236100                    LDQ     ACN$,,AUTO
         1 000072   200007 756100                    STQ     BUF$,,AUTO

      396     1821    2              FM$GRAN.KEYCNT=0;            /* NO KEYS HERE                       */

   1821  1 000073   200007 470500                    LDP0    BUF$,,AUTO
         1 000074   000000 236003                    LDQ     0,DU
         1 000075   000002 552104                    STBQ    2,'04'O,PR0

      397     1822    2              END;

      398     1823    1           CALL FAG$G1DIR(DA) ALTRET(ERR1); /* ALLOCATE A GRANULE                */

   1823  1 000076   200005 631500                    EPPR1   DA,,AUTO
         1 000077   200016 451500                    STP1    PAD$+2,,AUTO
         1 000100   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000101   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000102   000000 701000 xent               TSX1    FAG$G1DIR
         1 000103   000406 702000 1                  TSX2    ERR1

      399     1824    1           CALL FMO$FDHASH(B$JIT.DCB$,FM$GRAN.STAMP.HASH);
              1824                    /* CALC HASH               */

   1824  1 000104   200007 236100                    LDQ     BUF$,,AUTO
         1 000105   200017 756100                    STQ     PAD$+3,,AUTO
         1 000106   000000 236000 xsym               LDQ     B$JIT$
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:75   
         1 000107   000232 036003                    ADLQ    154,DU
         1 000110   200016 756100                    STQ     PAD$+2,,AUTO
         1 000111   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000112   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000113   000000 701000 xent               TSX1    FMO$FDHASH
         1 000114   000000 011000                    NOP     0

      400     1825    1           FM$GRAN.STAMP.GMOD=DA;

   1825  1 000115   200007 470500                    LDP0    BUF$,,AUTO
         1 000116   200005 236100                    LDQ     DA,,AUTO
         1 000117   000000 552104                    STBQ    0,'04'O,PR0

      401     1826    1           FM$GRAN.HDR='1'B;

   1826  1 000120   400000 236007                    LDQ     -131072,DL
         1 000121   000001 256100                    ORSQ    1,,PR0

      402     1827    1           FM$GRAN.LVL=FMGTFD;

   1827  1 000122   000001 236100                    LDQ     1,,PR0
         1 000123   000006 376000 2                  ANQ     6
         1 000124   200000 276007                    ORQ     65536,DL
         1 000125   000001 756100                    STQ     1,,PR0

      403     1828    1           FM$GRAN.NAVX=FM$GRAN.FCEX+SIZEW(FM$KEYTBL);

   1828  1 000126   000002 220100                    LDX0    2,,PR0
         1 000127   000106 621010                    EAX1    70,X0
         1 000130   000001 741100                    STX1    1,,PR0

      404     1829    1           FM$GRAN.AVAIL=1024-FM$GRAN.NAVX;

   1829  1 000131   000001 236100                    LDQ     1,,PR0
         1 000132   000022 772000                    QRL     18
         1 000133   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 000134   002001 036007                    ADLQ    1025,DL
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:76   
         1 000135   000001 676100                    ERQ     1,,PR0
         1 000136   001777 376007                    ANQ     1023,DL
         1 000137   000001 656100                    ERSQ    1,,PR0

      405     1830    1           FM$GRAN.FLINK=0;

   1830  1 000140   000004 450100                    STZ     4,,PR0

      406     1831    1           FM$GRAN.BLINK=0;

   1831  1 000141   000003 450100                    STZ     3,,PR0

      407     1832    1           PAD$=PINCRW(BUF$,SIZEW(FM$GRAN));

   1832  1 000142   200007 236100                    LDQ     BUF$,,AUTO
         1 000143   000005 036003                    ADLQ    5,DU
         1 000144   200014 756100                    STQ     PAD$,,AUTO

      408     1833    1           ACN$=PAD$;

   1833  1 000145   200006 756100                    STQ     ACN$,,AUTO

      409     1834    1           CALL FMO$LOCCODP(ACN$,4)ALTRET(NOTIMES);

   1834  1 000146   000007 236000 2                  LDQ     7
         1 000147   200017 756100                    STQ     PAD$+3,,AUTO
         1 000150   200006 631500                    EPPR1   ACN$,,AUTO
         1 000151   200016 451500                    STP1    PAD$+2,,AUTO
         1 000152   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000153   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000154   000000 701000 xent               TSX1    FMO$LOCCODP
         1 000155   000207 702000 1                  TSX2    NOTIMES

      410     1835    1           SEG$=ACN$;

   1835  1 000156   200006 236100                    LDQ     ACN$,,AUTO
         1 000157   200010 756100                    STQ     SEG$,,AUTO
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:77   

      411     1836    1           CODE04='0'B;

   1836  1 000160   200010 470500                    LDP0    SEG$,,AUTO
         1 000161   000100 100400                    MLR     fill='000'O
         1 000162   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000163   000000 000054                    ADSC9   0,,PR0                   cn=0,n=44

      412     1837    1           CODE04.CREATOR.NAME=B$JIT.UNAME;

   1837  1 000164   000000 470400 xsym               LDP0    B$JIT$
         1 000165   200010 471500                    LDP1    SEG$,,AUTO
         1 000166   040100 100500                    MLR     fill='040'O
         1 000167   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12
         1 000170   100005 000014                    ADSC9   5,,PR1                   cn=0,n=12

      413     1838    1           CODE04.CREATOR.ACCT=B$JIT.ACCN;

   1838  1 000171   200010 471500                    LDP1    SEG$,,AUTO
         1 000172   040100 100500                    MLR     fill='040'O
         1 000173   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 000174   100003 000010                    ADSC9   3,,PR1                   cn=0,n=8

      414     1839    1           CALL SSS$SYSTIME(CODE04.CREATION);

   1839  1 000175   200010 236100                    LDQ     SEG$,,AUTO
         1 000176   000002 036003                    ADLQ    2,DU
         1 000177   200016 756100                    STQ     PAD$+2,,AUTO
         1 000200   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000201   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000202   000000 701000 xent               TSX1    SSS$SYSTIME
         1 000203   000000 011000                    NOP     0

      415     1840    1           CODE04.MODIFY=CODE04.CREATION;

   1840  1 000204   200010 470500                    LDP0    SEG$,,AUTO
         1 000205   000002 236100                    LDQ     2,,PR0
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:78   
         1 000206   000001 756100                    STQ     1,,PR0

   1840  1 000207                       NOTIMES      null
      416     1841    1   NOTIMES:;
      417     1842    1           I=14;

   1842  1 000207   000016 235007                    LDA     14,DL
         1 000210   200010 755100                    STA     SEG$,,AUTO

      418     1843    1           CALL FMO$LOCCODE(PAD$,I)ALTRET(NO14);

   1843  1 000211   200010 630500                    EPPR0   SEG$,,AUTO
         1 000212   200017 450500                    STP0    PAD$+3,,AUTO
         1 000213   200014 631500                    EPPR1   PAD$,,AUTO
         1 000214   200016 451500                    STP1    PAD$+2,,AUTO
         1 000215   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000216   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000217   000000 701000 xent               TSX1    FMO$LOCCODE
         1 000220   000234 702000 1                  TSX2    NO14

      419     1844    1           FM$FIT.CODES.NDW(I+SIZEW(FM$GRAN))=SIZEW(CODE14);/*STRIP OWNERS*/

   1844  1 000221   200007 470500                    LDP0    BUF$,,AUTO
         1 000222   200010 720100                    LXL0    SEG$,,AUTO
         1 000223   000005 236110                    LDQ     5,X0,PR0
         1 000224   000010 376000 2                  ANQ     8
         1 000225   020000 276007                    ORQ     8192,DL
         1 000226   000005 756110                    STQ     5,X0,PR0

      420     1845    1           CODE14.OWNER.ACCT(0)=' ';

   1845  1 000227   200014 471500                    LDP1    PAD$,,AUTO
         1 000230   000035 235000 xsym               LDA     B_VECTNIL+29
         1 000231   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000232   100003 755100                    STA     3,,PR1
         1 000233   100004 756100                    STQ     4,,PR1

PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:79   
   1845  1 000234                       NO14         null
      421     1846    1   NO14:   ;
      422     1847    1           PINCRW(BUF$,FM$GRAN.FCEX)->FM$KEYTBL=INITKEYTBL;

   1847  1 000234   200007 470500                    LDP0    BUF$,,AUTO
         1 000235   000002 220100                    LDX0    2,,PR0
         1 000236   000000 635010                    EAA     0,X0
         1 000237   000020 771000                    ARL     16
         1 000240   000105 100400                    MLR     fill='000'O
         1 000241   000000 000001 0                  ADSC9   INITKEYTBL               cn=0,n=1
         1 000242   000000 000430                    ADSC9   0,A,PR0                  cn=0,n=280

      423     1848    1           F$DCB.BFR.DA(0)=DA;

   1848  1 000243   200004 471500                    LDP1    JDCB$,,AUTO
         1 000244   200005 236100                    LDQ     DA,,AUTO
         1 000245   100115 552134                    STBQ    77,'34'O,PR1

      424     1849    1           F$DCB.BFR.SCRUB(0)='1'B;

   1849  1 000246   200000 236003                    LDQ     65536,DU
         1 000247   100115 256100                    ORSQ    77,,PR1

      425     1850    1           CALL FMD$WRTBUF(0);             /* WRITE IT OUT                       */

   1850  1 000250   000000 630400 2                  EPPR0   0
         1 000251   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000252   000000 701000 xent               TSX1    FMD$WRTBUF
         1 000253   000000 011000                    NOP     0

      426     1851        /**/
      427     1852        /* CATALOG THE FILE DIRECTORY JUST BUILT */
      428     1853        /**/
      429     1854    2           IF F$DCB.STARF THEN DO;

   1854  1 000254   200004 470500                    LDP0    JDCB$,,AUTO
         1 000255   000064 236100                    LDQ     52,,PR0
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:80   
         1 000256   200000 316003                    CANQ    65536,DU
         1 000257   000264 600000 1                  TZE     s:1859

      430     1855    2              B$JIT.STAR.DA(0)=DA;

   1855  1 000260   200005 235100                    LDA     DA,,AUTO
         1 000261   000000 471400 xsym               LDP1    B$JIT$
         1 000262   100222 755100                    STA     146,,PR1

      431     1856    2              RETURN;

   1856  1 000263   000000 702200 xent               TSX2  ! X66_ARET

      432     1857    2              END;
      433     1858        /**/
      434     1859    1           PAD$=ADDR(FM$SET(F$DCB.SETX));  /* SET TABLE ADDR                     */

   1859  1 000264   000051 236100                    LDQ     41,,PR0
         1 000265   000003 736000                    QLS     3
         1 000266   000011 376000 2                  ANQ     9
         1 000267   000022 736000                    QLS     18
         1 000270   000000 036000 xsym               ADLQ    FM$SET$
         1 000271   200014 756100                    STQ     PAD$,,AUTO

      435     1860        /* RESERVE ACCOUNT DIRECTORY FOR WRITE */
      436     1861    1           CALL UQB$MENQX(PAD$)ALTRET(ENQERR);

   1861  1 000272   200014 631500                    EPPR1   PAD$,,AUTO
         1 000273   200016 451500                    STP1    PAD$+2,,AUTO
         1 000274   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000275   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000276   000000 701000 xent               TSX1    UQB$MENQX
         1 000277   000407 702000 1                  TSX2    ENQERR

      437     1862    1           CALL FMQ$SRCHAD(KEY$,ADDR(NIL)) ALTRET(NOFD);

   1862  1 000300   000001 236000 xsym               LDQ     B_VECTNIL+1
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:81   
         1 000301   200016 756100                    STQ     PAD$+2,,AUTO
         1 000302   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000303   200021 450500                    STP0    PAD$+5,,AUTO
         1 000304   200013 631500                    EPPR1   KEY$,,AUTO
         1 000305   200020 451500                    STP1    PAD$+4,,AUTO
         1 000306   200020 630500                    EPPR0   PAD$+4,,AUTO
         1 000307   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000310   000000 701000 xent               TSX1    FMQ$SRCHAD
         1 000311   000322 702000 1                  TSX2    NOFD

      438     1863    2           IF FM$ADKEY.D THEN DO;

   1863  1 000312   200013 470500                    LDP0    KEY$,,AUTO
         1 000313   000000 234100                    SZN     0,,PR0
         1 000314   000320 605000 1                  TPL     s:1867

      439     1864    2              FM$ADKEY.D='0'B;

   1864  1 000315   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000316   000000 356100                    ANSQ    0,,PR0

      440     1865    2              GOTO OLDFD;

   1865  1 000317   000351 710000 1                  TRA     OLDFD

      441     1866    2              END;
      442     1867    1           CALL SC_FMQ81;                  /* SCREECH IF ALREADY CATALOGED       */

   1867  1 000320   000000 713400 xsym               CLIMB   SC_FMQ81
         1 000321   000000 600000 xsid               climb   nvectors=         0

      443     1868        /*S*    SCREECH_CODE:   FMQ-S$FM81
      444     1869        *       TYPE:   SUA
      445     1870        *       MESSAGE:  FD already exists but CFU block says it is new
      446     1871        */
      447     1872        /**/
      448     1873    1   NOFD:   ACN$=ADDR(PACKACCT);
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:82   

   1873  1 000322   200011 630500       NOFD         EPPR0   PACKACCT,,AUTO
         1 000323   200006 450500                    STP0    ACN$,,AUTO

      449     1874    1           CALL FMO$PACKACCT(B$JIT.DCB$,ACN$); /* CREATE ACCOUNT KEY                */

   1874  1 000324   200006 631500                    EPPR1   ACN$,,AUTO
         1 000325   200017 451500                    STP1    PAD$+3,,AUTO
         1 000326   000000 236000 xsym               LDQ     B$JIT$
         1 000327   000232 036003                    ADLQ    154,DU
         1 000330   200016 756100                    STQ     PAD$+2,,AUTO
         1 000331   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000332   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000333   000000 701000 xent               TSX1    FMO$PACKACCT
         1 000334   000000 011000                    NOP     0

      450     1875    1           CALL FMG$ADDKEY(SEG$,SIZEW(FM$ADKEY)-2,KEY$,ACN$) ALTRET(ERR);

   1875  1 000335   200006 630500                    EPPR0   ACN$,,AUTO
         1 000336   200021 450500                    STP0    PAD$+5,,AUTO
         1 000337   200013 631500                    EPPR1   KEY$,,AUTO
         1 000340   200020 451500                    STP1    PAD$+4,,AUTO
         1 000341   000003 236000 2                  LDQ     3
         1 000342   200017 756100                    STQ     PAD$+3,,AUTO
         1 000343   200010 633500                    EPPR3   SEG$,,AUTO
         1 000344   200016 453500                    STP3    PAD$+2,,AUTO
         1 000345   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000346   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000347   000000 701000 xent               TSX1    FMG$ADDKEY
         1 000350   000400 702000 1                  TSX2    ERR

   1875  1 000351                       OLDFD        null
      451     1876    1   OLDFD:  ;
      452     1877    1           FM$ADKEY.FDSDA=DA;

   1877  1 000351   200005 235100                    LDA     DA,,AUTO
         1 000352   200013 470500                    LDP0    KEY$,,AUTO
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:83   
         1 000353   000002 755100                    STA     2,,PR0

      453     1878    1           CALL FMD$WRTBUF(1);

   1878  1 000354   000003 630400 2                  EPPR0   3
         1 000355   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000356   000000 701000 xent               TSX1    FMD$WRTBUF
         1 000357   000000 011000                    NOP     0

      454     1879        /**/
      455     1880    1           FM$CFUA.FDFITSDA=DA;

   1880  1 000360   200005 235100                    LDA     DA,,AUTO
         1 000361   200003 470500                    LDP0    @FM$CFUA,,AUTO
         1 000362   000004 755100                    STA     4,,PR0

      456     1881    1           FM$CFUA.FDCSDA=DA;

   1881  1 000363   200005 236100                    LDQ     DA,,AUTO
         1 000364   000003 756100                    STQ     3,,PR0

      457     1882    1           FM$CFUA.FLAGS.EXIST='1'B;

   1882  1 000365   400000 236003                    LDQ     -131072,DU
         1 000366   000005 256100                    ORSQ    5,,PR0

      458     1883    1           FM$CFUA.FLAGS.NEW='0'B;

   1883  1 000367   000012 236000 2                  LDQ     10
         1 000370   000005 356100                    ANSQ    5,,PR0

      459     1884        /* RELEASE AD RESERVATION */
      460     1885    1           CALL UQB$MDEQ(PAD$);

   1885  1 000371   200014 631500                    EPPR1   PAD$,,AUTO
         1 000372   200016 451500                    STP1    PAD$+2,,AUTO
         1 000373   200016 630500                    EPPR0   PAD$+2,,AUTO
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:84   
         1 000374   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000375   000000 701000 xent               TSX1    UQB$MDEQ
         1 000376   000000 011000                    NOP     0

      461     1886    1           RETURN;

   1886  1 000377   000000 702200 xent               TSX2  ! X66_ARET

      462     1887                                                /*                                    */
      463     1888    1   ERR:    CALL UQB$MDEQ(PAD$);

   1888  1 000400   200014 630500       ERR          EPPR0   PAD$,,AUTO
         1 000401   200016 450500                    STP0    PAD$+2,,AUTO
         1 000402   200016 630500                    EPPR0   PAD$+2,,AUTO
         1 000403   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000404   000000 701000 xent               TSX1    UQB$MDEQ
         1 000405   000000 011000                    NOP     0

      464     1889    1   ERR1:   ALTRETURN;

   1889  1 000406   000000 702200 xent  ERR1         TSX2  ! X66_AALT

   1883  1 000407                       ENQERR       null
      465     1890                                                /*                                    */
      466     1891    1   ENQERR: ;
      467     1892    1           CALL SC_FMQ94;

   1892  1 000407   000000 713400 xsym               CLIMB   SC_FMQ94
         1 000410   000000 600000 xsid               climb   nvectors=         0

      468     1893        /*S*    SCREECH_CODE:   FMQ-S$FM94
      469     1894        *      TYPE:   SUA
      470     1895        *      MESSAGE:  Error attempting to ENQ or DEQ account directory */
      471     1896    1   END FMQ$BLDFD;

   1896  1 000411   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:85   
INITKEYTBL
 Sect OctLoc
   0     000   430*** ******                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000002 006000   000000 000000   000002 006000   000003 006000    ................
   2     004   743777 777777   000000 006000   777777 437777   000006 006000    ................
   2     010   777774 001777   000007 777770   577777 777777                    ............
      472     1897        %EOD;

PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:86   
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$BLDFD.
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:87   

 **** Variables and constants ****

  ****  Section 000 RoData FMQ$BLDFD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC(9)     r     1 INITKEYTBL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FM$CFUA                   6-0-0/w PTR         r     1 ACN$
     7-0-0/w PTR         r     1 BUF$                       5-0-0/w SBIN        r     1 DA
    *0-0-0/w STRC(288)   r     1 FM$CFUA                   10-0-0/w UBIN        r     1 I
     4-0-0/w PTR         r     1 JDCB$                     13-0-0/w PTR         r     1 KEY$
    11-0-0/c CHAR(8)     r     1 PACKACCT                  14-0-0/w PTR         r     1 PAD$
    10-0-0/w PTR         r     1 SEG$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 FM$SET$
     0-0-0/w SBIN        r     1 FM_PADSDA

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(396)   r     1 CODE04
     0-0-0/w STRC(288)   r     1 CODE14                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(108)   r     1 FM$ADKEY                   0-0-0/w STRC(1116)  r     1 FM$FIT
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:88   
     0-0-0/w STRC(180)   r     1 FM$GRAN
     0-0-0/w UBIN(9)     r     1 FM$KEYTBL(0:279)
     0-0-0/w UBIN        r     1 FM$KT(0:69)                0-0-0/w STRC(288)   r     1 FM$SET(0:0)
     0-0-0/w STRC(720)   r     1 WRDS20


   Procedure FMQ$BLDFD requires 266 words for executable code.
   Procedure FMQ$BLDFD requires 20 words of local(AUTO) storage.
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:89   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:90   
          MINI XREF LISTING

ACN$
        32**DCL      1812<>CALL     1813>>ASSIGN   1819<>CALL     1820>>ASSIGN   1833<<ASSIGN   1834<>CALL
      1835>>ASSIGN   1873<<ASSIGN   1874<>CALL     1875<>CALL
B$JIT.ACCN
       386**DCL      1838>>ASSIGN
B$JIT.DCB$
       476**DCL      1800>>ASSIGN   1824<>CALL     1874<>CALL
B$JIT.ERR.MID
       387**DCL       387--REDEF
B$JIT.STAR.DA
       476**DCL      1855<<ASSIGN
B$JIT.UNAME
       386**DCL      1837>>ASSIGN
B$JIT$
      1703**DCL       381--IMP-PTR  1800>>ASSIGN   1824>>CALL     1837>>ASSIGN   1838>>ASSIGN   1855>>ASSIGN
      1874>>CALL
BUF$
        33**DCL      1759--IMP-PTR  1792--IMP-PTR  1813<<ASSIGN   1814>>ASSIGN   1815>>ASSIGN   1820<<ASSIGN
      1821>>ASSIGN   1824>>CALL     1825>>ASSIGN   1826>>ASSIGN   1827>>ASSIGN   1828>>ASSIGN   1828>>ASSIGN
      1829>>ASSIGN   1829>>ASSIGN   1830>>ASSIGN   1831>>ASSIGN   1832>>ASSIGN   1844>>ASSIGN   1847>>ASSIGN
      1847>>ASSIGN
CODE04
      1776**DCL      1836<<ASSIGN
CODE04.CREATION
      1778**DCL      1839<>CALL     1840>>ASSIGN
CODE04.CREATOR.ACCT
      1778**DCL      1838<<ASSIGN
CODE04.CREATOR.NAME
      1778**DCL      1837<<ASSIGN
CODE04.MODIFY
      1778**DCL      1840<<ASSIGN
CODE14
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:91   
      1784**DCL      1844--ASSIGN
CODE14.OWNER.ACCT
      1789**DCL      1845<<ASSIGN
DA
        31**DCL      1823<>CALL     1825>>ASSIGN   1848>>ASSIGN   1855>>ASSIGN   1877>>ASSIGN   1880>>ASSIGN
      1881>>ASSIGN
ENQERR
      1883**LABEL    1861--CALLALT
ERR
      1888**LABEL    1875--CALLALT
ERR1
      1889**LABEL    1819--CALLALT  1823--CALLALT
F$DCB.ACCT
      1719**DCL      1804>>IF
F$DCB.ACTPOS
      1734**DCL      1734--REDEF
F$DCB.ARS
      1709**DCL      1709--REDEF
F$DCB.ATTR
      1727**DCL      1728--REDEF
F$DCB.BFR.DA
      1754**DCL      1848<<ASSIGN
F$DCB.BFR.SCRUB
      1753**DCL      1849<<ASSIGN
F$DCB.BORROW
      1742**DCL      1742--REDEF    1742--REDEF    1742--REDEF
F$DCB.DCBNAME.L
      1756**DCL      1756--IMP-SIZ
F$DCB.EOMCHAR
      1713**DCL      1713--REDEF
F$DCB.FLDID
      1737**DCL      1737--REDEF
F$DCB.FORM$
      1731**DCL      1731--REDEF
F$DCB.FSECT
      1747**DCL      1747--REDEF
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:92   
F$DCB.FSN
      1724**DCL      1724--REDEF    1724--REDEF    1725--REDEF
F$DCB.GTYP
      1738**DCL      1818<<ASSIGN
F$DCB.HEADER$
      1730**DCL      1730--REDEF
F$DCB.IXTNSIZE
      1728**DCL      1728--REDEF
F$DCB.LASTSTA$
      1718**DCL      1718--REDEF
F$DCB.LVL
      1743**DCL      1743--REDEF
F$DCB.NAME.C
      1718**DCL      1718--REDEF
F$DCB.NOEOF
      1739**DCL      1739--REDEF
F$DCB.NRECS
      1729**DCL      1729--REDEF
F$DCB.NRECX
      1748**DCL      1748--REDEF
F$DCB.OHDR
      1740**DCL      1740--REDEF
F$DCB.ORG
      1723**DCL      1723--REDEF
F$DCB.PRECNO
      1746**DCL      1746--REDEF
F$DCB.RCSZ
      1751**DCL      1751--REDEF
F$DCB.RES
      1719**DCL      1719--REDEF
F$DCB.SETX
      1731**DCL      1731--REDEF    1859>>ASSIGN
F$DCB.STARF
      1738**DCL      1803>>IF       1810>>IF       1854>>IF
F$DCB.TAB$
      1730**DCL      1731--REDEF
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:93   
F$DCB.TDA
      1745**DCL      1745--REDEF
F$DCB.WSN
      1720**DCL      1720--REDEF
FAG$G1DIR
        51**DCL-ENT  1823--CALL
FM$ADKEY
      1768**DCL      1875--CALL
FM$ADKEY.D
      1768**DCL      1863>>IF       1864<<ASSIGN
FM$ADKEY.FDSDA
      1768**DCL      1877<<ASSIGN
FM$CFUA
      1697**DCL        28--PROC
FM$CFUA.ACCT
      1697**DCL      1804>>IF
FM$CFUA.FDCSDA
      1697**DCL      1881<<ASSIGN
FM$CFUA.FDFITSDA
      1697**DCL      1880<<ASSIGN
FM$CFUA.FLAGS.EXIST
      1697**DCL      1882<<ASSIGN
FM$CFUA.FLAGS.NEW
      1698**DCL      1883<<ASSIGN
FM$FIT.CODES.NDW
      1792**DCL      1844<<ASSIGN
FM$GRAN
      1759**DCL      1815--ASSIGN   1832--ASSIGN   1844--ASSIGN
FM$GRAN.AVAIL
      1760**DCL      1829<<ASSIGN
FM$GRAN.BLINK
      1760**DCL      1831<<ASSIGN
FM$GRAN.FCEX
      1760**DCL      1815<<ASSIGN   1828>>ASSIGN   1847>>ASSIGN
FM$GRAN.FLINK
      1760**DCL      1830<<ASSIGN
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:94   
FM$GRAN.HDR
      1759**DCL      1826<<ASSIGN
FM$GRAN.KEYCNT
      1760**DCL      1821<<ASSIGN
FM$GRAN.LVL
      1759**DCL      1827<<ASSIGN
FM$GRAN.NAVX
      1759**DCL      1828<<ASSIGN   1829>>ASSIGN
FM$GRAN.STAMP.GMOD
      1759**DCL      1825<<ASSIGN
FM$GRAN.STAMP.HASH
      1759**DCL      1824<>CALL
FM$KEYTBL
      1771**DCL      1798--DCLINIT  1828--ASSIGN   1847<<ASSIGN
FM$KT
      1771**DCL      1771--REDEF
FM$SET
      1763**DCL      1859--ASSIGN
FM$SET.USERLIST
      1764**DCL      1764--REDEF
FM$SET$
      1706**DCL      1763--IMP-PTR  1859>>ASSIGN
FMD$FLSHBUF
        41**DCL-ENT  1811--CALL
FMD$GETBUF
        42**DCL-ENT  1812--CALL
FMD$REDBUFBC
        43**DCL-ENT  1819--CALL
FMD$WRTBUF
        50**DCL-ENT  1850--CALL     1878--CALL
FMG$ADDKEY
        49**DCL-ENT  1875--CALL
FMO$FDHASH
        44**DCL-ENT  1824--CALL
FMO$LOCCODE
        45**DCL-ENT  1843--CALL
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:95   
FMO$LOCCODP
        46**DCL-ENT  1834--CALL
FMO$PACKACCT
        48**DCL-ENT  1874--CALL
FMQ$SRCHAD
        47**DCL-ENT  1862--CALL
FM_PADSDA
      1705**DCL      1819<>CALL
I
        35**DCL      1842<<ASSIGN   1843<>CALL     1844>>ASSIGN
INITKEYTBL
      1797**DCL      1847>>ASSIGN
JDCB$
        30**DCL      1709--IMP-PTR  1800<<ASSIGN   1803>>IF       1804>>IF       1810>>IF       1818>>ASSIGN
      1848>>ASSIGN   1849>>ASSIGN   1854>>IF       1859>>ASSIGN
KEY$
        38**DCL      1768--IMP-PTR  1862<>CALL     1863>>IF       1864>>ASSIGN   1875<>CALL     1877>>ASSIGN
NO14
      1845**LABEL    1843--CALLALT
NOFD
      1873**LABEL    1862--CALLALT
NOTIMES
      1840**LABEL    1834--CALLALT
OLDFD
      1875**LABEL    1865--GOTO
PACKACCT
        36**DCL        37--REDEF    1873--ASSIGN
PAD$
        39**DCL      1784--IMP-PTR  1832<<ASSIGN   1833>>ASSIGN   1843<>CALL     1845>>ASSIGN   1859<<ASSIGN
      1861<>CALL     1885<>CALL     1888<>CALL
SC_FMQ81
        55**DCL-ENT  1867--CALL
SC_FMQ83
        56**DCL-ENT  1805--CALL
SC_FMQ94
        57**DCL-ENT  1892--CALL
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:96   
SEG$
        34**DCL        35--REDEF    1776--IMP-PTR  1835<<ASSIGN   1836>>ASSIGN   1837>>ASSIGN   1838>>ASSIGN
      1839>>CALL     1840>>ASSIGN   1840>>ASSIGN   1875<>CALL
SSS$SYSTIME
        52**DCL-ENT  1839--CALL
UQB$MDEQ
        54**DCL-ENT  1885--CALL     1888--CALL
UQB$MENQX
        53**DCL-ENT  1861--CALL
WRDS20
      1794**DCL      1814<<ASSIGN
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:97   
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FMQ$BLDFD File=FMQ$DIR.:E05TSI                                TUE 07/29/97 17:00 Page:98   
              MINI UREF LISTING

FM$BUF$    1704**DCL
FMQ$BLDFD      28**PROC
PACKACCTB      37**DCL

PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:99   
      473        1        /*T***********************************************************/
      474        2        /*T*                                                         */
      475        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      476        4        /*T*                                                         */
      477        5        /*T***********************************************************/
      478        6        /*F*   NAME:  FMQ$CTG
      479        7        *      PURPOSE:  Catalog a file in a directory, either by adding
      480        8        *                a new entry or by changing the pointers in an
      481        9        *                existing one.                                               */
      482       10                                                                                  /*
      483       11                                                                                   *
      484       12                                                                                     */
      485       13        /*D*     NAME:   FMQ$CTG
      486       14        *      CALL:   CALL FMQ$CTG(JDCB$,NAME$,OLDFITDA) ALTRET(LOC);
      487       15        *      INPUT:  JDCB$ - Pointer to DCB
      488       16        *              NAME$ - Pointer to name to add
      489       17        *              CFU contains DA of FIT, and ACCTX points to the
      490       18        *                account block of the FD
      491       19        *      OUTPUT: OLDFITDA - Disk address of old FIT if cataloging
      492       20        *                         over an existing file, else zero
      493       21        *      DESCRIPTION:                                                          */
      494       22                                                /*                                    */
      495       23        FMQ$CTG: PROC(NAME$,OLDFITDA) ALTRET;
      496       24        /* PARAMETERS */
      497       25    1   DCL NAME$ PTR;
      498       26    1   DCL OLDFITDA SBIN WORD;
      499       27        /* LOCAL AUTOMATIC STORAGE */
      500       28    1   DCL JDCB$ PTR;
      501       29    1   DCL ACCTX SBIN WORD;
      502       30    1   DCL ACCT$ PTR;
      503       31    1   DCL BUF$ PTR;
      504       32    1   DCL KEY$ PTR;
      505       33    1   DCL SEG$ PTR;
      506       34    1   DCL CFU$ PTR;
      507       35        /* EXTERNAL ROUTINES */
      508       36    1   DCL FAG$RFILE ENTRY(1) ALTRET;
      509       37    1   DCL FMP$RELCFUS ENTRY(1);
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:100  
      510       38    1   DCL FMR$FN ENTRY(1);
      511       39    1   DCL FMR$L8 ENTRY;
      512       40    1   DCL FMR$U8 ENTRY;
      513       41    1   DCL FMQ$BLDFD ENTRY(1) ALTRET;
      514       42    1   DCL FMD$FLSHBUF ENTRY(1);
      515       43    1   DCL FMR$UPDGAC ENTRY(2);
      516       44    1   DCL FMQ$SRCHFD ENTRY(5) ALTRET;
      517       45    1   DCL FMG$ADDKEY ENTRY(4) ALTRET;
      518       46    1   DCL FMD$WRTBUF ENTRY(1);
      519       47    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
      520       48    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      521       49    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      522       50    1   DCL UQB$WAIT ENTRY(8) ALTRET;
      523       51    1   DCL SC_FMQ94 ENTRY CONV(2,0);
      524       52        /* INCLUDE FILES */
      525       53        %INCLUDE F$JIT_C;
      526      483        %MACRO F$DCB(BASED=BASED);
      527      484        %INCLUDE F$DCB;
      528      533        %MEND;
      529      534        %F$DCB(BASED="BASED(JDCB$)");
      530      584        %INCLUDE FM$MACROS;
      531      959        %INCLUDE F_ERRORS_C;
      532     1199        %INCLUDE FM_DATA_R;
      533     1213        %INCLUDE CP_6_SUBS;
      534     1753        /* EXTERNAL DATA */
      535     1754    1   DCL B$JIT$ PTR SYMREF;
      536     1755    1   DCL FM$BUF$(0:0) PTR SYMREF;
      537     1756        /* BASED STRUCTURES */
      538     1757        %FM$CFU(BASED="BASED(CFU$)");
      539     1763        %FM$CFUA(BASED="BASED(ACCT$)");
      540     1769        %FM$KEYENT(BASED="BASED(KEY$)");
      541     1772        %FM$FDSEG(BASED="BASED(SEG$)");
      542     1776        %FM$CFUF(BASED="BASED(CFU$)");
      543     1779        %CODE14(BASED="BASED(SEG$)");
      544     1789        %FM$GRAN;
      545     1793        /**/
      546     1794    1           JDCB$=B$JIT.DCB$;
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:101  
      547     1795    1           CFU$=F$DCB.CFU$;
      548     1796    2           IF NOT F$DCB.STARF THEN DO;     /* NOT STAR FILE                      */
      549     1797    2              ACCTX=FM$CFU.ACCTX;
      550     1798    2              IF ACCTX=0 THEN              /* TWO CFUS, OTHER HAS REAL ACCTX     */
      551     1799    2                 ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;
      552     1800    2              ACCT$=PINCRW(F$CFU$,ACCTX);  /* ACCT BLOCK POINTER                 */
      553     1801        /* RESERVE FILE DIRECTORY FOR WRITE */
      554     1802    2              CALL UQB$MENQX(ACCT$)ALTRET(ENQERR);
      555     1803    2              IF NOT FM$CFUA.FLAGS.NEW THEN /* DIRECTORY EXISTS                  */
      556     1804    2                 GOTO OLDDIR;
      557     1805    2              ELSE                         /* NEW DIRECTORY                      */
      558     1806    2                 GOTO NEWDIR;
      559     1807    2              END;
      560     1808        /**/
      561     1809    2           IF B$JIT.STAR.DA(0)+F$DCB.STARX=0 THEN DO; /* MUST BUILD DRCTRY       */
      562     1810    2   NEWDIR:    CALL FMQ$BLDFD(FM$CFUA) ALTRET(ERR);
      563     1811    2              END;
      564     1812        /**/
      565     1813    1   OLDDIR: OLDFITDA=0;                     /* ASSUME NO OLD FIT                  */
      566     1814    2           IF F$DCB.STARF AND F$DCB.STARX~=0 THEN DO; /* JIT CATALOGED           */
      567     1815    2              OLDFITDA=B$JIT.STAR.DA(F$DCB.STARX);
      568     1816    2              B$JIT.STAR.DA(F$DCB.STARX)=FM$CFU.FITSDA;
      569     1817    2              GOTO FIXCFU;
      570     1818    2              END;
      571     1819        /**/
      572     1820    1           CALL FMQ$SRCHFD(NAME$,KEY$,SEG$,ACCT$,ADDR(NIL)) ALTRET(NOKEY);
      573     1821    1   GOTENT: IF FM$KEYENT.D THEN             /* OLD DELETED ENTRY                  */
      574     1822    1              FM$KEYENT.D='0'B;
      575     1823    1           ELSE
      576     1824    1              IF NOT FM$FDSEG.DESC.DELF THEN
      577     1825    1                 OLDFITDA=FM$FDSEG.FITSDA; /* GET OLD FIT ADDR                   */
      578     1826        /**/
      579     1827    1   SETPTR: FM$FDSEG.FITSDA=FM$CFU.FITSDA;
      580     1828    1           FM$FDSEG.DESC=F$DCB.DESC;
      581     1829    1           IF NOT F$DCB.STARF THEN
      582     1830    2              IF F$DCB.BFR.DA(1)=FM$CFUA.FDFITSDA AND FM$CFUA.GMOD~=0 THEN DO;
      583     1831    2                 CALL FMR$L8;
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:102  
      584     1832    2                 SEG$=PINCRW(FM$BUF$(F$DCB.BFR.BUFX(1)),SIZEW(FM$GRAN));
      585     1833    2                 CALL FMO$LOCCODP(SEG$,14);
      586     1834    2                 CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;
      587     1835    2                 FM$CFUA.GMOD=0;
      588     1836    2                 CALL FMR$U8;
      589     1837    2                 END;
      590     1838                                                /*                                    */
      591     1839    1              CALL FMD$WRTBUF(1);
      592     1840        /**/
      593     1841    2   FIXCFU: IF MOD(FM$CFU.FUN,4)=%CREATE# THEN DO;
      594     1842    2              CALL FMR$L8;
      595     1843    2              IF F$DCB.ACS~=%JRNL# THEN FM$CFU.FUN=%UPDATE#;
      596     1844    2              ELSE FM$CFU.FUN=%JRNL#;
      597     1845                            /* IF A FILE ALREADY EXISTED, CAUSE IT TO BE RELEASED     */
      598     1846    3              IF FM$CFU.ACCTX=0 THEN DO;
      599     1847    3                 SEG$=PINCRW(F$CFU$,FM$CFU.NAMEX);
      600     1848    3                 FM$CFUF.ACCNAM=SEG$->FM$CFUF.ACCNAM;
      601     1849    3                 SEG$->FM$CFU.NAMEX=POFFW(CFU$,F$CFU$); /* POINT IT AT US        */
      602     1850    3                 CALL FMR$FN(SEG$);        /* UNLINK IT                          */
      603     1851    3                 SEG$->FM$CFU.ACFU=0;
      604     1852    3                 CALL FMR$U8;
      605     1853    3                 CALL FMP$RELCFUS(SEG$);   /* UNCOUNT US..MEBBE RFILE            */
      606     1854    3                 END;
      607     1855    3              ELSE DO;
      608     1856    3                 CALL FMR$U8;              /* NO INPUT OPENS                     */
      609     1857    4                 IF OLDFITDA~=0 THEN DO;
      610     1858    4                    CALL FAG$RFILE(OLDFITDA);
      611     1859    4                    CALL FMD$FLSHBUF(1);
      612     1860    4                    END;
      613     1861    3                 END;
      614     1862    2              IF F$DCB.BORROW>0 THEN
      615     1863    3                 IF NOT F$DCB.STARF THEN DO;
      616     1864    3                    CALL FMR$L8;
      617     1865    3                    FM$CFUA.GRANS=FM$CFUA.GRANS+F$DCB.BORROW;
      618     1866    3                    FM$CFUA.GMOD=1;
      619     1867    3                    CALL FMR$U8;
      620     1868    3                    B$JIT.PRDPRM=B$JIT.PRDPRM+F$DCB.BORROW;
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:103  
      621     1869    3                    END;
      622     1870    3                 ELSE DO;
      623     1871    3                    CALL FMR$UPDGAC(B$JIT.TMPGAC,B$JIT.CURTMPDP);
      624     1872    3                    B$JIT.CURTMPDP=B$JIT.CURTMPDP-F$DCB.BORROW;
      625     1873    3                    END;
      626     1874    2              F$DCB.BORROW=0;
      627     1875    2              END;
      628     1876                                                /*                                    */
      629     1877    1           IF NOT F$DCB.STARF THEN         /* RELEASE FD RESERVATION             */
      630     1878    1           CALL UQB$MDEQ(ACCT$);
      631     1879                                                /*                                    */
      632     1880    1           B$JIT.ERR='0'B;                 /* CLEAR ANY ERROR                    */
      633     1881                                                /*                                    */
      634     1882    1           RETURN;
      635     1883        /**/
      636     1884        /**/
      637     1885    1   NOKEY:  IF B$JIT.ERR.CODE~=%E$NOKEY THEN
      638     1886    1              GOTO ERR;
      639     1887    1           IF B$JIT.ERR.MID='21'O THEN     /* SRCHFD FOUND DELETED ENTRY         */
      640     1888    1              GOTO GOTENT;
      641     1889    1           CALL FMG$ADDKEY(SEG$,SIZEW(FM$FDSEG),KEY$,NAME$) ALTRET(ERR);
      642     1890    1           GOTO SETPTR;
      643     1891        /**/
      644     1892        /**/
      645     1893    1   ERR:    IF NOT F$DCB.STARF THEN         /* RELEASE FD RESERVATION             */
      646     1894    1           CALL UQB$MDEQ(ACCT$);
      647     1895    1           ALTRETURN;
      648     1896                                                /*                                    */
      649     1897    1   ENQERR: ;
      650     1898    1           CALL SC_FMQ94;
      651     1899        /*S*    SCREECH_CODE:   FMQ-S$FM94
      652     1900        *       TYPE:  SUA
      653     1901        */
      654     1902    1   END FMQ$CTG;
      655     1903        %EOD;

PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:104  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   FM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$CTG.

   Procedure FMQ$CTG requires 319 words for executable code.
   Procedure FMQ$CTG requires 18 words of local(AUTO) storage.

PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:105  

 Object Unit name= FMQ$CTG                                    File name= FMQ$DIR.:E05TOU
 UTS= JUL 29 '97 17:01:10.84 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   319    477  FMQ$CTG
    1  RoData even  none     6      6  FMQ$CTG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        2  FMQ$CTG

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       1 FMQ$BLDFD
 yes     yes           Std       5 FMQ$SRCHFD
 yes     yes           Std       2 FMO$LOCCODP
         yes           Std       2 FMR$UPDGAC
         yes           Std       1 FMD$WRTBUF
         yes           Std       1 FMR$FN
 yes     yes           Std       1 FAG$RFILE
         yes           Std       1 FMD$FLSHBUF
         yes           Std       1 FMP$RELCFUS
 yes     yes           Std       1 UQB$MDEQ
 yes     yes           Std       4 FMG$ADDKEY
         yes           Std       0 FMR$L8
         yes           Std       0 FMR$U8
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:106  
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_FMQ94                         r    F$CFU$                                B$JIT$
     FM$BUF$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:107  


      473        1        /*T***********************************************************/
      474        2        /*T*                                                         */
      475        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      476        4        /*T*                                                         */
      477        5        /*T***********************************************************/
      478        6        /*F*   NAME:  FMQ$CTG
      479        7        *      PURPOSE:  Catalog a file in a directory, either by adding
      480        8        *                a new entry or by changing the pointers in an
      481        9        *                existing one.                                               */
      482       10                                                                                  /*
      483       11                                                                                   *
      484       12                                                                                     */
      485       13        /*D*     NAME:   FMQ$CTG
      486       14        *      CALL:   CALL FMQ$CTG(JDCB$,NAME$,OLDFITDA) ALTRET(LOC);
      487       15        *      INPUT:  JDCB$ - Pointer to DCB
      488       16        *              NAME$ - Pointer to name to add
      489       17        *              CFU contains DA of FIT, and ACCTX points to the
      490       18        *                account block of the FD
      491       19        *      OUTPUT: OLDFITDA - Disk address of old FIT if cataloging
      492       20        *                         over an existing file, else zero
      493       21        *      DESCRIPTION:                                                          */
      494       22                                                /*                                    */
      495       23        FMQ$CTG: PROC(NAME$,OLDFITDA) ALTRET;

     23  0 000000   000000 700200 xent  FMQ$CTG      TSX0  ! X66_AUTO_2
         0 000001   000022 000002                    ZERO    18,2

      496       24        /* PARAMETERS */
      497       25    1   DCL NAME$ PTR;
      498       26    1   DCL OLDFITDA SBIN WORD;
      499       27        /* LOCAL AUTOMATIC STORAGE */
      500       28    1   DCL JDCB$ PTR;
      501       29    1   DCL ACCTX SBIN WORD;
      502       30    1   DCL ACCT$ PTR;
      503       31    1   DCL BUF$ PTR;
      504       32    1   DCL KEY$ PTR;
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:108  
      505       33    1   DCL SEG$ PTR;
      506       34    1   DCL CFU$ PTR;
      507       35        /* EXTERNAL ROUTINES */
      508       36    1   DCL FAG$RFILE ENTRY(1) ALTRET;
      509       37    1   DCL FMP$RELCFUS ENTRY(1);
      510       38    1   DCL FMR$FN ENTRY(1);
      511       39    1   DCL FMR$L8 ENTRY;
      512       40    1   DCL FMR$U8 ENTRY;
      513       41    1   DCL FMQ$BLDFD ENTRY(1) ALTRET;
      514       42    1   DCL FMD$FLSHBUF ENTRY(1);
      515       43    1   DCL FMR$UPDGAC ENTRY(2);
      516       44    1   DCL FMQ$SRCHFD ENTRY(5) ALTRET;
      517       45    1   DCL FMG$ADDKEY ENTRY(4) ALTRET;
      518       46    1   DCL FMD$WRTBUF ENTRY(1);
      519       47    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
      520       48    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      521       49    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      522       50    1   DCL UQB$WAIT ENTRY(8) ALTRET;
      523       51    1   DCL SC_FMQ94 ENTRY CONV(2,0);
      524       52        /* INCLUDE FILES */
      525       53        %INCLUDE F$JIT_C;
      526      483        %MACRO F$DCB(BASED=BASED);
      527      484        %INCLUDE F$DCB;
      528      533        %MEND;
      529      534        %F$DCB(BASED="BASED(JDCB$)");
      530      584        %INCLUDE FM$MACROS;
      531      959        %INCLUDE F_ERRORS_C;
      532     1199        %INCLUDE FM_DATA_R;
      533     1213        %INCLUDE CP_6_SUBS;
      534     1753        /* EXTERNAL DATA */
      535     1754    1   DCL B$JIT$ PTR SYMREF;
      536     1755    1   DCL FM$BUF$(0:0) PTR SYMREF;
      537     1756        /* BASED STRUCTURES */
      538     1757        %FM$CFU(BASED="BASED(CFU$)");
      539     1763        %FM$CFUA(BASED="BASED(ACCT$)");
      540     1769        %FM$KEYENT(BASED="BASED(KEY$)");
      541     1772        %FM$FDSEG(BASED="BASED(SEG$)");
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:109  
      542     1776        %FM$CFUF(BASED="BASED(CFU$)");
      543     1779        %CODE14(BASED="BASED(SEG$)");
      544     1789        %FM$GRAN;
      545     1793        /**/
      546     1794    1           JDCB$=B$JIT.DCB$;

   1794  0 000002   000000 470400 xsym               LDP0    B$JIT$
         0 000003   000232 236100                    LDQ     154,,PR0
         0 000004   200005 756100                    STQ     JDCB$,,AUTO

      547     1795    1           CFU$=F$DCB.CFU$;

   1795  0 000005   200005 471500                    LDP1    JDCB$,,AUTO
         0 000006   100066 236100                    LDQ     54,,PR1
         0 000007   200013 756100                    STQ     CFU$,,AUTO

      548     1796    2           IF NOT F$DCB.STARF THEN DO;     /* NOT STAR FILE                      */

   1796  0 000010   100064 236100                    LDQ     52,,PR1
         0 000011   200000 316003                    CANQ    65536,DU
         0 000012   000043 601000 0                  TNZ     s:1809

      549     1797    2              ACCTX=FM$CFU.ACCTX;

   1797  0 000013   200013 473500                    LDP3    CFU$,,AUTO
         0 000014   300002 236100                    LDQ     2,,PR3
         0 000015   000022 772000                    QRL     18
         0 000016   200006 756100                    STQ     ACCTX,,AUTO

      550     1798    2              IF ACCTX=0 THEN              /* TWO CFUS, OTHER HAS REAL ACCTX     */

   1798  0 000017   000025 601000 0                  TNZ     s:1800

      551     1799    2                 ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;

   1799  0 000020   300002 720100                    LXL0    2,,PR3
         0 000021   000000 474400 xsym               LDP4    F$CFU$
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:110  
         0 000022   400002 236110                    LDQ     2,X0,PR4
         0 000023   000022 772000                    QRL     18
         0 000024   200006 756100                    STQ     ACCTX,,AUTO

      552     1800    2              ACCT$=PINCRW(F$CFU$,ACCTX);  /* ACCT BLOCK POINTER                 */

   1800  0 000025   000022 736000                    QLS     18
         0 000026   000000 036000 xsym               ADLQ    F$CFU$
         0 000027   200007 756100                    STQ     ACCT$,,AUTO

      553     1801        /* RESERVE FILE DIRECTORY FOR WRITE */
      554     1802    2              CALL UQB$MENQX(ACCT$)ALTRET(ENQERR);

   1802  0 000030   200007 634500                    EPPR4   ACCT$,,AUTO
         0 000031   200014 454500                    STP4    CFU$+1,,AUTO
         0 000032   200014 630500                    EPPR0   CFU$+1,,AUTO
         0 000033   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000034   000000 701000 xent               TSX1    UQB$MENQX
         0 000035   000474 702000 0                  TSX2    ENQERR

      555     1803    2              IF NOT FM$CFUA.FLAGS.NEW THEN /* DIRECTORY EXISTS                  */

   1803  0 000036   200007 470500                    LDP0    ACCT$,,AUTO
         0 000037   000005 236100                    LDQ     5,,PR0
         0 000040   200000 316003                    CANQ    65536,DU
         0 000041   000054 600000 0                  TZE     OLDDIR

      556     1804    2                 GOTO OLDDIR;
      557     1805    2              ELSE                         /* NEW DIRECTORY                      */
      558     1806    2                 GOTO NEWDIR;

   1806  0 000042   000050 710000 0                  TRA     NEWDIR

      559     1807    2              END;
      560     1808        /**/
      561     1809    2           IF B$JIT.STAR.DA(0)+F$DCB.STARX=0 THEN DO; /* MUST BUILD DRCTRY       */

PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:111  
   1809  0 000043   100064 236100                    LDQ     52,,PR1
         0 000044   000011 772000                    QRL     9
         0 000045   000007 376007                    ANQ     7,DL
         0 000046   000222 036100                    ADLQ    146,,PR0
         0 000047   000054 601000 0                  TNZ     OLDDIR

      562     1810    2   NEWDIR:    CALL FMQ$BLDFD(FM$CFUA) ALTRET(ERR);

   1810  0 000050   200007 630500       NEWDIR       EPPR0   ACCT$,,AUTO
         0 000051   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000052   000000 701000 xent               TSX1    FMQ$BLDFD
         0 000053   000461 702000 0                  TSX2    ERR

      563     1811    2              END;

      564     1812        /**/
      565     1813    1   OLDDIR: OLDFITDA=0;                     /* ASSUME NO OLD FIT                  */

   1813  0 000054   200004 470500       OLDDIR       LDP0    @OLDFITDA,,AUTO
         0 000055   000000 450100                    STZ     0,,PR0

      566     1814    2           IF F$DCB.STARF AND F$DCB.STARX~=0 THEN DO; /* JIT CATALOGED           */

   1814  0 000056   200005 471500                    LDP1    JDCB$,,AUTO
         0 000057   100064 236100                    LDQ     52,,PR1
         0 000060   200000 316003                    CANQ    65536,DU
         0 000061   000104 600000 0                  TZE     s:1820
         0 000062   007000 316007                    CANQ    3584,DL
         0 000063   000104 600000 0                  TZE     s:1820

      567     1815    2              OLDFITDA=B$JIT.STAR.DA(F$DCB.STARX);

   1815  0 000064   100064 236100                    LDQ     52,,PR1
         0 000065   000011 772000                    QRL     9
         0 000066   000007 376007                    ANQ     7,DL
         0 000067   000000 473400 xsym               LDP3    B$JIT$
         0 000070   300222 235106                    LDA     146,QL,PR3
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:112  
         0 000071   000000 755100                    STA     0,,PR0

      568     1816    2              B$JIT.STAR.DA(F$DCB.STARX)=FM$CFU.FITSDA;

   1816  0 000072   100064 236100                    LDQ     52,,PR1
         0 000073   000011 772000                    QRL     9
         0 000074   000007 376007                    ANQ     7,DL
         0 000075   200013 473500                    LDP3    CFU$,,AUTO
         0 000076   000000 474400 xsym               LDP4    B$JIT$
         0 000077   000000 620006                    EAX0    0,QL
         0 000100   300000 236100                    LDQ     0,,PR3
         0 000101   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 000102   400222 756110                    STQ     146,X0,PR4

      569     1817    2              GOTO FIXCFU;

   1817  0 000103   000227 710000 0                  TRA     FIXCFU

      570     1818    2              END;
      571     1819        /**/
      572     1820    1           CALL FMQ$SRCHFD(NAME$,KEY$,SEG$,ACCT$,ADDR(NIL)) ALTRET(NOKEY);

   1820  0 000104   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000105   200014 756100                    STQ     CFU$+1,,AUTO
         0 000106   200014 633500                    EPPR3   CFU$+1,,AUTO
         0 000107   200021 453500                    STP3    CFU$+6,,AUTO
         0 000110   200007 634500                    EPPR4   ACCT$,,AUTO
         0 000111   200020 454500                    STP4    CFU$+5,,AUTO
         0 000112   200012 635500                    EPPR5   SEG$,,AUTO
         0 000113   200017 455500                    STP5    CFU$+4,,AUTO
         0 000114   200011 636500                    EPPR6   KEY$,,AUTO
         0 000115   200016 456500                    STP6    CFU$+3,,AUTO
         0 000116   200003 236100                    LDQ     @NAME$,,AUTO
         0 000117   200015 756100                    STQ     CFU$+2,,AUTO
         0 000120   200015 630500                    EPPR0   CFU$+2,,AUTO
         0 000121   000023 631400 xsym               EPPR1   B_VECTNIL+19
         0 000122   000000 701000 xent               TSX1    FMQ$SRCHFD
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:113  
         0 000123   000433 702000 0                  TSX2    NOKEY

      573     1821    1   GOTENT: IF FM$KEYENT.D THEN             /* OLD DELETED ENTRY                  */

   1821  0 000124   200011 470500       GOTENT       LDP0    KEY$,,AUTO
         0 000125   000000 234100                    SZN     0,,PR0
         0 000126   000132 605000 0                  TPL     s:1824

      574     1822    1              FM$KEYENT.D='0'B;

   1822  0 000127   000031 236000 xsym               LDQ     B_VECTNIL+25
         0 000130   000000 356100                    ANSQ    0,,PR0
         0 000131   000141 710000 0                  TRA     SETPTR

      575     1823    1           ELSE
      576     1824    1              IF NOT FM$FDSEG.DESC.DELF THEN

   1824  0 000132   200012 471500                    LDP1    SEG$,,AUTO
         0 000133   100000 234100                    SZN     0,,PR1
         0 000134   000141 604000 0                  TMI     SETPTR

      577     1825    1                 OLDFITDA=FM$FDSEG.FITSDA; /* GET OLD FIT ADDR                   */

   1825  0 000135   100000 236100                    LDQ     0,,PR1
         0 000136   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 000137   200004 473500                    LDP3    @OLDFITDA,,AUTO
         0 000140   300000 756100                    STQ     0,,PR3

      578     1826        /**/
      579     1827    1   SETPTR: FM$FDSEG.FITSDA=FM$CFU.FITSDA;

   1827  0 000141   200013 470500       SETPTR       LDP0    CFU$,,AUTO
         0 000142   200012 471500                    LDP1    SEG$,,AUTO
         0 000143   000000 236100                    LDQ     0,,PR0
         0 000144   100000 552134                    STBQ    0,'34'O,PR1

      580     1828    1           FM$FDSEG.DESC=F$DCB.DESC;
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:114  

   1828  0 000145   200012 471500                    LDP1    SEG$,,AUTO
         0 000146   200005 473500                    LDP3    JDCB$,,AUTO
         0 000147   300005 236100                    LDQ     5,,PR3
         0 000150   000022 736000                    QLS     18
         0 000151   100000 552140                    STBQ    0,'40'O,PR1

      581     1829    1           IF NOT F$DCB.STARF THEN

   1829  0 000152   300064 236100                    LDQ     52,,PR3
         0 000153   200000 316003                    CANQ    65536,DU
         0 000154   000223 601000 0                  TNZ     s:1839

      582     1830    2              IF F$DCB.BFR.DA(1)=FM$CFUA.FDFITSDA AND FM$CFUA.GMOD~=0 THEN DO;

   1830  0 000155   200007 471500                    LDP1    ACCT$,,AUTO
         0 000156   300116 236100                    LDQ     78,,PR3
         0 000157   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 000160   100004 116100                    CMPQ    4,,PR1
         0 000161   000223 601000 0                  TNZ     s:1839
         0 000162   100005 236100                    LDQ     5,,PR1
         0 000163   100000 316003                    CANQ    32768,DU
         0 000164   000223 600000 0                  TZE     s:1839

      583     1831    2                 CALL FMR$L8;

   1831  0 000165   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000166   000000 701000 xent               TSX1    FMR$L8
         0 000167   000000 011000                    NOP     0

      584     1832    2                 SEG$=PINCRW(FM$BUF$(F$DCB.BFR.BUFX(1)),SIZEW(FM$GRAN));

   1832  0 000170   200005 470500                    LDP0    JDCB$,,AUTO
         0 000171   000116 236100                    LDQ     78,,PR0
         0 000172   000033 772000                    QRL     27
         0 000173   000037 376007                    ANQ     31,DL
         0 000174   000000 236006 xsym               LDQ     FM$BUF$,QL
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:115  
         0 000175   000005 036003                    ADLQ    5,DU
         0 000176   200012 756100                    STQ     SEG$,,AUTO

      585     1833    2                 CALL FMO$LOCCODP(SEG$,14);

   1833  0 000177   000001 236000 1                  LDQ     1
         0 000200   200015 756100                    STQ     CFU$+2,,AUTO
         0 000201   200012 631500                    EPPR1   SEG$,,AUTO
         0 000202   200014 451500                    STP1    CFU$+1,,AUTO
         0 000203   200014 630500                    EPPR0   CFU$+1,,AUTO
         0 000204   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000205   000000 701000 xent               TSX1    FMO$LOCCODP
         0 000206   000000 011000                    NOP     0

      586     1834    2                 CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;

   1834  0 000207   200007 470500                    LDP0    ACCT$,,AUTO
         0 000210   200012 471500                    LDP1    SEG$,,AUTO
         0 000211   100001 236100                    LDQ     1,,PR1
         0 000212   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 000213   000007 136100                    SBLQ    7,,PR0
         0 000214   100002 756100                    STQ     2,,PR1

      587     1835    2                 FM$CFUA.GMOD=0;

   1835  0 000215   200007 470500                    LDP0    ACCT$,,AUTO
         0 000216   000002 236000 1                  LDQ     2
         0 000217   000005 356100                    ANSQ    5,,PR0

      588     1836    2                 CALL FMR$U8;

   1836  0 000220   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000221   000000 701000 xent               TSX1    FMR$U8
         0 000222   000000 011000                    NOP     0

      589     1837    2                 END;

PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:116  
      590     1838                                                /*                                    */
      591     1839    1              CALL FMD$WRTBUF(1);

   1839  0 000223   000003 630400 1                  EPPR0   3
         0 000224   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000225   000000 701000 xent               TSX1    FMD$WRTBUF
         0 000226   000000 011000                    NOP     0

      592     1840        /**/
      593     1841    2   FIXCFU: IF MOD(FM$CFU.FUN,4)=%CREATE# THEN DO;

   1841  0 000227   200013 470500       FIXCFU       LDP0    CFU$,,AUTO
         0 000230   000000 236100                    LDQ     0,,PR0
         0 000231   000041 772000                    QRL     33
         0 000232   000003 376007                    ANQ     3,DL
         0 000233   000003 116007                    CMPQ    3,DL
         0 000234   000416 601000 0                  TNZ     s:1877

      594     1842    2              CALL FMR$L8;

   1842  0 000235   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000236   000000 701000 xent               TSX1    FMR$L8
         0 000237   000000 011000                    NOP     0

      595     1843    2              IF F$DCB.ACS~=%JRNL# THEN FM$CFU.FUN=%UPDATE#;

   1843  0 000240   200005 470500                    LDP0    JDCB$,,AUTO
         0 000241   000036 236100                    LDQ     30,,PR0
         0 000242   000777 376007                    ANQ     511,DL
         0 000243   000004 116007                    CMPQ    4,DL
         0 000244   000253 600000 0                  TZE     s:1844

   1843  0 000245   200013 471500                    LDP1    CFU$,,AUTO
         0 000246   100000 236100                    LDQ     0,,PR1
         0 000247   000004 376000 1                  ANQ     4
         0 000250   100000 276003                    ORQ     32768,DU
         0 000251   100000 756100                    STQ     0,,PR1
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:117  
         0 000252   000260 710000 0                  TRA     s:1846

      596     1844    2              ELSE FM$CFU.FUN=%JRNL#;

   1844  0 000253   200013 471500                    LDP1    CFU$,,AUTO
         0 000254   100000 236100                    LDQ     0,,PR1
         0 000255   000004 376000 1                  ANQ     4
         0 000256   400000 276003                    ORQ     -131072,DU
         0 000257   100000 756100                    STQ     0,,PR1

      597     1845                            /* IF A FILE ALREADY EXISTED, CAUSE IT TO BE RELEASED     */
      598     1846    3              IF FM$CFU.ACCTX=0 THEN DO;

   1846  0 000260   100002 220100                    LDX0    2,,PR1
         0 000261   000325 601000 0                  TNZ     s:1856

      599     1847    3                 SEG$=PINCRW(F$CFU$,FM$CFU.NAMEX);

   1847  0 000262   100002 721100                    LXL1    2,,PR1
         0 000263   000000 636011                    EAQ     0,X1
         0 000264   000000 036000 xsym               ADLQ    F$CFU$
         0 000265   200012 756100                    STQ     SEG$,,AUTO

      600     1848    3                 FM$CFUF.ACCNAM=SEG$->FM$CFUF.ACCNAM;

   1848  0 000266   200012 473500                    LDP3    SEG$,,AUTO
         0 000267   300002 235100                    LDA     2,,PR3
         0 000270   100002 755100                    STA     2,,PR1

      601     1849    3                 SEG$->FM$CFU.NAMEX=POFFW(CFU$,F$CFU$); /* POINT IT AT US        */

   1849  0 000271   000000 236000 xsym               LDQ     F$CFU$
         0 000272   000022 772000                    QRL     18
         0 000273   200014 756100                    STQ     CFU$+1,,AUTO
         0 000274   200013 236100                    LDQ     CFU$,,AUTO
         0 000275   000022 772000                    QRL     18
         0 000276   200014 136100                    SBLQ    CFU$+1,,AUTO
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:118  
         0 000277   000000 620006                    EAX0    0,QL
         0 000300   200012 473500                    LDP3    SEG$,,AUTO
         0 000301   300002 440100                    SXL0    2,,PR3

      602     1850    3                 CALL FMR$FN(SEG$);        /* UNLINK IT                          */

   1850  0 000302   200012 633500                    EPPR3   SEG$,,AUTO
         0 000303   200014 453500                    STP3    CFU$+1,,AUTO
         0 000304   200014 630500                    EPPR0   CFU$+1,,AUTO
         0 000305   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000306   000000 701000 xent               TSX1    FMR$FN
         0 000307   000000 011000                    NOP     0

      603     1851    3                 SEG$->FM$CFU.ACFU=0;

   1851  0 000310   200012 470500                    LDP0    SEG$,,AUTO
         0 000311   000005 236000 1                  LDQ     5
         0 000312   000000 356100                    ANSQ    0,,PR0

      604     1852    3                 CALL FMR$U8;

   1852  0 000313   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000314   000000 701000 xent               TSX1    FMR$U8
         0 000315   000000 011000                    NOP     0

      605     1853    3                 CALL FMP$RELCFUS(SEG$);   /* UNCOUNT US..MEBBE RFILE            */

   1853  0 000316   200012 630500                    EPPR0   SEG$,,AUTO
         0 000317   200014 450500                    STP0    CFU$+1,,AUTO
         0 000320   200014 630500                    EPPR0   CFU$+1,,AUTO
         0 000321   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000322   000000 701000 xent               TSX1    FMP$RELCFUS
         0 000323   000000 011000                    NOP     0

      606     1854    3                 END;

   1854  0 000324   000343 710000 0                  TRA     s:1862
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:119  

      607     1855    3              ELSE DO;

      608     1856    3                 CALL FMR$U8;              /* NO INPUT OPENS                     */

   1856  0 000325   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000326   000000 701000 xent               TSX1    FMR$U8
         0 000327   000000 011000                    NOP     0

      609     1857    4                 IF OLDFITDA~=0 THEN DO;

   1857  0 000330   200004 470500                    LDP0    @OLDFITDA,,AUTO
         0 000331   000000 235100                    LDA     0,,PR0
         0 000332   000343 600000 0                  TZE     s:1862

      610     1858    4                    CALL FAG$RFILE(OLDFITDA);

   1858  0 000333   200004 630500                    EPPR0   @OLDFITDA,,AUTO
         0 000334   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000335   000000 701000 xent               TSX1    FAG$RFILE
         0 000336   000000 011000                    NOP     0

      611     1859    4                    CALL FMD$FLSHBUF(1);

   1859  0 000337   000003 630400 1                  EPPR0   3
         0 000340   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000341   000000 701000 xent               TSX1    FMD$FLSHBUF
         0 000342   000000 011000                    NOP     0

      612     1860    4                    END;

      613     1861    3                 END;

      614     1862    2              IF F$DCB.BORROW>0 THEN

   1862  0 000343   200005 470500                    LDP0    JDCB$,,AUTO
         0 000344   000065 235100                    LDA     53,,PR0
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:120  
         0 000345   000414 604400 0                  TMOZ    s:1874

      615     1863    3                 IF NOT F$DCB.STARF THEN DO;

   1863  0 000346   000064 236100                    LDQ     52,,PR0
         0 000347   200000 316003                    CANQ    65536,DU
         0 000350   000375 601000 0                  TNZ     s:1871

      616     1864    3                    CALL FMR$L8;

   1864  0 000351   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000352   000000 701000 xent               TSX1    FMR$L8
         0 000353   000000 011000                    NOP     0

      617     1865    3                    FM$CFUA.GRANS=FM$CFUA.GRANS+F$DCB.BORROW;

   1865  0 000354   200007 470500                    LDP0    ACCT$,,AUTO
         0 000355   200005 471500                    LDP1    JDCB$,,AUTO
         0 000356   000007 236100                    LDQ     7,,PR0
         0 000357   100065 036100                    ADLQ    53,,PR1
         0 000360   000007 756100                    STQ     7,,PR0

      618     1866    3                    FM$CFUA.GMOD=1;

   1866  0 000361   200007 470500                    LDP0    ACCT$,,AUTO
         0 000362   100000 236003                    LDQ     32768,DU
         0 000363   000005 256100                    ORSQ    5,,PR0

      619     1867    3                    CALL FMR$U8;

   1867  0 000364   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000365   000000 701000 xent               TSX1    FMR$U8
         0 000366   000000 011000                    NOP     0

      620     1868    3                    B$JIT.PRDPRM=B$JIT.PRDPRM+F$DCB.BORROW;

   1868  0 000367   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:121  
         0 000370   200005 471500                    LDP1    JDCB$,,AUTO
         0 000371   000242 236100                    LDQ     162,,PR0
         0 000372   100065 036100                    ADLQ    53,,PR1
         0 000373   000242 756100                    STQ     162,,PR0

      621     1869    3                    END;

   1869  0 000374   000414 710000 0                  TRA     s:1874

      622     1870    3                 ELSE DO;

      623     1871    3                    CALL FMR$UPDGAC(B$JIT.TMPGAC,B$JIT.CURTMPDP);

   1871  0 000375   000000 236000 xsym               LDQ     B$JIT$
         0 000376   000240 036003                    ADLQ    160,DU
         0 000377   200015 756100                    STQ     CFU$+2,,AUTO
         0 000400   000000 236000 xsym               LDQ     B$JIT$
         0 000401   000246 036003                    ADLQ    166,DU
         0 000402   200014 756100                    STQ     CFU$+1,,AUTO
         0 000403   200014 630500                    EPPR0   CFU$+1,,AUTO
         0 000404   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000405   000000 701000 xent               TSX1    FMR$UPDGAC
         0 000406   000000 011000                    NOP     0

      624     1872    3                    B$JIT.CURTMPDP=B$JIT.CURTMPDP-F$DCB.BORROW;

   1872  0 000407   200005 470500                    LDP0    JDCB$,,AUTO
         0 000410   000000 471400 xsym               LDP1    B$JIT$
         0 000411   100240 236100                    LDQ     160,,PR1
         0 000412   000065 136100                    SBLQ    53,,PR0
         0 000413   100240 756100                    STQ     160,,PR1

      625     1873    3                    END;

      626     1874    2              F$DCB.BORROW=0;

   1874  0 000414   200005 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:122  
         0 000415   000065 450100                    STZ     53,,PR0

      627     1875    2              END;

      628     1876                                                /*                                    */
      629     1877    1           IF NOT F$DCB.STARF THEN         /* RELEASE FD RESERVATION             */

   1877  0 000416   200005 470500                    LDP0    JDCB$,,AUTO
         0 000417   000064 236100                    LDQ     52,,PR0
         0 000420   200000 316003                    CANQ    65536,DU
         0 000421   000430 601000 0                  TNZ     s:1880

      630     1878    1           CALL UQB$MDEQ(ACCT$);

   1878  0 000422   200007 631500                    EPPR1   ACCT$,,AUTO
         0 000423   200014 451500                    STP1    CFU$+1,,AUTO
         0 000424   200014 630500                    EPPR0   CFU$+1,,AUTO
         0 000425   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000426   000000 701000 xent               TSX1    UQB$MDEQ
         0 000427   000000 011000                    NOP     0

      631     1879                                                /*                                    */
      632     1880    1           B$JIT.ERR='0'B;                 /* CLEAR ANY ERROR                    */

   1880  0 000430   000000 470400 xsym               LDP0    B$JIT$
         0 000431   000012 450100                    STZ     10,,PR0

      633     1881                                                /*                                    */
      634     1882    1           RETURN;

   1882  0 000432   000000 702200 xent               TSX2  ! X66_ARET

      635     1883        /**/
      636     1884        /**/
      637     1885    1   NOKEY:  IF B$JIT.ERR.CODE~=%E$NOKEY THEN

   1885  0 000433   000000 470400 xsym  NOKEY        LDP0    B$JIT$
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:123  
         0 000434   000012 236100                    LDQ     10,,PR0
         0 000435   377770 376007                    ANQ     131064,DL
         0 000436   001020 116007                    CMPQ    528,DL
         0 000437   000461 601000 0                  TNZ     ERR

      638     1886    1              GOTO ERR;
      639     1887    1           IF B$JIT.ERR.MID='21'O THEN     /* SRCHFD FOUND DELETED ENTRY         */

   1887  0 000440   000012 236100                    LDQ     10,,PR0
         0 000441   000077 376003                    ANQ     63,DU
         0 000442   000021 116003                    CMPQ    17,DU
         0 000443   000124 600000 0                  TZE     GOTENT

      640     1888    1              GOTO GOTENT;
      641     1889    1           CALL FMG$ADDKEY(SEG$,SIZEW(FM$FDSEG),KEY$,NAME$) ALTRET(ERR);

   1889  0 000444   200003 236100                    LDQ     @NAME$,,AUTO
         0 000445   200017 756100                    STQ     CFU$+4,,AUTO
         0 000446   200011 631500                    EPPR1   KEY$,,AUTO
         0 000447   200016 451500                    STP1    CFU$+3,,AUTO
         0 000450   000003 236000 1                  LDQ     3
         0 000451   200015 756100                    STQ     CFU$+2,,AUTO
         0 000452   200012 633500                    EPPR3   SEG$,,AUTO
         0 000453   200014 453500                    STP3    CFU$+1,,AUTO
         0 000454   200014 630500                    EPPR0   CFU$+1,,AUTO
         0 000455   000022 631400 xsym               EPPR1   B_VECTNIL+18
         0 000456   000000 701000 xent               TSX1    FMG$ADDKEY
         0 000457   000461 702000 0                  TSX2    ERR

      642     1890    1           GOTO SETPTR;

   1890  0 000460   000141 710000 0                  TRA     SETPTR

      643     1891        /**/
      644     1892        /**/
      645     1893    1   ERR:    IF NOT F$DCB.STARF THEN         /* RELEASE FD RESERVATION             */

PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:124  
   1893  0 000461   200005 470500       ERR          LDP0    JDCB$,,AUTO
         0 000462   000064 236100                    LDQ     52,,PR0
         0 000463   200000 316003                    CANQ    65536,DU
         0 000464   000473 601000 0                  TNZ     s:1895

      646     1894    1           CALL UQB$MDEQ(ACCT$);

   1894  0 000465   200007 631500                    EPPR1   ACCT$,,AUTO
         0 000466   200014 451500                    STP1    CFU$+1,,AUTO
         0 000467   200014 630500                    EPPR0   CFU$+1,,AUTO
         0 000470   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000471   000000 701000 xent               TSX1    UQB$MDEQ
         0 000472   000000 011000                    NOP     0

      647     1895    1           ALTRETURN;

   1895  0 000473   000000 702200 xent               TSX2  ! X66_AALT

   1893  0 000474                       ENQERR       null
      648     1896                                                /*                                    */
      649     1897    1   ENQERR: ;
      650     1898    1           CALL SC_FMQ94;

   1898  0 000474   000000 713400 xsym               CLIMB   SC_FMQ94
         0 000475   000000 600000 xsid               climb   nvectors=         0

      651     1899        /*S*    SCREECH_CODE:   FMQ-S$FM94
      652     1900        *       TYPE:  SUA
      653     1901        */
      654     1902    1   END FMQ$CTG;

   1902  0 000476   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000000 000016   000000 006000   677777 777777   000003 006000    ................
   1     004   077777 777777   767777 777777                                    ?.......
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:125  
      655     1903        %EOD;

PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:126  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   FM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$CTG.
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:127  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NAME$                     4-0-0/w PTR         r     1 @OLDFITDA
     7-0-0/w PTR         r     1 ACCT$                      6-0-0/w SBIN        r     1 ACCTX
    13-0-0/w PTR         r     1 CFU$                       5-0-0/w PTR         r     1 JDCB$
    11-0-0/w PTR         r     1 KEY$                      *0-0-0/w PTR         r     1 NAME$
    *0-0-0/w SBIN        r     1 OLDFITDA                  12-0-0/w PTR         r     1 SEG$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FM$BUF$(0:0)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(288)   r     1 CODE14
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(288)   r     1 FM$CFU
     0-0-0/w STRC(288)   r     1 FM$CFUA                    0-0-0/w STRC(288)   r     1 FM$CFUF
     0-0-0/w STRC        r     1 FM$FDSEG                   0-0-0/w STRC(180)   r     1 FM$GRAN
     0-0-0/w ASTR(9)     r     1 FM$KEYENT


   Procedure FMQ$CTG requires 319 words for executable code.
   Procedure FMQ$CTG requires 18 words of local(AUTO) storage.
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:128  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:129  
          MINI XREF LISTING

ACCT$
        30**DCL      1764--IMP-PTR  1800<<ASSIGN   1802<>CALL     1803>>IF       1810>>CALL     1820<>CALL
      1830>>IF       1830>>IF       1834>>ASSIGN   1835>>ASSIGN   1865>>ASSIGN   1865>>ASSIGN   1866>>ASSIGN
      1878<>CALL     1894<>CALL
ACCTX
        29**DCL      1797<<ASSIGN   1798>>IF       1799<<ASSIGN   1800>>ASSIGN
B$JIT.CURTMPDP
       471**DCL      1871<>CALL     1872<<ASSIGN   1872>>ASSIGN
B$JIT.DCB$
       470**DCL      1794>>ASSIGN
B$JIT.ERR
       380**DCL      1880<<ASSIGN
B$JIT.ERR.CODE
       381**DCL      1885>>IF
B$JIT.ERR.MID
       381**DCL       381--REDEF    1887>>IF
B$JIT.PRDPRM
       471**DCL      1868<<ASSIGN   1868>>ASSIGN
B$JIT.STAR.DA
       470**DCL      1809>>IF       1815>>ASSIGN   1816<<ASSIGN
B$JIT.TMPGAC
       471**DCL      1871<>CALL
B$JIT$
      1754**DCL       375--IMP-PTR  1794>>ASSIGN   1809>>IF       1815>>ASSIGN   1816>>ASSIGN   1868>>ASSIGN
      1868>>ASSIGN   1871>>CALL     1871>>CALL     1872>>ASSIGN   1872>>ASSIGN   1880>>ASSIGN   1885>>IF
      1887>>IF
CFU$
        34**DCL      1758--IMP-PTR  1777--IMP-PTR  1795<<ASSIGN   1797>>ASSIGN   1799>>ASSIGN   1816>>ASSIGN
      1827>>ASSIGN   1841>>IF       1843>>ASSIGN   1844>>ASSIGN   1846>>IF       1847>>ASSIGN   1848>>ASSIGN
      1849>>ASSIGN
CODE14.CGRANS
      1787**DCL      1834<<ASSIGN
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:130  
CODE14.MGRANS
      1787**DCL      1834>>ASSIGN
ENQERR
      1893**LABEL    1802--CALLALT
ERR
      1893**LABEL    1810--CALLALT  1886--GOTO     1889--CALLALT
F$CFU$
      1210**DCL      1799>>ASSIGN   1800>>ASSIGN   1847>>ASSIGN   1849>>ASSIGN
F$DCB.ACS
       552**DCL      1843>>IF
F$DCB.ACTPOS
       560**DCL       560--REDEF
F$DCB.ARS
       535**DCL       535--REDEF
F$DCB.ATTR
       553**DCL       554--REDEF
F$DCB.BFR.BUFX
       580**DCL      1832>>ASSIGN
F$DCB.BFR.DA
       580**DCL      1830>>IF
F$DCB.BORROW
       568**DCL       568--REDEF     568--REDEF     568--REDEF    1862>>IF       1865>>ASSIGN   1868>>ASSIGN
      1872>>ASSIGN   1874<<ASSIGN
F$DCB.CFU$
       569**DCL      1795>>ASSIGN
F$DCB.DCBNAME.L
       582**DCL       582--IMP-SIZ
F$DCB.DESC
       542**DCL      1828>>ASSIGN
F$DCB.EOMCHAR
       539**DCL       539--REDEF
F$DCB.FLDID
       563**DCL       563--REDEF
F$DCB.FORM$
       557**DCL       557--REDEF
F$DCB.FSECT
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:131  
       573**DCL       573--REDEF
F$DCB.FSN
       550**DCL       550--REDEF     550--REDEF     551--REDEF
F$DCB.HEADER$
       556**DCL       556--REDEF
F$DCB.IXTNSIZE
       554**DCL       554--REDEF
F$DCB.LASTSTA$
       544**DCL       544--REDEF
F$DCB.LVL
       569**DCL       569--REDEF
F$DCB.NAME.C
       544**DCL       544--REDEF
F$DCB.NOEOF
       565**DCL       565--REDEF
F$DCB.NRECS
       555**DCL       555--REDEF
F$DCB.NRECX
       574**DCL       574--REDEF
F$DCB.OHDR
       566**DCL       566--REDEF
F$DCB.ORG
       549**DCL       549--REDEF
F$DCB.PRECNO
       572**DCL       572--REDEF
F$DCB.RCSZ
       577**DCL       577--REDEF
F$DCB.RES
       545**DCL       545--REDEF
F$DCB.SETX
       557**DCL       557--REDEF
F$DCB.STARF
       564**DCL      1796>>IF       1814>>IF       1829>>IF       1863>>IF       1877>>IF       1893>>IF
F$DCB.STARX
       566**DCL      1809>>IF       1814>>IF       1815>>ASSIGN   1816>>ASSIGN
F$DCB.TAB$
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:132  
       556**DCL       557--REDEF
F$DCB.TDA
       571**DCL       571--REDEF
F$DCB.WSN
       546**DCL       546--REDEF
FAG$RFILE
        36**DCL-ENT  1858--CALL
FIXCFU
      1841**LABEL    1817--GOTO
FM$BUF$
      1755**DCL      1832>>ASSIGN
FM$CFU.ACCTX
      1759**DCL      1759--REDEF    1797>>ASSIGN   1799>>ASSIGN   1846>>IF
FM$CFU.ACFU
      1758**DCL      1851<<ASSIGN
FM$CFU.FITSDA
      1759**DCL      1816>>ASSIGN   1827>>ASSIGN
FM$CFU.FUN
      1758**DCL      1841>>IF       1843<<ASSIGN   1844<<ASSIGN
FM$CFU.NAMEX
      1759**DCL      1799>>ASSIGN   1847>>ASSIGN   1849<<ASSIGN
FM$CFUA
      1764**DCL      1810<>CALL
FM$CFUA.FDFITSDA
      1764**DCL      1830>>IF
FM$CFUA.FLAGS.NEW
      1765**DCL      1803>>IF
FM$CFUA.GMOD
      1765**DCL      1830>>IF       1835<<ASSIGN   1866<<ASSIGN
FM$CFUA.GRANS
      1767**DCL      1834>>ASSIGN   1865<<ASSIGN   1865>>ASSIGN
FM$CFUF.ACCNAM
      1777**DCL      1848<<ASSIGN   1848>>ASSIGN
FM$FDSEG
      1773**DCL      1889--CALL
FM$FDSEG.DESC
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:133  
      1773**DCL      1828<<ASSIGN
FM$FDSEG.DESC.DELF
      1773**DCL      1824>>IF
FM$FDSEG.FITSDA
      1774**DCL      1825>>ASSIGN   1827<<ASSIGN
FM$GRAN
      1790**DCL      1832--ASSIGN
FM$KEYENT.D
      1770**DCL      1821>>IF       1822<<ASSIGN
FM$KEYENT.KLB
      1770**DCL      1770--IMP-SIZ
FMD$FLSHBUF
        42**DCL-ENT  1859--CALL
FMD$WRTBUF
        46**DCL-ENT  1839--CALL
FMG$ADDKEY
        45**DCL-ENT  1889--CALL
FMO$LOCCODP
        47**DCL-ENT  1833--CALL
FMP$RELCFUS
        37**DCL-ENT  1853--CALL
FMQ$BLDFD
        41**DCL-ENT  1810--CALL
FMQ$SRCHFD
        44**DCL-ENT  1820--CALL
FMR$FN
        38**DCL-ENT  1850--CALL
FMR$L8
        39**DCL-ENT  1831--CALL     1842--CALL     1864--CALL
FMR$U8
        40**DCL-ENT  1836--CALL     1852--CALL     1856--CALL     1867--CALL
FMR$UPDGAC
        43**DCL-ENT  1871--CALL
GOTENT
      1821**LABEL    1888--GOTO
JDCB$
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:134  
        28**DCL       535--IMP-PTR  1794<<ASSIGN   1795>>ASSIGN   1796>>IF       1809>>IF       1814>>IF
      1814>>IF       1815>>ASSIGN   1816>>ASSIGN   1828>>ASSIGN   1829>>IF       1830>>IF       1832>>ASSIGN
      1843>>IF       1862>>IF       1863>>IF       1865>>ASSIGN   1868>>ASSIGN   1872>>ASSIGN   1874>>ASSIGN
      1877>>IF       1893>>IF
KEY$
        32**DCL      1770--IMP-PTR  1820<>CALL     1821>>IF       1822>>ASSIGN   1889<>CALL
NAME$
        25**DCL        23--PROC     1820<>CALL     1889<>CALL
NEWDIR
      1810**LABEL    1806--GOTO
NOKEY
      1885**LABEL    1820--CALLALT
OLDDIR
      1813**LABEL    1804--GOTO
OLDFITDA
        26**DCL        23--PROC     1813<<ASSIGN   1815<<ASSIGN   1825<<ASSIGN   1857>>IF       1858<>CALL
SC_FMQ94
        51**DCL-ENT  1898--CALL
SEG$
        33**DCL      1773--IMP-PTR  1782--IMP-PTR  1820<>CALL     1824>>IF       1825>>ASSIGN   1827>>ASSIGN
      1828>>ASSIGN   1832<<ASSIGN   1833<>CALL     1834>>ASSIGN   1834>>ASSIGN   1847<<ASSIGN   1848>>ASSIGN
      1849>>ASSIGN   1850<>CALL     1851>>ASSIGN   1853<>CALL     1889<>CALL
SETPTR
      1827**LABEL    1890--GOTO
UQB$MDEQ
        49**DCL-ENT  1878--CALL     1894--CALL
UQB$MENQX
        48**DCL-ENT  1802--CALL
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:135  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FMQ$CTG File=FMQ$DIR.:E05TSI                                  TUE 07/29/97 17:01 Page:136  
              MINI UREF LISTING

BUF$      31**DCL
FM$SET$    1211**DCL
FMQ$CTG      23**PROC
FM_CFUWAIT    1210**DCL
FM_CFUWGRB    1210**DCL
FM_EOP    1208**DCL
FM_FRMAX    1207**DCL
FM_FRZERO    1207**DCL
FM_GCT    1211**DCL
FM_GIP    1211**DCL
FM_GPSDA    1208**DCL
FM_HASH    1209**DCL
FM_MADSDA    1208**DCL
FM_PADSDA    1208**DCL
FM_SRMAX    1207**DCL
FM_SRZERO    1207**DCL
FM_SYSACCTX    1211**DCL
FM_SYSSETX    1211**DCL
FM_TRUNC    1209**DCL
FM_WSQ    1209**DCL
F_CWLK    1210**DCL
F_CWUSER    1210**DCL
F_DCBLOCK    1209**DCL
UQB$WAIT      50**DCL-ENT

PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:137  
      656        1        /*T***********************************************************/
      657        2        /*T*                                                         */
      658        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      659        4        /*T*                                                         */
      660        5        /*T***********************************************************/
      661        6        /*F*   NAME:   FMQ$BLDMAD
      662        7        *      PURPOSE:  Build the MAD from a PAD */
      663        8        /**/
      664        9        /**/
      665       10        /*D*   NAME:   FMQ$BLDMAD
      666       11        *      CALL:   CALL FMQ$BLDMAD ALTRET(ERR);
      667       12        *      INPUT:  B$JIT.DCB$ - Pointer to a DCB which points to
      668       13        *                the pack set containing the PAD.
      669       14        *              M$* - Must be closed
      670       15        *      OUTPUT: The MAD is constructed.
      671       16        *      DESCRIPTION:  Any accounts that are in the PAD buf not in
      672       17        *        the MAD are added to the MAD.  Entries already in the MAD
      673       18        *        for accounts that exist in the PAD are not changed even if
      674       19        *        they point to a different pack set. */
      675       20        /**/
      676       21        /**/
      677       22        FMQ$BLDMAD: PROC ALTRET;
      678       23        /* INCLUDE FILES */
      679       24        %INCLUDE F$JIT_C;
      680      454        %INCLUDE FM$MACROS;
      681      829        %INCLUDE F_ERRORS_C;
      682     1069        %MACRO F$DCB(BASED=BASED);
      683     1070        %INCLUDE F$DCB;
      684     1119        %MEND;
      685     1120        %INCLUDE CP_6_SUBS;
      686     1660        /* LOCAL AUTOMATIC STORAGE */
      687     1661    1   DCL JDCB$ PTR;
      688     1662    1   DCL M$STAR$ PTR;
      689     1663    1   DCL I SBIN;
      690     1664    1   DCL PKEY$ PTR;
      691     1665    1   DCL MKEY$ PTR;
      692     1666        /* EXTERNAL DATA */
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:138  
      693     1667    1   DCL FM_MADSDA UBIN SYMREF;
      694     1668    1   DCL FM_PADSDA UBIN SYMREF;
      695     1669    1   DCL B$JIT$ PTR SYMREF;
      696     1670    1   DCL F$CFU$ PTR SYMREF;
      697     1671    1   DCL FM$SET$ PTR SYMREF;
      698     1672    1   DCL FM_SYSSETX UBIN SYMREF;
      699     1673        /* EXTERNAL ROUTINES */
      700     1674    1   DCL FMD$FLSHBUF ENTRY(1);
      701     1675    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
      702     1676    1   DCL FMG$ADDKEY ENTRY(4) ALTRET;
      703     1677    1   DCL FMG$FINDKEY ENTRY(4) ALTRET;
      704     1678    1   DCL FMG$NXTKEY ENTRY(3) ALTRET;
      705     1679    1   DCL FMM$SCRUB ENTRY(1);
      706     1680    1   DCL FMP$CLSJ ENTRY;
      707     1681    1   DCL SC_FMQ94 ENTRY CONV(2,0);
      708     1682    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      709     1683    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      710     1684        /* BASED STRUCTURES */
      711     1685        %F$DCB (BASED="BASED(JDCB$)");
      712     1735        %FM$MADKEY (BASED="BASED(MKEY$)");
      713     1738        %FM$ADKEY(BASED="BASED(PKEY$)");
      714     1741        %FM$SET (BASED="BASED(FM$SET$)");
      715     1746        /**/
      716     1747    1           JDCB$=B$JIT.DCB$;               /* PTR TO PAD DCB                     */
      717     1748    1           JDCB$->F$DCB.GTYP=FMGTPAD;
      718     1749    1           M$STAR$=DCBADDR(1);             /* PTR TO MAD DCB (M$*)               */
      719     1750        /**/
      720     1751    1           CALL SETMAD;
      721     1752    1           IF M$STAR$->F$DCB.FCD THEN
      722     1753    1           CALL FMP$CLSJ;                  /* CLOSE M$*                          */
      723     1754        /**/
      724     1755    1           CALL FMM$SCRUB(M$STAR$);
      725     1756    1           CALL SETMAD;                    /* PUT M$* ADDR IN JIT                */
      726     1757    1           M$STAR$->F$DCB.SETX=FM_SYSSETX; /* SYS PACK SET INDEX                 */
      727     1758    1           M$STAR$->F$DCB.GTYP=FMGTMAD;
      728     1759        /**/
      729     1760    1           CALL UQB$MENQX(F$CFU$)
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:139  
      730     1761    1             ALTRET(QERR);                 /* LOCK MAD FOR WRITE                 */
      731     1762        /**/
      732     1763    1           CALL SETPAD;
      733     1764    1           CALL FMD$REDBUF(I,1,FM_PADSDA,,0) ALTRET(ERR);
      734     1765        /**/
      735     1766    1           CALL SETMAD;
      736     1767    1           CALL FMD$REDBUF(I,1,FM_MADSDA,,0) ALTRET(ERR);
      737     1768        /**/
      738     1769        /* GET NEXT ENTRY FROM PAD */
      739     1770        /**/
      740     1771    1   NXTPAD: CALL SETPAD;
      741     1772    1           CALL FMG$NXTKEY(I,I,PKEY$) ALTRET(PADERR);
      742     1773    1           IF FM$ADKEY.D THEN GOTO NXTPAD;
      743     1774        /**/
      744     1775        /*  See if an entry for this account is in MAD */
      745     1776        /**/
      746     1777    1           CALL SETMAD;
      747     1778    1           CALL FMG$FINDKEY(I,I,MKEY$,PKEY$) ALTRET(NOMAD);
      748     1779    1           GOTO NXTPAD;                    /* YES - NOTHING TO DO                */
      749     1780        /**/
      750     1781        /**/
      751     1782    1   NOMAD:  IF B$JIT.ERR.CODE~=%E$NOKEY THEN
      752     1783    1              GOTO ERR;
      753     1784    1           CALL FMG$ADDKEY(I,2,MKEY$,PKEY$) ALTRET(ERR);
      754     1785    1           FM$MADKEY.PSN=FM$SET.PSN(F$DCB.SETX);
      755     1786    1           GOTO NXTPAD;
      756     1787        /**/
      757     1788        /**/
      758     1789    1   PADERR: IF B$JIT.ERR.CODE~=%E$EOF THEN
      759     1790    1              GOTO ERR;
      760     1791        /**/
      761     1792        /**/
      762     1793    1   DONE:   B$JIT.ERR='0'B;
      763     1794    1   ERR:    CALL SETMAD;
      764     1795    1           CALL FMD$FLSHBUF(1);
      765     1796    1           CALL SETPAD;
      766     1797    1           CALL FMD$FLSHBUF(1);
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:140  
      767     1798    1           CALL UQB$MDEQ(F$CFU$);
      768     1799    1           IF B$JIT.ERR.CODE=0 THEN RETURN;
      769     1800    1           ALTRETURN;
      770     1801        /**/
      771     1802    1   QERR:   ;
      772     1803    1           CALL SC_FMQ94;
      773     1804        /**/
      774     1805        /*S*    SCREECH_CODE:   FMQ-S$FM94
      775     1806        *      TYPE:  SUA
      776     1807        */
      777     1808        /**/
      778     1809        /**/
      779     1810    1   SETMAD: PROC;
      780     1811    2           B$JIT.DCB$=M$STAR$;
      781     1812    2           RETURN;
      782     1813    2   SETPAD: ENTRY;
      783     1814    2           B$JIT.DCB$=JDCB$;
      784     1815    2           RETURN;
      785     1816    2   END SETMAD;
      786     1817        /**/
      787     1818    1   END FMQ$BLDMAD;
      788     1819        %EOD;

PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:141  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$BLDMAD.

   Procedure FMQ$BLDMAD requires 172 words for executable code.
   Procedure FMQ$BLDMAD requires 16 words of local(AUTO) storage.

PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:142  

 Object Unit name= FMQ$BLDMAD                                 File name= FMQ$DIR.:E05TOU
 UTS= JUL 29 '97 17:01:42.84 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   172    254  FMQ$BLDMAD
    1  RoData even  none     9     11  FMQ$BLDMAD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        0  FMQ$BLDMAD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FMP$CLSJ
         yes           Std       1 FMM$SCRUB
 yes     yes           Std       3 FMG$NXTKEY
 yes     yes           Std       4 FMG$ADDKEY
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       1 UQB$MDEQ
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       4 FMG$FINDKEY
 yes     yes           Std       6 FMD$REDBUF
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:143  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_FMQ94                              FM_MADSDA                             FM_PADSDA
     B$JIT$                                F$CFU$                                FM$SET$
     FM_SYSSETX                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 ASLENTSID                             ISSID
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:144  


      656        1        /*T***********************************************************/
      657        2        /*T*                                                         */
      658        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      659        4        /*T*                                                         */
      660        5        /*T***********************************************************/
      661        6        /*F*   NAME:   FMQ$BLDMAD
      662        7        *      PURPOSE:  Build the MAD from a PAD */
      663        8        /**/
      664        9        /**/
      665       10        /*D*   NAME:   FMQ$BLDMAD
      666       11        *      CALL:   CALL FMQ$BLDMAD ALTRET(ERR);
      667       12        *      INPUT:  B$JIT.DCB$ - Pointer to a DCB which points to
      668       13        *                the pack set containing the PAD.
      669       14        *              M$* - Must be closed
      670       15        *      OUTPUT: The MAD is constructed.
      671       16        *      DESCRIPTION:  Any accounts that are in the PAD buf not in
      672       17        *        the MAD are added to the MAD.  Entries already in the MAD
      673       18        *        for accounts that exist in the PAD are not changed even if
      674       19        *        they point to a different pack set. */
      675       20        /**/
      676       21        /**/
      677       22        FMQ$BLDMAD: PROC ALTRET;

     22  0 000000   000000 700200 xent  FMQ$BLDMAD   TSX0  ! X66_AUTO_0
         0 000001   000020 000000                    ZERO    16,0

      678       23        /* INCLUDE FILES */
      679       24        %INCLUDE F$JIT_C;
      680      454        %INCLUDE FM$MACROS;
      681      829        %INCLUDE F_ERRORS_C;
      682     1069        %MACRO F$DCB(BASED=BASED);
      683     1070        %INCLUDE F$DCB;
      684     1119        %MEND;
      685     1120        %INCLUDE CP_6_SUBS;
      686     1660        /* LOCAL AUTOMATIC STORAGE */
      687     1661    1   DCL JDCB$ PTR;
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:145  
      688     1662    1   DCL M$STAR$ PTR;
      689     1663    1   DCL I SBIN;
      690     1664    1   DCL PKEY$ PTR;
      691     1665    1   DCL MKEY$ PTR;
      692     1666        /* EXTERNAL DATA */
      693     1667    1   DCL FM_MADSDA UBIN SYMREF;
      694     1668    1   DCL FM_PADSDA UBIN SYMREF;
      695     1669    1   DCL B$JIT$ PTR SYMREF;
      696     1670    1   DCL F$CFU$ PTR SYMREF;
      697     1671    1   DCL FM$SET$ PTR SYMREF;
      698     1672    1   DCL FM_SYSSETX UBIN SYMREF;
      699     1673        /* EXTERNAL ROUTINES */
      700     1674    1   DCL FMD$FLSHBUF ENTRY(1);
      701     1675    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
      702     1676    1   DCL FMG$ADDKEY ENTRY(4) ALTRET;
      703     1677    1   DCL FMG$FINDKEY ENTRY(4) ALTRET;
      704     1678    1   DCL FMG$NXTKEY ENTRY(3) ALTRET;
      705     1679    1   DCL FMM$SCRUB ENTRY(1);
      706     1680    1   DCL FMP$CLSJ ENTRY;
      707     1681    1   DCL SC_FMQ94 ENTRY CONV(2,0);
      708     1682    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      709     1683    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      710     1684        /* BASED STRUCTURES */
      711     1685        %F$DCB (BASED="BASED(JDCB$)");
      712     1735        %FM$MADKEY (BASED="BASED(MKEY$)");
      713     1738        %FM$ADKEY(BASED="BASED(PKEY$)");
      714     1741        %FM$SET (BASED="BASED(FM$SET$)");
      715     1746        /**/
      716     1747    1           JDCB$=B$JIT.DCB$;               /* PTR TO PAD DCB                     */

   1747  0 000002   000000 470400 xsym               LDP0    B$JIT$
         0 000003   000232 236100                    LDQ     154,,PR0
         0 000004   200003 756100                    STQ     JDCB$,,AUTO

      717     1748    1           JDCB$->F$DCB.GTYP=FMGTPAD;

   1748  0 000005   200003 471500                    LDP1    JDCB$,,AUTO
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:146  
         0 000006   100064 236100                    LDQ     52,,PR1
         0 000007   000000 376000 1                  ANQ     0
         0 000010   014000 276003                    ORQ     6144,DU
         0 000011   100064 756100                    STQ     52,,PR1

      718     1749    1           M$STAR$=DCBADDR(1);             /* PTR TO MAD DCB (M$*)               */

   1749  0 000012   000001 473400 1                  LDP3    1
         0 000013   300000 474500                    LDP4    0,,PR3
         0 000014   400001 236100                    LDQ     1,,PR4
         0 000015   200004 756100                    STQ     M$STAR$,,AUTO

      719     1750        /**/
      720     1751    1           CALL SETMAD;

   1751  0 000016   000241 701000 0                  TSX1    SETMAD
         0 000017   000000 011000                    NOP     0

      721     1752    1           IF M$STAR$->F$DCB.FCD THEN

   1752  0 000020   200004 470500                    LDP0    M$STAR$,,AUTO
         0 000021   000031 236100                    LDQ     25,,PR0
         0 000022   020000 316007                    CANQ    8192,DL
         0 000023   000027 600000 0                  TZE     s:1755

      722     1753    1           CALL FMP$CLSJ;                  /* CLOSE M$*                          */

   1753  0 000024   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000025   000000 701000 xent               TSX1    FMP$CLSJ
         0 000026   000000 011000                    NOP     0

      723     1754        /**/
      724     1755    1           CALL FMM$SCRUB(M$STAR$);

   1755  0 000027   200004 630500                    EPPR0   M$STAR$,,AUTO
         0 000030   200012 450500                    STP0    MKEY$+3,,AUTO
         0 000031   200012 630500                    EPPR0   MKEY$+3,,AUTO
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:147  
         0 000032   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000033   000000 701000 xent               TSX1    FMM$SCRUB
         0 000034   000000 011000                    NOP     0

      725     1756    1           CALL SETMAD;                    /* PUT M$* ADDR IN JIT                */

   1756  0 000035   000241 701000 0                  TSX1    SETMAD
         0 000036   000000 011000                    NOP     0

      726     1757    1           M$STAR$->F$DCB.SETX=FM_SYSSETX; /* SYS PACK SET INDEX                 */

   1757  0 000037   000000 720000 xsym               LXL0    FM_SYSSETX
         0 000040   200004 470500                    LDP0    M$STAR$,,AUTO
         0 000041   000051 440100                    SXL0    41,,PR0

      727     1758    1           M$STAR$->F$DCB.GTYP=FMGTMAD;

   1758  0 000042   000064 236100                    LDQ     52,,PR0
         0 000043   000000 376000 1                  ANQ     0
         0 000044   010000 276003                    ORQ     4096,DU
         0 000045   000064 756100                    STQ     52,,PR0

      728     1759        /**/
      729     1760    1           CALL UQB$MENQX(F$CFU$)

   1760  0 000046   000002 630400 1                  EPPR0   2
         0 000047   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000050   000000 701000 xent               TSX1    UQB$MENQX
         0 000051   000236 702000 0                  TSX2    QERR

      730     1761    1             ALTRET(QERR);                 /* LOCK MAD FOR WRITE                 */
      731     1762        /**/
      732     1763    1           CALL SETPAD;

   1763  0 000052   000246 701000 0                  TSX1    SETPAD
         0 000053   000000 011000                    NOP     0

PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:148  
      733     1764    1           CALL FMD$REDBUF(I,1,FM_PADSDA,,0) ALTRET(ERR);

   1764  0 000054   000003 236000 1                  LDQ     3
         0 000055   200016 756100                    STQ     MKEY$+7,,AUTO
         0 000056   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000057   000004 235000 1                  LDA     4
         0 000060   200014 757100                    STAQ    MKEY$+5,,AUTO
         0 000061   000005 236000 1                  LDQ     5
         0 000062   200013 756100                    STQ     MKEY$+4,,AUTO
         0 000063   200005 630500                    EPPR0   I,,AUTO
         0 000064   200012 450500                    STP0    MKEY$+3,,AUTO
         0 000065   200012 630500                    EPPR0   MKEY$+3,,AUTO
         0 000066   000023 631400 xsym               EPPR1   B_VECTNIL+19
         0 000067   000000 701000 xent               TSX1    FMD$REDBUF
         0 000070   000210 702000 0                  TSX2    ERR

      734     1765        /**/
      735     1766    1           CALL SETMAD;

   1766  0 000071   000241 701000 0                  TSX1    SETMAD
         0 000072   000000 011000                    NOP     0

      736     1767    1           CALL FMD$REDBUF(I,1,FM_MADSDA,,0) ALTRET(ERR);

   1767  0 000073   000003 236000 1                  LDQ     3
         0 000074   200016 756100                    STQ     MKEY$+7,,AUTO
         0 000075   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000076   000006 235000 1                  LDA     6
         0 000077   200014 757100                    STAQ    MKEY$+5,,AUTO
         0 000100   000005 236000 1                  LDQ     5
         0 000101   200013 756100                    STQ     MKEY$+4,,AUTO
         0 000102   200005 630500                    EPPR0   I,,AUTO
         0 000103   200012 450500                    STP0    MKEY$+3,,AUTO
         0 000104   200012 630500                    EPPR0   MKEY$+3,,AUTO
         0 000105   000023 631400 xsym               EPPR1   B_VECTNIL+19
         0 000106   000000 701000 xent               TSX1    FMD$REDBUF
         0 000107   000210 702000 0                  TSX2    ERR
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:149  

      737     1768        /**/
      738     1769        /* GET NEXT ENTRY FROM PAD */
      739     1770        /**/
      740     1771    1   NXTPAD: CALL SETPAD;

   1771  0 000110   000246 701000 0     NXTPAD       TSX1    SETPAD
         0 000111   000000 011000                    NOP     0

      741     1772    1           CALL FMG$NXTKEY(I,I,PKEY$) ALTRET(PADERR);

   1772  0 000112   200006 630500                    EPPR0   PKEY$,,AUTO
         0 000113   200014 450500                    STP0    MKEY$+5,,AUTO
         0 000114   200005 631500                    EPPR1   I,,AUTO
         0 000115   200013 451500                    STP1    MKEY$+4,,AUTO
         0 000116   200005 633500                    EPPR3   I,,AUTO
         0 000117   200012 453500                    STP3    MKEY$+3,,AUTO
         0 000120   200012 630500                    EPPR0   MKEY$+3,,AUTO
         0 000121   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000122   000000 701000 xent               TSX1    FMG$NXTKEY
         0 000123   000202 702000 0                  TSX2    PADERR

      742     1773    1           IF FM$ADKEY.D THEN GOTO NXTPAD;

   1773  0 000124   200006 470500                    LDP0    PKEY$,,AUTO
         0 000125   000000 234100                    SZN     0,,PR0
         0 000126   000110 604000 0                  TMI     NXTPAD

      743     1774        /**/
      744     1775        /*  See if an entry for this account is in MAD */
      745     1776        /**/
      746     1777    1           CALL SETMAD;

   1777  0 000127   000241 701000 0                  TSX1    SETMAD
         0 000130   000000 011000                    NOP     0

      747     1778    1           CALL FMG$FINDKEY(I,I,MKEY$,PKEY$) ALTRET(NOMAD);
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:150  

   1778  0 000131   200006 630500                    EPPR0   PKEY$,,AUTO
         0 000132   200015 450500                    STP0    MKEY$+6,,AUTO
         0 000133   200007 631500                    EPPR1   MKEY$,,AUTO
         0 000134   200014 451500                    STP1    MKEY$+5,,AUTO
         0 000135   200005 633500                    EPPR3   I,,AUTO
         0 000136   200013 453500                    STP3    MKEY$+4,,AUTO
         0 000137   200005 634500                    EPPR4   I,,AUTO
         0 000140   200012 454500                    STP4    MKEY$+3,,AUTO
         0 000141   200012 630500                    EPPR0   MKEY$+3,,AUTO
         0 000142   000022 631400 xsym               EPPR1   B_VECTNIL+18
         0 000143   000000 701000 xent               TSX1    FMG$FINDKEY
         0 000144   000146 702000 0                  TSX2    NOMAD

      748     1779    1           GOTO NXTPAD;                    /* YES - NOTHING TO DO                */

   1779  0 000145   000110 710000 0                  TRA     NXTPAD

      749     1780        /**/
      750     1781        /**/
      751     1782    1   NOMAD:  IF B$JIT.ERR.CODE~=%E$NOKEY THEN

   1782  0 000146   000000 470400 xsym  NOMAD        LDP0    B$JIT$
         0 000147   000012 236100                    LDQ     10,,PR0
         0 000150   377770 376007                    ANQ     131064,DL
         0 000151   001020 116007                    CMPQ    528,DL
         0 000152   000210 601000 0                  TNZ     ERR

      752     1783    1              GOTO ERR;
      753     1784    1           CALL FMG$ADDKEY(I,2,MKEY$,PKEY$) ALTRET(ERR);

   1784  0 000153   200006 631500                    EPPR1   PKEY$,,AUTO
         0 000154   200015 451500                    STP1    MKEY$+6,,AUTO
         0 000155   200007 633500                    EPPR3   MKEY$,,AUTO
         0 000156   200014 453500                    STP3    MKEY$+5,,AUTO
         0 000157   000007 236000 1                  LDQ     7
         0 000160   200013 756100                    STQ     MKEY$+4,,AUTO
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:151  
         0 000161   200005 634500                    EPPR4   I,,AUTO
         0 000162   200012 454500                    STP4    MKEY$+3,,AUTO
         0 000163   200012 630500                    EPPR0   MKEY$+3,,AUTO
         0 000164   000022 631400 xsym               EPPR1   B_VECTNIL+18
         0 000165   000000 701000 xent               TSX1    FMG$ADDKEY
         0 000166   000210 702000 0                  TSX2    ERR

      754     1785    1           FM$MADKEY.PSN=FM$SET.PSN(F$DCB.SETX);

   1785  0 000167   200003 470500                    LDP0    JDCB$,,AUTO
         0 000170   000051 236100                    LDQ     41,,PR0
         0 000171   000003 736000                    QLS     3
         0 000172   000010 376000 1                  ANQ     8
         0 000173   000002 736000                    QLS     2
         0 000174   000000 471400 xsym               LDP1    FM$SET$
         0 000175   200007 473500                    LDP3    MKEY$,,AUTO
         0 000176   040100 100506                    MLR     fill='040'O
         0 000177   100000 400006                    ADSC9   0,Q,PR1                  cn=2,n=6
         0 000200   300002 400006                    ADSC9   2,,PR3                   cn=2,n=6

      755     1786    1           GOTO NXTPAD;

   1786  0 000201   000110 710000 0                  TRA     NXTPAD

      756     1787        /**/
      757     1788        /**/
      758     1789    1   PADERR: IF B$JIT.ERR.CODE~=%E$EOF THEN

   1789  0 000202   000000 470400 xsym  PADERR       LDP0    B$JIT$
         0 000203   000012 236100                    LDQ     10,,PR0
         0 000204   377770 376007                    ANQ     131064,DL
         0 000205   000060 116007                    CMPQ    48,DL
         0 000206   000210 601000 0                  TNZ     ERR

      759     1790    1              GOTO ERR;
      760     1791        /**/
      761     1792        /**/
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:152  
      762     1793    1   DONE:   B$JIT.ERR='0'B;

   1793  0 000207   000012 450100       DONE         STZ     10,,PR0

      763     1794    1   ERR:    CALL SETMAD;

   1794  0 000210   000241 701000 0     ERR          TSX1    SETMAD
         0 000211   000000 011000                    NOP     0

      764     1795    1           CALL FMD$FLSHBUF(1);

   1795  0 000212   000005 630400 1                  EPPR0   5
         0 000213   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000214   000000 701000 xent               TSX1    FMD$FLSHBUF
         0 000215   000000 011000                    NOP     0

      765     1796    1           CALL SETPAD;

   1796  0 000216   000246 701000 0                  TSX1    SETPAD
         0 000217   000000 011000                    NOP     0

      766     1797    1           CALL FMD$FLSHBUF(1);

   1797  0 000220   000005 630400 1                  EPPR0   5
         0 000221   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000222   000000 701000 xent               TSX1    FMD$FLSHBUF
         0 000223   000000 011000                    NOP     0

      767     1798    1           CALL UQB$MDEQ(F$CFU$);

   1798  0 000224   000002 630400 1                  EPPR0   2
         0 000225   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000226   000000 701000 xent               TSX1    UQB$MDEQ
         0 000227   000000 011000                    NOP     0

      768     1799    1           IF B$JIT.ERR.CODE=0 THEN RETURN;

PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:153  
   1799  0 000230   000000 470400 xsym               LDP0    B$JIT$
         0 000231   000012 236100                    LDQ     10,,PR0
         0 000232   377770 316007                    CANQ    131064,DL
         0 000233   000235 601000 0                  TNZ     s:1800

   1799  0 000234   000000 702200 xent               TSX2  ! X66_ARET

      769     1800    1           ALTRETURN;

   1800  0 000235   000000 702200 xent               TSX2  ! X66_AALT

   1799  0 000236                       QERR         null
      770     1801        /**/
      771     1802    1   QERR:   ;
      772     1803    1           CALL SC_FMQ94;

   1803  0 000236   000000 713400 xsym               CLIMB   SC_FMQ94
         0 000237   000000 600000 xsid               climb   nvectors=         0
         0 000240   000253 710000 0                  TRA     s:1818

      773     1804        /**/
      774     1805        /*S*    SCREECH_CODE:   FMQ-S$FM94
      775     1806        *      TYPE:  SUA
      776     1807        */
      777     1808        /**/
      778     1809        /**/
      779     1810    1   SETMAD: PROC;

   1810  0 000241   200010 741300       SETMAD       STX1  ! MKEY$+1,,AUTO

      780     1811    2           B$JIT.DCB$=M$STAR$;

   1811  0 000242   200004 236100                    LDQ     M$STAR$,,AUTO
         0 000243   000000 470400 xsym               LDP0    B$JIT$
         0 000244   000232 756100                    STQ     154,,PR0

      781     1812    2           RETURN;
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:154  

   1812  0 000245   000001 702211                    TSX2  ! 1,X1

      782     1813    2   SETPAD: ENTRY;

   1813  0 000246   200010 741300       SETPAD       STX1  ! MKEY$+1,,AUTO

      783     1814    2           B$JIT.DCB$=JDCB$;

   1814  0 000247   200003 236100                    LDQ     JDCB$,,AUTO
         0 000250   000000 470400 xsym               LDP0    B$JIT$
         0 000251   000232 756100                    STQ     154,,PR0

      784     1815    2           RETURN;

   1815  0 000252   000001 702211                    TSX2  ! 1,X1

      785     1816    2   END SETMAD;
      786     1817        /**/
      787     1818    1   END FMQ$BLDMAD;

   1818  0 000253   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   743777 777777   000000 006003   000000 006000   000002 006000    ................
   1     004   000000 006000   000003 006000   000000 006000   000004 006000    ................
   1     010   000007 777770                                                    ....
      788     1819        %EOD;

PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:155  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$BLDMAD.
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:156  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w SBIN        r     1 I                          3-0-0/w PTR         r     1 JDCB$
     4-0-0/w PTR         r     1 M$STAR$                    7-0-0/w PTR         r     1 MKEY$
     6-0-0/w PTR         r     1 PKEY$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FM$SET$                    0-0-0/w UBIN        r     1 FM_MADSDA
     0-0-0/w UBIN        r     1 FM_PADSDA                  0-0-0/w UBIN        r     1 FM_SYSSETX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(108)   r     1 FM$ADKEY                   0-0-0/w STRC(144)   r     1 FM$MADKEY
     0-0-0/w STRC(288)   r     1 FM$SET(0:0)


   Procedure FMQ$BLDMAD requires 172 words for executable code.
   Procedure FMQ$BLDMAD requires 16 words of local(AUTO) storage.
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:157  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:158  
          MINI XREF LISTING

B$JIT.DCB$
       441**DCL      1747>>ASSIGN   1811<<ASSIGN   1814<<ASSIGN
B$JIT.ERR
       351**DCL      1793<<ASSIGN
B$JIT.ERR.CODE
       352**DCL      1782>>IF       1789>>IF       1799>>IF
B$JIT.ERR.MID
       352**DCL       352--REDEF
B$JIT$
      1669**DCL       346--IMP-PTR  1747>>ASSIGN   1782>>IF       1789>>IF       1793>>ASSIGN   1799>>IF
      1811>>ASSIGN   1814>>ASSIGN
ERR
      1794**LABEL    1764--CALLALT  1767--CALLALT  1783--GOTO     1784--CALLALT  1790--GOTO
F$CFU$
      1670**DCL      1760<>CALL     1798<>CALL
F$DCB.ACTPOS
      1711**DCL      1711--REDEF
F$DCB.ARS
      1686**DCL      1686--REDEF
F$DCB.ATTR
      1704**DCL      1705--REDEF
F$DCB.BORROW
      1719**DCL      1719--REDEF    1719--REDEF    1719--REDEF
F$DCB.DCBNAME.L
      1733**DCL      1733--IMP-SIZ
F$DCB.EOMCHAR
      1690**DCL      1690--REDEF
F$DCB.FCD
      1699**DCL      1752>>IF
F$DCB.FLDID
      1714**DCL      1714--REDEF
F$DCB.FORM$
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:159  
      1708**DCL      1708--REDEF
F$DCB.FSECT
      1724**DCL      1724--REDEF
F$DCB.FSN
      1701**DCL      1701--REDEF    1701--REDEF    1702--REDEF
F$DCB.GTYP
      1715**DCL      1748<<ASSIGN   1758<<ASSIGN
F$DCB.HEADER$
      1707**DCL      1707--REDEF
F$DCB.IXTNSIZE
      1705**DCL      1705--REDEF
F$DCB.LASTSTA$
      1695**DCL      1695--REDEF
F$DCB.LVL
      1720**DCL      1720--REDEF
F$DCB.NAME.C
      1695**DCL      1695--REDEF
F$DCB.NOEOF
      1716**DCL      1716--REDEF
F$DCB.NRECS
      1706**DCL      1706--REDEF
F$DCB.NRECX
      1725**DCL      1725--REDEF
F$DCB.OHDR
      1717**DCL      1717--REDEF
F$DCB.ORG
      1700**DCL      1700--REDEF
F$DCB.PRECNO
      1723**DCL      1723--REDEF
F$DCB.RCSZ
      1728**DCL      1728--REDEF
F$DCB.RES
      1696**DCL      1696--REDEF
F$DCB.SETX
      1708**DCL      1708--REDEF    1757<<ASSIGN   1785>>ASSIGN
F$DCB.TAB$
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:160  
      1707**DCL      1708--REDEF
F$DCB.TDA
      1722**DCL      1722--REDEF
F$DCB.WSN
      1697**DCL      1697--REDEF
FM$ADKEY.D
      1739**DCL      1773>>IF
FM$MADKEY.PSN
      1736**DCL      1785<<ASSIGN
FM$SET.PSN
      1742**DCL      1785>>ASSIGN
FM$SET.USERLIST
      1743**DCL      1743--REDEF
FM$SET$
      1671**DCL      1742--IMP-PTR  1785>>ASSIGN
FMD$FLSHBUF
      1674**DCL-ENT  1795--CALL     1797--CALL
FMD$REDBUF
      1675**DCL-ENT  1764--CALL     1767--CALL
FMG$ADDKEY
      1676**DCL-ENT  1784--CALL
FMG$FINDKEY
      1677**DCL-ENT  1778--CALL
FMG$NXTKEY
      1678**DCL-ENT  1772--CALL
FMM$SCRUB
      1679**DCL-ENT  1755--CALL
FMP$CLSJ
      1680**DCL-ENT  1753--CALL
FM_MADSDA
      1667**DCL      1767<>CALL
FM_PADSDA
      1668**DCL      1764<>CALL
FM_SYSSETX
      1672**DCL      1757>>ASSIGN
I
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:161  
      1663**DCL      1764<>CALL     1767<>CALL     1772<>CALL     1772<>CALL     1778<>CALL     1778<>CALL
      1784<>CALL
JDCB$
      1661**DCL      1686--IMP-PTR  1747<<ASSIGN   1748>>ASSIGN   1785>>ASSIGN   1814>>ASSIGN
M$STAR$
      1662**DCL      1749<<ASSIGN   1752>>IF       1755<>CALL     1757>>ASSIGN   1758>>ASSIGN   1811>>ASSIGN
MKEY$
      1665**DCL      1736--IMP-PTR  1778<>CALL     1784<>CALL     1785>>ASSIGN
NOMAD
      1782**LABEL    1778--CALLALT
NXTPAD
      1771**LABEL    1773--GOTO     1779--GOTO     1786--GOTO
PADERR
      1789**LABEL    1772--CALLALT
PKEY$
      1664**DCL      1739--IMP-PTR  1772<>CALL     1773>>IF       1778<>CALL     1784<>CALL
QERR
      1799**LABEL    1760--CALLALT
SC_FMQ94
      1681**DCL-ENT  1803--CALL
SETMAD
      1810**PROC     1751--CALL     1756--CALL     1766--CALL     1777--CALL     1794--CALL
SETPAD IN PROCEDURE SETMAD
      1813**ENTRY    1763--CALL     1771--CALL     1796--CALL
UQB$MDEQ
      1682**DCL-ENT  1798--CALL
UQB$MENQX
      1683**DCL-ENT  1760--CALL
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:162  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #005=FMQ$BLDMAD File=FMQ$DIR.:E05TSI                               TUE 07/29/97 17:01 Page:163  
              MINI UREF LISTING

DONE    1793**LABEL
FMQ$BLDMAD      22**PROC

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:164  
      789        1        /*T***********************************************************/
      790        2        /*T*                                                         */
      791        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      792        4        /*T*                                                         */
      793        5        /*T***********************************************************/
      794        6        /*F*  NAME:   FMQ$RELSTARF
      795        7        *     PURPOSE:  Release all star files for the current user. */
      796        8        /*D*     NAME:     FMQ$RELSTARF
      797        9                 ENTRY:    FMQ$RELSTARFP
      798       10                 PURPOSE:  To release star files, and handle sleazy
      799       11                           ALTKEY monitor calls
      800       12                 CALL:     CALL FMQ$RELSTARF
      801       13                 DESCRIPTION:
      802       14
      803       15                      This routine can be called for one of several
      804       16                 reasons.  It could be called while running a user down
      805       17                 to release star files, it could be called during RECOVER2
      806       18                 to release star files, and it could be called by ALTKEY
      807       19                 for some sleazy monitor calls.
      808       20
      809       21                      If we get called through the main entry point, then
      810       22                 we are getting called as a result of running down a user.
      811       23                 We want to release all of the user's star files.
      812       24        */
      813       25                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:165  
      814       26        FMQ$RELSTARF: PROC;
      815       27        /* */
      816       28               %INCLUDE B$ROSEG;
      817       91               %INCLUDE F$JIT_C;
      818      521               %MACRO F$DCB(BASED=BASED);
      819      522               %INCLUDE F$DCB;
      820      571               %MEND;
      821      572               %INCLUDE CP_6_SUBS;
      822     1112               %INCLUDE FM$MACROS;
      823     1487               %INCLUDE F_FMTCODE_C;
      824     1521               %INCLUDE FK_DATA_C;
      825     1598               %INCLUDE JG_GHOSTS_C;
      826     1688               %INCLUDE FM_FIELD_C;
      827     1729               %INCLUDE F_ERRORS_C;
      828     1969        /* */
      829     1970               %F$DCB (BASED="BASED(JDCB$)");
      830     2020               %FITALTKEYS;
      831     2026               %FMG$IRKEYS(FPTN=IRKEYS, STCLASS="BASED(ALTKEY$)");
      832     2033               %FK$ALTKEY_BFR(FPTN=FKA_ALTKEYS_BFR, STCLASS="BASED(B$PS1$)");
      833     2053               %CODE01(BASED="BASED(CODE$)");
      834     2057               %CODE02(BASED="BASED(CODE$)");
      835     2061               %CODE03(BASED="BASED(CODE$)");
      836     2068               %CODE19(BASED="BASED(CODE19$)");
      837     2071               %CODE20(BASED="BASED(CODE20$)");
      838     2076               %FM$CFU(BASED="BASED(CFU$)");
      839     2082               %FM$CFUA;
      840     2088               %FM$CFUN(BASED="BASED(NAME$)");
      841     2091               %FM$CFUX(BASED="BASED(F$CFU$)");
      842     2096               %FM$GRAN (BASED="BASED(BUF$)");
      843     2100               %FM$KEYENT (BASED="BASED(KEY$)");
      844     2103               %FM$FDSEG (BASED="BASED(SEG$)");
      845     2107        /* */
      846     2108    1          DCL FAF$GETGRAN ENTRY(1) ALTRET;
      847     2109    1          DCL FAG$REXT ENTRY(1) ALTRET;
      848     2110    1          DCL FAG$RFILE ENTRY(1) ALTRET;
      849     2111    1          DCL FMC$CLR1 ENTRY(1);
      850     2112    1          DCL FMD$REDBUF ENTRY(6) ALTRET;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:166  
      851     2113    1          DCL FMD$RELBUF ENTRY(1);
      852     2114    1          DCL FMD$WRTBUF ENTRY(1);
      853     2115    1          DCL FMG$NXTKEYNM ENTRY(3) ALTRET;
      854     2116    1          DCL FMG$IRSETUP ENTRY(1) ALTRET;
      855     2117    1          DCL FMM$SCRUB ENTRY(1);
      856     2118    1          DCL FMN$GETFIT ENTRY(2) ALTRET;
      857     2119    1          DCL FMO$GETDOMAIN ENTRY(1);
      858     2120    1          DCL FMO$LOCCODP ENTRY(2) ALTRET;
      859     2121    1          DCL FMO$RELG ENTRY(1) ALTRET;
      860     2122    1          DCL FMP$CLSJ ENTRY;
      861     2123    1          DCL FMU$BLDALT ENTRY;
      862     2124    1          DCL FSA$FSP ENTRY(2) ALTRET;
      863     2125    1          DCL FSA$GSP ENTRY(2) ALTRET;
      864     2126    1          DCL HFF$DSIZ ENTRY(2);
      865     2127    1          DCL HFF$NILERASE ENTRY(1) ALTRET;
      866     2128    1          DCL UMD$QDRIB ENTRY ALTRET;
      867     2129        /* */
      868     2130    1          DCL B$JIT$ PTR SYMREF;
      869     2131    1          DCL B$PS0$ PTR SYMREF;
      870     2132    1          DCL B$PS1$ PTR SYMREF;
      871     2133    1          DCL B$ROSEG$ PTR SYMREF;
      872     2134    1          DCL F$CFU$ PTR SYMREF;
      873     2135    1          DCL FM_SYSSETX UBIN SYMREF;
      874     2136    1          DCL FM_STARCHARS(0:0) CHAR(1) UNAL SYMREF;
      875     2137    1          DCL S_CUN UBIN SYMREF;
      876     2138        /* */
      877     2139               %SUB FCG#='0615'O;
      878     2140               %SUB MID#='21'O;
      879     2141               %ERRCODE(NAME=FMQ$E$CLSREL,COD#=%E$CLSREL);
      880     2145        /* */
      881     2146    1          DCL JDCB$ PTR;
      882     2147    1          DCL UJIT$ PTR;
      883     2148    1          DCL DA SBIN;
      884     2149    1          DCL I SBIN;
      885     2150    1          DCL LCDA SBIN;
      886     2151    1          DCL FITDA SBIN;
      887     2152    1          DCL 1 EXTNT REDEF FITDA,
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:167  
      888     2153    1               2 SIZ UBIN(9) UNAL,
      889     2154    1               2 DA UBIN(27) UNAL;
      890     2155    1          DCL BUF$ PTR;
      891     2156    1          DCL SEG$ PTR;
      892     2157    1          DCL KEY$ PTR;
      893     2158    1          DCL NAME$ PTR;
      894     2159    1          DCL CFU$ PTR;
      895     2160    1          DCL ALLFILES BIT(1);
      896     2161    1          DCL BFR BIT(36);
      897     2162    1          DCL BFR1 BIT(36);
      898     2163    1          DCL FIT$ PTR;
      899     2164    1          DCL FPARAM$ PTR;
      900     2165    1          DCL IORG UBIN;
      901     2166    1          DCL BUFNO SBIN;
      902     2167    1          DCL CODE$ PTR;
      903     2168    1          DCL N SBIN;
      904     2169    1          DCL CODE19$ PTR;
      905     2170    1          DCL CODE20$ PTR;
      906     2171    1          DCL ALTKEY$ PTR;
      907     2172    1          DCL NEWCODE$ PTR;
      908     2173    1          DCL ACCTX UBIN;
      909     2174    1          DCL ACCT$ PTR;
      910     2175        /* */
      911     2176    1          DCL FPARAM(0:1023) UBIN BASED(FPARAM$);
      912     2177    1          DCL MOVEN CHAR(N) BASED CALIGNED;
      913     2178        /* */
      914     2179    1          UJIT$=B$JIT$;
      915     2180    1          ALLFILES=%YES#;
      916     2181    1          CALL RELSTARF;
      917     2182    1          RETURN;
      918     2183               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:168  
      919     2184        /*F*     NAME:     FMQ$RELSTARFP
      920     2185                 PURPOSE:  To handle the M$RELSTARF monitor call
      921     2186                 CALL:     CALL FMQ$RELSTARFP
      922     2187                 DESCRIPTION:
      923     2188                      Get the size of the second vector.  If it is
      924     2189                 zero, then we want to release star files, otherwise,
      925     2190                 this is probably a sleazy ALTKEY monitor call.
      926     2191
      927     2192                      If there is a vector 0, then it is GHOST1 releasing
      928     2193                 star files during RECOVER2.  Otherwise, it is LOGOFF
      929     2194                 releasing all but *A, and *S.
      930     2195        */
      931     2196                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:169  
      932     2197    1   FMQ$RELSTARFP: ENTRY;
      933     2198    1          CALL HFF$DSIZ(1,I);
      934     2199    1          IF I = 0 THEN
      935     2200    2             DO;   /* RELEASE FILES */
      936     2201    2             CALL HFF$NILERASE(0) ALTRET(PARTREL);
      937     2202    2             ALLFILES=%YES#;
      938     2203    2             UJIT$=B$PS0$;
      939     2204    2             IF S_CUN~=JG_SLUG# THEN
      940     2205    2                RETURN;
      941     2206
      942     2207    3             DO WHILE ('0'B);
      943     2208    3   PARTREL:     ALLFILES=%NO#;
      944     2209    3                CALL FMO$GETDOMAIN(I);
      945     2210    3                IF I~=4 THEN
      946     2211    3                   RETURN;
      947     2212    3                UJIT$=B$JIT$;
      948     2213    3             END;
      949     2214    2             CALL RELSTARF;
      950     2215    2             END;  /* RELEASE FILES */
      951     2216    1          ELSE
      952     2217    1             CALL ALTKEYS;
      953     2218
      954     2219    1          RETURN;
      955     2220               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:170  
      956     2221        /*I*     NAME:     RELSTARF
      957     2222                 PURPOSE:  To release star files
      958     2223                 DESCRIPTION:
      959     2224
      960     2225                      If we are dribbling, then we need to clean it up.
      961     2226
      962     2227                      Make sure M$STAR is closed, we will use it to
      963     2228                 release star files.
      964     2229
      965     2230                      First, release all of the JIT cataloged files.
      966     2231                 If there is a DA for the file, and we want to release
      967     2232                 it, then put the name of the star file in the DCB, and
      968     2233                 release the file.
      969     2234
      970     2235                      Next, get the DA of the file directory for star
      971     2236                 files, to release the rest of the user's star files.
      972     2237                 Point to the first record, then use FMG$NXTKEYNM to
      973     2238                 position to the name of the next star file.  We
      974     2239                 want to save the buffer that holds the file directory.
      975     2240
      976     2241                     Finally, release the file directory, and then
      977     2242                 return.
      978     2243        */
      979     2244               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:171  
      980     2245    1   RELSTARF: PROC;
      981     2246        /* */
      982     2247    2          IF DCBADDR(%M$DRIBBLE#) ~= ADDR(NIL) THEN
      983     2248    2             IF DCBADDR(%M$DRIBBLE#)->F$DCB.STARF THEN
      984     2249    2             CALL UMD$QDRIB;
      985     2250    2          B$JIT.DCB$=DCBADDR(%M$STAR#);
      986     2251    2          JDCB$=B$JIT.DCB$;
      987     2252    2          IF F$DCB.FCD THEN
      988     2253    2             CALL FMP$CLSJ;
      989     2254    2          F$DCB.BFR='0'B;
      990     2255    2          F$DCB.BFR1='0'B;
      991     2256    2          F$DCB.SETX=FM_SYSSETX;
      992     2257
      993     2258    3          DO I=1 TO SIZEW(B$JIT.STAR)-1;
      994     2259    3             IF UJIT$->B$JIT.STAR.DA(I) ~= 0 AND
      995     2260    3                (ALLFILES = %YES# OR I < 3 OR I > 4) THEN
      996     2261    4                DO;   /* PUT NAME IN DCB */
      997     2262    4                F$DCB.NAME.L=2;
      998     2263    4                F$DCB.NAME.C='*';
      999     2264    4                CALL INSERT(F$DCB.NAME.C,1,1,FM_STARCHARS(I));
     1000     2265    4                FITDA=UJIT$->B$JIT.STAR.DA(I);
     1001     2266    4                UJIT$->B$JIT.STAR.DA(I)=0;
     1002     2267    4                CALL FAG$RFILE(FITDA) ALTRET(ERR);
     1003     2268    4                CALL FMD$RELBUF(1);
     1004     2269    4                END;  /* PUT NAME IN DCB */
     1005     2270    3          END;
     1006     2271
     1007     2272    2          DA=UJIT$->B$JIT.STAR.DA(0);
     1008     2273    2          UJIT$->B$JIT.STAR.DA(0)=0;
     1009     2274    2          F$DCB.HASH=UJIT$->B$JIT.SYSID;
     1010     2275    2          LCDA=0;
     1011     2276
     1012     2277    3          DO WHILE (DA ~= 0);
     1013     2278    3             F$DCB.GTYP=FMGTFDSTAR;
     1014     2279    3             CALL FMC$CLR1(DA);
     1015     2280    3             F$DCB.HASH=UJIT$->B$JIT.SYSID;
     1016     2281    3             F$DCB.STARF='1'B;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:172  
     1017     2282    3             F$DCB.CRECX=0;
     1018     2283    3             F$DCB.RPOS='0'B;
     1019     2284    3             CALL FMD$REDBUF(BUF$,1,DA,,LCDA) ALTRET(ERR);
     1020     2285
     1021     2286    4             DO WHILE ('1'B);
     1022     2287    4                B$JIT.ERR='0'B;
     1023     2288    4                CALL FMG$NXTKEYNM(SEG$,I,KEY$) ALTRET(NXTERR);
     1024     2289    4                IF NOT FM$KEYENT.D AND FM$FDSEG.FITSDA~=0 THEN
     1025     2290    5                   DO;
     1026     2291    5                   F$DCB.NAME.L=FM$KEYENT.KLB;
     1027     2292    5                   F$DCB.NAME.C=FM$KEYENT.TXT;
     1028     2293    5                   FITDA=FM$FDSEG.FITSDA;
     1029     2294    5                   BFR=F$DCB.BFR(1);
     1030     2295    5                   BFR1=F$DCB.BFR1(1);
     1031     2296    5                   F$DCB.BFR(1)='0'B;
     1032     2297    5                   F$DCB.BFR1(1)='0'B;
     1033     2298    5                   CALL FAG$RFILE(FITDA) ALTRET(ERR);
     1034     2299    5                   CALL FMD$RELBUF(1);
     1035     2300    5                   F$DCB.BFR(1)=BFR;
     1036     2301    5                   F$DCB.BFR1(1)=BFR1;
     1037     2302    5                   BFR='0'B;
     1038     2303    5                   BFR1='0'B;
     1039     2304    5                   F$DCB.GTYP=FMGTFD;
     1040     2305    5                   END;
     1041     2306    4             END;  /* FOREVER */
     1042     2307
     1043     2308    3   NXTERR:   IF B$JIT.ERR THEN
     1044     2309    3                GOTO ERR;
     1045     2310    3             EXTNT.DA=DA;
     1046     2311    3             EXTNT.SIZ=1;
     1047     2312    3             LCDA=DA;
     1048     2313    3             DA=FM$GRAN.FLINK;
     1049     2314    3             CALL FMD$RELBUF(1);
     1050     2315    3             CALL FAG$REXT(EXTNT) ALTRET(ERR);
     1051     2316    3          END;  /* WHILE */
     1052     2317
     1053     2318    2          RETURN;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:173  
     1054     2319
     1055     2320    2   ERR:   CALL FMD$RELBUF(0);
     1056     2321    2          CALL FMD$RELBUF(1);
     1057     2322    2          B$JIT.ERR='0'B;
     1058     2323    2          RETURN;
     1059     2324    2          END RELSTARF;
     1060     2325               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:174  
     1061     2326        /*I*     NAME:     ALTKEYS
     1062     2327                 PURPOSE:  To handle sleazy monitor calls for ALTKEY
     1063     2328                 DESCRIPTION:
     1064     2329
     1065     2330                      Make sure that this is ALTKEY.:SYS calling us,
     1066     2331                 if it isn't, hang up.
     1067     2332
     1068     2333                      Find out want it wants to do.
     1069     2334        */
     1070     2335                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:175  
     1071     2336    1   ALTKEYS: PROC;
     1072     2337        /* */
     1073     2338    2          IF DCBADDR(%M$LM#)->F$DCB.NAME.C ~= 'ALTKEY' OR
     1074     2339    2             DCBADDR(%M$LM#)->F$DCB.ACCT ~= ':SYS' THEN
     1075     2340    2             RETURN;
     1076     2341
     1077     2342    2          B$JIT.DCB$=B$ROSEG$->B$ROSEG.DCBPTR$->B$RODCB$(FKA_ALTKEYS_BFR.DCB#);
     1078     2343    2          JDCB$=B$JIT.DCB$;
     1079     2344
     1080     2345    3          DO CASE(FKA_ALTKEYS_BFR.CODE);
     1081     2346    3             CASE(%ALTKEY_OPEN#);
     1082     2347    3                CALL OPEN;
     1083     2348
     1084     2349    3             CASE(%ALTKEY_CLOSE#);
     1085     2350    3                CALL CLOSE;
     1086     2351
     1087     2352    3             CASE(%ALTKEY_EXTEND#);
     1088     2353    3                CALL EXTEND;
     1089     2354
     1090     2355    3          END;  /* CASE */
     1091     2356
     1092     2357    2          RETURN;
     1093     2358    2          END ALTKEYS;
     1094     2359               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:176  
     1095     2360        /*I*     NAME:     OPEN
     1096     2361                 PURPOSE:  To handle sleazy opens for ALTKEY
     1097     2362                 DESCRIPTION:
     1098     2363
     1099     2364                      Initialize the DCB from the information from
     1100     2365                 the CFU pointer given to us.
     1101     2366
     1102     2367                      Next, get the FIT, and initialize some more
     1103     2368                 information in the DCB.
     1104     2369        */
     1105     2370                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:177  
     1106     2371    1   OPEN:  PROC;
     1107     2372        /* */
     1108     2373    2          CALL FMM$SCRUB(JDCB$);
     1109     2374
     1110     2375    2          F$DCB.CFU$=FKA_ALTKEYS_BFR.CFU$;
     1111     2376    2          F$DCB.ASN=%FILE#;
     1112     2377    2          F$DCB.IASN=%FILE#;
     1113     2378    2          F$DCB.IORG=%KEYED#;
     1114     2379    2          F$DCB.IFMT=FMTRAN#;
     1115     2380    2          F$DCB.MEDIA=FMTRAN#;
     1116     2381    2          F$DCB.ACS=%BLOCK#;
     1117     2382    2          F$DCB.SETX=FKA_ALTKEYS_BFR.SETX;
     1118     2383    2          F$DCB.FFLG=%FFLG_OWNER#;
     1119     2384    2          F$DCB.FUN=%IN#;
     1120     2385    2          F$DCB.FCD='1'B;
     1121     2386    2          CFU$=FKA_ALTKEYS_BFR.CFU$;
     1122     2387    2          F$DCB.CFU$=CFU$;
     1123     2388    2          B$JIT.CHECK_CFU = '0'B;
     1124     2389
     1125     2390    3          DO WHILE(FM$CFU.NAMEX < FM$CFUX.NAMES);
     1126     2391    3             CFU$=PINCRW(F$CFU$, FM$CFU.NAMEX);
     1127     2392    3          END;
     1128     2393
     1129     2394    2          NAME$=PINCRC(F$CFU$, FM$CFU.NAMEX);
     1130     2395    2          F$DCB.NAME.C=FM$CFUN.C;
     1131     2396    2          F$DCB.NAME.L=FM$CFUN.L;
     1132     2397    2          F$DCB.STARF=BINBIT(FM$CFU.STARX.F, 1);
     1133     2398
     1134     2399    2          IF F$DCB.STARF THEN
     1135     2400    3             DO;   /* STAR FILE */
     1136     2401    3             F$DCB.ACCT='*';
     1137     2402    3             END;  /* STAR FILE */
     1138     2403    2          ELSE
     1139     2404    3             DO;   /* REAL FILE */
     1140     2405    3             CFU$=F$DCB.CFU$;
     1141     2406    3             ACCTX=FM$CFU.ACCTX;
     1142     2407    3             IF ACCTX = 0 THEN
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:178  
     1143     2408    3                ACCTX=PINCRW(F$CFU$, FM$CFU.NAMEX)->FM$CFU.ACCTX;
     1144     2409    3             ACCT$=PINCRW(F$CFU$, ACCTX);
     1145     2410    3             F$DCB.ACCT=ACCT$->FM$CFUA.ACCT;
     1146     2411    3             END;  /* REAL FILE */
     1147     2412
     1148     2413    2          BUFNO=1;
     1149     2414    2          CALL FMN$GETFIT(BUF$, BUFNO) ALTRET(ERR);
     1150     2415
     1151     2416    2          FKA_ALTKEYS_BFR.FPARAM=BUF$->FPARAM;
     1152     2417    2          FIT$=PINCRW(BUF$, SIZEW(FM$GRAN));
     1153     2418
     1154     2419    2          CODE$=FIT$;
     1155     2420    2          CALL FMO$LOCCODP(CODE$, 1);
     1156     2421    2          F$DCB.HASH=CODE01.HASH;
     1157     2422
     1158     2423    2          CODE$=FIT$;
     1159     2424    2          CALL FMO$LOCCODP(CODE$, 2);
     1160     2425    2          F$DCB.SPARE=CODE02.SPARE;
     1161     2426
     1162     2427    2          CODE$=FIT$;
     1163     2428    2          CALL FMO$LOCCODP(CODE$, 3);
     1164     2429    2          F$DCB.ORG=CODE03.ORG;
     1165     2430    2          F$DCB.XTNSIZE=CODE03.XTNSIZE;
     1166     2431    2          F$DCB.DESC=CODE03.DESC;
     1167     2432
     1168     2433    2   ERR:   RETURN;
     1169     2434    2          END OPEN;
     1170     2435               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:179  
     1171     2436        /*I*     NAME:     CLOSE
     1172     2437                 PURPOSE:  To handle sleazy closes for ALTKEY
     1173     2438                 DESCRIPTION:
     1174     2439
     1175     2440                      We need to rebuild the upper levels for the alternate
     1176     2441                 indexes and update the FIT.  ALTKEY has some new information
     1177     2442                 for the DCB and ROSEG, so put that in place first.
     1178     2443
     1179     2444                      Next, rebuild the upper levels for just the alternate
     1180     2445                 keys.  Since we may have added extents to the file during
     1181     2446                 the build, there may be something in NGAVAL even though
     1182     2447                 FMO$MODFIT may have already thrown away extras before linking
     1183     2448                 to ALTKEY.  So, see if he wants to release NGAVAL. If so and
     1184     2449                 he's allowed to, do it.  Otherwise, give him an error.  Then
     1185     2450                 get the FIT and call the right routine to update it with the
     1186     2451                 new information.  Finally, write out the updated FIT.
     1187     2452        */
     1188     2453                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:180  
     1189     2454    1   CLOSE: PROC;
     1190     2455        /* */
     1191     2456    2          FPARAM$=PINCRW(ADDR(FKA_ALTKEYS_BFR.FPARAM), SIZEW(FM$GRAN));
     1192     2457    2          IF F$DCB.ORG = %INDEXED# THEN
     1193     2458    2             CALL INDEXED_SETUP ALTRET(ERR);
     1194     2459    2          ELSE
     1195     2460    2             CALL IREL_SETUP ALTRET(ERR);
     1196     2461
     1197     2462    2          IORG=F$DCB.IORG;
     1198     2463    2          F$DCB.IORG=%KEYED#;
     1199     2464    2          F$DCB.CFU$->FM$CFU.ULBLD=1;
     1200     2465    2          CALL FMU$BLDALT;
     1201     2466    2          F$DCB.CFU$->FM$CFU.FUN=MOD(F$DCB.CFU$->FM$CFU.FUN,4);
     1202     2467
     1203     2468    2          IF FKA_ALTKEYS_BFR.RELG AND F$DCB.CFU$->FM$CFU.NGAVAL~=0 THEN
     1204     2469    2             IF FKA_ALTKEYS_BFR.DELF THEN
     1205     2470    3                DO;  /* Release NGAVAL */
     1206     2471    3                BUFNO=1;
     1207     2472    4                CALL FMO$RELG(BUFNO) WHENALTRETURN DO;
     1208     2473    4                   F$DCB.IORG=IORG;
     1209     2474    4                   GOTO ERR; /* Bad fit */
     1210     2475    4                   END;
     1211     2476    3                END; /* Release NGAVAL */
     1212     2477    2             ELSE B$JIT.ERR=FMQ$E$CLSREL;
     1213     2478
     1214     2479               /*E* ERROR:    FMQ-E$CLSREL-E
     1215     2480                    MESSAGE:  You may not release NGAVAL% for %FN% since you
     1216     2481                              do not have DELF access
     1217     2482               */
     1218     2483
     1219     2484    2          F$DCB.IORG=IORG;
     1220     2485    2          BUFNO=1;
     1221     2486    2          CALL FMN$GETFIT(BUF$, BUFNO) ALTRET(ERR);
     1222     2487    2          FIT$=PINCRW(BUF$, SIZEW(FM$GRAN));
     1223     2488
     1224     2489    2          IF F$DCB.ORG = %INDEXED# THEN
     1225     2490    2             CALL INDEXED_CLEANUP;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:181  
     1226     2491    2          ELSE
     1227     2492    2             CALL IREL_CLEANUP;
     1228     2493
     1229     2494    2          CALL FMD$WRTBUF(BUFNO);
     1230     2495    2   ERR:   RETURN;
     1231     2496    2          END CLOSE;
     1232     2497               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:182  
     1233     2498        /*I*     NAME:     EXTEND
     1234     2499                 PURPOSE:  To get another granule for an altkey file
     1235     2500                 DESCRIPTION:
     1236     2501
     1237     2502                      Set the IORG to KEYED, so the CFU will get updated
     1238     2503                 correctly, then get a granule.  Tell ALTKEY what the
     1239     2504                 DA was.
     1240     2505        */
     1241     2506    1   EXTEND: PROC;
     1242     2507        /* */
     1243     2508    2          IORG=F$DCB.IORG;
     1244     2509    2          F$DCB.IORG=%KEYED#;
     1245     2510    2          CALL FAF$GETGRAN(DA) ALTRET(NONE);
     1246     2511    2          F$DCB.IORG=IORG;
     1247     2512    2          FKA_ALTKEYS_BFR.DA=DA;
     1248     2513    2          RETURN;
     1249     2514    2   NONE:  FKA_ALTKEYS_BFR.DA=0;
     1250     2515    2          RETURN;
     1251     2516    2          END EXTEND;
     1252     2517               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:183  
     1253     2518        /*I*     NAME:     INDEXED_SETUP
     1254     2519                 PURPOSE:  To handle some set-up for indexed files
     1255     2520                 DESCRIPTION:
     1256     2521
     1257     2522                      Find the CODE08 from the FPARAM buffer passed
     1258     2523                 by ALTKEY.  Get some space in the ROSEG, and stuff
     1259     2524                 the information there.
     1260     2525        */
     1261     2526                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:184  
     1262     2527    1   INDEXED_SETUP: PROC ALTRET;
     1263     2528        /* */
     1264     2529    2          CODE$=FPARAM$;
     1265     2530    2          CALL FMO$LOCCODP(CODE$, 8);
     1266     2531    2          N=CODE$->FITALTKEYS.NUMWRDS;
     1267     2532    2          CALL FSA$GSP(N, ALTKEY$) ALTRET(ERR);
     1268     2533    2          F$DCB.ALTKEYX=POFFW(ALTKEY$, B$ROSEG$);
     1269     2534    2          N=N*4;
     1270     2535    2          ALTKEY$->MOVEN=CODE$->MOVEN;
     1271     2536    2          F$DCB.CFU$->FM$CFU.ALTBLD=ALTKEY$->FITALTKEYS.ALTBLD;
     1272     2537
     1273     2538    2          RETURN;
     1274     2539    2   ERR:   ALTRETURN;
     1275     2540    2          END INDEXED_SETUP;
     1276     2541               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:185  
     1277     2542        /*I*     NAME:     IREL_SETUP
     1278     2543                 PURPOSE:  To handle the set-up for IREL files
     1279     2544                 DESCRIPTION:
     1280     2545
     1281     2546                      Find the information from the buffer passed
     1282     2547                 by ALTKEY.  Selectively move the information from
     1283     2548                 the buffer to the ROSEG.
     1284     2549        */
     1285     2550                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:186  
     1286     2551    1   IREL_SETUP: PROC ALTRET;
     1287     2552        /* */
     1288     2553    2          CODE19$=FPARAM$;
     1289     2554    2          CALL FMO$LOCCODP(CODE19$, 19);
     1290     2555    2          CALL FMG$IRSETUP(CODE19) ALTRET(ERR);
     1291     2556
     1292     2557    2          CODE20$=FPARAM$;
     1293     2558    2          CALL FMO$LOCCODP(CODE20$, 20);
     1294     2559    2          F$DCB.CFU$->FM$CFU.ALTBLD=CODE20.ALTBLD;
     1295     2560
     1296     2561    2          ALTKEY$=PINCRW(B$ROSEG$, F$DCB.ALTKEYX);
     1297     2562
     1298     2563    3          DO I=0 TO CODE20.NKEYS-1;
     1299     2564    3             IRKEYS.K.TDALVL(I)=CODE20.K.TDALVL(I);
     1300     2565    3             IRKEYS.K.TDA(I)=CODE20.K.TDA(I);
     1301     2566    3             IRKEYS.K.FDA(I)=CODE20.K.FDA(I);
     1302     2567    3             IRKEYS.K.LDA(I)=CODE20.K.LDA(I);
     1303     2568    3          END;  /* DO I */
     1304     2569
     1305     2570    2          RETURN;
     1306     2571    2   ERR:   ALTRETURN;
     1307     2572    2          END IREL_SETUP;
     1308     2573               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:187  
     1309     2574        /*I*     NAME:     INDEXED_CLEANUP
     1310     2575                 PURPOSE:  To handle clean-up for Indexed files
     1311     2576                 DESCRIPTION:
     1312     2577
     1313     2578                      Move the information from the ROSEG to the
     1314     2579                 fit buffer, then release the ROSEG space we
     1315     2580                 obtained.
     1316     2581        */
     1317     2582    1   INDEXED_CLEANUP: PROC;
     1318     2583        /* */
     1319     2584    2          CODE$=FIT$;
     1320     2585    2          CALL FMO$LOCCODP(CODE$, 8);
     1321     2586
     1322     2587    2          N=CODE$->FITALTKEYS.NUMWRDS*4;
     1323     2588    2          CODE$->MOVEN=ALTKEY$->MOVEN;
     1324     2589
     1325     2590    2          N=N/4;
     1326     2591    2          CALL FSA$FSP(N, ALTKEY$);
     1327     2592    2          F$DCB.ALTKEYX=0;
     1328     2593
     1329     2594    2          RETURN;
     1330     2595    2          END INDEXED_CLEANUP;
     1331     2596               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:188  
     1332     2597        /*I*     NAME:     IREL_CLEANUP
     1333     2598                 PURPOSE:  To handle clean-up for IREL files.
     1334     2599                 DESCRIPTION:
     1335     2600
     1336     2601                      Find the CODE19 blocks from the FIT, and
     1337     2602                 the buffer passed by ALTKEY.  Since duplicates
     1338     2603                 may have been found by ALTKEY, we may have to
     1339     2604                 reset some UNIQUE bits.
     1340     2605
     1341     2606                      Next, set ALTBLD, and the other information
     1342     2607                 for the alternate indexes that may have changed.
     1343     2608        */
     1344     2609                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:189  
     1345     2610    1   IREL_CLEANUP: PROC;
     1346     2611    2          DCL I SBIN;
     1347     2612        /* */
     1348     2613    2          CODE19$=FIT$;
     1349     2614    2          CALL FMO$LOCCODP(CODE19$, 19);
     1350     2615
     1351     2616    2          NEWCODE$=FPARAM$;
     1352     2617    2          CALL FMO$LOCCODP(NEWCODE$, 19);
     1353     2618
     1354     2619    2          N=0;
     1355     2620    2          I=0;
     1356     2621    3          DO UNTIL(N >= CODE19.NKEYS);
     1357     2622    3             CODE19.K.UNIQUE(I)=NEWCODE$->CODE19.K.UNIQUE(I);
     1358     2623    3             IF CODE19.K.KEYEND(I) THEN
     1359     2624    3                N=N+1;
     1360     2625    3             I=I+1;
     1361     2626    3          END;  /* UNTIL */
     1362     2627
     1363     2628    2          CODE20$=FIT$;
     1364     2629    2          CALL FMO$LOCCODP(CODE20$, 20);
     1365     2630    2          CODE20.ALTBLD=IRKEYS.ALTBLD;
     1366     2631
     1367     2632    3          DO I=0 TO IRKEYS.NKEYS-1;
     1368     2633    3             CODE20.K.TDALVL(I)=IRKEYS.K.TDALVL(I);
     1369     2634    3             CODE20.K.TDA(I)=IRKEYS.K.TDA(I);
     1370     2635    3             CODE20.K.FDA(I)=IRKEYS.K.FDA(I);
     1371     2636    3             CODE20.K.LDA(I)=IRKEYS.K.LDA(I);
     1372     2637    3          END;  /* DO I */
     1373     2638
     1374     2639    2          RETURN;
     1375     2640    2          END IREL_CLEANUP;
     1376     2641    1          END FMQ$RELSTARF;

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:190  
--  Include file information  --

   F_ERRORS_C.:E05TOU  is referenced.
   FM_FIELD_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   FK_DATA_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$RELSTARF.

   Procedure FMQ$RELSTARF requires 940 words for executable code.
   Procedure FMQ$RELSTARF requires 42 words of local(AUTO) storage.

    No errors detected in file FMQ$DIR.:E05TSI    .

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:191  

 Object Unit name= FMQ$RELSTARF                               File name= FMQ$DIR.:E05TOU
 UTS= JUL 29 '97 17:02:10.40 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      4      4  FMQ$RELSTARF
    1   Proc  even  none   940   1654  FMQ$RELSTARF
    2  RoData even  none    16     20  FMQ$RELSTARF

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  FMQ$RELSTARF
     1     11                  yes      Std        0  FMQ$RELSTARFP
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:192  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 HFF$DSIZ
 yes     yes           Std       1 HFF$NILERASE
         yes           Std       1 FMO$GETDOMAIN
 yes     yes           Std       0 UMD$QDRIB
         yes           Std       0 FMP$CLSJ
 yes     yes           Std       1 FAG$RFILE
         yes           Std       1 FMD$RELBUF
 yes     yes           Std       3 FMG$NXTKEYNM
 yes     yes           Std       1 FAG$REXT
         yes           Std       1 FMC$CLR1
 yes     yes           Std       6 FMD$REDBUF
         yes           Std       1 FMM$SCRUB
 yes     yes           Std       2 FMO$LOCCODP
 yes     yes           Std       2 FMN$GETFIT
 yes     yes           Std       1 FMO$RELG
         yes           Std       1 FMD$WRTBUF
         yes           Std       0 FMU$BLDALT
 yes     yes           Std       1 FAF$GETGRAN
 yes     yes           Std       2 FSA$GSP
 yes     yes           Std       1 FMG$IRSETUP
 yes     yes           Std       2 FSA$FSP
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:193  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                B$PS0$                                B$PS1$
     B$ROSEG$                              F$CFU$                                FM_SYSSETX
     FM_STARCHARS                          S_CUN                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 ISSID
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:194  


      789        1        /*T***********************************************************/
      790        2        /*T*                                                         */
      791        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      792        4        /*T*                                                         */
      793        5        /*T***********************************************************/
      794        6        /*F*  NAME:   FMQ$RELSTARF
      795        7        *     PURPOSE:  Release all star files for the current user. */
      796        8        /*D*     NAME:     FMQ$RELSTARF
      797        9                 ENTRY:    FMQ$RELSTARFP
      798       10                 PURPOSE:  To release star files, and handle sleazy
      799       11                           ALTKEY monitor calls
      800       12                 CALL:     CALL FMQ$RELSTARF
      801       13                 DESCRIPTION:
      802       14
      803       15                      This routine can be called for one of several
      804       16                 reasons.  It could be called while running a user down
      805       17                 to release star files, it could be called during RECOVER2
      806       18                 to release star files, and it could be called by ALTKEY
      807       19                 for some sleazy monitor calls.
      808       20
      809       21                      If we get called through the main entry point, then
      810       22                 we are getting called as a result of running down a user.
      811       23                 We want to release all of the user's star files.
      812       24        */
      813       25                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:195  
      814       26        FMQ$RELSTARF: PROC;

     26  1 000000   000000 700200 xent  FMQ$RELSTARF TSX0  ! X66_AUTO_0
         1 000001   000052 000000                    ZERO    42,0

      815       27        /* */
      816       28               %INCLUDE B$ROSEG;
      817       91               %INCLUDE F$JIT_C;
      818      521               %MACRO F$DCB(BASED=BASED);
      819      522               %INCLUDE F$DCB;
      820      571               %MEND;
      821      572               %INCLUDE CP_6_SUBS;
      822     1112               %INCLUDE FM$MACROS;
      823     1487               %INCLUDE F_FMTCODE_C;
      824     1521               %INCLUDE FK_DATA_C;
      825     1598               %INCLUDE JG_GHOSTS_C;
      826     1688               %INCLUDE FM_FIELD_C;
      827     1729               %INCLUDE F_ERRORS_C;
      828     1969        /* */
      829     1970               %F$DCB (BASED="BASED(JDCB$)");
      830     2020               %FITALTKEYS;
      831     2026               %FMG$IRKEYS(FPTN=IRKEYS, STCLASS="BASED(ALTKEY$)");
      832     2033               %FK$ALTKEY_BFR(FPTN=FKA_ALTKEYS_BFR, STCLASS="BASED(B$PS1$)");
      833     2053               %CODE01(BASED="BASED(CODE$)");
      834     2057               %CODE02(BASED="BASED(CODE$)");
      835     2061               %CODE03(BASED="BASED(CODE$)");
      836     2068               %CODE19(BASED="BASED(CODE19$)");
      837     2071               %CODE20(BASED="BASED(CODE20$)");
      838     2076               %FM$CFU(BASED="BASED(CFU$)");
      839     2082               %FM$CFUA;
      840     2088               %FM$CFUN(BASED="BASED(NAME$)");
      841     2091               %FM$CFUX(BASED="BASED(F$CFU$)");
      842     2096               %FM$GRAN (BASED="BASED(BUF$)");
      843     2100               %FM$KEYENT (BASED="BASED(KEY$)");
      844     2103               %FM$FDSEG (BASED="BASED(SEG$)");
      845     2107        /* */
      846     2108    1          DCL FAF$GETGRAN ENTRY(1) ALTRET;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:196  
      847     2109    1          DCL FAG$REXT ENTRY(1) ALTRET;
      848     2110    1          DCL FAG$RFILE ENTRY(1) ALTRET;
      849     2111    1          DCL FMC$CLR1 ENTRY(1);
      850     2112    1          DCL FMD$REDBUF ENTRY(6) ALTRET;
      851     2113    1          DCL FMD$RELBUF ENTRY(1);
      852     2114    1          DCL FMD$WRTBUF ENTRY(1);
      853     2115    1          DCL FMG$NXTKEYNM ENTRY(3) ALTRET;
      854     2116    1          DCL FMG$IRSETUP ENTRY(1) ALTRET;
      855     2117    1          DCL FMM$SCRUB ENTRY(1);
      856     2118    1          DCL FMN$GETFIT ENTRY(2) ALTRET;
      857     2119    1          DCL FMO$GETDOMAIN ENTRY(1);
      858     2120    1          DCL FMO$LOCCODP ENTRY(2) ALTRET;
      859     2121    1          DCL FMO$RELG ENTRY(1) ALTRET;
      860     2122    1          DCL FMP$CLSJ ENTRY;
      861     2123    1          DCL FMU$BLDALT ENTRY;
      862     2124    1          DCL FSA$FSP ENTRY(2) ALTRET;
      863     2125    1          DCL FSA$GSP ENTRY(2) ALTRET;
      864     2126    1          DCL HFF$DSIZ ENTRY(2);
      865     2127    1          DCL HFF$NILERASE ENTRY(1) ALTRET;
      866     2128    1          DCL UMD$QDRIB ENTRY ALTRET;
      867     2129        /* */
      868     2130    1          DCL B$JIT$ PTR SYMREF;
      869     2131    1          DCL B$PS0$ PTR SYMREF;
      870     2132    1          DCL B$PS1$ PTR SYMREF;
      871     2133    1          DCL B$ROSEG$ PTR SYMREF;
      872     2134    1          DCL F$CFU$ PTR SYMREF;
      873     2135    1          DCL FM_SYSSETX UBIN SYMREF;
      874     2136    1          DCL FM_STARCHARS(0:0) CHAR(1) UNAL SYMREF;
      875     2137    1          DCL S_CUN UBIN SYMREF;
      876     2138        /* */
      877     2139               %SUB FCG#='0615'O;
      878     2140               %SUB MID#='21'O;
      879     2141               %ERRCODE(NAME=FMQ$E$CLSREL,COD#=%E$CLSREL);
      880     2145        /* */
      881     2146    1          DCL JDCB$ PTR;
      882     2147    1          DCL UJIT$ PTR;
      883     2148    1          DCL DA SBIN;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:197  
      884     2149    1          DCL I SBIN;
      885     2150    1          DCL LCDA SBIN;
      886     2151    1          DCL FITDA SBIN;
      887     2152    1          DCL 1 EXTNT REDEF FITDA,
      888     2153    1               2 SIZ UBIN(9) UNAL,
      889     2154    1               2 DA UBIN(27) UNAL;
      890     2155    1          DCL BUF$ PTR;
      891     2156    1          DCL SEG$ PTR;
      892     2157    1          DCL KEY$ PTR;
      893     2158    1          DCL NAME$ PTR;
      894     2159    1          DCL CFU$ PTR;
      895     2160    1          DCL ALLFILES BIT(1);
      896     2161    1          DCL BFR BIT(36);
      897     2162    1          DCL BFR1 BIT(36);
      898     2163    1          DCL FIT$ PTR;
      899     2164    1          DCL FPARAM$ PTR;
      900     2165    1          DCL IORG UBIN;
      901     2166    1          DCL BUFNO SBIN;
      902     2167    1          DCL CODE$ PTR;
      903     2168    1          DCL N SBIN;
      904     2169    1          DCL CODE19$ PTR;
      905     2170    1          DCL CODE20$ PTR;
      906     2171    1          DCL ALTKEY$ PTR;
      907     2172    1          DCL NEWCODE$ PTR;
      908     2173    1          DCL ACCTX UBIN;
      909     2174    1          DCL ACCT$ PTR;
      910     2175        /* */
      911     2176    1          DCL FPARAM(0:1023) UBIN BASED(FPARAM$);
      912     2177    1          DCL MOVEN CHAR(N) BASED CALIGNED;
      913     2178        /* */
      914     2179    1          UJIT$=B$JIT$;

   2179  1 000002   000000 236000 xsym               LDQ     B$JIT$
         1 000003   200004 756100                    STQ     UJIT$,,AUTO

      915     2180    1          ALLFILES=%YES#;

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:198  
   2180  1 000004   400000 236003                    LDQ     -131072,DU
         1 000005   200016 756100                    STQ     ALLFILES,,AUTO

      916     2181    1          CALL RELSTARF;

   2181  1 000006   000065 701000 1                  TSX1    RELSTARF
         1 000007   000000 011000                    NOP     0

      917     2182    1          RETURN;

   2182  1 000010   000000 702200 xent               TSX2  ! X66_ARET

      918     2183               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:199  
      919     2184        /*F*     NAME:     FMQ$RELSTARFP
      920     2185                 PURPOSE:  To handle the M$RELSTARF monitor call
      921     2186                 CALL:     CALL FMQ$RELSTARFP
      922     2187                 DESCRIPTION:
      923     2188                      Get the size of the second vector.  If it is
      924     2189                 zero, then we want to release star files, otherwise,
      925     2190                 this is probably a sleazy ALTKEY monitor call.
      926     2191
      927     2192                      If there is a vector 0, then it is GHOST1 releasing
      928     2193                 star files during RECOVER2.  Otherwise, it is LOGOFF
      929     2194                 releasing all but *A, and *S.
      930     2195        */
      931     2196                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:200  
      932     2197    1   FMQ$RELSTARFP: ENTRY;

   2197  1 000011   000000 700200 xent  FMQ$RELSTAR* TSX0  ! X66_AUTO_0
         1 000012   000052 000000                    ZERO    42,0

      933     2198    1          CALL HFF$DSIZ(1,I);

   2198  1 000013   200006 630500                    EPPR0   I,,AUTO
         1 000014   200045 450500                    STP0    I+2,,AUTO
         1 000015   000000 236000 2                  LDQ     0
         1 000016   200044 756100                    STQ     I+1,,AUTO
         1 000017   200044 630500                    EPPR0   I+1,,AUTO
         1 000020   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000021   000000 701000 xent               TSX1    HFF$DSIZ
         1 000022   000000 011000                    NOP     0

      934     2199    1          IF I = 0 THEN

   2199  1 000023   200006 235100                    LDA     I,,AUTO
         1 000024   000062 601000 1                  TNZ     s:2217

      935     2200    2             DO;   /* RELEASE FILES */

      936     2201    2             CALL HFF$NILERASE(0) ALTRET(PARTREL);

   2201  1 000025   000001 630400 2                  EPPR0   1
         1 000026   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000027   000000 701000 xent               TSX1    HFF$NILERASE
         1 000030   000042 702000 1                  TSX2    PARTREL

      937     2202    2             ALLFILES=%YES#;

   2202  1 000031   400000 236003                    LDQ     -131072,DU
         1 000032   200016 756100                    STQ     ALLFILES,,AUTO

      938     2203    2             UJIT$=B$PS0$;

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:201  
   2203  1 000033   000000 236000 xsym               LDQ     B$PS0$
         1 000034   200004 756100                    STQ     UJIT$,,AUTO

      939     2204    2             IF S_CUN~=JG_SLUG# THEN

   2204  1 000035   000000 235000 xsym               LDA     S_CUN
         1 000036   000001 115007                    CMPA    1,DL
         1 000037   000041 600000 1                  TZE     s:2207

      940     2205    2                RETURN;

   2205  1 000040   000000 702200 xent               TSX2  ! X66_ARET

      941     2206
      942     2207    3             DO WHILE ('0'B);

   2207  1 000041   000057 710000 1                  TRA     s:2214

      943     2208    3   PARTREL:     ALLFILES=%NO#;

   2208  1 000042   200016 450100       PARTREL      STZ     ALLFILES,,AUTO

      944     2209    3                CALL FMO$GETDOMAIN(I);

   2209  1 000043   200006 630500                    EPPR0   I,,AUTO
         1 000044   200044 450500                    STP0    I+1,,AUTO
         1 000045   200044 630500                    EPPR0   I+1,,AUTO
         1 000046   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000047   000000 701000 xent               TSX1    FMO$GETDOMAIN
         1 000050   000000 011000                    NOP     0

      945     2210    3                IF I~=4 THEN

   2210  1 000051   200006 235100                    LDA     I,,AUTO
         1 000052   000004 115007                    CMPA    4,DL
         1 000053   000055 600000 1                  TZE     s:2212

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:202  
      946     2211    3                   RETURN;

   2211  1 000054   000000 702200 xent               TSX2  ! X66_ARET

      947     2212    3                UJIT$=B$JIT$;

   2212  1 000055   000000 236000 xsym               LDQ     B$JIT$
         1 000056   200004 756100                    STQ     UJIT$,,AUTO

      948     2213    3             END;

      949     2214    2             CALL RELSTARF;

   2214  1 000057   000065 701000 1                  TSX1    RELSTARF
         1 000060   000000 011000                    NOP     0

      950     2215    2             END;  /* RELEASE FILES */

   2215  1 000061   000064 710000 1                  TRA     s:2219

      951     2216    1          ELSE
      952     2217    1             CALL ALTKEYS;

   2217  1 000062   000425 701000 1                  TSX1    ALTKEYS
         1 000063   000000 011000                    NOP     0

      953     2218
      954     2219    1          RETURN;

   2219  1 000064   000000 702200 xent               TSX2  ! X66_ARET

      955     2220               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:203  
      956     2221        /*I*     NAME:     RELSTARF
      957     2222                 PURPOSE:  To release star files
      958     2223                 DESCRIPTION:
      959     2224
      960     2225                      If we are dribbling, then we need to clean it up.
      961     2226
      962     2227                      Make sure M$STAR is closed, we will use it to
      963     2228                 release star files.
      964     2229
      965     2230                      First, release all of the JIT cataloged files.
      966     2231                 If there is a DA for the file, and we want to release
      967     2232                 it, then put the name of the star file in the DCB, and
      968     2233                 release the file.
      969     2234
      970     2235                      Next, get the DA of the file directory for star
      971     2236                 files, to release the rest of the user's star files.
      972     2237                 Point to the first record, then use FMG$NXTKEYNM to
      973     2238                 position to the name of the next star file.  We
      974     2239                 want to save the buffer that holds the file directory.
      975     2240
      976     2241                     Finally, release the file directory, and then
      977     2242                 return.
      978     2243        */
      979     2244               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:204  
      980     2245    1   RELSTARF: PROC;

   2245  1 000065   200036 741300       RELSTARF     STX1  ! ACCT$+2,,AUTO

      981     2246        /* */
      982     2247    2          IF DCBADDR(%M$DRIBBLE#) ~= ADDR(NIL) THEN

   2247  1 000066   000002 470400 2                  LDP0    2
         1 000067   000000 471500                    LDP1    0,,PR0
         1 000070   177777 236100                    LDQ     -1,,PR1
         1 000071   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000072   000102 600000 1                  TZE     s:2250

      983     2248    2             IF DCBADDR(%M$DRIBBLE#)->F$DCB.STARF THEN

   2248  1 000073   177777 473500                    LDP3    -1,,PR1
         1 000074   300064 236100                    LDQ     52,,PR3
         1 000075   200000 316003                    CANQ    65536,DU
         1 000076   000102 600000 1                  TZE     s:2250

      984     2249    2             CALL UMD$QDRIB;

   2249  1 000077   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000100   000000 701000 xent               TSX1    UMD$QDRIB
         1 000101   000000 011000                    NOP     0

      985     2250    2          B$JIT.DCB$=DCBADDR(%M$STAR#);

   2250  1 000102   000002 470400 2                  LDP0    2
         1 000103   000000 471500                    LDP1    0,,PR0
         1 000104   100001 236100                    LDQ     1,,PR1
         1 000105   000000 473400 xsym               LDP3    B$JIT$
         1 000106   300232 756100                    STQ     154,,PR3

      986     2251    2          JDCB$=B$JIT.DCB$;

   2251  1 000107   200003 756100                    STQ     JDCB$,,AUTO
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:205  

      987     2252    2          IF F$DCB.FCD THEN

   2252  1 000110   200003 474500                    LDP4    JDCB$,,AUTO
         1 000111   400031 236100                    LDQ     25,,PR4
         1 000112   020000 316007                    CANQ    8192,DL
         1 000113   000117 600000 1                  TZE     s:2254

      988     2253    2             CALL FMP$CLSJ;

   2253  1 000114   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000115   000000 701000 xent               TSX1    FMP$CLSJ
         1 000116   000000 011000                    NOP     0

      989     2254    2          F$DCB.BFR='0'B;

   2254  1 000117   200003 470500                    LDP0    JDCB$,,AUTO
         1 000120   000100 100400                    MLR     fill='000'O
         1 000121   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000122   000115 000024                    ADSC9   77,,PR0                  cn=0,n=20

      990     2255    2          F$DCB.BFR1='0'B;

   2255  1 000123   000100 100400                    MLR     fill='000'O
         1 000124   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000125   000122 000024                    ADSC9   82,,PR0                  cn=0,n=20

      991     2256    2          F$DCB.SETX=FM_SYSSETX;

   2256  1 000126   000000 720000 xsym               LXL0    FM_SYSSETX
         1 000127   000051 440100                    SXL0    41,,PR0

      992     2257
      993     2258    3          DO I=1 TO SIZEW(B$JIT.STAR)-1;

   2258  1 000130   000001 235007                    LDA     1,DL
         1 000131   200006 755100                    STA     I,,AUTO
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:206  
         1 000132   000176 710000 1                  TRA     s:2270+1

      994     2259    3             IF UJIT$->B$JIT.STAR.DA(I) ~= 0 AND

   2259  1 000133   200004 470500                    LDP0    UJIT$,,AUTO
         1 000134   200006 720100                    LXL0    I,,AUTO
         1 000135   000222 235110                    LDA     146,X0,PR0
         1 000136   000175 600000 1                  TZE     s:2270
         1 000137   200016 234100                    SZN     ALLFILES,,AUTO
         1 000140   000146 604000 1                  TMI     s:2262
         1 000141   200006 236100                    LDQ     I,,AUTO
         1 000142   000003 116007                    CMPQ    3,DL
         1 000143   000146 604000 1                  TMI     s:2262
         1 000144   000004 116007                    CMPQ    4,DL
         1 000145   000175 604400 1                  TMOZ    s:2270

      995     2260    3                (ALLFILES = %YES# OR I < 3 OR I > 4) THEN
      996     2261    4                DO;   /* PUT NAME IN DCB */

      997     2262    4                F$DCB.NAME.L=2;

   2262  1 000146   200003 471500                    LDP1    JDCB$,,AUTO
         1 000147   002000 236003                    LDQ     1024,DU
         1 000150   100010 552140                    STBQ    8,'40'O,PR1

      998     2263    4                F$DCB.NAME.C='*';

   2263  1 000151   040100 100400                    MLR     fill='040'O
         1 000152   000003 000001 2                  ADSC9   3                        cn=0,n=1
         1 000153   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31

      999     2264    4                CALL INSERT(F$DCB.NAME.C,1,1,FM_STARCHARS(I));

   2264  1 000154   200006 235100                    LDA     I,,AUTO
         1 000155   040100 100405                    MLR     fill='040'O
         1 000156   000000 000001 xsym               ADSC9   FM_STARCHARS,A           cn=0,n=1
         1 000157   100010 400001                    ADSC9   8,,PR1                   cn=2,n=1
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:207  

     1000     2265    4                FITDA=UJIT$->B$JIT.STAR.DA(I);

   2265  1 000160   000222 235110                    LDA     146,X0,PR0
         1 000161   200010 755100                    STA     FITDA,,AUTO

     1001     2266    4                UJIT$->B$JIT.STAR.DA(I)=0;

   2266  1 000162   000222 450110                    STZ     146,X0,PR0

     1002     2267    4                CALL FAG$RFILE(FITDA) ALTRET(ERR);

   2267  1 000163   200010 631500                    EPPR1   FITDA,,AUTO
         1 000164   200044 451500                    STP1    I+1,,AUTO
         1 000165   200044 630500                    EPPR0   I+1,,AUTO
         1 000166   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000167   000000 701000 xent               TSX1    FAG$RFILE
         1 000170   000411 702000 1                  TSX2    ERR

     1003     2268    4                CALL FMD$RELBUF(1);

   2268  1 000171   000000 630400 2                  EPPR0   0
         1 000172   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000173   000000 701000 xent               TSX1    FMD$RELBUF
         1 000174   000000 011000                    NOP     0

     1004     2269    4                END;  /* PUT NAME IN DCB */

     1005     2270    3          END;

   2270  1 000175   200006 054100                    AOS     I,,AUTO
         1 000176   200006 235100                    LDA     I,,AUTO
         1 000177   000007 115007                    CMPA    7,DL
         1 000200   000133 604400 1                  TMOZ    s:2259

     1006     2271
     1007     2272    2          DA=UJIT$->B$JIT.STAR.DA(0);
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:208  

   2272  1 000201   200004 470500                    LDP0    UJIT$,,AUTO
         1 000202   000222 235100                    LDA     146,,PR0
         1 000203   200005 755100                    STA     DA,,AUTO

     1008     2273    2          UJIT$->B$JIT.STAR.DA(0)=0;

   2273  1 000204   000222 450100                    STZ     146,,PR0

     1009     2274    2          F$DCB.HASH=UJIT$->B$JIT.SYSID;

   2274  1 000205   200003 471500                    LDP1    JDCB$,,AUTO
         1 000206   000000 236100                    LDQ     0,,PR0
         1 000207   777777 376007                    ANQ     -1,DL
         1 000210   000011 736000                    QLS     9
         1 000211   100073 552170                    STBQ    59,'70'O,PR1

     1010     2275    2          LCDA=0;

   2275  1 000212   200007 450100                    STZ     LCDA,,AUTO

     1011     2276
     1012     2277    3          DO WHILE (DA ~= 0);

   2277  1 000213   000000 115003                    CMPA    0,DU
         1 000214   000407 600000 1                  TZE     s:2318

     1013     2278    3             F$DCB.GTYP=FMGTFDSTAR;

   2278  1 000215   200003 470500                    LDP0    JDCB$,,AUTO
         1 000216   034000 236003                    LDQ     14336,DU
         1 000217   000064 256100                    ORSQ    52,,PR0

     1014     2279    3             CALL FMC$CLR1(DA);

   2279  1 000220   200005 631500                    EPPR1   DA,,AUTO
         1 000221   200044 451500                    STP1    I+1,,AUTO
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:209  
         1 000222   200044 630500                    EPPR0   I+1,,AUTO
         1 000223   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000224   000000 701000 xent               TSX1    FMC$CLR1
         1 000225   000000 011000                    NOP     0

     1015     2280    3             F$DCB.HASH=UJIT$->B$JIT.SYSID;

   2280  1 000226   200003 470500                    LDP0    JDCB$,,AUTO
         1 000227   200004 471500                    LDP1    UJIT$,,AUTO
         1 000230   100000 236100                    LDQ     0,,PR1
         1 000231   777777 376007                    ANQ     -1,DL
         1 000232   000011 736000                    QLS     9
         1 000233   000073 552170                    STBQ    59,'70'O,PR0

     1016     2281    3             F$DCB.STARF='1'B;

   2281  1 000234   200000 236003                    LDQ     65536,DU
         1 000235   000064 256100                    ORSQ    52,,PR0

     1017     2282    3             F$DCB.CRECX=0;

   2282  1 000236   000000 220003                    LDX0    0,DU
         1 000237   000067 440100                    SXL0    55,,PR0

     1018     2283    3             F$DCB.RPOS='0'B;

   2283  1 000240   000004 236000 2                  LDQ     4
         1 000241   000064 356100                    ANSQ    52,,PR0

     1019     2284    3             CALL FMD$REDBUF(BUF$,1,DA,,LCDA) ALTRET(ERR);

   2284  1 000242   200007 633500                    EPPR3   LCDA,,AUTO
         1 000243   200050 453500                    STP3    I+5,,AUTO
         1 000244   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000245   200047 756100                    STQ     I+4,,AUTO
         1 000246   200005 634500                    EPPR4   DA,,AUTO
         1 000247   200046 454500                    STP4    I+3,,AUTO
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:210  
         1 000250   000000 236000 2                  LDQ     0
         1 000251   200045 756100                    STQ     I+2,,AUTO
         1 000252   200011 635500                    EPPR5   BUF$,,AUTO
         1 000253   200044 455500                    STP5    I+1,,AUTO
         1 000254   200044 630500                    EPPR0   I+1,,AUTO
         1 000255   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000256   000000 701000 xent               TSX1    FMD$REDBUF
         1 000257   000411 702000 1                  TSX2    ERR

     1020     2285
     1021     2286    4             DO WHILE ('1'B);

     1022     2287    4                B$JIT.ERR='0'B;

   2287  1 000260   000000 470400 xsym               LDP0    B$JIT$
         1 000261   000012 450100                    STZ     10,,PR0

     1023     2288    4                CALL FMG$NXTKEYNM(SEG$,I,KEY$) ALTRET(NXTERR);

   2288  1 000262   200013 631500                    EPPR1   KEY$,,AUTO
         1 000263   200046 451500                    STP1    I+3,,AUTO
         1 000264   200006 633500                    EPPR3   I,,AUTO
         1 000265   200045 453500                    STP3    I+2,,AUTO
         1 000266   200012 634500                    EPPR4   SEG$,,AUTO
         1 000267   200044 454500                    STP4    I+1,,AUTO
         1 000270   200044 630500                    EPPR0   I+1,,AUTO
         1 000271   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000272   000000 701000 xent               TSX1    FMG$NXTKEYNM
         1 000273   000357 702000 1                  TSX2    NXTERR

     1024     2289    4                IF NOT FM$KEYENT.D AND FM$FDSEG.FITSDA~=0 THEN

   2289  1 000274   200013 470500                    LDP0    KEY$,,AUTO
         1 000275   000000 234100                    SZN     0,,PR0
         1 000276   000260 604000 1                  TMI     s:2287
         1 000277   200012 471500                    LDP1    SEG$,,AUTO
         1 000300   100000 236100                    LDQ     0,,PR1
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:211  
         1 000301   000032 316000 xsym               CANQ    B_VECTNIL+26
         1 000302   000260 600000 1                  TZE     s:2287

     1025     2290    5                   DO;

     1026     2291    5                   F$DCB.NAME.L=FM$KEYENT.KLB;

   2291  1 000303   200003 473500                    LDP3    JDCB$,,AUTO
         1 000304   000000 236100                    LDQ     0,,PR0
         1 000305   377000 376003                    ANQ     130560,DU
         1 000306   300010 552140                    STBQ    8,'40'O,PR3

     1027     2292    5                   F$DCB.NAME.C=FM$KEYENT.TXT;

   2292  1 000307   200013 470500                    LDP0    KEY$,,AUTO
         1 000310   000000 236100                    LDQ     0,,PR0
         1 000311   000033 772000                    QRL     27
         1 000312   000377 376007                    ANQ     255,DL
         1 000313   000000 620006                    EAX0    0,QL
         1 000314   040100 100540                    MLR     fill='040'O
         1 000315   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
         1 000316   300010 200037                    ADSC9   8,,PR3                   cn=1,n=31

     1028     2293    5                   FITDA=FM$FDSEG.FITSDA;

   2293  1 000317   200012 470500                    LDP0    SEG$,,AUTO
         1 000320   000000 236100                    LDQ     0,,PR0
         1 000321   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000322   200010 756100                    STQ     FITDA,,AUTO

     1029     2294    5                   BFR=F$DCB.BFR(1);

   2294  1 000323   300116 236100                    LDQ     78,,PR3
         1 000324   200017 756100                    STQ     BFR,,AUTO

     1030     2295    5                   BFR1=F$DCB.BFR1(1);

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:212  
   2295  1 000325   300123 236100                    LDQ     83,,PR3
         1 000326   200020 756100                    STQ     BFR1,,AUTO

     1031     2296    5                   F$DCB.BFR(1)='0'B;

   2296  1 000327   300116 450100                    STZ     78,,PR3

     1032     2297    5                   F$DCB.BFR1(1)='0'B;

   2297  1 000330   300123 450100                    STZ     83,,PR3

     1033     2298    5                   CALL FAG$RFILE(FITDA) ALTRET(ERR);

   2298  1 000331   200010 631500                    EPPR1   FITDA,,AUTO
         1 000332   200044 451500                    STP1    I+1,,AUTO
         1 000333   200044 630500                    EPPR0   I+1,,AUTO
         1 000334   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000335   000000 701000 xent               TSX1    FAG$RFILE
         1 000336   000411 702000 1                  TSX2    ERR

     1034     2299    5                   CALL FMD$RELBUF(1);

   2299  1 000337   000000 630400 2                  EPPR0   0
         1 000340   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000341   000000 701000 xent               TSX1    FMD$RELBUF
         1 000342   000000 011000                    NOP     0

     1035     2300    5                   F$DCB.BFR(1)=BFR;

   2300  1 000343   200017 236100                    LDQ     BFR,,AUTO
         1 000344   200003 470500                    LDP0    JDCB$,,AUTO
         1 000345   000116 756100                    STQ     78,,PR0

     1036     2301    5                   F$DCB.BFR1(1)=BFR1;

   2301  1 000346   200020 236100                    LDQ     BFR1,,AUTO
         1 000347   000123 756100                    STQ     83,,PR0
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:213  

     1037     2302    5                   BFR='0'B;

   2302  1 000350   200017 450100                    STZ     BFR,,AUTO

     1038     2303    5                   BFR1='0'B;

   2303  1 000351   200020 450100                    STZ     BFR1,,AUTO

     1039     2304    5                   F$DCB.GTYP=FMGTFD;

   2304  1 000352   000064 236100                    LDQ     52,,PR0
         1 000353   000005 376000 2                  ANQ     5
         1 000354   020000 276003                    ORQ     8192,DU
         1 000355   000064 756100                    STQ     52,,PR0

     1040     2305    5                   END;

     1041     2306    4             END;  /* FOREVER */

   2306  1 000356   000260 710000 1                  TRA     s:2287

     1042     2307
     1043     2308    3   NXTERR:   IF B$JIT.ERR THEN

   2308  1 000357   000000 470400 xsym  NXTERR       LDP0    B$JIT$
         1 000360   000012 235100                    LDA     10,,PR0
         1 000361   000411 601000 1                  TNZ     ERR

     1044     2309    3                GOTO ERR;
     1045     2310    3             EXTNT.DA=DA;

   2310  1 000362   200005 236100                    LDQ     DA,,AUTO
         1 000363   200010 552134                    STBQ    FITDA,'34'O,AUTO

     1046     2311    3             EXTNT.SIZ=1;

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:214  
   2311  1 000364   001000 236003                    LDQ     512,DU
         1 000365   200010 552140                    STBQ    FITDA,'40'O,AUTO

     1047     2312    3             LCDA=DA;

   2312  1 000366   200005 235100                    LDA     DA,,AUTO
         1 000367   200007 755100                    STA     LCDA,,AUTO

     1048     2313    3             DA=FM$GRAN.FLINK;

   2313  1 000370   200011 471500                    LDP1    BUF$,,AUTO
         1 000371   100004 235100                    LDA     4,,PR1
         1 000372   200005 755100                    STA     DA,,AUTO

     1049     2314    3             CALL FMD$RELBUF(1);

   2314  1 000373   000000 630400 2                  EPPR0   0
         1 000374   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000375   000000 701000 xent               TSX1    FMD$RELBUF
         1 000376   000000 011000                    NOP     0

     1050     2315    3             CALL FAG$REXT(EXTNT) ALTRET(ERR);

   2315  1 000377   200010 630500                    EPPR0   FITDA,,AUTO
         1 000400   200044 450500                    STP0    I+1,,AUTO
         1 000401   200044 630500                    EPPR0   I+1,,AUTO
         1 000402   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000403   000000 701000 xent               TSX1    FAG$REXT
         1 000404   000411 702000 1                  TSX2    ERR

     1051     2316    3          END;  /* WHILE */

   2316  1 000405   200005 235100                    LDA     DA,,AUTO
         1 000406   000215 601000 1                  TNZ     s:2278

     1052     2317
     1053     2318    2          RETURN;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:215  

   2318  1 000407   200036 221300                    LDX1  ! ACCT$+2,,AUTO
         1 000410   000001 702211                    TSX2  ! 1,X1

     1054     2319
     1055     2320    2   ERR:   CALL FMD$RELBUF(0);

   2320  1 000411   000001 630400 2     ERR          EPPR0   1
         1 000412   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000413   000000 701000 xent               TSX1    FMD$RELBUF
         1 000414   000000 011000                    NOP     0

     1056     2321    2          CALL FMD$RELBUF(1);

   2321  1 000415   000000 630400 2                  EPPR0   0
         1 000416   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000417   000000 701000 xent               TSX1    FMD$RELBUF
         1 000420   000000 011000                    NOP     0

     1057     2322    2          B$JIT.ERR='0'B;

   2322  1 000421   000000 470400 xsym               LDP0    B$JIT$
         1 000422   000012 450100                    STZ     10,,PR0

     1058     2323    2          RETURN;

   2323  1 000423   200036 221300                    LDX1  ! ACCT$+2,,AUTO
         1 000424   000001 702211                    TSX2  ! 1,X1

     1059     2324    2          END RELSTARF;
     1060     2325               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:216  
     1061     2326        /*I*     NAME:     ALTKEYS
     1062     2327                 PURPOSE:  To handle sleazy monitor calls for ALTKEY
     1063     2328                 DESCRIPTION:
     1064     2329
     1065     2330                      Make sure that this is ALTKEY.:SYS calling us,
     1066     2331                 if it isn't, hang up.
     1067     2332
     1068     2333                      Find out want it wants to do.
     1069     2334        */
     1070     2335                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:217  
     1071     2336    1   ALTKEYS: PROC;

   2336  1 000425   200036 741300       ALTKEYS      STX1  ! ACCT$+2,,AUTO

     1072     2337        /* */
     1073     2338    2          IF DCBADDR(%M$LM#)->F$DCB.NAME.C ~= 'ALTKEY' OR

   2338  1 000426   000002 470400 2                  LDP0    2
         1 000427   000000 471500                    LDP1    0,,PR0
         1 000430   100002 473500                    LDP3    2,,PR1
         1 000431   040000 106500                    CMPC    fill='040'O
         1 000432   300010 200037                    ADSC9   8,,PR3                   cn=1,n=31
         1 000433   000001 000006 0                  ADSC9   FMQ$E$CLSREL+1           cn=0,n=6
         1 000434   000441 601000 1                  TNZ     s:2340
         1 000435   040000 106500                    CMPC    fill='040'O
         1 000436   300020 000010                    ADSC9   16,,PR3                  cn=0,n=8
         1 000437   000003 000004 0                  ADSC9   FMQ$E$CLSREL+3           cn=0,n=4
         1 000440   000442 600000 1                  TZE     s:2342

     1074     2339    2             DCBADDR(%M$LM#)->F$DCB.ACCT ~= ':SYS' THEN
     1075     2340    2             RETURN;

   2340  1 000441   000001 702211                    TSX2  ! 1,X1

     1076     2341
     1077     2342    2          B$JIT.DCB$=B$ROSEG$->B$ROSEG.DCBPTR$->B$RODCB$(FKA_ALTKEYS_BFR.DCB#);

   2342  1 000442   000000 474400 xsym               LDP4    B$ROSEG$
         1 000443   400000 475500                    LDP5    0,,PR4
         1 000444   000000 476400 xsym               LDP6    B$PS1$
         1 000445   600000 720100                    LXL0    0,,PR6
         1 000446   500000 236110                    LDQ     0,X0,PR5
         1 000447   000000 477400 xsym               LDP7    B$JIT$
         1 000450   700232 756100                    STQ     154,,PR7

     1078     2343    2          JDCB$=B$JIT.DCB$;

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:218  
   2343  1 000451   200003 756100                    STQ     JDCB$,,AUTO

     1079     2344
     1080     2345    3          DO CASE(FKA_ALTKEYS_BFR.CODE);

   2345  1 000452   600002 235100                    LDA     2,,PR6
         1 000453   000003 115007                    CMPA    3,DL
         1 000454   000456 602005 1                  TNC     s:2345+4,AL
         1 000455   000471 710000 1                  TRA     s:2357
         1 000456   000461 710000 1                  TRA     s:2347
         1 000457   000467 710000 1                  TRA     s:2353
         1 000460   000464 710000 1                  TRA     s:2350

     1081     2346    3             CASE(%ALTKEY_OPEN#);

     1082     2347    3                CALL OPEN;

   2347  1 000461   000473 701000 1                  TSX1    OPEN
         1 000462   000000 011000                    NOP     0
         1 000463   000471 710000 1                  TRA     s:2357

     1083     2348
     1084     2349    3             CASE(%ALTKEY_CLOSE#);

     1085     2350    3                CALL CLOSE;

   2350  1 000464   000756 701000 1                  TSX1    CLOSE
         1 000465   000000 011000                    NOP     0
         1 000466   000471 710000 1                  TRA     s:2357

     1086     2351
     1087     2352    3             CASE(%ALTKEY_EXTEND#);

     1088     2353    3                CALL EXTEND;

   2353  1 000467   001130 701000 1                  TSX1    EXTEND
         1 000470   000000 011000                    NOP     0
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:219  

     1089     2354
     1090     2355    3          END;  /* CASE */

     1091     2356
     1092     2357    2          RETURN;

   2357  1 000471   200036 221300                    LDX1  ! ACCT$+2,,AUTO
         1 000472   000001 702211                    TSX2  ! 1,X1

     1093     2358    2          END ALTKEYS;
     1094     2359               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:220  
     1095     2360        /*I*     NAME:     OPEN
     1096     2361                 PURPOSE:  To handle sleazy opens for ALTKEY
     1097     2362                 DESCRIPTION:
     1098     2363
     1099     2364                      Initialize the DCB from the information from
     1100     2365                 the CFU pointer given to us.
     1101     2366
     1102     2367                      Next, get the FIT, and initialize some more
     1103     2368                 information in the DCB.
     1104     2369        */
     1105     2370                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:221  
     1106     2371    1   OPEN:  PROC;

   2371  1 000473   200040 741300       OPEN         STX1  ! ACCT$+4,,AUTO

     1107     2372        /* */
     1108     2373    2          CALL FMM$SCRUB(JDCB$);

   2373  1 000474   200003 630500                    EPPR0   JDCB$,,AUTO
         1 000475   200044 450500                    STP0    I+1,,AUTO
         1 000476   200044 630500                    EPPR0   I+1,,AUTO
         1 000477   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000500   000000 701000 xent               TSX1    FMM$SCRUB
         1 000501   000000 011000                    NOP     0

     1109     2374
     1110     2375    2          F$DCB.CFU$=FKA_ALTKEYS_BFR.CFU$;

   2375  1 000502   000000 470400 xsym               LDP0    B$PS1$
         1 000503   000001 236100                    LDQ     1,,PR0
         1 000504   200003 471500                    LDP1    JDCB$,,AUTO
         1 000505   100066 756100                    STQ     54,,PR1

     1111     2376    2          F$DCB.ASN=%FILE#;

   2376  1 000506   001000 236007                    LDQ     512,DL
         1 000507   100032 552110                    STBQ    26,'10'O,PR1

     1112     2377    2          F$DCB.IASN=%FILE#;

   2377  1 000510   000001 236007                    LDQ     1,DL
         1 000511   100103 552104                    STBQ    67,'04'O,PR1

     1113     2378    2          F$DCB.IORG=%KEYED#;

   2378  1 000512   100070 236100                    LDQ     56,,PR1
         1 000513   000006 376000 2                  ANQ     6
         1 000514   002000 276003                    ORQ     1024,DU
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:222  
         1 000515   100070 756100                    STQ     56,,PR1

     1114     2379    2          F$DCB.IFMT=FMTRAN#;

   2379  1 000516   003000 236003                    LDQ     1536,DU
         1 000517   100103 552140                    STBQ    67,'40'O,PR1

     1115     2380    2          F$DCB.MEDIA=FMTRAN#;

   2380  1 000520   000003 236003                    LDQ     3,DU
         1 000521   100103 552120                    STBQ    67,'20'O,PR1

     1116     2381    2          F$DCB.ACS=%BLOCK#;

   2381  1 000522   000003 236007                    LDQ     3,DL
         1 000523   100036 552104                    STBQ    30,'04'O,PR1

     1117     2382    2          F$DCB.SETX=FKA_ALTKEYS_BFR.SETX;

   2382  1 000524   000004 720100                    LXL0    4,,PR0
         1 000525   100051 440100                    SXL0    41,,PR1

     1118     2383    2          F$DCB.FFLG=%FFLG_OWNER#;

   2383  1 000526   765700 221003                    LDX1    -5184,DU
         1 000527   100004 741100                    STX1    4,,PR1

     1119     2384    2          F$DCB.FUN=%IN#;

   2384  1 000530   000002 236003                    LDQ     2,DU
         1 000531   100032 552120                    STBQ    26,'20'O,PR1

     1120     2385    2          F$DCB.FCD='1'B;

   2385  1 000532   020000 236007                    LDQ     8192,DL
         1 000533   100031 256100                    ORSQ    25,,PR1

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:223  
     1121     2386    2          CFU$=FKA_ALTKEYS_BFR.CFU$;

   2386  1 000534   000001 236100                    LDQ     1,,PR0
         1 000535   200015 756100                    STQ     CFU$,,AUTO

     1122     2387    2          F$DCB.CFU$=CFU$;

   2387  1 000536   100066 756100                    STQ     54,,PR1

     1123     2388    2          B$JIT.CHECK_CFU = '0'B;

   2388  1 000537   000000 473400 xsym               LDP3    B$JIT$
         1 000540   000007 236000 2                  LDQ     7
         1 000541   300250 356100                    ANSQ    168,,PR3

     1124     2389
     1125     2390    3          DO WHILE(FM$CFU.NAMEX < FM$CFUX.NAMES);

   2390  1 000542   000000 474400 xsym               LDP4    F$CFU$
         1 000543   400001 236100                    LDQ     1,,PR4
         1 000544   777777 376007                    ANQ     -1,DL
         1 000545   200044 756100                    STQ     I+1,,AUTO
         1 000546   200015 475500                    LDP5    CFU$,,AUTO
         1 000547   500002 236100                    LDQ     2,,PR5
         1 000550   777777 376007                    ANQ     -1,DL
         1 000551   200044 116100                    CMPQ    I+1,,AUTO
         1 000552   000571 605000 1                  TPL     s:2394

     1126     2391    3             CFU$=PINCRW(F$CFU$, FM$CFU.NAMEX);

   2391  1 000553   200015 470500                    LDP0    CFU$,,AUTO
         1 000554   000002 720100                    LXL0    2,,PR0
         1 000555   000000 636010                    EAQ     0,X0
         1 000556   000000 036000 xsym               ADLQ    F$CFU$
         1 000557   200015 756100                    STQ     CFU$,,AUTO

     1127     2392    3          END;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:224  

   2392  1 000560   000000 470400 xsym               LDP0    F$CFU$
         1 000561   000001 236100                    LDQ     1,,PR0
         1 000562   777777 376007                    ANQ     -1,DL
         1 000563   200044 756100                    STQ     I+1,,AUTO
         1 000564   200015 471500                    LDP1    CFU$,,AUTO
         1 000565   100002 236100                    LDQ     2,,PR1
         1 000566   777777 376007                    ANQ     -1,DL
         1 000567   200044 116100                    CMPQ    I+1,,AUTO
         1 000570   000553 604000 1                  TMI     s:2391

     1128     2393
     1129     2394    2          NAME$=PINCRC(F$CFU$, FM$CFU.NAMEX);

   2394  1 000571   200015 470500                    LDP0    CFU$,,AUTO
         1 000572   000002 236100                    LDQ     2,,PR0
         1 000573   777777 376007                    ANQ     -1,DL
         1 000574   000020 736000                    QLS     16
         1 000575   000000 036000 xsym               ADLQ    F$CFU$
         1 000576   200014 756100                    STQ     NAME$,,AUTO

     1130     2395    2          F$DCB.NAME.C=FM$CFUN.C;

   2395  1 000577   200014 471500                    LDP1    NAME$,,AUTO
         1 000600   000100 101500                    MRL     fill='000'O
         1 000601   100000 400001                    ADSC9   0,,PR1                   cn=2,n=1
         1 000602   200044 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
         1 000603   200044 220100                    LDX0    I+1,,AUTO
         1 000604   200003 473500                    LDP3    JDCB$,,AUTO
         1 000605   040100 100540                    MLR     fill='040'O
         1 000606   100000 600010                    ADSC9   0,,PR1                   cn=3,n=*X0
         1 000607   300010 200037                    ADSC9   8,,PR3                   cn=1,n=31

     1131     2396    2          F$DCB.NAME.L=FM$CFUN.L;

   2396  1 000610   000100 100500                    MLR     fill='000'O
         1 000611   100000 400001                    ADSC9   0,,PR1                   cn=2,n=1
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:225  
         1 000612   300010 000001                    ADSC9   8,,PR3                   cn=0,n=1

     1132     2397    2          F$DCB.STARF=BINBIT(FM$CFU.STARX.F, 1);

   2397  1 000613   000002 236100                    LDQ     2,,PR0
         1 000614   000001 772000                    QRL     1
         1 000615   300064 676100                    ERQ     52,,PR3
         1 000616   200000 376003                    ANQ     65536,DU
         1 000617   300064 656100                    ERSQ    52,,PR3

     1133     2398
     1134     2399    2          IF F$DCB.STARF THEN

   2399  1 000620   300064 236100                    LDQ     52,,PR3
         1 000621   200000 316003                    CANQ    65536,DU
         1 000622   000627 600000 1                  TZE     s:2405

     1135     2400    3             DO;   /* STAR FILE */

     1136     2401    3             F$DCB.ACCT='*';

   2401  1 000623   000003 235000 2                  LDA     3
         1 000624   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000625   300020 757100                    STAQ    16,,PR3

     1137     2402    3             END;  /* STAR FILE */

   2402  1 000626   000652 710000 1                  TRA     s:2413

     1138     2403    2          ELSE
     1139     2404    3             DO;   /* REAL FILE */

     1140     2405    3             CFU$=F$DCB.CFU$;

   2405  1 000627   300066 236100                    LDQ     54,,PR3
         1 000630   200015 756100                    STQ     CFU$,,AUTO

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:226  
     1141     2406    3             ACCTX=FM$CFU.ACCTX;

   2406  1 000631   200015 470500                    LDP0    CFU$,,AUTO
         1 000632   000002 236100                    LDQ     2,,PR0
         1 000633   000022 772000                    QRL     18
         1 000634   200033 756100                    STQ     ACCTX,,AUTO

     1142     2407    3             IF ACCTX = 0 THEN

   2407  1 000635   000643 601000 1                  TNZ     s:2409

     1143     2408    3                ACCTX=PINCRW(F$CFU$, FM$CFU.NAMEX)->FM$CFU.ACCTX;

   2408  1 000636   000002 720100                    LXL0    2,,PR0
         1 000637   000000 474400 xsym               LDP4    F$CFU$
         1 000640   400002 236110                    LDQ     2,X0,PR4
         1 000641   000022 772000                    QRL     18
         1 000642   200033 756100                    STQ     ACCTX,,AUTO

     1144     2409    3             ACCT$=PINCRW(F$CFU$, ACCTX);

   2409  1 000643   000022 736000                    QLS     18
         1 000644   000000 036000 xsym               ADLQ    F$CFU$
         1 000645   200034 756100                    STQ     ACCT$,,AUTO

     1145     2410    3             F$DCB.ACCT=ACCT$->FM$CFUA.ACCT;

   2410  1 000646   200034 474500                    LDP4    ACCT$,,AUTO
         1 000647   040100 100500                    MLR     fill='040'O
         1 000650   400001 000010                    ADSC9   1,,PR4                   cn=0,n=8
         1 000651   300020 000010                    ADSC9   16,,PR3                  cn=0,n=8

     1146     2411    3             END;  /* REAL FILE */

     1147     2412
     1148     2413    2          BUFNO=1;

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:227  
   2413  1 000652   000001 235007                    LDA     1,DL
         1 000653   200024 755100                    STA     BUFNO,,AUTO

     1149     2414    2          CALL FMN$GETFIT(BUF$, BUFNO) ALTRET(ERR);

   2414  1 000654   200024 634500                    EPPR4   BUFNO,,AUTO
         1 000655   200045 454500                    STP4    I+2,,AUTO
         1 000656   200011 635500                    EPPR5   BUF$,,AUTO
         1 000657   200044 455500                    STP5    I+1,,AUTO
         1 000660   200044 630500                    EPPR0   I+1,,AUTO
         1 000661   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000662   000000 701000 xent               TSX1    FMN$GETFIT
         1 000663   000754 702000 1                  TSX2    ERR

     1150     2415
     1151     2416    2          FKA_ALTKEYS_BFR.FPARAM=BUF$->FPARAM;

   2416  1 000664   200011 470500                    LDP0    BUF$,,AUTO
         1 000665   010000 220003                    LDX0    4096,DU
         1 000666   000000 471400 xsym               LDP1    B$PS1$
         1 000667   000140 100540                    MLR     fill='000'O
         1 000670   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 000671   100006 000010                    ADSC9   6,,PR1                   cn=0,n=*X0

     1152     2417    2          FIT$=PINCRW(BUF$, SIZEW(FM$GRAN));

   2417  1 000672   200011 236100                    LDQ     BUF$,,AUTO
         1 000673   000005 036003                    ADLQ    5,DU
         1 000674   200021 756100                    STQ     FIT$,,AUTO

     1153     2418
     1154     2419    2          CODE$=FIT$;

   2419  1 000675   200025 756100                    STQ     CODE$,,AUTO

     1155     2420    2          CALL FMO$LOCCODP(CODE$, 1);

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:228  
   2420  1 000676   000000 236000 2                  LDQ     0
         1 000677   200045 756100                    STQ     I+2,,AUTO
         1 000700   200025 630500                    EPPR0   CODE$,,AUTO
         1 000701   200044 450500                    STP0    I+1,,AUTO
         1 000702   200044 630500                    EPPR0   I+1,,AUTO
         1 000703   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000704   000000 701000 xent               TSX1    FMO$LOCCODP
         1 000705   000000 011000                    NOP     0

     1156     2421    2          F$DCB.HASH=CODE01.HASH;

   2421  1 000706   200025 470500                    LDP0    CODE$,,AUTO
         1 000707   200003 471500                    LDP1    JDCB$,,AUTO
         1 000710   000000 236100                    LDQ     0,,PR0
         1 000711   000011 736000                    QLS     9
         1 000712   100073 552170                    STBQ    59,'70'O,PR1

     1157     2422
     1158     2423    2          CODE$=FIT$;

   2423  1 000713   200021 236100                    LDQ     FIT$,,AUTO
         1 000714   200025 756100                    STQ     CODE$,,AUTO

     1159     2424    2          CALL FMO$LOCCODP(CODE$, 2);

   2424  1 000715   000010 236000 2                  LDQ     8
         1 000716   200045 756100                    STQ     I+2,,AUTO
         1 000717   200025 630500                    EPPR0   CODE$,,AUTO
         1 000720   200044 450500                    STP0    I+1,,AUTO
         1 000721   200044 630500                    EPPR0   I+1,,AUTO
         1 000722   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000723   000000 701000 xent               TSX1    FMO$LOCCODP
         1 000724   000000 011000                    NOP     0

     1160     2425    2          F$DCB.SPARE=CODE02.SPARE;

   2425  1 000725   200025 470500                    LDP0    CODE$,,AUTO
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:229  
         1 000726   200003 471500                    LDP1    JDCB$,,AUTO
         1 000727   000000 236100                    LDQ     0,,PR0
         1 000730   000022 736000                    QLS     18
         1 000731   100040 552140                    STBQ    32,'40'O,PR1

     1161     2426
     1162     2427    2          CODE$=FIT$;

   2427  1 000732   200021 236100                    LDQ     FIT$,,AUTO
         1 000733   200025 756100                    STQ     CODE$,,AUTO

     1163     2428    2          CALL FMO$LOCCODP(CODE$, 3);

   2428  1 000734   000011 236000 2                  LDQ     9
         1 000735   200045 756100                    STQ     I+2,,AUTO
         1 000736   200025 630500                    EPPR0   CODE$,,AUTO
         1 000737   200044 450500                    STP0    I+1,,AUTO
         1 000740   200044 630500                    EPPR0   I+1,,AUTO
         1 000741   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000742   000000 701000 xent               TSX1    FMO$LOCCODP
         1 000743   000000 011000                    NOP     0

     1164     2429    2          F$DCB.ORG=CODE03.ORG;

   2429  1 000744   200025 470500                    LDP0    CODE$,,AUTO
         1 000745   200003 471500                    LDP1    JDCB$,,AUTO
         1 000746   000000 236100                    LDQ     0,,PR0
         1 000747   100032 552140                    STBQ    26,'40'O,PR1

     1165     2430    2          F$DCB.XTNSIZE=CODE03.XTNSIZE;

   2430  1 000750   000005 220100                    LDX0    5,,PR0
         1 000751   100037 740100                    STX0    31,,PR1

     1166     2431    2          F$DCB.DESC=CODE03.DESC;

   2431  1 000752   000001 221100                    LDX1    1,,PR0
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:230  
         1 000753   100005 441100                    SXL1    5,,PR1

     1167     2432
     1168     2433    2   ERR:   RETURN;

   2433  1 000754   200040 221300       ERR          LDX1  ! ACCT$+4,,AUTO
         1 000755   000001 702211                    TSX2  ! 1,X1

     1169     2434    2          END OPEN;
     1170     2435               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:231  
     1171     2436        /*I*     NAME:     CLOSE
     1172     2437                 PURPOSE:  To handle sleazy closes for ALTKEY
     1173     2438                 DESCRIPTION:
     1174     2439
     1175     2440                      We need to rebuild the upper levels for the alternate
     1176     2441                 indexes and update the FIT.  ALTKEY has some new information
     1177     2442                 for the DCB and ROSEG, so put that in place first.
     1178     2443
     1179     2444                      Next, rebuild the upper levels for just the alternate
     1180     2445                 keys.  Since we may have added extents to the file during
     1181     2446                 the build, there may be something in NGAVAL even though
     1182     2447                 FMO$MODFIT may have already thrown away extras before linking
     1183     2448                 to ALTKEY.  So, see if he wants to release NGAVAL. If so and
     1184     2449                 he's allowed to, do it.  Otherwise, give him an error.  Then
     1185     2450                 get the FIT and call the right routine to update it with the
     1186     2451                 new information.  Finally, write out the updated FIT.
     1187     2452        */
     1188     2453                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:232  
     1189     2454    1   CLOSE: PROC;

   2454  1 000756   200040 741300       CLOSE        STX1  ! ACCT$+4,,AUTO

     1190     2455        /* */
     1191     2456    2          FPARAM$=PINCRW(ADDR(FKA_ALTKEYS_BFR.FPARAM), SIZEW(FM$GRAN));

   2456  1 000757   000000 236000 xsym               LDQ     B$PS1$
         1 000760   000013 036003                    ADLQ    11,DU
         1 000761   200022 756100                    STQ     FPARAM$,,AUTO

     1192     2457    2          IF F$DCB.ORG = %INDEXED# THEN

   2457  1 000762   200003 470500                    LDP0    JDCB$,,AUTO
         1 000763   000032 236100                    LDQ     26,,PR0
         1 000764   777000 376003                    ANQ     -512,DU
         1 000765   006000 116003                    CMPQ    3072,DU
         1 000766   000772 601000 1                  TNZ     s:2460

     1193     2458    2             CALL INDEXED_SETUP ALTRET(ERR);

   2458  1 000767   001167 701000 1                  TSX1    INDEXED_SETUP
         1 000770   001126 702000 1                  TSX2    ERR
         1 000771   000774 710000 1                  TRA     s:2462

     1194     2459    2          ELSE
     1195     2460    2             CALL IREL_SETUP ALTRET(ERR);

   2460  1 000772   001255 701000 1                  TSX1    IREL_SETUP
         1 000773   001126 702000 1                  TSX2    ERR

     1196     2461
     1197     2462    2          IORG=F$DCB.IORG;

   2462  1 000774   200003 470500                    LDP0    JDCB$,,AUTO
         1 000775   000070 236100                    LDQ     56,,PR0
         1 000776   000033 772000                    QRL     27
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:233  
         1 000777   000077 376007                    ANQ     63,DL
         1 001000   200023 756100                    STQ     IORG,,AUTO

     1198     2463    2          F$DCB.IORG=%KEYED#;

   2463  1 001001   000070 236100                    LDQ     56,,PR0
         1 001002   000006 376000 2                  ANQ     6
         1 001003   002000 276003                    ORQ     1024,DU
         1 001004   000070 756100                    STQ     56,,PR0

     1199     2464    2          F$DCB.CFU$->FM$CFU.ULBLD=1;

   2464  1 001005   000066 471500                    LDP1    54,,PR0
         1 001006   000001 236003                    LDQ     1,DU
         1 001007   100006 256100                    ORSQ    6,,PR1

     1200     2465    2          CALL FMU$BLDALT;

   2465  1 001010   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001011   000000 701000 xent               TSX1    FMU$BLDALT
         1 001012   000000 011000                    NOP     0

     1201     2466    2          F$DCB.CFU$->FM$CFU.FUN=MOD(F$DCB.CFU$->FM$CFU.FUN,4);

   2466  1 001013   200003 470500                    LDP0    JDCB$,,AUTO
         1 001014   000066 471500                    LDP1    54,,PR0
         1 001015   100000 236100                    LDQ     0,,PR1
         1 001016   000041 772000                    QRL     33
         1 001017   000003 376007                    ANQ     3,DL
         1 001020   000041 736000                    QLS     33
         1 001021   100000 676100                    ERQ     0,,PR1
         1 001022   700000 376003                    ANQ     -32768,DU
         1 001023   100000 656100                    ERSQ    0,,PR1

     1202     2467
     1203     2468    2          IF FKA_ALTKEYS_BFR.RELG AND F$DCB.CFU$->FM$CFU.NGAVAL~=0 THEN

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:234  
   2468  1 001024   000000 470400 xsym               LDP0    B$PS1$
         1 001025   000005 234100                    SZN     5,,PR0
         1 001026   001063 605000 1                  TPL     s:2484
         1 001027   200003 471500                    LDP1    JDCB$,,AUTO
         1 001030   100066 473500                    LDP3    54,,PR1
         1 001031   300007 236100                    LDQ     7,,PR3
         1 001032   000032 316000 xsym               CANQ    B_VECTNIL+26
         1 001033   001063 600000 1                  TZE     s:2484

     1204     2469    2             IF FKA_ALTKEYS_BFR.DELF THEN

   2469  1 001034   000005 236100                    LDQ     5,,PR0
         1 001035   200000 316003                    CANQ    65536,DU
         1 001036   001060 600000 1                  TZE     s:2477

     1205     2470    3                DO;  /* Release NGAVAL */

     1206     2471    3                BUFNO=1;

   2471  1 001037   000001 235007                    LDA     1,DL
         1 001040   200024 755100                    STA     BUFNO,,AUTO

     1207     2472    4                CALL FMO$RELG(BUFNO) WHENALTRETURN DO;

   2472  1 001041   200024 634500                    EPPR4   BUFNO,,AUTO
         1 001042   200044 454500                    STP4    I+1,,AUTO
         1 001043   200044 630500                    EPPR0   I+1,,AUTO
         1 001044   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001045   000000 701000 xent               TSX1    FMO$RELG
         1 001046   001050 702000 1                  TSX2    s:2473
         1 001047   001057 710000 1                  TRA     s:2476

     1208     2473    4                   F$DCB.IORG=IORG;

   2473  1 001050   200003 470500                    LDP0    JDCB$,,AUTO
         1 001051   200023 236100                    LDQ     IORG,,AUTO
         1 001052   000033 736000                    QLS     27
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:235  
         1 001053   000070 676100                    ERQ     56,,PR0
         1 001054   077000 376003                    ANQ     32256,DU
         1 001055   000070 656100                    ERSQ    56,,PR0

     1209     2474    4                   GOTO ERR; /* Bad fit */

   2474  1 001056   001126 710000 1                  TRA     ERR

     1210     2475    4                   END;
     1211     2476    3                END; /* Release NGAVAL */

   2476  1 001057   001063 710000 1                  TRA     s:2484

     1212     2477    2             ELSE B$JIT.ERR=FMQ$E$CLSREL;

   2477  1 001060   000000 236000 0                  LDQ     FMQ$E$CLSREL
         1 001061   000000 474400 xsym               LDP4    B$JIT$
         1 001062   400012 756100                    STQ     10,,PR4

     1213     2478
     1214     2479               /*E* ERROR:    FMQ-E$CLSREL-E
     1215     2480                    MESSAGE:  You may not release NGAVAL% for %FN% since you
     1216     2481                              do not have DELF access
     1217     2482               */
     1218     2483
     1219     2484    2          F$DCB.IORG=IORG;

   2484  1 001063   200003 470500                    LDP0    JDCB$,,AUTO
         1 001064   200023 236100                    LDQ     IORG,,AUTO
         1 001065   000033 736000                    QLS     27
         1 001066   000070 676100                    ERQ     56,,PR0
         1 001067   077000 376003                    ANQ     32256,DU
         1 001070   000070 656100                    ERSQ    56,,PR0

     1220     2485    2          BUFNO=1;

   2485  1 001071   000001 235007                    LDA     1,DL
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:236  
         1 001072   200024 755100                    STA     BUFNO,,AUTO

     1221     2486    2          CALL FMN$GETFIT(BUF$, BUFNO) ALTRET(ERR);

   2486  1 001073   200024 631500                    EPPR1   BUFNO,,AUTO
         1 001074   200045 451500                    STP1    I+2,,AUTO
         1 001075   200011 633500                    EPPR3   BUF$,,AUTO
         1 001076   200044 453500                    STP3    I+1,,AUTO
         1 001077   200044 630500                    EPPR0   I+1,,AUTO
         1 001100   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001101   000000 701000 xent               TSX1    FMN$GETFIT
         1 001102   001126 702000 1                  TSX2    ERR

     1222     2487    2          FIT$=PINCRW(BUF$, SIZEW(FM$GRAN));

   2487  1 001103   200011 236100                    LDQ     BUF$,,AUTO
         1 001104   000005 036003                    ADLQ    5,DU
         1 001105   200021 756100                    STQ     FIT$,,AUTO

     1223     2488
     1224     2489    2          IF F$DCB.ORG = %INDEXED# THEN

   2489  1 001106   200003 470500                    LDP0    JDCB$,,AUTO
         1 001107   000032 236100                    LDQ     26,,PR0
         1 001110   777000 376003                    ANQ     -512,DU
         1 001111   006000 116003                    CMPQ    3072,DU
         1 001112   001116 601000 1                  TNZ     s:2492

     1225     2490    2             CALL INDEXED_CLEANUP;

   2490  1 001113   001416 701000 1                  TSX1    INDEXED_CLEANUP
         1 001114   000000 011000                    NOP     0
         1 001115   001120 710000 1                  TRA     s:2494

     1226     2491    2          ELSE
     1227     2492    2             CALL IREL_CLEANUP;

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:237  
   2492  1 001116   001464 701000 1                  TSX1    IREL_CLEANUP
         1 001117   000000 011000                    NOP     0

     1228     2493
     1229     2494    2          CALL FMD$WRTBUF(BUFNO);

   2494  1 001120   200024 630500                    EPPR0   BUFNO,,AUTO
         1 001121   200044 450500                    STP0    I+1,,AUTO
         1 001122   200044 630500                    EPPR0   I+1,,AUTO
         1 001123   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001124   000000 701000 xent               TSX1    FMD$WRTBUF
         1 001125   000000 011000                    NOP     0

     1230     2495    2   ERR:   RETURN;

   2495  1 001126   200040 221300       ERR          LDX1  ! ACCT$+4,,AUTO
         1 001127   000001 702211                    TSX2  ! 1,X1

     1231     2496    2          END CLOSE;
     1232     2497               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:238  
     1233     2498        /*I*     NAME:     EXTEND
     1234     2499                 PURPOSE:  To get another granule for an altkey file
     1235     2500                 DESCRIPTION:
     1236     2501
     1237     2502                      Set the IORG to KEYED, so the CFU will get updated
     1238     2503                 correctly, then get a granule.  Tell ALTKEY what the
     1239     2504                 DA was.
     1240     2505        */
     1241     2506    1   EXTEND: PROC;

   2506  1 001130   200040 741300       EXTEND       STX1  ! ACCT$+4,,AUTO

     1242     2507        /* */
     1243     2508    2          IORG=F$DCB.IORG;

   2508  1 001131   200003 470500                    LDP0    JDCB$,,AUTO
         1 001132   000070 236100                    LDQ     56,,PR0
         1 001133   000033 772000                    QRL     27
         1 001134   000077 376007                    ANQ     63,DL
         1 001135   200023 756100                    STQ     IORG,,AUTO

     1244     2509    2          F$DCB.IORG=%KEYED#;

   2509  1 001136   000070 236100                    LDQ     56,,PR0
         1 001137   000006 376000 2                  ANQ     6
         1 001140   002000 276003                    ORQ     1024,DU
         1 001141   000070 756100                    STQ     56,,PR0

     1245     2510    2          CALL FAF$GETGRAN(DA) ALTRET(NONE);

   2510  1 001142   200005 631500                    EPPR1   DA,,AUTO
         1 001143   200044 451500                    STP1    I+1,,AUTO
         1 001144   200044 630500                    EPPR0   I+1,,AUTO
         1 001145   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001146   000000 701000 xent               TSX1    FAF$GETGRAN
         1 001147   001163 702000 1                  TSX2    NONE

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:239  
     1246     2511    2          F$DCB.IORG=IORG;

   2511  1 001150   200003 470500                    LDP0    JDCB$,,AUTO
         1 001151   200023 236100                    LDQ     IORG,,AUTO
         1 001152   000033 736000                    QLS     27
         1 001153   000070 676100                    ERQ     56,,PR0
         1 001154   077000 376003                    ANQ     32256,DU
         1 001155   000070 656100                    ERSQ    56,,PR0

     1247     2512    2          FKA_ALTKEYS_BFR.DA=DA;

   2512  1 001156   200005 235100                    LDA     DA,,AUTO
         1 001157   000000 471400 xsym               LDP1    B$PS1$
         1 001160   100003 755100                    STA     3,,PR1

     1248     2513    2          RETURN;

   2513  1 001161   200040 221300                    LDX1  ! ACCT$+4,,AUTO
         1 001162   000001 702211                    TSX2  ! 1,X1

     1249     2514    2   NONE:  FKA_ALTKEYS_BFR.DA=0;

   2514  1 001163   000000 470400 xsym  NONE         LDP0    B$PS1$
         1 001164   000003 450100                    STZ     3,,PR0

     1250     2515    2          RETURN;

   2515  1 001165   200040 221300                    LDX1  ! ACCT$+4,,AUTO
         1 001166   000001 702211                    TSX2  ! 1,X1

     1251     2516    2          END EXTEND;
     1252     2517               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:240  
     1253     2518        /*I*     NAME:     INDEXED_SETUP
     1254     2519                 PURPOSE:  To handle some set-up for indexed files
     1255     2520                 DESCRIPTION:
     1256     2521
     1257     2522                      Find the CODE08 from the FPARAM buffer passed
     1258     2523                 by ALTKEY.  Get some space in the ROSEG, and stuff
     1259     2524                 the information there.
     1260     2525        */
     1261     2526                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:241  
     1262     2527    1   INDEXED_SETUP: PROC ALTRET;

   2527  1 001167   200042 741300       INDEXED_SET* STX1  ! ACCT$+6,,AUTO

     1263     2528        /* */
     1264     2529    2          CODE$=FPARAM$;

   2529  1 001170   200022 236100                    LDQ     FPARAM$,,AUTO
         1 001171   200025 756100                    STQ     CODE$,,AUTO

     1265     2530    2          CALL FMO$LOCCODP(CODE$, 8);

   2530  1 001172   000012 236000 2                  LDQ     10
         1 001173   200045 756100                    STQ     I+2,,AUTO
         1 001174   200025 630500                    EPPR0   CODE$,,AUTO
         1 001175   200044 450500                    STP0    I+1,,AUTO
         1 001176   200044 630500                    EPPR0   I+1,,AUTO
         1 001177   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001200   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001201   000000 011000                    NOP     0

     1266     2531    2          N=CODE$->FITALTKEYS.NUMWRDS;

   2531  1 001202   200025 470500                    LDP0    CODE$,,AUTO
         1 001203   000000 236100                    LDQ     0,,PR0
         1 001204   000033 772000                    QRL     27
         1 001205   200026 756100                    STQ     N,,AUTO

     1267     2532    2          CALL FSA$GSP(N, ALTKEY$) ALTRET(ERR);

   2532  1 001206   200031 631500                    EPPR1   ALTKEY$,,AUTO
         1 001207   200045 451500                    STP1    I+2,,AUTO
         1 001210   200026 633500                    EPPR3   N,,AUTO
         1 001211   200044 453500                    STP3    I+1,,AUTO
         1 001212   200044 630500                    EPPR0   I+1,,AUTO
         1 001213   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001214   000000 701000 xent               TSX1    FSA$GSP
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:242  
         1 001215   001253 702000 1                  TSX2    ERR

     1268     2533    2          F$DCB.ALTKEYX=POFFW(ALTKEY$, B$ROSEG$);

   2533  1 001216   000000 235000 xsym               LDA     B$ROSEG$
         1 001217   000022 771000                    ARL     18
         1 001220   200044 755100                    STA     I+1,,AUTO
         1 001221   200031 236100                    LDQ     ALTKEY$,,AUTO
         1 001222   000022 772000                    QRL     18
         1 001223   200044 136100                    SBLQ    I+1,,AUTO
         1 001224   000000 620006                    EAX0    0,QL
         1 001225   200003 470500                    LDP0    JDCB$,,AUTO
         1 001226   000052 440100                    SXL0    42,,PR0

     1269     2534    2          N=N*4;

   2534  1 001227   200026 236100                    LDQ     N,,AUTO
         1 001230   000002 736000                    QLS     2
         1 001231   200026 756100                    STQ     N,,AUTO

     1270     2535    2          ALTKEY$->MOVEN=CODE$->MOVEN;

   2535  1 001232   200025 471500                    LDP1    CODE$,,AUTO
         1 001233   000000 621006                    EAX1    0,QL
         1 001234   200031 473500                    LDP3    ALTKEY$,,AUTO
         1 001235   200026 722100                    LXL2    N,,AUTO
         1 001236   040140 100540                    MLR     fill='040'O
         1 001237   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1
         1 001240   300000 000012                    ADSC9   0,,PR3                   cn=0,n=*X2

     1271     2536    2          F$DCB.CFU$->FM$CFU.ALTBLD=ALTKEY$->FITALTKEYS.ALTBLD;

   2536  1 001241   200003 470500                    LDP0    JDCB$,,AUTO
         1 001242   000066 471500                    LDP1    54,,PR0
         1 001243   200031 473500                    LDP3    ALTKEY$,,AUTO
         1 001244   300000 236100                    LDQ     0,,PR3
         1 001245   000006 772000                    QRL     6
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:243  
         1 001246   100006 676100                    ERQ     6,,PR1
         1 001247   000004 376003                    ANQ     4,DU
         1 001250   100006 656100                    ERSQ    6,,PR1

     1272     2537
     1273     2538    2          RETURN;

   2538  1 001251   200042 221300                    LDX1  ! ACCT$+6,,AUTO
         1 001252   000001 702211                    TSX2  ! 1,X1

     1274     2539    2   ERR:   ALTRETURN;

   2539  1 001253   200042 221300       ERR          LDX1  ! ACCT$+6,,AUTO
         1 001254   000000 702211                    TSX2  ! 0,X1

     1275     2540    2          END INDEXED_SETUP;
     1276     2541               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:244  
     1277     2542        /*I*     NAME:     IREL_SETUP
     1278     2543                 PURPOSE:  To handle the set-up for IREL files
     1279     2544                 DESCRIPTION:
     1280     2545
     1281     2546                      Find the information from the buffer passed
     1282     2547                 by ALTKEY.  Selectively move the information from
     1283     2548                 the buffer to the ROSEG.
     1284     2549        */
     1285     2550                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:245  
     1286     2551    1   IREL_SETUP: PROC ALTRET;

   2551  1 001255   200042 741300       IREL_SETUP   STX1  ! ACCT$+6,,AUTO

     1287     2552        /* */
     1288     2553    2          CODE19$=FPARAM$;

   2553  1 001256   200022 236100                    LDQ     FPARAM$,,AUTO
         1 001257   200027 756100                    STQ     CODE19$,,AUTO

     1289     2554    2          CALL FMO$LOCCODP(CODE19$, 19);

   2554  1 001260   000014 236000 2                  LDQ     12
         1 001261   200045 756100                    STQ     I+2,,AUTO
         1 001262   200027 630500                    EPPR0   CODE19$,,AUTO
         1 001263   200044 450500                    STP0    I+1,,AUTO
         1 001264   200044 630500                    EPPR0   I+1,,AUTO
         1 001265   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001266   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001267   000000 011000                    NOP     0

     1290     2555    2          CALL FMG$IRSETUP(CODE19) ALTRET(ERR);

   2555  1 001270   200027 630500                    EPPR0   CODE19$,,AUTO
         1 001271   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001272   000000 701000 xent               TSX1    FMG$IRSETUP
         1 001273   001414 702000 1                  TSX2    ERR

     1291     2556
     1292     2557    2          CODE20$=FPARAM$;

   2557  1 001274   200022 236100                    LDQ     FPARAM$,,AUTO
         1 001275   200030 756100                    STQ     CODE20$,,AUTO

     1293     2558    2          CALL FMO$LOCCODP(CODE20$, 20);

   2558  1 001276   000016 236000 2                  LDQ     14
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:246  
         1 001277   200045 756100                    STQ     I+2,,AUTO
         1 001300   200030 630500                    EPPR0   CODE20$,,AUTO
         1 001301   200044 450500                    STP0    I+1,,AUTO
         1 001302   200044 630500                    EPPR0   I+1,,AUTO
         1 001303   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001304   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001305   000000 011000                    NOP     0

     1294     2559    2          F$DCB.CFU$->FM$CFU.ALTBLD=CODE20.ALTBLD;

   2559  1 001306   200003 470500                    LDP0    JDCB$,,AUTO
         1 001307   000066 471500                    LDP1    54,,PR0
         1 001310   200030 473500                    LDP3    CODE20$,,AUTO
         1 001311   300001 236100                    LDQ     1,,PR3
         1 001312   000017 772000                    QRL     15
         1 001313   100006 676100                    ERQ     6,,PR1
         1 001314   000004 376003                    ANQ     4,DU
         1 001315   100006 656100                    ERSQ    6,,PR1

     1295     2560
     1296     2561    2          ALTKEY$=PINCRW(B$ROSEG$, F$DCB.ALTKEYX);

   2561  1 001316   000052 720100                    LXL0    42,,PR0
         1 001317   000000 636010                    EAQ     0,X0
         1 001320   000000 036000 xsym               ADLQ    B$ROSEG$
         1 001321   200031 756100                    STQ     ALTKEY$,,AUTO

     1297     2562
     1298     2563    3          DO I=0 TO CODE20.NKEYS-1;

   2563  1 001322   200006 450100                    STZ     I,,AUTO
         1 001323   001405 710000 1                  TRA     s:2568+1

     1299     2564    3             IRKEYS.K.TDALVL(I)=CODE20.K.TDALVL(I);

   2564  1 001324   200006 236100                    LDQ     I,,AUTO
         1 001325   000007 402007                    MPY     7,DL
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:247  
         1 001326   000000 620006                    EAX0    0,QL
         1 001327   200006 236100                    LDQ     I,,AUTO
         1 001330   000003 402007                    MPY     3,DL
         1 001331   200030 470500                    LDP0    CODE20$,,AUTO
         1 001332   200031 471500                    LDP1    ALTKEY$,,AUTO
         1 001333   000002 236106                    LDQ     2,QL,PR0
         1 001334   100003 676110                    ERQ     3,X0,PR1
         1 001335   777000 376003                    ANQ     -512,DU
         1 001336   100003 656110                    ERSQ    3,X0,PR1

     1300     2565    3             IRKEYS.K.TDA(I)=CODE20.K.TDA(I);

   2565  1 001337   200006 236100                    LDQ     I,,AUTO
         1 001340   000007 402007                    MPY     7,DL
         1 001341   000000 620006                    EAX0    0,QL
         1 001342   200006 236100                    LDQ     I,,AUTO
         1 001343   000003 402007                    MPY     3,DL
         1 001344   200030 470500                    LDP0    CODE20$,,AUTO
         1 001345   200031 471500                    LDP1    ALTKEY$,,AUTO
         1 001346   000002 236106                    LDQ     2,QL,PR0
         1 001347   100003 676110                    ERQ     3,X0,PR1
         1 001350   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001351   100003 656110                    ERSQ    3,X0,PR1

     1301     2566    3             IRKEYS.K.FDA(I)=CODE20.K.FDA(I);

   2566  1 001352   200006 236100                    LDQ     I,,AUTO
         1 001353   000007 402007                    MPY     7,DL
         1 001354   000000 620006                    EAX0    0,QL
         1 001355   200006 236100                    LDQ     I,,AUTO
         1 001356   000003 402007                    MPY     3,DL
         1 001357   200030 470500                    LDP0    CODE20$,,AUTO
         1 001360   200031 471500                    LDP1    ALTKEY$,,AUTO
         1 001361   000003 236106                    LDQ     3,QL,PR0
         1 001362   000011 772000                    QRL     9
         1 001363   100007 676110                    ERQ     7,X0,PR1
         1 001364   000032 376000 xsym               ANQ     B_VECTNIL+26
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:248  
         1 001365   100007 656110                    ERSQ    7,X0,PR1

     1302     2567    3             IRKEYS.K.LDA(I)=CODE20.K.LDA(I);

   2567  1 001366   200006 236100                    LDQ     I,,AUTO
         1 001367   000007 402007                    MPY     7,DL
         1 001370   000000 620006                    EAX0    0,QL
         1 001371   200006 236100                    LDQ     I,,AUTO
         1 001372   000003 402007                    MPY     3,DL
         1 001373   200030 470500                    LDP0    CODE20$,,AUTO
         1 001374   200031 471500                    LDP1    ALTKEY$,,AUTO
         1 001375   000003 235106                    LDA     3,QL,PR0
         1 001376   000004 236106                    LDQ     4,QL,PR0
         1 001377   000022 773000                    LRL     18
         1 001400   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001401   100011 676110                    ERQ     9,X0,PR1
         1 001402   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001403   100011 656110                    ERSQ    9,X0,PR1

     1303     2568    3          END;  /* DO I */

   2568  1 001404   200006 054100                    AOS     I,,AUTO
         1 001405   200030 470500                    LDP0    CODE20$,,AUTO
         1 001406   200006 236100                    LDQ     I,,AUTO
         1 001407   001324 604000 1                  TMI     s:2564
         1 001410   000000 116100                    CMPQ    0,,PR0
         1 001411   001324 602000 1                  TNC     s:2564

     1304     2569
     1305     2570    2          RETURN;

   2570  1 001412   200042 221300                    LDX1  ! ACCT$+6,,AUTO
         1 001413   000001 702211                    TSX2  ! 1,X1

     1306     2571    2   ERR:   ALTRETURN;

   2571  1 001414   200042 221300       ERR          LDX1  ! ACCT$+6,,AUTO
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:249  
         1 001415   000000 702211                    TSX2  ! 0,X1

     1307     2572    2          END IREL_SETUP;
     1308     2573               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:250  
     1309     2574        /*I*     NAME:     INDEXED_CLEANUP
     1310     2575                 PURPOSE:  To handle clean-up for Indexed files
     1311     2576                 DESCRIPTION:
     1312     2577
     1313     2578                      Move the information from the ROSEG to the
     1314     2579                 fit buffer, then release the ROSEG space we
     1315     2580                 obtained.
     1316     2581        */
     1317     2582    1   INDEXED_CLEANUP: PROC;

   2582  1 001416   200042 741300       INDEXED_CLE* STX1  ! ACCT$+6,,AUTO

     1318     2583        /* */
     1319     2584    2          CODE$=FIT$;

   2584  1 001417   200021 236100                    LDQ     FIT$,,AUTO
         1 001420   200025 756100                    STQ     CODE$,,AUTO

     1320     2585    2          CALL FMO$LOCCODP(CODE$, 8);

   2585  1 001421   000012 236000 2                  LDQ     10
         1 001422   200045 756100                    STQ     I+2,,AUTO
         1 001423   200025 630500                    EPPR0   CODE$,,AUTO
         1 001424   200044 450500                    STP0    I+1,,AUTO
         1 001425   200044 630500                    EPPR0   I+1,,AUTO
         1 001426   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001427   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001430   000000 011000                    NOP     0

     1321     2586
     1322     2587    2          N=CODE$->FITALTKEYS.NUMWRDS*4;

   2587  1 001431   200025 470500                    LDP0    CODE$,,AUTO
         1 001432   000000 236100                    LDQ     0,,PR0
         1 001433   000031 772000                    QRL     25
         1 001434   003774 376007                    ANQ     2044,DL
         1 001435   200026 756100                    STQ     N,,AUTO
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:251  

     1323     2588    2          CODE$->MOVEN=ALTKEY$->MOVEN;

   2588  1 001436   200031 471500                    LDP1    ALTKEY$,,AUTO
         1 001437   000000 620006                    EAX0    0,QL
         1 001440   200026 721100                    LXL1    N,,AUTO
         1 001441   040140 100540                    MLR     fill='040'O
         1 001442   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 001443   000000 000011                    ADSC9   0,,PR0                   cn=0,n=*X1

     1324     2589
     1325     2590    2          N=N/4;

   2590  1 001444   200026 236100                    LDQ     N,,AUTO
         1 001445   000004 506007                    DIV     4,DL
         1 001446   200026 756100                    STQ     N,,AUTO

     1326     2591    2          CALL FSA$FSP(N, ALTKEY$);

   2591  1 001447   200031 630500                    EPPR0   ALTKEY$,,AUTO
         1 001450   200045 450500                    STP0    I+2,,AUTO
         1 001451   200026 631500                    EPPR1   N,,AUTO
         1 001452   200044 451500                    STP1    I+1,,AUTO
         1 001453   200044 630500                    EPPR0   I+1,,AUTO
         1 001454   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001455   000000 701000 xent               TSX1    FSA$FSP
         1 001456   000000 011000                    NOP     0

     1327     2592    2          F$DCB.ALTKEYX=0;

   2592  1 001457   000000 220003                    LDX0    0,DU
         1 001460   200003 470500                    LDP0    JDCB$,,AUTO
         1 001461   000052 440100                    SXL0    42,,PR0

     1328     2593
     1329     2594    2          RETURN;

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:252  
   2594  1 001462   200042 221300                    LDX1  ! ACCT$+6,,AUTO
         1 001463   000001 702211                    TSX2  ! 1,X1

     1330     2595    2          END INDEXED_CLEANUP;
     1331     2596               %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:253  
     1332     2597        /*I*     NAME:     IREL_CLEANUP
     1333     2598                 PURPOSE:  To handle clean-up for IREL files.
     1334     2599                 DESCRIPTION:
     1335     2600
     1336     2601                      Find the CODE19 blocks from the FIT, and
     1337     2602                 the buffer passed by ALTKEY.  Since duplicates
     1338     2603                 may have been found by ALTKEY, we may have to
     1339     2604                 reset some UNIQUE bits.
     1340     2605
     1341     2606                      Next, set ALTBLD, and the other information
     1342     2607                 for the alternate indexes that may have changed.
     1343     2608        */
     1344     2609                 %EJECT;
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:254  
     1345     2610    1   IREL_CLEANUP: PROC;

   2610  1 001464   200042 741300       IREL_CLEANUP STX1  ! ACCT$+6,,AUTO

     1346     2611    2          DCL I SBIN;
     1347     2612        /* */
     1348     2613    2          CODE19$=FIT$;

   2613  1 001465   200021 236100                    LDQ     FIT$,,AUTO
         1 001466   200027 756100                    STQ     CODE19$,,AUTO

     1349     2614    2          CALL FMO$LOCCODP(CODE19$, 19);

   2614  1 001467   000014 236000 2                  LDQ     12
         1 001470   200045 756100                    STQ     I+2,,AUTO
         1 001471   200027 630500                    EPPR0   CODE19$,,AUTO
         1 001472   200044 450500                    STP0    I+1,,AUTO
         1 001473   200044 630500                    EPPR0   I+1,,AUTO
         1 001474   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001475   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001476   000000 011000                    NOP     0

     1350     2615
     1351     2616    2          NEWCODE$=FPARAM$;

   2616  1 001477   200022 236100                    LDQ     FPARAM$,,AUTO
         1 001500   200032 756100                    STQ     NEWCODE$,,AUTO

     1352     2617    2          CALL FMO$LOCCODP(NEWCODE$, 19);

   2617  1 001501   000014 236000 2                  LDQ     12
         1 001502   200045 756100                    STQ     I+2,,AUTO
         1 001503   200032 630500                    EPPR0   NEWCODE$,,AUTO
         1 001504   200044 450500                    STP0    I+1,,AUTO
         1 001505   200044 630500                    EPPR0   I+1,,AUTO
         1 001506   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001507   000000 701000 xent               TSX1    FMO$LOCCODP
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:255  
         1 001510   000000 011000                    NOP     0

     1353     2618
     1354     2619    2          N=0;

   2619  1 001511   200026 450100                    STZ     N,,AUTO

     1355     2620    2          I=0;

   2620  1 001512   200043 450100                    STZ     I,,AUTO

     1356     2621    3          DO UNTIL(N >= CODE19.NKEYS);

     1357     2622    3             CODE19.K.UNIQUE(I)=NEWCODE$->CODE19.K.UNIQUE(I);

   2622  1 001513   200043 236100                    LDQ     I,,AUTO
         1 001514   000022 402007                    MPY     18,DL
         1 001515   000000 116003                    CMPQ    0,DU
         1 001516   001520 605000 1                  TPL     s:2622+5
         1 001517   000044 036003                    ADLQ    36,DU
         1 001520   200044 756100                    STQ     I+1,,AUTO
         1 001521   200043 236100                    LDQ     I,,AUTO
         1 001522   000022 402007                    MPY     18,DL
         1 001523   000000 116003                    CMPQ    0,DU
         1 001524   001526 605000 1                  TPL     s:2622+11
         1 001525   000044 036003                    ADLQ    36,DU
         1 001526   200032 470500                    LDP0    NEWCODE$,,AUTO
         1 001527   200044 235100                    LDA     I+1,,AUTO
         1 001530   200027 471500                    LDP1    CODE19$,,AUTO
         1 001531   003106 060505                    CSL     bolr='003'O
         1 001532   000001 010001                    BDSC    1,A,PR0                  by=0,bit=1,n=1
         1 001533   100001 010001                    BDSC    1,Q,PR1                  by=0,bit=1,n=1

     1358     2623    3             IF CODE19.K.KEYEND(I) THEN

   2623  1 001534   200043 236100                    LDQ     I,,AUTO
         1 001535   000022 402007                    MPY     18,DL
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:256  
         1 001536   000000 116003                    CMPQ    0,DU
         1 001537   001541 605000 1                  TPL     s:2623+5
         1 001540   000044 036003                    ADLQ    36,DU
         1 001541   200027 470500                    LDP0    CODE19$,,AUTO
         1 001542   000000 066506                    CMPB    filb='0'B
         1 001543   000001 000001                    BDSC    1,Q,PR0                  by=0,bit=0,n=1
         1 001544   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 001545   001547 600000 1                  TZE     s:2625

     1359     2624    3                N=N+1;

   2624  1 001546   200026 054100                    AOS     N,,AUTO

     1360     2625    3             I=I+1;

   2625  1 001547   200043 054100                    AOS     I,,AUTO

     1361     2626    3          END;  /* UNTIL */

   2626  1 001550   200026 236100                    LDQ     N,,AUTO
         1 001551   001513 604000 1                  TMI     s:2622
         1 001552   000000 116100                    CMPQ    0,,PR0
         1 001553   001513 602000 1                  TNC     s:2622

     1362     2627
     1363     2628    2          CODE20$=FIT$;

   2628  1 001554   200021 236100                    LDQ     FIT$,,AUTO
         1 001555   200030 756100                    STQ     CODE20$,,AUTO

     1364     2629    2          CALL FMO$LOCCODP(CODE20$, 20);

   2629  1 001556   000016 236000 2                  LDQ     14
         1 001557   200045 756100                    STQ     I+2,,AUTO
         1 001560   200030 631500                    EPPR1   CODE20$,,AUTO
         1 001561   200044 451500                    STP1    I+1,,AUTO
         1 001562   200044 630500                    EPPR0   I+1,,AUTO
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:257  
         1 001563   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001564   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001565   000000 011000                    NOP     0

     1365     2630    2          CODE20.ALTBLD=IRKEYS.ALTBLD;

   2630  1 001566   200030 470500                    LDP0    CODE20$,,AUTO
         1 001567   200031 471500                    LDP1    ALTKEY$,,AUTO
         1 001570   100002 236100                    LDQ     2,,PR1
         1 001571   000001 676100                    ERQ     1,,PR0
         1 001572   400000 376003                    ANQ     -131072,DU
         1 001573   000001 656100                    ERSQ    1,,PR0

     1366     2631
     1367     2632    3          DO I=0 TO IRKEYS.NKEYS-1;

   2632  1 001574   200043 450100                    STZ     I,,AUTO
         1 001575   001645 710000 1                  TRA     s:2637+1

     1368     2633    3             CODE20.K.TDALVL(I)=IRKEYS.K.TDALVL(I);

   2633  1 001576   200043 236100                    LDQ     I,,AUTO
         1 001577   000003 402007                    MPY     3,DL
         1 001600   000000 620006                    EAX0    0,QL
         1 001601   200043 236100                    LDQ     I,,AUTO
         1 001602   000007 402007                    MPY     7,DL
         1 001603   200031 470500                    LDP0    ALTKEY$,,AUTO
         1 001604   200030 471500                    LDP1    CODE20$,,AUTO
         1 001605   000003 236106                    LDQ     3,QL,PR0
         1 001606   100002 676110                    ERQ     2,X0,PR1
         1 001607   777000 376003                    ANQ     -512,DU
         1 001610   100002 656110                    ERSQ    2,X0,PR1

     1369     2634    3             CODE20.K.TDA(I)=IRKEYS.K.TDA(I);

   2634  1 001611   200043 236100                    LDQ     I,,AUTO
         1 001612   000007 402007                    MPY     7,DL
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:258  
         1 001613   200031 470500                    LDP0    ALTKEY$,,AUTO
         1 001614   200030 471500                    LDP1    CODE20$,,AUTO
         1 001615   000003 236106                    LDQ     3,QL,PR0
         1 001616   100002 676110                    ERQ     2,X0,PR1
         1 001617   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001620   100002 656110                    ERSQ    2,X0,PR1

     1370     2635    3             CODE20.K.FDA(I)=IRKEYS.K.FDA(I);

   2635  1 001621   200043 236100                    LDQ     I,,AUTO
         1 001622   000007 402007                    MPY     7,DL
         1 001623   200031 470500                    LDP0    ALTKEY$,,AUTO
         1 001624   200030 471500                    LDP1    CODE20$,,AUTO
         1 001625   000007 236106                    LDQ     7,QL,PR0
         1 001626   000011 736000                    QLS     9
         1 001627   100003 676110                    ERQ     3,X0,PR1
         1 001630   000017 376000 2                  ANQ     15
         1 001631   100003 656110                    ERSQ    3,X0,PR1

     1371     2636    3             CODE20.K.LDA(I)=IRKEYS.K.LDA(I);

   2636  1 001632   200043 236100                    LDQ     I,,AUTO
         1 001633   000007 402007                    MPY     7,DL
         1 001634   200031 470500                    LDP0    ALTKEY$,,AUTO
         1 001635   200030 471500                    LDP1    CODE20$,,AUTO
         1 001636   000002 736000                    QLS     2
         1 001637   000000 635010                    EAA     0,X0
         1 001640   000020 731000                    ARS     16
         1 001641   000105 100506                    MLR     fill='000'O
         1 001642   000011 200003                    ADSC9   9,Q,PR0                  cn=1,n=3
         1 001643   100003 600003                    ADSC9   3,A,PR1                  cn=3,n=3

     1372     2637    3          END;  /* DO I */

   2637  1 001644   200043 054100                    AOS     I,,AUTO
         1 001645   200031 470500                    LDP0    ALTKEY$,,AUTO
         1 001646   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:259  
         1 001647   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001650   200043 116100                    CMPQ    I,,AUTO
         1 001651   001576 605400 1                  TPNZ    s:2633

     1373     2638
     1374     2639    2          RETURN;

   2639  1 001652   200042 221300                    LDX1  ! ACCT$+6,,AUTO
         1 001653   000001 702211                    TSX2  ! 1,X1

FMQ$E$CLSREL
 Sect OctLoc
   0     000   061521 002332                                                    1...

(unnamed)
 Sect OctLoc
   0     001   101114 124113   105131 040040   072123 131123                    ALTKEY  :SYS

(unnamed)
 Sect OctLoc
   2     000   000003 006000   000002 006000   000000 006003   052040 040040    ............*
   2     004   777777 767777   743777 777777   700777 777777   777377 777777    ................
   2     010   000004 006000   000005 006000   000012 006000   000000 000023    ................
   2     014   000013 006000   000000 000024   000015 006000   777777 777000    ................
     1375     2640    2          END IREL_CLEANUP;
     1376     2641    1          END FMQ$RELSTARF;

PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:260  
--  Include file information  --

   F_ERRORS_C.:E05TOU  is referenced.
   FM_FIELD_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   FK_DATA_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMQ$RELSTARF.
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:261  

 **** Variables and constants ****

  ****  Section 000 RoData FMQ$RELSTARF

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 FMQ$E$CLSREL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    34-0-0/w PTR         r     1 ACCT$                     33-0-0/w UBIN        r     1 ACCTX
    16-0-0/b BIT         r     1 ALLFILES                  31-0-0/w PTR         r     1 ALTKEY$
    17-0-0/b BIT         r     1 BFR                       20-0-0/b BIT         r     1 BFR1
    11-0-0/w PTR         r     1 BUF$                      24-0-0/w SBIN        r     1 BUFNO
    15-0-0/w PTR         r     1 CFU$                      25-0-0/w PTR         r     1 CODE$
    27-0-0/w PTR         r     1 CODE19$                   30-0-0/w PTR         r     1 CODE20$
     5-0-0/w SBIN        r     1 DA                        10-0-0/w STRC        r     1 EXTNT
    21-0-0/w PTR         r     1 FIT$                      10-0-0/w SBIN        r     1 FITDA
    22-0-0/w PTR         r     1 FPARAM$                    6-0-0/w SBIN        r     1 I
    43-0-0/w SBIN        r     1 I                         23-0-0/w UBIN        r     1 IORG
     3-0-0/w PTR         r     1 JDCB$                     13-0-0/w PTR         r     1 KEY$
     7-0-0/w SBIN        r     1 LCDA                      26-0-0/w SBIN        r     1 N
    14-0-0/w PTR         r     1 NAME$                     32-0-0/w PTR         r     1 NEWCODE$
    12-0-0/w PTR         r     1 SEG$                       4-0-0/w PTR         r     1 UJIT$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$PS1$                     0-0-0/w PTR         r     1 B$ROSEG$
     0-0-0/w PTR         r     1 F$CFU$
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:262  
     0-0-0/c CHAR        r     1 FM_STARCHARS(0:0)
     0-0-0/w UBIN        r     1 FM_SYSSETX                 0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w PTR         r     1 B$RODCB$(0:0)
     0-0-0/d STRC(3024)  r     1 B$ROSEG                    0-0-0/w STRC(576)   r     1 CODE01
     0-0-0/w STRC(135)   r     1 CODE02                     0-0-0/w STRC(324)   r     1 CODE03
     0-0-0/w STRC(54)    r     1 CODE19                     0-0-0/w STRC(180)   r     1 CODE20
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(4572)  r     1 FITALTKEYS
     0-0-0/d STRC(37080) r     1 FKA_ALTKEYS_BFR            0-0-0/w STRC(288)   r     1 FM$CFU
     0-0-0/w STRC(288)   r     1 FM$CFUA                    0-0-0/c ASTR(27)    r     1 FM$CFUN
     0-0-0/w STRC(288)   r     1 FM$CFUX                    0-0-0/w STRC        r     1 FM$FDSEG
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/w ASTR(9)     r     1 FM$KEYENT
     0-0-0/w UBIN        r     1 FPARAM(0:1023)             0-0-0/w STRC(360)   r     1 IRKEYS
     0-0-0/c ACHR        r     1 MOVEN


   Procedure FMQ$RELSTARF requires 940 words for executable code.
   Procedure FMQ$RELSTARF requires 42 words of local(AUTO) storage.

    No errors detected in file FMQ$DIR.:E05TSI    .
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:263  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:264  
          MINI XREF LISTING

ACCT$
      2174**DCL      2409<<ASSIGN   2410>>ASSIGN
ACCTX
      2173**DCL      2406<<ASSIGN   2407>>IF       2408<<ASSIGN   2409>>ASSIGN
ALLFILES
      2160**DCL      2180<<ASSIGN   2202<<ASSIGN   2208<<ASSIGN   2259>>IF
ALTKEY$
      2171**DCL      2027--IMP-PTR  2532<>CALL     2533>>ASSIGN   2535>>ASSIGN   2536>>ASSIGN   2561<<ASSIGN
      2564>>ASSIGN   2565>>ASSIGN   2566>>ASSIGN   2567>>ASSIGN   2588>>ASSIGN   2591<>CALL     2630>>ASSIGN
      2632>>DOINDEX  2633>>ASSIGN   2634>>ASSIGN   2635>>ASSIGN   2636>>ASSIGN
ALTKEYS
      2336**PROC     2217--CALL
B$JIT.CHECK_CFU
       510**DCL      2388<<ASSIGN
B$JIT.DCB$
       508**DCL      2250<<ASSIGN   2251>>ASSIGN   2342<<ASSIGN   2343>>ASSIGN
B$JIT.ERR
       418**DCL      2287<<ASSIGN   2308>>IF       2322<<ASSIGN   2477<<ASSIGN
B$JIT.ERR.MID
       419**DCL       419--REDEF
B$JIT.STAR
       508**DCL      2258--DOINDEX
B$JIT.STAR.DA
       508**DCL      2259>>IF       2265>>ASSIGN   2266<<ASSIGN   2272>>ASSIGN   2273<<ASSIGN
B$JIT.SYSID
       418**DCL      2274>>ASSIGN   2280>>ASSIGN
B$JIT$
      2130**DCL       413--IMP-PTR  2179>>ASSIGN   2212>>ASSIGN   2250>>ASSIGN   2251>>ASSIGN   2287>>ASSIGN
      2308>>IF       2322>>ASSIGN   2342>>ASSIGN   2343>>ASSIGN   2388>>ASSIGN   2477>>ASSIGN
B$PS0$
      2131**DCL      2203>>ASSIGN
B$PS1$
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:265  
      2132**DCL      2034--IMP-PTR  2342>>ASSIGN   2345>>DOCASE   2375>>ASSIGN   2382>>ASSIGN   2386>>ASSIGN
      2416>>ASSIGN   2456>>ASSIGN   2468>>IF       2469>>IF       2512>>ASSIGN   2514>>ASSIGN
B$RODCB$
        75**DCL      2342>>ASSIGN
B$ROSEG.DCBPTR$
        39**DCL      2342>>ASSIGN
B$ROSEG$
      2133**DCL      2342>>ASSIGN   2533>>ASSIGN   2561>>ASSIGN
BFR
      2161**DCL      2294<<ASSIGN   2300>>ASSIGN   2302<<ASSIGN
BFR1
      2162**DCL      2295<<ASSIGN   2301>>ASSIGN   2303<<ASSIGN
BUF$
      2155**DCL      2097--IMP-PTR  2284<>CALL     2313>>ASSIGN   2414<>CALL     2416>>ASSIGN   2417>>ASSIGN
      2486<>CALL     2487>>ASSIGN
BUFNO
      2166**DCL      2413<<ASSIGN   2414<>CALL     2471<<ASSIGN   2472<>CALL     2485<<ASSIGN   2486<>CALL
      2494<>CALL
CFU$
      2159**DCL      2077--IMP-PTR  2386<<ASSIGN   2387>>ASSIGN   2390>>DOWHILE  2391<<ASSIGN   2391>>ASSIGN
      2394>>ASSIGN   2397>>ASSIGN   2405<<ASSIGN   2406>>ASSIGN   2408>>ASSIGN
CLOSE
      2454**PROC     2350--CALL
CODE$
      2167**DCL      2054--IMP-PTR  2058--IMP-PTR  2062--IMP-PTR  2419<<ASSIGN   2420<>CALL     2421>>ASSIGN
      2423<<ASSIGN   2424<>CALL     2425>>ASSIGN   2427<<ASSIGN   2428<>CALL     2429>>ASSIGN   2430>>ASSIGN
      2431>>ASSIGN   2529<<ASSIGN   2530<>CALL     2531>>ASSIGN   2535>>ASSIGN   2584<<ASSIGN   2585<>CALL
      2587>>ASSIGN   2588>>ASSIGN
CODE01.HASH
      2054**DCL      2421>>ASSIGN
CODE01.XTNT
      2054**DCL      2055--REDEF
CODE02.SPARE
      2058**DCL      2425>>ASSIGN
CODE03.DESC
      2062**DCL      2431>>ASSIGN
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:266  
CODE03.ORG
      2062**DCL      2429>>ASSIGN
CODE03.XTNSIZE
      2065**DCL      2430>>ASSIGN
CODE19
      2069**DCL      2555<>CALL
CODE19.K.KEYEND
      2069**DCL      2623>>IF
CODE19.K.UNIQUE
      2069**DCL      2622<<ASSIGN   2622>>ASSIGN
CODE19.NKEYS
      2069**DCL      2621>>DOUNTIL
CODE19$
      2169**DCL      2069--IMP-PTR  2553<<ASSIGN   2554<>CALL     2555>>CALL     2613<<ASSIGN   2614<>CALL
      2621>>DOUNTIL  2622>>ASSIGN   2623>>IF
CODE20.ALTBLD
      2072**DCL      2559>>ASSIGN   2630<<ASSIGN
CODE20.K.FDA
      2073**DCL      2566>>ASSIGN   2635<<ASSIGN
CODE20.K.LDA
      2073**DCL      2567>>ASSIGN   2636<<ASSIGN
CODE20.K.TDA
      2072**DCL      2565>>ASSIGN   2634<<ASSIGN
CODE20.K.TDALVL
      2072**DCL      2564>>ASSIGN   2633<<ASSIGN
CODE20.NKEYS
      2072**DCL      2563>>DOINDEX
CODE20$
      2170**DCL      2072--IMP-PTR  2557<<ASSIGN   2558<>CALL     2559>>ASSIGN   2563>>DOINDEX  2564>>ASSIGN
      2565>>ASSIGN   2566>>ASSIGN   2567>>ASSIGN   2628<<ASSIGN   2629<>CALL     2630>>ASSIGN   2633>>ASSIGN
      2634>>ASSIGN   2635>>ASSIGN   2636>>ASSIGN
DA
      2148**DCL      2272<<ASSIGN   2277>>DOWHILE  2279<>CALL     2284<>CALL     2310>>ASSIGN   2312>>ASSIGN
      2313<<ASSIGN   2510<>CALL     2512>>ASSIGN
ERR IN PROCEDURE CLOSE
      2495**LABEL    2458--CALLALT  2460--CALLALT  2474--GOTO     2486--CALLALT
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:267  
ERR IN PROCEDURE INDEXED_SETUP
      2539**LABEL    2532--CALLALT
ERR IN PROCEDURE IREL_SETUP
      2571**LABEL    2555--CALLALT
ERR IN PROCEDURE OPEN
      2433**LABEL    2414--CALLALT
ERR IN PROCEDURE RELSTARF
      2320**LABEL    2267--CALLALT  2284--CALLALT  2298--CALLALT  2309--GOTO     2315--CALLALT
EXTEND
      2506**PROC     2353--CALL
EXTNT
      2152**DCL      2315<>CALL
EXTNT.DA
      2154**DCL      2310<<ASSIGN
EXTNT.SIZ
      2153**DCL      2311<<ASSIGN
F$CFU$
      2134**DCL      2092--IMP-PTR  2390>>DOWHILE  2391>>ASSIGN   2394>>ASSIGN   2408>>ASSIGN   2409>>ASSIGN
F$DCB.ACCT
      1981**DCL      2338>>IF       2401<<ASSIGN   2410<<ASSIGN
F$DCB.ACS
      1988**DCL      2381<<ASSIGN
F$DCB.ACTPOS
      1996**DCL      1996--REDEF
F$DCB.ALTKEYX
      1994**DCL      2533<<ASSIGN   2561>>ASSIGN   2592<<ASSIGN
F$DCB.ARS
      1971**DCL      1971--REDEF
F$DCB.ASN
      1986**DCL      2376<<ASSIGN
F$DCB.ATTR
      1989**DCL      1990--REDEF
F$DCB.BFR
      2015**DCL      2254<<ASSIGN   2294>>ASSIGN   2296<<ASSIGN   2300<<ASSIGN
F$DCB.BFR1
      2016**DCL      2255<<ASSIGN   2295>>ASSIGN   2297<<ASSIGN   2301<<ASSIGN
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:268  
F$DCB.BORROW
      2004**DCL      2004--REDEF    2004--REDEF    2004--REDEF
F$DCB.CFU$
      2005**DCL      2375<<ASSIGN   2387<<ASSIGN   2405>>ASSIGN   2464>>ASSIGN   2466>>ASSIGN   2466>>ASSIGN
      2468>>IF       2536>>ASSIGN   2559>>ASSIGN
F$DCB.CRECX
      2007**DCL      2282<<ASSIGN
F$DCB.DCBNAME.L
      2018**DCL      2018--IMP-SIZ
F$DCB.DESC
      1978**DCL      2431<<ASSIGN
F$DCB.EOMCHAR
      1975**DCL      1975--REDEF
F$DCB.FCD
      1984**DCL      2252>>IF       2385<<ASSIGN
F$DCB.FFLG
      1975**DCL      2383<<ASSIGN
F$DCB.FLDID
      1999**DCL      1999--REDEF
F$DCB.FORM$
      1993**DCL      1993--REDEF
F$DCB.FSECT
      2009**DCL      2009--REDEF
F$DCB.FSN
      1986**DCL      1986--REDEF    1986--REDEF    1987--REDEF
F$DCB.FUN
      1985**DCL      2384<<ASSIGN
F$DCB.GTYP
      2000**DCL      2278<<ASSIGN   2304<<ASSIGN
F$DCB.HASH
      2008**DCL      2274<<ASSIGN   2280<<ASSIGN   2421<<ASSIGN
F$DCB.HEADER$
      1992**DCL      1992--REDEF
F$DCB.IASN
      2012**DCL      2377<<ASSIGN
F$DCB.IFMT
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:269  
      2011**DCL      2379<<ASSIGN
F$DCB.IORG
      2007**DCL      2378<<ASSIGN   2462>>ASSIGN   2463<<ASSIGN   2473<<ASSIGN   2484<<ASSIGN   2508>>ASSIGN
      2509<<ASSIGN   2511<<ASSIGN
F$DCB.IXTNSIZE
      1990**DCL      1990--REDEF
F$DCB.LASTSTA$
      1980**DCL      1980--REDEF
F$DCB.LVL
      2005**DCL      2005--REDEF
F$DCB.MEDIA
      2011**DCL      2380<<ASSIGN
F$DCB.NAME.C
      1980**DCL      1980--REDEF    2263<<ASSIGN   2264<<CALLBLT  2292<<ASSIGN   2338>>IF       2395<<ASSIGN
F$DCB.NAME.L
      1980**DCL      2262<<ASSIGN   2291<<ASSIGN   2396<<ASSIGN
F$DCB.NOEOF
      2001**DCL      2001--REDEF
F$DCB.NRECS
      1991**DCL      1991--REDEF
F$DCB.NRECX
      2010**DCL      2010--REDEF
F$DCB.OHDR
      2002**DCL      2002--REDEF
F$DCB.ORG
      1985**DCL      1985--REDEF    2429<<ASSIGN   2457>>IF       2489>>IF
F$DCB.PRECNO
      2008**DCL      2008--REDEF
F$DCB.RCSZ
      2013**DCL      2013--REDEF
F$DCB.RES
      1981**DCL      1981--REDEF
F$DCB.RPOS
      2002**DCL      2283<<ASSIGN
F$DCB.SETX
      1993**DCL      1993--REDEF    2256<<ASSIGN   2382<<ASSIGN
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:270  
F$DCB.SPARE
      1988**DCL      2425<<ASSIGN
F$DCB.STARF
      2000**DCL      2248>>IF       2281<<ASSIGN   2397<<ASSIGN   2399>>IF
F$DCB.TAB$
      1992**DCL      1993--REDEF
F$DCB.TDA
      2007**DCL      2007--REDEF
F$DCB.WSN
      1982**DCL      1982--REDEF
F$DCB.XTNSIZE
      1988**DCL      2430<<ASSIGN
FAF$GETGRAN
      2108**DCL-ENT  2510--CALL
FAG$REXT
      2109**DCL-ENT  2315--CALL
FAG$RFILE
      2110**DCL-ENT  2267--CALL     2298--CALL
FIT$
      2163**DCL      2417<<ASSIGN   2419>>ASSIGN   2423>>ASSIGN   2427>>ASSIGN   2487<<ASSIGN   2584>>ASSIGN
      2613>>ASSIGN   2628>>ASSIGN
FITALTKEYS.ALTBLD
      2021**DCL      2536>>ASSIGN
FITALTKEYS.NUMWRDS
      2021**DCL      2531>>ASSIGN   2587>>ASSIGN
FITDA
      2151**DCL      2152--REDEF    2265<<ASSIGN   2267<>CALL     2293<<ASSIGN   2298<>CALL
FKA_ALTKEYS_BFR.CFU$
      2037**DCL      2375>>ASSIGN   2386>>ASSIGN
FKA_ALTKEYS_BFR.CODE
      2039**DCL      2345>>DOCASE
FKA_ALTKEYS_BFR.DA
      2041**DCL      2512<<ASSIGN   2514<<ASSIGN
FKA_ALTKEYS_BFR.DCB#
      2035**DCL      2342>>ASSIGN
FKA_ALTKEYS_BFR.DELF
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:271  
      2047**DCL      2469>>IF
FKA_ALTKEYS_BFR.FPARAM
      2050**DCL      2416<<ASSIGN   2456--ASSIGN
FKA_ALTKEYS_BFR.RELG
      2045**DCL      2468>>IF
FKA_ALTKEYS_BFR.SETX
      2043**DCL      2382>>ASSIGN
FM$CFU.ACCTX
      2078**DCL      2078--REDEF    2406>>ASSIGN   2408>>ASSIGN
FM$CFU.ALTBLD
      2080**DCL      2536<<ASSIGN   2559<<ASSIGN
FM$CFU.FUN
      2077**DCL      2466<<ASSIGN   2466>>ASSIGN
FM$CFU.NAMEX
      2078**DCL      2390>>DOWHILE  2391>>ASSIGN   2394>>ASSIGN   2408>>ASSIGN
FM$CFU.NGAVAL
      2080**DCL      2468>>IF
FM$CFU.STARX.F
      2078**DCL      2397>>ASSIGN
FM$CFU.ULBLD
      2080**DCL      2464<<ASSIGN
FM$CFUA.ACCT
      2083**DCL      2410>>ASSIGN
FM$CFUN.C
      2089**DCL      2395>>ASSIGN
FM$CFUN.L
      2089**DCL      2089--IMP-SIZ  2395>>ASSIGN   2396>>ASSIGN
FM$CFUX.NAMES
      2092**DCL      2390>>DOWHILE
FM$FDSEG.FITSDA
      2105**DCL      2289>>IF       2293>>ASSIGN
FM$GRAN
      2097**DCL      2417--ASSIGN   2456--ASSIGN   2487--ASSIGN
FM$GRAN.FLINK
      2098**DCL      2313>>ASSIGN
FM$KEYENT.D
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:272  
      2101**DCL      2289>>IF
FM$KEYENT.KLB
      2101**DCL      2101--IMP-SIZ  2291>>ASSIGN   2292>>ASSIGN
FM$KEYENT.TXT
      2101**DCL      2292>>ASSIGN
FMC$CLR1
      2111**DCL-ENT  2279--CALL
FMD$REDBUF
      2112**DCL-ENT  2284--CALL
FMD$RELBUF
      2113**DCL-ENT  2268--CALL     2299--CALL     2314--CALL     2320--CALL     2321--CALL
FMD$WRTBUF
      2114**DCL-ENT  2494--CALL
FMG$IRSETUP
      2116**DCL-ENT  2555--CALL
FMG$NXTKEYNM
      2115**DCL-ENT  2288--CALL
FMM$SCRUB
      2117**DCL-ENT  2373--CALL
FMN$GETFIT
      2118**DCL-ENT  2414--CALL     2486--CALL
FMO$GETDOMAIN
      2119**DCL-ENT  2209--CALL
FMO$LOCCODP
      2120**DCL-ENT  2420--CALL     2424--CALL     2428--CALL     2530--CALL     2554--CALL     2558--CALL
      2585--CALL     2614--CALL     2617--CALL     2629--CALL
FMO$RELG
      2121**DCL-ENT  2472--CALL
FMP$CLSJ
      2122**DCL-ENT  2253--CALL
FMQ$E$CLSREL
      2142**DCL      2477>>ASSIGN
FMU$BLDALT
      2123**DCL-ENT  2465--CALL
FM_STARCHARS
      2136**DCL      2264>>CALLBLT
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:273  
FM_SYSSETX
      2135**DCL      2256>>ASSIGN
FPARAM
      2176**DCL      2416>>ASSIGN
FPARAM$
      2164**DCL      2176--IMP-PTR  2456<<ASSIGN   2529>>ASSIGN   2553>>ASSIGN   2557>>ASSIGN   2616>>ASSIGN
FSA$FSP
      2124**DCL-ENT  2591--CALL
FSA$GSP
      2125**DCL-ENT  2532--CALL
HFF$DSIZ
      2126**DCL-ENT  2198--CALL
HFF$NILERASE
      2127**DCL-ENT  2201--CALL
I
      2149**DCL      2198<>CALL     2199>>IF       2209<>CALL     2210>>IF       2258<<DOINDEX  2259>>IF
      2259>>IF       2259>>IF       2264>>CALLBLT  2265>>ASSIGN   2266>>ASSIGN   2288<>CALL     2563<<DOINDEX
      2564>>ASSIGN   2564>>ASSIGN   2565>>ASSIGN   2565>>ASSIGN   2566>>ASSIGN   2566>>ASSIGN   2567>>ASSIGN
      2567>>ASSIGN
I IN PROCEDURE IREL_CLEANUP
      2611**DCL      2620<<ASSIGN   2622>>ASSIGN   2622>>ASSIGN   2623>>IF       2625<<ASSIGN   2625>>ASSIGN
      2632<<DOINDEX  2633>>ASSIGN   2633>>ASSIGN   2634>>ASSIGN   2634>>ASSIGN   2635>>ASSIGN   2635>>ASSIGN
      2636>>ASSIGN   2636>>ASSIGN
INDEXED_CLEANUP
      2582**PROC     2490--CALL
INDEXED_SETUP
      2527**PROC     2458--CALL
IORG
      2165**DCL      2462<<ASSIGN   2473>>ASSIGN   2484>>ASSIGN   2508<<ASSIGN   2511>>ASSIGN
IREL_CLEANUP
      2610**PROC     2492--CALL
IREL_SETUP
      2551**PROC     2460--CALL
IRKEYS.ALTBLD
      2027**DCL      2630>>ASSIGN
IRKEYS.K.FDA
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:274  
      2030**DCL      2566<<ASSIGN   2635>>ASSIGN
IRKEYS.K.LDA
      2031**DCL      2567<<ASSIGN   2636>>ASSIGN
IRKEYS.K.TDA
      2028**DCL      2565<<ASSIGN   2634>>ASSIGN
IRKEYS.K.TDALVL
      2028**DCL      2564<<ASSIGN   2633>>ASSIGN
IRKEYS.NKEYS
      2027**DCL      2632>>DOINDEX
JDCB$
      2146**DCL      1971--IMP-PTR  2251<<ASSIGN   2252>>IF       2254>>ASSIGN   2255>>ASSIGN   2256>>ASSIGN
      2262>>ASSIGN   2263>>ASSIGN   2264>>CALLBLT  2274>>ASSIGN   2278>>ASSIGN   2280>>ASSIGN   2281>>ASSIGN
      2282>>ASSIGN   2283>>ASSIGN   2291>>ASSIGN   2292>>ASSIGN   2294>>ASSIGN   2295>>ASSIGN   2296>>ASSIGN
      2297>>ASSIGN   2300>>ASSIGN   2301>>ASSIGN   2304>>ASSIGN   2343<<ASSIGN   2373<>CALL     2375>>ASSIGN
      2376>>ASSIGN   2377>>ASSIGN   2378>>ASSIGN   2379>>ASSIGN   2380>>ASSIGN   2381>>ASSIGN   2382>>ASSIGN
      2383>>ASSIGN   2384>>ASSIGN   2385>>ASSIGN   2387>>ASSIGN   2395>>ASSIGN   2396>>ASSIGN   2397>>ASSIGN
      2399>>IF       2401>>ASSIGN   2405>>ASSIGN   2410>>ASSIGN   2421>>ASSIGN   2425>>ASSIGN   2429>>ASSIGN
      2430>>ASSIGN   2431>>ASSIGN   2457>>IF       2462>>ASSIGN   2463>>ASSIGN   2464>>ASSIGN   2466>>ASSIGN
      2466>>ASSIGN   2468>>IF       2473>>ASSIGN   2484>>ASSIGN   2489>>IF       2508>>ASSIGN   2509>>ASSIGN
      2511>>ASSIGN   2533>>ASSIGN   2536>>ASSIGN   2559>>ASSIGN   2561>>ASSIGN   2592>>ASSIGN
KEY$
      2157**DCL      2101--IMP-PTR  2288<>CALL     2289>>IF       2291>>ASSIGN   2292>>ASSIGN   2292>>ASSIGN
LCDA
      2150**DCL      2275<<ASSIGN   2284<>CALL     2312<<ASSIGN
MOVEN
      2177**DCL      2535<<ASSIGN   2535>>ASSIGN   2588<<ASSIGN   2588>>ASSIGN
N
      2168**DCL      2177--IMP-SIZ  2531<<ASSIGN   2532<>CALL     2534<<ASSIGN   2534>>ASSIGN   2535>>ASSIGN
      2535>>ASSIGN   2587<<ASSIGN   2588>>ASSIGN   2588>>ASSIGN   2590<<ASSIGN   2590>>ASSIGN   2591<>CALL
      2619<<ASSIGN   2621>>DOUNTIL  2624<<ASSIGN   2624>>ASSIGN
NAME$
      2158**DCL      2089--IMP-PTR  2394<<ASSIGN   2395>>ASSIGN   2395>>ASSIGN   2396>>ASSIGN
NEWCODE$
      2172**DCL      2616<<ASSIGN   2617<>CALL     2622>>ASSIGN
NONE IN PROCEDURE EXTEND
      2514**LABEL    2510--CALLALT
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:275  
NXTERR IN PROCEDURE RELSTARF
      2308**LABEL    2288--CALLALT
OPEN
      2371**PROC     2347--CALL
PARTREL
      2208**LABEL    2201--CALLALT
RELSTARF
      2245**PROC     2181--CALL     2214--CALL
SEG$
      2156**DCL      2104--IMP-PTR  2288<>CALL     2289>>IF       2293>>ASSIGN
S_CUN
      2137**DCL      2204>>IF
UJIT$
      2147**DCL      2179<<ASSIGN   2203<<ASSIGN   2212<<ASSIGN   2259>>IF       2265>>ASSIGN   2266>>ASSIGN
      2272>>ASSIGN   2273>>ASSIGN   2274>>ASSIGN   2280>>ASSIGN
UMD$QDRIB
      2128**DCL-ENT  2249--CALL
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:276  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #006=FMQ$RELSTARF File=FMQ$DIR.:E05TSI                             TUE 07/29/97 17:02 Page:277  
              MINI UREF LISTING

B$ROAVAIL      78**DCL
FMQ$RELSTARF      26**PROC
FMQ$RELSTARFP    2197**ENTRY
