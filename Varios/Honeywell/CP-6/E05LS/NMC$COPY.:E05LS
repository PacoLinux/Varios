VERSION E05

PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:1    
        1        1        /*M* NMC$COPY - Perform MIRROR COPY command.                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DFC=YES, DMC=YES, EDMC=YES                                    */
        8        8        /*F*
        9        9        NAME:           NMC$COPY
       10       10
       11       11        PURSPOSE:       To perform the MIRROR COPY command.
       12       12        */
       13       13        /*D*
       14       14        NAME:           NMC$COPY
       15       15
       16       16        CALL:           CALL NMC$COPY ALTRET ( error ) ;
       17       17
       18       18        PARAMETERS:
       19       19        */
       20       20        /*K*
       21       21        error           is a statement label to which NMC$COPY will
       22       22                make an altreturn if an error is detected.
       23       23        */
       24       24        /*D*
       25       25
       26       26        DESCRIPTION:
       27       27
       28       28        The NMC$COPY procedure is used to make a mirrored copy of
       29       29        a Mirrored Disk device.
       30       30
       31       31        DPxx and DPyy must be a Mirrored Disk devices.  DPxx must be
       32       32        operational.  DPyy must be failed.
       33       33
       34       34        DPyy is made %NI_MIRROR_REST.  Then DPxx is copied over DPyy.
       35       35
       36       36        The COPY will be done GRANS granules at a time.  There
       37       37        will be a delay of PAUSE seconds within the copy loop.
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:2    
       38       38
       39       39        If the COPY is successful, DPyy will be set to %NI_MIRROR_OPER.
       40       40        If the COPY fails for any reason, DPyy will be set to
       41       41        %NI_MIRROR_FAIL.
       42       42
       43       43        */
       44       44        %EJECT ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:3    
       45       45        NMC$COPY:     PROC      ALTRET ;
       46       46        /*
       47       47                        Includes
       48       48        */
       49       49        %INCLUDE                CP_6 ;
       50     5608        %INCLUDE                FM$GRAN ;
       51     5677        %INCLUDE                NI$TABLES ;
       52     5893        %INCLUDE                NI_DATA_C ;
       53     6006        %INCLUDE                NM_MACRO_M ;
       54     7411        %INCLUDE                NM_PERR_C ;
       55     7488        %INCLUDE                XU_MACRO_C ;
       56    10594        /*
       57    10595                        Entries
       58    10596        */
       59    10597    1   DCL 1 NME$ERRMSG        ENTRY(6) ;
       60    10598    1   DCL 1 NMO$DEV           ENTRY(2) ALTRET ;
       61    10599    1   DCL 1 NMO$OPTIONS       ENTRY(2) ALTRET ;
       62    10600    1   DCL 1 NMO$REPORT        ENTRY(1) ALTRET ;
       63    10601    1   DCL 1 NMU$ABORT         ENTRY(2) ALTRET ;
       64    10602    1   DCL 1 NMU$CHGSTATE      ENTRY(3) ALTRET ;
       65    10603    1   DCL 1 NMU$FDS           ENTRY    ALTRET ;
       66    10604    1   DCL 1 NMU$FGRAN         ENTRY(2) ;
       67    10605    1   DCL 1 NMU$GDS           ENTRY    ALTRET ;
       68    10606    1   DCL 1 NMU$LGRAN         ENTRY(2) ;
       69    10607    1   DCL 1 NMU$LOCK          ENTRY(1) ALTRET ;
       70    10608    1   DCL 1 NMU$READ          ENTRY(3) ALTRET ;
       71    10609    1   DCL 1 NMU$UNLOCK        ENTRY(1) ALTRET ;
       72    10610    1   DCL 1 NMU$WAIT          ENTRY    ALTRET ;
       73    10611    1   DCL 1 NMU$WRITE         ENTRY(3) ALTRET ;
       74    10612    1   DCL 1 NMV$CHGSTATE      ENTRY(1) ALTRET ;
       75    10613    1   DCL 1 NMV$DGT           ENTRY    ALTRET ;
       76    10614    1   DCL 1 NMV$MIRRORED      ENTRY(1) ALTRET ;
       77    10615    1   DCL 1 NMV$PACKSIZE      ENTRY    ALTRET ;
       78    10616    1   DCL 1 NMV$PAIR          ENTRY    ALTRET ;
       79    10617    1   DCL 1 NMV$STATE         ENTRY(3) ALTRET ;
       80    10618    1   DCL 1 NMV$VSN           ENTRY    ALTRET ;
       81    10619        /*
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:4    
       82    10620                        Variables
       83    10621        */
       84    10622                                %B$ALT ( NAME =
       85    10623              B$ALT             , STCLASS = BASED
       86    10624                                                                        ) ;
       87    10632                                %B$TCB ( NAME =
       88    10633              B$TCB             , STCLASS = "BASED(B$TCB$)"
       89    10634                                                                        ) ;
       90    10637    1   DCL 1 B$TCB$            PTR SYMREF ;
       91    10638                                %NI$DCT ( NAME =
       92    10639              DCT               , STCLASS = BASED
       93    10640                                                                        ) ;
       94    10688    1   DCL 1 FGRAN             SBIN WORD ALIGNED AUTO ;
       95    10689                                %FM$VID ( FM$VID =
       96    10690              FM$VID            , BASED=BASED
       97    10691                                                                        ) ;
       98    10697    1   DCL 1 LGRAN             SBIN WORD ALIGNED AUTO ;
       99    10698    1   DCL 1 NGRAN             SBIN WORD ALIGNED AUTO ;
      100    10699                                %NMD_PIT ( FPTN =
      101    10700              NMD_PIT           , STCLASS=SYMREF
      102    10701                                                                        ) ;
      103    11154                                %PARSE$OUT ( NAME =
      104    11155              OUT               , STCLASS ="BASED(XUG_GETCMD.OUT$)"
      105    11156                                                                        ) ;
      106    11201                                %FPT_TIME ( FPTN =
      107    11202              TIME              , STCLASS = CONSTANT
      108    11203                                , DEST = UTS
      109    11204                                , SOURCE = CLOCK
      110    11205                                , TSTAMP = UTS
      111    11206                                                                        ) ;
      112    11225    1   DCL 1 UTS               UBIN WORD ALIGNED STATIC ;
      113    11226                                %NMD_VID ( FPTN =
      114    11227              VID               , STCLASS = BASED
      115    11228                                                                        ) ;
      116    11245    1   DCL 1 VSIZE             SBIN WORD ALIGNED AUTO ;
      117    11246                                %VLP_VECTOR ( FPTN =
      118    11247              V_                , STCLASS = BASED
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:5    
      119    11248                                                                        ) ;
      120    11263                                %XUG_GETCMD ( NAME =
      121    11264              XUG_GETCMD        , STCLASS = SYMREF
      122    11265                                                                        ) ;
      123    11603        %EJECT ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:6    
      124    11604        /*
      125    11605        Process the devices and options specified on the command.
      126    11606        */
      127    11607    1           CALL NMO$DEV     ( 0, OUT.SUBLK$(0) )   ALTRET ( ERROR ) ;
      128    11608    1           CALL NMO$DEV     ( 1, OUT.SUBLK$(1) )   ALTRET ( ERROR ) ;
      129    11609    1           CALL NMO$OPTIONS ( 2, OUT.NSUBLKS-1 )   ALTRET ( ERROR ) ;
      130    11610        /*
      131    11611        Verify that these devices are a Mirrored Disk pair with DPxx
      132    11612        operational and DPyy failed.  If they are, read the VIDs, verify
      133    11613        the VSNs, packsizes, and DGTs.
      134    11614        */
      135    11615    1           CALL NMV$MIRRORED ( 0 )                 ALTRET ( ERROR ) ;
      136    11616    1           CALL NMV$MIRRORED ( 1 )                 ALTRET ( ERROR ) ;
      137    11617    1           CALL NMV$PAIR                           ALTRET ( ERROR ) ;
      138    11618    1           CALL NMV$STATE ( 0, %NI_MIRROR_OPER )   ALTRET ( ERROR ) ;
      139    11619    1           CALL NMV$STATE ( 1, %NI_MIRROR_FAIL )   ALTRET ( ERROR ) ;
      140    11620
      141    11621    1           CALL NMU$READ  ( 0, 0, NMD_PIT.DEV.VID_(0) )
      142    11622    1                                                   ALTRET ( ERROR ) ;
      143    11623    1           CALL NMU$READ  ( 1, 0, NMD_PIT.DEV.VID_(1) )
      144    11624    1                                                   ALTRET ( ERROR ) ;
      145    11625
      146    11626    1           CALL NMV$VSN                            ALTRET ( ERROR ) ;
      147    11627    1           CALL NMV$PACKSIZE                       ALTRET ( ERROR ) ;
      148    11628    1           CALL NMV$DGT                            ALTRET ( ERROR ) ;
      149    11629
      150    11630        %EJECT ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:7    
      151    11631        /*
      152    11632        Entry point for COPY part of MIRROR operation.
      153    11633        */
      154    11634    1   NMC$KOPY:       ENTRY           ALTRET ;
      155    11635        /*
      156    11636        Get buffers to do COPY operation.
      157    11637        */
      158    11638    1           CALL NMU$GDS                            ALTRET ( ABORT ) ;
      159    11639        /*
      160    11640        Change state of DEV(1) to RESTORE so all future writes will be done
      161    11641        to that device.
      162    11642        */
      163    11643    1           CALL M$TIME       ( TIME )              ALTRET ( ALTERR ) ;
      164    11644    1           CALL NMU$CHGSTATE ( 1, %NI_MIRROR_REST, UTS )
      165    11645    1                                                   ALTRET ( ABORT ) ;
      166    11646        /*
      167    11647        Initialize the percentage completion report for this COPY operation.
      168    11648        */
      169    11649    1           CALL NMO$REPORT ( 0 ) ;
      170    11650        /*
      171    11651        Set flag to indicate that a COPY operation is in progress.
      172    11652        */
      173    11653    1           NMD_PIT.FLAGS.CIP# = '1'B ;
      174    11654        /*
      175    11655        Loop thru all granules on the Mirrored Disk device starting with the
      176    11656        second granule.  (First granule is granule 0.)
      177    11657        */
      178    11658    1           LGRAN = 0 ;
      179    11659    1           CALL NMU$FGRAN ( FGRAN, LGRAN ) ;
      180    11660    2           DO UNTIL ( FGRAN >= NMD_PIT.PACKSIZE ) ;
      181    11661        /*
      182    11662        Set up device logical address and size for this granule segment.
      183    11663        This segment may be up to GRANS granules in size.  The size will
      184    11664        be smaller if there are defective granule entries within this
      185    11665        segment.  In that case, the segment is shortened to end before
      186    11666        the first bad granule.
      187    11667        */
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:8    
      188    11668    2               CALL NMU$LGRAN ( FGRAN, LGRAN ) ;
      189    11669    2               NGRAN = LGRAN - FGRAN + 1 ;
      190    11670    2               VSIZE = ( NGRAN * %NMD#WORDS_PER_GRAN
      191    11671    2                               * %NMD#BYTES_PER_WORD ) - 1 ;
      192    11672
      193    11673    2               ADDR(NMD_PIT.DEV.BUF_(0))->V_.W1.VSIZE# = VSIZE ;
      194    11674
      195    11675    2               NMD_PIT.DEV.BUF_(1) = NMD_PIT.DEV.BUF_(0) ;
      196    11676        /*
      197    11677        Copy this granule segment from DEV(0) to DEV(1).
      198    11678        */
      199    11679    2               CALL NMU$LOCK    ( 0 )              ALTRET ( ABORT ) ;
      200    11680    2               IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.STATE ~=
      201    11681    2                   NMD_PIT.DEV.STATE(0)
      202    11682    3               THEN DO ;
      203    11683    3                   CALL NMV$CHGSTATE ( 0 )         ALTRET ( ABORT ) ;
      204    11684    3                   GOTO ERROR ;
      205    11685    3                   END ;
      206    11686    2               CALL NMU$READ    ( 0, FGRAN, NMD_PIT.DEV.BUF_(0) )
      207    11687    2                                                   ALTRET ( ABORT ) ;
      208    11688    2               CALL NMU$LOCK    ( 1 )              ALTRET ( ABORT ) ;
      209    11689    2               IF  NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.STATE ~=
      210    11690    2                   NMD_PIT.DEV.STATE(1)
      211    11691    3               THEN DO ;
      212    11692    3                   CALL NMV$CHGSTATE ( 1 )         ALTRET ( ABORT ) ;
      213    11693    3                   GOTO ERROR ;
      214    11694    3                   END ;
      215    11695    2               CALL NMU$UNLOCK  ( 0 )              ALTRET ( ABORT ) ;
      216    11696    2               CALL NMU$WRITE   ( 1, FGRAN, NMD_PIT.DEV.BUF_(1) )
      217    11697    2                                                   ALTRET ( ABORT ) ;
      218    11698    2               CALL NMU$UNLOCK  ( 1 )              ALTRET ( ABORT ) ;
      219    11699        /*
      220    11700        Advance to next granule segment, report completion percentage, and
      221    11701        wait if specified.
      222    11702        */
      223    11703    2               CALL NMU$FGRAN ( FGRAN, LGRAN ) ;
      224    11704    2               IF  NMD_PIT.FLAGS.REPORT#
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:9    
      225    11705    2               THEN
      226    11706    2                   CALL NMO$REPORT ( FGRAN ) ;
      227    11707    2               IF  NMD_PIT.PAUSE# > 0
      228    11708    2               THEN
      229    11709    2                   CALL NMU$WAIT ;
      230    11710
      231    11711    2               END ; /* of COPY loop. */
      232    11712        /*
      233    11713        Release buffers used in COPY operation.
      234    11714        */
      235    11715    1           CALL NMU$FDS                            ALTRET ( ABORT ) ;
      236    11716        /*
      237    11717        Update VID on primary device.
      238    11718        */
      239    11719    1           CALL M$TIME      ( TIME )               ALTRET ( ALTERR ) ;
      240    11720    1           CALL NMU$LOCK    ( 0 )                  ALTRET ( ABORT ) ;
      241    11721    1           IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.STATE ~=
      242    11722    1               NMD_PIT.DEV.STATE(0)
      243    11723    2           THEN DO ;
      244    11724    2               CALL NMV$CHGSTATE ( 0 )             ALTRET ( ABORT ) ;
      245    11725    2               GOTO ERROR ;
      246    11726    2               END ;
      247    11727    1           CALL NMU$READ    ( 0, 0, NMD_PIT.DEV.VID_(0) )
      248    11728    1                                                   ALTRET ( ABORT ) ;
      249    11729
      250    11730    1           NMD_PIT.DEV.VID$(0)->FM$VID.MIRROR.C        = 'MIRROR  ' ;
      251    11731    1           NMD_PIT.DEV.VID$(0)->FM$VID.MIRROR.UTS      = UTS ;
      252    11732    1           NMD_PIT.DEV.VID$(0)->FM$VID.MIRROR.STATE(0) = %NI_MIRROR_OPER ;
      253    11733    1           NMD_PIT.DEV.VID$(0)->FM$VID.MIRROR.STATE(1) = %NI_MIRROR_OPER ;
      254    11734
      255    11735    1           CALL NMU$WRITE   ( 0, 0, NMD_PIT.DEV.VID_(0) )
      256    11736    1                                                   ALTRET ( ABORT ) ;
      257    11737    1           CALL NMU$UNLOCK  ( 0 )                  ALTRET ( ABORT ) ;
      258    11738        /*
      259    11739        Update VID on secondary device.
      260    11740        */
      261    11741    1           CALL NMU$LOCK    ( 1 )                  ALTRET ( ABORT ) ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:10   
      262    11742    1           IF  NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.STATE ~=
      263    11743    1               NMD_PIT.DEV.STATE(1)
      264    11744    2           THEN DO ;
      265    11745    2               CALL NMV$CHGSTATE ( 1 )             ALTRET ( ABORT ) ;
      266    11746    2               GOTO ERROR ;
      267    11747    2               END ;
      268    11748
      269    11749    1           NMD_PIT.DEV.VID$(1)->VID                    = NMD_PIT.DEV.VID$(0)->VID ;
      270    11750
      271    11751    1           NMD_PIT.DEV.VID$(1)->FM$VID.MIRROR.STATE(0) = %NI_MIRROR_OPER ;
      272    11752    1           NMD_PIT.DEV.VID$(1)->FM$VID.MIRROR.STATE(1) = %NI_MIRROR_OPER ;
      273    11753
      274    11754    1           CALL NMU$WRITE   ( 1, 0, NMD_PIT.DEV.VID_(1) )
      275    11755    1                                                   ALTRET ( ABORT ) ;
      276    11756    1           CALL NMU$UNLOCK  ( 1 )                  ALTRET ( ABORT ) ;
      277    11757        /*
      278    11758        Update the states of both the primary and secondary Mirrored Disk
      279    11759        devices to operational.
      280    11760        */
      281    11761    1           CALL NMU$CHGSTATE ( 0, %NI_MIRROR_OPER, UTS )
      282    11762    1                                                   ALTRET ( ABORT ) ;
      283    11763    1           CALL NMU$CHGSTATE ( 1, %NI_MIRROR_OPER, UTS )
      284    11764    1                                                   ALTRET ( ABORT ) ;
      285    11765        /*
      286    11766        Reset the flag indication that a COPY operation is in progress.
      287    11767        */
      288    11768    1           NMD_PIT.FLAGS.CIP# = '0'B ;
      289    11769        /*
      290    11770        Return to the calling procedure.
      291    11771        */
      292    11772    1           RETURN ;
      293    11773
      294    11774    1   ALTERR: CALL NME$ERRMSG ( B$TCB.ALT$->B$ALT.ERR ) ;
      295    11775
      296    11776    1   ABORT:  CALL NMU$ABORT ( %NI_MIRROR_OPER, %NI_MIRROR_FAIL ) ;
      297    11777
      298    11778    1           NMD_PIT.FLAGS.CIP# = '0'B ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:11   
      299    11779
      300    11780    1   ERROR:  ALTRETURN ;
      301    11781
      302    11782    1           END NMC$COPY ;

PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:12   
--  Include file information  --

   XU_MACRO_C.:E05TOU  is referenced.
   NM_PERR_C.:E05TOU  is referenced.
   NM_SUBS_C.:E05TOU  is referenced.
   NM_EQU_E.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NM_MACRO_M.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NMC$COPY.

   Procedure NMC$COPY requires 306 words for executable code.
   Procedure NMC$COPY requires 12 words of local(AUTO) storage.

    No errors detected in file NMC$COPY.:E05TSI    .

PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:13   

 Object Unit name= NMC$COPY                                   File name= NMC$COPY.:E05TOU
 UTS= JUL 30 '97 03:47:02.96 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     14     16  NMC$COPY
    2   Data  even  none     1      1  NMC$COPY
    3   Proc  even  none   306    462  NMC$COPY
    4  RoData even  none    25     31  NMC$COPY

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        0  NMC$COPY
     3    104          yes     yes      Std        0  NMC$KOPY
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:14   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 NMO$DEV
 yes     yes           Std       1 NMV$MIRRORED
 yes     yes           Std       0 NMV$VSN
         yes           Std       2 NMU$FGRAN
 yes     yes           Std       0 NMU$GDS
 yes     yes           Std       3 NMU$WRITE
 yes     yes           Std       1 NMU$UNLOCK
 yes     yes           Std       0 NMU$FDS
 yes     yes           Std       3 NMU$READ
 yes     yes           Std       0 NMV$PACKSIZE
 yes     yes           Std       3 NMU$CHGSTATE
         yes           Std       2 NMU$LGRAN
 yes     yes           Std       2 NMO$OPTIONS
 yes     yes           Std       0 NMV$DGT
 yes     yes           Std       1 NMU$LOCK
 yes     yes           Std       1 NMV$CHGSTATE
 yes     yes           Std       0 NMU$WAIT
 yes     yes           Std       0 NMV$PAIR
 yes     yes           Std       1 NMO$REPORT
 yes     yes           Std       2 NMU$ABORT
 yes     yes           Std       3 NMV$STATE
         yes           Std       6 NME$ERRMSG
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:15   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$TCB$                                NMD_PIT
     XUG_GETCMD                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:16   


        1        1        /*M* NMC$COPY - Perform MIRROR COPY command.                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DFC=YES, DMC=YES, EDMC=YES                                    */
        8        8        /*F*
        9        9        NAME:           NMC$COPY
       10       10
       11       11        PURSPOSE:       To perform the MIRROR COPY command.
       12       12        */
       13       13        /*D*
       14       14        NAME:           NMC$COPY
       15       15
       16       16        CALL:           CALL NMC$COPY ALTRET ( error ) ;
       17       17
       18       18        PARAMETERS:
       19       19        */
       20       20        /*K*
       21       21        error           is a statement label to which NMC$COPY will
       22       22                make an altreturn if an error is detected.
       23       23        */
       24       24        /*D*
       25       25
       26       26        DESCRIPTION:
       27       27
       28       28        The NMC$COPY procedure is used to make a mirrored copy of
       29       29        a Mirrored Disk device.
       30       30
       31       31        DPxx and DPyy must be a Mirrored Disk devices.  DPxx must be
       32       32        operational.  DPyy must be failed.
       33       33
       34       34        DPyy is made %NI_MIRROR_REST.  Then DPxx is copied over DPyy.
       35       35
       36       36        The COPY will be done GRANS granules at a time.  There
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:17   
       37       37        will be a delay of PAUSE seconds within the copy loop.
       38       38
       39       39        If the COPY is successful, DPyy will be set to %NI_MIRROR_OPER.
       40       40        If the COPY fails for any reason, DPyy will be set to
       41       41        %NI_MIRROR_FAIL.
       42       42
       43       43        */
       44       44        %EJECT ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:18   
       45       45        NMC$COPY:     PROC      ALTRET ;

     45  3 000000   000000 700200 xent  NMC$COPY     TSX0  ! X66_AUTO_0
         3 000001   000014 000000                    ZERO    12,0

       46       46        /*
       47       47                        Includes
       48       48        */
       49       49        %INCLUDE                CP_6 ;
       50     5608        %INCLUDE                FM$GRAN ;
       51     5677        %INCLUDE                NI$TABLES ;
       52     5893        %INCLUDE                NI_DATA_C ;
       53     6006        %INCLUDE                NM_MACRO_M ;
       54     7411        %INCLUDE                NM_PERR_C ;
       55     7488        %INCLUDE                XU_MACRO_C ;
       56    10594        /*
       57    10595                        Entries
       58    10596        */
       59    10597    1   DCL 1 NME$ERRMSG        ENTRY(6) ;
       60    10598    1   DCL 1 NMO$DEV           ENTRY(2) ALTRET ;
       61    10599    1   DCL 1 NMO$OPTIONS       ENTRY(2) ALTRET ;
       62    10600    1   DCL 1 NMO$REPORT        ENTRY(1) ALTRET ;
       63    10601    1   DCL 1 NMU$ABORT         ENTRY(2) ALTRET ;
       64    10602    1   DCL 1 NMU$CHGSTATE      ENTRY(3) ALTRET ;
       65    10603    1   DCL 1 NMU$FDS           ENTRY    ALTRET ;
       66    10604    1   DCL 1 NMU$FGRAN         ENTRY(2) ;
       67    10605    1   DCL 1 NMU$GDS           ENTRY    ALTRET ;
       68    10606    1   DCL 1 NMU$LGRAN         ENTRY(2) ;
       69    10607    1   DCL 1 NMU$LOCK          ENTRY(1) ALTRET ;
       70    10608    1   DCL 1 NMU$READ          ENTRY(3) ALTRET ;
       71    10609    1   DCL 1 NMU$UNLOCK        ENTRY(1) ALTRET ;
       72    10610    1   DCL 1 NMU$WAIT          ENTRY    ALTRET ;
       73    10611    1   DCL 1 NMU$WRITE         ENTRY(3) ALTRET ;
       74    10612    1   DCL 1 NMV$CHGSTATE      ENTRY(1) ALTRET ;
       75    10613    1   DCL 1 NMV$DGT           ENTRY    ALTRET ;
       76    10614    1   DCL 1 NMV$MIRRORED      ENTRY(1) ALTRET ;
       77    10615    1   DCL 1 NMV$PACKSIZE      ENTRY    ALTRET ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:19   
       78    10616    1   DCL 1 NMV$PAIR          ENTRY    ALTRET ;
       79    10617    1   DCL 1 NMV$STATE         ENTRY(3) ALTRET ;
       80    10618    1   DCL 1 NMV$VSN           ENTRY    ALTRET ;
       81    10619        /*
       82    10620                        Variables
       83    10621        */
       84    10622                                %B$ALT ( NAME =
       85    10623              B$ALT             , STCLASS = BASED
       86    10624                                                                        ) ;
       87    10632                                %B$TCB ( NAME =
       88    10633              B$TCB             , STCLASS = "BASED(B$TCB$)"
       89    10634                                                                        ) ;
       90    10637    1   DCL 1 B$TCB$            PTR SYMREF ;
       91    10638                                %NI$DCT ( NAME =
       92    10639              DCT               , STCLASS = BASED
       93    10640                                                                        ) ;
       94    10688    1   DCL 1 FGRAN             SBIN WORD ALIGNED AUTO ;
       95    10689                                %FM$VID ( FM$VID =
       96    10690              FM$VID            , BASED=BASED
       97    10691                                                                        ) ;
       98    10697    1   DCL 1 LGRAN             SBIN WORD ALIGNED AUTO ;
       99    10698    1   DCL 1 NGRAN             SBIN WORD ALIGNED AUTO ;
      100    10699                                %NMD_PIT ( FPTN =
      101    10700              NMD_PIT           , STCLASS=SYMREF
      102    10701                                                                        ) ;
      103    11154                                %PARSE$OUT ( NAME =
      104    11155              OUT               , STCLASS ="BASED(XUG_GETCMD.OUT$)"
      105    11156                                                                        ) ;
      106    11201                                %FPT_TIME ( FPTN =
      107    11202              TIME              , STCLASS = CONSTANT
      108    11203                                , DEST = UTS
      109    11204                                , SOURCE = CLOCK
      110    11205                                , TSTAMP = UTS
      111    11206                                                                        ) ;
      112    11225    1   DCL 1 UTS               UBIN WORD ALIGNED STATIC ;
      113    11226                                %NMD_VID ( FPTN =
      114    11227              VID               , STCLASS = BASED
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:20   
      115    11228                                                                        ) ;
      116    11245    1   DCL 1 VSIZE             SBIN WORD ALIGNED AUTO ;
      117    11246                                %VLP_VECTOR ( FPTN =
      118    11247              V_                , STCLASS = BASED
      119    11248                                                                        ) ;
      120    11263                                %XUG_GETCMD ( NAME =
      121    11264              XUG_GETCMD        , STCLASS = SYMREF
      122    11265                                                                        ) ;
      123    11603        %EJECT ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:21   
      124    11604        /*
      125    11605        Process the devices and options specified on the command.
      126    11606        */
      127    11607    1           CALL NMO$DEV     ( 0, OUT.SUBLK$(0) )   ALTRET ( ERROR ) ;

  11607  3 000002   000001 236000 xsym               LDQ     XUG_GETCMD+1
         3 000003   000003 036003                    ADLQ    3,DU
         3 000004   000000 235000 4                  LDA     0
         3 000005   200010 757100                    STAQ    VSIZE+2,,AUTO
         3 000006   200010 630500                    EPPR0   VSIZE+2,,AUTO
         3 000007   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000010   000000 701000 xent               TSX1    NMO$DEV
         3 000011   000461 702000 3                  TSX2    ERROR

      128    11608    1           CALL NMO$DEV     ( 1, OUT.SUBLK$(1) )   ALTRET ( ERROR ) ;

  11608  3 000012   000001 236000 xsym               LDQ     XUG_GETCMD+1
         3 000013   000004 036003                    ADLQ    4,DU
         3 000014   000001 235000 4                  LDA     1
         3 000015   200010 757100                    STAQ    VSIZE+2,,AUTO
         3 000016   200010 630500                    EPPR0   VSIZE+2,,AUTO
         3 000017   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000020   000000 701000 xent               TSX1    NMO$DEV
         3 000021   000461 702000 3                  TSX2    ERROR

      129    11609    1           CALL NMO$OPTIONS ( 2, OUT.NSUBLKS-1 )   ALTRET ( ERROR ) ;

  11609  3 000022   000001 470400 xsym               LDP0    XUG_GETCMD+1
         3 000023   000001 236100                    LDQ     1,,PR0
         3 000024   000022 772000                    QRL     18
         3 000025   000001 136007                    SBLQ    1,DL
         3 000026   200010 756100                    STQ     VSIZE+2,,AUTO
         3 000027   200010 631500                    EPPR1   VSIZE+2,,AUTO
         3 000030   200013 451500                    STP1    VSIZE+5,,AUTO
         3 000031   000002 236000 4                  LDQ     2
         3 000032   200012 756100                    STQ     VSIZE+4,,AUTO
         3 000033   200012 630500                    EPPR0   VSIZE+4,,AUTO
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:22   
         3 000034   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000035   000000 701000 xent               TSX1    NMO$OPTIONS
         3 000036   000461 702000 3                  TSX2    ERROR

      130    11610        /*
      131    11611        Verify that these devices are a Mirrored Disk pair with DPxx
      132    11612        operational and DPyy failed.  If they are, read the VIDs, verify
      133    11613        the VSNs, packsizes, and DGTs.
      134    11614        */
      135    11615    1           CALL NMV$MIRRORED ( 0 )                 ALTRET ( ERROR ) ;

  11615  3 000037   000000 630400 4                  EPPR0   0
         3 000040   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000041   000000 701000 xent               TSX1    NMV$MIRRORED
         3 000042   000461 702000 3                  TSX2    ERROR

      136    11616    1           CALL NMV$MIRRORED ( 1 )                 ALTRET ( ERROR ) ;

  11616  3 000043   000001 630400 4                  EPPR0   1
         3 000044   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000045   000000 701000 xent               TSX1    NMV$MIRRORED
         3 000046   000461 702000 3                  TSX2    ERROR

      137    11617    1           CALL NMV$PAIR                           ALTRET ( ERROR ) ;

  11617  3 000047   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000050   000000 701000 xent               TSX1    NMV$PAIR
         3 000051   000461 702000 3                  TSX2    ERROR

      138    11618    1           CALL NMV$STATE ( 0, %NI_MIRROR_OPER )   ALTRET ( ERROR ) ;

  11618  3 000052   000003 630400 4                  EPPR0   3
         3 000053   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000054   000000 701000 xent               TSX1    NMV$STATE
         3 000055   000461 702000 3                  TSX2    ERROR

      139    11619    1           CALL NMV$STATE ( 1, %NI_MIRROR_FAIL )   ALTRET ( ERROR ) ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:23   

  11619  3 000056   000005 630400 4                  EPPR0   5
         3 000057   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000060   000000 701000 xent               TSX1    NMV$STATE
         3 000061   000461 702000 3                  TSX2    ERROR

      140    11620
      141    11621    1           CALL NMU$READ  ( 0, 0, NMD_PIT.DEV.VID_(0) )

  11621  3 000062   000007 630400 4                  EPPR0   7
         3 000063   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000064   000000 701000 xent               TSX1    NMU$READ
         3 000065   000461 702000 3                  TSX2    ERROR

      142    11622    1                                                   ALTRET ( ERROR ) ;
      143    11623    1           CALL NMU$READ  ( 1, 0, NMD_PIT.DEV.VID_(1) )

  11623  3 000066   000012 630400 4                  EPPR0   10
         3 000067   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000070   000000 701000 xent               TSX1    NMU$READ
         3 000071   000461 702000 3                  TSX2    ERROR

      144    11624    1                                                   ALTRET ( ERROR ) ;
      145    11625
      146    11626    1           CALL NMV$VSN                            ALTRET ( ERROR ) ;

  11626  3 000072   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000073   000000 701000 xent               TSX1    NMV$VSN
         3 000074   000461 702000 3                  TSX2    ERROR

      147    11627    1           CALL NMV$PACKSIZE                       ALTRET ( ERROR ) ;

  11627  3 000075   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000076   000000 701000 xent               TSX1    NMV$PACKSIZE
         3 000077   000461 702000 3                  TSX2    ERROR

      148    11628    1           CALL NMV$DGT                            ALTRET ( ERROR ) ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:24   

  11628  3 000100   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000101   000000 701000 xent               TSX1    NMV$DGT
         3 000102   000461 702000 3                  TSX2    ERROR
         3 000103   000106 710000 3                  TRA     s:11638

      149    11629
      150    11630        %EJECT ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:25   
      151    11631        /*
      152    11632        Entry point for COPY part of MIRROR operation.
      153    11633        */
      154    11634    1   NMC$KOPY:       ENTRY           ALTRET ;

  11634  3 000104   000000 700200 xent  NMC$KOPY     TSX0  ! X66_AUTO_0
         3 000105   000014 000000                    ZERO    12,0

      155    11635        /*
      156    11636        Get buffers to do COPY operation.
      157    11637        */
      158    11638    1           CALL NMU$GDS                            ALTRET ( ABORT ) ;

  11638  3 000106   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000107   000000 701000 xent               TSX1    NMU$GDS
         3 000110   000453 702000 3                  TSX2    ABORT

      159    11639        /*
      160    11640        Change state of DEV(1) to RESTORE so all future writes will be done
      161    11641        to that device.
      162    11642        */
      163    11643    1           CALL M$TIME       ( TIME )              ALTRET ( ALTERR ) ;

  11643  3 000111   000000 630400 1                  EPPR0   TIME
         3 000112   420004 713400                    CLIMB   alt,+8196
         3 000113   402000 401760                    pmme    nvectors=5
         3 000114   000443 702000 3                  TSX2    ALTERR

      164    11644    1           CALL NMU$CHGSTATE ( 1, %NI_MIRROR_REST, UTS )

  11644  3 000115   000015 630400 4                  EPPR0   13
         3 000116   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000117   000000 701000 xent               TSX1    NMU$CHGSTATE
         3 000120   000453 702000 3                  TSX2    ABORT

      165    11645    1                                                   ALTRET ( ABORT ) ;
      166    11646        /*
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:26   
      167    11647        Initialize the percentage completion report for this COPY operation.
      168    11648        */
      169    11649    1           CALL NMO$REPORT ( 0 ) ;

  11649  3 000121   000000 630400 4                  EPPR0   0
         3 000122   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000123   000000 701000 xent               TSX1    NMO$REPORT
         3 000124   000000 011000                    NOP     0

      170    11650        /*
      171    11651        Set flag to indicate that a COPY operation is in progress.
      172    11652        */
      173    11653    1           NMD_PIT.FLAGS.CIP# = '1'B ;

  11653  3 000125   200000 236003                    LDQ     65536,DU
         3 000126   000273 256000 xsym               ORSQ    NMD_PIT+187

      174    11654        /*
      175    11655        Loop thru all granules on the Mirrored Disk device starting with the
      176    11656        second granule.  (First granule is granule 0.)
      177    11657        */
      178    11658    1           LGRAN = 0 ;

  11658  3 000127   200004 450100                    STZ     LGRAN,,AUTO

      179    11659    1           CALL NMU$FGRAN ( FGRAN, LGRAN ) ;

  11659  3 000130   200004 630500                    EPPR0   LGRAN,,AUTO
         3 000131   200011 450500                    STP0    VSIZE+3,,AUTO
         3 000132   200003 631500                    EPPR1   FGRAN,,AUTO
         3 000133   200010 451500                    STP1    VSIZE+2,,AUTO
         3 000134   200010 630500                    EPPR0   VSIZE+2,,AUTO
         3 000135   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000136   000000 701000 xent               TSX1    NMU$FGRAN
         3 000137   000000 011000                    NOP     0

      180    11660    2           DO UNTIL ( FGRAN >= NMD_PIT.PACKSIZE ) ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:27   

      181    11661        /*
      182    11662        Set up device logical address and size for this granule segment.
      183    11663        This segment may be up to GRANS granules in size.  The size will
      184    11664        be smaller if there are defective granule entries within this
      185    11665        segment.  In that case, the segment is shortened to end before
      186    11666        the first bad granule.
      187    11667        */
      188    11668    2               CALL NMU$LGRAN ( FGRAN, LGRAN ) ;

  11668  3 000140   200004 630500                    EPPR0   LGRAN,,AUTO
         3 000141   200011 450500                    STP0    VSIZE+3,,AUTO
         3 000142   200003 631500                    EPPR1   FGRAN,,AUTO
         3 000143   200010 451500                    STP1    VSIZE+2,,AUTO
         3 000144   200010 630500                    EPPR0   VSIZE+2,,AUTO
         3 000145   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000146   000000 701000 xent               TSX1    NMU$LGRAN
         3 000147   000000 011000                    NOP     0

      189    11669    2               NGRAN = LGRAN - FGRAN + 1 ;

  11669  3 000150   200004 236100                    LDQ     LGRAN,,AUTO
         3 000151   200003 136100                    SBLQ    FGRAN,,AUTO
         3 000152   000001 036007                    ADLQ    1,DL
         3 000153   200005 756100                    STQ     NGRAN,,AUTO

      190    11670    2               VSIZE = ( NGRAN * %NMD#WORDS_PER_GRAN

  11670  3 000154   200005 235100                    LDA     NGRAN,,AUTO
         3 000155   000014 735000                    ALS     12
         3 000156   000001 135007                    SBLA    1,DL
         3 000157   200006 755100                    STA     VSIZE,,AUTO

      191    11671    2                               * %NMD#BYTES_PER_WORD ) - 1 ;
      192    11672
      193    11673    2               ADDR(NMD_PIT.DEV.BUF_(0))->V_.W1.VSIZE# = VSIZE ;

PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:28   
  11673  3 000160   200006 236100                    LDQ     VSIZE,,AUTO
         3 000161   000020 736000                    QLS     16
         3 000162   000002 676000 xsym               ERQ     NMD_PIT+2
         3 000163   000034 376000 xsym               ANQ     B_VECTNIL+28
         3 000164   000002 656000 xsym               ERSQ    NMD_PIT+2

      194    11674
      195    11675    2               NMD_PIT.DEV.BUF_(1) = NMD_PIT.DEV.BUF_(0) ;

  11675  3 000165   000002 237000 xsym               LDAQ    NMD_PIT+2
         3 000166   000034 757000 xsym               STAQ    NMD_PIT+28

      196    11676        /*
      197    11677        Copy this granule segment from DEV(0) to DEV(1).
      198    11678        */
      199    11679    2               CALL NMU$LOCK    ( 0 )              ALTRET ( ABORT ) ;

  11679  3 000167   000000 630400 4                  EPPR0   0
         3 000170   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000171   000000 701000 xent               TSX1    NMU$LOCK
         3 000172   000453 702000 3                  TSX2    ABORT

      200    11680    2               IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.STATE ~=

  11680  3 000173   000010 470400 xsym               LDP0    NMD_PIT+8
         3 000174   000036 236100                    LDQ     30,,PR0
         3 000175   000030 772000                    QRL     24
         3 000176   000077 376007                    ANQ     63,DL
         3 000177   000025 116000 xsym               CMPQ    NMD_PIT+21
         3 000200   000206 600000 3                  TZE     s:11686

      201    11681    2                   NMD_PIT.DEV.STATE(0)
      202    11682    3               THEN DO ;

      203    11683    3                   CALL NMV$CHGSTATE ( 0 )         ALTRET ( ABORT ) ;

  11683  3 000201   000000 630400 4                  EPPR0   0
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:29   
         3 000202   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000203   000000 701000 xent               TSX1    NMV$CHGSTATE
         3 000204   000453 702000 3                  TSX2    ABORT

      204    11684    3                   GOTO ERROR ;

  11684  3 000205   000461 710000 3                  TRA     ERROR

      205    11685    3                   END ;
      206    11686    2               CALL NMU$READ    ( 0, FGRAN, NMD_PIT.DEV.BUF_(0) )

  11686  3 000206   000020 236000 4                  LDQ     16
         3 000207   200012 756100                    STQ     VSIZE+4,,AUTO
         3 000210   200003 631500                    EPPR1   FGRAN,,AUTO
         3 000211   200011 451500                    STP1    VSIZE+3,,AUTO
         3 000212   000000 236000 4                  LDQ     0
         3 000213   200010 756100                    STQ     VSIZE+2,,AUTO
         3 000214   200010 630500                    EPPR0   VSIZE+2,,AUTO
         3 000215   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000216   000000 701000 xent               TSX1    NMU$READ
         3 000217   000453 702000 3                  TSX2    ABORT

      207    11687    2                                                   ALTRET ( ABORT ) ;
      208    11688    2               CALL NMU$LOCK    ( 1 )              ALTRET ( ABORT ) ;

  11688  3 000220   000001 630400 4                  EPPR0   1
         3 000221   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000222   000000 701000 xent               TSX1    NMU$LOCK
         3 000223   000453 702000 3                  TSX2    ABORT

      209    11689    2               IF  NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.STATE ~=

  11689  3 000224   000042 470400 xsym               LDP0    NMD_PIT+34
         3 000225   000036 236100                    LDQ     30,,PR0
         3 000226   000030 772000                    QRL     24
         3 000227   000077 376007                    ANQ     63,DL
         3 000230   000057 116000 xsym               CMPQ    NMD_PIT+47
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:30   
         3 000231   000237 600000 3                  TZE     s:11695

      210    11690    2                   NMD_PIT.DEV.STATE(1)
      211    11691    3               THEN DO ;

      212    11692    3                   CALL NMV$CHGSTATE ( 1 )         ALTRET ( ABORT ) ;

  11692  3 000232   000001 630400 4                  EPPR0   1
         3 000233   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000234   000000 701000 xent               TSX1    NMV$CHGSTATE
         3 000235   000453 702000 3                  TSX2    ABORT

      213    11693    3                   GOTO ERROR ;

  11693  3 000236   000461 710000 3                  TRA     ERROR

      214    11694    3                   END ;
      215    11695    2               CALL NMU$UNLOCK  ( 0 )              ALTRET ( ABORT ) ;

  11695  3 000237   000000 630400 4                  EPPR0   0
         3 000240   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000241   000000 701000 xent               TSX1    NMU$UNLOCK
         3 000242   000453 702000 3                  TSX2    ABORT

      216    11696    2               CALL NMU$WRITE   ( 1, FGRAN, NMD_PIT.DEV.BUF_(1) )

  11696  3 000243   000021 236000 4                  LDQ     17
         3 000244   200012 756100                    STQ     VSIZE+4,,AUTO
         3 000245   200003 630500                    EPPR0   FGRAN,,AUTO
         3 000246   200011 450500                    STP0    VSIZE+3,,AUTO
         3 000247   000001 236000 4                  LDQ     1
         3 000250   200010 756100                    STQ     VSIZE+2,,AUTO
         3 000251   200010 630500                    EPPR0   VSIZE+2,,AUTO
         3 000252   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000253   000000 701000 xent               TSX1    NMU$WRITE
         3 000254   000453 702000 3                  TSX2    ABORT

PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:31   
      217    11697    2                                                   ALTRET ( ABORT ) ;
      218    11698    2               CALL NMU$UNLOCK  ( 1 )              ALTRET ( ABORT ) ;

  11698  3 000255   000001 630400 4                  EPPR0   1
         3 000256   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000257   000000 701000 xent               TSX1    NMU$UNLOCK
         3 000260   000453 702000 3                  TSX2    ABORT

      219    11699        /*
      220    11700        Advance to next granule segment, report completion percentage, and
      221    11701        wait if specified.
      222    11702        */
      223    11703    2               CALL NMU$FGRAN ( FGRAN, LGRAN ) ;

  11703  3 000261   200004 630500                    EPPR0   LGRAN,,AUTO
         3 000262   200011 450500                    STP0    VSIZE+3,,AUTO
         3 000263   200003 631500                    EPPR1   FGRAN,,AUTO
         3 000264   200010 451500                    STP1    VSIZE+2,,AUTO
         3 000265   200010 630500                    EPPR0   VSIZE+2,,AUTO
         3 000266   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000267   000000 701000 xent               TSX1    NMU$FGRAN
         3 000270   000000 011000                    NOP     0

      224    11704    2               IF  NMD_PIT.FLAGS.REPORT#

  11704  3 000271   000273 236000 xsym               LDQ     NMD_PIT+187
         3 000272   020000 316003                    CANQ    8192,DU
         3 000273   000302 600000 3                  TZE     s:11707

      225    11705    2               THEN
      226    11706    2                   CALL NMO$REPORT ( FGRAN ) ;

  11706  3 000274   200003 630500                    EPPR0   FGRAN,,AUTO
         3 000275   200010 450500                    STP0    VSIZE+2,,AUTO
         3 000276   200010 630500                    EPPR0   VSIZE+2,,AUTO
         3 000277   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000300   000000 701000 xent               TSX1    NMO$REPORT
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:32   
         3 000301   000000 011000                    NOP     0

      227    11707    2               IF  NMD_PIT.PAUSE# > 0

  11707  3 000302   000310 235000 xsym               LDA     NMD_PIT+200
         3 000303   000307 600000 3                  TZE     s:11711

      228    11708    2               THEN
      229    11709    2                   CALL NMU$WAIT ;

  11709  3 000304   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000305   000000 701000 xent               TSX1    NMU$WAIT
         3 000306   000000 011000                    NOP     0

      230    11710
      231    11711    2               END ; /* of COPY loop. */

  11711  3 000307   200003 236100                    LDQ     FGRAN,,AUTO
         3 000310   000140 604000 3                  TMI     s:11668
         3 000311   000307 116000 xsym               CMPQ    NMD_PIT+199
         3 000312   000140 602000 3                  TNC     s:11668

      232    11712        /*
      233    11713        Release buffers used in COPY operation.
      234    11714        */
      235    11715    1           CALL NMU$FDS                            ALTRET ( ABORT ) ;

  11715  3 000313   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000314   000000 701000 xent               TSX1    NMU$FDS
         3 000315   000453 702000 3                  TSX2    ABORT

      236    11716        /*
      237    11717        Update VID on primary device.
      238    11718        */
      239    11719    1           CALL M$TIME      ( TIME )               ALTRET ( ALTERR ) ;

  11719  3 000316   000000 630400 1                  EPPR0   TIME
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:33   
         3 000317   420004 713400                    CLIMB   alt,+8196
         3 000320   402000 401760                    pmme    nvectors=5
         3 000321   000443 702000 3                  TSX2    ALTERR

      240    11720    1           CALL NMU$LOCK    ( 0 )                  ALTRET ( ABORT ) ;

  11720  3 000322   000000 630400 4                  EPPR0   0
         3 000323   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000324   000000 701000 xent               TSX1    NMU$LOCK
         3 000325   000453 702000 3                  TSX2    ABORT

      241    11721    1           IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.STATE ~=

  11721  3 000326   000010 470400 xsym               LDP0    NMD_PIT+8
         3 000327   000036 236100                    LDQ     30,,PR0
         3 000330   000030 772000                    QRL     24
         3 000331   000077 376007                    ANQ     63,DL
         3 000332   000025 116000 xsym               CMPQ    NMD_PIT+21
         3 000333   000341 600000 3                  TZE     s:11727

      242    11722    1               NMD_PIT.DEV.STATE(0)
      243    11723    2           THEN DO ;

      244    11724    2               CALL NMV$CHGSTATE ( 0 )             ALTRET ( ABORT ) ;

  11724  3 000334   000000 630400 4                  EPPR0   0
         3 000335   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000336   000000 701000 xent               TSX1    NMV$CHGSTATE
         3 000337   000453 702000 3                  TSX2    ABORT

      245    11725    2               GOTO ERROR ;

  11725  3 000340   000461 710000 3                  TRA     ERROR

      246    11726    2               END ;
      247    11727    1           CALL NMU$READ    ( 0, 0, NMD_PIT.DEV.VID_(0) )

PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:34   
  11727  3 000341   000007 630400 4                  EPPR0   7
         3 000342   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000343   000000 701000 xent               TSX1    NMU$READ
         3 000344   000453 702000 3                  TSX2    ABORT

      248    11728    1                                                   ALTRET ( ABORT ) ;
      249    11729
      250    11730    1           NMD_PIT.DEV.VID$(0)->FM$VID.MIRROR.C        = 'MIRROR  ' ;

  11730  3 000345   000032 470400 xsym               LDP0    NMD_PIT+26
         3 000346   000014 237000 1                  LDAQ    TIME+12
         3 000347   000042 755100                    STA     34,,PR0
         3 000350   000043 756100                    STQ     35,,PR0

      251    11731    1           NMD_PIT.DEV.VID$(0)->FM$VID.MIRROR.UTS      = UTS ;

  11731  3 000351   000000 235000 2                  LDA     UTS
         3 000352   000044 755100                    STA     36,,PR0

      252    11732    1           NMD_PIT.DEV.VID$(0)->FM$VID.MIRROR.STATE(0) = %NI_MIRROR_OPER ;

  11732  3 000353   000000 236003                    LDQ     0,DU
         3 000354   000045 752140                    STCQ    37,'40'O,PR0

      253    11733    1           NMD_PIT.DEV.VID$(0)->FM$VID.MIRROR.STATE(1) = %NI_MIRROR_OPER ;

  11733  3 000355   000045 752120                    STCQ    37,'20'O,PR0

      254    11734
      255    11735    1           CALL NMU$WRITE   ( 0, 0, NMD_PIT.DEV.VID_(0) )

  11735  3 000356   000007 630400 4                  EPPR0   7
         3 000357   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000360   000000 701000 xent               TSX1    NMU$WRITE
         3 000361   000453 702000 3                  TSX2    ABORT

      256    11736    1                                                   ALTRET ( ABORT ) ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:35   
      257    11737    1           CALL NMU$UNLOCK  ( 0 )                  ALTRET ( ABORT ) ;

  11737  3 000362   000000 630400 4                  EPPR0   0
         3 000363   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000364   000000 701000 xent               TSX1    NMU$UNLOCK
         3 000365   000453 702000 3                  TSX2    ABORT

      258    11738        /*
      259    11739        Update VID on secondary device.
      260    11740        */
      261    11741    1           CALL NMU$LOCK    ( 1 )                  ALTRET ( ABORT ) ;

  11741  3 000366   000001 630400 4                  EPPR0   1
         3 000367   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000370   000000 701000 xent               TSX1    NMU$LOCK
         3 000371   000453 702000 3                  TSX2    ABORT

      262    11742    1           IF  NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.STATE ~=

  11742  3 000372   000042 470400 xsym               LDP0    NMD_PIT+34
         3 000373   000036 236100                    LDQ     30,,PR0
         3 000374   000030 772000                    QRL     24
         3 000375   000077 376007                    ANQ     63,DL
         3 000376   000057 116000 xsym               CMPQ    NMD_PIT+47
         3 000377   000405 600000 3                  TZE     s:11749

      263    11743    1               NMD_PIT.DEV.STATE(1)
      264    11744    2           THEN DO ;

      265    11745    2               CALL NMV$CHGSTATE ( 1 )             ALTRET ( ABORT ) ;

  11745  3 000400   000001 630400 4                  EPPR0   1
         3 000401   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000402   000000 701000 xent               TSX1    NMV$CHGSTATE
         3 000403   000453 702000 3                  TSX2    ABORT

      266    11746    2               GOTO ERROR ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:36   

  11746  3 000404   000461 710000 3                  TRA     ERROR

      267    11747    2               END ;
      268    11748
      269    11749    1           NMD_PIT.DEV.VID$(1)->VID                    = NMD_PIT.DEV.VID$(0)->VID ;

  11749  3 000405   000032 471400 xsym               LDP1    NMD_PIT+26
         3 000406   010000 220003                    LDX0    4096,DU
         3 000407   000064 473400 xsym               LDP3    NMD_PIT+52
         3 000410   000140 100540                    MLR     fill='000'O
         3 000411   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         3 000412   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

      270    11750
      271    11751    1           NMD_PIT.DEV.VID$(1)->FM$VID.MIRROR.STATE(0) = %NI_MIRROR_OPER ;

  11751  3 000413   000064 470400 xsym               LDP0    NMD_PIT+52
         3 000414   000000 236003                    LDQ     0,DU
         3 000415   000045 752140                    STCQ    37,'40'O,PR0

      272    11752    1           NMD_PIT.DEV.VID$(1)->FM$VID.MIRROR.STATE(1) = %NI_MIRROR_OPER ;

  11752  3 000416   000064 470400 xsym               LDP0    NMD_PIT+52
         3 000417   000045 752120                    STCQ    37,'20'O,PR0

      273    11753
      274    11754    1           CALL NMU$WRITE   ( 1, 0, NMD_PIT.DEV.VID_(1) )

  11754  3 000420   000012 630400 4                  EPPR0   10
         3 000421   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000422   000000 701000 xent               TSX1    NMU$WRITE
         3 000423   000453 702000 3                  TSX2    ABORT

      275    11755    1                                                   ALTRET ( ABORT ) ;
      276    11756    1           CALL NMU$UNLOCK  ( 1 )                  ALTRET ( ABORT ) ;

PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:37   
  11756  3 000424   000001 630400 4                  EPPR0   1
         3 000425   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000426   000000 701000 xent               TSX1    NMU$UNLOCK
         3 000427   000453 702000 3                  TSX2    ABORT

      277    11757        /*
      278    11758        Update the states of both the primary and secondary Mirrored Disk
      279    11759        devices to operational.
      280    11760        */
      281    11761    1           CALL NMU$CHGSTATE ( 0, %NI_MIRROR_OPER, UTS )

  11761  3 000430   000022 630400 4                  EPPR0   18
         3 000431   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000432   000000 701000 xent               TSX1    NMU$CHGSTATE
         3 000433   000453 702000 3                  TSX2    ABORT

      282    11762    1                                                   ALTRET ( ABORT ) ;
      283    11763    1           CALL NMU$CHGSTATE ( 1, %NI_MIRROR_OPER, UTS )

  11763  3 000434   000025 630400 4                  EPPR0   21
         3 000435   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000436   000000 701000 xent               TSX1    NMU$CHGSTATE
         3 000437   000453 702000 3                  TSX2    ABORT

      284    11764    1                                                   ALTRET ( ABORT ) ;
      285    11765        /*
      286    11766        Reset the flag indication that a COPY operation is in progress.
      287    11767        */
      288    11768    1           NMD_PIT.FLAGS.CIP# = '0'B ;

  11768  3 000440   000030 236000 4                  LDQ     24
         3 000441   000273 356000 xsym               ANSQ    NMD_PIT+187

      289    11769        /*
      290    11770        Return to the calling procedure.
      291    11771        */
      292    11772    1           RETURN ;
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:38   

  11772  3 000442   000000 702200 xent               TSX2  ! X66_ARET

      293    11773
      294    11774    1   ALTERR: CALL NME$ERRMSG ( B$TCB.ALT$->B$ALT.ERR ) ;

  11774  3 000443   000000 470400 xsym  ALTERR       LDP0    B$TCB$
         3 000444   000000 471500                    LDP1    0,,PR0
         3 000445   100102 633500                    EPPR3   66,,PR1
         3 000446   200010 453500                    STP3    VSIZE+2,,AUTO
         3 000447   200010 630500                    EPPR0   VSIZE+2,,AUTO
         3 000450   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000451   000000 701000 xent               TSX1    NME$ERRMSG
         3 000452   000000 011000                    NOP     0

      295    11775
      296    11776    1   ABORT:  CALL NMU$ABORT ( %NI_MIRROR_OPER, %NI_MIRROR_FAIL ) ;

  11776  3 000453   000000 630400 4     ABORT        EPPR0   0
         3 000454   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000455   000000 701000 xent               TSX1    NMU$ABORT
         3 000456   000000 011000                    NOP     0

      297    11777
      298    11778    1           NMD_PIT.FLAGS.CIP# = '0'B ;

  11778  3 000457   000030 236000 4                  LDQ     24
         3 000460   000273 356000 xsym               ANSQ    NMD_PIT+187

      299    11779
      300    11780    1   ERROR:  ALTRETURN ;

  11780  3 000461   000000 702200 xent  ERROR        TSX2  ! X66_AALT
      301    11781
      302    11782    1           END NMC$COPY ;

PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:39   
--  Include file information  --

   XU_MACRO_C.:E05TOU  is referenced.
   NM_PERR_C.:E05TOU  is referenced.
   NM_SUBS_C.:E05TOU  is referenced.
   NM_EQU_E.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NM_MACRO_M.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NMC$COPY.
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:40   

 **** Variables and constants ****

  ****  Section 001 RoData NMC$COPY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(432)   r     1 TIME

  ****  Section 002  Data  NMC$COPY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 UTS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w SBIN        r     1 FGRAN                      4-0-0/w SBIN        r     1 LGRAN
     5-0-0/w SBIN        r     1 NGRAN                      6-0-0/w SBIN        r     1 VSIZE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/d STRC(8892)  r     1 NMD_PIT
     0-0-0/d STRC(1512)  r     1 XUG_GETCMD

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:41   
     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w STRC(36864) r     1 FM$VID
     0-0-0/w STRC(144)   r     1 OUT                        0-0-0/w UBIN        r     1 VID(0:1023)
     0-0-0/d STRC(72)    r     1 V_


   Procedure NMC$COPY requires 306 words for executable code.
   Procedure NMC$COPY requires 12 words of local(AUTO) storage.

    No errors detected in file NMC$COPY.:E05TSI    .
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:42   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:43   
          MINI XREF LISTING

ABORT
     11776**LABEL   11638--CALLALT 11644--CALLALT 11679--CALLALT 11683--CALLALT 11686--CALLALT 11688--CALLALT
     11692--CALLALT 11695--CALLALT 11696--CALLALT 11698--CALLALT 11715--CALLALT 11720--CALLALT 11724--CALLALT
     11727--CALLALT 11735--CALLALT 11737--CALLALT 11741--CALLALT 11745--CALLALT 11754--CALLALT 11756--CALLALT
     11761--CALLALT 11763--CALLALT
ALTERR
     11774**LABEL   11643--CALLALT 11719--CALLALT
B$ALT.CODE
     10626**DCL     10626--REDEF   10627--REDEF   10627--REDEF
B$ALT.ERR
     10627**DCL     11774<>CALL
B$ALT.ERR.ERR#
     10628**DCL     10628--REDEF
B$ALT.EVID
     10627**DCL     10627--REDEF   10627--REDEF
B$TCB.ALT$
     10635**DCL     11774>>CALL
B$TCB$
     10637**DCL     10635--IMP-PTR 11774>>CALL
DCT.DP
     10669**DCL     10676--REDEF   10679--REDEF   10680--REDEF   10682--REDEF   10682--REDEF   10683--REDEF
     10684--REDEF   10684--REDEF
DCT.DP.MIRROR.STATE
     10673**DCL     11680>>IF      11689>>IF      11721>>IF      11742>>IF
DCT.MPC.IOCHANX
     10677**DCL     10677--REDEF
ERROR
     11780**LABEL   11607--CALLALT 11608--CALLALT 11609--CALLALT 11615--CALLALT 11616--CALLALT 11617--CALLALT
     11618--CALLALT 11619--CALLALT 11621--CALLALT 11623--CALLALT 11626--CALLALT 11627--CALLALT 11628--CALLALT
     11684--GOTO    11693--GOTO    11725--GOTO    11746--GOTO
FGRAN
     10688**DCL     11659<>CALL    11660>>DOUNTIL 11668<>CALL    11669>>ASSIGN  11686<>CALL    11696<>CALL
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:44   
     11703<>CALL    11706<>CALL
FM$VID.DTT
     10694**DCL     10694--REDEF
FM$VID.MIRROR.C
     10693**DCL     11730<<ASSIGN
FM$VID.MIRROR.STATE
     10693**DCL     11732<<ASSIGN  11733<<ASSIGN  11751<<ASSIGN  11752<<ASSIGN
FM$VID.MIRROR.UTS
     10693**DCL     11731<<ASSIGN
LGRAN
     10697**DCL     11658<<ASSIGN  11659<>CALL    11668<>CALL    11669>>ASSIGN  11703<>CALL
M$TIME
      5603**DCL-ENT 11643--CALL    11719--CALL
NGRAN
     10698**DCL     11669<<ASSIGN  11670>>ASSIGN
NMD_PIT.DEV.BUF_
     10734**DCL     11673--ASSIGN  11675<<ASSIGN  11675>>ASSIGN  11686<>CALL    11696<>CALL
NMD_PIT.DEV.DCT$
     10762**DCL     11680>>IF      11689>>IF      11721>>IF      11742>>IF
NMD_PIT.DEV.STATE
     10842**DCL     11680>>IF      11689>>IF      11721>>IF      11742>>IF
NMD_PIT.DEV.VID$
     10864**DCL     11730>>ASSIGN  11731>>ASSIGN  11732>>ASSIGN  11733>>ASSIGN  11749>>ASSIGN  11749>>ASSIGN
     11751>>ASSIGN  11752>>ASSIGN
NMD_PIT.DEV.VID_
     10858**DCL     11621<>CALL    11623<>CALL    11727<>CALL    11735<>CALL    11754<>CALL
NMD_PIT.FLAGS.CIP#
     10954**DCL     11653<<ASSIGN  11768<<ASSIGN  11778<<ASSIGN
NMD_PIT.FLAGS.REPORT#
     10973**DCL     11704>>IF
NMD_PIT.PACKSIZE
     11086**DCL     11660>>DOUNTIL
NMD_PIT.PAUSE#
     11091**DCL     11707>>IF
NME$ERRMSG
     10597**DCL-ENT 11774--CALL
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:45   
NMO$DEV
     10598**DCL-ENT 11607--CALL    11608--CALL
NMO$OPTIONS
     10599**DCL-ENT 11609--CALL
NMO$REPORT
     10600**DCL-ENT 11649--CALL    11706--CALL
NMU$ABORT
     10601**DCL-ENT 11776--CALL
NMU$CHGSTATE
     10602**DCL-ENT 11644--CALL    11761--CALL    11763--CALL
NMU$FDS
     10603**DCL-ENT 11715--CALL
NMU$FGRAN
     10604**DCL-ENT 11659--CALL    11703--CALL
NMU$GDS
     10605**DCL-ENT 11638--CALL
NMU$LGRAN
     10606**DCL-ENT 11668--CALL
NMU$LOCK
     10607**DCL-ENT 11679--CALL    11688--CALL    11720--CALL    11741--CALL
NMU$READ
     10608**DCL-ENT 11621--CALL    11623--CALL    11686--CALL    11727--CALL
NMU$UNLOCK
     10609**DCL-ENT 11695--CALL    11698--CALL    11737--CALL    11756--CALL
NMU$WAIT
     10610**DCL-ENT 11709--CALL
NMU$WRITE
     10611**DCL-ENT 11696--CALL    11735--CALL    11754--CALL
NMV$CHGSTATE
     10612**DCL-ENT 11683--CALL    11692--CALL    11724--CALL    11745--CALL
NMV$DGT
     10613**DCL-ENT 11628--CALL
NMV$MIRRORED
     10614**DCL-ENT 11615--CALL    11616--CALL
NMV$PACKSIZE
     10615**DCL-ENT 11627--CALL
PL6.E3A0      #001=NMC$COPY File=NMC$COPY.:E05TSI                                WED 07/30/97 03:47 Page:46   
NMV$PAIR
     10616**DCL-ENT 11617--CALL
NMV$STATE
     10617**DCL-ENT 11618--CALL    11619--CALL
NMV$VSN
     10618**DCL-ENT 11626--CALL
OUT.NSUBLKS
     11174**DCL     11609>>CALL
OUT.SUBLK$
     11195**DCL     11607<>CALL    11608<>CALL
TIME
     11217**DCL     11643<>CALL    11719<>CALL
TIME.V
     11221**DCL     11217--DCLINIT
UTS
     11225**DCL     11221--DCLINIT 11644<>CALL    11731>>ASSIGN  11761<>CALL    11763<>CALL
VID
     11242**DCL     11749<<ASSIGN  11749>>ASSIGN
VSIZE
     11245**DCL     11670<<ASSIGN  11673>>ASSIGN
V_.W1.VSIZE#
     11259**DCL     11673<<ASSIGN
V_.W2
     11260**DCL     11261--REDEF
XUG_GETCMD.OUT$
     11283**DCL     11162--IMP-PTR 11289--REDEF   11607>>CALL    11608>>CALL    11609>>CALL
