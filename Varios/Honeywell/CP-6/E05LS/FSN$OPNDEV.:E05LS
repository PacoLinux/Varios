VERSION E05

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:1    
        1        1        /*M*     FSN$OPNDEV       DEVICE DCB OPEN      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        /*P*     NAME:    FSN$OPNDEV
        9        9         *       PURPOSE: OPEN A DEVICE DCB.
       10       10         **/
       11       11        /*F*     NAME:    FSN$OPNDEV
       12       12         *       PURPOSE: OPEN A DEVICE DCB.
       13       13         *       DESCRIPTION:  EXAMINE F$DCB.RES.  THIS TELLS WHETHER
       14       14         *                IT IS STREAM OR DIRECT CONNECTION.
       15       15         *                IF STREAM, FIND OR BUILD STREAM DCB AND
       16       16         *                POINT DCB BEING OPENED TO STREAM DCB.
       17       17         *                IF DIRECT, MAY BE SYMBIONT OR DEVICE;
       18       18         *                  IF DIRECT SYMBIONT, CREATE SYMBIONT FILE;
       19       19         *                  IF DIRECT DEVICE, ACQUIRE DEVICE.
       20       20         **/
       21       21        /*D*     NAME:    FSN$OPNDEV
       22       22         *       CALL:    CALL FSN$OPNDEV(PN$)
       23       23         *       INTERFACE:  FRA$OPR
       24       24         *       ENVIRONMENT:  MONITOR (FOR USER) LS.
       25       25                INPUT:
       26       26                   DCB, pointed to by B$JIT.DCB$.
       27       27                      FCD is off.
       28       28                      ASN= Device.
       29       29                      IASN= Device.
       30       30                      FFLG=0.  DDEV=0.  WIDTH=0.  DESC=0.
       31       31         *                PN$ IS A POINTER ARRAY FOR VARIOUS M$OPEN FPT
       32       32         *                  AREAS, MOSTLY UNUSED FOR DEVICE OPEN.
       33       33         *       OUTPUT:  DCB (B$JIT.DCB$) IS OPENED, & OTHER FIELDS CHANGED.
       34       34         *                B$JIT.ERR SET UP IF ERROR OCCURRED.
       35       35                         DCB's CFU$ may point to newly created stream DCB.
       36       36                DESCRIPTION:
       37       37         **/
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:2    
       38       38        FSN$OPNDEV:PROC(PN$);
       39       39    1   DCL B$JIT$ PTR SYMREF READONLY;         /* Note that B$JIT is BASED(B$JIT$).  */
       40       40    1   DCL B$ROSEG$ PTR SYMREF READONLY;
       41       41    1   DCL B$M$UC$ PTR SYMREF READONLY;
       42       42    1   DCL B$M$DO$ PTR SYMREF READONLY;
       43       43        /*** * * * ***/
       44       44    1   DCL FRA$OPR ENTRY ALTRET;               /* GETS RESOURCE DEVICE               */
       45       45    1   DCL FRB$CLS ENTRY;
       46       46    1   DCL NKU$UCOPN ENTRY ALTRET;             /* OPENS M$UC DCB                     */
       47       47    1   DCL FMN$OPNDP ENTRY(1) ALTRET;          /* DEVICE PACK OPEN FOR LATCH,VOLINNT */
       48       48    1   DCL FSA$GSP ENTRY(2) ALTRET;            /* GET ROSEG SPACE */
       49       49    1   DCL FSA$FSP ENTRY(2) ALTRET;            /* Free ROSEG space */
       50       50    1   DCL FSB$MEDDCB ENTRY(1) ALTRET;
       51       51    1   DCL FSB$STREAMCREATE ENTRY(1) ALTRET;   /* CREATE A STREAMFILE                */
       52       52    1   DCL FSB$STREAMDCB ENTRY(1) ALTRET;      /* GET/OPEN STREAM DCB                */
       53       53    1   DCL FSB$DDF ENTRY(1) ALTRET;            /* Setup DCB from DDF */
       54       54    1   DCL FMM$DFLOPNP ENTRY;
       55       55    1   DCL FMO$GETDOMAIN ENTRY(1);
       56       56    1   DCL KCI$VALSTA1 ENTRY(2) ALTRET;
       57       57    1   DCL FSD$JEJFOPN ENTRY(1)ALTRET;         /* Open JE/JF DCB (Make JCL)          */
       58       58    1   DCL FSD$C1GETDCB ENTRY ALTRET;          /* Make & open DCB for command file   */
       59       59    1   DCL FTO$OPNAT ENTRY(1);                 /* Open DCB to tape                   */
       60       60    1   DCL FPO$OPNOD ENTRY(1) ALTRET;          /* Open DCB to Optical Disc  */
       61       61    1   DCL FSW$DESTFORM ENTRY(3)ALTRET;        /* Verify dev/wsn/form for dd@wsn. */
       62       62    1   DCL FSF$SYMBFILE ENTRY(3)ALTRET;        /* Open symfile, build banner.*/
       63       63    1   DCL FMD$GBUF ENTRY(1);                  /* Steal a File-Management buffer. */
       64       64    1   DCL FMD$RBUF ENTRY(1);                  /* Return a Stolen File Mgmt buffer. */
       65       65    1   DCL FMD$RELBUF ENTRY(1);                /* Return a File Mgmt buffer. */
       66       66    1   DCL FSM$HDRSET ENTRY(1);                /* Fix up user-specified Header.*/
       67       67    1   DCL KUB$WRITE ENTRY(3) ALTRET;
       68       68    1   DCL NKA$DEVIO ENTRY(5)ALTRET;
       69       69    1   DCL FSP$CLSDEV ENTRY(1) ALTRET;
       70       70    1   DCL FMO$GETPFB ENTRY(1);
       71       71    1   DCL KIA$CLSSTR ENTRY(3) ALTRET;
       72       72    1   DCL KIA$DCLSTR ENTRY(2) ALTRET;
       73       73    1   DCL KIA$OPNSSN ENTRY(1) ALTRET;
       74       74    1   DCL KIA$OPNSTR ENTRY(2) ALTRET;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:3    
       75       75    1   DCL KIA$UCIOND ENTRY(7) ALTRET;
       76       76    1   DCL FRF$EVRPT ENTRY(1) ALTRET;
       77       77    1   DCL FMF$REMOTE ENTRY(1);
       78       78    1   DCL KIA$WINDOW ENTRY(2) ALTRET;
       79       79    1   DCL KIA$8TO9 ENTRY(3);
       80       80    1   DCL KIA$9TO8 ENTRY(3);
       81       81    1   DCL KIF$FPRGR ENTRY ALTRET;
       82       82    1   DCL KCO$FINDSTA ENTRY(4) ALTRET;
       83       83    1   DCL NKL$GETDCT ENTRY(1) ALTRET;
       84       84    1   DCL NKL$RELDCT ENTRY(1) ALTRET;
       85       85    1   DCL SSR$REG ENTRY(3) ALTRET;
       86       86    1   DCL FSL$GET_CLDEV ENTRY(1);
       87       87    1   DCL KIS$OSI_OPEN ENTRY (0) ALTRET;
       88       88        /*** INCLUDES ***/
       89       89        %INCLUDE B$JIT_C;
       90      403        %MACRO B$ROSEG(BASED=BASED);
       91      404        %INCLUDE B$ROSEG;
       92      467        %MEND;
       93      468        %INCLUDE CP_6_SUBS;
       94     1008        %INCLUDE B_ERRORS_C;
       95     2135        %INCLUDE B_STRINGS_C;
       96     2264        %INCLUDE F$CP6P_C;
       97     2275        %INCLUDE F$CP6V_C;
       98     2501        %MACRO F$DCBI(BASED=BASED);
       99     2502        %INCLUDE F$DCB;
      100     2551        %MEND;
      101     2552        %INCLUDE FM$FIT;
      102     2773        %INCLUDE FS$FIT;
      103     2816        %INCLUDE FS_SUPER_C;
      104     3579        %INCLUDE F_CP6;
      105     4604        %INCLUDE F_FMTCODE_C;
      106     4638        %INCLUDE F_FPTCODE_C;
      107     4674        %INCLUDE F_MACROS_C;
      108     4685        %INCLUDE G_JIT_M;
      109     4950        %INCLUDE JG_GHOSTS_C;
      110     5040        %INCLUDE KI_SUBS_C;
      111     5176        %INCLUDE KC$CGBLK;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:4    
      112     5224        %INCLUDE KC_CP6;
      113     5784        %INCLUDE KI_CP6;
      114     6880        %INCLUDE KL_AFCN_C;
      115     6981        %INCLUDE KL_MACRO_C;
      116    10333        %INCLUDE KL_SUPER_C;
      117    13235        %INCLUDE KV$VDO;
      118    14250        %KV_VDO_ALL_E;
      119    14329        %INCLUDE K_DATA_R;
      120    15040        %INCLUDE NK$LDCT;
      121    15142        %INCLUDE NK_LDCT_R;
      122    15151        %INCLUDE NK_SUBS;
      123    15176        %INCLUDE NK_VFC_C;
      124    15250        %INCLUDE SS_SCHED_C;
      125    15483        /**/
      126    15484        /*** MACROS, BASED, ETC. ***/
      127    15485        %INCLUDE HF_LOCK_C;
      128    15499        %B$JIT0;
      129    15588        %U$JIT1;
      130    15662        %M$JIT2X;
      131    15665        %F$JIT3;
      132    15670        %S$JIT4X;
      133    15673        %J$JIT5X;
      134    15676        %A$JIT6X;
      135    15679        %FPT$OPEN_V;
      136    15694        %VLP_SETSTA(STCLASS=CONSTANT);
      137    15722        %VLP_SETSTA(FPTN=VLP$SETSTA,STCLASS=BASED);
      138    15750        %VLP_STATION(STCLASS=CONSTANT);
      139    15777        %VLP_STATION(FPTN=VLP$STATION,STCLASS=BASED);
      140    15804        %VLP_WINDOW (FPTN=FS_WINDOW,STCLASS=SYMREF);
      141    15848    1   DCL ZEROES BIT(72)CONSTANT INIT('0'B);
      142    15849    1   DCL CONV_STR(0:3) CHAR(4) CONSTANT INIT('    ','UC98','UC01','UC99');
      143    15850        %FPT$OPEN_P(FPTN=PN$,STCLASS=,PFMT=PTR);
      144    15856        %VLP_FORM(FPTN=VLP$FORM,STCLASS=BASED);
      145    15869        %VLP_WINDOW (FPTN=VLP$WINDOW,STCLASS=BASED);
      146    15913        %VLP_WINDOW (FPTN=WINDOW,STCLASS=AUTO);
      147    15957        %NK$LDCT(STCLASS="BASED(LDCT$)");
      148    16003        %B$ROSEG (BASED="BASED(B$ROSEG$)");
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:5    
      149    16063        %F$DCBI (BASED="BASED(JDCB$)");
      150    16113        %CODE16;
      151    16121        %KL_WSNHDR(STCLASS="BASED(BUF$)");
      152    16132    1   DCL 1 BPTR BASED ALIGNED,
      153    16133    1            2 ADR UBIN(18) UNAL,
      154    16134    1            2 SEGID BIT(18) UNAL;
      155    16135    1   DCL NEWSTREAM BIT(1) ALIGNED;      /* Set if this pass opened this stream */
      156    16136    1   DCL HOST BIT(1) ALIGNED;
      157    16137    1   DCL ERRCODE BIT(36) ALIGNED;
      158    16138    1   DCL JDCB$ PTR;                     /* TO HOLD POINTER TO DCB BEING OPENED     */
      159    16139    1   DCL LDCT$ PTR;
      160    16140    1   DCL I SBIN;                             /*ALL SORTS OF INDEXING USES          */
      161    16141    1   DCL 1 RLCID REDEF I,
      162    16142    1            2 NODE UBIN(9) UNAL,
      163    16143    1            2 GENERATION UBIN(9) UNAL,
      164    16144    1            2 LDCTX UBIN(18) UNAL;
      165    16145    1   DCL J SBIN;
      166    16146    1   DCL F SBIN;              /*F is converted DCB.FUN .. 0=UPD, 1=IN, 2=CREATE.*/
      167    16147    1   DCL JDCBNO UBIN;
      168    16148    1   DCL RES CHAR(4);                        /* Hold RES field of DCB here.        */
      169    16149    1   DCL FEX UBIN;
      170    16150    1   DCL STR UBIN;
      171    16151    1   DCL JIT$ PTR;
      172    16152    1   DCL BUF$ PTR;
      173    16153        %SUB FCG#='0623'O;
      174    16154        %SUB MID#='16'O;
      175    16155        %G$JIT_E;
      176    16217        %ERRCODE (NAME=ERR_ILLIN,COD#=%E$ILLIN);
      177    16221        %ERRCODE (NAME=ERR_INVRES,COD#=%E$INVRES);
      178    16225        %ERRCODE (NAME=ERR_PCNLDCT,COD#=%E$PCNLDCT);
      179    16229        %ERRCODE (NAME=ERR_NOSTREAMS,COD#=%E$LDEVNOSTREAMS);
      180    16233        %ERRCODE (NAME=ERR_NOTAUTH,COD#=%E$NOTAUTH);
      181    16237        %ERRCODE (NAME=ERR_NOTDBG,COD#=%E$NOTDBG);
      182    16241        %ERRCODE (NAME=ERR_INVDBG,COD#=%E$INVDBG);
      183    16245        %ERRCODE (NAME=ERR_ORGNOTCOM,COD#=%E$ORGNOTCOM);
      184    16249        %ERRCODE (NAME=ERR_BADFEP,COD#=%E$BAD_FEP);
      185    16253        %ERRCODE (NAME=ERR_NOFPRG,COD#=%E$NOFPRG);
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:6    
      186    16257        /*N* THIS OUGHTA BE REPLACED BY CALL TO FSL BY END OF T */
      187    16258        %FS$LDEVDDF(NAME=LDEVUATTR,STCLASS=,SIZ=NAWNDW);
      188    16262        %VLP_TAB(FPTN=LDEVPLUSTAB,STCLASS=BASED);
      189    16276        %VLP_HDR(FPTN=LDEVPLUSHDR,STCLASS=BASED,LEN=160);
      190    16292        %FS$FORMREC(STCLASS="BASED(BUF$)");
      191    16363    1   DCL TSTFINFO SBIN;
      192    16364    1   DCL ORG UBIN;
      193    16365    1   DCL 1 ORGSTR REDEF ORG,
      194    16366    1            2 * BIT(27), 2 BYT UBIN(9) UNAL;
      195    16367        %FS_OSFN(FPTN=OSFN,STCLASS=BASED);
      196    16381        %FPT_CLOSE(FPTN=CLSSAVE$,PFMT=PTR,VECTOR=ADDR,DISP=SAVE,
      197    16382                STCLASS=CONSTANT);
      198    16424    1   DCL FMP$CLSF ENTRY(1);
      199    16425    1   DCL FSA$FDCB ENTRY(1);
      200    16426    1   DCL KIN$CONV_NODENAME ENTRY(3) ALTRET;
      201    16427    1   DCL KIN$CONV_NODE ENTRY(3) ALTRET;
      202    16428    1   DCL FSN$CONV_STR ENTRY(2) ALTRET;
      203    16429        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:7    
      204    16430        /*D*       The very first time through Device Open for this user,
      205    16431                M$UC is forced open and some flags are set so that all
      206    16432                subsequent opens of control-command DCB's will go faster.
      207    16433                   There are three kinds of user to be distinguished at
      208    16434                this time --
      209    16435                1.  Batch User.  M$UC.ASN is DEVICE, and B$JIT.NEXTCC is
      210    16436                   %CC_FROMJOB#.  M$UC is opened as NO.
      211    16437                2.  System Ghost User.  M$UC.ASN is DEVICE, and B$JIT.NEXTCC
      212    16438                   is %CC_FROMNO#.  M$UC is opened as NO.
      213    16439                3.  Interactive User.  B$JIT.NEXTCC is %CC_FROMUC#.  M$UC.ASN
      214    16440                   may or may not be DEVICE.  If not, it gets opened by
      215    16441                   Comgroup Open.  If so, it as opened as UC.
      216    16442                   Special Frill - If line hangs up before first open, M$UC
      217    16443                   may be 'NO' instead of 'UC'. It gets opened as NO, but
      218    16444                   the user is still considered Interactive.
      219    16445                After M$UC is open, the flags in B$ROSEG.CR01ID and
      220    16446                B$ROSEG.CR01DCB may have one of several configurations.
      221    16447                (The ones marked '**' are possible initial ones.)
      222    16448                ============================================================
      223    16449                  CR01ID.      CR01    Meaning
      224    16450                INT JCL NOWIS  DCB.
      225    16451                ------------------------------------------------------------
      226    16452                 0   1   JOB   M$UC ** Batch; CC read from JCL in M$UC.
      227    16453                 0   0   NO    M$UC ** Sys ghost; CC read = EOF.
      228    16454                 1   0   UC    M$UC ** Interactive; CC read from M$UC.
      229    16455                 0   1   XEQ   M$UC    Batch; CC read from XEQ in M$UC.
      230    16456                 0   1   NO    M$UC    Batch; CC read = EOF.
      231    16457                 0   0   XEQ   M$UC    Sys ghost; CC read from XEQ in M$UC.
      232    16458                 1   0   XEQ   nnnn    Interactive; CC read from XEQ in nnnn.
      233    16459                 1   0   XEQ    0      Interactive; CC read from XEQ needs
      234    16460                                          a DCB.
      235    16461                ------------------------------------------------------------
      236    16462                   B$ROSEG.CR01ID.NOWIS values are the same as B$JIT.NEXTCC
      237    16463                values %CC_FROMJOB#,%CC_FROMNO#, etc.
      238    16464                ------------------------------------------------------------
      239    16465                LP      means logical device LP01.
      240    16466                CP      meand logical device CP01.
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:8    
      241    16467                GR      means logical device GR01.
      242    16468                NO      means device NO.
      243    16469                JF      means the JCL-place maker for you yourself.  The
      244    16470                        XEQ process writes output to JF.
      245    16471                JE      means the JCL-place maker for a new batch job.
      246    16472                        The BATCH process writes output to JE.
      247    16473                LO      means terminal if you are an interactive user, and
      248    16474                        logical device LP01 if you are a batch user.  LO
      249    16475                        can only be written to.
      250    16476                CR      means your JCL-place if you have one (batch, or
      251    16477                        interactive in an XEQ), otherwise terminal
      252    16478                        (interactive user without an XEQ in progress).
      253    16479                        CR can only be read from.
      254    16480                UC      means terminal if you are interactive, NO if you
      255    16481                        are a batch user.
      256    16482                ME      means the same as CR when read from, the same as
      257    16483                        LO when written to.
      258    16484        */
      259    16485    1        JDCB$=B$JIT.DCB$;
      260    16486    1        JDCBNO = F$DCB.DCB#;
      261    16487
      262    16488        /* Default stream correctly depending on what DCB it is */
      263    16489    1        IF JDCB$ = B$M$DO$
      264    16490    1        THEN
      265    16491    1             STR = KIDM_DB;
      266    16492    1        ELSE
      267    16493    1             CALL FMO$GETPFB(STR);
      268    16494    1        IF NOT B$ROSEG.STREAM_VALID(STR)
      269    16495    1        THEN
      270    16496    1             STR = KIDM_CP;
      271    16497
      272    16498    1   INITLOOP:;
      273    16499    2        IF B$ROSEG.CR01DCB=1 THEN DO;
      274    16500    2             B$ROSEG.CR01ID='0'B;
      275    16501    3             IF JDCB$=B$M$UC$ THEN DO;
      276    16502    4                  IF B$JIT.NEXTCC=%CC_FROMUC# AND F$DCB.RES='UC' THEN DO;
      277    16503    4                       F$DCB.CFU$=JDCB$;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:9    
      278    16504    4                       CALL NKU$UCOPN ALTRET(CANTOPENUC);
      279    16505                /*ORG=TERMINAL,WIDTH=nn.*/
      280    16506    4                       F$DCB.DDEV=%DDEV_LP#|%DDEV_IC#|%DDEV_UCOUT#;
      281    16507    4                       F$DCB.UCOUT=%YES#;
      282    16508    4                       F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;
      283    16509    4                       F$DCB.DVFC='A';
      284    16510    4                       F$DCB.MEDIA=FMTUC#;
      285    16511    4                       F$DCB.IFMT=FMTTTY#;
      286    16512    4                     END;
      287    16513    4                  ELSE DO;
      288    16514    4                       F$DCB.FFLG=%FFLG_OWNER#;
      289    16515    4                       F$DCB.IFMT=FMTNO#;
      290    16516    4                       F$DCB.MEDIA=FMTNO#;
      291    16517    4                       F$DCB.IASN=0;
      292    16518                /*Other fields ignored on PMME's for FMTNO.*/
      293    16519    4                     END;
      294    16520    3                  B$ROSEG.CR01ID.NOWIS=B$JIT.NEXTCC;
      295    16521    3                  B$ROSEG.CR01ID.INT=(B$JIT.NEXTCC=%CC_FROMUC#);
      296    16522    3                  B$ROSEG.CR01ID.JCL=(B$JIT.NEXTCC=%CC_FROMJOB#);
      297    16523    3                  B$ROSEG.CR01DCB=POFFW(JDCB$,B$ROSEG$);
      298    16524    3                  F$DCB.FCD=%YES#;
      299    16525    3                  B$JIT.ERR='0'B;
      300    16526    3                  RETURN;
      301    16527    3                END;
      302    16528    3             IF NOT B$M$UC$->F$DCB.FCD THEN DO;
      303    16529                /*Can't tell what to do until UC gets open.*/
      304    16530    3                  B$JIT.DCB$=B$M$UC$;
      305    16531    3                  CALL FMM$DFLOPNP;
      306    16532    3                  B$JIT.DCB$=JDCB$;
      307    16533    3                  IF NOT B$M$UC$->F$DCB.FCD THEN
      308    16534    3                       GOTO CANTOPENUC;
      309    16535    3                  GOTO INITLOOP;
      310    16536    3                END;
      311    16537    2             B$ROSEG.CR01ID.NOWIS=B$JIT.NEXTCC;
      312    16538    2             B$ROSEG.CR01ID.INT=(B$JIT.NEXTCC=%CC_FROMUC#);
      313    16539    2             B$ROSEG.CR01DCB=POFFW(B$M$UC$,B$ROSEG$);
      314    16540    2           END;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:10   
      315    16541        /*D*       Now figure out where the DCB to be opened is hooked.
      316    16542                   Get DCB's Resource-Name field (RES).
      317    16543                   Encode DCB's FUN into F --
      318    16544                FUN=IN..F=1  FUN=UPDATE..F=0  FUN=CREATE..F=2.
      319    16545        */
      320    16546    1        RES=F$DCB.RES;
      321    16547    2        DO CASE(F$DCB.FUN);
      322    16548    2        CASE(%UPDATE#); F=0;
      323    16549    2        CASE( %IN#); F=1;
      324    16550    2        CASE(%CREATE#); F=2;
      325    16551    2        CASE(ELSE); F=0; F$DCB.FUN=%UPDATE#;
      326    16552    2        END;
      327    16553        /*D*       If DCB is assigned to a workstation (DCB.WSN non-blank),
      328    16554                it is to be attached directly to a symbiont file.  The
      329    16555                symbiont file creater is called to verify user accessibility
      330    16556                to the workstation.   This is the one shot case!
      331    16557        */
      332    16558    1        IF F$DCB.WSN~=' '
      333    16559    1             AND SUBSTR(RES,0,2) ~= 'FE'
      334    16560    1             AND SUBSTR(RES,0,2) ~= 'NC'
      335    16561    1             AND SUBSTR(RES,0,2) ~= 'OD'
      336    16562    2        THEN DO;
      337    16563    2             JIT$=B$JIT$;
      338    16564    2             F$DCB.ATTR='0'B;    /* Don't let leftovers interfere with WSN attrs */
      339    16565    3             IF PN$.PROCATTR_~=ADDR(NIL) THEN DO;
      340    16566    3                  IF B$JIT.SYSID=%JG_PRESCAN# OR B$JIT.SYSID=%JG_INSYM#
      341    16567    3                  THEN
      342    16568    3                       JIT$=PN$.PROCATTR_;
      343    16569    3                  PN$.PROCATTR_=ADDR(NIL);
      344    16570    3                END;
      345    16571    2             CALL FMD$GBUF(BUF$);
      346    16572    2             CALL FSW$DESTFORM(PN$.PROCATTR_,BUF$,JIT$) ALTRET(CANTDDWSN);
      347    16573    3             IF KL_WSNHDR.INDIRECT# THEN DO;
      348    16574    3                  B$JIT.DCB$=JDCB$;
      349    16575    3                  CALL FMF$REMOTE (PN$);
      350    16576    3                  GOTO CANTDDWSN;
      351    16577    3                END;                       /*  INDIRECT#  */
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:11   
      352    16578    3             IF F=1 THEN DO;               /*Symb file can't be IN.*/
      353    16579    3                  CALL FMD$RBUF (BUF$);
      354    16580    3                  GOTO BADFUN;
      355    16581    3                END;                       /*  F=1  */
      356    16582    2             F$DCB.PASS=' ';
      357    16583    2             F$DCB.PSN=' ';
      358    16584    2             F$DCB.FUN=%CREATE#;
      359    16585    2             F$DCB.COMP=%NO#;
      360    16586    2             F$DCB.DISP=%SAVE#;
      361    16587    2             F$DCB.ACS=%SEQUEN#;
      362    16588    2             F$DCB.ACCT=':SYMO';
      363    16589    2             I=F$DCB.ORG;
      364    16590    2             F$DCB.CODE16$=F$DCB.FORM$;
      365    16591    3             IF NOT PN$.V_->FPT$OPEN_V.OPER.TEST THEN DO;
      366    16592    3                  PN$.V_=ADDR(ZEROES);
      367    16593    3                  PN$.UATTR_=ADDR(NIL);
      368    16594    3                  PN$.INSTATTR_=ADDR(NIL);
      369    16595    3                  PN$.ACCESS_=ADDR(NIL);
      370    16596    3                  PN$.ACSVEH_=ADDR(NIL);
      371    16597    3                  PN$.SN_=ADDR(NIL);
      372    16598    3                  CALL FSF$SYMBFILE(BUF$,PN$,JIT$)ALTRET(CANTDDWSN);
      373    16599    3                END;
      374    16600    2             B$JIT.DCB$=JDCB$;
      375    16601    2             F$DCB.RES=RES;
      376    16602    2             IF I=%TERMINAL# AND NOT F$DCB.DDEV.LP THEN
      377    16603    2                  F$DCB.IFMT=FMTTTY#;
      378    16604    2             ELSE F$DCB.IFMT=FMTURDEV#;
      379    16605    2             IF FS$FORMREC.GRAPHIC
      380    16606    3             THEN DO;
      381    16607    3                  F$DCB.IFMT = FMTGR#;
      382    16608    3                  F$DCB.MEDIA = FMTSYMB#;
      383    16609    3                  F$DCB.DDEV = %DDEV_GR#;
      384    16610    3                  F$DCB.ORG = %UR#;
      385    16611    3                END;                       /* THIS WAS A GRAPHIC DEVICE FORM */
      386    16612    2             F$DCB.FFLG=%FFLG_WNEW#|%FFLG_DELF#;
      387    16613    2             CALL FMD$RBUF(BUF$);
      388    16614    2             B$JIT.ERR='0'B;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:12   
      389    16615    2             RETURN;
      390    16616    2   CANTDDWSNRES:;
      391    16617    2             F$DCB.WSN=' ';
      392    16618    2   CANTDDWSN: ;
      393    16619    2             B$JIT.DCB$=JDCB$;
      394    16620    2             F$DCB.RES=RES;
      395    16621    2             CALL FMD$RBUF(BUF$);
      396    16622    2             RETURN;
      397    16623    2           END;
      398    16624        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:13   
      399    16625        /*D*       If DCB is not to workstation, RES says where the DCB is
      400    16626                hooked.  RES must be a two or four character name.  There are
      401    16627                three major types of RES --
      402    16628                1.  Two-character Special Names --
      403    16629                      ME,CR,LP,CP,NO,SI,LO,PO,UC,JE,JF,C1,L1,P1.
      404    16630                      Depending on the name and on DCB.FUN, a Special Name DCB
      405    16631                      is hooked to Command stream, NO, JE, JF, Terminal, or
      406    16632                      Logical Device LP01 or CP01.
      407    16633
      408    16634                      For UC, MODE=M_INT & ORG=FPRG, the DCB is not streamed
      409    16635                      but is instead opened to a FEP user (created here) which
      410    16636                      is in control of the UC device.
      411    16637                2.  Four-character Logical Devices.
      412    16638                      Logical Devices are defined by !LDEV-M$LDEV; logical
      413    16639                      devices LP01 and CP01 are system-defined.
      414    16640                3.  Two- or four-character Resource Devices.
      415    16641                      Resource devices come in four flavors --
      416    16642                      DPxx is a Device Pack.  Diagnostic use only.
      417    16643                      FTxx,MTxx,LTxx is an unlabeled magnetic tape.  Tape
      418    16644                         drives are acquired on a !RESOURCE command.
      419    16645                         Tape device DCB's are opened by general tape code.
      420    16646                      FExx is used to start device handlers on FEP xx.
      421    16647                         This usage requires MFEP privilege.
      422    16648                      NC is a network connection.
      423    16649                         This connection is actually made by the KIS$OSI code.
      424    16650                      Other resource devices are acquired on a !RESOURCE
      425    16651                         command, and are opened here.
      426    16652        */
      427    16653    1        NEWSTREAM='0'B;
      428    16654    1        CALL INDEX(I,' ',RES);
      429    16655    2        DO CASE(I);
      430    16656    2        CASE(0,1,3);
      431    16657    2   BADRES: ;
      432    16658    2           B$JIT.ERR=ERR_INVRES;
      433    16659        /*E*    ERROR: FSN-E$INVRES-2
      434    16660                MESSAGE: Invalid resource specified in DCB %DC
      435    16661         */
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:14   
      436    16662    2           RETURN;
      437    16663    2        CASE(2);                      /* THIS IS FOR DEVICE WITH NO NUMBER IE LP */
      438    16664    2           IF SUBSTR(RES,2,2)~='  ' THEN GOTO BADRES;
      439    16665    2           CALL INDEX(I,SUBSTR(RES,0,2),
      440    16666    2                'ME CR LP LO NO CP PO UC JE JF SI C1 L1 P1 FE GR NC')
      441    16667    2                ALTRET(LBL_RDEV);
      442    16668    2           TSTFINFO=-1;
      443    16669    2           F$DCB.STR=STR;
      444    16670    3           DO CASE(I+F);
      445    16671    3           CASE(6,8/*LP-UPD,CRE*/,36,38/*L1-UPD,CRE*/);
      446    16672    3   LBL_LP:    RES='LP01';
      447    16673    3              CALL OPENLDEV ALTRET(ALTRETUR);
      448    16674    3           CASE(15,17/*CP-UPD,CRE*/,39,41/*P1-UPD,CRE*/);
      449    16675    3   LBL_CP:    RES='CP01';
      450    16676    3              CALL OPENLDEV ALTRET(ALTRETUR);
      451    16677    3           CASE(12,14/*NO-UPD,CRE*/);
      452    16678    3              F$DCB.FFLG=%FFLG_OWNER#;
      453    16679    3              IF JDCB$ = B$M$UC$ THEN
      454    16680    3                   F$DCB.UCOUT = %YES#;
      455    16681    3              GOTO LBL_NO;
      456    16682    3           CASE(13/*NO-IN*/);
      457    16683    3              F$DCB.FFLG=%FFLG_READ#;
      458    16684    3              GOTO LBL_NO;
      459    16685    3           CASE (45,47 /* GR UP, CR */ );  /*The GR IN case should error*/
      460    16686    3              RES = 'GR01';
      461    16687    3              F$DCB.IFMT = FMTGRSTRM#;
      462    16688    3              F$DCB.MEDIA = FMTSYMB#;
      463    16689    3              F$DCB.DDEV = %DDEV_GR#;
      464    16690    3              F$DCB.IASN = %STREAM#;
      465    16691    3              F$DCB.ORG = %UR#;
      466    16692    3              CALL OPENLDEV ALTRET (ALTRETUR);
      467    16693    3           CASE(9,11/*LO-UPD,CRE*/,2/*ME-CRE*/);
      468    16694                /*Batch LO=LP01, Interactive LO=M$UC.*/
      469    16695    3              IF NOT B$ROSEG.CR01ID.INT THEN GOTO LBL_LP;
      470    16696    3              F$DCB.FFLG=%FFLG_WNEW#;
      471    16697    3   LBL_UC:    ;
      472    16698    3              RES = CONV_STR(STR);
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:15   
      473    16699    3              CALL OPENLDEV ALTRET(ALTRETUR);
      474    16700    3           CASE(18,20/*PO-UPD,CRE*/);
      475    16701    3              IF B$JIT.MODE=%M_BATCH# THEN GOTO LBL_CP;
      476    16702    3              F$DCB.FFLG=%FFLG_WNEW#;
      477    16703    3              GOTO LBL_NO;
      478    16704    3           CASE(26/*JE-CRE*/,29/*JF-CRE*/);
      479    16705    3              CALL FSD$JEJFOPN(PN$) ALTRET(ALTRETUR);
      480    16706    3           CASE(21,23/*UC-UPD,CRE*/);
      481    16707    3              F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;
      482    16708                /*Batch UC=NO, Interactive UC=M$UC.*/
      483    16709    3              IF NOT B$ROSEG.CR01ID.INT THEN GOTO LBL_NO;
      484    16710    3              GOTO LBL_UC;
      485    16711    3           CASE(22/*UC-IN*/);
      486    16712    3              F$DCB.FFLG=%FFLG_READ#;
      487    16713                /*Batch UC=NO, Interactive UC=M$UC.*/
      488    16714    3              IF NOT B$ROSEG.CR01ID.INT THEN GOTO LBL_NO;
      489    16715    3              GOTO LBL_UC;
      490    16716    3           CASE(0/*ME-UPD*/);
      491    16717                /*Batch ME=CR/LP, Interactive ME=CR/M$UC.*/
      492    16718    4              IF NOT B$ROSEG.CR01ID.INT THEN DO;
      493    16719    4                   RES='LP01';
      494    16720    4                   CALL OPENLDEV ALTRET(ALTRETUR);
      495    16721    4                   F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;
      496    16722    4                   GOTO LBL_MEBI;
      497    16723    4                 END;
      498    16724    3              F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;
      499    16725    3              RES = CONV_STR(STR);
      500    16726    3              CALL OPENLDEV ALTRET (ALTRETUR);
      501    16727    3              IF F$DCB.ORG = %FPRG# AND B$JIT.MODE = %M_INT#
      502    16728    3              THEN
      503    16729    3                   GOTO ALL_DONE;
      504    16730    3              TSTFINFO=-1;       /* Don't trash the *X dcb if it's a TEST open */
      505    16731    3   LBL_MEII:  ;
      506    16732    4              IF B$ROSEG.CR01DCB=0 THEN DO;
      507    16733    4                   CALL FSD$C1GETDCB ALTRET(ALTRETUR);
      508    16734    4                   TSTFINFO=100;
      509    16735    4                 END;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:16   
      510    16736    3              F$DCB.CFU$=PINCRW(B$ROSEG$,B$ROSEG.CR01DCB);
      511    16737    4              IF B$JIT.NEXTCC=%CC_FROMXEQ# THEN DO;
      512    16738    4                   F$DCB.DDEV.IC='0'B;
      513    16739    4                   F$DCB.DDEV.XEQ='1'B;
      514    16740    4                 END;
      515    16741    4              ELSE DO;
      516    16742    4                   F$DCB.DDEV.IC=B$M$UC$->F$DCB.DDEV.IC;
      517    16743    4                 END;
      518    16744    3              F$DCB.UCOUT=B$M$UC$->F$DCB.UCOUT;
      519    16745    3              F$DCB.CTLCMDIN=%YES#;
      520    16746    3           CASE(1/*ME-IN*/,3,4/*CR-UPD,IN*/,
      521    16747    3                   30,31/*SI-UPD,IN*/,33,34/*C1-UPD,IN*/);
      522    16748    3              F$DCB.FFLG=%FFLG_READ#;
      523    16749    3              F$DCB.ORG=%UR#;
      524    16750    3              F$DCB.IASN=%STREAM#;
      525    16751    3              F$DCB.IFMT=FMTURSTRM#;
      526    16752                /*Batch ME=CR01, Interactive ME=UC/XEQ.*/
      527    16753    3              IF B$ROSEG.CR01ID.INT THEN GOTO LBL_MEII;
      528    16754    3              F$DCB.CFU$=PINCRW(B$ROSEG$,B$ROSEG.CR01DCB);
      529    16755    3   LBL_MEBI:  ;
      530    16756    3              IF B$JIT.NEXTCC=%CC_FROMXEQ# THEN
      531    16757    3                   F$DCB.DDEV.XEQ='1'B;
      532    16758    3              F$DCB.CTLCMDIN=%YES#;
      533    16759    3              CALL CHECK_COMP(STR) ALTRET (ALTRETUR);
      534    16760
      535    16761    3           CASE(42/*FE-UPD*/,43/*FE_IN*/,44/*FE_CRE*/);
      536    16762    3              IF F$DCB.ORG ~= %DBGCG# AND F$DCB.ORG ~= %DBGDCB#
      537    16763    4              THEN DO;
      538    16764    4                   IF F$DCB.WSN = ' '
      539    16765    4                   THEN
      540    16766    4                        GOTO BADFEP;
      541    16767    4                   ELSE
      542    16768    4                        CALL KIN$CONV_NODENAME(F$DCB.WSN,FEX,HOST)
      543    16769    5                        WHENALTRETURN DO;
      544    16770    5   BADFEP:                   ;
      545    16771    5                             B$JIT.ERR = ERR_BADFEP;
      546    16772                            /*E* ERROR: FSN-E$BAD_FEP-0
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:17   
      547    16773                                 MESSAGE: There is no FEP with that name.
      548    16774         */
      549    16775    5                             RETURN;
      550    16776    5                           END;
      551    16777    4                   IF HOST
      552    16778    4                   THEN
      553    16779    4                        GOTO BADFEP;
      554    16780    4                 END;
      555    16781    3              IF F$DCB.ORG = %HANDLER# OR F$DCB.ORG = %FPRG#
      556    16782    4              THEN DO;
      557    16783    4                   GOTO DO_FE;
      558    16784    4                 END;
      559    16785
      560    16786    3              IF F$DCB.ORG=%DBGDCB# OR F$DCB.ORG=%DBGCG#
      561    16787    3                   OR F$DCB.ORG = %DBGSYSID#
      562    16788    3              THEN CALL DBGFPRG ALTRET(ALTRETUR);
      563    16789    3              ELSE GOTO BADFUN;
      564    16790    3              F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;
      565    16791
      566    16792    3           CASE ( 48 /* NC-UPD */) ;
      567    16793
      568    16794    3              F$DCB.IASN = %DEVICE# ;
      569    16795    3              F$DCB.FFLG = %FFLG_READ# | %FFLG_WNEW# ;
      570    16796    3              F$DCB.ATTR.TRANSLGL = '1'B;
      571    16797    3              F$DCB.IFMT = FMTNC#;
      572    16798    3              F$DCB.MEDIA = FMTNC#;
      573    16799
      574    16800    3              CALL KIS$OSI_OPEN ALTRET (ALTRETUR);
      575    16801
      576    16802
      577    16803    3           CASE(ELSE);
      578    16804    3   BADFUN:    B$JIT.ERR=ERR_ILLIN;
      579    16805        /*E*    ERROR: FSN-E$ILLIN-2
      580    16806                MESSAGE: Conflicting FUN and RES used% for %UF%.
      581    16807                MESSAGE1:Output devices must not have FUN=IN.
      582    16808                         Input devices must not have FUN=CREATE.
      583    16809                         JE, JF, and FEnn must have FUN=CREATE.
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:18   
      584    16810                         FE and FEnn must have ORG={FPRG, HANDLER, or DBGx}.
      585    16811        */
      586    16812    3              RETURN;
      587    16813
      588    16814    3           END /*CASE(SPECIALNAME+FUN)*/;
      589    16815    2   MEBBETSTF:
      590    16816    3           IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN DO;
      591    16817    4                IF TSTFINFO>=0 AND F$DCB.CFU$ ~= B$M$UC$ THEN DO;
      592    16818    5                     IF TSTFINFO<16 THEN DO;
      593    16819    5                          CALL CHARBIN(I,ADDR(F$DCB.CFU$->F$DCB.NAME)->
      594    16820    5                               OSFN.NUM);
      595    16821    5                          B$ROSEG.STREAMID.IDENT(TSTFINFO)=I;
      596    16822    5                          B$ROSEG.STREAMID.FLG(TSTFINFO)=1;
      597    16823    5                          B$JIT.DCB$=F$DCB.CFU$;
      598    16824    5                          CALL FMP$CLSF(CLSSAVE$);
      599    16825    5                        END;
      600    16826    5                     ELSE DO;
      601    16827    5                          B$JIT.DCB$=F$DCB.CFU$;
      602    16828    5                          B$ROSEG.CR01DCB=0;
      603    16829    5                        END;
      604    16830    4                     CALL FSA$FDCB(B$JIT.DCB$);
      605    16831    4                   END;
      606    16832    3                B$JIT.ERR='0'B;
      607    16833    3                GOTO ALTRETUR;
      608    16834    3              END;
      609    16835    2        CASE(4);
      610    16836    2           TSTFINFO=-1;
      611    16837    2           CALL OPENLDEV ALTRET(ALTRETUR);
      612    16838    3           IF I<=15 THEN DO;
      613    16839    3                IF TSTFINFO>=0 THEN GOTO MEBBETSTF;
      614    16840    3              END;
      615    16841    3           ELSE DO;
      616    16842    3   LBL_RDEV:    CALL INDEX(I,SUBSTR(RES,0,2),
      617    16843    3                     'FT MT LT DP LP CP CR SY FT FE UC OD ');
      618    16844    4                DO CASE(I);
      619    16845    4                CASE(0,3,6/*TAPE*/);
      620    16846    4                   F$DCB.IASN=%TAPE#;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:19   
      621    16847    4                   CALL FTO$OPNAT(PN$);
      622    16848    4                   RETURN;
      623    16849    4                CASE(9/*PACK*/);
      624    16850    4                   CALL FMN$OPNDP(PN$);
      625    16851    4                   F$DCB.IFMT=FMTRAN#;     /* Make FMF$PMME work right */
      626    16852    4                   F$DCB.ORG=%RANDOM#;     /* Make UDE$FPTCHK work right */
      627    16853    4                   RETURN;
      628    16854    4                CASE(33/*Optical Disk*/);
      629    16855    4                   CALL FPO$OPNOD(PN$);
      630    16856    4                   RETURN;
      631    16857    4                CASE(12,15,36/*LP,CP or anything else*/);
      632    16858    5                   IF SUBSTR(RES,0,2)~='CL' THEN DO;
      633    16859    5                        IF F$DCB.HEADER$~=ADDR(NIL) THEN
      634    16860    5                             CALL FSM$HDRSET(F$DCB);
      635    16861    5                        CALL FMD$GBUF(BUF$);
      636    16862    5                        JIT$=ADDR(NIL);
      637    16863    5                        CALL FSW$DESTFORM(JIT$,BUF$,B$JIT$)ALTRET(CANTDDWSNRES);
      638    16864    5                        F$DCB.CODE16$=F$DCB.FORM$;
      639    16865    5                        F$DCB.PSN=F$DCB.FORM$->CODE16.FORM;
      640    16866    5                        F$DCB.WSN=' ';
      641    16867    5                      END;
      642    16868    5                   ELSE DO;
      643    16869    5                        IF PN$.V_->FPT$OPEN_V.ATTR
      644    16870    5                        THEN F$DCB.ATTR=PN$.V_->FPT$OPEN_V.ATTR;
      645    16871    5                        BUF$=ADDR(NIL);
      646    16872    5                      END;
      647    16873    4                   CALL FRA$OPR ALTRET(CANTDDWSNRES);
      648    16874    5                   IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN DO;
      649    16875    5   FRB_RTN:             ;
      650    16876    5                        CALL FRB$CLS;
      651    16877    5                        GOTO CANTDDWSN;
      652    16878    5                      END;
      653    16879    4                   LDCT$ = NK$LDCT$(F$DCB.SETX);
      654    16880    4                   IF LDCT$->NK$LDCT.RESCOD ~= NK_RES
      655    16881    5                   THEN DO;
      656    16882    5                        F$DCB.FFLG=%FFLG_WNEW#;
      657    16883    5                        F$DCB.MEDIA=FMTDEV#;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:20   
      658    16884    5                        F$DCB.IFMT=FMTURDEV#;
      659    16885    5                        F$DCB.WAIT=1;
      660    16886    5                        F$DCB.TYC(1)='0'B;
      661    16887    5                        F$DCB.UB$=ADDR(FS$FORMREC.SOFTFORM);
      662    16888    5                        F$DCB.UBYTES=SIZEC(FS$FORMREC.SOFTFORM);
      663    16889    5                        CALL NKA$DEVIO(MFC_WRITE,
      664    16890    5                             %DVBYTE_TRANS#|%DVBYTE_VFC#|%DVBYTE_BP#,
      665    16891    5                             %VFC_VFU,0);
      666    16892    5                      END;
      667    16893    5                   ELSE DO;
      668    16894    5                        IF SUBSTR(RES,0,2)='CL'
      669    16895    6                        THEN DO;
      670    16896    7                             IF F$DCB.IORG=%UNDEF# THEN DO;
      671    16897        /* FRA set IORG to indicate unknown status - AKA ask the AU for permission */
      672    16898    7                                  CALL FRF$EVRPT;
      673    16899    7                                  IF F$DCB.EVENT~=0 THEN GOTO FRB_RTN;
      674    16900    7                                  I=NK$LDCT.GENERATION;
      675    16901    8                                  DO UNTIL F$DCB.SETX~=NK$LDCT.LDCTX;
      676    16902    8                                       IF NK$LDCT.GENERATION~=I OR NK$LDCT.RAT$=ADDR(
             16902                                                NIL)
      677    16903    8                                       THEN F$DCB.SETX=0;
      678    16904    8                                       CALL SSR$REG (%SS_SL,ADDR(NIL),1);
      679    16905    8                                     END;
      680    16906    7   OPNCL_EVT:                     IF F$DCB.SETX=0 THEN GOTO FRB_RTN;
      681    16907    7                                END; ELSE IF F$DCB.IORG=%VARIABLE# THEN DO;
      682    16908        /* IORG is VARIABLE if only the Fep needs to be asked */
      683    16909    8                                       CALL NKL$GETDCT (JIT$) WHENALTRETURN DO;
      684    16910    8                                            B$JIT.ERR=ERR_PCNLDCT;
      685    16911    8                                            GOTO FRB_RTN;
      686    16912    8                                          END;
      687    16913    7                                       JIT$->NK$LDCT.RAT$=NK$LDCT.RAT$;
      688    16914    7                                       JIT$->NK$LDCT.TERMID=NK$LDCT.TERMID;
      689    16915    7                                       JIT$->NK$LDCT.RESCOD=NK_RES;
      690    16916    7                                       JIT$->NK$LDCT.DFLG=NK$LDCT.DFLG;
      691    16917    7                                       JIT$->NK$LDCT.DFLG.INPUT='1'B;
      692    16918    7                                       JIT$->NK$LDCT.DEVNM='*CLRES*';
      693    16919    7                                       RLCID.NODE=K_NODE#;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:21   
      694    16920    7                                       RLCID.LDCTX=JIT$->NK$LDCT.LDCTX+
      695    16921    7                                            BITBIN('777400'O &
      696    16922    7                                            BINBIT(JIT$->NK$LDCT.LDCTX,18));
      697    16923    7                                       RLCID.GENERATION=JIT$->NK$LDCT.GENERATION;
      698    16924                                            %LOCK (G=NK$LDCT.LOCK);
      699    16927    7                                       JIT$->NK$LDCT.CLLNK$=NK$LDCT.CLLNK$;
      700    16928    7                                       NK$LDCT.CLLNK$=JIT$;
      701    16929    8                                       DO WHILE '1'B;
      702    16930    8                                            IF NK$LDCT.USER=0 THEN NK$LDCT.USER=B$JIT.
             16930                                                     USER;
      703    16931                                                 %UNLOCK (G=NK$LDCT.LOCK);
      704    16934    8                                            IF NK$LDCT.USER=B$JIT.USER THEN EXIT;
      705    16935    8                                            CALL SSR$REG (%SS_SL,ADDR(NIL),1);
      706    16936                                                 %LOCK (G=NK$LDCT.LOCK);
      707    16939    8                                          END;
      708    16940    7                                       IF F$DCB.DISP~=%RELEASE# OR NK$LDCT.DCBNO=0
      709    16941        /* RELEASE is used only by an AU to refuse an open without asking the Fep */
      710    16942    7                                       THEN CALL KIA$UCIOND (MFC_WRITE,
      711    16943    7                                                 %DVBYTE_TRANS#|%DVBYTE_RRR#,'@',,
      712    16944    7                                                 ADDR(RLCID),4,NK$LDCT);
      713    16945    7                                       ELSE B$JIT.ERR='1'B; /* Flag so we know */
      714    16946    7                                       IF NK$LDCT.DCBNO=0 THEN NK$LDCT.USER=0;
      715    16947    7                                       LDCT$=JIT$;
      716    16948    7                                       F$DCB.SETX=NK$LDCT.LDCTX;
      717    16949    7                                       F$DCB.LDCTX=NK$LDCT.LDCTX;
      718    16950    8                                       IF NK$LDCT.RLCID='0'B THEN DO;
      719    16951    8                                            NK$LDCT.DFLG.PRLS='1'B;
      720    16952    8                                            NK$LDCT.DFLG.FEDN='1'B;
      721    16953    8                                            NK$LDCT.USER=B$JIT.USER;
      722    16954    8                                            IF B$JIT.ERR='1'B THEN GOTO AU_RELEASE;
      723    16955    8   FSP_RTN:                                 CALL FSP$CLSDEV (ADDR(NIL));
      724    16956    8                                            GOTO CANTDDWSN;
      725    16957    8                                          END;
      726    16958    7                                     END;
      727    16959    6                             NK$LDCT.USER=B$JIT.USER;
      728    16960    6                             NK$LDCT.DCBNO=F$DCB.DCB#;
      729    16961    6                           END;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:22   
      730    16962    5                        F$DCB.MEDIA = FMTUC#;
      731    16963    5                        F$DCB.IASN = %DEVICE#;
      732    16964    5                        F$DCB.IFMT = FMTTTY#;
      733    16965    5                        IF NK$LDCT.DFLG.INPUT THEN F$DCB.FFLG.READ = '1'B;
      734    16966    5                        IF NK$LDCT.DFLG.OUTPUT THEN F$DCB.FFLG.WNEW = '1'B;
      735    16967    5                        IF F$DCB.DVFC=BINASC(0) THEN F$DCB.DVFC = '@';
      736    16968    5                        F$DCB.LDCTX = F$DCB.SETX;
      737    16969    5                        F$DCB.STR = KIDM_CP;
      738    16970    5                        IF F$DCB.ORG = %FPRG#
      739    16971    6                        THEN DO;
      740    16972    6                             FEX = LDCT$->NK$LDCT.RLCID.NODE;
      741    16973    6                             CALL FPRG(%G_M_USER#,FEX,KIDM_CP,F$DCB)
      742    16974    6                                  ALTRET(FSP_RTN);
      743    16975    6                           END;
      744    16976    6                        ELSE DO;
      745    16977    6                             CALL KIA$OPNSSN(LDCT$->NK$LDCT) ALTRET(FSP_RTN);
      746    16978    6                           END;
      747    16979    5                      END;
      748    16980    4   AU_RELEASE:     ;
      749    16981    4                   CALL FMD$RBUF(BUF$);
      750    16982    4                CASE(18/*CR*/);
      751    16983    4                   GOTO BADRES;
      752    16984    4                CASE(21/*SY*/);
      753    16985    4                   IF RES~='SYMO' THEN GOTO BADRES;
      754    16986    4                   IF NOT B$JIT.PRIV.ACTIVE &
      755    16987    4                        %(PR_FMEFT#|PR_FMBLK#|PR_FMSEC#) THEN
      756    16988    4                        GOTO BADFUN;
      757    16989    4                   IF F=1 OR F$DCB.ACS~=%BLOCK# THEN GOTO BADFUN;
      758    16990    4                   GOTO BADRES;
      759    16991    4                CASE(27/*FE*/);
      760    16992    4                   IF F~=2 THEN GOTO BADFUN;
      761    16993    4                   IF ( (ASCBIN( SUBSTR( RES, 2, 1)) < ASCBIN ('0'))OR
      762    16994    4                        (ASCBIN( SUBSTR( RES, 2, 1)) > ASCBIN ('9'))OR
      763    16995    4                        (ASCBIN( SUBSTR( RES, 3, 1)) < ASCBIN ('0'))OR
      764    16996    4                        (ASCBIN( SUBSTR( RES, 3, 1)) > ASCBIN ('9')) )
      765    16997    4                   THEN GOTO BADRES;       /* ONLY 2 DIGITS ARE ALLOWED */
      766    16998    4                   CALL CHARBIN(FEX,SUBSTR(RES,2,2));
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:23   
      767    16999    4                   CALL KIN$CONV_NODE(F$DCB.WSN,FEX,HOST) ALTRET(BADFEP);
      768    17000    4                   IF HOST
      769    17001    4                   THEN
      770    17002    4                        GOTO BADFEP;
      771    17003    5                   DO CASE(F$DCB.ORG);
      772    17004    5                   CASE(ELSE);
      773    17005    5                      GOTO BADFUN;
      774    17006    5                   CASE(%DBGDCB#,%DBGCG#,%DBGSYSID#);
      775    17007    5                      CALL DBGFPRG ALTRET(ALTRETUR);
      776    17008    5                   CASE(%HANDLER#,%FPRG#);
      777    17009    5   DO_FE:             ;
      778    17010    5                      IF NOT (B$JIT.PRIV.ACTIVE.MFEP)
      779    17011    5                           AND F$DCB.ORG = %HANDLER#
      780    17012    6                      THEN DO;
      781    17013    6                           B$JIT.ERR=ERR_NOTAUTH;
      782    17014        /*E*   ERROR: FSN-E$NOTAUTH-2
      783    17015             MESSAGE: ORG=HANDLER requires MFEP privilege.
      784    17016            MESSAGE1: You tried to M$OPEN %%DC %with ASN=DEVICE, RES=FExx,
      785    17017                      and ORG=HANDLER without the MFEP privilege active.
      786    17018        */
      787    17019    6                           RETURN;
      788    17020    6                         END;
      789    17021    5                      F$DCB.FFLG = %FFLG_WNEW# | %FFLG_READ#;
      790    17022    5                      F$DCB.IFMT = FMTFPRG#;
      791    17023    5                      F$DCB.MEDIA = FMTFPRG#;
      792    17024    5                      NEWSTREAM='1'B;
      793    17025    5                      IF F$DCB.ORG = %HANDLER#
      794    17026    5                      THEN
      795    17027    5                           I = %G_M_HANDLER#;
      796    17028    5                      ELSE
      797    17029    5                           I = %G_M_GHOST#;
      798    17030    5                      CALL FPRG(I,FEX,0)
      799    17031    6                      WHENALTRETURN DO;
      800    17032    6                           GOTO ALTRETUR;
      801    17033    6                         END;
      802    17034    5                   END;                    /*CASE*/
      803    17035    4                   GOTO MEBBETSTF;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:24   
      804    17036
      805    17037
      806    17038    4                CASE (30);                 /* UC stream */
      807    17039    4                   IF ( (ASCBIN( SUBSTR( RES, 2, 1)) < ASCBIN ('0'))OR
      808    17040    4                        (ASCBIN( SUBSTR( RES, 2, 1)) > ASCBIN ('9'))OR
      809    17041    4                        (ASCBIN( SUBSTR( RES, 3, 1)) < ASCBIN ('0'))OR
      810    17042    4                        (ASCBIN( SUBSTR( RES, 3, 1)) > ASCBIN ('9')) )
      811    17043    4                   THEN GOTO BADRES;       /* ONLY 2 DIGITS ARE ALLOWED */
      812    17044    4                   F$DCB.FFLG = %FFLG_WNEW# | %FFLG_READ#;
      813    17045    5                   IF NOT B$ROSEG.CR01ID.INT THEN DO;
      814    17046    5   LBL_NO:              F$DCB.IFMT=FMTNO#;
      815    17047    5                        F$DCB.MEDIA=FMTNO#;
      816    17048    5                        F$DCB.IASN=0;
      817    17049    6                        IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN DO;
      818    17050    6                             CALL FSP$CLSDEV(ADDR(NIL));
      819    17051    6                             B$JIT.ERR = '0'B;
      820    17052    6                             GOTO GETOUT;
      821    17053    6                           END;
      822    17054    5                        GOTO ALL_DONE;
      823    17055    5                      END;
      824    17056    4                   CALL CHARBIN (I,SUBSTR(RES,2,2));
      825    17057    4                   I = I + 20;   /* Make stream number greater than LDEVable */
      826    17058    4                   F$DCB.FPSTR = I;   /* So FSP knows stream to delete if FPRG */
      827    17059    4                   B$JIT.DCB$ = B$M$UC$;
      828    17060    4                   IF B$M$UC$->F$DCB.MEDIA = FMTUC#
      829    17061    4                        AND NOT B$ROSEG.STREAM_VALID(I)
      830    17062    5                   THEN DO;
      831    17063    5                        NEWSTREAM = '1'B;
      832    17064    5                        ORG = KIDM_USER;
      833    17065    5                        IF PN$.WINDOW_~=ADDR(NIL) AND F$DCB.UOPT(1)
      834    17066    6                        THEN DO;
      835    17067    6                             CALL FSN$CONV_STR
      836    17068    6                                  (PN$.WINDOW_->VLP$WINDOW.FWINDOW#,ORGSTR.BYT)
      837    17069    6                                  ALTRET(ALTRETUR);
      838    17070    6                           END;
      839    17071    5                        CALL KIA$DCLSTR (ORG,I) ALTRET(ALTRETUR);
      840    17072    5                      END;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:25   
      841    17073    4                   ELSE
      842    17074    4                        NEWSTREAM = '0'B;
      843    17075    4                   CALL MOVEINFO
      844    17076    5                   WHENALTRETURN DO;
      845    17077    5                        IF NEWSTREAM
      846    17078    5                        THEN
      847    17079    5                             CALL KIA$CLSSTR (I,'1'B,'0'B);
      848    17080    5                        GOTO ALTRETUR;
      849    17081    5                      END;
      850    17082    4                END;
      851    17083    3              END;
      852    17084    2        END /*CASE(RES length)*/;
      853    17085    1        IF ADDR(F$DCB.CFU$)->BPTR.SEGID='006003'O
      854    17086    2        THEN DO;
      855    17087    2             IF F$DCB.CFU$->F$DCB.ASN=%COMGROUP#
      856    17088    3             THEN DO;
      857    17089    3                  CALL CGINIT ALTRET(GETOUT);
      858    17090    3                END;
      859    17091    2           END;
      860    17092    1   ALL_DONE: ;
      861    17093    1        B$JIT.DCB$=JDCB$;
      862    17094    1        F$DCB.FCD=%YES#;
      863    17095    1        B$JIT.ERR='0'B;
      864    17096    1        IF F$DCB.IASN = %FPRGIASN#
      865    17097    2        THEN DO;
      866    17098    2             CALL FMD$RELBUF (0);
      867    17099    2             CALL KIF$FPRGR;
      868    17100    3             IF B$JIT.ERR.CODE~=0 THEN DO;
      869    17101    3                  ERRCODE=B$JIT.ERR;
      870    17102    3                  CALL FSP$CLSDEV(ADDR(NIL));
      871    17103    3                  B$JIT.ERR=ERRCODE;
      872    17104    3                END;
      873    17105    2           END;
      874    17106    1        RETURN;
      875    17107    1   CANTOPENUC:;
      876    17108    1        IF B$JIT.ERR.CODE=0 THEN
      877    17109    1             B$JIT.ERR=ERR_INVRES;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:26   
      878    17110    1   ALTRETUR: ;
      879    17111    1   GETOUT: ;
      880    17112    1        B$JIT.DCB$=JDCB$;
      881    17113    1        RETURN;
      882    17114        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:27   
      883    17115    1   FSN$OPNCL_EVT: ENTRY(PN$);
      884    17116        /*F* NAME: FSN$OPNCL_EVT
      885    17117             DESCRIPTION: Entered from FRF$OPNCL_EVT for a DCB with a no_wait
      886    17118             open pending, to get the rest of the open protocol done.
      887    17119        */
      888    17120    1        JDCB$ = ADDR(PN$);
      889    17121    1        LDCT$ = NK$LDCT$(F$DCB.SETX);
      890    17122    1        GOTO OPNCL_EVT;
      891    17123        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:28   
      892    17124    1   OPENLDEV: PROC ALTRET;
      893    17125    2        I=0;
      894    17126    3        DO WHILE (I<16);
      895    17127    3             IF B$ROSEG.LDEVNAME(I)=RES THEN GOTO FOUND;
      896    17128    3             I=I+1;
      897    17129    3           END;
      898    17130    2        IF (RES ~= 'CP01' AND
      899    17131    2             RES ~= 'GR01')
      900    17132    3        THEN DO;
      901    17133    3             RETURN;
      902    17134    3           END;
      903    17135    3        DO I=0 TO 15;
      904    17136    4             IF B$ROSEG.LDEVNAME(I)='    ' THEN DO;
      905    17137    4                  B$ROSEG.LDEVNAME(I) = RES;
      906    17138    4                  GOTO FOUND;
      907    17139    4                END;
      908    17140    3           END;
      909    17141    2        B$JIT.ERR=ERR_NOSTREAMS;
      910    17142        /*E*    ERROR: FSN-E$LDEVNOSTREAMS-2
      911    17143                MESSAGE: You can't use CP01 or GR01 at this time.
      912    17144                MESSAGE1: All Logical Device slots are in use.  To use CP01 or GR01,
      913    17145                          LDEV (REMOVE) one of your Logical Devices.
      914    17146         */
      915    17147    2   ALTRETUR: ALTRETURN;
      916    17148    2   ARCLLD: ;
      917    17149    2        PN$.V_=JIT$;
      918    17150    2        CALL FMD$RBUF(BUF$);
      919    17151    2        B$ROSEG.STREAMID(I)='0'B;
      920    17152    2        GOTO ALTRETUR;
      921    17153    2   FOUND: ;
      922    17154    3        IF F=1 AND NOT B$ROSEG.STREAMID.UC_STR(I) THEN DO;
      923    17155    3             B$JIT.ERR=ERR_ILLIN;
      924    17156    3             ALTRETURN;
      925    17157    3           END;
      926    17158        /*
      927    17159         *       'I' is the stream number.  Stream's flag value tells
      928    17160         *       us what kind of shape the stream is in:
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:29   
      929    17161         *           0 - Stream is currently undefined.  (This is the
      930    17162         *                case for LP01 and CP01 at user startup).
      931    17163         *           1 - Stream is defined but not open.  We must make
      932    17164         *                a stream DCB.  Stream's IDENT combined with
      933    17165         *                our user I.D. gives file name for stream.
      934    17166         *           2 - Stream currently has an open dcb.  Stream's
      935    17167         *                IDENT is displacement to stream DCB.
      936    17168         */
      937    17169    3        DO CASE(B$ROSEG.STREAMID.FLG(I));
      938    17170    3        CASE(0);                           /* STREAM IS UNDEFINED                */
      939    17171    3           CALL FSB$STREAMCREATE(I) ALTRET(ALTRETUR);
      940    17172    3           CALL FMD$GBUF(BUF$);
      941    17173    3           PN$.PROCATTR_=ADDR(NIL);
      942    17174    3           JIT$=PN$.V_;
      943    17175    3           CALL FSW$DESTFORM(PN$.PROCATTR_,BUF$,B$JIT$)ALTRET(ARCLLD);
      944    17176    3           PN$.V_=ADDR(ZEROES);
      945    17177                   /*N* OUGHTA BE REPLACED BY CALL TO FSL */
      946    17178    3           LDEVUATTR='0'B;
      947    17179    3           LDEVUATTR.NDW=SIZEW(LDEVUATTR)-1;
      948    17180    3           LDEVUATTR.NAW=LDEVUATTR.NDW+SIZEW(LDEVPLUSTAB)+
      949    17181    3                SIZEW(LDEVPLUSHDR);
      950    17182    3           PN$.UATTR_=ADDR(LDEVUATTR);
      951    17183    3           PN$.INSTATTR_=ADDR(NIL);
      952    17184    3           PN$.ACCESS_=ADDR(NIL);
      953    17185    3           PN$.ACSVEH_=ADDR(NIL);
      954    17186    3           PN$.SN_=ADDR(NIL);
      955    17187    3           CALL FSF$SYMBFILE(BUF$,PN$,B$JIT$)ALTRET(ARCLLD);
      956    17188    3           CALL FMD$RBUF(BUF$);
      957    17189    3           B$JIT.DCB$->F$DCB.WSN=B$JIT.WOO;
      958    17190    3           B$JIT.DCB$->F$DCB.RES=SUBSTR(B$ROSEG.LDEVNAME(I),0,2);
      959    17191    3           PN$.V_=JIT$;
      960    17192    3           TSTFINFO=I;
      961    17193    3           NEWSTREAM='1'B;
      962    17194    3        CASE(1);                      /* STREAM IS DEFINED BUT NO DCB IS OPEN    */
      963    17195    3           NEWSTREAM='1'B;
      964    17196    3           TSTFINFO=I;
      965    17197    3           IF NOT B$ROSEG.STREAMID.UC_STR(I)
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:30   
      966    17198    4           THEN DO;
      967    17199    4                CALL FSB$STREAMDCB(I) ALTRET(ALTRETUR);
      968    17200                /* Note: STREAMDCB sets B$JIT.DCB$ -> Stream DCB     */
      969    17201    4              END;
      970    17202    4           ELSE DO;
      971    17203    4                B$ROSEG.STREAMID.FLG(I) = 2;
      972    17204    4                B$JIT.DCB$ = B$M$UC$;
      973    17205    4                B$ROSEG.STREAMID.IDENT(I) = POFFW(B$M$UC$,B$ROSEG$);
      974    17206    4              END;
      975    17207    3        CASE(2);                           /* STREAM HAS OPEN DCB                */
      976    17208    3           B$JIT.DCB$= PINCRW(B$ROSEG$,B$ROSEG.STREAMID.IDENT(I));
      977    17209    3        END;
      978    17210    2        IF B$ROSEG.STREAMID.UC_STR(I)
      979    17211    2        THEN
      980    17212    2             F$DCB.FFLG = %FFLG_WNEW# | %FFLG_READ#;
      981    17213    2        ELSE
      982    17214    2             F$DCB.FFLG=%FFLG_WNEW#;
      983    17215    2   MOVEINFO: ENTRY ALTRET;
      984    17216    2        F$DCB.CFU$=B$JIT.DCB$;
      985    17217    2        IF B$JIT.DCB$->F$DCB.MEDIA = FMTUC#
      986    17218    3        THEN DO;
      987    17219    3             F$DCB.STR = I;
      988    17220    3             ORG = F$DCB.ORG;
      989    17221    3             CALL CHECK_COMP(I) ALTRET(ALTRETUR);
      990    17222    3             WINDOW = FS_WINDOW;
      991    17223    3             IF PN$.WINDOW_ ~= ADDR(NIL)
      992    17224    4             THEN DO;
      993    17225    4                  WINDOW = PN$.WINDOW_->VLP$WINDOW;
      994    17226    4                  IF B$ROSEG.STREAMID.WINDOW(I) AND I<20
      995    17227    4                  THEN
      996    17228    4                       WINDOW.POSITION# = 0;
      997    17229    4                END;
      998    17230    3             ELSE
      999    17231    3                  IF NOT NEWSTREAM
     1000    17232    3                       OR (ORG ~= %SE# AND ORG ~= %FORM#)
     1001    17233    3                  THEN GOTO JUSTOPNIT;     /* No window required or specified */
     1002    17234    3                  ELSE
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:31   
     1003    17235    3                       IF I <= KIDM_USER   /* No FORM or SE in standard streams */
     1004    17236    4                       THEN DO;
     1005    17237    4                            B$JIT.ERR = ERR_ORGNOTCOM;
     1006    17238    4                            GOTO ALTRETUR;
     1007    17239    4                          END;
     1008    17240    3             CALL KIA$WINDOW(I,WINDOW);
     1009    17241    3             IF I<16
     1010    17242    3             THEN
     1011    17243    3                  B$ROSEG.STREAMID.WINDOW(I) = '1'B;
     1012    17244    3   JUSTOPNIT: ;
     1013    17245    3             IF NEWSTREAM
     1014    17246    3             THEN
     1015    17247    3                  CALL KIA$OPNSTR (I, F$DCB)
     1016    17248    4                  WHENALTRETURN DO;
     1017    17249    4                       IF B$JIT.ERR.CODE ~= %E$BYD
     1018    17250    4                       THEN
     1019    17251    4                            GOTO ALTRETUR;
     1020    17252    4                     END;
     1021    17253    3           END;
     1022    17254    2        IF ((F$DCB.ORG ~= %FPRG#) OR
     1023    17255    2             (F$DCB.CFU$->F$DCB.ORG ~= %TERMINAL#))
     1024    17256    3        THEN DO;
     1025    17257    3             F$DCB.IASN=%STREAM#;
     1026    17258        /*      First copy stuff common to all formatting types.*/
     1027    17259    3             F$DCB.UCOUT=F$DCB.CFU$->F$DCB.UCOUT;
     1028    17260    3             F$DCB.DDEV=F$DCB.CFU$->F$DCB.DDEV;
     1029    17261    3             F$DCB.SETX=F$DCB.CFU$->F$DCB.SETX;
     1030    17262    3             F$DCB.WIDTH=F$DCB.CFU$->F$DCB.WIDTH;
     1031    17263    3             F$DCB.ATTR=F$DCB.CFU$->F$DCB.ATTR;
     1032    17264    3             F$DCB.CODE16$=F$DCB.CFU$->F$DCB.FORM$;
     1033    17265    3           END;
     1034    17266    2        IF F$DCB.FORM$~=ADDR(NIL) THEN
     1035    17267    2             CALL FSA$FSP(SIZEW(CODE16),F$DCB.FORM$);
     1036    17268
     1037    17269        /*      Then do formatter-specific stuff.*/
     1038    17270    3        DO CASE(F$DCB.CFU$->F$DCB.ORG);
     1039    17271    3        CASE(%FPRG#);
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:32   
     1040    17272    3           F$DCB.ORG=%FPRG#;
     1041    17273    3           F$DCB.IFMT=FMTFPSTRM#;
     1042    17274    3           F$DCB.FFLG = %FFLG_WNEW# | %FFLG_READ#;
     1043    17275    3           RETURN;
     1044    17276    3        CASE(%TERMINAL#);
     1045    17277    3           IF F$DCB.ORG = %FPRG# AND F$DCB.CFU$->F$DCB.LDCTX ~= 0
     1046    17278    3                AND B$JIT.MODE = %M_INT#
     1047    17279    3                AND F$DCB.CFU$->F$DCB.LDCTX = F$DCB.CFU$->F$DCB.SETX
     1048    17280    4           THEN DO;
     1049    17281    4                FEX = NK$LDCT$(F$DCB.CFU$->F$DCB.LDCTX)->NK$LDCT.RLCID.NODE;
     1050    17282    4                CALL FPRG(%G_M_USER#,FEX,I,F$DCB.CFU$->F$DCB) ALTRET(ALTRETUR);
     1051    17283    4                RETURN;
     1052    17284    4              END;
     1053    17285    3           IF F$DCB.ORG = %SE#
     1054    17286    3           THEN F$DCB.FFLG.DELR = '1'B;
     1055    17287    3           IF F$DCB.ORG=%TERMINAL# OR F$DCB.ORG = %SE# OR
     1056    17288    3                F$DCB.ORG = %X364# OR F$DCB.ORG = %FORM#
     1057    17289    4           THEN DO;
     1058    17290    4                F$DCB.IFMT=FMTTTYSTRM#;
     1059    17291    4                F$DCB.MEDIA=FMTUC#;
     1060    17292    4              END;
     1061    17293    3           ELSE GOTO ALSOUR;
     1062    17294    3        CASE(%SYMB#);
     1063    17295    3           IF F$DCB.CFU$->F$DCB.IFMT = FMTGRSTRM#
     1064    17296    3           THEN GOTO GRSTRM;
     1065    17297    3           ELSE IF (F$DCB.ORG=%TERMINAL# AND
     1066    17298    3                     NOT F$DCB.DDEV.LP)
     1067    17299    4                THEN DO;
     1068    17300    4                     F$DCB.IFMT=FMTTTYSTRM#;
     1069    17301    4                   END;
     1070    17302    3                ELSE GOTO ALSOUR;
     1071    17303    3        CASE(%UR#,ELSE);
     1072    17304    4   ALSOUR: IF F$DCB.CFU$->F$DCB.ASN=%COMGROUP# THEN DO;
     1073    17305    4                F$DCB.ORG=%TERMINAL#;
     1074    17306    4                F$DCB.IFMT=FMTTTYSTRM#;
     1075    17307    4                F$DCB.IASN = %STREAM#;     /* Just in case DCB.ORG was FPRG */
     1076    17308    4              END;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:33   
     1077    17309    4           ELSE DO;
     1078    17310    4                F$DCB.ORG=%UR#;
     1079    17311    4                F$DCB.IFMT=FMTURSTRM#;
     1080    17312    4              END;
     1081    17313    3           IF F$DCB.CFU$->F$DCB.IFMT = FMTGRSTRM#
     1082    17314    4           THEN DO;
     1083    17315    4   GRSTRM:      ;
     1084    17316    4                F$DCB.IFMT = FMTGRSTRM#;
     1085    17317    4                F$DCB.DDEV = %DDEV_GR#;
     1086    17318    4                F$DCB.MEDIA = FMTSYMB#;
     1087    17319    4              END;
     1088    17320    3           IF NOT F$DCB.SEQ THEN
     1089    17321    3                F$DCB.IWL.SEQIWL=F$DCB.CFU$->F$DCB.IWL.SEQIWL;
     1090    17322    3           IF F$DCB.HEADER$=ADDR(NIL) THEN
     1091    17323    3                F$DCB.IWL.HDRIWL=F$DCB.CFU$->F$DCB.IWL.HDRIWL;
     1092    17324    3           ELSE
     1093    17325    3                CALL FSM$HDRSET(F$DCB);
     1094    17326    3        END;
     1095    17327        /*      Then do stuff common to UR and TTY.*/
     1096    17328    2   XIT:
     1097    17329    2        IF F$DCB.DVFC=BINASC(0) THEN
     1098    17330    2             F$DCB.DVFC=F$DCB.CFU$->F$DCB.DVFC;
     1099    17331    2        IF F$DCB.LINES=0 OR F$DCB.LINES>F$DCB.CFU$->F$DCB.LINES THEN
     1100    17332    2             F$DCB.LINES=F$DCB.CFU$->F$DCB.LINES;
     1101    17333    2        IF F$DCB.TAB$=ADDR(NIL) THEN
     1102    17334    2             F$DCB.IWL.TABIWL=F$DCB.CFU$->F$DCB.IWL.TABIWL;
     1103    17335    2        RETURN;
     1104    17336    2   END OPENLDEV;
     1105    17337        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:34   
     1106    17338    1   CHECK_COMP: PROC (STR) ALTRET;
     1107    17339
     1108    17340    2   DCL STR UBIN;
     1109    17341    2   DCL I SBIN;
     1110    17342
     1111    17343    2        I = B$ROSEG.NUMDCBS;
     1112    17344    3        DO WHILE (I>=0);
     1113    17345    3             IF DCBADDR(I) ~= ADDR(NIL) AND DCBADDR(I)->F$DCB.CFU$ = F$DCB.CFU$
     1114    17346    3                  AND DCBADDR(I)->F$DCB.FCD AND DCBADDR(I)->F$DCB.IASN = %STREAM#
     1115    17347    3             THEN
     1116    17348    3                  IF DCBADDR(I)->F$DCB.STR = STR
     1117    17349    4                  THEN DO;
     1118    17350    4                       NEWSTREAM = '0'B;
     1119    17351    5                       DO CASE (F$DCB.ORG);
     1120    17352
     1121    17353    5                       CASE (%FORM#,%SE#);
     1122    17354    5                          B$JIT.ERR = ERR_ORGNOTCOM;
     1123    17355    5                          ALTRETURN;
     1124    17356
     1125    17357    5                       CASE (%TERMINAL#,%UR#);
     1126    17358    5                          IF DCBADDR(I)->F$DCB.ORG ~= %UR# AND
     1127    17359    5                               DCBADDR(I)->F$DCB.ORG ~= %TERMINAL#
     1128    17360    6                          THEN DO;
     1129    17361    6                               B$JIT.ERR = ERR_ORGNOTCOM;
     1130    17362    6                               ALTRETURN;
     1131    17363    6                             END;
     1132    17364    5                       CASE (%X364#);
     1133    17365    5                          IF DCBADDR(I)->F$DCB.ORG ~= %X364#
     1134    17366    6                          THEN DO;
     1135    17367    6                               B$JIT.ERR = ERR_ORGNOTCOM;
     1136    17368                  /*E* ERROR: FSN-%E$ORGNOTCOM-0
     1137    17369                       MESSAGE: The ORG is not compatible.
     1138    17370                       MESSAGE1: The organization specified on the M$OPEN is not
     1139    17371                                 compatible with a DCB already opened to this stream.
     1140    17372          */
     1141    17373    6                               ALTRETURN;
     1142    17374    6                             END;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:35   
     1143    17375    5                       END;
     1144    17376    4                     END;
     1145    17377    3             I = I - 1;
     1146    17378    3           END;
     1147    17379    2        RETURN;
     1148    17380
     1149    17381    2   END CHECK_COMP;
     1150    17382        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:36   
     1151    17383    1   CGINIT: PROC ALTRET;
     1152    17384        /**/
     1153    17385    2   DCL SDCB$ PTR;
     1154    17386    2   DCL FFLG BIT(36);
     1155    17387        %VLP_STATION (FPTN=ASTATION,STCLASS=);
     1156    17414        /**/
     1157    17415    3        IF F$DCB.LASTSTA$=ADDR(NIL) THEN DO;
     1158    17416    3             CALL FSA$GSP(SIZEW(VLP$STATION)+SIZEW(VLP$SETSTA),
     1159    17417    3                  F$DCB.LASTSTA$) ALTRET(ERR);
     1160    17418    3             F$DCB.SETSTA$=PINCRW(F$DCB.LASTSTA$,SIZEW(VLP$STATION));
     1161    17419    3             F$DCB.SETSTA$->VLP$SETSTA=VLP_SETSTA;
     1162    17420    3           END;
     1163    17421        /**/
     1164    17422    2        F$DCB.LASTSTA$->VLP$STATION=VLP_STATION;
     1165    17423    2        SDCB$=F$DCB.CFU$;
     1166    17424        /**/
     1167    17425    2        ASTATION=SDCB$->F$DCB.SETSTA$->VLP$SETSTA.ISTA;
     1168    17426    2        IF B$JIT.MODE=%M_TP# AND F$DCB.AMRSETSTA AND SDCB$=B$M$UC$ THEN
     1169    17427    2             ASTATION.CTL.LOCK='0'B;       /* Ignore lock violations for TP */
     1170    17428    2        CALL KCI$VALSTA1(F$DCB.SETSTA$->VLP$SETSTA.ISTA,ASTATION) ALTRET(ERR);
     1171    17429        /**/
     1172    17430    2        ASTATION=SDCB$->F$DCB.SETSTA$->VLP$SETSTA.OSTA;
     1173    17431    2        IF B$JIT.MODE=%M_TP# AND F$DCB.AMRSETSTA AND SDCB$=B$M$UC$ THEN
     1174    17432    2             ASTATION.CTL.LOCK='0'B;
     1175    17433    2        CALL KCI$VALSTA1(F$DCB.SETSTA$->VLP$SETSTA.OSTA,ASTATION) ALTRET(ERR);
     1176    17434        /**/
     1177    17435        /**/
     1178    17436    2        RETURN;
     1179    17437        /**/
     1180    17438    2   ERR: ALTRETURN;
     1181    17439        /**/
     1182    17440    2   END CGINIT;
     1183    17441        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:37   
     1184    17442    1   FPRG: PROC(MODE,FEX,STR,SOURCEDCB) ALTRET;
     1185    17443        /*D* NAME:        FPRG
     1186    17444             PURPOSE:     To start DCB-connected FEP users (including handlers)
     1187    17445             INPUT:       MODE - The mode of FEP user to start; either G_M_USER#
     1188    17446                                 or G_M_HANDLER#.
     1189    17447                          FEX  - The destination FEP number.
     1190    17448                       STR - Stream number to open to
     1191    17449             DESCRIPTION: FPRG handles creating a FEP user and attaching
     1192    17450                          this FEP user to the opening DCB. This consists of:
     1193    17451                             1) Completing setup of the DCB
     1194    17452                             2) Dangling an LDCT from the DCB
     1195    17453                             3) Sending a 'start FEP user' message to the
     1196    17454                                network manager
     1197    17455                             4) REGing QA for completion or failure of this
     1198    17456                                request
     1199    17457                             5) Cleaning up LDCT and ALTRETURNing if path to
     1200    17458                                user terminal not set up, or...
     1201    17459        */
     1202    17460    2   DCL MODE UBIN;
     1203    17461    2   DCL FEX UBIN;
     1204    17462    2   DCL STR UBIN;
     1205    17463    2   DCL SOURCEDCB UBIN;                     /* Really a DCB, but ... */
     1206    17464        %KL_STRTU (STCLASS=AUTO);
     1207    17637    2   DCL UCLDCT$ PTR;
     1208    17638    2   DCL NETMNGR CHAR(8) DALIGNED CONSTANT INIT('HLPADMIN');
     1209    17639
     1210    17640    2        IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN RETURN;
     1211    17641    3        CALL NKL$GETDCT(JIT$) WHENALTRETURN DO;
     1212    17642    3             B$JIT.ERR=ERR_PCNLDCT;
     1213    17643    3             ALTRETURN;
     1214    17644    3           END;
     1215    17645    2        LDCT$ = JIT$;
     1216    17646    2        NK$LDCT.RESCOD=NK_TSFPRG;
     1217    17647    2        NK$LDCT.DFLG.CM='1'B;
     1218    17648    2        NK$LDCT.USER=B$JIT.USER;
     1219    17649    2        NK$LDCT.RLCID.NODE=FEX;
     1220    17650    2        NK$LDCT.UDCBNO = JDCBNO;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:38   
     1221    17651    2        KL_STRTU='0'B;
     1222    17652    2        KL_STRTU.FCN=IGA_STRTU;
     1223    17653    2        KL_STRTU.NODE=FEX;
     1224    17654    2        KL_STRTU.STR = STR;
     1225    17655    2        KL_STRTU.NETADR_FROM.NODE=K_NODE#;
     1226    17656    2        KL_STRTU.NETADR_FROM.GENERATION = NK$LDCT.GENERATION;
     1227    17657    2        KL_STRTU.NETADR_FROM.LDX.BYT(0)=NK$LDCT.LDCTX/256;
     1228    17658    2        KL_STRTU.NETADR_FROM.LDX.BYT(1)=
     1229    17659    2             NK$LDCT.LDCTX-KL_STRTU.NETADR_FROM.LDX.BYT(0)*256;
     1230    17660    2        KL_STRTU.ACCT=B$JIT.ACCN;
     1231    17661    2        KL_STRTU.UNAME=B$JIT.UNAME;
     1232    17662    2        KL_STRTU.MODE=MODE;
     1233    17663    2        NK$LDCT.DCBNO=JDCBNO;
     1234    17664    3        IF MODE=%G_M_USER# THEN DO;
     1235    17665    3             F$DCB.DDEV=ADDR(SOURCEDCB)->F$DCB.DDEV;
     1236    17666    3             F$DCB.ATTR=ADDR(SOURCEDCB)->F$DCB.ATTR;
     1237    17667    3             NK$LDCT.DEVNM='*TSFPRG*';
     1238    17668    3             UCLDCT$=NK$LDCT$(ADDR(SOURCEDCB)->F$DCB.SETX);
     1239    17669    3             NK$LDCT.TERMID.TTYP=UCLDCT$->NK$LDCT.TERMID.TTYP;
     1240    17670    3             NK$LDCT.DFLG.INPUT=UCLDCT$->NK$LDCT.DFLG.INPUT;
     1241    17671    3             NK$LDCT.DFLG.OUTPUT=UCLDCT$->NK$LDCT.DFLG.OUTPUT;
     1242    17672    3             KL_STRTU.NETADR_TO=UCLDCT$->NK$LDCT.RLCID;
     1243    17673    3           END;
     1244    17674    2        ELSE
     1245    17675    2             IF MODE=%G_M_GHOST#
     1246    17676    2             THEN
     1247    17677    2                  NK$LDCT.DEVNM = '*GHFPRG*';
     1248    17678    3             ELSE DO;
     1249    17679    3                  NK$LDCT.DEVNM='*HNDLR*';
     1250    17680    3                  KL_STRTU.UNAME = F$DCB.NAME.C;
     1251    17681    3                END;
     1252    17682    2        CALL KUB$WRITE(KL_STRTU,SIZEC(KL_STRTU),NETMNGR);
     1253    17683             %LOCK (G=NK$LDCT.LOCK);
     1254    17686    2        NK$LDCT.LKFLG.REGGED = '1'B;
     1255    17687        /* SS will unlock NK$LDCT.LOCK */
     1256    17688    2        CALL SSR$REG(%SS_CW,JIT$);
     1257    17689    3        IF NK$LDCT.RLCID.LDCTX=0 THEN DO;  /* Path failed to be set up           */
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:39   
     1258    17690    3             B$JIT.ERR=NK$LDCT.ERR;
     1259    17691    3             CALL NKL$RELDCT(JIT$);
     1260    17692    3             ALTRETURN;
     1261    17693    3           END;
     1262    17694    2        NK$LDCT.ERR = ERR_NOFPRG;
     1263    17695             /*E* ERROR: FSN-E$NOFPRG-0
     1264    17696                  MESSAGE: No FPRG is currently running.
     1265    17697                  MESSAGE1: After an open with ORG=FPRG a run unit must be down-loaded.
     1266    17698                   */
     1267    17699    2        F$DCB.SYSID = (NK$LDCT.SYSID+MOD(NK$LDCT.SYSID,512))/2;
     1268    17700    2        F$DCB.LDCTX=NK$LDCT.LDCTX;
     1269    17701    2        F$DCB.STR = KIDM_CP;
     1270    17702    2        F$DCB.IASN = %FPRGIASN#;
     1271    17703    2        F$DCB.IFMT=%FMTFPRG#;
     1272    17704    2        F$DCB.CFU$ = ADDR(NIL);
     1273    17705    2        F$DCB.MEDIA = FMTUC#;
     1274    17706    2        IF ADDR(SOURCEDCB)~=ADDR(F$DCB)
     1275    17707    2        THEN F$DCB.SETX = 0;
     1276    17708    2        RETURN;
     1277    17709    2   END FPRG;
     1278    17710        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:40   
     1279    17711    1   DBGFPRG: PROC ALTRET;
     1280    17712        /*D* NAME:        DBGFPRG
     1281    17713             PURPOSE:     To establish a debugging path to an existing FPRG user
     1282    17714             CALL:        CALL DBGFPRG ALTRET(LBL);
     1283    17715             DESCRIPTION: DBGFPRG uses F$DCB.ORG along with NAME, ACCT, PSN,
     1284    17716                          SETSTA, DBGDCBNO and DBGSYSID to fill in a KL_AFD
     1285    17717                          (Associate Front-end Debugger) message and sends it
     1286    17718                          off to the Network Manager who will forward it to
     1287    17719                          the appropriate node who will cause the designated
     1288    17720                          FPRG user to have a debugger associated. The message
     1289    17721                          contains the node number and sysid of the user to
     1290    17722                          debug as well as identification of a 'dangling' LDCT
     1291    17723                          to which the front-end debugger is to connect.
     1292    17724                          The user is REGged after sending the KL_AFD message
     1293    17725                          and will be RUEed by either the FPRG-user's node
     1294    17726                          crashing, a connect or an error reported from
     1295    17727                          several places down the line.
     1296    17728
     1297    17729                          If all is well and the connection is completed (or
     1298    17730                          no connection was attempted due to this being a
     1299    17731                          TEST open), DBGFPRG will RETURN. If all is not well,
     1300    17732                          including a non-debugger attempting this open or
     1301    17733                          no such destination or no LDCTs available, this
     1302    17734                          procedure will ALTRETURN.  */
     1303    17735
     1304    17736    2   DCL DDCB$ PTR;
     1305    17737        %KC$CGID(FPTN=CGID,STCLASS=AUTO);
     1306    17763        %KL_AFD(FPTN=AFD,STCLASS=AUTO);
     1307    17803
     1308    17804    2        CALL FMO$GETDOMAIN(I);
     1309    17805    3        IF I~=%DBWSR THEN DO;
     1310    17806    3             B$JIT.ERR=ERR_NOTDBG;
     1311    17807        /*E* ERROR: FSN-E$NOTDBG-2
     1312    17808           MESSAGE: Only a debugger may open with ORG=DBGxxx */
     1313    17809    3             ALTRETURN;
     1314    17810    3           END;
     1315    17811    2        AFD='0'B;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:41   
     1316    17812    2        AFD.FCN=IGA_AFD;
     1317    17813    3   ORGS: DO CASE(F$DCB.ORG);
     1318    17814    3        CASE(%DBGSYSID#);
     1319    17815    3           AFD.NODE=FEX;    /* FEnn or FE@nodename has been converted by caller */
     1320    17816    3           CALL KIA$9TO8(PN$.V_->FPT$OPEN_V.DBGSYSID,AFD.SYSID,2);
     1321    17817    3        CASE(%DBGDCB#);
     1322    17818    3           DDCB$=DCBADDR(PN$.V_->FPT$OPEN_V.DBGDCBNO);
     1323    17819    3           IF DDCB$~=ADDR(NIL)
     1324    17820    3                AND DDCB$->F$DCB.FCD='1'B
     1325    17821    4           THEN DO;
     1326    17822    4                LDCT$=NK$LDCT$(DDCB$->F$DCB.LDCTX);
     1327    17823    4   GOTLDCT:     ;
     1328    17824    5                IF LDCT$~=ADDR(NIL) THEN DO;
     1329    17825                          %LOCK(G=NK$LDCT.LOCK);
     1330    17828    5                     IF NK$LDCT.RESCOD=NK_TSFPRG OR NK$LDCT.RESCOD=NK_CGFPRG
     1331    17829    6                     THEN DO;
     1332    17830    6                          AFD.SYSID=BINBIT(NK$LDCT.SYSID,18);
     1333    17831    6                          AFD.NODE=NK$LDCT.RLCID.NODE;
     1334    17832    6                        END;
     1335    17833                          %UNLOCK(G=NK$LDCT.LOCK);
     1336    17836    5                   END;
     1337    17837    4              END;
     1338    17838    3           IF AFD.SYSID THEN EXIT;
     1339    17839    3           B$JIT.ERR=ERR_INVDBG;
     1340    17840        /*E* ERROR: FSN-E$INVDBG-2
     1341    17841           MESSAGE: Invalid debug destination specified
     1342    17842          MESSAGE1: Something is wrong with your debug destination. possibilities include:
     1343    17843                       o That DCB is not open
     1344    17844                       o That DCB is not an FPRG DCB
     1345    17845                       o That station is not an FPRG station
     1346    17846        */
     1347    17847    3           ALTRETURN;
     1348    17848    3        CASE(%DBGCG#);
     1349    17849    3           CGID.NAME#=F$DCB.NAME;
     1350    17850    3           CGID.ACCT#=F$DCB.ACCT;
     1351    17851    3           CGID.PSN#=F$DCB.PSN;
     1352    17852    3           I=8;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:42   
     1353    17853    3           LDCT$=ADDR(NIL);
     1354    17854    3           CALL KCO$FINDSTA(JIT$,CGID,PN$.SETSTA_->VLP$SETSTA.MYSTATION#,I)
     1355    17855    3                ALTRET (GOTLDCT);
     1356    17856    3           LDCT$=JIT$;
     1357    17857    3           GOTO GOTLDCT;
     1358    17858    3        END;                               /*CASE*/
     1359    17859    2        IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN RETURN;
     1360    17860    3        CALL NKL$GETDCT(JIT$) WHENALTRETURN DO;
     1361    17861    3             B$JIT.ERR=ERR_PCNLDCT;
     1362    17862    3             ALTRETURN;
     1363    17863    3           END;
     1364    17864    2        LDCT$=JIT$;
     1365    17865    2        F$DCB.LDCTX=NK$LDCT.LDCTX;
     1366    17866    2        F$DCB.STR=KIDM_DB;
     1367    17867    2        F$DCB.IFMT=%FMTFPRG#;
     1368    17868    2        F$DCB.MEDIA=FMTUC#;
     1369    17869    2        F$DCB.IASN = %FPRGIASN#;
     1370    17870    2        NK$LDCT.RESCOD=NK_TSTRM;
     1371    17871    2        NK$LDCT.DFLG.INPUT='1'B;
     1372    17872    2        NK$LDCT.DFLG.OUTPUT='1'B;
     1373    17873    2        NK$LDCT.DFLG.CM='1'B;
     1374    17874    2        NK$LDCT.USER=B$JIT.USER;
     1375    17875    2        NK$LDCT.RLCID.NODE=AFD.NODE;
     1376    17876    2        NK$LDCT.DCBNO=JDCBNO;
     1377    17877    2        NK$LDCT.DEVNM='*DEBUG*';
     1378    17878    2        AFD.NETADR_FROM.NODE=K_NODE#;
     1379    17879    2        AFD.NETADR_FROM.GENERATION=NK$LDCT.GENERATION;
     1380    17880    2        AFD.NETADR_FROM.LDX.BYT(0)=NK$LDCT.LDCTX/256;
     1381    17881    2        AFD.NETADR_FROM.LDX.BYT(1)=
     1382    17882    2             NK$LDCT.LDCTX- AFD.NETADR_FROM.LDX.BYT(0)*256;
     1383    17883    2        IF B$JIT.PRIV.ACTIVE & %(PR_FMREAD# | PR_FMSEC#)
     1384    17884    2        THEN AFD.ACCT=' ';                 /* Indicates privileged */
     1385    17885    2        ELSE AFD.ACCT=B$JIT.ACCN;
     1386    17886    2        CALL KUB$WRITE(AFD,SIZEC(AFD),'HLPADMIN');
     1387    17887             %LOCK(G=NK$LDCT.LOCK);
     1388    17890    2        NK$LDCT.LKFLG.REGGED='1'B;
     1389    17891        /* SS will unlock NK$LDCT.LOCK */
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:43   
     1390    17892    2        CALL SSR$REG(%SS_CW,JIT$);
     1391    17893    3        IF NK$LDCT.RLCID.LDCTX=0 THEN DO;  /* Path failed to be set up */
     1392    17894    3             B$JIT.ERR=NK$LDCT.ERR;
     1393    17895    3             CALL NKL$RELDCT(JIT$);
     1394    17896    3             ALTRETURN;
     1395    17897    3           END;
     1396    17898    2        NK$LDCT.ERR = ERR_NOFPRG;
     1397    17899    2        RETURN;
     1398    17900    2   END DBGFPRG;
     1399    17901    1   END FSN$OPNDEV;
     1400    17902        %EOD;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:44   
--  Include file information  --

   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   FS_SUPER_C.:E05TOU  is referenced.
   FS$FIT.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FSN$OPNDEV.
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:45   

   Procedure FSN$OPNDEV requires 2602 words for executable code.
   Procedure FSN$OPNDEV requires 96 words of local(AUTO) storage.

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:46   

 Object Unit name= FSN$OPNDEV                                 File name= FSN$OPNDEV.:E05TOU
 UTS= JUL 29 '97 17:36:22.56 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS    104    150  FSN$OPNDEV
    1   Proc  even  none  2602   5052  FSN$OPNDEV
    2  RoData even  none    37     45  FSN$OPNDEV

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  FSN$OPNDEV
     1   2660                  yes      Std        1  FSN$OPNCL_EVT
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:47   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMO$GETPFB
 yes     yes           Std       0 NKU$UCOPN
         yes           Std       1 FMP$CLSF
         yes           Std       0 FRB$CLS
 yes     yes           Std       3 SSR$REG
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       7 KIA$UCIOND
         yes           Std       1 FSM$HDRSET
 yes     yes           Std       1 NKL$GETDCT
         yes           Std       1 FMD$RELBUF
 yes     yes           Std       2 FSN$CONV_STR
 yes     yes           Std       0 FSD$C1GETDCB
 yes     yes           Std       3 KIN$CONV_NODENAME
         yes           Std       0 FMM$DFLOPNP
 yes     yes           Std       5 NKA$DEVIO
 yes     yes           Std       3 FSW$DESTFORM
         yes           Std       1 FMF$REMOTE
 yes     yes           Std       1 FRF$EVRPT
 yes     yes           Std       1 KIA$OPNSSN
 yes     yes           Std       3 KIN$CONV_NODE
         yes           Std       1 FMD$GBUF
         yes           Std       1 FMD$RBUF
         yes           Std       1 FSA$FDCB
 yes     yes           Std       1 FMN$OPNDP
         yes           Std       1 FTO$OPNAT
         yes           Std       1 HFC$LOCK
 yes     yes           Std       3 KIA$CLSSTR
 yes     yes           Std       3 FSF$SYMBFILE
 yes     yes           Std       0 KIS$OSI_OPEN
 yes     yes           Std       2 KIA$DCLSTR
 yes     yes           Std       0 FRA$OPR
 yes     yes           Std       1 FSP$CLSDEV
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:48   
 yes     yes           Std       1 FSD$JEJFOPN
 yes     yes           Std       1 FPO$OPNOD
 yes     yes           Std       0 KIF$FPRGR
 yes     yes           Std       2 KIA$OPNSTR
 yes     yes           Std       1 FSB$STREAMDCB
 yes     yes           Std       2 FSA$FSP
 yes     yes           Std       1 FSB$STREAMCREATE
 yes     yes           Std       2 KIA$WINDOW
 yes     yes           Std       2 FSA$GSP
 yes     yes           Std       2 KCI$VALSTA1
 yes     yes           Std       3 KUB$WRITE
 yes     yes           Std       1 NKL$RELDCT
         yes           Std       1 FMO$GETDOMAIN
         yes           Std       3 KIA$9TO8
 yes     yes           Std       4 KCO$FINDSTA
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    B$JIT$                           r    B$ROSEG$                         r    B$M$UC$
r    B$M$DO$                               K_NODE#                               N$DCT$$
     FS_WINDOW                             B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:49   


        1        1        /*M*     FSN$OPNDEV       DEVICE DCB OPEN      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8        /*P*     NAME:    FSN$OPNDEV
        9        9         *       PURPOSE: OPEN A DEVICE DCB.
       10       10         **/
       11       11        /*F*     NAME:    FSN$OPNDEV
       12       12         *       PURPOSE: OPEN A DEVICE DCB.
       13       13         *       DESCRIPTION:  EXAMINE F$DCB.RES.  THIS TELLS WHETHER
       14       14         *                IT IS STREAM OR DIRECT CONNECTION.
       15       15         *                IF STREAM, FIND OR BUILD STREAM DCB AND
       16       16         *                POINT DCB BEING OPENED TO STREAM DCB.
       17       17         *                IF DIRECT, MAY BE SYMBIONT OR DEVICE;
       18       18         *                  IF DIRECT SYMBIONT, CREATE SYMBIONT FILE;
       19       19         *                  IF DIRECT DEVICE, ACQUIRE DEVICE.
       20       20         **/
       21       21        /*D*     NAME:    FSN$OPNDEV
       22       22         *       CALL:    CALL FSN$OPNDEV(PN$)
       23       23         *       INTERFACE:  FRA$OPR
       24       24         *       ENVIRONMENT:  MONITOR (FOR USER) LS.
       25       25                INPUT:
       26       26                   DCB, pointed to by B$JIT.DCB$.
       27       27                      FCD is off.
       28       28                      ASN= Device.
       29       29                      IASN= Device.
       30       30                      FFLG=0.  DDEV=0.  WIDTH=0.  DESC=0.
       31       31         *                PN$ IS A POINTER ARRAY FOR VARIOUS M$OPEN FPT
       32       32         *                  AREAS, MOSTLY UNUSED FOR DEVICE OPEN.
       33       33         *       OUTPUT:  DCB (B$JIT.DCB$) IS OPENED, & OTHER FIELDS CHANGED.
       34       34         *                B$JIT.ERR SET UP IF ERROR OCCURRED.
       35       35                         DCB's CFU$ may point to newly created stream DCB.
       36       36                DESCRIPTION:
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:50   
       37       37         **/
       38       38        FSN$OPNDEV:PROC(PN$);

     38  1 000000   000000 700200 xent  FSN$OPNDEV   TSX0  ! X66_AUTO_1
         1 000001   000140 000001                    ZERO    96,1

       39       39    1   DCL B$JIT$ PTR SYMREF READONLY;         /* Note that B$JIT is BASED(B$JIT$).  */
       40       40    1   DCL B$ROSEG$ PTR SYMREF READONLY;
       41       41    1   DCL B$M$UC$ PTR SYMREF READONLY;
       42       42    1   DCL B$M$DO$ PTR SYMREF READONLY;
       43       43        /*** * * * ***/
       44       44    1   DCL FRA$OPR ENTRY ALTRET;               /* GETS RESOURCE DEVICE               */
       45       45    1   DCL FRB$CLS ENTRY;
       46       46    1   DCL NKU$UCOPN ENTRY ALTRET;             /* OPENS M$UC DCB                     */
       47       47    1   DCL FMN$OPNDP ENTRY(1) ALTRET;          /* DEVICE PACK OPEN FOR LATCH,VOLINNT */
       48       48    1   DCL FSA$GSP ENTRY(2) ALTRET;            /* GET ROSEG SPACE */
       49       49    1   DCL FSA$FSP ENTRY(2) ALTRET;            /* Free ROSEG space */
       50       50    1   DCL FSB$MEDDCB ENTRY(1) ALTRET;
       51       51    1   DCL FSB$STREAMCREATE ENTRY(1) ALTRET;   /* CREATE A STREAMFILE                */
       52       52    1   DCL FSB$STREAMDCB ENTRY(1) ALTRET;      /* GET/OPEN STREAM DCB                */
       53       53    1   DCL FSB$DDF ENTRY(1) ALTRET;            /* Setup DCB from DDF */
       54       54    1   DCL FMM$DFLOPNP ENTRY;
       55       55    1   DCL FMO$GETDOMAIN ENTRY(1);
       56       56    1   DCL KCI$VALSTA1 ENTRY(2) ALTRET;
       57       57    1   DCL FSD$JEJFOPN ENTRY(1)ALTRET;         /* Open JE/JF DCB (Make JCL)          */
       58       58    1   DCL FSD$C1GETDCB ENTRY ALTRET;          /* Make & open DCB for command file   */
       59       59    1   DCL FTO$OPNAT ENTRY(1);                 /* Open DCB to tape                   */
       60       60    1   DCL FPO$OPNOD ENTRY(1) ALTRET;          /* Open DCB to Optical Disc  */
       61       61    1   DCL FSW$DESTFORM ENTRY(3)ALTRET;        /* Verify dev/wsn/form for dd@wsn. */
       62       62    1   DCL FSF$SYMBFILE ENTRY(3)ALTRET;        /* Open symfile, build banner.*/
       63       63    1   DCL FMD$GBUF ENTRY(1);                  /* Steal a File-Management buffer. */
       64       64    1   DCL FMD$RBUF ENTRY(1);                  /* Return a Stolen File Mgmt buffer. */
       65       65    1   DCL FMD$RELBUF ENTRY(1);                /* Return a File Mgmt buffer. */
       66       66    1   DCL FSM$HDRSET ENTRY(1);                /* Fix up user-specified Header.*/
       67       67    1   DCL KUB$WRITE ENTRY(3) ALTRET;
       68       68    1   DCL NKA$DEVIO ENTRY(5)ALTRET;
       69       69    1   DCL FSP$CLSDEV ENTRY(1) ALTRET;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:51   
       70       70    1   DCL FMO$GETPFB ENTRY(1);
       71       71    1   DCL KIA$CLSSTR ENTRY(3) ALTRET;
       72       72    1   DCL KIA$DCLSTR ENTRY(2) ALTRET;
       73       73    1   DCL KIA$OPNSSN ENTRY(1) ALTRET;
       74       74    1   DCL KIA$OPNSTR ENTRY(2) ALTRET;
       75       75    1   DCL KIA$UCIOND ENTRY(7) ALTRET;
       76       76    1   DCL FRF$EVRPT ENTRY(1) ALTRET;
       77       77    1   DCL FMF$REMOTE ENTRY(1);
       78       78    1   DCL KIA$WINDOW ENTRY(2) ALTRET;
       79       79    1   DCL KIA$8TO9 ENTRY(3);
       80       80    1   DCL KIA$9TO8 ENTRY(3);
       81       81    1   DCL KIF$FPRGR ENTRY ALTRET;
       82       82    1   DCL KCO$FINDSTA ENTRY(4) ALTRET;
       83       83    1   DCL NKL$GETDCT ENTRY(1) ALTRET;
       84       84    1   DCL NKL$RELDCT ENTRY(1) ALTRET;
       85       85    1   DCL SSR$REG ENTRY(3) ALTRET;
       86       86    1   DCL FSL$GET_CLDEV ENTRY(1);
       87       87    1   DCL KIS$OSI_OPEN ENTRY (0) ALTRET;
       88       88        /*** INCLUDES ***/
       89       89        %INCLUDE B$JIT_C;
       90      403        %MACRO B$ROSEG(BASED=BASED);
       91      404        %INCLUDE B$ROSEG;
       92      467        %MEND;
       93      468        %INCLUDE CP_6_SUBS;
       94     1008        %INCLUDE B_ERRORS_C;
       95     2135        %INCLUDE B_STRINGS_C;
       96     2264        %INCLUDE F$CP6P_C;
       97     2275        %INCLUDE F$CP6V_C;
       98     2501        %MACRO F$DCBI(BASED=BASED);
       99     2502        %INCLUDE F$DCB;
      100     2551        %MEND;
      101     2552        %INCLUDE FM$FIT;
      102     2773        %INCLUDE FS$FIT;
      103     2816        %INCLUDE FS_SUPER_C;
      104     3579        %INCLUDE F_CP6;
      105     4604        %INCLUDE F_FMTCODE_C;
      106     4638        %INCLUDE F_FPTCODE_C;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:52   
      107     4674        %INCLUDE F_MACROS_C;
      108     4685        %INCLUDE G_JIT_M;
      109     4950        %INCLUDE JG_GHOSTS_C;
      110     5040        %INCLUDE KI_SUBS_C;
      111     5176        %INCLUDE KC$CGBLK;
      112     5224        %INCLUDE KC_CP6;
      113     5784        %INCLUDE KI_CP6;
      114     6880        %INCLUDE KL_AFCN_C;
      115     6981        %INCLUDE KL_MACRO_C;
      116    10333        %INCLUDE KL_SUPER_C;
      117    13235        %INCLUDE KV$VDO;
      118    14250        %KV_VDO_ALL_E;
      119    14329        %INCLUDE K_DATA_R;
      120    15040        %INCLUDE NK$LDCT;
      121    15142        %INCLUDE NK_LDCT_R;
      122    15151        %INCLUDE NK_SUBS;
      123    15176        %INCLUDE NK_VFC_C;
      124    15250        %INCLUDE SS_SCHED_C;
      125    15483        /**/
      126    15484        /*** MACROS, BASED, ETC. ***/
      127    15485        %INCLUDE HF_LOCK_C;
      128    15499        %B$JIT0;
      129    15588        %U$JIT1;
      130    15662        %M$JIT2X;
      131    15665        %F$JIT3;
      132    15670        %S$JIT4X;
      133    15673        %J$JIT5X;
      134    15676        %A$JIT6X;
      135    15679        %FPT$OPEN_V;
      136    15694        %VLP_SETSTA(STCLASS=CONSTANT);
      137    15722        %VLP_SETSTA(FPTN=VLP$SETSTA,STCLASS=BASED);
      138    15750        %VLP_STATION(STCLASS=CONSTANT);
      139    15777        %VLP_STATION(FPTN=VLP$STATION,STCLASS=BASED);
      140    15804        %VLP_WINDOW (FPTN=FS_WINDOW,STCLASS=SYMREF);
      141    15848    1   DCL ZEROES BIT(72)CONSTANT INIT('0'B);
      142    15849    1   DCL CONV_STR(0:3) CHAR(4) CONSTANT INIT('    ','UC98','UC01','UC99');
      143    15850        %FPT$OPEN_P(FPTN=PN$,STCLASS=,PFMT=PTR);
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:53   
      144    15856        %VLP_FORM(FPTN=VLP$FORM,STCLASS=BASED);
      145    15869        %VLP_WINDOW (FPTN=VLP$WINDOW,STCLASS=BASED);
      146    15913        %VLP_WINDOW (FPTN=WINDOW,STCLASS=AUTO);
      147    15957        %NK$LDCT(STCLASS="BASED(LDCT$)");
      148    16003        %B$ROSEG (BASED="BASED(B$ROSEG$)");
      149    16063        %F$DCBI (BASED="BASED(JDCB$)");
      150    16113        %CODE16;
      151    16121        %KL_WSNHDR(STCLASS="BASED(BUF$)");
      152    16132    1   DCL 1 BPTR BASED ALIGNED,
      153    16133    1            2 ADR UBIN(18) UNAL,
      154    16134    1            2 SEGID BIT(18) UNAL;
      155    16135    1   DCL NEWSTREAM BIT(1) ALIGNED;      /* Set if this pass opened this stream */
      156    16136    1   DCL HOST BIT(1) ALIGNED;
      157    16137    1   DCL ERRCODE BIT(36) ALIGNED;
      158    16138    1   DCL JDCB$ PTR;                     /* TO HOLD POINTER TO DCB BEING OPENED     */
      159    16139    1   DCL LDCT$ PTR;
      160    16140    1   DCL I SBIN;                             /*ALL SORTS OF INDEXING USES          */
      161    16141    1   DCL 1 RLCID REDEF I,
      162    16142    1            2 NODE UBIN(9) UNAL,
      163    16143    1            2 GENERATION UBIN(9) UNAL,
      164    16144    1            2 LDCTX UBIN(18) UNAL;
      165    16145    1   DCL J SBIN;
      166    16146    1   DCL F SBIN;              /*F is converted DCB.FUN .. 0=UPD, 1=IN, 2=CREATE.*/
      167    16147    1   DCL JDCBNO UBIN;
      168    16148    1   DCL RES CHAR(4);                        /* Hold RES field of DCB here.        */
      169    16149    1   DCL FEX UBIN;
      170    16150    1   DCL STR UBIN;
      171    16151    1   DCL JIT$ PTR;
      172    16152    1   DCL BUF$ PTR;
      173    16153        %SUB FCG#='0623'O;
      174    16154        %SUB MID#='16'O;
      175    16155        %G$JIT_E;
      176    16217        %ERRCODE (NAME=ERR_ILLIN,COD#=%E$ILLIN);
      177    16221        %ERRCODE (NAME=ERR_INVRES,COD#=%E$INVRES);
      178    16225        %ERRCODE (NAME=ERR_PCNLDCT,COD#=%E$PCNLDCT);
      179    16229        %ERRCODE (NAME=ERR_NOSTREAMS,COD#=%E$LDEVNOSTREAMS);
      180    16233        %ERRCODE (NAME=ERR_NOTAUTH,COD#=%E$NOTAUTH);
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:54   
      181    16237        %ERRCODE (NAME=ERR_NOTDBG,COD#=%E$NOTDBG);
      182    16241        %ERRCODE (NAME=ERR_INVDBG,COD#=%E$INVDBG);
      183    16245        %ERRCODE (NAME=ERR_ORGNOTCOM,COD#=%E$ORGNOTCOM);
      184    16249        %ERRCODE (NAME=ERR_BADFEP,COD#=%E$BAD_FEP);
      185    16253        %ERRCODE (NAME=ERR_NOFPRG,COD#=%E$NOFPRG);
      186    16257        /*N* THIS OUGHTA BE REPLACED BY CALL TO FSL BY END OF T */
      187    16258        %FS$LDEVDDF(NAME=LDEVUATTR,STCLASS=,SIZ=NAWNDW);
      188    16262        %VLP_TAB(FPTN=LDEVPLUSTAB,STCLASS=BASED);
      189    16276        %VLP_HDR(FPTN=LDEVPLUSHDR,STCLASS=BASED,LEN=160);
      190    16292        %FS$FORMREC(STCLASS="BASED(BUF$)");
      191    16363    1   DCL TSTFINFO SBIN;
      192    16364    1   DCL ORG UBIN;
      193    16365    1   DCL 1 ORGSTR REDEF ORG,
      194    16366    1            2 * BIT(27), 2 BYT UBIN(9) UNAL;
      195    16367        %FS_OSFN(FPTN=OSFN,STCLASS=BASED);
      196    16381        %FPT_CLOSE(FPTN=CLSSAVE$,PFMT=PTR,VECTOR=ADDR,DISP=SAVE,
      197    16382                STCLASS=CONSTANT);
      198    16424    1   DCL FMP$CLSF ENTRY(1);
      199    16425    1   DCL FSA$FDCB ENTRY(1);
      200    16426    1   DCL KIN$CONV_NODENAME ENTRY(3) ALTRET;
      201    16427    1   DCL KIN$CONV_NODE ENTRY(3) ALTRET;
      202    16428    1   DCL FSN$CONV_STR ENTRY(2) ALTRET;
      203    16429        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:55   
      204    16430        /*D*       The very first time through Device Open for this user,
      205    16431                M$UC is forced open and some flags are set so that all
      206    16432                subsequent opens of control-command DCB's will go faster.
      207    16433                   There are three kinds of user to be distinguished at
      208    16434                this time --
      209    16435                1.  Batch User.  M$UC.ASN is DEVICE, and B$JIT.NEXTCC is
      210    16436                   %CC_FROMJOB#.  M$UC is opened as NO.
      211    16437                2.  System Ghost User.  M$UC.ASN is DEVICE, and B$JIT.NEXTCC
      212    16438                   is %CC_FROMNO#.  M$UC is opened as NO.
      213    16439                3.  Interactive User.  B$JIT.NEXTCC is %CC_FROMUC#.  M$UC.ASN
      214    16440                   may or may not be DEVICE.  If not, it gets opened by
      215    16441                   Comgroup Open.  If so, it as opened as UC.
      216    16442                   Special Frill - If line hangs up before first open, M$UC
      217    16443                   may be 'NO' instead of 'UC'. It gets opened as NO, but
      218    16444                   the user is still considered Interactive.
      219    16445                After M$UC is open, the flags in B$ROSEG.CR01ID and
      220    16446                B$ROSEG.CR01DCB may have one of several configurations.
      221    16447                (The ones marked '**' are possible initial ones.)
      222    16448                ============================================================
      223    16449                  CR01ID.      CR01    Meaning
      224    16450                INT JCL NOWIS  DCB.
      225    16451                ------------------------------------------------------------
      226    16452                 0   1   JOB   M$UC ** Batch; CC read from JCL in M$UC.
      227    16453                 0   0   NO    M$UC ** Sys ghost; CC read = EOF.
      228    16454                 1   0   UC    M$UC ** Interactive; CC read from M$UC.
      229    16455                 0   1   XEQ   M$UC    Batch; CC read from XEQ in M$UC.
      230    16456                 0   1   NO    M$UC    Batch; CC read = EOF.
      231    16457                 0   0   XEQ   M$UC    Sys ghost; CC read from XEQ in M$UC.
      232    16458                 1   0   XEQ   nnnn    Interactive; CC read from XEQ in nnnn.
      233    16459                 1   0   XEQ    0      Interactive; CC read from XEQ needs
      234    16460                                          a DCB.
      235    16461                ------------------------------------------------------------
      236    16462                   B$ROSEG.CR01ID.NOWIS values are the same as B$JIT.NEXTCC
      237    16463                values %CC_FROMJOB#,%CC_FROMNO#, etc.
      238    16464                ------------------------------------------------------------
      239    16465                LP      means logical device LP01.
      240    16466                CP      meand logical device CP01.
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:56   
      241    16467                GR      means logical device GR01.
      242    16468                NO      means device NO.
      243    16469                JF      means the JCL-place maker for you yourself.  The
      244    16470                        XEQ process writes output to JF.
      245    16471                JE      means the JCL-place maker for a new batch job.
      246    16472                        The BATCH process writes output to JE.
      247    16473                LO      means terminal if you are an interactive user, and
      248    16474                        logical device LP01 if you are a batch user.  LO
      249    16475                        can only be written to.
      250    16476                CR      means your JCL-place if you have one (batch, or
      251    16477                        interactive in an XEQ), otherwise terminal
      252    16478                        (interactive user without an XEQ in progress).
      253    16479                        CR can only be read from.
      254    16480                UC      means terminal if you are interactive, NO if you
      255    16481                        are a batch user.
      256    16482                ME      means the same as CR when read from, the same as
      257    16483                        LO when written to.
      258    16484        */
      259    16485    1        JDCB$=B$JIT.DCB$;

  16485  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200017 756100                    STQ     JDCB$,,AUTO

      260    16486    1        JDCBNO = F$DCB.DCB#;

  16486  1 000005   200017 471500                    LDP1    JDCB$,,AUTO
         1 000006   100060 236100                    LDQ     48,,PR1
         1 000007   000033 772000                    QRL     27
         1 000010   200024 756100                    STQ     JDCBNO,,AUTO

      261    16487
      262    16488        /* Default stream correctly depending on what DCB it is */
      263    16489    1        IF JDCB$ = B$M$DO$

  16489  1 000011   200017 236100                    LDQ     JDCB$,,AUTO
         1 000012   000000 116000 xsym               CMPQ    B$M$DO$
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:57   
         1 000013   000017 601000 1                  TNZ     s:16493

      264    16490    1        THEN
      265    16491    1             STR = KIDM_DB;

  16491  1 000014   000003 235007                    LDA     3,DL
         1 000015   200027 755100                    STA     STR,,AUTO
         1 000016   000025 710000 1                  TRA     s:16494

      266    16492    1        ELSE
      267    16493    1             CALL FMO$GETPFB(STR);

  16493  1 000017   200027 633500                    EPPR3   STR,,AUTO
         1 000020   200130 453500                    STP3    UCLDCT$+2,,AUTO
         1 000021   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 000022   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000023   000000 701000 xent               TSX1    FMO$GETPFB
         1 000024   000000 011000                    NOP     0

      268    16494    1        IF NOT B$ROSEG.STREAM_VALID(STR)

  16494  1 000025   000000 470400 xsym               LDP0    B$ROSEG$
         1 000026   200027 235100                    LDA     STR,,AUTO
         1 000027   000000 066505                    CMPB    filb='0'B
         1 000030   000117 000001                    BDSC    79,A,PR0                 by=0,bit=0,n=1
         1 000031   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000032   000035 601000 1                  TNZ     INITLOOP

      269    16495    1        THEN
      270    16496    1             STR = KIDM_CP;

  16496  1 000033   000001 236007                    LDQ     1,DL
         1 000034   200027 756100                    STQ     STR,,AUTO

  16494  1 000035                       INITLOOP     null
      271    16497
      272    16498    1   INITLOOP:;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:58   
      273    16499    2        IF B$ROSEG.CR01DCB=1 THEN DO;

  16499  1 000035   000000 470400 xsym               LDP0    B$ROSEG$
         1 000036   000115 220100                    LDX0    77,,PR0
         1 000037   000001 100003                    CMPX0   1,DU
         1 000040   000236 601000 1                  TNZ     s:16546

      274    16500    2             B$ROSEG.CR01ID='0'B;

  16500  1 000041   000114 450100                    STZ     76,,PR0

      275    16501    3             IF JDCB$=B$M$UC$ THEN DO;

  16501  1 000042   200017 236100                    LDQ     JDCB$,,AUTO
         1 000043   000000 116000 xsym               CMPQ    B$M$UC$
         1 000044   000164 601000 1                  TNZ     s:16528

      276    16502    4                  IF B$JIT.NEXTCC=%CC_FROMUC# AND F$DCB.RES='UC' THEN DO;

  16502  1 000045   000000 471400 xsym               LDP1    B$JIT$
         1 000046   100151 236100                    LDQ     105,,PR1
         1 000047   000777 376003                    ANQ     511,DU
         1 000050   000003 116003                    CMPQ    3,DU
         1 000051   000102 601000 1                  TNZ     s:16514
         1 000052   200017 473500                    LDP3    JDCB$,,AUTO
         1 000053   040000 106500                    CMPC    fill='040'O
         1 000054   300026 000004                    ADSC9   22,,PR3                  cn=0,n=4
         1 000055   000070 000002 0                  ADSC9   NETMNGR+2                cn=0,n=2
         1 000056   000102 601000 1                  TNZ     s:16514

      277    16503    4                       F$DCB.CFU$=JDCB$;

  16503  1 000057   200017 236100                    LDQ     JDCB$,,AUTO
         1 000060   300066 756100                    STQ     54,,PR3

      278    16504    4                       CALL NKU$UCOPN ALTRET(CANTOPENUC);

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:59   
  16504  1 000061   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000062   000000 701000 xent               TSX1    NKU$UCOPN
         1 000063   002646 702000 1                  TSX2    CANTOPENUC

      279    16505                /*ORG=TERMINAL,WIDTH=nn.*/
      280    16506    4                       F$DCB.DDEV=%DDEV_LP#|%DDEV_IC#|%DDEV_UCOUT#;

  16506  1 000064   200017 470500                    LDP0    JDCB$,,AUTO
         1 000065   520000 236007                    LDQ     -90112,DL
         1 000066   000004 552110                    STBQ    4,'10'O,PR0

      281    16507    4                       F$DCB.UCOUT=%YES#;

  16507  1 000067   001000 236003                    LDQ     512,DU
         1 000070   000067 256100                    ORSQ    55,,PR0

      282    16508    4                       F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;

  16508  1 000071   500000 220003                    LDX0    -98304,DU
         1 000072   000004 740100                    STX0    4,,PR0

      283    16509    4                       F$DCB.DVFC='A';

  16509  1 000073   101000 236007                    LDQ     33280,DL
         1 000074   000044 552110                    STBQ    36,'10'O,PR0

      284    16510    4                       F$DCB.MEDIA=FMTUC#;

  16510  1 000075   000014 236003                    LDQ     12,DU
         1 000076   000103 552120                    STBQ    67,'20'O,PR0

      285    16511    4                       F$DCB.IFMT=FMTTTY#;

  16511  1 000077   016000 236003                    LDQ     7168,DU
         1 000100   000103 552140                    STBQ    67,'40'O,PR0

      286    16512    4                     END;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:60   

  16512  1 000101   000113 710000 1                  TRA     s:16520

      287    16513    4                  ELSE DO;

      288    16514    4                       F$DCB.FFLG=%FFLG_OWNER#;

  16514  1 000102   765700 221003                    LDX1    -5184,DU
         1 000103   200017 473500                    LDP3    JDCB$,,AUTO
         1 000104   300004 741100                    STX1    4,,PR3

      289    16515    4                       F$DCB.IFMT=FMTNO#;

  16515  1 000105   007000 236003                    LDQ     3584,DU
         1 000106   300103 552140                    STBQ    67,'40'O,PR3

      290    16516    4                       F$DCB.MEDIA=FMTNO#;

  16516  1 000107   000007 236003                    LDQ     7,DU
         1 000110   300103 552120                    STBQ    67,'20'O,PR3

      291    16517    4                       F$DCB.IASN=0;

  16517  1 000111   000000 236003                    LDQ     0,DU
         1 000112   300103 552104                    STBQ    67,'04'O,PR3

      292    16518                /*Other fields ignored on PMME's for FMTNO.*/
      293    16519    4                     END;

      294    16520    3                  B$ROSEG.CR01ID.NOWIS=B$JIT.NEXTCC;

  16520  1 000113   000000 470400 xsym               LDP0    B$JIT$
         1 000114   000000 471400 xsym               LDP1    B$ROSEG$
         1 000115   000151 236100                    LDQ     105,,PR0
         1 000116   000014 736000                    QLS     12
         1 000117   100114 676100                    ERQ     76,,PR1
         1 000120   170000 376003                    ANQ     61440,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:61   
         1 000121   100114 656100                    ERSQ    76,,PR1

      295    16521    3                  B$ROSEG.CR01ID.INT=(B$JIT.NEXTCC=%CC_FROMUC#);

  16521  1 000122   400000 220003                    LDX0    -131072,DU
         1 000123   000151 236100                    LDQ     105,,PR0
         1 000124   000777 376003                    ANQ     511,DU
         1 000125   000003 116003                    CMPQ    3,DU
         1 000126   000130 600000 1                  TZE     s:16521+6
         1 000127   000000 220003                    LDX0    0,DU
         1 000130   000000 636010                    EAQ     0,X0
         1 000131   100114 676100                    ERQ     76,,PR1
         1 000132   400000 376003                    ANQ     -131072,DU
         1 000133   100114 656100                    ERSQ    76,,PR1

      296    16522    3                  B$ROSEG.CR01ID.JCL=(B$JIT.NEXTCC=%CC_FROMJOB#);

  16522  1 000134   400000 220003                    LDX0    -131072,DU
         1 000135   000151 236100                    LDQ     105,,PR0
         1 000136   000777 376003                    ANQ     511,DU
         1 000137   000001 116003                    CMPQ    1,DU
         1 000140   000142 600000 1                  TZE     s:16522+6
         1 000141   000000 220003                    LDX0    0,DU
         1 000142   000000 636010                    EAQ     0,X0
         1 000143   000001 772000                    QRL     1
         1 000144   100114 676100                    ERQ     76,,PR1
         1 000145   200000 376003                    ANQ     65536,DU
         1 000146   100114 656100                    ERSQ    76,,PR1

      297    16523    3                  B$ROSEG.CR01DCB=POFFW(JDCB$,B$ROSEG$);

  16523  1 000147   000000 235000 xsym               LDA     B$ROSEG$
         1 000150   000022 771000                    ARL     18
         1 000151   200130 755100                    STA     UCLDCT$+2,,AUTO
         1 000152   200017 236100                    LDQ     JDCB$,,AUTO
         1 000153   000022 772000                    QRL     18
         1 000154   200130 136100                    SBLQ    UCLDCT$+2,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:62   
         1 000155   000000 620006                    EAX0    0,QL
         1 000156   100115 740100                    STX0    77,,PR1

      298    16524    3                  F$DCB.FCD=%YES#;

  16524  1 000157   200017 473500                    LDP3    JDCB$,,AUTO
         1 000160   020000 236007                    LDQ     8192,DL
         1 000161   300031 256100                    ORSQ    25,,PR3

      299    16525    3                  B$JIT.ERR='0'B;

  16525  1 000162   000012 450100                    STZ     10,,PR0

      300    16526    3                  RETURN;

  16526  1 000163   000000 702200 xent               TSX2  ! X66_ARET

      301    16527    3                END;
      302    16528    3             IF NOT B$M$UC$->F$DCB.FCD THEN DO;

  16528  1 000164   000000 471400 xsym               LDP1    B$M$UC$
         1 000165   100031 236100                    LDQ     25,,PR1
         1 000166   020000 316007                    CANQ    8192,DL
         1 000167   000206 601000 1                  TNZ     s:16537

      303    16529                /*Can't tell what to do until UC gets open.*/
      304    16530    3                  B$JIT.DCB$=B$M$UC$;

  16530  1 000170   000000 236000 xsym               LDQ     B$M$UC$
         1 000171   000000 473400 xsym               LDP3    B$JIT$
         1 000172   300232 756100                    STQ     154,,PR3

      305    16531    3                  CALL FMM$DFLOPNP;

  16531  1 000173   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000174   000000 701000 xent               TSX1    FMM$DFLOPNP
         1 000175   000000 011000                    NOP     0
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:63   

      306    16532    3                  B$JIT.DCB$=JDCB$;

  16532  1 000176   200017 236100                    LDQ     JDCB$,,AUTO
         1 000177   000000 470400 xsym               LDP0    B$JIT$
         1 000200   000232 756100                    STQ     154,,PR0

      307    16533    3                  IF NOT B$M$UC$->F$DCB.FCD THEN

  16533  1 000201   000000 471400 xsym               LDP1    B$M$UC$
         1 000202   100031 236100                    LDQ     25,,PR1
         1 000203   020000 316007                    CANQ    8192,DL
         1 000204   002646 600000 1                  TZE     CANTOPENUC

      308    16534    3                       GOTO CANTOPENUC;
      309    16535    3                  GOTO INITLOOP;

  16535  1 000205   000035 710000 1                  TRA     INITLOOP

      310    16536    3                END;
      311    16537    2             B$ROSEG.CR01ID.NOWIS=B$JIT.NEXTCC;

  16537  1 000206   000000 473400 xsym               LDP3    B$JIT$
         1 000207   300151 236100                    LDQ     105,,PR3
         1 000210   000014 736000                    QLS     12
         1 000211   000114 676100                    ERQ     76,,PR0
         1 000212   170000 376003                    ANQ     61440,DU
         1 000213   000114 656100                    ERSQ    76,,PR0

      312    16538    2             B$ROSEG.CR01ID.INT=(B$JIT.NEXTCC=%CC_FROMUC#);

  16538  1 000214   400000 221003                    LDX1    -131072,DU
         1 000215   300151 236100                    LDQ     105,,PR3
         1 000216   000777 376003                    ANQ     511,DU
         1 000217   000003 116003                    CMPQ    3,DU
         1 000220   000222 600000 1                  TZE     s:16538+6
         1 000221   000000 221003                    LDX1    0,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:64   
         1 000222   000000 636011                    EAQ     0,X1
         1 000223   000114 676100                    ERQ     76,,PR0
         1 000224   400000 376003                    ANQ     -131072,DU
         1 000225   000114 656100                    ERSQ    76,,PR0

      313    16539    2             B$ROSEG.CR01DCB=POFFW(B$M$UC$,B$ROSEG$);

  16539  1 000226   000000 235000 xsym               LDA     B$ROSEG$
         1 000227   000022 771000                    ARL     18
         1 000230   200130 755100                    STA     UCLDCT$+2,,AUTO
         1 000231   000000 236000 xsym               LDQ     B$M$UC$
         1 000232   000022 772000                    QRL     18
         1 000233   200130 136100                    SBLQ    UCLDCT$+2,,AUTO
         1 000234   000000 620006                    EAX0    0,QL
         1 000235   000115 740100                    STX0    77,,PR0

      314    16540    2           END;

      315    16541        /*D*       Now figure out where the DCB to be opened is hooked.
      316    16542                   Get DCB's Resource-Name field (RES).
      317    16543                   Encode DCB's FUN into F --
      318    16544                FUN=IN..F=1  FUN=UPDATE..F=0  FUN=CREATE..F=2.
      319    16545        */
      320    16546    1        RES=F$DCB.RES;

  16546  1 000236   200017 471500                    LDP1    JDCB$,,AUTO
         1 000237   100026 236100                    LDQ     22,,PR1
         1 000240   200025 756100                    STQ     RES,,AUTO

      321    16547    2        DO CASE(F$DCB.FUN);

  16547  1 000241   100032 221100                    LDX1    26,,PR1
         1 000242   000777 361003                    ANX1    511,DU
         1 000243   000004 101003                    CMPX1   4,DU
         1 000244   000246 602011 1                  TNC     s:16547+5,X1
         1 000245   000262 710000 1                  TRA     s:16551
         1 000246   000262 710000 1                  TRA     s:16551
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:65   
         1 000247   000252 710000 1                  TRA     s:16548
         1 000250   000254 710000 1                  TRA     s:16549
         1 000251   000257 710000 1                  TRA     s:16550

      322    16548    2        CASE(%UPDATE#); F=0;

  16548  1 000252   200023 450100                    STZ     F,,AUTO
         1 000253   000265 710000 1                  TRA     s:16558

      323    16549    2        CASE( %IN#); F=1;

  16549  1 000254   000001 235007                    LDA     1,DL
         1 000255   200023 755100                    STA     F,,AUTO
         1 000256   000265 710000 1                  TRA     s:16558

      324    16550    2        CASE(%CREATE#); F=2;

  16550  1 000257   000002 235007                    LDA     2,DL
         1 000260   200023 755100                    STA     F,,AUTO
         1 000261   000265 710000 1                  TRA     s:16558

      325    16551    2        CASE(ELSE); F=0; F$DCB.FUN=%UPDATE#;

  16551  1 000262   200023 450100                    STZ     F,,AUTO

  16551  1 000263   000001 236003                    LDQ     1,DU
         1 000264   100032 552120                    STBQ    26,'20'O,PR1

      326    16552    2        END;

      327    16553        /*D*       If DCB is assigned to a workstation (DCB.WSN non-blank),
      328    16554                it is to be attached directly to a symbiont file.  The
      329    16555                symbiont file creater is called to verify user accessibility
      330    16556                to the workstation.   This is the one shot case!
      331    16557        */
      332    16558    1        IF F$DCB.WSN~=' '

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:66   
  16558  1 000265   040000 106500                    CMPC    fill='040'O
         1 000266   100027 000010                    ADSC9   23,,PR1                  cn=0,n=8
         1 000267   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000270   000536 600000 1                  TZE     s:16653
         1 000271   200025 220100                    LDX0    RES,,AUTO
         1 000272   000071 100000 0                  CMPX0   NETMNGR+3
         1 000273   000536 600000 1                  TZE     s:16653
         1 000274   000072 100000 0                  CMPX0   NETMNGR+4
         1 000275   000536 600000 1                  TZE     s:16653
         1 000276   000073 100000 0                  CMPX0   NETMNGR+5
         1 000277   000536 600000 1                  TZE     s:16653

      333    16559    1             AND SUBSTR(RES,0,2) ~= 'FE'
      334    16560    1             AND SUBSTR(RES,0,2) ~= 'NC'
      335    16561    1             AND SUBSTR(RES,0,2) ~= 'OD'
      336    16562    2        THEN DO;

      337    16563    2             JIT$=B$JIT$;

  16563  1 000300   000000 236000 xsym               LDQ     B$JIT$
         1 000301   200030 756100                    STQ     JIT$,,AUTO

      338    16564    2             F$DCB.ATTR='0'B;    /* Don't let leftovers interfere with WSN attrs */

  16564  1 000302   000000 221003                    LDX1    0,DU
         1 000303   100040 441100                    SXL1    32,,PR1

      339    16565    3             IF PN$.PROCATTR_~=ADDR(NIL) THEN DO;

  16565  1 000304   200003 473500                    LDP3    @PN$,,AUTO
         1 000305   300011 236100                    LDQ     9,,PR3
         1 000306   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000307   000321 600000 1                  TZE     s:16571

      340    16566    3                  IF B$JIT.SYSID=%JG_PRESCAN# OR B$JIT.SYSID=%JG_INSYM#

  16566  1 000310   000000 474400 xsym               LDP4    B$JIT$
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:67   
         1 000311   400000 722100                    LXL2    0,,PR4
         1 000312   000004 102003                    CMPX2   4,DU
         1 000313   000316 600000 1                  TZE     s:16568
         1 000314   000005 102003                    CMPX2   5,DU
         1 000315   000317 601000 1                  TNZ     s:16569

      341    16567    3                  THEN
      342    16568    3                       JIT$=PN$.PROCATTR_;

  16568  1 000316   200030 756100                    STQ     JIT$,,AUTO

      343    16569    3                  PN$.PROCATTR_=ADDR(NIL);

  16569  1 000317   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000320   300011 756100                    STQ     9,,PR3

      344    16570    3                END;

      345    16571    2             CALL FMD$GBUF(BUF$);

  16571  1 000321   200031 634500                    EPPR4   BUF$,,AUTO
         1 000322   200130 454500                    STP4    UCLDCT$+2,,AUTO
         1 000323   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 000324   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000325   000000 701000 xent               TSX1    FMD$GBUF
         1 000326   000000 011000                    NOP     0

      346    16572    2             CALL FSW$DESTFORM(PN$.PROCATTR_,BUF$,JIT$) ALTRET(CANTDDWSN);

  16572  1 000327   200030 630500                    EPPR0   JIT$,,AUTO
         1 000330   200132 450500                    STP0    UCLDCT$+4,,AUTO
         1 000331   200031 631500                    EPPR1   BUF$,,AUTO
         1 000332   200131 451500                    STP1    UCLDCT$+3,,AUTO
         1 000333   200003 236100                    LDQ     @PN$,,AUTO
         1 000334   000011 036003                    ADLQ    9,DU
         1 000335   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 000336   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:68   
         1 000337   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000340   000000 701000 xent               TSX1    FSW$DESTFORM
         1 000341   000521 702000 1                  TSX2    CANTDDWSN

      347    16573    3             IF KL_WSNHDR.INDIRECT# THEN DO;

  16573  1 000342   200031 470500                    LDP0    BUF$,,AUTO
         1 000343   000000 234100                    SZN     0,,PR0
         1 000344   000355 605000 1                  TPL     s:16578

      348    16574    3                  B$JIT.DCB$=JDCB$;

  16574  1 000345   200017 236100                    LDQ     JDCB$,,AUTO
         1 000346   000000 471400 xsym               LDP1    B$JIT$
         1 000347   100232 756100                    STQ     154,,PR1

      349    16575    3                  CALL FMF$REMOTE (PN$);

  16575  1 000350   200003 630500                    EPPR0   @PN$,,AUTO
         1 000351   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000352   000000 701000 xent               TSX1    FMF$REMOTE
         1 000353   000000 011000                    NOP     0

      350    16576    3                  GOTO CANTDDWSN;

  16576  1 000354   000521 710000 1                  TRA     CANTDDWSN

      351    16577    3                END;                       /*  INDIRECT#  */
      352    16578    3             IF F=1 THEN DO;               /*Symb file can't be IN.*/

  16578  1 000355   200023 235100                    LDA     F,,AUTO
         1 000356   000001 115007                    CMPA    1,DL
         1 000357   000367 601000 1                  TNZ     s:16582

      353    16579    3                  CALL FMD$RBUF (BUF$);

  16579  1 000360   200031 631500                    EPPR1   BUF$,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:69   
         1 000361   200130 451500                    STP1    UCLDCT$+2,,AUTO
         1 000362   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 000363   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000364   000000 701000 xent               TSX1    FMD$RBUF
         1 000365   000000 011000                    NOP     0

      354    16580    3                  GOTO BADFUN;

  16580  1 000366   001230 710000 1                  TRA     BADFUN

      355    16581    3                END;                       /*  F=1  */
      356    16582    2             F$DCB.PASS=' ';

  16582  1 000367   000035 235000 xsym               LDA     B_VECTNIL+29
         1 000370   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000371   200017 471500                    LDP1    JDCB$,,AUTO
         1 000372   100022 757100                    STAQ    18,,PR1

      357    16583    2             F$DCB.PSN=' ';

  16583  1 000373   040100 100400                    MLR     fill='040'O
         1 000374   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000375   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6

      358    16584    2             F$DCB.FUN=%CREATE#;

  16584  1 000376   000003 236003                    LDQ     3,DU
         1 000377   100032 552120                    STBQ    26,'20'O,PR1

      359    16585    2             F$DCB.COMP=%NO#;

  16585  1 000400   000000 236000 2                  LDQ     0
         1 000401   100031 356100                    ANSQ    25,,PR1

      360    16586    2             F$DCB.DISP=%SAVE#;

  16586  1 000402   000002 236007                    LDQ     2,DL
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:70   
         1 000403   100032 552104                    STBQ    26,'04'O,PR1

      361    16587    2             F$DCB.ACS=%SEQUEN#;

  16587  1 000404   000001 236007                    LDQ     1,DL
         1 000405   100036 552104                    STBQ    30,'04'O,PR1

      362    16588    2             F$DCB.ACCT=':SYMO';

  16588  1 000406   040100 100400                    MLR     fill='040'O
         1 000407   000074 000005 0                  ADSC9   NETMNGR+6                cn=0,n=5
         1 000410   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8

      363    16589    2             I=F$DCB.ORG;

  16589  1 000411   100032 236100                    LDQ     26,,PR1
         1 000412   000033 772000                    QRL     27
         1 000413   200021 756100                    STQ     I,,AUTO

      364    16590    2             F$DCB.CODE16$=F$DCB.FORM$;

  16590  1 000414   100050 236100                    LDQ     40,,PR1
         1 000415   100053 756100                    STQ     43,,PR1

      365    16591    3             IF NOT PN$.V_->FPT$OPEN_V.OPER.TEST THEN DO;

  16591  1 000416   200003 470500                    LDP0    @PN$,,AUTO
         1 000417   000000 473500                    LDP3    0,,PR0
         1 000420   300000 236100                    LDQ     0,,PR3
         1 000421   020000 316007                    CANQ    8192,DL
         1 000422   000445 601000 1                  TNZ     s:16600

      366    16592    3                  PN$.V_=ADDR(ZEROES);

  16592  1 000423   000001 236000 2                  LDQ     1
         1 000424   000000 756100                    STQ     0,,PR0

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:71   
      367    16593    3                  PN$.UATTR_=ADDR(NIL);

  16593  1 000425   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000426   000007 756100                    STQ     7,,PR0

      368    16594    3                  PN$.INSTATTR_=ADDR(NIL);

  16594  1 000427   000010 756100                    STQ     8,,PR0

      369    16595    3                  PN$.ACCESS_=ADDR(NIL);

  16595  1 000430   000005 756100                    STQ     5,,PR0

      370    16596    3                  PN$.ACSVEH_=ADDR(NIL);

  16596  1 000431   000006 756100                    STQ     6,,PR0

      371    16597    3                  PN$.SN_=ADDR(NIL);

  16597  1 000432   000001 756100                    STQ     1,,PR0

      372    16598    3                  CALL FSF$SYMBFILE(BUF$,PN$,JIT$)ALTRET(CANTDDWSN);

  16598  1 000433   200030 633500                    EPPR3   JIT$,,AUTO
         1 000434   200132 453500                    STP3    UCLDCT$+4,,AUTO
         1 000435   200003 236100                    LDQ     @PN$,,AUTO
         1 000436   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 000437   200031 634500                    EPPR4   BUF$,,AUTO
         1 000440   200130 454500                    STP4    UCLDCT$+2,,AUTO
         1 000441   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 000442   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000443   000000 701000 xent               TSX1    FSF$SYMBFILE
         1 000444   000521 702000 1                  TSX2    CANTDDWSN

      373    16599    3                END;

      374    16600    2             B$JIT.DCB$=JDCB$;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:72   

  16600  1 000445   200017 236100                    LDQ     JDCB$,,AUTO
         1 000446   000000 470400 xsym               LDP0    B$JIT$
         1 000447   000232 756100                    STQ     154,,PR0

      375    16601    2             F$DCB.RES=RES;

  16601  1 000450   200025 236100                    LDQ     RES,,AUTO
         1 000451   200017 471500                    LDP1    JDCB$,,AUTO
         1 000452   100026 756100                    STQ     22,,PR1

      376    16602    2             IF I=%TERMINAL# AND NOT F$DCB.DDEV.LP THEN

  16602  1 000453   200021 235100                    LDA     I,,AUTO
         1 000454   000010 115007                    CMPA    8,DL
         1 000455   000464 601000 1                  TNZ     s:16604
         1 000456   100004 236100                    LDQ     4,,PR1
         1 000457   400000 316007                    CANQ    -131072,DL
         1 000460   000464 601000 1                  TNZ     s:16604

      377    16603    2                  F$DCB.IFMT=FMTTTY#;

  16603  1 000461   016000 236003                    LDQ     7168,DU
         1 000462   100103 552140                    STBQ    67,'40'O,PR1
         1 000463   000466 710000 1                  TRA     s:16605

      378    16604    2             ELSE F$DCB.IFMT=FMTURDEV#;

  16604  1 000464   017000 236003                    LDQ     7680,DU
         1 000465   100103 552140                    STBQ    67,'40'O,PR1

      379    16605    2             IF FS$FORMREC.GRAPHIC

  16605  1 000466   200031 473500                    LDP3    BUF$,,AUTO
         1 000467   300004 430100                    FSZN    4,,PR3
         1 000470   000501 605000 1                  TPL     s:16612

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:73   
      380    16606    3             THEN DO;

      381    16607    3                  F$DCB.IFMT = FMTGR#;

  16607  1 000471   027000 236003                    LDQ     11776,DU
         1 000472   100103 552140                    STBQ    67,'40'O,PR1

      382    16608    3                  F$DCB.MEDIA = FMTSYMB#;

  16608  1 000473   000022 236003                    LDQ     18,DU
         1 000474   100103 552120                    STBQ    67,'20'O,PR1

      383    16609    3                  F$DCB.DDEV = %DDEV_GR#;

  16609  1 000475   010000 236007                    LDQ     4096,DL
         1 000476   100004 552110                    STBQ    4,'10'O,PR1

      384    16610    3                  F$DCB.ORG = %UR#;

  16610  1 000477   004000 236003                    LDQ     2048,DU
         1 000500   100032 552140                    STBQ    26,'40'O,PR1

      385    16611    3                END;                       /* THIS WAS A GRAPHIC DEVICE FORM */

      386    16612    2             F$DCB.FFLG=%FFLG_WNEW#|%FFLG_DELF#;

  16612  1 000501   120000 220003                    LDX0    40960,DU
         1 000502   100004 740100                    STX0    4,,PR1

      387    16613    2             CALL FMD$RBUF(BUF$);

  16613  1 000503   200031 633500                    EPPR3   BUF$,,AUTO
         1 000504   200130 453500                    STP3    UCLDCT$+2,,AUTO
         1 000505   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 000506   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000507   000000 701000 xent               TSX1    FMD$RBUF
         1 000510   000000 011000                    NOP     0
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:74   

      388    16614    2             B$JIT.ERR='0'B;

  16614  1 000511   000000 470400 xsym               LDP0    B$JIT$
         1 000512   000012 450100                    STZ     10,,PR0

      389    16615    2             RETURN;

  16615  1 000513   000000 702200 xent               TSX2  ! X66_ARET

  16614  1 000514                       CANTDDWSNRES null
      390    16616    2   CANTDDWSNRES:;
      391    16617    2             F$DCB.WSN=' ';

  16617  1 000514   200017 470500                    LDP0    JDCB$,,AUTO
         1 000515   000035 235000 xsym               LDA     B_VECTNIL+29
         1 000516   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000517   000027 755100                    STA     23,,PR0
         1 000520   000030 756100                    STQ     24,,PR0

  16617  1 000521                       CANTDDWSN    null
      392    16618    2   CANTDDWSN: ;
      393    16619    2             B$JIT.DCB$=JDCB$;

  16619  1 000521   200017 236100                    LDQ     JDCB$,,AUTO
         1 000522   000000 470400 xsym               LDP0    B$JIT$
         1 000523   000232 756100                    STQ     154,,PR0

      394    16620    2             F$DCB.RES=RES;

  16620  1 000524   200025 236100                    LDQ     RES,,AUTO
         1 000525   200017 471500                    LDP1    JDCB$,,AUTO
         1 000526   100026 756100                    STQ     22,,PR1

      395    16621    2             CALL FMD$RBUF(BUF$);

  16621  1 000527   200031 633500                    EPPR3   BUF$,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:75   
         1 000530   200130 453500                    STP3    UCLDCT$+2,,AUTO
         1 000531   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 000532   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000533   000000 701000 xent               TSX1    FMD$RBUF
         1 000534   000000 011000                    NOP     0

      396    16622    2             RETURN;

  16622  1 000535   000000 702200 xent               TSX2  ! X66_ARET

      397    16623    2           END;
      398    16624        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:76   
      399    16625        /*D*       If DCB is not to workstation, RES says where the DCB is
      400    16626                hooked.  RES must be a two or four character name.  There are
      401    16627                three major types of RES --
      402    16628                1.  Two-character Special Names --
      403    16629                      ME,CR,LP,CP,NO,SI,LO,PO,UC,JE,JF,C1,L1,P1.
      404    16630                      Depending on the name and on DCB.FUN, a Special Name DCB
      405    16631                      is hooked to Command stream, NO, JE, JF, Terminal, or
      406    16632                      Logical Device LP01 or CP01.
      407    16633
      408    16634                      For UC, MODE=M_INT & ORG=FPRG, the DCB is not streamed
      409    16635                      but is instead opened to a FEP user (created here) which
      410    16636                      is in control of the UC device.
      411    16637                2.  Four-character Logical Devices.
      412    16638                      Logical Devices are defined by !LDEV-M$LDEV; logical
      413    16639                      devices LP01 and CP01 are system-defined.
      414    16640                3.  Two- or four-character Resource Devices.
      415    16641                      Resource devices come in four flavors --
      416    16642                      DPxx is a Device Pack.  Diagnostic use only.
      417    16643                      FTxx,MTxx,LTxx is an unlabeled magnetic tape.  Tape
      418    16644                         drives are acquired on a !RESOURCE command.
      419    16645                         Tape device DCB's are opened by general tape code.
      420    16646                      FExx is used to start device handlers on FEP xx.
      421    16647                         This usage requires MFEP privilege.
      422    16648                      NC is a network connection.
      423    16649                         This connection is actually made by the KIS$OSI code.
      424    16650                      Other resource devices are acquired on a !RESOURCE
      425    16651                         command, and are opened here.
      426    16652        */
      427    16653    1        NEWSTREAM='0'B;

  16653  1 000536   200014 450100                    STZ     NEWSTREAM,,AUTO

      428    16654    1        CALL INDEX(I,' ',RES);

  16654  1 000537   000000 124500                    SCM     mask='000'O
         1 000540   200025 000004                    ADSC9   RES,,AUTO                cn=0,n=4
         1 000541   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:77   
         1 000542   200021 000100                    ARG     I,,AUTO

      429    16655    2        DO CASE(I);

  16655  1 000543   200021 235100                    LDA     I,,AUTO
         1 000544   000005 115007                    CMPA    5,DL
         1 000545   000547 602005 1                  TNC     s:16655+4,AL
         1 000546   002570 710000 1                  TRA     s:17085
         1 000547   000554 710000 1                  TRA     BADRES
         1 000550   000554 710000 1                  TRA     BADRES
         1 000551   000560 710000 1                  TRA     s:16664
         1 000552   000554 710000 1                  TRA     BADRES
         1 000553   001314 710000 1                  TRA     s:16836

      430    16656    2        CASE(0,1,3);

  16620  1 000554                       BADRES       null
      431    16657    2   BADRES: ;
      432    16658    2           B$JIT.ERR=ERR_INVRES;

  16658  1 000554   000033 236000 0                  LDQ     ERR_INVRES
         1 000555   000000 470400 xsym               LDP0    B$JIT$
         1 000556   000012 756100                    STQ     10,,PR0

      433    16659        /*E*    ERROR: FSN-E$INVRES-2
      434    16660                MESSAGE: Invalid resource specified in DCB %DC
      435    16661         */
      436    16662    2           RETURN;

  16662  1 000557   000000 702200 xent               TSX2  ! X66_ARET

      437    16663    2        CASE(2);                      /* THIS IS FOR DEVICE WITH NO NUMBER IE LP */

      438    16664    2           IF SUBSTR(RES,2,2)~='  ' THEN GOTO BADRES;

  16664  1 000560   200025 720100                    LXL0    RES,,AUTO
         1 000561   000076 100000 0                  CMPX0   NETMNGR+8
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:78   
         1 000562   000554 601000 1                  TNZ     BADRES

      439    16665    2           CALL INDEX(I,SUBSTR(RES,0,2),

  16665  1 000563   000100 120400                    SCD
         1 000564   000077 000062 0                  ADSC9   NETMNGR+9                cn=0,n=50
         1 000565   200025 000002                    ADSC9   RES,,AUTO                cn=0,n=2
         1 000566   200021 000100                    ARG     I,,AUTO
         1 000567   000572 607000 1                  TTF     s:16668
         1 000570   200021 054100                    AOS     I,,AUTO
         1 000571   001326 710000 1                  TRA     LBL_RDEV

      440    16666    2                'ME CR LP LO NO CP PO UC JE JF SI C1 L1 P1 FE GR NC')
      441    16667    2                ALTRET(LBL_RDEV);
      442    16668    2           TSTFINFO=-1;

  16668  1 000572   000001 335007                    LCA     1,DL
         1 000573   200037 755100                    STA     TSTFINFO,,AUTO

      443    16669    2           F$DCB.STR=STR;

  16669  1 000574   200027 236100                    LDQ     STR,,AUTO
         1 000575   100077 552104                    STBQ    63,'04'O,PR1

      444    16670    3           DO CASE(I+F);

  16670  1 000576   200021 236100                    LDQ     I,,AUTO
         1 000577   200023 036100                    ADLQ    F,,AUTO
         1 000600   000061 116007                    CMPQ    49,DL
         1 000601   000603 602006 1                  TNC     s:16670+5,QL
         1 000602   001230 710000 1                  TRA     BADFUN
         1 000603   000771 710000 1                  TRA     s:16718
         1 000604   001073 710000 1                  TRA     s:16748
         1 000605   000730 710000 1                  TRA     s:16695
         1 000606   001073 710000 1                  TRA     s:16748
         1 000607   001073 710000 1                  TRA     s:16748
         1 000610   001230 710000 1                  TRA     BADFUN
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:79   
         1 000611   000664 710000 1                  TRA     LBL_LP
         1 000612   001230 710000 1                  TRA     BADFUN
         1 000613   000664 710000 1                  TRA     LBL_LP
         1 000614   000730 710000 1                  TRA     s:16695
         1 000615   001230 710000 1                  TRA     BADFUN
         1 000616   000730 710000 1                  TRA     s:16695
         1 000617   000676 710000 1                  TRA     s:16678
         1 000620   000706 710000 1                  TRA     s:16683
         1 000621   000676 710000 1                  TRA     s:16678
         1 000622   000671 710000 1                  TRA     LBL_CP
         1 000623   001230 710000 1                  TRA     BADFUN
         1 000624   000671 710000 1                  TRA     LBL_CP
         1 000625   000742 710000 1                  TRA     s:16701
         1 000626   001230 710000 1                  TRA     BADFUN
         1 000627   000742 710000 1                  TRA     s:16701
         1 000630   000757 710000 1                  TRA     s:16707
         1 000631   000764 710000 1                  TRA     s:16712
         1 000632   000757 710000 1                  TRA     s:16707
         1 000633   001230 710000 1                  TRA     BADFUN
         1 000634   001230 710000 1                  TRA     BADFUN
         1 000635   000752 710000 1                  TRA     s:16705
         1 000636   001230 710000 1                  TRA     BADFUN
         1 000637   001230 710000 1                  TRA     BADFUN
         1 000640   000752 710000 1                  TRA     s:16705
         1 000641   001073 710000 1                  TRA     s:16748
         1 000642   001073 710000 1                  TRA     s:16748
         1 000643   001230 710000 1                  TRA     BADFUN
         1 000644   001073 710000 1                  TRA     s:16748
         1 000645   001073 710000 1                  TRA     s:16748
         1 000646   001230 710000 1                  TRA     BADFUN
         1 000647   000664 710000 1                  TRA     LBL_LP
         1 000650   001230 710000 1                  TRA     BADFUN
         1 000651   000664 710000 1                  TRA     LBL_LP
         1 000652   000671 710000 1                  TRA     LBL_CP
         1 000653   001230 710000 1                  TRA     BADFUN
         1 000654   000671 710000 1                  TRA     LBL_CP
         1 000655   001131 710000 1                  TRA     s:16762
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:80   
         1 000656   001131 710000 1                  TRA     s:16762
         1 000657   001131 710000 1                  TRA     s:16762
         1 000660   000711 710000 1                  TRA     s:16686
         1 000661   001230 710000 1                  TRA     BADFUN
         1 000662   000711 710000 1                  TRA     s:16686
         1 000663   001212 710000 1                  TRA     s:16794

      445    16671    3           CASE(6,8/*LP-UPD,CRE*/,36,38/*L1-UPD,CRE*/);

      446    16672    3   LBL_LP:    RES='LP01';

  16672  1 000664   000114 236000 0     LBL_LP       LDQ     NETMNGR+22
         1 000665   200025 756100                    STQ     RES,,AUTO

      447    16673    3              CALL OPENLDEV ALTRET(ALTRETUR);

  16673  1 000666   002672 701000 1                  TSX1    OPENLDEV
         1 000667   002654 702000 1                  TSX2    ALTRETUR
         1 000670   001234 710000 1                  TRA     MEBBETSTF

      448    16674    3           CASE(15,17/*CP-UPD,CRE*/,39,41/*P1-UPD,CRE*/);

      449    16675    3   LBL_CP:    RES='CP01';

  16675  1 000671   000115 236000 0     LBL_CP       LDQ     NETMNGR+23
         1 000672   200025 756100                    STQ     RES,,AUTO

      450    16676    3              CALL OPENLDEV ALTRET(ALTRETUR);

  16676  1 000673   002672 701000 1                  TSX1    OPENLDEV
         1 000674   002654 702000 1                  TSX2    ALTRETUR
         1 000675   001234 710000 1                  TRA     MEBBETSTF

      451    16677    3           CASE(12,14/*NO-UPD,CRE*/);

      452    16678    3              F$DCB.FFLG=%FFLG_OWNER#;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:81   
  16678  1 000676   765700 221003                    LDX1    -5184,DU
         1 000677   100004 741100                    STX1    4,,PR1

      453    16679    3              IF JDCB$ = B$M$UC$ THEN

  16679  1 000700   200017 236100                    LDQ     JDCB$,,AUTO
         1 000701   000000 116000 xsym               CMPQ    B$M$UC$
         1 000702   000705 601000 1                  TNZ     s:16681

      454    16680    3                   F$DCB.UCOUT = %YES#;

  16680  1 000703   001000 236003                    LDQ     512,DU
         1 000704   100067 256100                    ORSQ    55,,PR1

      455    16681    3              GOTO LBL_NO;

  16681  1 000705   002432 710000 1                  TRA     LBL_NO

      456    16682    3           CASE(13/*NO-IN*/);

      457    16683    3              F$DCB.FFLG=%FFLG_READ#;

  16683  1 000706   400000 221003                    LDX1    -131072,DU
         1 000707   100004 741100                    STX1    4,,PR1

      458    16684    3              GOTO LBL_NO;

  16684  1 000710   002432 710000 1                  TRA     LBL_NO

      459    16685    3           CASE (45,47 /* GR UP, CR */ );  /*The GR IN case should error*/

      460    16686    3              RES = 'GR01';

  16686  1 000711   000116 236000 0                  LDQ     NETMNGR+24
         1 000712   200025 756100                    STQ     RES,,AUTO

      461    16687    3              F$DCB.IFMT = FMTGRSTRM#;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:82   

  16687  1 000713   030000 236003                    LDQ     12288,DU
         1 000714   100103 552140                    STBQ    67,'40'O,PR1

      462    16688    3              F$DCB.MEDIA = FMTSYMB#;

  16688  1 000715   000022 236003                    LDQ     18,DU
         1 000716   100103 552120                    STBQ    67,'20'O,PR1

      463    16689    3              F$DCB.DDEV = %DDEV_GR#;

  16689  1 000717   010000 236007                    LDQ     4096,DL
         1 000720   100004 552110                    STBQ    4,'10'O,PR1

      464    16690    3              F$DCB.IASN = %STREAM#;

  16690  1 000721   000005 236007                    LDQ     5,DL
         1 000722   100103 552104                    STBQ    67,'04'O,PR1

      465    16691    3              F$DCB.ORG = %UR#;

  16691  1 000723   004000 236003                    LDQ     2048,DU
         1 000724   100032 552140                    STBQ    26,'40'O,PR1

      466    16692    3              CALL OPENLDEV ALTRET (ALTRETUR);

  16692  1 000725   002672 701000 1                  TSX1    OPENLDEV
         1 000726   002654 702000 1                  TSX2    ALTRETUR
         1 000727   001234 710000 1                  TRA     MEBBETSTF

      467    16693    3           CASE(9,11/*LO-UPD,CRE*/,2/*ME-CRE*/);

      468    16694                /*Batch LO=LP01, Interactive LO=M$UC.*/
      469    16695    3              IF NOT B$ROSEG.CR01ID.INT THEN GOTO LBL_LP;

  16695  1 000730   000114 234100                    SZN     76,,PR0
         1 000731   000664 605000 1                  TPL     LBL_LP
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:83   

      470    16696    3              F$DCB.FFLG=%FFLG_WNEW#;

  16696  1 000732   100000 221003                    LDX1    32768,DU
         1 000733   100004 741100                    STX1    4,,PR1

  16696  1 000734                       LBL_UC       null
      471    16697    3   LBL_UC:    ;
      472    16698    3              RES = CONV_STR(STR);

  16698  1 000734   200027 720100                    LXL0    STR,,AUTO
         1 000735   000026 236010 0                  LDQ     CONV_STR,X0
         1 000736   200025 756100                    STQ     RES,,AUTO

      473    16699    3              CALL OPENLDEV ALTRET(ALTRETUR);

  16699  1 000737   002672 701000 1                  TSX1    OPENLDEV
         1 000740   002654 702000 1                  TSX2    ALTRETUR
         1 000741   001234 710000 1                  TRA     MEBBETSTF

      474    16700    3           CASE(18,20/*PO-UPD,CRE*/);

      475    16701    3              IF B$JIT.MODE=%M_BATCH# THEN GOTO LBL_CP;

  16701  1 000742   000000 473400 xsym               LDP3    B$JIT$
         1 000743   300000 236100                    LDQ     0,,PR3
         1 000744   740000 376003                    ANQ     -16384,DU
         1 000745   040000 116003                    CMPQ    16384,DU
         1 000746   000671 600000 1                  TZE     LBL_CP

      476    16702    3              F$DCB.FFLG=%FFLG_WNEW#;

  16702  1 000747   100000 221003                    LDX1    32768,DU
         1 000750   100004 741100                    STX1    4,,PR1

      477    16703    3              GOTO LBL_NO;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:84   
  16703  1 000751   002432 710000 1                  TRA     LBL_NO

      478    16704    3           CASE(26/*JE-CRE*/,29/*JF-CRE*/);

      479    16705    3              CALL FSD$JEJFOPN(PN$) ALTRET(ALTRETUR);

  16705  1 000752   200003 630500                    EPPR0   @PN$,,AUTO
         1 000753   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000754   000000 701000 xent               TSX1    FSD$JEJFOPN
         1 000755   002654 702000 1                  TSX2    ALTRETUR
         1 000756   001234 710000 1                  TRA     MEBBETSTF

      480    16706    3           CASE(21,23/*UC-UPD,CRE*/);

      481    16707    3              F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;

  16707  1 000757   500000 221003                    LDX1    -98304,DU
         1 000760   100004 741100                    STX1    4,,PR1

      482    16708                /*Batch UC=NO, Interactive UC=M$UC.*/
      483    16709    3              IF NOT B$ROSEG.CR01ID.INT THEN GOTO LBL_NO;

  16709  1 000761   000114 234100                    SZN     76,,PR0
         1 000762   002432 605000 1                  TPL     LBL_NO

      484    16710    3              GOTO LBL_UC;

  16710  1 000763   000734 710000 1                  TRA     LBL_UC

      485    16711    3           CASE(22/*UC-IN*/);

      486    16712    3              F$DCB.FFLG=%FFLG_READ#;

  16712  1 000764   400000 221003                    LDX1    -131072,DU
         1 000765   100004 741100                    STX1    4,,PR1

      487    16713                /*Batch UC=NO, Interactive UC=M$UC.*/
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:85   
      488    16714    3              IF NOT B$ROSEG.CR01ID.INT THEN GOTO LBL_NO;

  16714  1 000766   000114 234100                    SZN     76,,PR0
         1 000767   002432 605000 1                  TPL     LBL_NO

      489    16715    3              GOTO LBL_UC;

  16715  1 000770   000734 710000 1                  TRA     LBL_UC

      490    16716    3           CASE(0/*ME-UPD*/);

      491    16717                /*Batch ME=CR/LP, Interactive ME=CR/M$UC.*/
      492    16718    4              IF NOT B$ROSEG.CR01ID.INT THEN DO;

  16718  1 000771   000114 234100                    SZN     76,,PR0
         1 000772   001003 604000 1                  TMI     s:16724

      493    16719    4                   RES='LP01';

  16719  1 000773   000114 236000 0                  LDQ     NETMNGR+22
         1 000774   200025 756100                    STQ     RES,,AUTO

      494    16720    4                   CALL OPENLDEV ALTRET(ALTRETUR);

  16720  1 000775   002672 701000 1                  TSX1    OPENLDEV
         1 000776   002654 702000 1                  TSX2    ALTRETUR

      495    16721    4                   F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;

  16721  1 000777   500000 220003                    LDX0    -98304,DU
         1 001000   200017 470500                    LDP0    JDCB$,,AUTO
         1 001001   000004 740100                    STX0    4,,PR0

      496    16722    4                   GOTO LBL_MEBI;

  16722  1 001002   001111 710000 1                  TRA     LBL_MEBI

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:86   
      497    16723    4                 END;
      498    16724    3              F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;

  16724  1 001003   500000 221003                    LDX1    -98304,DU
         1 001004   100004 741100                    STX1    4,,PR1

      499    16725    3              RES = CONV_STR(STR);

  16725  1 001005   200027 722100                    LXL2    STR,,AUTO
         1 001006   000026 236012 0                  LDQ     CONV_STR,X2
         1 001007   200025 756100                    STQ     RES,,AUTO

      500    16726    3              CALL OPENLDEV ALTRET (ALTRETUR);

  16726  1 001010   002672 701000 1                  TSX1    OPENLDEV
         1 001011   002654 702000 1                  TSX2    ALTRETUR

      501    16727    3              IF F$DCB.ORG = %FPRG# AND B$JIT.MODE = %M_INT#

  16727  1 001012   200017 470500                    LDP0    JDCB$,,AUTO
         1 001013   000032 236100                    LDQ     26,,PR0
         1 001014   777000 376003                    ANQ     -512,DU
         1 001015   012000 116003                    CMPQ    5120,DU
         1 001016   001024 601000 1                  TNZ     s:16730
         1 001017   000000 471400 xsym               LDP1    B$JIT$
         1 001020   100000 236100                    LDQ     0,,PR1
         1 001021   740000 376003                    ANQ     -16384,DU
         1 001022   140000 116003                    CMPQ    49152,DU
         1 001023   002603 600000 1                  TZE     ALL_DONE

      502    16728    3              THEN
      503    16729    3                   GOTO ALL_DONE;
      504    16730    3              TSTFINFO=-1;       /* Don't trash the *X dcb if it's a TEST open */

  16730  1 001024   000001 335007                    LCA     1,DL
         1 001025   200037 755100                    STA     TSTFINFO,,AUTO

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:87   
  16730  1 001026                       LBL_MEII     null
      505    16731    3   LBL_MEII:  ;
      506    16732    4              IF B$ROSEG.CR01DCB=0 THEN DO;

  16732  1 001026   000000 470400 xsym               LDP0    B$ROSEG$
         1 001027   000115 220100                    LDX0    77,,PR0
         1 001030   001036 601000 1                  TNZ     s:16736

      507    16733    4                   CALL FSD$C1GETDCB ALTRET(ALTRETUR);

  16733  1 001031   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001032   000000 701000 xent               TSX1    FSD$C1GETDCB
         1 001033   002654 702000 1                  TSX2    ALTRETUR

      508    16734    4                   TSTFINFO=100;

  16734  1 001034   000144 235007                    LDA     100,DL
         1 001035   200037 755100                    STA     TSTFINFO,,AUTO

      509    16735    4                 END;

      510    16736    3              F$DCB.CFU$=PINCRW(B$ROSEG$,B$ROSEG.CR01DCB);

  16736  1 001036   000000 470400 xsym               LDP0    B$ROSEG$
         1 001037   000115 220100                    LDX0    77,,PR0
         1 001040   000000 636010                    EAQ     0,X0
         1 001041   000000 036000 xsym               ADLQ    B$ROSEG$
         1 001042   200017 471500                    LDP1    JDCB$,,AUTO
         1 001043   100066 756100                    STQ     54,,PR1

      511    16737    4              IF B$JIT.NEXTCC=%CC_FROMXEQ# THEN DO;

  16737  1 001044   000000 473400 xsym               LDP3    B$JIT$
         1 001045   300151 236100                    LDQ     105,,PR3
         1 001046   000777 376003                    ANQ     511,DU
         1 001047   000002 116003                    CMPQ    2,DU
         1 001050   001056 601000 1                  TNZ     s:16742
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:88   

      512    16738    4                   F$DCB.DDEV.IC='0'B;

  16738  1 001051   000002 236000 2                  LDQ     2
         1 001052   100004 356100                    ANSQ    4,,PR1

      513    16739    4                   F$DCB.DDEV.XEQ='1'B;

  16739  1 001053   040000 236007                    LDQ     16384,DL
         1 001054   100004 256100                    ORSQ    4,,PR1

      514    16740    4                 END;

  16740  1 001055   001063 710000 1                  TRA     s:16744

      515    16741    4              ELSE DO;

      516    16742    4                   F$DCB.DDEV.IC=B$M$UC$->F$DCB.DDEV.IC;

  16742  1 001056   000000 474400 xsym               LDP4    B$M$UC$
         1 001057   400004 236100                    LDQ     4,,PR4
         1 001060   100004 676100                    ERQ     4,,PR1
         1 001061   100000 376007                    ANQ     32768,DL
         1 001062   100004 656100                    ERSQ    4,,PR1

      517    16743    4                 END;

      518    16744    3              F$DCB.UCOUT=B$M$UC$->F$DCB.UCOUT;

  16744  1 001063   000000 474400 xsym               LDP4    B$M$UC$
         1 001064   400067 236100                    LDQ     55,,PR4
         1 001065   100067 676100                    ERQ     55,,PR1
         1 001066   001000 376003                    ANQ     512,DU
         1 001067   100067 656100                    ERSQ    55,,PR1

      519    16745    3              F$DCB.CTLCMDIN=%YES#;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:89   
  16745  1 001070   004000 236007                    LDQ     2048,DL
         1 001071   100103 256100                    ORSQ    67,,PR1
         1 001072   001234 710000 1                  TRA     MEBBETSTF

      520    16746    3           CASE(1/*ME-IN*/,3,4/*CR-UPD,IN*/,

      521    16747    3                   30,31/*SI-UPD,IN*/,33,34/*C1-UPD,IN*/);
      522    16748    3              F$DCB.FFLG=%FFLG_READ#;

  16748  1 001073   400000 221003                    LDX1    -131072,DU
         1 001074   100004 741100                    STX1    4,,PR1

      523    16749    3              F$DCB.ORG=%UR#;

  16749  1 001075   004000 236003                    LDQ     2048,DU
         1 001076   100032 552140                    STBQ    26,'40'O,PR1

      524    16750    3              F$DCB.IASN=%STREAM#;

  16750  1 001077   000005 236007                    LDQ     5,DL
         1 001100   100103 552104                    STBQ    67,'04'O,PR1

      525    16751    3              F$DCB.IFMT=FMTURSTRM#;

  16751  1 001101   020000 236003                    LDQ     8192,DU
         1 001102   100103 552140                    STBQ    67,'40'O,PR1

      526    16752                /*Batch ME=CR01, Interactive ME=UC/XEQ.*/
      527    16753    3              IF B$ROSEG.CR01ID.INT THEN GOTO LBL_MEII;

  16753  1 001103   000114 234100                    SZN     76,,PR0
         1 001104   001026 604000 1                  TMI     LBL_MEII

      528    16754    3              F$DCB.CFU$=PINCRW(B$ROSEG$,B$ROSEG.CR01DCB);

  16754  1 001105   000115 222100                    LDX2    77,,PR0
         1 001106   000000 636012                    EAQ     0,X2
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:90   
         1 001107   000000 036000 xsym               ADLQ    B$ROSEG$
         1 001110   100066 756100                    STQ     54,,PR1

  16754  1 001111                       LBL_MEBI     null
      529    16755    3   LBL_MEBI:  ;
      530    16756    3              IF B$JIT.NEXTCC=%CC_FROMXEQ# THEN

  16756  1 001111   000000 470400 xsym               LDP0    B$JIT$
         1 001112   000151 236100                    LDQ     105,,PR0
         1 001113   000777 376003                    ANQ     511,DU
         1 001114   000002 116003                    CMPQ    2,DU
         1 001115   001121 601000 1                  TNZ     s:16758

      531    16757    3                   F$DCB.DDEV.XEQ='1'B;

  16757  1 001116   200017 471500                    LDP1    JDCB$,,AUTO
         1 001117   040000 236007                    LDQ     16384,DL
         1 001120   100004 256100                    ORSQ    4,,PR1

      532    16758    3              F$DCB.CTLCMDIN=%YES#;

  16758  1 001121   200017 471500                    LDP1    JDCB$,,AUTO
         1 001122   004000 236007                    LDQ     2048,DL
         1 001123   100103 256100                    ORSQ    67,,PR1

      533    16759    3              CALL CHECK_COMP(STR) ALTRET (ALTRETUR);

  16759  1 001124   200027 633500                    EPPR3   STR,,AUTO
         1 001125   200045 453500                    STP3    CGID+1,,AUTO
         1 001126   003635 701000 1                  TSX1    CHECK_COMP
         1 001127   002654 702000 1                  TSX2    ALTRETUR
         1 001130   001234 710000 1                  TRA     MEBBETSTF

      534    16760
      535    16761    3           CASE(42/*FE-UPD*/,43/*FE_IN*/,44/*FE_CRE*/);

      536    16762    3              IF F$DCB.ORG ~= %DBGCG# AND F$DCB.ORG ~= %DBGDCB#
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:91   

  16762  1 001131   100032 236100                    LDQ     26,,PR1
         1 001132   777000 376003                    ANQ     -512,DU
         1 001133   025000 116003                    CMPQ    10752,DU
         1 001134   001165 600000 1                  TZE     s:16781
         1 001135   024000 116003                    CMPQ    10240,DU
         1 001136   001165 600000 1                  TZE     s:16781

      537    16763    4              THEN DO;

      538    16764    4                   IF F$DCB.WSN = ' '

  16764  1 001137   040000 106500                    CMPC    fill='040'O
         1 001140   100027 000010                    ADSC9   23,,PR1                  cn=0,n=8
         1 001141   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 001142   001157 600000 1                  TZE     BADFEP

      539    16765    4                   THEN
      540    16766    4                        GOTO BADFEP;
      541    16767    4                   ELSE
      542    16768    4                        CALL KIN$CONV_NODENAME(F$DCB.WSN,FEX,HOST)

  16768  1 001143   200015 633500                    EPPR3   HOST,,AUTO
         1 001144   200132 453500                    STP3    UCLDCT$+4,,AUTO
         1 001145   200026 634500                    EPPR4   FEX,,AUTO
         1 001146   200131 454500                    STP4    UCLDCT$+3,,AUTO
         1 001147   200017 236100                    LDQ     JDCB$,,AUTO
         1 001150   000027 036003                    ADLQ    23,DU
         1 001151   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 001152   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 001153   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001154   000000 701000 xent               TSX1    KIN$CONV_NODENAME
         1 001155   001157 702000 1                  TSX2    BADFEP
         1 001156   001163 710000 1                  TRA     s:16777

      543    16769    5                        WHENALTRETURN DO;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:92   
      544    16770    5   BADFEP:                   ;

  16770  1 001157                       BADFEP       null
      545    16771    5                             B$JIT.ERR = ERR_BADFEP;

  16771  1 001157   000042 236000 0                  LDQ     ERR_BADFEP
         1 001160   000000 470400 xsym               LDP0    B$JIT$
         1 001161   000012 756100                    STQ     10,,PR0

      546    16772                            /*E* ERROR: FSN-E$BAD_FEP-0
      547    16773                                 MESSAGE: There is no FEP with that name.
      548    16774         */
      549    16775    5                             RETURN;

  16775  1 001162   000000 702200 xent               TSX2  ! X66_ARET

      550    16776    5                           END;
      551    16777    4                   IF HOST

  16777  1 001163   200015 234100                    SZN     HOST,,AUTO
         1 001164   001157 604000 1                  TMI     BADFEP

      552    16778    4                   THEN
      553    16779    4                        GOTO BADFEP;
      554    16780    4                 END;

      555    16781    3              IF F$DCB.ORG = %HANDLER# OR F$DCB.ORG = %FPRG#

  16781  1 001165   200017 470500                    LDP0    JDCB$,,AUTO
         1 001166   000032 236100                    LDQ     26,,PR0
         1 001167   777000 376003                    ANQ     -512,DU
         1 001170   014000 116003                    CMPQ    6144,DU
         1 001171   001174 600000 1                  TZE     s:16783
         1 001172   012000 116003                    CMPQ    5120,DU
         1 001173   001175 601000 1                  TNZ     s:16786

      556    16782    4              THEN DO;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:93   

      557    16783    4                   GOTO DO_FE;

  16783  1 001174   002336 710000 1                  TRA     DO_FE

      558    16784    4                 END;
      559    16785
      560    16786    3              IF F$DCB.ORG=%DBGDCB# OR F$DCB.ORG=%DBGCG#

  16786  1 001175   024000 116003                    CMPQ    10240,DU
         1 001176   001203 600000 1                  TZE     s:16788
         1 001177   025000 116003                    CMPQ    10752,DU
         1 001200   001203 600000 1                  TZE     s:16788
         1 001201   026000 116003                    CMPQ    11264,DU
         1 001202   001230 601000 1                  TNZ     BADFUN

      561    16787    3                   OR F$DCB.ORG = %DBGSYSID#
      562    16788    3              THEN CALL DBGFPRG ALTRET(ALTRETUR);

  16788  1 001203   004435 701000 1                  TSX1    DBGFPRG
         1 001204   002654 702000 1                  TSX2    ALTRETUR
         1 001205   001206 710000 1                  TRA     s:16790

      563    16789    3              ELSE GOTO BADFUN;
      564    16790    3              F$DCB.FFLG=%FFLG_READ#|%FFLG_WNEW#;

  16790  1 001206   500000 220003                    LDX0    -98304,DU
         1 001207   200017 470500                    LDP0    JDCB$,,AUTO
         1 001210   000004 740100                    STX0    4,,PR0
         1 001211   001234 710000 1                  TRA     MEBBETSTF

      565    16791
      566    16792    3           CASE ( 48 /* NC-UPD */) ;

      567    16793
      568    16794    3              F$DCB.IASN = %DEVICE# ;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:94   
  16794  1 001212   000003 236007                    LDQ     3,DL
         1 001213   100103 552104                    STBQ    67,'04'O,PR1

      569    16795    3              F$DCB.FFLG = %FFLG_READ# | %FFLG_WNEW# ;

  16795  1 001214   500000 221003                    LDX1    -98304,DU
         1 001215   100004 741100                    STX1    4,,PR1

      570    16796    3              F$DCB.ATTR.TRANSLGL = '1'B;

  16796  1 001216   000200 236007                    LDQ     128,DL
         1 001217   100040 256100                    ORSQ    32,,PR1

      571    16797    3              F$DCB.IFMT = FMTNC#;

  16797  1 001220   031000 236003                    LDQ     12800,DU
         1 001221   100103 552140                    STBQ    67,'40'O,PR1

      572    16798    3              F$DCB.MEDIA = FMTNC#;

  16798  1 001222   000031 236003                    LDQ     25,DU
         1 001223   100103 552120                    STBQ    67,'20'O,PR1

      573    16799
      574    16800    3              CALL KIS$OSI_OPEN ALTRET (ALTRETUR);

  16800  1 001224   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001225   000000 701000 xent               TSX1    KIS$OSI_OPEN
         1 001226   002654 702000 1                  TSX2    ALTRETUR
         1 001227   001234 710000 1                  TRA     MEBBETSTF

      575    16801
      576    16802
      577    16803    3           CASE(ELSE);

      578    16804    3   BADFUN:    B$JIT.ERR=ERR_ILLIN;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:95   
  16804  1 001230   000032 236000 0     BADFUN       LDQ     ERR_ILLIN
         1 001231   000000 470400 xsym               LDP0    B$JIT$
         1 001232   000012 756100                    STQ     10,,PR0

      579    16805        /*E*    ERROR: FSN-E$ILLIN-2
      580    16806                MESSAGE: Conflicting FUN and RES used% for %UF%.
      581    16807                MESSAGE1:Output devices must not have FUN=IN.
      582    16808                         Input devices must not have FUN=CREATE.
      583    16809                         JE, JF, and FEnn must have FUN=CREATE.
      584    16810                         FE and FEnn must have ORG={FPRG, HANDLER, or DBGx}.
      585    16811        */
      586    16812    3              RETURN;

  16812  1 001233   000000 702200 xent               TSX2  ! X66_ARET

      587    16813
      588    16814    3           END /*CASE(SPECIALNAME+FUN)*/;

      589    16815    2   MEBBETSTF:
      590    16816    3           IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN DO;

  16816  1 001234   200003 470500       MEBBETSTF    LDP0    @PN$,,AUTO
         1 001235   000000 471500                    LDP1    0,,PR0
         1 001236   100000 236100                    LDQ     0,,PR1
         1 001237   020000 316007                    CANQ    8192,DL
         1 001240   002570 600000 1                  TZE     s:17085

      591    16817    4                IF TSTFINFO>=0 AND F$DCB.CFU$ ~= B$M$UC$ THEN DO;

  16817  1 001241   200037 235100                    LDA     TSTFINFO,,AUTO
         1 001242   001311 604000 1                  TMI     s:16832
         1 001243   200017 473500                    LDP3    JDCB$,,AUTO
         1 001244   300066 236100                    LDQ     54,,PR3
         1 001245   000000 116000 xsym               CMPQ    B$M$UC$
         1 001246   001311 600000 1                  TZE     s:16832

      592    16818    5                     IF TSTFINFO<16 THEN DO;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:96   

  16818  1 001247   000020 115007                    CMPA    16,DL
         1 001250   001275 605000 1                  TPL     s:16827

      593    16819    5                          CALL CHARBIN(I,ADDR(F$DCB.CFU$->F$DCB.NAME)->

  16819  1 001251   300066 474500                    LDP4    54,,PR3
         1 001252   000100 305500                    DTB
         1 001253   400012 430006                    NDSC9   10,,PR4                  cn=2,s=nosgn,sf=0,n=6
         1 001254   200021 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      594    16820    5                               OSFN.NUM);
      595    16821    5                          B$ROSEG.STREAMID.IDENT(TSTFINFO)=I;

  16821  1 001255   200021 720100                    LXL0    I,,AUTO
         1 001256   000000 471400 xsym               LDP1    B$ROSEG$
         1 001257   100074 440105                    SXL0    60,AL,PR1

      596    16822    5                          B$ROSEG.STREAMID.FLG(TSTFINFO)=1;

  16822  1 001260   200037 720100                    LXL0    TSTFINFO,,AUTO
         1 001261   100074 236110                    LDQ     60,X0,PR1
         1 001262   000003 376000 2                  ANQ     3
         1 001263   200000 276003                    ORQ     65536,DU
         1 001264   100074 756110                    STQ     60,X0,PR1

      597    16823    5                          B$JIT.DCB$=F$DCB.CFU$;

  16823  1 001265   300066 236100                    LDQ     54,,PR3
         1 001266   000000 474400 xsym               LDP4    B$JIT$
         1 001267   400232 756100                    STQ     154,,PR4

      598    16824    5                          CALL FMP$CLSF(CLSSAVE$);

  16824  1 001270   000004 630400 2                  EPPR0   4
         1 001271   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001272   000000 701000 xent               TSX1    FMP$CLSF
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:97   
         1 001273   000000 011000                    NOP     0

      599    16825    5                        END;

  16825  1 001274   001302 710000 1                  TRA     s:16830

      600    16826    5                     ELSE DO;

      601    16827    5                          B$JIT.DCB$=F$DCB.CFU$;

  16827  1 001275   000000 474400 xsym               LDP4    B$JIT$
         1 001276   400232 756100                    STQ     154,,PR4

      602    16828    5                          B$ROSEG.CR01DCB=0;

  16828  1 001277   000000 220003                    LDX0    0,DU
         1 001300   000000 471400 xsym               LDP1    B$ROSEG$
         1 001301   100115 740100                    STX0    77,,PR1

      603    16829    5                        END;

      604    16830    4                     CALL FSA$FDCB(B$JIT.DCB$);

  16830  1 001302   000000 236000 xsym               LDQ     B$JIT$
         1 001303   000232 036003                    ADLQ    154,DU
         1 001304   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 001305   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 001306   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001307   000000 701000 xent               TSX1    FSA$FDCB
         1 001310   000000 011000                    NOP     0

      605    16831    4                   END;

      606    16832    3                B$JIT.ERR='0'B;

  16832  1 001311   000000 470400 xsym               LDP0    B$JIT$
         1 001312   000012 450100                    STZ     10,,PR0
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:98   

      607    16833    3                GOTO ALTRETUR;

  16833  1 001313   002654 710000 1                  TRA     ALTRETUR

      608    16834    3              END;
      609    16835    2        CASE(4);

      610    16836    2           TSTFINFO=-1;

  16836  1 001314   000001 336007                    LCQ     1,DL
         1 001315   200037 756100                    STQ     TSTFINFO,,AUTO

      611    16837    2           CALL OPENLDEV ALTRET(ALTRETUR);

  16837  1 001316   002672 701000 1                  TSX1    OPENLDEV
         1 001317   002654 702000 1                  TSX2    ALTRETUR

      612    16838    3           IF I<=15 THEN DO;

  16838  1 001320   200021 235100                    LDA     I,,AUTO
         1 001321   000017 115007                    CMPA    15,DL
         1 001322   001326 605400 1                  TPNZ    LBL_RDEV

      613    16839    3                IF TSTFINFO>=0 THEN GOTO MEBBETSTF;

  16839  1 001323   200037 236100                    LDQ     TSTFINFO,,AUTO
         1 001324   001234 605000 1                  TPL     MEBBETSTF

      614    16840    3              END;

  16840  1 001325   002570 710000 1                  TRA     s:17085

      615    16841    3           ELSE DO;

      616    16842    3   LBL_RDEV:    CALL INDEX(I,SUBSTR(RES,0,2),

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:99   
  16842  1 001326   000100 120400       LBL_RDEV     SCD
         1 001327   000117 000044 0                  ADSC9   NETMNGR+25               cn=0,n=36
         1 001330   200025 000002                    ADSC9   RES,,AUTO                cn=0,n=2
         1 001331   200021 000100                    ARG     I,,AUTO
         1 001332   001334 607000 1                  TTF     s:16844
         1 001333   200021 054100                    AOS     I,,AUTO

      617    16843    3                     'FT MT LT DP LP CP CR SY FT FE UC OD ');
      618    16844    4                DO CASE(I);

  16844  1 001334   200021 235100                    LDA     I,,AUTO
         1 001335   000045 115007                    CMPA    37,DL
         1 001336   001340 602005 1                  TNC     s:16844+4,AL
         1 001337   002570 710000 1                  TRA     s:17085
         1 001340   001405 710000 1                  TRA     s:16846
         1 001341   002570 710000 1                  TRA     s:17085
         1 001342   002570 710000 1                  TRA     s:17085
         1 001343   001405 710000 1                  TRA     s:16846
         1 001344   002570 710000 1                  TRA     s:17085
         1 001345   002570 710000 1                  TRA     s:17085
         1 001346   001405 710000 1                  TRA     s:16846
         1 001347   002570 710000 1                  TRA     s:17085
         1 001350   002570 710000 1                  TRA     s:17085
         1 001351   001415 710000 1                  TRA     s:16850
         1 001352   002570 710000 1                  TRA     s:17085
         1 001353   002570 710000 1                  TRA     s:17085
         1 001354   001433 710000 1                  TRA     s:16858
         1 001355   002570 710000 1                  TRA     s:17085
         1 001356   002570 710000 1                  TRA     s:17085
         1 001357   001433 710000 1                  TRA     s:16858
         1 001360   002570 710000 1                  TRA     s:17085
         1 001361   002570 710000 1                  TRA     s:17085
         1 001362   002223 710000 1                  TRA     s:16983
         1 001363   002570 710000 1                  TRA     s:17085
         1 001364   002570 710000 1                  TRA     s:17085
         1 001365   002224 710000 1                  TRA     s:16985
         1 001366   002570 710000 1                  TRA     s:17085
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:100  
         1 001367   002570 710000 1                  TRA     s:17085
         1 001370   002570 710000 1                  TRA     s:17085
         1 001371   002570 710000 1                  TRA     s:17085
         1 001372   002570 710000 1                  TRA     s:17085
         1 001373   002244 710000 1                  TRA     s:16992
         1 001374   002570 710000 1                  TRA     s:17085
         1 001375   002570 710000 1                  TRA     s:17085
         1 001376   002407 710000 1                  TRA     s:17039
         1 001377   002570 710000 1                  TRA     s:17085
         1 001400   002570 710000 1                  TRA     s:17085
         1 001401   001426 710000 1                  TRA     s:16855
         1 001402   002570 710000 1                  TRA     s:17085
         1 001403   002570 710000 1                  TRA     s:17085
         1 001404   001433 710000 1                  TRA     s:16858

      619    16845    4                CASE(0,3,6/*TAPE*/);

      620    16846    4                   F$DCB.IASN=%TAPE#;

  16846  1 001405   200017 470500                    LDP0    JDCB$,,AUTO
         1 001406   000002 236007                    LDQ     2,DL
         1 001407   000103 552104                    STBQ    67,'04'O,PR0

      621    16847    4                   CALL FTO$OPNAT(PN$);

  16847  1 001410   200003 630500                    EPPR0   @PN$,,AUTO
         1 001411   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001412   000000 701000 xent               TSX1    FTO$OPNAT
         1 001413   000000 011000                    NOP     0

      622    16848    4                   RETURN;

  16848  1 001414   000000 702200 xent               TSX2  ! X66_ARET

      623    16849    4                CASE(9/*PACK*/);

      624    16850    4                   CALL FMN$OPNDP(PN$);
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:101  

  16850  1 001415   200003 630500                    EPPR0   @PN$,,AUTO
         1 001416   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001417   000000 701000 xent               TSX1    FMN$OPNDP
         1 001420   000000 011000                    NOP     0

      625    16851    4                   F$DCB.IFMT=FMTRAN#;     /* Make FMF$PMME work right */

  16851  1 001421   200017 470500                    LDP0    JDCB$,,AUTO
         1 001422   003000 236003                    LDQ     1536,DU
         1 001423   000103 552140                    STBQ    67,'40'O,PR0

      626    16852    4                   F$DCB.ORG=%RANDOM#;     /* Make UDE$FPTCHK work right */

  16852  1 001424   000032 552140                    STBQ    26,'40'O,PR0

      627    16853    4                   RETURN;

  16853  1 001425   000000 702200 xent               TSX2  ! X66_ARET

      628    16854    4                CASE(33/*Optical Disk*/);

      629    16855    4                   CALL FPO$OPNOD(PN$);

  16855  1 001426   200003 630500                    EPPR0   @PN$,,AUTO
         1 001427   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001430   000000 701000 xent               TSX1    FPO$OPNOD
         1 001431   000000 011000                    NOP     0

      630    16856    4                   RETURN;

  16856  1 001432   000000 702200 xent               TSX2  ! X66_ARET

      631    16857    4                CASE(12,15,36/*LP,CP or anything else*/);

      632    16858    5                   IF SUBSTR(RES,0,2)~='CL' THEN DO;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:102  
  16858  1 001433   200025 220100                    LDX0    RES,,AUTO
         1 001434   000130 100000 0                  CMPX0   NETMNGR+34
         1 001435   001504 600000 1                  TZE     s:16869

      633    16859    5                        IF F$DCB.HEADER$~=ADDR(NIL) THEN

  16859  1 001436   200017 470500                    LDP0    JDCB$,,AUTO
         1 001437   000046 236100                    LDQ     38,,PR0
         1 001440   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001441   001446 600000 1                  TZE     s:16861

      634    16860    5                             CALL FSM$HDRSET(F$DCB);

  16860  1 001442   200017 630500                    EPPR0   JDCB$,,AUTO
         1 001443   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001444   000000 701000 xent               TSX1    FSM$HDRSET
         1 001445   000000 011000                    NOP     0

      635    16861    5                        CALL FMD$GBUF(BUF$);

  16861  1 001446   200031 630500                    EPPR0   BUF$,,AUTO
         1 001447   200130 450500                    STP0    UCLDCT$+2,,AUTO
         1 001450   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 001451   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001452   000000 701000 xent               TSX1    FMD$GBUF
         1 001453   000000 011000                    NOP     0

      636    16862    5                        JIT$=ADDR(NIL);

  16862  1 001454   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001455   200030 756100                    STQ     JIT$,,AUTO

      637    16863    5                        CALL FSW$DESTFORM(JIT$,BUF$,B$JIT$)ALTRET(CANTDDWSNRES);

  16863  1 001456   000005 236000 2                  LDQ     5
         1 001457   200132 756100                    STQ     UCLDCT$+4,,AUTO
         1 001460   200031 630500                    EPPR0   BUF$,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:103  
         1 001461   200131 450500                    STP0    UCLDCT$+3,,AUTO
         1 001462   200030 631500                    EPPR1   JIT$,,AUTO
         1 001463   200130 451500                    STP1    UCLDCT$+2,,AUTO
         1 001464   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 001465   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001466   000000 701000 xent               TSX1    FSW$DESTFORM
         1 001467   000514 702000 1                  TSX2    CANTDDWSNRES

      638    16864    5                        F$DCB.CODE16$=F$DCB.FORM$;

  16864  1 001470   200017 470500                    LDP0    JDCB$,,AUTO
         1 001471   000050 236100                    LDQ     40,,PR0
         1 001472   000053 756100                    STQ     43,,PR0

      639    16865    5                        F$DCB.PSN=F$DCB.FORM$->CODE16.FORM;

  16865  1 001473   000050 471500                    LDP1    40,,PR0
         1 001474   040100 100500                    MLR     fill='040'O
         1 001475   100000 000006                    ADSC9   0,,PR1                   cn=0,n=6
         1 001476   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6

      640    16866    5                        F$DCB.WSN=' ';

  16866  1 001477   000035 235000 xsym               LDA     B_VECTNIL+29
         1 001500   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 001501   000027 755100                    STA     23,,PR0
         1 001502   000030 756100                    STQ     24,,PR0

      641    16867    5                      END;

  16867  1 001503   001514 710000 1                  TRA     s:16873

      642    16868    5                   ELSE DO;

      643    16869    5                        IF PN$.V_->FPT$OPEN_V.ATTR

  16869  1 001504   200003 470500                    LDP0    @PN$,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:104  
         1 001505   000000 471500                    LDP1    0,,PR0
         1 001506   100016 221100                    LDX1    14,,PR1
         1 001507   001512 600000 1                  TZE     s:16871

      644    16870    5                        THEN F$DCB.ATTR=PN$.V_->FPT$OPEN_V.ATTR;

  16870  1 001510   200017 473500                    LDP3    JDCB$,,AUTO
         1 001511   300040 441100                    SXL1    32,,PR3

      645    16871    5                        BUF$=ADDR(NIL);

  16871  1 001512   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001513   200031 756100                    STQ     BUF$,,AUTO

      646    16872    5                      END;

      647    16873    4                   CALL FRA$OPR ALTRET(CANTDDWSNRES);

  16873  1 001514   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001515   000000 701000 xent               TSX1    FRA$OPR
         1 001516   000514 702000 1                  TSX2    CANTDDWSNRES

      648    16874    5                   IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN DO;

  16874  1 001517   200003 470500                    LDP0    @PN$,,AUTO
         1 001520   000000 471500                    LDP1    0,,PR0
         1 001521   100000 236100                    LDQ     0,,PR1
         1 001522   020000 316007                    CANQ    8192,DL
         1 001523   001530 600000 1                  TZE     s:16879

  16871  1 001524                       FRB_RTN      null
      649    16875    5   FRB_RTN:             ;
      650    16876    5                        CALL FRB$CLS;

  16876  1 001524   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001525   000000 701000 xent               TSX1    FRB$CLS
         1 001526   000000 011000                    NOP     0
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:105  

      651    16877    5                        GOTO CANTDDWSN;

  16877  1 001527   000521 710000 1                  TRA     CANTDDWSN

      652    16878    5                      END;
      653    16879    4                   LDCT$ = NK$LDCT$(F$DCB.SETX);

  16879  1 001530   200017 473500                    LDP3    JDCB$,,AUTO
         1 001531   300051 720100                    LXL0    41,,PR3
         1 001532   000000 474400 xsym               LDP4    N$DCT$$
         1 001533   400000 236110                    LDQ     0,X0,PR4
         1 001534   200020 756100                    STQ     LDCT$,,AUTO

      654    16880    4                   IF LDCT$->NK$LDCT.RESCOD ~= NK_RES

  16880  1 001535   200020 475500                    LDP5    LDCT$,,AUTO
         1 001536   500006 236100                    LDQ     6,,PR5
         1 001537   000017 376007                    ANQ     15,DL
         1 001540   000013 116007                    CMPQ    11,DL
         1 001541   001565 600000 1                  TZE     s:16894

      655    16881    5                   THEN DO;

      656    16882    5                        F$DCB.FFLG=%FFLG_WNEW#;

  16882  1 001542   100000 221003                    LDX1    32768,DU
         1 001543   300004 741100                    STX1    4,,PR3

      657    16883    5                        F$DCB.MEDIA=FMTDEV#;

  16883  1 001544   000006 236003                    LDQ     6,DU
         1 001545   300103 552120                    STBQ    67,'20'O,PR3

      658    16884    5                        F$DCB.IFMT=FMTURDEV#;

  16884  1 001546   017000 236003                    LDQ     7680,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:106  
         1 001547   300103 552140                    STBQ    67,'40'O,PR3

      659    16885    5                        F$DCB.WAIT=1;

  16885  1 001550   000020 236007                    LDQ     16,DL
         1 001551   300064 256100                    ORSQ    52,,PR3

      660    16886    5                        F$DCB.TYC(1)='0'B;

  16886  1 001552   300002 450100                    STZ     2,,PR3

      661    16887    5                        F$DCB.UB$=ADDR(FS$FORMREC.SOFTFORM);

  16887  1 001553   200031 236100                    LDQ     BUF$,,AUTO
         1 001554   000006 036000 2                  ADLQ    6
         1 001555   300075 756100                    STQ     61,,PR3

      662    16888    5                        F$DCB.UBYTES=SIZEC(FS$FORMREC.SOFTFORM);

  16888  1 001556   000124 235007                    LDA     84,DL
         1 001557   300076 755100                    STA     62,,PR3

      663    16889    5                        CALL NKA$DEVIO(MFC_WRITE,

  16889  1 001560   000011 630400 2                  EPPR0   9
         1 001561   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 001562   000000 701000 xent               TSX1    NKA$DEVIO
         1 001563   000000 011000                    NOP     0

      664    16890    5                             %DVBYTE_TRANS#|%DVBYTE_VFC#|%DVBYTE_BP#,
      665    16891    5                             %VFC_VFU,0);
      666    16892    5                      END;

  16892  1 001564   002214 710000 1                  TRA     AU_RELEASE

      667    16893    5                   ELSE DO;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:107  
      668    16894    5                        IF SUBSTR(RES,0,2)='CL'

  16894  1 001565   200025 221100                    LDX1    RES,,AUTO
         1 001566   000130 101000 0                  CMPX1   NETMNGR+34
         1 001567   002134 601000 1                  TNZ     s:16962

      669    16895    6                        THEN DO;

      670    16896    7                             IF F$DCB.IORG=%UNDEF# THEN DO;

  16896  1 001570   300070 236100                    LDQ     56,,PR3
         1 001571   077000 376003                    ANQ     32256,DU
         1 001572   021000 116003                    CMPQ    8704,DU
         1 001573   001650 601000 1                  TNZ     s:16907+1

      671    16897        /* FRA set IORG to indicate unknown status - AKA ask the AU for permission */
      672    16898    7                                  CALL FRF$EVRPT;

  16898  1 001574   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001575   000000 701000 xent               TSX1    FRF$EVRPT
         1 001576   000000 011000                    NOP     0

      673    16899    7                                  IF F$DCB.EVENT~=0 THEN GOTO FRB_RTN;

  16899  1 001577   200017 470500                    LDP0    JDCB$,,AUTO
         1 001600   000055 235100                    LDA     45,,PR0
         1 001601   001524 601000 1                  TNZ     FRB_RTN

      674    16900    7                                  I=NK$LDCT.GENERATION;

  16900  1 001602   200020 471500                    LDP1    LDCT$,,AUTO
         1 001603   100014 236100                    LDQ     12,,PR1
         1 001604   000022 772000                    QRL     18
         1 001605   000377 376007                    ANQ     255,DL
         1 001606   200021 756100                    STQ     I,,AUTO

      675    16901    8                                  DO UNTIL F$DCB.SETX~=NK$LDCT.LDCTX;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:108  

      676    16902    8                                       IF NK$LDCT.GENERATION~=I OR NK$LDCT.RAT$=ADDR(
             16902                                                NIL)

  16902  1 001607   200020 470500                    LDP0    LDCT$,,AUTO
         1 001610   000014 236100                    LDQ     12,,PR0
         1 001611   000022 772000                    QRL     18
         1 001612   000377 376007                    ANQ     255,DL
         1 001613   200021 116100                    CMPQ    I,,AUTO
         1 001614   001620 601000 1                  TNZ     s:16903
         1 001615   000005 236100                    LDQ     5,,PR0
         1 001616   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001617   001623 601000 1                  TNZ     s:16904

      677    16903    8                                       THEN F$DCB.SETX=0;

  16903  1 001620   000000 220003                    LDX0    0,DU
         1 001621   200017 471500                    LDP1    JDCB$,,AUTO
         1 001622   100051 440100                    SXL0    41,,PR1

      678    16904    8                                       CALL SSR$REG (%SS_SL,ADDR(NIL),1);

  16904  1 001623   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001624   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 001625   000011 236000 2                  LDQ     9
         1 001626   200133 756100                    STQ     UCLDCT$+5,,AUTO
         1 001627   200130 631500                    EPPR1   UCLDCT$+2,,AUTO
         1 001630   200132 451500                    STP1    UCLDCT$+4,,AUTO
         1 001631   000016 236000 2                  LDQ     14
         1 001632   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 001633   200131 630500                    EPPR0   UCLDCT$+3,,AUTO
         1 001634   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001635   000000 701000 xent               TSX1    SSR$REG
         1 001636   000000 011000                    NOP     0

      679    16905    8                                     END;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:109  
  16905  1 001637   200017 470500                    LDP0    JDCB$,,AUTO
         1 001640   000051 720100                    LXL0    41,,PR0
         1 001641   200020 471500                    LDP1    LDCT$,,AUTO
         1 001642   100006 100100                    CMPX0   6,,PR1
         1 001643   001607 600000 1                  TZE     s:16902

      680    16906    7   OPNCL_EVT:                     IF F$DCB.SETX=0 THEN GOTO FRB_RTN;

  16906  1 001644   200017 470500       OPNCL_EVT    LDP0    JDCB$,,AUTO
         1 001645   000051 720100                    LXL0    41,,PR0
         1 001646   001524 600000 1                  TZE     FRB_RTN

      681    16907    7                                END; ELSE IF F$DCB.IORG=%VARIABLE# THEN DO;

  16907  1 001647   002124 710000 1                  TRA     s:16959

  16907  1 001650   020000 116003                    CMPQ    8192,DU
         1 001651   002124 601000 1                  TNZ     s:16959

      682    16908        /* IORG is VARIABLE if only the Fep needs to be asked */
      683    16909    8                                       CALL NKL$GETDCT (JIT$) WHENALTRETURN DO;

  16909  1 001652   200030 636500                    EPPR6   JIT$,,AUTO
         1 001653   200130 456500                    STP6    UCLDCT$+2,,AUTO
         1 001654   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 001655   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001656   000000 701000 xent               TSX1    NKL$GETDCT
         1 001657   001661 702000 1                  TSX2    s:16910
         1 001660   001665 710000 1                  TRA     s:16913

      684    16910    8                                            B$JIT.ERR=ERR_PCNLDCT;

  16910  1 001661   000034 236000 0                  LDQ     ERR_PCNLDCT
         1 001662   000000 470400 xsym               LDP0    B$JIT$
         1 001663   000012 756100                    STQ     10,,PR0

      685    16911    8                                            GOTO FRB_RTN;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:110  

  16911  1 001664   001524 710000 1                  TRA     FRB_RTN

      686    16912    8                                          END;
      687    16913    7                                       JIT$->NK$LDCT.RAT$=NK$LDCT.RAT$;

  16913  1 001665   200020 470500                    LDP0    LDCT$,,AUTO
         1 001666   000005 236100                    LDQ     5,,PR0
         1 001667   200030 471500                    LDP1    JIT$,,AUTO
         1 001670   100005 756100                    STQ     5,,PR1

      688    16914    7                                       JIT$->NK$LDCT.TERMID=NK$LDCT.TERMID;

  16914  1 001671   000022 237100                    LDAQ    18,,PR0
         1 001672   200030 471500                    LDP1    JIT$,,AUTO
         1 001673   100022 757100                    STAQ    18,,PR1

      689    16915    7                                       JIT$->NK$LDCT.RESCOD=NK_RES;

  16915  1 001674   200030 471500                    LDP1    JIT$,,AUTO
         1 001675   100006 236100                    LDQ     6,,PR1
         1 001676   000017 376000 2                  ANQ     15
         1 001677   000013 276007                    ORQ     11,DL
         1 001700   100006 756100                    STQ     6,,PR1

      690    16916    7                                       JIT$->NK$LDCT.DFLG=NK$LDCT.DFLG;

  16916  1 001701   200030 471500                    LDP1    JIT$,,AUTO
         1 001702   000006 236100                    LDQ     6,,PR0
         1 001703   100006 676100                    ERQ     6,,PR1
         1 001704   777760 376007                    ANQ     -16,DL
         1 001705   100006 656100                    ERSQ    6,,PR1

      691    16917    7                                       JIT$->NK$LDCT.DFLG.INPUT='1'B;

  16917  1 001706   200030 471500                    LDP1    JIT$,,AUTO
         1 001707   400000 236007                    LDQ     -131072,DL
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:111  
         1 001710   100006 256100                    ORSQ    6,,PR1

      692    16918    7                                       JIT$->NK$LDCT.DEVNM='*CLRES*';

  16918  1 001711   200030 471500                    LDP1    JIT$,,AUTO
         1 001712   040100 100400                    MLR     fill='040'O
         1 001713   000131 000007 0                  ADSC9   NETMNGR+35               cn=0,n=7
         1 001714   100002 000010                    ADSC9   2,,PR1                   cn=0,n=8

      693    16919    7                                       RLCID.NODE=K_NODE#;

  16919  1 001715   000000 236000 xsym               LDQ     K_NODE#
         1 001716   000033 736000                    QLS     27
         1 001717   200021 552140                    STBQ    I,'40'O,AUTO

      694    16920    7                                       RLCID.LDCTX=JIT$->NK$LDCT.LDCTX+

  16920  1 001720   200030 471500                    LDP1    JIT$,,AUTO
         1 001721   100006 220100                    LDX0    6,,PR1
         1 001722   777400 360003                    ANX0    -256,DU
         1 001723   000000 636010                    EAQ     0,X0
         1 001724   000022 772000                    QRL     18
         1 001725   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 001726   100006 236100                    LDQ     6,,PR1
         1 001727   000022 772000                    QRL     18
         1 001730   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 001731   200130 236100                    LDQ     UCLDCT$+2,,AUTO
         1 001732   200131 036100                    ADLQ    UCLDCT$+3,,AUTO
         1 001733   000000 620006                    EAX0    0,QL
         1 001734   200021 440100                    SXL0    I,,AUTO

      695    16921    7                                            BITBIN('777400'O &
      696    16922    7                                            BINBIT(JIT$->NK$LDCT.LDCTX,18));
      697    16923    7                                       RLCID.GENERATION=JIT$->NK$LDCT.GENERATION;

  16923  1 001735   100014 236100                    LDQ     12,,PR1
         1 001736   000377 376003                    ANQ     255,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:112  
         1 001737   200021 552120                    STBQ    I,'20'O,AUTO

      698    16924                                            %LOCK (G=NK$LDCT.LOCK);

  16925  1 001740   200020 236100                    LDQ     LDCT$,,AUTO
         1 001741   000020 036003                    ADLQ    16,DU
         1 001742   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 001743   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 001744   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001745   000000 701000 xent               TSX1    HFC$LOCK
         1 001746   000000 011000                    NOP     0

      699    16927    7                                       JIT$->NK$LDCT.CLLNK$=NK$LDCT.CLLNK$;

  16927  1 001747   200020 470500                    LDP0    LDCT$,,AUTO
         1 001750   000012 236100                    LDQ     10,,PR0
         1 001751   200030 471500                    LDP1    JIT$,,AUTO
         1 001752   100012 756100                    STQ     10,,PR1

      700    16928    7                                       NK$LDCT.CLLNK$=JIT$;

  16928  1 001753   200030 236100                    LDQ     JIT$,,AUTO
         1 001754   000012 756100                    STQ     10,,PR0

      701    16929    8                                       DO WHILE '1'B;

      702    16930    8                                            IF NK$LDCT.USER=0 THEN NK$LDCT.USER=B$JIT.
             16930                                                     USER;

  16930  1 001755   200020 470500                    LDP0    LDCT$,,AUTO
         1 001756   000007 236100                    LDQ     7,,PR0
         1 001757   000777 316003                    CANQ    511,DU
         1 001760   001764 601000 1                  TNZ     s:16932

  16930  1 001761   000000 471400 xsym               LDP1    B$JIT$
         1 001762   100000 236100                    LDQ     0,,PR1
         1 001763   000007 552120                    STBQ    7,'20'O,PR0
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:113  

      703    16931                                                 %UNLOCK (G=NK$LDCT.LOCK);

  16932  1 001764   200020 236100                    LDQ     LDCT$,,AUTO
         1 001765   000020 036003                    ADLQ    16,DU
         1 001766   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 001767   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 001770   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001771   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001772   000000 011000                    NOP     0

      704    16934    8                                            IF NK$LDCT.USER=B$JIT.USER THEN EXIT;

  16934  1 001773   000000 470400 xsym               LDP0    B$JIT$
         1 001774   200020 471500                    LDP1    LDCT$,,AUTO
         1 001775   100007 236100                    LDQ     7,,PR1
         1 001776   000000 676100                    ERQ     0,,PR0
         1 001777   000777 376003                    ANQ     511,DU
         1 002000   002025 600000 1                  TZE     s:16940

      705    16935    8                                            CALL SSR$REG (%SS_SL,ADDR(NIL),1);

  16935  1 002001   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002002   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 002003   000011 236000 2                  LDQ     9
         1 002004   200133 756100                    STQ     UCLDCT$+5,,AUTO
         1 002005   200130 633500                    EPPR3   UCLDCT$+2,,AUTO
         1 002006   200132 453500                    STP3    UCLDCT$+4,,AUTO
         1 002007   000016 236000 2                  LDQ     14
         1 002010   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 002011   200131 630500                    EPPR0   UCLDCT$+3,,AUTO
         1 002012   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002013   000000 701000 xent               TSX1    SSR$REG
         1 002014   000000 011000                    NOP     0

      706    16936                                                 %LOCK (G=NK$LDCT.LOCK);

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:114  
  16937  1 002015   200020 236100                    LDQ     LDCT$,,AUTO
         1 002016   000020 036003                    ADLQ    16,DU
         1 002017   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 002020   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 002021   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002022   000000 701000 xent               TSX1    HFC$LOCK
         1 002023   000000 011000                    NOP     0

      707    16939    8                                          END;

  16939  1 002024   001755 710000 1                  TRA     s:16930

      708    16940    7                                       IF F$DCB.DISP~=%RELEASE# OR NK$LDCT.DCBNO=0

  16940  1 002025   200017 473500                    LDP3    JDCB$,,AUTO
         1 002026   300032 236100                    LDQ     26,,PR3
         1 002027   000777 376007                    ANQ     511,DL
         1 002030   000001 116007                    CMPQ    1,DL
         1 002031   002035 601000 1                  TNZ     s:16942
         1 002032   100014 236100                    LDQ     12,,PR1
         1 002033   000777 316007                    CANQ    511,DL
         1 002034   002057 601000 1                  TNZ     s:16945

      709    16941        /* RELEASE is used only by an AU to refuse an open without asking the Fep */
      710    16942    7                                       THEN CALL KIA$UCIOND (MFC_WRITE,

  16942  1 002035   200021 634500                    EPPR4   I,,AUTO
         1 002036   200130 454500                    STP4    UCLDCT$+2,,AUTO
         1 002037   200020 236100                    LDQ     LDCT$,,AUTO
         1 002040   000022 235000 2                  LDA     18
         1 002041   200136 757100                    STAQ    UCLDCT$+8,,AUTO
         1 002042   200130 635500                    EPPR5   UCLDCT$+2,,AUTO
         1 002043   200135 455500                    STP5    UCLDCT$+7,,AUTO
         1 002044   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002045   200134 756100                    STQ     UCLDCT$+6,,AUTO
         1 002046   000024 237000 2                  LDAQ    20
         1 002047   200132 757100                    STAQ    UCLDCT$+4,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:115  
         1 002050   000011 236000 2                  LDQ     9
         1 002051   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 002052   200131 630500                    EPPR0   UCLDCT$+3,,AUTO
         1 002053   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 002054   000000 701000 xent               TSX1    KIA$UCIOND
         1 002055   000000 011000                    NOP     0
         1 002056   002061 710000 1                  TRA     s:16946

      711    16943    7                                                 %DVBYTE_TRANS#|%DVBYTE_RRR#,'@',,
      712    16944    7                                                 ADDR(RLCID),4,NK$LDCT);
      713    16945    7                                       ELSE B$JIT.ERR='1'B; /* Flag so we know */

  16945  1 002057   400000 236003                    LDQ     -131072,DU
         1 002060   000012 756100                    STQ     10,,PR0

      714    16946    7                                       IF NK$LDCT.DCBNO=0 THEN NK$LDCT.USER=0;

  16946  1 002061   200020 470500                    LDP0    LDCT$,,AUTO
         1 002062   000014 236100                    LDQ     12,,PR0
         1 002063   000777 316007                    CANQ    511,DL
         1 002064   002067 601000 1                  TNZ     s:16947

  16946  1 002065   000000 236003                    LDQ     0,DU
         1 002066   000007 552120                    STBQ    7,'20'O,PR0

      715    16947    7                                       LDCT$=JIT$;

  16947  1 002067   200030 236100                    LDQ     JIT$,,AUTO
         1 002070   200020 756100                    STQ     LDCT$,,AUTO

      716    16948    7                                       F$DCB.SETX=NK$LDCT.LDCTX;

  16948  1 002071   200020 470500                    LDP0    LDCT$,,AUTO
         1 002072   000006 220100                    LDX0    6,,PR0
         1 002073   200017 471500                    LDP1    JDCB$,,AUTO
         1 002074   100051 440100                    SXL0    41,,PR1

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:116  
      717    16949    7                                       F$DCB.LDCTX=NK$LDCT.LDCTX;

  16949  1 002075   000006 221100                    LDX1    6,,PR0
         1 002076   100051 741100                    STX1    41,,PR1

      718    16950    8                                       IF NK$LDCT.RLCID='0'B THEN DO;

  16950  1 002077   000015 235100                    LDA     13,,PR0
         1 002100   002124 601000 1                  TNZ     s:16959

      719    16951    8                                            NK$LDCT.DFLG.PRLS='1'B;

  16951  1 002101   000200 236007                    LDQ     128,DL
         1 002102   000006 256100                    ORSQ    6,,PR0

      720    16952    8                                            NK$LDCT.DFLG.FEDN='1'B;

  16952  1 002103   000020 236007                    LDQ     16,DL
         1 002104   000006 256100                    ORSQ    6,,PR0

      721    16953    8                                            NK$LDCT.USER=B$JIT.USER;

  16953  1 002105   000000 473400 xsym               LDP3    B$JIT$
         1 002106   300000 236100                    LDQ     0,,PR3
         1 002107   000007 552120                    STBQ    7,'20'O,PR0

      722    16954    8                                            IF B$JIT.ERR='1'B THEN GOTO AU_RELEASE;

  16954  1 002110   300012 236100                    LDQ     10,,PR3
         1 002111   400000 116003                    CMPQ    -131072,DU
         1 002112   002214 600000 1                  TZE     AU_RELEASE

      723    16955    8   FSP_RTN:                                 CALL FSP$CLSDEV (ADDR(NIL));

  16955  1 002113   000001 236000 xsym  FSP_RTN      LDQ     B_VECTNIL+1
         1 002114   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 002115   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:117  
         1 002116   200131 450500                    STP0    UCLDCT$+3,,AUTO
         1 002117   200131 630500                    EPPR0   UCLDCT$+3,,AUTO
         1 002120   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002121   000000 701000 xent               TSX1    FSP$CLSDEV
         1 002122   000000 011000                    NOP     0

      724    16956    8                                            GOTO CANTDDWSN;

  16956  1 002123   000521 710000 1                  TRA     CANTDDWSN

      725    16957    8                                          END;
      726    16958    7                                     END;
      727    16959    6                             NK$LDCT.USER=B$JIT.USER;

  16959  1 002124   000000 470400 xsym               LDP0    B$JIT$
         1 002125   200020 471500                    LDP1    LDCT$,,AUTO
         1 002126   000000 236100                    LDQ     0,,PR0
         1 002127   100007 552120                    STBQ    7,'20'O,PR1

      728    16960    6                             NK$LDCT.DCBNO=F$DCB.DCB#;

  16960  1 002130   200017 473500                    LDP3    JDCB$,,AUTO
         1 002131   300060 236100                    LDQ     48,,PR3
         1 002132   000033 772000                    QRL     27
         1 002133   100014 552104                    STBQ    12,'04'O,PR1

      729    16961    6                           END;

      730    16962    5                        F$DCB.MEDIA = FMTUC#;

  16962  1 002134   000014 236003                    LDQ     12,DU
         1 002135   300103 552120                    STBQ    67,'20'O,PR3

      731    16963    5                        F$DCB.IASN = %DEVICE#;

  16963  1 002136   000003 236007                    LDQ     3,DL
         1 002137   300103 552104                    STBQ    67,'04'O,PR3
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:118  

      732    16964    5                        F$DCB.IFMT = FMTTTY#;

  16964  1 002140   016000 236003                    LDQ     7168,DU
         1 002141   300103 552140                    STBQ    67,'40'O,PR3

      733    16965    5                        IF NK$LDCT.DFLG.INPUT THEN F$DCB.FFLG.READ = '1'B;

  16965  1 002142   200020 470500                    LDP0    LDCT$,,AUTO
         1 002143   000006 236100                    LDQ     6,,PR0
         1 002144   400000 316007                    CANQ    -131072,DL
         1 002145   002150 600000 1                  TZE     s:16966

  16965  1 002146   400000 236003                    LDQ     -131072,DU
         1 002147   300004 256100                    ORSQ    4,,PR3

      734    16966    5                        IF NK$LDCT.DFLG.OUTPUT THEN F$DCB.FFLG.WNEW = '1'B;

  16966  1 002150   000006 236100                    LDQ     6,,PR0
         1 002151   200000 316007                    CANQ    65536,DL
         1 002152   002155 600000 1                  TZE     s:16967

  16966  1 002153   100000 236003                    LDQ     32768,DU
         1 002154   300004 256100                    ORSQ    4,,PR3

      735    16967    5                        IF F$DCB.DVFC=BINASC(0) THEN F$DCB.DVFC = '@';

  16967  1 002155   300044 236100                    LDQ     36,,PR3
         1 002156   777000 376007                    ANQ     -512,DL
         1 002157   000000 116003                    CMPQ    0,DU
         1 002160   002163 601000 1                  TNZ     s:16968

  16967  1 002161   100000 236007                    LDQ     32768,DL
         1 002162   300044 552110                    STBQ    36,'10'O,PR3

      736    16968    5                        F$DCB.LDCTX = F$DCB.SETX;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:119  
  16968  1 002163   300051 720100                    LXL0    41,,PR3
         1 002164   300051 740100                    STX0    41,,PR3

      737    16969    5                        F$DCB.STR = KIDM_CP;

  16969  1 002165   000001 236007                    LDQ     1,DL
         1 002166   300077 552104                    STBQ    63,'04'O,PR3

      738    16970    5                        IF F$DCB.ORG = %FPRG#

  16970  1 002167   300032 236100                    LDQ     26,,PR3
         1 002170   777000 376003                    ANQ     -512,DU
         1 002171   012000 116003                    CMPQ    5120,DU
         1 002172   002210 601000 1                  TNZ     s:16977

      739    16971    6                        THEN DO;

      740    16972    6                             FEX = LDCT$->NK$LDCT.RLCID.NODE;

  16972  1 002173   000015 236100                    LDQ     13,,PR0
         1 002174   000033 772000                    QRL     27
         1 002175   200026 756100                    STQ     FEX,,AUTO

      741    16973    6                             CALL FPRG(%G_M_USER#,FEX,KIDM_CP,F$DCB)

  16973  1 002176   200017 236100                    LDQ     JDCB$,,AUTO
         1 002177   200050 756100                    STQ     @STR+1,,AUTO
         1 002200   000011 236000 2                  LDQ     9
         1 002201   200047 756100                    STQ     @FEX+1,,AUTO
         1 002202   200026 631500                    EPPR1   FEX,,AUTO
         1 002203   200046 451500                    STP1    @MODE+1,,AUTO
         1 002204   200045 756100                    STQ     CGID+1,,AUTO
         1 002205   004114 701000 1                  TSX1    FPRG
         1 002206   002113 702000 1                  TSX2    FSP_RTN

      742    16974    6                                  ALTRET(FSP_RTN);
      743    16975    6                           END;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:120  

  16975  1 002207   002214 710000 1                  TRA     AU_RELEASE

      744    16976    6                        ELSE DO;

      745    16977    6                             CALL KIA$OPNSSN(LDCT$->NK$LDCT) ALTRET(FSP_RTN);

  16977  1 002210   200020 630500                    EPPR0   LDCT$,,AUTO
         1 002211   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002212   000000 701000 xent               TSX1    KIA$OPNSSN
         1 002213   002113 702000 1                  TSX2    FSP_RTN

      746    16978    6                           END;

      747    16979    5                      END;

  16974  1 002214                       AU_RELEASE   null
      748    16980    4   AU_RELEASE:     ;
      749    16981    4                   CALL FMD$RBUF(BUF$);

  16981  1 002214   200031 630500                    EPPR0   BUF$,,AUTO
         1 002215   200130 450500                    STP0    UCLDCT$+2,,AUTO
         1 002216   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 002217   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002220   000000 701000 xent               TSX1    FMD$RBUF
         1 002221   000000 011000                    NOP     0
         1 002222   002570 710000 1                  TRA     s:17085

      750    16982    4                CASE(18/*CR*/);

      751    16983    4                   GOTO BADRES;

  16983  1 002223   000554 710000 1                  TRA     BADRES

      752    16984    4                CASE(21/*SY*/);

      753    16985    4                   IF RES~='SYMO' THEN GOTO BADRES;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:121  

  16985  1 002224   200025 236100                    LDQ     RES,,AUTO
         1 002225   000133 116000 0                  CMPQ    NETMNGR+37
         1 002226   000554 601000 1                  TNZ     BADRES

      754    16986    4                   IF NOT B$JIT.PRIV.ACTIVE &

  16986  1 002227   000000 470400 xsym               LDP0    B$JIT$
         1 002230   000013 236100                    LDQ     11,,PR0
         1 002231   000134 376000 0                  ANQ     NETMNGR+38
         1 002232   001230 600000 1                  TZE     BADFUN

      755    16987    4                        %(PR_FMEFT#|PR_FMBLK#|PR_FMSEC#) THEN
      756    16988    4                        GOTO BADFUN;
      757    16989    4                   IF F=1 OR F$DCB.ACS~=%BLOCK# THEN GOTO BADFUN;

  16989  1 002233   200023 236100                    LDQ     F,,AUTO
         1 002234   000001 116007                    CMPQ    1,DL
         1 002235   001230 600000 1                  TZE     BADFUN
         1 002236   200017 471500                    LDP1    JDCB$,,AUTO
         1 002237   100036 236100                    LDQ     30,,PR1
         1 002240   000777 376007                    ANQ     511,DL
         1 002241   000003 116007                    CMPQ    3,DL
         1 002242   001230 601000 1                  TNZ     BADFUN

      758    16990    4                   GOTO BADRES;

  16990  1 002243   000554 710000 1                  TRA     BADRES

      759    16991    4                CASE(27/*FE*/);

      760    16992    4                   IF F~=2 THEN GOTO BADFUN;

  16992  1 002244   200023 236100                    LDQ     F,,AUTO
         1 002245   000002 116007                    CMPQ    2,DL
         1 002246   001230 601000 1                  TNZ     BADFUN

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:122  
      761    16993    4                   IF ( (ASCBIN( SUBSTR( RES, 2, 1)) < ASCBIN ('0'))OR

  16993  1 002247   200025 236100                    LDQ     RES,,AUTO
         1 002250   000011 772000                    QRL     9
         1 002251   000777 376007                    ANQ     511,DL
         1 002252   000060 116007                    CMPQ    48,DL
         1 002253   000554 602000 1                  TNC     BADRES
         1 002254   000072 116007                    CMPQ    58,DL
         1 002255   000554 603000 1                  TRC     BADRES
         1 002256   200025 236100                    LDQ     RES,,AUTO
         1 002257   000777 376007                    ANQ     511,DL
         1 002260   000060 116007                    CMPQ    48,DL
         1 002261   000554 602000 1                  TNC     BADRES
         1 002262   000072 116007                    CMPQ    58,DL
         1 002263   000554 603000 1                  TRC     BADRES

      762    16994    4                        (ASCBIN( SUBSTR( RES, 2, 1)) > ASCBIN ('9'))OR
      763    16995    4                        (ASCBIN( SUBSTR( RES, 3, 1)) < ASCBIN ('0'))OR
      764    16996    4                        (ASCBIN( SUBSTR( RES, 3, 1)) > ASCBIN ('9')) )
      765    16997    4                   THEN GOTO BADRES;       /* ONLY 2 DIGITS ARE ALLOWED */
      766    16998    4                   CALL CHARBIN(FEX,SUBSTR(RES,2,2));

  16998  1 002264   000100 305500                    DTB
         1 002265   200025 430002                    NDSC9   RES,,AUTO                cn=2,s=nosgn,sf=0,n=2
         1 002266   200130 000010                    NDSC9   UCLDCT$+2,,AUTO          cn=0,s=lsgnf,sf=0,n=8
         1 002267   200131 235100                    LDA     UCLDCT$+3,,AUTO
         1 002270   200026 755100                    STA     FEX,,AUTO

      767    16999    4                   CALL KIN$CONV_NODE(F$DCB.WSN,FEX,HOST) ALTRET(BADFEP);

  16999  1 002271   200015 630500                    EPPR0   HOST,,AUTO
         1 002272   200132 450500                    STP0    UCLDCT$+4,,AUTO
         1 002273   200026 631500                    EPPR1   FEX,,AUTO
         1 002274   200131 451500                    STP1    UCLDCT$+3,,AUTO
         1 002275   200017 236100                    LDQ     JDCB$,,AUTO
         1 002276   000027 036003                    ADLQ    23,DU
         1 002277   200130 756100                    STQ     UCLDCT$+2,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:123  
         1 002300   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 002301   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002302   000000 701000 xent               TSX1    KIN$CONV_NODE
         1 002303   001157 702000 1                  TSX2    BADFEP

      768    17000    4                   IF HOST

  17000  1 002304   200015 234100                    SZN     HOST,,AUTO
         1 002305   001157 604000 1                  TMI     BADFEP

      769    17001    4                   THEN
      770    17002    4                        GOTO BADFEP;
      771    17003    5                   DO CASE(F$DCB.ORG);

  17003  1 002306   200017 470500                    LDP0    JDCB$,,AUTO
         1 002307   000032 236100                    LDQ     26,,PR0
         1 002310   000033 772000                    QRL     27
         1 002311   000012 136007                    SBLQ    10,DL
         1 002312   000015 116007                    CMPQ    13,DL
         1 002313   002315 602006 1                  TNC     s:17003+7,QL
         1 002314   002332 710000 1                  TRA     s:17005
         1 002315   002336 710000 1                  TRA     DO_FE
         1 002316   002332 710000 1                  TRA     s:17005
         1 002317   002336 710000 1                  TRA     DO_FE
         1 002320   002332 710000 1                  TRA     s:17005
         1 002321   002332 710000 1                  TRA     s:17005
         1 002322   002332 710000 1                  TRA     s:17005
         1 002323   002332 710000 1                  TRA     s:17005
         1 002324   002332 710000 1                  TRA     s:17005
         1 002325   002332 710000 1                  TRA     s:17005
         1 002326   002332 710000 1                  TRA     s:17005
         1 002327   002333 710000 1                  TRA     s:17007
         1 002330   002333 710000 1                  TRA     s:17007
         1 002331   002333 710000 1                  TRA     s:17007

      772    17004    5                   CASE(ELSE);

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:124  
      773    17005    5                      GOTO BADFUN;

  17005  1 002332   001230 710000 1                  TRA     BADFUN

      774    17006    5                   CASE(%DBGDCB#,%DBGCG#,%DBGSYSID#);

      775    17007    5                      CALL DBGFPRG ALTRET(ALTRETUR);

  17007  1 002333   004435 701000 1                  TSX1    DBGFPRG
         1 002334   002654 702000 1                  TSX2    ALTRETUR
         1 002335   002406 710000 1                  TRA     s:17035

      776    17008    5                   CASE(%HANDLER#,%FPRG#);

  17007  1 002336                       DO_FE        null
      777    17009    5   DO_FE:             ;
      778    17010    5                      IF NOT (B$JIT.PRIV.ACTIVE.MFEP)

  17010  1 002336   000000 471400 xsym               LDP1    B$JIT$
         1 002337   100013 236100                    LDQ     11,,PR1
         1 002340   040000 316007                    CANQ    16384,DL
         1 002341   002351 601000 1                  TNZ     s:17021
         1 002342   000032 236100                    LDQ     26,,PR0
         1 002343   777000 376003                    ANQ     -512,DU
         1 002344   014000 116003                    CMPQ    6144,DU
         1 002345   002351 601000 1                  TNZ     s:17021

      779    17011    5                           AND F$DCB.ORG = %HANDLER#
      780    17012    6                      THEN DO;

      781    17013    6                           B$JIT.ERR=ERR_NOTAUTH;

  17013  1 002346   000036 236000 0                  LDQ     ERR_NOTAUTH
         1 002347   100012 756100                    STQ     10,,PR1

      782    17014        /*E*   ERROR: FSN-E$NOTAUTH-2
      783    17015             MESSAGE: ORG=HANDLER requires MFEP privilege.
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:125  
      784    17016            MESSAGE1: You tried to M$OPEN %%DC %with ASN=DEVICE, RES=FExx,
      785    17017                      and ORG=HANDLER without the MFEP privilege active.
      786    17018        */
      787    17019    6                           RETURN;

  17019  1 002350   000000 702200 xent               TSX2  ! X66_ARET

      788    17020    6                         END;
      789    17021    5                      F$DCB.FFLG = %FFLG_WNEW# | %FFLG_READ#;

  17021  1 002351   500000 220003                    LDX0    -98304,DU
         1 002352   000004 740100                    STX0    4,,PR0

      790    17022    5                      F$DCB.IFMT = FMTFPRG#;

  17022  1 002353   023000 236003                    LDQ     9728,DU
         1 002354   000103 552140                    STBQ    67,'40'O,PR0

      791    17023    5                      F$DCB.MEDIA = FMTFPRG#;

  17023  1 002355   000023 236003                    LDQ     19,DU
         1 002356   000103 552120                    STBQ    67,'20'O,PR0

      792    17024    5                      NEWSTREAM='1'B;

  17024  1 002357   400000 236003                    LDQ     -131072,DU
         1 002360   200014 756100                    STQ     NEWSTREAM,,AUTO

      793    17025    5                      IF F$DCB.ORG = %HANDLER#

  17025  1 002361   000032 236100                    LDQ     26,,PR0
         1 002362   777000 376003                    ANQ     -512,DU
         1 002363   014000 116003                    CMPQ    6144,DU
         1 002364   002370 601000 1                  TNZ     s:17029

      794    17026    5                      THEN
      795    17027    5                           I = %G_M_HANDLER#;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:126  

  17027  1 002365   000003 235007                    LDA     3,DL
         1 002366   200021 755100                    STA     I,,AUTO
         1 002367   002372 710000 1                  TRA     s:17030

      796    17028    5                      ELSE
      797    17029    5                           I = %G_M_GHOST#;

  17029  1 002370   000004 235007                    LDA     4,DL
         1 002371   200021 755100                    STA     I,,AUTO

      798    17030    5                      CALL FPRG(I,FEX,0)

  17030  1 002372   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002373   200050 756100                    STQ     @STR+1,,AUTO
         1 002374   000014 236000 2                  LDQ     12
         1 002375   200047 756100                    STQ     @FEX+1,,AUTO
         1 002376   200026 633500                    EPPR3   FEX,,AUTO
         1 002377   200046 453500                    STP3    @MODE+1,,AUTO
         1 002400   200021 634500                    EPPR4   I,,AUTO
         1 002401   200045 454500                    STP4    CGID+1,,AUTO
         1 002402   004114 701000 1                  TSX1    FPRG
         1 002403   002405 702000 1                  TSX2    s:17032
         1 002404   002406 710000 1                  TRA     s:17035

      799    17031    6                      WHENALTRETURN DO;

      800    17032    6                           GOTO ALTRETUR;

  17032  1 002405   002654 710000 1                  TRA     ALTRETUR

      801    17033    6                         END;
      802    17034    5                   END;                    /*CASE*/

      803    17035    4                   GOTO MEBBETSTF;

  17035  1 002406   001234 710000 1                  TRA     MEBBETSTF
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:127  

      804    17036
      805    17037
      806    17038    4                CASE (30);                 /* UC stream */

      807    17039    4                   IF ( (ASCBIN( SUBSTR( RES, 2, 1)) < ASCBIN ('0'))OR

  17039  1 002407   200025 236100                    LDQ     RES,,AUTO
         1 002410   000011 772000                    QRL     9
         1 002411   000777 376007                    ANQ     511,DL
         1 002412   000060 116007                    CMPQ    48,DL
         1 002413   000554 602000 1                  TNC     BADRES
         1 002414   000072 116007                    CMPQ    58,DL
         1 002415   000554 603000 1                  TRC     BADRES
         1 002416   200025 236100                    LDQ     RES,,AUTO
         1 002417   000777 376007                    ANQ     511,DL
         1 002420   000060 116007                    CMPQ    48,DL
         1 002421   000554 602000 1                  TNC     BADRES
         1 002422   000072 116007                    CMPQ    58,DL
         1 002423   000554 603000 1                  TRC     BADRES

      808    17040    4                        (ASCBIN( SUBSTR( RES, 2, 1)) > ASCBIN ('9'))OR
      809    17041    4                        (ASCBIN( SUBSTR( RES, 3, 1)) < ASCBIN ('0'))OR
      810    17042    4                        (ASCBIN( SUBSTR( RES, 3, 1)) > ASCBIN ('9')) )
      811    17043    4                   THEN GOTO BADRES;       /* ONLY 2 DIGITS ARE ALLOWED */
      812    17044    4                   F$DCB.FFLG = %FFLG_WNEW# | %FFLG_READ#;

  17044  1 002424   500000 220003                    LDX0    -98304,DU
         1 002425   200017 470500                    LDP0    JDCB$,,AUTO
         1 002426   000004 740100                    STX0    4,,PR0

      813    17045    5                   IF NOT B$ROSEG.CR01ID.INT THEN DO;

  17045  1 002427   000000 471400 xsym               LDP1    B$ROSEG$
         1 002430   100114 234100                    SZN     76,,PR1
         1 002431   002462 604000 1                  TMI     s:17056

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:128  
      814    17046    5   LBL_NO:              F$DCB.IFMT=FMTNO#;

  17046  1 002432   200017 470500       LBL_NO       LDP0    JDCB$,,AUTO
         1 002433   007000 236003                    LDQ     3584,DU
         1 002434   000103 552140                    STBQ    67,'40'O,PR0

      815    17047    5                        F$DCB.MEDIA=FMTNO#;

  17047  1 002435   000007 236003                    LDQ     7,DU
         1 002436   000103 552120                    STBQ    67,'20'O,PR0

      816    17048    5                        F$DCB.IASN=0;

  17048  1 002437   000000 236003                    LDQ     0,DU
         1 002440   000103 552104                    STBQ    67,'04'O,PR0

      817    17049    6                        IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN DO;

  17049  1 002441   200003 471500                    LDP1    @PN$,,AUTO
         1 002442   100000 473500                    LDP3    0,,PR1
         1 002443   300000 236100                    LDQ     0,,PR3
         1 002444   020000 316007                    CANQ    8192,DL
         1 002445   002461 600000 1                  TZE     s:17054

      818    17050    6                             CALL FSP$CLSDEV(ADDR(NIL));

  17050  1 002446   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002447   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 002450   200130 633500                    EPPR3   UCLDCT$+2,,AUTO
         1 002451   200131 453500                    STP3    UCLDCT$+3,,AUTO
         1 002452   200131 630500                    EPPR0   UCLDCT$+3,,AUTO
         1 002453   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002454   000000 701000 xent               TSX1    FSP$CLSDEV
         1 002455   000000 011000                    NOP     0

      819    17051    6                             B$JIT.ERR = '0'B;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:129  
  17051  1 002456   000000 470400 xsym               LDP0    B$JIT$
         1 002457   000012 450100                    STZ     10,,PR0

      820    17052    6                             GOTO GETOUT;

  17052  1 002460   002654 710000 1                  TRA     ALTRETUR

      821    17053    6                           END;
      822    17054    5                        GOTO ALL_DONE;

  17054  1 002461   002603 710000 1                  TRA     ALL_DONE

      823    17055    5                      END;
      824    17056    4                   CALL CHARBIN (I,SUBSTR(RES,2,2));

  17056  1 002462   000100 305500                    DTB
         1 002463   200025 430002                    NDSC9   RES,,AUTO                cn=2,s=nosgn,sf=0,n=2
         1 002464   200021 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      825    17057    4                   I = I + 20;   /* Make stream number greater than LDEVable */

  17057  1 002465   000024 236007                    LDQ     20,DL
         1 002466   200021 056100                    ASQ     I,,AUTO

      826    17058    4                   F$DCB.FPSTR = I;   /* So FSP knows stream to delete if FPRG */

  17058  1 002467   200021 236100                    LDQ     I,,AUTO
         1 002470   000011 736000                    QLS     9
         1 002471   000077 552110                    STBQ    63,'10'O,PR0

      827    17059    4                   B$JIT.DCB$ = B$M$UC$;

  17059  1 002472   000000 236000 xsym               LDQ     B$M$UC$
         1 002473   000000 473400 xsym               LDP3    B$JIT$
         1 002474   300232 756100                    STQ     154,,PR3

      828    17060    4                   IF B$M$UC$->F$DCB.MEDIA = FMTUC#
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:130  

  17060  1 002475   000000 474400 xsym               LDP4    B$M$UC$
         1 002476   400103 236100                    LDQ     67,,PR4
         1 002477   000777 376003                    ANQ     511,DU
         1 002500   000014 116003                    CMPQ    12,DU
         1 002501   002547 601000 1                  TNZ     s:17074
         1 002502   200021 235100                    LDA     I,,AUTO
         1 002503   002505 605000 1                  TPL     s:17060+8
         1 002504   000044 035003                    ADLA    36,DU
         1 002505   000000 066505                    CMPB    filb='0'B
         1 002506   100117 000001                    BDSC    79,A,PR1                 by=0,bit=0,n=1
         1 002507   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 002510   002547 601000 1                  TNZ     s:17074

      829    17061    4                        AND NOT B$ROSEG.STREAM_VALID(I)
      830    17062    5                   THEN DO;

      831    17063    5                        NEWSTREAM = '1'B;

  17063  1 002511   400000 236003                    LDQ     -131072,DU
         1 002512   200014 756100                    STQ     NEWSTREAM,,AUTO

      832    17064    5                        ORG = KIDM_USER;

  17064  1 002513   000002 235007                    LDA     2,DL
         1 002514   200040 755100                    STA     ORG,,AUTO

      833    17065    5                        IF PN$.WINDOW_~=ADDR(NIL) AND F$DCB.UOPT(1)

  17065  1 002515   200003 475500                    LDP5    @PN$,,AUTO
         1 002516   500006 236100                    LDQ     6,,PR5
         1 002517   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002520   002536 600000 1                  TZE     s:17071
         1 002521   000031 236100                    LDQ     25,,PR0
         1 002522   000200 316003                    CANQ    128,DU
         1 002523   002536 600000 1                  TZE     s:17071

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:131  
      834    17066    6                        THEN DO;

      835    17067    6                             CALL FSN$CONV_STR

  17067  1 002524   500006 476500                    LDP6    6,,PR5
         1 002525   200132 452500                    STP2    UCLDCT$+4,,AUTO
         1 002526   200132 236100                    LDQ     UCLDCT$+4,,AUTO
         1 002527   000026 036000 2                  ADLQ    22
         1 002530   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 002531   200130 456500                    STP6    UCLDCT$+2,,AUTO
         1 002532   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 002533   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002534   000000 701000 xent               TSX1    FSN$CONV_STR
         1 002535   002654 702000 1                  TSX2    ALTRETUR

      836    17068    6                                  (PN$.WINDOW_->VLP$WINDOW.FWINDOW#,ORGSTR.BYT)
      837    17069    6                                  ALTRET(ALTRETUR);
      838    17070    6                           END;

      839    17071    5                        CALL KIA$DCLSTR (ORG,I) ALTRET(ALTRETUR);

  17071  1 002536   200021 630500                    EPPR0   I,,AUTO
         1 002537   200131 450500                    STP0    UCLDCT$+3,,AUTO
         1 002540   200040 631500                    EPPR1   ORG,,AUTO
         1 002541   200130 451500                    STP1    UCLDCT$+2,,AUTO
         1 002542   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 002543   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002544   000000 701000 xent               TSX1    KIA$DCLSTR
         1 002545   002654 702000 1                  TSX2    ALTRETUR

      840    17072    5                      END;

  17072  1 002546   002550 710000 1                  TRA     s:17075

      841    17073    4                   ELSE
      842    17074    4                        NEWSTREAM = '0'B;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:132  
  17074  1 002547   200014 450100                    STZ     NEWSTREAM,,AUTO

      843    17075    4                   CALL MOVEINFO

  17075  1 002550   003204 701000 1                  TSX1    MOVEINFO
         1 002551   002553 702000 1                  TSX2    s:17077
         1 002552   002570 710000 1                  TRA     s:17085

      844    17076    5                   WHENALTRETURN DO;

      845    17077    5                        IF NEWSTREAM

  17077  1 002553   200014 234100                    SZN     NEWSTREAM,,AUTO
         1 002554   002567 605000 1                  TPL     s:17080

      846    17078    5                        THEN
      847    17079    5                             CALL KIA$CLSSTR (I,'1'B,'0'B);

  17079  1 002555   000014 236000 2                  LDQ     12
         1 002556   200132 756100                    STQ     UCLDCT$+4,,AUTO
         1 002557   000027 236000 2                  LDQ     23
         1 002560   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 002561   200021 630500                    EPPR0   I,,AUTO
         1 002562   200130 450500                    STP0    UCLDCT$+2,,AUTO
         1 002563   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 002564   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002565   000000 701000 xent               TSX1    KIA$CLSSTR
         1 002566   000000 011000                    NOP     0

      848    17080    5                        GOTO ALTRETUR;

  17080  1 002567   002654 710000 1                  TRA     ALTRETUR

      849    17081    5                      END;
      850    17082    4                END;

      851    17083    3              END;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:133  

      852    17084    2        END /*CASE(RES length)*/;

      853    17085    1        IF ADDR(F$DCB.CFU$)->BPTR.SEGID='006003'O

  17085  1 002570   200017 470500                    LDP0    JDCB$,,AUTO
         1 002571   000066 720100                    LXL0    54,,PR0
         1 002572   006003 100003                    CMPX0   3075,DU
         1 002573   002603 601000 1                  TNZ     ALL_DONE

      854    17086    2        THEN DO;

      855    17087    2             IF F$DCB.CFU$->F$DCB.ASN=%COMGROUP#

  17087  1 002574   000066 471500                    LDP1    54,,PR0
         1 002575   100032 236100                    LDQ     26,,PR1
         1 002576   777000 376007                    ANQ     -512,DL
         1 002577   004000 116007                    CMPQ    2048,DL
         1 002600   002603 601000 1                  TNZ     ALL_DONE

      856    17088    3             THEN DO;

      857    17089    3                  CALL CGINIT ALTRET(GETOUT);

  17089  1 002601   003765 701000 1                  TSX1    CGINIT
         1 002602   002654 702000 1                  TSX2    ALTRETUR

      858    17090    3                END;

      859    17091    2           END;

  17085  1 002603                       ALL_DONE     null
      860    17092    1   ALL_DONE: ;
      861    17093    1        B$JIT.DCB$=JDCB$;

  17093  1 002603   200017 236100                    LDQ     JDCB$,,AUTO
         1 002604   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:134  
         1 002605   000232 756100                    STQ     154,,PR0

      862    17094    1        F$DCB.FCD=%YES#;

  17094  1 002606   200017 471500                    LDP1    JDCB$,,AUTO
         1 002607   020000 236007                    LDQ     8192,DL
         1 002610   100031 256100                    ORSQ    25,,PR1

      863    17095    1        B$JIT.ERR='0'B;

  17095  1 002611   000012 450100                    STZ     10,,PR0

      864    17096    1        IF F$DCB.IASN = %FPRGIASN#

  17096  1 002612   100103 236100                    LDQ     67,,PR1
         1 002613   000777 376007                    ANQ     511,DL
         1 002614   000010 116007                    CMPQ    8,DL
         1 002615   002645 601000 1                  TNZ     s:17106

      865    17097    2        THEN DO;

      866    17098    2             CALL FMD$RELBUF (0);

  17098  1 002616   000014 630400 2                  EPPR0   12
         1 002617   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002620   000000 701000 xent               TSX1    FMD$RELBUF
         1 002621   000000 011000                    NOP     0

      867    17099    2             CALL KIF$FPRGR;

  17099  1 002622   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002623   000000 701000 xent               TSX1    KIF$FPRGR
         1 002624   000000 011000                    NOP     0

      868    17100    3             IF B$JIT.ERR.CODE~=0 THEN DO;

  17100  1 002625   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:135  
         1 002626   000012 236100                    LDQ     10,,PR0
         1 002627   377770 316007                    CANQ    131064,DL
         1 002630   002645 600000 1                  TZE     s:17106

      869    17101    3                  ERRCODE=B$JIT.ERR;

  17101  1 002631   200016 756100                    STQ     ERRCODE,,AUTO

      870    17102    3                  CALL FSP$CLSDEV(ADDR(NIL));

  17102  1 002632   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002633   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 002634   200130 631500                    EPPR1   UCLDCT$+2,,AUTO
         1 002635   200131 451500                    STP1    UCLDCT$+3,,AUTO
         1 002636   200131 630500                    EPPR0   UCLDCT$+3,,AUTO
         1 002637   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002640   000000 701000 xent               TSX1    FSP$CLSDEV
         1 002641   000000 011000                    NOP     0

      871    17103    3                  B$JIT.ERR=ERRCODE;

  17103  1 002642   200016 236100                    LDQ     ERRCODE,,AUTO
         1 002643   000000 470400 xsym               LDP0    B$JIT$
         1 002644   000012 756100                    STQ     10,,PR0

      872    17104    3                END;

      873    17105    2           END;

      874    17106    1        RETURN;

  17106  1 002645   000000 702200 xent               TSX2  ! X66_ARET

  17105  1 002646                       CANTOPENUC   null
      875    17107    1   CANTOPENUC:;
      876    17108    1        IF B$JIT.ERR.CODE=0 THEN

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:136  
  17108  1 002646   000000 470400 xsym               LDP0    B$JIT$
         1 002647   000012 236100                    LDQ     10,,PR0
         1 002650   377770 316007                    CANQ    131064,DL
         1 002651   002654 601000 1                  TNZ     ALTRETUR

      877    17109    1             B$JIT.ERR=ERR_INVRES;

  17109  1 002652   000033 236000 0                  LDQ     ERR_INVRES
         1 002653   000012 756100                    STQ     10,,PR0

  17108  1 002654                       ALTRETUR     null
  17108  1 002654                       GETOUT       null
      878    17110    1   ALTRETUR: ;
      879    17111    1   GETOUT: ;
      880    17112    1        B$JIT.DCB$=JDCB$;

  17112  1 002654   200017 236100                    LDQ     JDCB$,,AUTO
         1 002655   000000 470400 xsym               LDP0    B$JIT$
         1 002656   000232 756100                    STQ     154,,PR0

      881    17113    1        RETURN;

  17113  1 002657   000000 702200 xent               TSX2  ! X66_ARET

      882    17114        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:137  
      883    17115    1   FSN$OPNCL_EVT: ENTRY(PN$);

  17115  1 002660   000000 700200 xent  FSN$OPNCL_E* TSX0  ! X66_AUTO_1
         1 002661   000140 000001                    ZERO    96,1

      884    17116        /*F* NAME: FSN$OPNCL_EVT
      885    17117             DESCRIPTION: Entered from FRF$OPNCL_EVT for a DCB with a no_wait
      886    17118             open pending, to get the rest of the open protocol done.
      887    17119        */
      888    17120    1        JDCB$ = ADDR(PN$);

  17120  1 002662   200003 236100                    LDQ     @PN$,,AUTO
         1 002663   200017 756100                    STQ     JDCB$,,AUTO

      889    17121    1        LDCT$ = NK$LDCT$(F$DCB.SETX);

  17121  1 002664   200017 470500                    LDP0    JDCB$,,AUTO
         1 002665   000051 720100                    LXL0    41,,PR0
         1 002666   000000 471400 xsym               LDP1    N$DCT$$
         1 002667   100000 236110                    LDQ     0,X0,PR1
         1 002670   200020 756100                    STQ     LDCT$,,AUTO

      890    17122    1        GOTO OPNCL_EVT;

  17122  1 002671   001644 710000 1                  TRA     OPNCL_EVT

      891    17123        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:138  
      892    17124    1   OPENLDEV: PROC ALTRET;

  17124  1 002672   200042 741300       OPENLDEV     STX1  ! ORG+2,,AUTO

      893    17125    2        I=0;

  17125  1 002673   200021 450100                    STZ     I,,AUTO

      894    17126    3        DO WHILE (I<16);

  17126  1 002674   200021 235100                    LDA     I,,AUTO
         1 002675   000020 115007                    CMPA    16,DL
         1 002676   002710 605000 1                  TPL     s:17130

      895    17127    3             IF B$ROSEG.LDEVNAME(I)=RES THEN GOTO FOUND;

  17127  1 002677   000000 470400 xsym               LDP0    B$ROSEG$
         1 002700   200021 720100                    LXL0    I,,AUTO
         1 002701   000054 236110                    LDQ     44,X0,PR0
         1 002702   200025 116100                    CMPQ    RES,,AUTO
         1 002703   002756 600000 1                  TZE     FOUND

      896    17128    3             I=I+1;

  17128  1 002704   200021 054100                    AOS     I,,AUTO

      897    17129    3           END;

  17129  1 002705   200021 235100                    LDA     I,,AUTO
         1 002706   000020 115007                    CMPA    16,DL
         1 002707   002677 604000 1                  TMI     s:17127

      898    17130    2        IF (RES ~= 'CP01' AND

  17130  1 002710   200025 236100                    LDQ     RES,,AUTO
         1 002711   000115 116000 0                  CMPQ    NETMNGR+23
         1 002712   002717 600000 1                  TZE     s:17135
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:139  
         1 002713   000116 116000 0                  CMPQ    NETMNGR+24
         1 002714   002717 600000 1                  TZE     s:17135

      899    17131    2             RES ~= 'GR01')
      900    17132    3        THEN DO;

      901    17133    3             RETURN;

  17133  1 002715   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 002716   000001 702211                    TSX2  ! 1,X1

      902    17134    3           END;
      903    17135    3        DO I=0 TO 15;

  17135  1 002717   200021 450100                    STZ     I,,AUTO

      904    17136    4             IF B$ROSEG.LDEVNAME(I)='    ' THEN DO;

  17136  1 002720   000000 470400 xsym               LDP0    B$ROSEG$
         1 002721   200021 720100                    LXL0    I,,AUTO
         1 002722   000054 236110                    LDQ     44,X0,PR0
         1 002723   000076 116000 0                  CMPQ    NETMNGR+8
         1 002724   002730 601000 1                  TNZ     s:17140

      905    17137    4                  B$ROSEG.LDEVNAME(I) = RES;

  17137  1 002725   200025 236100                    LDQ     RES,,AUTO
         1 002726   000054 756110                    STQ     44,X0,PR0

      906    17138    4                  GOTO FOUND;

  17138  1 002727   002756 710000 1                  TRA     FOUND

      907    17139    4                END;
      908    17140    3           END;

  17140  1 002730   200021 054100                    AOS     I,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:140  
         1 002731   200021 235100                    LDA     I,,AUTO
         1 002732   000017 115007                    CMPA    15,DL
         1 002733   002720 604400 1                  TMOZ    s:17136

      909    17141    2        B$JIT.ERR=ERR_NOSTREAMS;

  17141  1 002734   000035 236000 0                  LDQ     ERR_NOSTREAMS
         1 002735   000000 471400 xsym               LDP1    B$JIT$
         1 002736   100012 756100                    STQ     10,,PR1

      910    17142        /*E*    ERROR: FSN-E$LDEVNOSTREAMS-2
      911    17143                MESSAGE: You can't use CP01 or GR01 at this time.
      912    17144                MESSAGE1: All Logical Device slots are in use.  To use CP01 or GR01,
      913    17145                          LDEV (REMOVE) one of your Logical Devices.
      914    17146         */
      915    17147    2   ALTRETUR: ALTRETURN;

  17147  1 002737   200042 221300       ALTRETUR     LDX1  ! ORG+2,,AUTO
         1 002740   000000 702211                    TSX2  ! 0,X1

  17141  1 002741                       ARCLLD       null
      916    17148    2   ARCLLD: ;
      917    17149    2        PN$.V_=JIT$;

  17149  1 002741   200030 236100                    LDQ     JIT$,,AUTO
         1 002742   200003 470500                    LDP0    @PN$,,AUTO
         1 002743   000000 756100                    STQ     0,,PR0

      918    17150    2        CALL FMD$RBUF(BUF$);

  17150  1 002744   200031 631500                    EPPR1   BUF$,,AUTO
         1 002745   200130 451500                    STP1    UCLDCT$+2,,AUTO
         1 002746   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 002747   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002750   000000 701000 xent               TSX1    FMD$RBUF
         1 002751   000000 011000                    NOP     0

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:141  
      919    17151    2        B$ROSEG.STREAMID(I)='0'B;

  17151  1 002752   000000 470400 xsym               LDP0    B$ROSEG$
         1 002753   200021 720100                    LXL0    I,,AUTO
         1 002754   000074 450110                    STZ     60,X0,PR0

      920    17152    2        GOTO ALTRETUR;

  17152  1 002755   002737 710000 1                  TRA     ALTRETUR

  17151  1 002756                       FOUND        null
      921    17153    2   FOUND: ;
      922    17154    3        IF F=1 AND NOT B$ROSEG.STREAMID.UC_STR(I) THEN DO;

  17154  1 002756   200023 235100                    LDA     F,,AUTO
         1 002757   000001 115007                    CMPA    1,DL
         1 002760   002772 601000 1                  TNZ     s:17169
         1 002761   200021 720100                    LXL0    I,,AUTO
         1 002762   000074 236110                    LDQ     60,X0,PR0
         1 002763   000001 316003                    CANQ    1,DU
         1 002764   002772 601000 1                  TNZ     s:17169

      923    17155    3             B$JIT.ERR=ERR_ILLIN;

  17155  1 002765   000032 236000 0                  LDQ     ERR_ILLIN
         1 002766   000000 471400 xsym               LDP1    B$JIT$
         1 002767   100012 756100                    STQ     10,,PR1

      924    17156    3             ALTRETURN;

  17156  1 002770   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 002771   000000 702211                    TSX2  ! 0,X1

      925    17157    3           END;
      926    17158        /*
      927    17159         *       'I' is the stream number.  Stream's flag value tells
      928    17160         *       us what kind of shape the stream is in:
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:142  
      929    17161         *           0 - Stream is currently undefined.  (This is the
      930    17162         *                case for LP01 and CP01 at user startup).
      931    17163         *           1 - Stream is defined but not open.  We must make
      932    17164         *                a stream DCB.  Stream's IDENT combined with
      933    17165         *                our user I.D. gives file name for stream.
      934    17166         *           2 - Stream currently has an open dcb.  Stream's
      935    17167         *                IDENT is displacement to stream DCB.
      936    17168         */
      937    17169    3        DO CASE(B$ROSEG.STREAMID.FLG(I));

  17169  1 002772   200021 720100                    LXL0    I,,AUTO
         1 002773   000074 236110                    LDQ     60,X0,PR0
         1 002774   000042 772000                    QRL     34
         1 002775   000003 116007                    CMPQ    3,DL
         1 002776   003000 602006 1                  TNC     s:17169+6,QL
         1 002777   003167 710000 1                  TRA     s:17210
         1 003000   003003 710000 1                  TRA     s:17171
         1 003001   003124 710000 1                  TRA     s:17195
         1 003002   003162 710000 1                  TRA     s:17208

      938    17170    3        CASE(0);                           /* STREAM IS UNDEFINED                */

      939    17171    3           CALL FSB$STREAMCREATE(I) ALTRET(ALTRETUR);

  17171  1 003003   200021 631500                    EPPR1   I,,AUTO
         1 003004   200130 451500                    STP1    UCLDCT$+2,,AUTO
         1 003005   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003006   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003007   000000 701000 xent               TSX1    FSB$STREAMCREATE
         1 003010   002737 702000 1                  TSX2    ALTRETUR

      940    17172    3           CALL FMD$GBUF(BUF$);

  17172  1 003011   200031 630500                    EPPR0   BUF$,,AUTO
         1 003012   200130 450500                    STP0    UCLDCT$+2,,AUTO
         1 003013   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003014   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:143  
         1 003015   000000 701000 xent               TSX1    FMD$GBUF
         1 003016   000000 011000                    NOP     0

      941    17173    3           PN$.PROCATTR_=ADDR(NIL);

  17173  1 003017   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003020   200003 470500                    LDP0    @PN$,,AUTO
         1 003021   000011 756100                    STQ     9,,PR0

      942    17174    3           JIT$=PN$.V_;

  17174  1 003022   000000 236100                    LDQ     0,,PR0
         1 003023   200030 756100                    STQ     JIT$,,AUTO

      943    17175    3           CALL FSW$DESTFORM(PN$.PROCATTR_,BUF$,B$JIT$)ALTRET(ARCLLD);

  17175  1 003024   000005 236000 2                  LDQ     5
         1 003025   200132 756100                    STQ     UCLDCT$+4,,AUTO
         1 003026   200031 631500                    EPPR1   BUF$,,AUTO
         1 003027   200131 451500                    STP1    UCLDCT$+3,,AUTO
         1 003030   200003 236100                    LDQ     @PN$,,AUTO
         1 003031   000011 036003                    ADLQ    9,DU
         1 003032   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 003033   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003034   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003035   000000 701000 xent               TSX1    FSW$DESTFORM
         1 003036   002741 702000 1                  TSX2    ARCLLD

      944    17176    3           PN$.V_=ADDR(ZEROES);

  17176  1 003037   000001 236000 2                  LDQ     1
         1 003040   200003 470500                    LDP0    @PN$,,AUTO
         1 003041   000000 756100                    STQ     0,,PR0

      945    17177                   /*N* OUGHTA BE REPLACED BY CALL TO FSL */
      946    17178    3           LDEVUATTR='0'B;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:144  
  17178  1 003042   000100 100400                    MLR     fill='000'O
         1 003043   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 003044   200032 000024                    ADSC9   LDEVUATTR,,AUTO          cn=0,n=20

      947    17179    3           LDEVUATTR.NDW=SIZEW(LDEVUATTR)-1;

  17179  1 003045   000004 220003                    LDX0    4,DU
         1 003046   200032 440100                    SXL0    LDEVUATTR,,AUTO

      948    17180    3           LDEVUATTR.NAW=LDEVUATTR.NDW+SIZEW(LDEVPLUSTAB)+

  17180  1 003047   000062 621010                    EAX1    50,X0
         1 003050   200032 741100                    STX1    LDEVUATTR,,AUTO

      949    17181    3                SIZEW(LDEVPLUSHDR);
      950    17182    3           PN$.UATTR_=ADDR(LDEVUATTR);

  17182  1 003051   200032 631500                    EPPR1   LDEVUATTR,,AUTO
         1 003052   000007 451500                    STP1    7,,PR0

      951    17183    3           PN$.INSTATTR_=ADDR(NIL);

  17183  1 003053   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003054   000010 756100                    STQ     8,,PR0

      952    17184    3           PN$.ACCESS_=ADDR(NIL);

  17184  1 003055   000005 756100                    STQ     5,,PR0

      953    17185    3           PN$.ACSVEH_=ADDR(NIL);

  17185  1 003056   000006 756100                    STQ     6,,PR0

      954    17186    3           PN$.SN_=ADDR(NIL);

  17186  1 003057   000001 756100                    STQ     1,,PR0

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:145  
      955    17187    3           CALL FSF$SYMBFILE(BUF$,PN$,B$JIT$)ALTRET(ARCLLD);

  17187  1 003060   000005 236000 2                  LDQ     5
         1 003061   200132 756100                    STQ     UCLDCT$+4,,AUTO
         1 003062   200003 236100                    LDQ     @PN$,,AUTO
         1 003063   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 003064   200031 631500                    EPPR1   BUF$,,AUTO
         1 003065   200130 451500                    STP1    UCLDCT$+2,,AUTO
         1 003066   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003067   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003070   000000 701000 xent               TSX1    FSF$SYMBFILE
         1 003071   002741 702000 1                  TSX2    ARCLLD

      956    17188    3           CALL FMD$RBUF(BUF$);

  17188  1 003072   200031 630500                    EPPR0   BUF$,,AUTO
         1 003073   200130 450500                    STP0    UCLDCT$+2,,AUTO
         1 003074   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003075   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003076   000000 701000 xent               TSX1    FMD$RBUF
         1 003077   000000 011000                    NOP     0

      957    17189    3           B$JIT.DCB$->F$DCB.WSN=B$JIT.WOO;

  17189  1 003100   000000 470400 xsym               LDP0    B$JIT$
         1 003101   000232 471500                    LDP1    154,,PR0
         1 003102   000010 237100                    LDAQ    8,,PR0
         1 003103   100027 755100                    STA     23,,PR1
         1 003104   100030 756100                    STQ     24,,PR1

      958    17190    3           B$JIT.DCB$->F$DCB.RES=SUBSTR(B$ROSEG.LDEVNAME(I),0,2);

  17190  1 003105   000232 471500                    LDP1    154,,PR0
         1 003106   000000 473400 xsym               LDP3    B$ROSEG$
         1 003107   200021 720100                    LXL0    I,,AUTO
         1 003110   300054 236110                    LDQ     44,X0,PR3
         1 003111   777777 376003                    ANQ     -1,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:146  
         1 003112   040040 276007                    ORQ     16416,DL
         1 003113   100026 756100                    STQ     22,,PR1

      959    17191    3           PN$.V_=JIT$;

  17191  1 003114   200030 236100                    LDQ     JIT$,,AUTO
         1 003115   200003 471500                    LDP1    @PN$,,AUTO
         1 003116   100000 756100                    STQ     0,,PR1

      960    17192    3           TSTFINFO=I;

  17192  1 003117   200021 235100                    LDA     I,,AUTO
         1 003120   200037 755100                    STA     TSTFINFO,,AUTO

      961    17193    3           NEWSTREAM='1'B;

  17193  1 003121   400000 236003                    LDQ     -131072,DU
         1 003122   200014 756100                    STQ     NEWSTREAM,,AUTO
         1 003123   003167 710000 1                  TRA     s:17210

      962    17194    3        CASE(1);                      /* STREAM IS DEFINED BUT NO DCB IS OPEN    */

      963    17195    3           NEWSTREAM='1'B;

  17195  1 003124   400000 236003                    LDQ     -131072,DU
         1 003125   200014 756100                    STQ     NEWSTREAM,,AUTO

      964    17196    3           TSTFINFO=I;

  17196  1 003126   200021 235100                    LDA     I,,AUTO
         1 003127   200037 755100                    STA     TSTFINFO,,AUTO

      965    17197    3           IF NOT B$ROSEG.STREAMID.UC_STR(I)

  17197  1 003130   000074 236110                    LDQ     60,X0,PR0
         1 003131   000001 316003                    CANQ    1,DU
         1 003132   003142 601000 1                  TNZ     s:17203
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:147  

      966    17198    4           THEN DO;

      967    17199    4                CALL FSB$STREAMDCB(I) ALTRET(ALTRETUR);

  17199  1 003133   200021 631500                    EPPR1   I,,AUTO
         1 003134   200130 451500                    STP1    UCLDCT$+2,,AUTO
         1 003135   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003136   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003137   000000 701000 xent               TSX1    FSB$STREAMDCB
         1 003140   002737 702000 1                  TSX2    ALTRETUR

      968    17200                /* Note: STREAMDCB sets B$JIT.DCB$ -> Stream DCB     */
      969    17201    4              END;

  17201  1 003141   003167 710000 1                  TRA     s:17210

      970    17202    4           ELSE DO;

      971    17203    4                B$ROSEG.STREAMID.FLG(I) = 2;

  17203  1 003142   000003 376000 2                  ANQ     3
         1 003143   400000 276003                    ORQ     -131072,DU
         1 003144   000074 756110                    STQ     60,X0,PR0

      972    17204    4                B$JIT.DCB$ = B$M$UC$;

  17204  1 003145   000000 236000 xsym               LDQ     B$M$UC$
         1 003146   000000 471400 xsym               LDP1    B$JIT$
         1 003147   100232 756100                    STQ     154,,PR1

      973    17205    4                B$ROSEG.STREAMID.IDENT(I) = POFFW(B$M$UC$,B$ROSEG$);

  17205  1 003150   000000 235000 xsym               LDA     B$ROSEG$
         1 003151   000022 771000                    ARL     18
         1 003152   200130 755100                    STA     UCLDCT$+2,,AUTO
         1 003153   000000 236000 xsym               LDQ     B$M$UC$
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:148  
         1 003154   000022 772000                    QRL     18
         1 003155   200130 136100                    SBLQ    UCLDCT$+2,,AUTO
         1 003156   000000 620006                    EAX0    0,QL
         1 003157   200021 721100                    LXL1    I,,AUTO
         1 003160   000074 440111                    SXL0    60,X1,PR0

      974    17206    4              END;

  17206  1 003161   003167 710000 1                  TRA     s:17210

      975    17207    3        CASE(2);                           /* STREAM HAS OPEN DCB                */

      976    17208    3           B$JIT.DCB$= PINCRW(B$ROSEG$,B$ROSEG.STREAMID.IDENT(I));

  17208  1 003162   000074 721110                    LXL1    60,X0,PR0
         1 003163   000000 636011                    EAQ     0,X1
         1 003164   000000 036000 xsym               ADLQ    B$ROSEG$
         1 003165   000000 471400 xsym               LDP1    B$JIT$
         1 003166   100232 756100                    STQ     154,,PR1

      977    17209    3        END;

      978    17210    2        IF B$ROSEG.STREAMID.UC_STR(I)

  17210  1 003167   000000 470400 xsym               LDP0    B$ROSEG$
         1 003170   200021 720100                    LXL0    I,,AUTO
         1 003171   000074 236110                    LDQ     60,X0,PR0
         1 003172   000001 316003                    CANQ    1,DU
         1 003173   003200 600000 1                  TZE     s:17214

      979    17211    2        THEN
      980    17212    2             F$DCB.FFLG = %FFLG_WNEW# | %FFLG_READ#;

  17212  1 003174   500000 221003                    LDX1    -98304,DU
         1 003175   200017 471500                    LDP1    JDCB$,,AUTO
         1 003176   100004 741100                    STX1    4,,PR1
         1 003177   003203 710000 1                  TRA     s:17214+3
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:149  

      981    17213    2        ELSE
      982    17214    2             F$DCB.FFLG=%FFLG_WNEW#;

  17214  1 003200   100000 221003                    LDX1    32768,DU
         1 003201   200017 471500                    LDP1    JDCB$,,AUTO
         1 003202   100004 741100                    STX1    4,,PR1
         1 003203   003205 710000 1                  TRA     s:17216

      983    17215    2   MOVEINFO: ENTRY ALTRET;

  17215  1 003204   200042 741300       MOVEINFO     STX1  ! ORG+2,,AUTO

      984    17216    2        F$DCB.CFU$=B$JIT.DCB$;

  17216  1 003205   000000 470400 xsym               LDP0    B$JIT$
         1 003206   000232 236100                    LDQ     154,,PR0
         1 003207   200017 471500                    LDP1    JDCB$,,AUTO
         1 003210   100066 756100                    STQ     54,,PR1

      985    17217    2        IF B$JIT.DCB$->F$DCB.MEDIA = FMTUC#

  17217  1 003211   000232 473500                    LDP3    154,,PR0
         1 003212   300103 236100                    LDQ     67,,PR3
         1 003213   000777 376003                    ANQ     511,DU
         1 003214   000014 116003                    CMPQ    12,DU
         1 003215   003331 601000 1                  TNZ     s:17254

      986    17218    3        THEN DO;

      987    17219    3             F$DCB.STR = I;

  17219  1 003216   200021 236100                    LDQ     I,,AUTO
         1 003217   100077 552104                    STBQ    63,'04'O,PR1

      988    17220    3             ORG = F$DCB.ORG;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:150  
  17220  1 003220   100032 236100                    LDQ     26,,PR1
         1 003221   000033 772000                    QRL     27
         1 003222   200040 756100                    STQ     ORG,,AUTO

      989    17221    3             CALL CHECK_COMP(I) ALTRET(ALTRETUR);

  17221  1 003223   200021 633500                    EPPR3   I,,AUTO
         1 003224   200045 453500                    STP3    CGID+1,,AUTO
         1 003225   003635 701000 1                  TSX1    CHECK_COMP
         1 003226   002737 702000 1                  TSX2    ALTRETUR

      990    17222    3             WINDOW = FS_WINDOW;

  17222  1 003227   000100 100400                    MLR     fill='000'O
         1 003230   000000 000040 xsym               ADSC9   FS_WINDOW                cn=0,n=32
         1 003231   200004 000040                    ADSC9   WINDOW,,AUTO             cn=0,n=32

      991    17223    3             IF PN$.WINDOW_ ~= ADDR(NIL)

  17223  1 003232   200003 470500                    LDP0    @PN$,,AUTO
         1 003233   000006 236100                    LDQ     6,,PR0
         1 003234   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003235   003255 600000 1                  TZE     s:17231

      992    17224    4             THEN DO;

      993    17225    4                  WINDOW = PN$.WINDOW_->VLP$WINDOW;

  17225  1 003236   000006 471500                    LDP1    6,,PR0
         1 003237   000100 100500                    MLR     fill='000'O
         1 003240   100000 000040                    ADSC9   0,,PR1                   cn=0,n=32
         1 003241   200004 000040                    ADSC9   WINDOW,,AUTO             cn=0,n=32

      994    17226    4                  IF B$ROSEG.STREAMID.WINDOW(I) AND I<20

  17226  1 003242   000000 471400 xsym               LDP1    B$ROSEG$
         1 003243   200021 720100                    LXL0    I,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:151  
         1 003244   100074 236110                    LDQ     60,X0,PR1
         1 003245   000002 316003                    CANQ    2,DU
         1 003246   003273 600000 1                  TZE     s:17240
         1 003247   200021 235100                    LDA     I,,AUTO
         1 003250   000024 115007                    CMPA    20,DL
         1 003251   003273 605000 1                  TPL     s:17240

      995    17227    4                  THEN
      996    17228    4                       WINDOW.POSITION# = 0;

  17228  1 003252   000000 236003                    LDQ     0,DU
         1 003253   200006 552140                    STBQ    WINDOW+2,'40'O,AUTO

      997    17229    4                END;

  17229  1 003254   003273 710000 1                  TRA     s:17240

      998    17230    3             ELSE
      999    17231    3                  IF NOT NEWSTREAM

  17231  1 003255   200014 234100                    SZN     NEWSTREAM,,AUTO
         1 003256   003311 605000 1                  TPL     JUSTOPNIT
         1 003257   200040 235100                    LDA     ORG,,AUTO
         1 003260   000027 115007                    CMPA    23,DL
         1 003261   003264 600000 1                  TZE     s:17235
         1 003262   000031 115007                    CMPA    25,DL
         1 003263   003311 601000 1                  TNZ     JUSTOPNIT

     1000    17232    3                       OR (ORG ~= %SE# AND ORG ~= %FORM#)
     1001    17233    3                  THEN GOTO JUSTOPNIT;     /* No window required or specified */
     1002    17234    3                  ELSE
     1003    17235    3                       IF I <= KIDM_USER   /* No FORM or SE in standard streams */

  17235  1 003264   200021 235100                    LDA     I,,AUTO
         1 003265   000002 115007                    CMPA    2,DL
         1 003266   003273 605400 1                  TPNZ    s:17240

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:152  
     1004    17236    4                       THEN DO;

     1005    17237    4                            B$JIT.ERR = ERR_ORGNOTCOM;

  17237  1 003267   000041 236000 0                  LDQ     ERR_ORGNOTCOM
         1 003270   000000 471400 xsym               LDP1    B$JIT$
         1 003271   100012 756100                    STQ     10,,PR1

     1006    17238    4                            GOTO ALTRETUR;

  17238  1 003272   002737 710000 1                  TRA     ALTRETUR

     1007    17239    4                          END;
     1008    17240    3             CALL KIA$WINDOW(I,WINDOW);

  17240  1 003273   200004 631500                    EPPR1   WINDOW,,AUTO
         1 003274   200131 451500                    STP1    UCLDCT$+3,,AUTO
         1 003275   200021 633500                    EPPR3   I,,AUTO
         1 003276   200130 453500                    STP3    UCLDCT$+2,,AUTO
         1 003277   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003300   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003301   000000 701000 xent               TSX1    KIA$WINDOW
         1 003302   000000 011000                    NOP     0

     1009    17241    3             IF I<16

  17241  1 003303   200021 235100                    LDA     I,,AUTO
         1 003304   000020 115007                    CMPA    16,DL
         1 003305   003311 605000 1                  TPL     JUSTOPNIT

     1010    17242    3             THEN
     1011    17243    3                  B$ROSEG.STREAMID.WINDOW(I) = '1'B;

  17243  1 003306   000000 470400 xsym               LDP0    B$ROSEG$
         1 003307   000002 236003                    LDQ     2,DU
         1 003310   000074 256105                    ORSQ    60,AL,PR0

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:153  
  17241  1 003311                       JUSTOPNIT    null
     1012    17244    3   JUSTOPNIT: ;
     1013    17245    3             IF NEWSTREAM

  17245  1 003311   200014 234100                    SZN     NEWSTREAM,,AUTO
         1 003312   003331 605000 1                  TPL     s:17254

     1014    17246    3             THEN
     1015    17247    3                  CALL KIA$OPNSTR (I, F$DCB)

  17247  1 003313   200017 236100                    LDQ     JDCB$,,AUTO
         1 003314   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 003315   200021 630500                    EPPR0   I,,AUTO
         1 003316   200130 450500                    STP0    UCLDCT$+2,,AUTO
         1 003317   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003320   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003321   000000 701000 xent               TSX1    KIA$OPNSTR
         1 003322   003324 702000 1                  TSX2    s:17249
         1 003323   003331 710000 1                  TRA     s:17254

     1016    17248    4                  WHENALTRETURN DO;

     1017    17249    4                       IF B$JIT.ERR.CODE ~= %E$BYD

  17249  1 003324   000000 470400 xsym               LDP0    B$JIT$
         1 003325   000012 236100                    LDQ     10,,PR0
         1 003326   377770 376007                    ANQ     131064,DL
         1 003327   020400 116007                    CMPQ    8448,DL
         1 003330   002737 601000 1                  TNZ     ALTRETUR

     1018    17250    4                       THEN
     1019    17251    4                            GOTO ALTRETUR;
     1020    17252    4                     END;

     1021    17253    3           END;

     1022    17254    2        IF ((F$DCB.ORG ~= %FPRG#) OR
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:154  

  17254  1 003331   200017 470500                    LDP0    JDCB$,,AUTO
         1 003332   000032 236100                    LDQ     26,,PR0
         1 003333   777000 376003                    ANQ     -512,DU
         1 003334   012000 116003                    CMPQ    5120,DU
         1 003335   003343 601000 1                  TNZ     s:17257
         1 003336   000066 471500                    LDP1    54,,PR0
         1 003337   100032 236100                    LDQ     26,,PR1
         1 003340   777000 376003                    ANQ     -512,DU
         1 003341   010000 116003                    CMPQ    4096,DU
         1 003342   003364 600000 1                  TZE     s:17266

     1023    17255    2             (F$DCB.CFU$->F$DCB.ORG ~= %TERMINAL#))
     1024    17256    3        THEN DO;

     1025    17257    3             F$DCB.IASN=%STREAM#;

  17257  1 003343   000005 236007                    LDQ     5,DL
         1 003344   000103 552104                    STBQ    67,'04'O,PR0

     1026    17258        /*      First copy stuff common to all formatting types.*/
     1027    17259    3             F$DCB.UCOUT=F$DCB.CFU$->F$DCB.UCOUT;

  17259  1 003345   000066 471500                    LDP1    54,,PR0
         1 003346   100067 236100                    LDQ     55,,PR1
         1 003347   000067 676100                    ERQ     55,,PR0
         1 003350   001000 376003                    ANQ     512,DU
         1 003351   000067 656100                    ERSQ    55,,PR0

     1028    17260    3             F$DCB.DDEV=F$DCB.CFU$->F$DCB.DDEV;

  17260  1 003352   100004 236100                    LDQ     4,,PR1
         1 003353   000004 552110                    STBQ    4,'10'O,PR0

     1029    17261    3             F$DCB.SETX=F$DCB.CFU$->F$DCB.SETX;

  17261  1 003354   100051 720100                    LXL0    41,,PR1
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:155  
         1 003355   000051 440100                    SXL0    41,,PR0

     1030    17262    3             F$DCB.WIDTH=F$DCB.CFU$->F$DCB.WIDTH;

  17262  1 003356   100004 236100                    LDQ     4,,PR1
         1 003357   000004 552104                    STBQ    4,'04'O,PR0

     1031    17263    3             F$DCB.ATTR=F$DCB.CFU$->F$DCB.ATTR;

  17263  1 003360   100040 721100                    LXL1    32,,PR1
         1 003361   000040 441100                    SXL1    32,,PR0

     1032    17264    3             F$DCB.CODE16$=F$DCB.CFU$->F$DCB.FORM$;

  17264  1 003362   100050 236100                    LDQ     40,,PR1
         1 003363   000053 756100                    STQ     43,,PR0

     1033    17265    3           END;

     1034    17266    2        IF F$DCB.FORM$~=ADDR(NIL) THEN

  17266  1 003364   000050 236100                    LDQ     40,,PR0
         1 003365   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003366   003377 600000 1                  TZE     s:17270

     1035    17267    2             CALL FSA$FSP(SIZEW(CODE16),F$DCB.FORM$);

  17267  1 003367   200017 236100                    LDQ     JDCB$,,AUTO
         1 003370   000050 036003                    ADLQ    40,DU
         1 003371   000031 235000 2                  LDA     25
         1 003372   200130 757100                    STAQ    UCLDCT$+2,,AUTO
         1 003373   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003374   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003375   000000 701000 xent               TSX1    FSA$FSP
         1 003376   000000 011000                    NOP     0

     1036    17268
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:156  
     1037    17269        /*      Then do formatter-specific stuff.*/
     1038    17270    3        DO CASE(F$DCB.CFU$->F$DCB.ORG);

  17270  1 003377   200017 470500                    LDP0    JDCB$,,AUTO
         1 003400   000066 471500                    LDP1    54,,PR0
         1 003401   100032 236100                    LDQ     26,,PR1
         1 003402   000033 772000                    QRL     27
         1 003403   000004 136007                    SBLQ    4,DL
         1 003404   000007 116007                    CMPQ    7,DL
         1 003405   003407 602006 1                  TNC     s:17270+8,QL
         1 003406   003527 710000 1                  TRA     ALSOUR
         1 003407   003527 710000 1                  TRA     ALSOUR
         1 003410   003527 710000 1                  TRA     ALSOUR
         1 003411   003527 710000 1                  TRA     ALSOUR
         1 003412   003527 710000 1                  TRA     ALSOUR
         1 003413   003426 710000 1                  TRA     s:17277
         1 003414   003511 710000 1                  TRA     s:17295
         1 003415   003416 710000 1                  TRA     s:17272

     1039    17271    3        CASE(%FPRG#);

     1040    17272    3           F$DCB.ORG=%FPRG#;

  17272  1 003416   012000 236003                    LDQ     5120,DU
         1 003417   000032 552140                    STBQ    26,'40'O,PR0

     1041    17273    3           F$DCB.IFMT=FMTFPSTRM#;

  17273  1 003420   024000 236003                    LDQ     10240,DU
         1 003421   000103 552140                    STBQ    67,'40'O,PR0

     1042    17274    3           F$DCB.FFLG = %FFLG_WNEW# | %FFLG_READ#;

  17274  1 003422   500000 220003                    LDX0    -98304,DU
         1 003423   000004 740100                    STX0    4,,PR0

     1043    17275    3           RETURN;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:157  

  17275  1 003424   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 003425   000001 702211                    TSX2  ! 1,X1

     1044    17276    3        CASE(%TERMINAL#);

     1045    17277    3           IF F$DCB.ORG = %FPRG# AND F$DCB.CFU$->F$DCB.LDCTX ~= 0

  17277  1 003426   000032 236100                    LDQ     26,,PR0
         1 003427   777000 376003                    ANQ     -512,DU
         1 003430   012000 116003                    CMPQ    5120,DU
         1 003431   003464 601000 1                  TNZ     s:17285
         1 003432   100051 220100                    LDX0    41,,PR1
         1 003433   003464 600000 1                  TZE     s:17285
         1 003434   000000 473400 xsym               LDP3    B$JIT$
         1 003435   300000 236100                    LDQ     0,,PR3
         1 003436   740000 376003                    ANQ     -16384,DU
         1 003437   140000 116003                    CMPQ    49152,DU
         1 003440   003464 601000 1                  TNZ     s:17285
         1 003441   100051 721100                    LXL1    41,,PR1
         1 003442   100051 101100                    CMPX1   41,,PR1
         1 003443   003464 601000 1                  TNZ     s:17285

     1046    17278    3                AND B$JIT.MODE = %M_INT#
     1047    17279    3                AND F$DCB.CFU$->F$DCB.LDCTX = F$DCB.CFU$->F$DCB.SETX
     1048    17280    4           THEN DO;

     1049    17281    4                FEX = NK$LDCT$(F$DCB.CFU$->F$DCB.LDCTX)->NK$LDCT.RLCID.NODE;

  17281  1 003444   000000 474400 xsym               LDP4    N$DCT$$
         1 003445   400000 475510                    LDP5    0,X0,PR4
         1 003446   500015 236100                    LDQ     13,,PR5
         1 003447   000033 772000                    QRL     27
         1 003450   200026 756100                    STQ     FEX,,AUTO

     1050    17282    4                CALL FPRG(%G_M_USER#,FEX,I,F$DCB.CFU$->F$DCB) ALTRET(ALTRETUR);

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:158  
  17282  1 003451   200050 451500                    STP1    @STR+1,,AUTO
         1 003452   200021 635500                    EPPR5   I,,AUTO
         1 003453   200047 455500                    STP5    @FEX+1,,AUTO
         1 003454   200026 636500                    EPPR6   FEX,,AUTO
         1 003455   200046 456500                    STP6    @MODE+1,,AUTO
         1 003456   000011 236000 2                  LDQ     9
         1 003457   200045 756100                    STQ     CGID+1,,AUTO
         1 003460   004114 701000 1                  TSX1    FPRG
         1 003461   002737 702000 1                  TSX2    ALTRETUR

     1051    17283    4                RETURN;

  17283  1 003462   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 003463   000001 702211                    TSX2  ! 1,X1

     1052    17284    4              END;
     1053    17285    3           IF F$DCB.ORG = %SE#

  17285  1 003464   000032 236100                    LDQ     26,,PR0
         1 003465   777000 376003                    ANQ     -512,DU
         1 003466   027000 116003                    CMPQ    11776,DU
         1 003467   003472 601000 1                  TNZ     s:17287

     1054    17286    3           THEN F$DCB.FFLG.DELR = '1'B;

  17286  1 003470   200000 236003                    LDQ     65536,DU
         1 003471   000004 256100                    ORSQ    4,,PR0

     1055    17287    3           IF F$DCB.ORG=%TERMINAL# OR F$DCB.ORG = %SE# OR

  17287  1 003472   000032 236100                    LDQ     26,,PR0
         1 003473   777000 376003                    ANQ     -512,DU
         1 003474   010000 116003                    CMPQ    4096,DU
         1 003475   003504 600000 1                  TZE     s:17290
         1 003476   027000 116003                    CMPQ    11776,DU
         1 003477   003504 600000 1                  TZE     s:17290
         1 003500   030000 116003                    CMPQ    12288,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:159  
         1 003501   003504 600000 1                  TZE     s:17290
         1 003502   031000 116003                    CMPQ    12800,DU
         1 003503   003527 601000 1                  TNZ     ALSOUR

     1056    17288    3                F$DCB.ORG = %X364# OR F$DCB.ORG = %FORM#
     1057    17289    4           THEN DO;

     1058    17290    4                F$DCB.IFMT=FMTTTYSTRM#;

  17290  1 003504   021000 236003                    LDQ     8704,DU
         1 003505   000103 552140                    STBQ    67,'40'O,PR0

     1059    17291    4                F$DCB.MEDIA=FMTUC#;

  17291  1 003506   000014 236003                    LDQ     12,DU
         1 003507   000103 552120                    STBQ    67,'20'O,PR0

     1060    17292    4              END;

  17292  1 003510   003603 710000 1                  TRA     XIT

     1061    17293    3           ELSE GOTO ALSOUR;
     1062    17294    3        CASE(%SYMB#);

     1063    17295    3           IF F$DCB.CFU$->F$DCB.IFMT = FMTGRSTRM#

  17295  1 003511   100103 236100                    LDQ     67,,PR1
         1 003512   777000 376003                    ANQ     -512,DU
         1 003513   030000 116003                    CMPQ    12288,DU
         1 003514   003552 600000 1                  TZE     GRSTRM

     1064    17296    3           THEN GOTO GRSTRM;
     1065    17297    3           ELSE IF (F$DCB.ORG=%TERMINAL# AND

  17297  1 003515   000032 236100                    LDQ     26,,PR0
         1 003516   777000 376003                    ANQ     -512,DU
         1 003517   010000 116003                    CMPQ    4096,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:160  
         1 003520   003527 601000 1                  TNZ     ALSOUR
         1 003521   000004 236100                    LDQ     4,,PR0
         1 003522   400000 316007                    CANQ    -131072,DL
         1 003523   003527 601000 1                  TNZ     ALSOUR

     1066    17298    3                     NOT F$DCB.DDEV.LP)
     1067    17299    4                THEN DO;

     1068    17300    4                     F$DCB.IFMT=FMTTTYSTRM#;

  17300  1 003524   021000 236003                    LDQ     8704,DU
         1 003525   000103 552140                    STBQ    67,'40'O,PR0

     1069    17301    4                   END;

  17301  1 003526   003603 710000 1                  TRA     XIT

     1070    17302    3                ELSE GOTO ALSOUR;
     1071    17303    3        CASE(%UR#,ELSE);

     1072    17304    4   ALSOUR: IF F$DCB.CFU$->F$DCB.ASN=%COMGROUP# THEN DO;

  17304  1 003527   100032 236100       ALSOUR       LDQ     26,,PR1
         1 003530   777000 376007                    ANQ     -512,DL
         1 003531   004000 116007                    CMPQ    2048,DL
         1 003532   003542 601000 1                  TNZ     s:17310

     1073    17305    4                F$DCB.ORG=%TERMINAL#;

  17305  1 003533   010000 236003                    LDQ     4096,DU
         1 003534   000032 552140                    STBQ    26,'40'O,PR0

     1074    17306    4                F$DCB.IFMT=FMTTTYSTRM#;

  17306  1 003535   021000 236003                    LDQ     8704,DU
         1 003536   000103 552140                    STBQ    67,'40'O,PR0

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:161  
     1075    17307    4                F$DCB.IASN = %STREAM#;     /* Just in case DCB.ORG was FPRG */

  17307  1 003537   000005 236007                    LDQ     5,DL
         1 003540   000103 552104                    STBQ    67,'04'O,PR0

     1076    17308    4              END;

  17308  1 003541   003546 710000 1                  TRA     s:17313

     1077    17309    4           ELSE DO;

     1078    17310    4                F$DCB.ORG=%UR#;

  17310  1 003542   004000 236003                    LDQ     2048,DU
         1 003543   000032 552140                    STBQ    26,'40'O,PR0

     1079    17311    4                F$DCB.IFMT=FMTURSTRM#;

  17311  1 003544   020000 236003                    LDQ     8192,DU
         1 003545   000103 552140                    STBQ    67,'40'O,PR0

     1080    17312    4              END;

     1081    17313    3           IF F$DCB.CFU$->F$DCB.IFMT = FMTGRSTRM#

  17313  1 003546   100103 236100                    LDQ     67,,PR1
         1 003547   777000 376003                    ANQ     -512,DU
         1 003550   030000 116003                    CMPQ    12288,DU
         1 003551   003560 601000 1                  TNZ     s:17320

     1082    17314    4           THEN DO;

  17311  1 003552                       GRSTRM       null
     1083    17315    4   GRSTRM:      ;
     1084    17316    4                F$DCB.IFMT = FMTGRSTRM#;

  17316  1 003552   030000 236003                    LDQ     12288,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:162  
         1 003553   000103 552140                    STBQ    67,'40'O,PR0

     1085    17317    4                F$DCB.DDEV = %DDEV_GR#;

  17317  1 003554   010000 236007                    LDQ     4096,DL
         1 003555   000004 552110                    STBQ    4,'10'O,PR0

     1086    17318    4                F$DCB.MEDIA = FMTSYMB#;

  17318  1 003556   000022 236003                    LDQ     18,DU
         1 003557   000103 552120                    STBQ    67,'20'O,PR0

     1087    17319    4              END;

     1088    17320    3           IF NOT F$DCB.SEQ THEN

  17320  1 003560   000044 236100                    LDQ     36,,PR0
         1 003561   000400 316007                    CANQ    256,DL
         1 003562   003567 601000 1                  TNZ     s:17322

     1089    17321    3                F$DCB.IWL.SEQIWL=F$DCB.CFU$->F$DCB.IWL.SEQIWL;

  17321  1 003563   100103 236100                    LDQ     67,,PR1
         1 003564   000103 676100                    ERQ     67,,PR0
         1 003565   200000 376007                    ANQ     65536,DL
         1 003566   000103 656100                    ERSQ    67,,PR0

     1090    17322    3           IF F$DCB.HEADER$=ADDR(NIL) THEN

  17322  1 003567   000046 236100                    LDQ     38,,PR0
         1 003570   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003571   003577 601000 1                  TNZ     s:17325

     1091    17323    3                F$DCB.IWL.HDRIWL=F$DCB.CFU$->F$DCB.IWL.HDRIWL;

  17323  1 003572   100103 236100                    LDQ     67,,PR1
         1 003573   000103 676100                    ERQ     67,,PR0
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:163  
         1 003574   100000 376007                    ANQ     32768,DL
         1 003575   000103 656100                    ERSQ    67,,PR0
         1 003576   003603 710000 1                  TRA     XIT

     1092    17324    3           ELSE
     1093    17325    3                CALL FSM$HDRSET(F$DCB);

  17325  1 003577   200017 630500                    EPPR0   JDCB$,,AUTO
         1 003600   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003601   000000 701000 xent               TSX1    FSM$HDRSET
         1 003602   000000 011000                    NOP     0

     1094    17326    3        END;

     1095    17327        /*      Then do stuff common to UR and TTY.*/
     1096    17328    2   XIT:
     1097    17329    2        IF F$DCB.DVFC=BINASC(0) THEN

  17329  1 003603   200017 470500       XIT          LDP0    JDCB$,,AUTO
         1 003604   000044 236100                    LDQ     36,,PR0
         1 003605   777000 376007                    ANQ     -512,DL
         1 003606   000000 116003                    CMPQ    0,DU
         1 003607   003613 601000 1                  TNZ     s:17331

     1098    17330    2             F$DCB.DVFC=F$DCB.CFU$->F$DCB.DVFC;

  17330  1 003610   000066 471500                    LDP1    54,,PR0
         1 003611   100044 236100                    LDQ     36,,PR1
         1 003612   000044 552110                    STBQ    36,'10'O,PR0

     1099    17331    2        IF F$DCB.LINES=0 OR F$DCB.LINES>F$DCB.CFU$->F$DCB.LINES THEN

  17331  1 003613   000044 220100                    LDX0    36,,PR0
         1 003614   003621 600000 1                  TZE     s:17332
         1 003615   000066 471500                    LDP1    54,,PR0
         1 003616   100044 221100                    LDX1    36,,PR1
         1 003617   000044 101100                    CMPX1   36,,PR0
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:164  
         1 003620   003624 603000 1                  TRC     s:17333

     1100    17332    2             F$DCB.LINES=F$DCB.CFU$->F$DCB.LINES;

  17332  1 003621   000066 471500                    LDP1    54,,PR0
         1 003622   100044 221100                    LDX1    36,,PR1
         1 003623   000044 741100                    STX1    36,,PR0

     1101    17333    2        IF F$DCB.TAB$=ADDR(NIL) THEN

  17333  1 003624   000047 236100                    LDQ     39,,PR0
         1 003625   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003626   003633 601000 1                  TNZ     s:17335

     1102    17334    2             F$DCB.IWL.TABIWL=F$DCB.CFU$->F$DCB.IWL.TABIWL;

  17334  1 003627   100103 236100                    LDQ     67,,PR1
         1 003630   000103 676100                    ERQ     67,,PR0
         1 003631   400000 376007                    ANQ     -131072,DL
         1 003632   000103 656100                    ERSQ    67,,PR0

     1103    17335    2        RETURN;

  17335  1 003633   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 003634   000001 702211                    TSX2  ! 1,X1

     1104    17336    2   END OPENLDEV;
     1105    17337        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:165  
     1106    17338    1   CHECK_COMP: PROC (STR) ALTRET;

  17338  1 003635   200044 741300       CHECK_COMP   STX1  ! DDCB$+1,,AUTO

     1107    17339
     1108    17340    2   DCL STR UBIN;
     1109    17341    2   DCL I SBIN;
     1110    17342
     1111    17343    2        I = B$ROSEG.NUMDCBS;

  17343  1 003636   000000 470400 xsym               LDP0    B$ROSEG$
         1 003637   000002 236100                    LDQ     2,,PR0
         1 003640   000022 772000                    QRL     18
         1 003641   200046 756100                    STQ     I,,AUTO

     1112    17344    3        DO WHILE (I>=0);

  17344  1 003642   003763 604000 1                  TMI     s:17379

     1113    17345    3             IF DCBADDR(I) ~= ADDR(NIL) AND DCBADDR(I)->F$DCB.CFU$ = F$DCB.CFU$

  17345  1 003643   000032 470400 2                  LDP0    26
         1 003644   000000 471500                    LDP1    0,,PR0
         1 003645   200046 720100                    LXL0    I,,AUTO
         1 003646   100000 236110                    LDQ     0,X0,PR1
         1 003647   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003650   003760 600000 1                  TZE     s:17377
         1 003651   100000 473510                    LDP3    0,X0,PR1
         1 003652   200017 474500                    LDP4    JDCB$,,AUTO
         1 003653   300066 236100                    LDQ     54,,PR3
         1 003654   400066 116100                    CMPQ    54,,PR4
         1 003655   003760 601000 1                  TNZ     s:17377
         1 003656   300031 236100                    LDQ     25,,PR3
         1 003657   020000 316007                    CANQ    8192,DL
         1 003660   003760 600000 1                  TZE     s:17377
         1 003661   300103 236100                    LDQ     67,,PR3
         1 003662   000777 376007                    ANQ     511,DL
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:166  
         1 003663   000005 116007                    CMPQ    5,DL
         1 003664   003760 601000 1                  TNZ     s:17377

     1114    17346    3                  AND DCBADDR(I)->F$DCB.FCD AND DCBADDR(I)->F$DCB.IASN = %STREAM#
     1115    17347    3             THEN
     1116    17348    3                  IF DCBADDR(I)->F$DCB.STR = STR

  17348  1 003665   200045 475500                    LDP5    @STR,,AUTO
         1 003666   300077 236100                    LDQ     63,,PR3
         1 003667   000777 376007                    ANQ     511,DL
         1 003670   500000 116100                    CMPQ    0,,PR5
         1 003671   003760 601000 1                  TNZ     s:17377

     1117    17349    4                  THEN DO;

     1118    17350    4                       NEWSTREAM = '0'B;

  17350  1 003672   200014 450100                    STZ     NEWSTREAM,,AUTO

     1119    17351    5                       DO CASE (F$DCB.ORG);

  17351  1 003673   400032 236100                    LDQ     26,,PR4
         1 003674   000033 772000                    QRL     27
         1 003675   000004 136007                    SBLQ    4,DL
         1 003676   000026 116007                    CMPQ    22,DL
         1 003677   003701 602006 1                  TNC     s:17351+6,QL
         1 003700   003760 710000 1                  TRA     s:17377
         1 003701   003734 710000 1                  TRA     s:17358
         1 003702   003760 710000 1                  TRA     s:17377
         1 003703   003760 710000 1                  TRA     s:17377
         1 003704   003760 710000 1                  TRA     s:17377
         1 003705   003734 710000 1                  TRA     s:17358
         1 003706   003760 710000 1                  TRA     s:17377
         1 003707   003760 710000 1                  TRA     s:17377
         1 003710   003760 710000 1                  TRA     s:17377
         1 003711   003760 710000 1                  TRA     s:17377
         1 003712   003760 710000 1                  TRA     s:17377
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:167  
         1 003713   003760 710000 1                  TRA     s:17377
         1 003714   003760 710000 1                  TRA     s:17377
         1 003715   003760 710000 1                  TRA     s:17377
         1 003716   003760 710000 1                  TRA     s:17377
         1 003717   003760 710000 1                  TRA     s:17377
         1 003720   003760 710000 1                  TRA     s:17377
         1 003721   003760 710000 1                  TRA     s:17377
         1 003722   003760 710000 1                  TRA     s:17377
         1 003723   003760 710000 1                  TRA     s:17377
         1 003724   003727 710000 1                  TRA     s:17354
         1 003725   003747 710000 1                  TRA     s:17365
         1 003726   003727 710000 1                  TRA     s:17354

     1120    17352
     1121    17353    5                       CASE (%FORM#,%SE#);

     1122    17354    5                          B$JIT.ERR = ERR_ORGNOTCOM;

  17354  1 003727   000041 236000 0                  LDQ     ERR_ORGNOTCOM
         1 003730   000000 476400 xsym               LDP6    B$JIT$
         1 003731   600012 756100                    STQ     10,,PR6

     1123    17355    5                          ALTRETURN;

  17355  1 003732   200044 221300                    LDX1  ! DDCB$+1,,AUTO
         1 003733   000000 702211                    TSX2  ! 0,X1

     1124    17356
     1125    17357    5                       CASE (%TERMINAL#,%UR#);

     1126    17358    5                          IF DCBADDR(I)->F$DCB.ORG ~= %UR# AND

  17358  1 003734   300032 236100                    LDQ     26,,PR3
         1 003735   777000 376003                    ANQ     -512,DU
         1 003736   004000 116003                    CMPQ    2048,DU
         1 003737   003760 600000 1                  TZE     s:17377
         1 003740   010000 116003                    CMPQ    4096,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:168  
         1 003741   003760 600000 1                  TZE     s:17377

     1127    17359    5                               DCBADDR(I)->F$DCB.ORG ~= %TERMINAL#
     1128    17360    6                          THEN DO;

     1129    17361    6                               B$JIT.ERR = ERR_ORGNOTCOM;

  17361  1 003742   000041 236000 0                  LDQ     ERR_ORGNOTCOM
         1 003743   000000 476400 xsym               LDP6    B$JIT$
         1 003744   600012 756100                    STQ     10,,PR6

     1130    17362    6                               ALTRETURN;

  17362  1 003745   200044 221300                    LDX1  ! DDCB$+1,,AUTO
         1 003746   000000 702211                    TSX2  ! 0,X1

     1131    17363    6                             END;
     1132    17364    5                       CASE (%X364#);

     1133    17365    5                          IF DCBADDR(I)->F$DCB.ORG ~= %X364#

  17365  1 003747   300032 236100                    LDQ     26,,PR3
         1 003750   777000 376003                    ANQ     -512,DU
         1 003751   030000 116003                    CMPQ    12288,DU
         1 003752   003760 600000 1                  TZE     s:17377

     1134    17366    6                          THEN DO;

     1135    17367    6                               B$JIT.ERR = ERR_ORGNOTCOM;

  17367  1 003753   000041 236000 0                  LDQ     ERR_ORGNOTCOM
         1 003754   000000 476400 xsym               LDP6    B$JIT$
         1 003755   600012 756100                    STQ     10,,PR6

     1136    17368                  /*E* ERROR: FSN-%E$ORGNOTCOM-0
     1137    17369                       MESSAGE: The ORG is not compatible.
     1138    17370                       MESSAGE1: The organization specified on the M$OPEN is not
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:169  
     1139    17371                                 compatible with a DCB already opened to this stream.
     1140    17372          */
     1141    17373    6                               ALTRETURN;

  17373  1 003756   200044 221300                    LDX1  ! DDCB$+1,,AUTO
         1 003757   000000 702211                    TSX2  ! 0,X1

     1142    17374    6                             END;
     1143    17375    5                       END;

     1144    17376    4                     END;

     1145    17377    3             I = I - 1;

  17377  1 003760   000001 336007                    LCQ     1,DL
         1 003761   200046 056100                    ASQ     I,,AUTO

     1146    17378    3           END;

  17378  1 003762   003643 605000 1                  TPL     s:17345

     1147    17379    2        RETURN;

  17379  1 003763   200044 221300                    LDX1  ! DDCB$+1,,AUTO
         1 003764   000001 702211                    TSX2  ! 1,X1

     1148    17380
     1149    17381    2   END CHECK_COMP;
     1150    17382        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:170  
     1151    17383    1   CGINIT: PROC ALTRET;

  17383  1 003765   200042 741300       CGINIT       STX1  ! ORG+2,,AUTO

     1152    17384        /**/
     1153    17385    2   DCL SDCB$ PTR;
     1154    17386    2   DCL FFLG BIT(36);
     1155    17387        %VLP_STATION (FPTN=ASTATION,STCLASS=);
     1156    17414        /**/
     1157    17415    3        IF F$DCB.LASTSTA$=ADDR(NIL) THEN DO;

  17415  1 003766   200017 470500                    LDP0    JDCB$,,AUTO
         1 003767   000007 236100                    LDQ     7,,PR0
         1 003770   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003771   004012 601000 1                  TNZ     s:17422

     1158    17416    3             CALL FSA$GSP(SIZEW(VLP$STATION)+SIZEW(VLP$SETSTA),

  17416  1 003772   200017 236100                    LDQ     JDCB$,,AUTO
         1 003773   000007 036003                    ADLQ    7,DU
         1 003774   000034 235000 2                  LDA     28
         1 003775   200130 757100                    STAQ    UCLDCT$+2,,AUTO
         1 003776   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 003777   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004000   000000 701000 xent               TSX1    FSA$GSP
         1 004001   004112 702000 1                  TSX2    ERR

     1159    17417    3                  F$DCB.LASTSTA$) ALTRET(ERR);
     1160    17418    3             F$DCB.SETSTA$=PINCRW(F$DCB.LASTSTA$,SIZEW(VLP$STATION));

  17418  1 004002   200017 470500                    LDP0    JDCB$,,AUTO
         1 004003   000007 236100                    LDQ     7,,PR0
         1 004004   000010 036003                    ADLQ    8,DU
         1 004005   000006 756100                    STQ     6,,PR0

     1161    17419    3             F$DCB.SETSTA$->VLP$SETSTA=VLP_SETSTA;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:171  
  17419  1 004006   000006 471500                    LDP1    6,,PR0
         1 004007   000100 100400                    MLR     fill='000'O
         1 004010   000000 000060 0                  ADSC9   VLP_SETSTA               cn=0,n=48
         1 004011   100000 000060                    ADSC9   0,,PR1                   cn=0,n=48

     1162    17420    3           END;

     1163    17421        /**/
     1164    17422    2        F$DCB.LASTSTA$->VLP$STATION=VLP_STATION;

  17422  1 004012   000007 471500                    LDP1    7,,PR0
         1 004013   000100 100400                    MLR     fill='000'O
         1 004014   000014 000040 0                  ADSC9   VLP_STATION              cn=0,n=32
         1 004015   100000 000040                    ADSC9   0,,PR1                   cn=0,n=32

     1165    17423    2        SDCB$=F$DCB.CFU$;

  17423  1 004016   000066 236100                    LDQ     54,,PR0
         1 004017   200043 756100                    STQ     SDCB$,,AUTO

     1166    17424        /**/
     1167    17425    2        ASTATION=SDCB$->F$DCB.SETSTA$->VLP$SETSTA.ISTA;

  17425  1 004020   200043 471500                    LDP1    SDCB$,,AUTO
         1 004021   100006 473500                    LDP3    6,,PR1
         1 004022   000100 100500                    MLR     fill='000'O
         1 004023   300002 000024                    ADSC9   2,,PR3                   cn=0,n=20
         1 004024   200045 000040                    ADSC9   ASTATION,,AUTO           cn=0,n=32

     1168    17426    2        IF B$JIT.MODE=%M_TP# AND F$DCB.AMRSETSTA AND SDCB$=B$M$UC$ THEN

  17426  1 004025   000000 473400 xsym               LDP3    B$JIT$
         1 004026   300000 236100                    LDQ     0,,PR3
         1 004027   740000 376003                    ANQ     -16384,DU
         1 004030   200000 116003                    CMPQ    65536,DU
         1 004031   004042 601000 1                  TNZ     s:17428
         1 004032   000031 236100                    LDQ     25,,PR0
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:172  
         1 004033   010000 316003                    CANQ    4096,DU
         1 004034   004042 600000 1                  TZE     s:17428
         1 004035   200043 236100                    LDQ     SDCB$,,AUTO
         1 004036   000000 116000 xsym               CMPQ    B$M$UC$
         1 004037   004042 601000 1                  TNZ     s:17428

     1169    17427    2             ASTATION.CTL.LOCK='0'B;       /* Ignore lock violations for TP */

  17427  1 004040   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 004041   200051 356100                    ANSQ    @SOURCEDCB+1,,AUTO

     1170    17428    2        CALL KCI$VALSTA1(F$DCB.SETSTA$->VLP$SETSTA.ISTA,ASTATION) ALTRET(ERR);

  17428  1 004042   000006 474500                    LDP4    6,,PR0
         1 004043   200045 635500                    EPPR5   ASTATION,,AUTO
         1 004044   200131 455500                    STP5    UCLDCT$+3,,AUTO
         1 004045   400002 636500                    EPPR6   2,,PR4
         1 004046   200130 456500                    STP6    UCLDCT$+2,,AUTO
         1 004047   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004050   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004051   000000 701000 xent               TSX1    KCI$VALSTA1
         1 004052   004112 702000 1                  TSX2    ERR

     1171    17429        /**/
     1172    17430    2        ASTATION=SDCB$->F$DCB.SETSTA$->VLP$SETSTA.OSTA;

  17430  1 004053   200043 470500                    LDP0    SDCB$,,AUTO
         1 004054   000006 471500                    LDP1    6,,PR0
         1 004055   000100 100500                    MLR     fill='000'O
         1 004056   100007 000024                    ADSC9   7,,PR1                   cn=0,n=20
         1 004057   200045 000040                    ADSC9   ASTATION,,AUTO           cn=0,n=32

     1173    17431    2        IF B$JIT.MODE=%M_TP# AND F$DCB.AMRSETSTA AND SDCB$=B$M$UC$ THEN

  17431  1 004060   000000 471400 xsym               LDP1    B$JIT$
         1 004061   100000 236100                    LDQ     0,,PR1
         1 004062   740000 376003                    ANQ     -16384,DU
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:173  
         1 004063   200000 116003                    CMPQ    65536,DU
         1 004064   004076 601000 1                  TNZ     s:17433
         1 004065   200017 473500                    LDP3    JDCB$,,AUTO
         1 004066   300031 236100                    LDQ     25,,PR3
         1 004067   010000 316003                    CANQ    4096,DU
         1 004070   004076 600000 1                  TZE     s:17433
         1 004071   200043 236100                    LDQ     SDCB$,,AUTO
         1 004072   000000 116000 xsym               CMPQ    B$M$UC$
         1 004073   004076 601000 1                  TNZ     s:17433

     1174    17432    2             ASTATION.CTL.LOCK='0'B;

  17432  1 004074   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 004075   200051 356100                    ANSQ    @SOURCEDCB+1,,AUTO

     1175    17433    2        CALL KCI$VALSTA1(F$DCB.SETSTA$->VLP$SETSTA.OSTA,ASTATION) ALTRET(ERR);

  17433  1 004076   200017 473500                    LDP3    JDCB$,,AUTO
         1 004077   300006 474500                    LDP4    6,,PR3
         1 004100   200045 635500                    EPPR5   ASTATION,,AUTO
         1 004101   200131 455500                    STP5    UCLDCT$+3,,AUTO
         1 004102   400007 636500                    EPPR6   7,,PR4
         1 004103   200130 456500                    STP6    UCLDCT$+2,,AUTO
         1 004104   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004105   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004106   000000 701000 xent               TSX1    KCI$VALSTA1
         1 004107   004112 702000 1                  TSX2    ERR

     1176    17434        /**/
     1177    17435        /**/
     1178    17436    2        RETURN;

  17436  1 004110   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 004111   000001 702211                    TSX2  ! 1,X1

     1179    17437        /**/
     1180    17438    2   ERR: ALTRETURN;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:174  

  17438  1 004112   200042 221300       ERR          LDX1  ! ORG+2,,AUTO
         1 004113   000000 702211                    TSX2  ! 0,X1

     1181    17439        /**/
     1182    17440    2   END CGINIT;
     1183    17441        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:175  
     1184    17442    1   FPRG: PROC(MODE,FEX,STR,SOURCEDCB) ALTRET;

  17442  1 004114   200044 741300       FPRG         STX1  ! DDCB$+1,,AUTO

     1185    17443        /*D* NAME:        FPRG
     1186    17444             PURPOSE:     To start DCB-connected FEP users (including handlers)
     1187    17445             INPUT:       MODE - The mode of FEP user to start; either G_M_USER#
     1188    17446                                 or G_M_HANDLER#.
     1189    17447                          FEX  - The destination FEP number.
     1190    17448                       STR - Stream number to open to
     1191    17449             DESCRIPTION: FPRG handles creating a FEP user and attaching
     1192    17450                          this FEP user to the opening DCB. This consists of:
     1193    17451                             1) Completing setup of the DCB
     1194    17452                             2) Dangling an LDCT from the DCB
     1195    17453                             3) Sending a 'start FEP user' message to the
     1196    17454                                network manager
     1197    17455                             4) REGing QA for completion or failure of this
     1198    17456                                request
     1199    17457                             5) Cleaning up LDCT and ALTRETURNing if path to
     1200    17458                                user terminal not set up, or...
     1201    17459        */
     1202    17460    2   DCL MODE UBIN;
     1203    17461    2   DCL FEX UBIN;
     1204    17462    2   DCL STR UBIN;
     1205    17463    2   DCL SOURCEDCB UBIN;                     /* Really a DCB, but ... */
     1206    17464        %KL_STRTU (STCLASS=AUTO);
     1207    17637    2   DCL UCLDCT$ PTR;
     1208    17638    2   DCL NETMNGR CHAR(8) DALIGNED CONSTANT INIT('HLPADMIN');
     1209    17639
     1210    17640    2        IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN RETURN;

  17640  1 004115   200003 470500                    LDP0    @PN$,,AUTO
         1 004116   000000 471500                    LDP1    0,,PR0
         1 004117   100000 236100                    LDQ     0,,PR1
         1 004120   020000 316007                    CANQ    8192,DL
         1 004121   004123 600000 1                  TZE     s:17641

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:176  
  17640  1 004122   000001 702211                    TSX2  ! 1,X1

     1211    17641    3        CALL NKL$GETDCT(JIT$) WHENALTRETURN DO;

  17641  1 004123   200030 633500                    EPPR3   JIT$,,AUTO
         1 004124   200130 453500                    STP3    UCLDCT$+2,,AUTO
         1 004125   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004126   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004127   000000 701000 xent               TSX1    NKL$GETDCT
         1 004130   004132 702000 1                  TSX2    s:17642
         1 004131   004137 710000 1                  TRA     s:17645

     1212    17642    3             B$JIT.ERR=ERR_PCNLDCT;

  17642  1 004132   000034 236000 0                  LDQ     ERR_PCNLDCT
         1 004133   000000 470400 xsym               LDP0    B$JIT$
         1 004134   000012 756100                    STQ     10,,PR0

     1213    17643    3             ALTRETURN;

  17643  1 004135   200044 221300                    LDX1  ! DDCB$+1,,AUTO
         1 004136   000000 702211                    TSX2  ! 0,X1

     1214    17644    3           END;
     1215    17645    2        LDCT$ = JIT$;

  17645  1 004137   200030 236100                    LDQ     JIT$,,AUTO
         1 004140   200020 756100                    STQ     LDCT$,,AUTO

     1216    17646    2        NK$LDCT.RESCOD=NK_TSFPRG;

  17646  1 004141   200020 470500                    LDP0    LDCT$,,AUTO
         1 004142   000006 236100                    LDQ     6,,PR0
         1 004143   000017 376000 2                  ANQ     15
         1 004144   000010 276007                    ORQ     8,DL
         1 004145   000006 756100                    STQ     6,,PR0

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:177  
     1217    17647    2        NK$LDCT.DFLG.CM='1'B;

  17647  1 004146   100000 236007                    LDQ     32768,DL
         1 004147   000006 256100                    ORSQ    6,,PR0

     1218    17648    2        NK$LDCT.USER=B$JIT.USER;

  17648  1 004150   000000 471400 xsym               LDP1    B$JIT$
         1 004151   100000 236100                    LDQ     0,,PR1
         1 004152   000007 552120                    STBQ    7,'20'O,PR0

     1219    17649    2        NK$LDCT.RLCID.NODE=FEX;

  17649  1 004153   200046 473500                    LDP3    @FEX,,AUTO
         1 004154   300000 236100                    LDQ     0,,PR3
         1 004155   000033 736000                    QLS     27
         1 004156   000015 552140                    STBQ    13,'40'O,PR0

     1220    17650    2        NK$LDCT.UDCBNO = JDCBNO;

  17650  1 004157   200024 236100                    LDQ     JDCBNO,,AUTO
         1 004160   000033 736000                    QLS     27
         1 004161   000016 552140                    STBQ    14,'40'O,PR0

     1221    17651    2        KL_STRTU='0'B;

  17651  1 004162   000100 100400                    MLR     fill='000'O
         1 004163   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 004164   200051 000264                    ADSC9   KL_STRTU,,AUTO           cn=0,n=180

     1222    17652    2        KL_STRTU.FCN=IGA_STRTU;

  17652  1 004165   033000 236003                    LDQ     13824,DU
         1 004166   200051 552140                    STBQ    KL_STRTU,'40'O,AUTO

     1223    17653    2        KL_STRTU.NODE=FEX;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:178  
  17653  1 004167   300000 236100                    LDQ     0,,PR3
         1 004170   000022 736000                    QLS     18
         1 004171   200051 552120                    STBQ    KL_STRTU,'20'O,AUTO

     1224    17654    2        KL_STRTU.STR = STR;

  17654  1 004172   200047 474500                    LDP4    @STR,,AUTO
         1 004173   400000 236100                    LDQ     0,,PR4
         1 004174   200062 552104                    STBQ    AFD+2,'04'O,AUTO

     1225    17655    2        KL_STRTU.NETADR_FROM.NODE=K_NODE#;

  17655  1 004175   000000 236000 xsym               LDQ     K_NODE#
         1 004176   000011 736000                    QLS     9
         1 004177   200051 552110                    STBQ    KL_STRTU,'10'O,AUTO

     1226    17656    2        KL_STRTU.NETADR_FROM.GENERATION = NK$LDCT.GENERATION;

  17656  1 004200   000014 236100                    LDQ     12,,PR0
         1 004201   000377 376003                    ANQ     255,DU
         1 004202   000022 772000                    QRL     18
         1 004203   200051 552104                    STBQ    KL_STRTU,'04'O,AUTO

     1227    17657    2        KL_STRTU.NETADR_FROM.LDX.BYT(0)=NK$LDCT.LDCTX/256;

  17657  1 004204   000006 236100                    LDQ     6,,PR0
         1 004205   000022 772000                    QRL     18
         1 004206   000010 772000                    QRL     8
         1 004207   000033 736000                    QLS     27
         1 004210   200052 676100                    ERQ     KL_STRTU+1,,AUTO
         1 004211   377000 376003                    ANQ     130560,DU
         1 004212   200052 656100                    ERSQ    KL_STRTU+1,,AUTO

     1228    17658    2        KL_STRTU.NETADR_FROM.LDX.BYT(1)=

  17658  1 004213   000006 236100                    LDQ     6,,PR0
         1 004214   000022 772000                    QRL     18
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:179  
         1 004215   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 004216   200052 236100                    LDQ     KL_STRTU+1,,AUTO
         1 004217   000023 772000                    QRL     19
         1 004220   177400 376007                    ANQ     65280,DL
         1 004221   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 004222   000001 036007                    ADLQ    1,DL
         1 004223   200130 036100                    ADLQ    UCLDCT$+2,,AUTO
         1 004224   000022 736000                    QLS     18
         1 004225   200052 676100                    ERQ     KL_STRTU+1,,AUTO
         1 004226   000377 376003                    ANQ     255,DU
         1 004227   200052 656100                    ERSQ    KL_STRTU+1,,AUTO

     1229    17659    2             NK$LDCT.LDCTX-KL_STRTU.NETADR_FROM.LDX.BYT(0)*256;
     1230    17660    2        KL_STRTU.ACCT=B$JIT.ACCN;

  17660  1 004230   040100 100500                    MLR     fill='040'O
         1 004231   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         1 004232   200056 400010                    ADSC9   KL_STRTU+5,,AUTO         cn=2,n=8

     1231    17661    2        KL_STRTU.UNAME=B$JIT.UNAME;

  17661  1 004233   040100 100500                    MLR     fill='040'O
         1 004234   100003 000014                    ADSC9   3,,PR1                   cn=0,n=12
         1 004235   200053 400014                    ADSC9   KL_STRTU+2,,AUTO         cn=2,n=12

     1232    17662    2        KL_STRTU.MODE=MODE;

  17662  1 004236   200045 475500                    LDP5    @MODE,,AUTO
         1 004237   500000 236100                    LDQ     0,,PR5
         1 004240   000011 736000                    QLS     9
         1 004241   200062 552110                    STBQ    AFD+2,'10'O,AUTO

     1233    17663    2        NK$LDCT.DCBNO=JDCBNO;

  17663  1 004242   200024 236100                    LDQ     JDCBNO,,AUTO
         1 004243   000014 552104                    STBQ    12,'04'O,PR0

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:180  
     1234    17664    3        IF MODE=%G_M_USER# THEN DO;

  17664  1 004244   500000 235100                    LDA     0,,PR5
         1 004245   000001 115007                    CMPA    1,DL
         1 004246   004304 601000 1                  TNZ     s:17675

     1235    17665    3             F$DCB.DDEV=ADDR(SOURCEDCB)->F$DCB.DDEV;

  17665  1 004247   200017 476500                    LDP6    JDCB$,,AUTO
         1 004250   200050 477500                    LDP7    @SOURCEDCB,,AUTO
         1 004251   700004 236100                    LDQ     4,,PR7
         1 004252   600004 552110                    STBQ    4,'10'O,PR6

     1236    17666    3             F$DCB.ATTR=ADDR(SOURCEDCB)->F$DCB.ATTR;

  17666  1 004253   700040 720100                    LXL0    32,,PR7
         1 004254   600040 440100                    SXL0    32,,PR6

     1237    17667    3             NK$LDCT.DEVNM='*TSFPRG*';

  17667  1 004255   040100 100400                    MLR     fill='040'O
         1 004256   000135 000010 0                  ADSC9   NETMNGR+39               cn=0,n=8
         1 004257   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8

     1238    17668    3             UCLDCT$=NK$LDCT$(ADDR(SOURCEDCB)->F$DCB.SETX);

  17668  1 004260   700051 720100                    LXL0    41,,PR7
         1 004261   000000 470400 xsym               LDP0    N$DCT$$
         1 004262   000000 236110                    LDQ     0,X0,PR0
         1 004263   200126 756100                    STQ     UCLDCT$,,AUTO

     1239    17669    3             NK$LDCT.TERMID.TTYP=UCLDCT$->NK$LDCT.TERMID.TTYP;

  17669  1 004264   200126 470500                    LDP0    UCLDCT$,,AUTO
         1 004265   200020 471500                    LDP1    LDCT$,,AUTO
         1 004266   000022 236100                    LDQ     18,,PR0
         1 004267   100022 552120                    STBQ    18,'20'O,PR1
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:181  

     1240    17670    3             NK$LDCT.DFLG.INPUT=UCLDCT$->NK$LDCT.DFLG.INPUT;

  17670  1 004270   000006 236100                    LDQ     6,,PR0
         1 004271   100006 676100                    ERQ     6,,PR1
         1 004272   400000 376007                    ANQ     -131072,DL
         1 004273   100006 656100                    ERSQ    6,,PR1

     1241    17671    3             NK$LDCT.DFLG.OUTPUT=UCLDCT$->NK$LDCT.DFLG.OUTPUT;

  17671  1 004274   000006 236100                    LDQ     6,,PR0
         1 004275   100006 676100                    ERQ     6,,PR1
         1 004276   200000 376007                    ANQ     65536,DL
         1 004277   100006 656100                    ERSQ    6,,PR1

     1242    17672    3             KL_STRTU.NETADR_TO=UCLDCT$->NK$LDCT.RLCID;

  17672  1 004300   000100 100500                    MLR     fill='000'O
         1 004301   000015 000004                    ADSC9   13,,PR0                  cn=0,n=4
         1 004302   200052 400004                    ADSC9   KL_STRTU+1,,AUTO         cn=2,n=4

     1243    17673    3           END;

  17673  1 004303   004321 710000 1                  TRA     s:17682

     1244    17674    2        ELSE
     1245    17675    2             IF MODE=%G_M_GHOST#

  17675  1 004304   000004 115007                    CMPA    4,DL
         1 004305   004312 601000 1                  TNZ     s:17679

     1246    17676    2             THEN
     1247    17677    2                  NK$LDCT.DEVNM = '*GHFPRG*';

  17677  1 004306   040100 100400                    MLR     fill='040'O
         1 004307   000137 000010 0                  ADSC9   NETMNGR+41               cn=0,n=8
         1 004310   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:182  
         1 004311   004321 710000 1                  TRA     s:17682

     1248    17678    3             ELSE DO;

     1249    17679    3                  NK$LDCT.DEVNM='*HNDLR*';

  17679  1 004312   040100 100400                    MLR     fill='040'O
         1 004313   000141 000007 0                  ADSC9   NETMNGR+43               cn=0,n=7
         1 004314   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8

     1250    17680    3                  KL_STRTU.UNAME = F$DCB.NAME.C;

  17680  1 004315   200017 476500                    LDP6    JDCB$,,AUTO
         1 004316   040100 100500                    MLR     fill='040'O
         1 004317   600010 200014                    ADSC9   8,,PR6                   cn=1,n=12
         1 004320   200053 400014                    ADSC9   KL_STRTU+2,,AUTO         cn=2,n=12

     1251    17681    3                END;

     1252    17682    2        CALL KUB$WRITE(KL_STRTU,SIZEC(KL_STRTU),NETMNGR);

  17682  1 004321   000036 236000 2                  LDQ     30
         1 004322   200132 756100                    STQ     UCLDCT$+4,,AUTO
         1 004323   000037 236000 2                  LDQ     31
         1 004324   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 004325   200051 630500                    EPPR0   KL_STRTU,,AUTO
         1 004326   200130 450500                    STP0    UCLDCT$+2,,AUTO
         1 004327   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004330   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004331   000000 701000 xent               TSX1    KUB$WRITE
         1 004332   000000 011000                    NOP     0

     1253    17683             %LOCK (G=NK$LDCT.LOCK);

  17684  1 004333   200020 236100                    LDQ     LDCT$,,AUTO
         1 004334   000020 036003                    ADLQ    16,DU
         1 004335   200130 756100                    STQ     UCLDCT$+2,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:183  
         1 004336   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004337   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004340   000000 701000 xent               TSX1    HFC$LOCK
         1 004341   000000 011000                    NOP     0

     1254    17686    2        NK$LDCT.LKFLG.REGGED = '1'B;

  17686  1 004342   200020 470500                    LDP0    LDCT$,,AUTO
         1 004343   100000 236003                    LDQ     32768,DU
         1 004344   000011 256100                    ORSQ    9,,PR0

     1255    17687        /* SS will unlock NK$LDCT.LOCK */
     1256    17688    2        CALL SSR$REG(%SS_CW,JIT$);

  17688  1 004345   200030 631500                    EPPR1   JIT$,,AUTO
         1 004346   200131 451500                    STP1    UCLDCT$+3,,AUTO
         1 004347   000031 236000 2                  LDQ     25
         1 004350   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 004351   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004352   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004353   000000 701000 xent               TSX1    SSR$REG
         1 004354   000000 011000                    NOP     0

     1257    17689    3        IF NK$LDCT.RLCID.LDCTX=0 THEN DO;  /* Path failed to be set up           */

  17689  1 004355   200020 470500                    LDP0    LDCT$,,AUTO
         1 004356   000015 720100                    LXL0    13,,PR0
         1 004357   004373 601000 1                  TNZ     s:17694

     1258    17690    3             B$JIT.ERR=NK$LDCT.ERR;

  17690  1 004360   000000 236100                    LDQ     0,,PR0
         1 004361   000000 471400 xsym               LDP1    B$JIT$
         1 004362   100012 756100                    STQ     10,,PR1

     1259    17691    3             CALL NKL$RELDCT(JIT$);

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:184  
  17691  1 004363   200030 633500                    EPPR3   JIT$,,AUTO
         1 004364   200130 453500                    STP3    UCLDCT$+2,,AUTO
         1 004365   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004366   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004367   000000 701000 xent               TSX1    NKL$RELDCT
         1 004370   000000 011000                    NOP     0

     1260    17692    3             ALTRETURN;

  17692  1 004371   200044 221300                    LDX1  ! DDCB$+1,,AUTO
         1 004372   000000 702211                    TSX2  ! 0,X1

     1261    17693    3           END;
     1262    17694    2        NK$LDCT.ERR = ERR_NOFPRG;

  17694  1 004373   000043 236000 0                  LDQ     ERR_NOFPRG
         1 004374   000000 756100                    STQ     0,,PR0

     1263    17695             /*E* ERROR: FSN-E$NOFPRG-0
     1264    17696                  MESSAGE: No FPRG is currently running.
     1265    17697                  MESSAGE1: After an open with ORG=FPRG a run unit must be down-loaded.
     1266    17698                   */
     1267    17699    2        F$DCB.SYSID = (NK$LDCT.SYSID+MOD(NK$LDCT.SYSID,512))/2;

  17699  1 004375   000011 236100                    LDQ     9,,PR0
         1 004376   777777 376007                    ANQ     -1,DL
         1 004377   000777 376007                    ANQ     511,DL
         1 004400   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 004401   000011 236100                    LDQ     9,,PR0
         1 004402   777777 376007                    ANQ     -1,DL
         1 004403   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 004404   200130 236100                    LDQ     UCLDCT$+2,,AUTO
         1 004405   200131 036100                    ADLQ    UCLDCT$+3,,AUTO
         1 004406   000001 772000                    QRL     1
         1 004407   000000 620006                    EAX0    0,QL
         1 004410   200017 471500                    LDP1    JDCB$,,AUTO
         1 004411   100034 740100                    STX0    28,,PR1
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:185  

     1268    17700    2        F$DCB.LDCTX=NK$LDCT.LDCTX;

  17700  1 004412   000006 221100                    LDX1    6,,PR0
         1 004413   100051 741100                    STX1    41,,PR1

     1269    17701    2        F$DCB.STR = KIDM_CP;

  17701  1 004414   000001 236007                    LDQ     1,DL
         1 004415   100077 552104                    STBQ    63,'04'O,PR1

     1270    17702    2        F$DCB.IASN = %FPRGIASN#;

  17702  1 004416   000010 236007                    LDQ     8,DL
         1 004417   100103 552104                    STBQ    67,'04'O,PR1

     1271    17703    2        F$DCB.IFMT=%FMTFPRG#;

  17703  1 004420   023000 236003                    LDQ     9728,DU
         1 004421   100103 552140                    STBQ    67,'40'O,PR1

     1272    17704    2        F$DCB.CFU$ = ADDR(NIL);

  17704  1 004422   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004423   100066 756100                    STQ     54,,PR1

     1273    17705    2        F$DCB.MEDIA = FMTUC#;

  17705  1 004424   000014 236003                    LDQ     12,DU
         1 004425   100103 552120                    STBQ    67,'20'O,PR1

     1274    17706    2        IF ADDR(SOURCEDCB)~=ADDR(F$DCB)

  17706  1 004426   200050 236100                    LDQ     @SOURCEDCB,,AUTO
         1 004427   200017 116100                    CMPQ    JDCB$,,AUTO
         1 004430   004433 600000 1                  TZE     s:17708

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:186  
     1275    17707    2        THEN F$DCB.SETX = 0;

  17707  1 004431   000000 222003                    LDX2    0,DU
         1 004432   100051 442100                    SXL2    41,,PR1

     1276    17708    2        RETURN;

  17708  1 004433   200044 221300                    LDX1  ! DDCB$+1,,AUTO
         1 004434   000001 702211                    TSX2  ! 1,X1

     1277    17709    2   END FPRG;
     1278    17710        %EJECT;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:187  
     1279    17711    1   DBGFPRG: PROC ALTRET;

  17711  1 004435   200042 741300       DBGFPRG      STX1  ! ORG+2,,AUTO

     1280    17712        /*D* NAME:        DBGFPRG
     1281    17713             PURPOSE:     To establish a debugging path to an existing FPRG user
     1282    17714             CALL:        CALL DBGFPRG ALTRET(LBL);
     1283    17715             DESCRIPTION: DBGFPRG uses F$DCB.ORG along with NAME, ACCT, PSN,
     1284    17716                          SETSTA, DBGDCBNO and DBGSYSID to fill in a KL_AFD
     1285    17717                          (Associate Front-end Debugger) message and sends it
     1286    17718                          off to the Network Manager who will forward it to
     1287    17719                          the appropriate node who will cause the designated
     1288    17720                          FPRG user to have a debugger associated. The message
     1289    17721                          contains the node number and sysid of the user to
     1290    17722                          debug as well as identification of a 'dangling' LDCT
     1291    17723                          to which the front-end debugger is to connect.
     1292    17724                          The user is REGged after sending the KL_AFD message
     1293    17725                          and will be RUEed by either the FPRG-user's node
     1294    17726                          crashing, a connect or an error reported from
     1295    17727                          several places down the line.
     1296    17728
     1297    17729                          If all is well and the connection is completed (or
     1298    17730                          no connection was attempted due to this being a
     1299    17731                          TEST open), DBGFPRG will RETURN. If all is not well,
     1300    17732                          including a non-debugger attempting this open or
     1301    17733                          no such destination or no LDCTs available, this
     1302    17734                          procedure will ALTRETURN.  */
     1303    17735
     1304    17736    2   DCL DDCB$ PTR;
     1305    17737        %KC$CGID(FPTN=CGID,STCLASS=AUTO);
     1306    17763        %KL_AFD(FPTN=AFD,STCLASS=AUTO);
     1307    17803
     1308    17804    2        CALL FMO$GETDOMAIN(I);

  17804  1 004436   200021 630500                    EPPR0   I,,AUTO
         1 004437   200130 450500                    STP0    UCLDCT$+2,,AUTO
         1 004440   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:188  
         1 004441   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004442   000000 701000 xent               TSX1    FMO$GETDOMAIN
         1 004443   000000 011000                    NOP     0

     1309    17805    3        IF I~=%DBWSR THEN DO;

  17805  1 004444   200021 235100                    LDA     I,,AUTO
         1 004445   000005 115007                    CMPA    5,DL
         1 004446   004454 600000 1                  TZE     s:17811

     1310    17806    3             B$JIT.ERR=ERR_NOTDBG;

  17806  1 004447   000037 236000 0                  LDQ     ERR_NOTDBG
         1 004450   000000 470400 xsym               LDP0    B$JIT$
         1 004451   000012 756100                    STQ     10,,PR0

     1311    17807        /*E* ERROR: FSN-E$NOTDBG-2
     1312    17808           MESSAGE: Only a debugger may open with ORG=DBGxxx */
     1313    17809    3             ALTRETURN;

  17809  1 004452   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 004453   000000 702211                    TSX2  ! 0,X1

     1314    17810    3           END;
     1315    17811    2        AFD='0'B;

  17811  1 004454   000100 100400                    MLR     fill='000'O
         1 004455   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 004456   200060 000020                    ADSC9   AFD,,AUTO                cn=0,n=16

     1316    17812    2        AFD.FCN=IGA_AFD;

  17812  1 004457   113000 236003                    LDQ     38400,DU
         1 004460   200060 552140                    STBQ    AFD,'40'O,AUTO

     1317    17813    3   ORGS: DO CASE(F$DCB.ORG);

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:189  
  17813  1 004461   200017 470500       ORGS         LDP0    JDCB$,,AUTO
         1 004462   000032 236100                    LDQ     26,,PR0
         1 004463   000033 772000                    QRL     27
         1 004464   000024 136007                    SBLQ    20,DL
         1 004465   000003 116007                    CMPQ    3,DL
         1 004466   004470 602006 1                  TNC     ORGS+7,QL
         1 004467   004641 710000 1                  TRA     s:17859
         1 004470   004515 710000 1                  TRA     s:17818
         1 004471   004605 710000 1                  TRA     s:17849
         1 004472   004473 710000 1                  TRA     s:17815

     1318    17814    3        CASE(%DBGSYSID#);

     1319    17815    3           AFD.NODE=FEX;    /* FEnn or FE@nodename has been converted by caller */

  17815  1 004473   200026 236100                    LDQ     FEX,,AUTO
         1 004474   000022 736000                    QLS     18
         1 004475   200060 552120                    STBQ    AFD,'20'O,AUTO

     1320    17816    3           CALL KIA$9TO8(PN$.V_->FPT$OPEN_V.DBGSYSID,AFD.SYSID,2);

  17816  1 004476   200003 471500                    LDP1    @PN$,,AUTO
         1 004477   100000 473500                    LDP3    0,,PR1
         1 004500   000040 236000 2                  LDQ     32
         1 004501   200132 756100                    STQ     UCLDCT$+4,,AUTO
         1 004502   200133 452500                    STP2    UCLDCT$+5,,AUTO
         1 004503   200133 236100                    LDQ     UCLDCT$+5,,AUTO
         1 004504   000041 036000 2                  ADLQ    33
         1 004505   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 004506   300022 634500                    EPPR4   18,,PR3
         1 004507   200130 454500                    STP4    UCLDCT$+2,,AUTO
         1 004510   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004511   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004512   000000 701000 xent               TSX1    KIA$9TO8
         1 004513   000000 011000                    NOP     0
         1 004514   004641 710000 1                  TRA     s:17859

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:190  
     1321    17817    3        CASE(%DBGDCB#);

     1322    17818    3           DDCB$=DCBADDR(PN$.V_->FPT$OPEN_V.DBGDCBNO);

  17818  1 004515   200003 471500                    LDP1    @PN$,,AUTO
         1 004516   100000 473500                    LDP3    0,,PR1
         1 004517   000032 474400 2                  LDP4    26
         1 004520   400000 475500                    LDP5    0,,PR4
         1 004521   300022 220100                    LDX0    18,,PR3
         1 004522   500000 236110                    LDQ     0,X0,PR5
         1 004523   200043 756100                    STQ     DDCB$,,AUTO

     1323    17819    3           IF DDCB$~=ADDR(NIL)

  17819  1 004524   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004525   004576 600000 1                  TZE     s:17838
         1 004526   200043 476500                    LDP6    DDCB$,,AUTO
         1 004527   600031 236100                    LDQ     25,,PR6
         1 004530   020000 316007                    CANQ    8192,DL
         1 004531   004576 600000 1                  TZE     s:17838

     1324    17820    3                AND DDCB$->F$DCB.FCD='1'B
     1325    17821    4           THEN DO;

     1326    17822    4                LDCT$=NK$LDCT$(DDCB$->F$DCB.LDCTX);

  17822  1 004532   600051 221100                    LDX1    41,,PR6
         1 004533   000000 477400 xsym               LDP7    N$DCT$$
         1 004534   700000 236111                    LDQ     0,X1,PR7
         1 004535   200020 756100                    STQ     LDCT$,,AUTO

  17822  1 004536                       GOTLDCT      null
     1327    17823    4   GOTLDCT:     ;
     1328    17824    5                IF LDCT$~=ADDR(NIL) THEN DO;

  17824  1 004536   200020 236100                    LDQ     LDCT$,,AUTO
         1 004537   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:191  
         1 004540   004576 600000 1                  TZE     s:17838

     1329    17825                          %LOCK(G=NK$LDCT.LOCK);

  17826  1 004541   000020 036003                    ADLQ    16,DU
         1 004542   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 004543   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004544   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004545   000000 701000 xent               TSX1    HFC$LOCK
         1 004546   000000 011000                    NOP     0

     1330    17828    5                     IF NK$LDCT.RESCOD=NK_TSFPRG OR NK$LDCT.RESCOD=NK_CGFPRG

  17828  1 004547   200020 470500                    LDP0    LDCT$,,AUTO
         1 004550   000006 236100                    LDQ     6,,PR0
         1 004551   000017 376007                    ANQ     15,DL
         1 004552   000010 116007                    CMPQ    8,DL
         1 004553   004556 600000 1                  TZE     s:17830
         1 004554   000011 116007                    CMPQ    9,DL
         1 004555   004567 601000 1                  TNZ     s:17834

     1331    17829    6                     THEN DO;

     1332    17830    6                          AFD.SYSID=BINBIT(NK$LDCT.SYSID,18);

  17830  1 004556   000011 236100                    LDQ     9,,PR0
         1 004557   777777 376007                    ANQ     -1,DL
         1 004560   000022 736000                    QLS     18
         1 004561   000022 772000                    QRL     18
         1 004562   000000 620006                    EAX0    0,QL
         1 004563   200061 440100                    SXL0    AFD+1,,AUTO

     1333    17831    6                          AFD.NODE=NK$LDCT.RLCID.NODE;

  17831  1 004564   000015 236100                    LDQ     13,,PR0
         1 004565   000011 772000                    QRL     9
         1 004566   200060 552120                    STBQ    AFD,'20'O,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:192  

     1334    17832    6                        END;

     1335    17833                          %UNLOCK(G=NK$LDCT.LOCK);

  17834  1 004567   200020 236100                    LDQ     LDCT$,,AUTO
         1 004570   000020 036003                    ADLQ    16,DU
         1 004571   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 004572   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004573   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004574   000000 701000 xent               TSX1    HFC$UNLOCK
         1 004575   000000 011000                    NOP     0

     1336    17836    5                   END;

     1337    17837    4              END;

     1338    17838    3           IF AFD.SYSID THEN EXIT;

  17838  1 004576   200061 720100                    LXL0    AFD+1,,AUTO
         1 004577   004641 601000 1                  TNZ     s:17859

     1339    17839    3           B$JIT.ERR=ERR_INVDBG;

  17839  1 004600   000040 236000 0                  LDQ     ERR_INVDBG
         1 004601   000000 470400 xsym               LDP0    B$JIT$
         1 004602   000012 756100                    STQ     10,,PR0

     1340    17840        /*E* ERROR: FSN-E$INVDBG-2
     1341    17841           MESSAGE: Invalid debug destination specified
     1342    17842          MESSAGE1: Something is wrong with your debug destination. possibilities include:
     1343    17843                       o That DCB is not open
     1344    17844                       o That DCB is not an FPRG DCB
     1345    17845                       o That station is not an FPRG station
     1346    17846        */
     1347    17847    3           ALTRETURN;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:193  
  17847  1 004603   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 004604   000000 702211                    TSX2  ! 0,X1

     1348    17848    3        CASE(%DBGCG#);

     1349    17849    3           CGID.NAME#=F$DCB.NAME;

  17849  1 004605   000100 100500                    MLR     fill='000'O
         1 004606   000010 000040                    ADSC9   8,,PR0                   cn=0,n=32
         1 004607   200050 000040                    ADSC9   @SOURCEDCB,,AUTO         cn=0,n=32

     1350    17850    3           CGID.ACCT#=F$DCB.ACCT;

  17850  1 004610   000020 237100                    LDAQ    16,,PR0
         1 004611   200044 757100                    STAQ    CGID,,AUTO

     1351    17851    3           CGID.PSN#=F$DCB.PSN;

  17851  1 004612   040100 100500                    MLR     fill='040'O
         1 004613   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         1 004614   200046 000006                    ADSC9   @FEX,,AUTO               cn=0,n=6

     1352    17852    3           I=8;

  17852  1 004615   000010 235007                    LDA     8,DL
         1 004616   200021 755100                    STA     I,,AUTO

     1353    17853    3           LDCT$=ADDR(NIL);

  17853  1 004617   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004620   200020 756100                    STQ     LDCT$,,AUTO

     1354    17854    3           CALL KCO$FINDSTA(JIT$,CGID,PN$.SETSTA_->VLP$SETSTA.MYSTATION#,I)

  17854  1 004621   200003 471500                    LDP1    @PN$,,AUTO
         1 004622   100002 473500                    LDP3    2,,PR1
         1 004623   200021 634500                    EPPR4   I,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:194  
         1 004624   200133 454500                    STP4    UCLDCT$+5,,AUTO
         1 004625   200132 453500                    STP3    UCLDCT$+4,,AUTO
         1 004626   200044 635500                    EPPR5   CGID,,AUTO
         1 004627   200131 455500                    STP5    UCLDCT$+3,,AUTO
         1 004630   200030 636500                    EPPR6   JIT$,,AUTO
         1 004631   200130 456500                    STP6    UCLDCT$+2,,AUTO
         1 004632   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004633   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 004634   000000 701000 xent               TSX1    KCO$FINDSTA
         1 004635   004536 702000 1                  TSX2    GOTLDCT

     1355    17855    3                ALTRET (GOTLDCT);
     1356    17856    3           LDCT$=JIT$;

  17856  1 004636   200030 236100                    LDQ     JIT$,,AUTO
         1 004637   200020 756100                    STQ     LDCT$,,AUTO

     1357    17857    3           GOTO GOTLDCT;

  17857  1 004640   004536 710000 1                  TRA     GOTLDCT

     1358    17858    3        END;                               /*CASE*/

     1359    17859    2        IF PN$.V_->FPT$OPEN_V.OPER.TEST THEN RETURN;

  17859  1 004641   200003 470500                    LDP0    @PN$,,AUTO
         1 004642   000000 471500                    LDP1    0,,PR0
         1 004643   100000 236100                    LDQ     0,,PR1
         1 004644   020000 316007                    CANQ    8192,DL
         1 004645   004650 600000 1                  TZE     s:17860

  17859  1 004646   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 004647   000001 702211                    TSX2  ! 1,X1

     1360    17860    3        CALL NKL$GETDCT(JIT$) WHENALTRETURN DO;

  17860  1 004650   200030 633500                    EPPR3   JIT$,,AUTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:195  
         1 004651   200130 453500                    STP3    UCLDCT$+2,,AUTO
         1 004652   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 004653   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004654   000000 701000 xent               TSX1    NKL$GETDCT
         1 004655   004657 702000 1                  TSX2    s:17861
         1 004656   004664 710000 1                  TRA     s:17864

     1361    17861    3             B$JIT.ERR=ERR_PCNLDCT;

  17861  1 004657   000034 236000 0                  LDQ     ERR_PCNLDCT
         1 004660   000000 470400 xsym               LDP0    B$JIT$
         1 004661   000012 756100                    STQ     10,,PR0

     1362    17862    3             ALTRETURN;

  17862  1 004662   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 004663   000000 702211                    TSX2  ! 0,X1

     1363    17863    3           END;
     1364    17864    2        LDCT$=JIT$;

  17864  1 004664   200030 236100                    LDQ     JIT$,,AUTO
         1 004665   200020 756100                    STQ     LDCT$,,AUTO

     1365    17865    2        F$DCB.LDCTX=NK$LDCT.LDCTX;

  17865  1 004666   200020 470500                    LDP0    LDCT$,,AUTO
         1 004667   000006 220100                    LDX0    6,,PR0
         1 004670   200017 471500                    LDP1    JDCB$,,AUTO
         1 004671   100051 740100                    STX0    41,,PR1

     1366    17866    2        F$DCB.STR=KIDM_DB;

  17866  1 004672   000003 236007                    LDQ     3,DL
         1 004673   100077 552104                    STBQ    63,'04'O,PR1

     1367    17867    2        F$DCB.IFMT=%FMTFPRG#;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:196  

  17867  1 004674   023000 236003                    LDQ     9728,DU
         1 004675   100103 552140                    STBQ    67,'40'O,PR1

     1368    17868    2        F$DCB.MEDIA=FMTUC#;

  17868  1 004676   000014 236003                    LDQ     12,DU
         1 004677   100103 552120                    STBQ    67,'20'O,PR1

     1369    17869    2        F$DCB.IASN = %FPRGIASN#;

  17869  1 004700   000010 236007                    LDQ     8,DL
         1 004701   100103 552104                    STBQ    67,'04'O,PR1

     1370    17870    2        NK$LDCT.RESCOD=NK_TSTRM;

  17870  1 004702   000006 236100                    LDQ     6,,PR0
         1 004703   000017 376000 2                  ANQ     15
         1 004704   000001 276007                    ORQ     1,DL
         1 004705   000006 756100                    STQ     6,,PR0

     1371    17871    2        NK$LDCT.DFLG.INPUT='1'B;

  17871  1 004706   400000 236007                    LDQ     -131072,DL
         1 004707   000006 256100                    ORSQ    6,,PR0

     1372    17872    2        NK$LDCT.DFLG.OUTPUT='1'B;

  17872  1 004710   200000 236007                    LDQ     65536,DL
         1 004711   000006 256100                    ORSQ    6,,PR0

     1373    17873    2        NK$LDCT.DFLG.CM='1'B;

  17873  1 004712   100000 236007                    LDQ     32768,DL
         1 004713   000006 256100                    ORSQ    6,,PR0

     1374    17874    2        NK$LDCT.USER=B$JIT.USER;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:197  

  17874  1 004714   000000 473400 xsym               LDP3    B$JIT$
         1 004715   300000 236100                    LDQ     0,,PR3
         1 004716   000007 552120                    STBQ    7,'20'O,PR0

     1375    17875    2        NK$LDCT.RLCID.NODE=AFD.NODE;

  17875  1 004717   200060 236100                    LDQ     AFD,,AUTO
         1 004720   000011 736000                    QLS     9
         1 004721   000015 552140                    STBQ    13,'40'O,PR0

     1376    17876    2        NK$LDCT.DCBNO=JDCBNO;

  17876  1 004722   200024 236100                    LDQ     JDCBNO,,AUTO
         1 004723   000014 552104                    STBQ    12,'04'O,PR0

     1377    17877    2        NK$LDCT.DEVNM='*DEBUG*';

  17877  1 004724   040100 100400                    MLR     fill='040'O
         1 004725   000143 000007 0                  ADSC9   NETMNGR+45               cn=0,n=7
         1 004726   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8

     1378    17878    2        AFD.NETADR_FROM.NODE=K_NODE#;

  17878  1 004727   000000 236000 xsym               LDQ     K_NODE#
         1 004730   000011 736000                    QLS     9
         1 004731   200060 552110                    STBQ    AFD,'10'O,AUTO

     1379    17879    2        AFD.NETADR_FROM.GENERATION=NK$LDCT.GENERATION;

  17879  1 004732   000014 236100                    LDQ     12,,PR0
         1 004733   000377 376003                    ANQ     255,DU
         1 004734   000022 772000                    QRL     18
         1 004735   200060 552104                    STBQ    AFD,'04'O,AUTO

     1380    17880    2        AFD.NETADR_FROM.LDX.BYT(0)=NK$LDCT.LDCTX/256;

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:198  
  17880  1 004736   000006 236100                    LDQ     6,,PR0
         1 004737   000022 772000                    QRL     18
         1 004740   000010 772000                    QRL     8
         1 004741   000033 736000                    QLS     27
         1 004742   200061 676100                    ERQ     AFD+1,,AUTO
         1 004743   377000 376003                    ANQ     130560,DU
         1 004744   200061 656100                    ERSQ    AFD+1,,AUTO

     1381    17881    2        AFD.NETADR_FROM.LDX.BYT(1)=

  17881  1 004745   000006 236100                    LDQ     6,,PR0
         1 004746   000022 772000                    QRL     18
         1 004747   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 004750   200061 236100                    LDQ     AFD+1,,AUTO
         1 004751   000023 772000                    QRL     19
         1 004752   177400 376007                    ANQ     65280,DL
         1 004753   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 004754   000001 036007                    ADLQ    1,DL
         1 004755   200130 036100                    ADLQ    UCLDCT$+2,,AUTO
         1 004756   000022 736000                    QLS     18
         1 004757   200061 676100                    ERQ     AFD+1,,AUTO
         1 004760   000377 376003                    ANQ     255,DU
         1 004761   200061 656100                    ERSQ    AFD+1,,AUTO

     1382    17882    2             NK$LDCT.LDCTX- AFD.NETADR_FROM.LDX.BYT(0)*256;
     1383    17883    2        IF B$JIT.PRIV.ACTIVE & %(PR_FMREAD# | PR_FMSEC#)

  17883  1 004762   300013 236100                    LDQ     11,,PR3
         1 004763   000145 376000 0                  ANQ     NETMNGR+47
         1 004764   004771 600000 1                  TZE     s:17885

     1384    17884    2        THEN AFD.ACCT=' ';                 /* Indicates privileged */

  17884  1 004765   000035 235000 xsym               LDA     B_VECTNIL+29
         1 004766   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 004767   200062 757100                    STAQ    AFD+2,,AUTO
         1 004770   004774 710000 1                  TRA     s:17886
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:199  

     1385    17885    2        ELSE AFD.ACCT=B$JIT.ACCN;

  17885  1 004771   040100 100500                    MLR     fill='040'O
         1 004772   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
         1 004773   200062 000010                    ADSC9   AFD+2,,AUTO              cn=0,n=8

     1386    17886    2        CALL KUB$WRITE(AFD,SIZEC(AFD),'HLPADMIN');

  17886  1 004774   000043 236000 2                  LDQ     35
         1 004775   200132 756100                    STQ     UCLDCT$+4,,AUTO
         1 004776   000044 236000 2                  LDQ     36
         1 004777   200131 756100                    STQ     UCLDCT$+3,,AUTO
         1 005000   200060 634500                    EPPR4   AFD,,AUTO
         1 005001   200130 454500                    STP4    UCLDCT$+2,,AUTO
         1 005002   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 005003   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 005004   000000 701000 xent               TSX1    KUB$WRITE
         1 005005   000000 011000                    NOP     0

     1387    17887             %LOCK(G=NK$LDCT.LOCK);

  17888  1 005006   200020 236100                    LDQ     LDCT$,,AUTO
         1 005007   000020 036003                    ADLQ    16,DU
         1 005010   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 005011   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 005012   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005013   000000 701000 xent               TSX1    HFC$LOCK
         1 005014   000000 011000                    NOP     0

     1388    17890    2        NK$LDCT.LKFLG.REGGED='1'B;

  17890  1 005015   200020 470500                    LDP0    LDCT$,,AUTO
         1 005016   100000 236003                    LDQ     32768,DU
         1 005017   000011 256100                    ORSQ    9,,PR0

     1389    17891        /* SS will unlock NK$LDCT.LOCK */
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:200  
     1390    17892    2        CALL SSR$REG(%SS_CW,JIT$);

  17892  1 005020   200030 631500                    EPPR1   JIT$,,AUTO
         1 005021   200131 451500                    STP1    UCLDCT$+3,,AUTO
         1 005022   000031 236000 2                  LDQ     25
         1 005023   200130 756100                    STQ     UCLDCT$+2,,AUTO
         1 005024   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 005025   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005026   000000 701000 xent               TSX1    SSR$REG
         1 005027   000000 011000                    NOP     0

     1391    17893    3        IF NK$LDCT.RLCID.LDCTX=0 THEN DO;  /* Path failed to be set up */

  17893  1 005030   200020 470500                    LDP0    LDCT$,,AUTO
         1 005031   000015 720100                    LXL0    13,,PR0
         1 005032   005046 601000 1                  TNZ     s:17898

     1392    17894    3             B$JIT.ERR=NK$LDCT.ERR;

  17894  1 005033   000000 236100                    LDQ     0,,PR0
         1 005034   000000 471400 xsym               LDP1    B$JIT$
         1 005035   100012 756100                    STQ     10,,PR1

     1393    17895    3             CALL NKL$RELDCT(JIT$);

  17895  1 005036   200030 633500                    EPPR3   JIT$,,AUTO
         1 005037   200130 453500                    STP3    UCLDCT$+2,,AUTO
         1 005040   200130 630500                    EPPR0   UCLDCT$+2,,AUTO
         1 005041   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005042   000000 701000 xent               TSX1    NKL$RELDCT
         1 005043   000000 011000                    NOP     0

     1394    17896    3             ALTRETURN;

  17896  1 005044   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 005045   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:201  
     1395    17897    3           END;
     1396    17898    2        NK$LDCT.ERR = ERR_NOFPRG;

  17898  1 005046   000043 236000 0                  LDQ     ERR_NOFPRG
         1 005047   000000 756100                    STQ     0,,PR0

     1397    17899    2        RETURN;

  17899  1 005050   200042 221300                    LDX1  ! ORG+2,,AUTO
         1 005051   000001 702211                    TSX2  ! 1,X1

VLP_SETSTA
 Sect OctLoc
   0     000   040040 040040   040040 040040   040040 040040   040040 040040
   0     004   040040 040040   040040 040040   000000 000000   040040 040040            ....
   0     010   040040 040040   040040 040040   040040 040040   000000 000000                ....

VLP_STATION
 Sect OctLoc
   0     014   040040 040040   040040 040040   040040 040040   040040 040040
   0     020   001000 000000   000000 000000   000000 000000   000000 000000    ................

ZEROES
 Sect OctLoc
   0     024   000000 000000   000000 000000                                    ........

CONV_STR
 Sect OctLoc
   0     026   040040 040040   125103 071070   125103 060061   125103 071071        UC98UC01UC99

ERR_ILLIN
 Sect OctLoc
   0     032   062316 014012                                                    2...

ERR_INVRES
 Sect OctLoc
   0     033   062316 001702                                                    2...
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:202  

ERR_PCNLDCT
 Sect OctLoc
   0     034   062316 022612                                                    2...

ERR_NOSTREAMS
 Sect OctLoc
   0     035   062316 013722                                                    2...

ERR_NOTAUTH
 Sect OctLoc
   0     036   062316 006252                                                    2...

ERR_NOTDBG
 Sect OctLoc
   0     037   062316 002242                                                    2...

ERR_INVDBG
 Sect OctLoc
   0     040   062316 002252                                                    2...

ERR_ORGNOTCOM
 Sect OctLoc
   0     041   062316 014172                                                    2..z

ERR_BADFEP
 Sect OctLoc
   0     042   062316 016722                                                    2...

ERR_NOFPRG
 Sect OctLoc
   0     043   062316 020652                                                    2...

CLSSAVE$
 Sect OctLoc
   0     044   000062 006000   000000 006014   000000 006014   000000 006014    .2..............
   0     050   000000 006014   000000 006014   000000 006014   000000 006014    ................
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:203  
   0     060*  000000 006014   ****** ******   000000 000002   000000 000040    ...............
   0     064   000220 000000   000000 000000                                    ........

NETMNGR
 Sect OctLoc
   0     066   110114 120101   104115 111116                                    HLPADMIN

(unnamed)
 Sect OctLoc
   0     070   125103 040040   106105 040040   116103 040040   117104 040040    UC  FE  NC  OD
   0     074   072123 131115   117040 040040   040040 040040   115105 040103    :SYMO       ME C
   0     100   122040 114120   040114 117040   116117 040103   120040 120117    R LP LO NO CP PO
   0     104   040125 103040   112105 040112   106040 123111   040103 061040     UC JE JF SI C1
   0     110   114061 040120   061040 106105   040107 122040   116103 040040    L1 P1 FE GR NC
   0     114   114120 060061   103120 060061   107122 060061   106124 040115    LP01CP01GR01FT M
   0     120   124040 114124   040104 120040   114120 040103   120040 103122    T LT DP LP CP CR
   0     124   040123 131040   106124 040106   105040 125103   040117 104040     SY FT FE UC OD
   0     130   103114 040040   052103 114122   105123 052040   123131 115117    CL  *CLRES* SYMO
   0     134   700000 000000   052124 123106   120122 107052   052107 110106    ....*TSFPRG**GHF
   0     140   120122 107052   052110 116104   114122 052040   052104 105102    PRG**HNDLR* *DEB
   0     144   125107 052040   120000 000000   110114 120101   104115 111116    UG* P...HLPADMIN

(unnamed)
 Sect OctLoc
   2     000   777777 777677   000024 006000   777777 677777   177777 777777    ................
   2     004   000044 006000   000000 006000   000005 400000   320000 000000    .$..............
   2     010   033040 040040   000003 006000   000007 006000   000010 006000    .   ............
   2     014   000002 006000   000000 000031   000015 006000   777777 777760    ................
   2     020   030000 000000   100040 040040   000006 006000   000000 000000    ....@   ........
   2     024   000020 006000   000021 006000   000040 600000   000030 006000    ......... ......
   2     030   000000 000047   000030 006000   000000 006003   000000 000024    ...'............
   2     034   000033 006000   000000 000264   000066 006000   000035 006000    .........6......
   2     040   000004 006000   000061 400000   000000 000020   000146 006000    .....1.......f..
   2     044   000042 006000                                                    ."..
     1398    17900    2   END DBGFPRG;
     1399    17901    1   END FSN$OPNDEV;
     1400    17902        %EOD;
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:204  

PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:205  
--  Include file information  --

   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   FS_SUPER_C.:E05TOU  is referenced.
   FS$FIT.:E05TOU  is referenced.
   FM$FIT.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FSN$OPNDEV.
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:206  

 **** Variables and constants ****

  ****  Section 000 RoData FSN$OPNDEV

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    44-0-0/d STRC(648)   r     1 CLSSAVE$
    26-0-0/c CHAR(4)     r     1 CONV_STR(0:3)
    42-0-0/b STRC        r     1 ERR_BADFEP                32-0-0/b STRC        r     1 ERR_ILLIN
    40-0-0/b STRC        r     1 ERR_INVDBG                33-0-0/b STRC        r     1 ERR_INVRES
    43-0-0/b STRC        r     1 ERR_NOFPRG                35-0-0/b STRC        r     1 ERR_NOSTREAMS
    36-0-0/b STRC        r     1 ERR_NOTAUTH               37-0-0/b STRC        r     1 ERR_NOTDBG
    41-0-0/b STRC        r     1 ERR_ORGNOTCOM             34-0-0/b STRC        r     1 ERR_PCNLDCT
    66-0-0/d CHAR(8)     r     1 NETMNGR                    0-0-0/w STRC(432)   r     1 VLP_SETSTA
    14-0-0/w STRC(288)   r     1 VLP_STATION               24-0-0/b BIT (72)    r     1 ZEROES

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    46-0-0/w PTR         r     1 @FEX                      45-0-0/w PTR         r     1 @MODE
     3-0-0/w PTR         r     1 @PN$                      50-0-0/w PTR         r     1 @SOURCEDCB
    45-0-0/w PTR         r     1 @STR                      47-0-0/w PTR         r     1 @STR
    60-0-0/w STRC(144)   r     1 AFD                       45-0-0/w STRC(288)   r     1 ASTATION
    31-0-0/w PTR         r     1 BUF$                      44-0-0/w STRC(432)   r     1 CGID
    43-0-0/w PTR         r     1 DDCB$                     16-0-0/w BIT         r     1 ERRCODE
    23-0-0/w SBIN        r     1 F                         26-0-0/w UBIN        r     1 FEX
    *0-0-0/w UBIN        r     1 FEX                       15-0-0/w BIT         r     1 HOST
    21-0-0/w SBIN        r     1 I                         46-0-0/w SBIN        r     1 I
    17-0-0/w PTR         r     1 JDCB$                     24-0-0/w UBIN        r     1 JDCBNO
    30-0-0/w PTR         r     1 JIT$                      51-0-0/w STRC(1620)  r     1 KL_STRTU
    20-0-0/w PTR         r     1 LDCT$                     32-0-0/w STRC(180)   r     1 LDEVUATTR
    *0-0-0/w UBIN        r     1 MODE                      14-0-0/w BIT         r     1 NEWSTREAM
    40-0-0/w UBIN        r     1 ORG                       40-0-0/w STRC        r     1 ORGSTR
    *0-0-0/w STRC(684)   r     1 PN$                       25-0-0/c CHAR(4)     r     1 RES
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:207  
    21-0-0/w STRC        r     1 RLCID                     43-0-0/w PTR         r     1 SDCB$
    *0-0-0/w UBIN        r     1 SOURCEDCB                 27-0-0/w UBIN        r     1 STR
    *0-0-0/w UBIN        r     1 STR                       *0-0-0/w UBIN        r     1 STR
    37-0-0/w SBIN        r     1 TSTFINFO                 126-0-0/w PTR         r     1 UCLDCT$
     4-0-0/d STRC(288)   r     1 WINDOW

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$DO$
     0-0-0/w PTR         r     1 B$M$UC$                    0-0-0/w PTR         r     1 B$ROSEG$
     0-0-0/d STRC(288)   r     1 FS_WINDOW                  0-0-0/w UBIN        r     1 K_NODE#
     0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(3024)  r     1 B$ROSEG
     0-0-0/w STRC        r     1 BPTR                       0-0-0/w STRC(1404)  r     1 CODE16
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/d STRC(756)   r     1 FPT$OPEN_V
     0-0-0/w STRC(3186)  r     1 FS$FORMREC                 0-0-0/w STRC(180)   r     1 KL_WSNHDR
     0-0-0/w STRC(1485)  r     1 LDEVPLUSHDR                0-0-0/w STRC(288)   r     1 LDEVPLUSTAB
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/w STRC(171)   r     1 OSFN                       0-0-0/w STRC(432)   r     1 VLP$SETSTA
     0-0-0/w STRC(288)   r     1 VLP$STATION                0-0-0/d STRC(288)   r     1 VLP$WINDOW


   Procedure FSN$OPNDEV requires 2602 words for executable code.
   Procedure FSN$OPNDEV requires 96 words of local(AUTO) storage.
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:208  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:209  
          MINI XREF LISTING

AFD IN PROCEDURE DBGFPRG
     17776**DCL     17811<<ASSIGN  17886<>CALL    17886--CALL
AFD.ACCT IN PROCEDURE DBGFPRG
     17798**DCL     17884<<ASSIGN  17885<<ASSIGN
AFD.FCN IN PROCEDURE DBGFPRG
     17777**DCL     17812<<ASSIGN
AFD.NETADR_FROM.GENERATION IN PROCEDURE DBGFPRG
     17783**DCL     17879<<ASSIGN
AFD.NETADR_FROM.LDX.BYT IN PROCEDURE DBGFPRG
     17787**DCL     17880<<ASSIGN  17881<<ASSIGN  17881>>ASSIGN
AFD.NETADR_FROM.NODE IN PROCEDURE DBGFPRG
     17782**DCL     17878<<ASSIGN
AFD.NODE IN PROCEDURE DBGFPRG
     17779**DCL     17815<<ASSIGN  17831<<ASSIGN  17875>>ASSIGN
AFD.SYSID IN PROCEDURE DBGFPRG
     17792**DCL     17816<>CALL    17830<<ASSIGN  17838>>IF
ALL_DONE
     17085**LABEL   16729--GOTO    17054--GOTO
ALSOUR IN PROCEDURE OPENLDEV
     17304**LABEL   17293--GOTO    17302--GOTO
ALTRETUR
     17108**LABEL   16673--CALLALT 16676--CALLALT 16692--CALLALT 16699--CALLALT 16705--CALLALT 16720--CALLALT
     16726--CALLALT 16733--CALLALT 16759--CALLALT 16788--CALLALT 16800--CALLALT 16833--GOTO    16837--CALLALT
     17007--CALLALT 17032--GOTO    17067--CALLALT 17071--CALLALT 17080--GOTO
ALTRETUR IN PROCEDURE OPENLDEV
     17147**LABEL   17152--GOTO    17171--CALLALT 17199--CALLALT 17221--CALLALT 17238--GOTO    17251--GOTO
     17282--CALLALT
ARCLLD IN PROCEDURE OPENLDEV
     17141**LABEL   17175--CALLALT 17187--CALLALT
ASTATION IN PROCEDURE CGINIT
     17399**DCL     17425<<ASSIGN  17428<>CALL    17430<<ASSIGN  17433<>CALL
ASTATION.CTL.LOCK IN PROCEDURE CGINIT
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:210  
     17404**DCL     17427<<ASSIGN  17432<<ASSIGN
ASTATION.MSGIDXT IN PROCEDURE CGINIT
     17409**DCL     17412--REDEF
AU_RELEASE
     16974**LABEL   16954--GOTO
B$JIT.ACCN
     15505**DCL     17660>>ASSIGN  17885>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
     15599**DCL     15599--REDEF
B$JIT.DCB$
     15666**DCL     16485>>ASSIGN  16530<<ASSIGN  16532<<ASSIGN  16574<<ASSIGN  16600<<ASSIGN  16619<<ASSIGN
     16823<<ASSIGN  16827<<ASSIGN  16830<>CALL    17059<<ASSIGN  17093<<ASSIGN  17112<<ASSIGN  17189>>ASSIGN
     17190>>ASSIGN  17204<<ASSIGN  17208<<ASSIGN  17216>>ASSIGN  17217>>IF
B$JIT.ERR
     15505**DCL     16525<<ASSIGN  16614<<ASSIGN  16658<<ASSIGN  16771<<ASSIGN  16804<<ASSIGN  16832<<ASSIGN
     16910<<ASSIGN  16945<<ASSIGN  16954>>IF      17013<<ASSIGN  17051<<ASSIGN  17095<<ASSIGN  17101>>ASSIGN
     17103<<ASSIGN  17109<<ASSIGN  17141<<ASSIGN  17155<<ASSIGN  17237<<ASSIGN  17354<<ASSIGN  17361<<ASSIGN
     17367<<ASSIGN  17642<<ASSIGN  17690<<ASSIGN  17806<<ASSIGN  17839<<ASSIGN  17861<<ASSIGN  17894<<ASSIGN
B$JIT.ERR.CODE
     15506**DCL     17100>>IF      17108>>IF      17249>>IF
B$JIT.ERR.MID
     15506**DCL     15506--REDEF
B$JIT.MODE
     15500**DCL     16701>>IF      16727>>IF      17277>>IF      17426>>IF      17431>>IF
B$JIT.NEXTCC
     15647**DCL     16502>>IF      16520>>ASSIGN  16521>>ASSIGN  16522>>ASSIGN  16537>>ASSIGN  16538>>ASSIGN
     16737>>IF      16756>>IF
B$JIT.PRIV.ACTIVE
     15506**DCL     16986>>IF      17883>>IF
B$JIT.PRIV.ACTIVE.MFEP
     15509**DCL     17010>>IF
B$JIT.SYSID
     15505**DCL     16566>>IF      16566>>IF
B$JIT.UNAME
     15505**DCL     17661>>ASSIGN
B$JIT.USER
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:211  
     15505**DCL     16930>>ASSIGN  16934>>IF      16953>>ASSIGN  16959>>ASSIGN  17648>>ASSIGN  17874>>ASSIGN
B$JIT.WOO
     15505**DCL     17189>>ASSIGN
B$JIT$
        39**DCL     15500--IMP-PTR 16485>>ASSIGN  16502>>IF      16520>>ASSIGN  16521>>ASSIGN  16522>>ASSIGN
     16525>>ASSIGN  16530>>ASSIGN  16532>>ASSIGN  16537>>ASSIGN  16538>>ASSIGN  16563>>ASSIGN  16566>>IF
     16566>>IF      16574>>ASSIGN  16600>>ASSIGN  16614>>ASSIGN  16619>>ASSIGN  16658>>ASSIGN  16701>>IF
     16727>>IF      16737>>IF      16756>>IF      16771>>ASSIGN  16804>>ASSIGN  16823>>ASSIGN  16827>>ASSIGN
     16830>>CALL    16832>>ASSIGN  16863<>CALL    16910>>ASSIGN  16930>>ASSIGN  16934>>IF      16945>>ASSIGN
     16953>>ASSIGN  16954>>IF      16959>>ASSIGN  16986>>IF      17010>>IF      17013>>ASSIGN  17051>>ASSIGN
     17059>>ASSIGN  17093>>ASSIGN  17095>>ASSIGN  17100>>IF      17101>>ASSIGN  17103>>ASSIGN  17108>>IF
     17109>>ASSIGN  17112>>ASSIGN  17141>>ASSIGN  17155>>ASSIGN  17175<>CALL    17187<>CALL    17189>>ASSIGN
     17189>>ASSIGN  17190>>ASSIGN  17204>>ASSIGN  17208>>ASSIGN  17216>>ASSIGN  17217>>IF      17237>>ASSIGN
     17249>>IF      17277>>IF      17354>>ASSIGN  17361>>ASSIGN  17367>>ASSIGN  17426>>IF      17431>>IF
     17642>>ASSIGN  17648>>ASSIGN  17660>>ASSIGN  17661>>ASSIGN  17690>>ASSIGN  17806>>ASSIGN  17839>>ASSIGN
     17861>>ASSIGN  17874>>ASSIGN  17883>>IF      17885>>ASSIGN  17894>>ASSIGN
B$M$DO$
        42**DCL     16489>>IF
B$M$UC$
        41**DCL     16501>>IF      16528>>IF      16530>>ASSIGN  16533>>IF      16539>>ASSIGN  16679>>IF
     16742>>ASSIGN  16744>>ASSIGN  16817>>IF      17059>>ASSIGN  17060>>IF      17204>>ASSIGN  17205>>ASSIGN
     17426>>IF      17431>>IF
B$ROSEG.CR01DCB
     16042**DCL     16499>>IF      16523<<ASSIGN  16539<<ASSIGN  16732>>IF      16736>>ASSIGN  16754>>ASSIGN
     16828<<ASSIGN
B$ROSEG.CR01ID
     16034**DCL     16500<<ASSIGN
B$ROSEG.CR01ID.INT
     16035**DCL     16521<<ASSIGN  16538<<ASSIGN  16695>>IF      16709>>IF      16714>>IF      16718>>IF
     16753>>IF      17045>>IF
B$ROSEG.CR01ID.JCL
     16036**DCL     16522<<ASSIGN
B$ROSEG.CR01ID.NOWIS
     16037**DCL     16520<<ASSIGN  16537<<ASSIGN
B$ROSEG.LDEVNAME
     16023**DCL     17127>>IF      17136>>IF      17137<<ASSIGN  17190>>ASSIGN
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:212  
B$ROSEG.NUMDCBS
     16015**DCL     17343>>ASSIGN
B$ROSEG.STREAMID
     16024**DCL     17151<<ASSIGN
B$ROSEG.STREAMID.FLG
     16025**DCL     16822<<ASSIGN  17169>>DOCASE  17203<<ASSIGN
B$ROSEG.STREAMID.IDENT
     16032**DCL     16821<<ASSIGN  17205<<ASSIGN  17208>>ASSIGN
B$ROSEG.STREAMID.UC_STR
     16031**DCL     17154>>IF      17197>>IF      17210>>IF
B$ROSEG.STREAMID.WINDOW
     16030**DCL     17226>>IF      17243<<ASSIGN
B$ROSEG.STREAM_VALID
     16045**DCL     16494>>IF      17060>>IF
B$ROSEG$
        40**DCL     16012--IMP-PTR 16048--IMP-PTR 16050--IMP-PTR 16494>>IF      16499>>IF      16500>>ASSIGN
     16520>>ASSIGN  16521>>ASSIGN  16522>>ASSIGN  16523>>ASSIGN  16523>>ASSIGN  16537>>ASSIGN  16538>>ASSIGN
     16539>>ASSIGN  16539>>ASSIGN  16695>>IF      16709>>IF      16714>>IF      16718>>IF      16732>>IF
     16736>>ASSIGN  16736>>ASSIGN  16753>>IF      16754>>ASSIGN  16754>>ASSIGN  16821>>ASSIGN  16822>>ASSIGN
     16828>>ASSIGN  17045>>IF      17060>>IF      17127>>IF      17136>>IF      17137>>ASSIGN  17151>>ASSIGN
     17154>>IF      17169>>DOCASE  17190>>ASSIGN  17197>>IF      17203>>ASSIGN  17205>>ASSIGN  17205>>ASSIGN
     17208>>ASSIGN  17208>>ASSIGN  17210>>IF      17226>>IF      17243>>ASSIGN  17343>>ASSIGN
BADFEP
     16770**LABEL   16766--GOTO    16779--GOTO    16999--CALLALT 17002--GOTO
BADFUN
     16804**LABEL   16580--GOTO    16789--GOTO    16988--GOTO    16989--GOTO    16992--GOTO    17005--GOTO
BADRES
     16620**LABEL   16664--GOTO    16983--GOTO    16985--GOTO    16990--GOTO    16997--GOTO    17043--GOTO
BPTR.SEGID
     16134**DCL     17085>>IF
BUF$
     16152**DCL     16122--IMP-PTR 16303--IMP-PTR 16571<>CALL    16572<>CALL    16573>>IF      16579<>CALL
     16598<>CALL    16605>>IF      16613<>CALL    16621<>CALL    16861<>CALL    16863<>CALL    16871<<ASSIGN
     16887>>ASSIGN  16981<>CALL    17150<>CALL    17172<>CALL    17175<>CALL    17187<>CALL    17188<>CALL
CANTDDWSN
     16617**LABEL   16572--CALLALT 16576--GOTO    16598--CALLALT 16877--GOTO    16956--GOTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:213  
CANTDDWSNRES
     16614**LABEL   16863--CALLALT 16873--CALLALT
CANTOPENUC
     17105**LABEL   16504--CALLALT 16534--GOTO
CGID IN PROCEDURE DBGFPRG
     17752**DCL     17854<>CALL
CGID.ACCT# IN PROCEDURE DBGFPRG
     17756**DCL     17850<<ASSIGN
CGID.NAME# IN PROCEDURE DBGFPRG
     17759**DCL     17849<<ASSIGN
CGID.PSN# IN PROCEDURE DBGFPRG
     17757**DCL     17851<<ASSIGN
CGINIT
     17383**PROC    17089--CALL
CHECK_COMP
     17338**PROC    16759--CALL    17221--CALL
CLSSAVE$
     16405**DCL     16824<>CALL
CLSSAVE$.SN_
     16405**DCL     16405--REDEF
CLSSAVE$.UTL_
     16406**DCL     16406--REDEF
CLSSAVE$.V
     16410**DCL     16405--DCLINIT
CLSSAVE$.V.EXPIRE#
     16420**DCL     16420--REDEF
CLSSAVE$.V.TYPE#
     16418**DCL     16418--REDEF
CLSSAVE$.V.XTNSIZE#
     16415**DCL     16415--REDEF   16417--REDEF
CODE16
     16114**DCL     17267--CALL
CODE16.FORM
     16114**DCL     16865>>ASSIGN
CONV_STR
     15849**DCL     16698>>ASSIGN  16725>>ASSIGN
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:214  
DBGFPRG
     17711**PROC    16788--CALL    17007--CALL
DDCB$ IN PROCEDURE DBGFPRG
     17736**DCL     17818<<ASSIGN  17819>>IF      17819>>IF      17822>>ASSIGN
DO_FE
     17007**LABEL   16783--GOTO
ERR IN PROCEDURE CGINIT
     17438**LABEL   17416--CALLALT 17428--CALLALT 17433--CALLALT
ERRCODE
     16137**DCL     17101<<ASSIGN  17103>>ASSIGN
ERR_BADFEP
     16250**DCL     16771>>ASSIGN
ERR_ILLIN
     16218**DCL     16804>>ASSIGN  17155>>ASSIGN
ERR_INVDBG
     16242**DCL     17839>>ASSIGN
ERR_INVRES
     16222**DCL     16658>>ASSIGN  17109>>ASSIGN
ERR_NOFPRG
     16254**DCL     17694>>ASSIGN  17898>>ASSIGN
ERR_NOSTREAMS
     16230**DCL     17141>>ASSIGN
ERR_NOTAUTH
     16234**DCL     17013>>ASSIGN
ERR_NOTDBG
     16238**DCL     17806>>ASSIGN
ERR_ORGNOTCOM
     16246**DCL     17237>>ASSIGN  17354>>ASSIGN  17361>>ASSIGN  17367>>ASSIGN
ERR_PCNLDCT
     16226**DCL     16910>>ASSIGN  17642>>ASSIGN  17861>>ASSIGN
F
     16146**DCL     16548<<ASSIGN  16549<<ASSIGN  16550<<ASSIGN  16551<<ASSIGN  16578>>IF      16670>>DOCASE
     16989>>IF      16992>>IF      17154>>IF
F$DCB
     16064**DCL     16860<>CALL    16973<>CALL    17247<>CALL    17282<>CALL    17325<>CALL    17706--IF
F$DCB.ACCT
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:215  
     16074**DCL     16588<<ASSIGN  17850>>ASSIGN
F$DCB.ACS
     16081**DCL     16587<<ASSIGN  16989>>IF
F$DCB.ACTPOS
     16089**DCL     16089--REDEF
F$DCB.AMRSETSTA
     16076**DCL     17426>>IF      17431>>IF
F$DCB.ARS
     16064**DCL     16064--REDEF
F$DCB.ASN
     16079**DCL     17087>>IF      17304>>IF
F$DCB.ATTR
     16082**DCL     16083--REDEF   16564<<ASSIGN  16870<<ASSIGN  17263<<ASSIGN  17263>>ASSIGN  17666<<ASSIGN
     17666>>ASSIGN
F$DCB.ATTR.TRANSLGL
     16082**DCL     16796<<ASSIGN
F$DCB.BORROW
     16097**DCL     16097--REDEF   16097--REDEF   16097--REDEF
F$DCB.CFU$
     16098**DCL     16503<<ASSIGN  16736<<ASSIGN  16754<<ASSIGN  16817>>IF      16819>>CALLBLT 16823>>ASSIGN
     16827>>ASSIGN  17085--IF      17087>>IF      17216<<ASSIGN  17254>>IF      17259>>ASSIGN  17260>>ASSIGN
     17261>>ASSIGN  17262>>ASSIGN  17263>>ASSIGN  17264>>ASSIGN  17270>>DOCASE  17277>>IF      17277>>IF
     17277>>IF      17281>>ASSIGN  17282>>CALL    17282>>CALL    17295>>IF      17304>>IF      17313>>IF
     17321>>ASSIGN  17323>>ASSIGN  17330>>ASSIGN  17331>>IF      17332>>ASSIGN  17334>>ASSIGN  17345>>IF
     17345>>IF      17423>>ASSIGN  17704<<ASSIGN
F$DCB.CODE16$
     16088**DCL     16590<<ASSIGN  16864<<ASSIGN  17264<<ASSIGN
F$DCB.COMP
     16077**DCL     16585<<ASSIGN
F$DCB.CTLCMDIN
     16105**DCL     16745<<ASSIGN  16758<<ASSIGN
F$DCB.DCB#
     16091**DCL     16486>>ASSIGN  16960>>ASSIGN
F$DCB.DCBNAME.L
     16111**DCL     16111--IMP-SIZ 16860>>CALL    16973>>CALL    17247>>CALL    17282>>CALL    17325>>CALL
F$DCB.DDEV
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:216  
     16070**DCL     16506<<ASSIGN  16609<<ASSIGN  16689<<ASSIGN  17260<<ASSIGN  17260>>ASSIGN  17317<<ASSIGN
     17665<<ASSIGN  17665>>ASSIGN
F$DCB.DDEV.IC
     16070**DCL     16738<<ASSIGN  16742<<ASSIGN  16742>>ASSIGN
F$DCB.DDEV.LP
     16070**DCL     16602>>IF      17297>>IF
F$DCB.DDEV.XEQ
     16070**DCL     16739<<ASSIGN  16757<<ASSIGN
F$DCB.DISP
     16079**DCL     16586<<ASSIGN  16940>>IF
F$DCB.DVFC
     16085**DCL     16509<<ASSIGN  16967>>IF      16967<<ASSIGN  17329>>IF      17330<<ASSIGN  17330>>ASSIGN
F$DCB.EOMCHAR
     16068**DCL     16068--REDEF
F$DCB.EVENT
     16088**DCL     16899>>IF
F$DCB.FCD
     16077**DCL     16524<<ASSIGN  16528>>IF      16533>>IF      17094<<ASSIGN  17345>>IF      17819>>IF
F$DCB.FFLG
     16068**DCL     16508<<ASSIGN  16514<<ASSIGN  16612<<ASSIGN  16678<<ASSIGN  16683<<ASSIGN  16696<<ASSIGN
     16702<<ASSIGN  16707<<ASSIGN  16712<<ASSIGN  16721<<ASSIGN  16724<<ASSIGN  16748<<ASSIGN  16790<<ASSIGN
     16795<<ASSIGN  16882<<ASSIGN  17021<<ASSIGN  17044<<ASSIGN  17212<<ASSIGN  17214<<ASSIGN  17274<<ASSIGN
F$DCB.FFLG.DELR
     16069**DCL     17286<<ASSIGN
F$DCB.FFLG.READ
     16069**DCL     16965<<ASSIGN
F$DCB.FFLG.WNEW
     16069**DCL     16966<<ASSIGN
F$DCB.FLDID
     16092**DCL     16092--REDEF
F$DCB.FORM$
     16086**DCL     16086--REDEF   16590>>ASSIGN  16864>>ASSIGN  16865>>ASSIGN  17264>>ASSIGN  17266>>IF
     17267<>CALL
F$DCB.FPSTR
     16102**DCL     17058<<ASSIGN
F$DCB.FSECT
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:217  
     16102**DCL     16102--REDEF
F$DCB.FSN
     16079**DCL     16079--REDEF   16079--REDEF   16080--REDEF
F$DCB.FUN
     16078**DCL     16547>>DOCASE  16551<<ASSIGN  16584<<ASSIGN
F$DCB.HEADER$
     16085**DCL     16085--REDEF   16859>>IF      17322>>IF
F$DCB.IASN
     16105**DCL     16517<<ASSIGN  16690<<ASSIGN  16750<<ASSIGN  16794<<ASSIGN  16846<<ASSIGN  16963<<ASSIGN
     17048<<ASSIGN  17096>>IF      17257<<ASSIGN  17307<<ASSIGN  17345>>IF      17702<<ASSIGN  17869<<ASSIGN
F$DCB.IFMT
     16104**DCL     16511<<ASSIGN  16515<<ASSIGN  16603<<ASSIGN  16604<<ASSIGN  16607<<ASSIGN  16687<<ASSIGN
     16751<<ASSIGN  16797<<ASSIGN  16851<<ASSIGN  16884<<ASSIGN  16964<<ASSIGN  17022<<ASSIGN  17046<<ASSIGN
     17273<<ASSIGN  17290<<ASSIGN  17295>>IF      17300<<ASSIGN  17306<<ASSIGN  17311<<ASSIGN  17313>>IF
     17316<<ASSIGN  17703<<ASSIGN  17867<<ASSIGN
F$DCB.IORG
     16100**DCL     16896>>IF      16907>>IF
F$DCB.IWL.HDRIWL
     16105**DCL     17323<<ASSIGN  17323>>ASSIGN
F$DCB.IWL.SEQIWL
     16105**DCL     17321<<ASSIGN  17321>>ASSIGN
F$DCB.IWL.TABIWL
     16105**DCL     17334<<ASSIGN  17334>>ASSIGN
F$DCB.IXTNSIZE
     16083**DCL     16083--REDEF
F$DCB.LASTSTA$
     16073**DCL     16073--REDEF   17415>>IF      17416<>CALL    17418>>ASSIGN  17422>>ASSIGN
F$DCB.LDCTX
     16086**DCL     16949<<ASSIGN  16968<<ASSIGN  17277>>IF      17277>>IF      17281>>ASSIGN  17700<<ASSIGN
     17822>>ASSIGN  17865<<ASSIGN
F$DCB.LINES
     16085**DCL     17331>>IF      17331>>IF      17331>>IF      17332<<ASSIGN  17332>>ASSIGN
F$DCB.LVL
     16098**DCL     16098--REDEF
F$DCB.MEDIA
     16104**DCL     16510<<ASSIGN  16516<<ASSIGN  16608<<ASSIGN  16688<<ASSIGN  16798<<ASSIGN  16883<<ASSIGN
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:218  
     16962<<ASSIGN  17023<<ASSIGN  17047<<ASSIGN  17060>>IF      17217>>IF      17291<<ASSIGN  17318<<ASSIGN
     17705<<ASSIGN  17868<<ASSIGN
F$DCB.NAME
     16073**DCL     16819--CALLBLT 17849>>ASSIGN
F$DCB.NAME.C
     16073**DCL     16073--REDEF   17680>>ASSIGN
F$DCB.NOEOF
     16094**DCL     16094--REDEF
F$DCB.NRECS
     16084**DCL     16084--REDEF
F$DCB.NRECX
     16103**DCL     16103--REDEF
F$DCB.OHDR
     16095**DCL     16095--REDEF
F$DCB.ORG
     16078**DCL     16078--REDEF   16589>>ASSIGN  16610<<ASSIGN  16691<<ASSIGN  16727>>IF      16749<<ASSIGN
     16762>>IF      16762>>IF      16781>>IF      16781>>IF      16786>>IF      16786>>IF      16786>>IF
     16852<<ASSIGN  16970>>IF      17003>>DOCASE  17010>>IF      17025>>IF      17220>>ASSIGN  17254>>IF
     17254>>IF      17270>>DOCASE  17272<<ASSIGN  17277>>IF      17285>>IF      17287>>IF      17287>>IF
     17287>>IF      17287>>IF      17297>>IF      17305<<ASSIGN  17310<<ASSIGN  17351>>DOCASE  17358>>IF
     17358>>IF      17365>>IF      17813>>DOCASE
F$DCB.PASS
     16074**DCL     16582<<ASSIGN
F$DCB.PRECNO
     16101**DCL     16101--REDEF
F$DCB.PSN
     16074**DCL     16583<<ASSIGN  16865<<ASSIGN  17851>>ASSIGN
F$DCB.RCSZ
     16106**DCL     16106--REDEF
F$DCB.RES
     16074**DCL     16074--REDEF   16502>>IF      16546>>ASSIGN  16601<<ASSIGN  16620<<ASSIGN  17190<<ASSIGN
F$DCB.SEQ
     16085**DCL     17320>>IF
F$DCB.SETSTA$
     16073**DCL     17418<<ASSIGN  17419>>ASSIGN  17425>>ASSIGN  17428>>CALL    17430>>ASSIGN  17433>>CALL
F$DCB.SETX
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:219  
     16086**DCL     16086--REDEF   16879>>ASSIGN  16901>>DOUNTIL 16903<<ASSIGN  16906>>IF      16948<<ASSIGN
     16968>>ASSIGN  17121>>ASSIGN  17261<<ASSIGN  17261>>ASSIGN  17277>>IF      17668>>ASSIGN  17707<<ASSIGN
F$DCB.STR
     16102**DCL     16669<<ASSIGN  16969<<ASSIGN  17219<<ASSIGN  17348>>IF      17701<<ASSIGN  17866<<ASSIGN
F$DCB.SYSID
     16080**DCL     17699<<ASSIGN
F$DCB.TAB$
     16085**DCL     16086--REDEF   17333>>IF
F$DCB.TDA
     16100**DCL     16100--REDEF
F$DCB.TYC
     16064**DCL     16886<<ASSIGN
F$DCB.UB$
     16102**DCL     16887<<ASSIGN
F$DCB.UBYTES
     16102**DCL     16888<<ASSIGN
F$DCB.UCOUT
     16099**DCL     16507<<ASSIGN  16680<<ASSIGN  16744<<ASSIGN  16744>>ASSIGN  17259<<ASSIGN  17259>>ASSIGN
F$DCB.UOPT
     16076**DCL     17065>>IF
F$DCB.WAIT
     16096**DCL     16885<<ASSIGN
F$DCB.WIDTH
     16071**DCL     17262<<ASSIGN  17262>>ASSIGN
F$DCB.WSN
     16075**DCL     16075--REDEF   16558>>IF      16617<<ASSIGN  16764>>IF      16768<>CALL    16866<<ASSIGN
     16999<>CALL    17189<<ASSIGN
FEX
     16149**DCL     16768<>CALL    16972<<ASSIGN  16973<>CALL    16998<<CALLBLT 16999<>CALL    17030<>CALL
     17281<<ASSIGN  17282<>CALL    17815>>ASSIGN
FEX IN PROCEDURE FPRG
     17461**DCL     17442--PROC    17649>>ASSIGN  17653>>ASSIGN
FMD$GBUF
        63**DCL-ENT 16571--CALL    16861--CALL    17172--CALL
FMD$RBUF
        64**DCL-ENT 16579--CALL    16613--CALL    16621--CALL    16981--CALL    17150--CALL    17188--CALL
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:220  
FMD$RELBUF
        65**DCL-ENT 17098--CALL
FMF$REMOTE
        77**DCL-ENT 16575--CALL
FMM$DFLOPNP
        54**DCL-ENT 16531--CALL
FMN$OPNDP
        47**DCL-ENT 16850--CALL
FMO$GETDOMAIN
        55**DCL-ENT 17804--CALL
FMO$GETPFB
        70**DCL-ENT 16493--CALL
FMP$CLSF
     16424**DCL-ENT 16824--CALL
FOUND IN PROCEDURE OPENLDEV
     17151**LABEL   17127--GOTO    17138--GOTO
FPO$OPNOD
        60**DCL-ENT 16855--CALL
FPRG
     17442**PROC    16973--CALL    17030--CALL    17282--CALL
FPT$OPEN_V.ATTR
     15689**DCL     16869>>IF      16870>>ASSIGN
FPT$OPEN_V.DBGDCBNO
     15690**DCL     17818--ASSIGN
FPT$OPEN_V.DBGSYSID
     15691**DCL     17816<>CALL
FPT$OPEN_V.FSN
     15690**DCL     15690--REDEF   15691--REDEF
FPT$OPEN_V.OPER.TEST
     15680**DCL     16591>>IF      16816>>IF      16874>>IF      17049>>IF      17640>>IF      17859>>IF
FRA$OPR
        44**DCL-ENT 16873--CALL
FRB$CLS
        45**DCL-ENT 16876--CALL
FRB_RTN
     16871**LABEL   16899--GOTO    16906--GOTO    16911--GOTO
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:221  
FRF$EVRPT
        76**DCL-ENT 16898--CALL
FS$FORMREC.CHAINS
     16351**DCL     16361--REDEF
FS$FORMREC.GRAPHIC
     16312**DCL     16605>>IF
FS$FORMREC.SOFTFORM
     16327**DCL     16887--ASSIGN  16888--ASSIGN
FSA$FDCB
     16425**DCL-ENT 16830--CALL
FSA$FSP
        49**DCL-ENT 17267--CALL
FSA$GSP
        48**DCL-ENT 17416--CALL
FSB$STREAMCREATE
        51**DCL-ENT 17171--CALL
FSB$STREAMDCB
        52**DCL-ENT 17199--CALL
FSD$C1GETDCB
        58**DCL-ENT 16733--CALL
FSD$JEJFOPN
        57**DCL-ENT 16705--CALL
FSF$SYMBFILE
        62**DCL-ENT 16598--CALL    17187--CALL
FSM$HDRSET
        66**DCL-ENT 16860--CALL    17325--CALL
FSN$CONV_STR
     16428**DCL-ENT 17067--CALL
FSP$CLSDEV
        69**DCL-ENT 16955--CALL    17050--CALL    17102--CALL
FSP_RTN
     16955**LABEL   16973--CALLALT 16977--CALLALT
FSW$DESTFORM
        61**DCL-ENT 16572--CALL    16863--CALL    17175--CALL
FS_WINDOW
     15822**DCL     17222>>ASSIGN
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:222  
FS_WINDOW.FWINDOW#
     15822**DCL     15822--REDEF   15823--REDEF
FTO$OPNAT
        59**DCL-ENT 16847--CALL
GETOUT
     17108**LABEL   17052--GOTO    17089--CALLALT
GOTLDCT IN PROCEDURE DBGFPRG
     17822**LABEL   17854--CALLALT 17857--GOTO
GRSTRM IN PROCEDURE OPENLDEV
     17311**LABEL   17296--GOTO
HFC$LOCK
     15498**DCL-ENT 16925--CALL    16937--CALL    17684--CALL    17826--CALL    17888--CALL
HFC$UNLOCK
     15498**DCL-ENT 16932--CALL    17834--CALL
HOST
     16136**DCL     16768<>CALL    16777>>IF      16999<>CALL    17000>>IF
I
     16140**DCL     16141--REDEF   16589<<ASSIGN  16602>>IF      16654<<CALLBLT 16655>>DOCASE  16665<<CALLBLT
     16670>>DOCASE  16819<<CALLBLT 16821>>ASSIGN  16838>>IF      16842<<CALLBLT 16844>>DOCASE  16900<<ASSIGN
     16902>>IF      17027<<ASSIGN  17029<<ASSIGN  17030<>CALL    17056<<CALLBLT 17057<<ASSIGN  17057>>ASSIGN
     17058>>ASSIGN  17060>>IF      17071<>CALL    17079<>CALL    17125<<ASSIGN  17126>>DOWHILE 17127>>IF
     17128<<ASSIGN  17128>>ASSIGN  17135<<DOINDEX 17136>>IF      17137>>ASSIGN  17151>>ASSIGN  17154>>IF
     17169>>DOCASE  17171<>CALL    17190>>ASSIGN  17192>>ASSIGN  17196>>ASSIGN  17197>>IF      17199<>CALL
     17203>>ASSIGN  17205>>ASSIGN  17208>>ASSIGN  17210>>IF      17219>>ASSIGN  17221<>CALL    17226>>IF
     17226>>IF      17235>>IF      17240<>CALL    17241>>IF      17243>>ASSIGN  17247<>CALL    17282<>CALL
     17804<>CALL    17805>>IF      17852<<ASSIGN  17854<>CALL
I IN PROCEDURE CHECK_COMP
     17341**DCL     17343<<ASSIGN  17344>>DOWHILE 17345--IF      17345--IF      17345--IF      17345--IF
     17348--IF      17358--IF      17358--IF      17365--IF      17377<<ASSIGN  17377>>ASSIGN
INITLOOP
     16494**LABEL   16535--GOTO
JDCB$
     16138**DCL     16064--IMP-PTR 16485<<ASSIGN  16486>>ASSIGN  16489>>IF      16501>>IF      16502>>IF
     16503>>ASSIGN  16503>>ASSIGN  16506>>ASSIGN  16507>>ASSIGN  16508>>ASSIGN  16509>>ASSIGN  16510>>ASSIGN
     16511>>ASSIGN  16514>>ASSIGN  16515>>ASSIGN  16516>>ASSIGN  16517>>ASSIGN  16523>>ASSIGN  16524>>ASSIGN
     16532>>ASSIGN  16546>>ASSIGN  16547>>DOCASE  16551>>ASSIGN  16558>>IF      16564>>ASSIGN  16574>>ASSIGN
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:223  
     16582>>ASSIGN  16583>>ASSIGN  16584>>ASSIGN  16585>>ASSIGN  16586>>ASSIGN  16587>>ASSIGN  16588>>ASSIGN
     16589>>ASSIGN  16590>>ASSIGN  16590>>ASSIGN  16600>>ASSIGN  16601>>ASSIGN  16602>>IF      16603>>ASSIGN
     16604>>ASSIGN  16607>>ASSIGN  16608>>ASSIGN  16609>>ASSIGN  16610>>ASSIGN  16612>>ASSIGN  16617>>ASSIGN
     16619>>ASSIGN  16620>>ASSIGN  16669>>ASSIGN  16678>>ASSIGN  16679>>IF      16680>>ASSIGN  16683>>ASSIGN
     16687>>ASSIGN  16688>>ASSIGN  16689>>ASSIGN  16690>>ASSIGN  16691>>ASSIGN  16696>>ASSIGN  16702>>ASSIGN
     16707>>ASSIGN  16712>>ASSIGN  16721>>ASSIGN  16724>>ASSIGN  16727>>IF      16736>>ASSIGN  16738>>ASSIGN
     16739>>ASSIGN  16742>>ASSIGN  16744>>ASSIGN  16745>>ASSIGN  16748>>ASSIGN  16749>>ASSIGN  16750>>ASSIGN
     16751>>ASSIGN  16754>>ASSIGN  16757>>ASSIGN  16758>>ASSIGN  16762>>IF      16762>>IF      16764>>IF
     16768>>CALL    16781>>IF      16781>>IF      16786>>IF      16786>>IF      16786>>IF      16790>>ASSIGN
     16794>>ASSIGN  16795>>ASSIGN  16796>>ASSIGN  16797>>ASSIGN  16798>>ASSIGN  16817>>IF      16819>>CALLBLT
     16823>>ASSIGN  16827>>ASSIGN  16846>>ASSIGN  16851>>ASSIGN  16852>>ASSIGN  16859>>IF      16860>>CALL
     16860>>CALL    16864>>ASSIGN  16864>>ASSIGN  16865>>ASSIGN  16865>>ASSIGN  16866>>ASSIGN  16870>>ASSIGN
     16879>>ASSIGN  16882>>ASSIGN  16883>>ASSIGN  16884>>ASSIGN  16885>>ASSIGN  16886>>ASSIGN  16887>>ASSIGN
     16888>>ASSIGN  16896>>IF      16899>>IF      16901>>DOUNTIL 16903>>ASSIGN  16906>>IF      16907>>IF
     16940>>IF      16948>>ASSIGN  16949>>ASSIGN  16960>>ASSIGN  16962>>ASSIGN  16963>>ASSIGN  16964>>ASSIGN
     16965>>ASSIGN  16966>>ASSIGN  16967>>IF      16967>>ASSIGN  16968>>ASSIGN  16968>>ASSIGN  16969>>ASSIGN
     16970>>IF      16973>>CALL    16973>>CALL    16989>>IF      16999>>CALL    17003>>DOCASE  17010>>IF
     17021>>ASSIGN  17022>>ASSIGN  17023>>ASSIGN  17025>>IF      17044>>ASSIGN  17046>>ASSIGN  17047>>ASSIGN
     17048>>ASSIGN  17058>>ASSIGN  17065>>IF      17085>>IF      17087>>IF      17093>>ASSIGN  17094>>ASSIGN
     17096>>IF      17112>>ASSIGN  17120<<ASSIGN  17121>>ASSIGN  17212>>ASSIGN  17214>>ASSIGN  17216>>ASSIGN
     17219>>ASSIGN  17220>>ASSIGN  17247>>CALL    17247>>CALL    17254>>IF      17254>>IF      17257>>ASSIGN
     17259>>ASSIGN  17259>>ASSIGN  17260>>ASSIGN  17260>>ASSIGN  17261>>ASSIGN  17261>>ASSIGN  17262>>ASSIGN
     17262>>ASSIGN  17263>>ASSIGN  17263>>ASSIGN  17264>>ASSIGN  17264>>ASSIGN  17266>>IF      17267>>CALL
     17270>>DOCASE  17272>>ASSIGN  17273>>ASSIGN  17274>>ASSIGN  17277>>IF      17277>>IF      17277>>IF
     17277>>IF      17281>>ASSIGN  17282>>CALL    17282>>CALL    17285>>IF      17286>>ASSIGN  17287>>IF
     17287>>IF      17287>>IF      17287>>IF      17290>>ASSIGN  17291>>ASSIGN  17295>>IF      17297>>IF
     17297>>IF      17300>>ASSIGN  17304>>IF      17305>>ASSIGN  17306>>ASSIGN  17307>>ASSIGN  17310>>ASSIGN
     17311>>ASSIGN  17313>>IF      17316>>ASSIGN  17317>>ASSIGN  17318>>ASSIGN  17320>>IF      17321>>ASSIGN
     17321>>ASSIGN  17322>>IF      17323>>ASSIGN  17323>>ASSIGN  17325>>CALL    17325>>CALL    17329>>IF
     17330>>ASSIGN  17330>>ASSIGN  17331>>IF      17331>>IF      17331>>IF      17332>>ASSIGN  17332>>ASSIGN
     17333>>IF      17334>>ASSIGN  17334>>ASSIGN  17345>>IF      17351>>DOCASE  17415>>IF      17416>>CALL
     17418>>ASSIGN  17418>>ASSIGN  17419>>ASSIGN  17422>>ASSIGN  17423>>ASSIGN  17426>>IF      17428>>CALL
     17431>>IF      17433>>CALL    17665>>ASSIGN  17666>>ASSIGN  17680>>ASSIGN  17699>>ASSIGN  17700>>ASSIGN
     17701>>ASSIGN  17702>>ASSIGN  17703>>ASSIGN  17704>>ASSIGN  17705>>ASSIGN  17706>>IF      17707>>ASSIGN
     17813>>DOCASE  17849>>ASSIGN  17850>>ASSIGN  17851>>ASSIGN  17865>>ASSIGN  17866>>ASSIGN  17867>>ASSIGN
     17868>>ASSIGN  17869>>ASSIGN
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:224  
JDCBNO
     16147**DCL     16486<<ASSIGN  17650>>ASSIGN  17663>>ASSIGN  17876>>ASSIGN
JIT$
     16151**DCL     16563<<ASSIGN  16568<<ASSIGN  16572<>CALL    16598<>CALL    16862<<ASSIGN  16863<>CALL
     16909<>CALL    16913>>ASSIGN  16914>>ASSIGN  16915>>ASSIGN  16916>>ASSIGN  16917>>ASSIGN  16918>>ASSIGN
     16920>>ASSIGN  16920>>ASSIGN  16923>>ASSIGN  16927>>ASSIGN  16928>>ASSIGN  16947>>ASSIGN  17149>>ASSIGN
     17174<<ASSIGN  17191>>ASSIGN  17641<>CALL    17645>>ASSIGN  17688<>CALL    17691<>CALL    17854<>CALL
     17856>>ASSIGN  17860<>CALL    17864>>ASSIGN  17892<>CALL    17895<>CALL
JUSTOPNIT IN PROCEDURE OPENLDEV
     17241**LABEL   17233--GOTO
KCI$VALSTA1
        56**DCL-ENT 17428--CALL    17433--CALL
KCO$FINDSTA
        82**DCL-ENT 17854--CALL
KIA$9TO8
        80**DCL-ENT 17816--CALL
KIA$CLSSTR
        71**DCL-ENT 17079--CALL
KIA$DCLSTR
        72**DCL-ENT 17071--CALL
KIA$OPNSSN
        73**DCL-ENT 16977--CALL
KIA$OPNSTR
        74**DCL-ENT 17247--CALL
KIA$UCIOND
        75**DCL-ENT 16942--CALL
KIA$WINDOW
        78**DCL-ENT 17240--CALL
KIF$FPRGR
        81**DCL-ENT 17099--CALL
KIN$CONV_NODE
     16427**DCL-ENT 16999--CALL
KIN$CONV_NODENAME
     16426**DCL-ENT 16768--CALL
KIS$OSI_OPEN
        87**DCL-ENT 16800--CALL
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:225  
KL_STRTU IN PROCEDURE FPRG
     17479**DCL     17651<<ASSIGN  17682<>CALL    17682--CALL
KL_STRTU.ACCT IN PROCEDURE FPRG
     17520**DCL     17660<<ASSIGN
KL_STRTU.FCN IN PROCEDURE FPRG
     17480**DCL     17652<<ASSIGN
KL_STRTU.MODE IN PROCEDURE FPRG
     17528**DCL     17662<<ASSIGN
KL_STRTU.NETADR_FROM.GENERATION IN PROCEDURE FPRG
     17492**DCL     17656<<ASSIGN
KL_STRTU.NETADR_FROM.LDX.BYT IN PROCEDURE FPRG
     17496**DCL     17657<<ASSIGN  17658<<ASSIGN  17658>>ASSIGN
KL_STRTU.NETADR_FROM.NODE IN PROCEDURE FPRG
     17491**DCL     17655<<ASSIGN
KL_STRTU.NETADR_TO IN PROCEDURE FPRG
     17503**DCL     17672<<ASSIGN
KL_STRTU.NODE IN PROCEDURE FPRG
     17486**DCL     17653<<ASSIGN
KL_STRTU.STR IN PROCEDURE FPRG
     17532**DCL     17654<<ASSIGN
KL_STRTU.UNAME IN PROCEDURE FPRG
     17516**DCL     17661<<ASSIGN  17680<<ASSIGN
KL_WSNHDR.INDIRECT#
     16123**DCL     16573>>IF
KUB$WRITE
        67**DCL-ENT 17682--CALL    17886--CALL
K_NODE#
     15039**DCL     16919>>ASSIGN  17655>>ASSIGN  17878>>ASSIGN
K_RWPARM_CON.BLKREC
     14770**DCL     14795--REDEF
K_RWPARM_CON.BLKREC.BLKU#
     14771**DCL     14773--REDEF
K_RWPARM_CON.BLKREC.RECU#
     14783**DCL     14785--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
     14810**DCL     14811--REDEF
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:226  
K_RWPARM_CON.DVE.EOMCHAR
     14818**DCL     14822--REDEF
K_RWPARM_CON.ERR
     14882**DCL     14887--REDEF
K_RWPARM_CON.FC
     14846**DCL     14847--REDEF
K_RWPARM_CON.FLDID
     15028**DCL     15029--REDEF
K_RWPARM_CON.FPT$
     14909**DCL     14916--REDEF
K_RWPARM_CON.KEYTYPE
     15035**DCL     15036--REDEF
K_RWPARM_CON.MSG$
     14745**DCL     14751--REDEF
K_RWPARM_CON.MSGID
     14857**DCL     14862--REDEF
K_RWPARM_CON.MSGIDXT
     14870**DCL     14874--REDEF
K_RWPARM_CON.ORG
     15006**DCL     15007--REDEF
K_RWPARM_CON.THDRSZ
     14950**DCL     14954--REDEF
K_RWPARM_CON.VDOFLGS
     15008**DCL     15019--REDEF
LBL_CP
     16675**LABEL   16701--GOTO
LBL_LP
     16672**LABEL   16695--GOTO
LBL_MEBI
     16754**LABEL   16722--GOTO
LBL_MEII
     16730**LABEL   16753--GOTO
LBL_NO
     17046**LABEL   16681--GOTO    16684--GOTO    16703--GOTO    16709--GOTO    16714--GOTO
LBL_RDEV
     16842**LABEL   16665--CALLALT
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:227  
LBL_UC
     16696**LABEL   16710--GOTO    16715--GOTO
LDCT$
     16139**DCL     15970--IMP-PTR 16879<<ASSIGN  16880>>IF      16900>>ASSIGN  16901>>DOUNTIL 16902>>IF
     16902>>IF      16913>>ASSIGN  16914>>ASSIGN  16916>>ASSIGN  16925>>CALL    16927>>ASSIGN  16928>>ASSIGN
     16930>>IF      16930>>ASSIGN  16932>>CALL    16934>>IF      16937>>CALL    16940>>IF      16942>>CALL
     16946>>IF      16946>>ASSIGN  16947<<ASSIGN  16948>>ASSIGN  16949>>ASSIGN  16950>>IF      16951>>ASSIGN
     16952>>ASSIGN  16953>>ASSIGN  16959>>ASSIGN  16960>>ASSIGN  16965>>IF      16966>>IF      16972>>ASSIGN
     16977>>CALL    17121<<ASSIGN  17645<<ASSIGN  17646>>ASSIGN  17647>>ASSIGN  17648>>ASSIGN  17649>>ASSIGN
     17650>>ASSIGN  17656>>ASSIGN  17657>>ASSIGN  17658>>ASSIGN  17663>>ASSIGN  17667>>ASSIGN  17669>>ASSIGN
     17670>>ASSIGN  17671>>ASSIGN  17677>>ASSIGN  17679>>ASSIGN  17684>>CALL    17686>>ASSIGN  17689>>IF
     17690>>ASSIGN  17694>>ASSIGN  17699>>ASSIGN  17699>>ASSIGN  17700>>ASSIGN  17822<<ASSIGN  17824>>IF
     17826>>CALL    17828>>IF      17828>>IF      17830>>ASSIGN  17831>>ASSIGN  17834>>CALL    17853<<ASSIGN
     17856<<ASSIGN  17864<<ASSIGN  17865>>ASSIGN  17870>>ASSIGN  17871>>ASSIGN  17872>>ASSIGN  17873>>ASSIGN
     17874>>ASSIGN  17875>>ASSIGN  17876>>ASSIGN  17877>>ASSIGN  17879>>ASSIGN  17880>>ASSIGN  17881>>ASSIGN
     17888>>CALL    17890>>ASSIGN  17893>>IF      17894>>ASSIGN  17898>>ASSIGN
LDEVPLUSHDR
     16287**DCL     17180--ASSIGN
LDEVPLUSTAB
     16273**DCL     17180--ASSIGN
LDEVUATTR
     16259**DCL     17178<<ASSIGN  17179--ASSIGN  17182--ASSIGN
LDEVUATTR.NAW
     16259**DCL     17180<<ASSIGN
LDEVUATTR.NDW
     16259**DCL     17179<<ASSIGN  17180>>ASSIGN
MEBBETSTF
     16816**LABEL   16839--GOTO    17035--GOTO
MODE IN PROCEDURE FPRG
     17460**DCL     17442--PROC    17662>>ASSIGN  17664>>IF      17675>>IF
MOVEINFO IN PROCEDURE OPENLDEV
     17215**ENTRY   17075--CALL
N$DCT$$
     15149**DCL     15149--IMP-PTR 16879>>ASSIGN  17121>>ASSIGN  17281>>ASSIGN  17668>>ASSIGN  17822>>ASSIGN
NETMNGR IN PROCEDURE FPRG
     17638**DCL     17682<>CALL
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:228  
NEWSTREAM
     16135**DCL     16653<<ASSIGN  17024<<ASSIGN  17063<<ASSIGN  17074<<ASSIGN  17077>>IF      17193<<ASSIGN
     17195<<ASSIGN  17231>>IF      17245>>IF      17350<<ASSIGN
NK$LDCT
     15970**DCL     16942<>CALL    16977<>CALL
NK$LDCT.CLLNK$
     15992**DCL     16927<<ASSIGN  16927>>ASSIGN  16928<<ASSIGN
NK$LDCT.DCBNO
     15994**DCL     16940>>IF      16946>>IF      16960<<ASSIGN  17663<<ASSIGN  17876<<ASSIGN
NK$LDCT.DDT$
     15972**DCL     15972--REDEF
NK$LDCT.DEVNM
     15972**DCL     16918<<ASSIGN  17667<<ASSIGN  17677<<ASSIGN  17679<<ASSIGN  17877<<ASSIGN
NK$LDCT.DFLG
     15974**DCL     16916<<ASSIGN  16916>>ASSIGN
NK$LDCT.DFLG.CM
     15974**DCL     17647<<ASSIGN  17873<<ASSIGN
NK$LDCT.DFLG.FEDN
     15978**DCL     16952<<ASSIGN
NK$LDCT.DFLG.INPUT
     15974**DCL     16917<<ASSIGN  16965>>IF      17670<<ASSIGN  17670>>ASSIGN  17871<<ASSIGN
NK$LDCT.DFLG.OUTPUT
     15974**DCL     16966>>IF      17671<<ASSIGN  17671>>ASSIGN  17872<<ASSIGN
NK$LDCT.DFLG.PRLS
     15977**DCL     16951<<ASSIGN
NK$LDCT.ERR
     15971**DCL     17690>>ASSIGN  17694<<ASSIGN  17894>>ASSIGN  17898<<ASSIGN
NK$LDCT.GENERATION
     15993**DCL     16900>>ASSIGN  16902>>IF      16923>>ASSIGN  17656>>ASSIGN  17879>>ASSIGN
NK$LDCT.IOQ$
     15971**DCL     15972--REDEF
NK$LDCT.LDCTX
     15973**DCL     15973--REDEF   16901>>DOUNTIL 16920>>ASSIGN  16920>>ASSIGN  16948>>ASSIGN  16949>>ASSIGN
     17657>>ASSIGN  17658>>ASSIGN  17700>>ASSIGN  17865>>ASSIGN  17880>>ASSIGN  17881>>ASSIGN
NK$LDCT.LKFLG.ABORTED
     15985**DCL     15986--REDEF
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:229  
NK$LDCT.LKFLG.REGGED
     15986**DCL     17686<<ASSIGN  17890<<ASSIGN
NK$LDCT.LOCK
     15998**DCL     16925<>CALL    16932<>CALL    16937<>CALL    17684<>CALL    17826<>CALL    17834<>CALL
     17888<>CALL
NK$LDCT.RAT$
     15973**DCL     16902>>IF      16913<<ASSIGN  16913>>ASSIGN
NK$LDCT.RESCOD
     15978**DCL     16880>>IF      16915<<ASSIGN  17646<<ASSIGN  17828>>IF      17828>>IF      17870<<ASSIGN
NK$LDCT.RLCID
     15994**DCL     16950>>IF      17672>>ASSIGN
NK$LDCT.RLCID.LDCTX
     15995**DCL     15995--REDEF   17689>>IF      17893>>IF
NK$LDCT.RLCID.NODE
     15994**DCL     16972>>ASSIGN  17281>>ASSIGN  17649<<ASSIGN  17831>>ASSIGN  17875<<ASSIGN
NK$LDCT.STA$
     15991**DCL     15992--REDEF
NK$LDCT.SYMB$
     15970**DCL     15970--REDEF   15970--REDEF   15971--REDEF
NK$LDCT.SYSID
     15991**DCL     17699>>ASSIGN  17699>>ASSIGN  17830>>ASSIGN
NK$LDCT.TERMID
     15998**DCL     16914<<ASSIGN  16914>>ASSIGN
NK$LDCT.TERMID.TTYP
     15998**DCL     17669<<ASSIGN  17669>>ASSIGN
NK$LDCT.UDCBNO
     15995**DCL     17650<<ASSIGN
NK$LDCT.USER
     15980**DCL     16930>>IF      16930<<ASSIGN  16934>>IF      16946<<ASSIGN  16953<<ASSIGN  16959<<ASSIGN
     17648<<ASSIGN  17874<<ASSIGN
NK$LDCT$
     15149**DCL     16879>>ASSIGN  17121>>ASSIGN  17281>>ASSIGN  17668>>ASSIGN  17822>>ASSIGN
NKA$DEVIO
        68**DCL-ENT 16889--CALL
NKL$GETDCT
        83**DCL-ENT 16909--CALL    17641--CALL    17860--CALL
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:230  
NKL$RELDCT
        84**DCL-ENT 17691--CALL    17895--CALL
NKU$UCOPN
        46**DCL-ENT 16504--CALL
OPENLDEV
     17124**PROC    16673--CALL    16676--CALL    16692--CALL    16699--CALL    16720--CALL    16726--CALL
     16837--CALL
OPNCL_EVT
     16906**LABEL   17122--GOTO
ORG
     16364**DCL     16365--REDEF   17064<<ASSIGN  17071<>CALL    17220<<ASSIGN  17231>>IF      17231>>IF
ORGSTR.BYT
     16366**DCL     17067<>CALL
OSFN.NUM
     16379**DCL     16819>>CALLBLT
PN$
     15851**DCL        38--PROC    16575<>CALL    16598<>CALL    16705<>CALL    16847<>CALL    16850<>CALL
     16855<>CALL    17115--ENTRY   17120--ASSIGN  17187<>CALL
PN$.ACCESS_
     15851**DCL     16595<<ASSIGN  17184<<ASSIGN
PN$.ACSVEH_
     15852**DCL     15852--REDEF   16596<<ASSIGN  17185<<ASSIGN
PN$.ALTKEYS_
     15854**DCL     15854--REDEF   15854--REDEF
PN$.HDR_
     15853**DCL     15853--REDEF
PN$.INSTATTR_
     15852**DCL     16594<<ASSIGN  17183<<ASSIGN
PN$.PROCATTR_
     15852**DCL     16565>>IF      16568>>ASSIGN  16569<<ASSIGN  16572<>CALL    17173<<ASSIGN  17175<>CALL
PN$.SETSTA_
     15851**DCL     17854>>CALL
PN$.SN_
     15851**DCL     16597<<ASSIGN  17186<<ASSIGN
PN$.TAB_
     15853**DCL     15853--REDEF
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:231  
PN$.UATTR_
     15852**DCL     16593<<ASSIGN  17182<<ASSIGN
PN$.UHL_
     15851**DCL     15851--REDEF   15851--REDEF
PN$.V_
     15851**DCL     16591>>IF      16592<<ASSIGN  16816>>IF      16869>>IF      16870>>ASSIGN  16874>>IF
     17049>>IF      17149<<ASSIGN  17174>>ASSIGN  17176<<ASSIGN  17191<<ASSIGN  17640>>IF      17816>>CALL
     17818>>ASSIGN  17859>>IF
PN$.WINDOW_
     15852**DCL     17065>>IF      17067>>CALL    17223>>IF      17225>>ASSIGN
PN$.WSN_
     15853**DCL     15853--REDEF
RES
     16148**DCL     16546<<ASSIGN  16558>>IF      16558>>IF      16558>>IF      16601>>ASSIGN  16620>>ASSIGN
     16654>>CALLBLT 16664>>IF      16665>>CALLBLT 16672<<ASSIGN  16675<<ASSIGN  16686<<ASSIGN  16698<<ASSIGN
     16719<<ASSIGN  16725<<ASSIGN  16842>>CALLBLT 16858>>IF      16894>>IF      16985>>IF      16993>>IF
     16993>>IF      16993>>IF      16993>>IF      16998>>CALLBLT 17039>>IF      17039>>IF      17039>>IF
     17039>>IF      17056>>CALLBLT 17127>>IF      17130>>IF      17130>>IF      17137>>ASSIGN
RLCID
     16141**DCL     16942--CALL
RLCID.GENERATION
     16143**DCL     16923<<ASSIGN
RLCID.LDCTX
     16144**DCL     16920<<ASSIGN
RLCID.NODE
     16142**DCL     16919<<ASSIGN
SDCB$ IN PROCEDURE CGINIT
     17385**DCL     17423<<ASSIGN  17425>>ASSIGN  17426>>IF      17430>>ASSIGN  17431>>IF
SOURCEDCB IN PROCEDURE FPRG
     17463**DCL     17442--PROC    17665--ASSIGN  17666--ASSIGN  17668--ASSIGN  17706--IF
SSR$REG
        85**DCL-ENT 16904--CALL    16935--CALL    17688--CALL    17892--CALL
STR
     16150**DCL     16491<<ASSIGN  16493<>CALL    16494>>IF      16496<<ASSIGN  16669>>ASSIGN  16698>>ASSIGN
     16725>>ASSIGN  16759<>CALL
STR IN PROCEDURE CHECK_COMP
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:232  
     17340**DCL     17338--PROC    17348>>IF
STR IN PROCEDURE FPRG
     17462**DCL     17442--PROC    17654>>ASSIGN
TSTFINFO
     16363**DCL     16668<<ASSIGN  16730<<ASSIGN  16734<<ASSIGN  16817>>IF      16818>>IF      16821>>ASSIGN
     16822>>ASSIGN  16836<<ASSIGN  16839>>IF      17192<<ASSIGN  17196<<ASSIGN
UCLDCT$ IN PROCEDURE FPRG
     17637**DCL     17668<<ASSIGN  17669>>ASSIGN  17670>>ASSIGN  17671>>ASSIGN  17672>>ASSIGN
VLP$SETSTA
     15734**DCL     17416--CALL    17419<<ASSIGN
VLP$SETSTA.ISTA
     15738**DCL     17425>>ASSIGN  17428<>CALL
VLP$SETSTA.MYSTATION#
     15738**DCL     17854<>CALL
VLP$SETSTA.OSTA
     15743**DCL     17430>>ASSIGN  17433<>CALL
VLP$STATION
     15789**DCL     17416--CALL    17418--ASSIGN  17422<<ASSIGN
VLP$STATION.MSGIDXT
     15799**DCL     15802--REDEF
VLP$WINDOW
     15887**DCL     17225>>ASSIGN
VLP$WINDOW.FWINDOW#
     15887**DCL     15887--REDEF   15888--REDEF   17067<>CALL
VLP_SETSTA
     15706**DCL     17419>>ASSIGN
VLP_STATION
     15762**DCL     17422>>ASSIGN
VLP_STATION.MSGIDXT
     15772**DCL     15775--REDEF
WINDOW
     15931**DCL     17222<<ASSIGN  17225<<ASSIGN  17240<>CALL
WINDOW.FWINDOW#
     15931**DCL     15931--REDEF   15932--REDEF
WINDOW.POSITION#
     15945**DCL     17228<<ASSIGN
PL6.E3A0      #001=FSN$OPNDEV File=FSN$OPNDEV.:E05TSI                            TUE 07/29/97 17:36 Page:233  
ZEROES
     15848**DCL     16592--ASSIGN  17176--ASSIGN

PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:234  
     1401        1        /*T***********************************************************/
     1402        2        /*T*                                                         */
     1403        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1404        4        /*T*                                                         */
     1405        5        /*T***********************************************************/
     1406        6        FSN$CONV_STR: PROC (STREAMPARM,STREAM) ALTRET;
     1407        7
     1408        8        /*F* NAME: FSN$CONV_STR
     1409        9             PURPOSE: To convert a stream name to a stream number
     1410       10             DESCRIPTION: This module validates the passed stream name and
     1411       11                          then converts the name to a number.  It does this
     1412       12                          by searching the ROSEG for a match or converting
     1413       13                          the name to a number.
     1414       14         */
     1415       15
     1416       16        /* Include files */
     1417       17        %INCLUDE F$JIT_C;
     1418      447        %INCLUDE B$ROSEG;
     1419      510        %INCLUDE F_ERRORS_C;
     1420      750        %INCLUDE F_MACROS_C;
     1421      761
     1422      762        /* Symrefs */
     1423      763    1   DCL B$ROSEG$ PTR SYMREF;
     1424      764    1   DCL B$JIT$ PTR SYMREF;
     1425      765
     1426      766        /* Subs */
     1427      767        %SUB FCG#='0623'O;
     1428      768        %SUB MID#='16'O;
     1429      769
     1430      770        /* Parameters */
     1431      771    1   DCL STREAMPARM CHAR(4) CALIGNED;
     1432      772    1   DCL STREAM UBIN BYTE CALIGNED;
     1433      773
     1434      774        /* Auto */
     1435      775    1   DCL I SBIN;
     1436      776    1   DCL 1 STREAMNAME,
     1437      777    1            2 NN CHAR(2),
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:235  
     1438      778    1            2 NNB REDEF NN BIT(18),
     1439      779    1            2 DD CHAR(2);
     1440      780    1   DCL STREAMNAME_C REDEF STREAMNAME CHAR(4);
     1441      781        %EJECT;
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:236  
     1442      782
     1443      783        /* Error codes */
     1444      784        %ERRCODE (NAME=INVRES,COD#=%E$INVRES);
     1445      788        %ERRCODE (NAME=UNDEFSTREAM,COD#=%E$UNDEFSTREAM);
     1446      792
     1447      793        %EJECT;
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:237  
     1448      794    1        STREAMNAME_C = STREAMPARM;
     1449      795    1        IF STREAMNAME_C = '    '
     1450      796    2        THEN DO;
     1451      797    2             STREAM = 0;
     1452      798    2             RETURN;
     1453      799    2           END;
     1454      800    1        STREAMNAME.NNB = STREAMNAME.NNB&'767767'O;
     1455      801    1        IF STREAMNAME.NN ~= 'UC'
     1456      802    2        THEN DO;
     1457      803    2   INVRESERR:;
     1458      804    2             B$JIT.ERR = INVRES;
     1459      805    2             ALTRETURN;
     1460      806    2           END;
     1461      807    2        DO I = 0 TO 15;
     1462      808    2             IF B$ROSEG$->B$ROSEG.LDEVNAME(I) = STREAMNAME_C
     1463      809    2             THEN EXIT;
     1464      810    2           END;
     1465      811    1        IF I = 16
     1466      812    2        THEN DO;
     1467      813    2             IF ASCBIN(SUBSTR(STREAMNAME.DD,0,1)) < ASCBIN('0')
     1468      814    2                  OR ASCBIN(SUBSTR(STREAMNAME.DD,0,1)) > ASCBIN('9')
     1469      815    2                  OR ASCBIN(SUBSTR(STREAMNAME.DD,1,1)) < ASCBIN('0')
     1470      816    2                  OR ASCBIN(SUBSTR(STREAMNAME.DD,1,1)) > ASCBIN('9')
     1471      817    2             THEN GOTO INVRESERR;
     1472      818    2             I = ASCBIN(SUBSTR(STREAMNAME.DD,1,1)) +
     1473      819    2                  10*ASCBIN(SUBSTR(STREAMNAME.DD,0,1)) +
     1474      820    2                  20 - 10*ASCBIN('0') - ASCBIN('0');
     1475      821    2             IF B$ROSEG$->B$ROSEG.STREAM_VALID(I)
     1476      822    2             THEN EXIT;
     1477      823    2             B$JIT.ERR = UNDEFSTREAM;
     1478      824                  /*E* ERROR: FSN-E$UNDEFSTREAM
     1479      825                       MESSAGE: The specified stream has not been defined.
     1480      826                        */
     1481      827    2             ALTRETURN;
     1482      828    2           END;
     1483      829    1        STREAM = I;
     1484      830    1        RETURN;
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:238  
     1485      831
     1486      832    1   END FSN$CONV_STR;

PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:239  
--  Include file information  --

   F_MACROS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FSN$CONV_STR.

   Procedure FSN$CONV_STR requires 73 words for executable code.
   Procedure FSN$CONV_STR requires 10 words of local(AUTO) storage.

    No errors detected in file FSN$OPNDEV.:E05TSI    .

PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:240  

 Object Unit name= FSN$CONV_STR                               File name= FSN$OPNDEV.:E05TOU
 UTS= JUL 29 '97 17:37:26.40 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      4      4  FSN$CONV_STR
    1   Proc  even  none    73    111  FSN$CONV_STR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  FSN$CONV_STR

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$ROSEG$                              B$JIT$                                B_VECTNIL
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:241  


     1401        1        /*T***********************************************************/
     1402        2        /*T*                                                         */
     1403        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1404        4        /*T*                                                         */
     1405        5        /*T***********************************************************/
     1406        6        FSN$CONV_STR: PROC (STREAMPARM,STREAM) ALTRET;

      6  1 000000   000000 700200 xent  FSN$CONV_STR TSX0  ! X66_AUTO_2
         1 000001   000012 000002                    ZERO    10,2

     1407        7
     1408        8        /*F* NAME: FSN$CONV_STR
     1409        9             PURPOSE: To convert a stream name to a stream number
     1410       10             DESCRIPTION: This module validates the passed stream name and
     1411       11                          then converts the name to a number.  It does this
     1412       12                          by searching the ROSEG for a match or converting
     1413       13                          the name to a number.
     1414       14         */
     1415       15
     1416       16        /* Include files */
     1417       17        %INCLUDE F$JIT_C;
     1418      447        %INCLUDE B$ROSEG;
     1419      510        %INCLUDE F_ERRORS_C;
     1420      750        %INCLUDE F_MACROS_C;
     1421      761
     1422      762        /* Symrefs */
     1423      763    1   DCL B$ROSEG$ PTR SYMREF;
     1424      764    1   DCL B$JIT$ PTR SYMREF;
     1425      765
     1426      766        /* Subs */
     1427      767        %SUB FCG#='0623'O;
     1428      768        %SUB MID#='16'O;
     1429      769
     1430      770        /* Parameters */
     1431      771    1   DCL STREAMPARM CHAR(4) CALIGNED;
     1432      772    1   DCL STREAM UBIN BYTE CALIGNED;
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:242  
     1433      773
     1434      774        /* Auto */
     1435      775    1   DCL I SBIN;
     1436      776    1   DCL 1 STREAMNAME,
     1437      777    1            2 NN CHAR(2),
     1438      778    1            2 NNB REDEF NN BIT(18),
     1439      779    1            2 DD CHAR(2);
     1440      780    1   DCL STREAMNAME_C REDEF STREAMNAME CHAR(4);
     1441      781        %EJECT;
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:243  
     1442      782
     1443      783        /* Error codes */
     1444      784        %ERRCODE (NAME=INVRES,COD#=%E$INVRES);
     1445      788        %ERRCODE (NAME=UNDEFSTREAM,COD#=%E$UNDEFSTREAM);
     1446      792
     1447      793        %EJECT;
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:244  
     1448      794    1        STREAMNAME_C = STREAMPARM;

    794  1 000002   200003 470500                    LDP0    @STREAMPARM,,AUTO
         1 000003   040100 100500                    MLR     fill='040'O
         1 000004   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000005   200006 000004                    ADSC9   STREAMNAME,,AUTO         cn=0,n=4

     1449      795    1        IF STREAMNAME_C = '    '

    795  1 000006   200006 236100                    LDQ     STREAMNAME,,AUTO
         1 000007   000002 116000 0                  CMPQ    UNDEFSTREAM+1
         1 000010   000016 601000 1                  TNZ     s:800

     1450      796    2        THEN DO;

     1451      797    2             STREAM = 0;

    797  1 000011   200004 471500                    LDP1    @STREAM,,AUTO
         1 000012   000100 101400                    MRL     fill='000'O
         1 000013   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         1 000014   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     1452      798    2             RETURN;

    798  1 000015   000000 702200 xent               TSX2  ! X66_ARET

     1453      799    2           END;
     1454      800    1        STREAMNAME.NNB = STREAMNAME.NNB&'767767'O;

    800  1 000016   200006 220100                    LDX0    STREAMNAME,,AUTO
         1 000017   767767 360003                    ANX0    -4105,DU
         1 000020   200006 740100                    STX0    STREAMNAME,,AUTO

     1455      801    1        IF STREAMNAME.NN ~= 'UC'

    801  1 000021   200006 221100                    LDX1    STREAMNAME,,AUTO
         1 000022   000003 101000 0                  CMPX1   UNDEFSTREAM+2
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:245  
         1 000023   000030 600000 1                  TZE     s:807

     1456      802    2        THEN DO;

    798  1 000024                       INVRESERR    null
     1457      803    2   INVRESERR:;
     1458      804    2             B$JIT.ERR = INVRES;

    804  1 000024   000000 236000 0                  LDQ     INVRES
         1 000025   000000 470400 xsym               LDP0    B$JIT$
         1 000026   000012 756100                    STQ     10,,PR0

     1459      805    2             ALTRETURN;

    805  1 000027   000000 702200 xent               TSX2  ! X66_AALT

     1460      806    2           END;
     1461      807    2        DO I = 0 TO 15;

    807  1 000030   200005 450100                    STZ     I,,AUTO

     1462      808    2             IF B$ROSEG$->B$ROSEG.LDEVNAME(I) = STREAMNAME_C

    808  1 000031   000000 470400 xsym               LDP0    B$ROSEG$
         1 000032   200005 720100                    LXL0    I,,AUTO
         1 000033   000054 236110                    LDQ     44,X0,PR0
         1 000034   200006 116100                    CMPQ    STREAMNAME,,AUTO
         1 000035   000042 600000 1                  TZE     s:811

     1463      809    2             THEN EXIT;
     1464      810    2           END;

    810  1 000036   200005 054100                    AOS     I,,AUTO
         1 000037   200005 235100                    LDA     I,,AUTO
         1 000040   000017 115007                    CMPA    15,DL
         1 000041   000031 604400 1                  TMOZ    s:808

PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:246  
     1465      811    1        IF I = 16

    811  1 000042   200005 235100                    LDA     I,,AUTO
         1 000043   000020 115007                    CMPA    16,DL
         1 000044   000104 601000 1                  TNZ     s:829

     1466      812    2        THEN DO;

     1467      813    2             IF ASCBIN(SUBSTR(STREAMNAME.DD,0,1)) < ASCBIN('0')

    813  1 000045   200006 236100                    LDQ     STREAMNAME,,AUTO
         1 000046   000011 772000                    QRL     9
         1 000047   000777 376007                    ANQ     511,DL
         1 000050   000060 116007                    CMPQ    48,DL
         1 000051   000024 602000 1                  TNC     INVRESERR
         1 000052   000072 116007                    CMPQ    58,DL
         1 000053   000024 603000 1                  TRC     INVRESERR
         1 000054   200006 236100                    LDQ     STREAMNAME,,AUTO
         1 000055   000777 376007                    ANQ     511,DL
         1 000056   000060 116007                    CMPQ    48,DL
         1 000057   000024 602000 1                  TNC     INVRESERR
         1 000060   000072 116007                    CMPQ    58,DL
         1 000061   000024 603000 1                  TRC     INVRESERR

     1468      814    2                  OR ASCBIN(SUBSTR(STREAMNAME.DD,0,1)) > ASCBIN('9')
     1469      815    2                  OR ASCBIN(SUBSTR(STREAMNAME.DD,1,1)) < ASCBIN('0')
     1470      816    2                  OR ASCBIN(SUBSTR(STREAMNAME.DD,1,1)) > ASCBIN('9')
     1471      817    2             THEN GOTO INVRESERR;
     1472      818    2             I = ASCBIN(SUBSTR(STREAMNAME.DD,1,1)) +

    818  1 000062   200010 756100                    STQ     STREAMNAME+2,,AUTO
         1 000063   200006 236100                    LDQ     STREAMNAME,,AUTO
         1 000064   000011 772000                    QRL     9
         1 000065   000777 376007                    ANQ     511,DL
         1 000066   000012 402007                    MPY     10,DL
         1 000067   200010 036100                    ADLQ    STREAMNAME+2,,AUTO
         1 000070   000774 136007                    SBLQ    508,DL
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:247  
         1 000071   200005 756100                    STQ     I,,AUTO

     1473      819    2                  10*ASCBIN(SUBSTR(STREAMNAME.DD,0,1)) +
     1474      820    2                  20 - 10*ASCBIN('0') - ASCBIN('0');
     1475      821    2             IF B$ROSEG$->B$ROSEG.STREAM_VALID(I)

    821  1 000072   000074 605000 1                  TPL     s:821+2
         1 000073   000044 036003                    ADLQ    36,DU
         1 000074   000000 066506                    CMPB    filb='0'B
         1 000075   000117 000001                    BDSC    79,Q,PR0                 by=0,bit=0,n=1
         1 000076   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000077   000104 601000 1                  TNZ     s:829

     1476      822    2             THEN EXIT;
     1477      823    2             B$JIT.ERR = UNDEFSTREAM;

    823  1 000100   000001 236000 0                  LDQ     UNDEFSTREAM
         1 000101   000000 471400 xsym               LDP1    B$JIT$
         1 000102   100012 756100                    STQ     10,,PR1

     1478      824                  /*E* ERROR: FSN-E$UNDEFSTREAM
     1479      825                       MESSAGE: The specified stream has not been defined.
     1480      826                        */
     1481      827    2             ALTRETURN;

    827  1 000103   000000 702200 xent               TSX2  ! X66_AALT

     1482      828    2           END;
     1483      829    1        STREAM = I;

    829  1 000104   200004 471500                    LDP1    @STREAM,,AUTO
         1 000105   000100 101500                    MRL     fill='000'O
         1 000106   200005 000004                    ADSC9   I,,AUTO                  cn=0,n=4
         1 000107   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

     1484      830    1        RETURN;

PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:248  
    830  1 000110   000000 702200 xent               TSX2  ! X66_ARET

INVRES
 Sect OctLoc
   0     000   062316 001702                                                    2...

UNDEFSTREAM
 Sect OctLoc
   0     001   062316 014052                                                    2..*

(unnamed)
 Sect OctLoc
   0     002   040040 040040   125103 040040                                        UC
     1485      831
     1486      832    1   END FSN$CONV_STR;

PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:249  
--  Include file information  --

   F_MACROS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FSN$CONV_STR.
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:250  

 **** Variables and constants ****

  ****  Section 000 RoData FSN$CONV_STR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 INVRES                     1-0-0/b STRC        r     1 UNDEFSTREAM

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @STREAM                    3-0-0/w PTR         r     1 @STREAMPARM
     5-0-0/w SBIN        r     1 I                         *0-0-0/c UBIN(9)     r     1 STREAM
     6-0-0/c STRC        r     1 STREAMNAME                 6-0-0/c CHAR(4)     r     1 STREAMNAME_C
    *0-0-0/c CHAR(4)     r     1 STREAMPARM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$ROSEG$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(3024)  r     1 B$ROSEG


   Procedure FSN$CONV_STR requires 73 words for executable code.
   Procedure FSN$CONV_STR requires 10 words of local(AUTO) storage.
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:251  

    No errors detected in file FSN$OPNDEV.:E05TSI    .
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:252  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:253  
          MINI XREF LISTING

B$JIT.ERR
       344**DCL       804<<ASSIGN    823<<ASSIGN
B$JIT.ERR.MID
       345**DCL       345--REDEF
B$JIT$
       764**DCL       339--IMP-PTR   804>>ASSIGN    823>>ASSIGN
B$ROSEG.LDEVNAME
       468**DCL       808>>IF
B$ROSEG.STREAM_VALID
       490**DCL       821>>IF
B$ROSEG$
       763**DCL       808>>IF        821>>IF
I
       775**DCL       807<<DOINDEX   808>>IF        811>>IF        818<<ASSIGN    821>>IF        829>>ASSIGN
INVRES
       785**DCL       804>>ASSIGN
INVRESERR
       798**LABEL     817--GOTO
STREAM
       772**DCL         6--PROC      797<<ASSIGN    829<<ASSIGN
STREAMNAME
       776**DCL       780--REDEF
STREAMNAME.DD
       779**DCL       813>>IF        813>>IF        813>>IF        813>>IF        818>>ASSIGN    818>>ASSIGN
STREAMNAME.NN
       777**DCL       778--REDEF     801>>IF
STREAMNAME.NNB
       778**DCL       800<<ASSIGN    800>>ASSIGN
STREAMNAME_C
       780**DCL       794<<ASSIGN    795>>IF        808>>IF
STREAMPARM
       771**DCL         6--PROC      794>>ASSIGN
PL6.E3A0      #002=FSN$CONV_STR File=FSN$OPNDEV.:E05TSI                          TUE 07/29/97 17:37 Page:254  
UNDEFSTREAM
       789**DCL       823>>ASSIGN
