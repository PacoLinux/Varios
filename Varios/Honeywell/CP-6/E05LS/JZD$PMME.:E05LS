VERSION E05

PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:1    
        1        1        /*M* JZD$PMME - PMME handlers for M$FSUSER, M$ASUSER, M$DSUSER.    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8        JZD$FSUSER: PROC ALTRET;
        9        9        /**/
       10       10    1   DCL BLOCK$ PTR;
       11       11    1   DCL USER# UBIN BYTE UNAL;
       12       12    1   DCL B$JIT$ PTR SYMREF READONLY;
       13       13    1   DCL B$M$UC$ PTR SYMREF READONLY;
       14       14        /**/
       15       15        %INCLUDE B$JIT_C;
       16      329                %B$JIT0;
       17      418                %U$JIT1;
       18      492                %M$JIT2X;
       19      495                %F$JIT3;
       20      500                %S$JIT4X;
       21      503                %J$JIT5;
       22      591                %A$JIT6;
       23      601        %INCLUDE B$P;
       24      685        %INCLUDE B$USER;
       25      901        %B$USERREFS;
       26      905        %INCLUDE F$DCB;
       27      954        %INCLUDE J_ERRORS_C;
       28     1041        %INCLUDE J_ERRSET_C;
       29     1061        %INCLUDE JZ_DATA_R;
       30     1614        %INCLUDE SS_SCHED_C;
       31     1847        %INCLUDE CP_6_SUBS;
       32     2387        /**/
       33     2388    1   DCL FMM$DFLOPN ENTRY;
       34     2389    1   DCL JZC$FIND ENTRY(3) ALTRET;
       35     2390    1   DCL SSR$RUE ENTRY(4);
       36     2391
       37     2392    1   DCL 1 J_LOGON SYMREF READONLY,
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:2    
       38     2393    1         2 CNT UBIN(9) UNAL,
       39     2394    1         2 NAME CHAR(7) UNAL;
       40     2395
       41     2396        %SUB    B$P=B$P$->B$P;
       42     2397        %SUB    B$U=S$CU$->B$U;
       43     2398        %SUB    B$USRT=B$USRT$->B$USER;
       44     2399        %SUB    M$UC=B$M$UC$->F$DCB;
       45     2400
       46     2401        %INCLUDE UD_SEV_C;
       47     2415        %SUB FCG#='1232'O;
       48     2416        %SUB MID#='04'O;
       49     2417        %ERRCODE (NAME=EJZLOGONONLY,COD#=%E$JZLOGONONLY);
       50     2425        %ERRCODE (NAME=EJZNOPROG,COD#=%E$JZNOPROG);
       51     2433        %INCLUDE XUD_UTS_M;
       52     2515        %XUD$UTS_ENTRIES;
       53     2547        %XUD_UTS_EQU;
       54     2558        %EJECT;
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:3    
       55     2559        /*F*    NAME:   JZD$FSUSER
       56     2560                PURPOSE: To process the M$FSUSER PMME.
       57     2561                DESCRIPTION: The list of suspended users is searched for an
       58     2562                        entry having the same [account, name] as the current
       59     2563                        user. If one is found, its wait time is increased by
       60     2564                        30 seconds to allow for slow typists trying to
       61     2565                        reconnect to their saved programs.                 */
       62     2566        /**/
       63     2567        /* This service is restricted to use by LOGON */
       64     2568    1      IF B$P.NAME.TEXT(B$U.ACP) ~= J_LOGON.NAME THEN GOTO NOT_LOGON;
       65     2569    1      CALL JZC$FIND(B$JIT.ACCN,B$JIT.UNAME,BLOCK$) ALTRET(NOT_SAVED);
       66     2570    1      USER# = BLOCK$->JZ$INFO.USER#;
       67     2571    1      CALL XUD$UTS_ADJUST (B$USRT.MISC(USER#), B$USRT.MISC(USER#), 30*%UTS_CSEC_SEC#);
       68     2572    1      RETURN;
       69     2573        /**/
       70     2574        %EJECT;
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:4    
       71     2575        /*F*    NAME:   JZD$ASUSER
       72     2576                PURPOSE: To process the M$ASUSER PMME.
       73     2577                DESCRIPTION: The list of suspended users is searched for
       74     2578                        one having the same [account, name] as the current
       75     2579                        user. When one is found, the information defining
       76     2580                        the current user's front end connection is passed
       77     2581                        to the sleeping user via his autosave block, and the
       78     2582                        current user's M$UC DCB is set to 'NO', allowing
       79     2583                        him to be logged off silently.  The suspended user is
       80     2584                        then caused to resume execution.                   */
       81     2585    1   JZD$ASUSER: ENTRY ALTRET;
       82     2586        /**/
       83     2587    1      IF B$P.NAME.TEXT(B$U.ACP) ~= J_LOGON.NAME THEN GOTO NOT_LOGON;
       84     2588    1      CALL JZC$FIND(B$JIT.ACCN,B$JIT.UNAME,BLOCK$) ALTRET(NOT_SAVED);
       85     2589    1      USER# = BLOCK$->JZ$INFO.USER#;
       86     2590        /*   Get this user's LDCTx & store it into the autosave block */
       87     2591    1      BLOCK$->JZ$INFO.LDCT# = M$UC.LDCTX;
       88     2592    1      BLOCK$->JZ$INFO.TSLINE# = B$JIT.TSLINE;
       89     2593        /* Make this user's M$UC DCB look like device 'NO', so that any    */
       90     2594        /* output generated by the logoff process will get swallowed.      */
       91     2595    1      M$UC.FCD = '0'B;
       92     2596    1      M$UC.ASN = %DEVICE#;
       93     2597    1      M$UC.RES = 'NO';
       94     2598    1      M$UC.WSN = ' ';
       95     2599    1      B$JIT.DCB$ = B$M$UC$;
       96     2600    1      CALL FMM$DFLOPN;
       97     2601        /* And set LDCTX to zero so that if we ever do call NKU$UCCLS or
       98     2602           NKU$DRQ, we'll screech instead of zapping some poor soul's line */
       99     2603    1      M$UC.LDCTX = 0;
      100     2604        /* Wake up the suspended user */
      101     2605    1      CALL SSR$RUE(%SS_WU,USER#);
      102     2606    1      RETURN;
      103     2607        /**/
      104     2608        %EJECT;
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:5    
      105     2609        /*F*    NAME:   JZD$DSUSER
      106     2610                PURPOSE: To process the M$DSUSER PMME.
      107     2611                DESCRIPTION: The list of suspended user's is searched for
      108     2612                        one having the same [account, name] as the current
      109     2613                        user. If found, MISC is zeroed, wake-up event is issued
      110     2614                        for the suspended program, causing it to be woken up
      111     2615                        and subsequently rundown and logged off.           */
      112     2616    1   JZD$DSUSER: ENTRY ALTRET;
      113     2617        /**/
      114     2618    1      IF B$P.NAME.TEXT(B$U.ACP) ~= J_LOGON.NAME THEN GOTO NOT_LOGON;
      115     2619    1      CALL JZC$FIND(B$JIT.ACCN,B$JIT.UNAME,BLOCK$) ALTRET(NOT_SAVED);
      116     2620    1      USER# = BLOCK$->JZ$INFO.USER#;
      117     2621    1      B$USRT.MISC(USER#) = 0;
      118     2622    1      CALL SSR$RUE(%SS_WU,USER#);
      119     2623    1      RETURN;
      120     2624        /**/
      121     2625        /**/
      122     2626    1   NOT_LOGON:
      123     2627        /*E*    ERROR:  JZD-E$JZLOGONONLY-A
      124     2628                MESSAGE: That Service Request may only be used by LOGON. */
      125     2629    1      B$JIT.ERR=EJZLOGONONLY;
      126     2630    1      ALTRETURN;
      127     2631        /**/
      128     2632        /*NOT_SAVED:*/
      129     2633        /*E*    ERROR:  JZD-E$JZSTREAM-A
      130     2634         MESSAGE: There are FEP streams which make reconnect impossible, * files have been m
              2634        oved to this user. */
      131     2635        /* B$JIT.ERR=EJZSTREAM;*/
      132     2636        /* ALTRETURN;*/
      133     2637        /**/
      134     2638    1   NOT_SAVED:
      135     2639        /*E*    ERROR:  JZD-E$JZNOPROG-A
      136     2640                MESSAGE: There is no suspended program for the current user */
      137     2641    1      B$JIT.ERR=EJZNOPROG;
      138     2642    1      ALTRETURN;
      139     2643        /**/
      140     2644    1   END JZD$FSUSER;
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:6    

PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:7    
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   JZ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   J_ERRSET_C.:E05TOU  is referenced.
   J_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure JZD$FSUSER.

   Procedure JZD$FSUSER requires 166 words for executable code.
   Procedure JZD$FSUSER requires 10 words of local(AUTO) storage.

    No errors detected in file JZD$PMME.:E05TSI    .

PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:8    

 Object Unit name= JZD$FSUSER                                 File name= JZD$PMME.:E05TOU
 UTS= JUL 29 '97 23:53:39.92 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      3      3  JZD$FSUSER
    1   Proc  even  none   166    246  JZD$FSUSER
    2  RoData even  none     5      5  JZD$FSUSER

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        0  JZD$FSUSER
     1     57          yes     yes      Std        0  JZD$ASUSER
     1    162          yes     yes      Std        0  JZD$DSUSER

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 JZC$FIND
 yes     yes           Std       3 XUD$UTS_ADJUST
         yes           Std       0 FMM$DFLOPN
         yes           Std       4 SSR$RUE
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:9    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    B$JIT$                           r    B$M$UC$                               B$P$
     S$CU$                                 B$USRT$                               JZ_PAGE
r    J_LOGON                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:10   


        1        1        /*M* JZD$PMME - PMME handlers for M$FSUSER, M$ASUSER, M$DSUSER.    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8        JZD$FSUSER: PROC ALTRET;

      8  1 000000   000000 700200 xent  JZD$FSUSER   TSX0  ! X66_AUTO_0
         1 000001   000012 000000                    ZERO    10,0

        9        9        /**/
       10       10    1   DCL BLOCK$ PTR;
       11       11    1   DCL USER# UBIN BYTE UNAL;
       12       12    1   DCL B$JIT$ PTR SYMREF READONLY;
       13       13    1   DCL B$M$UC$ PTR SYMREF READONLY;
       14       14        /**/
       15       15        %INCLUDE B$JIT_C;
       16      329                %B$JIT0;
       17      418                %U$JIT1;
       18      492                %M$JIT2X;
       19      495                %F$JIT3;
       20      500                %S$JIT4X;
       21      503                %J$JIT5;
       22      591                %A$JIT6;
       23      601        %INCLUDE B$P;
       24      685        %INCLUDE B$USER;
       25      901        %B$USERREFS;
       26      905        %INCLUDE F$DCB;
       27      954        %INCLUDE J_ERRORS_C;
       28     1041        %INCLUDE J_ERRSET_C;
       29     1061        %INCLUDE JZ_DATA_R;
       30     1614        %INCLUDE SS_SCHED_C;
       31     1847        %INCLUDE CP_6_SUBS;
       32     2387        /**/
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:11   
       33     2388    1   DCL FMM$DFLOPN ENTRY;
       34     2389    1   DCL JZC$FIND ENTRY(3) ALTRET;
       35     2390    1   DCL SSR$RUE ENTRY(4);
       36     2391
       37     2392    1   DCL 1 J_LOGON SYMREF READONLY,
       38     2393    1         2 CNT UBIN(9) UNAL,
       39     2394    1         2 NAME CHAR(7) UNAL;
       40     2395
       41     2396        %SUB    B$P=B$P$->B$P;
       42     2397        %SUB    B$U=S$CU$->B$U;
       43     2398        %SUB    B$USRT=B$USRT$->B$USER;
       44     2399        %SUB    M$UC=B$M$UC$->F$DCB;
       45     2400
       46     2401        %INCLUDE UD_SEV_C;
       47     2415        %SUB FCG#='1232'O;
       48     2416        %SUB MID#='04'O;
       49     2417        %ERRCODE (NAME=EJZLOGONONLY,COD#=%E$JZLOGONONLY);
       50     2425        %ERRCODE (NAME=EJZNOPROG,COD#=%E$JZNOPROG);
       51     2433        %INCLUDE XUD_UTS_M;
       52     2515        %XUD$UTS_ENTRIES;
       53     2547        %XUD_UTS_EQU;
       54     2558        %EJECT;
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:12   
       55     2559        /*F*    NAME:   JZD$FSUSER
       56     2560                PURPOSE: To process the M$FSUSER PMME.
       57     2561                DESCRIPTION: The list of suspended users is searched for an
       58     2562                        entry having the same [account, name] as the current
       59     2563                        user. If one is found, its wait time is increased by
       60     2564                        30 seconds to allow for slow typists trying to
       61     2565                        reconnect to their saved programs.                 */
       62     2566        /**/
       63     2567        /* This service is restricted to use by LOGON */
       64     2568    1      IF B$P.NAME.TEXT(B$U.ACP) ~= J_LOGON.NAME THEN GOTO NOT_LOGON;

   2568  1 000002   000000 470400 xsym               LDP0    S$CU$
         1 000003   000006 236100                    LDQ     6,,PR0
         1 000004   000022 772000                    QRL     18
         1 000005   000777 376007                    ANQ     511,DL
         1 000006   000021 402007                    MPY     17,DL
         1 000007   000003 736000                    QLS     3
         1 000010   000000 471400 xsym               LDP1    B$P$
         1 000011   040000 106506                    CMPC    fill='040'O
         1 000012   100032 200037                    ADSC9   26,Q,PR1                 cn=1,n=31
         1 000013   000000 200007 xsym               ADSC9   J_LOGON                  cn=1,n=7
         1 000014   000236 601000 1                  TNZ     NOT_LOGON

       65     2569    1      CALL JZC$FIND(B$JIT.ACCN,B$JIT.UNAME,BLOCK$) ALTRET(NOT_SAVED);

   2569  1 000015   200003 633500                    EPPR3   BLOCK$,,AUTO
         1 000016   200010 453500                    STP3    USER#+4,,AUTO
         1 000017   000000 236000 xsym               LDQ     B$JIT$
         1 000020   000003 036003                    ADLQ    3,DU
         1 000021   200007 756100                    STQ     USER#+3,,AUTO
         1 000022   000000 236000 xsym               LDQ     B$JIT$
         1 000023   000001 036003                    ADLQ    1,DU
         1 000024   200006 756100                    STQ     USER#+2,,AUTO
         1 000025   200006 630500                    EPPR0   USER#+2,,AUTO
         1 000026   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000027   000000 701000 xent               TSX1    JZC$FIND
         1 000030   000242 702000 1                  TSX2    NOT_SAVED
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:13   

       66     2570    1      USER# = BLOCK$->JZ$INFO.USER#;

   2570  1 000031   200003 470500                    LDP0    BLOCK$,,AUTO
         1 000032   000002 236100                    LDQ     2,,PR0
         1 000033   000033 772000                    QRL     27
         1 000034   000033 736000                    QLS     27
         1 000035   200004 756100                    STQ     USER#,,AUTO

       67     2571    1      CALL XUD$UTS_ADJUST (B$USRT.MISC(USER#), B$USRT.MISC(USER#), 30*%UTS_CSEC_SEC#);

   2571  1 000036   200004 236100                    LDQ     USER#,,AUTO
         1 000037   000027 772000                    QRL     23
         1 000040   017760 376007                    ANQ     8176,DL
         1 000041   000000 620006                    EAX0    0,QL
         1 000042   000001 236000 2                  LDQ     1
         1 000043   200010 756100                    STQ     USER#+4,,AUTO
         1 000044   000017 636010                    EAQ     15,X0
         1 000045   000000 036000 xsym               ADLQ    B$USRT$
         1 000046   200007 756100                    STQ     USER#+3,,AUTO
         1 000047   000017 636010                    EAQ     15,X0
         1 000050   000000 036000 xsym               ADLQ    B$USRT$
         1 000051   200006 756100                    STQ     USER#+2,,AUTO
         1 000052   200006 630500                    EPPR0   USER#+2,,AUTO
         1 000053   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000054   000000 701000 xent               TSX1    XUD$UTS_ADJUST
         1 000055   000000 011000                    NOP     0

       68     2572    1      RETURN;

   2572  1 000056   000000 702200 xent               TSX2  ! X66_ARET

       69     2573        /**/
       70     2574        %EJECT;
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:14   
       71     2575        /*F*    NAME:   JZD$ASUSER
       72     2576                PURPOSE: To process the M$ASUSER PMME.
       73     2577                DESCRIPTION: The list of suspended users is searched for
       74     2578                        one having the same [account, name] as the current
       75     2579                        user. When one is found, the information defining
       76     2580                        the current user's front end connection is passed
       77     2581                        to the sleeping user via his autosave block, and the
       78     2582                        current user's M$UC DCB is set to 'NO', allowing
       79     2583                        him to be logged off silently.  The suspended user is
       80     2584                        then caused to resume execution.                   */
       81     2585    1   JZD$ASUSER: ENTRY ALTRET;

   2585  1 000057   000000 700200 xent  JZD$ASUSER   TSX0  ! X66_AUTO_0
         1 000060   000012 000000                    ZERO    10,0

       82     2586        /**/
       83     2587    1      IF B$P.NAME.TEXT(B$U.ACP) ~= J_LOGON.NAME THEN GOTO NOT_LOGON;

   2587  1 000061   000000 470400 xsym               LDP0    S$CU$
         1 000062   000006 236100                    LDQ     6,,PR0
         1 000063   000022 772000                    QRL     18
         1 000064   000777 376007                    ANQ     511,DL
         1 000065   000021 402007                    MPY     17,DL
         1 000066   000003 736000                    QLS     3
         1 000067   000000 471400 xsym               LDP1    B$P$
         1 000070   040000 106506                    CMPC    fill='040'O
         1 000071   100032 200037                    ADSC9   26,Q,PR1                 cn=1,n=31
         1 000072   000000 200007 xsym               ADSC9   J_LOGON                  cn=1,n=7
         1 000073   000236 601000 1                  TNZ     NOT_LOGON

       84     2588    1      CALL JZC$FIND(B$JIT.ACCN,B$JIT.UNAME,BLOCK$) ALTRET(NOT_SAVED);

   2588  1 000074   200003 633500                    EPPR3   BLOCK$,,AUTO
         1 000075   200010 453500                    STP3    USER#+4,,AUTO
         1 000076   000000 236000 xsym               LDQ     B$JIT$
         1 000077   000003 036003                    ADLQ    3,DU
         1 000100   200007 756100                    STQ     USER#+3,,AUTO
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:15   
         1 000101   000000 236000 xsym               LDQ     B$JIT$
         1 000102   000001 036003                    ADLQ    1,DU
         1 000103   200006 756100                    STQ     USER#+2,,AUTO
         1 000104   200006 630500                    EPPR0   USER#+2,,AUTO
         1 000105   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000106   000000 701000 xent               TSX1    JZC$FIND
         1 000107   000242 702000 1                  TSX2    NOT_SAVED

       85     2589    1      USER# = BLOCK$->JZ$INFO.USER#;

   2589  1 000110   200003 470500                    LDP0    BLOCK$,,AUTO
         1 000111   000002 236100                    LDQ     2,,PR0
         1 000112   000033 772000                    QRL     27
         1 000113   000033 736000                    QLS     27
         1 000114   200004 756100                    STQ     USER#,,AUTO

       86     2590        /*   Get this user's LDCTx & store it into the autosave block */
       87     2591    1      BLOCK$->JZ$INFO.LDCT# = M$UC.LDCTX;

   2591  1 000115   000000 471400 xsym               LDP1    B$M$UC$
         1 000116   100051 236100                    LDQ     41,,PR1
         1 000117   000011 772000                    QRL     9
         1 000120   000002 552130                    STBQ    2,'30'O,PR0

       88     2592    1      BLOCK$->JZ$INFO.TSLINE# = B$JIT.TSLINE;

   2592  1 000121   000000 470400 xsym               LDP0    B$JIT$
         1 000122   000337 236100                    LDQ     223,,PR0
         1 000123   200003 473500                    LDP3    BLOCK$,,AUTO
         1 000124   300001 756100                    STQ     1,,PR3

       89     2593        /* Make this user's M$UC DCB look like device 'NO', so that any    */
       90     2594        /* output generated by the logoff process will get swallowed.      */
       91     2595    1      M$UC.FCD = '0'B;

   2595  1 000125   000002 236000 2                  LDQ     2
         1 000126   100031 356100                    ANSQ    25,,PR1
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:16   

       92     2596    1      M$UC.ASN = %DEVICE#;

   2596  1 000127   003000 236007                    LDQ     1536,DL
         1 000130   100032 552110                    STBQ    26,'10'O,PR1

       93     2597    1      M$UC.RES = 'NO';

   2597  1 000131   000002 236000 0                  LDQ     EJZNOPROG+1
         1 000132   777777 376003                    ANQ     -1,DU
         1 000133   040040 276007                    ORQ     16416,DL
         1 000134   100026 756100                    STQ     22,,PR1

       94     2598    1      M$UC.WSN = ' ';

   2598  1 000135   000035 235000 xsym               LDA     B_VECTNIL+29
         1 000136   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000137   100027 755100                    STA     23,,PR1
         1 000140   100030 756100                    STQ     24,,PR1

       95     2599    1      B$JIT.DCB$ = B$M$UC$;

   2599  1 000141   000000 236000 xsym               LDQ     B$M$UC$
         1 000142   000232 756100                    STQ     154,,PR0

       96     2600    1      CALL FMM$DFLOPN;

   2600  1 000143   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000144   000000 701000 xent               TSX1    FMM$DFLOPN
         1 000145   000000 011000                    NOP     0

       97     2601        /* And set LDCTX to zero so that if we ever do call NKU$UCCLS or
       98     2602           NKU$DRQ, we'll screech instead of zapping some poor soul's line */
       99     2603    1      M$UC.LDCTX = 0;

   2603  1 000146   000000 220003                    LDX0    0,DU
         1 000147   000000 470400 xsym               LDP0    B$M$UC$
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:17   
         1 000150   000051 740100                    STX0    41,,PR0

      100     2604        /* Wake up the suspended user */
      101     2605    1      CALL SSR$RUE(%SS_WU,USER#);

   2605  1 000151   200004 631500                    EPPR1   USER#,,AUTO
         1 000152   200007 451500                    STP1    USER#+3,,AUTO
         1 000153   000004 236000 2                  LDQ     4
         1 000154   200006 756100                    STQ     USER#+2,,AUTO
         1 000155   200006 630500                    EPPR0   USER#+2,,AUTO
         1 000156   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000157   000000 701000 xent               TSX1    SSR$RUE
         1 000160   000000 011000                    NOP     0

      102     2606    1      RETURN;

   2606  1 000161   000000 702200 xent               TSX2  ! X66_ARET

      103     2607        /**/
      104     2608        %EJECT;
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:18   
      105     2609        /*F*    NAME:   JZD$DSUSER
      106     2610                PURPOSE: To process the M$DSUSER PMME.
      107     2611                DESCRIPTION: The list of suspended user's is searched for
      108     2612                        one having the same [account, name] as the current
      109     2613                        user. If found, MISC is zeroed, wake-up event is issued
      110     2614                        for the suspended program, causing it to be woken up
      111     2615                        and subsequently rundown and logged off.           */
      112     2616    1   JZD$DSUSER: ENTRY ALTRET;

   2616  1 000162   000000 700200 xent  JZD$DSUSER   TSX0  ! X66_AUTO_0
         1 000163   000012 000000                    ZERO    10,0

      113     2617        /**/
      114     2618    1      IF B$P.NAME.TEXT(B$U.ACP) ~= J_LOGON.NAME THEN GOTO NOT_LOGON;

   2618  1 000164   000000 470400 xsym               LDP0    S$CU$
         1 000165   000006 236100                    LDQ     6,,PR0
         1 000166   000022 772000                    QRL     18
         1 000167   000777 376007                    ANQ     511,DL
         1 000170   000021 402007                    MPY     17,DL
         1 000171   000003 736000                    QLS     3
         1 000172   000000 471400 xsym               LDP1    B$P$
         1 000173   040000 106506                    CMPC    fill='040'O
         1 000174   100032 200037                    ADSC9   26,Q,PR1                 cn=1,n=31
         1 000175   000000 200007 xsym               ADSC9   J_LOGON                  cn=1,n=7
         1 000176   000236 601000 1                  TNZ     NOT_LOGON

      115     2619    1      CALL JZC$FIND(B$JIT.ACCN,B$JIT.UNAME,BLOCK$) ALTRET(NOT_SAVED);

   2619  1 000177   200003 633500                    EPPR3   BLOCK$,,AUTO
         1 000200   200010 453500                    STP3    USER#+4,,AUTO
         1 000201   000000 236000 xsym               LDQ     B$JIT$
         1 000202   000003 036003                    ADLQ    3,DU
         1 000203   200007 756100                    STQ     USER#+3,,AUTO
         1 000204   000000 236000 xsym               LDQ     B$JIT$
         1 000205   000001 036003                    ADLQ    1,DU
         1 000206   200006 756100                    STQ     USER#+2,,AUTO
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:19   
         1 000207   200006 630500                    EPPR0   USER#+2,,AUTO
         1 000210   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000211   000000 701000 xent               TSX1    JZC$FIND
         1 000212   000242 702000 1                  TSX2    NOT_SAVED

      116     2620    1      USER# = BLOCK$->JZ$INFO.USER#;

   2620  1 000213   200003 470500                    LDP0    BLOCK$,,AUTO
         1 000214   000002 236100                    LDQ     2,,PR0
         1 000215   000033 772000                    QRL     27
         1 000216   000033 736000                    QLS     27
         1 000217   200004 756100                    STQ     USER#,,AUTO

      117     2621    1      B$USRT.MISC(USER#) = 0;

   2621  1 000220   200004 236100                    LDQ     USER#,,AUTO
         1 000221   000027 772000                    QRL     23
         1 000222   017760 376007                    ANQ     8176,DL
         1 000223   000000 471400 xsym               LDP1    B$USRT$
         1 000224   100017 450106                    STZ     15,QL,PR1

      118     2622    1      CALL SSR$RUE(%SS_WU,USER#);

   2622  1 000225   200004 630500                    EPPR0   USER#,,AUTO
         1 000226   200007 450500                    STP0    USER#+3,,AUTO
         1 000227   000004 236000 2                  LDQ     4
         1 000230   200006 756100                    STQ     USER#+2,,AUTO
         1 000231   200006 630500                    EPPR0   USER#+2,,AUTO
         1 000232   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000233   000000 701000 xent               TSX1    SSR$RUE
         1 000234   000000 011000                    NOP     0

      119     2623    1      RETURN;

   2623  1 000235   000000 702200 xent               TSX2  ! X66_ARET

      120     2624        /**/
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:20   
      121     2625        /**/
      122     2626    1   NOT_LOGON:
      123     2627        /*E*    ERROR:  JZD-E$JZLOGONONLY-A
      124     2628                MESSAGE: That Service Request may only be used by LOGON. */
      125     2629    1      B$JIT.ERR=EJZLOGONONLY;

   2629  1 000236   000000 236000 0     NOT_LOGON    LDQ     EJZLOGONONLY
         1 000237   000000 473400 xsym               LDP3    B$JIT$
         1 000240   300012 756100                    STQ     10,,PR3

      126     2630    1      ALTRETURN;

   2630  1 000241   000000 702200 xent               TSX2  ! X66_AALT

      127     2631        /**/
      128     2632        /*NOT_SAVED:*/
      129     2633        /*E*    ERROR:  JZD-E$JZSTREAM-A
      130     2634        MESSAGE: There are FEP streams which make reconnect impossible, * files have been m
              2634        oved to this user. */
      131     2635        /* B$JIT.ERR=EJZSTREAM;*/
      132     2636        /* ALTRETURN;*/
      133     2637        /**/
      134     2638    1   NOT_SAVED:
      135     2639        /*E*    ERROR:  JZD-E$JZNOPROG-A
      136     2640                MESSAGE: There is no suspended program for the current user */
      137     2641    1      B$JIT.ERR=EJZNOPROG;

   2641  1 000242   000001 236000 0     NOT_SAVED    LDQ     EJZNOPROG
         1 000243   000000 470400 xsym               LDP0    B$JIT$
         1 000244   000012 756100                    STQ     10,,PR0

      138     2642    1      ALTRETURN;

   2642  1 000245   000000 702200 xent               TSX2  ! X66_AALT

EJZLOGONONLY
 Sect OctLoc
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:21   
   0     000   123204 405374                                                    S...

EJZNOPROG
 Sect OctLoc
   0     001   123204 405364                                                    S...

(unnamed)
 Sect OctLoc
   0     002   116117 040040                                                    NO

(unnamed)
 Sect OctLoc
   2     000   000000 005670   000000 006000   777777 757777   000000 000027    ................
   2     004   000003 006000                                                    ....
      139     2643        /**/
      140     2644    1   END JZD$FSUSER;

PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:22   
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   JZ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   J_ERRSET_C.:E05TOU  is referenced.
   J_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure JZD$FSUSER.
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:23   

 **** Variables and constants ****

  ****  Section 000 RoData JZD$FSUSER

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 EJZLOGONONLY               1-0-0/b STRC        r     1 EJZNOPROG

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 BLOCK$                     4-0-0/b UBIN(9)     r     1 USER#

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$UC$
     0-0-0/w PTR         r     1 B$P$                       0-0-0/w PTR         r     1 B$USRT$
     0-0-0/c STRC(72)    r     1 J_LOGON                    0-0-0/w PTR         r     1 S$CU$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(1224)  r     1 B$P(0:0)
     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/w STRC(576)   r     1 B$USER(0:0)
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(4896)  r     1 JZ$INFO


   Procedure JZD$FSUSER requires 166 words for executable code.
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:24   
   Procedure JZD$FSUSER requires 10 words of local(AUTO) storage.

    No errors detected in file JZD$PMME.:E05TSI    .
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:25   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:26   
          MINI XREF LISTING

B$DO.ECCINFO
       836**DCL       837--REDEF
B$JIT.ACCN
       335**DCL      2569<>CALL     2588<>CALL     2619<>CALL
B$JIT.CPFLAGS1.SLEAZE
       429**DCL       429--REDEF
B$JIT.DCB$
       496**DCL      2599<<ASSIGN
B$JIT.ERR
       335**DCL      2629<<ASSIGN   2641<<ASSIGN
B$JIT.ERR.MID
       336**DCL       336--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       596**DCL       596--REDEF     597--REDEF
B$JIT.TSLINE
       594**DCL       595--REDEF    2592>>ASSIGN
B$JIT.UNAME
       335**DCL      2569<>CALL     2588<>CALL     2619<>CALL
B$JIT$
        12**DCL       330--IMP-PTR  2569>>CALL     2569>>CALL     2588>>CALL     2588>>CALL     2592>>ASSIGN
      2599>>ASSIGN   2619>>CALL     2619>>CALL     2629>>ASSIGN   2641>>ASSIGN
B$M$UC$
        13**DCL      2591>>ASSIGN   2595>>ASSIGN   2596>>ASSIGN   2597>>ASSIGN   2598>>ASSIGN   2599>>ASSIGN
      2603>>ASSIGN
B$P.NAME.TEXT
       635**DCL      2568>>IF       2587>>IF       2618>>IF
B$P$
       663**DCL      2568>>IF       2587>>IF       2618>>IF
B$U.ACP
       792**DCL      2568>>IF       2587>>IF       2618>>IF
B$U.MISC
       815**DCL       816--REDEF
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:27   
B$USER.MISC
       891**DCL       892--REDEF    2571<>CALL     2571<>CALL     2621<<ASSIGN
B$USRT$
       903**DCL      2571>>CALL     2571>>CALL     2621>>ASSIGN
BLOCK$
        10**DCL      2569<>CALL     2570>>ASSIGN   2588<>CALL     2589>>ASSIGN   2591>>ASSIGN   2592>>ASSIGN
      2619<>CALL     2620>>ASSIGN
EJZLOGONONLY
      2418**DCL      2629>>ASSIGN
EJZNOPROG
      2426**DCL      2641>>ASSIGN
F$DCB.ACTPOS
       931**DCL       931--REDEF
F$DCB.ARS
       906**DCL       906--REDEF
F$DCB.ASN
       921**DCL      2596<<ASSIGN
F$DCB.ATTR
       924**DCL       925--REDEF
F$DCB.BORROW
       939**DCL       939--REDEF     939--REDEF     939--REDEF
F$DCB.DCBNAME.L
       953**DCL       953--IMP-SIZ
F$DCB.EOMCHAR
       910**DCL       910--REDEF
F$DCB.FCD
       919**DCL      2595<<ASSIGN
F$DCB.FLDID
       934**DCL       934--REDEF
F$DCB.FORM$
       928**DCL       928--REDEF
F$DCB.FSECT
       944**DCL       944--REDEF
F$DCB.FSN
       921**DCL       921--REDEF     921--REDEF     922--REDEF
F$DCB.HEADER$
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:28   
       927**DCL       927--REDEF
F$DCB.IXTNSIZE
       925**DCL       925--REDEF
F$DCB.LASTSTA$
       915**DCL       915--REDEF
F$DCB.LDCTX
       928**DCL      2591>>ASSIGN   2603<<ASSIGN
F$DCB.LVL
       940**DCL       940--REDEF
F$DCB.NAME.C
       915**DCL       915--REDEF
F$DCB.NOEOF
       936**DCL       936--REDEF
F$DCB.NRECS
       926**DCL       926--REDEF
F$DCB.NRECX
       945**DCL       945--REDEF
F$DCB.OHDR
       937**DCL       937--REDEF
F$DCB.ORG
       920**DCL       920--REDEF
F$DCB.PRECNO
       943**DCL       943--REDEF
F$DCB.RCSZ
       948**DCL       948--REDEF
F$DCB.RES
       916**DCL       916--REDEF    2597<<ASSIGN
F$DCB.SETX
       928**DCL       928--REDEF
F$DCB.TAB$
       927**DCL       928--REDEF
F$DCB.TDA
       942**DCL       942--REDEF
F$DCB.WSN
       917**DCL       917--REDEF    2598<<ASSIGN
FMM$DFLOPN
PL6.E3A0      #001=JZD$FSUSER File=JZD$PMME.:E05TSI                              TUE 07/29/97 23:53 Page:29   
      2388**DCL-ENT  2600--CALL
JZ$INFO.ACCT
      1613**DCL      1613--REDEF
JZ$INFO.BLK_COUNT
      1612**DCL      1612--REDEF
JZ$INFO.LDCT#
      1612**DCL      2591<<ASSIGN
JZ$INFO.TSLINE#
      1611**DCL      2592<<ASSIGN
JZ$INFO.USER#
      1612**DCL      2570>>ASSIGN   2589>>ASSIGN   2620>>ASSIGN
JZC$FIND
      2389**DCL-ENT  2569--CALL     2588--CALL     2619--CALL
JZ_PAGE
      1608**DCL      1608--REDEF
J_LOGON.NAME
      2394**DCL      2568>>IF       2587>>IF       2618>>IF
NOT_LOGON
      2629**LABEL    2568--GOTO     2587--GOTO     2618--GOTO
NOT_SAVED
      2641**LABEL    2569--CALLALT  2588--CALLALT  2619--CALLALT
S$CU$
       902**DCL      2568>>IF       2587>>IF       2618>>IF
SSR$RUE
      2390**DCL-ENT  2605--CALL     2622--CALL
USER#
        11**DCL      2570<<ASSIGN   2571>>CALL     2571>>CALL     2589<<ASSIGN   2605<>CALL     2620<<ASSIGN
      2621>>ASSIGN   2622<>CALL
XUD$UTS_ADJUST
      2534**DCL-ENT  2571--CALL
