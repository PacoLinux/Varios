VERSION E05

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:1    
        1        1        /*M* KVI$INT ASYNC HANDLER INPUT FUNCTION INTERPRETER ROUTINES                */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        8        8
        9        9        KVI$INT: PROC (VDH_PARM);
       10       10
       11       11        %INCLUDE KH_SCREECH_M;
       12       22 S      %INCLUDE KV$GLB;
       13       23 S      %INCLUDE KV$GLBCTX;
       14       24        %INCLUDE KV$INPFNC;
       15      583 S      %INCLUDE KV$INT;
       16      584 S      %INCLUDE KV$SND;
       17      585 S      %INCLUDE KV$USR;
       18      586 S      %INCLUDE KV$VDH;
       19      587 S      %INCLUDE KV$VDO;
       20      588 S      %INCLUDE KV_GLBCNS_E;
       21      589 S      %INCLUDE KV_PRMID_E;
       22      590        %INCLUDE KV_ASCCHR_E;
       23      727        %INCLUDE KV_INT;
       24      766        %INCLUDE KV_INT_M;
       25      909        %INCLUDE KV_SCODE_C;
       26      930        %INCLUDE LCP_6;
       27     1121        %INCLUDE K_CP6_M;
       28     1317        %G#GRPRND_E;
       29     1327        %G$LOW_MEM (STCLASS="BASED(G$LOW_MEM$)");
       30     1376    1   DCL G$LOW_MEM$ PTR SYMREF READONLY;
       31     1377
       32     1378        %KV#VD_ORG_E;
       33     1386        %KV_ABSGRPRND_E;
       34     1395        %KV_BFRRLSDSP_E;
       35     1401        %KV_CMPCOD_E;
       36     1415        %KV_DSCRSN_E;
       37     1424        %KV_EVTTYP_E;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:2    
       38     1428        %KV_INPFNC_E;
       39     1442        %KV_INPOPRX_E;
       40     1454        %KV_INPOPR_E;
       41     1467        %KV_INPPRC_E;
       42     1519        %KV_INPUNT_E;
       43     1524        %KV_PRMID_E;
       44     1680        %KV_SCP_E;
       45     1690        %KV_SND_FNC_E;
       46     1706        %KV_USR_EVT_ID_E;
       47     1726        %KV_PHSPSTMOD_E;
       48     1733        %KV_STRTYP_E;
       49     1771        %KV_VRTPSTMOD_E;
       50     1777
       51     1778        %KV$EDTWND;
       52     1794        %KV$INPFNCTBL;
       53     1878        %KV$INPOPR(STCLASS="BASED(INPOPR$)");   /*  INPUT OPERATOR                    */
       54     1977        %KV$LINLST;
       55     2004        %KV$MRD;
       56     2051        %KV$MVD;                                /*  Master virtual device             */
       57     2095        %KV$PTR;                                /*  Pointers, status                  */
       58     2138        %KV$RCRLST;
       59     2174        %KV$REDBFR (STCLASS="BASED(REDBFR$)");  /*  HANDLER INPUT BUFFER DESCRIPTION  */
       60     2177    1   DCL KV$REDBFR_BIN(0:0) BASED(REDBFR$) UBIN(8) CALIGNED;
       61     2178    1   DCL KV$REDBFR_BIT(0:0) BASED(REDBFR$) BIT(8) CALIGNED;
       62     2179    1   DCL KV$REDBFR_BYT(0:0) BASED(REDBFR$) SBIN(8) CALIGNED;
       63     2180    1   DCL KV$REDBFR_CHR BASED(REDBFR$) CHAR(512) ALIGNED;
       64     2181        %KV$SHRBFR (LAST=",");             /*  ASYNC MISCELLANEOUS BUFFER DESCRIPTION */
       65     2213    1          2 BITT(0:15) BIT(1),
       66     2214    1          2 BYT(0:1) REDEF BITT UBIN(8) CALIGNED;
       67     2215    1   DCL KV$SHRBFR_BYT(0:0) BASED UBIN(8) CALIGNED;
       68     2216        %KV$SRD;                                /*  Subordinate real device           */
       69     2491        %KV$SSN (STCLASS="BASED(SSN$)");        /*  Session                           */
       70     2570        %EQU KV_SSN = CHARTEXT('KV$SSN');
       71     2571        %KV$STR;                                /*  Stream                            */
       72     2658        %KV$TYPAHDBFR;
       73     2683        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
       74     2754    1   DCL KV$INPFNCCHR BASED CHAR(255) ALIGNED;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:3    
       75     2755    1   DCL KV$INPFNCOPRX(0:0) BASED SBIN CALIGNED;
       76     2756        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:4    
       77     2757    1   DCL KHD$SCREECH ENTRY(1);
       78     2758    1   DCL KVC$DRWBRD ENTRY;
       79     2759    1   DCL KVC$DSC ENTRY(1);
       80     2760    1   DCL KVE$DSPALL ENTRY ALTRET;
       81     2761    1   DCL KVE$INPOPR ENTRY(1) ALTRET;
       82     2762    1   DCL KVE$RE_DSPSE ENTRY ALTRET;
       83     2763    1   DCL KVE$SCRALL ENTRY ALTRET;
       84     2764    1   DCL KVF$PST ENTRY(1);
       85     2765    1   DCL KVF$RE_TYPFRM ENTRY ALTRET;
       86     2766    1   DCL KVI$ACTRED ENTRY(1);
       87     2767    1   DCL KVI$ADJINPFLDBGNATR ENTRY;
       88     2768    1   DCL KVI$BFRREDCHR ENTRY;
       89     2769    1   DCL KVI$CPYSSNEDTBFRTO_REDBFR ENTRY;
       90     2770    1   DCL KVI$CPYSTREDTBFRTO_REDBFR ENTRY;
       91     2771    1   DCL KVI$ENBRED ENTRY;
       92     2772    1   DCL KVI$INCINPFLDSIZ ENTRY;
       93     2773    1   DCL KVI$INPCHR_INPFNC ENTRY;
       94     2774    1   DCL KVI$INPCHR_INPFNCIMD ENTRY;
       95     2775    1   DCL KVI$INTINPOPRX ENTRY(1);
       96     2776    1   DCL KVI$OTPPRTID ENTRY;
       97     2777    1   DCL KVI$RSTINPFLDBGNATR ENTRY;
       98     2778    1   DCL KVI$RSTINPFLDENDATR ENTRY;
       99     2779    1   DCL KVI$SETINPFLDBGNATR ENTRY;
      100     2780    1   DCL KVM$SND ENTRY(1) ALTRET;
      101     2781    1   DCL KVO$ERSMRD ENTRY;
      102     2782    1   DCL KVO$ERSSRD ENTRY;
      103     2783    1   DCL KVO$ERSTO_ENDOF_INP ENTRY;
      104     2784    1   DCL KVO$OTPLCL ENTRY(1);
      105     2785    1   DCL KVO$PAGBRK ENTRY;
      106     2786    1   DCL KVO$PST ENTRY(1);
      107     2787    1   DCL KVO$PSTAFTHI_NONBLNPHSPST ENTRY;
      108     2788    1   DCL KVO$SCRENDNO_HLT ENTRY;
      109     2789    1   DCL KVO$OTP1_NONVRT ENTRY(1);
      110     2790    1   DCL KVO$OTP1_VRT ENTRY(1);
      111     2791    1   DCL KVP$GETPRM ENTRY(1);
      112     2792    1   DCL KVP$SETPRM ENTRY(1);
      113     2793    1   DCL KVS$CHNSSN ENTRY;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:5    
      114     2794    1   DCL KVS$GETBFR ENTRY(1) ALTRET;
      115     2795    1   DCL KVS$GETREDBFR ENTRY(1) ALTRET;
      116     2796    1   DCL KVS$RLSBFR ENTRY(1) ALTRET;
      117     2797    1   DCL KVS$SETSTR ENTRY(1);
      118     2798    1   DCL KVV$CALUSR_EVT ENTRY(1) ALTRET;
      119     2799    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
      120     2800    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
      121     2801
      122     2802        /* SYMREF structures (for initializing AUTO ones */
      123     2803
      124     2804        %KV$USR_INPPRC (NAME=KV_USR_INPPRC, STCLASS=SYMREF);
      125     2840        %KV$USR_PST (NAME=KV_USR_PST, STCLASS=SYMREF);
      126     2910        %KV$USR_SETATR (NAME=KV_USR_SETATR, STCLASS=SYMREF);
      127     3033        %KV$VDH_DAT (NAME=KV_VDH_DAT_NRM_NO_ACTCHR, STCLASS=SYMREF);
      128     3113        %KV$VDH_DSC (NAME=KV_VDH_DSC, STCLASS=SYMREF);
      129     3149        %KV$VDH_GETBFR (NAME=KV_VDH_GETBFR, STCLASS=SYMREF);
      130     3214        %KV$VDH_GETPRM (NAME=KV_VDH_GETPRM, STCLASS=SYMREF);
      131     3276        %KV$VDH_OTPLCL (NAME=KV_VDH_OTPLCL, STCLASS=SYMREF);
      132     3349        %KV$VDH_PST (NAME=KV_VDH_PST_SPCFRM, STCLASS=SYMREF);
      133     3423        %KV$VDH_RLSBFR (NAME=KV_VDH_RLSBFR, STCLASS=SYMREF);
      134     3459
      135     3460        /* SYMREF structures used only to CALL other routines */
      136     3461
      137     3462    1   DCL KV_SND_EVT_BRK UBIN SYMREF;
      138     3463    1   DCL KV_SND_EVT_MNTATN UBIN SYMREF;
      139     3464    1   DCL KV_SND_RQSMRK_DLTRCVDAT UBIN SYMREF;
      140     3465    1   DCL KV_SND_RQSMRK_DLTRCVRQS UBIN SYMREF;
      141     3466    1   DCL KV_SND_RQSSTT UBIN SYMREF;
      142     3467    1   DCL KV_VDH_PST_0_VRT UBIN SYMREF;
      143     3468    1   DCL KV_VDH_PST_BS_FRM UBIN SYMREF;
      144     3469    1   DCL KV_VDH_PST_CR_VRT UBIN SYMREF;
      145     3470    1   DCL KV_VDH_PST_LF UBIN SYMREF;
      146     3471    1   DCL KV_VDH_PST_NEWLIN_VRT UBIN SYMREF;
      147     3472    1   DCL KV_VDH_PST_VRT UBIN SYMREF;
      148     3473    1   DCL KV_VDH_PST_WHTSPC UBIN SYMREF;
      149     3474        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:6    
      150     3475        %MACRO Y_PRMID (PRMID=0, ACK=.., LAST(YES="*0);")=",");
      151     3476        %SET Y@PRMTXT=CONCAT(Y@PRMTXT,TEXTCHAR(ACK));
      152     3477        %(PRMID) LAST
      153     3478        %MEND;
      154     3479    1   DCL KV_INPFNC_PRMIDS(0:63) UBIN BYTE CALIGNED CONSTANT SYMDEF INIT(0,
      155     3480        %SET Y@PRMTXT='  ';
      156     3481             %Y_PRMID (PRMID=KV_PRMID_AUTTABCLM, ACK=AT); /* 01                       */
      157     3485        %Y_PRMID (PRMID=KV_PRMID_INSMOD, ACK=IN); /* 02                               */
      158     3489        %Y_PRMID (PRMID=KV_PRMID_MSGLIN, ACK=ML); /* 03                               */
      159     3493        %Y_PRMID (PRMID=KV_PRMID_WRDWRPCLM, ACK=WC); /* 04                            */
      160     3497        %Y_PRMID (PRMID=KV_PRMID_EDTRHT, ACK=ER); /* 05                               */
      161     3501        %Y_PRMID (PRMID=KV_PRMID_TRUNCATE, ACK=TC); /* 06                             */
      162     3505        %Y_PRMID (PRMID=KV_PRMID_ACTONTRN, ACK=AO); /* 07                             */
      163     3509        %Y_PRMID (PRMID=KV_PRMID_WRDWRP, ACK=WW); /* 08                               */
      164     3513        %Y_PRMID (PRMID=KV_PRMID_RCRWRAP, ACK=RW); /* 09                              */
      165     3517        %Y_PRMID (PRMID=KV_PRMID_TEXTEDIT, ACK=TE); /* 10                             */
      166     3521        %Y_PRMID (PRMID=KV_PRMID_EASYAPPEND, ACK=EA); /* 11                           */
      167     3525        %Y_PRMID (PRMID=KV_PRMID_CHNCAS, ACK=CC); /* 12                               */
      168     3529        %Y_PRMID (PRMID=KV_PRMID_PRKCRS, ACK=PK); /* 13                               */
      169     3533        %Y_PRMID (PRMID=KV_PRMID_ONESPCEDT, ACK=OS); /* 14                            */
      170     3537        %Y_PRMID (PRMID=0, ACK=15);
      171     3541        %Y_PRMID (PRMID=0, ACK=16);
      172     3545        %Y_PRMID (PRMID=0, ACK=17);
      173     3549        %Y_PRMID (PRMID=0, ACK=18);
      174     3553        %Y_PRMID (PRMID=0, ACK=19);
      175     3557        %EQU Y_LVL2_MAX=LENGTHC(Y@PRMTXT)/2;
      176     3558        %Y_PRMID (PRMID=KV_PRMID_OVRSTR, ACK=SB); /* 20                               */
      177     3562        %Y_PRMID (PRMID=KV_PRMID_DISPINPUT, ACK=DI); /* 21                            */
      178     3566        %Y_PRMID (PRMID=KV_PRMID_PARITYCHECK, ACK=PC); /* 22                          */
      179     3570        %Y_PRMID (PRMID=KV_PRMID_OUTPUTDISCARD, ACK=OD); /* 23                        */
      180     3574        %Y_PRMID (PRMID=KV_PRMID_UPPERCASE, ACK=UC); /* 24                            */
      181     3578        %Y_PRMID (PRMID=KV_PRMID_APLLCNRM, ACK=AL); /* 25                             */
      182     3582        %Y_PRMID (PRMID=KV_PRMID_RETYPOVR, ACK=RO); /* 26                             */
      183     3586        %Y_PRMID (PRMID=KV_PRMID_EDITOVR, ACK=EO); /* 27                              */
      184     3590        %Y_PRMID (PRMID=KV_PRMID_SCROLL*0, ACK=SC); /* 28                             */
      185     3594        %Y_PRMID (PRMID=KV_PRMID_PAGEHALT, ACK=PA); /* 29                             */
      186     3598        %Y_PRMID (PRMID=KV_PRMID_PRINTHALT, ACK=PR); /* 30                            */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:7    
      187     3602        %Y_PRMID (PRMID=KV_PRMID_RELPAGE, ACK=RP); /* 31                              */
      188     3606        %Y_PRMID (PRMID=KV_PRMID_SIMPERF, ACK=SP); /* 32                              */
      189     3610        %Y_PRMID (PRMID=KV_PRMID_NOOPTMIZ, ACK=NO); /* 33                             */
      190     3614        %Y_PRMID (PRMID=KV_PRMID_WRPPAG, ACK=WP); /* 34                               */
      191     3618        %Y_PRMID (PRMID=KV_PRMID_LOCALECHO, ACK=LE); /* 35                            */
      192     3622        %Y_PRMID (PRMID=KV_PRMID_MSGHLT, ACK=MH); /* 36                               */
      193     3626        %Y_PRMID (PRMID=KV_PRMID_AUTCRS, ACK=AC); /* 37                               */
      194     3630        %Y_PRMID (PRMID=KV_PRMID_TRUOVRPRT, ACK=TO); /* 38                            */
      195     3634        %Y_PRMID (PRMID=KV_PRMID_CRSRED, ACK=CR); /* 39                               */
      196     3638        %Y_PRMID (PRMID=KV_PRMID_KEPTYP, ACK=KT); /* 40                               */
      197     3642        %Y_PRMID (PRMID=0, ACK=41);
      198     3646        %Y_PRMID (PRMID=0, ACK=42);
      199     3650        %Y_PRMID (PRMID=0, ACK=43);
      200     3654        %Y_PRMID (PRMID=0, ACK=44);
      201     3658        %Y_PRMID (PRMID=0, ACK=45);
      202     3662        %Y_PRMID (PRMID=0, ACK=46);
      203     3666        %Y_PRMID (PRMID=0, ACK=47);
      204     3670        %Y_PRMID (PRMID=0, ACK=48);
      205     3674        %Y_PRMID (PRMID=0, ACK=49);
      206     3678        %EQU Y_LVL1_MAX=LENGTHC(Y@PRMTXT)/2;
      207     3679        %Y_PRMID (PRMID=KV_PRMID_TABSIM, ACK=TS); /* 50                               */
      208     3683        %Y_PRMID (PRMID=KV_PRMID_TABRELATIVE, ACK=TR); /* 51                          */
      209     3687        %Y_PRMID (PRMID=KV_PRMID_SPACEINSERT, ACK=SI); /* 52                          */
      210     3691        %Y_PRMID (PRMID=KV_PRMID_LOWERCASE, ACK=LC); /* 53                            */
      211     3695        %Y_PRMID (PRMID=KV_PRMID_FULLDUPLEXPAPERTAPE, ACK=FP); /* 54                  */
      212     3699        %Y_PRMID (PRMID=KV_PRMID_HALFDUPLEXPAPERTAPE, ACK=HP); /* 55                  */
      213     3703        %Y_PRMID (PRMID=0, LAST=YES);
      214     3707    1   DCL KV_PRMACK_TXT CHAR(0) CONSTANT INIT(%Y@PRMTXT);
      215     3708    1   DCL KV_PRMACK_TXTU(0:%(LENGTHC(Y@PRMTXT)/2-1)) REDEF KV_PRMACK_TXT UBIN;
      216     3709    1   DCL Y_MAXPRMX(0:2) SBIN CONSTANT INIT(63,%Y_LVL1_MAX,%Y_LVL2_MAX);
      217     3710        %KV_GRPCHR;
      218     3726    1   DCL 1 Y_CHNCAS CONSTANT,
      219     3727    1          2 *(0:15) BIT(32) CALIGNED INIT(
      220     3728    1   '00010203'X,'04050607'X,'08090A0B'X,'0C0D0E0F'X,
      221     3729    1   '10111213'X,'14151617'X,'18191A1B'X,'1C1D1E1F'X,
      222     3730    1   '20212223'X,'24252627'X,'28292A2B'X,'2C2D2E2F'X,
      223     3731    1   '30313233'X,'34353637'X,'38393A3B'X,'3C3D3E3F'X),
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:8    
      224     3732    1          2 * CHAR(0) INIT(
              3732                   '@abcdefghijklmnopqrstuvwxyz[\]^_`ABCDEFGHIJKLMNOPQRSTUVWXYZ{'),
      225     3733    1          2 *(0:32) BIT(32) INIT('7C7D7E7F'X,
      226     3734    1   '80818283'X,'84858687'X,'88898A8B'X,'8C8D8E8F'X,
      227     3735    1   '90919293'X,'94959697'X,'98999A9B'X,'9C9D9E9F'X,
      228     3736    1   'A0A1A2A3'X,'A4A5A6A7'X,'A8A9AAAB'X,'ACADAEAF'X,
      229     3737    1   'B0B1B2B3'X,'B4B5B6B7'X,'B8B9BABB'X,'BCBDBEBF'X,
      230     3738    1   'C0C1C2C3'X,'C4C5C6C7'X,'C8C9CACB'X,'CCCDCECF'X,
      231     3739    1   'D0D1D2D3'X,'D4D5D6D7'X,'D8D9DADB'X,'DCDDDEDF'X,
      232     3740    1   'E0E1E2E3'X,'E4E5E6E7'X,'E8E9EAEB'X,'ECEDEEEF'X,
      233     3741    1   'F0F1F2F3'X,'F4F5F6F7'X,'F8F9FAFB'X,'FCFDFEFF'X);
      234     3742        %KV$VDH_OTPLCL (NAME=VDH_OTPLCL_BNG_HI_BNG, TEXT='!HI!', NONVRT=YES, STCLASS=
              3742            CONSTANT);
      235     3815        /* Static KV$VDH_OTPLCL structure for sending TXT_WRT data                    */
      236     3816        %KV$VDH_OTPLCL (NAME=VDH_OTPLCL_WRT, BYTX=3, STCLASS=CONSTANT);
      237     3889        /* Static KV$VDH_OTPLCL structure for sending 'TYPE: '.                       */
      238     3890
      239     3891        %KV$VDH_OTPLCL (NAME=VDH_OTPLCL_TYPE, TEXT='TYPE:', NONVRT=YES, STCLASS=CONSTANT);
      240     3964        %VLP_SCODE (FPTN=KVI_INPFNC,FCG=KV,MID=I,ERR#=%S$KV_INPFNC,STCLASS=CONSTANT);
      241     4025
      242     4026        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:9    
      243     4027        %KV$USR_INPPRC (NAME=KV@USR_INPPRC);
      244     4063        %EQU USR_INPPRC=CHARTEXT('ADDR(FPT)->KV@USR_INPPRC');
      245     4064        %KV$USR_PST (NAME=KV@USR_PST);
      246     4134        %EQU USR_PST=CHARTEXT('ADDR(FPT(5))->KV@USR_PST');
      247     4135        %KV$USR_SETATR (NAME=KV@USR_SETATR);
      248     4258        %EQU USR_SETATR=CHARTEXT('ADDR(FPT)->KV@USR_SETATR');
      249     4259
      250     4260        %KV$VDH_DAT (NAME=KV@VDH_DAT);
      251     4340        %EQU VDH_DAT=CHARTEXT('ADDR(FPT)->KV@VDH_DAT');
      252     4341        %KV$VDH_DSC (NAME=KV@VDH_DSC);
      253     4377        %EQU VDH_DSC=CHARTEXT('ADDR(FPT)->KV@VDH_DSC');
      254     4378        %KV$VDH_GETBFR (NAME=KV@VDH_GETBFR);
      255     4443        %EQU VDH_GETBFR=CHARTEXT('ADDR(FPT)->KV@VDH_GETBFR');
      256     4444        %KV$VDH_GETPRM (NAME=KV@VDH_GETPRM);
      257     4506        %EQU VDH_GETPRM=CHARTEXT('ADDR(FPT)->KV@VDH_GETPRM');
      258     4507        %KV$VDH_OTPLCL (NAME=KV@VDH_OTPLCL);
      259     4580        %EQU VDH_OTPLCL=CHARTEXT('ADDR(FPT)->KV@VDH_OTPLCL');
      260     4581        %KV$VDH_PST (NAME=KV@VDH_PST);
      261     4655        %EQU VDH_PST=CHARTEXT('ADDR(FPT)->KV@VDH_PST');
      262     4656        %KV$VDH_RLSBFR (NAME=KV@VDH_RLSBFR);
      263     4692        %EQU VDH_RLSBFR=CHARTEXT('ADDR(FPT)->KV@VDH_RLSBFR');
      264     4693        %KV$VDH_SETPRM (NAME=KV@VDH_SETPRM);
      265     4755        %EQU VDH_SETPRM=CHARTEXT('ADDR(FPT)->KV@VDH_SETPRM');
      266     4756
      267     4757    1   DCL VDH_PARM CHAR(VDH_VRTCLM);
      268     4758    1   DCL VDH_VRTCLM REDEF VDH_PARM UBIN;
      269     4759    1   DCL VDH_SHFCNT REDEF VDH_PARM SBIN;
      270     4760        %KV$VDH_INTINPOPR(NAME = VDH_INTINPOPR, STCLASS = REDEF VDH_PARM);
      271     4796        %KV$VDH_DAT(NAME = VDH_DAT, STCLASS = REDEF VDH_PARM);
      272     4876
      273     4877    1   DCL INPOPR$ PTR;
      274     4878    1   DCL REDBFR$ PTR;
      275     4879    1   DCL SSN$ PTR;
      276     4880    1   DCL B3 PTR;
      277     4881    1   DCL R2 SBIN;
      278     4882    1   DCL R3 SBIN;
      279     4883    1   DCL R5 SBIN;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:10   
      280     4884    1   DCL EDTX SBIN;
      281     4885    1   DCL DSPLOWCLM SBIN;
      282     4886    1   DCL OPRCNT SBIN;
      283     4887    1   DCL OPRCNTU REDEF OPRCNT UBIN;
      284     4888    1   DCL STR UBIN;
      285     4889    1   DCL SAVEBIT BIT(1);
      286     4890    1   DCL FPT(0:15) UBIN;
      287     4891        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:11   
      288     4892    1   KVI$INTINPOPR: ENTRY (VDH_PARM);
      289     4893
      290     4894        /* Interpret the input operators that start at the point
      291     4895           indexed to by VDH_INTINPOPR.INPOPRX.                                       */
      292     4896
      293     4897    1      INPOPR$ = PINCRW (VDH_INTINPOPR.INPFNCTBL$, VDH_INTINPOPR.INPOPRX);
      294     4898    1      SSN$ = KV$PTR.SSN$;
      295     4899    1      OPRCNT = KV$PTR.INPCNDPND.OPRX;
      296     4900
      297     4901    2      IF G$LOW_MEM.WDT_CURR<50 THEN DO;
      298     4902
      299     4903        /* If we have done too much for this line -
      300     4904           blow it away.                                                              */
      301     4905    2         INPOPR$ = %KV_MVD.SSTINPFNCTBL$;
      302     4906    2         INPOPR$ = PINCRW (INPOPR$,
      303     4907    2           INPOPR$->KV$INPFNCTBL.INPOPROFS+%KV_INPOPRX_REDDATLST);
      304     4908    2      END /* IF */;
      305     4909    2      DO WHILE '1'B;
      306     4910
      307     4911        /* This loop is traversed for each input operator.                            */
      308     4912    3         IF NOT %KV_VDI.USRRQSDAT.RED AND KV$INPOPR.RED THEN DO;
      309     4913        /* We're not doing read processing, and this input operator
      310     4914           is to be processed during read processing. Buffer the
      311     4915           character string invoking this input function.                             */
      312     4916
      313     4917    3            %KV_SSN.TYPAHD.BFRCHR = '1'B;
      314     4918    3         END /* IF */;
      315     4919    2         IF KV$INPOPR.IMD AND VDH_INTINPOPR.IMD
      316     4920    3           OR KV$INPOPR.RED AND %KV_VDI.USRRQSDAT.RED THEN DO;
      317     4921        /* The processing of this input operator is required during this
      318     4922           phase (immediate or read).                                                 */
      319     4923
      320     4924    3            IF KV$INPOPR.ACK AND KV$INPOPR.TYP~=%KV_INPOPR_TYP_MSC
      321     4925    3              AND KV$INPOPR.TYP~=%KV_INPOPR_TYP_TGLPRM
      322     4926        /* WE ARE TO ECHO <escape-chr> , E.G., IF ESCAPE R, ECHO <R>              */
      323     4927
      324     4928    3            THEN CALL Y$ECHINPOPR;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:12   
      325     4929
      326     4930    3            REDBFR$ = %KV_SSN.REDBFR__.ADR$;
      327     4931    4   INPOPR:  DO CASE (KV$INPOPR.TYP);
      328     4932        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:13   
      329     4933    4            CASE (%KV_INPOPR_TYP_ACTRED);
      330     4934        /* This is the activate-read INPOPR. A data message
      331     4935           (e.g., KV$VDO_DAT) will be sent to the other end if there is
      332     4936           a pending read.                                                            */
      333     4937
      334     4938    4               %VDH_DAT = KV_VDH_DAT_NRM_NO_ACTCHR;
      335     4939    4               %VDH_DAT.CMPCOD = KV$INPOPR.CMPCOD;
      336     4940    4               CALL KVI$ACTRED (FPT);
      337     4941    4               IF %KV_MVD.ORG<%KV#VD_ORG_FORM AND %VDH_DAT.CMPCOD~=%KV_CMPCOD_NRM
      338     4942        /* This isn't a forms virtual device, and the completion
      339     4943           code isn't 'normal'. Position to a new virtual line.                       */
      340     4944
      341     4945    4               THEN CALL KVO$PST (KV_VDH_PST_NEWLIN_VRT);
      342     4946        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:14   
      343     4947    4            CASE (%KV_INPOPR_TYP_FLWON);
      344     4948        /* This is the follow-on INPOPR. An input operator index is being
      345     4949           passed. We're to process that INPOPR when we get the next character that
      346     4950           isn't completely processed by the SPCESC mechanism in the translate table. */
      347     4951
      348     4952    4               KV$PTR.INPCNDPND.INPOPR = '1'B;
      349     4953    4               KV$PTR.INPCNDPND.OPRX = 1-KV$INPOPR.INPOPRX+
      350     4954    4                 POFFW (INPOPR$, VDH_INTINPOPR.INPFNCTBL$);
      351     4955        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:15   
      352     4956    4            CASE (%KV_INPOPR_TYP_JMP);
      353     4957        /* This is the jump input operator. Process the specified INPOPR next.        */
      354     4958
      355     4959        /* This operator is performed below where CHN is checked. */
      356     4960        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:16   
      357     4961    4            CASE (%KV_INPOPR_TYP_PST);
      358     4962        /* This is a PST (position) request.                                          */
      359     4963
      360     4964    4               CALL KVO$PST (KV$INPOPR_PST.VDH_PST);
      361     4965        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:17   
      362     4966    4            CASE (%KV_INPOPR_TYP_RSTPRM, %KV_INPOPR_TYP_SETPRM,
      363     4967    4                 %KV_INPOPR_TYP_TGLPRM);
      364     4968        /* This is a change parameter request INPOPR (RSTPRM, SETPRM, or TGLPRM).     */
      365     4969
      366     4970    4               %VDH_GETPRM = KV_VDH_GETPRM;
      367     4971    4               %VDH_GETPRM.PRMID = KV$INPOPR.PRMID;
      368     4972    5               IF %VDH_GETPRM.PRMID=0 THEN DO;
      369     4973    5                  IF OPRCNTU<=             /* disallow negative indexes, too     */
      370     4974    5                    Y_MAXPRMX(VDH_INTINPOPR.INPFNCTBL$->KV$INPFNCTBL.SBSLVL)
      371     4975    5                  THEN %VDH_GETPRM.PRMID = KV_INPFNC_PRMIDS(OPRCNT);
      372     4976    5                  OPRCNT = 0; /* WRDWRPCLM & AUTTABCLM need SET to use EDTLOWX   */
      373     4977    5               END;
      374     4978    4               IF %VDH_GETPRM.PRMID=0 THEN EXIT;
      375     4979    4               IF %VDH_GETPRM.PRMID=%KV_PRMID_EASYAPPEND
      376     4980    4                 OR %VDH_GETPRM.PRMID=%KV_PRMID_TEXTEDIT
      377     4981    4                 OR %VDH_GETPRM.PRMID=%KV_PRMID_ONESPCEDT
      378     4982    4               THEN IF %KV_MVD.ORG~=%KV#VD_ORG_SE THEN EXIT;
      379     4983    4               IF %KV_SSN.REDRQSPND
      380     4984    4                 AND %VDH_SETPRM.PRMID=%KV_PRMID_OUTPUTDISCARD THEN EXIT;
      381     4985    4               %KV_SSN.LSTPRMID = %VDH_SETPRM.PRMID;
      382     4986    5               IF KV$INPOPR.TYP=%KV_INPOPR_TYP_TGLPRM THEN DO;
      383     4987        /* Get the current value of the parameter to be toggled. */
      384     4988
      385     4989    5                  CALL KVP$GETPRM (FPT);
      386     4990    5                  IF %VDH_SETPRM.VAL~=0 THEN %VDH_GETPRM.VAL = 65535;
      387     4991    5                  %VDH_SETPRM.VAL = %VDH_GETPRM.VAL+1;
      388     4992    5                  IF KV$INPOPR.ACK THEN CALL Y$ECHINPOPR;
      389     4993    5               END /* IF */;
      390     4994    5               ELSE IF KV$INPOPR.TYP=%KV_INPOPR_TYP_SETPRM THEN DO;
      391     4995    5                  IF OPRCNT<0 THEN OPRCNT = 0;
      392     4996    5                  IF %VDH_SETPRM.PRMID=%KV_PRMID_AUTTABCLM
      393     4997    5                    OR %VDH_SETPRM.PRMID=%KV_PRMID_WRDWRPCLM
      394     4998    5                    OR %VDH_SETPRM.PRMID=%KV_PRMID_HRZSCRMRG
      395     4999    5                    OR %VDH_SETPRM.PRMID=%KV_PRMID_HRZSCRSHF
      396     5000    5                  THEN IF OPRCNT>0 THEN %VDH_SETPRM.VAL = OPRCNT;
      397     5001    5                  ELSE %VDH_SETPRM.VAL = %KV_SSN.REDBFR.EDTLOWX+1;
      398     5002    5                  ELSE %VDH_SETPRM.VAL = 1;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:18   
      399     5003    5                  IF %VDH_SETPRM.PRMID=%KV_PRMID_WRDWRPCLM
      400     5004    5                  THEN %KV_STR.WRDWRP = '1'B;
      401     5005    5               END /* IF */;
      402     5006    4               %VDH_SETPRM.SCP = %KV_SCP_ONE_ONLY;
      403     5007    4               CALL KVP$SETPRM (FPT);
      404     5008    4               IF %VDH_SETPRM.PRMID=%KV_PRMID_DISPINPUT
      405     5009    4               THEN IF %KV_VDI.USRRQSDAT.RED
      406     5010    4                 AND %KV_VDI.INPUNT=%KV_INPUNT_BLK
      407     5011    4               THEN CALL KVI$ADJINPFLDBGNATR;
      408     5012        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:19   
      409     5013    4            CASE (%KV_INPOPR_TYP_TXT);
      410     5014        /* This is the text INPOPR. Put the text in read buffers,
      411     5015           type-ahead buffers, or write the text to the terminal.                     */
      412     5016
      413     5017        /* Buffer and/or write the text.                                              */
      414     5018
      415     5019    5               IF KV$INPOPR_TXT.L>0 THEN DO;
      416     5020
      417     5021    5                  R5 = 0;
      418     5022    5                  %KV_SSN.INPECH = KV$INPOPR_TXT.ECH;
      419     5023    6                  DO CASE (KV$INPOPR_TXT.DSP);
      420     5024        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:20   
      421     5025    6                  CASE (%KV_INPOPR_TXT_DSP_INPFNC);
      422     5026        /* We are to pass the character thru the system input function
      423     5027           table. That may result in the character being buffered/echoed.             */
      424     5028
      425     5029    7                     DO WHILE R5<KV$INPOPR_TXT.L;
      426     5030    7                        %KV_SSN.INPCHR = SUBSTR (KV$INPOPR_TXT.T,R5,1);
      427     5031
      428     5032    7                        IF VDH_INTINPOPR.IMD THEN CALL KVI$INPCHR_INPFNCIMD;
      429     5033    7                        ELSE CALL KVI$INPCHR_INPFNC;
      430     5034    7                        SSN$ = KV$PTR.SSN$;
      431     5035    7                        REDBFR$ = %KV_SSN.REDBFR__.ADR$;
      432     5036    7                        R5 = R5+1;
      433     5037    7                     END /* LOOP */;
      434     5038        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:21   
      435     5039    6                  CASE (%KV_INPOPR_TXT_DSP_REDBFR);
      436     5040        /* We are to buffer the chr in the read buffer.                               */
      437     5041
      438     5042    7                     DO WHILE R5<KV$INPOPR_TXT.L AND %KV_SSN.REDRQSPND;
      439     5043    7                        %KV_SSN.INPCHR = SUBSTR (KV$INPOPR_TXT.T,R5,1);
      440     5044    7                        CALL KVI$BFRREDCHR;
      441     5045    7                        R5 = R5+1;
      442     5046    7                     END /* LOOP */;
      443     5047        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:22   
      444     5048    6                  CASE (%KV_INPOPR_TXT_DSP_TYPAHDBFR);
      445     5049        /* We are to buffer the chr in the type-ahead buffers.                        */
      446     5050
      447     5051    6                     CALL Y$TYPAHDTXT (KV$INPOPR);
      448     5052        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:23   
      449     5053    6                  CASE (%KV_INPOPR_TXT_DSP_WRT);
      450     5054        /* We are to write the character on the terminal.                             */
      451     5055
      452     5056    6                     IF %KV_VDI.INPUNT=%KV_INPUNT_BLK AND %KV_VDI.USRRQSDAT.RED
      453     5057        /* This is a block-mode device with a read outstanding. Position
      454     5058           to just beyond the hi non-blank position before outputting
      455     5059           the text.                                                                  */
      456     5060
      457     5061    6                     THEN CALL KVO$PSTAFTHI_NONBLNPHSPST;
      458     5062    6                     ELSE IF %KV_VDI.RE_DSPINP
      459     5063        /* The displayed input needs to be caught up. */
      460     5064
      461     5065    6                     THEN CALL Y$RE_DSPINP;
      462     5066
      463     5067        /* Send the chars                                                             */
      464     5068
      465     5069    6                     %VDH_OTPLCL = VDH_OTPLCL_WRT;
      466     5070    6                     %VDH_OTPLCL.BFR_.ADR$ = INPOPR$;
      467     5071    6                     %VDH_OTPLCL.BFR_.BYTSIZ = KV$INPOPR_TXT.L;
      468     5072    6                     %VDH_OTPLCL.TRN = KV$INPOPR_TXT.TRN;
      469     5073    6                     IF NOT KV$INPOPR_TXT.VRT THEN %VDH_OTPLCL.NONVRT = '1'B;
      470     5074    6                     CALL KVO$OTPLCL (FPT) ;
      471     5075    6                     IF %KV_VDI.INPUNT=%KV_INPUNT_BLK AND %KV_VDI.USRRQSDAT.RED
      472     5076        /* This is a block-mode device with a read outstanding. Position
      473     5077           back to where we started.                                                  */
      474     5078
      475     5079    6                     THEN CALL KVO$PST(KV_VDH_PST_VRT);
      476     5080    6                  END /* CASE */;
      477     5081    5               END /* IF */;
      478     5082        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:24   
      479     5083    4            CASE (%KV_INPOPR_TYP_MSC);
      480     5084        /* This is the miscellaneous input operator.                                  */
      481     5085
      482     5086    4               %KV_VDI.PRG = '0'B;
      483     5087    5               IF KV$INPOPR_MSC.DLTOTP THEN DO;
      484     5088        /* We are to delete q'd output, and data in the
      485     5089           our receive path (typically from a user program to us).        */
      486     5090
      487     5091    5                  CALL KVM$SND (KV_SND_RQSMRK_DLTRCVDAT);
      488     5092
      489     5093    5                  CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_DLTOTP);
      490     5094    5               END /* IF */;
      491     5095
      492     5096        /* Now do the ACKnowlegement, since otherwise it would never be seen.  */
      493     5097    4               IF KV$INPOPR.ACK THEN CALL Y$ECHINPOPR;
      494     5098    4               IF KV$INPOPR_MSC.DLTINP
      495     5099        /* We are to delete typed-ahead input.                                        */
      496     5100
      497     5101    4               THEN CALL Y$PRGTYPAHD;
      498     5102    4               IF KV$INPOPR_MSC.ABRRED
      499     5103        /* We are to abort the read, if any. No read response message
      500     5104           will be sent to the other end.                                             */
      501     5105
      502     5106    4               THEN CALL Y$ABRRED;
      503     5107    4               IF KV$INPOPR_MSC.DLTRED
      504     5108        /* We are to delete the current read message.                                 */
      505     5109
      506     5110    4               THEN CALL Y$PRGRED;
      507     5111
      508     5112        /* Send out the underscore and position if we purged anything.                */
      509     5113
      510     5114    5               IF %KV_VDI.PRG THEN DO;
      511     5115    5                  IF NOT %KV_VDI.PHSDSC
      512     5116    5                  THEN IF %KV_VDI.INPUNT=%KV_INPUNT_BLK
      513     5117        /* This is a block-mode device with a read outstanding.
      514     5118           Send a bell so we don't clobber the input field.                           */
      515     5119
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:25   
      516     5120    5                    OR %KV_MVD.ORG~=%KV#VD_ORG_UR
      517     5121        /* Or it's non-serial, so the underscore would get erased anyway */
      518     5122
      519     5123    6                  THEN DO;
      520     5124    6                     IF %KV_VDI.PRG.RED THEN EXIT; /* No beep with an erase      */
      521     5125    6                     CALL KVO$OTP1_NONVRT (%ASCIIBEL);
      522     5126    6                  END;
      523     5127    5                  ELSE CALL KVO$OTP1_NONVRT (%ASCIIUNDSCR);
      524     5128    5                  IF %KV_VDI.PRG.OTP
      525     5129        /* Purged output, fix up lost position                                        */
      526     5130
      527     5131    5                  THEN IF NOT %KV_SRD.SCROLL AND %KV_MRD.PHSFRM
      528     5132    6                    AND (%KV_MRD.BLANKERASES OR %KV_MRD.FSTERS) THEN DO;
      529     5133    6                     %KV_SRD.UNKPST = '0'B;
      530     5134    6                     %KV_SRD.HI_NONBLN = %KV_SRD.SRDEND;
      531     5135    6                     CALL KVO$SCRENDNO_HLT;
      532     5136    6                  END; ELSE DO;
      533     5137    6                     %KV_SRD.UNKPST = '0'B;
      534     5138    7                     IF %KV_SRD.RELPAGE AND %KV_SRD.SCROLL THEN DO;
      535     5139        /* Make this the top of the page                                              */
      536     5140
      537     5141    7                        %KV_SRD.CRT.LIN = %KV_SRD.TOPLFT.LIN;
      538     5142    7                        %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.TOPLFT.LIN;
      539     5143    7                        %KV_SRD.HI_NONBLN.LIN = %KV_SRD.TOPLFT.LIN-1;
      540     5144    7                        %KV_MVD.FRMLIN = 0;
      541     5145    7                        %KV_SRD.DVCLINBIS = %KV_SRD.LNG-1;
      542     5146    7                     END /* IF */;
      543     5147    6                     CALL KVO$PST(KV_VDH_PST_NEWLIN_VRT);
      544     5148    6                  END /* IF */;
      545     5149    5               END /* IF */;
      546     5150    4               IF %KV_VDI.PRG.RED OR %KV_VDI.USRRQSDAT.RED
      547     5151        /* We purged the read, and actually purged some data.
      548     5152           reposition the cursor to just after the end of the prompt.                 */
      549     5153
      550     5154    4               THEN IF %KV_VDI.PRG.OTP
      551     5155    5                 AND %KV_VDI.USRRQSDAT.RED THEN DO;
      552     5156        /* We purged output, re-issue the prompt                                      */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:26   
      553     5157
      554     5158    5                  CALL KVI$ENBRED;
      555     5159    5                  CALL Y$SHFTYPREDBFR;
      556     5160    5               END;
      557     5161    4               ELSE IF KV$INPOPR_MSC.ABRRED OR KV$INPOPR_MSC.DLTRED
      558     5162    5               THEN IF %KV_VDI.INPUNT~=%KV_INPUNT_BLK OR %KV_VDI.USRRQSDAT THEN DO;
      559     5163    6                  IF %KV_SSN.REDBFR.DSPLOWX~=0 THEN DO;
      560     5164    6                     %KV_SSN.REDBFR.DSPLOWX = 0;
      561     5165    6                     IF %KV_MVD.ORG=%KV#VD_ORG_SE
      562     5166    6                     THEN IF %KV_RCRLST.HRZSCRALL THEN CALL KVE$SCRALL;
      563     5167    6                  END;
      564     5168    5                  CALL Y$RE_PSTRED;
      565     5169    5               END;
      566     5170        /*N* if waiting (giveup) for buffer, and don't have any of this               */
      567     5171        /*N* type yet, won't set prg bit... After unreg, won't see                    */
      568     5172        /*N* prg bit... Need another array of bits??                                  */
      569     5173        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:27   
      570     5174    4            CASE (%KV_INPOPR_TYP_USRINPPRC);
      571     5175        /* This is a USRINPPRC (user input procedure) request.                        */
      572     5176
      573     5177    4               %USR_INPPRC = KV_USR_INPPRC;
      574     5178    4               %USR_INPPRC.ID = KV$INPOPR.ID;
      575     5179    4               %USR_INPPRC.ORGCHR = BINASC(VDH_INTINPOPR.ORGCHR);
      576     5180    4               %USR_INPPRC.CHR = VDH_INTINPOPR.ACKCHR;
      577     5181    4               %USR_INPPRC.IMD = VDH_INTINPOPR.IMD;
      578     5182    4               %USR_INPPRC.RED = %KV_VDI.USRRQSDAT.RED;
      579     5183    4               CALL KVV$CALUSR (FPT);
      580     5184        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:28   
      581     5185    4            CASE (%KV_INPOPR_TYP_VDHINPPRC);
      582     5186        /* This is a VDHINPPRC (input procedure) request. */
      583     5187
      584     5188    5   INPPRC:     DO CASE (KV$INPOPR.ID);
      585     5189        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:29   
      586     5190    5               CASE (%KV_INPPRC_AT_PRF);
      587     5191        /* This is a request to set the line counters to the values
      588     5192           that indicate we're at the perforation in fan-folded
      589     5193           paper.                                                                     */
      590     5194
      591     5195    5                  IF NOT %KV_MRD.CTNFRM THEN GOTO RE_DSP_FRM;
      592     5196    6                  IF %KV_MVD.LNG>11 THEN DO;
      593     5197    6                     %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+
      594     5198    6                       %KV_SRD.BTMRHT.LIN-%KV_SRD.CRT.LIN;
      595     5199    6                     %KV_SRD.CRT.LIN = %KV_SRD.BTMRHT.LIN;
      596     5200    6                     %KV_MRD.DVCLIN = %KV_SRD.BTMRHT.LIN;
      597     5201    6                     %KV_MVD.VRTLIN = %KV_MVD.LNG;
      598     5202    6                     %KV_MVD.FRMLIN = %KV_MVD.LNG-1;
      599     5203    6                  END /* IF */;
      600     5204        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:30   
      601     5205    5               CASE (%KV_INPPRC_BLKTYPAHD);
      602     5206    5                  CALL Y$BLKTYPAHD;
      603     5207        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:31   
      604     5208    5               CASE (%KV_INPPRC_BRK);
      605     5209        /* This is a break.                                                           */
      606     5210
      607     5211    5                  CALL KVM$SND (KV_SND_EVT_BRK);
      608     5212        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:32   
      609     5213    5               CASE (%KV_INPPRC_CR);
      610     5214        /* This is a CR character (carriage return).                                  */
      611     5215
      612     5216    5                  %KV_SSN.INPCHR = BITASC(%ASCIICR);
      613     5217    5                  GOTO KVI_NEWLIN;
      614     5218        /* Same as LF, but not ignored with an empty REDBFR. */
      615     5219
      616     5220        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:33   
      617     5221    5               CASE (%KV_INPPRC_COPSSNEDTBFR);
      618     5222        /* This is a copy-session-edit-buffer request.                                */
      619     5223
      620     5224    5                  CALL KVI$CPYSSNEDTBFRTO_REDBFR;
      621     5225        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:34   
      622     5226    5               CASE (%KV_INPPRC_COPSTREDTBFR);
      623     5227        /* This is a copy-stream-edit-buffer request.                                 */
      624     5228
      625     5229    5                  CALL KVI$CPYSTREDTBFRTO_REDBFR;
      626     5230        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:35   
      627     5231    5               CASE (%KV_INPPRC_DEL, %KV_INPPRC_DELLFT);
      628     5232        /* This is a delete character request.                                        */
      629     5233
      630     5234    5                  IF REDBFR$=ADDR(NIL) OR %KV_SSN.REDBFR__.DATBYTSIZ=0 THEN GOTO
              5234                           CHKJOIN;
      631     5235        /* We have a read buffer, and there is at least 1 character in it. */
      632     5236
      633     5237    5                  IF %KV_SSN.REDBFR.EDTLOWX>=%KV_SSN.REDBFR.NXTX
      634     5238    5                  THEN IF %KV_MVD.INSMOD AND KV$INPOPR.ID=%KV_INPPRC_DEL
      635     5239    5                  THEN IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN EXIT;
      636     5240    5                  ELSE GOTO CHKJOIN;       /* DEL at end in INSMOD               */
      637     5241    6                  ELSE IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;
      638     5242    6                     OPRCNT = 0;
      639     5243    6                     GOTO PSTLFT;          /* Past end, DELLFT or not INSMOD     */
      640     5244    6                  END;
      641     5245    5                  IF NOT %KV_MVD.INSMOD
      642     5246    5                    AND %KV_SSN.REDBFR.INSMODX=%KV_SSN.REDBFR.INSLOWX THEN EXIT;
      643     5247        /* And the editting window is not empty. There is something to delete. */
      644     5248
      645     5249    5                  IF KV$INPOPR.ID=%KV_INPPRC_DELLFT OR NOT %KV_MVD.INSMOD
      646     5250    5                    AND %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR.INSMODX
      647     5251    6                  THEN IF %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR__.BYTX THEN DO;
      648     5252    6   CHKJOIN:          IF %KV_MVD.RCRWRAP AND %KV_MVD.INSMOD
      649     5253    6                     THEN CALL KVE$INPOPR (KV$INPOPR);
      650     5254    6                     EXIT INPPRC;
      651     5255    6                  END;
      652     5256    6                  ELSE DO;
      653     5257        /* We're at the insert point. Delete the column to the left. */
      654     5258
      655     5259    6                     %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX-1;
      656     5260    6                     CALL Y$SCPVRTCLMHI_X;
      657     5261    6                  END;
      658     5262        /* EDTxxxX now frames the column we want to remove. */
      659     5263
      660     5264    5                  R2 = %KV_SSN.REDBFR.NXTX-%KV_SSN.REDBFR.EDTHI_X-1;
      661     5265    5                  IF R2~=0
      662     5266        /* There are characters to the right, so move them down. */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:36   
      663     5267
      664     5268    5                  THEN CALL INSERT (KV$REDBFR_CHR, %KV_SSN.REDBFR.EDTLOWX, R2,
      665     5269    5                    SUBSTR (KV$REDBFR_CHR, %KV_SSN.REDBFR.EDTHI_X+1, R2));
      666     5270        /* Update the buffer indexes that need it. */
      667     5271
      668     5272    5                  R2 = %KV_SSN.REDBFR.EDTHI_X-%KV_SSN.REDBFR.EDTLOWX+1;
      669     5273    5                  IF %KV_SSN.REDBFR.INSMODX>%KV_SSN.REDBFR.EDTHI_X
      670     5274    5                  THEN %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.INSMODX-R2;
      671     5275    5                  IF %KV_SSN.REDBFR.INSLOWX>%KV_SSN.REDBFR.EDTHI_X
      672     5276    5                  THEN %KV_SSN.REDBFR.INSLOWX = %KV_SSN.REDBFR.INSLOWX-R2;
      673     5277    5                  %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.NXTX-R2;
      674     5278    5                  %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR__.DATBYTSIZ-R2;
      675     5279        /* Update the screen image or type a backslash. */
      676     5280
      677     5281    6                  IF NOT %KV_VDI.RE_DSPINP THEN DO;
      678     5282    6                     R2 = %KV_MVD.VRTCLM-1;
      679     5283    6                     CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);
      680     5284    6                     IF %KV_MVD.RETYPOVR
      681     5285        /* We are to edit in place.                                       */
      682     5286
      683     5287    6                     THEN CALL Y$SHFDSPPST (-1);
      684     5288    7                     ELSE IF %KV_MVD.DISPINPUT THEN DO;
      685     5289    8                        IF %KV_SSN.REDBFR__.DATBYTSIZ=0 THEN DO;
      686     5290        /* The read buffer had only 1 column in it, so it's now empty.
      687     5291           Echo an underscore (as in DLTINP), and position to the next line.    */
      688     5292
      689     5293    8                           IF %KV_MVD.EDITOVR AND R2=%KV_MVD.VRTCLM
      690     5294    8                           THEN CALL KVO$PST(KV_VDH_PST_0_VRT);
      691     5295    8                           CALL KVO$OTP1_NONVRT (%ASCIIUNDSCR);
      692     5296    8                           CALL Y$RE_PSTRED;
      693     5297    8                        END; ELSE IF NOT %KV_MVD.EDITOVR THEN DO;
      694     5298        /* Not EDITOVR, just tack baskslashes onto the end */
      695     5299
      696     5300    8                           CALL KVO$OTP1_NONVRT (%ASCIIBCKSLS);
      697     5301    8                           %KV_SRD.VRTPSTOK = '1'B;
      698     5302    8                        END; ELSE DO;
      699     5303        /* EDITOVR, strike out the deleted chars accurately. */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:37   
      700     5304
      701     5305    8                           IF R2=%KV_MVD.VRTCLM
      702     5306        /* We're deleting the column to the left of our position
      703     5307           position to it to mark it out                                  */
      704     5308
      705     5309    8                           THEN CALL KVO$PST(KV_VDH_PST_0_VRT);
      706     5310    8                           CALL KVO$OTP1_NONVRT (%ASCIIBCKSLS);
      707     5311    8                        END /* IF */;
      708     5312    7                     END /* IF */;
      709     5313    6                  END; ELSE IF %KV_SSN.REDBFR.EDTLOWX<%KV_VDI.RE_DSPLOWX THEN DO;
      710     5314    6                     %KV_VDI.RE_DSPLOWX = %KV_SSN.REDBFR.EDTLOWX;
      711     5315    6                     %KV_SRD.VRTPSTOK='0'B;
      712     5316    6                  END;
      713     5317    5                  CALL Y$SCPVRTCLMLOWX;
      714     5318        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:38   
      715     5319    5               CASE (%KV_INPPRC_DELWRD);
      716     5320    5                  R2 = %KV_SSN.REDBFR.EDTLOWX;
      717     5321    5                  R3 = R2;
      718     5322    6                  DO WHILE R3<%KV_SSN.REDBFR.INSMODX;
      719     5323    6                     IF KV$REDBFR.CHR(R3)=' ' THEN EXIT;
      720     5324    6                     R3 = R3+1;
      721     5325    6                  END;
      722     5326    6                  DO WHILE R3<%KV_SSN.REDBFR.INSMODX;
      723     5327    6                     IF KV$REDBFR.CHR(R3)~=' ' THEN EXIT;
      724     5328    6                     R3 = R3+1;
      725     5329    6                  END;
      726     5330    5                  GOTO DLTSGM;
      727     5331        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:39   
      728     5332    5               CASE (%KV_INPPRC_DLTTO_BGN);
      729     5333        /* This is delete-to-beginning-of-edit-window request.                        */
      730     5334
      731     5335    6                  IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;
      732     5336    6                     %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.EDTLOWX;
      733     5337    6                     %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.EDTLOWX;
      734     5338    6                  END;
      735     5339    5                  R3 = %KV_SSN.REDBFR.EDTLOWX;
      736     5340    5                  R2 = %KV_SSN.REDBFR.INSLOWX;
      737     5341    5                  %KV_SSN.REDBFR.EDTLOWX = R2;
      738     5342    5                  CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);
      739     5343    5                  IF %KV_MVD.HRZSCR AND DSPLOWCLM~=0
      740     5344    5                    AND %KV_MVD.VRTCLM-%KV_SRD.PRMVRTCLM<=%KV_MVD.HRZSCRMRG
      741     5345    5                  THEN CALL Y$SHFDSPPST (0);
      742     5346    5                  GOTO DLTSGM;
      743     5347        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:40   
      744     5348    5               CASE (%KV_INPPRC_DLTTO_END);
      745     5349        /* This is a delete-to-end-of-the-edit-window request.                        */
      746     5350
      747     5351    5                  R2 = %KV_SSN.REDBFR.EDTLOWX;
      748     5352    5                  R3 = %KV_SSN.REDBFR.INSMODX;
      749     5353    5   DLTSGM:        ;
      750     5354    6                  IF R3<=R2 THEN DO;
      751     5355        /* Nothing to do - unless the acknowledgement needs erasing */
      752     5356
      753     5357    6                     IF %KV_MVD.RETYPOVR AND NOT %KV_SRD.VRTPSTOK
      754     5358    6                       AND NOT %KV_VDI.RE_DSPINP
      755     5359    6                     THEN CALL KVO$PST (KV_VDH_PST_VRT);
      756     5360    6                     EXIT INPPRC;
      757     5361    6                  END;
      758     5362    5                  R5 = %KV_SSN.REDBFR.NXTX-R3;
      759     5363    5                  IF R5~=0
      760     5364    5                  THEN SUBSTR(KV$REDBFR_CHR,R2,R5) = SUBSTR(KV$REDBFR_CHR,R3,R5);
      761     5365    5                  R5 = R3-R2;
      762     5366    5                  %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.INSMODX-R5;
      763     5367    5                  %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.NXTX-R5;
      764     5368    5                  %KV_SSN.REDBFR__.DATBYTSIZ =
      765     5369    5                    %KV_SSN.REDBFR.NXTX-%KV_SSN.REDBFR__.BYTX;
      766     5370    5                  CALL Y$SCPVRTCLMLOWX;
      767     5371    5                  IF NOT %KV_VDI.RE_DSPINP
      768     5372    6                  THEN IF NOT %KV_MVD.RETYPOVR THEN DO;
      769     5373        /* For hard copy, do a retyp */
      770     5374
      771     5375    6                     CALL Y$RE_PSTRED;
      772     5376    6                     CALL Y$SHFTYPREDBFR;
      773     5377    7                     IF %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR.INSMODX THEN DO;
      774     5378    7                        %KV_MVD.VRTCLM = %KV_MVD.VRTCLM-1;
      775     5379    7                        GOTO SETINSHI_X;   /* And position properly              */
      776     5380    7                     END;
      777     5381    6                  END; ELSE DO;
      778     5382    6                     CALL KVO$PST(KV_VDH_PST_VRT);
      779     5383    6                     CALL Y$SHFDSPPST (-R5);
      780     5384    6                  END;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:41   
      781     5385    6                  ELSE IF %KV_SSN.REDBFR.EDTLOWX<%KV_VDI.RE_DSPLOWX THEN DO;
      782     5386    6                     %KV_VDI.RE_DSPLOWX = %KV_SSN.REDBFR.EDTLOWX;
      783     5387    6                     %KV_SRD.VRTPSTOK='0'B;
      784     5388    6                  END;
      785     5389        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:42   
      786     5390    5               CASE (%KV_INPPRC_DMP);
      787     5391        /* This is a dump.                                                            */
      788     5392
      789     5393        /*N* call gad$dmpusr                                                          */
      790     5394        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:43   
      791     5395    5               CASE (%KV_INPPRC_DSC);
      792     5396        /* This is a physical disconnect.
      793     5397           initiate a disconnect sequence.                                            */
      794     5398
      795     5399    5                  %VDH_DSC = KV_VDH_DSC;
      796     5400    5                  %VDH_DSC.NO_IO = '1'B;
      797     5401    5                  %VDH_DSC.ALLSSN = '1'B;
      798     5402    5                  %VDH_DSC.RSN = %KV_DSCRSN_LINDRP;
      799     5403    5                  CALL KVC$DSC (FPT);
      800     5404        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:44   
      801     5405    5               CASE (%KV_INPPRC_ESC);
      802     5406        /* This is a set-escape-pending request.
      803     5407
      804     5408           Escape-pending (KV$MRD.INPCNDPND.ESC) can be set two ways.
      805     5409           It can be set by KV$INPFNCTBL.SPCCHR special character
      806     5410           detection, without interpreting an input operator that
      807     5411           asks for escape pending; it can also be set by either the input
      808     5412           translate table special character accelerator mechanism or the
      809     5413           the KV$INPFNCTBL.SPCCHR special character detection mechanism calling
      810     5414           this piece of code with an input operator that asks for escape pending.
      811     5415           The latter only happens for system input function tables, and only if
      812     5416           the character is not a SPCCHR in a user input function table. */
      813     5417
      814     5418    5                  IF VDH_INTINPOPR.INPFNCTBL$->
      815     5419    5                    KV$INPFNCTBL.ESCINT1_CHR(0) = VDH_INTINPOPR.ACKCHR
      816     5420        /* This character is an escape introducer. (Surprise!).                       */
      817     5421
      818     5422    5                  THEN KV$PTR.INPCNDPND.ESC.SST(0) = '1'B;
      819     5423    5                  IF VDH_INTINPOPR.INPFNCTBL$->
      820     5424    5                    KV$INPFNCTBL.ESCINT1_CHR(1) = VDH_INTINPOPR.ACKCHR
      821     5425        /* This character is an escape introducer. (Surprise!).                       */
      822     5426
      823     5427    5                  THEN KV$PTR.INPCNDPND.ESC.SST(1) = '1'B;
      824     5428        /* Reset the type-ahead buffer-character flag. It was
      825     5429           set at the top of KVI$INT because this character
      826     5430           was invoking an input function. However, the input
      827     5431           function in this case is simply to introduce a string
      828     5432           that may invoke an input function.
      829     5433
      830     5434           After processing this input operator, we'll do a 'return'
      831     5435           to skip the code at the bottom of KVI$INT that checks to see
      832     5436           if the input function should be purged from the type-ahead
      833     5437           buffers. The escape-introducer won't properly survive that
      834     5438           test. This has the side-effect of ignoring chaining on an
      835     5439           escape introducer input operator.                                          */
      836     5440
      837     5441    5                  %KV_SSN.TYPAHD.BFRCHR = '0'B;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:45   
      838     5442    5                  %KV_SSN.TYPAHD.BFRINPFNCCHR = '1'B;
      839     5443    5                  RETURN;
      840     5444        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:46   
      841     5445    5               CASE (%KV_INPPRC_FNDPSTCHR);
      842     5446        /* This is a request to find and position to the specified
      843     5447           character.                                                                 */
      844     5448
      845     5449    5                  R3 = VDH_INTINPOPR.ACKCHR;
      846     5450    5                  IF %KV_MVD.UPPERCASE
      847     5451        /* We're in upper-case-shift mode.                                            */
      848     5452
      849     5453    5                    AND R3>=ASCBIN('a') AND R3<=ASCBIN('z')
      850     5454        /* We're in upper case shift mode and this chr is
      851     5455           a lower case chr. Shift to upper case.                                     */
      852     5456
      853     5457    5                  THEN R3 = R3-BITBIN('20'X);
      854     5458    5                  ELSE IF %KV_MVD.LOWERCASE
      855     5459        /* We're in lower-case-shift mode. This isn't quite a case shift
      856     5460           we're shifting
      857     5461           sticks 6 and 7, except we don't shift underscore (x'5f), which
      858     5462           would map into del (x'7f').
      859     5463
      860     5464           The mapping is:
      861     5465
      862     5466           upper case alpha's ->lower case alpha's
      863     5467           [ (left bracket) ->{ (left brace)
      864     5468           \ (back-slash) ->| (vertical line)
      865     5469           ] (right bracket) ->} (right brace)
      866     5470           ^ (up-arrow) ->~ (tilde)                                                  */
      867     5471
      868     5472    5                    AND R3>=ASCBIN('@') AND R3<=ASCBIN('^')
      869     5473        /* We're in lower case shift mode and this chr is
      870     5474           an upper case chr. Shift to lower case.                                    */
      871     5475
      872     5476    5                  THEN R3 = R3+BITBIN('20'X);
      873     5477    5                  CALL Y$FNDPSTCHR;
      874     5478        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:47   
      875     5479    5               CASE (%KV_INPPRC_FNDPSTWRD);
      876     5480    5                  CALL Y$FNDPSTWRD;
      877     5481        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:48   
      878     5482    5               CASE (%KV_INPPRC_INCINPFLDSIZ);
      879     5483        /* This is a request to increase the input field size on a block-mode device. */
      880     5484
      881     5485    5                  CALL KVI$INCINPFLDSIZ;
      882     5486        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:49   
      883     5487    5               CASE (%KV_INPPRC_LCLLF);
      884     5488        /* This is a local line feed request.                                         */
      885     5489
      886     5490    5                  CALL KVO$PST(KV_VDH_PST_LF) ;
      887     5491        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:50   
      888     5492    5               CASE (%KV_INPPRC_LF);
      889     5493        /* This is a LF character (line feed).                                        */
      890     5494
      891     5495    5                  IF (%KV_VDI.FULLDUPLEXPAPERTAPE OR %KV_VDI.HALFDUPLEXPAPERTAPE)
      892     5496        /* If we're in paper tape mode, */
      893     5497
      894     5498    5                    AND (REDBFR$=ADDR(NIL) OR %KV_SSN.REDBFR__.DATBYTSIZ=0)
      895     5499        /* And there is no read buffer, or it is empty, ignore the LF. */
      896     5500    5                  THEN EXIT;
      897     5501    5                  %KV_SSN.INPCHR = %BITASC(ASCIILF);
      898     5502    5   KVI_NEWLIN:    ;
      899     5503    5                  SAVEBIT = %KV_SSN.INPECH;
      900     5504    5                  %KV_SSN.INPECH = '0'B;
      901     5505    5                  CALL KVI$BFRREDCHR;
      902     5506        /* If we are not in half duplex paper tape mode and we are
      903     5507           echoing, or the char activated, or we're on a block-mode device,
      904     5508           echo a newline.                                                            */
      905     5509
      906     5510    5                  IF NOT %KV_VDI.HALFDUPLEXPAPERTAPE
      907     5511    5                    AND (NOT %KV_VDI.USRRQSDAT.RED OR %KV_MVD.DISPINPUT
      908     5512    5                    OR %KV_VDI.INPUNT = %KV_INPUNT_BLK)
      909     5513    5                  THEN CALL KVO$PST (KV_VDH_PST_NEWLIN_VRT);
      910     5514    5                  %KV_SSN.INPECH = SAVEBIT;
      911     5515        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:51   
      912     5516    5               CASE (%KV_INPPRC_MNTATN);
      913     5517        /* This is a monitor attention.                                               */
      914     5518
      915     5519    5                  CALL KVM$SND (KV_SND_EVT_MNTATN);
      916     5520        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:52   
      917     5521    5               CASE (%KV_INPPRC_NXTSSN);
      918     5522
      919     5523        /* Move to a different session (if there is one). */
      920     5524
      921     5525    5                  CALL Y$PRGTYPAHDINPFNC;
      922     5526    6                  IF %KV_VDI.SSNCNT>1 THEN DO WHILE '1'B;
      923     5527    6                     IF %KV_SSN.LNK$~=ADDR(NIL)
      924     5528    6                     THEN SSN$ = %KV_SSN.LNK$;
      925     5529    6                     ELSE SSN$ = %KV_VDI.SSN$;
      926     5530    6                     IF SSN$=KV$PTR.SSN$ THEN EXIT;
      927     5531    6                     IF OPRCNT=%KV_SSN.SSNID
      928     5532    6                       OR OPRCNT<=0 AND (%KV_SSN.REDRQSPND OR NOT %KV_VDI.CRSRED)
      929     5533    6                     THEN IF %KV_SSN.SSNCNCID~=0 THEN EXIT;
      930     5534    6                  END;
      931     5535    5                  IF SSN$=KV$PTR.SSN$ THEN EXIT;
      932     5536    5                  REDBFR$ = %KV_SSN.REDBFR__.ADR$;
      933     5537    5                  KV$PTR$ = %KV_SSN.SNCPTR$;
      934     5538    5                  STR = %KV_STR.ID;
      935     5539
      936     5540        /* SETSTR will take care of cleaning up and getting us there */
      937     5541
      938     5542    5                  CALL KVS$SETSTR(STR);
      939     5543        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:53   
      940     5544    5               CASE (%KV_INPPRC_OTPPRTID, %KV_INPPRC_OTPSTT);
      941     5545        /* Output port-id or status. */
      942     5546
      943     5547    5                  STR = %KV_STR.ID;
      944     5548    5                  IF %KV_MVD.ORG>=%KV#VD_ORG_X364
      945     5549    5                  THEN CALL KVS$SETSTR (1);
      946     5550    5                  IF %KV_VDI.INPUNT=%KV_INPUNT_BLK AND %KV_VDI.USRRQSDAT.RED
      947     5551        /* This is a block-mode device with a read outstanding. Position
      948     5552           to just beyond the hi non-blank position before outputting
      949     5553           the text.                                                                  */
      950     5554
      951     5555    5                  THEN CALL KVO$PSTAFTHI_NONBLNPHSPST;
      952     5556
      953     5557    6                  IF KV$INPOPR.ID=%KV_INPPRC_OTPSTT THEN DO;
      954     5558        /* For output status, send a !HI!, and ask for the rest. */
      955     5559    6                     CALL KVO$OTPLCL (VDH_OTPLCL_BNG_HI_BNG);
      956     5560    6                     CALL KVM$SND (KV_SND_RQSSTT);
      957     5561    6                  END;
      958     5562    5                  ELSE CALL KVI$OTPPRTID;
      959     5563    5                  IF %KV_VDI.INPUNT=%KV_INPUNT_BLK AND %KV_VDI.USRRQSDAT.RED
      960     5564    5                    AND %KV_SRD.FLDEND.CLM~=0
      961     5565        /* This is a block-mode input device, there is a read pending,
      962     5566           and there is an input field declared.
      963     5567           Position the cursor to the virtual column it belongs in.                   */
      964     5568
      965     5569    5                  THEN CALL KVO$PST(KV_VDH_PST_VRT);
      966     5570
      967     5571    5                  IF STR~=%KV_STR.ID THEN CALL KVS$SETSTR(STR) ;
      968     5572        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:54   
      969     5573    5               CASE (%KV_INPPRC_PAGBRK);
      970     5574        /* This is a page break request.                                              */
      971     5575
      972     5576    5                  IF %KV_MRD.PHSFRM THEN GOTO SCREND;
      973     5577    5                  CALL KVO$PAGBRK;
      974     5578        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:55   
      975     5579    5               CASE (%KV_INPPRC_PSTBGNRED);
      976     5580        /* We are to position to the beginning of the edit window.                    */
      977     5581
      978     5582    5                  IF REDBFR$=ADDR(NIL) THEN EXIT;
      979     5583        /* The read buffer exists.                                                    */
      980     5584
      981     5585    5                  IF %KV_SSN.REDBFR.INSLOWX=%KV_SSN.REDBFR.EDTLOWX
      982     5586    6                    AND %KV_SSN.REDBFR.INSLOWX>%KV_SSN.REDBFR__.BYTX THEN DO;
      983     5587    6                     %KV_SSN.REDBFR.INSLOWX=%KV_SSN.REDBFR__.BYTX;
      984     5588    6                     %KV_SSN.REDBFR.INSMODX=%KV_SSN.REDBFR.NXTX;
      985     5589    6                  END;
      986     5590    5                  %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.INSLOWX;
      987     5591    5                  CALL Y$SCPVRTCLMLOWX;
      988     5592    5                  CALL Y$PSTLFT_N;
      989     5593        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:56   
      990     5594    5               CASE (%KV_INPPRC_PSTENDRED);
      991     5595        /* We are to position to the end of the read buffer.                          */
      992     5596
      993     5597    5                  IF REDBFR$=ADDR(NIL) THEN EXIT;
      994     5598        /* The read buffer exists.                                                    */
      995     5599
      996     5600    5                  IF %KV_SSN.REDBFR.INSMODX=%KV_SSN.REDBFR.EDTLOWX
      997     5601    6                    AND %KV_SSN.REDBFR.INSMODX<%KV_SSN.REDBFR.NXTX THEN DO;
      998     5602    7                     IF NOT (%KV_MVD.RETYPOVR AND %KV_MVD.EDITOVR) THEN DO;
      999     5603    7                        %KV_MVD.VRTCLM = %KV_MVD.VRTCLM-1;
     1000     5604    7                        CALL KVO$PST (KV_VDH_PST_VRT);
     1001     5605    7                     END;
     1002     5606    6                     %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.NXTX;
     1003     5607    6                     %KV_SSN.REDBFR.INSLOWX = %KV_SSN.REDBFR__.BYTX;
     1004     5608    6                  END;
     1005     5609    6                  IF %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.NXTX THEN DO;
     1006     5610    6                     %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.INSMODX-1;
     1007     5611    6                     CALL Y$TYPREDBFRSGM;
     1008     5612    6                     IF %KV_MVD.ORG=%KV#VD_ORG_FORM
     1009     5613    6                       AND %KV_SSN.REDBFR.EDTLOWX=%KV_STR.MAXRCRBYTSIZ
     1010     5614    6                     THEN CALL Y$PSTLFT;
     1011     5615    6                  END; ELSE IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;
     1012     5616    6                     %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;
     1013     5617    6                     %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.NXTX;
     1014     5618    6                     CALL Y$PSTLFT_N;
     1015     5619    6                  END;
     1016     5620        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:57   
     1017     5621    5               CASE (%KV_INPPRC_PSTLFT);
     1018     5622        /* We are to position to the left in the read buffer.                         */
     1019     5623
     1020     5624    5   PSTLFT:        ;
     1021     5625    5                  %KV_MVD.EDTRHT = '0'B;
     1022     5626    5                  CALL Y$PSTLFT;
     1023     5627        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:58   
     1024     5628    5               CASE (%KV_INPPRC_PSTRHT);
     1025     5629        /* We are to position to the right in the read buffer.                        */
     1026     5630
     1027     5631    5                  %KV_MVD.EDTRHT = '1'B;
     1028     5632    5                  CALL Y$PSTRHT_TYP;
     1029     5633        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:59   
     1030     5634    5               CASE (%KV_INPPRC_RCLEDTWND);
     1031     5635    5                  R5 = 0;
     1032     5636    5                  IF %KV_VDI.EDTWND$~=ADDR(NIL)
     1033     5637    5                  THEN CALL Y$TYPAHDTXT (%KV_VDI.EDTWND$->KV$EDTWND);
     1034     5638        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:60   
     1035     5639    5               CASE (%KV_INPPRC_RE_PSTRED);
     1036     5640        /* This is a re-position read (to end of prompt) request.                     */
     1037     5641
     1038     5642    5                  IF NOT %KV_VDI.RE_DSPINP THEN CALL Y$RE_PSTRED;
     1039     5643        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:61   
     1040     5644    5               CASE (%KV_INPPRC_RE_TYP);
     1041     5645        /* This is a re-type read message request.                                    */
     1042     5646
     1043     5647    5                  CALL Y$SHFTYPREDBFR;
     1044     5648        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:62   
     1045     5649    5               CASE (%KV_INPPRC_RE_TYPFRM);
     1046     5650    5   RE_DSP_FRM:    ;
     1047     5651    5                  SAVEBIT = '0'B;
     1048     5652    5                  B3 = %KV_MRD.MVD$;       /* First mark all the borders         */
     1049     5653    6                  DO WHILE B3~=ADDR(NIL);
     1050     5654    7                     IF B3->KV$MVD.SRD$->KV$SRD.BRDEXS THEN DO;
     1051     5655    7                        SAVEBIT = '1'B;
     1052     5656    7                        B3->KV$MVD.SRD$->KV$SRD.BRDUPD = '1'B;
     1053     5657    7                     END;
     1054     5658    6                     IF B3->KV$MVD.ORG>=%KV#VD_ORG_FORM
     1055     5659    6                     THEN SAVEBIT = '1'B;
     1056     5660    6                     B3 = B3->KV$MVD.LNK$;
     1057     5661    6                  END;
     1058     5662    5                  R3 = %KV_SSN.SSNID;
     1059     5663    5                  IF %KV_VDI.INPUNT=%KV_INPUNT_BLK THEN SAVEBIT = '1'B;
     1060     5664    5                  ELSE IF SAVEBIT THEN CALL KVO$ERSMRD;
     1061     5665    6                  IF SAVEBIT THEN DO UNTIL R3=%KV_SSN.SSNID;
     1062     5666    6                     STR = %KV_STR.ID;
     1063     5667    6                     B3 = %KV_SSN.STR$;    /* Search for form str(s)             */
     1064     5668    7                     DO WHILE B3~=ADDR(NIL);
     1065     5669    7                        IF B3->KV$STR.MVD$->KV$MVD.ORG>=%KV#VD_ORG_FORM
     1066     5670    8                          OR B3->KV$STR.MVD$->KV$MVD.SRD$->KV$SRD.BRDEXS THEN DO;
     1067     5671    8                           R2 = B3->KV$STR.ID;
     1068     5672    8                           IF R2~=%KV_STR.ID THEN CALL KVS$SETSTR(R2);
     1069     5673    8                           IF %KV_MVD.ORG=%KV#VD_ORG_FORM
     1070     5674    8                           THEN %KV_LINLST.FRMDSP = '0'B;
     1071     5675    8                           IF %KV_SRD.BRDUPD THEN CALL KVC$DRWBRD;
     1072     5676    8                           IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN CALL KVF$RE_TYPFRM;
     1073     5677    8                           ELSE IF %KV_MVD.ORG=%KV#VD_ORG_SE THEN CALL KVE$DSPALL;
     1074     5678
     1075     5679    8                        END;
     1076     5680    7                        B3 = B3->KV$STR.LNK$;
     1077     5681
     1078     5682    7                     END;
     1079     5683    6                     IF STR~=%KV_STR.ID THEN CALL KVS$SETSTR (STR);
     1080     5684    6                     IF SAVEBIT AND STR=%KV_SSN.REDSTRID
     1081     5685    6                       AND %KV_SRD.LNG>0 AND %KV_SRD.WDT>0
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:63   
     1082     5686    7                       AND %KV_MVD.ORG<%KV#VD_ORG_FORM THEN DO;
     1083     5687    7                        %KV_MVD.VRTCLM = 1;
     1084     5688    7                        CALL KVO$SCRENDNO_HLT;
     1085     5689    7                        CALL KVI$ENBRED;
     1086     5690    7                        REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     1087     5691    7                        CALL Y$SHFTYPREDBFR;
     1088     5692    7                     END;
     1089     5693    6                     IF %KV_SSN.LNK$=ADDR(NIL)
     1090     5694    6                     THEN SSN$ = %KV_VDI.SSN$;
     1091     5695    6                     ELSE SSN$ = %KV_SSN.LNK$;
     1092     5696    6                     %KV_VDI.ASNINPPTR$ = %KV_SSN.SNCPTR$;
     1093     5697    6                     CALL KVS$CHNSSN;      /* Make sure we do EXT/ENT-SRD stuff  */
     1094     5698    6                  END;
     1095     5699    6                  IF SAVEBIT THEN DO;
     1096     5700    6                     %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;
     1097     5701    6                     REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     1098     5702    6                  END;
     1099     5703        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:64   
     1100     5704    5               CASE (%KV_INPPRC_RSTINSMOD);
     1101     5705        /* This is a reset insert mode request.                                       */
     1102     5706
     1103     5707    5                  %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.NXTX;
     1104     5708    5                  %KV_SSN.REDBFR.INSLOWX = %KV_SSN.REDBFR__.BYTX;
     1105     5709    5                  IF REDBFR$~=ADDR(NIL) THEN CALL Y$SCPVRTCLMLOWX;
     1106     5710        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:65   
     1107     5711    5               CASE (%KV_INPPRC_SAVEDTWND);
     1108     5712    5                  R5 = %KV_SSN.REDBFR.INSMODX-%KV_SSN.REDBFR.INSLOWX;
     1109     5713    5                  IF REDBFR$=ADDR(NIL) THEN R5 = 0;
     1110     5714    5                  IF R5>256-LENGTHV(KV$EDTWND) THEN R5 = 256-LENGTHV(KV$EDTWND);
     1111     5715    5                  %VDH_GETBFR = KV_VDH_GETBFR;
     1112     5716    5                  %VDH_GETBFR.STRTYP = %KV_STRTYP_REDBFR;
     1113     5717    5                  %VDH_GETBFR.BFR$ = %KV_VDI.EDTWND$;
     1114     5718    6                  IF %VDH_GETBFR.BFR$~=ADDR(NIL) THEN DO;
     1115     5719    6                     %VDH_GETBFR.BYTSIZ = %VDH_GETBFR.BFR$->KV$EDTWND.STRBYTSIZ;
     1116     5720    7                     IF %VDH_GETBFR.BYTSIZ<R5+LENGTHV(KV$EDTWND) OR R5<=0 THEN DO;
     1117     5721    7                        CALL KVS$RLSBFR (FPT);
     1118     5722    7                        %VDH_GETBFR.BFR$ = ADDR(NIL);
     1119     5723    7                     END;
     1120     5724    6                  END;
     1121     5725    6                  IF %VDH_GETBFR.BFR$=ADDR(NIL) AND R5>0 THEN DO;
     1122     5726    6                     %VDH_GETBFR.BYTSIZ = R5+LENGTHV(KV$EDTWND);
     1123     5727    6                     CALL KVS$GETBFR (FPT);
     1124     5728    6                  END;
     1125     5729    5                  %KV_VDI.EDTWND$ = %VDH_GETBFR.BFR$;
     1126     5730    6                  IF %VDH_GETBFR.BFR$~=ADDR(NIL) THEN DO;
     1127     5731    6                     %VDH_GETBFR.BFR$->KV$EDTWND.STRBYTSIZ = %VDH_GETBFR.BYTSIZ;
     1128     5732    6                     %VDH_GETBFR.BFR$->KV$EDTWND.L = R5;
     1129     5733    6                     SUBSTR(%VDH_GETBFR.BFR$->KV$EDTWND.T,0,R5) =
     1130     5734    6                       SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR.INSLOWX,R5);
     1131     5735    6                  END;
     1132     5736        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:66   
     1133     5737    5               CASE (%KV_INPPRC_SCREND);
     1134     5738        /* This is a screen end request.                                              */
     1135     5739
     1136     5740    6                  IF NOT %KV_MRD.PHSFRM THEN DO;
     1137     5741        /* Not a fixed page-size device, do a page eject                              */
     1138     5742
     1139     5743    6                     CALL KVO$PST (KV_VDH_PST_CR_VRT);
     1140     5744    6                     CALL KVO$PAGBRK;
     1141     5745    6                  END;
     1142     5746    6                  ELSE DO;
     1143     5747    6   SCREND:           ;
     1144     5748    6                     %KV_SRD.NXTNONBLNLIN = %KV_SRD.BTMRHT.LIN+1;
     1145     5749    6                     CALL KVO$ERSSRD;
     1146     5750    6                     %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRT.LIN;
     1147     5751    6                     %KV_MVD.VRTCLM = 1;
     1148     5752    6                     %KV_SRD.VRTPSTOK = '0'B;
     1149     5753    7                     IF KV$INPOPR.ID=%KV_INPPRC_PAGBRK THEN DO;
     1150     5754    7                        %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.TOPLFT.LIN;
     1151     5755    7                        IF %KV_SRD.SCROLL
     1152     5756    7                        THEN %KV_SRD.DVCLINBIS = %KV_SRD.LNG-1;
     1153     5757    7                     END;
     1154     5758    6                  END /* IF */;
     1155     5759    6                  IF %KV_SSN.REDSTRID=%KV_STR.ID THEN DO;
     1156     5760    6                     CALL KVI$ENBRED;
     1157     5761    6                     CALL Y$SHFTYPREDBFR;
     1158     5762    6                  END /* IF */;
     1159     5763        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:67   
     1160     5764    5               CASE (%KV_INPPRC_SETINSHI_X);
     1161     5765        /* This is a set insert mode request.                                         */
     1162     5766
     1163     5767    5                  GOTO SETINSHI_X;         /* Part of TGLINSMOD                  */
     1164     5768        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:68   
     1165     5769    5               CASE (%KV_INPPRC_SETINSLOWX);
     1166     5770        /* This is a set insert mode request.                                         */
     1167     5771
     1168     5772    5                  %KV_SSN.REDBFR.INSLOWX = %KV_SSN.REDBFR.EDTLOWX;
     1169     5773    6                  IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;
     1170     5774    6                     %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.EDTLOWX;
     1171     5775    6                     %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.EDTLOWX;
     1172     5776    6                  END;
     1173     5777        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:69   
     1174     5778    5               CASE (%KV_INPPRC_TAB);
     1175     5779        /* This is a tab request.                                                     */
     1176     5780
     1177     5781    5                  SAVEBIT = %KV_SSN.INPECH;
     1178     5782    5                  %KV_SSN.INPECH = '0'B;
     1179     5783    6                  IF %KV_STR.ACTCHRTBL$->KV$SHRBFR.BITT(BITBIN(%ASCIIHT)) THEN DO;
     1180     5784        /* We're to activate on a tab.                                                */
     1181     5785
     1182     5786    6                     %KV_SSN.INPCHR = BITASC(%ASCIIHT);
     1183     5787    6                     CALL KVI$BFRREDCHR;
     1184     5788    6                  END /* IF */;
     1185     5789
     1186     5790    6                  ELSE IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN DO;
     1187     5791    6                     %VDH_PST = KV_VDH_PST_SPCFRM;
     1188     5792    6                     IF OPRCNT~=0 THEN %VDH_PST.PSTVAL.CLM = OPRCNT;
     1189     5793    6                     CALL KVF$PST(FPT);
     1190     5794
     1191     5795    6                  END; ELSE DO;
     1192     5796        /* Tab isn't an activation character and it's not a forms space-field.
     1193     5797           If we're not in tab-relative mode; tab starting at the left margin.        */
     1194     5798
     1195     5799    6                     CALL Y$EDTX_TO_VRTCLM (R2);
     1196     5800    6                     %KV_MVD.VRTCLM = R2;
     1197     5801    6                     %KV_MVD.EDTRHT = '1'B;
     1198     5802    6                     R2 = R2+DSPLOWCLM;
     1199     5803    6                     IF OPRCNT=0 THEN R2 = R2+1;
     1200     5804    6                     IF OPRCNT<0 THEN %KV_MVD.EDTRHT = '0'B;
     1201     5805    6                     IF %KV_MVD.TABRELATIVE
     1202     5806        /* We're in tab-relative mode; tab relative to the position
     1203     5807           the prompt ended at.                                                       */
     1204     5808
     1205     5809    6                     THEN R2 = R2-%KV_SRD.PRMVRTCLM;
     1206     5810    6                     B3 = %KV_MVD.INPTAB$;
     1207     5811    6                     R5 = SIZEC(KV$SHRBFR);
     1208     5812
     1209     5813    6                     IF OPRCNT>0 THEN R2 = OPRCNT;
     1210     5814    6                     ELSE IF B3~=ADDR(NIL)
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:70   
     1211     5815    7                     THEN IF B3->KV$SHRBFR.BYTSIZ>=R5 THEN DO;
     1212     5816        /* the tab buffer exists. */
     1213     5817
     1214     5818    7                        IF B3->KV$SHRBFR.BYT(1)>=R2
     1215     5819        /* The first tab is the one we want */
     1216     5820
     1217     5821    7                        THEN IF OPRCNT<0 THEN R2 = 1;
     1218     5822    7                        ELSE R2 = B3->KV$SHRBFR.BYT(1);
     1219     5823    7                        ELSE IF B3->KV$SHRBFR.BYT(1)~=0
     1220     5824        /* The first tab is not the last. */
     1221     5825
     1222     5826        /* This loop is traversed for each position in the tab buffer
     1223     5827           scanned, until the correct tab is found or the end is encountered.         */
     1224     5828
     1225     5829    8                        THEN TABLOOP: DO WHILE (R5<B3->KV$SHRBFR.BYTSIZ);
     1226     5830    8                           IF B3->KV$SHRBFR_BYT(R5)<=B3->KV$SHRBFR_BYT(R5-1)
     1227     5831        /* The tabs must monotonically increase. */
     1228     5832
     1229     5833    8                           THEN EXIT;
     1230     5834
     1231     5835    9                           IF B3->KV$SHRBFR_BYT(R5)>=R2 THEN DO;
     1232     5836        /* The current tab stop is greater than the one we're looking for; we've found*/
     1233     5837
     1234     5838    9                              R2 = B3->KV$SHRBFR_BYT(R5);
     1235     5839    9                              EXIT TABLOOP;
     1236     5840    9                           END /* IF */;
     1237     5841    8                           R5 = R5+1;
     1238     5842    8                        END /* LOOP */;
     1239     5843    7                        IF OPRCNT<0 AND R2>1 THEN R2 = B3->KV$SHRBFR_BYT(R5-1);
     1240     5844    7                     END;
     1241     5845
     1242     5846    6                     IF %KV_MVD.TABRELATIVE THEN R2 = R2+%KV_SRD.PRMVRTCLM;
     1243     5847    7                     IF %KV_MVD.SPACEINSERT OR OPRCNT~=0 THEN DO;
     1244     5848    7                        IF %KV_MVD.TABSIM THEN %KV_SSN.INPECH = SAVEBIT;
     1245     5849    7                        OPRCNT = R2-%KV_MVD.VRTCLM-DSPLOWCLM;
     1246     5850    7                        IF OPRCNT>0 THEN CALL Y$PSTRHT_TYP;
     1247     5851    8                        ELSE IF OPRCNT<0 THEN DO;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:71   
     1248     5852    8                           OPRCNT = -OPRCNT;
     1249     5853    8                           CALL Y$PSTLFT;
     1250     5854    8                        END;
     1251     5855    7                        %KV_SSN.INPECH = SAVEBIT;
     1252     5856    7                        IF %KV_MVD.TABSIM OR NOT %KV_SSN.REDRQSPND
     1253     5857    7                        THEN EXIT INPPRC;
     1254     5858    7                     END;
     1255     5859    7                     ELSE DO;
     1256     5860    7                        %KV_SSN.INPCHR = BITASC(%ASCIIHT);
     1257     5861    7                        CALL KVI$BFRREDCHR;
     1258     5862    7                        REDBFR$ = %KV_SSN.REDBFR__.ADR$; /* Possible extension   */
     1259     5863    7                     END /* IF */;
     1260     5864    6                     R2 = R2-DSPLOWCLM;
     1261     5865
     1262     5866    6                     IF %KV_VDI.RE_DSPINP THEN %KV_SRD.VRTPSTOK='0'B;
     1263     5867    7                     ELSE IF %KV_MVD.RETYPOVR OR %KV_MVD.DISPINPUT THEN DO;
     1264     5868    7                        IF %KV_VDI.HALFDUPLEXPAPERTAPE THEN EXIT;
     1265     5869    8                        IF %KV_MVD.TABSIM THEN DO;
     1266     5870        /* We're in tab simulation mode; move the carriage manually.                  */
     1267     5871
     1268     5872    8                           IF %KV_MVD.RETYPOVR AND NOT %KV_SRD.VRTPSTOK
     1269     5873        /* First restore current position in case of esc-q or esc-g                   */
     1270     5874
     1271     5875    8                           THEN CALL KVO$PST(KV_VDH_PST_VRT);
     1272     5876    8                           %KV_MVD.VRTCLM = R2;
     1273     5877        /* Now get to the new position                                                */
     1274     5878
     1275     5879    8                           IF %KV_MVD.HRZSCR
     1276     5880    8                           THEN IF R2+%KV_MVD.HRZSCRMRG>%KV_MVD.WDT
     1277     5881    8                           THEN CALL Y$SHFDSPPST;
     1278     5882    8                           CALL KVO$PST(KV_VDH_PST_VRT);
     1279     5883    8                        END; ELSE DO;
     1280     5884        /* We're not to simulate tabs; the device will do it for us (!?)              */
     1281     5885    8                           CALL KVO$OTP1_VRT (%ASCIIHT);
     1282     5886    8                           %KV_MVD.VRTCLM = R2;
     1283     5887    8                        END /* IF */;
     1284     5888    7                     END /* IF */;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:72   
     1285     5889    6                  END /* IF */;
     1286     5890    5                  %KV_SSN.INPECH = SAVEBIT;
     1287     5891        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:73   
     1288     5892    5               CASE (%KV_INPPRC_TGLINSMOD);
     1289     5893
     1290     5894        /* A toggle-insert-mode request. */
     1291     5895
     1292     5896    5                  IF %KV_SSN.REDBFR.INSMODX~=%KV_SSN.REDBFR.NXTX
     1293     5897    5                    OR %KV_SSN.REDBFR.INSLOWX~=%KV_SSN.REDBFR__.BYTX
     1294     5898    5                  THEN CALL KVI$INTINPOPRX (%KV_INPOPRX_RSTINSMOD);
     1295     5899    6                  ELSE DO;
     1296     5900    6                     %KV_SSN.REDBFR.INSLOWX=%KV_SSN.REDBFR.EDTLOWX;
     1297     5901    6   SETINSHI_X:       ;
     1298     5902    6                     %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.EDTLOWX;
     1299     5903    6                     IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX
     1300     5904    6                     THEN %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.EDTLOWX;
     1301     5905    6                     IF (NOT %KV_MVD.EDITOVR OR NOT %KV_MVD.RETYPOVR)
     1302     5906
     1303     5907    6                       AND %KV_MVD.DISPINPUT
     1304     5908    7                       AND %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.NXTX THEN DO;
     1305     5909         /* We're not editing in place, so type the \                                  */
     1306     5910
     1307     5911    7                        CALL KVO$PST (KV_VDH_PST_WHTSPC);
     1308     5912    7                        CALL KVO$OTP1_VRT (%ASCIIBCKSLS);
     1309     5913    7                     END /* IF */;
     1310     5914    6                  END /* IF */;
     1311     5915        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:74   
     1312     5916    5               CASE (%KV_INPPRC_TGLLCLMOD);
     1313     5917    5               CASE(ELSE);
     1314     5918    5                  IF %KV_MVD.ORG=%KV#VD_ORG_SE THEN CALL KVE$INPOPR (KV$INPOPR)
     1315     5919    6                  WHENRETURN DO;
     1316     5920    6                     EXIT INPPRC;
     1317     5921    6                  END;
     1318     5922        /* This function table has a bad entry -
     1319     5923           we dont know from this input procedure.                               */
     1320     5924
     1321     5925        /*S* SCREECH_CODE: KVI-S$KV_INPFNC
     1322     5926             MESSAGE: Bad INPPRC value in an input function table.              */
     1323     5927
     1324     5928                       %KH$SCREECH(COD = KVI_INPFNC);
     1325     5932
     1326     5933    5               END /* CASE VDH- */ INPPRC;
     1327     5934    4               %KV_SSN.LSTPRMID = 0;
     1328     5935    4            END /* DO CASE */ INPOPR;
     1329     5936    3         END;
     1330     5937        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:75   
     1331     5938        /* Processing of this input operator isn't required during
     1332     5939           this phase.                                                                */
     1333     5940
     1334     5941    2         ELSE IF %KV_STR.SNDMAXNMBRCR>0
     1335     5942    2           AND NOT %KV_VDI.USRRQSDAT.RED
     1336     5943        /* There is a delayed read request that hasn't yet been enabled.
     1337     5944           set the delayed read request trigger.                                      */
     1338     5945
     1339     5946    2         THEN %KV_SSN.NO_WATREDTRG = '1'B;
     1340     5947    2         IF KV$INPOPR.TYP=%KV_INPOPR_TYP_JMP
     1341     5948    2         THEN INPOPR$ = PINCRW (INPOPR$, 1-KV$INPOPR.INPOPRX);
     1342     5949
     1343     5950    2         ELSE IF NOT KV$INPOPR.CHN THEN EXIT;
     1344     5951        /* This input operator is chained, so go on to the next INPOPR.               */
     1345     5952
     1346     5953    2         ELSE IF KV$INPOPR.TYP=%KV_INPOPR_TYP_TXT
     1347     5954    2         THEN INPOPR$ = PINCRW (INPOPR$,KV$INPOPR_TXT.L/2+2);
     1348     5955    2         ELSE IF KV$INPOPR.TYP=%KV_INPOPR_TYP_PST
     1349     5956    2         THEN INPOPR$ = PINCRW (INPOPR$,SIZEW(KV$INPOPR_PST));
     1350     5957    2         ELSE INPOPR$ = PINCRW (INPOPR$,SIZEW(KV$INPOPR));
     1351     5958    2         OPRCNT = 0;
     1352     5959    2      END /* LOOP */;
     1353     5960    1      IF NOT %KV_SSN.TYPAHD.BFRCHR AND VDH_INTINPOPR.IMD
     1354     5961        /* We didn't ask to have the characters invoking this input
     1355     5962           function saved in the type-ahead buffer. Purge
     1356     5963           whatever part of the string may have been saved.                           */
     1357     5964
     1358     5965    1      THEN CALL Y$PRGTYPAHDINPFNC;
     1359     5966    1      RETURN;
     1360     5967        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:76   
     1361     5968    1   Y$ABRRED: PROC;
     1362     5969
     1363     5970        /* Abort any pending read.                                                    */
     1364     5971
     1365     5972        /* If a marker request message hasn't already been sent, send one.
     1366     5973           (MNTATNRQS and BRKRQS constitute marker requests.)                         */
     1367     5974
     1368     5975    2      CALL KVM$SND (KV_SND_RQSMRK_DLTRCVRQS);
     1369     5976    2      IF NOT %KV_SSN.REDRQSPND THEN RETURN;
     1370     5977        /* There is a read request pending.                                          */
     1371     5978
     1372     5979    2      %KV_SSN.REDRSPCNT = %KV_SSN.REDRSPCNT+1;
     1373     5980    2      CALL Y$PRGRED;
     1374     5981    2      CALL Y$TRMRED;
     1375     5982    2      %KV_STR.SNDMAXNMBRCR = %KV_STR.SNDMAXNMBRCR-1;
     1376     5983    2      RETURN;
     1377     5984    2   END;
     1378     5985        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:77   
     1379     5986    1   Y$BLKTYPAHD: PROC;
     1380     5987
     1381     5988        /* Hi non-blank physical position, saved.                                     */
     1382     5989
     1383     5990        %KV$PST(NAME=HI_NONBLN, STCLASS=AUTO, LVL=1);
     1384     6024
     1385     6025        /* Substructure describing the physical (cursor) position items.              */
     1386     6026
     1387     6027
     1388     6028        /* Current physical position, saved.                                          */
     1389     6029
     1390     6030        %KV$PST(NAME=CRT, STCLASS=AUTO, LVL=1);
     1391     6064
     1392     6065    2      IF NOT %KV_VDI.USRRQSDAT.RED
     1393     6066        /* There isn't a read outstanding, so it's ok to do type-ahead
     1394     6067           or to enable a delayed read.                                               */
     1395     6068
     1396     6069    2      THEN IF %KV_STR.SNDMAXNMBRCR~=0
     1397     6070        /* There is a delayed read request outstanding.                               */
     1398     6071
     1399     6072    2      THEN %KV_SSN.NO_WATREDTRG = '1'B;
     1400     6073    3      ELSE DO;
     1401     6074        /* There is no delayed read request outstanding.
     1402     6075           Do type-ahead.                                                             */
     1403     6076
     1404     6077        /* Set up the following on the next clear line.                               */
     1405     6078
     1406     6079        /* 'TYPE: '<input attribute> space for input <output attribute>               */
     1407     6080
     1408     6081    3         HI_NONBLN = %KV_SRD.HI_NONBLN;
     1409     6082    3         CRT = %KV_SRD.CRT;
     1410     6083
     1411     6084        /* Position to the left margin of the next clear line, and display
     1412     6085           the prompt.                                                                */
     1413     6086
     1414     6087    3         %KV_SRD.HI_NONBLN.CLM = %KV_SRD.BTMRHT.CLM;
     1415     6088    3         CALL KVO$PSTAFTHI_NONBLNPHSPST;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:78   
     1416     6089    3         CALL KVO$OTPLCL (VDH_OTPLCL_TYPE);
     1417     6090
     1418     6091        /* Set the attribute for the beginning of the input field.                    */
     1419     6092
     1420     6093    3         %USR_SETATR = KV_USR_SETATR;
     1421     6094    3         %USR_SETATR.PHSPST = %KV_SRD.CRT;
     1422     6095    3         %USR_SETATR.GRPRND = %KV_MRD.ABSGRPRND(%KV_ABSGRPRND_INPUT);
     1423     6096    3         %USR_SETATR.QLF.ACPALL = '1'B;
     1424     6097    3         IF NOT %KV_MVD.DISPINPUT
     1425     6098        /* We aren't to display the input data.                                       */
     1426     6099
     1427     6100    3         THEN %USR_SETATR.GRPRND.HDN = '1'B;
     1428     6101    3         CALL KVV$CALUSR (FPT);
     1429     6102
     1430     6103        /* Set the attribute for the end of the input field.                          */
     1431     6104
     1432     6105    3         %USR_SETATR.GRPRND = %KV_MRD.ABSGRPRND(%KV_ABSGRPRND_OUTPUT);
     1433     6106    3         %USR_SETATR.QLF.PRT = '1'B;
     1434     6107    3         %USR_SETATR.PHSPST.CLM = %KV_SRD.BTMRHT.CLM;
     1435     6108    3         %KV_SRD.FLDEND = %USR_SETATR.PHSPST;
     1436     6109    3         %KV_VDI.USRRQSDAT.TYPAHD = '1'B;
     1437     6110    3         CALL KVV$CALUSR (FPT);
     1438     6111
     1439     6112        /* Position back to just after the attribute declaration.                     */
     1440     6113
     1441     6114    3         IF %KV_MRD.ATRRQRDSPPST
     1442     6115        /* The attribute requires a display position. Skip over it.                   */
     1443     6116
     1444     6117    3         THEN %KV_SRD.CRT.CLM = %KV_SRD.CRT.CLM+1;
     1445     6118    3         %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;
     1446     6119    3         CALL KVV$CALUSR_PST;
     1447     6120
     1448     6121        /* Halt output. This is to prevent anything we do after this point
     1449     6122           from writing in our input field. The VDH-user always clears
     1450     6123           the halt condition when it receives input from the device.                 */
     1451     6124
     1452     6125    3         CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_HLTOTP);
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:79   
     1453     6126
     1454     6127        /* Erase the line we just declared for type-ahead.
     1455     6128           Reset a few things to the way they were (maybe adjusted) when
     1456     6129           we started setting up for type-ahead.                                      */
     1457     6130
     1458     6131    3         %KV_SRD.FLDEND.CLM = %KV_SRD.BTMRHT.CLM+1;
     1459     6132    3         %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;
     1460     6133    3         CALL KVO$ERSTO_ENDOF_INP;
     1461     6134        /*N* THE OBEV CALL SHOULD SAY DLTATR. */
     1462     6135    3         %KV_SRD.FLDEND = '0'B;
     1463     6136    4         IF CRT.LIN>%USR_SETATR.PHSPST.LIN THEN DO;
     1464     6137        /* We must have wrapped to get past HI_NONBLN. */
     1465     6138
     1466     6139    4            CRT.LIN = %KV_SRD.TOPLFT.LIN;
     1467     6140    4            HI_NONBLN.LIN = 0;
     1468     6141    4         END /* IF */;
     1469     6142    3         %KV_SRD.HI_NONBLN = HI_NONBLN;
     1470     6143    3         %KV_SRD.CRT = CRT;
     1471     6144    3         %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;
     1472     6145    3      END /* IF */;
     1473     6146    2      RETURN;
     1474     6147    2   END /* SUBROUTINE */;
     1475     6148        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:80   
     1476     6149    1   Y$ECHINPOPR: PROC;
     1477     6150
     1478     6151    2      IF NOT %KV_VDI.HALFDUPLEXPAPERTAPE
     1479     6152    2        AND %KV_MVD.ORG~=%KV#VD_ORG_FORM
     1480     6153    3        AND NOT KV$PTR.USRINPFNCINH THEN DO;
     1481     6154        /* We are to print the character that invoked the escape
     1482     6155              sequence (or spcchr), bracketed by < and > .
     1483     6156           E.g., if ESC R was entered, print. <R>                                   */
     1484     6157
     1485     6158    3         SAVEBIT = %KV_SRD.TRUNCATE;
     1486     6159    3         %KV_SRD.TRUNCATE = '1'B;
     1487     6160        /* Dont scroll because of these chars                                         */
     1488     6161
     1489     6162    3         CALL KVO$OTP1_NONVRT (%ASCIILFTARW);
     1490     6163    4         IF KV$INPOPR.TYP=%KV_INPOPR_TYP_TGLPRM AND KV$INPOPR.PRMID=0 THEN DO;
     1491     6164    4            R5 = KV_PRMACK_TXTU(KV$PTR.INPCNDPND.OPRX);
     1492     6165    4            CALL KVO$OTP1_NONVRT (R5);
     1493     6166    4            CALL KVO$OTP1_NONVRT (BINBIT(R5,8));
     1494     6167    4         END;
     1495     6168    4         ELSE IF VDH_INTINPOPR.ACKCHR<BITBIN(%ASCIISP) THEN DO;
     1496     6169        /* Ack control chars as the keytop char then C.                               */
     1497     6170
     1498     6171    4            CALL KVO$OTP1_NONVRT (VDH_INTINPOPR.ACKCHR+64);
     1499     6172    4            CALL KVO$OTP1_NONVRT ('C');
     1500     6173    4         END /* IF */;
     1501     6174    3         ELSE CALL KVO$OTP1_NONVRT (VDH_INTINPOPR.ACKCHR);
     1502     6175    3         IF KV$INPOPR.TYP=%KV_INPOPR_TYP_TGLPRM
     1503     6176        /* For toggles, ACK the new state with + or - */
     1504     6177
     1505     6178    3         THEN CALL KVO$OTP1_NONVRT (ASCBIN('-')-2*%VDH_SETPRM.VAL);
     1506     6179    3         CALL KVO$OTP1_NONVRT (%ASCIIRHTARW);
     1507     6180    3         %KV_SRD.TRUNCATE = SAVEBIT;
     1508     6181    3      END /* IF */;
     1509     6182    2      RETURN;
     1510     6183    2   END;
     1511     6184        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:81   
     1512     6185    1   Y$EDTX_TO_VRTCLM: PROC (VRTCLM);
     1513     6186
     1514     6187        /* Convert an edit index (index into KV$REDBFR.CHR) to a virtual
     1515     6188           column.                                                                    */
     1516     6189    2   DCL VRTCLM SBIN;
     1517     6190    2   DCL R SBIN;
     1518     6191
     1519     6192    2      EDTX = %KV_SSN.REDBFR.EDTLOWX;
     1520     6193    2   Y$BYTX_TO_VRTCLM: ENTRY;
     1521     6194    2      DSPLOWCLM = %KV_SSN.REDBFR.DSPLOWX;
     1522     6195    2      R5 = 1+%KV_SRD.PRMVRTCLM;
     1523     6196    2      IF %KV_SSN.CLMIS_BYTX
     1524     6197    2      THEN R5 = R5+EDTX-DSPLOWCLM;
     1525     6198    3      ELSE DO;
     1526     6199    3         IF EDTX=%KV_SSN.REDBFR.NXTX THEN %KV_SSN.CLMIS_BYTX = '1'B;
     1527     6200    3         R = %KV_SSN.REDBFR__.BYTX;
     1528     6201    4         DO WHILE R<EDTX;
     1529     6202    4            IF KV$REDBFR.CHR(R)>=' '
     1530     6203    4              AND KV$REDBFR.CHR(R)~=BITASC(%ASCIIDEL) THEN R5 = R5+1;
     1531     6204    5            ELSE DO;
     1532     6205    5               IF KV$REDBFR.CHR(R)=BITASC(%ASCIICR) THEN R5 = 1;
     1533     6206    5               ELSE IF KV$REDBFR.CHR(R)=BITASC(%ASCIIBS) THEN R5 = R5-1;
     1534     6207    5               IF R5=0 THEN R5 = R5+1;
     1535     6208    5               %KV_SSN.CLMIS_BYTX = '0'B;
     1536     6209    5            END;
     1537     6210    4            R = R+1;
     1538     6211    4            IF R=DSPLOWCLM THEN DSPLOWCLM = -R5;
     1539     6212    4         END /* LOOP */;
     1540     6213    4         IF DSPLOWCLM>0 THEN DO;
     1541     6214    4            VRTCLM = R5;                   /* Save the result for a while        */
     1542     6215    5            DO WHILE R<DSPLOWCLM;
     1543     6216    5               IF KV$REDBFR.CHR(R)>=' ' AND KV$REDBFR.CHR(R)~=BITASC(%ASCIIDEL)
     1544     6217    5               THEN R5 = R5+1;
     1545     6218    5               ELSE IF KV$REDBFR.CHR(R)=BITASC(%ASCIICR) THEN R5 = 1;
     1546     6219    6               ELSE IF KV$REDBFR.CHR(R)=BITASC(%ASCIIBS) THEN DO;
     1547     6220    6                  R5 = R5-1;
     1548     6221    6                  IF R5=0 THEN R5 = R5+1;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:82   
     1549     6222    6               END;
     1550     6223    5               R = R+1;
     1551     6224    5            END;
     1552     6225    4            DSPLOWCLM = -R5;
     1553     6226    4            R5 = VRTCLM;
     1554     6227    4         END;
     1555     6228    4         IF DSPLOWCLM~=0 THEN DO;
     1556     6229    4            DSPLOWCLM = -DSPLOWCLM-%KV_SRD.PRMVRTCLM-1;
     1557     6230    4            R5 = R5-DSPLOWCLM;
     1558     6231    4         END;
     1559     6232    3      END;
     1560     6233    2      IF (NOT %KV_MVD.RETYPOVR OR NOT %KV_MVD.EDITOVR)
     1561     6234    2        AND %KV_SSN.REDBFR.INSMODX<%KV_SSN.REDBFR.NXTX THEN R5 = R5+1;
     1562     6235        /* Make room for the backslash if were inserting on hard-copy. */
     1563     6236
     1564     6237    2      VRTCLM = R5;
     1565     6238    2      RETURN;
     1566     6239    2   END;
     1567     6240        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:83   
     1568     6241    1   Y$FNDPSTCHR: PROC;
     1569     6242
     1570     6243        /* Temp storage. */
     1571     6244
     1572     6245    2   DCL 1 TMP,
     1573     6246
     1574     6247        /* Char to search for. */
     1575     6248
     1576     6249    2          2 CHR CHAR(1),
     1577     6250
     1578     6251        /* ID.  For KVE$SE to know what to do. */
     1579     6252        /* In the same place as in KV$INPOPR. */
     1580     6253
     1581     6254    2          2 ID UBIN BYTE CALIGNED,
     1582     6255
     1583     6256        /* Reverse direction. We're currently searching in the reverse
     1584     6257           of the originally requested direction.                                     */
     1585     6258
     1586     6259    2          2 RVRDRC BIT(1),
     1587     6260
     1588     6261        /* Word search - position to the position after the search char (a blank). */
     1589     6262
     1590     6263    2          2 WRD BIT(1),
     1591     6264    2          2 * BIT(14);
     1592     6265    2   DCL TMPU REDEF TMP UBIN(32);
     1593     6266
     1594     6267        /* Find and position to given virtual column.                                 */
     1595     6268
     1596     6269    2      TMP = '0'B;
     1597     6270    2      TMP.CHR = BINASC(R3);
     1598     6271    3      IF %KV_MVD.USRINPFNCTBL$~=ADDR(NIL) THEN DO;
     1599     6272        /* First check that the char isn't a SPCCHR that's really just a translation. */
     1600     6273
     1601     6274    3         B3 = %KV_MVD.USRINPFNCTBL$;
     1602     6275    3         IF B3->KV$INPFNCTBL.SPCCHR(VDH_INTINPOPR.ACKCHR)
     1603     6276    4           AND B3->KV$INPFNCTBL.ID_CHRCNT(%KV_INPFNCTYP_SPCCHR)~=0 THEN DO;
     1604     6277        /* We've got a pretty good chance of finding it. */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:84   
     1605     6278
     1606     6279    4            CALL INDEX (R2, TMP.CHR, SUBSTR (B3->KV$INPFNCCHR,
     1607     6280    4              B3->KV$INPFNCTBL.ID_CHROFS(%KV_INPFNCTYP_SPCCHR),
     1608     6281    4              B3->KV$INPFNCTBL.ID_CHRCNT(%KV_INPFNCTYP_SPCCHR)))
     1609     6282    5            WHENRETURN DO;
     1610     6283        /* It's there, check to see if it's a vanilla translation. */
     1611     6284
     1612     6285    5               B3 = PINCRW(B3, B3->KV$INPFNCTBL.INPOPROFS+B3->KV$INPFNCOPRX
     1613     6286    5                 (B3->KV$INPFNCTBL.OPRX_OFS(%KV_INPFNCTYP_SPCCHR)+R2));
     1614     6287    5               IF B3->KV$INPOPR.TYP=%KV_INPOPR_TYP_TXT
     1615     6288    5                 AND B3->KV$INPOPR_TXT.DSP=%KV_INPOPR_TXT_DSP_TYPAHDBFR
     1616     6289    5               THEN IF B3->KV$INPOPR_TXT.L=1
     1617     6290    5               THEN TMP.CHR = SUBSTR (B3->KV$INPOPR_TXT.T,0,1);
     1618     6291    6               ELSE IF B3->KV$INPOPR_TXT.L=0 THEN DO;
     1619     6292    6                  KV$PTR.INPCNDPND.INPOPR = '1'B; /* Try the next one            */
     1620     6293    6                  RETURN;
     1621     6294    6               END;
     1622     6295    5            END /* IF */;
     1623     6296    4         END /* IF */;
     1624     6297    3      END /* IF */;
     1625     6298    2      GOTO SUBCOMMON;
     1626     6299
     1627     6300    2   Y$FNDPSTWRD: ENTRY;
     1628     6301
     1629     6302    2      TMPU = %BITBIN('20004000'X);
     1630     6303    2   SUBCOMMON:;
     1631     6304    2      IF REDBFR$=ADDR(NIL) THEN RETURN;
     1632     6305    3      DO WHILE '1'B;
     1633     6306        /* This loop is iterated (once) if we have to reverse direction. */
     1634     6307
     1635     6308    4         IF %KV_MVD.EDTRHT\TMP.RVRDRC THEN DO;
     1636     6309        /* We're to search to the right. */
     1637     6310
     1638     6311    4            R2 = %KV_SSN.REDBFR.EDTHI_X;
     1639     6312    4            IF NOT TMP.WRD THEN R2 = R2+1;
     1640     6313    4            R5 = %KV_SSN.REDBFR.INSMODX;
     1641     6314        /*N* PL6 BUG!
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:85   
     1642     6315              IF R2<R5 THEN CALL INDEX (R2, TMP.CHR, SUBSTR(KV$REDBFR_CHR,R2,R5-R2))
     1643     6316                 WHENRETURN DO; */
     1644     6317    5            DO WHILE R2<R5;
     1645     6318    5               IF KV$REDBFR.CHR(R2) = TMP.CHR THEN EXIT;
     1646     6319    5               R2 = R2+1;
     1647     6320    5            END;
     1648     6321    4            IF TMP.WRD
     1649     6322    5            THEN DO WHILE R2<R5 AND KV$REDBFR.CHR(R2)=' ';
     1650     6323    5               R2 = R2+1;
     1651     6324    5            END;
     1652     6325    5            IF R2<R5 THEN DO;              /**/
     1653     6326        /*N* END OF PL6 BUG SUBTERFUGE. */
     1654     6327        /* Found one, get us positioned there. */
     1655     6328
     1656     6329    5               IF TMP.CHR = %BITASC(ASCIIBS) THEN R2 = R2-1;
     1657     6330    5               %KV_SSN.REDBFR.EDTHI_X = R2;
     1658     6331    5               R2 = %KV_SSN.REDBFR.EDTLOWX;
     1659     6332    5               CALL Y$SCPVRTCLMHI_X;
     1660     6333    5               %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX-1;
     1661     6334    5               %KV_SSN.REDBFR.EDTLOWX = R2;
     1662     6335    5               CALL Y$TYPREDBFRSGM;
     1663     6336    5               CALL Y$SCPVRTCLMLOWX;
     1664     6337    5               %KV_MVD.EDTRHT = '1'B;
     1665     6338    5               RETURN;
     1666     6339    5            END;
     1667     6340    4         END; ELSE DO;
     1668     6341        /* We're to search to the left. */
     1669     6342
     1670     6343    4            R2 = %KV_SSN.REDBFR.EDTLOWX;
     1671     6344    4            R5 = %KV_SSN.REDBFR.INSLOWX;
     1672     6345    5            IF TMP.WRD THEN DO WHILE R2>R5;
     1673     6346    5               IF KV$REDBFR.CHR(R2-1)~=' ' THEN EXIT;
     1674     6347    5               R2 = R2-1;
     1675     6348    5            END;
     1676     6349    5            DO WHILE R2>R5;
     1677     6350    5               R2 = R2-1;
     1678     6351    5               IF KV$REDBFR.CHR(R2)=TMP.CHR
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:86   
     1679     6352    6                 OR TMP.WRD AND R2=R5 THEN DO;
     1680     6353        /* Found one, get us positioned there. */
     1681     6354
     1682     6355    6                  IF KV$REDBFR.CHR(R2)=' ' AND TMP.WRD THEN R2 = R2+1;
     1683     6356    6                  IF TMP.CHR=%BITASC(ASCIIBS) THEN R2 = R2-1;
     1684     6357    6                  %KV_SSN.REDBFR.EDTLOWX = R2;
     1685     6358    6                  CALL Y$SCPVRTCLMLOWX;
     1686     6359    6                  CALL Y$SCPVRTCLMHI_X;
     1687     6360    6                  CALL Y$PSTLFT_N;
     1688     6361    6                  %KV_MVD.EDTRHT = '0'B;
     1689     6362    6                  RETURN;
     1690     6363    6               END /* IF */;
     1691     6364    5            END /* LOOP */;
     1692     6365    4         END /* IF */;
     1693     6366    4         IF %KV_MVD.RCRWRAP THEN DO;
     1694     6367    4            TMP.ID = KV$INPOPR.ID;
     1695     6368    5            CALL KVE$INPOPR (TMP) WHENRETURN DO;
     1696     6369    5               TMP.RVRDRC = '1'B;
     1697     6370    5            END;
     1698     6371    4         END;
     1699     6372    3         IF TMP.RVRDRC OR %KV_SSN.LSTPRMID=%KV_PRMID_EDTRHT THEN RETURN;
     1700     6373        /* Already tried reversing directions, give up. */
     1701     6374    3         TMP.RVRDRC = '1'B;
     1702     6375    3      END /* LOOP */;
     1703     6376    2   END;
     1704     6377        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:87   
     1705     6378    1   Y$PRGRED: PROC;
     1706     6379
     1707     6380        /* Release the read buffer.                                                   */
     1708     6381
     1709     6382    3      IF REDBFR$~= ADDR(NIL) THEN DO;
     1710     6383        /* There is a read buffer.                                                    */
     1711     6384
     1712     6385    3         IF %KV_SSN.REDBFR__.DATBYTSIZ~=0
     1713     6386        /* The read buffer isn't empty.                                               */
     1714     6387
     1715     6388    3         THEN %KV_VDI.PRG.RED = '1'B;
     1716     6389
     1717     6390    3         %VDH_RLSBFR = KV_VDH_RLSBFR;
     1718     6391    3         %VDH_RLSBFR.STRTYP = %KV_STRTYP_REDBFR;
     1719     6392    3         %VDH_RLSBFR.BFR$ = REDBFR$;
     1720     6393    3         %VDH_RLSBFR.BYTSIZ = %KV_SSN.REDBFR__.BFRBYTSIZ;
     1721     6394    3         CALL KVS$RLSBFR (FPT);
     1722     6395    3         %KV_SSN.REDBFR__ = '0'B;
     1723     6396    3         FPT(0) = %KV_SSN.REDBFR.DSPLOWX;
     1724     6397    3         %KV_SSN.REDBFR = '0'B;
     1725     6398    3         IF %KV_MVD.ORG=%KV#VD_ORG_SE
     1726     6399    3         THEN %KV_SSN.REDBFR.DSPLOWX = FPT(0);
     1727     6400    3         REDBFR$ = ADDR(NIL);
     1728     6401    3      END /* IF */;
     1729     6402    2      %KV_SSN.CLMIS_BYTX = '1'B;
     1730     6403    2      %KV_VDI.RE_DSPLOWX = 0;
     1731     6404    2      RETURN;
     1732     6405    2   END;
     1733     6406        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:88   
     1734     6407    1   Y$PRGTYPAHD: PROC;
     1735     6408        /* type-ahead delete - delete all type-ahead in the type-ahead buffers
     1736     6409        except any partially bufferred input function sequence.                       */
     1737     6410
     1738     6411    2      B3 = %KV_SSN.TYPAHDBFRHED$;
     1739     6412    2      IF B3->KV$TYPAHDBFR.CHRX>B3->KV$TYPAHDBFR.CHRX_HI
     1740     6413
     1741     6414        /* the head type-ahead buffer is empty, so we're not                          */
     1742     6415        /* deleting type-ahead.                                                       */
     1743     6416
     1744     6417    2      THEN RETURN;
     1745     6418
     1746     6419
     1747     6420        /* insure that we do not set the purge bit if we are only                     */
     1748     6421        /* purging the first character of a control string (like                      */
     1749     6422        /* in the break key case).                                                    */
     1750     6423
     1751     6424    2      IF B3~=%KV_SSN.TYPAHDBFRINPFNC$ OR
     1752     6425    2        B3->KV$TYPAHDBFR.CHRX<=%KV_SSN.TYPAHDBFRINPFNCX
     1753     6426    2      THEN %KV_SSN.VDI$->KV$VDI.PRG.TYPAHD = '1'B;
     1754     6427    2      %KV_SSN.NO_WATREDTRG = '0'B;         /* Nothing to start a read anymore    */
     1755     6428        /*N* eh?    kv$copptr (if, none) */
     1756     6429    2   Y$PRGTYPAHDINT:;
     1757     6430
     1758     6431        /* this loop is traversed for each buffer released.                           */
     1759     6432
     1760     6433    3      DO WHILE B3->KV$TYPAHDBFR.LNK$~=ADDR(NIL);
     1761     6434        /* we've come to the last buffer in the chain. always leave                   */
     1762     6435        /* one buffer in the type-ahead chain for efficiency.                         */
     1763     6436
     1764     6437    3         IF B3=%KV_SSN.TYPAHDBFRINPFNC$ THEN EXIT;
     1765     6438    3         %VDH_RLSBFR = KV_VDH_RLSBFR;
     1766     6439    3         %VDH_RLSBFR.STRTYP = %KV_STRTYP_TYPAHDBFR;
     1767     6440    3         %VDH_RLSBFR.BFR$ = B3;
     1768     6441    3         B3 = B3->KV$TYPAHDBFR.LNK$;
     1769     6442    3         CALL KVS$RLSBFR (FPT);
     1770     6443    3         %KV_SSN.TYPAHDBFRCNT = %KV_SSN.TYPAHDBFRCNT-1;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:89   
     1771     6444    3      END /* LOOP */;
     1772     6445    3      IF %KV_SSN.TYPAHDBFRINPFNC$=ADDR(NIL) THEN DO;
     1773     6446    3         B3->KV$TYPAHDBFR.CHRX = LENGTHC(KV$TYPAHDBFR);
     1774     6447    3         B3->KV$TYPAHDBFR.CHRX_HI = LENGTHC(KV$TYPAHDBFR)-1;
     1775     6448    3         %KV_SSN.TYPAHDBFRINS$ = B3;
     1776     6449    3         %KV_SSN.TYPCND.NOT_TRN = '0'B;
     1777     6450    3      END;
     1778     6451    2      ELSE B3->KV$TYPAHDBFR.CHRX = %KV_SSN.TYPAHDBFRINPFNCX+1;
     1779     6452    2      %KV_SSN.TYPAHDBFRHED$ = B3;
     1780     6453    2      RETURN;
     1781     6454    2   Y$PRGTYPAHDINPFNC: ENTRY;
     1782     6455
     1783     6456        /* purge type-ahead input function, if any.                                   */
     1784     6457
     1785     6458    2      %KV_SSN.TYPAHD = '0'B;
     1786     6459    3      IF NOT %KV_VDI.USRRQSDAT.RED THEN DO;
     1787     6460        /* we're not doing read processing.                                           */
     1788     6461
     1789     6462    3         B3 = %KV_SSN.TYPAHDBFRINPFNC$;
     1790     6463    3         %KV_SSN.TYPAHDBFRINPFNC$ = ADDR(NIL);
     1791     6464    3         IF B3~=ADDR(NIL) THEN IF B3=%KV_SSN.TYPAHDBFRHED$
     1792     6465        /* there is a partially buffered input function to purge.                     */
     1793     6466
     1794     6467    3           AND B3->KV$TYPAHDBFR.CHRX>%KV_SSN.TYPAHDBFRINPFNCX
     1795     6468        /* the head pointer/index has passed the input function pointer/index,        */
     1796     6469        /* indicating the only thing buffered in the type-ahead buffers is            */
     1797     6470        /* the input function we're purging. purge all type-ahead buffers.            */
     1798     6471
     1799     6472    3         THEN GOTO Y$PRGTYPAHDINT;
     1800     6473    4         ELSE DO;
     1801     6474        /* there are characters in the type-ahead buffers other than                  */
     1802     6475        /* a partial input function.                                                  */
     1803     6476        /* move the insert pointers back to the input function pointers,              */
     1804     6477        /* and clear the input function pointers.                                     */
     1805     6478
     1806     6479    4            %KV_SSN.TYPAHDBFRINS$ = B3;
     1807     6480    4            B3->KV$TYPAHDBFR.CHRX_HI = %KV_SSN.TYPAHDBFRINPFNCX;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:90   
     1808     6481    4         END /* IF */;
     1809     6482    3      END /* IF */;
     1810     6483    2      RETURN;
     1811     6484    2   END Y$PRGTYPAHD;
     1812     6485        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:91   
     1813     6486    1   Y$PSTLFT: PROC;
     1814     6487
     1815     6488        /* Position left OPRCNT columns in the read buffer.                           */
     1816     6489
     1817     6490    2      IF REDBFR$~=ADDR(NIL)
     1818     6491    2        AND %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR__.BYTX
     1819     6492    3      THEN DO WHILE '1'B;
     1820     6493        /* We're not at the beginning of the read buffer, so we can
     1821     6494           position to the left.                                                      */
     1822     6495
     1823     6496    3         IF NOT %KV_SSN.CLMIS_BYTX OR OPRCNT<=0
     1824     6497    3         THEN %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX-1;
     1825     6498    3         ELSE %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX-OPRCNT;
     1826     6499    4         IF %KV_SSN.REDBFR.EDTHI_X<%KV_SSN.REDBFR__.BYTX THEN DO;
     1827     6500    4            %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR__.BYTX;
     1828     6501    4            OPRCNT = 0;
     1829     6502    4         END;
     1830     6503    3         ELSE OPRCNT = OPRCNT-%KV_SSN.REDBFR.EDTLOWX+%KV_SSN.REDBFR.EDTHI_X;
     1831     6504    3         CALL Y$SCPVRTCLMHI_X;
     1832     6505    3         IF %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.INSLOWX
     1833     6506    3         THEN CALL KVI$INTINPOPRX (%KV_INPOPRX_RSTINSMOD);
     1834     6507    3         IF OPRCNT<=0 THEN GOTO Y@PSTLFT_N;
     1835     6508    3      END /* IF */;
     1836     6509        /* We're at the beginning of the buffer, try a backspace form.                */
     1837     6510
     1838     6511    2      ELSE IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN CALL KVO$PST (KV_VDH_PST_BS_FRM);
     1839     6512    2      ELSE IF %KV_MVD.RCRWRAP THEN CALL KVE$INPOPR (KV$INPOPR);
     1840     6513    2      RETURN;
     1841     6514
     1842     6515    2   Y$PSTLFT_N: ENTRY;
     1843     6516    2   Y@PSTLFT_N:;
     1844     6517    2      IF %KV_SSN.REDBFR.NXTX>=%KV_SSN.REDBFR.EDTLOWX
     1845     6518    2      THEN %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.NXTX-%KV_SSN.REDBFR__.BYTX;
     1846     6519    2      ELSE %KV_SSN.REDBFR__.DATBYTSIZ =
     1847     6520    2        %KV_SSN.REDBFR.EDTLOWX-%KV_SSN.REDBFR__.BYTX;
     1848     6521    2      IF %KV_VDI.RE_DSPINP THEN %KV_SRD.VRTPSTOK='0'B;
     1849     6522    3      ELSE IF %KV_MVD.DISPINPUT OR %KV_MVD.RETYPOVR THEN DO;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:92   
     1850     6523    3         IF %KV_VDI.HALFDUPLEXPAPERTAPE THEN EXIT;
     1851     6524        /* Dont bother to position for hrdcpy if not echoing                          */
     1852     6525
     1853     6526    3         CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);
     1854     6527    3         IF %KV_MVD.HRZSCR AND DSPLOWCLM~=0
     1855     6528    3           AND %KV_MVD.VRTCLM-%KV_SRD.PRMVRTCLM<=%KV_MVD.HRZSCRMRG
     1856     6529    3         THEN CALL Y$SHFDSPPST (0);
     1857     6530    3         ELSE CALL KVO$PST (KV_VDH_PST_0_VRT);
     1858     6531    3      END /* IF */;
     1859     6532    2      RETURN;
     1860     6533    2   END;
     1861     6534        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:93   
     1862     6535    1   Y$PSTRHT_TYP: PROC;
     1863     6536
     1864     6537        /* Position right OPRCNT columns in the read buffer.                          */
     1865     6538
     1866     6539    3      DO WHILE '1'B;
     1867     6540
     1868     6541    3         IF REDBFR$~=ADDR(NIL)
     1869     6542    4           AND %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.NXTX THEN DO;
     1870     6543        /* We're not at the end of the read buffer.                                   */
     1871     6544
     1872     6545    4            IF NOT %KV_SSN.CLMIS_BYTX OR OPRCNT=0
     1873     6546    4            THEN R5 = MINIMUM(%KV_SSN.REDBFR.EDTHI_X,%KV_SSN.REDBFR.INSMODX);
     1874     6547    4            ELSE R5 = MINIMUM(%KV_SSN.REDBFR.EDTLOWX+OPRCNT,%KV_SSN.REDBFR.NXTX)-1;
     1875     6548    4            IF R5>=%KV_SSN.REDBFR.INSMODX
     1876     6549        /* We're at the point where insert mode was entered;
     1877     6550           we can't position right without getting out of
     1878     6551           insert mode.                                                               */
     1879     6552
     1880     6553    4            THEN CALL KVI$INTINPOPRX (%KV_INPOPRX_RSTINSMOD);
     1881     6554    5            IF %KV_SSN.CLMIS_BYTX AND OPRCNT>0 THEN DO;
     1882     6555    5               %KV_SSN.REDBFR.EDTHI_X = R5;
     1883     6556    5               OPRCNT = OPRCNT-R5+%KV_SSN.REDBFR.EDTLOWX-1;
     1884     6557    4            END; ELSE OPRCNT = OPRCNT-1;
     1885     6558    4            CALL Y$TYPREDBFRSGM;
     1886     6559    4            CALL Y$SCPVRTCLMLOWX;
     1887     6560    4            IF %KV_MVD.ORG=%KV#VD_ORG_FORM
     1888     6561    4              AND %KV_SSN.REDBFR.EDTLOWX>=%KV_STR.MAXRCRBYTSIZ
     1889     6562    4            THEN CALL KVF$PST(KV_VDH_PST_SPCFRM);
     1890     6563    3         END; ELSE IF OPRCNT=0 AND %KV_MVD.RCRWRAP
     1891     6564    3         THEN CALL KVE$INPOPR (KV$INPOPR);
     1892     6565    3         ELSE IF %KV_SSN.REDBFR__.DATBYTSIZ<%KV_STR.MAXRCRBYTSIZ-1
     1893     6566    4           OR %KV_MVD.ORG=%KV#VD_ORG_FORM THEN DO;
     1894     6567        /* We're at the end of the read buffer.
     1895     6568           positioning to the right means buffering spaces at the end
     1896     6569           of the read buffer.                                                        */
     1897     6570
     1898     6571    4            %KV_SSN.INPCHR = ' ';
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:94   
     1899     6572    4            IF %KV_VDI.RE_DSPINP THEN %KV_SSN.INPECH = '0'B;
     1900     6573    5            IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN DO;
     1901     6574    5               CALL KVI$BFRREDCHR;
     1902     6575    5               OPRCNT = OPRCNT-1;
     1903     6576    5               REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     1904     6577    5               IF %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR__.BYTX THEN OPRCNT = 0;
     1905     6578    5            END; ELSE DO;
     1906     6579    5               R5 = %KV_SSN.REDBFR__.BYTX+MINIMUM (%KV_STR.MAXRCRBYTSIZ-1,
     1907     6580    5                 %KV_SSN.REDBFR__.DATBYTSIZ+MAXIMUM (OPRCNT,1));
     1908     6581    5               IF R5>%KV_SSN.REDBFR__.BFRBYTSIZ
     1909     6582    6               THEN CALL KVS$GETREDBFR (R5) WHENALTRETURN DO;
     1910     6583    6                  R5 = %KV_SSN.REDBFR__.BFRBYTSIZ;
     1911     6584    6               END;
     1912     6585    5               %KV_SSN.REDBFR.EDTHI_X = R5-1;
     1913     6586    5               %KV_SSN.REDBFR__.DATBYTSIZ = R5-%KV_SSN.REDBFR__.BYTX;
     1914     6587    5               REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     1915     6588    5               SUBSTR (KV$REDBFR_CHR, %KV_SSN.REDBFR.EDTLOWX,
     1916     6589    5                 R5-%KV_SSN.REDBFR.EDTLOWX) = ' ';
     1917     6590    5               CALL Y$TYPREDBFRSGM;
     1918     6591    5               OPRCNT = 0;
     1919     6592    5            END;
     1920     6593    3         END; ELSE EXIT;
     1921     6594    3         IF OPRCNT<=0 THEN EXIT;
     1922     6595    3      END /* IF */;
     1923     6596    2   END;
     1924     6597        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:95   
     1925     6598    1   Y$RE_DSPINP: PROC;
     1926     6599
     1927     6600        /* Re-display the current input data, if any.
     1928     6601           This is used for interactive devices operating in block mode
     1929     6602           to update the input image on the device, to ensure that it
     1930     6603           corresponds with the input record, after any translation
     1931     6604           or input function processing is done.
     1932     6605           It is also used for character-mode devices when the screen updating
     1933     6606           has been discontinued to avoid excessive re-typing. */
     1934     6607
     1935     6608    2      IF %KV_MVD.ORG=%KV#VD_ORG_SE AND %KV_MVD.FRMSCNINH
     1936     6609    3      THEN CALL KVE$RE_DSPSE WHENRETURN DO; RETURN; END;
     1937     6610    3      IF %KV_VDI.RE_DSPINP THEN DO;
     1938     6611        /* We're to re-display the input.                                             */
     1939     6612
     1940     6613    3         %KV_VDI.RE_DSPINP = '0'B;
     1941     6614    4         IF %KV_VDI.USRRQSDAT.RED THEN DO;
     1942     6615        /* There is a user request-data for read data outstanding.
     1943     6616           Therefore, there may be data to re-display.                                */
     1944     6617
     1945     6618    4            IF %KV_VDI.INPUNT~=%KV_INPUNT_BLK AND %KV_SRD.VRTPSTOK THEN EXIT;
     1946     6619    4            CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);
     1947     6620    4            R2 = %KV_SSN.REDBFR.EDTLOWX;
     1948     6621    5            IF R2~=%KV_VDI.RE_DSPLOWX AND REDBFR$~=ADDR(NIL) THEN DO;
     1949     6622    5               %KV_SSN.REDBFR.EDTLOWX = %KV_VDI.RE_DSPLOWX;
     1950     6623    5               CALL Y$EDTX_TO_VRTCLM (R5);
     1951     6624    5            END;
     1952     6625    4            ELSE R5 = %KV_MVD.VRTCLM;
     1953     6626    4            CALL Y$SHFTYPREDBFRSGM (R5);
     1954     6627    4            %KV_SSN.REDBFR.EDTLOWX = R2;
     1955     6628    5            IF %KV_VDI.INPUNT=%KV_INPUNT_BLK THEN DO;
     1956     6629    5               %KV_VDI.RE_DSPLOWX = 0;
     1957     6630    5               %KV_VDI.RE_DSPINP = '0'B;
     1958     6631    5            END /* IF */;
     1959     6632    4         END /* IF */;
     1960     6633    3      END /* IF */;
     1961     6634    2      RETURN;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:96   
     1962     6635    2   END;
     1963     6636        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:97   
     1964     6637    1   Y$RE_PSTRED: PROC;
     1965     6638
     1966     6639        /* Re-position to after the prompt, typically after deleting the input line.  */
     1967     6640
     1968     6641
     1969     6642    2      %KV_MVD.VRTCLM = %KV_SRD.PRMVRTCLM+1;
     1970     6643        /* Make the RE_PSTVRT erase the input line if there is one. */
     1971     6644    2      %KV_SRD.HI_NONBLNVRT = '0'B;
     1972     6645    2      CALL KVO$PST (KV_VDH_PST_VRT);
     1973     6646    2      RETURN;
     1974     6647    2   END;
     1975     6648        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:98   
     1976     6649    1   Y$SCPVRTCLMHI_X: PROC;
     1977     6650
     1978     6651        /* Scope (find low index) of this virtual column given the hi index. */
     1979     6652
     1980     6653    2   DCL R SBIN;
     1981     6654
     1982     6655    2   DCL DLT SBIN;
     1983     6656    2      DLT = 0;
     1984     6657    2      R = %KV_SSN.REDBFR.EDTHI_X;
     1985     6658        /* This loop is traversed for each character scanned from right
     1986     6659           to left, until we leave this virtual column.                               */
     1987     6660
     1988     6661    2      IF NOT %KV_SSN.CLMIS_BYTX AND R<%KV_SSN.REDBFR.INSMODX
     1989     6662    3      THEN DO WHILE R>%KV_SSN.REDBFR__.BYTX;
     1990     6663    3         R = R-1;
     1991     6664        /* This character causes carriage positioning.                                */
     1992     6665
     1993     6666    3         IF KV$REDBFR.CHR(R)=BITASC(%ASCIIBS) THEN DLT = DLT+1;
     1994     6667        /* This is a backspace character.                                             */
     1995     6668
     1996     6669    3         ELSE IF KV$REDBFR.CHR(R)>=' '
     1997     6670    4           AND KV$REDBFR.CHR(R)~=BITASC(%ASCIIDEL) THEN DO;
     1998     6671        /* This character causes positioning, but isn't a backspace. */
     1999     6672
     2000     6673    4            DLT = DLT-1;
     2001     6674    5            IF DLT<0 THEN DO;
     2002     6675        /* It must be the last character in the virtual column
     2003     6676           to the left of our virtual column.                                         */
     2004     6677
     2005     6678    5               %KV_SSN.REDBFR.EDTLOWX = R+1;
     2006     6679    5               RETURN;
     2007     6680    5            END /* IF */;
     2008     6681    4         END /* IF */;
     2009     6682    3      END /* LOOP */;
     2010     6683    2      %KV_SSN.REDBFR.EDTLOWX = R;
     2011     6684    2      RETURN;
     2012     6685    2   END;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:99   
     2013     6686        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:100  
     2014     6687    1   Y$SCPVRTCLMLOWX: PROC;
     2015     6688
     2016     6689        /* Scope (find high index) of this virtual column given the low index. */
     2017     6690
     2018     6691    2   DCL R SBIN;
     2019     6692
     2020     6693    2   DCL DLT SBIN;
     2021     6694
     2022     6695    2      IF %KV_SSN.CLMIS_BYTX OR %KV_SSN.REDBFR.EDTLOWX>=%KV_SSN.REDBFR.INSMODX
     2023     6696    3      THEN DO;
     2024     6697    3         %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX;
     2025     6698    3         RETURN;
     2026     6699    3      END;
     2027     6700    2      R = %KV_SSN.REDBFR.EDTLOWX;
     2028     6701    2      DLT = -1;
     2029     6702    2      IF KV$REDBFR.CHR(R)=BITASC(%ASCIICR) THEN R = R+1;
     2030     6703    3      DO WHILE R<%KV_SSN.REDBFR.INSMODX;
     2031     6704        /* This loop is traversed for each character scanned from left to
     2032     6705           right in the read buffer, until the next virtual column is
     2033     6706           encountered.                                                               */
     2034     6707
     2035     6708    3         IF KV$REDBFR.CHR(R)=BITASC(%ASCIIBS) THEN DLT = DLT-1;
     2036     6709        /* This is a backspace.                                                       */
     2037     6710
     2038     6711    3         ELSE IF DLT =0 OR KV$REDBFR.CHR(R)=BITASC(%ASCIICR) THEN EXIT;
     2039     6712        /* We've just entered the next virtual column.                                */
     2040     6713
     2041     6714        /* We haven't yet entered the next virtual column.                            */
     2042     6715
     2043     6716    3         ELSE IF KV$REDBFR.CHR(R)>=' '
     2044     6717    3           AND KV$REDBFR.CHR(R)~=BITASC(%ASCIIDEL) THEN DLT = DLT+1;
     2045     6718        /* This character causes positioning, but isn't a backspace.                  */
     2046     6719
     2047     6720    3         R = R+1;
     2048     6721    3      END /* LOOP */;
     2049     6722    2      %KV_SSN.REDBFR.EDTHI_X = R-1;
     2050     6723    2      RETURN;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:101  
     2051     6724    2   END;
     2052     6725        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:102  
     2053     6726    1   Y$SHFDSPPST: PROC (SHFCNT);
     2054     6727
     2055     6728        /* Re-display the input field, shifted according to the parameter:
     2056     6729           n>0 - insert n spaces at MVD.VRTCLM for the n chars <EDTLOWX. n is always 1.
     2057     6730           n<0 - delete n columns at MVD.VRTCLM - if HRZSCR, retype at the end.
     2058     6731           n=0 - scroll by inserting MVD.HRZSCRSHF at left until MVD.VRTCLM in range.
     2059     6732           nil - scroll by deleting MVD.HRZSCRSHF at left until MVD.VRTCLM in range.
     2060     6733
     2061     6734           Uses terminal line editing if available, else retypes some.
     2062     6735        */
     2063     6736
     2064     6737    2   DCL SHFCNT SBIN;
     2065     6738    2   DCL SHF SBIN;
     2066     6739    2   DCL OLDCLM SBIN;
     2067     6740
     2068     6741    2      OLDCLM = %KV_MVD.VRTCLM;
     2069     6742    3      IF ADDR(SHFCNT)~=ADDR(NIL) THEN IF SHFCNT~=0 THEN DO;
     2070     6743    3         SHF = SHFCNT;
     2071     6744    3         IF NOT %KV_MRD.HRZSCR OR NOT %KV_SSN.CLMIS_BYTX
     2072     6745    3           OR -2*SHF>%KV_SRD.WDT
     2073     6746    3           OR %KV_SSN.REDBFR.EDTLOWX>=%KV_SSN.REDBFR.NXTX
     2074     6747    3           OR SHF*2<%KV_SSN.REDBFR.EDTLOWX-%KV_SSN.REDBFR.NXTX
     2075     6748    3           OR %KV_MVD.ORG=%KV#VD_ORG_SE AND SHF>0 AND NOT %KV_SRD.VRTSCR
     2076     6749    3           AND %KV_SRD.HI_NONBLN_PST>=%KV_SRD.BTMRHT_PST
     2077     6750    3           OR SHF<0 AND %KV_MRD.DCHMOVFLD AND MOD(%KV_MVD.ORG,2)=0
     2078     6751    4         THEN DO;
     2079     6752    4            IF SHF>0 THEN OLDCLM = OLDCLM+SHF;
     2080     6753    4            GOTO Y@SHFTYPSGM;
     2081     6754    4         END;
     2082     6755    3         CALL KVO$PST (KV_VDH_PST_0_VRT);
     2083     6756    3         GOTO SCROLIT;
     2084     6757    3      END;
     2085     6758    2      CALL Y$SHFCNT;
     2086     6759    2   Y@SHFRCR:;
     2087     6760    2      IF NOT %KV_MRD.HRZSCR OR NOT %KV_SSN.CLMIS_BYTX
     2088     6761    2        OR MAXIMUM(3*SHF,-3*SHF)>%KV_MVD.WDT-%KV_SRD.PRMVRTCLM
     2089     6762    2      THEN GOTO Y@SHFTYP;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:103  
     2090     6763    2   SCROLIT:;
     2091     6764    2      %VDH_OTPLCL = KV_VDH_OTPLCL;
     2092     6765    2      %VDH_OTPLCL.BFR_.ADR$ = REDBFR$;
     2093     6766    2      %VDH_OTPLCL.NO_WRAP = %KV_MVD.HRZSCR;
     2094     6767    2      %USR_PST = KV_USR_PST;
     2095     6768    2      %USR_PST.PHSPSTMOD = %KV_PHSPSTMOD_HRZSCR;
     2096     6769    2      %USR_PST.SCRCNT = SHF;
     2097     6770    2      %USR_PST.PHSPST = %KV_SRD.CRT;
     2098     6771    2      EDTX = %KV_SRD.BTMRHT.CLM;
     2099     6772    2      IF %KV_SRD.FLDEND.CLM>0 THEN %KV_SRD.BTMRHT.CLM = %KV_SRD.FLDEND.CLM;
     2100     6773        /* (make it work properly for X364) */
     2101     6774    2      CALL KVV$CALUSR (%USR_PST);
     2102     6775    2      %KV_SRD.BTMRHT.CLM = EDTX;
     2103     6776    2      EDTX = EDTX+1-%USR_PST.PHSPST.CLM;   /* Clms left on 1st lin               */
     2104     6777    3      IF SHF>0 THEN DO;
     2105     6778    3         %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX;
     2106     6779    3         %VDH_OTPLCL.BFR_.BYTSIZ = SHF;
     2107     6780    3      END; ELSE DO;
     2108     6781    3         %KV_MVD.VRTCLM = %KV_MVD.VRTCLM+EDTX+SHF;
     2109     6782    3         %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX+%KV_MVD.VRTCLM
     2110     6783    3           -%KV_SRD.PRMVRTCLM-1;
     2111     6784    3         %VDH_OTPLCL.BFR_.BYTSIZ = -SHF;
     2112     6785    3         EDTX = %KV_SRD.WDT;
     2113     6786    3      END;
     2114     6787    2      %USR_PST.PHSPST.CLM = %KV_SRD.TOPLFT.CLM;
     2115     6788    3      DO WHILE %VDH_OTPLCL.BFR_.BYTX<%KV_SSN.REDBFR.NXTX;
     2116     6789    3         IF %VDH_OTPLCL.BFR_.BYTSIZ+%VDH_OTPLCL.BFR_.BYTX>%KV_SSN.REDBFR.NXTX
     2117     6790    3         THEN %VDH_OTPLCL.BFR_.BYTSIZ = %KV_SSN.REDBFR.NXTX-%VDH_OTPLCL.BFR_.BYTX;
     2118     6791    3         IF %VDH_OTPLCL.BFR_.BYTX~=%KV_SSN.REDBFR.DSPLOWX
     2119     6792    3           OR ADDR(SHFCNT)=ADDR(NIL) OR SHFCNT=0
     2120     6793    3         THEN CALL KVO$OTPLCL (%VDH_OTPLCL);
     2121     6794    4         ELSE DO;
     2122     6795    4            %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.EDTLOWX-SHF;
     2123     6796    4            %KV_MVD.VRTCLM = %KV_MVD.VRTCLM+SHF; /* (simulated write)            */
     2124     6797    4         END;
     2125     6798    3         %VDH_OTPLCL.BFR_.BYTX =%VDH_OTPLCL.BFR_.BYTX+EDTX;
     2126     6799    3         IF %KV_MVD.HRZSCR OR %KV_SRD.TRUNCATE
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:104  
     2127     6800    3           OR SHF>0 AND %VDH_OTPLCL.BFR_.BYTX>=%KV_SSN.REDBFR.NXTX THEN EXIT;
     2128     6801    3         %KV_MVD.VRTCLM = %KV_MVD.VRTCLM+EDTX;
     2129     6802    4         IF SHF>0 THEN DO;
     2130     6803    4            CALL KVO$PST (KV_VDH_PST_0_VRT);
     2131     6804    4            %USR_PST.PHSPST.LIN = %KV_SRD.CRT.LIN-1; /* KVE$INCFLD could scroll  */
     2132     6805    4         END;
     2133     6806    3         %KV_MVD.VRTCLM = %KV_MVD.VRTCLM-%VDH_OTPLCL.BFR_.BYTSIZ;
     2134     6807    3         EDTX = %KV_SRD.WDT;
     2135     6808    3         %USR_PST.PHSPST.LIN = %USR_PST.PHSPST.LIN+1;
     2136     6809    3         IF SHF>=0 AND SHF>=%KV_SSN.REDBFR.NXTX-%VDH_OTPLCL.BFR_.BYTX
     2137     6810    3         THEN %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;
     2138     6811    3         ELSE CALL KVV$CALUSR (%USR_PST);
     2139     6812    3      END;
     2140     6813    2      %KV_MVD.VRTCLM = OLDCLM;
     2141     6814    2      CALL KVO$PST (KV_VDH_PST_0_VRT);
     2142     6815    2      RETURN;
     2143     6816
     2144     6817    2   Y$SHFTO_DFL: ENTRY (SHFCNT);
     2145     6818    2      IF %KV_MVD.ORG~=%KV#VD_ORG_SE THEN OLDCLM = 0;
     2146     6819    2      ELSE OLDCLM = %KV_RCRLST.HRZSCROFS;
     2147     6820    2      OLDCLM = %KV_MVD.VRTCLM-OLDCLM+%KV_SSN.REDBFR.DSPLOWX;
     2148     6821    2      CALL Y$SHFCNTDFL;
     2149     6822    2      GOTO Y@SHFRCR;
     2150     6823        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:105  
     2151     6824    2   Y$SHFCNT: PROC;
     2152     6825    3      SHF = %KV_MVD.HRZSCRSHF;
     2153     6826    3      EDTX = %KV_MVD.WDT-%KV_SRD.PRMVRTCLM;
     2154     6827    3      OLDCLM = EDTX/2+%KV_SRD.PRMVRTCLM;
     2155     6828    4      IF SHF~=%G_SCROLL_CENTER# OR EDTX=1 THEN DO;
     2156     6829    4         IF SHF>%G_SCROLL_CENTER#
     2157     6830    4         THEN SHF = (EDTX*(SHF-%G_SCROLL_CENTER#)+99)/100;
     2158     6831    4         IF SHF=0 THEN SHF=SHF+1;
     2159     6832    4         SHF = SHF+%KV_MVD.HRZSCRMRG;
     2160     6833    4         IF SHF*2>EDTX AND EDTX>1 THEN EXIT;
     2161     6834    4         IF %KV_MVD.VRTCLM<OLDCLM
     2162     6835    4         THEN OLDCLM = %KV_SRD.PRMVRTCLM+SHF;
     2163     6836    4         ELSE OLDCLM = %KV_MVD.WDT+1-SHF;
     2164     6837    4      END;
     2165     6838    3   Y$SHFCNTDFL: ENTRY;
     2166     6839    3      SHF = OLDCLM-%KV_MVD.VRTCLM;
     2167     6840    4      IF %KV_SSN.REDBFR.DSPLOWX<SHF THEN DO;
     2168     6841    4         SHF = %KV_SSN.REDBFR.DSPLOWX;
     2169     6842    4         OLDCLM = %KV_MVD.VRTCLM+SHF;
     2170     6843    4      END;
     2171     6844    3      %KV_SSN.REDBFR.DSPLOWX = %KV_SSN.REDBFR.DSPLOWX-SHF;
     2172     6845    3      DSPLOWCLM = DSPLOWCLM-SHF;
     2173     6846    3      IF %KV_MVD.ORG=%KV#VD_ORG_SE
     2174     6847    3      THEN IF %KV_RCRLST.HRZSCRALL THEN CALL KVE$SCRALL;
     2175     6848    3      %KV_MVD.VRTCLM = %KV_SRD.PRMVRTCLM+1;
     2176     6849    3      CALL KVO$PST (KV_VDH_PST_0_VRT);
     2177     6850    3      RETURN;
     2178     6851    3   END Y$SHFCNT;
     2179     6852    2   Y$SHFTYPREDBFR: ENTRY (SHFCNT);
     2180     6853
     2181     6854        /* Erase the input field, and type the entire read buffer.
     2182     6855           Leave the cursor positioned at the end.                                    */
     2183     6856
     2184     6857    2   Y@SHFTYP:;
     2185     6858    2      OLDCLM = 0;
     2186     6859    2      GOTO Y@SHFTYPSGM;
     2187     6860
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:106  
     2188     6861    2   Y$SHFTYPREDBFRSGM: ENTRY (SHFCNT);
     2189     6862
     2190     6863        /* Type the rest of the input from EDTLOWX, positioned at the parameter. */
     2191     6864
     2192     6865    2      OLDCLM = SHFCNT;
     2193     6866    2   Y@SHFTYPSGM:;
     2194     6867    2      %VDH_OTPLCL = KV_VDH_OTPLCL;
     2195     6868    2      IF OLDCLM=0 THEN %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX;
     2196     6869    2      ELSE %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.EDTLOWX;
     2197     6870    2      %VDH_OTPLCL.BFR_.BYTSIZ = %KV_SSN.REDBFR__.DATBYTSIZ;
     2198     6871    3      IF NOT %KV_VDI.RE_DSPINP THEN DO;
     2199     6872    3         %VDH_OTPLCL.BFR_.ADR$ = REDBFR$;
     2200     6873    3         IF NOT %KV_MVD.DISPINPUT AND NOT %KV_MVD.RETYPOVR
     2201     6874    3           OR %KV_VDI.HALFDUPLEXPAPERTAPE THEN RETURN;
     2202     6875    3         %VDH_OTPLCL.NO_WRAP = %KV_MVD.HRZSCR;
     2203     6876    3         IF %KV_MVD.HRZSCR AND OLDCLM>%KV_MVD.WDT THEN GOTO Y@PSTN_XIT;
     2204     6877    3         IF %VDH_OTPLCL.BFR_.BYTSIZ<=%VDH_OTPLCL.BFR_.BYTX
     2205     6878    3         THEN %VDH_OTPLCL.BFR_.BYTSIZ = %VDH_OTPLCL.BFR_.BYTX;
     2206     6879    4         ELSE IF %KV_MVD.RETYPOVR THEN DO;
     2207     6880        /* Retypovr - HDN if not echoing, and setup for retype at line quiet.         */
     2208     6881
     2209     6882    4            IF NOT %KV_MVD.DISPINPUT AND %KV_VDI.INPUNT~=%KV_INPUNT_BLK
     2210     6883    4            THEN %VDH_OTPLCL.HDN = '1'B;
     2211     6884    4            %KV_VDI.RE_DSPINP = '1'B;
     2212     6885    4            %KV_VDI.RE_DSPLOWX = %VDH_OTPLCL.BFR_.BYTSIZ;
     2213     6886    4         END /* IF */;
     2214     6887    4         IF OLDCLM~=0 THEN DO;
     2215     6888    4            EDTX = OLDCLM;
     2216     6889    4            OLDCLM = %KV_MVD.VRTCLM;
     2217     6890    4            %KV_MVD.VRTCLM = EDTX;
     2218     6891    4            EDTX = -1;
     2219     6892    4         END;
     2220     6893    3         ELSE CALL Y$EDTX_TO_VRTCLM (OLDCLM);
     2221     6894    3         IF %KV_MVD.HRZSCR
     2222     6895    3           AND (DSPLOWCLM~=0 AND OLDCLM-%KV_SRD.PRMVRTCLM<=%KV_MVD.HRZSCRMRG
     2223     6896    4           OR OLDCLM+%KV_MVD.HRZSCRMRG>%KV_MVD.WDT) THEN DO;
     2224     6897    4            %KV_MVD.VRTCLM = OLDCLM;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:107  
     2225     6898    4            CALL Y$SHFCNT;
     2226     6899    4            %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX;
     2227     6900    4         END;
     2228     6901    3         ELSE IF EDTX<0 THEN CALL KVO$PST (KV_VDH_PST_0_VRT);
     2229     6902    3         %VDH_OTPLCL.BFR_.BYTSIZ = %VDH_OTPLCL.BFR_.BYTSIZ-%VDH_OTPLCL.BFR_.BYTX;
     2230     6903    3         IF %KV_SRD.FSTERS AND (%KV_SRD.FLDEND.CLM=0
     2231     6904    3           OR %KV_SRD.FLDEND.CLM=%KV_SRD.BTMRHT.CLM)
     2232     6905    3           AND (NOT %KV_MRD.DCLATRWHNOTP
     2233     6906    4           OR NOT %(G#GRPRND_RVRVID|G#GRPRND_UNDSCR)&%KV_MRD.DVCATR) THEN DO;
     2234     6907        /* This device has an erase to end of line or erase to end
     2235     6908           of display function, or a similar function.
     2236     6909           use it to clear the way for the read buffer
     2237     6910           data we're about to display.                                               */
     2238     6911
     2239     6912    4            CALL KVO$ERSTO_ENDOF_INP;
     2240     6913    4            CALL KVO$OTPLCL (FPT);
     2241     6914    4         END; ELSE DO;
     2242     6915        /* This device has no erase to end of line or erase to end
     2243     6916           of display. Display the read buffer segment, and then
     2244     6917           erase (with spaces) the rest of the display.                               */
     2245     6918
     2246     6919    4            CALL KVO$OTPLCL (FPT);
     2247     6920    4            CALL KVO$ERSTO_ENDOF_INP;
     2248     6921    4         END /* IF */;
     2249     6922    4         IF OLDCLM~=%KV_MVD.VRTCLM THEN DO;
     2250     6923    4            %KV_MVD.VRTCLM = OLDCLM;
     2251     6924    4   Y@PSTN_XIT:;
     2252     6925    4            CALL KVO$PST (KV_VDH_PST_0_VRT);
     2253     6926    4         END;
     2254     6927    3      END /* IF */;
     2255     6928    3      ELSE IF %VDH_OTPLCL.BFR_.BYTX<%KV_VDI.RE_DSPLOWX THEN DO;
     2256     6929    3         %KV_VDI.RE_DSPLOWX = %VDH_OTPLCL.BFR_.BYTX;
     2257     6930    3         %KV_SRD.VRTPSTOK = '0'B;
     2258     6931    3      END;
     2259     6932    2      RETURN;
     2260     6933        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:108  
     2261     6934    2   END Y$SHFDSPPST;
     2262     6935        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:109  
     2263     6936    1   Y$TRMRED: PROC (VDH_DAT);
     2264     6937
     2265     6938        %KV$VDH_DAT (NAME=VDH_DAT, STCLASS=);
     2266     7018        %INCLUDE KH$CLK;
     2267     7388        %INCLUDE KH_CLKFNC_E;
     2268     7433        %KH$CLK;
     2269     7582        %EQU KH@CLK = CHARTEXT('ADDR(FPT)->KH$CLK');
     2270     7583        %KH$CLK (FPTN=KV_CLK_CANCEL, STCLASS=CONSTANT SYMDEF, FNC=%KH#CLK_CANCEL, NO_CTB=YES
              7583            );
     2271     7732    2   DCL KV_SND_RQSDAT_GNR UBIN SYMREF;
     2272     7733    2   DCL KHC$CLOCK ENTRY(1) ALTRET;
     2273     7734        %KV_CLKNMB_E;
     2274     7743
     2275     7744    3      IF %KV_VDI.INPUNT~=%KV_INPUNT_RCR THEN DO;
     2276     7745        /* This device doesn't give us records as input.                              */
     2277     7746
     2278     7747    3         IF %KV_VDI.INPUNT=%KV_INPUNT_BLK
     2279     7748    4           AND %KV_MVD.ORG~=%KV#VD_ORG_FORM THEN DO;
     2280     7749    4            IF KV$PTR.INPCNDPND.TRN THEN EXIT;
     2281     7750        /* This is a block mode device.
     2282     7751        Move the input field end attribute in to just after the last
     2283     7752        input character.                                                           */
     2284     7753
     2285     7754    4            CALL KVI$RSTINPFLDBGNATR;
     2286     7755    4            CALL Y$RE_DSPINP;
     2287     7756    4            IF ADDR(VDH_DAT)~=ADDR(NIL)
     2288     7757    4            THEN IF KV_GRPCHR (ASCBIN(VDH_DAT.DATCTRCHR))
     2289     7758        /* Echo the activation char if it is printable. */
     2290     7759
     2291     7760    4            THEN CALL KVO$OTP1_VRT (ASCBIN(VDH_DAT.DATCTRCHR));
     2292     7761    4            CALL KVI$RSTINPFLDENDATR;
     2293     7762    4         END /* IF */;
     2294     7763    3         ELSE CALL Y$RE_DSPINP;
     2295     7764    3      END /* IF */;
     2296     7765    2      %KV_VDI.USRRQSDAT.RED = '0'B;
     2297     7766    2      %KV_SSN.REDRQSPND = '0'B;
     2298     7767    2      %KV_SSN.TYPCND = KV$PTR.INPCNDPND;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:110  
     2299     7768
     2300     7769        %EQU REDCLKS=CONCAT(SUBBIT('00'X,0,KV_CLKNMB_REDTIMOUT),'1'B)|'00'X|
     2301     7770         CONCAT(SUBBIT('00'X,0,KV_CLKNMB_USRREDTIMOUT),'1'B);
     2302     7771    3      IF %KV_SSN.CLKSET&%REDCLKS THEN DO;
     2303     7772        /* There is a read timeout clock set;  reset it.                              */
     2304     7773    3         %KH@CLK = KV_CLK_CANCEL;
     2305     7774    3         %KH@CLK.UID$ = ADDR(%KV_SSN);
     2306     7775    3         %KH@CLK.UVAL = %KV_CLKNMB_REDTIMOUT;
     2307     7776    3         IF %KV_SSN.CLKSET(%KV_CLKNMB_REDTIMOUT) THEN CALL KHC$CLOCK (FPT);
     2308     7777    3         %KH@CLK.UVAL = %KV_CLKNMB_USRREDTIMOUT;
     2309     7778    3         IF %KV_SSN.CLKSET(%KV_CLKNMB_USRREDTIMOUT) THEN CALL KHC$CLOCK (FPT);
     2310     7779    3         %KV_SSN.CLKSET = %KV_SSN.CLKSET&%(~REDCLKS);
     2311     7780    3      END;
     2312     7781    2      IF NOT %KV_SSN.WATINPDLTMRK THEN %KV_SSN.BRKCNT = 0;
     2313     7782    2      %KV_SSN.REDSTRID = 0;
     2314     7783    2      IF %KV_VDI.USREVTENB (%KV_USR_EVT_ID_TRMUSRRQSDAT)
     2315     7784    2      THEN CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_TRMUSRRQSDAT);
     2316     7785    3      IF %KV_VDI.FULLDUPLEXPAPERTAPE OR %KV_VDI.HALFDUPLEXPAPERTAPE THEN DO;
     2317     7786    3         IF %KV_VDI.SSNCNT=1 AND %KV_STR.SNDMAXNMBRCR=1 THEN EXIT;
     2318     7787        /*
     2319     7788           Send XON again if there's any reads still pending
     2320     7789        */
     2321     7790    3         B3 = %KV_VDI.SSN$;
     2322     7791    4         IF %KV_VDI.SSNCNT>1 THEN DO WHILE B3~=ADDR(NIL);
     2323     7792    4            IF B3->KV$SSN.SNCPTR$->KV$PTR.STR$->KV$STR.SNDMAXNMBRCR>1
     2324     7793    4              OR B3->KV$SSN.SNCPTR$->KV$PTR.STR$->KV$STR.SNDMAXNMBRCR~=0
     2325     7794    4              AND B3~=KV$PTR.SSN$ OR B3->KV$SSN.REDRQSPND THEN EXIT;
     2326     7795    4            B3 = B3->KV$SSN.LNK$;
     2327     7796    4         END;
     2328     7797    3         IF B3=ADDR(NIL) THEN EXIT;
     2329     7798    3         CALL KVO$OTP1_VRT (%ASCIIDC1);
     2330     7799    3      END;
     2331     7800        /* Enable defered message delivery again. */
     2332     7801    2      IF %KV_SSN.TYPAHDBFRHED$=%KV_SSN.TYPAHDBFRINS$
     2333     7802    2        AND %KV_SSN.TYPAHDBFRHED$->KV$TYPAHDBFR.CHRX_HI<LENGTHC(KV$TYPAHDBFR)
     2334     7803    2        AND %KV_SSN.OTPBLK
     2335     7804    2      THEN CALL KVM$SND (KV_SND_RQSDAT_GNR);
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:111  
     2336     7805    2      RETURN;
     2337     7806    2   END;
     2338     7807        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:112  
     2339     7808    1   Y$TYPAHDTXT: PROC (KV$INPOPR_DUMMY);
     2340     7809
     2341     7810        %KV$INPOPR (STCLASS=PARAM);
     2342     7909
     2343     7910        /*I* NAME: Y$TYPAHDTXT.
     2344     7911             PURPOSE: Moves the text of a INPOPR_TXT with disp=typeahead into
     2345     7912             typeahead buffers. */
     2346     7913        /* R5 has starting index into the text                                        */
     2347     7914
     2348     7915    2      B3 = %KV_SSN.TYPAHDBFRHED$;
     2349     7916        /* This loop is traversed for each typeahead buffer, starting
     2350     7917           at the head, until the last buffer with
     2351     7918           KV$TYPAHDBFR.INPFNCTXT set is found.                                       */
     2352     7919
     2353     7920    2      IF B3->KV$TYPAHDBFR.INPFNCTXT AND ADDR(KV$INPOPR_DUMMY)=INPOPR$
     2354     7921    3      THEN DO WHILE '1'B;
     2355     7922
     2356     7923    3         IF B3->KV$TYPAHDBFR.LNK$=ADDR(NIL) THEN EXIT;
     2357     7924    3         IF NOT B3->KV$TYPAHDBFR.LNK$->KV$TYPAHDBFR.INPFNCTXT THEN EXIT;
     2358     7925    3         B3 = B3->KV$TYPAHDBFR.LNK$;
     2359     7926    3      END /* LOOP */;
     2360     7927    3      ELSE DO;
     2361     7928        /* The head buffer wasn't created by input function text.
     2362     7929           Get a buffer, and queue it on in front of the head. */
     2363     7930
     2364     7931    3         %VDH_GETBFR = KV_VDH_GETBFR;
     2365     7932    3         %VDH_GETBFR.STRTYP = %KV_STRTYP_TYPAHDBFR;
     2366     7933    3         CALL KVS$GETBFR (FPT)
     2367     7934    4         WHENALTRETURN DO; RETURN; END;
     2368     7935    3         B3 = %VDH_GETBFR.BFR$;
     2369     7936    3         %KV_SSN.TYPAHDBFRCNT = %KV_SSN.TYPAHDBFRCNT+1;
     2370     7937    3         B3->KV$TYPAHDBFR.LNK$ = %KV_SSN.TYPAHDBFRHED$;
     2371     7938    3         %KV_SSN.TYPAHDBFRHED$ = B3;
     2372     7939    3         B3->KV$TYPAHDBFR.INPFNCTXT = '1'B;
     2373     7940    3      END /* IF */;
     2374     7941
     2375     7942        /* B3 points to the buffer to put characters into.                            */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:113  
     2376     7943
     2377     7944    3      DO WHILE R5<KV$INPOPR_TXT.L;
     2378     7945        /* This loop is traversed for each character transferred
     2379     7946           to type-ahead buffers.                                                     */
     2380     7947
     2381     7948    4         IF B3->KV$TYPAHDBFR.CHRX_HI>=%KV_TYPAHDBFR_CHRX_HI THEN DO;
     2382     7949        /* We're at the end of this buffer.                                           */
     2383     7950
     2384     7951    4            %VDH_GETBFR = KV_VDH_GETBFR;
     2385     7952    4            %VDH_GETBFR.STRTYP = %KV_STRTYP_TYPAHDBFR;
     2386     7953    4            CALL KVS$GETBFR (FPT)
     2387     7954    5            WHENALTRETURN DO; RETURN; END;
     2388     7955    4            %KV_SSN.TYPAHDBFRCNT = %KV_SSN.TYPAHDBFRCNT+1;
     2389     7956    4            %VDH_GETBFR.BFR$->KV$TYPAHDBFR.LNK$ = B3->KV$TYPAHDBFR.LNK$;
     2390     7957    4            B3->KV$TYPAHDBFR.LNK$ = %VDH_GETBFR.BFR$;
     2391     7958    4            B3 = %VDH_GETBFR.BFR$;
     2392     7959    4            B3->KV$TYPAHDBFR.INPFNCTXT = '1'B;
     2393     7960    4         END /* IF */;
     2394     7961
     2395     7962        /* Move the character from the INPOPR to the type-ahead buffer.               */
     2396     7963
     2397     7964    3         B3->KV$TYPAHDBFR.CHRX_HI = B3->KV$TYPAHDBFR.CHRX_HI+1;
     2398     7965    3         B3->KV$TYPAHDBFR_CHR(B3->KV$TYPAHDBFR.CHRX_HI) =
     2399     7966    3           SUBSTR (KV$INPOPR_TXT.T,R5,1);
     2400     7967
     2401     7968    3         R5 = R5+1;
     2402     7969    3      END /* LOOP */;
     2403     7970    2      RETURN;
     2404     7971    2   END;
     2405     7972        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:114  
     2406     7973    1   Y$TYPREDBFRSGM: PROC;
     2407     7974
     2408     7975        /* Type a segment of a read buffer, from EDTLOWX thru EDTHI_X. */
     2409     7976
     2410     7977    2      IF %KV_SSN.REDBFR.EDTHI_X<%KV_SSN.REDBFR.EDTLOWX THEN RETURN;
     2411     7978    2      R5 = %KV_SSN.REDBFR.EDTHI_X-%KV_SSN.REDBFR.EDTLOWX+1;
     2412     7979    3      IF %KV_SSN.CHNCAS AND NOT %KV_SSN.REDONL THEN DO;
     2413     7980    3         CALL XLATE (SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR.EDTLOWX,R5),
     2414     7981    3           Y_CHNCAS, SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR.EDTLOWX,R5));
     2415     7982    3         IF %KV_VDI.RE_DSPINP
     2416     7983    3         THEN IF %KV_SSN.REDBFR.EDTLOWX<%KV_VDI.RE_DSPLOWX
     2417     7984    3         THEN %KV_VDI.RE_DSPLOWX = %KV_SSN.REDBFR.EDTLOWX;
     2418     7985    3      END;
     2419     7986    2      IF (%KV_MVD.DISPINPUT OR %KV_MVD.RETYPOVR)
     2420     7987    2        AND %KV_SSN.REDBFR__.DATBYTSIZ~=0
     2421     7988    2      THEN IF %KV_VDI.RE_DSPINP THEN %KV_SRD.VRTPSTOK = '0'B;
     2422     7989    3      ELSE IF NOT %KV_VDI.HALFDUPLEXPAPERTAPE THEN DO;
     2423     7990        /* There is data in the read buffer.                                       */
     2424     7991
     2425     7992    3         %VDH_OTPLCL = KV_VDH_OTPLCL;
     2426     7993    3         %VDH_OTPLCL.BFR_.ADR$ = REDBFR$;
     2427     7994    3         %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.EDTLOWX;
     2428     7995    3         %VDH_OTPLCL.BFR_.BYTSIZ = R5;
     2429     7996    3         IF NOT %KV_MVD.DISPINPUT AND %KV_VDI.INPUNT~=%KV_INPUNT_BLK
     2430     7997        /* Simulate a hidden field (must be retypovr)                              */
     2431     7998
     2432     7999    3         THEN %VDH_OTPLCL.HDN = '1'B;
     2433     8000    3         %VDH_OTPLCL.NO_WRAP = %KV_MVD.HRZSCR;
     2434     8001    3         CALL KVO$OTPLCL (FPT);
     2435     8002    3      END /* IF */;
     2436     8003    2      %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTHI_X+1;
     2437     8004    2      %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.EDTHI_X;
     2438     8005    2      IF %KV_MVD.HRZSCR AND NOT %KV_VDI.RE_DSPINP
     2439     8006    2      THEN IF %KV_MVD.VRTCLM+%KV_MVD.HRZSCRMRG>%KV_MVD.WDT
     2440     8007    2        AND (%KV_SSN.REDBFR.EDTLOWX+%KV_MVD.HRZSCRMRG<=%KV_SSN.REDBFR.NXTX
     2441     8008    3        OR %KV_MVD.VRTCLM>%KV_MVD.WDT) THEN DO;
     2442     8009    3         CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:115  
     2443     8010    3         CALL Y$SHFDSPPST;
     2444     8011    3      END;
     2445     8012    2      RETURN;
     2446     8013    2   END;
     2447     8014        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:116  
     2448     8015        /* Some of the above subroutines need external entry points. */
     2449     8016
     2450     8017    1   KVI$ABRRED: ENTRY;
     2451     8018
     2452     8019    1      SSN$ = KV$PTR.SSN$;
     2453     8020    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2454     8021    1      CALL Y$ABRRED;
     2455     8022    1      RETURN;
     2456     8023
     2457     8024    1   KVI$AUTWRP: ENTRY;
     2458     8025
     2459     8026    1      R5 = %KV_STR.WRDWRPSIZ+%KV_STR.AUTTABCLM;
     2460     8027    1      SSN$ = KV$PTR.SSN$;
     2461     8028    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2462     8029    2      IF REDBFR$=ADDR(NIL) OR R5>%KV_SSN.REDBFR__.BFRBYTSIZ THEN DO;
     2463     8030    3         CALL KVS$GETREDBFR(R5) WHENALTRETURN DO;
     2464     8031    3            RETURN;
     2465     8032    3         END;
     2466     8033    2         REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2467     8034    2      END;
     2468     8035    1      IF %KV_STR.AUTTABCLM>1
     2469     8036    1      THEN SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR__.BYTX,%KV_STR.AUTTABCLM-1) = ' ';
     2470     8037    1      R2 = %KV_STR.AUTTABCLM;
     2471     8038    1      IF R2~=0 THEN R2 = R2-1;
     2472     8039    1      R5 = %KV_STR.WRDWRPSIZ;
     2473     8040    1      IF R5~=0 THEN SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR__.BYTX+R2,R5) =
     2474     8041    1        SUBSTR(%KV_STR.EDTBFR__.ADR$->KV$REDBFR_CHR,
     2475     8042    1        %KV_STR.EDTBFR__.DATBYTSIZ+%KV_STR.EDTBFR__.BYTX-R5,R5);
     2476     8043    1      %KV_STR.WRDWRPSIZ = 0;
     2477     8044    1      %KV_SSN.REDBFR__.DATBYTSIZ = R2+R5;
     2478     8045    1      %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR__.DATBYTSIZ+%KV_SSN.REDBFR__.BYTX;
     2479     8046    1      %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;
     2480     8047    1      %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.NXTX;
     2481     8048    1      %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.NXTX;
     2482     8049    1      %KV_SSN.CLMIS_BYTX = '0'B;
     2483     8050    1      CALL Y$EDTX_TO_VRTCLM(R2);
     2484     8051    1      CALL Y$SHFTYPREDBFR;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:117  
     2485     8052    1      RETURN;
     2486     8053
     2487     8054    1   KVI$EDTX_TO_VRTCLM: ENTRY (VDH_PARM);
     2488     8055
     2489     8056    1      SSN$ = KV$PTR.SSN$;
     2490     8057    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2491     8058    1      CALL Y$EDTX_TO_VRTCLM (VDH_VRTCLM);
     2492     8059    1      RETURN;
     2493     8060
     2494     8061    1   KVI$PRGRED: ENTRY;
     2495     8062
     2496     8063    1      SSN$ = KV$PTR.SSN$;
     2497     8064    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2498     8065    1      CALL Y$PRGRED;
     2499     8066    1      RETURN;
     2500     8067
     2501     8068    1   KVI$PRGTYPAHDINPFNC: ENTRY;
     2502     8069
     2503     8070    1      SSN$ = KV$PTR.SSN$;
     2504     8071    1      CALL Y$PRGTYPAHDINPFNC;
     2505     8072    1      RETURN;
     2506     8073
     2507     8074    1   KVI$RE_DSPINP: ENTRY;
     2508     8075
     2509     8076    1      SSN$ = KV$PTR.SSN$;
     2510     8077    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2511     8078    1      CALL Y$RE_DSPINP;
     2512     8079    1      RETURN;
     2513     8080
     2514     8081    1   KVI$SCPVRTCLMLOWX: ENTRY;
     2515     8082
     2516     8083    1      SSN$ = KV$PTR.SSN$;
     2517     8084    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2518     8085    1      CALL Y$SCPVRTCLMLOWX;
     2519     8086    1      RETURN;
     2520     8087
     2521     8088    1   KVI$SHFDSPPST: ENTRY (VDH_PARM);
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:118  
     2522     8089
     2523     8090    1      SSN$ = KV$PTR.SSN$;
     2524     8091    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2525     8092    1      CALL Y$SHFDSPPST (VDH_SHFCNT);
     2526     8093    1      RETURN;
     2527     8094
     2528     8095    1   KVI$SHFTO_DFL: ENTRY;
     2529     8096
     2530     8097    1      SSN$ = KV$PTR.SSN$;
     2531     8098    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2532     8099    1      R2 = %KV_SSN.REDBFR.EDTLOWX;
     2533     8100    1      IF %KV_MVD.ORG=%KV#VD_ORG_SE
     2534     8101    1      THEN IF %KV_RCRLST.HRZSCROFS<%KV_SSN.REDBFR.NXTX
     2535     8102    1      THEN %KV_SSN.REDBFR.EDTLOWX = %KV_RCRLST.HRZSCROFS+%KV_MVD.HRZSCRMRG;
     2536     8103    2      ELSE DO;
     2537     8104    2         %KV_MVD.VRTCLM = %KV_SRD.PRMVRTCLM+1;
     2538     8105    2         CALL KVO$PST (KV_VDH_PST_0_VRT);
     2539     8106    2         CALL KVO$ERSTO_ENDOF_INP;
     2540     8107    2         RETURN;
     2541     8108    2      END;
     2542     8109    1      ELSE %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR__.BYTX;
     2543     8110    1      CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);
     2544     8111    1      CALL Y$SHFTO_DFL;
     2545     8112    1      %KV_VDI.RE_DSPINP = '0'B;
     2546     8113    1      %KV_SSN.REDBFR.EDTLOWX = R2;
     2547     8114    1      RETURN;
     2548     8115
     2549     8116    1   KVI$TRMRED_VDH_DAT: ENTRY (VDH_PARM);
     2550     8117
     2551     8118    1      SSN$ = KV$PTR.SSN$;
     2552     8119    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;
     2553     8120    1      IF REDBFR$=%KV_STR.EDTBFR__.ADR$
     2554     8121    1        AND %KV_STR.WRDWRPCLM>11 AND %KV_STR.WRDWRP
     2555     8122    1        AND %KV_STR.EDTBFR__.DATBYTSIZ>%KV_STR.WRDWRPCLM
     2556     8123    2        AND ADDR(VDH_DAT)~=ADDR(NIL) THEN DO;
     2557     8124
     2558     8125        /* We have the wordwrap condition. Do it. */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:119  
     2559     8126
     2560     8127    2         R5 = %KV_STR.WRDWRPCLM+%KV_STR.EDTBFR__.BYTX;
     2561     8128    3         DO UNTIL R5<0;
     2562     8129    3            IF KV$REDBFR_BYT(R5)=ASCBIN(' ') THEN EXIT;
     2563     8130    3            R5 = R5-1;
     2564     8131    3         END;
     2565     8132    2         R5 = R5-%KV_STR.EDTBFR__.BYTX;
     2566     8133    2         IF R5<%KV_STR.WRDWRPCLM/2 OR R5<%KV_STR.AUTTABCLM
     2567     8134    2         THEN R5 = %KV_STR.WRDWRPCLM;
     2568     8135    2         %KV_STR.RE_REDCLM = R5+1;
     2569     8136    2         R2 = R5+%KV_STR.EDTBFR__.BYTX;
     2570     8137    2         %KV_SSN.REDBFR.EDTLOWX = R2;
     2571     8138    2         IF %KV_MVD.RETYPOVR
     2572     8139    3           AND (%KV_VDI.RE_DSPLOWX>R2 OR NOT %KV_VDI.RE_DSPINP) THEN DO;
     2573     8140    3            %KV_VDI.RE_DSPLOWX = R2;
     2574     8141    3            %KV_VDI.RE_DSPINP = '1'B;
     2575     8142    3            %KV_SRD.VRTPSTOK = '0'B;
     2576     8143    3         END;
     2577     8144    2         IF %KV_SSN.BP AND R5<%KV_STR.WRDWRPCLM THEN R5 = R5+1;
     2578     8145    3         DO WHILE R2<%KV_SSN.REDBFR.NXTX AND KV$REDBFR_BYT(R2)=ASCBIN(' ');
     2579     8146    3            R2 = R2+1;
     2580     8147    3         END;
     2581     8148    2         %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.EDTLOWX;
     2582     8149    2         VDH_DAT.DAT__.DATBYTSIZ = R5;
     2583     8150    2         %KV_STR.WRDWRPSIZ = %KV_STR.EDTBFR__.DATBYTSIZ+%KV_STR.EDTBFR__.BYTX-R2;
     2584     8151    2      END;
     2585     8152    1      CALL Y$TRMRED (VDH_DAT);
     2586     8153    1      IF %KV_STR.WRDWRPSIZ~=0 THEN CALL KVO$PST (KV_VDH_PST_NEWLIN_VRT);
     2587     8154    2      IF %KV_SSN.REDBFR__.BFRRLSDSP = %KV_BFRRLSDSP_MSG THEN DO;
     2588     8155
     2589     8156        /* We just released the read buffer, so clear the read buffer descriptor. */
     2590     8157
     2591     8158    2         %KV_SSN.REDBFR__ = '0'B;
     2592     8159    2      END; ELSE DO;                        /* ELSE IF BFRRLSDSP = MSG            */
     2593     8160
     2594     8161        /* We didn't release the read buffer, so just reset the data size. */
     2595     8162
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:120  
     2596     8163    2         %KV_SSN.REDBFR__.DATBYTSIZ = 0;
     2597     8164    2      END; /* END ELSE IF BFRRLSDSP = MSG */
     2598     8165    1      %KV_SSN.REDBFR = '0'B;
     2599     8166    1      RETURN;
     2600     8167    1   END;
     2601     8168        %EOD;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:121  
--  Include file information  --

   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   K_CP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_SCODE_C.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_INT.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KH_SCREECH_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVI$INT.

   Procedure KVI$INT requires 8625 words for executable code.
   Procedure KVI$INT requires 62 words of local(AUTO) storage.

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:122  

 Object Unit name= KVI$INT                                    File name= KVI$INT.:E05TOU
 UTS= JUL 30 '97 02:01:02.88 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    251     FB  KVI$INT
    1   Proc  even  none  8625   21B1  KVI$INT
    2  RoData even  none    75     4B  KVI$INT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KVI$INT
     1      7                  yes      Std        1  KVI$INTINPOPR
     1   1F01                  yes      Std        0  KVI$ABRRED
     1   1F17                  yes      Std        0  KVI$AUTWRP
     1   1FC8                  yes      Std        1  KVI$EDTX_TO_VRTCLM
     1   1FE2                  yes      Std        0  KVI$PRGRED
     1   1FF8                  yes      Std        0  KVI$PRGTYPAHDINPFNC
     1   200A                  yes      Std        0  KVI$RE_DSPINP
     1   2020                  yes      Std        0  KVI$SCPVRTCLMLOWX
     1   2036                  yes      Std        1  KVI$SHFDSPPST
     1   2050                  yes      Std        0  KVI$SHFTO_DFL
     1   20B9                  yes      Std        1  KVI$TRMRED_VDH_DAT

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0      0  KV_INPFNC_PRMIDS                   0     F3  KV_CLK_CANCEL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:123  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KVF$PST
         yes           Std       0 KVO$ERSSRD
         yes           Std       0 KVO$SCRENDNO_HLT
 yes     yes           Std       1 KVE$INPOPR
         yes           Std       1 KVO$OTP1_VRT
         yes           Std       0 KVS$CHNSSN
         yes           Std       1 KVI$ACTRED
         yes           Std       1 KVP$GETPRM
         yes           Std       0 KVI$ADJINPFLDBGNATR
         yes           Std       1 KVS$SETSTR
 yes     yes           Std       1 KVS$GETBFR
         yes           Std       1 KVP$SETPRM
         yes           Std       0 KVI$INPCHR_INPFNCIMD
 yes     yes           Std       1 KVS$RLSBFR
         yes           Std       0 KVI$INPCHR_INPFNC
         yes           Std       0 KVI$BFRREDCHR
         yes           Std       0 KVI$ENBRED
         yes           Std       1 KVC$DSC
 yes     yes           Std       1 KVV$CALUSR
 yes     yes           Std       1 KVS$GETREDBFR
 yes     yes           Std       1 KVV$CALUSR_EVT
 yes     yes           Std       0 KVE$DSPALL
         yes           Std       0 KVI$CPYSTREDTBFRTO_REDBFR
 yes     yes           Std       1 KVM$SND
         yes           Std       0 KVI$OTPPRTID
         yes           Std       0 KVC$DRWBRD
         yes           Std       0 KVI$CPYSSNEDTBFRTO_REDBFR
         yes           Std       0 KVO$ERSTO_ENDOF_INP
         yes           Std       1 KVO$PST
         yes           Std       0 KVO$PSTAFTHI_NONBLNPHSPST
         yes           Std       1 KVO$OTPLCL
         yes           Std       1 KVO$OTP1_NONVRT
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:124  
         yes           Std       0 KVI$INCINPFLDSIZ
         yes           Std       0 KVO$PAGBRK
 yes     yes           Std       0 KVE$SCRALL
         yes           Std       0 KVO$ERSMRD
 yes     yes           Std       0 KVF$RE_TYPFRM
         yes           Std       1 KVI$INTINPOPRX
         yes           Std       1 KHD$SCREECH
 yes     yes           Std       0 KVV$CALUSR_PST
 yes     yes           Std       0 KVE$RE_DSPSE
         yes           Std       0 KVI$RSTINPFLDBGNATR
 yes     yes           Std       1 KHC$CLOCK
         yes           Std       0 KVI$RSTINPFLDENDATR
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6C_ALR
                       nStd      0 X6C_MAT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    G$LOW_MEM$                            KV$PTR$                               KV_USR_INPPRC
     KV_USR_PST                            KV_USR_SETATR                         KV_VDH_DAT_NRM_NO_ACTCHR
     KV_VDH_DSC                            KV_VDH_GETBFR                         KV_VDH_GETPRM
     KV_VDH_OTPLCL                         KV_VDH_PST_SPCFRM                     KV_VDH_RLSBFR
     KV_SND_EVT_BRK                        KV_SND_EVT_MNTATN                     KV_SND_RQSMRK_DLTRCVDAT
     KV_SND_RQSMRK_DLTRCVRQS               KV_SND_RQSSTT                         KV_VDH_PST_0_VRT
     KV_VDH_PST_BS_FRM                     KV_VDH_PST_CR_VRT                     KV_VDH_PST_LF
     KV_VDH_PST_NEWLIN_VRT                 KV_VDH_PST_VRT                        KV_VDH_PST_WHTSPC
r    KV_GRPCHR_WRD                         KV_SND_RQSDAT_GNR                r    G$ROS$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:125  


        1        1        /*M* KVI$INT ASYNC HANDLER INPUT FUNCTION INTERPRETER ROUTINES                */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        8        8
        9        9        KVI$INT: PROC (VDH_PARM);

      9   1 000000  D380 0000 0000  xent KVI$INT         LNJ,B5   X6A_AUTO_1
          1 000003       003E 0001                       DC       62,1
          1 000005  0F81 0006                            B        s:4897,PREL

       10       10
       11       11        %INCLUDE KH_SCREECH_M;
       12       22 S      %INCLUDE KV$GLB;
       13       23 S      %INCLUDE KV$GLBCTX;
       14       24        %INCLUDE KV$INPFNC;
       15      583 S      %INCLUDE KV$INT;
       16      584 S      %INCLUDE KV$SND;
       17      585 S      %INCLUDE KV$USR;
       18      586 S      %INCLUDE KV$VDH;
       19      587 S      %INCLUDE KV$VDO;
       20      588 S      %INCLUDE KV_GLBCNS_E;
       21      589 S      %INCLUDE KV_PRMID_E;
       22      590        %INCLUDE KV_ASCCHR_E;
       23      727        %INCLUDE KV_INT;
       24      766        %INCLUDE KV_INT_M;
       25      909        %INCLUDE KV_SCODE_C;
       26      930        %INCLUDE LCP_6;
       27     1121        %INCLUDE K_CP6_M;
       28     1317        %G#GRPRND_E;
       29     1327        %G$LOW_MEM (STCLASS="BASED(G$LOW_MEM$)");
       30     1376    1   DCL G$LOW_MEM$ PTR SYMREF READONLY;
       31     1377
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:126  
       32     1378        %KV#VD_ORG_E;
       33     1386        %KV_ABSGRPRND_E;
       34     1395        %KV_BFRRLSDSP_E;
       35     1401        %KV_CMPCOD_E;
       36     1415        %KV_DSCRSN_E;
       37     1424        %KV_EVTTYP_E;
       38     1428        %KV_INPFNC_E;
       39     1442        %KV_INPOPRX_E;
       40     1454        %KV_INPOPR_E;
       41     1467        %KV_INPPRC_E;
       42     1519        %KV_INPUNT_E;
       43     1524        %KV_PRMID_E;
       44     1680        %KV_SCP_E;
       45     1690        %KV_SND_FNC_E;
       46     1706        %KV_USR_EVT_ID_E;
       47     1726        %KV_PHSPSTMOD_E;
       48     1733        %KV_STRTYP_E;
       49     1771        %KV_VRTPSTMOD_E;
       50     1777
       51     1778        %KV$EDTWND;
       52     1794        %KV$INPFNCTBL;
       53     1878        %KV$INPOPR(STCLASS="BASED(INPOPR$)");   /*  INPUT OPERATOR                    */
       54     1977        %KV$LINLST;
       55     2004        %KV$MRD;
       56     2051        %KV$MVD;                                /*  Master virtual device             */
       57     2095        %KV$PTR;                                /*  Pointers, status                  */
       58     2138        %KV$RCRLST;
       59     2174        %KV$REDBFR (STCLASS="BASED(REDBFR$)");  /*  HANDLER INPUT BUFFER DESCRIPTION  */
       60     2177    1   DCL KV$REDBFR_BIN(0:0) BASED(REDBFR$) UBIN(8) CALIGNED;
       61     2178    1   DCL KV$REDBFR_BIT(0:0) BASED(REDBFR$) BIT(8) CALIGNED;
       62     2179    1   DCL KV$REDBFR_BYT(0:0) BASED(REDBFR$) SBIN(8) CALIGNED;
       63     2180    1   DCL KV$REDBFR_CHR BASED(REDBFR$) CHAR(512) ALIGNED;
       64     2181        %KV$SHRBFR (LAST=",");             /*  ASYNC MISCELLANEOUS BUFFER DESCRIPTION */
       65     2213    1          2 BITT(0:15) BIT(1),
       66     2214    1          2 BYT(0:1) REDEF BITT UBIN(8) CALIGNED;
       67     2215    1   DCL KV$SHRBFR_BYT(0:0) BASED UBIN(8) CALIGNED;
       68     2216        %KV$SRD;                                /*  Subordinate real device           */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:127  
       69     2491        %KV$SSN (STCLASS="BASED(SSN$)");        /*  Session                           */
       70     2570        %EQU KV_SSN = CHARTEXT('KV$SSN');
       71     2571        %KV$STR;                                /*  Stream                            */
       72     2658        %KV$TYPAHDBFR;
       73     2683        %KV$VDI;                                /*  VDI (VDH < ->VDH user interface)  */
       74     2754    1   DCL KV$INPFNCCHR BASED CHAR(255) ALIGNED;
       75     2755    1   DCL KV$INPFNCOPRX(0:0) BASED SBIN CALIGNED;
       76     2756        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:128  
       77     2757    1   DCL KHD$SCREECH ENTRY(1);
       78     2758    1   DCL KVC$DRWBRD ENTRY;
       79     2759    1   DCL KVC$DSC ENTRY(1);
       80     2760    1   DCL KVE$DSPALL ENTRY ALTRET;
       81     2761    1   DCL KVE$INPOPR ENTRY(1) ALTRET;
       82     2762    1   DCL KVE$RE_DSPSE ENTRY ALTRET;
       83     2763    1   DCL KVE$SCRALL ENTRY ALTRET;
       84     2764    1   DCL KVF$PST ENTRY(1);
       85     2765    1   DCL KVF$RE_TYPFRM ENTRY ALTRET;
       86     2766    1   DCL KVI$ACTRED ENTRY(1);
       87     2767    1   DCL KVI$ADJINPFLDBGNATR ENTRY;
       88     2768    1   DCL KVI$BFRREDCHR ENTRY;
       89     2769    1   DCL KVI$CPYSSNEDTBFRTO_REDBFR ENTRY;
       90     2770    1   DCL KVI$CPYSTREDTBFRTO_REDBFR ENTRY;
       91     2771    1   DCL KVI$ENBRED ENTRY;
       92     2772    1   DCL KVI$INCINPFLDSIZ ENTRY;
       93     2773    1   DCL KVI$INPCHR_INPFNC ENTRY;
       94     2774    1   DCL KVI$INPCHR_INPFNCIMD ENTRY;
       95     2775    1   DCL KVI$INTINPOPRX ENTRY(1);
       96     2776    1   DCL KVI$OTPPRTID ENTRY;
       97     2777    1   DCL KVI$RSTINPFLDBGNATR ENTRY;
       98     2778    1   DCL KVI$RSTINPFLDENDATR ENTRY;
       99     2779    1   DCL KVI$SETINPFLDBGNATR ENTRY;
      100     2780    1   DCL KVM$SND ENTRY(1) ALTRET;
      101     2781    1   DCL KVO$ERSMRD ENTRY;
      102     2782    1   DCL KVO$ERSSRD ENTRY;
      103     2783    1   DCL KVO$ERSTO_ENDOF_INP ENTRY;
      104     2784    1   DCL KVO$OTPLCL ENTRY(1);
      105     2785    1   DCL KVO$PAGBRK ENTRY;
      106     2786    1   DCL KVO$PST ENTRY(1);
      107     2787    1   DCL KVO$PSTAFTHI_NONBLNPHSPST ENTRY;
      108     2788    1   DCL KVO$SCRENDNO_HLT ENTRY;
      109     2789    1   DCL KVO$OTP1_NONVRT ENTRY(1);
      110     2790    1   DCL KVO$OTP1_VRT ENTRY(1);
      111     2791    1   DCL KVP$GETPRM ENTRY(1);
      112     2792    1   DCL KVP$SETPRM ENTRY(1);
      113     2793    1   DCL KVS$CHNSSN ENTRY;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:129  
      114     2794    1   DCL KVS$GETBFR ENTRY(1) ALTRET;
      115     2795    1   DCL KVS$GETREDBFR ENTRY(1) ALTRET;
      116     2796    1   DCL KVS$RLSBFR ENTRY(1) ALTRET;
      117     2797    1   DCL KVS$SETSTR ENTRY(1);
      118     2798    1   DCL KVV$CALUSR_EVT ENTRY(1) ALTRET;
      119     2799    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
      120     2800    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
      121     2801
      122     2802        /* SYMREF structures (for initializing AUTO ones */
      123     2803
      124     2804        %KV$USR_INPPRC (NAME=KV_USR_INPPRC, STCLASS=SYMREF);
      125     2840        %KV$USR_PST (NAME=KV_USR_PST, STCLASS=SYMREF);
      126     2910        %KV$USR_SETATR (NAME=KV_USR_SETATR, STCLASS=SYMREF);
      127     3033        %KV$VDH_DAT (NAME=KV_VDH_DAT_NRM_NO_ACTCHR, STCLASS=SYMREF);
      128     3113        %KV$VDH_DSC (NAME=KV_VDH_DSC, STCLASS=SYMREF);
      129     3149        %KV$VDH_GETBFR (NAME=KV_VDH_GETBFR, STCLASS=SYMREF);
      130     3214        %KV$VDH_GETPRM (NAME=KV_VDH_GETPRM, STCLASS=SYMREF);
      131     3276        %KV$VDH_OTPLCL (NAME=KV_VDH_OTPLCL, STCLASS=SYMREF);
      132     3349        %KV$VDH_PST (NAME=KV_VDH_PST_SPCFRM, STCLASS=SYMREF);
      133     3423        %KV$VDH_RLSBFR (NAME=KV_VDH_RLSBFR, STCLASS=SYMREF);
      134     3459
      135     3460        /* SYMREF structures used only to CALL other routines */
      136     3461
      137     3462    1   DCL KV_SND_EVT_BRK UBIN SYMREF;
      138     3463    1   DCL KV_SND_EVT_MNTATN UBIN SYMREF;
      139     3464    1   DCL KV_SND_RQSMRK_DLTRCVDAT UBIN SYMREF;
      140     3465    1   DCL KV_SND_RQSMRK_DLTRCVRQS UBIN SYMREF;
      141     3466    1   DCL KV_SND_RQSSTT UBIN SYMREF;
      142     3467    1   DCL KV_VDH_PST_0_VRT UBIN SYMREF;
      143     3468    1   DCL KV_VDH_PST_BS_FRM UBIN SYMREF;
      144     3469    1   DCL KV_VDH_PST_CR_VRT UBIN SYMREF;
      145     3470    1   DCL KV_VDH_PST_LF UBIN SYMREF;
      146     3471    1   DCL KV_VDH_PST_NEWLIN_VRT UBIN SYMREF;
      147     3472    1   DCL KV_VDH_PST_VRT UBIN SYMREF;
      148     3473    1   DCL KV_VDH_PST_WHTSPC UBIN SYMREF;
      149     3474        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:130  
      150     3475        %MACRO Y_PRMID (PRMID=0, ACK=.., LAST(YES="*0);")=",");
      151     3476        %SET Y@PRMTXT=CONCAT(Y@PRMTXT,TEXTCHAR(ACK));
      152     3477        %(PRMID) LAST
      153     3478        %MEND;
      154     3479    1   DCL KV_INPFNC_PRMIDS(0:63) UBIN BYTE CALIGNED CONSTANT SYMDEF INIT(0,
      155     3480        %SET Y@PRMTXT='  ';
      156     3481             %Y_PRMID (PRMID=KV_PRMID_AUTTABCLM, ACK=AT); /* 01                       */
      157     3485        %Y_PRMID (PRMID=KV_PRMID_INSMOD, ACK=IN); /* 02                               */
      158     3489        %Y_PRMID (PRMID=KV_PRMID_MSGLIN, ACK=ML); /* 03                               */
      159     3493        %Y_PRMID (PRMID=KV_PRMID_WRDWRPCLM, ACK=WC); /* 04                            */
      160     3497        %Y_PRMID (PRMID=KV_PRMID_EDTRHT, ACK=ER); /* 05                               */
      161     3501        %Y_PRMID (PRMID=KV_PRMID_TRUNCATE, ACK=TC); /* 06                             */
      162     3505        %Y_PRMID (PRMID=KV_PRMID_ACTONTRN, ACK=AO); /* 07                             */
      163     3509        %Y_PRMID (PRMID=KV_PRMID_WRDWRP, ACK=WW); /* 08                               */
      164     3513        %Y_PRMID (PRMID=KV_PRMID_RCRWRAP, ACK=RW); /* 09                              */
      165     3517        %Y_PRMID (PRMID=KV_PRMID_TEXTEDIT, ACK=TE); /* 10                             */
      166     3521        %Y_PRMID (PRMID=KV_PRMID_EASYAPPEND, ACK=EA); /* 11                           */
      167     3525        %Y_PRMID (PRMID=KV_PRMID_CHNCAS, ACK=CC); /* 12                               */
      168     3529        %Y_PRMID (PRMID=KV_PRMID_PRKCRS, ACK=PK); /* 13                               */
      169     3533        %Y_PRMID (PRMID=KV_PRMID_ONESPCEDT, ACK=OS); /* 14                            */
      170     3537        %Y_PRMID (PRMID=0, ACK=15);
      171     3541        %Y_PRMID (PRMID=0, ACK=16);
      172     3545        %Y_PRMID (PRMID=0, ACK=17);
      173     3549        %Y_PRMID (PRMID=0, ACK=18);
      174     3553        %Y_PRMID (PRMID=0, ACK=19);
      175     3557        %EQU Y_LVL2_MAX=LENGTHC(Y@PRMTXT)/2;
      176     3558        %Y_PRMID (PRMID=KV_PRMID_OVRSTR, ACK=SB); /* 20                               */
      177     3562        %Y_PRMID (PRMID=KV_PRMID_DISPINPUT, ACK=DI); /* 21                            */
      178     3566        %Y_PRMID (PRMID=KV_PRMID_PARITYCHECK, ACK=PC); /* 22                          */
      179     3570        %Y_PRMID (PRMID=KV_PRMID_OUTPUTDISCARD, ACK=OD); /* 23                        */
      180     3574        %Y_PRMID (PRMID=KV_PRMID_UPPERCASE, ACK=UC); /* 24                            */
      181     3578        %Y_PRMID (PRMID=KV_PRMID_APLLCNRM, ACK=AL); /* 25                             */
      182     3582        %Y_PRMID (PRMID=KV_PRMID_RETYPOVR, ACK=RO); /* 26                             */
      183     3586        %Y_PRMID (PRMID=KV_PRMID_EDITOVR, ACK=EO); /* 27                              */
      184     3590        %Y_PRMID (PRMID=KV_PRMID_SCROLL*0, ACK=SC); /* 28                             */
      185     3594        %Y_PRMID (PRMID=KV_PRMID_PAGEHALT, ACK=PA); /* 29                             */
      186     3598        %Y_PRMID (PRMID=KV_PRMID_PRINTHALT, ACK=PR); /* 30                            */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:131  
      187     3602        %Y_PRMID (PRMID=KV_PRMID_RELPAGE, ACK=RP); /* 31                              */
      188     3606        %Y_PRMID (PRMID=KV_PRMID_SIMPERF, ACK=SP); /* 32                              */
      189     3610        %Y_PRMID (PRMID=KV_PRMID_NOOPTMIZ, ACK=NO); /* 33                             */
      190     3614        %Y_PRMID (PRMID=KV_PRMID_WRPPAG, ACK=WP); /* 34                               */
      191     3618        %Y_PRMID (PRMID=KV_PRMID_LOCALECHO, ACK=LE); /* 35                            */
      192     3622        %Y_PRMID (PRMID=KV_PRMID_MSGHLT, ACK=MH); /* 36                               */
      193     3626        %Y_PRMID (PRMID=KV_PRMID_AUTCRS, ACK=AC); /* 37                               */
      194     3630        %Y_PRMID (PRMID=KV_PRMID_TRUOVRPRT, ACK=TO); /* 38                            */
      195     3634        %Y_PRMID (PRMID=KV_PRMID_CRSRED, ACK=CR); /* 39                               */
      196     3638        %Y_PRMID (PRMID=KV_PRMID_KEPTYP, ACK=KT); /* 40                               */
      197     3642        %Y_PRMID (PRMID=0, ACK=41);
      198     3646        %Y_PRMID (PRMID=0, ACK=42);
      199     3650        %Y_PRMID (PRMID=0, ACK=43);
      200     3654        %Y_PRMID (PRMID=0, ACK=44);
      201     3658        %Y_PRMID (PRMID=0, ACK=45);
      202     3662        %Y_PRMID (PRMID=0, ACK=46);
      203     3666        %Y_PRMID (PRMID=0, ACK=47);
      204     3670        %Y_PRMID (PRMID=0, ACK=48);
      205     3674        %Y_PRMID (PRMID=0, ACK=49);
      206     3678        %EQU Y_LVL1_MAX=LENGTHC(Y@PRMTXT)/2;
      207     3679        %Y_PRMID (PRMID=KV_PRMID_TABSIM, ACK=TS); /* 50                               */
      208     3683        %Y_PRMID (PRMID=KV_PRMID_TABRELATIVE, ACK=TR); /* 51                          */
      209     3687        %Y_PRMID (PRMID=KV_PRMID_SPACEINSERT, ACK=SI); /* 52                          */
      210     3691        %Y_PRMID (PRMID=KV_PRMID_LOWERCASE, ACK=LC); /* 53                            */
      211     3695        %Y_PRMID (PRMID=KV_PRMID_FULLDUPLEXPAPERTAPE, ACK=FP); /* 54                  */
      212     3699        %Y_PRMID (PRMID=KV_PRMID_HALFDUPLEXPAPERTAPE, ACK=HP); /* 55                  */
      213     3703        %Y_PRMID (PRMID=0, LAST=YES);
      214     3707    1   DCL KV_PRMACK_TXT CHAR(0) CONSTANT INIT(%Y@PRMTXT);
      215     3708    1   DCL KV_PRMACK_TXTU(0:%(LENGTHC(Y@PRMTXT)/2-1)) REDEF KV_PRMACK_TXT UBIN;
      216     3709    1   DCL Y_MAXPRMX(0:2) SBIN CONSTANT INIT(63,%Y_LVL1_MAX,%Y_LVL2_MAX);
      217     3710        %KV_GRPCHR;
      218     3726    1   DCL 1 Y_CHNCAS CONSTANT,
      219     3727    1          2 *(0:15) BIT(32) CALIGNED INIT(
      220     3728    1   '00010203'X,'04050607'X,'08090A0B'X,'0C0D0E0F'X,
      221     3729    1   '10111213'X,'14151617'X,'18191A1B'X,'1C1D1E1F'X,
      222     3730    1   '20212223'X,'24252627'X,'28292A2B'X,'2C2D2E2F'X,
      223     3731    1   '30313233'X,'34353637'X,'38393A3B'X,'3C3D3E3F'X),
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:132  
      224     3732    1          2 * CHAR(0) INIT(
              3732                   '@abcdefghijklmnopqrstuvwxyz[\]^_`ABCDEFGHIJKLMNOPQRSTUVWXYZ{'),
      225     3733    1          2 *(0:32) BIT(32) INIT('7C7D7E7F'X,
      226     3734    1   '80818283'X,'84858687'X,'88898A8B'X,'8C8D8E8F'X,
      227     3735    1   '90919293'X,'94959697'X,'98999A9B'X,'9C9D9E9F'X,
      228     3736    1   'A0A1A2A3'X,'A4A5A6A7'X,'A8A9AAAB'X,'ACADAEAF'X,
      229     3737    1   'B0B1B2B3'X,'B4B5B6B7'X,'B8B9BABB'X,'BCBDBEBF'X,
      230     3738    1   'C0C1C2C3'X,'C4C5C6C7'X,'C8C9CACB'X,'CCCDCECF'X,
      231     3739    1   'D0D1D2D3'X,'D4D5D6D7'X,'D8D9DADB'X,'DCDDDEDF'X,
      232     3740    1   'E0E1E2E3'X,'E4E5E6E7'X,'E8E9EAEB'X,'ECEDEEEF'X,
      233     3741    1   'F0F1F2F3'X,'F4F5F6F7'X,'F8F9FAFB'X,'FCFDFEFF'X);
      234     3742        %KV$VDH_OTPLCL (NAME=VDH_OTPLCL_BNG_HI_BNG, TEXT='!HI!', NONVRT=YES, STCLASS=
              3742            CONSTANT);
      235     3815        /* Static KV$VDH_OTPLCL structure for sending TXT_WRT data                    */
      236     3816        %KV$VDH_OTPLCL (NAME=VDH_OTPLCL_WRT, BYTX=3, STCLASS=CONSTANT);
      237     3889        /* Static KV$VDH_OTPLCL structure for sending 'TYPE: '.                       */
      238     3890
      239     3891        %KV$VDH_OTPLCL (NAME=VDH_OTPLCL_TYPE, TEXT='TYPE:', NONVRT=YES, STCLASS=CONSTANT);
      240     3964        %VLP_SCODE (FPTN=KVI_INPFNC,FCG=KV,MID=I,ERR#=%S$KV_INPFNC,STCLASS=CONSTANT);
      241     4025
      242     4026        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:133  
      243     4027        %KV$USR_INPPRC (NAME=KV@USR_INPPRC);
      244     4063        %EQU USR_INPPRC=CHARTEXT('ADDR(FPT)->KV@USR_INPPRC');
      245     4064        %KV$USR_PST (NAME=KV@USR_PST);
      246     4134        %EQU USR_PST=CHARTEXT('ADDR(FPT(5))->KV@USR_PST');
      247     4135        %KV$USR_SETATR (NAME=KV@USR_SETATR);
      248     4258        %EQU USR_SETATR=CHARTEXT('ADDR(FPT)->KV@USR_SETATR');
      249     4259
      250     4260        %KV$VDH_DAT (NAME=KV@VDH_DAT);
      251     4340        %EQU VDH_DAT=CHARTEXT('ADDR(FPT)->KV@VDH_DAT');
      252     4341        %KV$VDH_DSC (NAME=KV@VDH_DSC);
      253     4377        %EQU VDH_DSC=CHARTEXT('ADDR(FPT)->KV@VDH_DSC');
      254     4378        %KV$VDH_GETBFR (NAME=KV@VDH_GETBFR);
      255     4443        %EQU VDH_GETBFR=CHARTEXT('ADDR(FPT)->KV@VDH_GETBFR');
      256     4444        %KV$VDH_GETPRM (NAME=KV@VDH_GETPRM);
      257     4506        %EQU VDH_GETPRM=CHARTEXT('ADDR(FPT)->KV@VDH_GETPRM');
      258     4507        %KV$VDH_OTPLCL (NAME=KV@VDH_OTPLCL);
      259     4580        %EQU VDH_OTPLCL=CHARTEXT('ADDR(FPT)->KV@VDH_OTPLCL');
      260     4581        %KV$VDH_PST (NAME=KV@VDH_PST);
      261     4655        %EQU VDH_PST=CHARTEXT('ADDR(FPT)->KV@VDH_PST');
      262     4656        %KV$VDH_RLSBFR (NAME=KV@VDH_RLSBFR);
      263     4692        %EQU VDH_RLSBFR=CHARTEXT('ADDR(FPT)->KV@VDH_RLSBFR');
      264     4693        %KV$VDH_SETPRM (NAME=KV@VDH_SETPRM);
      265     4755        %EQU VDH_SETPRM=CHARTEXT('ADDR(FPT)->KV@VDH_SETPRM');
      266     4756
      267     4757    1   DCL VDH_PARM CHAR(VDH_VRTCLM);
      268     4758    1   DCL VDH_VRTCLM REDEF VDH_PARM UBIN;
      269     4759    1   DCL VDH_SHFCNT REDEF VDH_PARM SBIN;
      270     4760        %KV$VDH_INTINPOPR(NAME = VDH_INTINPOPR, STCLASS = REDEF VDH_PARM);
      271     4796        %KV$VDH_DAT(NAME = VDH_DAT, STCLASS = REDEF VDH_PARM);
      272     4876
      273     4877    1   DCL INPOPR$ PTR;
      274     4878    1   DCL REDBFR$ PTR;
      275     4879    1   DCL SSN$ PTR;
      276     4880    1   DCL B3 PTR;
      277     4881    1   DCL R2 SBIN;
      278     4882    1   DCL R3 SBIN;
      279     4883    1   DCL R5 SBIN;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:134  
      280     4884    1   DCL EDTX SBIN;
      281     4885    1   DCL DSPLOWCLM SBIN;
      282     4886    1   DCL OPRCNT SBIN;
      283     4887    1   DCL OPRCNTU REDEF OPRCNT UBIN;
      284     4888    1   DCL STR UBIN;
      285     4889    1   DCL SAVEBIT BIT(1);
      286     4890    1   DCL FPT(0:15) UBIN;
      287     4891        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:135  
      288     4892    1   KVI$INTINPOPR: ENTRY (VDH_PARM);

   4892   1 000007  D380 0000 0000  xent KVI$INTINPOPR   LNJ,B5   X6A_AUTO_1
          1 00000A       003E 0001                       DC       62,1

      289     4893
      290     4894        /* Interpret the input operators that start at the point
      291     4895           indexed to by VDH_INTINPOPR.INPOPRX.                                       */
      292     4896
      293     4897    1      INPOPR$ = PINCRW (VDH_INTINPOPR.INPFNCTBL$, VDH_INTINPOPR.INPOPRX);

   4897   1 00000C  ECC7 0004                            LDB,B6   @VDH_PARM,AUTO
          1 00000E  B846 0004                            LDR,R3   4,B6
          1 000010  DCC6 0001                            LDB,B5   1,B6
          1 000012  CBB5                                 LAB,B4   ,B5,R3
          1 000013  CFC7 0006                            STB,B4   INPOPR$,AUTO

      294     4898    1      SSN$ = KV$PTR.SSN$;

   4898   1 000015  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 000018  ACC3 0002                            LDB,B2   2,B3
          1 00001A  AFC7 000A                            STB,B2   SSN$,AUTO

      295     4899    1      OPRCNT = KV$PTR.INPCNDPND.OPRX;

   4899   1 00001C  E843 001C                            LDR,R6   28,B3
          1 00001E  EF47 0013                            STR,R6   OPRCNT,AUTO

      296     4900
      297     4901    2      IF G$LOW_MEM.WDT_CURR<50 THEN DO;

   4901   1 000020  9C80 0000 0000  xsym                 LDB,B1   G$LOW_MEM$
          1 000023  D841 0017                            LDR,R5   23,B1
          1 000025  5D32                                 CMV,R5   50
          1 000026  0281 0012                            BGE      s:4912,PREL

      298     4902
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:136  
      299     4903        /* If we have done too much for this line -
      300     4904           blow it away.                                                              */
      301     4905    2         INPOPR$ = %KV_MVD.SSTINPFNCTBL$;

   4905   1 000028  ECC3 0006                            LDB,B6   6,B3
          1 00002A  DCC6 000A                            LDB,B5   10,B6
          1 00002C  DFC7 0006                            STB,B5   INPOPR$,AUTO

      302     4906    2         INPOPR$ = PINCRW (INPOPR$,

   4906   1 00002E  B845 002C                            LDR,R3   44,B5
          1 000030  E853                                 LDR,R6   R3
          1 000031  70F0                                 DAR,R7   16
          1 000032  8447 0006                            AID      INPOPR$,AUTO
          1 000034  8470 0000 0008                       AID      8,IMO
          1 000037  8D47 0006                            SDI      INPOPR$,AUTO

      303     4907    2           INPOPR$->KV$INPFNCTBL.INPOPROFS+%KV_INPOPRX_REDDATLST);
      304     4908    2      END /* IF */;

      305     4909    2      DO WHILE '1'B;

      306     4910
      307     4911        /* This loop is traversed for each input operator.                            */
      308     4912    3         IF NOT %KV_VDI.USRRQSDAT.RED AND KV$INPOPR.RED THEN DO;

   4912   1 000039  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00003C  DC86                                 LDB,B5   ,B6
          1 00003D  82C5 001D                            LB,'0010'X        29,B5
          1 00003F       0010
          1 000040  0501 000C                            BBT      s:4919,PREL
          1 000042  CCC7 0006                            LDB,B4   INPOPR$,AUTO
          1 000044  8284                                 LB,'4000'X        ,B4
          1 000045       4000
          1 000046  0581 0006                            BBF      s:4919,PREL

      309     4913        /* We're not doing read processing, and this input operator
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:137  
      310     4914           is to be processed during read processing. Buffer the
      311     4915           character string invoking this input function.                             */
      312     4916
      313     4917    3            %KV_SSN.TYPAHD.BFRCHR = '1'B;

   4917   1 000048  BCC7 000A                            LDB,B3   SSN$,AUTO
          1 00004A  8943 0027                            LBT,'0020'X       39,B3
          1 00004C       0020

      314     4918    3         END /* IF */;

      315     4919    2         IF KV$INPOPR.IMD AND VDH_INTINPOPR.IMD

   4919   1 00004D  DCC7 0006                            LDB,B5   INPOPR$,AUTO
          1 00004F  8985                                 CMZ      ,B5
          1 000050  0881 0007                            BAGE     s:4919+11,PREL
          1 000052  CCC7 0004                            LDB,B4   @VDH_PARM,AUTO
          1 000054  8284                                 LB,'0080'X        ,B4
          1 000055       0080
          1 000056  0501 000B                            BBT      s:4924,PREL
          1 000058  8285                                 LB,'4000'X        ,B5
          1 000059       4000
          1 00005A  0581 0E4D                            BBF      s:5941,PREL
          1 00005C  CC86                                 LDB,B4   ,B6
          1 00005D  82C4 001D                            LB,'0010'X        29,B4
          1 00005F       0010
          1 000060  0581 0E47                            BBF      s:5941,PREL

      316     4920    3           OR KV$INPOPR.RED AND %KV_VDI.USRRQSDAT.RED THEN DO;

      317     4921        /* The processing of this input operator is required during this
      318     4922           phase (immediate or read).                                                 */
      319     4923
      320     4924    3            IF KV$INPOPR.ACK AND KV$INPOPR.TYP~=%KV_INPOPR_TYP_MSC

   4924   1 000062  8285                                 LB,'1000'X        ,B5
   4924   1 000063       1000
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:138  
          1 000064  0581 000E                            BBF      s:4930,PREL
          1 000066  E805                                 LDR,R6   ,B5
          1 000067  6048                                 SOR,R6   8
          1 000068  E570 000F                            AND,R6   15,IMO
          1 00006A  6D04                                 CMV,R6   4
          1 00006B  0901 0007                            BE       s:4930,PREL
          1 00006D  6D08                                 CMV,R6   8
          1 00006E  0901 0004                            BE       s:4930,PREL

      321     4925    3              AND KV$INPOPR.TYP~=%KV_INPOPR_TYP_TGLPRM
      322     4926        /* WE ARE TO ECHO <escape-chr> , E.G., IF ESCAPE R, ECHO <R>              */
      323     4927
      324     4928    3            THEN CALL Y$ECHINPOPR;

   4928   1 000070  E3C0 0FB6                            LNJ,B6   s:0,PREL
          1 000072       0001                            DC       s:4930,PREL

      325     4929
      326     4930    3            REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   4930   1 000073  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000075  DCC6 0030                            LDB,B5   48,B6
          1 000077  DFC7 0008                            STB,B5   REDBFR$,AUTO

      327     4931    4   INPOPR:  DO CASE (KV$INPOPR.TYP);

   4931   1 000079  CCC7 0006            INPOPR          LDB,B4   INPOPR$,AUTO
          1 00007B  B804                                 LDR,R3   ,B4
          1 00007C  3048                                 SOR,R3   8
          1 00007D  B570 000F                            AND,R3   15,IMO
          1 00007F  3D0C                                 CMV,R3   12
          1 000080  0281 0E38                            BGE      s:5947,PREL
          1 000082  A830 0000 0088  01                   LDR,R2   INPOPR+15,R3
          1 000085  83A0 0000 0094  01                   JMP      s:4938,R2
          1 000088       0E12                            DC       s:5936,PREL
          1 000089       0000                            DC       s:4938,PREL
          1 00008A       0034                            DC       s:4952,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:139  
          1 00008B       0E12                            DC       s:5936,PREL
          1 00008C       0220                            DC       s:5086,PREL
          1 00008D       0052                            DC       s:4964,PREL
          1 00008E       0060                            DC       s:4970,PREL
          1 00008F       0060                            DC       s:4970,PREL
          1 000090       0060                            DC       s:4970,PREL
          1 000091       0138                            DC       s:5019,PREL
          1 000092       035D                            DC       s:5177,PREL
          1 000093       0395                            DC       s:5185,PREL

      328     4932        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:140  
      329     4933    4            CASE (%KV_INPOPR_TYP_ACTRED);

      330     4934        /* This is the activate-read INPOPR. A data message
      331     4935           (e.g., KV$VDO_DAT) will be sent to the other end if there is
      332     4936           a pending read.                                                            */
      333     4937
      334     4938    4               %VDH_DAT = KV_VDH_DAT_NRM_NO_ACTCHR;

   4938   1 000094  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_DAT_NRM_NO_ACTCHR
          1 000097  2C00                                 LDV,R2   0
          1 000098  6C10                                 LDV,R6   16
          1 000099  BB87                                 LAB,B3   ,AUTO
          1 00009A  3C2C                                 LDV,R3   44
          1 00009B  0008                                 MMM

      335     4939    4               %VDH_DAT.CMPCOD = KV$INPOPR.CMPCOD;

   4939   1 00009C  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 00009E  E806                                 LDR,R6   ,B6
          1 00009F  E570 00FF                            AND,R6   255,IMO
          1 0000A1  E7C7 001D                            STH,R6   FPT+7,AUTO

      336     4940    4               CALL KVI$ACTRED (FPT);

   4940   1 0000A3  DBC7 0016                            LAB,B5   FPT,AUTO
          1 0000A5  DFC7 003A                            STB,B5   R+2,AUTO
          1 0000A7  BBC7 003A                            LAB,B3   R+2,AUTO
          1 0000A9  CBF0 0100                            LAB,B4   256,IMO
          1 0000AB  E380 0000 0000  xent                 LNJ,B6   KVI$ACTRED
          1 0000AE       0001                            DC       s:4941,PREL

      337     4941    4               IF %KV_MVD.ORG<%KV#VD_ORG_FORM AND %VDH_DAT.CMPCOD~=%KV_CMPCOD_NRM

   4941   1 0000AF  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0000B2  DCC6 0006                            LDB,B5   6,B6
          1 0000B4  E2C5 0015                            LLH,R6   21,B5
          1 0000B6  6D04                                 CMV,R6   4
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:141  
          1 0000B7  0281 0E01                            BGE      s:5947,PREL
          1 0000B9  D2C7 001D                            LLH,R5   FPT+7,AUTO
          1 0000BB  5901 0DFD                            BEZ,R5   s:5947,PREL

      338     4942        /* This isn't a forms virtual device, and the completion
      339     4943           code isn't 'normal'. Position to a new virtual line.                       */
      340     4944
      341     4945    4               THEN CALL KVO$PST (KV_VDH_PST_NEWLIN_VRT);

   4945   1 0000BD  BB80 0000 0000  02                   LAB,B3   0
          1 0000C0  CBF0 0100                            LAB,B4   256,IMO
          1 0000C2  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0000C5       0001                            DC       s:4945+9,PREL
          1 0000C6  0F81 0DF2                            B        s:5947,PREL

      342     4946        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:142  
      343     4947    4            CASE (%KV_INPOPR_TYP_FLWON);

      344     4948        /* This is the follow-on INPOPR. An input operator index is being
      345     4949           passed. We're to process that INPOPR when we get the next character that
      346     4950           isn't completely processed by the SPCESC mechanism in the translate table. */
      347     4951
      348     4952    4               KV$PTR.INPCNDPND.INPOPR = '1'B;

   4952   1 0000C8  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0000CB  8943 001B                            LBT,'4000'X       27,B3
          1 0000CD       4000

      349     4953    4               KV$PTR.INPCNDPND.OPRX = 1-KV$INPOPR.INPOPRX+

   4953   1 0000CE  ACC7 0004                            LDB,B2   @VDH_PARM,AUTO
          1 0000D0  8CC7 0006                            LDI      INPOPR$,AUTO
          1 0000D2  84C2 0001                            SID      1,B2
          1 0000D4  8D47 003A                            SDI      R+2,AUTO
          1 0000D6  F804                                 LDR,R7   ,B4
          1 0000D7  F570 00FF                            AND,R7   255,IMO
          1 0000D9  6C00                                 LDV,R6   0
          1 0000DA  84C7 003A                            SID      R+2,AUTO
          1 0000DC  8656                                 CPL      R6
          1 0000DD  8657                                 CPL      R7
          1 0000DE  8470 0000 0002                       AID      2,IMO
          1 0000E1  E857                                 LDR,R6   R7
          1 0000E2  EF43 001C                            STR,R6   28,B3
          1 0000E4  0F81 0DD4                            B        s:5947,PREL

      350     4954    4                 POFFW (INPOPR$, VDH_INTINPOPR.INPFNCTBL$);
      351     4955        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:143  
      352     4956    4            CASE (%KV_INPOPR_TYP_JMP);

      353     4957        /* This is the jump input operator. Process the specified INPOPR next.        */
      354     4958
      355     4959        /* This operator is performed below where CHN is checked. */
      356     4960        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:144  
      357     4961    4            CASE (%KV_INPOPR_TYP_PST);

      358     4962        /* This is a PST (position) request.                                          */
      359     4963
      360     4964    4               CALL KVO$PST (KV$INPOPR_PST.VDH_PST);

   4964   1 0000E6  BBC4 0001                            LAB,B3   1,B4
          1 0000E8  BFC7 003A                            STB,B3   R+2,AUTO
          1 0000EA  BBC7 003A                            LAB,B3   R+2,AUTO
          1 0000EC  CBF0 0100                            LAB,B4   256,IMO
          1 0000EE  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0000F1       0001                            DC       s:4964+12,PREL
          1 0000F2  0F81 0DC6                            B        s:5947,PREL

      361     4965        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:145  
      362     4966    4            CASE (%KV_INPOPR_TYP_RSTPRM, %KV_INPOPR_TYP_SETPRM,

      363     4967    4                 %KV_INPOPR_TYP_TGLPRM);
      364     4968        /* This is a change parameter request INPOPR (RSTPRM, SETPRM, or TGLPRM).     */
      365     4969
      366     4970    4               %VDH_GETPRM = KV_VDH_GETPRM;

   4970   1 0000F4  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_GETPRM
          1 0000F7  2C00                                 LDV,R2   0
          1 0000F8  6C14                                 LDV,R6   20
          1 0000F9  BB87                                 LAB,B3   ,AUTO
          1 0000FA  3C2C                                 LDV,R3   44
          1 0000FB  0008                                 MMM

      367     4971    4               %VDH_GETPRM.PRMID = KV$INPOPR.PRMID;

   4971   1 0000FC  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 0000FE  E806                                 LDR,R6   ,B6
          1 0000FF  E570 00FF                            AND,R6   255,IMO
          1 000101  EF47 0017                            STR,R6   FPT+1,AUTO

      368     4972    5               IF %VDH_GETPRM.PRMID=0 THEN DO;

   4972   1 000103  6981 0019                            BNEZ,R6  s:4978,PREL

      369     4973    5                  IF OPRCNTU<=             /* disallow negative indexes, too     */

   4973   1 000105  DCC7 0004                            LDB,B5   @VDH_PARM,AUTO
          1 000107  CCC5 0001                            LDB,B4   1,B5
          1 000109  B2C4 001B                            LLH,R3   27,B4
          1 00010B  D847 0013                            LDR,R5   OPRCNT,AUTO
          1 00010D  5801 000D                            BLZ,R5   s:4976,PREL
          1 00010F  D930 0000 0059  00                   CMR,R5   Y_MAXPRMX,R3
          1 000112  0A01 0008                            BAG      s:4976,PREL

      370     4974    5                    Y_MAXPRMX(VDH_INTINPOPR.INPFNCTBL$->KV$INPFNCTBL.SBSLVL)
      371     4975    5                  THEN %VDH_GETPRM.PRMID = KV_INPFNC_PRMIDS(OPRCNT);
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:146  

   4975   1 000114  A847 0013                            LDR,R2   OPRCNT,AUTO
          1 000116  E2A0 0000 0000  00                   LLH,R6   KV_INPFNC_PRMIDS,R2
          1 000119  EF47 0017                            STR,R6   FPT+1,AUTO

      372     4976    5                  OPRCNT = 0; /* WRDWRPCLM & AUTTABCLM need SET to use EDTLOWX   */

   4976   1 00011B  8747 0013                            CL       OPRCNT,AUTO

      373     4977    5               END;

      374     4978    4               IF %VDH_GETPRM.PRMID=0 THEN EXIT;

   4978   1 00011D  6901 0D88                            BEZ,R6   s:5936,PREL

      375     4979    4               IF %VDH_GETPRM.PRMID=%KV_PRMID_EASYAPPEND

   4979   1 00011F  E970 00B1                            CMR,R6   177,IMO
          1 000121  0901 0009                            BE       s:4982,PREL
          1 000123  E970 00B0                            CMR,R6   176,IMO
          1 000125  0901 0005                            BE       s:4982,PREL
          1 000127  E970 00BB                            CMR,R6   187,IMO
          1 000129  0981 000B                            BNE      s:4983,PREL

      376     4980    4                 OR %VDH_GETPRM.PRMID=%KV_PRMID_TEXTEDIT
      377     4981    4                 OR %VDH_GETPRM.PRMID=%KV_PRMID_ONESPCEDT
      378     4982    4               THEN IF %KV_MVD.ORG~=%KV#VD_ORG_SE THEN EXIT;

   4982   1 00012B  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00012E  CCC5 0006                            LDB,B4   6,B5
          1 000130  D2C4 0015                            LLH,R5   21,B4
          1 000132  5D05                                 CMV,R5   5
          1 000133  0981 0D72                            BNE      s:5936,PREL

      379     4983    4               IF %KV_SSN.REDRQSPND

   4983   1 000135  DCC7 000A                            LDB,B5   SSN$,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:147  
          1 000137  82C5 0028                            LB,'0002'X        40,B5
          1 000139       0002
          1 00013A  0581 0004                            BBF      s:4985,PREL
          1 00013C  6D46                                 CMV,R6   70
          1 00013D  0901 0D68                            BE       s:5936,PREL

      380     4984    4                 AND %VDH_SETPRM.PRMID=%KV_PRMID_OUTPUTDISCARD THEN EXIT;
      381     4985    4               %KV_SSN.LSTPRMID = %VDH_SETPRM.PRMID;

   4985   1 00013F  E7C5 003B                            STH,R6   59,B5

      382     4986    5               IF KV$INPOPR.TYP=%KV_INPOPR_TYP_TGLPRM THEN DO;

   4986   1 000141  D806                                 LDR,R5   ,B6
          1 000142  5048                                 SOR,R5   8
          1 000143  D570 000F                            AND,R5   15,IMO
          1 000145  5D08                                 CMV,R5   8
          1 000146  0981 0021                            BNE      s:4994,PREL

      383     4987        /* Get the current value of the parameter to be toggled. */
      384     4988
      385     4989    5                  CALL KVP$GETPRM (FPT);

   4989   1 000148  CBC7 0016                            LAB,B4   FPT,AUTO
          1 00014A  CFC7 003A                            STB,B4   R+2,AUTO
          1 00014C  BBC7 003A                            LAB,B3   R+2,AUTO
          1 00014E  CBF0 0100                            LAB,B4   256,IMO
          1 000150  E380 0000 0000  xent                 LNJ,B6   KVP$GETPRM
          1 000153       0001                            DC       s:4990,PREL

      386     4990    5                  IF %VDH_SETPRM.VAL~=0 THEN %VDH_GETPRM.VAL = 65535;

   4990   1 000154  E847 0018                            LDR,R6   FPT+2,AUTO
          1 000156  6901 0004                            BEZ,R6   s:4991,PREL

   4990   1 000158  8947 0018                            LBT,'FFFF'X       FPT+2,AUTO
   4990   1 00015A       FFFF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:148  

      387     4991    5                  %VDH_SETPRM.VAL = %VDH_GETPRM.VAL+1;

   4991   1 00015B  8AC7 0018                            INC      FPT+2,AUTO

      388     4992    5                  IF KV$INPOPR.ACK THEN CALL Y$ECHINPOPR;

   4992   1 00015D  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 00015F  8286                                 LB,'1000'X        ,B6
          1 000160       1000
          1 000161  0581 003D                            BBF      s:5006,PREL

   4992   1 000163  E3C0 0EC3                            LNJ,B6   s:0,PREL
          1 000165       0001                            DC       s:4993,PREL

      389     4993    5               END /* IF */;

   4993   1 000166  0F81 0038                            B        s:5006,PREL

      390     4994    5               ELSE IF KV$INPOPR.TYP=%KV_INPOPR_TYP_SETPRM THEN DO;

   4994   1 000168  5D07                                 CMV,R5   7
          1 000169  0981 0035                            BNE      s:5006,PREL

      391     4995    5                  IF OPRCNT<0 THEN OPRCNT = 0;

   4995   1 00016B  C847 0013                            LDR,R4   OPRCNT,AUTO
          1 00016D  4881 0003                            BGEZ,R4  s:4996,PREL

   4995   1 00016F  8747 0013                            CL       OPRCNT,AUTO

      392     4996    5                  IF %VDH_SETPRM.PRMID=%KV_PRMID_AUTTABCLM

   4996   1 000171  E970 0099                            CMR,R6   153,IMO
          1 000173  0901 000D                            BE       s:5000,PREL
          1 000175  E970 009C                            CMR,R6   156,IMO
          1 000177  0901 0009                            BE       s:5000,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:149  
          1 000179  E970 009E                            CMR,R6   158,IMO
          1 00017B  0901 0005                            BE       s:5000,PREL
          1 00017D  E970 009F                            CMR,R6   159,IMO
          1 00017F  0981 0010                            BNE      s:5002,PREL

      393     4997    5                    OR %VDH_SETPRM.PRMID=%KV_PRMID_WRDWRPCLM
      394     4998    5                    OR %VDH_SETPRM.PRMID=%KV_PRMID_HRZSCRMRG
      395     4999    5                    OR %VDH_SETPRM.PRMID=%KV_PRMID_HRZSCRSHF
      396     5000    5                  THEN IF OPRCNT>0 THEN %VDH_SETPRM.VAL = OPRCNT;

   5000   1 000181  C847 0013                            LDR,R4   OPRCNT,AUTO
          1 000183  4A81 0005                            BLEZ,R4  s:5001,PREL

   5000   1 000185  CF47 0018                            STR,R4   FPT+2,AUTO
          1 000187  0F81 000B                            B        s:5003,PREL

      397     5001    5                  ELSE %VDH_SETPRM.VAL = %KV_SSN.REDBFR.EDTLOWX+1;

   5001   1 000189  B845 002B                            LDR,R3   43,B5
          1 00018B  3E01                                 ADV,R3   1
          1 00018C  BF47 0018                            STR,R3   FPT+2,AUTO
          1 00018E  0F81 0004                            B        s:5003,PREL

      398     5002    5                  ELSE %VDH_SETPRM.VAL = 1;

   5002   1 000190  4C01                                 LDV,R4   1
          1 000191  CF47 0018                            STR,R4   FPT+2,AUTO

      399     5003    5                  IF %VDH_SETPRM.PRMID=%KV_PRMID_WRDWRPCLM

   5003   1 000193  E970 009C                            CMR,R6   156,IMO
          1 000195  0981 0009                            BNE      s:5006,PREL

      400     5004    5                  THEN %KV_STR.WRDWRP = '1'B;

   5004   1 000197  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 00019A  ACC4 0004                            LDB,B2   4,B4
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:150  
          1 00019C  8942 001E                            LBT,'0040'X       30,B2
          1 00019E       0040

      401     5005    5               END /* IF */;

      402     5006    4               %VDH_SETPRM.SCP = %KV_SCP_ONE_ONLY;

   5006   1 00019F  6C08                                 LDV,R6   8
          1 0001A0  E7C7 001D                            STH,R6   FPT+7,AUTO

      403     5007    4               CALL KVP$SETPRM (FPT);

   5007   1 0001A2  EBC7 0016                            LAB,B6   FPT,AUTO
          1 0001A4  EFC7 003A                            STB,B6   R+2,AUTO
          1 0001A6  BBC7 003A                            LAB,B3   R+2,AUTO
          1 0001A8  CBF0 0100                            LAB,B4   256,IMO
          1 0001AA  E380 0000 0000  xent                 LNJ,B6   KVP$SETPRM
          1 0001AD       0001                            DC       s:5008,PREL

      404     5008    4               IF %VDH_SETPRM.PRMID=%KV_PRMID_DISPINPUT

   5008   1 0001AE  E847 0017                            LDR,R6   FPT+1,AUTO
          1 0001B0  6D44                                 CMV,R6   68
          1 0001B1  0981 0D07                            BNE      s:5947,PREL

      405     5009    4               THEN IF %KV_VDI.USRRQSDAT.RED

   5009   1 0001B3  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0001B6  DC86                                 LDB,B5   ,B6
          1 0001B7  82C5 001D                            LB,'0010'X        29,B5
          1 0001B9       0010
          1 0001BA  0581 0CFE                            BBF      s:5947,PREL
          1 0001BC  D845 001D                            LDR,R5   29,B5
          1 0001BE  5045                                 SOR,R5   5
          1 0001BF  D570 0003                            AND,R5   3,IMO
          1 0001C1  5D03                                 CMV,R5   3
          1 0001C2  0981 0CF6                            BNE      s:5947,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:151  

      406     5010    4                 AND %KV_VDI.INPUNT=%KV_INPUNT_BLK
      407     5011    4               THEN CALL KVI$ADJINPFLDBGNATR;

   5011   1 0001C4  CBF0 0000                            LAB,B4   0,IMO
          1 0001C6  E380 0000 0000  xent                 LNJ,B6   KVI$ADJINPFLDBGNATR
          1 0001C9       0001                            DC       s:5011+6,PREL
          1 0001CA  0F81 0CEE                            B        s:5947,PREL

      408     5012        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:152  
      409     5013    4            CASE (%KV_INPOPR_TYP_TXT);

      410     5014        /* This is the text INPOPR. Put the text in read buffers,
      411     5015           type-ahead buffers, or write the text to the terminal.                     */
      412     5016
      413     5017        /* Buffer and/or write the text.                                              */
      414     5018
      415     5019    5               IF KV$INPOPR_TXT.L>0 THEN DO;

   5019   1 0001CC  E2C4 0001                            LLH,R6   1,B4
          1 0001CE  6901 0CEA                            BEZ,R6   s:5947,PREL

      416     5020
      417     5021    5                  R5 = 0;

   5021   1 0001D0  8747 0010                            CL       R5,AUTO

      418     5022    5                  %KV_SSN.INPECH = KV$INPOPR_TXT.ECH;

   5022   1 0001D2  E804                                 LDR,R6   ,B4
          1 0001D3  6047                                 SOR,R6   7
          1 0001D4  EAC6 0028                            SRM,R6,'0001'X    40,B6
          1 0001D6       0001

      419     5023    6                  DO CASE (KV$INPOPR_TXT.DSP);

   5023   1 0001D7  B804                                 LDR,R3   ,B4
          1 0001D8  B570 0003                            AND,R3   3,IMO
          1 0001DA  3D04                                 CMV,R3   4
          1 0001DB  0281 0CDD                            BGE      s:5947,PREL
          1 0001DD  A830 0000 01E3  01                   LDR,R2   s:5023+12,R3
          1 0001E0  83A0 0000 01E7  01                   JMP      s:5029,R2
          1 0001E3       0000                            DC       s:5029,PREL
          1 0001E4       003C                            DC       s:5042,PREL
          1 0001E5       0062                            DC       s:5051,PREL
          1 0001E6       0069                            DC       s:5056,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:153  
      420     5024        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:154  
      421     5025    6                  CASE (%KV_INPOPR_TXT_DSP_INPFNC);

      422     5026        /* We are to pass the character thru the system input function
      423     5027           table. That may result in the character being buffered/echoed.             */
      424     5028
      425     5029    7                     DO WHILE R5<KV$INPOPR_TXT.L;

   5029   1 0001E7  E2C4 0001                            LLH,R6   1,B4
          1 0001E9  E947 0010                            CMR,R6   R5,AUTO
          1 0001EB  0A81 0CCD                            BALE     s:5947,PREL

      426     5030    7                        %KV_SSN.INPCHR = SUBSTR (KV$INPOPR_TXT.T,R5,1);

   5030   1 0001ED  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 0001EF  E2C6 0001                            LLH,R6   1,B6
          1 0001F1  B847 0010                            LDR,R3   R5,AUTO
          1 0001F3  3E03                                 ADV,R3   3
          1 0001F4  D0B6                                 LDH,R5   ,B6,R3
          1 0001F5  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0001F7  D7C5 0029                            STH,R5   41,B5

      427     5031
      428     5032    7                        IF VDH_INTINPOPR.IMD THEN CALL KVI$INPCHR_INPFNCIMD;

   5032   1 0001F9  CCC7 0004                            LDB,B4   @VDH_PARM,AUTO
          1 0001FB  8284                                 LB,'0080'X        ,B4
          1 0001FC       0080
          1 0001FD  0581 0009                            BBF      s:5033,PREL

   5032   1 0001FF  CBF0 0000                            LAB,B4   0,IMO
          1 000201  E380 0000 0000  xent                 LNJ,B6   KVI$INPCHR_INPFNCIMD
          1 000204       0001                            DC       s:5032+12,PREL
          1 000205  0F81 0007                            B        s:5034,PREL

      429     5033    7                        ELSE CALL KVI$INPCHR_INPFNC;

   5033   1 000207  CBF0 0000                            LAB,B4   0,IMO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:155  
          1 000209  E380 0000 0000  xent                 LNJ,B6   KVI$INPCHR_INPFNC
          1 00020C       0001                            DC       s:5034,PREL

      430     5034    7                        SSN$ = KV$PTR.SSN$;

   5034   1 00020D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000210  DCC6 0002                            LDB,B5   2,B6
          1 000212  DFC7 000A                            STB,B5   SSN$,AUTO

      431     5035    7                        REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   5035   1 000214  CCC5 0030                            LDB,B4   48,B5
          1 000216  CFC7 0008                            STB,B4   REDBFR$,AUTO

      432     5036    7                        R5 = R5+1;

   5036   1 000218  8AC7 0010                            INC      R5,AUTO

      433     5037    7                     END /* LOOP */;

   5037   1 00021A  BCC7 0006                            LDB,B3   INPOPR$,AUTO
          1 00021C  E2C3 0001                            LLH,R6   1,B3
          1 00021E  E947 0010                            CMR,R6   R5,AUTO
          1 000220  0A4D                                 BAG      s:5030,SPREL
          1 000221  0F81 0C97                            B        s:5947,PREL

      434     5038        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:156  
      435     5039    6                  CASE (%KV_INPOPR_TXT_DSP_REDBFR);

      436     5040        /* We are to buffer the chr in the read buffer.                               */
      437     5041
      438     5042    7                     DO WHILE R5<KV$INPOPR_TXT.L AND %KV_SSN.REDRQSPND;

   5042   1 000223  0F81 0015                            B        s:5046,PREL

      439     5043    7                        %KV_SSN.INPCHR = SUBSTR (KV$INPOPR_TXT.T,R5,1);

   5043   1 000225  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 000227  E2C6 0001                            LLH,R6   1,B6
          1 000229  B847 0010                            LDR,R3   R5,AUTO
          1 00022B  3E03                                 ADV,R3   3
          1 00022C  D0B6                                 LDH,R5   ,B6,R3
          1 00022D  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 00022F  D7C5 0029                            STH,R5   41,B5

      440     5044    7                        CALL KVI$BFRREDCHR;

   5044   1 000231  CBF0 0000                            LAB,B4   0,IMO
          1 000233  E380 0000 0000  xent                 LNJ,B6   KVI$BFRREDCHR
          1 000236       0001                            DC       s:5045,PREL

      441     5045    7                        R5 = R5+1;

   5045   1 000237  8AC7 0010                            INC      R5,AUTO

      442     5046    7                     END /* LOOP */;

   5046   1 000239  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 00023B  E2C6 0001                            LLH,R6   1,B6
          1 00023D  E947 0010                            CMR,R6   R5,AUTO
          1 00023F  0A81 0007                            BALE     s:5046+14,PREL
          1 000241  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 000243  82C5 0028                            LB,'0002'X        40,B5
          1 000245       0002
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:157  
          1 000246  055F                                 BBT      s:5043,SPREL
          1 000247  0F81 0C71                            B        s:5947,PREL

      443     5047        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:158  
      444     5048    6                  CASE (%KV_INPOPR_TXT_DSP_TYPAHDBFR);

      445     5049        /* We are to buffer the chr in the type-ahead buffers.                        */
      446     5050
      447     5051    6                     CALL Y$TYPAHDTXT (KV$INPOPR);

   5051   1 000249  CFC7 0028                            STB,B4   FPT+18,AUTO
          1 00024B  E3C0 1B07                            LNJ,B6   s:0,PREL
          1 00024D       0001                            DC       s:5051+5,PREL
          1 00024E  0F81 0C6A                            B        s:5947,PREL

      448     5052        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:159  
      449     5053    6                  CASE (%KV_INPOPR_TXT_DSP_WRT);

      450     5054        /* We are to write the character on the terminal.                             */
      451     5055
      452     5056    6                     IF %KV_VDI.INPUNT=%KV_INPUNT_BLK AND %KV_VDI.USRRQSDAT.RED

   5056   1 000250  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 000253  AC83                                 LDB,B2   ,B3
          1 000254  E842 001D                            LDR,R6   29,B2
          1 000256  6045                                 SOR,R6   5
          1 000257  E570 0003                            AND,R6   3,IMO
          1 000259  6D03                                 CMV,R6   3
          1 00025A  0981 000E                            BNE      s:5062,PREL
          1 00025C  82C2 001D                            LB,'0010'X        29,B2
          1 00025E       0010
          1 00025F  0581 0009                            BBF      s:5062,PREL

      453     5057        /* This is a block-mode device with a read outstanding. Position
      454     5058           to just beyond the hi non-blank position before outputting
      455     5059           the text.                                                                  */
      456     5060
      457     5061    6                     THEN CALL KVO$PSTAFTHI_NONBLNPHSPST;

   5061   1 000261  CBF0 0000                            LAB,B4   0,IMO
          1 000263  E380 0000 0000  xent                 LNJ,B6   KVO$PSTAFTHI_NONBLNPHSPST
          1 000266       0001                            DC       s:5061+6,PREL
          1 000267  0F81 0009                            B        s:5069,PREL

      458     5062    6                     ELSE IF %KV_VDI.RE_DSPINP

   5062   1 000269  82C2 0019                            LB,'0010'X        25,B2
   5062   1 00026B       0010
          1 00026C  0581 0004                            BBF      s:5069,PREL

      459     5063        /* The displayed input needs to be caught up. */
      460     5064
      461     5065    6                     THEN CALL Y$RE_DSPINP;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:160  

   5065   1 00026E  E3C0 1438                            LNJ,B6   s:0,PREL
          1 000270       0001                            DC       s:5069,PREL

      462     5066
      463     5067        /* Send the chars                                                             */
      464     5068
      465     5069    6                     %VDH_OTPLCL = VDH_OTPLCL_WRT;

   5069   1 000271  AB80 0000 00E3  00                   LAB,B2   VDH_OTPLCL_WRT
          1 000274  2C00                                 LDV,R2   0
          1 000275  6C0A                                 LDV,R6   10
          1 000276  BB87                                 LAB,B3   ,AUTO
          1 000277  3C2C                                 LDV,R3   44
          1 000278  0008                                 MMM

      466     5070    6                     %VDH_OTPLCL.BFR_.ADR$ = INPOPR$;

   5070   1 000279  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 00027B  EFC7 0017                            STB,B6   FPT+1,AUTO

      467     5071    6                     %VDH_OTPLCL.BFR_.BYTSIZ = KV$INPOPR_TXT.L;

   5071   1 00027D  E2C6 0001                            LLH,R6   1,B6
          1 00027F  EF47 001A                            STR,R6   FPT+4,AUTO

      468     5072    6                     %VDH_OTPLCL.TRN = KV$INPOPR_TXT.TRN;

   5072   1 000281  D806                                 LDR,R5   ,B6
          1 000282  DAC7 0016                            SRM,R5,'0040'X    FPT,AUTO
          1 000284       0040

      469     5073    6                     IF NOT KV$INPOPR_TXT.VRT THEN %VDH_OTPLCL.NONVRT = '1'B;

   5073   1 000285  8286                                 LB,'0020'X        ,B6
   5073   1 000286       0020
          1 000287  0501 0004                            BBT      s:5074,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:161  

   5073   1 000289  8947 0016                            LBT,'0080'X       FPT,AUTO
   5073   1 00028B       0080

      470     5074    6                     CALL KVO$OTPLCL (FPT) ;

   5074   1 00028C  DBC7 0016                            LAB,B5   FPT,AUTO
          1 00028E  DFC7 003A                            STB,B5   R+2,AUTO
          1 000290  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000292  CBF0 0100                            LAB,B4   256,IMO
          1 000294  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 000297       0001                            DC       s:5075,PREL

      471     5075    6                     IF %KV_VDI.INPUNT=%KV_INPUNT_BLK AND %KV_VDI.USRRQSDAT.RED

   5075   1 000298  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00029B  DC86                                 LDB,B5   ,B6
          1 00029C  E845 001D                            LDR,R6   29,B5
          1 00029E  6045                                 SOR,R6   5
          1 00029F  E570 0003                            AND,R6   3,IMO
          1 0002A1  6D03                                 CMV,R6   3
          1 0002A2  0981 0C16                            BNE      s:5947,PREL
          1 0002A4  82C5 001D                            LB,'0010'X        29,B5
          1 0002A6       0010
          1 0002A7  0581 0C11                            BBF      s:5947,PREL

      472     5076        /* This is a block-mode device with a read outstanding. Position
      473     5077           back to where we started.                                                  */
      474     5078
      475     5079    6                     THEN CALL KVO$PST(KV_VDH_PST_VRT);

   5079   1 0002A9  BB80 0000 0002  02                   LAB,B3   +2
          1 0002AC  CBF0 0100                            LAB,B4   256,IMO
          1 0002AE  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0002B1       0001                            DC       s:5081,PREL

      476     5080    6                  END /* CASE */;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:162  

      477     5081    5               END /* IF */;

   5081   1 0002B2  0F81 0C06                            B        s:5947,PREL

      478     5082        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:163  
      479     5083    4            CASE (%KV_INPOPR_TYP_MSC);

      480     5084        /* This is the miscellaneous input operator.                                  */
      481     5085
      482     5086    4               %KV_VDI.PRG = '0'B;

   5086   1 0002B4  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0002B7  AC83                                 LDB,B2   ,B3
          1 0002B8  8842 0018                            LBF,'0700'X       24,B2
          1 0002BA       0700

      483     5087    5               IF KV$INPOPR_MSC.DLTOTP THEN DO;

   5087   1 0002BB  8284                                 LB,'0020'X        ,B4
   5087   1 0002BC       0020
          1 0002BD  0581 0013                            BBF      s:5097,PREL

      484     5088        /* We are to delete q'd output, and data in the
      485     5089           our receive path (typically from a user program to us).        */
      486     5090
      487     5091    5                  CALL KVM$SND (KV_SND_RQSMRK_DLTRCVDAT);

   5091   1 0002BF  BB80 0000 0004  02                   LAB,B3   +4
          1 0002C2  CBF0 0100                            LAB,B4   256,IMO
          1 0002C4  E380 0000 0000  xent                 LNJ,B6   KVM$SND
          1 0002C7       0001                            DC       s:5093,PREL

      488     5092
      489     5093    5                  CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_DLTOTP);

   5093   1 0002C8  BB80 0000 0007  02                   LAB,B3   +7
          1 0002CB  CBF0 0100                            LAB,B4   256,IMO
          1 0002CD  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_EVT
          1 0002D0       0001                            DC       s:5097,PREL

      490     5094    5               END /* IF */;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:164  
      491     5095
      492     5096        /* Now do the ACKnowlegement, since otherwise it would never be seen.  */
      493     5097    4               IF KV$INPOPR.ACK THEN CALL Y$ECHINPOPR;

   5097   1 0002D1  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 0002D3  8286                                 LB,'1000'X        ,B6
          1 0002D4       1000
          1 0002D5  0581 0004                            BBF      s:5098,PREL

   5097   1 0002D7  E3C0 0D4F                            LNJ,B6   s:0,PREL
          1 0002D9       0001                            DC       s:5098,PREL

      494     5098    4               IF KV$INPOPR_MSC.DLTINP

   5098   1 0002DA  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 0002DC  8286                                 LB,'0080'X        ,B6
          1 0002DD       0080
          1 0002DE  0581 0004                            BBF      s:5102,PREL

      495     5099        /* We are to delete typed-ahead input.                                        */
      496     5100
      497     5101    4               THEN CALL Y$PRGTYPAHD;

   5101   1 0002E0  E3C0 10ED                            LNJ,B6   s:0,PREL
          1 0002E2       0001                            DC       s:5102,PREL

      498     5102    4               IF KV$INPOPR_MSC.ABRRED

   5102   1 0002E3  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 0002E5  8286                                 LB,'0010'X        ,B6
          1 0002E6       0010
          1 0002E7  0581 0004                            BBF      s:5107,PREL

      499     5103        /* We are to abort the read, if any. No read response message
      500     5104           will be sent to the other end.                                             */
      501     5105
      502     5106    4               THEN CALL Y$ABRRED;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:165  

   5106   1 0002E9  E3C0 0C1B                            LNJ,B6   s:0,PREL
          1 0002EB       0001                            DC       s:5107,PREL

      503     5107    4               IF KV$INPOPR_MSC.DLTRED

   5107   1 0002EC  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 0002EE  8286                                 LB,'0040'X        ,B6
          1 0002EF       0040
          1 0002F0  0581 0004                            BBF      s:5114,PREL

      504     5108        /* We are to delete the current read message.                                 */
      505     5109
      506     5110    4               THEN CALL Y$PRGRED;

   5110   1 0002F2  E3C0 1075                            LNJ,B6   s:0,PREL
          1 0002F4       0001                            DC       s:5114,PREL

      507     5111
      508     5112        /* Send out the underscore and position if we purged anything.                */
      509     5113
      510     5114    5               IF %KV_VDI.PRG THEN DO;

   5114   1 0002F5  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0002F8  DC86                                 LDB,B5   ,B6
          1 0002F9  82C5 0018                            LB,'0700'X        24,B5
          1 0002FB       0700
          1 0002FC  0581 0094                            BBF      s:5150,PREL

      511     5115    5                  IF NOT %KV_VDI.PHSDSC

   5115   1 0002FE  82C5 0019                            LB,'0040'X        25,B5
   5115   1 000300       0040
          1 000301  0501 0029                            BBT      s:5128,PREL

      512     5116    5                  THEN IF %KV_VDI.INPUNT=%KV_INPUNT_BLK

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:166  
   5116   1 000303  E845 001D                            LDR,R6   29,B5
          1 000305  6045                                 SOR,R6   5
          1 000306  E570 0003                            AND,R6   3,IMO
          1 000308  6D03                                 CMV,R6   3
          1 000309  0901 0008                            BE       s:5124,PREL
          1 00030B  CCC6 0006                            LDB,B4   6,B6
          1 00030D  D2C4 0015                            LLH,R5   21,B4
          1 00030F  5D01                                 CMV,R5   1
          1 000310  0901 0011                            BE       s:5127,PREL

      513     5117        /* This is a block-mode device with a read outstanding.
      514     5118           Send a bell so we don't clobber the input field.                           */
      515     5119
      516     5120    5                    OR %KV_MVD.ORG~=%KV#VD_ORG_UR
      517     5121        /* Or it's non-serial, so the underscore would get erased anyway */
      518     5122
      519     5123    6                  THEN DO;

      520     5124    6                     IF %KV_VDI.PRG.RED THEN EXIT; /* No beep with an erase      */

   5124   1 000312  82C5 0018                            LB,'0200'X        24,B5
   5124   1 000314       0200
          1 000315  0501 000A                            BBT      s:5126,PREL

      521     5125    6                     CALL KVO$OTP1_NONVRT (%ASCIIBEL);

   5125   1 000317  BB80 0000 000A  02                   LAB,B3   +10
          1 00031A  CBF0 0100                            LAB,B4   256,IMO
          1 00031C  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 00031F       0001                            DC       s:5126,PREL

      522     5126    6                  END;

   5126   1 000320  0F81 000A                            B        s:5128,PREL

      523     5127    5                  ELSE CALL KVO$OTP1_NONVRT (%ASCIIUNDSCR);

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:167  
   5127   1 000322  BB80 0000 000D  02                   LAB,B3   +13
          1 000325  CBF0 0100                            LAB,B4   256,IMO
          1 000327  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 00032A       0001                            DC       s:5128,PREL

      524     5128    5                  IF %KV_VDI.PRG.OTP

   5128   1 00032B  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00032E  DC86                                 LDB,B5   ,B6
          1 00032F  82C5 0018                            LB,'0400'X        24,B5
          1 000331       0400
          1 000332  0581 005E                            BBF      s:5150,PREL

      525     5129        /* Purged output, fix up lost position                                        */
      526     5130
      527     5131    5                  THEN IF NOT %KV_SRD.SCROLL AND %KV_MRD.PHSFRM

   5131   1 000334  CCC6 000A                            LDB,B4   10,B6
          1 000336  82C4 000E                            LB,'0008'X        14,B4
          1 000338       0008
          1 000339  0501 0023                            BBT      s:5137,PREL
          1 00033B  BCC6 0008                            LDB,B3   8,B6
          1 00033D  82C3 0018                            LB,'0400'X        24,B3
          1 00033F       0400
          1 000340  0581 001C                            BBF      s:5137,PREL
          1 000342  82C3 0016                            LB,'0002'X        22,B3
          1 000344       0002
          1 000345  0501 0006                            BBT      s:5133,PREL
          1 000347  82C3 0017                            LB,'0001'X        23,B3
          1 000349       0001
          1 00034A  0581 0012                            BBF      s:5137,PREL

      528     5132    6                    AND (%KV_MRD.BLANKERASES OR %KV_MRD.FSTERS) THEN DO;

      529     5133    6                     %KV_SRD.UNKPST = '0'B;

   5133   1 00034C  8844 001C                            LBF,'4000'X       28,B4
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:168  
   5133   1 00034E       4000

      530     5134    6                     %KV_SRD.HI_NONBLN = %KV_SRD.SRDEND;

   5134   1 00034F  DCC6 000A                            LDB,B5   10,B6
          1 000351  8CC5 001A                            LDI      26,B5
          1 000353  8D45 0017                            SDI      23,B5

      531     5135    6                     CALL KVO$SCRENDNO_HLT;

   5135   1 000355  CBF0 0000                            LAB,B4   0,IMO
          1 000357  E380 0000 0000  xent                 LNJ,B6   KVO$SCRENDNO_HLT
          1 00035A       0001                            DC       s:5136,PREL

      532     5136    6                  END; ELSE DO;

   5136   1 00035B  0F81 0035                            B        s:5150,PREL

      533     5137    6                     %KV_SRD.UNKPST = '0'B;

   5137   1 00035D  8844 001C                            LBF,'4000'X       28,B4
   5137   1 00035F       4000

      534     5138    7                     IF %KV_SRD.RELPAGE AND %KV_SRD.SCROLL THEN DO;

   5138   1 000360  DCC6 000A                            LDB,B5   10,B6
          1 000362  82C5 000E                            LB,'0040'X        14,B5
          1 000364       0040
          1 000365  0581 0022                            BBF      s:5147,PREL
          1 000367  82C5 000E                            LB,'0008'X        14,B5
          1 000369       0008
          1 00036A  0581 001D                            BBF      s:5147,PREL

      535     5139        /* Make this the top of the page                                              */
      536     5140
      537     5141    7                        %KV_SRD.CRT.LIN = %KV_SRD.TOPLFT.LIN;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:169  
   5141   1 00036C  E845 0009                            LDR,R6   9,B5
          1 00036E  EF45 0015                            STR,R6   21,B5

      538     5142    7                        %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.TOPLFT.LIN;

   5142   1 000370  DCC6 000A                            LDB,B5   10,B6
          1 000372  E845 0009                            LDR,R6   9,B5
          1 000374  EF45 0013                            STR,R6   19,B5

      539     5143    7                        %KV_SRD.HI_NONBLN.LIN = %KV_SRD.TOPLFT.LIN-1;

   5143   1 000376  DCC6 000A                            LDB,B5   10,B6
          1 000378  E845 0009                            LDR,R6   9,B5
          1 00037A  6EFF                                 ADV,R6   -1
          1 00037B  EF45 0017                            STR,R6   23,B5

      540     5144    7                        %KV_MVD.FRMLIN = 0;

   5144   1 00037D  DCC6 0006                            LDB,B5   6,B6
          1 00037F  87C5 001D                            CLH      29,B5

      541     5145    7                        %KV_SRD.DVCLINBIS = %KV_SRD.LNG-1;

   5145   1 000381  DCC6 000A                            LDB,B5   10,B6
          1 000383  E2C5 000E                            LLH,R6   14,B5
          1 000385  6EFF                                 ADV,R6   -1
          1 000386  EF45 0019                            STR,R6   25,B5

      542     5146    7                     END /* IF */;

      543     5147    6                     CALL KVO$PST(KV_VDH_PST_NEWLIN_VRT);

   5147   1 000388  BB80 0000 0000  02                   LAB,B3   0
          1 00038B  CBF0 0100                            LAB,B4   256,IMO
          1 00038D  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 000390       0001                            DC       s:5150,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:170  
      544     5148    6                  END /* IF */;

      545     5149    5               END /* IF */;

      546     5150    4               IF %KV_VDI.PRG.RED OR %KV_VDI.USRRQSDAT.RED

   5150   1 000391  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000394  DC86                                 LDB,B5   ,B6
          1 000395  82C5 0018                            LB,'0200'X        24,B5
          1 000397       0200
          1 000398  0501 0006                            BBT      s:5154,PREL
          1 00039A  82C5 001D                            LB,'0010'X        29,B5
          1 00039C       0010
          1 00039D  0581 0B1B                            BBF      s:5947,PREL

      547     5151        /* We purged the read, and actually purged some data.
      548     5152           reposition the cursor to just after the end of the prompt.                 */
      549     5153
      550     5154    4               THEN IF %KV_VDI.PRG.OTP

   5154   1 00039F  82C5 0018                            LB,'0400'X        24,B5
   5154   1 0003A1       0400
          1 0003A2  0581 0016                            BBF      s:5161,PREL
          1 0003A4  82C5 001D                            LB,'0010'X        29,B5
          1 0003A6       0010
          1 0003A7  0581 0011                            BBF      s:5161,PREL

      551     5155    5                 AND %KV_VDI.USRRQSDAT.RED THEN DO;

      552     5156        /* We purged output, re-issue the prompt                                      */
      553     5157
      554     5158    5                  CALL KVI$ENBRED;

   5158   1 0003A9  CBF0 0000                            LAB,B4   0,IMO
          1 0003AB  E380 0000 0000  xent                 LNJ,B6   KVI$ENBRED
          1 0003AE       0001                            DC       s:5159,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:171  
      555     5159    5                  CALL Y$SHFTYPREDBFR;

   5159   1 0003AF  EB80 0000 0000                       LAB,B6   0
          1 0003B2  EFC7 0030                            STB,B6   DLT+1,AUTO
          1 0003B4  E3C0 170F                            LNJ,B6   s:0,PREL
          1 0003B6       0001                            DC       s:5160,PREL

      556     5160    5               END;

   5160   1 0003B7  0F81 0B01                            B        s:5947,PREL

      557     5161    4               ELSE IF KV$INPOPR_MSC.ABRRED OR KV$INPOPR_MSC.DLTRED

   5161   1 0003B9  CCC7 0006                            LDB,B4   INPOPR$,AUTO
          1 0003BB  8284                                 LB,'0010'X        ,B4
          1 0003BC       0010
          1 0003BD  0501 0005                            BBT      s:5162,PREL
          1 0003BF  8284                                 LB,'0040'X        ,B4
          1 0003C0       0040
          1 0003C1  0581 0AF7                            BBF      s:5947,PREL

      558     5162    5               THEN IF %KV_VDI.INPUNT~=%KV_INPUNT_BLK OR %KV_VDI.USRRQSDAT THEN DO;

   5162   1 0003C3  E845 001D                            LDR,R6   29,B5
          1 0003C5  6045                                 SOR,R6   5
          1 0003C6  E570 0003                            AND,R6   3,IMO
          1 0003C8  6D03                                 CMV,R6   3
          1 0003C9  0981 0006                            BNE      s:5163,PREL
          1 0003CB  82C5 001D                            LB,'0018'X        29,B5
          1 0003CD       0018
          1 0003CE  0581 0AEA                            BBF      s:5947,PREL

      559     5163    6                  IF %KV_SSN.REDBFR.DSPLOWX~=0 THEN DO;

   5163   1 0003D0  BCC7 000A                            LDB,B3   SSN$,AUTO
          1 0003D2  D843 002F                            LDR,R5   47,B3
          1 0003D4  5901 0017                            BEZ,R5   s:5168,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:172  

      560     5164    6                     %KV_SSN.REDBFR.DSPLOWX = 0;

   5164   1 0003D6  8743 002F                            CL       47,B3

      561     5165    6                     IF %KV_MVD.ORG=%KV#VD_ORG_SE

   5165   1 0003D8  DCC6 0006                            LDB,B5   6,B6
          1 0003DA  E2C5 0015                            LLH,R6   21,B5
          1 0003DC  6D05                                 CMV,R6   5
          1 0003DD  0981 000E                            BNE      s:5168,PREL

      562     5166    6                     THEN IF %KV_RCRLST.HRZSCRALL THEN CALL KVE$SCRALL;

   5166   1 0003DF  ACC6 000E                            LDB,B2   14,B6
          1 0003E1  82C2 000C                            LB,'0001'X        12,B2
          1 0003E3       0001
          1 0003E4  0581 0007                            BBF      s:5168,PREL

   5166   1 0003E6  CBF0 0000                            LAB,B4   0,IMO
          1 0003E8  E380 0000 0000  xent                 LNJ,B6   KVE$SCRALL
          1 0003EB       0001                            DC       s:5168,PREL

      563     5167    6                  END;

      564     5168    5                  CALL Y$RE_PSTRED;

   5168   1 0003EC  E3C0 1349                            LNJ,B6   s:0,PREL
          1 0003EE       0001                            DC       s:5169,PREL

      565     5169    5               END;

   5169   1 0003EF  0F81 0AC9                            B        s:5947,PREL

      566     5170        /*N* if waiting (giveup) for buffer, and don't have any of this               */
      567     5171        /*N* type yet, won't set prg bit... After unreg, won't see                    */
      568     5172        /*N* prg bit... Need another array of bits??                                  */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:173  
      569     5173        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:174  
      570     5174    4            CASE (%KV_INPOPR_TYP_USRINPPRC);

      571     5175        /* This is a USRINPPRC (user input procedure) request.                        */
      572     5176
      573     5177    4               %USR_INPPRC = KV_USR_INPPRC;

   5177   1 0003F1  AB80 0000 0000  xsym                 LAB,B2   KV_USR_INPPRC
          1 0003F4  2C00                                 LDV,R2   0
          1 0003F5  6C06                                 LDV,R6   6
          1 0003F6  BB87                                 LAB,B3   ,AUTO
          1 0003F7  3C2C                                 LDV,R3   44
          1 0003F8  0008                                 MMM

      574     5178    4               %USR_INPPRC.ID = KV$INPOPR.ID;

   5178   1 0003F9  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 0003FB  E806                                 LDR,R6   ,B6
          1 0003FC  E570 00FF                            AND,R6   255,IMO
          1 0003FE  E7C7 0018                            STH,R6   FPT+2,AUTO

      575     5179    4               %USR_INPPRC.ORGCHR = BINASC(VDH_INTINPOPR.ORGCHR);

   5179   1 000400  DCC7 0004                            LDB,B5   @VDH_PARM,AUTO
          1 000402  E845 0003                            LDR,R6   3,B5
          1 000404  6008                                 SOL,R6   8
          1 000405  6068                                 SAR,R6   8
          1 000406  EAC7 0018                            SRM,R6,'00FF'X    FPT+2,AUTO
          1 000408       00FF

      576     5180    4               %USR_INPPRC.CHR = VDH_INTINPOPR.ACKCHR;

   5180   1 000409  E845 0005                            LDR,R6   5,B5
          1 00040B  EF47 0017                            STR,R6   FPT+1,AUTO

      577     5181    4               %USR_INPPRC.IMD = VDH_INTINPOPR.IMD;

   5181   1 00040D  D805                                 LDR,R5   ,B5
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:175  
          1 00040E  DAC7 0016                            SRM,R5,'0080'X    FPT,AUTO
          1 000410       0080

      578     5182    4               %USR_INPPRC.RED = %KV_VDI.USRRQSDAT.RED;

   5182   1 000411  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 000414  AC84                                 LDB,B2   ,B4
          1 000415  D842 001D                            LDR,R5   29,B2
          1 000417  5002                                 SOL,R5   2
          1 000418  DAC7 0016                            SRM,R5,'0040'X    FPT,AUTO
          1 00041A       0040

      579     5183    4               CALL KVV$CALUSR (FPT);

   5183   1 00041B  ABC7 0016                            LAB,B2   FPT,AUTO
          1 00041D  AFC7 003A                            STB,B2   R+2,AUTO
          1 00041F  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000421  CBF0 0100                            LAB,B4   256,IMO
          1 000423  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 000426       0001                            DC       s:5183+12,PREL
          1 000427  0F81 0A91                            B        s:5947,PREL

      580     5184        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:176  
      581     5185    4            CASE (%KV_INPOPR_TYP_VDHINPPRC);

      582     5186        /* This is a VDHINPPRC (input procedure) request. */
      583     5187
      584     5188    5   INPPRC:     DO CASE (KV$INPOPR.ID);

   5188   1 000429  9804                 INPPRC          LDR,R1   ,B4
          1 00042A  9570 00FF                            AND,R1   255,IMO
          1 00042C  1D32                                 CMV,R1   50
          1 00042D  0281 0A57                            BGE      s:5918,PREL
          1 00042F  B810 0000 0435  01                   LDR,R3   INPPRC+12,R1
          1 000432  83B0 0000 0467  01                   JMP      s:5195,R3
          1 000435       0A1E                            DC       s:5918,PREL
          1 000436       0000                            DC       s:5195,PREL
          1 000437       003D                            DC       s:5211,PREL
          1 000438       004D                            DC       s:5224,PREL
          1 000439       0055                            DC       s:5229,PREL
          1 00043A       0048                            DC       s:5216,PREL
          1 00043B       005D                            DC       s:5234,PREL
          1 00043C       01D3                            DC       s:5335,PREL
          1 00043D       0214                            DC       s:5351,PREL
          1 00043E       0A3B                            DC       s:5934,PREL
          1 00043F       02C5                            DC       s:5399,PREL
          1 000440       02E2                            DC       s:5418,PREL
          1 000441       0309                            DC       s:5449,PREL
          1 000442       0337                            DC       s:5480,PREL
          1 000443       0344                            DC       s:5490,PREL
          1 000444       034F                            DC       s:5495,PREL
          1 000445       03A6                            DC       s:5519,PREL
          1 000446       0418                            DC       s:5547,PREL
          1 000447       0418                            DC       s:5547,PREL
          1 000448       04A3                            DC       s:5576,PREL
          1 000449       04B5                            DC       s:5582,PREL
          1 00044A       04D5                            DC       s:5597,PREL
          1 00044B       053B                            DC       s:5621,PREL
          1 00044C       005D                            DC       s:5234,PREL
          1 00044D       0548                            DC       s:5631,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:177  
          1 00044E       0568                            DC       s:5642,PREL
          1 00044F       0576                            DC       s:5647,PREL
          1 000450       06DD                            DC       s:5707,PREL
          1 000451       0778                            DC       s:5740,PREL
          1 000452       07EB                            DC       s:5767,PREL
          1 000453       07ED                            DC       s:5772,PREL
          1 000454       07FB                            DC       s:5781,PREL
          1 000455       0580                            DC       s:5649,PREL
          1 000456       0038                            DC       s:5206,PREL
          1 000457       033C                            DC       s:5485,PREL
          1 000458       09CD                            DC       s:5896,PREL
          1 000459       03B1                            DC       s:5525,PREL
          1 00045A       0A3B                            DC       s:5934,PREL
          1 00045B       0A1E                            DC       s:5918,PREL
          1 00045C       0A1E                            DC       s:5918,PREL
          1 00045D       0A1E                            DC       s:5918,PREL
          1 00045E       0A1E                            DC       s:5918,PREL
          1 00045F       0A1E                            DC       s:5918,PREL
          1 000460       0A1E                            DC       s:5918,PREL
          1 000461       0A1E                            DC       s:5918,PREL
          1 000462       0A1E                            DC       s:5918,PREL
          1 000463       0A1E                            DC       s:5918,PREL
          1 000464       019D                            DC       s:5320,PREL
          1 000465       0555                            DC       s:5635,PREL
          1 000466       06EE                            DC       s:5712,PREL

      585     5189        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:178  
      586     5190    5               CASE (%KV_INPPRC_AT_PRF);

      587     5191        /* This is a request to set the line counters to the values
      588     5192           that indicate we're at the perforation in fan-folded
      589     5193           paper.                                                                     */
      590     5194
      591     5195    5                  IF NOT %KV_MRD.CTNFRM THEN GOTO RE_DSP_FRM;

   5195   1 000467  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 00046A  ACC3 0008                            LDB,B2   8,B3
          1 00046C  82C2 0018                            LB,'0800'X        24,B2
          1 00046E       0800
          1 00046F  0581 0577                            BBF      s:5649,PREL

      592     5196    6                  IF %KV_MVD.LNG>11 THEN DO;

   5196   1 000471  9CC3 0006                            LDB,B1   6,B3
          1 000473  E2C1 0014                            LLH,R6   20,B1
          1 000475  6D0B                                 CMV,R6   11
          1 000476  0381 0A2B                            BLE      s:5934,PREL

      593     5197    6                     %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRTVRTLINPHSLIN+

   5197   1 000478  ECC3 000A                            LDB,B6   10,B3
          1 00047A  D846 0013                            LDR,R5   19,B6
          1 00047C  DA46 000B                            ADD,R5   11,B6
          1 00047E  D246 0015                            SUB,R5   21,B6
          1 000480  DF46 0013                            STR,R5   19,B6

      594     5198    6                       %KV_SRD.BTMRHT.LIN-%KV_SRD.CRT.LIN;
      595     5199    6                     %KV_SRD.CRT.LIN = %KV_SRD.BTMRHT.LIN;

   5199   1 000482  ECC3 000A                            LDB,B6   10,B3
          1 000484  E846 000B                            LDR,R6   11,B6
          1 000486  EF46 0015                            STR,R6   21,B6

      596     5200    6                     %KV_MRD.DVCLIN = %KV_SRD.BTMRHT.LIN;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:179  

   5200   1 000488  ECC3 0008                            LDB,B6   8,B3
          1 00048A  ACC3 000A                            LDB,B2   10,B3
          1 00048C  E842 000B                            LDR,R6   11,B2
          1 00048E  EF46 001D                            STR,R6   29,B6

      597     5201    6                     %KV_MVD.VRTLIN = %KV_MVD.LNG;

   5201   1 000490  ECC3 0006                            LDB,B6   6,B3
          1 000492  E2C6 0014                            LLH,R6   20,B6
          1 000494  EF46 001A                            STR,R6   26,B6

      598     5202    6                     %KV_MVD.FRMLIN = %KV_MVD.LNG-1;

   5202   1 000496  ECC3 0006                            LDB,B6   6,B3
          1 000498  E2C6 0014                            LLH,R6   20,B6
          1 00049A  6EFF                                 ADV,R6   -1
          1 00049B  E7C6 001D                            STH,R6   29,B6

      599     5203    6                  END /* IF */;

   5203   1 00049D  0F81 0A04                            B        s:5934,PREL

      600     5204        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:180  
      601     5205    5               CASE (%KV_INPPRC_BLKTYPAHD);

      602     5206    5                  CALL Y$BLKTYPAHD;

   5206   1 00049F  E3C0 0A95                            LNJ,B6   s:0,PREL
          1 0004A1       0001                            DC       s:5206+3,PREL
          1 0004A2  0F81 09FF                            B        s:5934,PREL

      603     5207        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:181  
      604     5208    5               CASE (%KV_INPPRC_BRK);

      605     5209        /* This is a break.                                                           */
      606     5210
      607     5211    5                  CALL KVM$SND (KV_SND_EVT_BRK);

   5211   1 0004A4  BB80 0000 000F  02                   LAB,B3   +15
          1 0004A7  CBF0 0100                            LAB,B4   256,IMO
          1 0004A9  E380 0000 0000  xent                 LNJ,B6   KVM$SND
          1 0004AC       0001                            DC       s:5211+9,PREL
          1 0004AD  0F81 09F4                            B        s:5934,PREL

      608     5212        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:182  
      609     5213    5               CASE (%KV_INPPRC_CR);

      610     5214        /* This is a CR character (carriage return).                                  */
      611     5215
      612     5216    5                  %KV_SSN.INPCHR = BITASC(%ASCIICR);

   5216   1 0004AF  6C0D                                 LDV,R6   13
          1 0004B0  E7C6 0029                            STH,R6   41,B6

      613     5217    5                  GOTO KVI_NEWLIN;

   5217   1 0004B2  0F81 031C                            B        s:5501,PREL

      614     5218        /* Same as LF, but not ignored with an empty REDBFR. */
      615     5219
      616     5220        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:183  
      617     5221    5               CASE (%KV_INPPRC_COPSSNEDTBFR);

      618     5222        /* This is a copy-session-edit-buffer request.                                */
      619     5223
      620     5224    5                  CALL KVI$CPYSSNEDTBFRTO_REDBFR;

   5224   1 0004B4  CBF0 0000                            LAB,B4   0,IMO
          1 0004B6  E380 0000 0000  xent                 LNJ,B6   KVI$CPYSSNEDTBFRTO_REDBFR
          1 0004B9       0001                            DC       s:5224+6,PREL
          1 0004BA  0F81 09E7                            B        s:5934,PREL

      621     5225        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:184  
      622     5226    5               CASE (%KV_INPPRC_COPSTREDTBFR);

      623     5227        /* This is a copy-stream-edit-buffer request.                                 */
      624     5228
      625     5229    5                  CALL KVI$CPYSTREDTBFRTO_REDBFR;

   5229   1 0004BC  CBF0 0000                            LAB,B4   0,IMO
          1 0004BE  E380 0000 0000  xent                 LNJ,B6   KVI$CPYSTREDTBFRTO_REDBFR
          1 0004C1       0001                            DC       s:5229+6,PREL
          1 0004C2  0F81 09DF                            B        s:5934,PREL

      626     5230        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:185  
      627     5231    5               CASE (%KV_INPPRC_DEL, %KV_INPPRC_DELLFT);

      628     5232        /* This is a delete character request.                                        */
      629     5233
      630     5234    5                  IF REDBFR$=ADDR(NIL) OR %KV_SSN.REDBFR__.DATBYTSIZ=0 THEN GOTO
              5234                           CHKJOIN;

   5234   1 0004C4  8DC7 0008                            CMN      REDBFR$,AUTO
          1 0004C6  0901 0043                            BE       s:5252,PREL
          1 0004C8  E846 0033                            LDR,R6   51,B6
          1 0004CA  6901 003F                            BEZ,R6   s:5252,PREL

      631     5235        /* We have a read buffer, and there is at least 1 character in it. */
      632     5236
      633     5237    5                  IF %KV_SSN.REDBFR.EDTLOWX>=%KV_SSN.REDBFR.NXTX

   5237   1 0004CC  D846 002B                            LDR,R5   43,B6
          1 0004CE  D946 002A                            CMR,R5   42,B6
          1 0004D0  0801 001C                            BAL      s:5245,PREL

      634     5238    5                  THEN IF %KV_MVD.INSMOD AND KV$INPOPR.ID=%KV_INPPRC_DEL

   5238   1 0004D2  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0004D5  ACC3 0006                            LDB,B2   6,B3
          1 0004D7  82C2 0016                            LB,'0008'X        22,B2
          1 0004D9       0008
          1 0004DA  0581 000A                            BBF      s:5241,PREL
          1 0004DC  1D06                                 CMV,R1   6
          1 0004DD  0981 0007                            BNE      s:5241,PREL

      635     5239    5                  THEN IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN EXIT;

   5239   1 0004DF  D946 002A                            CMR,R5   42,B6
          1 0004E1  0A01 09C0                            BAG      s:5934,PREL

      636     5240    5                  ELSE GOTO CHKJOIN;       /* DEL at end in INSMOD               */

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:186  
   5240   1 0004E3  0F81 0026                            B        s:5252,PREL

      637     5241    6                  ELSE IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;

   5241   1 0004E5  D946 002A                            CMR,R5   42,B6
          1 0004E7  0A81 0005                            BALE     s:5245,PREL

      638     5242    6                     OPRCNT = 0;

   5242   1 0004E9  8747 0013                            CL       OPRCNT,AUTO

      639     5243    6                     GOTO PSTLFT;          /* Past end, DELLFT or not INSMOD     */

   5243   1 0004EB  0F81 04B6                            B        s:5621,PREL

      640     5244    6                  END;
      641     5245    5                  IF NOT %KV_MVD.INSMOD

   5245   1 0004ED  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0004F0  ACC3 0006                            LDB,B2   6,B3
          1 0004F2  82C2 0016                            LB,'0008'X        22,B2
          1 0004F4       0008
          1 0004F5  0501 0007                            BBT      s:5249,PREL
          1 0004F7  C846 002E                            LDR,R4   46,B6
          1 0004F9  C946 002D                            CMR,R4   45,B6
          1 0004FB  0901 09A6                            BE       s:5934,PREL

      642     5246    5                    AND %KV_SSN.REDBFR.INSMODX=%KV_SSN.REDBFR.INSLOWX THEN EXIT;
      643     5247        /* And the editting window is not empty. There is something to delete. */
      644     5248
      645     5249    5                  IF KV$INPOPR.ID=%KV_INPPRC_DELLFT OR NOT %KV_MVD.INSMOD

   5249   1 0004FD  1D17                                 CMV,R1   23
          1 0004FE  0901 0007                            BE       s:5251,PREL
          1 000500  0501 0028                            BBT      s:5264,PREL
          1 000502  D946 002E                            CMR,R5   46,B6
          1 000504  0981 0024                            BNE      s:5264,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:187  

      646     5250    5                    AND %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR.INSMODX
      647     5251    6                  THEN IF %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR__.BYTX THEN DO;

   5251   1 000506  D946 0032                            CMR,R5   50,B6
          1 000508  0981 001A                            BNE      s:5259,PREL

      648     5252    6   CHKJOIN:          IF %KV_MVD.RCRWRAP AND %KV_MVD.INSMOD

   5252   1 00050A  BC80 0000 0000  xsym CHKJOIN         LDB,B3   KV$PTR$
          1 00050D  ACC3 0006                            LDB,B2   6,B3
          1 00050F  82C2 001F                            LB,'0080'X        31,B2
          1 000511       0080
          1 000512  0581 000E                            BBF      s:5254,PREL
          1 000514  82C2 0016                            LB,'0008'X        22,B2
          1 000516       0008
          1 000517  0581 0009                            BBF      s:5254,PREL

      649     5253    6                     THEN CALL KVE$INPOPR (KV$INPOPR);

   5253   1 000519  BBC7 0006                            LAB,B3   INPOPR$,AUTO
          1 00051B  CBF0 0100                            LAB,B4   256,IMO
          1 00051D  E380 0000 0000  xent                 LNJ,B6   KVE$INPOPR
          1 000520       0001                            DC       s:5254,PREL

      650     5254    6                     EXIT INPPRC;

   5254   1 000521  0F81 0980                            B        s:5934,PREL

      651     5255    6                  END;
      652     5256    6                  ELSE DO;

      653     5257        /* We're at the insert point. Delete the column to the left. */
      654     5258
      655     5259    6                     %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX-1;

   5259   1 000523  5EFF                                 ADV,R5   -1
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:188  
          1 000524  DF46 002C                            STR,R5   44,B6

      656     5260    6                     CALL Y$SCPVRTCLMHI_X;

   5260   1 000526  E3C0 122F                            LNJ,B6   s:0,PREL
          1 000528       0001                            DC       s:5264,PREL

      657     5261    6                  END;

      658     5262        /* EDTxxxX now frames the column we want to remove. */
      659     5263
      660     5264    5                  R2 = %KV_SSN.REDBFR.NXTX-%KV_SSN.REDBFR.EDTHI_X-1;

   5264   1 000529  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 00052B  E846 002A                            LDR,R6   42,B6
          1 00052D  E246 002C                            SUB,R6   44,B6
          1 00052F  6EFF                                 ADV,R6   -1
          1 000530  EF47 000E                            STR,R6   R2,AUTO

      661     5265    5                  IF R2~=0

   5265   1 000532  6901 000C                            BEZ,R6   s:5272,PREL

      662     5266        /* There are characters to the right, so move them down. */
      663     5267
      664     5268    5                  THEN CALL INSERT (KV$REDBFR_CHR, %KV_SSN.REDBFR.EDTLOWX, R2,

   5268   1 000534  D846 002C                            LDR,R5   44,B6
          1 000536  C846 002B                            LDR,R4   43,B6
          1 000538  ACC7 0008                            LDB,B2   REDBFR$,AUTO
          1 00053A  A855                                 LDR,R2   R5
          1 00053B  2E01                                 ADV,R2   1
          1 00053C  BB82                                 LAB,B3   ,B2
          1 00053D  B854                                 LDR,R3   R4
          1 00053E  0008                                 MMM

      665     5269    5                    SUBSTR (KV$REDBFR_CHR, %KV_SSN.REDBFR.EDTHI_X+1, R2));
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:189  
      666     5270        /* Update the buffer indexes that need it. */
      667     5271
      668     5272    5                  R2 = %KV_SSN.REDBFR.EDTHI_X-%KV_SSN.REDBFR.EDTLOWX+1;

   5272   1 00053F  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000541  E846 002C                            LDR,R6   44,B6
          1 000543  E246 002B                            SUB,R6   43,B6
          1 000545  6E01                                 ADV,R6   1
          1 000546  EF47 000E                            STR,R6   R2,AUTO

      669     5273    5                  IF %KV_SSN.REDBFR.INSMODX>%KV_SSN.REDBFR.EDTHI_X

   5273   1 000548  D846 002E                            LDR,R5   46,B6
          1 00054A  D946 002C                            CMR,R5   44,B6
          1 00054C  0A81 0004                            BALE     s:5275,PREL

      670     5274    5                  THEN %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.INSMODX-R2;

   5274   1 00054E  D256                                 SUB,R5   R6
          1 00054F  DF46 002E                            STR,R5   46,B6

      671     5275    5                  IF %KV_SSN.REDBFR.INSLOWX>%KV_SSN.REDBFR.EDTHI_X

   5275   1 000551  C846 002D                            LDR,R4   45,B6
          1 000553  C946 002C                            CMR,R4   44,B6
          1 000555  0A81 0004                            BALE     s:5277,PREL

      672     5276    5                  THEN %KV_SSN.REDBFR.INSLOWX = %KV_SSN.REDBFR.INSLOWX-R2;

   5276   1 000557  C256                                 SUB,R4   R6
          1 000558  CF46 002D                            STR,R4   45,B6

      673     5277    5                  %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.NXTX-R2;

   5277   1 00055A  E246 002A                            SUB,R6   42,B6
          1 00055C  8256                                 NEG      R6
          1 00055D  EF46 002A                            STR,R6   42,B6
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:190  

      674     5278    5                  %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR__.DATBYTSIZ-R2;

   5278   1 00055F  B846 0033                            LDR,R3   51,B6
          1 000561  B247 000E                            SUB,R3   R2,AUTO
          1 000563  BF46 0033                            STR,R3   51,B6

      675     5279        /* Update the screen image or type a backslash. */
      676     5280
      677     5281    6                  IF NOT %KV_VDI.RE_DSPINP THEN DO;

   5281   1 000565  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000568  CC85                                 LDB,B4   ,B5
          1 000569  82C4 0019                            LB,'0010'X        25,B4
          1 00056B       0010
          1 00056C  0501 0083                            BBT      s:5313+2,PREL

      678     5282    6                     R2 = %KV_MVD.VRTCLM-1;

   5282   1 00056E  BCC5 0006                            LDB,B3   6,B5
          1 000570  A843 001B                            LDR,R2   27,B3
          1 000572  2EFF                                 ADV,R2   -1
          1 000573  AF47 000E                            STR,R2   R2,AUTO

      679     5283    6                     CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);

   5283   1 000575  CCC5 0006                            LDB,B4   6,B5
          1 000577  BBC4 001B                            LAB,B3   27,B4
          1 000579  BFC7 0036                            STB,B3   OLDCLM+3,AUTO
          1 00057B  E3C0 0B6F                            LNJ,B6   s:0,PREL
          1 00057D       0001                            DC       s:5284,PREL

      680     5284    6                     IF %KV_MVD.RETYPOVR

   5284   1 00057E  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000581  DCC6 0006                            LDB,B5   6,B6
          1 000583  82C5 0016                            LB,'0080'X        22,B5
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:191  
          1 000585       0080
          1 000586  0581 000A                            BBF      s:5288,PREL

      681     5285        /* We are to edit in place.                                       */
      682     5286
      683     5287    6                     THEN CALL Y$SHFDSPPST (-1);

   5287   1 000588  CBF0 FFFF                            LAB,B4   -1,IMO
          1 00058A  CFC7 0030                            STB,B4   DLT+1,AUTO
          1 00058C  E3C0 126A                            LNJ,B6   s:0,PREL
          1 00058E       0001                            DC       s:5287+7,PREL
          1 00058F  0F81 006F                            B        s:5317,PREL

      684     5288    7                     ELSE IF %KV_MVD.DISPINPUT THEN DO;

   5288   1 000591  82C5 0015                            LB,'0080'X        21,B5
   5288   1 000593       0080
          1 000594  0581 006A                            BBF      s:5317,PREL

      685     5289    8                        IF %KV_SSN.REDBFR__.DATBYTSIZ=0 THEN DO;

   5289   1 000596  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 000598  E844 0033                            LDR,R6   51,B4
          1 00059A  6981 0023                            BNEZ,R6  s:5297+2,PREL

      686     5290        /* The read buffer had only 1 column in it, so it's now empty.
      687     5291           Echo an underscore (as in DLTINP), and position to the next line.    */
      688     5292
      689     5293    8                           IF %KV_MVD.EDITOVR AND R2=%KV_MVD.VRTCLM

   5293   1 00059C  82C5 0016                            LB,'0040'X        22,B5
   5293   1 00059E       0040
          1 00059F  0581 0010                            BBF      s:5295,PREL
          1 0005A1  D847 000E                            LDR,R5   R2,AUTO
          1 0005A3  D945 001B                            CMR,R5   27,B5
          1 0005A5  0981 000A                            BNE      s:5295,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:192  
      690     5294    8                           THEN CALL KVO$PST(KV_VDH_PST_0_VRT);

   5294   1 0005A7  BB80 0000 0011  02                   LAB,B3   +17
          1 0005AA  CBF0 0100                            LAB,B4   256,IMO
          1 0005AC  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0005AF       0001                            DC       s:5295,PREL

      691     5295    8                           CALL KVO$OTP1_NONVRT (%ASCIIUNDSCR);

   5295   1 0005B0  BB80 0000 000D  02                   LAB,B3   +13
          1 0005B3  CBF0 0100                            LAB,B4   256,IMO
          1 0005B5  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 0005B8       0001                            DC       s:5296,PREL

      692     5296    8                           CALL Y$RE_PSTRED;

   5296   1 0005B9  E3C0 117C                            LNJ,B6   s:0,PREL
          1 0005BB       0001                            DC       s:5297,PREL

      693     5297    8                        END; ELSE IF NOT %KV_MVD.EDITOVR THEN DO;

   5297   1 0005BC  0F81 0042                            B        s:5317,PREL

   5297   1 0005BE  82C5 0016                            LB,'0040'X        22,B5
   5297   1 0005C0       0040
          1 0005C1  0501 0014                            BBT      s:5305,PREL

      694     5298        /* Not EDITOVR, just tack baskslashes onto the end */
      695     5299
      696     5300    8                           CALL KVO$OTP1_NONVRT (%ASCIIBCKSLS);

   5300   1 0005C3  BB80 0000 0014  02                   LAB,B3   +20
          1 0005C6  CBF0 0100                            LAB,B4   256,IMO
          1 0005C8  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 0005CB       0001                            DC       s:5301,PREL

      697     5301    8                           %KV_SRD.VRTPSTOK = '1'B;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:193  

   5301   1 0005CC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0005CF  DCC6 000A                            LDB,B5   10,B6
          1 0005D1  8945 000E                            LBT,'0010'X       14,B5
          1 0005D3       0010

      698     5302    8                        END; ELSE DO;

   5302   1 0005D4  0F81 002A                            B        s:5317,PREL

      699     5303        /* EDITOVR, strike out the deleted chars accurately. */
      700     5304
      701     5305    8                           IF R2=%KV_MVD.VRTCLM

   5305   1 0005D6  D847 000E                            LDR,R5   R2,AUTO
          1 0005D8  D945 001B                            CMR,R5   27,B5
          1 0005DA  0981 000A                            BNE      s:5310,PREL

      702     5306        /* We're deleting the column to the left of our position
      703     5307           position to it to mark it out                                  */
      704     5308
      705     5309    8                           THEN CALL KVO$PST(KV_VDH_PST_0_VRT);

   5309   1 0005DC  BB80 0000 0011  02                   LAB,B3   +17
          1 0005DF  CBF0 0100                            LAB,B4   256,IMO
          1 0005E1  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0005E4       0001                            DC       s:5310,PREL

      706     5310    8                           CALL KVO$OTP1_NONVRT (%ASCIIBCKSLS);

   5310   1 0005E5  BB80 0000 0014  02                   LAB,B3   +20
          1 0005E8  CBF0 0100                            LAB,B4   256,IMO
          1 0005EA  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 0005ED       0001                            DC       s:5313,PREL

      707     5311    8                        END /* IF */;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:194  
      708     5312    7                     END /* IF */;

      709     5313    6                  END; ELSE IF %KV_SSN.REDBFR.EDTLOWX<%KV_VDI.RE_DSPLOWX THEN DO;

   5313   1 0005EE  0F81 0010                            B        s:5317,PREL

   5313   1 0005F0  A846 002B                            LDR,R2   43,B6
          1 0005F2  2801 0005                            BLZ,R2   s:5314,PREL
          1 0005F4  A944 0016                            CMR,R2   22,B4
          1 0005F6  0281 0008                            BGE      s:5317,PREL

      710     5314    6                     %KV_VDI.RE_DSPLOWX = %KV_SSN.REDBFR.EDTLOWX;

   5314   1 0005F8  AF44 0016                            STR,R2   22,B4

      711     5315    6                     %KV_SRD.VRTPSTOK='0'B;

   5315   1 0005FA  CCC5 000A                            LDB,B4   10,B5
          1 0005FC  8844 000E                            LBF,'0010'X       14,B4
          1 0005FE       0010

      712     5316    6                  END;

      713     5317    5                  CALL Y$SCPVRTCLMLOWX;

   5317   1 0005FF  E3C0 119D                            LNJ,B6   s:0,PREL
          1 000601       0001                            DC       s:5317+3,PREL
          1 000602  0F81 089F                            B        s:5934,PREL

      714     5318        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:195  
      715     5319    5               CASE (%KV_INPPRC_DELWRD);

      716     5320    5                  R2 = %KV_SSN.REDBFR.EDTLOWX;

   5320   1 000604  E846 002B                            LDR,R6   43,B6
          1 000606  EF47 000E                            STR,R6   R2,AUTO

      717     5321    5                  R3 = R2;

   5321   1 000608  EF47 000F                            STR,R6   R3,AUTO

      718     5322    6                  DO WHILE R3<%KV_SSN.REDBFR.INSMODX;

   5322   1 00060A  E946 002E                            CMR,R6   46,B6
          1 00060C  0881 0012                            BAGE     s:5326,PREL

      719     5323    6                     IF KV$REDBFR.CHR(R3)=' ' THEN EXIT;

   5323   1 00060E  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 000610  B847 000F                            LDR,R3   R3,AUTO
          1 000612  E0B6                                 LDH,R6   ,B6,R3
          1 000613  6D20                                 CMV,R6   32
          1 000614  0901 000A                            BE       s:5326,PREL

      720     5324    6                     R3 = R3+1;

   5324   1 000616  8AC7 000F                            INC      R3,AUTO

      721     5325    6                  END;

   5325   1 000618  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 00061A  E847 000F                            LDR,R6   R3,AUTO
          1 00061C  E945 002E                            CMR,R6   46,B5
          1 00061E  0870                                 BAL      s:5323,SPREL

      722     5326    6                  DO WHILE R3<%KV_SSN.REDBFR.INSMODX;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:196  
   5326   1 00061F  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000621  E847 000F                            LDR,R6   R3,AUTO
          1 000623  E946 002E                            CMR,R6   46,B6
          1 000625  0881 0012                            BAGE     s:5330,PREL

      723     5327    6                     IF KV$REDBFR.CHR(R3)~=' ' THEN EXIT;

   5327   1 000627  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 000629  B847 000F                            LDR,R3   R3,AUTO
          1 00062B  E0B6                                 LDH,R6   ,B6,R3
          1 00062C  6D20                                 CMV,R6   32
          1 00062D  0981 000A                            BNE      s:5330,PREL

      724     5328    6                     R3 = R3+1;

   5328   1 00062F  8AC7 000F                            INC      R3,AUTO

      725     5329    6                  END;

   5329   1 000631  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 000633  E847 000F                            LDR,R6   R3,AUTO
          1 000635  E945 002E                            CMR,R6   46,B5
          1 000637  0870                                 BAL      s:5327,SPREL

      726     5330    5                  GOTO DLTSGM;

   5330   1 000638  0F81 004A                            B        s:5352,PREL

      727     5331        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:197  
      728     5332    5               CASE (%KV_INPPRC_DLTTO_BGN);

      729     5333        /* This is delete-to-beginning-of-edit-window request.                        */
      730     5334
      731     5335    6                  IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;

   5335   1 00063A  E846 002B                            LDR,R6   43,B6
          1 00063C  E946 002A                            CMR,R6   42,B6
          1 00063E  0A81 0005                            BALE     s:5339,PREL

      732     5336    6                     %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.EDTLOWX;

   5336   1 000640  EF46 002A                            STR,R6   42,B6

      733     5337    6                     %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.EDTLOWX;

   5337   1 000642  EF46 002E                            STR,R6   46,B6

      734     5338    6                  END;

      735     5339    5                  R3 = %KV_SSN.REDBFR.EDTLOWX;

   5339   1 000644  EF47 000F                            STR,R6   R3,AUTO

      736     5340    5                  R2 = %KV_SSN.REDBFR.INSLOWX;

   5340   1 000646  D846 002D                            LDR,R5   45,B6
          1 000648  DF47 000E                            STR,R5   R2,AUTO

      737     5341    5                  %KV_SSN.REDBFR.EDTLOWX = R2;

   5341   1 00064A  E855                                 LDR,R6   R5
          1 00064B  EF46 002B                            STR,R6   43,B6

      738     5342    5                  CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);

   5342   1 00064D  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:198  
          1 000650  ACC3 0006                            LDB,B2   6,B3
          1 000652  9BC2 001B                            LAB,B1   27,B2
          1 000654  9FC7 0036                            STB,B1   OLDCLM+3,AUTO
          1 000656  E3C0 0A94                            LNJ,B6   s:0,PREL
          1 000658       0001                            DC       s:5343,PREL

      739     5343    5                  IF %KV_MVD.HRZSCR AND DSPLOWCLM~=0

   5343   1 000659  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00065C  DCC6 0006                            LDB,B5   6,B6
          1 00065E  82C5 0016                            LB,'0004'X        22,B5
          1 000660       0004
          1 000661  0581 0017                            BBF      s:5346,PREL
          1 000663  E847 0012                            LDR,R6   DSPLOWCLM,AUTO
          1 000665  6901 0013                            BEZ,R6   s:5346,PREL
          1 000667  CCC6 000A                            LDB,B4   10,B6
          1 000669  D845 001B                            LDR,R5   27,B5
          1 00066B  D244 0012                            SUB,R5   18,B4
          1 00066D  C2C5 0017                            LLH,R4   23,B5
          1 00066F  C955                                 CMR,R4   R5
          1 000670  0801 0008                            BAL      s:5346,PREL

      740     5344    5                    AND %KV_MVD.VRTCLM-%KV_SRD.PRMVRTCLM<=%KV_MVD.HRZSCRMRG
      741     5345    5                  THEN CALL Y$SHFDSPPST (0);

   5345   1 000672  BBF0 0000                            LAB,B3   0,IMO
          1 000674  BFC7 0030                            STB,B3   DLT+1,AUTO
          1 000676  E3C0 1180                            LNJ,B6   s:0,PREL
          1 000678       0001                            DC       s:5346,PREL

      742     5346    5                  GOTO DLTSGM;

   5346   1 000679  0F81 0009                            B        s:5352,PREL

      743     5347        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:199  
      744     5348    5               CASE (%KV_INPPRC_DLTTO_END);

      745     5349        /* This is a delete-to-end-of-the-edit-window request.                        */
      746     5350
      747     5351    5                  R2 = %KV_SSN.REDBFR.EDTLOWX;

   5351   1 00067B  E846 002B                            LDR,R6   43,B6
          1 00067D  EF47 000E                            STR,R6   R2,AUTO

      748     5352    5                  R3 = %KV_SSN.REDBFR.INSMODX;

   5352   1 00067F  D846 002E                            LDR,R5   46,B6
          1 000681  DF47 000F                            STR,R5   R3,AUTO

   5352   1                              DLTSGM          null
      749     5353    5   DLTSGM:        ;
      750     5354    6                  IF R3<=R2 THEN DO;

   5354   1 000683  E847 000F            DLTSGM          LDR,R6   R3,AUTO
          1 000685  E947 000E                            CMR,R6   R2,AUTO
          1 000687  0A01 0023                            BAG      s:5362,PREL

      751     5355        /* Nothing to do - unless the acknowledgement needs erasing */
      752     5356
      753     5357    6                     IF %KV_MVD.RETYPOVR AND NOT %KV_SRD.VRTPSTOK

   5357   1 000689  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00068C  DCC6 0006                            LDB,B5   6,B6
          1 00068E  82C5 0016                            LB,'0080'X        22,B5
          1 000690       0080
          1 000691  0581 0017                            BBF      s:5360,PREL
          1 000693  CCC6 000A                            LDB,B4   10,B6
          1 000695  82C4 000E                            LB,'0010'X        14,B4
          1 000697       0010
          1 000698  0501 0010                            BBT      s:5360,PREL
          1 00069A  BC86                                 LDB,B3   ,B6
          1 00069B  82C3 0019                            LB,'0010'X        25,B3
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:200  
          1 00069D       0010
          1 00069E  0501 000A                            BBT      s:5360,PREL

      754     5358    6                       AND NOT %KV_VDI.RE_DSPINP
      755     5359    6                     THEN CALL KVO$PST (KV_VDH_PST_VRT);

   5359   1 0006A0  BB80 0000 0002  02                   LAB,B3   +2
          1 0006A3  CBF0 0100                            LAB,B4   256,IMO
          1 0006A5  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0006A8       0001                            DC       s:5360,PREL

      756     5360    6                     EXIT INPPRC;

   5360   1 0006A9  0F81 07F8                            B        s:5934,PREL

      757     5361    6                  END;
      758     5362    5                  R5 = %KV_SSN.REDBFR.NXTX-R3;

   5362   1 0006AB  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0006AD  E246 002A                            SUB,R6   42,B6
          1 0006AF  8256                                 NEG      R6
          1 0006B0  EF47 0010                            STR,R6   R5,AUTO

      759     5363    5                  IF R5~=0

   5363   1 0006B2  6901 0009                            BEZ,R6   s:5365,PREL

      760     5364    5                  THEN SUBSTR(KV$REDBFR_CHR,R2,R5) = SUBSTR(KV$REDBFR_CHR,R3,R5);

   5364   1 0006B4  ACC7 0008                            LDB,B2   REDBFR$,AUTO
          1 0006B6  A847 000F                            LDR,R2   R3,AUTO
          1 0006B8  BB82                                 LAB,B3   ,B2
          1 0006B9  B847 000E                            LDR,R3   R2,AUTO
          1 0006BB  0008                                 MMM

      761     5365    5                  R5 = R3-R2;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:201  
   5365   1 0006BC  E847 000F                            LDR,R6   R3,AUTO
          1 0006BE  E247 000E                            SUB,R6   R2,AUTO
          1 0006C0  EF47 0010                            STR,R6   R5,AUTO

      762     5366    5                  %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.INSMODX-R5;

   5366   1 0006C2  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0006C4  E246 002E                            SUB,R6   46,B6
          1 0006C6  8256                                 NEG      R6
          1 0006C7  EF46 002E                            STR,R6   46,B6

      763     5367    5                  %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.NXTX-R5;

   5367   1 0006C9  D846 002A                            LDR,R5   42,B6
          1 0006CB  D247 0010                            SUB,R5   R5,AUTO
          1 0006CD  DF46 002A                            STR,R5   42,B6

      764     5368    5                  %KV_SSN.REDBFR__.DATBYTSIZ =

   5368   1 0006CF  D246 0032                            SUB,R5   50,B6
          1 0006D1  DF46 0033                            STR,R5   51,B6

      765     5369    5                    %KV_SSN.REDBFR.NXTX-%KV_SSN.REDBFR__.BYTX;
      766     5370    5                  CALL Y$SCPVRTCLMLOWX;

   5370   1 0006D3  E3C0 10C9                            LNJ,B6   s:0,PREL
          1 0006D5       0001                            DC       s:5371,PREL

      767     5371    5                  IF NOT %KV_VDI.RE_DSPINP

   5371   1 0006D6  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0006D9  DC86                                 LDB,B5   ,B6
          1 0006DA  82C5 0019                            LB,'0010'X        25,B5
          1 0006DC       0010
          1 0006DD  0501 003B                            BBT      s:5385,PREL

      768     5372    6                  THEN IF NOT %KV_MVD.RETYPOVR THEN DO;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:202  

   5372   1 0006DF  CCC6 0006                            LDB,B4   6,B6
          1 0006E1  82C4 0016                            LB,'0080'X        22,B4
          1 0006E3       0080
          1 0006E4  0501 001D                            BBT      s:5382,PREL

      769     5373        /* For hard copy, do a retyp */
      770     5374
      771     5375    6                     CALL Y$RE_PSTRED;

   5375   1 0006E6  E3C0 104F                            LNJ,B6   s:0,PREL
          1 0006E8       0001                            DC       s:5376,PREL

      772     5376    6                     CALL Y$SHFTYPREDBFR;

   5376   1 0006E9  EB80 0000 0000                       LAB,B6   0
          1 0006EC  EFC7 0030                            STB,B6   DLT+1,AUTO
          1 0006EE  E3C0 13D5                            LNJ,B6   s:0,PREL
          1 0006F0       0001                            DC       s:5377,PREL

      773     5377    7                     IF %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR.INSMODX THEN DO;

   5377   1 0006F1  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0006F3  E846 002B                            LDR,R6   43,B6
          1 0006F5  E946 002E                            CMR,R6   46,B6
          1 0006F7  0981 07AA                            BNE      s:5934,PREL

      774     5378    7                        %KV_MVD.VRTCLM = %KV_MVD.VRTCLM-1;

   5378   1 0006F9  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0006FC  CCC5 0006                            LDB,B4   6,B5
          1 0006FE  88C4 001B                            DEC      27,B4

      775     5379    7                        GOTO SETINSHI_X;   /* And position properly              */

   5379   1 000700  0F81 074E                            B        s:5900,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:203  
      776     5380    7                     END;
      777     5381    6                  END; ELSE DO;

      778     5382    6                     CALL KVO$PST(KV_VDH_PST_VRT);

   5382   1 000702  BB80 0000 0002  02                   LAB,B3   +2
          1 000705  CBF0 0100                            LAB,B4   256,IMO
          1 000707  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 00070A       0001                            DC       s:5383,PREL

      779     5383    6                     CALL Y$SHFDSPPST (-R5);

   5383   1 00070B  E847 0010                            LDR,R6   R5,AUTO
          1 00070D  8256                                 NEG      R6
          1 00070E  EF47 003D                            STR,R6   R+5,AUTO
          1 000710  EBC7 003D                            LAB,B6   R+5,AUTO
          1 000712  EFC7 0030                            STB,B6   DLT+1,AUTO
          1 000714  E3C0 10E2                            LNJ,B6   s:0,PREL
          1 000716       0001                            DC       s:5384,PREL

      780     5384    6                  END;

   5384   1 000717  0F81 078A                            B        s:5934,PREL

      781     5385    6                  ELSE IF %KV_SSN.REDBFR.EDTLOWX<%KV_VDI.RE_DSPLOWX THEN DO;

   5385   1 000719  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 00071B  E844 002B                            LDR,R6   43,B4
          1 00071D  6801 0005                            BLZ,R6   s:5386,PREL
          1 00071F  E945 0016                            CMR,R6   22,B5
          1 000721  0281 0780                            BGE      s:5934,PREL

      782     5386    6                     %KV_VDI.RE_DSPLOWX = %KV_SSN.REDBFR.EDTLOWX;

   5386   1 000723  EF45 0016                            STR,R6   22,B5

      783     5387    6                     %KV_SRD.VRTPSTOK='0'B;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:204  

   5387   1 000725  DCC6 000A                            LDB,B5   10,B6
          1 000727  8845 000E                            LBF,'0010'X       14,B5
          1 000729       0010

      784     5388    6                  END;

   5388   1 00072A  0F81 0777                            B        s:5934,PREL

      785     5389        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:205  
      786     5390    5               CASE (%KV_INPPRC_DMP);

      787     5391        /* This is a dump.                                                            */
      788     5392
      789     5393        /*N* call gad$dmpusr                                                          */
      790     5394        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:206  
      791     5395    5               CASE (%KV_INPPRC_DSC);

      792     5396        /* This is a physical disconnect.
      793     5397           initiate a disconnect sequence.                                            */
      794     5398
      795     5399    5                  %VDH_DSC = KV_VDH_DSC;

   5399   1 00072C  8C80 0000 0000  xsym                 LDI      KV_VDH_DSC
          1 00072F  8D47 0016                            SDI      FPT,AUTO

      796     5400    5                  %VDH_DSC.NO_IO = '1'B;

   5400   1 000731  8947 0017                            LBT,'8000'X       FPT+1,AUTO
   5400   1 000733       8000

      797     5401    5                  %VDH_DSC.ALLSSN = '1'B;

   5401   1 000734  8947 0017                            LBT,'4000'X       FPT+1,AUTO
   5401   1 000736       4000

      798     5402    5                  %VDH_DSC.RSN = %KV_DSCRSN_LINDRP;

   5402   1 000737  5C01                                 LDV,R5   1
          1 000738  DAC7 0016                            SRM,R5,'00FF'X    FPT,AUTO
          1 00073A       00FF

      799     5403    5                  CALL KVC$DSC (FPT);

   5403   1 00073B  BBC7 0016                            LAB,B3   FPT,AUTO
          1 00073D  BFC7 003A                            STB,B3   R+2,AUTO
          1 00073F  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000741  CBF0 0100                            LAB,B4   256,IMO
          1 000743  E380 0000 0000  xent                 LNJ,B6   KVC$DSC
          1 000746       0001                            DC       s:5403+12,PREL
          1 000747  0F81 075A                            B        s:5934,PREL

      800     5404        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:207  
      801     5405    5               CASE (%KV_INPPRC_ESC);

      802     5406        /* This is a set-escape-pending request.
      803     5407
      804     5408           Escape-pending (KV$MRD.INPCNDPND.ESC) can be set two ways.
      805     5409           It can be set by KV$INPFNCTBL.SPCCHR special character
      806     5410           detection, without interpreting an input operator that
      807     5411           asks for escape pending; it can also be set by either the input
      808     5412           translate table special character accelerator mechanism or the
      809     5413           the KV$INPFNCTBL.SPCCHR special character detection mechanism calling
      810     5414           this piece of code with an input operator that asks for escape pending.
      811     5415           The latter only happens for system input function tables, and only if
      812     5416           the character is not a SPCCHR in a user input function table. */
      813     5417
      814     5418    5                  IF VDH_INTINPOPR.INPFNCTBL$->

   5418   1 000749  BCC7 0004                            LDB,B3   @VDH_PARM,AUTO
          1 00074B  ACC3 0001                            LDB,B2   1,B3
          1 00074D  E842 0028                            LDR,R6   40,B2
          1 00074F  E943 0005                            CMR,R6   5,B3
          1 000751  0981 0007                            BNE      s:5423,PREL

      815     5419    5                    KV$INPFNCTBL.ESCINT1_CHR(0) = VDH_INTINPOPR.ACKCHR
      816     5420        /* This character is an escape introducer. (Surprise!).                       */
      817     5421
      818     5422    5                  THEN KV$PTR.INPCNDPND.ESC.SST(0) = '1'B;

   5422   1 000753  9C80 0000 0000  xsym                 LDB,B1   KV$PTR$
          1 000756  8941 001B                            LBT,'0008'X       27,B1
          1 000758       0008

      819     5423    5                  IF VDH_INTINPOPR.INPFNCTBL$->

   5423   1 000759  ACC3 0001                            LDB,B2   1,B3
          1 00075B  E842 0029                            LDR,R6   41,B2
          1 00075D  E943 0005                            CMR,R6   5,B3
          1 00075F  0981 0007                            BNE      s:5441,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:208  

      820     5424    5                    KV$INPFNCTBL.ESCINT1_CHR(1) = VDH_INTINPOPR.ACKCHR
      821     5425        /* This character is an escape introducer. (Surprise!).                       */
      822     5426
      823     5427    5                  THEN KV$PTR.INPCNDPND.ESC.SST(1) = '1'B;

   5427   1 000761  9C80 0000 0000  xsym                 LDB,B1   KV$PTR$
          1 000764  8941 001B                            LBT,'0004'X       27,B1
          1 000766       0004

      824     5428        /* Reset the type-ahead buffer-character flag. It was
      825     5429           set at the top of KVI$INT because this character
      826     5430           was invoking an input function. However, the input
      827     5431           function in this case is simply to introduce a string
      828     5432           that may invoke an input function.
      829     5433
      830     5434           After processing this input operator, we'll do a 'return'
      831     5435           to skip the code at the bottom of KVI$INT that checks to see
      832     5436           if the input function should be purged from the type-ahead
      833     5437           buffers. The escape-introducer won't properly survive that
      834     5438           test. This has the side-effect of ignoring chaining on an
      835     5439           escape introducer input operator.                                          */
      836     5440
      837     5441    5                  %KV_SSN.TYPAHD.BFRCHR = '0'B;

   5441   1 000767  8846 0027                            LBF,'0020'X       39,B6
   5441   1 000769       0020

      838     5442    5                  %KV_SSN.TYPAHD.BFRINPFNCCHR = '1'B;

   5442   1 00076A  8946 0027                            LBT,'0010'X       39,B6
   5442   1 00076C       0010

      839     5443    5                  RETURN;

   5443   1 00076D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:209  
      840     5444        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:210  
      841     5445    5               CASE (%KV_INPPRC_FNDPSTCHR);

      842     5446        /* This is a request to find and position to the specified
      843     5447           character.                                                                 */
      844     5448
      845     5449    5                  R3 = VDH_INTINPOPR.ACKCHR;

   5449   1 000770  BCC7 0004                            LDB,B3   @VDH_PARM,AUTO
          1 000772  E843 0005                            LDR,R6   5,B3
          1 000774  EF47 000F                            STR,R6   R3,AUTO

      846     5450    5                  IF %KV_MVD.UPPERCASE

   5450   1 000776  AC80 0000 0000  xsym                 LDB,B2   KV$PTR$
          1 000779  9CC2 0006                            LDB,B1   6,B2
          1 00077B  82C1 0015                            LB,'0001'X        21,B1
          1 00077D       0001
          1 00077E  0581 000C                            BBF      s:5458,PREL
          1 000780  6D61                                 CMV,R6   97
          1 000781  0801 0009                            BAL      s:5458,PREL
          1 000783  6D7A                                 CMV,R6   122
          1 000784  0A01 0006                            BAG      s:5458,PREL

      847     5451        /* We're in upper-case-shift mode.                                            */
      848     5452
      849     5453    5                    AND R3>=ASCBIN('a') AND R3<=ASCBIN('z')
      850     5454        /* We're in upper case shift mode and this chr is
      851     5455           a lower case chr. Shift to upper case.                                     */
      852     5456
      853     5457    5                  THEN R3 = R3-BITBIN('20'X);

   5457   1 000786  6EE0                                 ADV,R6   -32
          1 000787  EF47 000F                            STR,R6   R3,AUTO
          1 000789  0F81 000F                            B        s:5477,PREL

      854     5458    5                  ELSE IF %KV_MVD.LOWERCASE

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:211  
   5458   1 00078B  82C1 0015                            LB,'0020'X        21,B1
   5458   1 00078D       0020
          1 00078E  0581 000A                            BBF      s:5477,PREL
          1 000790  6D40                                 CMV,R6   64
          1 000791  0801 0007                            BAL      s:5477,PREL
          1 000793  6D5E                                 CMV,R6   94
          1 000794  0A01 0004                            BAG      s:5477,PREL

      855     5459        /* We're in lower-case-shift mode. This isn't quite a case shift
      856     5460           we're shifting
      857     5461           sticks 6 and 7, except we don't shift underscore (x'5f), which
      858     5462           would map into del (x'7f').
      859     5463
      860     5464           The mapping is:
      861     5465
      862     5466           upper case alpha's ->lower case alpha's
      863     5467           [ (left bracket) ->{ (left brace)
      864     5468           \ (back-slash) ->| (vertical line)
      865     5469           ] (right bracket) ->} (right brace)
      866     5470           ^ (up-arrow) ->~ (tilde)                                                  */
      867     5471
      868     5472    5                    AND R3>=ASCBIN('@') AND R3<=ASCBIN('^')
      869     5473        /* We're in lower case shift mode and this chr is
      870     5474           an upper case chr. Shift to lower case.                                    */
      871     5475
      872     5476    5                  THEN R3 = R3+BITBIN('20'X);

   5476   1 000796  6E20                                 ADV,R6   32
          1 000797  EF47 000F                            STR,R6   R3,AUTO

      873     5477    5                  CALL Y$FNDPSTCHR;

   5477   1 000799  E3C0 0A33                            LNJ,B6   s:0,PREL
          1 00079B       0001                            DC       s:5477+3,PREL
          1 00079C  0F81 0705                            B        s:5934,PREL

      874     5478        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:212  
      875     5479    5               CASE (%KV_INPPRC_FNDPSTWRD);

      876     5480    5                  CALL Y$FNDPSTWRD;

   5480   1 00079E  E3C0 0A98                            LNJ,B6   s:0,PREL
          1 0007A0       0001                            DC       s:5480+3,PREL
          1 0007A1  0F81 0700                            B        s:5934,PREL

      877     5481        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:213  
      878     5482    5               CASE (%KV_INPPRC_INCINPFLDSIZ);

      879     5483        /* This is a request to increase the input field size on a block-mode device. */
      880     5484
      881     5485    5                  CALL KVI$INCINPFLDSIZ;

   5485   1 0007A3  CBF0 0000                            LAB,B4   0,IMO
          1 0007A5  E380 0000 0000  xent                 LNJ,B6   KVI$INCINPFLDSIZ
          1 0007A8       0001                            DC       s:5485+6,PREL
          1 0007A9  0F81 06F8                            B        s:5934,PREL

      882     5486        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:214  
      883     5487    5               CASE (%KV_INPPRC_LCLLF);

      884     5488        /* This is a local line feed request.                                         */
      885     5489
      886     5490    5                  CALL KVO$PST(KV_VDH_PST_LF) ;

   5490   1 0007AB  BB80 0000 0016  02                   LAB,B3   +22
          1 0007AE  CBF0 0100                            LAB,B4   256,IMO
          1 0007B0  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0007B3       0001                            DC       s:5490+9,PREL
          1 0007B4  0F81 06ED                            B        s:5934,PREL

      887     5491        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:215  
      888     5492    5               CASE (%KV_INPPRC_LF);

      889     5493        /* This is a LF character (line feed).                                        */
      890     5494
      891     5495    5                  IF (%KV_VDI.FULLDUPLEXPAPERTAPE OR %KV_VDI.HALFDUPLEXPAPERTAPE)

   5495   1 0007B6  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0007B9  AC83                                 LDB,B2   ,B3
          1 0007BA  82C2 0019                            LB,'0020'X        25,B2
          1 0007BC       0020
          1 0007BD  0501 0006                            BBT      s:5495+14,PREL
          1 0007BF  82C2 0019                            LB,'0002'X        25,B2
          1 0007C1       0002
          1 0007C2  0581 0009                            BBF      s:5501,PREL
          1 0007C4  8DC7 0008                            CMN      REDBFR$,AUTO
          1 0007C6  0901 06DB                            BE       s:5934,PREL
          1 0007C8  E846 0033                            LDR,R6   51,B6
          1 0007CA  6901 06D7                            BEZ,R6   s:5934,PREL

      892     5496        /* If we're in paper tape mode, */
      893     5497
      894     5498    5                    AND (REDBFR$=ADDR(NIL) OR %KV_SSN.REDBFR__.DATBYTSIZ=0)
      895     5499        /* And there is no read buffer, or it is empty, ignore the LF. */
      896     5500    5                  THEN EXIT;
      897     5501    5                  %KV_SSN.INPCHR = %BITASC(ASCIILF);

   5501   1 0007CC  6C0A                                 LDV,R6   10
          1 0007CD  E7C6 0029                            STH,R6   41,B6

   5501   1                              KVI_NEWLIN      null
      898     5502    5   KVI_NEWLIN:    ;
      899     5503    5                  SAVEBIT = %KV_SSN.INPECH;

   5503   1 0007CF  D846 0028            KVI_NEWLIN      LDR,R5   40,B6
          1 0007D1  500F                                 SOL,R5   15
          1 0007D2  DF47 0015                            STR,R5   SAVEBIT,AUTO

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:216  
      900     5504    5                  %KV_SSN.INPECH = '0'B;

   5504   1 0007D4  8846 0028                            LBF,'0001'X       40,B6
   5504   1 0007D6       0001

      901     5505    5                  CALL KVI$BFRREDCHR;

   5505   1 0007D7  CBF0 0000                            LAB,B4   0,IMO
          1 0007D9  E380 0000 0000  xent                 LNJ,B6   KVI$BFRREDCHR
          1 0007DC       0001                            DC       s:5510,PREL

      902     5506        /* If we are not in half duplex paper tape mode and we are
      903     5507           echoing, or the char activated, or we're on a block-mode device,
      904     5508           echo a newline.                                                            */
      905     5509
      906     5510    5                  IF NOT %KV_VDI.HALFDUPLEXPAPERTAPE

   5510   1 0007DD  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0007E0  DC86                                 LDB,B5   ,B6
          1 0007E1  82C5 0019                            LB,'0002'X        25,B5
          1 0007E3       0002
          1 0007E4  0501 001E                            BBT      s:5514,PREL
          1 0007E6  82C5 001D                            LB,'0010'X        29,B5
          1 0007E8       0010
          1 0007E9  0581 0010                            BBF      s:5513,PREL
          1 0007EB  CCC6 0006                            LDB,B4   6,B6
          1 0007ED  82C4 0015                            LB,'0080'X        21,B4
          1 0007EF       0080
          1 0007F0  0501 0009                            BBT      s:5513,PREL
          1 0007F2  E845 001D                            LDR,R6   29,B5
          1 0007F4  6045                                 SOR,R6   5
          1 0007F5  E570 0003                            AND,R6   3,IMO
          1 0007F7  6D03                                 CMV,R6   3
          1 0007F8  0981 000A                            BNE      s:5514,PREL

      907     5511    5                    AND (NOT %KV_VDI.USRRQSDAT.RED OR %KV_MVD.DISPINPUT
      908     5512    5                    OR %KV_VDI.INPUNT = %KV_INPUNT_BLK)
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:217  
      909     5513    5                  THEN CALL KVO$PST (KV_VDH_PST_NEWLIN_VRT);

   5513   1 0007FA  BB80 0000 0000                       LAB,B3   0
          1 0007FD  CBF0 0100                            LAB,B4   256,IMO
          1 0007FF  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 000802       0001                            DC       s:5514,PREL

      910     5514    5                  %KV_SSN.INPECH = SAVEBIT;

   5514   1 000803  E847 0015                            LDR,R6   SAVEBIT,AUTO
          1 000805  604F                                 SOR,R6   15
          1 000806  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000808  EAC6 0028                            SRM,R6,'0001'X    40,B6
          1 00080A       0001
          1 00080B  0F81 0696                            B        s:5934,PREL

      911     5515        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:218  
      912     5516    5               CASE (%KV_INPPRC_MNTATN);

      913     5517        /* This is a monitor attention.                                               */
      914     5518
      915     5519    5                  CALL KVM$SND (KV_SND_EVT_MNTATN);

   5519   1 00080D  BB80 0000 0018  02                   LAB,B3   +24
          1 000810  CBF0 0100                            LAB,B4   256,IMO
          1 000812  E380 0000 0000  xent                 LNJ,B6   KVM$SND
          1 000815       0001                            DC       s:5519+9,PREL
          1 000816  0F81 068B                            B        s:5934,PREL

      916     5520        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:219  
      917     5521    5               CASE (%KV_INPPRC_NXTSSN);

      918     5522
      919     5523        /* Move to a different session (if there is one). */
      920     5524
      921     5525    5                  CALL Y$PRGTYPAHDINPFNC;

   5525   1 000818  E3C0 0C37                            LNJ,B6   s:0,PREL
          1 00081A       0001                            DC       s:5526,PREL

      922     5526    6                  IF %KV_VDI.SSNCNT>1 THEN DO WHILE '1'B;

   5526   1 00081B  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00081E  DC86                                 LDB,B5   ,B6
          1 00081F  E845 000E                            LDR,R6   14,B5
          1 000821  6D01                                 CMV,R6   1
          1 000822  0381 0036                            BLE      s:5535,PREL

      923     5527    6                     IF %KV_SSN.LNK$~=ADDR(NIL)

   5527   1 000824  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000826  8DC6 0002                            CMN      2,B6
          1 000828  0901 0007                            BE       s:5529,PREL

      924     5528    6                     THEN SSN$ = %KV_SSN.LNK$;

   5528   1 00082A  DCC6 0002                            LDB,B5   2,B6
          1 00082C  DFC7 000A                            STB,B5   SSN$,AUTO
          1 00082E  0F81 0009                            B        s:5530,PREL

      925     5529    6                     ELSE SSN$ = %KV_VDI.SSN$;

   5529   1 000830  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000833  CC85                                 LDB,B4   ,B5
          1 000834  BCC4 0004                            LDB,B3   4,B4
          1 000836  BFC7 000A                            STB,B3   SSN$,AUTO

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:220  
      926     5530    6                     IF SSN$=KV$PTR.SSN$ THEN EXIT;

   5530   1 000838  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 00083A  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00083D  EDC5 0002                            CMB,B6   2,B5
          1 00083F  0901 0019                            BE       s:5535,PREL

      927     5531    6                     IF OPRCNT=%KV_SSN.SSNID

   5531   1 000841  E2C6 0037                            LLH,R6   55,B6
          1 000843  E947 0013                            CMR,R6   OPRCNT,AUTO
          1 000845  0901 000E                            BE       s:5533,PREL
          1 000847  D847 0013                            LDR,R5   OPRCNT,AUTO
          1 000849  5A5B                                 BGZ,R5   s:5527,SPREL
          1 00084A  82C6 0028                            LB,'0002'X        40,B6
          1 00084C       0002
          1 00084D  0501 0006                            BBT      s:5533,PREL
          1 00084F  CC85                                 LDB,B4   ,B5
          1 000850  82C4 0018                            LB,'0080'X        24,B4
          1 000852       0080
          1 000853  0551                                 BBT      s:5527,SPREL

      928     5532    6                       OR OPRCNT<=0 AND (%KV_SSN.REDRQSPND OR NOT %KV_VDI.CRSRED)
      929     5533    6                     THEN IF %KV_SSN.SSNCNCID~=0 THEN EXIT;

   5533   1 000854  D846 0024                            LDR,R5   36,B6
          1 000856  5981 0002                            BNEZ,R5  s:5535,PREL

      930     5534    6                  END;

   5534   1 000858  0FCC                                 B        s:5527,SPREL

      931     5535    5                  IF SSN$=KV$PTR.SSN$ THEN EXIT;

   5535   1 000859  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 00085B  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00085E  EDC5 0002                            CMB,B6   2,B5
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:221  
          1 000860  0901 0641                            BE       s:5934,PREL

      932     5536    5                  REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   5536   1 000862  CCC6 0030                            LDB,B4   48,B6
          1 000864  CFC7 0008                            STB,B4   REDBFR$,AUTO

      933     5537    5                  KV$PTR$ = %KV_SSN.SNCPTR$;

   5537   1 000866  BCC6 0008                            LDB,B3   8,B6
          1 000868  BF80 0000 0000  xsym                 STB,B3   KV$PTR$

      934     5538    5                  STR = %KV_STR.ID;

   5538   1 00086B  DCC3 0004                            LDB,B5   4,B3
          1 00086D  E2C5 001C                            LLH,R6   28,B5
          1 00086F  EF47 0014                            STR,R6   STR,AUTO

      935     5539
      936     5540        /* SETSTR will take care of cleaning up and getting us there */
      937     5541
      938     5542    5                  CALL KVS$SETSTR(STR);

   5542   1 000871  DBC7 0014                            LAB,B5   STR,AUTO
          1 000873  DFC7 003A                            STB,B5   R+2,AUTO
          1 000875  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000877  CBF0 0100                            LAB,B4   256,IMO
          1 000879  E380 0000 0000  xent                 LNJ,B6   KVS$SETSTR
          1 00087C       0001                            DC       s:5542+12,PREL
          1 00087D  0F81 0624                            B        s:5934,PREL

      939     5543        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:222  
      940     5544    5               CASE (%KV_INPPRC_OTPPRTID, %KV_INPPRC_OTPSTT);

      941     5545        /* Output port-id or status. */
      942     5546
      943     5547    5                  STR = %KV_STR.ID;

   5547   1 00087F  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 000882  ACC3 0004                            LDB,B2   4,B3
          1 000884  E2C2 001C                            LLH,R6   28,B2
          1 000886  EF47 0014                            STR,R6   STR,AUTO

      944     5548    5                  IF %KV_MVD.ORG>=%KV#VD_ORG_X364

   5548   1 000888  ACC3 0006                            LDB,B2   6,B3
          1 00088A  D2C2 0015                            LLH,R5   21,B2
          1 00088C  5D02                                 CMV,R5   2
          1 00088D  0201 000A                            BL       s:5550,PREL

      945     5549    5                  THEN CALL KVS$SETSTR (1);

   5549   1 00088F  BB80 0000 001B  02                   LAB,B3   +27
          1 000892  CBF0 0100                            LAB,B4   256,IMO
          1 000894  E380 0000 0000  xent                 LNJ,B6   KVS$SETSTR
          1 000897       0001                            DC       s:5550,PREL

      946     5550    5                  IF %KV_VDI.INPUNT=%KV_INPUNT_BLK AND %KV_VDI.USRRQSDAT.RED

   5550   1 000898  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00089B  DC86                                 LDB,B5   ,B6
          1 00089C  E845 001D                            LDR,R6   29,B5
          1 00089E  6045                                 SOR,R6   5
          1 00089F  E570 0003                            AND,R6   3,IMO
          1 0008A1  6D03                                 CMV,R6   3
          1 0008A2  0981 000C                            BNE      s:5557,PREL
          1 0008A4  82C5 001D                            LB,'0010'X        29,B5
          1 0008A6       0010
          1 0008A7  0581 0007                            BBF      s:5557,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:223  

      947     5551        /* This is a block-mode device with a read outstanding. Position
      948     5552           to just beyond the hi non-blank position before outputting
      949     5553           the text.                                                                  */
      950     5554
      951     5555    5                  THEN CALL KVO$PSTAFTHI_NONBLNPHSPST;

   5555   1 0008A9  CBF0 0000                            LAB,B4   0,IMO
          1 0008AB  E380 0000 0000  xent                 LNJ,B6   KVO$PSTAFTHI_NONBLNPHSPST
          1 0008AE       0001                            DC       s:5557,PREL

      952     5556
      953     5557    6                  IF KV$INPOPR.ID=%KV_INPPRC_OTPSTT THEN DO;

   5557   1 0008AF  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 0008B1  E806                                 LDR,R6   ,B6
          1 0008B2  E570 00FF                            AND,R6   255,IMO
          1 0008B4  6D12                                 CMV,R6   18
          1 0008B5  0981 0015                            BNE      s:5562,PREL

      954     5558        /* For output status, send a !HI!, and ask for the rest. */
      955     5559    6                     CALL KVO$OTPLCL (VDH_OTPLCL_BNG_HI_BNG);

   5559   1 0008B7  BB80 0000 001D  02                   LAB,B3   +29
          1 0008BA  CBF0 0100                            LAB,B4   256,IMO
          1 0008BC  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 0008BF       0001                            DC       s:5560,PREL

      956     5560    6                     CALL KVM$SND (KV_SND_RQSSTT);

   5560   1 0008C0  BB80 0000 001F  02                   LAB,B3   +31
          1 0008C3  CBF0 0100                            LAB,B4   256,IMO
          1 0008C5  E380 0000 0000  xent                 LNJ,B6   KVM$SND
          1 0008C8       0001                            DC       s:5561,PREL

      957     5561    6                  END;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:224  
   5561   1 0008C9  0F81 0007                            B        s:5563,PREL

      958     5562    5                  ELSE CALL KVI$OTPPRTID;

   5562   1 0008CB  CBF0 0000                            LAB,B4   0,IMO
          1 0008CD  E380 0000 0000  xent                 LNJ,B6   KVI$OTPPRTID
          1 0008D0       0001                            DC       s:5563,PREL

      959     5563    5                  IF %KV_VDI.INPUNT=%KV_INPUNT_BLK AND %KV_VDI.USRRQSDAT.RED

   5563   1 0008D1  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0008D4  DC86                                 LDB,B5   ,B6
          1 0008D5  E845 001D                            LDR,R6   29,B5
          1 0008D7  6045                                 SOR,R6   5
          1 0008D8  E570 0003                            AND,R6   3,IMO
          1 0008DA  6D03                                 CMV,R6   3
          1 0008DB  0981 0015                            BNE      s:5571,PREL
          1 0008DD  82C5 001D                            LB,'0010'X        29,B5
          1 0008DF       0010
          1 0008E0  0581 0010                            BBF      s:5571,PREL
          1 0008E2  CCC6 000A                            LDB,B4   10,B6
          1 0008E4  D844 0011                            LDR,R5   17,B4
          1 0008E6  5901 000A                            BEZ,R5   s:5571,PREL

      960     5564    5                    AND %KV_SRD.FLDEND.CLM~=0
      961     5565        /* This is a block-mode input device, there is a read pending,
      962     5566           and there is an input field declared.
      963     5567           Position the cursor to the virtual column it belongs in.                   */
      964     5568
      965     5569    5                  THEN CALL KVO$PST(KV_VDH_PST_VRT);

   5569   1 0008E8  BB80 0000 0002  02                   LAB,B3   +2
          1 0008EB  CBF0 0100                            LAB,B4   256,IMO
          1 0008ED  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0008F0       0001                            DC       s:5571,PREL

      966     5570
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:225  
      967     5571    5                  IF STR~=%KV_STR.ID THEN CALL KVS$SETSTR(STR) ;

   5571   1 0008F1  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0008F4  DCC6 0004                            LDB,B5   4,B6
          1 0008F6  E2C5 001C                            LLH,R6   28,B5
          1 0008F8  E947 0014                            CMR,R6   STR,AUTO
          1 0008FA  0901 05A7                            BE       s:5934,PREL

   5571   1 0008FC  CBC7 0014                            LAB,B4   STR,AUTO
          1 0008FE  CFC7 003A                            STB,B4   R+2,AUTO
          1 000900  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000902  CBF0 0100                            LAB,B4   256,IMO
          1 000904  E380 0000 0000  xent                 LNJ,B6   KVS$SETSTR
          1 000907       0001                            DC       s:5571+23,PREL
          1 000908  0F81 0599                            B        s:5934,PREL

      968     5572        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:226  
      969     5573    5               CASE (%KV_INPPRC_PAGBRK);

      970     5574        /* This is a page break request.                                              */
      971     5575
      972     5576    5                  IF %KV_MRD.PHSFRM THEN GOTO SCREND;

   5576   1 00090A  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 00090D  ACC3 0008                            LDB,B2   8,B3
          1 00090F  82C2 0018                            LB,'0400'X        24,B2
          1 000911       0400
          1 000912  0501 02E7                            BBT      s:5746,PREL

      973     5577    5                  CALL KVO$PAGBRK;

   5577   1 000914  CBF0 0000                            LAB,B4   0,IMO
          1 000916  E380 0000 0000  xent                 LNJ,B6   KVO$PAGBRK
          1 000919       0001                            DC       s:5577+6,PREL
          1 00091A  0F81 0587                            B        s:5934,PREL

      974     5578        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:227  
      975     5579    5               CASE (%KV_INPPRC_PSTBGNRED);

      976     5580        /* We are to position to the beginning of the edit window.                    */
      977     5581
      978     5582    5                  IF REDBFR$=ADDR(NIL) THEN EXIT;

   5582   1 00091C  8DC7 0008                            CMN      REDBFR$,AUTO
          1 00091E  0901 0583                            BE       s:5934,PREL

      979     5583        /* The read buffer exists.                                                    */
      980     5584
      981     5585    5                  IF %KV_SSN.REDBFR.INSLOWX=%KV_SSN.REDBFR.EDTLOWX

   5585   1 000920  E846 002D                            LDR,R6   45,B6
          1 000922  E946 002B                            CMR,R6   43,B6
          1 000924  0981 000D                            BNE      s:5590,PREL
          1 000926  E946 0032                            CMR,R6   50,B6
          1 000928  0A81 0009                            BALE     s:5590,PREL

      982     5586    6                    AND %KV_SSN.REDBFR.INSLOWX>%KV_SSN.REDBFR__.BYTX THEN DO;

      983     5587    6                     %KV_SSN.REDBFR.INSLOWX=%KV_SSN.REDBFR__.BYTX;

   5587   1 00092A  E846 0032                            LDR,R6   50,B6
          1 00092C  EF46 002D                            STR,R6   45,B6

      984     5588    6                     %KV_SSN.REDBFR.INSMODX=%KV_SSN.REDBFR.NXTX;

   5588   1 00092E  D846 002A                            LDR,R5   42,B6
          1 000930  DF46 002E                            STR,R5   46,B6

      985     5589    6                  END;

      986     5590    5                  %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.INSLOWX;

   5590   1 000932  EF46 002B                            STR,R6   43,B6

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:228  
      987     5591    5                  CALL Y$SCPVRTCLMLOWX;

   5591   1 000934  E3C0 0E68                            LNJ,B6   s:0,PREL
          1 000936       0001                            DC       s:5592,PREL

      988     5592    5                  CALL Y$PSTLFT_N;

   5592   1 000937  E3C0 0BC8                            LNJ,B6   s:0,PREL
          1 000939       0001                            DC       s:5592+3,PREL
          1 00093A  0F81 0567                            B        s:5934,PREL

      989     5593        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:229  
      990     5594    5               CASE (%KV_INPPRC_PSTENDRED);

      991     5595        /* We are to position to the end of the read buffer.                          */
      992     5596
      993     5597    5                  IF REDBFR$=ADDR(NIL) THEN EXIT;

   5597   1 00093C  8DC7 0008                            CMN      REDBFR$,AUTO
          1 00093E  0901 0563                            BE       s:5934,PREL

      994     5598        /* The read buffer exists.                                                    */
      995     5599
      996     5600    5                  IF %KV_SSN.REDBFR.INSMODX=%KV_SSN.REDBFR.EDTLOWX

   5600   1 000940  E846 002E                            LDR,R6   46,B6
          1 000942  E946 002B                            CMR,R6   43,B6
          1 000944  0981 0029                            BNE      s:5609,PREL
          1 000946  E946 002A                            CMR,R6   42,B6
          1 000948  0881 0025                            BAGE     s:5609,PREL

      997     5601    6                    AND %KV_SSN.REDBFR.INSMODX<%KV_SSN.REDBFR.NXTX THEN DO;

      998     5602    7                     IF NOT (%KV_MVD.RETYPOVR AND %KV_MVD.EDITOVR) THEN DO;

   5602   1 00094A  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 00094D  ACC3 0006                            LDB,B2   6,B3
          1 00094F  82C2 0016                            LB,'0080'X        22,B2
          1 000951       0080
          1 000952  0581 0006                            BBF      s:5603,PREL
          1 000954  82C2 0016                            LB,'0040'X        22,B2
          1 000956       0040
          1 000957  0501 000C                            BBT      s:5606,PREL

      999     5603    7                        %KV_MVD.VRTCLM = %KV_MVD.VRTCLM-1;

   5603   1 000959  88C2 001B                            DEC      27,B2

     1000     5604    7                        CALL KVO$PST (KV_VDH_PST_VRT);
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:230  

   5604   1 00095B  BB80 0000 0002  02                   LAB,B3   +2
          1 00095E  CBF0 0100                            LAB,B4   256,IMO
          1 000960  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 000963       0001                            DC       s:5606,PREL

     1001     5605    7                     END;

     1002     5606    6                     %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.NXTX;

   5606   1 000964  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000966  E846 002A                            LDR,R6   42,B6
          1 000968  EF46 002E                            STR,R6   46,B6

     1003     5607    6                     %KV_SSN.REDBFR.INSLOWX = %KV_SSN.REDBFR__.BYTX;

   5607   1 00096A  D846 0032                            LDR,R5   50,B6
          1 00096C  DF46 002D                            STR,R5   45,B6

     1004     5608    6                  END;

     1005     5609    6                  IF %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.NXTX THEN DO;

   5609   1 00096E  D846 002B                            LDR,R5   43,B6
          1 000970  D946 002A                            CMR,R5   42,B6
          1 000972  0881 0022                            BAGE     s:5615+2,PREL

     1006     5610    6                     %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.INSMODX-1;

   5610   1 000974  6EFF                                 ADV,R6   -1
          1 000975  EF46 002C                            STR,R6   44,B6

     1007     5611    6                     CALL Y$TYPREDBFRSGM;

   5611   1 000977  E3C0 1493                            LNJ,B6   s:0,PREL
          1 000979       0001                            DC       s:5612,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:231  
     1008     5612    6                     IF %KV_MVD.ORG=%KV#VD_ORG_FORM

   5612   1 00097A  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00097D  DCC6 0006                            LDB,B5   6,B6
          1 00097F  E2C5 0015                            LLH,R6   21,B5
          1 000981  6D04                                 CMV,R6   4
          1 000982  0981 051F                            BNE      s:5934,PREL
          1 000984  CCC6 0004                            LDB,B4   4,B6
          1 000986  BCC7 000A                            LDB,B3   SSN$,AUTO
          1 000988  D843 002B                            LDR,R5   43,B3
          1 00098A  5801 0517                            BLZ,R5   s:5934,PREL
          1 00098C  D944 0015                            CMR,R5   21,B4
          1 00098E  0981 0513                            BNE      s:5934,PREL

     1009     5613    6                       AND %KV_SSN.REDBFR.EDTLOWX=%KV_STR.MAXRCRBYTSIZ
     1010     5614    6                     THEN CALL Y$PSTLFT;

   5614   1 000990  E3C0 0AF7                            LNJ,B6   s:0,PREL
          1 000992       0001                            DC       s:5615,PREL

     1011     5615    6                  END; ELSE IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;

   5615   1 000993  0F81 050E                            B        s:5934,PREL

   5615   1 000995  0A81 050C                            BALE     s:5934,PREL

     1012     5616    6                     %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;

   5616   1 000997  D846 002A                            LDR,R5   42,B6
          1 000999  DF46 002B                            STR,R5   43,B6

     1013     5617    6                     %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.NXTX;

   5617   1 00099B  DF46 002C                            STR,R5   44,B6

     1014     5618    6                     CALL Y$PSTLFT_N;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:232  
   5618   1 00099D  E3C0 0B62                            LNJ,B6   s:0,PREL
          1 00099F       0001                            DC       s:5619,PREL

     1015     5619    6                  END;

   5619   1 0009A0  0F81 0501                            B        s:5934,PREL

     1016     5620        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:233  
     1017     5621    5               CASE (%KV_INPPRC_PSTLFT);

   5617   1                              PSTLFT          null
     1018     5622        /* We are to position to the left in the read buffer.                         */
     1019     5623
     1020     5624    5   PSTLFT:        ;
     1021     5625    5                  %KV_MVD.EDTRHT = '0'B;

   5625   1 0009A2  BC80 0000 0000  xsym PSTLFT          LDB,B3   KV$PTR$
          1 0009A5  ACC3 0006                            LDB,B2   6,B3
          1 0009A7  8842 0015                            LBF,'0040'X       21,B2
          1 0009A9       0040

     1022     5626    5                  CALL Y$PSTLFT;

   5626   1 0009AA  E3C0 0ADD                            LNJ,B6   s:0,PREL
          1 0009AC       0001                            DC       s:5626+3,PREL
          1 0009AD  0F81 04F4                            B        s:5934,PREL

     1023     5627        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:234  
     1024     5628    5               CASE (%KV_INPPRC_PSTRHT);

     1025     5629        /* We are to position to the right in the read buffer.                        */
     1026     5630
     1027     5631    5                  %KV_MVD.EDTRHT = '1'B;

   5631   1 0009AF  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0009B2  ACC3 0006                            LDB,B2   6,B3
          1 0009B4  8942 0015                            LBT,'0040'X       21,B2
          1 0009B6       0040

     1028     5632    5                  CALL Y$PSTRHT_TYP;

   5632   1 0009B7  E3C0 0BB5                            LNJ,B6   s:0,PREL
          1 0009B9       0001                            DC       s:5632+3,PREL
          1 0009BA  0F81 04E7                            B        s:5934,PREL

     1029     5633        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:235  
     1030     5634    5               CASE (%KV_INPPRC_RCLEDTWND);

     1031     5635    5                  R5 = 0;

   5635   1 0009BC  8747 0010                            CL       R5,AUTO

     1032     5636    5                  IF %KV_VDI.EDTWND$~=ADDR(NIL)

   5636   1 0009BE  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0009C1  AC83                                 LDB,B2   ,B3
          1 0009C2  8DC2 0010                            CMN      16,B2
          1 0009C4  0901 04DD                            BE       s:5934,PREL

     1033     5637    5                  THEN CALL Y$TYPAHDTXT (%KV_VDI.EDTWND$->KV$EDTWND);

   5637   1 0009C6  9CC2 0010                            LDB,B1   16,B2
          1 0009C8  9FC7 0028                            STB,B1   FPT+18,AUTO
          1 0009CA  E3C0 1388                            LNJ,B6   s:0,PREL
          1 0009CC       0001                            DC       s:5637+7,PREL
          1 0009CD  0F81 04D4                            B        s:5934,PREL

     1034     5638        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:236  
     1035     5639    5               CASE (%KV_INPPRC_RE_PSTRED);

     1036     5640        /* This is a re-position read (to end of prompt) request.                     */
     1037     5641
     1038     5642    5                  IF NOT %KV_VDI.RE_DSPINP THEN CALL Y$RE_PSTRED;

   5642   1 0009CF  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0009D2  AC83                                 LDB,B2   ,B3
          1 0009D3  82C2 0019                            LB,'0010'X        25,B2
          1 0009D5       0010
          1 0009D6  0501 04CB                            BBT      s:5934,PREL

   5642   1 0009D8  E3C0 0D5D                            LNJ,B6   s:0,PREL
          1 0009DA       0001                            DC       s:5642+12,PREL
          1 0009DB  0F81 04C6                            B        s:5934,PREL

     1039     5643        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:237  
     1040     5644    5               CASE (%KV_INPPRC_RE_TYP);

     1041     5645        /* This is a re-type read message request.                                    */
     1042     5646
     1043     5647    5                  CALL Y$SHFTYPREDBFR;

   5647   1 0009DD  BB80 0000 0000                       LAB,B3   0
          1 0009E0  BFC7 0030                            STB,B3   DLT+1,AUTO
          1 0009E2  E3C0 10E1                            LNJ,B6   s:0,PREL
          1 0009E4       0001                            DC       s:5647+8,PREL
          1 0009E5  0F81 04BC                            B        s:5934,PREL

     1044     5648        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:238  
     1045     5649    5               CASE (%KV_INPPRC_RE_TYPFRM);

   5642   1                              RE_DSP_FRM      null
     1046     5650    5   RE_DSP_FRM:    ;
     1047     5651    5                  SAVEBIT = '0'B;

   5651   1 0009E7  8747 0015            RE_DSP_FRM      CL       SAVEBIT,AUTO

     1048     5652    5                  B3 = %KV_MRD.MVD$;       /* First mark all the borders         */

   5652   1 0009E9  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 0009EC  ACC3 0008                            LDB,B2   8,B3
          1 0009EE  9CC2 000D                            LDB,B1   13,B2
          1 0009F0  9FC7 000C                            STB,B1   B3,AUTO

     1049     5653    6                  DO WHILE B3~=ADDR(NIL);

   5653   1 0009F2  0F81 001B                            B        s:5661,PREL

     1050     5654    7                     IF B3->KV$MVD.SRD$->KV$SRD.BRDEXS THEN DO;

   5654   1 0009F4  ECC7 000C                            LDB,B6   B3,AUTO
          1 0009F6  DC86                                 LDB,B5   ,B6
          1 0009F7  82C5 000F                            LB,'0020'X        15,B5
          1 0009F9       0020
          1 0009FA  0581 0007                            BBF      s:5658,PREL

     1051     5655    7                        SAVEBIT = '1'B;

   5655   1 0009FC  8947 0015                            LBT,'8000'X       SAVEBIT,AUTO
   5655   1 0009FE       8000

     1052     5656    7                        B3->KV$MVD.SRD$->KV$SRD.BRDUPD = '1'B;

   5656   1 0009FF  8945 000F                            LBT,'0010'X       15,B5
   5656   1 000A01       0010

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:239  
     1053     5657    7                     END;

     1054     5658    6                     IF B3->KV$MVD.ORG>=%KV#VD_ORG_FORM

   5658   1 000A02  E2C6 0015                            LLH,R6   21,B6
          1 000A04  6D04                                 CMV,R6   4
          1 000A05  0201 0004                            BL       s:5660,PREL

     1055     5659    6                     THEN SAVEBIT = '1'B;

   5659   1 000A07  8947 0015                            LBT,'8000'X       SAVEBIT,AUTO
   5659   1 000A09       8000

     1056     5660    6                     B3 = B3->KV$MVD.LNK$;

   5660   1 000A0A  DCC6 0002                            LDB,B5   2,B6
          1 000A0C  DFC7 000C                            STB,B5   B3,AUTO

     1057     5661    6                  END;

   5661   1 000A0E  8DC7 000C                            CMN      B3,AUTO
          1 000A10  09E4                                 BNE      s:5654,SPREL

     1058     5662    5                  R3 = %KV_SSN.SSNID;

   5662   1 000A11  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000A13  E2C6 0037                            LLH,R6   55,B6
          1 000A15  EF47 000F                            STR,R6   R3,AUTO

     1059     5663    5                  IF %KV_VDI.INPUNT=%KV_INPUNT_BLK THEN SAVEBIT = '1'B;

   5663   1 000A17  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000A1A  CC85                                 LDB,B4   ,B5
          1 000A1B  D844 001D                            LDR,R5   29,B4
          1 000A1D  5045                                 SOR,R5   5
          1 000A1E  D570 0003                            AND,R5   3,IMO
          1 000A20  5D03                                 CMV,R5   3
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:240  
          1 000A21  0981 0006                            BNE      s:5664,PREL

   5663   1 000A23  8947 0015                            LBT,'8000'X       SAVEBIT,AUTO
   5663   1 000A25       8000
          1 000A26  0F81 000B                            B        s:5665,PREL

     1060     5664    5                  ELSE IF SAVEBIT THEN CALL KVO$ERSMRD;

   5664   1 000A28  89C7 0015                            CMZ      SAVEBIT,AUTO
          1 000A2A  0881 0007                            BAGE     s:5665,PREL

   5664   1 000A2C  CBF0 0000                            LAB,B4   0,IMO
          1 000A2E  E380 0000 0000  xent                 LNJ,B6   KVO$ERSMRD
          1 000A31       0001                            DC       s:5665,PREL

     1061     5665    6                  IF SAVEBIT THEN DO UNTIL R3=%KV_SSN.SSNID;

   5665   1 000A32  89C7 0015                            CMZ      SAVEBIT,AUTO
          1 000A34  0881 00FC                            BAGE     s:5699,PREL

     1062     5666    6                     STR = %KV_STR.ID;

   5666   1 000A36  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000A39  DCC6 0004                            LDB,B5   4,B6
          1 000A3B  E2C5 001C                            LLH,R6   28,B5
          1 000A3D  EF47 0014                            STR,R6   STR,AUTO

     1063     5667    6                     B3 = %KV_SSN.STR$;    /* Search for form str(s)             */

   5667   1 000A3F  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 000A41  CCC5 0004                            LDB,B4   4,B5
          1 000A43  CFC7 000C                            STB,B4   B3,AUTO

     1064     5668    7                     DO WHILE B3~=ADDR(NIL);

   5668   1 000A45  0F81 0067                            B        s:5682,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:241  
     1065     5669    7                        IF B3->KV$STR.MVD$->KV$MVD.ORG>=%KV#VD_ORG_FORM

   5669   1 000A47  ECC7 000C                            LDB,B6   B3,AUTO
          1 000A49  DCC6 0004                            LDB,B5   4,B6
          1 000A4B  E2C5 0015                            LLH,R6   21,B5
          1 000A4D  6D04                                 CMV,R6   4
          1 000A4E  0281 0007                            BGE      s:5671,PREL
          1 000A50  CC85                                 LDB,B4   ,B5
          1 000A51  82C4 000F                            LB,'0020'X        15,B4
          1 000A53       0020
          1 000A54  0581 0052                            BBF      s:5680,PREL

     1066     5670    8                          OR B3->KV$STR.MVD$->KV$MVD.SRD$->KV$SRD.BRDEXS THEN DO;

     1067     5671    8                           R2 = B3->KV$STR.ID;

   5671   1 000A56  D2C6 001C                            LLH,R5   28,B6
          1 000A58  DF47 000E                            STR,R5   R2,AUTO

     1068     5672    8                           IF R2~=%KV_STR.ID THEN CALL KVS$SETSTR(R2);

   5672   1 000A5A  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000A5D  CCC5 0004                            LDB,B4   4,B5
          1 000A5F  E2C4 001C                            LLH,R6   28,B4
          1 000A61  E955                                 CMR,R6   R5
          1 000A62  0901 000D                            BE       s:5673,PREL

   5672   1 000A64  BBC7 000E                            LAB,B3   R2,AUTO
          1 000A66  BFC7 003A                            STB,B3   R+2,AUTO
          1 000A68  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000A6A  CBF0 0100                            LAB,B4   256,IMO
          1 000A6C  E380 0000 0000  xent                 LNJ,B6   KVS$SETSTR
          1 000A6F       0001                            DC       s:5673,PREL

     1069     5673    8                           IF %KV_MVD.ORG=%KV#VD_ORG_FORM

   5673   1 000A70  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:242  
          1 000A73  DCC6 0006                            LDB,B5   6,B6
          1 000A75  E2C5 0015                            LLH,R6   21,B5
          1 000A77  6D04                                 CMV,R6   4
          1 000A78  0981 0006                            BNE      s:5675,PREL

     1070     5674    8                           THEN %KV_LINLST.FRMDSP = '0'B;

   5674   1 000A7A  CCC6 000E                            LDB,B4   14,B6
          1 000A7C  8844 0005                            LBF,'0040'X       5,B4
          1 000A7E       0040

     1071     5675    8                           IF %KV_SRD.BRDUPD THEN CALL KVC$DRWBRD;

   5675   1 000A7F  DCC6 000A                            LDB,B5   10,B6
          1 000A81  82C5 000F                            LB,'0010'X        15,B5
          1 000A83       0010
          1 000A84  0581 0007                            BBF      s:5676,PREL

   5675   1 000A86  CBF0 0000                            LAB,B4   0,IMO
          1 000A88  E380 0000 0000  xent                 LNJ,B6   KVC$DRWBRD
          1 000A8B       0001                            DC       s:5676,PREL

     1072     5676    8                           IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN CALL KVF$RE_TYPFRM;

   5676   1 000A8C  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000A8F  DCC6 0006                            LDB,B5   6,B6
          1 000A91  E2C5 0015                            LLH,R6   21,B5
          1 000A93  6D04                                 CMV,R6   4
          1 000A94  0981 0009                            BNE      s:5677,PREL

   5676   1 000A96  CBF0 0000                            LAB,B4   0,IMO
          1 000A98  E380 0000 0000  xent                 LNJ,B6   KVF$RE_TYPFRM
          1 000A9B       0001                            DC       s:5676+16,PREL
          1 000A9C  0F81 000A                            B        s:5680,PREL

     1073     5677    8                           ELSE IF %KV_MVD.ORG=%KV#VD_ORG_SE THEN CALL KVE$DSPALL;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:243  
   5677   1 000A9E  6D05                                 CMV,R6   5
          1 000A9F  0981 0007                            BNE      s:5680,PREL

   5677   1 000AA1  CBF0 0000                            LAB,B4   0,IMO
          1 000AA3  E380 0000 0000  xent                 LNJ,B6   KVE$DSPALL
          1 000AA6       0001                            DC       s:5680,PREL

     1074     5678
     1075     5679    8                        END;

     1076     5680    7                        B3 = B3->KV$STR.LNK$;

   5680   1 000AA7  ECC7 000C                            LDB,B6   B3,AUTO
          1 000AA9  DCC6 0002                            LDB,B5   2,B6
          1 000AAB  DFC7 000C                            STB,B5   B3,AUTO

     1077     5681
     1078     5682    7                     END;

   5682   1 000AAD  8DC7 000C                            CMN      B3,AUTO
          1 000AAF  0981 FF97                            BNE      s:5669,PREL

     1079     5683    6                     IF STR~=%KV_STR.ID THEN CALL KVS$SETSTR (STR);

   5683   1 000AB1  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000AB4  DCC6 0004                            LDB,B5   4,B6
          1 000AB6  E2C5 001C                            LLH,R6   28,B5
          1 000AB8  E947 0014                            CMR,R6   STR,AUTO
          1 000ABA  0901 000D                            BE       s:5684,PREL

   5683   1 000ABC  CBC7 0014                            LAB,B4   STR,AUTO
          1 000ABE  CFC7 003A                            STB,B4   R+2,AUTO
          1 000AC0  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000AC2  CBF0 0100                            LAB,B4   256,IMO
          1 000AC4  E380 0000 0000  xent                 LNJ,B6   KVS$SETSTR
          1 000AC7       0001                            DC       s:5684,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:244  
     1080     5684    6                     IF SAVEBIT AND STR=%KV_SSN.REDSTRID

   5684   1 000AC8  89C7 0015                            CMZ      SAVEBIT,AUTO
          1 000ACA  0881 003A                            BAGE     s:5693,PREL
          1 000ACC  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000ACE  E2C6 0038                            LLH,R6   56,B6
          1 000AD0  E947 0014                            CMR,R6   STR,AUTO
          1 000AD2  0981 0032                            BNE      s:5693,PREL
          1 000AD4  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000AD7  CCC5 000A                            LDB,B4   10,B5
          1 000AD9  D2C4 000E                            LLH,R5   14,B4
          1 000ADB  5901 0029                            BEZ,R5   s:5693,PREL
          1 000ADD  C844 000D                            LDR,R4   13,B4
          1 000ADF  4901 0025                            BEZ,R4   s:5693,PREL
          1 000AE1  BCC5 0006                            LDB,B3   6,B5
          1 000AE3  B2C3 0015                            LLH,R3   21,B3
          1 000AE5  3D04                                 CMV,R3   4
          1 000AE6  0281 001E                            BGE      s:5693,PREL

     1081     5685    6                       AND %KV_SRD.LNG>0 AND %KV_SRD.WDT>0
     1082     5686    7                       AND %KV_MVD.ORG<%KV#VD_ORG_FORM THEN DO;

     1083     5687    7                        %KV_MVD.VRTCLM = 1;

   5687   1 000AE8  2C01                                 LDV,R2   1
          1 000AE9  AF43 001B                            STR,R2   27,B3

     1084     5688    7                        CALL KVO$SCRENDNO_HLT;

   5688   1 000AEB  CBF0 0000                            LAB,B4   0,IMO
          1 000AED  E380 0000 0000  xent                 LNJ,B6   KVO$SCRENDNO_HLT
          1 000AF0       0001                            DC       s:5689,PREL

     1085     5689    7                        CALL KVI$ENBRED;

   5689   1 000AF1  CBF0 0000                            LAB,B4   0,IMO
          1 000AF3  E380 0000 0000  xent                 LNJ,B6   KVI$ENBRED
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:245  
          1 000AF6       0001                            DC       s:5690,PREL

     1086     5690    7                        REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   5690   1 000AF7  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000AF9  DCC6 0030                            LDB,B5   48,B6
          1 000AFB  DFC7 0008                            STB,B5   REDBFR$,AUTO

     1087     5691    7                        CALL Y$SHFTYPREDBFR;

   5691   1 000AFD  CB80 0000 0000                       LAB,B4   0
          1 000B00  CFC7 0030                            STB,B4   DLT+1,AUTO
          1 000B02  E3C0 0FC1                            LNJ,B6   s:0,PREL
          1 000B04       0001                            DC       s:5693,PREL

     1088     5692    7                     END;

     1089     5693    6                     IF %KV_SSN.LNK$=ADDR(NIL)

   5693   1 000B05  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000B07  8DC6 0002                            CMN      2,B6
          1 000B09  0981 000B                            BNE      s:5695,PREL

     1090     5694    6                     THEN SSN$ = %KV_VDI.SSN$;

   5694   1 000B0B  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000B0E  CC85                                 LDB,B4   ,B5
          1 000B0F  BCC4 0004                            LDB,B3   4,B4
          1 000B11  BFC7 000A                            STB,B3   SSN$,AUTO
          1 000B13  0F81 0005                            B        s:5696,PREL

     1091     5695    6                     ELSE SSN$ = %KV_SSN.LNK$;

   5695   1 000B15  DCC6 0002                            LDB,B5   2,B6
          1 000B17  DFC7 000A                            STB,B5   SSN$,AUTO

     1092     5696    6                     %KV_VDI.ASNINPPTR$ = %KV_SSN.SNCPTR$;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:246  

   5696   1 000B19  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000B1C  DC86                                 LDB,B5   ,B6
          1 000B1D  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 000B1F  BCC4 0008                            LDB,B3   8,B4
          1 000B21  BFC5 0006                            STB,B3   6,B5

     1093     5697    6                     CALL KVS$CHNSSN;      /* Make sure we do EXT/ENT-SRD stuff  */

   5697   1 000B23  CBF0 0000                            LAB,B4   0,IMO
          1 000B25  E380 0000 0000  xent                 LNJ,B6   KVS$CHNSSN
          1 000B28       0001                            DC       s:5698,PREL

     1094     5698    6                  END;

   5698   1 000B29  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000B2B  E2C6 0037                            LLH,R6   55,B6
          1 000B2D  E947 000F                            CMR,R6   R3,AUTO
          1 000B2F  0981 FF06                            BNE      s:5666,PREL

     1095     5699    6                  IF SAVEBIT THEN DO;

   5699   1 000B31  89C7 0015                            CMZ      SAVEBIT,AUTO
          1 000B33  0881 036E                            BAGE     s:5934,PREL

     1096     5700    6                     %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;

   5700   1 000B35  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000B38  DC86                                 LDB,B5   ,B6
          1 000B39  6C01                                 LDV,R6   1
          1 000B3A  EF45 001A                            STR,R6   26,B5

     1097     5701    6                     REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   5701   1 000B3C  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 000B3E  CCC5 0030                            LDB,B4   48,B5
          1 000B40  CFC7 0008                            STB,B4   REDBFR$,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:247  

     1098     5702    6                  END;

   5702   1 000B42  0F81 035F                            B        s:5934,PREL

     1099     5703        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:248  
     1100     5704    5               CASE (%KV_INPPRC_RSTINSMOD);

     1101     5705        /* This is a reset insert mode request.                                       */
     1102     5706
     1103     5707    5                  %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.NXTX;

   5707   1 000B44  E846 002A                            LDR,R6   42,B6
          1 000B46  EF46 002E                            STR,R6   46,B6

     1104     5708    5                  %KV_SSN.REDBFR.INSLOWX = %KV_SSN.REDBFR__.BYTX;

   5708   1 000B48  D846 0032                            LDR,R5   50,B6
          1 000B4A  DF46 002D                            STR,R5   45,B6

     1105     5709    5                  IF REDBFR$~=ADDR(NIL) THEN CALL Y$SCPVRTCLMLOWX;

   5709   1 000B4C  8DC7 0008                            CMN      REDBFR$,AUTO
          1 000B4E  0901 0353                            BE       s:5934,PREL

   5709   1 000B50  E3C0 0C4C                            LNJ,B6   s:0,PREL
          1 000B52       0001                            DC       s:5709+7,PREL
          1 000B53  0F81 034E                            B        s:5934,PREL

     1106     5710        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:249  
     1107     5711    5               CASE (%KV_INPPRC_SAVEDTWND);

     1108     5712    5                  R5 = %KV_SSN.REDBFR.INSMODX-%KV_SSN.REDBFR.INSLOWX;

   5712   1 000B55  E846 002E                            LDR,R6   46,B6
          1 000B57  E246 002D                            SUB,R6   45,B6
          1 000B59  EF47 0010                            STR,R6   R5,AUTO

     1109     5713    5                  IF REDBFR$=ADDR(NIL) THEN R5 = 0;

   5713   1 000B5B  8DC7 0008                            CMN      REDBFR$,AUTO
          1 000B5D  0981 0003                            BNE      s:5714,PREL

   5713   1 000B5F  8747 0010                            CL       R5,AUTO

     1110     5714    5                  IF R5>256-LENGTHV(KV$EDTWND) THEN R5 = 256-LENGTHV(KV$EDTWND);

   5714   1 000B61  E847 0010                            LDR,R6   R5,AUTO
          1 000B63  E970 00FD                            CMR,R6   253,IMO
          1 000B65  0A81 0005                            BALE     s:5715,PREL

   5714   1 000B67  E870 00FD                            LDR,R6   253,IMO
          1 000B69  EF47 0010                            STR,R6   R5,AUTO

     1111     5715    5                  %VDH_GETBFR = KV_VDH_GETBFR;

   5715   1 000B6B  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_GETBFR
          1 000B6E  2C00                                 LDV,R2   0
          1 000B6F  6C16                                 LDV,R6   22
          1 000B70  BB87                                 LAB,B3   ,AUTO
          1 000B71  3C2C                                 LDV,R3   44
          1 000B72  0008                                 MMM

     1112     5716    5                  %VDH_GETBFR.STRTYP = %KV_STRTYP_REDBFR;

   5716   1 000B73  6C11                                 LDV,R6   17
          1 000B74  E7C7 001C                            STH,R6   FPT+6,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:250  

     1113     5717    5                  %VDH_GETBFR.BFR$ = %KV_VDI.EDTWND$;

   5717   1 000B76  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000B79  DC86                                 LDB,B5   ,B6
          1 000B7A  CCC5 0010                            LDB,B4   16,B5
          1 000B7C  CFC7 0017                            STB,B4   FPT+1,AUTO

     1114     5718    6                  IF %VDH_GETBFR.BFR$~=ADDR(NIL) THEN DO;

   5718   1 000B7E  8DC7 0017                            CMN      FPT+1,AUTO
          1 000B80  0901 0021                            BE       s:5725,PREL

     1115     5719    6                     %VDH_GETBFR.BYTSIZ = %VDH_GETBFR.BFR$->KV$EDTWND.STRBYTSIZ;

   5719   1 000B82  D804                                 LDR,R5   ,B4
          1 000B83  DF47 0019                            STR,R5   FPT+3,AUTO

     1116     5720    7                     IF %VDH_GETBFR.BYTSIZ<R5+LENGTHV(KV$EDTWND) OR R5<=0 THEN DO;

   5720   1 000B85  C847 0010                            LDR,R4   R5,AUTO
          1 000B87  4E03                                 ADV,R4   3
          1 000B88  4801 0004                            BLZ,R4   s:5720+8,PREL
          1 000B8A  C955                                 CMR,R4   R5
          1 000B8B  0301 0005                            BG       s:5721,PREL
          1 000B8D  B847 0010                            LDR,R3   R5,AUTO
          1 000B8F  3A01 0012                            BGZ,R3   s:5725,PREL

     1117     5721    7                        CALL KVS$RLSBFR (FPT);

   5721   1 000B91  DBC7 0016                            LAB,B5   FPT,AUTO
          1 000B93  DFC7 003A                            STB,B5   R+2,AUTO
          1 000B95  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000B97  CBF0 0100                            LAB,B4   256,IMO
          1 000B99  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 000B9C       0001                            DC       s:5722,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:251  
     1118     5722    7                        %VDH_GETBFR.BFR$ = ADDR(NIL);

   5722   1 000B9D  EB80 0000 0000                       LAB,B6   0
          1 000BA0  EFC7 0017                            STB,B6   FPT+1,AUTO

     1119     5723    7                     END;

     1120     5724    6                  END;

     1121     5725    6                  IF %VDH_GETBFR.BFR$=ADDR(NIL) AND R5>0 THEN DO;

   5725   1 000BA2  8DC7 0017                            CMN      FPT+1,AUTO
          1 000BA4  0981 0014                            BNE      s:5729,PREL
          1 000BA6  E847 0010                            LDR,R6   R5,AUTO
          1 000BA8  6A81 0010                            BLEZ,R6  s:5729,PREL

     1122     5726    6                     %VDH_GETBFR.BYTSIZ = R5+LENGTHV(KV$EDTWND);

   5726   1 000BAA  6E03                                 ADV,R6   3
          1 000BAB  EF47 0019                            STR,R6   FPT+3,AUTO

     1123     5727    6                     CALL KVS$GETBFR (FPT);

   5727   1 000BAD  EBC7 0016                            LAB,B6   FPT,AUTO
          1 000BAF  EFC7 003A                            STB,B6   R+2,AUTO
          1 000BB1  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000BB3  CBF0 0100                            LAB,B4   256,IMO
          1 000BB5  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 000BB8       0001                            DC       s:5729,PREL

     1124     5728    6                  END;

     1125     5729    5                  %KV_VDI.EDTWND$ = %VDH_GETBFR.BFR$;

   5729   1 000BB9  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000BBC  DC86                                 LDB,B5   ,B6
          1 000BBD  CCC7 0017                            LDB,B4   FPT+1,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:252  
          1 000BBF  CFC5 0010                            STB,B4   16,B5

     1126     5730    6                  IF %VDH_GETBFR.BFR$~=ADDR(NIL) THEN DO;

   5730   1 000BC1  8DC7 0017                            CMN      FPT+1,AUTO
          1 000BC3  0901 02DE                            BE       s:5934,PREL

     1127     5731    6                     %VDH_GETBFR.BFR$->KV$EDTWND.STRBYTSIZ = %VDH_GETBFR.BYTSIZ;

   5731   1 000BC5  DCC7 0017                            LDB,B5   FPT+1,AUTO
          1 000BC7  E847 0019                            LDR,R6   FPT+3,AUTO
          1 000BC9  EF05                                 STR,R6   ,B5

     1128     5732    6                     %VDH_GETBFR.BFR$->KV$EDTWND.L = R5;

   5732   1 000BCA  E847 0010                            LDR,R6   R5,AUTO
          1 000BCC  ECC7 0017                            LDB,B6   FPT+1,AUTO
          1 000BCE  E7C6 0001                            STH,R6   1,B6

     1129     5733    6                     SUBSTR(%VDH_GETBFR.BFR$->KV$EDTWND.T,0,R5) =

   5733   1 000BD0  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000BD2  E846 002D                            LDR,R6   45,B6
          1 000BD4  ACC7 0008                            LDB,B2   REDBFR$,AUTO
          1 000BD6  A856                                 LDR,R2   R6
          1 000BD7  E847 0010                            LDR,R6   R5,AUTO
          1 000BD9  BCC7 0017                            LDB,B3   FPT+1,AUTO
          1 000BDB  3C03                                 LDV,R3   3
          1 000BDC  0008                                 MMM

     1130     5734    6                       SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR.INSLOWX,R5);
     1131     5735    6                  END;

   5735   1 000BDD  0F81 02C4                            B        s:5934,PREL

     1132     5736        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:253  
     1133     5737    5               CASE (%KV_INPPRC_SCREND);

     1134     5738        /* This is a screen end request.                                              */
     1135     5739
     1136     5740    6                  IF NOT %KV_MRD.PHSFRM THEN DO;

   5740   1 000BDF  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 000BE2  ACC3 0008                            LDB,B2   8,B3
          1 000BE4  82C2 0018                            LB,'0400'X        24,B2
          1 000BE6       0400
          1 000BE7  0501 0012                            BBT      s:5746,PREL

     1137     5741        /* Not a fixed page-size device, do a page eject                              */
     1138     5742
     1139     5743    6                     CALL KVO$PST (KV_VDH_PST_CR_VRT);

   5743   1 000BE9  BB80 0000 0021  02                   LAB,B3   +33
          1 000BEC  CBF0 0100                            LAB,B4   256,IMO
          1 000BEE  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 000BF1       0001                            DC       s:5744,PREL

     1140     5744    6                     CALL KVO$PAGBRK;

   5744   1 000BF2  CBF0 0000                            LAB,B4   0,IMO
          1 000BF4  E380 0000 0000  xent                 LNJ,B6   KVO$PAGBRK
          1 000BF7       0001                            DC       s:5745,PREL

     1141     5745    6                  END;

   5745   1 000BF8  0F81 003B                            B        s:5759,PREL

     1142     5746    6                  ELSE DO;

   5743   1                              SCREND          null
     1143     5747    6   SCREND:           ;
     1144     5748    6                     %KV_SRD.NXTNONBLNLIN = %KV_SRD.BTMRHT.LIN+1;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:254  
   5748   1 000BFA  9CC3 000A            SCREND          LDB,B1   10,B3
          1 000BFC  E841 000B                            LDR,R6   11,B1
          1 000BFE  6E01                                 ADV,R6   1
          1 000BFF  EF41 0014                            STR,R6   20,B1

     1145     5749    6                     CALL KVO$ERSSRD;

   5749   1 000C01  CBF0 0000                            LAB,B4   0,IMO
          1 000C03  E380 0000 0000  xent                 LNJ,B6   KVO$ERSSRD
          1 000C06       0001                            DC       s:5750,PREL

     1146     5750    6                     %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRT.LIN;

   5750   1 000C07  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000C0A  DCC6 000A                            LDB,B5   10,B6
          1 000C0C  E845 0015                            LDR,R6   21,B5
          1 000C0E  EF45 0013                            STR,R6   19,B5

     1147     5751    6                     %KV_MVD.VRTCLM = 1;

   5751   1 000C10  DCC6 0006                            LDB,B5   6,B6
          1 000C12  6C01                                 LDV,R6   1
          1 000C13  EF45 001B                            STR,R6   27,B5

     1148     5752    6                     %KV_SRD.VRTPSTOK = '0'B;

   5752   1 000C15  DCC6 000A                            LDB,B5   10,B6
          1 000C17  8845 000E                            LBF,'0010'X       14,B5
          1 000C19       0010

     1149     5753    7                     IF KV$INPOPR.ID=%KV_INPPRC_PAGBRK THEN DO;

   5753   1 000C1A  DCC7 0006                            LDB,B5   INPOPR$,AUTO
          1 000C1C  D805                                 LDR,R5   ,B5
          1 000C1D  D570 00FF                            AND,R5   255,IMO
          1 000C1F  5D13                                 CMV,R5   19
          1 000C20  0981 0013                            BNE      s:5759,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:255  

     1150     5754    7                        %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.TOPLFT.LIN;

   5754   1 000C22  CCC6 000A                            LDB,B4   10,B6
          1 000C24  C844 0009                            LDR,R4   9,B4
          1 000C26  CF44 0013                            STR,R4   19,B4

     1151     5755    7                        IF %KV_SRD.SCROLL

   5755   1 000C28  CCC6 000A                            LDB,B4   10,B6
          1 000C2A  82C4 000E                            LB,'0008'X        14,B4
          1 000C2C       0008
          1 000C2D  0581 0006                            BBF      s:5759,PREL

     1152     5756    7                        THEN %KV_SRD.DVCLINBIS = %KV_SRD.LNG-1;

   5756   1 000C2F  D2C4 000E                            LLH,R5   14,B4
          1 000C31  5EFF                                 ADV,R5   -1
          1 000C32  DF44 0019                            STR,R5   25,B4

     1153     5757    7                     END;

     1154     5758    6                  END /* IF */;

     1155     5759    6                  IF %KV_SSN.REDSTRID=%KV_STR.ID THEN DO;

   5759   1 000C34  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000C37  DCC6 0004                            LDB,B5   4,B6
          1 000C39  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 000C3B  E2C4 0038                            LLH,R6   56,B4
          1 000C3D  D2C5 001C                            LLH,R5   28,B5
          1 000C3F  E955                                 CMR,R6   R5
          1 000C40  0981 0261                            BNE      s:5934,PREL

     1156     5760    6                     CALL KVI$ENBRED;

   5760   1 000C42  CBF0 0000                            LAB,B4   0,IMO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:256  
          1 000C44  E380 0000 0000  xent                 LNJ,B6   KVI$ENBRED
          1 000C47       0001                            DC       s:5761,PREL

     1157     5761    6                     CALL Y$SHFTYPREDBFR;

   5761   1 000C48  EB80 0000 0000                       LAB,B6   0
          1 000C4B  EFC7 0030                            STB,B6   DLT+1,AUTO
          1 000C4D  E3C0 0E76                            LNJ,B6   s:0,PREL
          1 000C4F       0001                            DC       s:5762,PREL

     1158     5762    6                  END /* IF */;

   5762   1 000C50  0F81 0251                            B        s:5934,PREL

     1159     5763        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:257  
     1160     5764    5               CASE (%KV_INPPRC_SETINSHI_X);

     1161     5765        /* This is a set insert mode request.                                         */
     1162     5766
     1163     5767    5                  GOTO SETINSHI_X;         /* Part of TGLINSMOD                  */

   5767   1 000C52  0F81 01FC                            B        s:5900,PREL

     1164     5768        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:258  
     1165     5769    5               CASE (%KV_INPPRC_SETINSLOWX);

     1166     5770        /* This is a set insert mode request.                                         */
     1167     5771
     1168     5772    5                  %KV_SSN.REDBFR.INSLOWX = %KV_SSN.REDBFR.EDTLOWX;

   5772   1 000C54  E846 002B                            LDR,R6   43,B6
          1 000C56  EF46 002D                            STR,R6   45,B6

     1169     5773    6                  IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX THEN DO;

   5773   1 000C58  E946 002A                            CMR,R6   42,B6
          1 000C5A  0A81 0247                            BALE     s:5934,PREL

     1170     5774    6                     %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.EDTLOWX;

   5774   1 000C5C  EF46 002E                            STR,R6   46,B6

     1171     5775    6                     %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.EDTLOWX;

   5775   1 000C5E  EF46 002A                            STR,R6   42,B6

     1172     5776    6                  END;

   5776   1 000C60  0F81 0241                            B        s:5934,PREL

     1173     5777        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:259  
     1174     5778    5               CASE (%KV_INPPRC_TAB);

     1175     5779        /* This is a tab request.                                                     */
     1176     5780
     1177     5781    5                  SAVEBIT = %KV_SSN.INPECH;

   5781   1 000C62  E846 0028                            LDR,R6   40,B6
          1 000C64  600F                                 SOL,R6   15
          1 000C65  EF47 0015                            STR,R6   SAVEBIT,AUTO

     1178     5782    5                  %KV_SSN.INPECH = '0'B;

   5782   1 000C67  8846 0028                            LBF,'0001'X       40,B6
   5782   1 000C69       0001

     1179     5783    6                  IF %KV_STR.ACTCHRTBL$->KV$SHRBFR.BITT(BITBIN(%ASCIIHT)) THEN DO;

   5783   1 000C6A  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 000C6D  ACC3 0004                            LDB,B2   4,B3
          1 000C6F  9CC2 000A                            LDB,B1   10,B2
          1 000C71  82C1 0004                            LB,'0040'X        4,B1
          1 000C73       0040
          1 000C74  0581 000C                            BBF      s:5790,PREL

     1180     5784        /* We're to activate on a tab.                                                */
     1181     5785
     1182     5786    6                     %KV_SSN.INPCHR = BITASC(%ASCIIHT);

   5786   1 000C76  6C09                                 LDV,R6   9
          1 000C77  E7C6 0029                            STH,R6   41,B6

     1183     5787    6                     CALL KVI$BFRREDCHR;

   5787   1 000C79  CBF0 0000                            LAB,B4   0,IMO
          1 000C7B  E380 0000 0000  xent                 LNJ,B6   KVI$BFRREDCHR
          1 000C7E       0001                            DC       s:5788,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:260  
     1184     5788    6                  END /* IF */;

   5788   1 000C7F  0F81 01AA                            B        s:5890,PREL

     1185     5789
     1186     5790    6                  ELSE IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN DO;

   5790   1 000C81  ECC3 0006                            LDB,B6   6,B3
          1 000C83  E2C6 0015                            LLH,R6   21,B6
          1 000C85  6D04                                 CMV,R6   4
          1 000C86  0981 001D                            BNE      s:5799,PREL

     1187     5791    6                     %VDH_PST = KV_VDH_PST_SPCFRM;

   5791   1 000C88  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_PST_SPCFRM
          1 000C8B  2C00                                 LDV,R2   0
          1 000C8C  6C08                                 LDV,R6   8
          1 000C8D  BB87                                 LAB,B3   ,AUTO
          1 000C8E  3C2C                                 LDV,R3   44
          1 000C8F  0008                                 MMM

     1188     5792    6                     IF OPRCNT~=0 THEN %VDH_PST.PSTVAL.CLM = OPRCNT;

   5792   1 000C90  E847 0013                            LDR,R6   OPRCNT,AUTO
          1 000C92  6901 0003                            BEZ,R6   s:5793,PREL

   5792   1 000C94  EF47 0019                            STR,R6   FPT+3,AUTO

     1189     5793    6                     CALL KVF$PST(FPT);

   5793   1 000C96  EBC7 0016                            LAB,B6   FPT,AUTO
          1 000C98  EFC7 003A                            STB,B6   R+2,AUTO
          1 000C9A  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000C9C  CBF0 0100                            LAB,B4   256,IMO
          1 000C9E  E380 0000 0000  xent                 LNJ,B6   KVF$PST
          1 000CA1       0001                            DC       s:5795,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:261  
     1190     5794
     1191     5795    6                  END; ELSE DO;

   5795   1 000CA2  0F81 0187                            B        s:5890,PREL

     1192     5796        /* Tab isn't an activation character and it's not a forms space-field.
     1193     5797           If we're not in tab-relative mode; tab starting at the left margin.        */
     1194     5798
     1195     5799    6                     CALL Y$EDTX_TO_VRTCLM (R2);

   5799   1 000CA4  EBC7 000E                            LAB,B6   R2,AUTO
          1 000CA6  EFC7 0036                            STB,B6   OLDCLM+3,AUTO
          1 000CA8  E3C0 0442                            LNJ,B6   s:0,PREL
          1 000CAA       0001                            DC       s:5800,PREL

     1196     5800    6                     %KV_MVD.VRTCLM = R2;

   5800   1 000CAB  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000CAE  DCC6 0006                            LDB,B5   6,B6
          1 000CB0  E847 000E                            LDR,R6   R2,AUTO
          1 000CB2  EF45 001B                            STR,R6   27,B5

     1197     5801    6                     %KV_MVD.EDTRHT = '1'B;

   5801   1 000CB4  DCC6 0006                            LDB,B5   6,B6
          1 000CB6  8945 0015                            LBT,'0040'X       21,B5
          1 000CB8       0040

     1198     5802    6                     R2 = R2+DSPLOWCLM;

   5802   1 000CB9  EA47 0012                            ADD,R6   DSPLOWCLM,AUTO
          1 000CBB  EF47 000E                            STR,R6   R2,AUTO

     1199     5803    6                     IF OPRCNT=0 THEN R2 = R2+1;

   5803   1 000CBD  D847 0013                            LDR,R5   OPRCNT,AUTO
          1 000CBF  5981 0003                            BNEZ,R5  s:5804,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:262  

   5803   1 000CC1  8AC7 000E                            INC      R2,AUTO

     1200     5804    6                     IF OPRCNT<0 THEN %KV_MVD.EDTRHT = '0'B;

   5804   1 000CC3  5881 0006                            BGEZ,R5  s:5805,PREL

   5804   1 000CC5  DCC6 0006                            LDB,B5   6,B6
          1 000CC7  8845 0015                            LBF,'0040'X       21,B5
          1 000CC9       0040

     1201     5805    6                     IF %KV_MVD.TABRELATIVE

   5805   1 000CCA  DCC6 0006                            LDB,B5   6,B6
          1 000CCC  82C5 0015                            LB,'0004'X        21,B5
          1 000CCE       0004
          1 000CCF  0581 0009                            BBF      s:5810,PREL

     1202     5806        /* We're in tab-relative mode; tab relative to the position
     1203     5807           the prompt ended at.                                                       */
     1204     5808
     1205     5809    6                     THEN R2 = R2-%KV_SRD.PRMVRTCLM;

   5809   1 000CD1  CCC6 000A                            LDB,B4   10,B6
          1 000CD3  E847 000E                            LDR,R6   R2,AUTO
          1 000CD5  E244 0012                            SUB,R6   18,B4
          1 000CD7  EF47 000E                            STR,R6   R2,AUTO

     1206     5810    6                     B3 = %KV_MVD.INPTAB$;

   5810   1 000CD9  DCC6 0006                            LDB,B5   6,B6
          1 000CDB  CCC5 0004                            LDB,B4   4,B5
          1 000CDD  CFC7 000C                            STB,B4   B3,AUTO

     1207     5811    6                     R5 = SIZEC(KV$SHRBFR);

   5811   1 000CDF  6C0A                                 LDV,R6   10
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:263  
          1 000CE0  EF47 0010                            STR,R6   R5,AUTO

     1208     5812
     1209     5813    6                     IF OPRCNT>0 THEN R2 = OPRCNT;

   5813   1 000CE2  5A81 0005                            BLEZ,R5  s:5814,PREL

   5813   1 000CE4  DF47 000E                            STR,R5   R2,AUTO
          1 000CE6  0F81 0057                            B        s:5846,PREL

     1210     5814    6                     ELSE IF B3~=ADDR(NIL)

   5814   1 000CE8  8DC7 000C                            CMN      B3,AUTO
          1 000CEA  0901 0053                            BE       s:5846,PREL

     1211     5815    7                     THEN IF B3->KV$SHRBFR.BYTSIZ>=R5 THEN DO;

   5815   1 000CEC  6801 0005                            BLZ,R6   s:5818,PREL
          1 000CEE  E944 0002                            CMR,R6   2,B4
          1 000CF0  0301 004D                            BG       s:5846,PREL

     1212     5816        /* the tab buffer exists. */
     1213     5817
     1214     5818    7                        IF B3->KV$SHRBFR.BYT(1)>=R2

   5818   1 000CF2  C844 0004                            LDR,R4   4,B4
          1 000CF4  C570 00FF                            AND,R4   255,IMO
          1 000CF6  C947 000E                            CMR,R4   R2,AUTO
          1 000CF8  0801 000C                            BAL      s:5823,PREL

     1215     5819        /* The first tab is the one we want */
     1216     5820
     1217     5821    7                        THEN IF OPRCNT<0 THEN R2 = 1;

   5821   1 000CFA  5881 0006                            BGEZ,R5  s:5822,PREL

   5821   1 000CFC  3C01                                 LDV,R3   1
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:264  
          1 000CFD  BF47 000E                            STR,R3   R2,AUTO
          1 000CFF  0F81 002D                            B        s:5843,PREL

     1218     5822    7                        ELSE R2 = B3->KV$SHRBFR.BYT(1);

   5822   1 000D01  CF47 000E                            STR,R4   R2,AUTO
          1 000D03  0F81 0029                            B        s:5843,PREL

     1219     5823    7                        ELSE IF B3->KV$SHRBFR.BYT(1)~=0

   5823   1 000D05  82C4 0004                            LB,'00FF'X        4,B4
   5823   1 000D07       00FF
          1 000D08  0581 0024                            BBF      s:5843,PREL

     1220     5824        /* The first tab is not the last. */
     1221     5825
     1222     5826        /* This loop is traversed for each position in the tab buffer
     1223     5827           scanned, until the correct tab is found or the end is encountered.         */
     1224     5828
     1225     5829    8                        THEN TABLOOP: DO WHILE (R5<B3->KV$SHRBFR.BYTSIZ);

   5829   1 000D0A  6801 0005            TABLOOP         BLZ,R6   s:5830,PREL
          1 000D0C  E944 0002                            CMR,R6   2,B4
          1 000D0E  0281 001E                            BGE      s:5843,PREL

     1226     5830    8                           IF B3->KV$SHRBFR_BYT(R5)<=B3->KV$SHRBFR_BYT(R5-1)

   5830   1 000D10  ECC7 000C                            LDB,B6   B3,AUTO
          1 000D12  B847 0010                            LDR,R3   R5,AUTO
          1 000D14  E2B6                                 LLH,R6   ,B6,R3
          1 000D15  3EFF                                 ADV,R3   -1
          1 000D16  D2B6                                 LLH,R5   ,B6,R3
          1 000D17  E955                                 CMR,R6   R5
          1 000D18  0A81 0014                            BALE     s:5843,PREL

     1227     5831        /* The tabs must monotonically increase. */
     1228     5832
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:265  
     1229     5833    8                           THEN EXIT;
     1230     5834
     1231     5835    9                           IF B3->KV$SHRBFR_BYT(R5)>=R2 THEN DO;

   5835   1 000D1A  A847 0010                            LDR,R2   R5,AUTO
          1 000D1C  E2A6                                 LLH,R6   ,B6,R2
          1 000D1D  E947 000E                            CMR,R6   R2,AUTO
          1 000D1F  0801 0005                            BAL      s:5841,PREL

     1232     5836        /* The current tab stop is greater than the one we're looking for; we've found*/
     1233     5837
     1234     5838    9                              R2 = B3->KV$SHRBFR_BYT(R5);

   5838   1 000D21  EF47 000E                            STR,R6   R2,AUTO

     1235     5839    9                              EXIT TABLOOP;

   5839   1 000D23  0F81 0009                            B        s:5843,PREL

     1236     5840    9                           END /* IF */;
     1237     5841    8                           R5 = R5+1;

   5841   1 000D25  8AC7 0010                            INC      R5,AUTO

     1238     5842    8                        END /* LOOP */;

   5842   1 000D27  E847 0010                            LDR,R6   R5,AUTO
          1 000D29  6867                                 BLZ,R6   s:5830,SPREL
          1 000D2A  E946 0002                            CMR,R6   2,B6
          1 000D2C  0264                                 BL       s:5830,SPREL

     1239     5843    7                        IF OPRCNT<0 AND R2>1 THEN R2 = B3->KV$SHRBFR_BYT(R5-1);

   5843   1 000D2D  E847 0013                            LDR,R6   OPRCNT,AUTO
          1 000D2F  6881 000E                            BGEZ,R6  s:5846,PREL
          1 000D31  D847 000E                            LDR,R5   R2,AUTO
          1 000D33  5D01                                 CMV,R5   1
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:266  
          1 000D34  0A81 0009                            BALE     s:5846,PREL

   5843   1 000D36  ECC7 000C                            LDB,B6   B3,AUTO
          1 000D38  B847 0010                            LDR,R3   R5,AUTO
          1 000D3A  3EFF                                 ADV,R3   -1
          1 000D3B  D2B6                                 LLH,R5   ,B6,R3
          1 000D3C  DF47 000E                            STR,R5   R2,AUTO

     1240     5844    7                     END;

     1241     5845
     1242     5846    6                     IF %KV_MVD.TABRELATIVE THEN R2 = R2+%KV_SRD.PRMVRTCLM;

   5846   1 000D3E  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000D41  DCC6 0006                            LDB,B5   6,B6
          1 000D43  82C5 0015                            LB,'0004'X        21,B5
          1 000D45       0004
          1 000D46  0581 0009                            BBF      s:5847,PREL

   5846   1 000D48  CCC6 000A                            LDB,B4   10,B6
          1 000D4A  E847 000E                            LDR,R6   R2,AUTO
          1 000D4C  EA44 0012                            ADD,R6   18,B4
          1 000D4E  EF47 000E                            STR,R6   R2,AUTO

     1243     5847    7                     IF %KV_MVD.SPACEINSERT OR OPRCNT~=0 THEN DO;

   5847   1 000D50  DCC6 0006                            LDB,B5   6,B6
          1 000D52  82C5 0015                            LB,'0008'X        21,B5
          1 000D54       0008
          1 000D55  0501 0005                            BBT      s:5848,PREL
          1 000D57  E847 0013                            LDR,R6   OPRCNT,AUTO
          1 000D59  6901 0040                            BEZ,R6   s:5860,PREL

     1244     5848    7                        IF %KV_MVD.TABSIM THEN %KV_SSN.INPECH = SAVEBIT;

   5848   1 000D5B  82C5 0015                            LB,'0002'X        21,B5
   5848   1 000D5D       0002
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:267  
          1 000D5E  0581 0009                            BBF      s:5849,PREL

   5848   1 000D60  E847 0015                            LDR,R6   SAVEBIT,AUTO
          1 000D62  604F                                 SOR,R6   15
          1 000D63  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 000D65  EAC4 0028                            SRM,R6,'0001'X    40,B4
          1 000D67       0001

     1245     5849    7                        OPRCNT = R2-%KV_MVD.VRTCLM-DSPLOWCLM;

   5849   1 000D68  DCC6 0006                            LDB,B5   6,B6
          1 000D6A  E847 000E                            LDR,R6   R2,AUTO
          1 000D6C  E245 001B                            SUB,R6   27,B5
          1 000D6E  E247 0012                            SUB,R6   DSPLOWCLM,AUTO
          1 000D70  EF47 0013                            STR,R6   OPRCNT,AUTO

     1246     5850    7                        IF OPRCNT>0 THEN CALL Y$PSTRHT_TYP;

   5850   1 000D72  6A81 0006                            BLEZ,R6  s:5851,PREL

   5850   1 000D74  E3C0 07F8                            LNJ,B6   s:0,PREL
          1 000D76       0001                            DC       s:5850+5,PREL
          1 000D77  0F81 0009                            B        s:5855,PREL

     1247     5851    8                        ELSE IF OPRCNT<0 THEN DO;

   5851   1 000D79  6881 0007                            BGEZ,R6  s:5855,PREL

     1248     5852    8                           OPRCNT = -OPRCNT;

   5852   1 000D7B  8256                                 NEG      R6
          1 000D7C  EF47 0013                            STR,R6   OPRCNT,AUTO

     1249     5853    8                           CALL Y$PSTLFT;

   5853   1 000D7E  E3C0 0709                            LNJ,B6   s:0,PREL
          1 000D80       0001                            DC       s:5855,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:268  

     1250     5854    8                        END;

     1251     5855    7                        %KV_SSN.INPECH = SAVEBIT;

   5855   1 000D81  E847 0015                            LDR,R6   SAVEBIT,AUTO
          1 000D83  604F                                 SOR,R6   15
          1 000D84  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000D86  EAC6 0028                            SRM,R6,'0001'X    40,B6
          1 000D88       0001

     1252     5856    7                        IF %KV_MVD.TABSIM OR NOT %KV_SSN.REDRQSPND

   5856   1 000D89  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000D8C  CCC5 0006                            LDB,B4   6,B5
          1 000D8E  82C4 0015                            LB,'0002'X        21,B4
          1 000D90       0002
          1 000D91  0501 0110                            BBT      s:5934,PREL
          1 000D93  82C6 0028                            LB,'0002'X        40,B6
          1 000D95       0002
          1 000D96  0581 010B                            BBF      s:5934,PREL

     1253     5857    7                        THEN EXIT INPPRC;
     1254     5858    7                     END;

   5858   1 000D98  0F81 0012                            B        s:5864,PREL

     1255     5859    7                     ELSE DO;

     1256     5860    7                        %KV_SSN.INPCHR = BITASC(%ASCIIHT);

   5860   1 000D9A  5C09                                 LDV,R5   9
          1 000D9B  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 000D9D  D7C4 0029                            STH,R5   41,B4

     1257     5861    7                        CALL KVI$BFRREDCHR;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:269  
   5861   1 000D9F  CBF0 0000                            LAB,B4   0,IMO
          1 000DA1  E380 0000 0000  xent                 LNJ,B6   KVI$BFRREDCHR
          1 000DA4       0001                            DC       s:5862,PREL

     1258     5862    7                        REDBFR$ = %KV_SSN.REDBFR__.ADR$; /* Possible extension   */

   5862   1 000DA5  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000DA7  DCC6 0030                            LDB,B5   48,B6
          1 000DA9  DFC7 0008                            STB,B5   REDBFR$,AUTO

     1259     5863    7                     END /* IF */;

     1260     5864    6                     R2 = R2-DSPLOWCLM;

   5864   1 000DAB  E847 000E                            LDR,R6   R2,AUTO
          1 000DAD  E247 0012                            SUB,R6   DSPLOWCLM,AUTO
          1 000DAF  EF47 000E                            STR,R6   R2,AUTO

     1261     5865
     1262     5866    6                     IF %KV_VDI.RE_DSPINP THEN %KV_SRD.VRTPSTOK='0'B;

   5866   1 000DB1  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000DB4  CC85                                 LDB,B4   ,B5
          1 000DB5  82C4 0019                            LB,'0010'X        25,B4
          1 000DB7       0010
          1 000DB8  0581 0008                            BBF      s:5867,PREL

   5866   1 000DBA  BCC5 000A                            LDB,B3   10,B5
          1 000DBC  8843 000E                            LBF,'0010'X       14,B3
          1 000DBE       0010
          1 000DBF  0F81 006A                            B        s:5890,PREL

     1263     5867    7                     ELSE IF %KV_MVD.RETYPOVR OR %KV_MVD.DISPINPUT THEN DO;

   5867   1 000DC1  BCC5 0006                            LDB,B3   6,B5
          1 000DC3  82C3 0016                            LB,'0080'X        22,B3
          1 000DC5       0080
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:270  
          1 000DC6  0501 0006                            BBT      s:5868,PREL
          1 000DC8  82C3 0015                            LB,'0080'X        21,B3
          1 000DCA       0080
          1 000DCB  0581 005E                            BBF      s:5890,PREL

     1264     5868    7                        IF %KV_VDI.HALFDUPLEXPAPERTAPE THEN EXIT;

   5868   1 000DCD  82C4 0019                            LB,'0002'X        25,B4
   5868   1 000DCF       0002
          1 000DD0  0501 0059                            BBT      s:5890,PREL

     1265     5869    8                        IF %KV_MVD.TABSIM THEN DO;

   5869   1 000DD2  82C3 0015                            LB,'0002'X        21,B3
   5869   1 000DD4       0002
          1 000DD5  0581 0042                            BBF      s:5885,PREL

     1266     5870        /* We're in tab simulation mode; move the carriage manually.                  */
     1267     5871
     1268     5872    8                           IF %KV_MVD.RETYPOVR AND NOT %KV_SRD.VRTPSTOK

   5872   1 000DD7  82C3 0016                            LB,'0080'X        22,B3
   5872   1 000DD9       0080
          1 000DDA  0581 0011                            BBF      s:5876,PREL
          1 000DDC  ACC5 000A                            LDB,B2   10,B5
          1 000DDE  82C2 000E                            LB,'0010'X        14,B2
          1 000DE0       0010
          1 000DE1  0501 000A                            BBT      s:5876,PREL

     1269     5873        /* First restore current position in case of esc-q or esc-g                   */
     1270     5874
     1271     5875    8                           THEN CALL KVO$PST(KV_VDH_PST_VRT);

   5875   1 000DE3  BB80 0000 0002  02                   LAB,B3   +2
          1 000DE6  CBF0 0100                            LAB,B4   256,IMO
          1 000DE8  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 000DEB       0001                            DC       s:5876,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:271  

     1272     5876    8                           %KV_MVD.VRTCLM = R2;

   5876   1 000DEC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000DEF  DCC6 0006                            LDB,B5   6,B6
          1 000DF1  E847 000E                            LDR,R6   R2,AUTO
          1 000DF3  EF45 001B                            STR,R6   27,B5

     1273     5877        /* Now get to the new position                                                */
     1274     5878
     1275     5879    8                           IF %KV_MVD.HRZSCR

   5879   1 000DF5  DCC6 0006                            LDB,B5   6,B6
          1 000DF7  82C5 0016                            LB,'0004'X        22,B5
          1 000DF9       0004
          1 000DFA  0581 0012                            BBF      s:5882,PREL

     1276     5880    8                           THEN IF R2+%KV_MVD.HRZSCRMRG>%KV_MVD.WDT

   5880   1 000DFC  D2C5 0017                            LLH,R5   23,B5
          1 000DFE  DA56                                 ADD,R5   R6
          1 000DFF  5801 000D                            BLZ,R5   s:5882,PREL
          1 000E01  D945 0013                            CMR,R5   19,B5
          1 000E03  0381 0009                            BLE      s:5882,PREL

     1277     5881    8                           THEN CALL Y$SHFDSPPST;

   5881   1 000E05  CB80 0000 0000                       LAB,B4   0
          1 000E08  CFC7 0030                            STB,B4   DLT+1,AUTO
          1 000E0A  E3C0 09EC                            LNJ,B6   s:0,PREL
          1 000E0C       0001                            DC       s:5882,PREL

     1278     5882    8                           CALL KVO$PST(KV_VDH_PST_VRT);

   5882   1 000E0D  BB80 0000 0002  02                   LAB,B3   +2
          1 000E10  CBF0 0100                            LAB,B4   256,IMO
          1 000E12  E380 0000 0000  xent                 LNJ,B6   KVO$PST
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:272  
          1 000E15       0001                            DC       s:5883,PREL

     1279     5883    8                        END; ELSE DO;

   5883   1 000E16  0F81 0013                            B        s:5890,PREL

     1280     5884        /* We're not to simulate tabs; the device will do it for us (!?)              */
     1281     5885    8                           CALL KVO$OTP1_VRT (%ASCIIHT);

   5885   1 000E18  BB80 0000 0024  02                   LAB,B3   +36
          1 000E1B  CBF0 0100                            LAB,B4   256,IMO
          1 000E1D  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_VRT
          1 000E20       0001                            DC       s:5886,PREL

     1282     5886    8                           %KV_MVD.VRTCLM = R2;

   5886   1 000E21  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000E24  DCC6 0006                            LDB,B5   6,B6
          1 000E26  E847 000E                            LDR,R6   R2,AUTO
          1 000E28  EF45 001B                            STR,R6   27,B5

     1283     5887    8                        END /* IF */;

     1284     5888    7                     END /* IF */;

     1285     5889    6                  END /* IF */;

     1286     5890    5                  %KV_SSN.INPECH = SAVEBIT;

   5890   1 000E2A  E847 0015                            LDR,R6   SAVEBIT,AUTO
          1 000E2C  604F                                 SOR,R6   15
          1 000E2D  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000E2F  EAC6 0028                            SRM,R6,'0001'X    40,B6
          1 000E31       0001
          1 000E32  0F81 006F                            B        s:5934,PREL

     1287     5891        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:273  
     1288     5892    5               CASE (%KV_INPPRC_TGLINSMOD);

     1289     5893
     1290     5894        /* A toggle-insert-mode request. */
     1291     5895
     1292     5896    5                  IF %KV_SSN.REDBFR.INSMODX~=%KV_SSN.REDBFR.NXTX

   5896   1 000E34  E846 002E                            LDR,R6   46,B6
          1 000E36  E946 002A                            CMR,R6   42,B6
          1 000E38  0981 0007                            BNE      s:5898,PREL
          1 000E3A  D846 002D                            LDR,R5   45,B6
          1 000E3C  D946 0032                            CMR,R5   50,B6
          1 000E3E  0901 000C                            BE       s:5900,PREL

     1293     5897    5                    OR %KV_SSN.REDBFR.INSLOWX~=%KV_SSN.REDBFR__.BYTX
     1294     5898    5                  THEN CALL KVI$INTINPOPRX (%KV_INPOPRX_RSTINSMOD);

   5898   1 000E40  BB80 0000 0027  02                   LAB,B3   +39
          1 000E43  CBF0 0100                            LAB,B4   256,IMO
          1 000E45  E380 0000 0000  xent                 LNJ,B6   KVI$INTINPOPRX
          1 000E48       0001                            DC       s:5898+9,PREL
          1 000E49  0F81 0058                            B        s:5934,PREL

     1295     5899    6                  ELSE DO;

     1296     5900    6                     %KV_SSN.REDBFR.INSLOWX=%KV_SSN.REDBFR.EDTLOWX;

   5900   1 000E4B  D846 002B                            LDR,R5   43,B6
          1 000E4D  DF46 002D                            STR,R5   45,B6

   5900   1                              SETINSHI_X      null
     1297     5901    6   SETINSHI_X:       ;
     1298     5902    6                     %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.EDTLOWX;

   5902   1 000E4F  E846 002B            SETINSHI_X      LDR,R6   43,B6
          1 000E51  EF46 002E                            STR,R6   46,B6

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:274  
     1299     5903    6                     IF %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR.NXTX

   5903   1 000E53  E946 002A                            CMR,R6   42,B6
          1 000E55  0A81 0003                            BALE     s:5905,PREL

     1300     5904    6                     THEN %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR.EDTLOWX;

   5904   1 000E57  EF46 002A                            STR,R6   42,B6

     1301     5905    6                     IF (NOT %KV_MVD.EDITOVR OR NOT %KV_MVD.RETYPOVR)

   5905   1 000E59  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000E5C  CCC5 0006                            LDB,B4   6,B5
          1 000E5E  82C4 0016                            LB,'0040'X        22,B4
          1 000E60       0040
          1 000E61  0581 0006                            BBF      s:5905+15,PREL
          1 000E63  82C4 0016                            LB,'0080'X        22,B4
          1 000E65       0080
          1 000E66  0501 003B                            BBT      s:5934,PREL
          1 000E68  82C4 0015                            LB,'0080'X        21,B4
          1 000E6A       0080
          1 000E6B  0581 0036                            BBF      s:5934,PREL
          1 000E6D  E946 002A                            CMR,R6   42,B6
          1 000E6F  0881 0032                            BAGE     s:5934,PREL

     1302     5906
     1303     5907    6                       AND %KV_MVD.DISPINPUT
     1304     5908    7                       AND %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.NXTX THEN DO;

     1305     5909         /* We're not editing in place, so type the \                                  */
     1306     5910
     1307     5911    7                        CALL KVO$PST (KV_VDH_PST_WHTSPC);

   5911   1 000E71  BB80 0000 0029  02                   LAB,B3   +41
          1 000E74  CBF0 0100                            LAB,B4   256,IMO
          1 000E76  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 000E79       0001                            DC       s:5912,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:275  

     1308     5912    7                        CALL KVO$OTP1_VRT (%ASCIIBCKSLS);

   5912   1 000E7A  BB80 0000 0014  02                   LAB,B3   +20
          1 000E7D  CBF0 0100                            LAB,B4   256,IMO
          1 000E7F  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_VRT
          1 000E82       0001                            DC       s:5914,PREL

     1309     5913    7                     END /* IF */;

     1310     5914    6                  END /* IF */;

   5914   1 000E83  0F81 001E                            B        s:5934,PREL

     1311     5915        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:276  
     1312     5916    5               CASE (%KV_INPPRC_TGLLCLMOD);

     1313     5917    5               CASE(ELSE);

     1314     5918    5                  IF %KV_MVD.ORG=%KV#VD_ORG_SE THEN CALL KVE$INPOPR (KV$INPOPR)

   5918   1 000E85  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 000E88  ACC3 0006                            LDB,B2   6,B3
          1 000E8A  E2C2 0015                            LLH,R6   21,B2
          1 000E8C  6D05                                 CMV,R6   5
          1 000E8D  0981 000B                            BNE      s:5930,PREL

   5918   1 000E8F  BBC7 0006                            LAB,B3   INPOPR$,AUTO
          1 000E91  CBF0 0100                            LAB,B4   256,IMO
          1 000E93  E380 0000 0000  xent                 LNJ,B6   KVE$INPOPR
          1 000E96       0003                            DC       s:5930,PREL

     1315     5919    6                  WHENRETURN DO;

     1316     5920    6                     EXIT INPPRC;

   5920   1 000E97  0F81 000A                            B        s:5934,PREL

     1317     5921    6                  END;
     1318     5922        /* This function table has a bad entry -
     1319     5923           we dont know from this input procedure.                               */
     1320     5924
     1321     5925        /*S* SCREECH_CODE: KVI-S$KV_INPFNC
     1322     5926             MESSAGE: Bad INPPRC value in an input function table.              */
     1323     5927
     1324     5928                       %KH$SCREECH(COD = KVI_INPFNC);

   5930   1 000E99  BB80 0000 002B  02                   LAB,B3   +43
          1 000E9C  CBF0 0100                            LAB,B4   256,IMO
          1 000E9E  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          1 000EA1       0001                            DC       s:5934,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:277  
     1325     5932
     1326     5933    5               END /* CASE VDH- */ INPPRC;

     1327     5934    4               %KV_SSN.LSTPRMID = 0;

   5934   1 000EA2  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000EA4  87C6 003B                            CLH      59,B6

     1328     5935    4            END /* DO CASE */ INPOPR;

     1329     5936    3         END;

   5936   1 000EA6  0F81 0012                            B        s:5947,PREL

     1330     5937        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:278  
     1331     5938        /* Processing of this input operator isn't required during
     1332     5939           this phase.                                                                */
     1333     5940
     1334     5941    2         ELSE IF %KV_STR.SNDMAXNMBRCR>0

   5941   1 000EA8  CCC6 0004                            LDB,B4   4,B6
          1 000EAA  E844 0019                            LDR,R6   25,B4
          1 000EAC  6A81 000C                            BLEZ,R6  s:5947,PREL
          1 000EAE  BC86                                 LDB,B3   ,B6
          1 000EAF  82C3 001D                            LB,'0010'X        29,B3
          1 000EB1       0010
          1 000EB2  0501 0006                            BBT      s:5947,PREL

     1335     5942    2           AND NOT %KV_VDI.USRRQSDAT.RED
     1336     5943        /* There is a delayed read request that hasn't yet been enabled.
     1337     5944           set the delayed read request trigger.                                      */
     1338     5945
     1339     5946    2         THEN %KV_SSN.NO_WATREDTRG = '1'B;

   5946   1 000EB4  ACC7 000A                            LDB,B2   SSN$,AUTO
          1 000EB6  8942 0028                            LBT,'0004'X       40,B2
          1 000EB8       0004

     1340     5947    2         IF KV$INPOPR.TYP=%KV_INPOPR_TYP_JMP

   5947   1 000EB9  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 000EBB  E806                                 LDR,R6   ,B6
          1 000EBC  6048                                 SOR,R6   8
          1 000EBD  E570 000F                            AND,R6   15,IMO
          1 000EBF  6D03                                 CMV,R6   3
          1 000EC0  0981 000B                            BNE      s:5950,PREL

     1341     5948    2         THEN INPOPR$ = PINCRW (INPOPR$, 1-KV$INPOPR.INPOPRX);

   5948   1 000EC2  B806                                 LDR,R3   ,B6
          1 000EC3  B570 00FF                            AND,R3   255,IMO
          1 000EC5  8253                                 NEG      R3
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:279  
          1 000EC6  3E01                                 ADV,R3   1
          1 000EC7  DBB6                                 LAB,B5   ,B6,R3
          1 000EC8  DFC7 0006                            STB,B5   INPOPR$,AUTO
          1 000ECA  0F81 0023                            B        s:5958,PREL

     1342     5949
     1343     5950    2         ELSE IF NOT KV$INPOPR.CHN THEN EXIT;

   5950   1 000ECC  8286                                 LB,'2000'X        ,B6
   5950   1 000ECD       2000
          1 000ECE  0581 0023                            BBF      s:5960,PREL

     1344     5951        /* This input operator is chained, so go on to the next INPOPR.               */
     1345     5952
     1346     5953    2         ELSE IF KV$INPOPR.TYP=%KV_INPOPR_TYP_TXT

   5953   1 000ED0  6D09                                 CMV,R6   9
          1 000ED1  0981 000F                            BNE      s:5955,PREL

     1347     5954    2         THEN INPOPR$ = PINCRW (INPOPR$,KV$INPOPR_TXT.L/2+2);

   5954   1 000ED3  D2C6 0001                            LLH,R5   1,B6
          1 000ED5  5041                                 SOR,R5   1
          1 000ED6  F855                                 LDR,R7   R5
          1 000ED7  6C00                                 LDV,R6   0
          1 000ED8  8447 0006                            AID      INPOPR$,AUTO
          1 000EDA  8470 0000 0002                       AID      2,IMO
          1 000EDD  8D47 0006                            SDI      INPOPR$,AUTO
          1 000EDF  0F81 000E                            B        s:5958,PREL

     1348     5955    2         ELSE IF KV$INPOPR.TYP=%KV_INPOPR_TYP_PST

   5955   1 000EE1  6D05                                 CMV,R6   5
          1 000EE2  0981 0007                            BNE      s:5957,PREL

     1349     5956    2         THEN INPOPR$ = PINCRW (INPOPR$,SIZEW(KV$INPOPR_PST));

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:280  
   5956   1 000EE4  DBC6 0005                            LAB,B5   5,B6
          1 000EE6  DFC7 0006                            STB,B5   INPOPR$,AUTO
          1 000EE8  0F81 0005                            B        s:5958,PREL

     1350     5957    2         ELSE INPOPR$ = PINCRW (INPOPR$,SIZEW(KV$INPOPR));

   5957   1 000EEA  DBC6 0001                            LAB,B5   1,B6
          1 000EEC  DFC7 0006                            STB,B5   INPOPR$,AUTO

     1351     5958    2         OPRCNT = 0;

   5958   1 000EEE  8747 0013                            CL       OPRCNT,AUTO

     1352     5959    2      END /* LOOP */;

   5959   1 000EF0  0F81 F148                            B        s:4912,PREL

     1353     5960    1      IF NOT %KV_SSN.TYPAHD.BFRCHR AND VDH_INTINPOPR.IMD

   5960   1 000EF2  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 000EF4  82C5 0027                            LB,'0020'X        39,B5
          1 000EF6       0020
          1 000EF7  0501 000A                            BBT      s:5966,PREL
          1 000EF9  CCC7 0004                            LDB,B4   @VDH_PARM,AUTO
          1 000EFB  8284                                 LB,'0080'X        ,B4
          1 000EFC       0080
          1 000EFD  0581 0004                            BBF      s:5966,PREL

     1354     5961        /* We didn't ask to have the characters invoking this input
     1355     5962           function saved in the type-ahead buffer. Purge
     1356     5963           whatever part of the string may have been saved.                           */
     1357     5964
     1358     5965    1      THEN CALL Y$PRGTYPAHDINPFNC;

   5965   1 000EFF  E3C0 0550                            LNJ,B6   s:0,PREL
          1 000F01       0001                            DC       s:5966,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:281  
     1359     5966    1      RETURN;

   5966   1 000F02  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1360     5967        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:282  
     1361     5968    1   Y$ABRRED: PROC;

   5968   1 000F05  EFC7 0026            Y$ABRRED        STB,B6   FPT+16,AUTO

     1362     5969
     1363     5970        /* Abort any pending read.                                                    */
     1364     5971
     1365     5972        /* If a marker request message hasn't already been sent, send one.
     1366     5973           (MNTATNRQS and BRKRQS constitute marker requests.)                         */
     1367     5974
     1368     5975    2      CALL KVM$SND (KV_SND_RQSMRK_DLTRCVRQS);

   5975   1 000F07  BB80 0000 002D  02                   LAB,B3   +45
          1 000F0A  CBF0 0100                            LAB,B4   256,IMO
          1 000F0C  E380 0000 0000  xent                 LNJ,B6   KVM$SND
          1 000F0F       0001                            DC       s:5976,PREL

     1369     5976    2      IF NOT %KV_SSN.REDRQSPND THEN RETURN;

   5976   1 000F10  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 000F12  82C6 0028                            LB,'0002'X        40,B6
          1 000F14       0002
          1 000F15  0501 0005                            BBT      s:5979,PREL

   5976   1 000F17  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 000F19  C3C6 0001                            LNJ,B4   1,B6

     1370     5977        /* There is a read request pending.                                          */
     1371     5978
     1372     5979    2      %KV_SSN.REDRSPCNT = %KV_SSN.REDRSPCNT+1;

   5979   1 000F1B  8AC6 001B                            INC      27,B6
          1 000F1D  8EC6 001A                            CAD      26,B6

     1373     5980    2      CALL Y$PRGRED;

   5980   1 000F1F  E3C0 0448                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:283  
          1 000F21       0001                            DC       s:5981,PREL

     1374     5981    2      CALL Y$TRMRED;

   5981   1 000F22  EB80 0000 0000                       LAB,B6   0
          1 000F25  EFC7 002A                            STB,B6   @KV$INPOPR_DUMMY+2,AUTO
          1 000F27  E3C0 0CF8                            LNJ,B6   s:0,PREL
          1 000F29       0001                            DC       s:5982,PREL

     1375     5982    2      %KV_STR.SNDMAXNMBRCR = %KV_STR.SNDMAXNMBRCR-1;

   5982   1 000F2A  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000F2D  DCC6 0004                            LDB,B5   4,B6
          1 000F2F  88C5 0019                            DEC      25,B5

     1376     5983    2      RETURN;

   5983   1 000F31  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 000F33  C3C6 0001                            LNJ,B4   1,B6

     1377     5984    2   END;
     1378     5985        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:284  
     1379     5986    1   Y$BLKTYPAHD: PROC;

   5986   1 000F35  EFC7 0026            Y$BLKTYPAHD     STB,B6   FPT+16,AUTO

     1380     5987
     1381     5988        /* Hi non-blank physical position, saved.                                     */
     1382     5989
     1383     5990        %KV$PST(NAME=HI_NONBLN, STCLASS=AUTO, LVL=1);
     1384     6024
     1385     6025        /* Substructure describing the physical (cursor) position items.              */
     1386     6026
     1387     6027
     1388     6028        /* Current physical position, saved.                                          */
     1389     6029
     1390     6030        %KV$PST(NAME=CRT, STCLASS=AUTO, LVL=1);
     1391     6064
     1392     6065    2      IF NOT %KV_VDI.USRRQSDAT.RED

   6065   1 000F37  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000F3A  CC85                                 LDB,B4   ,B5
          1 000F3B  82C4 001D                            LB,'0010'X        29,B4
          1 000F3D       0010
          1 000F3E  0501 00E4                            BBT      s:6146,PREL

     1393     6066        /* There isn't a read outstanding, so it's ok to do type-ahead
     1394     6067           or to enable a delayed read.                                               */
     1395     6068
     1396     6069    2      THEN IF %KV_STR.SNDMAXNMBRCR~=0

   6069   1 000F40  BCC5 0004                            LDB,B3   4,B5
          1 000F42  E843 0019                            LDR,R6   25,B3
          1 000F44  6901 0008                            BEZ,R6   s:6081,PREL

     1397     6070        /* There is a delayed read request outstanding.                               */
     1398     6071
     1399     6072    2      THEN %KV_SSN.NO_WATREDTRG = '1'B;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:285  
   6072   1 000F46  ACC7 000A                            LDB,B2   SSN$,AUTO
          1 000F48  8942 0028                            LBT,'0004'X       40,B2
          1 000F4A       0004
          1 000F4B  0F81 00D7                            B        s:6146,PREL

     1400     6073    3      ELSE DO;

     1401     6074        /* There is no delayed read request outstanding.
     1402     6075           Do type-ahead.                                                             */
     1403     6076
     1404     6077        /* Set up the following on the next clear line.                               */
     1405     6078
     1406     6079        /* 'TYPE: '<input attribute> space for input <output attribute>               */
     1407     6080
     1408     6081    3         HI_NONBLN = %KV_SRD.HI_NONBLN;

   6081   1 000F4D  ACC5 000A                            LDB,B2   10,B5
          1 000F4F  8CC2 0017                            LDI      23,B2
          1 000F51  8D47 0028                            SDI      HI_NONBLN,AUTO

     1409     6082    3         CRT = %KV_SRD.CRT;

   6082   1 000F53  8CC2 0015                            LDI      21,B2
          1 000F55  8D47 002A                            SDI      CRT,AUTO

     1410     6083
     1411     6084        /* Position to the left margin of the next clear line, and display
     1412     6085           the prompt.                                                                */
     1413     6086
     1414     6087    3         %KV_SRD.HI_NONBLN.CLM = %KV_SRD.BTMRHT.CLM;

   6087   1 000F57  D842 000C                            LDR,R5   12,B2
          1 000F59  DF42 0018                            STR,R5   24,B2

     1415     6088    3         CALL KVO$PSTAFTHI_NONBLNPHSPST;

   6088   1 000F5B  CBF0 0000                            LAB,B4   0,IMO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:286  
          1 000F5D  E380 0000 0000  xent                 LNJ,B6   KVO$PSTAFTHI_NONBLNPHSPST
          1 000F60       0001                            DC       s:6089,PREL

     1416     6089    3         CALL KVO$OTPLCL (VDH_OTPLCL_TYPE);

   6089   1 000F61  BB80 0000 002F  02                   LAB,B3   +47
          1 000F64  CBF0 0100                            LAB,B4   256,IMO
          1 000F66  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 000F69       0001                            DC       s:6093,PREL

     1417     6090
     1418     6091        /* Set the attribute for the beginning of the input field.                    */
     1419     6092
     1420     6093    3         %USR_SETATR = KV_USR_SETATR;

   6093   1 000F6A  AB80 0000 0000  xsym                 LAB,B2   KV_USR_SETATR
          1 000F6D  2C00                                 LDV,R2   0
          1 000F6E  6C08                                 LDV,R6   8
          1 000F6F  BB87                                 LAB,B3   ,AUTO
          1 000F70  3C2C                                 LDV,R3   44
          1 000F71  0008                                 MMM

     1421     6094    3         %USR_SETATR.PHSPST = %KV_SRD.CRT;

   6094   1 000F72  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000F75  DCC6 000A                            LDB,B5   10,B6
          1 000F77  8CC5 0015                            LDI      21,B5
          1 000F79  8D47 0017                            SDI      FPT+1,AUTO

     1422     6095    3         %USR_SETATR.GRPRND = %KV_MRD.ABSGRPRND(%KV_ABSGRPRND_INPUT);

   6095   1 000F7B  DCC6 0008                            LDB,B5   8,B6
          1 000F7D  D2C5 001B                            LLH,R5   27,B5
          1 000F7F  5008                                 SOL,R5   8
          1 000F80  5048                                 SOR,R5   8
          1 000F81  DAC7 0019                            SRM,R5,'00FF'X    FPT+3,AUTO
          1 000F83       00FF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:287  

     1423     6096    3         %USR_SETATR.QLF.ACPALL = '1'B;

   6096   1 000F84  8947 0019                            LBT,'8000'X       FPT+3,AUTO
   6096   1 000F86       8000

     1424     6097    3         IF NOT %KV_MVD.DISPINPUT

   6097   1 000F87  DCC6 0006                            LDB,B5   6,B6
          1 000F89  82C5 0015                            LB,'0080'X        21,B5
          1 000F8B       0080
          1 000F8C  0501 0004                            BBT      s:6101,PREL

     1425     6098        /* We aren't to display the input data.                                       */
     1426     6099
     1427     6100    3         THEN %USR_SETATR.GRPRND.HDN = '1'B;

   6100   1 000F8E  8947 0019                            LBT,'0040'X       FPT+3,AUTO
   6100   1 000F90       0040

     1428     6101    3         CALL KVV$CALUSR (FPT);

   6101   1 000F91  DBC7 0016                            LAB,B5   FPT,AUTO
          1 000F93  DFC7 003A                            STB,B5   R+2,AUTO
          1 000F95  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000F97  CBF0 0100                            LAB,B4   256,IMO
          1 000F99  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 000F9C       0001                            DC       s:6105,PREL

     1429     6102
     1430     6103        /* Set the attribute for the end of the input field.                          */
     1431     6104
     1432     6105    3         %USR_SETATR.GRPRND = %KV_MRD.ABSGRPRND(%KV_ABSGRPRND_OUTPUT);

   6105   1 000F9D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000FA0  DCC6 0008                            LDB,B5   8,B6
          1 000FA2  E845 001B                            LDR,R6   27,B5
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:288  
          1 000FA4  EAC7 0019                            SRM,R6,'00FF'X    FPT+3,AUTO
          1 000FA6       00FF

     1433     6106    3         %USR_SETATR.QLF.PRT = '1'B;

   6106   1 000FA7  8947 0019                            LBT,'0400'X       FPT+3,AUTO
   6106   1 000FA9       0400

     1434     6107    3         %USR_SETATR.PHSPST.CLM = %KV_SRD.BTMRHT.CLM;

   6107   1 000FAA  DCC6 000A                            LDB,B5   10,B6
          1 000FAC  E845 000C                            LDR,R6   12,B5
          1 000FAE  EF47 0018                            STR,R6   FPT+2,AUTO

     1435     6108    3         %KV_SRD.FLDEND = %USR_SETATR.PHSPST;

   6108   1 000FB0  DCC6 000A                            LDB,B5   10,B6
          1 000FB2  8CC7 0017                            LDI      FPT+1,AUTO
          1 000FB4  8D45 0010                            SDI      16,B5

     1436     6109    3         %KV_VDI.USRRQSDAT.TYPAHD = '1'B;

   6109   1 000FB6  DC86                                 LDB,B5   ,B6
          1 000FB7  8945 001D                            LBT,'0008'X       29,B5
          1 000FB9       0008

     1437     6110    3         CALL KVV$CALUSR (FPT);

   6110   1 000FBA  DBC7 0016                            LAB,B5   FPT,AUTO
          1 000FBC  DFC7 003A                            STB,B5   R+2,AUTO
          1 000FBE  BBC7 003A                            LAB,B3   R+2,AUTO
          1 000FC0  CBF0 0100                            LAB,B4   256,IMO
          1 000FC2  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 000FC5       0001                            DC       s:6114,PREL

     1438     6111
     1439     6112        /* Position back to just after the attribute declaration.                     */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:289  
     1440     6113
     1441     6114    3         IF %KV_MRD.ATRRQRDSPPST

   6114   1 000FC6  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000FC9  DCC6 0008                            LDB,B5   8,B6
          1 000FCB  89C5 0018                            CMZ      24,B5
          1 000FCD  0881 0005                            BAGE     s:6118,PREL

     1442     6115        /* The attribute requires a display position. Skip over it.                   */
     1443     6116
     1444     6117    3         THEN %KV_SRD.CRT.CLM = %KV_SRD.CRT.CLM+1;

   6117   1 000FCF  CCC6 000A                            LDB,B4   10,B6
          1 000FD1  8AC4 0016                            INC      22,B4

     1445     6118    3         %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;

   6118   1 000FD3  DC86                                 LDB,B5   ,B6
          1 000FD4  6C01                                 LDV,R6   1
          1 000FD5  EF45 001A                            STR,R6   26,B5

     1446     6119    3         CALL KVV$CALUSR_PST;

   6119   1 000FD7  CBF0 0000                            LAB,B4   0,IMO
          1 000FD9  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          1 000FDC       0001                            DC       s:6125,PREL

     1447     6120
     1448     6121        /* Halt output. This is to prevent anything we do after this point
     1449     6122           from writing in our input field. The VDH-user always clears
     1450     6123           the halt condition when it receives input from the device.                 */
     1451     6124
     1452     6125    3         CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_HLTOTP);

   6125   1 000FDD  BB80 0000 0032  02                   LAB,B3   +50
          1 000FE0  CBF0 0100                            LAB,B4   256,IMO
          1 000FE2  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_EVT
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:290  
          1 000FE5       0001                            DC       s:6131,PREL

     1453     6126
     1454     6127        /* Erase the line we just declared for type-ahead.
     1455     6128           Reset a few things to the way they were (maybe adjusted) when
     1456     6129           we started setting up for type-ahead.                                      */
     1457     6130
     1458     6131    3         %KV_SRD.FLDEND.CLM = %KV_SRD.BTMRHT.CLM+1;

   6131   1 000FE6  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000FE9  DCC6 000A                            LDB,B5   10,B6
          1 000FEB  E845 000C                            LDR,R6   12,B5
          1 000FED  6E01                                 ADV,R6   1
          1 000FEE  EF45 0011                            STR,R6   17,B5

     1459     6132    3         %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;

   6132   1 000FF0  DCC6 000A                            LDB,B5   10,B6
          1 000FF2  E845 000A                            LDR,R6   10,B5
          1 000FF4  EF45 0016                            STR,R6   22,B5

     1460     6133    3         CALL KVO$ERSTO_ENDOF_INP;

   6133   1 000FF6  CBF0 0000                            LAB,B4   0,IMO
          1 000FF8  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_INP
          1 000FFB       0001                            DC       s:6135,PREL

     1461     6134        /*N* THE OBEV CALL SHOULD SAY DLTATR. */
     1462     6135    3         %KV_SRD.FLDEND = '0'B;

   6135   1 000FFC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000FFF  DCC6 000A                            LDB,B5   10,B6
          1 001001  8745 0010                            CL       16,B5
          1 001003  8745 0011                            CL       17,B5

     1463     6136    4         IF CRT.LIN>%USR_SETATR.PHSPST.LIN THEN DO;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:291  
   6136   1 001005  E847 002A                            LDR,R6   CRT,AUTO
          1 001007  E947 0017                            CMR,R6   FPT+1,AUTO
          1 001009  0A81 0009                            BALE     s:6142,PREL

     1464     6137        /* We must have wrapped to get past HI_NONBLN. */
     1465     6138
     1466     6139    4            CRT.LIN = %KV_SRD.TOPLFT.LIN;

   6139   1 00100B  DCC6 000A                            LDB,B5   10,B6
          1 00100D  E845 0009                            LDR,R6   9,B5
          1 00100F  EF47 002A                            STR,R6   CRT,AUTO

     1467     6140    4            HI_NONBLN.LIN = 0;

   6140   1 001011  8747 0028                            CL       HI_NONBLN,AUTO

     1468     6141    4         END /* IF */;

     1469     6142    3         %KV_SRD.HI_NONBLN = HI_NONBLN;

   6142   1 001013  DCC6 000A                            LDB,B5   10,B6
          1 001015  8CC7 0028                            LDI      HI_NONBLN,AUTO
          1 001017  8D45 0017                            SDI      23,B5

     1470     6143    3         %KV_SRD.CRT = CRT;

   6143   1 001019  DCC6 000A                            LDB,B5   10,B6
          1 00101B  8CC7 002A                            LDI      CRT,AUTO
          1 00101D  8D45 0015                            SDI      21,B5

     1471     6144    3         %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;

   6144   1 00101F  DC86                                 LDB,B5   ,B6
          1 001020  5C01                                 LDV,R5   1
          1 001021  DF45 001A                            STR,R5   26,B5

     1472     6145    3      END /* IF */;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:292  

     1473     6146    2      RETURN;

   6146   1 001023  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 001025  C3C6 0001                            LNJ,B4   1,B6

     1474     6147    2   END /* SUBROUTINE */;
     1475     6148        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:293  
     1476     6149    1   Y$ECHINPOPR: PROC;

   6149   1 001027  EFC7 0026            Y$ECHINPOPR     STB,B6   FPT+16,AUTO

     1477     6150
     1478     6151    2      IF NOT %KV_VDI.HALFDUPLEXPAPERTAPE

   6151   1 001029  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00102C  CC85                                 LDB,B4   ,B5
          1 00102D  82C4 0019                            LB,'0002'X        25,B4
          1 00102F       0002
          1 001030  0501 00B6                            BBT      s:6182,PREL
          1 001032  BCC5 0006                            LDB,B3   6,B5
          1 001034  E2C3 0015                            LLH,R6   21,B3
          1 001036  6D04                                 CMV,R6   4
          1 001037  0901 00AF                            BE       s:6182,PREL
          1 001039  82C5 001D                            LB,'0080'X        29,B5
          1 00103B       0080
          1 00103C  0501 00AA                            BBT      s:6182,PREL

     1479     6152    2        AND %KV_MVD.ORG~=%KV#VD_ORG_FORM
     1480     6153    3        AND NOT KV$PTR.USRINPFNCINH THEN DO;

     1481     6154        /* We are to print the character that invoked the escape
     1482     6155              sequence (or spcchr), bracketed by < and > .
     1483     6156           E.g., if ESC R was entered, print. <R>                                   */
     1484     6157
     1485     6158    3         SAVEBIT = %KV_SRD.TRUNCATE;

   6158   1 00103E  ACC5 000A                            LDB,B2   10,B5
          1 001040  D842 000E                            LDR,R5   14,B2
          1 001042  500D                                 SOL,R5   13
          1 001043  D570 8000                            AND,R5   -32768,IMO
          1 001045  DF47 0015                            STR,R5   SAVEBIT,AUTO

     1486     6159    3         %KV_SRD.TRUNCATE = '1'B;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:294  
   6159   1 001047  8942 000E                            LBT,'0004'X       14,B2
   6159   1 001049       0004

     1487     6160        /* Dont scroll because of these chars                                         */
     1488     6161
     1489     6162    3         CALL KVO$OTP1_NONVRT (%ASCIILFTARW);

   6162   1 00104A  BB80 0000 0035  02                   LAB,B3   +53
          1 00104D  CBF0 0100                            LAB,B4   256,IMO
          1 00104F  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 001052       0001                            DC       s:6163,PREL

     1490     6163    4         IF KV$INPOPR.TYP=%KV_INPOPR_TYP_TGLPRM AND KV$INPOPR.PRMID=0 THEN DO;

   6163   1 001053  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 001055  E806                                 LDR,R6   ,B6
          1 001056  6048                                 SOR,R6   8
          1 001057  E570 000F                            AND,R6   15,IMO
          1 001059  6D08                                 CMV,R6   8
          1 00105A  0981 002F                            BNE      s:6168,PREL
          1 00105C  8286                                 LB,'00FF'X        ,B6
          1 00105D       00FF
          1 00105E  0501 002B                            BBT      s:6168,PREL

     1491     6164    4            R5 = KV_PRMACK_TXTU(KV$PTR.INPCNDPND.OPRX);

   6164   1 001060  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 001063  B845 001C                            LDR,R3   28,B5
          1 001065  D830 0000 0020  00                   LDR,R5   KV_PRMACK_TXT,R3
          1 001068  DF47 0010                            STR,R5   R5,AUTO

     1492     6165    4            CALL KVO$OTP1_NONVRT (R5);

   6165   1 00106A  CBC7 0010                            LAB,B4   R5,AUTO
          1 00106C  CFC7 003A                            STB,B4   R+2,AUTO
          1 00106E  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001070  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:295  
          1 001072  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 001075       0001                            DC       s:6166,PREL

     1493     6166    4            CALL KVO$OTP1_NONVRT (BINBIT(R5,8));

   6166   1 001076  E847 0010                            LDR,R6   R5,AUTO
          1 001078  6008                                 SOL,R6   8
          1 001079  6048                                 SOR,R6   8
          1 00107A  E7C7 003A                            STH,R6   R+2,AUTO
          1 00107C  EBC7 003A                            LAB,B6   R+2,AUTO
          1 00107E  EFC7 003B                            STB,B6   R+3,AUTO
          1 001080  BBC7 003B                            LAB,B3   R+3,AUTO
          1 001082  CBF0 0100                            LAB,B4   256,IMO
          1 001084  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 001087       0001                            DC       s:6167,PREL

     1494     6167    4         END;

   6167   1 001088  0F81 002E                            B        s:6175,PREL

     1495     6168    4         ELSE IF VDH_INTINPOPR.ACKCHR<BITBIN(%ASCIISP) THEN DO;

   6168   1 00108A  DCC7 0004                            LDB,B5   @VDH_PARM,AUTO
          1 00108C  D845 0005                            LDR,R5   5,B5
          1 00108E  5D20                                 CMV,R5   32
          1 00108F  0881 001B                            BAGE     s:6174,PREL

     1496     6169        /* Ack control chars as the keytop char then C.                               */
     1497     6170
     1498     6171    4            CALL KVO$OTP1_NONVRT (VDH_INTINPOPR.ACKCHR+64);

   6171   1 001091  5E40                                 ADV,R5   64
          1 001092  DF47 003A                            STR,R5   R+2,AUTO
          1 001094  CBC7 003A                            LAB,B4   R+2,AUTO
          1 001096  CFC7 003B                            STB,B4   R+3,AUTO
          1 001098  BBC7 003B                            LAB,B3   R+3,AUTO
          1 00109A  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:296  
          1 00109C  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 00109F       0001                            DC       s:6172,PREL

     1499     6172    4            CALL KVO$OTP1_NONVRT ('C');

   6172   1 0010A0  BB80 0000 0038  02                   LAB,B3   +56
          1 0010A3  CBF0 0100                            LAB,B4   256,IMO
          1 0010A5  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 0010A8       0001                            DC       s:6173,PREL

     1500     6173    4         END /* IF */;

   6173   1 0010A9  0F81 000D                            B        s:6175,PREL

     1501     6174    3         ELSE CALL KVO$OTP1_NONVRT (VDH_INTINPOPR.ACKCHR);

   6174   1 0010AB  CBC5 0005                            LAB,B4   5,B5
          1 0010AD  CFC7 003A                            STB,B4   R+2,AUTO
          1 0010AF  BBC7 003A                            LAB,B3   R+2,AUTO
          1 0010B1  CBF0 0100                            LAB,B4   256,IMO
          1 0010B3  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 0010B6       0001                            DC       s:6175,PREL

     1502     6175    3         IF KV$INPOPR.TYP=%KV_INPOPR_TYP_TGLPRM

   6175   1 0010B7  ECC7 0006                            LDB,B6   INPOPR$,AUTO
          1 0010B9  E806                                 LDR,R6   ,B6
          1 0010BA  6048                                 SOR,R6   8
          1 0010BB  E570 000F                            AND,R6   15,IMO
          1 0010BD  6D08                                 CMV,R6   8
          1 0010BE  0981 0014                            BNE      s:6179,PREL

     1503     6176        /* For toggles, ACK the new state with + or - */
     1504     6177
     1505     6178    3         THEN CALL KVO$OTP1_NONVRT (ASCBIN('-')-2*%VDH_SETPRM.VAL);

   6178   1 0010C0  D847 0018                            LDR,R5   FPT+2,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:297  
          1 0010C2  5001                                 SOL,R5   1
          1 0010C3  8255                                 NEG      R5
          1 0010C4  5E2D                                 ADV,R5   45
          1 0010C5  DF47 003A                            STR,R5   R+2,AUTO
          1 0010C7  DBC7 003A                            LAB,B5   R+2,AUTO
          1 0010C9  DFC7 003B                            STB,B5   R+3,AUTO
          1 0010CB  BBC7 003B                            LAB,B3   R+3,AUTO
          1 0010CD  CBF0 0100                            LAB,B4   256,IMO
          1 0010CF  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 0010D2       0001                            DC       s:6179,PREL

     1506     6179    3         CALL KVO$OTP1_NONVRT (%ASCIIRHTARW);

   6179   1 0010D3  BB80 0000 003B  02                   LAB,B3   +59
          1 0010D6  CBF0 0100                            LAB,B4   256,IMO
          1 0010D8  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_NONVRT
          1 0010DB       0001                            DC       s:6180,PREL

     1507     6180    3         %KV_SRD.TRUNCATE = SAVEBIT;

   6180   1 0010DC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0010DF  DCC6 000A                            LDB,B5   10,B6
          1 0010E1  E847 0015                            LDR,R6   SAVEBIT,AUTO
          1 0010E3  604D                                 SOR,R6   13
          1 0010E4  EAC5 000E                            SRM,R6,'0004'X    14,B5
          1 0010E6       0004

     1508     6181    3      END /* IF */;

     1509     6182    2      RETURN;

   6182   1 0010E7  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 0010E9  C3C6 0001                            LNJ,B4   1,B6

     1510     6183    2   END;
     1511     6184        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:298  
     1512     6185    1   Y$EDTX_TO_VRTCLM: PROC (VRTCLM);

   6185   1 0010EB  EFC7 0034            Y$EDTX_TO_VRTCLMSTB,B6   OLDCLM+1,AUTO

     1513     6186
     1514     6187        /* Convert an edit index (index into KV$REDBFR.CHR) to a virtual
     1515     6188           column.                                                                    */
     1516     6189    2   DCL VRTCLM SBIN;
     1517     6190    2   DCL R SBIN;
     1518     6191
     1519     6192    2      EDTX = %KV_SSN.REDBFR.EDTLOWX;

   6192   1 0010ED  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0010EF  E845 002B                            LDR,R6   43,B5
          1 0010F1  EF47 0011                            STR,R6   EDTX,AUTO
          1 0010F3  0F81 0003                            B        s:6194,PREL

     1520     6193    2   Y$BYTX_TO_VRTCLM: ENTRY;

   6193   1 0010F5  EFC7 0034            Y$BYTX_TO_VRTCLMSTB,B6   OLDCLM+1,AUTO

     1521     6194    2      DSPLOWCLM = %KV_SSN.REDBFR.DSPLOWX;

   6194   1 0010F7  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0010F9  E845 002F                            LDR,R6   47,B5
          1 0010FB  EF47 0012                            STR,R6   DSPLOWCLM,AUTO

     1522     6195    2      R5 = 1+%KV_SRD.PRMVRTCLM;

   6195   1 0010FD  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 001100  BCC4 000A                            LDB,B3   10,B4
          1 001102  D843 0012                            LDR,R5   18,B3
          1 001104  5E01                                 ADV,R5   1
          1 001105  DF47 0010                            STR,R5   R5,AUTO

     1523     6196    2      IF %KV_SSN.CLMIS_BYTX

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:299  
   6196   1 001107  82C5 0037                            LB,'0080'X        55,B5
   6196   1 001109       0080
          1 00110A  0581 0008                            BBF      s:6199,PREL

     1524     6197    2      THEN R5 = R5+EDTX-DSPLOWCLM;

   6197   1 00110C  DA47 0011                            ADD,R5   EDTX,AUTO
          1 00110E  D256                                 SUB,R5   R6
          1 00110F  DF47 0010                            STR,R5   R5,AUTO
          1 001111  0F81 0099                            B        s:6233,PREL

     1525     6198    3      ELSE DO;

     1526     6199    3         IF EDTX=%KV_SSN.REDBFR.NXTX THEN %KV_SSN.CLMIS_BYTX = '1'B;

   6199   1 001113  C847 0011                            LDR,R4   EDTX,AUTO
          1 001115  C945 002A                            CMR,R4   42,B5
          1 001117  0981 0004                            BNE      s:6200,PREL

   6199   1 001119  8945 0037                            LBT,'0080'X       55,B5
   6199   1 00111B       0080

     1527     6200    3         R = %KV_SSN.REDBFR__.BYTX;

   6200   1 00111C  B845 0032                            LDR,R3   50,B5
          1 00111E  BF47 0038                            STR,R3   R,AUTO

     1528     6201    4         DO WHILE R<EDTX;

   6201   1 001120  B954                                 CMR,R3   R4
          1 001121  0881 0038                            BAGE     s:6213,PREL

     1529     6202    4            IF KV$REDBFR.CHR(R)>=' '

   6202   1 001123  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 001125  B847 0038                            LDR,R3   R,AUTO
          1 001127  E0B6                                 LDH,R6   ,B6,R3
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:300  
          1 001128  6D20                                 CMV,R6   32
          1 001129  0201 0008                            BL       s:6205,PREL
          1 00112B  6D7F                                 CMV,R6   127
          1 00112C  0901 0005                            BE       s:6205,PREL

     1530     6203    4              AND KV$REDBFR.CHR(R)~=BITASC(%ASCIIDEL) THEN R5 = R5+1;

   6203   1 00112E  8AC7 0010                            INC      R5,AUTO
          1 001130  0F81 0019                            B        s:6210,PREL

     1531     6204    5            ELSE DO;

     1532     6205    5               IF KV$REDBFR.CHR(R)=BITASC(%ASCIICR) THEN R5 = 1;

   6205   1 001132  6D0D                                 CMV,R6   13
          1 001133  0981 0006                            BNE      s:6206,PREL

   6205   1 001135  5C01                                 LDV,R5   1
          1 001136  DF47 0010                            STR,R5   R5,AUTO
          1 001138  0F81 0006                            B        s:6207,PREL

     1533     6206    5               ELSE IF KV$REDBFR.CHR(R)=BITASC(%ASCIIBS) THEN R5 = R5-1;

   6206   1 00113A  6D08                                 CMV,R6   8
          1 00113B  0981 0003                            BNE      s:6207,PREL

   6206   1 00113D  88C7 0010                            DEC      R5,AUTO

     1534     6207    5               IF R5=0 THEN R5 = R5+1;

   6207   1 00113F  E847 0010                            LDR,R6   R5,AUTO
          1 001141  6981 0003                            BNEZ,R6  s:6208,PREL

   6207   1 001143  8AC7 0010                            INC      R5,AUTO

     1535     6208    5               %KV_SSN.CLMIS_BYTX = '0'B;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:301  
   6208   1 001145  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001147  8845 0037                            LBF,'0080'X       55,B5
          1 001149       0080

     1536     6209    5            END;

     1537     6210    4            R = R+1;

   6210   1 00114A  8AC7 0038                            INC      R,AUTO

     1538     6211    4            IF R=DSPLOWCLM THEN DSPLOWCLM = -R5;

   6211   1 00114C  E847 0038                            LDR,R6   R,AUTO
          1 00114E  E947 0012                            CMR,R6   DSPLOWCLM,AUTO
          1 001150  0981 0006                            BNE      s:6212,PREL

   6211   1 001152  D847 0010                            LDR,R5   R5,AUTO
          1 001154  8255                                 NEG      R5
          1 001155  DF47 0012                            STR,R5   DSPLOWCLM,AUTO

     1539     6212    4         END /* LOOP */;

   6212   1 001157  E947 0011                            CMR,R6   EDTX,AUTO
          1 001159  084A                                 BAL      s:6202,SPREL

     1540     6213    4         IF DSPLOWCLM>0 THEN DO;

   6213   1 00115A  E847 0012                            LDR,R6   DSPLOWCLM,AUTO
          1 00115C  6A81 003D                            BLEZ,R6  s:6228,PREL

     1541     6214    4            VRTCLM = R5;                   /* Save the result for a while        */

   6214   1 00115E  ECC7 0036                            LDB,B6   @VRTCLM,AUTO
          1 001160  D847 0010                            LDR,R5   R5,AUTO
          1 001162  DF06                                 STR,R5   ,B6

     1542     6215    5            DO WHILE R<DSPLOWCLM;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:302  

   6215   1 001163  E947 0038                            CMR,R6   R,AUTO
          1 001165  0A81 002A                            BALE     s:6225,PREL

     1543     6216    5               IF KV$REDBFR.CHR(R)>=' ' AND KV$REDBFR.CHR(R)~=BITASC(%ASCIIDEL)

   6216   1 001167  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 001169  B847 0038                            LDR,R3   R,AUTO
          1 00116B  E0B6                                 LDH,R6   ,B6,R3
          1 00116C  6D20                                 CMV,R6   32
          1 00116D  0201 0008                            BL       s:6218,PREL
          1 00116F  6D7F                                 CMV,R6   127
          1 001170  0901 0005                            BE       s:6218,PREL

     1544     6217    5               THEN R5 = R5+1;

   6217   1 001172  8AC7 0010                            INC      R5,AUTO
          1 001174  0F81 0014                            B        s:6223,PREL

     1545     6218    5               ELSE IF KV$REDBFR.CHR(R)=BITASC(%ASCIICR) THEN R5 = 1;

   6218   1 001176  6D0D                                 CMV,R6   13
          1 001177  0981 0006                            BNE      s:6219,PREL

   6218   1 001179  5C01                                 LDV,R5   1
          1 00117A  DF47 0010                            STR,R5   R5,AUTO
          1 00117C  0F81 000C                            B        s:6223,PREL

     1546     6219    6               ELSE IF KV$REDBFR.CHR(R)=BITASC(%ASCIIBS) THEN DO;

   6219   1 00117E  6D08                                 CMV,R6   8
          1 00117F  0981 0009                            BNE      s:6223,PREL

     1547     6220    6                  R5 = R5-1;

   6220   1 001181  88C7 0010                            DEC      R5,AUTO

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:303  
     1548     6221    6                  IF R5=0 THEN R5 = R5+1;

   6221   1 001183  E847 0010                            LDR,R6   R5,AUTO
          1 001185  6981 0003                            BNEZ,R6  s:6223,PREL

   6221   1 001187  8AC7 0010                            INC      R5,AUTO

     1549     6222    6               END;

     1550     6223    5               R = R+1;

   6223   1 001189  8AC7 0038                            INC      R,AUTO

     1551     6224    5            END;

   6224   1 00118B  E847 0038                            LDR,R6   R,AUTO
          1 00118D  E947 0012                            CMR,R6   DSPLOWCLM,AUTO
          1 00118F  0858                                 BAL      s:6216,SPREL

     1552     6225    4            DSPLOWCLM = -R5;

   6225   1 001190  E847 0010                            LDR,R6   R5,AUTO
          1 001192  8256                                 NEG      R6
          1 001193  EF47 0012                            STR,R6   DSPLOWCLM,AUTO

     1553     6226    4            R5 = VRTCLM;

   6226   1 001195  ECC7 0036                            LDB,B6   @VRTCLM,AUTO
          1 001197  D806                                 LDR,R5   ,B6
          1 001198  DF47 0010                            STR,R5   R5,AUTO

     1554     6227    4         END;

     1555     6228    4         IF DSPLOWCLM~=0 THEN DO;

   6228   1 00119A  6901 0010                            BEZ,R6   s:6233,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:304  
     1556     6229    4            DSPLOWCLM = -DSPLOWCLM-%KV_SRD.PRMVRTCLM-1;

   6229   1 00119C  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00119F  DCC6 000A                            LDB,B5   10,B6
          1 0011A1  EA45 0012                            ADD,R6   18,B5
          1 0011A3  8656                                 CPL      R6
          1 0011A4  EF47 0012                            STR,R6   DSPLOWCLM,AUTO

     1557     6230    4            R5 = R5-DSPLOWCLM;

   6230   1 0011A6  E247 0010                            SUB,R6   R5,AUTO
          1 0011A8  8256                                 NEG      R6
          1 0011A9  EF47 0010                            STR,R6   R5,AUTO

     1558     6231    4         END;

     1559     6232    3      END;

     1560     6233    2      IF (NOT %KV_MVD.RETYPOVR OR NOT %KV_MVD.EDITOVR)

   6233   1 0011AB  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0011AE  DCC6 0006                            LDB,B5   6,B6
          1 0011B0  82C5 0016                            LB,'0080'X        22,B5
          1 0011B2       0080
          1 0011B3  0581 0006                            BBF      s:6233+15,PREL
          1 0011B5  82C5 0016                            LB,'0040'X        22,B5
          1 0011B7       0040
          1 0011B8  0501 000B                            BBT      s:6237,PREL
          1 0011BA  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 0011BC  E844 002E                            LDR,R6   46,B4
          1 0011BE  E944 002A                            CMR,R6   42,B4
          1 0011C0  0881 0003                            BAGE     s:6237,PREL

     1561     6234    2        AND %KV_SSN.REDBFR.INSMODX<%KV_SSN.REDBFR.NXTX THEN R5 = R5+1;

   6234   1 0011C2  8AC7 0010                            INC      R5,AUTO

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:305  
     1562     6235        /* Make room for the backslash if were inserting on hard-copy. */
     1563     6236
     1564     6237    2      VRTCLM = R5;

   6237   1 0011C4  DCC7 0036                            LDB,B5   @VRTCLM,AUTO
          1 0011C6  E847 0010                            LDR,R6   R5,AUTO
          1 0011C8  EF05                                 STR,R6   ,B5

     1565     6238    2      RETURN;

   6238   1 0011C9  ECC7 0034                            LDB,B6   OLDCLM+1,AUTO
          1 0011CB  C3C6 0001                            LNJ,B4   1,B6

     1566     6239    2   END;
     1567     6240        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:306  
     1568     6241    1   Y$FNDPSTCHR: PROC;

   6241   1 0011CD  EFC7 0026            Y$FNDPSTCHR     STB,B6   FPT+16,AUTO

     1569     6242
     1570     6243        /* Temp storage. */
     1571     6244
     1572     6245    2   DCL 1 TMP,
     1573     6246
     1574     6247        /* Char to search for. */
     1575     6248
     1576     6249    2          2 CHR CHAR(1),
     1577     6250
     1578     6251        /* ID.  For KVE$SE to know what to do. */
     1579     6252        /* In the same place as in KV$INPOPR. */
     1580     6253
     1581     6254    2          2 ID UBIN BYTE CALIGNED,
     1582     6255
     1583     6256        /* Reverse direction. We're currently searching in the reverse
     1584     6257           of the originally requested direction.                                     */
     1585     6258
     1586     6259    2          2 RVRDRC BIT(1),
     1587     6260
     1588     6261        /* Word search - position to the position after the search char (a blank). */
     1589     6262
     1590     6263    2          2 WRD BIT(1),
     1591     6264    2          2 * BIT(14);
     1592     6265    2   DCL TMPU REDEF TMP UBIN(32);
     1593     6266
     1594     6267        /* Find and position to given virtual column.                                 */
     1595     6268
     1596     6269    2      TMP = '0'B;

   6269   1 0011CF  8747 0028                            CL       TMP,AUTO
          1 0011D1  8747 0029                            CL       @KV$INPOPR_DUMMY+1,AUTO

     1597     6270    2      TMP.CHR = BINASC(R3);
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:307  

   6270   1 0011D3  E847 000F                            LDR,R6   R3,AUTO
          1 0011D5  6008                                 SOL,R6   8
          1 0011D6  6068                                 SAR,R6   8
          1 0011D7  E7C7 0028                            STH,R6   TMP,AUTO

     1598     6271    3      IF %KV_MVD.USRINPFNCTBL$~=ADDR(NIL) THEN DO;

   6271   1 0011D9  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0011DC  CCC5 0006                            LDB,B4   6,B5
          1 0011DE  8DC4 0008                            CMN      8,B4
          1 0011E0  0901 0054                            BE       s:6298,PREL

     1599     6272        /* First check that the char isn't a SPCCHR that's really just a translation. */
     1600     6273
     1601     6274    3         B3 = %KV_MVD.USRINPFNCTBL$;

   6274   1 0011E2  BCC4 0008                            LDB,B3   8,B4
          1 0011E4  BFC7 000C                            STB,B3   B3,AUTO

     1602     6275    3         IF B3->KV$INPFNCTBL.SPCCHR(VDH_INTINPOPR.ACKCHR)

   6275   1 0011E6  ACC7 0004                            LDB,B2   @VDH_PARM,AUTO
          1 0011E8  B842 0005                            LDR,R3   5,B2
          1 0011EA  9BC3 000B                            LAB,B1   11,B3
          1 0011EC  82B1                                 LB       ,B1,R3
          1 0011ED  0581 0047                            BBF      s:6298,PREL
          1 0011EF  D2C3 0009                            LLH,R5   9,B3
          1 0011F1  5901 0043                            BEZ,R5   s:6298,PREL

     1603     6276    4           AND B3->KV$INPFNCTBL.ID_CHRCNT(%KV_INPFNCTYP_SPCCHR)~=0 THEN DO;

     1604     6277        /* We've got a pretty good chance of finding it. */
     1605     6278
     1606     6279    4            CALL INDEX (R2, TMP.CHR, SUBSTR (B3->KV$INPFNCCHR,

   6279   1 0011F3  C843 0024                            LDR,R4   36,B3
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:308  
          1 0011F5  A854                                 LDR,R2   R4
          1 0011F6  E855                                 LDR,R6   R5
          1 0011F7  EA70 0100                            ADD,R6   256,IMO
          1 0011F9  0028                                 SRH      ;
          1 0011FA       4107 0028                                ALPHANUM(TMP,AUTO,,1),;
          1 0011FC       4407 003A                                BINARY(R+2,AUTO,,4),;
          1 0011FE       4023 0000                                ALPHANUM(0,B3,R2,,R6)
          1 001200  5381 0005                            CBE      s:6279+19,PREL
          1 001202  DF47 000E                            STR,R5   R2,AUTO
          1 001204  0F81 0030                            B        s:6298,PREL
          1 001206  B847 003B                            LDR,R3   R+3,AUTO
          1 001208  BF47 000E                            STR,R3   R2,AUTO

     1607     6280    4              B3->KV$INPFNCTBL.ID_CHROFS(%KV_INPFNCTYP_SPCCHR),
     1608     6281    4              B3->KV$INPFNCTBL.ID_CHRCNT(%KV_INPFNCTYP_SPCCHR)))
     1609     6282    5            WHENRETURN DO;

     1610     6283        /* It's there, check to see if it's a vanilla translation. */
     1611     6284
     1612     6285    5               B3 = PINCRW(B3, B3->KV$INPFNCTBL.INPOPROFS+B3->KV$INPFNCOPRX

   6285   1 00120A  BA43 001E                            ADD,R3   30,B3
          1 00120C  9843 002C                            LDR,R1   44,B3
          1 00120E  9A33                                 ADD,R1   ,B3,R3
          1 00120F  CB93                                 LAB,B4   ,B3,R1
          1 001210  CFC7 000C                            STB,B4   B3,AUTO

     1613     6286    5                 (B3->KV$INPFNCTBL.OPRX_OFS(%KV_INPFNCTYP_SPCCHR)+R2));
     1614     6287    5               IF B3->KV$INPOPR.TYP=%KV_INPOPR_TYP_TXT

   6287   1 001212  B804                                 LDR,R3   ,B4
          1 001213  3048                                 SOR,R3   8
          1 001214  B570 000F                            AND,R3   15,IMO
          1 001216  3D09                                 CMV,R3   9
          1 001217  0981 001D                            BNE      s:6298,PREL
          1 001219  9804                                 LDR,R1   ,B4
          1 00121A  9570 0003                            AND,R1   3,IMO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:309  
          1 00121C  1D02                                 CMV,R1   2
          1 00121D  0981 0017                            BNE      s:6298,PREL

     1615     6288    5                 AND B3->KV$INPOPR_TXT.DSP=%KV_INPOPR_TXT_DSP_TYPAHDBFR
     1616     6289    5               THEN IF B3->KV$INPOPR_TXT.L=1

   6289   1 00121F  E2C4 0001                            LLH,R6   1,B4
          1 001221  6D01                                 CMV,R6   1
          1 001222  0981 0009                            BNE      s:6291,PREL

     1617     6290    5               THEN TMP.CHR = SUBSTR (B3->KV$INPOPR_TXT.T,0,1);

   6290   1 001224  E844 0001                            LDR,R6   1,B4
          1 001226  6008                                 SOL,R6   8
          1 001227  6068                                 SAR,R6   8
          1 001228  E7C7 0028                            STH,R6   TMP,AUTO
          1 00122A  0F81 000A                            B        s:6298,PREL

     1618     6291    6               ELSE IF B3->KV$INPOPR_TXT.L=0 THEN DO;

   6291   1 00122C  6981 0008                            BNEZ,R6  s:6298,PREL

     1619     6292    6                  KV$PTR.INPCNDPND.INPOPR = '1'B; /* Try the next one            */

   6292   1 00122E  8945 001B                            LBT,'4000'X       27,B5
   6292   1 001230       4000

     1620     6293    6                  RETURN;

   6293   1 001231  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 001233  C3C6 0001                            LNJ,B4   1,B6

     1621     6294    6               END;
     1622     6295    5            END /* IF */;
     1623     6296    4         END /* IF */;

     1624     6297    3      END /* IF */;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:310  

     1625     6298    2      GOTO SUBCOMMON;

   6298   1 001235  0F81 0008                            B        s:6302,PREL

     1626     6299
     1627     6300    2   Y$FNDPSTWRD: ENTRY;

   6300   1 001237  EFC7 0026            Y$FNDPSTWRD     STB,B6   FPT+16,AUTO

     1628     6301
     1629     6302    2      TMPU = %BITBIN('20004000'X);

   6302   1 001239  8CF0 2000 4000                       LDI      536887296,IMO
          1 00123C  8D47 0028                            SDI      TMP,AUTO

   6302   1                              SUBCOMMON       null
     1630     6303    2   SUBCOMMON:;
     1631     6304    2      IF REDBFR$=ADDR(NIL) THEN RETURN;

   6304   1 00123E  8DC7 0008            SUBCOMMON       CMN      REDBFR$,AUTO
          1 001240  0981 0005                            BNE      s:6308,PREL

   6304   1 001242  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 001244  C3C6 0001                            LNJ,B4   1,B6

     1632     6305    3      DO WHILE '1'B;

     1633     6306        /* This loop is iterated (once) if we have to reverse direction. */
     1634     6307
     1635     6308    4         IF %KV_MVD.EDTRHT\TMP.RVRDRC THEN DO;

   6308   1 001246  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001249  DCC6 0006                            LDB,B5   6,B6
          1 00124B  E845 0015                            LDR,R6   21,B5
          1 00124D  6009                                 SOL,R6   9
          1 00124E  E570 8000                            AND,R6   -32768,IMO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:311  
          1 001250  D847 0029                            LDR,R5   @KV$INPOPR_DUMMY+1,AUTO
          1 001252  D570 8000                            AND,R5   -32768,IMO
          1 001254  E655                                 XOR,R6   R5
          1 001255  6901 0072                            BEZ,R6   s:6343,PREL

     1636     6309        /* We're to search to the right. */
     1637     6310
     1638     6311    4            R2 = %KV_SSN.REDBFR.EDTHI_X;

   6311   1 001257  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 001259  E844 002C                            LDR,R6   44,B4
          1 00125B  EF47 000E                            STR,R6   R2,AUTO

     1639     6312    4            IF NOT TMP.WRD THEN R2 = R2+1;

   6312   1 00125D  82C7 0029                            LB,'4000'X        @KV$INPOPR_DUMMY+1,AUTO
   6312   1 00125F       4000
          1 001260  0501 0003                            BBT      s:6313,PREL

   6312   1 001262  8AC7 000E                            INC      R2,AUTO

     1640     6313    4            R5 = %KV_SSN.REDBFR.INSMODX;

   6313   1 001264  C844 002E                            LDR,R4   46,B4
          1 001266  CF47 0010                            STR,R4   R5,AUTO

     1641     6314        /*N* PL6 BUG!
     1642     6315              IF R2<R5 THEN CALL INDEX (R2, TMP.CHR, SUBSTR(KV$REDBFR_CHR,R2,R5-R2))
     1643     6316                 WHENRETURN DO; */
     1644     6317    5            DO WHILE R2<R5;

   6317   1 001268  C947 000E                            CMR,R4   R2,AUTO
          1 00126A  0A81 0011                            BALE     s:6321,PREL

     1645     6318    5               IF KV$REDBFR.CHR(R2) = TMP.CHR THEN EXIT;

   6318   1 00126C  ECC7 0008                            LDB,B6   REDBFR$,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:312  
          1 00126E  B847 000E                            LDR,R3   R2,AUTO
          1 001270  E0B6                                 LDH,R6   ,B6,R3
          1 001271  E1C7 0028                            CMH,R6   TMP,AUTO
          1 001273  0901 0008                            BE       s:6321,PREL

     1646     6319    5               R2 = R2+1;

   6319   1 001275  8AC7 000E                            INC      R2,AUTO

     1647     6320    5            END;

   6320   1 001277  E847 000E                            LDR,R6   R2,AUTO
          1 001279  E947 0010                            CMR,R6   R5,AUTO
          1 00127B  0871                                 BAL      s:6318,SPREL

     1648     6321    4            IF TMP.WRD

   6321   1 00127C  82C7 0029                            LB,'4000'X        @KV$INPOPR_DUMMY+1,AUTO
   6321   1 00127E       4000
          1 00127F  0581 0011                            BBF      s:6325,PREL

     1649     6322    5            THEN DO WHILE R2<R5 AND KV$REDBFR.CHR(R2)=' ';

   6322   1 001281  0F81 0003                            B        s:6324,PREL

     1650     6323    5               R2 = R2+1;

   6323   1 001283  8AC7 000E                            INC      R2,AUTO

     1651     6324    5            END;

   6324   1 001285  E847 000E                            LDR,R6   R2,AUTO
          1 001287  E947 0010                            CMR,R6   R5,AUTO
          1 001289  0881 0007                            BAGE     s:6325,PREL
          1 00128B  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 00128D  B856                                 LDR,R3   R6
          1 00128E  D0B6                                 LDH,R5   ,B6,R3
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:313  
          1 00128F  5D20                                 CMV,R5   32
          1 001290  0973                                 BE       s:6323,SPREL

     1652     6325    5            IF R2<R5 THEN DO;              /**/

   6325   1 001291  E847 000E                            LDR,R6   R2,AUTO
          1 001293  E947 0010                            CMR,R6   R5,AUTO
          1 001295  0881 009E                            BAGE     s:6366,PREL

     1653     6326        /*N* END OF PL6 BUG SUBTERFUGE. */
     1654     6327        /* Found one, get us positioned there. */
     1655     6328
     1656     6329    5               IF TMP.CHR = %BITASC(ASCIIBS) THEN R2 = R2-1;

   6329   1 001297  D0C7 0028                            LDH,R5   TMP,AUTO
          1 001299  5D08                                 CMV,R5   8
          1 00129A  0981 0003                            BNE      s:6330,PREL

   6329   1 00129C  88C7 000E                            DEC      R2,AUTO

     1657     6330    5               %KV_SSN.REDBFR.EDTHI_X = R2;

   6330   1 00129E  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0012A0  E847 000E                            LDR,R6   R2,AUTO
          1 0012A2  EF46 002C                            STR,R6   44,B6

     1658     6331    5               R2 = %KV_SSN.REDBFR.EDTLOWX;

   6331   1 0012A4  E846 002B                            LDR,R6   43,B6
          1 0012A6  EF47 000E                            STR,R6   R2,AUTO

     1659     6332    5               CALL Y$SCPVRTCLMHI_X;

   6332   1 0012A8  E3C0 04AD                            LNJ,B6   s:0,PREL
          1 0012AA       0001                            DC       s:6333,PREL

     1660     6333    5               %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX-1;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:314  

   6333   1 0012AB  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0012AD  E846 002B                            LDR,R6   43,B6
          1 0012AF  6EFF                                 ADV,R6   -1
          1 0012B0  EF46 002C                            STR,R6   44,B6

     1661     6334    5               %KV_SSN.REDBFR.EDTLOWX = R2;

   6334   1 0012B2  D847 000E                            LDR,R5   R2,AUTO
          1 0012B4  DF46 002B                            STR,R5   43,B6

     1662     6335    5               CALL Y$TYPREDBFRSGM;

   6335   1 0012B6  E3C0 0B54                            LNJ,B6   s:0,PREL
          1 0012B8       0001                            DC       s:6336,PREL

     1663     6336    5               CALL Y$SCPVRTCLMLOWX;

   6336   1 0012B9  E3C0 04E3                            LNJ,B6   s:0,PREL
          1 0012BB       0001                            DC       s:6337,PREL

     1664     6337    5               %KV_MVD.EDTRHT = '1'B;

   6337   1 0012BC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0012BF  DCC6 0006                            LDB,B5   6,B6
          1 0012C1  8945 0015                            LBT,'0040'X       21,B5
          1 0012C3       0040

     1665     6338    5               RETURN;

   6338   1 0012C4  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 0012C6  C3C6 0001                            LNJ,B4   1,B6

     1666     6339    5            END;
     1667     6340    4         END; ELSE DO;

     1668     6341        /* We're to search to the left. */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:315  
     1669     6342
     1670     6343    4            R2 = %KV_SSN.REDBFR.EDTLOWX;

   6343   1 0012C8  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 0012CA  E844 002B                            LDR,R6   43,B4
          1 0012CC  EF47 000E                            STR,R6   R2,AUTO

     1671     6344    4            R5 = %KV_SSN.REDBFR.INSLOWX;

   6344   1 0012CE  C844 002D                            LDR,R4   45,B4
          1 0012D0  CF47 0010                            STR,R4   R5,AUTO

     1672     6345    5            IF TMP.WRD THEN DO WHILE R2>R5;

   6345   1 0012D2  82C7 0029                            LB,'4000'X        @KV$INPOPR_DUMMY+1,AUTO
   6345   1 0012D4       4000
          1 0012D5  0581 0014                            BBF      s:6349,PREL

   6345   1 0012D7  E954                                 CMR,R6   R4
          1 0012D8  0A81 0011                            BALE     s:6349,PREL

     1673     6346    5               IF KV$REDBFR.CHR(R2-1)~=' ' THEN EXIT;

   6346   1 0012DA  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 0012DC  B847 000E                            LDR,R3   R2,AUTO
          1 0012DE  3EFF                                 ADV,R3   -1
          1 0012DF  E0B6                                 LDH,R6   ,B6,R3
          1 0012E0  6D20                                 CMV,R6   32
          1 0012E1  0981 0008                            BNE      s:6349,PREL

     1674     6347    5               R2 = R2-1;

   6347   1 0012E3  88C7 000E                            DEC      R2,AUTO

     1675     6348    5            END;

   6348   1 0012E5  E847 000E                            LDR,R6   R2,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:316  
          1 0012E7  E947 0010                            CMR,R6   R5,AUTO
          1 0012E9  0A71                                 BAG      s:6346,SPREL

     1676     6349    5            DO WHILE R2>R5;

   6349   1 0012EA  E847 000E                            LDR,R6   R2,AUTO
          1 0012EC  E947 0010                            CMR,R6   R5,AUTO
          1 0012EE  0A81 0045                            BALE     s:6366,PREL

     1677     6350    5               R2 = R2-1;

   6350   1 0012F0  88C7 000E                            DEC      R2,AUTO

     1678     6351    5               IF KV$REDBFR.CHR(R2)=TMP.CHR

   6351   1 0012F2  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 0012F4  B847 000E                            LDR,R3   R2,AUTO
          1 0012F6  E0B6                                 LDH,R6   ,B6,R3
          1 0012F7  E1C7 0028                            CMH,R6   TMP,AUTO
          1 0012F9  0901 000A                            BE       s:6355,PREL
          1 0012FB  82C7 0029                            LB,'4000'X        @KV$INPOPR_DUMMY+1,AUTO
          1 0012FD       4000
          1 0012FE  0581 0031                            BBF      s:6364,PREL
          1 001300  B947 0010                            CMR,R3   R5,AUTO
          1 001302  0981 002D                            BNE      s:6364,PREL

     1679     6352    6                 OR TMP.WRD AND R2=R5 THEN DO;

     1680     6353        /* Found one, get us positioned there. */
     1681     6354
     1682     6355    6                  IF KV$REDBFR.CHR(R2)=' ' AND TMP.WRD THEN R2 = R2+1;

   6355   1 001304  6D20                                 CMV,R6   32
          1 001305  0981 0008                            BNE      s:6356,PREL
          1 001307  82C7 0029                            LB,'4000'X        @KV$INPOPR_DUMMY+1,AUTO
          1 001309       4000
          1 00130A  0581 0003                            BBF      s:6356,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:317  

   6355   1 00130C  8AC7 000E                            INC      R2,AUTO

     1683     6356    6                  IF TMP.CHR=%BITASC(ASCIIBS) THEN R2 = R2-1;

   6356   1 00130E  E0C7 0028                            LDH,R6   TMP,AUTO
          1 001310  6D08                                 CMV,R6   8
          1 001311  0981 0003                            BNE      s:6357,PREL

   6356   1 001313  88C7 000E                            DEC      R2,AUTO

     1684     6357    6                  %KV_SSN.REDBFR.EDTLOWX = R2;

   6357   1 001315  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001317  D847 000E                            LDR,R5   R2,AUTO
          1 001319  DF45 002B                            STR,R5   43,B5

     1685     6358    6                  CALL Y$SCPVRTCLMLOWX;

   6358   1 00131B  E3C0 0481                            LNJ,B6   s:0,PREL
          1 00131D       0001                            DC       s:6359,PREL

     1686     6359    6                  CALL Y$SCPVRTCLMHI_X;

   6359   1 00131E  E3C0 0437                            LNJ,B6   s:0,PREL
          1 001320       0001                            DC       s:6360,PREL

     1687     6360    6                  CALL Y$PSTLFT_N;

   6360   1 001321  E3C0 01DE                            LNJ,B6   s:0,PREL
          1 001323       0001                            DC       s:6361,PREL

     1688     6361    6                  %KV_MVD.EDTRHT = '0'B;

   6361   1 001324  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001327  DCC6 0006                            LDB,B5   6,B6
          1 001329  8845 0015                            LBF,'0040'X       21,B5
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:318  
          1 00132B       0040

     1689     6362    6                  RETURN;

   6362   1 00132C  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 00132E  C3C6 0001                            LNJ,B4   1,B6

     1690     6363    6               END /* IF */;
     1691     6364    5            END /* LOOP */;

   6364   1 001330  B947 0010                            CMR,R3   R5,AUTO
          1 001332  0A01 FFBD                            BAG      s:6350,PREL

     1692     6365    4         END /* IF */;

     1693     6366    4         IF %KV_MVD.RCRWRAP THEN DO;

   6366   1 001334  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001337  DCC6 0006                            LDB,B5   6,B6
          1 001339  82C5 001F                            LB,'0080'X        31,B5
          1 00133B       0080
          1 00133C  0581 0016                            BBF      s:6372,PREL

     1694     6367    4            TMP.ID = KV$INPOPR.ID;

   6367   1 00133E  CCC7 0006                            LDB,B4   INPOPR$,AUTO
          1 001340  E804                                 LDR,R6   ,B4
          1 001341  EAC7 0028                            SRM,R6,'00FF'X    TMP,AUTO
          1 001343       00FF

     1695     6368    5            CALL KVE$INPOPR (TMP) WHENRETURN DO;

   6368   1 001344  DBC7 0028                            LAB,B5   TMP,AUTO
          1 001346  DFC7 003A                            STB,B5   R+2,AUTO
          1 001348  BBC7 003A                            LAB,B3   R+2,AUTO
          1 00134A  CBF0 0100                            LAB,B4   256,IMO
          1 00134C  E380 0000 0000  xent                 LNJ,B6   KVE$INPOPR
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:319  
          1 00134F       0004                            DC       s:6372,PREL

     1696     6369    5               TMP.RVRDRC = '1'B;

   6369   1 001350  8947 0029                            LBT,'8000'X       @KV$INPOPR_DUMMY+1,AUTO
   6369   1 001352       8000

     1697     6370    5            END;

     1698     6371    4         END;

     1699     6372    3         IF TMP.RVRDRC OR %KV_SSN.LSTPRMID=%KV_PRMID_EDTRHT THEN RETURN;

   6372   1 001353  89C7 0029                            CMZ      @KV$INPOPR_DUMMY+1,AUTO
          1 001355  0801 0009                            BAL      s:6372+12,PREL
          1 001357  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001359  E2C6 003B                            LLH,R6   59,B6
          1 00135B  E970 0087                            CMR,R6   135,IMO
          1 00135D  0981 0005                            BNE      s:6374,PREL

   6372   1 00135F  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 001361  C3C6 0001                            LNJ,B4   1,B6

     1700     6373        /* Already tried reversing directions, give up. */
     1701     6374    3         TMP.RVRDRC = '1'B;

   6374   1 001363  8947 0029                            LBT,'8000'X       @KV$INPOPR_DUMMY+1,AUTO
   6374   1 001365       8000

     1702     6375    3      END /* LOOP */;

   6375   1 001366  0F81 FEDF                            B        s:6308,PREL

     1703     6376    2   END;
     1704     6377        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:320  
     1705     6378    1   Y$PRGRED: PROC;

   6378   1 001368  EFC7 0028            Y$PRGRED        STB,B6   TMP,AUTO

     1706     6379
     1707     6380        /* Release the read buffer.                                                   */
     1708     6381
     1709     6382    3      IF REDBFR$~= ADDR(NIL) THEN DO;

   6382   1 00136A  8DC7 0008                            CMN      REDBFR$,AUTO
          1 00136C  0901 0052                            BE       s:6402,PREL

     1710     6383        /* There is a read buffer.                                                    */
     1711     6384
     1712     6385    3         IF %KV_SSN.REDBFR__.DATBYTSIZ~=0

   6385   1 00136E  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001370  E845 0033                            LDR,R6   51,B5
          1 001372  6901 0008                            BEZ,R6   s:6390,PREL

     1713     6386        /* The read buffer isn't empty.                                               */
     1714     6387
     1715     6388    3         THEN %KV_VDI.PRG.RED = '1'B;

   6388   1 001374  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 001377  BC84                                 LDB,B3   ,B4
          1 001378  8943 0018                            LBT,'0200'X       24,B3
          1 00137A       0200

     1716     6389
     1717     6390    3         %VDH_RLSBFR = KV_VDH_RLSBFR;

   6390   1 00137B  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_RLSBFR
          1 00137E  2C00                                 LDV,R2   0
          1 00137F  6C0E                                 LDV,R6   14
          1 001380  BB87                                 LAB,B3   ,AUTO
          1 001381  3C2C                                 LDV,R3   44
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:321  
          1 001382  0008                                 MMM

     1718     6391    3         %VDH_RLSBFR.STRTYP = %KV_STRTYP_REDBFR;

   6391   1 001383  6C11                                 LDV,R6   17
          1 001384  E7C7 001C                            STH,R6   FPT+6,AUTO

     1719     6392    3         %VDH_RLSBFR.BFR$ = REDBFR$;

   6392   1 001386  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 001388  EFC7 0017                            STB,B6   FPT+1,AUTO

     1720     6393    3         %VDH_RLSBFR.BYTSIZ = %KV_SSN.REDBFR__.BFRBYTSIZ;

   6393   1 00138A  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 00138C  D845 0034                            LDR,R5   52,B5
          1 00138E  DF47 0019                            STR,R5   FPT+3,AUTO

     1721     6394    3         CALL KVS$RLSBFR (FPT);

   6394   1 001390  CBC7 0016                            LAB,B4   FPT,AUTO
          1 001392  CFC7 003A                            STB,B4   R+2,AUTO
          1 001394  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001396  CBF0 0100                            LAB,B4   256,IMO
          1 001398  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 00139B       0001                            DC       s:6395,PREL

     1722     6395    3         %KV_SSN.REDBFR__ = '0'B;

   6395   1 00139C  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 00139E  5C0C                                 LDV,R5   12
          1 00139F  0021                                 ALR      ;
          1 0013A0       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0013A2       4006 0030                                ALPHANUM(48,B6,,R5,FILL)

     1723     6396    3         FPT(0) = %KV_SSN.REDBFR.DSPLOWX;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:322  
   6396   1 0013A4  E846 002F                            LDR,R6   47,B6
          1 0013A6  EF47 0016                            STR,R6   FPT,AUTO

     1724     6397    3         %KV_SSN.REDBFR = '0'B;

   6397   1 0013A8  0021                                 ALR      ;
          1 0013A9       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0013AB       4006 002A                                ALPHANUM(42,B6,,R5,FILL)

     1725     6398    3         IF %KV_MVD.ORG=%KV#VD_ORG_SE

   6398   1 0013AD  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0013B0  437F                                 CSYNC    s:6398+2,SPREL
          1 0013B1  CCC5 0006                            LDB,B4   6,B5
          1 0013B3  C2C4 0015                            LLH,R4   21,B4
          1 0013B5  4D05                                 CMV,R4   5
          1 0013B6  0981 0003                            BNE      s:6400,PREL

     1726     6399    3         THEN %KV_SSN.REDBFR.DSPLOWX = FPT(0);

   6399   1 0013B8  EF46 002F                            STR,R6   47,B6

     1727     6400    3         REDBFR$ = ADDR(NIL);

   6400   1 0013BA  CB80 0000 0000                       LAB,B4   0
          1 0013BD  CFC7 0008                            STB,B4   REDBFR$,AUTO

     1728     6401    3      END /* IF */;

     1729     6402    2      %KV_SSN.CLMIS_BYTX = '1'B;

   6402   1 0013BF  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0013C1  8946 0037                            LBT,'0080'X       55,B6
          1 0013C3       0080

     1730     6403    2      %KV_VDI.RE_DSPLOWX = 0;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:323  
   6403   1 0013C4  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0013C7  CC85                                 LDB,B4   ,B5
          1 0013C8  8744 0016                            CL       22,B4

     1731     6404    2      RETURN;

   6404   1 0013CA  ECC7 0028                            LDB,B6   TMP,AUTO
          1 0013CC  C3C6 0001                            LNJ,B4   1,B6

     1732     6405    2   END;
     1733     6406        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:324  
     1734     6407    1   Y$PRGTYPAHD: PROC;

   6407   1 0013CE  EFC7 0026            Y$PRGTYPAHD     STB,B6   FPT+16,AUTO

     1735     6408        /* type-ahead delete - delete all type-ahead in the type-ahead buffers
     1736     6409        except any partially bufferred input function sequence.                       */
     1737     6410
     1738     6411    2      B3 = %KV_SSN.TYPAHDBFRHED$;

   6411   1 0013D0  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0013D2  CCC5 000A                            LDB,B4   10,B5
          1 0013D4  CFC7 000C                            STB,B4   B3,AUTO

     1739     6412    2      IF B3->KV$TYPAHDBFR.CHRX>B3->KV$TYPAHDBFR.CHRX_HI

   6412   1 0013D6  E844 0002                            LDR,R6   2,B4
          1 0013D8  6048                                 SOR,R6   8
          1 0013D9  E570 007F                            AND,R6   127,IMO
          1 0013DB  D844 0002                            LDR,R5   2,B4
          1 0013DD  D570 00FF                            AND,R5   255,IMO
          1 0013DF  E955                                 CMR,R6   R5
          1 0013E0  0A81 0005                            BALE     s:6424,PREL

     1740     6413
     1741     6414        /* the head type-ahead buffer is empty, so we're not                          */
     1742     6415        /* deleting type-ahead.                                                       */
     1743     6416
     1744     6417    2      THEN RETURN;

   6417   1 0013E2  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 0013E4  C3C6 0001                            LNJ,B4   1,B6

     1745     6418
     1746     6419
     1747     6420        /* insure that we do not set the purge bit if we are only                     */
     1748     6421        /* purging the first character of a control string (like                      */
     1749     6422        /* in the break key case).                                                    */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:325  
     1750     6423
     1751     6424    2      IF B3~=%KV_SSN.TYPAHDBFRINPFNC$ OR

   6424   1 0013E6  CDC5 000C                            CMB,B4   12,B5
          1 0013E8  0981 0008                            BNE      s:6426,PREL
          1 0013EA  C845 0026                            LDR,R4   38,B5
          1 0013EC  C570 00FF                            AND,R4   255,IMO
          1 0013EE  E954                                 CMR,R6   R4
          1 0013EF  0A01 0005                            BAG      s:6427,PREL

     1752     6425    2        B3->KV$TYPAHDBFR.CHRX<=%KV_SSN.TYPAHDBFRINPFNCX
     1753     6426    2      THEN %KV_SSN.VDI$->KV$VDI.PRG.TYPAHD = '1'B;

   6426   1 0013F1  BC85                                 LDB,B3   ,B5
          1 0013F2  8943 0018                            LBT,'0100'X       24,B3
          1 0013F4       0100

     1754     6427    2      %KV_SSN.NO_WATREDTRG = '0'B;         /* Nothing to start a read anymore    */

   6427   1 0013F5  8845 0028                            LBF,'0004'X       40,B5
   6427   1 0013F7       0004

   6427   1                              Y$PRGTYPAHDINT  null
     1755     6428        /*N* eh?    kv$copptr (if, none) */
     1756     6429    2   Y$PRGTYPAHDINT:;
     1757     6430
     1758     6431        /* this loop is traversed for each buffer released.                           */
     1759     6432
     1760     6433    3      DO WHILE B3->KV$TYPAHDBFR.LNK$~=ADDR(NIL);

   6433   1 0013F8  0F81 002E            Y$PRGTYPAHDINT  B        s:6444,PREL

     1761     6434        /* we've come to the last buffer in the chain. always leave                   */
     1762     6435        /* one buffer in the type-ahead chain for efficiency.                         */
     1763     6436
     1764     6437    3         IF B3=%KV_SSN.TYPAHDBFRINPFNC$ THEN EXIT;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:326  
   6437   1 0013FA  ECC7 000C                            LDB,B6   B3,AUTO
          1 0013FC  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0013FE  EDC5 000C                            CMB,B6   12,B5
          1 001400  0901 002A                            BE       s:6445,PREL

     1765     6438    3         %VDH_RLSBFR = KV_VDH_RLSBFR;

   6438   1 001402  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_RLSBFR
          1 001405  2C00                                 LDV,R2   0
          1 001406  6C0E                                 LDV,R6   14
          1 001407  BB87                                 LAB,B3   ,AUTO
          1 001408  3C2C                                 LDV,R3   44
          1 001409  0008                                 MMM

     1766     6439    3         %VDH_RLSBFR.STRTYP = %KV_STRTYP_TYPAHDBFR;

   6439   1 00140A  6C19                                 LDV,R6   25
          1 00140B  E7C7 001C                            STH,R6   FPT+6,AUTO

     1767     6440    3         %VDH_RLSBFR.BFR$ = B3;

   6440   1 00140D  ECC7 000C                            LDB,B6   B3,AUTO
          1 00140F  EFC7 0017                            STB,B6   FPT+1,AUTO

     1768     6441    3         B3 = B3->KV$TYPAHDBFR.LNK$;

   6441   1 001411  DC86                                 LDB,B5   ,B6
          1 001412  DFC7 000C                            STB,B5   B3,AUTO

     1769     6442    3         CALL KVS$RLSBFR (FPT);

   6442   1 001414  CBC7 0016                            LAB,B4   FPT,AUTO
          1 001416  CFC7 003A                            STB,B4   R+2,AUTO
          1 001418  BBC7 003A                            LAB,B3   R+2,AUTO
          1 00141A  CBF0 0100                            LAB,B4   256,IMO
          1 00141C  E380 0000 0000  xent                 LNJ,B6   KVS$RLSBFR
          1 00141F       0001                            DC       s:6443,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:327  

     1770     6443    3         %KV_SSN.TYPAHDBFRCNT = %KV_SSN.TYPAHDBFRCNT-1;

   6443   1 001420  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001422  E2C6 0027                            LLH,R6   39,B6
          1 001424  6EFF                                 ADV,R6   -1
          1 001425  E7C6 0027                            STH,R6   39,B6

     1771     6444    3      END /* LOOP */;

   6444   1 001427  ECC7 000C                            LDB,B6   B3,AUTO
          1 001429  8D86                                 CMN      ,B6
          1 00142A  09D0                                 BNE      s:6437,SPREL

     1772     6445    3      IF %KV_SSN.TYPAHDBFRINPFNC$=ADDR(NIL) THEN DO;

   6445   1 00142B  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 00142D  8DC5 000C                            CMN      12,B5
          1 00142F  0981 0011                            BNE      s:6451,PREL

     1773     6446    3         B3->KV$TYPAHDBFR.CHRX = LENGTHC(KV$TYPAHDBFR);

   6446   1 001431  E870 0600                            LDR,R6   1536,IMO
          1 001433  EAC6 0002                            SRM,R6,'7F00'X    2,B6
          1 001435       7F00

     1774     6447    3         B3->KV$TYPAHDBFR.CHRX_HI = LENGTHC(KV$TYPAHDBFR)-1;

   6447   1 001436  5C05                                 LDV,R5   5
          1 001437  DAC6 0002                            SRM,R5,'00FF'X    2,B6
          1 001439       00FF

     1775     6448    3         %KV_SSN.TYPAHDBFRINS$ = B3;

   6448   1 00143A  EFC5 000E                            STB,B6   14,B5

     1776     6449    3         %KV_SSN.TYPCND.NOT_TRN = '0'B;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:328  

   6449   1 00143C  8845 0039                            LBF,'7FFF'X       57,B5
   6449   1 00143E       7FFF

     1777     6450    3      END;

   6450   1 00143F  0F81 000A                            B        s:6452,PREL

     1778     6451    2      ELSE B3->KV$TYPAHDBFR.CHRX = %KV_SSN.TYPAHDBFRINPFNCX+1;

   6451   1 001441  E845 0026                            LDR,R6   38,B5
          1 001443  E570 00FF                            AND,R6   255,IMO
          1 001445  6E01                                 ADV,R6   1
          1 001446  6008                                 SOL,R6   8
          1 001447  EAC6 0002                            SRM,R6,'7F00'X    2,B6
          1 001449       7F00

     1779     6452    2      %KV_SSN.TYPAHDBFRHED$ = B3;

   6452   1 00144A  EFC5 000A                            STB,B6   10,B5

     1780     6453    2      RETURN;

   6453   1 00144C  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 00144E  C3C6 0001                            LNJ,B4   1,B6

     1781     6454    2   Y$PRGTYPAHDINPFNC: ENTRY;

   6454   1 001450  EFC7 0026            Y$PRGTYPAHDINPF*STB,B6   FPT+16,AUTO

     1782     6455
     1783     6456        /* purge type-ahead input function, if any.                                   */
     1784     6457
     1785     6458    2      %KV_SSN.TYPAHD = '0'B;

   6458   1 001452  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001454  8845 0027                            LBF,'0030'X       39,B5
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:329  
          1 001456       0030

     1786     6459    3      IF NOT %KV_VDI.USRRQSDAT.RED THEN DO;

   6459   1 001457  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00145A  CC86                                 LDB,B4   ,B6
          1 00145B  82C4 001D                            LB,'0010'X        29,B4
          1 00145D       0010
          1 00145E  0501 0025                            BBT      s:6483,PREL

     1787     6460        /* we're not doing read processing.                                           */
     1788     6461
     1789     6462    3         B3 = %KV_SSN.TYPAHDBFRINPFNC$;

   6462   1 001460  BCC5 000C                            LDB,B3   12,B5
          1 001462  BFC7 000C                            STB,B3   B3,AUTO

     1790     6463    3         %KV_SSN.TYPAHDBFRINPFNC$ = ADDR(NIL);

   6463   1 001464  AB80 0000 0000                       LAB,B2   0
          1 001467  AFC5 000C                            STB,B2   12,B5

     1791     6464    3         IF B3~=ADDR(NIL) THEN IF B3=%KV_SSN.TYPAHDBFRHED$

   6464   1 001469  8DC7 000C                            CMN      B3,AUTO
          1 00146B  0901 0018                            BE       s:6483,PREL

   6464   1 00146D  BDC5 000A                            CMB,B3   10,B5
          1 00146F  0981 000D                            BNE      s:6479,PREL
          1 001471  E843 0002                            LDR,R6   2,B3
          1 001473  6048                                 SOR,R6   8
          1 001474  E570 007F                            AND,R6   127,IMO
          1 001476  D845 0026                            LDR,R5   38,B5
          1 001478  D570 00FF                            AND,R5   255,IMO
          1 00147A  E955                                 CMR,R6   R5
          1 00147B  0A01 FF7C                            BAG      s:6427,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:330  
     1792     6465        /* there is a partially buffered input function to purge.                     */
     1793     6466
     1794     6467    3           AND B3->KV$TYPAHDBFR.CHRX>%KV_SSN.TYPAHDBFRINPFNCX
     1795     6468        /* the head pointer/index has passed the input function pointer/index,        */
     1796     6469        /* indicating the only thing buffered in the type-ahead buffers is            */
     1797     6470        /* the input function we're purging. purge all type-ahead buffers.            */
     1798     6471
     1799     6472    3         THEN GOTO Y$PRGTYPAHDINT;
     1800     6473    4         ELSE DO;

     1801     6474        /* there are characters in the type-ahead buffers other than                  */
     1802     6475        /* a partial input function.                                                  */
     1803     6476        /* move the insert pointers back to the input function pointers,              */
     1804     6477        /* and clear the input function pointers.                                     */
     1805     6478
     1806     6479    4            %KV_SSN.TYPAHDBFRINS$ = B3;

   6479   1 00147D  BFC5 000E                            STB,B3   14,B5

     1807     6480    4            B3->KV$TYPAHDBFR.CHRX_HI = %KV_SSN.TYPAHDBFRINPFNCX;

   6480   1 00147F  E845 0026                            LDR,R6   38,B5
          1 001481  EAC3 0002                            SRM,R6,'00FF'X    2,B3
          1 001483       00FF

     1808     6481    4         END /* IF */;

     1809     6482    3      END /* IF */;

     1810     6483    2      RETURN;

   6483   1 001484  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 001486  C3C6 0001                            LNJ,B4   1,B6

     1811     6484    2   END Y$PRGTYPAHD;
     1812     6485        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:331  
     1813     6486    1   Y$PSTLFT: PROC;

   6486   1 001488  EFC7 002A            Y$PSTLFT        STB,B6   CRT,AUTO

     1814     6487
     1815     6488        /* Position left OPRCNT columns in the read buffer.                           */
     1816     6489
     1817     6490    2      IF REDBFR$~=ADDR(NIL)

   6490   1 00148A  8DC7 0008                            CMN      REDBFR$,AUTO
          1 00148C  0901 004D                            BE       s:6511,PREL
          1 00148E  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001490  E845 002B                            LDR,R6   43,B5
          1 001492  E945 0032                            CMR,R6   50,B5
          1 001494  0A81 0045                            BALE     s:6511,PREL

     1818     6491    2        AND %KV_SSN.REDBFR.EDTLOWX>%KV_SSN.REDBFR__.BYTX
     1819     6492    3      THEN DO WHILE '1'B;

     1820     6493        /* We're not at the beginning of the read buffer, so we can
     1821     6494           position to the left.                                                      */
     1822     6495
     1823     6496    3         IF NOT %KV_SSN.CLMIS_BYTX OR OPRCNT<=0

   6496   1 001496  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001498  82C6 0037                            LB,'0080'X        55,B6
          1 00149A       0080
          1 00149B  0581 0005                            BBF      s:6497,PREL
          1 00149D  E847 0013                            LDR,R6   OPRCNT,AUTO
          1 00149F  6A01 0008                            BGZ,R6   s:6498,PREL

     1824     6497    3         THEN %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX-1;

   6497   1 0014A1  E846 002B                            LDR,R6   43,B6
          1 0014A3  6EFF                                 ADV,R6   -1
          1 0014A4  EF46 002C                            STR,R6   44,B6
          1 0014A6  0F81 0006                            B        s:6499,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:332  

     1825     6498    3         ELSE %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX-OPRCNT;

   6498   1 0014A8  E246 002B                            SUB,R6   43,B6
          1 0014AA  8256                                 NEG      R6
          1 0014AB  EF46 002C                            STR,R6   44,B6

     1826     6499    4         IF %KV_SSN.REDBFR.EDTHI_X<%KV_SSN.REDBFR__.BYTX THEN DO;

   6499   1 0014AD  E946 0032                            CMR,R6   50,B6
          1 0014AF  0881 0009                            BAGE     s:6503,PREL

     1827     6500    4            %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR__.BYTX;

   6500   1 0014B1  E846 0032                            LDR,R6   50,B6
          1 0014B3  EF46 002C                            STR,R6   44,B6

     1828     6501    4            OPRCNT = 0;

   6501   1 0014B5  8747 0013                            CL       OPRCNT,AUTO

     1829     6502    4         END;

   6502   1 0014B7  0F81 0008                            B        s:6504,PREL

     1830     6503    3         ELSE OPRCNT = OPRCNT-%KV_SSN.REDBFR.EDTLOWX+%KV_SSN.REDBFR.EDTHI_X;

   6503   1 0014B9  D847 0013                            LDR,R5   OPRCNT,AUTO
          1 0014BB  D246 002B                            SUB,R5   43,B6
          1 0014BD  DA56                                 ADD,R5   R6
          1 0014BE  DF47 0013                            STR,R5   OPRCNT,AUTO

     1831     6504    3         CALL Y$SCPVRTCLMHI_X;

   6504   1 0014C0  E3C0 0295                            LNJ,B6   s:0,PREL
          1 0014C2       0001                            DC       s:6505,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:333  
     1832     6505    3         IF %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.INSLOWX

   6505   1 0014C3  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0014C5  E846 002B                            LDR,R6   43,B6
          1 0014C7  E946 002D                            CMR,R6   45,B6
          1 0014C9  0881 000A                            BAGE     s:6507,PREL

     1833     6506    3         THEN CALL KVI$INTINPOPRX (%KV_INPOPRX_RSTINSMOD);

   6506   1 0014CB  BB80 0000 0027  02                   LAB,B3   +39
          1 0014CE  CBF0 0100                            LAB,B4   256,IMO
          1 0014D0  E380 0000 0000  xent                 LNJ,B6   KVI$INTINPOPRX
          1 0014D3       0001                            DC       s:6507,PREL

     1834     6507    3         IF OPRCNT<=0 THEN GOTO Y@PSTLFT_N;

   6507   1 0014D4  E847 0013                            LDR,R6   OPRCNT,AUTO
          1 0014D6  6A81 002B                            BLEZ,R6  s:6512,PREL

     1835     6508    3      END /* IF */;

   6508   1 0014D8  0F81 FFBD                            B        s:6496,PREL

     1836     6509        /* We're at the beginning of the buffer, try a backspace form.                */
     1837     6510
     1838     6511    2      ELSE IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN CALL KVO$PST (KV_VDH_PST_BS_FRM);

   6511   1 0014DA  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0014DD  CCC5 0006                            LDB,B4   6,B5
          1 0014DF  E2C4 0015                            LLH,R6   21,B4
          1 0014E1  6D04                                 CMV,R6   4
          1 0014E2  0981 000C                            BNE      s:6512,PREL

   6511   1 0014E4  BB80 0000 003D  02                   LAB,B3   +61
          1 0014E7  CBF0 0100                            LAB,B4   256,IMO
          1 0014E9  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0014EC       0001                            DC       s:6511+19,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:334  
          1 0014ED  0F81 000E                            B        s:6513,PREL

     1839     6512    2      ELSE IF %KV_MVD.RCRWRAP THEN CALL KVE$INPOPR (KV$INPOPR);

   6512   1 0014EF  82C4 001F                            LB,'0080'X        31,B4
   6512   1 0014F1       0080
          1 0014F2  0581 0009                            BBF      s:6513,PREL

   6512   1 0014F4  BBC7 0006                            LAB,B3   INPOPR$,AUTO
          1 0014F6  CBF0 0100                            LAB,B4   256,IMO
          1 0014F8  E380 0000 0000  xent                 LNJ,B6   KVE$INPOPR
          1 0014FB       0001                            DC       s:6513,PREL

     1840     6513    2      RETURN;

   6513   1 0014FC  ECC7 002A                            LDB,B6   CRT,AUTO
          1 0014FE  C3C6 0001                            LNJ,B4   1,B6

     1841     6514
     1842     6515    2   Y$PSTLFT_N: ENTRY;

   6515   1 001500  EFC7 002A            Y$PSTLFT_N      STB,B6   CRT,AUTO

   6512   1                              Y@PSTLFT_N      null
     1843     6516    2   Y@PSTLFT_N:;
     1844     6517    2      IF %KV_SSN.REDBFR.NXTX>=%KV_SSN.REDBFR.EDTLOWX

   6517   1 001502  ECC7 000A            Y@PSTLFT_N      LDB,B6   SSN$,AUTO
          1 001504  E846 002A                            LDR,R6   42,B6
          1 001506  E946 002B                            CMR,R6   43,B6
          1 001508  0801 0007                            BAL      s:6519,PREL

     1845     6518    2      THEN %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.NXTX-%KV_SSN.REDBFR__.BYTX;

   6518   1 00150A  E246 0032                            SUB,R6   50,B6
          1 00150C  EF46 0033                            STR,R6   51,B6
          1 00150E  0F81 0007                            B        s:6521,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:335  

     1846     6519    2      ELSE %KV_SSN.REDBFR__.DATBYTSIZ =

   6519   1 001510  D846 002B                            LDR,R5   43,B6
          1 001512  D246 0032                            SUB,R5   50,B6
          1 001514  DF46 0033                            STR,R5   51,B6

     1847     6520    2        %KV_SSN.REDBFR.EDTLOWX-%KV_SSN.REDBFR__.BYTX;
     1848     6521    2      IF %KV_VDI.RE_DSPINP THEN %KV_SRD.VRTPSTOK='0'B;

   6521   1 001516  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 001519  CC85                                 LDB,B4   ,B5
          1 00151A  82C4 0019                            LB,'0010'X        25,B4
          1 00151C       0010
          1 00151D  0581 0008                            BBF      s:6522,PREL

   6521   1 00151F  BCC5 000A                            LDB,B3   10,B5
          1 001521  8843 000E                            LBF,'0010'X       14,B3
          1 001523       0010
          1 001524  0F81 0044                            B        s:6532,PREL

     1849     6522    3      ELSE IF %KV_MVD.DISPINPUT OR %KV_MVD.RETYPOVR THEN DO;

   6522   1 001526  BCC5 0006                            LDB,B3   6,B5
          1 001528  82C3 0015                            LB,'0080'X        21,B3
          1 00152A       0080
          1 00152B  0501 0006                            BBT      s:6523,PREL
          1 00152D  82C3 0016                            LB,'0080'X        22,B3
          1 00152F       0080
          1 001530  0581 0038                            BBF      s:6532,PREL

     1850     6523    3         IF %KV_VDI.HALFDUPLEXPAPERTAPE THEN EXIT;

   6523   1 001532  82C4 0019                            LB,'0002'X        25,B4
   6523   1 001534       0002
          1 001535  0501 0033                            BBT      s:6532,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:336  
     1851     6524        /* Dont bother to position for hrdcpy if not echoing                          */
     1852     6525
     1853     6526    3         CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);

   6526   1 001537  ABC3 001B                            LAB,B2   27,B3
          1 001539  AFC7 0036                            STB,B2   @VRTCLM,AUTO
          1 00153B  E3C0 FBAF                            LNJ,B6   s:0,PREL
          1 00153D       0001                            DC       s:6527,PREL

     1854     6527    3         IF %KV_MVD.HRZSCR AND DSPLOWCLM~=0

   6527   1 00153E  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001541  DCC6 0006                            LDB,B5   6,B6
          1 001543  82C5 0016                            LB,'0004'X        22,B5
          1 001545       0004
          1 001546  0581 0019                            BBF      s:6530,PREL
          1 001548  E847 0012                            LDR,R6   DSPLOWCLM,AUTO
          1 00154A  6901 0015                            BEZ,R6   s:6530,PREL
          1 00154C  CCC6 000A                            LDB,B4   10,B6
          1 00154E  D845 001B                            LDR,R5   27,B5
          1 001550  D244 0012                            SUB,R5   18,B4
          1 001552  C2C5 0017                            LLH,R4   23,B5
          1 001554  C955                                 CMR,R4   R5
          1 001555  0801 000A                            BAL      s:6530,PREL

     1855     6528    3           AND %KV_MVD.VRTCLM-%KV_SRD.PRMVRTCLM<=%KV_MVD.HRZSCRMRG
     1856     6529    3         THEN CALL Y$SHFDSPPST (0);

   6529   1 001557  BBF0 0000                            LAB,B3   0,IMO
          1 001559  BFC7 0030                            STB,B3   DLT+1,AUTO
          1 00155B  E3C0 029B                            LNJ,B6   s:0,PREL
          1 00155D       0001                            DC       s:6529+7,PREL
          1 00155E  0F81 000A                            B        s:6532,PREL

     1857     6530    3         ELSE CALL KVO$PST (KV_VDH_PST_0_VRT);

   6530   1 001560  BB80 0000 0011  02                   LAB,B3   +17
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:337  
          1 001563  CBF0 0100                            LAB,B4   256,IMO
          1 001565  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 001568       0001                            DC       s:6532,PREL

     1858     6531    3      END /* IF */;

     1859     6532    2      RETURN;

   6532   1 001569  ECC7 002A                            LDB,B6   CRT,AUTO
          1 00156B  C3C6 0001                            LNJ,B4   1,B6

     1860     6533    2   END;
     1861     6534        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:338  
     1862     6535    1   Y$PSTRHT_TYP: PROC;

   6535   1 00156D  EFC7 0026            Y$PSTRHT_TYP    STB,B6   FPT+16,AUTO

     1863     6536
     1864     6537        /* Position right OPRCNT columns in the read buffer.                          */
     1865     6538
     1866     6539    3      DO WHILE '1'B;

     1867     6540
     1868     6541    3         IF REDBFR$~=ADDR(NIL)

   6541   1 00156F  8DC7 0008                            CMN      REDBFR$,AUTO
          1 001571  0901 0077                            BE       s:6563+2,PREL
          1 001573  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001575  E846 002B                            LDR,R6   43,B6
          1 001577  E946 002A                            CMR,R6   42,B6
          1 001579  0881 006F                            BAGE     s:6563+2,PREL

     1869     6542    4           AND %KV_SSN.REDBFR.EDTLOWX<%KV_SSN.REDBFR.NXTX THEN DO;

     1870     6543        /* We're not at the end of the read buffer.                                   */
     1871     6544
     1872     6545    4            IF NOT %KV_SSN.CLMIS_BYTX OR OPRCNT=0

   6545   1 00157B  82C6 0037                            LB,'0080'X        55,B6
   6545   1 00157D       0080
          1 00157E  0581 0005                            BBF      s:6546,PREL
          1 001580  D847 0013                            LDR,R5   OPRCNT,AUTO
          1 001582  5981 000D                            BNEZ,R5  s:6547,PREL

     1873     6546    4            THEN R5 = MINIMUM(%KV_SSN.REDBFR.EDTHI_X,%KV_SSN.REDBFR.INSMODX);

   6546   1 001584  D846 002E                            LDR,R5   46,B6
          1 001586  D946 002C                            CMR,R5   44,B6
          1 001588  0A81 0003                            BALE     s:6546+8,PREL
          1 00158A  D846 002C                            LDR,R5   44,B6
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:339  
          1 00158C  DF47 0010                            STR,R5   R5,AUTO
          1 00158E  0F81 000B                            B        s:6548,PREL

     1874     6547    4            ELSE R5 = MINIMUM(%KV_SSN.REDBFR.EDTLOWX+OPRCNT,%KV_SSN.REDBFR.NXTX)-1;

   6547   1 001590  EA55                                 ADD,R6   R5
          1 001591  E946 002A                            CMR,R6   42,B6
          1 001593  0A81 0003                            BALE     s:6547+7,PREL
          1 001595  E846 002A                            LDR,R6   42,B6
          1 001597  6EFF                                 ADV,R6   -1
          1 001598  EF47 0010                            STR,R6   R5,AUTO

     1875     6548    4            IF R5>=%KV_SSN.REDBFR.INSMODX

   6548   1 00159A  E847 0010                            LDR,R6   R5,AUTO
          1 00159C  E946 002E                            CMR,R6   46,B6
          1 00159E  0801 000A                            BAL      s:6554,PREL

     1876     6549        /* We're at the point where insert mode was entered;
     1877     6550           we can't position right without getting out of
     1878     6551           insert mode.                                                               */
     1879     6552
     1880     6553    4            THEN CALL KVI$INTINPOPRX (%KV_INPOPRX_RSTINSMOD);

   6553   1 0015A0  BB80 0000 0027  02                   LAB,B3   +39
          1 0015A3  CBF0 0100                            LAB,B4   256,IMO
          1 0015A5  E380 0000 0000  xent                 LNJ,B6   KVI$INTINPOPRX
          1 0015A8       0001                            DC       s:6554,PREL

     1881     6554    5            IF %KV_SSN.CLMIS_BYTX AND OPRCNT>0 THEN DO;

   6554   1 0015A9  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0015AB  82C6 0037                            LB,'0080'X        55,B6
          1 0015AD       0080
          1 0015AE  0581 0011                            BBF      s:6557+2,PREL
          1 0015B0  E847 0013                            LDR,R6   OPRCNT,AUTO
          1 0015B2  6A81 000D                            BLEZ,R6  s:6557+2,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:340  

     1882     6555    5               %KV_SSN.REDBFR.EDTHI_X = R5;

   6555   1 0015B4  D847 0010                            LDR,R5   R5,AUTO
          1 0015B6  DF46 002C                            STR,R5   44,B6

     1883     6556    5               OPRCNT = OPRCNT-R5+%KV_SSN.REDBFR.EDTLOWX-1;

   6556   1 0015B8  E255                                 SUB,R6   R5
          1 0015B9  EA46 002B                            ADD,R6   43,B6
          1 0015BB  6EFF                                 ADV,R6   -1
          1 0015BC  EF47 0013                            STR,R6   OPRCNT,AUTO

     1884     6557    4            END; ELSE OPRCNT = OPRCNT-1;

   6557   1 0015BE  0F81 0003                            B        s:6558,PREL

   6557   1 0015C0  88C7 0013                            DEC      OPRCNT,AUTO

     1885     6558    4            CALL Y$TYPREDBFRSGM;

   6558   1 0015C2  E3C0 0848                            LNJ,B6   s:0,PREL
          1 0015C4       0001                            DC       s:6559,PREL

     1886     6559    4            CALL Y$SCPVRTCLMLOWX;

   6559   1 0015C5  E3C0 01D7                            LNJ,B6   s:0,PREL
          1 0015C7       0001                            DC       s:6560,PREL

     1887     6560    4            IF %KV_MVD.ORG=%KV#VD_ORG_FORM

   6560   1 0015C8  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0015CB  DCC6 0006                            LDB,B5   6,B6
          1 0015CD  E2C5 0015                            LLH,R6   21,B5
          1 0015CF  6D04                                 CMV,R6   4
          1 0015D0  0981 00CC                            BNE      s:6594,PREL
          1 0015D2  CCC6 0004                            LDB,B4   4,B6
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:341  
          1 0015D4  BCC7 000A                            LDB,B3   SSN$,AUTO
          1 0015D6  D843 002B                            LDR,R5   43,B3
          1 0015D8  5801 00C4                            BLZ,R5   s:6594,PREL
          1 0015DA  D944 0015                            CMR,R5   21,B4
          1 0015DC  0201 00C0                            BL       s:6594,PREL

     1888     6561    4              AND %KV_SSN.REDBFR.EDTLOWX>=%KV_STR.MAXRCRBYTSIZ
     1889     6562    4            THEN CALL KVF$PST(KV_VDH_PST_SPCFRM);

   6562   1 0015DE  BB80 0000 003F  02                   LAB,B3   +63
          1 0015E1  CBF0 0100                            LAB,B4   256,IMO
          1 0015E3  E380 0000 0000  xent                 LNJ,B6   KVF$PST
          1 0015E6       0001                            DC       s:6563,PREL

     1890     6563    3         END; ELSE IF OPRCNT=0 AND %KV_MVD.RCRWRAP

   6563   1 0015E7  0F81 00B5                            B        s:6594,PREL

   6563   1 0015E9  E847 0013                            LDR,R6   OPRCNT,AUTO
          1 0015EB  6981 0015                            BNEZ,R6  s:6565,PREL
          1 0015ED  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0015F0  DCC6 0006                            LDB,B5   6,B6
          1 0015F2  82C5 001F                            LB,'0080'X        31,B5
          1 0015F4       0080
          1 0015F5  0581 000B                            BBF      s:6565,PREL

     1891     6564    3         THEN CALL KVE$INPOPR (KV$INPOPR);

   6564   1 0015F7  BBC7 0006                            LAB,B3   INPOPR$,AUTO
          1 0015F9  CBF0 0100                            LAB,B4   256,IMO
          1 0015FB  E380 0000 0000  xent                 LNJ,B6   KVE$INPOPR
          1 0015FE       0001                            DC       s:6564+8,PREL
          1 0015FF  0F81 009D                            B        s:6594,PREL

     1892     6565    3         ELSE IF %KV_SSN.REDBFR__.DATBYTSIZ<%KV_STR.MAXRCRBYTSIZ-1

   6565   1 001601  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:342  
          1 001604  DCC6 0004                            LDB,B5   4,B6
          1 001606  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 001608  D845 0015                            LDR,R5   21,B5
          1 00160A  5EFF                                 ADV,R5   -1
          1 00160B  5801 0005                            BLZ,R5   s:6565+16,PREL
          1 00160D  D944 0033                            CMR,R5   51,B4
          1 00160F  0301 0008                            BG       s:6571,PREL
          1 001611  BCC6 0006                            LDB,B3   6,B6
          1 001613  C2C3 0015                            LLH,R4   21,B3
          1 001615  4D04                                 CMV,R4   4
          1 001616  0981 008C                            BNE      s:6596,PREL

     1893     6566    4           OR %KV_MVD.ORG=%KV#VD_ORG_FORM THEN DO;

     1894     6567        /* We're at the end of the read buffer.
     1895     6568           positioning to the right means buffering spaces at the end
     1896     6569           of the read buffer.                                                        */
     1897     6570
     1898     6571    4            %KV_SSN.INPCHR = ' ';

   6571   1 001618  4C20                                 LDV,R4   32
          1 001619  C7C4 0029                            STH,R4   41,B4

     1899     6572    4            IF %KV_VDI.RE_DSPINP THEN %KV_SSN.INPECH = '0'B;

   6572   1 00161B  DC86                                 LDB,B5   ,B6
          1 00161C  82C5 0019                            LB,'0010'X        25,B5
          1 00161E       0010
          1 00161F  0581 0004                            BBF      s:6573,PREL

   6572   1 001621  8844 0028                            LBF,'0001'X       40,B4
   6572   1 001623       0001

     1900     6573    5            IF %KV_MVD.ORG=%KV#VD_ORG_FORM THEN DO;

   6573   1 001624  DCC6 0006                            LDB,B5   6,B6
          1 001626  D2C5 0015                            LLH,R5   21,B5
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:343  
          1 001628  5D04                                 CMV,R5   4
          1 001629  0981 0019                            BNE      s:6579,PREL

     1901     6574    5               CALL KVI$BFRREDCHR;

   6574   1 00162B  CBF0 0000                            LAB,B4   0,IMO
          1 00162D  E380 0000 0000  xent                 LNJ,B6   KVI$BFRREDCHR
          1 001630       0001                            DC       s:6575,PREL

     1902     6575    5               OPRCNT = OPRCNT-1;

   6575   1 001631  88C7 0013                            DEC      OPRCNT,AUTO

     1903     6576    5               REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   6576   1 001633  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001635  DCC6 0030                            LDB,B5   48,B6
          1 001637  DFC7 0008                            STB,B5   REDBFR$,AUTO

     1904     6577    5               IF %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR__.BYTX THEN OPRCNT = 0;

   6577   1 001639  E846 002B                            LDR,R6   43,B6
          1 00163B  E946 0032                            CMR,R6   50,B6
          1 00163D  0981 005F                            BNE      s:6594,PREL

   6577   1 00163F  8747 0013                            CL       OPRCNT,AUTO

     1905     6578    5            END; ELSE DO;

   6578   1 001641  0F81 005B                            B        s:6594,PREL

     1906     6579    5               R5 = %KV_SSN.REDBFR__.BYTX+MINIMUM (%KV_STR.MAXRCRBYTSIZ-1,

   6579   1 001643  3C01                                 LDV,R3   1
          1 001644  B956                                 CMR,R3   R6
          1 001645  0881 0002                            BAGE     s:6579+5,PREL
          1 001647  B856                                 LDR,R3   R6
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:344  
          1 001648  BA44 0033                            ADD,R3   51,B4
          1 00164A  BCC6 0004                            LDB,B3   4,B6
          1 00164C  A843 0015                            LDR,R2   21,B3
          1 00164E  2EFF                                 ADV,R2   -1
          1 00164F  A953                                 CMR,R2   R3
          1 001650  0881 0002                            BAGE     s:6579+16,PREL
          1 001652  B852                                 LDR,R3   R2
          1 001653  BA44 0032                            ADD,R3   50,B4
          1 001655  BF47 0010                            STR,R3   R5,AUTO

     1907     6580    5                 %KV_SSN.REDBFR__.DATBYTSIZ+MAXIMUM (OPRCNT,1));
     1908     6581    5               IF R5>%KV_SSN.REDBFR__.BFRBYTSIZ

   6581   1 001657  3801 0019                            BLZ,R3   s:6585,PREL
          1 001659  B944 0034                            CMR,R3   52,B4
          1 00165B  0381 0015                            BLE      s:6585,PREL

     1909     6582    6               THEN CALL KVS$GETREDBFR (R5) WHENALTRETURN DO;

   6582   1 00165D  DBC7 0010                            LAB,B5   R5,AUTO
          1 00165F  DFC7 003A                            STB,B5   R+2,AUTO
          1 001661  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001663  CBF0 0100                            LAB,B4   256,IMO
          1 001665  E380 0000 0000  xent                 LNJ,B6   KVS$GETREDBFR
          1 001668       0003                            DC       s:6583,PREL
          1 001669  0F81 0007                            B        s:6585,PREL

     1910     6583    6                  R5 = %KV_SSN.REDBFR__.BFRBYTSIZ;

   6583   1 00166B  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 00166D  E846 0034                            LDR,R6   52,B6
          1 00166F  EF47 0010                            STR,R6   R5,AUTO

     1911     6584    6               END;

     1912     6585    5               %KV_SSN.REDBFR.EDTHI_X = R5-1;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:345  
   6585   1 001671  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001673  E847 0010                            LDR,R6   R5,AUTO
          1 001675  6EFF                                 ADV,R6   -1
          1 001676  EF46 002C                            STR,R6   44,B6

     1913     6586    5               %KV_SSN.REDBFR__.DATBYTSIZ = R5-%KV_SSN.REDBFR__.BYTX;

   6586   1 001678  D847 0010                            LDR,R5   R5,AUTO
          1 00167A  D246 0032                            SUB,R5   50,B6
          1 00167C  DF46 0033                            STR,R5   51,B6

     1914     6587    5               REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   6587   1 00167E  DCC6 0030                            LDB,B5   48,B6
          1 001680  DFC7 0008                            STB,B5   REDBFR$,AUTO

     1915     6588    5               SUBSTR (KV$REDBFR_CHR, %KV_SSN.REDBFR.EDTLOWX,

   6588   1 001682  C847 0010                            LDR,R4   R5,AUTO
          1 001684  C246 002B                            SUB,R4   43,B6
          1 001686  B846 002B                            LDR,R3   43,B6
          1 001688  BF47 003A                            STR,R3   R+2,AUTO
          1 00168A  CF47 003B                            STR,R4   R+3,AUTO
          1 00168C  AB80 0000 0041  02                   LAB,B2   +65
          1 00168F  2C00                                 LDV,R2   0
          1 001690  6C01                                 LDV,R6   1
          1 001691  BB85                                 LAB,B3   ,B5
          1 001692  F854                                 LDR,R7   R4
          1 001693  D380 0000 0000  xent                 LNJ,B5   X6C_ALR

     1916     6589    5                 R5-%KV_SSN.REDBFR.EDTLOWX) = ' ';
     1917     6590    5               CALL Y$TYPREDBFRSGM;

   6590   1 001696  E3C0 0774                            LNJ,B6   s:0,PREL
          1 001698       0001                            DC       s:6591,PREL

     1918     6591    5               OPRCNT = 0;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:346  

   6591   1 001699  8747 0013                            CL       OPRCNT,AUTO

     1919     6592    5            END;

     1920     6593    3         END; ELSE EXIT;

   6593   1 00169B  0F81 0001                            B        s:6594,PREL

     1921     6594    3         IF OPRCNT<=0 THEN EXIT;

   6594   1 00169D  E847 0013                            LDR,R6   OPRCNT,AUTO
          1 00169F  6A81 0003                            BLEZ,R6  s:6596,PREL

     1922     6595    3      END /* IF */;

   6595   1 0016A1  0F81 FECD                            B        s:6541,PREL

     1923     6596    2   END;

   6596   1 0016A3  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 0016A5  C3C6 0001                            LNJ,B4   1,B6

     1924     6597        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:347  
     1925     6598    1   Y$RE_DSPINP: PROC;

   6598   1 0016A7  EFC7 002C            Y$RE_DSPINP     STB,B6   @VDH_DAT+2,AUTO

     1926     6599
     1927     6600        /* Re-display the current input data, if any.
     1928     6601           This is used for interactive devices operating in block mode
     1929     6602           to update the input image on the device, to ensure that it
     1930     6603           corresponds with the input record, after any translation
     1931     6604           or input function processing is done.
     1932     6605           It is also used for character-mode devices when the screen updating
     1933     6606           has been discontinued to avoid excessive re-typing. */
     1934     6607
     1935     6608    2      IF %KV_MVD.ORG=%KV#VD_ORG_SE AND %KV_MVD.FRMSCNINH

   6608   1 0016A9  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0016AC  CCC5 0006                            LDB,B4   6,B5
          1 0016AE  E2C4 0015                            LLH,R6   21,B4
          1 0016B0  6D05                                 CMV,R6   5
          1 0016B1  0981 0010                            BNE      s:6610,PREL
          1 0016B3  82C4 0016                            LB,'0010'X        22,B4
          1 0016B5       0010
          1 0016B6  0581 000B                            BBF      s:6610,PREL

     1936     6609    3      THEN CALL KVE$RE_DSPSE WHENRETURN DO; RETURN; END;

   6609   1 0016B8  CBF0 0000                            LAB,B4   0,IMO
          1 0016BA  E380 0000 0000  xent                 LNJ,B6   KVE$RE_DSPSE
          1 0016BD       0005                            DC       s:6610,PREL

   6609   1 0016BE  ECC7 002C                            LDB,B6   @VDH_DAT+2,AUTO
          1 0016C0  C3C6 0001                            LNJ,B4   1,B6

     1937     6610    3      IF %KV_VDI.RE_DSPINP THEN DO;

   6610   1 0016C2  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0016C5  DC86                                 LDB,B5   ,B6
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:348  
          1 0016C6  82C5 0019                            LB,'0010'X        25,B5
          1 0016C8       0010
          1 0016C9  0581 0068                            BBF      s:6634,PREL

     1938     6611        /* We're to re-display the input.                                             */
     1939     6612
     1940     6613    3         %KV_VDI.RE_DSPINP = '0'B;

   6613   1 0016CB  8845 0019                            LBF,'0010'X       25,B5
   6613   1 0016CD       0010

     1941     6614    4         IF %KV_VDI.USRRQSDAT.RED THEN DO;

   6614   1 0016CE  DC86                                 LDB,B5   ,B6
          1 0016CF  82C5 001D                            LB,'0010'X        29,B5
          1 0016D1       0010
          1 0016D2  0581 005F                            BBF      s:6634,PREL

     1942     6615        /* There is a user request-data for read data outstanding.
     1943     6616           Therefore, there may be data to re-display.                                */
     1944     6617
     1945     6618    4            IF %KV_VDI.INPUNT~=%KV_INPUNT_BLK AND %KV_SRD.VRTPSTOK THEN EXIT;

   6618   1 0016D4  E845 001D                            LDR,R6   29,B5
          1 0016D6  6045                                 SOR,R6   5
          1 0016D7  E570 0003                            AND,R6   3,IMO
          1 0016D9  6D03                                 CMV,R6   3
          1 0016DA  0901 0008                            BE       s:6619,PREL
          1 0016DC  CCC6 000A                            LDB,B4   10,B6
          1 0016DE  82C4 000E                            LB,'0010'X        14,B4
          1 0016E0       0010
          1 0016E1  0501 0050                            BBT      s:6634,PREL

     1946     6619    4            CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);

   6619   1 0016E3  CCC6 0006                            LDB,B4   6,B6
          1 0016E5  BBC4 001B                            LAB,B3   27,B4
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:349  
          1 0016E7  BFC7 0036                            STB,B3   @VRTCLM,AUTO
          1 0016E9  E3C0 FA01                            LNJ,B6   s:0,PREL
          1 0016EB       0001                            DC       s:6620,PREL

     1947     6620    4            R2 = %KV_SSN.REDBFR.EDTLOWX;

   6620   1 0016EC  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0016EE  E846 002B                            LDR,R6   43,B6
          1 0016F0  EF47 000E                            STR,R6   R2,AUTO

     1948     6621    5            IF R2~=%KV_VDI.RE_DSPLOWX AND REDBFR$~=ADDR(NIL) THEN DO;

   6621   1 0016F2  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0016F5  CC85                                 LDB,B4   ,B5
          1 0016F6  6801 0005                            BLZ,R6   s:6621+10,PREL
          1 0016F8  E944 0016                            CMR,R6   22,B4
          1 0016FA  0901 0012                            BE       s:6625,PREL
          1 0016FC  8DC7 0008                            CMN      REDBFR$,AUTO
          1 0016FE  0901 000E                            BE       s:6625,PREL

     1949     6622    5               %KV_SSN.REDBFR.EDTLOWX = %KV_VDI.RE_DSPLOWX;

   6622   1 001700  E844 0016                            LDR,R6   22,B4
          1 001702  EF46 002B                            STR,R6   43,B6

     1950     6623    5               CALL Y$EDTX_TO_VRTCLM (R5);

   6623   1 001704  CBC7 0010                            LAB,B4   R5,AUTO
          1 001706  CFC7 0036                            STB,B4   @VRTCLM,AUTO
          1 001708  E3C0 F9E2                            LNJ,B6   s:0,PREL
          1 00170A       0001                            DC       s:6624,PREL

     1951     6624    5            END;

   6624   1 00170B  0F81 0007                            B        s:6626,PREL

     1952     6625    4            ELSE R5 = %KV_MVD.VRTCLM;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:350  

   6625   1 00170D  BCC5 0006                            LDB,B3   6,B5
          1 00170F  D843 001B                            LDR,R5   27,B3
          1 001711  DF47 0010                            STR,R5   R5,AUTO

     1953     6626    4            CALL Y$SHFTYPREDBFRSGM (R5);

   6626   1 001713  EBC7 0010                            LAB,B6   R5,AUTO
          1 001715  EFC7 0030                            STB,B6   DLT+1,AUTO
          1 001717  E3C0 03B2                            LNJ,B6   s:0,PREL
          1 001719       0001                            DC       s:6627,PREL

     1954     6627    4            %KV_SSN.REDBFR.EDTLOWX = R2;

   6627   1 00171A  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 00171C  E847 000E                            LDR,R6   R2,AUTO
          1 00171E  EF46 002B                            STR,R6   43,B6

     1955     6628    5            IF %KV_VDI.INPUNT=%KV_INPUNT_BLK THEN DO;

   6628   1 001720  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 001723  CC85                                 LDB,B4   ,B5
          1 001724  D844 001D                            LDR,R5   29,B4
          1 001726  5045                                 SOR,R5   5
          1 001727  D570 0003                            AND,R5   3,IMO
          1 001729  5D03                                 CMV,R5   3
          1 00172A  0981 0007                            BNE      s:6634,PREL

     1956     6629    5               %KV_VDI.RE_DSPLOWX = 0;

   6629   1 00172C  8744 0016                            CL       22,B4

     1957     6630    5               %KV_VDI.RE_DSPINP = '0'B;

   6630   1 00172E  CC85                                 LDB,B4   ,B5
          1 00172F  8844 0019                            LBF,'0010'X       25,B4
          1 001731       0010
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:351  

     1958     6631    5            END /* IF */;

     1959     6632    4         END /* IF */;

     1960     6633    3      END /* IF */;

     1961     6634    2      RETURN;

   6634   1 001732  ECC7 002C                            LDB,B6   @VDH_DAT+2,AUTO
          1 001734  C3C6 0001                            LNJ,B4   1,B6

     1962     6635    2   END;
     1963     6636        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:352  
     1964     6637    1   Y$RE_PSTRED: PROC;

   6637   1 001736  EFC7 0026            Y$RE_PSTRED     STB,B6   FPT+16,AUTO

     1965     6638
     1966     6639        /* Re-position to after the prompt, typically after deleting the input line.  */
     1967     6640
     1968     6641
     1969     6642    2      %KV_MVD.VRTCLM = %KV_SRD.PRMVRTCLM+1;

   6642   1 001738  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00173B  CCC5 0006                            LDB,B4   6,B5
          1 00173D  BCC5 000A                            LDB,B3   10,B5
          1 00173F  E843 0012                            LDR,R6   18,B3
          1 001741  6E01                                 ADV,R6   1
          1 001742  EF44 001B                            STR,R6   27,B4

     1970     6643        /* Make the RE_PSTVRT erase the input line if there is one. */
     1971     6644    2      %KV_SRD.HI_NONBLNVRT = '0'B;

   6644   1 001744  ECC5 000A                            LDB,B6   10,B5
          1 001746  8846 000E                            LBF,'0002'X       14,B6
          1 001748       0002

     1972     6645    2      CALL KVO$PST (KV_VDH_PST_VRT);

   6645   1 001749  BB80 0000 0002  02                   LAB,B3   +2
          1 00174C  CBF0 0100                            LAB,B4   256,IMO
          1 00174E  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 001751       0001                            DC       s:6646,PREL

     1973     6646    2      RETURN;

   6646   1 001752  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 001754  C3C6 0001                            LNJ,B4   1,B6

     1974     6647    2   END;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:353  
     1975     6648        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:354  
     1976     6649    1   Y$SCPVRTCLMHI_X: PROC;

   6649   1 001756  EFC7 002C            Y$SCPVRTCLMHI_X STB,B6   @VDH_DAT+2,AUTO

     1977     6650
     1978     6651        /* Scope (find low index) of this virtual column given the hi index. */
     1979     6652
     1980     6653    2   DCL R SBIN;
     1981     6654
     1982     6655    2   DCL DLT SBIN;
     1983     6656    2      DLT = 0;

   6656   1 001758  8747 002F                            CL       DLT,AUTO

     1984     6657    2      R = %KV_SSN.REDBFR.EDTHI_X;

   6657   1 00175A  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 00175C  E845 002C                            LDR,R6   44,B5
          1 00175E  EF47 002E                            STR,R6   R,AUTO

     1985     6658        /* This loop is traversed for each character scanned from right
     1986     6659           to left, until we leave this virtual column.                               */
     1987     6660
     1988     6661    2      IF NOT %KV_SSN.CLMIS_BYTX AND R<%KV_SSN.REDBFR.INSMODX

   6661   1 001760  82C5 0037                            LB,'0080'X        55,B5
   6661   1 001762       0080
          1 001763  0501 0031                            BBT      s:6683,PREL
          1 001765  E945 002E                            CMR,R6   46,B5
          1 001767  0881 002D                            BAGE     s:6683,PREL

     1989     6662    3      THEN DO WHILE R>%KV_SSN.REDBFR__.BYTX;

   6662   1 001769  E945 0032                            CMR,R6   50,B5
          1 00176B  0A81 0029                            BALE     s:6683,PREL

     1990     6663    3         R = R-1;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:355  

   6663   1 00176D  88C7 002E                            DEC      R,AUTO

     1991     6664        /* This character causes carriage positioning.                                */
     1992     6665
     1993     6666    3         IF KV$REDBFR.CHR(R)=BITASC(%ASCIIBS) THEN DLT = DLT+1;

   6666   1 00176F  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 001771  B847 002E                            LDR,R3   R,AUTO
          1 001773  E0B6                                 LDH,R6   ,B6,R3
          1 001774  6D08                                 CMV,R6   8
          1 001775  0981 0005                            BNE      s:6669,PREL

   6666   1 001777  8AC7 002F                            INC      DLT,AUTO
          1 001779  0F81 0016                            B        s:6682,PREL

     1994     6667        /* This is a backspace character.                                             */
     1995     6668
     1996     6669    3         ELSE IF KV$REDBFR.CHR(R)>=' '

   6669   1 00177B  6D20                                 CMV,R6   32
          1 00177C  0201 0013                            BL       s:6682,PREL
          1 00177E  6D7F                                 CMV,R6   127
          1 00177F  0901 0010                            BE       s:6682,PREL

     1997     6670    4           AND KV$REDBFR.CHR(R)~=BITASC(%ASCIIDEL) THEN DO;

     1998     6671        /* This character causes positioning, but isn't a backspace. */
     1999     6672
     2000     6673    4            DLT = DLT-1;

   6673   1 001781  88C7 002F                            DEC      DLT,AUTO

     2001     6674    5            IF DLT<0 THEN DO;

   6674   1 001783  D847 002F                            LDR,R5   DLT,AUTO
          1 001785  5881 000A                            BGEZ,R5  s:6682,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:356  

     2002     6675        /* It must be the last character in the virtual column
     2003     6676           to the left of our virtual column.                                         */
     2004     6677
     2005     6678    5               %KV_SSN.REDBFR.EDTLOWX = R+1;

   6678   1 001787  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001789  3E01                                 ADV,R3   1
          1 00178A  BF45 002B                            STR,R3   43,B5

     2006     6679    5               RETURN;

   6679   1 00178C  ECC7 002C                            LDB,B6   @VDH_DAT+2,AUTO
          1 00178E  C3C6 0001                            LNJ,B4   1,B6

     2007     6680    5            END /* IF */;
     2008     6681    4         END /* IF */;
     2009     6682    3      END /* LOOP */;

   6682   1 001790  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001792  B945 0032                            CMR,R3   50,B5
          1 001794  0A59                                 BAG      s:6663,SPREL

     2010     6683    2      %KV_SSN.REDBFR.EDTLOWX = R;

   6683   1 001795  E847 002E                            LDR,R6   R,AUTO
          1 001797  EF45 002B                            STR,R6   43,B5

     2011     6684    2      RETURN;

   6684   1 001799  ECC7 002C                            LDB,B6   @VDH_DAT+2,AUTO
          1 00179B  C3C6 0001                            LNJ,B4   1,B6

     2012     6685    2   END;
     2013     6686        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:357  
     2014     6687    1   Y$SCPVRTCLMLOWX: PROC;

   6687   1 00179D  EFC7 002A            Y$SCPVRTCLMLOWX STB,B6   CRT,AUTO

     2015     6688
     2016     6689        /* Scope (find high index) of this virtual column given the low index. */
     2017     6690
     2018     6691    2   DCL R SBIN;
     2019     6692
     2020     6693    2   DCL DLT SBIN;
     2021     6694
     2022     6695    2      IF %KV_SSN.CLMIS_BYTX OR %KV_SSN.REDBFR.EDTLOWX>=%KV_SSN.REDBFR.INSMODX

   6695   1 00179F  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0017A1  82C5 0037                            LB,'0080'X        55,B5
          1 0017A3       0080
          1 0017A4  0501 0007                            BBT      s:6697,PREL
          1 0017A6  E845 002B                            LDR,R6   43,B5
          1 0017A8  E945 002E                            CMR,R6   46,B5
          1 0017AA  0801 0009                            BAL      s:6700,PREL

     2023     6696    3      THEN DO;

     2024     6697    3         %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTLOWX;

   6697   1 0017AC  E845 002B                            LDR,R6   43,B5
          1 0017AE  EF45 002C                            STR,R6   44,B5

     2025     6698    3         RETURN;

   6698   1 0017B0  ECC7 002A                            LDB,B6   CRT,AUTO
          1 0017B2  C3C6 0001                            LNJ,B4   1,B6

     2026     6699    3      END;
     2027     6700    2      R = %KV_SSN.REDBFR.EDTLOWX;

   6700   1 0017B4  EF47 002C                            STR,R6   R,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:358  

     2028     6701    2      DLT = -1;

   6701   1 0017B6  8947 002D                            LBT,'FFFF'X       DLT,AUTO
   6701   1 0017B8       FFFF

     2029     6702    2      IF KV$REDBFR.CHR(R)=BITASC(%ASCIICR) THEN R = R+1;

   6702   1 0017B9  CCC7 0008                            LDB,B4   REDBFR$,AUTO
          1 0017BB  B856                                 LDR,R3   R6
          1 0017BC  D0B4                                 LDH,R5   ,B4,R3
          1 0017BD  5D0D                                 CMV,R5   13
          1 0017BE  0981 0003                            BNE      s:6703,PREL

   6702   1 0017C0  8AC7 002C                            INC      R,AUTO

     2030     6703    3      DO WHILE R<%KV_SSN.REDBFR.INSMODX;

   6703   1 0017C2  C847 002C                            LDR,R4   R,AUTO
          1 0017C4  C945 002E                            CMR,R4   46,B5
          1 0017C6  0881 0025                            BAGE     s:6722,PREL

     2031     6704        /* This loop is traversed for each character scanned from left to
     2032     6705           right in the read buffer, until the next virtual column is
     2033     6706           encountered.                                                               */
     2034     6707
     2035     6708    3         IF KV$REDBFR.CHR(R)=BITASC(%ASCIIBS) THEN DLT = DLT-1;

   6708   1 0017C8  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 0017CA  B847 002C                            LDR,R3   R,AUTO
          1 0017CC  E0B6                                 LDH,R6   ,B6,R3
          1 0017CD  6D08                                 CMV,R6   8
          1 0017CE  0981 0005                            BNE      s:6711,PREL

   6708   1 0017D0  88C7 002D                            DEC      DLT,AUTO
          1 0017D2  0F81 0010                            B        s:6720,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:359  
     2036     6709        /* This is a backspace.                                                       */
     2037     6710
     2038     6711    3         ELSE IF DLT =0 OR KV$REDBFR.CHR(R)=BITASC(%ASCIICR) THEN EXIT;

   6711   1 0017D4  D847 002D                            LDR,R5   DLT,AUTO
          1 0017D6  5901 0015                            BEZ,R5   s:6722,PREL
          1 0017D8  6D0D                                 CMV,R6   13
          1 0017D9  0901 0012                            BE       s:6722,PREL

     2039     6712        /* We've just entered the next virtual column.                                */
     2040     6713
     2041     6714        /* We haven't yet entered the next virtual column.                            */
     2042     6715
     2043     6716    3         ELSE IF KV$REDBFR.CHR(R)>=' '

   6716   1 0017DB  6D20                                 CMV,R6   32
          1 0017DC  0201 0006                            BL       s:6720,PREL
          1 0017DE  6D7F                                 CMV,R6   127
          1 0017DF  0901 0003                            BE       s:6720,PREL

     2044     6717    3           AND KV$REDBFR.CHR(R)~=BITASC(%ASCIIDEL) THEN DLT = DLT+1;

   6717   1 0017E1  8AC7 002D                            INC      DLT,AUTO

     2045     6718        /* This character causes positioning, but isn't a backspace.                  */
     2046     6719
     2047     6720    3         R = R+1;

   6720   1 0017E3  8AC7 002C                            INC      R,AUTO

     2048     6721    3      END /* LOOP */;

   6721   1 0017E5  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0017E7  E847 002C                            LDR,R6   R,AUTO
          1 0017E9  E945 002E                            CMR,R6   46,B5
          1 0017EB  085D                                 BAL      s:6708,SPREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:360  
     2049     6722    2      %KV_SSN.REDBFR.EDTHI_X = R-1;

   6722   1 0017EC  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0017EE  E847 002C                            LDR,R6   R,AUTO
          1 0017F0  6EFF                                 ADV,R6   -1
          1 0017F1  EF46 002C                            STR,R6   44,B6

     2050     6723    2      RETURN;

   6723   1 0017F3  ECC7 002A                            LDB,B6   CRT,AUTO
          1 0017F5  C3C6 0001                            LNJ,B4   1,B6

     2051     6724    2   END;
     2052     6725        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:361  
     2053     6726    1   Y$SHFDSPPST: PROC (SHFCNT);

   6726   1 0017F7  EFC7 002E            Y$SHFDSPPST     STB,B6   R,AUTO

     2054     6727
     2055     6728        /* Re-display the input field, shifted according to the parameter:
     2056     6729           n>0 - insert n spaces at MVD.VRTCLM for the n chars <EDTLOWX. n is always 1.
     2057     6730           n<0 - delete n columns at MVD.VRTCLM - if HRZSCR, retype at the end.
     2058     6731           n=0 - scroll by inserting MVD.HRZSCRSHF at left until MVD.VRTCLM in range.
     2059     6732           nil - scroll by deleting MVD.HRZSCRSHF at left until MVD.VRTCLM in range.
     2060     6733
     2061     6734           Uses terminal line editing if available, else retypes some.
     2062     6735        */
     2063     6736
     2064     6737    2   DCL SHFCNT SBIN;
     2065     6738    2   DCL SHF SBIN;
     2066     6739    2   DCL OLDCLM SBIN;
     2067     6740
     2068     6741    2      OLDCLM = %KV_MVD.VRTCLM;

   6741   1 0017F9  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0017FC  CCC5 0006                            LDB,B4   6,B5
          1 0017FE  E844 001B                            LDR,R6   27,B4
          1 001800  EF47 0033                            STR,R6   OLDCLM,AUTO

     2069     6742    3      IF ADDR(SHFCNT)~=ADDR(NIL) THEN IF SHFCNT~=0 THEN DO;

   6742   1 001802  CCC7 0030                            LDB,B4   @SHFCNT,AUTO
          1 001804  8DD4                                 CMN      B4
          1 001805  0901 0064                            BE       s:6758,PREL

   6742   1 001807  D804                                 LDR,R5   ,B4
          1 001808  5901 0061                            BEZ,R5   s:6758,PREL

     2070     6743    3         SHF = SHFCNT;

   6743   1 00180A  DF47 0032                            STR,R5   SHF,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:362  

     2071     6744    3         IF NOT %KV_MRD.HRZSCR OR NOT %KV_SSN.CLMIS_BYTX

   6744   1 00180C  BCC5 0008                            LDB,B3   8,B5
          1 00180E  82C3 0017                            LB,'0020'X        23,B3
          1 001810       0020
          1 001811  0581 0043                            BBF      s:6752,PREL
          1 001813  ACC7 000A                            LDB,B2   SSN$,AUTO
          1 001815  82C2 0037                            LB,'0080'X        55,B2
          1 001817       0080
          1 001818  0581 003C                            BBF      s:6752,PREL
          1 00181A  9CC5 000A                            LDB,B1   10,B5
          1 00181C  5001                                 SOL,R5   1
          1 00181D  8255                                 NEG      R5
          1 00181E  5801 0005                            BLZ,R5   s:6744+24,PREL
          1 001820  D941 000D                            CMR,R5   13,B1
          1 001822  0301 0032                            BG       s:6752,PREL
          1 001824  C842 002B                            LDR,R4   43,B2
          1 001826  C942 002A                            CMR,R4   42,B2
          1 001828  0881 002C                            BAGE     s:6752,PREL
          1 00182A  C242 002A                            SUB,R4   42,B2
          1 00182C  B847 0032                            LDR,R3   SHF,AUTO
          1 00182E  3001                                 SOL,R3   1
          1 00182F  B954                                 CMR,R3   R4
          1 001830  0801 0024                            BAL      s:6752,PREL
          1 001832  ECC5 0006                            LDB,B6   6,B5
          1 001834  C2C6 0015                            LLH,R4   21,B6
          1 001836  4D05                                 CMV,R4   5
          1 001837  0981 0010                            BNE      s:6744+60,PREL
          1 001839  A847 0032                            LDR,R2   SHF,AUTO
          1 00183B  2A81 000C                            BLEZ,R2  s:6744+60,PREL
          1 00183D  82C1 001D                            LB,'4000'X        29,B1
          1 00183F       4000
          1 001840  0501 0007                            BBT      s:6744+60,PREL
          1 001842  8CC1 0017                            LDI      23,B1
          1 001844  84C1 000B                            SID      11,B1
          1 001846  6881 000E                            BGEZ,R6  s:6752,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:363  
          1 001848  E847 0032                            LDR,R6   SHF,AUTO
          1 00184A  6881 0014                            BGEZ,R6  s:6755,PREL
          1 00184C  82C3 0018                            LB,'0001'X        24,B3
          1 00184E       0001
          1 00184F  0581 000F                            BBF      s:6755,PREL
          1 001851  C570 0001                            AND,R4   1,IMO
          1 001853  4981 000B                            BNEZ,R4  s:6755,PREL

     2072     6745    3           OR -2*SHF>%KV_SRD.WDT
     2073     6746    3           OR %KV_SSN.REDBFR.EDTLOWX>=%KV_SSN.REDBFR.NXTX
     2074     6747    3           OR SHF*2<%KV_SSN.REDBFR.EDTLOWX-%KV_SSN.REDBFR.NXTX
     2075     6748    3           OR %KV_MVD.ORG=%KV#VD_ORG_SE AND SHF>0 AND NOT %KV_SRD.VRTSCR
     2076     6749    3           AND %KV_SRD.HI_NONBLN_PST>=%KV_SRD.BTMRHT_PST
     2077     6750    3           OR SHF<0 AND %KV_MRD.DCHMOVFLD AND MOD(%KV_MVD.ORG,2)=0
     2078     6751    4         THEN DO;

     2079     6752    4            IF SHF>0 THEN OLDCLM = OLDCLM+SHF;

   6752   1 001855  E847 0032                            LDR,R6   SHF,AUTO
          1 001857  6A81 0005                            BLEZ,R6  s:6753,PREL

   6752   1 001859  EA47 0033                            ADD,R6   OLDCLM,AUTO
          1 00185B  EF47 0033                            STR,R6   OLDCLM,AUTO

     2080     6753    4            GOTO Y@SHFTYPSGM;

   6753   1 00185D  0F81 0273                            B        s:6865,PREL

     2081     6754    4         END;
     2082     6755    3         CALL KVO$PST (KV_VDH_PST_0_VRT);

   6755   1 00185F  BB80 0000 0011  02                   LAB,B3   +17
          1 001862  CBF0 0100                            LAB,B4   256,IMO
          1 001864  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 001867       0001                            DC       s:6756,PREL

     2083     6756    3         GOTO SCROLIT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:364  

   6756   1 001868  0F81 002A                            B        s:6760,PREL

     2084     6757    3      END;
     2085     6758    2      CALL Y$SHFCNT;

   6758   1 00186A  E3C0 01AA                            LNJ,B6   s:0,PREL
          1 00186C       0001                            DC       s:6752,PREL

   6752   1                              Y@SHFRCR        null
     2086     6759    2   Y@SHFRCR:;
     2087     6760    2      IF NOT %KV_MRD.HRZSCR OR NOT %KV_SSN.CLMIS_BYTX

   6760   1 00186D  EC80 0000 0000  xsym Y@SHFRCR        LDB,B6   KV$PTR$
          1 001870  DCC6 0008                            LDB,B5   8,B6
          1 001872  82C5 0017                            LB,'0020'X        23,B5
          1 001874       0020
          1 001875  0581 0250                            BBF      s:6850,PREL
          1 001877  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 001879  82C4 0037                            LB,'0080'X        55,B4
          1 00187B       0080
          1 00187C  0581 0249                            BBF      s:6850,PREL
          1 00187E  E847 0032                            LDR,R6   SHF,AUTO
          1 001880  6FFD                                 MLV,R6   -3
          1 001881  D847 0032                            LDR,R5   SHF,AUTO
          1 001883  5F03                                 MLV,R5   3
          1 001884  D956                                 CMR,R5   R6
          1 001885  0A81 0002                            BALE     s:6752+27,PREL
          1 001887  E855                                 LDR,R6   R5
          1 001888  BCC6 0006                            LDB,B3   6,B6
          1 00188A  ACC6 000A                            LDB,B2   10,B6
          1 00188C  C843 0013                            LDR,R4   19,B3
          1 00188E  C242 0012                            SUB,R4   18,B2
          1 001890  E954                                 CMR,R6   R4
          1 001891  0A01 0234                            BAG      s:6850,PREL

   6760   1                              SCROLIT         null
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:365  
     2088     6761    2        OR MAXIMUM(3*SHF,-3*SHF)>%KV_MVD.WDT-%KV_SRD.PRMVRTCLM
     2089     6762    2      THEN GOTO Y@SHFTYP;
     2090     6763    2   SCROLIT:;
     2091     6764    2      %VDH_OTPLCL = KV_VDH_OTPLCL;

   6764   1 001893  AB80 0000 0000  xsym SCROLIT         LAB,B2   KV_VDH_OTPLCL
          1 001896  2C00                                 LDV,R2   0
          1 001897  6C0A                                 LDV,R6   10
          1 001898  BB87                                 LAB,B3   ,AUTO
          1 001899  3C2C                                 LDV,R3   44
          1 00189A  0008                                 MMM

     2092     6765    2      %VDH_OTPLCL.BFR_.ADR$ = REDBFR$;

   6765   1 00189B  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 00189D  EFC7 0017                            STB,B6   FPT+1,AUTO

     2093     6766    2      %VDH_OTPLCL.NO_WRAP = %KV_MVD.HRZSCR;

   6766   1 00189F  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0018A2  CCC5 0006                            LDB,B4   6,B5
          1 0018A4  E844 0016                            LDR,R6   22,B4
          1 0018A6  6002                                 SOL,R6   2
          1 0018A7  EAC7 0016                            SRM,R6,'0010'X    FPT,AUTO
          1 0018A9       0010

     2094     6767    2      %USR_PST = KV_USR_PST;

   6767   1 0018AA  AB80 0000 0000  xsym                 LAB,B2   KV_USR_PST
          1 0018AD  2C00                                 LDV,R2   0
          1 0018AE  6C08                                 LDV,R6   8
          1 0018AF  BB87                                 LAB,B3   ,AUTO
          1 0018B0  3C36                                 LDV,R3   54
          1 0018B1  0008                                 MMM

     2095     6768    2      %USR_PST.PHSPSTMOD = %KV_PHSPSTMOD_HRZSCR;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:366  
   6768   1 0018B2  6C05                                 LDV,R6   5
          1 0018B3  E7C7 001E                            STH,R6   FPT+8,AUTO

     2096     6769    2      %USR_PST.SCRCNT = SHF;

   6769   1 0018B5  D847 0032                            LDR,R5   SHF,AUTO
          1 0018B7  DAC7 001E                            SRM,R5,'00FF'X    FPT+8,AUTO
          1 0018B9       00FF

     2097     6770    2      %USR_PST.PHSPST = %KV_SRD.CRT;

   6770   1 0018BA  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0018BD  DCC6 000A                            LDB,B5   10,B6
          1 0018BF  8CC5 0015                            LDI      21,B5
          1 0018C1  8D47 001C                            SDI      FPT+6,AUTO

     2098     6771    2      EDTX = %KV_SRD.BTMRHT.CLM;

   6771   1 0018C3  DCC6 000A                            LDB,B5   10,B6
          1 0018C5  C845 000C                            LDR,R4   12,B5
          1 0018C7  CF47 0011                            STR,R4   EDTX,AUTO

     2099     6772    2      IF %KV_SRD.FLDEND.CLM>0 THEN %KV_SRD.BTMRHT.CLM = %KV_SRD.FLDEND.CLM;

   6772   1 0018C9  B845 0011                            LDR,R3   17,B5
          1 0018CB  3A81 0004                            BLEZ,R3  s:6774,PREL

   6772   1 0018CD  C853                                 LDR,R4   R3
          1 0018CE  CF45 000C                            STR,R4   12,B5

     2100     6773        /* (make it work properly for X364) */
     2101     6774    2      CALL KVV$CALUSR (%USR_PST);

   6774   1 0018D0  DBC7 001B                            LAB,B5   FPT+5,AUTO
          1 0018D2  DFC7 003A                            STB,B5   R+2,AUTO
          1 0018D4  BBC7 003A                            LAB,B3   R+2,AUTO
          1 0018D6  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:367  
          1 0018D8  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 0018DB       0001                            DC       s:6775,PREL

     2102     6775    2      %KV_SRD.BTMRHT.CLM = EDTX;

   6775   1 0018DC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0018DF  DCC6 000A                            LDB,B5   10,B6
          1 0018E1  E847 0011                            LDR,R6   EDTX,AUTO
          1 0018E3  EF45 000C                            STR,R6   12,B5

     2103     6776    2      EDTX = EDTX+1-%USR_PST.PHSPST.CLM;   /* Clms left on 1st lin               */

   6776   1 0018E5  E247 001D                            SUB,R6   FPT+7,AUTO
          1 0018E7  6E01                                 ADV,R6   1
          1 0018E8  EF47 0011                            STR,R6   EDTX,AUTO

     2104     6777    3      IF SHF>0 THEN DO;

   6777   1 0018EA  D847 0032                            LDR,R5   SHF,AUTO
          1 0018EC  5A81 000B                            BLEZ,R5  s:6781,PREL

     2105     6778    3         %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX;

   6778   1 0018EE  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0018F0  C845 002F                            LDR,R4   47,B5
          1 0018F2  CF47 0019                            STR,R4   FPT+3,AUTO

     2106     6779    3         %VDH_OTPLCL.BFR_.BYTSIZ = SHF;

   6779   1 0018F4  DF47 001A                            STR,R5   FPT+4,AUTO

     2107     6780    3      END; ELSE DO;

   6780   1 0018F6  0F81 0020                            B        s:6787,PREL

     2108     6781    3         %KV_MVD.VRTCLM = %KV_MVD.VRTCLM+EDTX+SHF;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:368  
   6781   1 0018F8  DCC6 0006                            LDB,B5   6,B6
          1 0018FA  EA45 001B                            ADD,R6   27,B5
          1 0018FC  EA55                                 ADD,R6   R5
          1 0018FD  EF45 001B                            STR,R6   27,B5

     2109     6782    3         %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX+%KV_MVD.VRTCLM

   6782   1 0018FF  DCC6 0006                            LDB,B5   6,B6
          1 001901  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 001903  E844 002F                            LDR,R6   47,B4
          1 001905  EA45 001B                            ADD,R6   27,B5
          1 001907  BCC6 000A                            LDB,B3   10,B6
          1 001909  E243 0012                            SUB,R6   18,B3
          1 00190B  6EFF                                 ADV,R6   -1
          1 00190C  EF47 0019                            STR,R6   FPT+3,AUTO

     2110     6783    3           -%KV_SRD.PRMVRTCLM-1;
     2111     6784    3         %VDH_OTPLCL.BFR_.BYTSIZ = -SHF;

   6784   1 00190E  8255                                 NEG      R5
          1 00190F  DF47 001A                            STR,R5   FPT+4,AUTO

     2112     6785    3         EDTX = %KV_SRD.WDT;

   6785   1 001911  DCC6 000A                            LDB,B5   10,B6
          1 001913  C845 000D                            LDR,R4   13,B5
          1 001915  CF47 0011                            STR,R4   EDTX,AUTO

     2113     6786    3      END;

     2114     6787    2      %USR_PST.PHSPST.CLM = %KV_SRD.TOPLFT.CLM;

   6787   1 001917  DCC6 000A                            LDB,B5   10,B6
          1 001919  E845 000A                            LDR,R6   10,B5
          1 00191B  EF47 001D                            STR,R6   FPT+7,AUTO

     2115     6788    3      DO WHILE %VDH_OTPLCL.BFR_.BYTX<%KV_SSN.REDBFR.NXTX;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:369  

   6788   1 00191D  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 00191F  C847 0019                            LDR,R4   FPT+3,AUTO
          1 001921  C945 002A                            CMR,R4   42,B5
          1 001923  0881 00B4                            BAGE     s:6813,PREL

     2116     6789    3         IF %VDH_OTPLCL.BFR_.BYTSIZ+%VDH_OTPLCL.BFR_.BYTX>%KV_SSN.REDBFR.NXTX

   6789   1 001925  E847 001A                            LDR,R6   FPT+4,AUTO
          1 001927  EA47 0019                            ADD,R6   FPT+3,AUTO
          1 001929  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 00192B  E946 002A                            CMR,R6   42,B6
          1 00192D  0A81 0007                            BALE     s:6791,PREL

     2117     6790    3         THEN %VDH_OTPLCL.BFR_.BYTSIZ = %KV_SSN.REDBFR.NXTX-%VDH_OTPLCL.BFR_.BYTX;

   6790   1 00192F  E846 002A                            LDR,R6   42,B6
          1 001931  E247 0019                            SUB,R6   FPT+3,AUTO
          1 001933  EF47 001A                            STR,R6   FPT+4,AUTO

     2118     6791    3         IF %VDH_OTPLCL.BFR_.BYTX~=%KV_SSN.REDBFR.DSPLOWX

   6791   1 001935  E847 0019                            LDR,R6   FPT+3,AUTO
          1 001937  E946 002F                            CMR,R6   47,B6
          1 001939  0981 0009                            BNE      s:6793,PREL
          1 00193B  DCC7 0030                            LDB,B5   @SHFCNT,AUTO
          1 00193D  8DD5                                 CMN      B5
          1 00193E  0901 0004                            BE       s:6793,PREL
          1 001940  D805                                 LDR,R5   ,B5
          1 001941  5981 000F                            BNEZ,R5  s:6795,PREL

     2119     6792    3           OR ADDR(SHFCNT)=ADDR(NIL) OR SHFCNT=0
     2120     6793    3         THEN CALL KVO$OTPLCL (%VDH_OTPLCL);

   6793   1 001943  DBC7 0016                            LAB,B5   FPT,AUTO
          1 001945  DFC7 003A                            STB,B5   R+2,AUTO
          1 001947  BBC7 003A                            LAB,B3   R+2,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:370  
          1 001949  CBF0 0100                            LAB,B4   256,IMO
          1 00194B  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 00194E       0001                            DC       s:6793+12,PREL
          1 00194F  0F81 0013                            B        s:6798,PREL

     2121     6794    4         ELSE DO;

     2122     6795    4            %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.EDTLOWX-SHF;

   6795   1 001951  C846 002B                            LDR,R4   43,B6
          1 001953  C247 0032                            SUB,R4   SHF,AUTO
          1 001955  E854                                 LDR,R6   R4
          1 001956  EF47 0019                            STR,R6   FPT+3,AUTO

     2123     6796    4            %KV_MVD.VRTCLM = %KV_MVD.VRTCLM+SHF; /* (simulated write)            */

   6796   1 001958  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 00195B  BCC4 0006                            LDB,B3   6,B4
          1 00195D  D843 001B                            LDR,R5   27,B3
          1 00195F  DA47 0032                            ADD,R5   SHF,AUTO
          1 001961  DF43 001B                            STR,R5   27,B3

     2124     6797    4         END;

     2125     6798    3         %VDH_OTPLCL.BFR_.BYTX =%VDH_OTPLCL.BFR_.BYTX+EDTX;

   6798   1 001963  E847 0019                            LDR,R6   FPT+3,AUTO
          1 001965  EA47 0011                            ADD,R6   EDTX,AUTO
          1 001967  EF47 0019                            STR,R6   FPT+3,AUTO

     2126     6799    3         IF %KV_MVD.HRZSCR OR %KV_SRD.TRUNCATE

   6799   1 001969  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00196C  DCC6 0006                            LDB,B5   6,B6
          1 00196E  82C5 0016                            LB,'0004'X        22,B5
          1 001970       0004
          1 001971  0501 0066                            BBT      s:6813,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:371  
          1 001973  CCC6 000A                            LDB,B4   10,B6
          1 001975  82C4 000E                            LB,'0004'X        14,B4
          1 001977       0004
          1 001978  0501 005F                            BBT      s:6813,PREL
          1 00197A  D847 0032                            LDR,R5   SHF,AUTO
          1 00197C  5A81 0007                            BLEZ,R5  s:6801,PREL
          1 00197E  BCC7 000A                            LDB,B3   SSN$,AUTO
          1 001980  E943 002A                            CMR,R6   42,B3
          1 001982  0881 0055                            BAGE     s:6813,PREL

     2127     6800    3           OR SHF>0 AND %VDH_OTPLCL.BFR_.BYTX>=%KV_SSN.REDBFR.NXTX THEN EXIT;
     2128     6801    3         %KV_MVD.VRTCLM = %KV_MVD.VRTCLM+EDTX;

   6801   1 001984  C845 001B                            LDR,R4   27,B5
          1 001986  CA47 0011                            ADD,R4   EDTX,AUTO
          1 001988  CF45 001B                            STR,R4   27,B5

     2129     6802    4         IF SHF>0 THEN DO;

   6802   1 00198A  5A81 0014                            BLEZ,R5  s:6806,PREL

     2130     6803    4            CALL KVO$PST (KV_VDH_PST_0_VRT);

   6803   1 00198C  BB80 0000 0011  02                   LAB,B3   +17
          1 00198F  CBF0 0100                            LAB,B4   256,IMO
          1 001991  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 001994       0001                            DC       s:6804,PREL

     2131     6804    4            %USR_PST.PHSPST.LIN = %KV_SRD.CRT.LIN-1; /* KVE$INCFLD could scroll  */

   6804   1 001995  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001998  DCC6 000A                            LDB,B5   10,B6
          1 00199A  E845 0015                            LDR,R6   21,B5
          1 00199C  6EFF                                 ADV,R6   -1
          1 00199D  EF47 001C                            STR,R6   FPT+6,AUTO

     2132     6805    4         END;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:372  

     2133     6806    3         %KV_MVD.VRTCLM = %KV_MVD.VRTCLM-%VDH_OTPLCL.BFR_.BYTSIZ;

   6806   1 00199F  DCC6 0006                            LDB,B5   6,B6
          1 0019A1  E845 001B                            LDR,R6   27,B5
          1 0019A3  E247 001A                            SUB,R6   FPT+4,AUTO
          1 0019A5  EF45 001B                            STR,R6   27,B5

     2134     6807    3         EDTX = %KV_SRD.WDT;

   6807   1 0019A7  DCC6 000A                            LDB,B5   10,B6
          1 0019A9  E845 000D                            LDR,R6   13,B5
          1 0019AB  EF47 0011                            STR,R6   EDTX,AUTO

     2135     6808    3         %USR_PST.PHSPST.LIN = %USR_PST.PHSPST.LIN+1;

   6808   1 0019AD  8AC7 001C                            INC      FPT+6,AUTO

     2136     6809    3         IF SHF>=0 AND SHF>=%KV_SSN.REDBFR.NXTX-%VDH_OTPLCL.BFR_.BYTX

   6809   1 0019AF  D847 0032                            LDR,R5   SHF,AUTO
          1 0019B1  5801 0012                            BLZ,R5   s:6811,PREL
          1 0019B3  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0019B5  C845 002A                            LDR,R4   42,B5
          1 0019B7  C247 0019                            SUB,R4   FPT+3,AUTO
          1 0019B9  C955                                 CMR,R4   R5
          1 0019BA  0A01 0009                            BAG      s:6811,PREL

     2137     6810    3         THEN %KV_SRD.CRT.CLM = %KV_SRD.TOPLFT.CLM;

   6810   1 0019BC  CCC6 000A                            LDB,B4   10,B6
          1 0019BE  C844 000A                            LDR,R4   10,B4
          1 0019C0  CF44 0016                            STR,R4   22,B4
          1 0019C2  0F81 000D                            B        s:6812,PREL

     2138     6811    3         ELSE CALL KVV$CALUSR (%USR_PST);

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:373  
   6811   1 0019C4  DBC7 001B                            LAB,B5   FPT+5,AUTO
          1 0019C6  DFC7 003A                            STB,B5   R+2,AUTO
          1 0019C8  BBC7 003A                            LAB,B3   R+2,AUTO
          1 0019CA  CBF0 0100                            LAB,B4   256,IMO
          1 0019CC  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 0019CF       0001                            DC       s:6812,PREL

     2139     6812    3      END;

   6812   1 0019D0  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 0019D2  E847 0019                            LDR,R6   FPT+3,AUTO
          1 0019D4  E946 002A                            CMR,R6   42,B6
          1 0019D6  0801 FF4E                            BAL      s:6789,PREL

     2140     6813    2      %KV_MVD.VRTCLM = OLDCLM;

   6813   1 0019D8  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0019DB  DCC6 0006                            LDB,B5   6,B6
          1 0019DD  E847 0033                            LDR,R6   OLDCLM,AUTO
          1 0019DF  EF45 001B                            STR,R6   27,B5

     2141     6814    2      CALL KVO$PST (KV_VDH_PST_0_VRT);

   6814   1 0019E1  BB80 0000 0011  02                   LAB,B3   +17
          1 0019E4  CBF0 0100                            LAB,B4   256,IMO
          1 0019E6  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0019E9       0001                            DC       s:6815,PREL

     2142     6815    2      RETURN;

   6815   1 0019EA  ECC7 002E                            LDB,B6   R,AUTO
          1 0019EC  C3C6 0001                            LNJ,B4   1,B6

     2143     6816
     2144     6817    2   Y$SHFTO_DFL: ENTRY (SHFCNT);

   6817   1 0019EE  EFC7 002E            Y$SHFTO_DFL     STB,B6   R,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:374  

     2145     6818    2      IF %KV_MVD.ORG~=%KV#VD_ORG_SE THEN OLDCLM = 0;

   6818   1 0019F0  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0019F3  CCC5 0006                            LDB,B4   6,B5
          1 0019F5  E2C4 0015                            LLH,R6   21,B4
          1 0019F7  6D05                                 CMV,R6   5
          1 0019F8  0901 0005                            BE       s:6819,PREL

   6818   1 0019FA  8747 0033                            CL       OLDCLM,AUTO
          1 0019FC  0F81 0007                            B        s:6820,PREL

     2146     6819    2      ELSE OLDCLM = %KV_RCRLST.HRZSCROFS;

   6819   1 0019FE  BCC5 000E                            LDB,B3   14,B5
          1 001A00  D843 0003                            LDR,R5   3,B3
          1 001A02  DF47 0033                            STR,R5   OLDCLM,AUTO

     2147     6820    2      OLDCLM = %KV_MVD.VRTCLM-OLDCLM+%KV_SSN.REDBFR.DSPLOWX;

   6820   1 001A04  CCC5 0006                            LDB,B4   6,B5
          1 001A06  E844 001B                            LDR,R6   27,B4
          1 001A08  E247 0033                            SUB,R6   OLDCLM,AUTO
          1 001A0A  BCC7 000A                            LDB,B3   SSN$,AUTO
          1 001A0C  EA43 002F                            ADD,R6   47,B3
          1 001A0E  EF47 0033                            STR,R6   OLDCLM,AUTO

     2148     6821    2      CALL Y$SHFCNTDFL;

   6821   1 001A10  E3C0 005F                            LNJ,B6   s:0,PREL
          1 001A12       0001                            DC       s:6822,PREL

     2149     6822    2      GOTO Y@SHFRCR;

   6822   1 001A13  0F81 FE59                            B        s:6752,PREL

     2150     6823        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:375  
     2151     6824    2   Y$SHFCNT: PROC;

   6824   1 001A15  EFC7 0034            Y$SHFCNT        STB,B6   OLDCLM+1,AUTO

     2152     6825    3      SHF = %KV_MVD.HRZSCRSHF;

   6825   1 001A17  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 001A1A  CCC5 0006                            LDB,B4   6,B5
          1 001A1C  E2C4 0016                            LLH,R6   22,B4
          1 001A1E  EF47 0032                            STR,R6   SHF,AUTO

     2153     6826    3      EDTX = %KV_MVD.WDT-%KV_SRD.PRMVRTCLM;

   6826   1 001A20  BCC5 000A                            LDB,B3   10,B5
          1 001A22  D844 0013                            LDR,R5   19,B4
          1 001A24  D243 0012                            SUB,R5   18,B3
          1 001A26  DF47 0011                            STR,R5   EDTX,AUTO

     2154     6827    3      OLDCLM = EDTX/2+%KV_SRD.PRMVRTCLM;

   6827   1 001A28  D370 0002                            DIV,R5   2,IMO
          1 001A2A  DA43 0012                            ADD,R5   18,B3
          1 001A2C  DF47 0033                            STR,R5   OLDCLM,AUTO

     2155     6828    4      IF SHF~=%G_SCROLL_CENTER# OR EDTX=1 THEN DO;

   6828   1 001A2E  6D7F                                 CMV,R6   127
          1 001A2F  0981 0006                            BNE      s:6829,PREL
          1 001A31  C847 0011                            LDR,R4   EDTX,AUTO
          1 001A33  4D01                                 CMV,R4   1
          1 001A34  0981 0039                            BNE      s:6837,PREL

     2156     6829    4         IF SHF>%G_SCROLL_CENTER#

   6829   1 001A36  6D7F                                 CMV,R6   127
          1 001A37  0A81 0009                            BALE     s:6831,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:376  
     2157     6830    4         THEN SHF = (EDTX*(SHF-%G_SCROLL_CENTER#)+99)/100;

   6830   1 001A39  6E81                                 ADV,R6   -127
          1 001A3A  EB47 0011                            MUL,R6   EDTX,AUTO
          1 001A3C  6E63                                 ADV,R6   99
          1 001A3D  E370 0064                            DIV,R6   100,IMO
          1 001A3F  EF47 0032                            STR,R6   SHF,AUTO

     2158     6831    4         IF SHF=0 THEN SHF=SHF+1;

   6831   1 001A41  6981 0003                            BNEZ,R6  s:6832,PREL

   6831   1 001A43  8AC7 0032                            INC      SHF,AUTO

     2159     6832    4         SHF = SHF+%KV_MVD.HRZSCRMRG;

   6832   1 001A45  CCC5 0006                            LDB,B4   6,B5
          1 001A47  E2C4 0017                            LLH,R6   23,B4
          1 001A49  EA47 0032                            ADD,R6   SHF,AUTO
          1 001A4B  EF47 0032                            STR,R6   SHF,AUTO

     2160     6833    4         IF SHF*2>EDTX AND EDTX>1 THEN EXIT;

   6833   1 001A4D  6001                                 SOL,R6   1
          1 001A4E  E947 0011                            CMR,R6   EDTX,AUTO
          1 001A50  0A81 0006                            BALE     s:6834,PREL
          1 001A52  C847 0011                            LDR,R4   EDTX,AUTO
          1 001A54  4D01                                 CMV,R4   1
          1 001A55  0A01 0018                            BAG      s:6837,PREL

     2161     6834    4         IF %KV_MVD.VRTCLM<OLDCLM

   6834   1 001A57  D944 001B                            CMR,R5   27,B4
          1 001A59  0A81 000C                            BALE     s:6836,PREL

     2162     6835    4         THEN OLDCLM = %KV_SRD.PRMVRTCLM+SHF;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:377  
   6835   1 001A5B  BCC5 000A                            LDB,B3   10,B5
          1 001A5D  C843 0012                            LDR,R4   18,B3
          1 001A5F  CA47 0032                            ADD,R4   SHF,AUTO
          1 001A61  D854                                 LDR,R5   R4
          1 001A62  DF47 0033                            STR,R5   OLDCLM,AUTO
          1 001A64  0F81 0009                            B        s:6837,PREL

     2163     6836    4         ELSE OLDCLM = %KV_MVD.WDT+1-SHF;

   6836   1 001A66  C844 0013                            LDR,R4   19,B4
          1 001A68  C247 0032                            SUB,R4   SHF,AUTO
          1 001A6A  D854                                 LDR,R5   R4
          1 001A6B  5E01                                 ADV,R5   1
          1 001A6C  DF47 0033                            STR,R5   OLDCLM,AUTO

     2164     6837    4      END;

   6837   1 001A6E  0F81 0003                            B        s:6839,PREL

     2165     6838    3   Y$SHFCNTDFL: ENTRY;

   6838   1 001A70  EFC7 0034            Y$SHFCNTDFL     STB,B6   OLDCLM+1,AUTO

     2166     6839    3      SHF = OLDCLM-%KV_MVD.VRTCLM;

   6839   1 001A72  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 001A75  CCC5 0006                            LDB,B4   6,B5
          1 001A77  E847 0033                            LDR,R6   OLDCLM,AUTO
          1 001A79  E244 001B                            SUB,R6   27,B4
          1 001A7B  EF47 0032                            STR,R6   SHF,AUTO

     2167     6840    4      IF %KV_SSN.REDBFR.DSPLOWX<SHF THEN DO;

   6840   1 001A7D  BCC7 000A                            LDB,B3   SSN$,AUTO
          1 001A7F  E943 002F                            CMR,R6   47,B3
          1 001A81  0A81 0009                            BALE     s:6844,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:378  
     2168     6841    4         SHF = %KV_SSN.REDBFR.DSPLOWX;

   6841   1 001A83  E843 002F                            LDR,R6   47,B3
          1 001A85  EF47 0032                            STR,R6   SHF,AUTO

     2169     6842    4         OLDCLM = %KV_MVD.VRTCLM+SHF;

   6842   1 001A87  EA44 001B                            ADD,R6   27,B4
          1 001A89  EF47 0033                            STR,R6   OLDCLM,AUTO

     2170     6843    4      END;

     2171     6844    3      %KV_SSN.REDBFR.DSPLOWX = %KV_SSN.REDBFR.DSPLOWX-SHF;

   6844   1 001A8B  E843 002F                            LDR,R6   47,B3
          1 001A8D  E247 0032                            SUB,R6   SHF,AUTO
          1 001A8F  EF43 002F                            STR,R6   47,B3

     2172     6845    3      DSPLOWCLM = DSPLOWCLM-SHF;

   6845   1 001A91  D847 0012                            LDR,R5   DSPLOWCLM,AUTO
          1 001A93  D247 0032                            SUB,R5   SHF,AUTO
          1 001A95  DF47 0012                            STR,R5   DSPLOWCLM,AUTO

     2173     6846    3      IF %KV_MVD.ORG=%KV#VD_ORG_SE

   6846   1 001A97  ECC5 0006                            LDB,B6   6,B5
          1 001A99  C2C6 0015                            LLH,R4   21,B6
          1 001A9B  4D05                                 CMV,R4   5
          1 001A9C  0981 000E                            BNE      s:6848,PREL

     2174     6847    3      THEN IF %KV_RCRLST.HRZSCRALL THEN CALL KVE$SCRALL;

   6847   1 001A9E  CCC5 000E                            LDB,B4   14,B5
          1 001AA0  82C4 000C                            LB,'0001'X        12,B4
          1 001AA2       0001
          1 001AA3  0581 0007                            BBF      s:6848,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:379  

   6847   1 001AA5  CBF0 0000                            LAB,B4   0,IMO
          1 001AA7  E380 0000 0000  xent                 LNJ,B6   KVE$SCRALL
          1 001AAA       0001                            DC       s:6848,PREL

     2175     6848    3      %KV_MVD.VRTCLM = %KV_SRD.PRMVRTCLM+1;

   6848   1 001AAB  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001AAE  DCC6 0006                            LDB,B5   6,B6
          1 001AB0  CCC6 000A                            LDB,B4   10,B6
          1 001AB2  E844 0012                            LDR,R6   18,B4
          1 001AB4  6E01                                 ADV,R6   1
          1 001AB5  EF45 001B                            STR,R6   27,B5

     2176     6849    3      CALL KVO$PST (KV_VDH_PST_0_VRT);

   6849   1 001AB7  BB80 0000 0011  02                   LAB,B3   +17
          1 001ABA  CBF0 0100                            LAB,B4   256,IMO
          1 001ABC  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 001ABF       0001                            DC       s:6850,PREL

     2177     6850    3      RETURN;

   6850   1 001AC0  ECC7 0034                            LDB,B6   OLDCLM+1,AUTO
          1 001AC2  C3C6 0001                            LNJ,B4   1,B6

     2178     6851    3   END Y$SHFCNT;
     2179     6852    2   Y$SHFTYPREDBFR: ENTRY (SHFCNT);

   6852   1 001AC4  EFC7 002E            Y$SHFTYPREDBFR  STB,B6   R,AUTO

   6850   1                              Y@SHFTYP        null
     2180     6853
     2181     6854        /* Erase the input field, and type the entire read buffer.
     2182     6855           Leave the cursor positioned at the end.                                    */
     2183     6856
     2184     6857    2   Y@SHFTYP:;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:380  
     2185     6858    2      OLDCLM = 0;

   6858   1 001AC6  8747 0033            Y@SHFTYP        CL       OLDCLM,AUTO

     2186     6859    2      GOTO Y@SHFTYPSGM;

   6859   1 001AC8  0F81 0008                            B        s:6865,PREL

     2187     6860
     2188     6861    2   Y$SHFTYPREDBFRSGM: ENTRY (SHFCNT);

   6861   1 001ACA  EFC7 002E            Y$SHFTYPREDBFRS*STB,B6   R,AUTO

     2189     6862
     2190     6863        /* Type the rest of the input from EDTLOWX, positioned at the parameter. */
     2191     6864
     2192     6865    2      OLDCLM = SHFCNT;

   6865   1 001ACC  DCC7 0030                            LDB,B5   @SHFCNT,AUTO
          1 001ACE  E805                                 LDR,R6   ,B5
          1 001ACF  EF47 0033                            STR,R6   OLDCLM,AUTO

   6865   1                              Y@SHFTYPSGM     null
     2193     6866    2   Y@SHFTYPSGM:;
     2194     6867    2      %VDH_OTPLCL = KV_VDH_OTPLCL;

   6867   1 001AD1  AB80 0000 0000  xsym Y@SHFTYPSGM     LAB,B2   KV_VDH_OTPLCL
          1 001AD4  2C00                                 LDV,R2   0
          1 001AD5  6C0A                                 LDV,R6   10
          1 001AD6  BB87                                 LAB,B3   ,AUTO
          1 001AD7  3C2C                                 LDV,R3   44
          1 001AD8  0008                                 MMM

     2195     6868    2      IF OLDCLM=0 THEN %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX;

   6868   1 001AD9  E847 0033                            LDR,R6   OLDCLM,AUTO
          1 001ADB  6981 0009                            BNEZ,R6  s:6869,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:381  

   6868   1 001ADD  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001ADF  D846 002F                            LDR,R5   47,B6
          1 001AE1  DF47 0019                            STR,R5   FPT+3,AUTO
          1 001AE3  0F81 0007                            B        s:6870,PREL

     2196     6869    2      ELSE %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.EDTLOWX;

   6869   1 001AE5  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001AE7  D846 002B                            LDR,R5   43,B6
          1 001AE9  DF47 0019                            STR,R5   FPT+3,AUTO

     2197     6870    2      %VDH_OTPLCL.BFR_.BYTSIZ = %KV_SSN.REDBFR__.DATBYTSIZ;

   6870   1 001AEB  C846 0033                            LDR,R4   51,B6
          1 001AED  CF47 001A                            STR,R4   FPT+4,AUTO

     2198     6871    3      IF NOT %KV_VDI.RE_DSPINP THEN DO;

   6871   1 001AEF  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 001AF2  CC85                                 LDB,B4   ,B5
          1 001AF3  82C4 0019                            LB,'0010'X        25,B4
          1 001AF5       0010
          1 001AF6  0501 0118                            BBT      s:6928,PREL

     2199     6872    3         %VDH_OTPLCL.BFR_.ADR$ = REDBFR$;

   6872   1 001AF8  ACC7 0008                            LDB,B2   REDBFR$,AUTO
          1 001AFA  AFC7 0017                            STB,B2   FPT+1,AUTO

     2200     6873    3         IF NOT %KV_MVD.DISPINPUT AND NOT %KV_MVD.RETYPOVR

   6873   1 001AFC  CCC5 0006                            LDB,B4   6,B5
          1 001AFE  82C4 0015                            LB,'0080'X        21,B4
          1 001B00       0080
          1 001B01  0501 0006                            BBT      s:6873+12,PREL
          1 001B03  82C4 0016                            LB,'0080'X        22,B4
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:382  
          1 001B05       0080
          1 001B06  0581 0007                            BBF      s:6874,PREL
          1 001B08  9C85                                 LDB,B1   ,B5
          1 001B09  82C1 0019                            LB,'0002'X        25,B1
          1 001B0B       0002
          1 001B0C  0581 0005                            BBF      s:6875,PREL

     2201     6874    3           OR %KV_VDI.HALFDUPLEXPAPERTAPE THEN RETURN;

   6874   1 001B0E  ECC7 002E                            LDB,B6   R,AUTO
          1 001B10  C3C6 0001                            LNJ,B4   1,B6

     2202     6875    3         %VDH_OTPLCL.NO_WRAP = %KV_MVD.HRZSCR;

   6875   1 001B12  B844 0016                            LDR,R3   22,B4
          1 001B14  3002                                 SOL,R3   2
          1 001B15  BAC7 0016                            SRM,R3,'0010'X    FPT,AUTO
          1 001B17       0010

     2203     6876    3         IF %KV_MVD.HRZSCR AND OLDCLM>%KV_MVD.WDT THEN GOTO Y@PSTN_XIT;

   6876   1 001B18  CCC5 0006                            LDB,B4   6,B5
          1 001B1A  82C4 0016                            LB,'0004'X        22,B4
          1 001B1C       0004
          1 001B1D  0581 0007                            BBF      s:6877,PREL
          1 001B1F  6801 0005                            BLZ,R6   s:6877,PREL
          1 001B21  E944 0013                            CMR,R6   19,B4
          1 001B23  0301 00E0                            BG       s:6923,PREL

     2204     6877    3         IF %VDH_OTPLCL.BFR_.BYTSIZ<=%VDH_OTPLCL.BFR_.BYTX

   6877   1 001B25  4801 0009                            BLZ,R4   s:6879,PREL
          1 001B27  C955                                 CMR,R4   R5
          1 001B28  0A01 0006                            BAG      s:6879,PREL

     2205     6878    3         THEN %VDH_OTPLCL.BFR_.BYTSIZ = %VDH_OTPLCL.BFR_.BYTX;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:383  
   6878   1 001B2A  C855                                 LDR,R4   R5
          1 001B2B  CF47 001A                            STR,R4   FPT+4,AUTO
          1 001B2D  0F81 0020                            B        s:6887,PREL

     2206     6879    4         ELSE IF %KV_MVD.RETYPOVR THEN DO;

   6879   1 001B2F  82C4 0016                            LB,'0080'X        22,B4
   6879   1 001B31       0080
          1 001B32  0581 001B                            BBF      s:6887,PREL

     2207     6880        /* Retypovr - HDN if not echoing, and setup for retype at line quiet.         */
     2208     6881
     2209     6882    4            IF NOT %KV_MVD.DISPINPUT AND %KV_VDI.INPUNT~=%KV_INPUNT_BLK

   6882   1 001B34  82C4 0015                            LB,'0080'X        21,B4
   6882   1 001B36       0080
          1 001B37  0501 000D                            BBT      s:6884,PREL
          1 001B39  9C85                                 LDB,B1   ,B5
          1 001B3A  B841 001D                            LDR,R3   29,B1
          1 001B3C  3045                                 SOR,R3   5
          1 001B3D  B570 0003                            AND,R3   3,IMO
          1 001B3F  3D03                                 CMV,R3   3
          1 001B40  0901 0004                            BE       s:6884,PREL

     2210     6883    4            THEN %VDH_OTPLCL.HDN = '1'B;

   6883   1 001B42  8947 0016                            LBT,'0020'X       FPT,AUTO
   6883   1 001B44       0020

     2211     6884    4            %KV_VDI.RE_DSPINP = '1'B;

   6884   1 001B45  CC85                                 LDB,B4   ,B5
          1 001B46  8944 0019                            LBT,'0010'X       25,B4
          1 001B48       0010

     2212     6885    4            %KV_VDI.RE_DSPLOWX = %VDH_OTPLCL.BFR_.BYTSIZ;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:384  
   6885   1 001B49  CC85                                 LDB,B4   ,B5
          1 001B4A  E847 001A                            LDR,R6   FPT+4,AUTO
          1 001B4C  EF44 0016                            STR,R6   22,B4

     2213     6886    4         END /* IF */;

     2214     6887    4         IF OLDCLM~=0 THEN DO;

   6887   1 001B4E  E847 0033                            LDR,R6   OLDCLM,AUTO
          1 001B50  6901 0014                            BEZ,R6   s:6893,PREL

     2215     6888    4            EDTX = OLDCLM;

   6888   1 001B52  EF47 0011                            STR,R6   EDTX,AUTO

     2216     6889    4            OLDCLM = %KV_MVD.VRTCLM;

   6889   1 001B54  CCC5 0006                            LDB,B4   6,B5
          1 001B56  E844 001B                            LDR,R6   27,B4
          1 001B58  EF47 0033                            STR,R6   OLDCLM,AUTO

     2217     6890    4            %KV_MVD.VRTCLM = EDTX;

   6890   1 001B5A  CCC5 0006                            LDB,B4   6,B5
          1 001B5C  D847 0011                            LDR,R5   EDTX,AUTO
          1 001B5E  DF44 001B                            STR,R5   27,B4

     2218     6891    4            EDTX = -1;

   6891   1 001B60  8947 0011                            LBT,'FFFF'X       EDTX,AUTO
   6891   1 001B62       FFFF

     2219     6892    4         END;

   6892   1 001B63  0F81 0008                            B        s:6894,PREL

     2220     6893    3         ELSE CALL Y$EDTX_TO_VRTCLM (OLDCLM);
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:385  

   6893   1 001B65  CBC7 0033                            LAB,B4   OLDCLM,AUTO
          1 001B67  CFC7 0036                            STB,B4   @VRTCLM,AUTO
          1 001B69  E3C0 F581                            LNJ,B6   s:0,PREL
          1 001B6B       0001                            DC       s:6894,PREL

     2221     6894    3         IF %KV_MVD.HRZSCR

   6894   1 001B6C  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001B6F  DCC6 0006                            LDB,B5   6,B6
          1 001B71  82C5 0016                            LB,'0004'X        22,B5
          1 001B73       0004
          1 001B74  0581 0029                            BBF      s:6901,PREL
          1 001B76  E847 0012                            LDR,R6   DSPLOWCLM,AUTO
          1 001B78  6901 000C                            BEZ,R6   s:6894+25,PREL
          1 001B7A  CCC6 000A                            LDB,B4   10,B6
          1 001B7C  D847 0033                            LDR,R5   OLDCLM,AUTO
          1 001B7E  D244 0012                            SUB,R5   18,B4
          1 001B80  C2C5 0017                            LLH,R4   23,B5
          1 001B82  C955                                 CMR,R4   R5
          1 001B83  0881 000B                            BAGE     s:6897,PREL
          1 001B85  D2C5 0017                            LLH,R5   23,B5
          1 001B87  DA47 0033                            ADD,R5   OLDCLM,AUTO
          1 001B89  5801 0014                            BLZ,R5   s:6901,PREL
          1 001B8B  D945 0013                            CMR,R5   19,B5
          1 001B8D  0381 0010                            BLE      s:6901,PREL

     2222     6895    3           AND (DSPLOWCLM~=0 AND OLDCLM-%KV_SRD.PRMVRTCLM<=%KV_MVD.HRZSCRMRG
     2223     6896    4           OR OLDCLM+%KV_MVD.HRZSCRMRG>%KV_MVD.WDT) THEN DO;

     2224     6897    4            %KV_MVD.VRTCLM = OLDCLM;

   6897   1 001B8F  D847 0033                            LDR,R5   OLDCLM,AUTO
          1 001B91  DF45 001B                            STR,R5   27,B5

     2225     6898    4            CALL Y$SHFCNT;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:386  
   6898   1 001B93  E3C0 FE81                            LNJ,B6   s:0,PREL
          1 001B95       0001                            DC       s:6899,PREL

     2226     6899    4            %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.DSPLOWX;

   6899   1 001B96  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001B98  E846 002F                            LDR,R6   47,B6
          1 001B9A  EF47 0019                            STR,R6   FPT+3,AUTO

     2227     6900    4         END;

   6900   1 001B9C  0F81 000E                            B        s:6902,PREL

     2228     6901    3         ELSE IF EDTX<0 THEN CALL KVO$PST (KV_VDH_PST_0_VRT);

   6901   1 001B9E  E847 0011                            LDR,R6   EDTX,AUTO
          1 001BA0  6881 000A                            BGEZ,R6  s:6902,PREL

   6901   1 001BA2  BB80 0000 0011  02                   LAB,B3   +17
          1 001BA5  CBF0 0100                            LAB,B4   256,IMO
          1 001BA7  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 001BAA       0001                            DC       s:6902,PREL

     2229     6902    3         %VDH_OTPLCL.BFR_.BYTSIZ = %VDH_OTPLCL.BFR_.BYTSIZ-%VDH_OTPLCL.BFR_.BYTX;

   6902   1 001BAB  E847 001A                            LDR,R6   FPT+4,AUTO
          1 001BAD  E247 0019                            SUB,R6   FPT+3,AUTO
          1 001BAF  EF47 001A                            STR,R6   FPT+4,AUTO

     2230     6903    3         IF %KV_SRD.FSTERS AND (%KV_SRD.FLDEND.CLM=0

   6903   1 001BB1  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001BB4  DCC6 000A                            LDB,B5   10,B6
          1 001BB6  82C5 000F                            LB,'0040'X        15,B5
          1 001BB8       0040
          1 001BB9  0581 002B                            BBF      s:6919,PREL
          1 001BBB  D845 0011                            LDR,R5   17,B5
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:387  
          1 001BBD  5901 0005                            BEZ,R5   s:6903+18,PREL
          1 001BBF  D945 000C                            CMR,R5   12,B5
          1 001BC1  0981 0023                            BNE      s:6919,PREL
          1 001BC3  CCC6 0008                            LDB,B4   8,B6
          1 001BC5  82C4 0018                            LB,'0200'X        24,B4
          1 001BC7       0200
          1 001BC8  0581 0008                            BBF      s:6912,PREL
          1 001BCA  C2C4 001F                            LLH,R4   31,B4
          1 001BCC  4008                                 SOL,R4   8
          1 001BCD  C570 0900                            AND,R4   2304,IMO
          1 001BCF  4981 0015                            BNEZ,R4  s:6919,PREL

     2231     6904    3           OR %KV_SRD.FLDEND.CLM=%KV_SRD.BTMRHT.CLM)
     2232     6905    3           AND (NOT %KV_MRD.DCLATRWHNOTP
     2233     6906    4           OR NOT %(G#GRPRND_RVRVID|G#GRPRND_UNDSCR)&%KV_MRD.DVCATR) THEN DO;

     2234     6907        /* This device has an erase to end of line or erase to end
     2235     6908           of display function, or a similar function.
     2236     6909           use it to clear the way for the read buffer
     2237     6910           data we're about to display.                                               */
     2238     6911
     2239     6912    4            CALL KVO$ERSTO_ENDOF_INP;

   6912   1 001BD1  CBF0 0000                            LAB,B4   0,IMO
          1 001BD3  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_INP
          1 001BD6       0001                            DC       s:6913,PREL

     2240     6913    4            CALL KVO$OTPLCL (FPT);

   6913   1 001BD7  EBC7 0016                            LAB,B6   FPT,AUTO
          1 001BD9  EFC7 003A                            STB,B6   R+2,AUTO
          1 001BDB  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001BDD  CBF0 0100                            LAB,B4   256,IMO
          1 001BDF  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 001BE2       0001                            DC       s:6914,PREL

     2241     6914    4         END; ELSE DO;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:388  

   6914   1 001BE3  0F81 0013                            B        s:6922,PREL

     2242     6915        /* This device has no erase to end of line or erase to end
     2243     6916           of display. Display the read buffer segment, and then
     2244     6917           erase (with spaces) the rest of the display.                               */
     2245     6918
     2246     6919    4            CALL KVO$OTPLCL (FPT);

   6919   1 001BE5  CBC7 0016                            LAB,B4   FPT,AUTO
          1 001BE7  CFC7 003A                            STB,B4   R+2,AUTO
          1 001BE9  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001BEB  CBF0 0100                            LAB,B4   256,IMO
          1 001BED  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 001BF0       0001                            DC       s:6920,PREL

     2247     6920    4            CALL KVO$ERSTO_ENDOF_INP;

   6920   1 001BF1  CBF0 0000                            LAB,B4   0,IMO
          1 001BF3  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_INP
          1 001BF6       0001                            DC       s:6922,PREL

     2248     6921    4         END /* IF */;

     2249     6922    4         IF OLDCLM~=%KV_MVD.VRTCLM THEN DO;

   6922   1 001BF7  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001BFA  DCC6 0006                            LDB,B5   6,B6
          1 001BFC  E847 0033                            LDR,R6   OLDCLM,AUTO
          1 001BFE  E945 001B                            CMR,R6   27,B5
          1 001C00  0901 001B                            BE       s:6932,PREL

     2250     6923    4            %KV_MVD.VRTCLM = OLDCLM;

   6923   1 001C02  EF45 001B                            STR,R6   27,B5

   6923   1                              Y@PSTN_XIT      null
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:389  
     2251     6924    4   Y@PSTN_XIT:;
     2252     6925    4            CALL KVO$PST (KV_VDH_PST_0_VRT);

   6925   1 001C04  BB80 0000 0011  02   Y@PSTN_XIT      LAB,B3   +17
          1 001C07  CBF0 0100                            LAB,B4   256,IMO
          1 001C09  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 001C0C       0001                            DC       s:6927,PREL

     2253     6926    4         END;

     2254     6927    3      END /* IF */;

   6927   1 001C0D  0F81 000E                            B        s:6932,PREL

     2255     6928    3      ELSE IF %VDH_OTPLCL.BFR_.BYTX<%KV_VDI.RE_DSPLOWX THEN DO;

   6928   1 001C0F  5801 0005                            BLZ,R5   s:6929,PREL
          1 001C11  D944 0016                            CMR,R5   22,B4
          1 001C13  0281 0008                            BGE      s:6932,PREL

     2256     6929    3         %KV_VDI.RE_DSPLOWX = %VDH_OTPLCL.BFR_.BYTX;

   6929   1 001C15  DF44 0016                            STR,R5   22,B4

     2257     6930    3         %KV_SRD.VRTPSTOK = '0'B;

   6930   1 001C17  CCC5 000A                            LDB,B4   10,B5
          1 001C19  8844 000E                            LBF,'0010'X       14,B4
          1 001C1B       0010

     2258     6931    3      END;

     2259     6932    2      RETURN;

   6932   1 001C1C  ECC7 002E                            LDB,B6   R,AUTO
          1 001C1E  C3C6 0001                            LNJ,B4   1,B6

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:390  
     2260     6933        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:391  
     2261     6934    2   END Y$SHFDSPPST;
     2262     6935        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:392  
     2263     6936    1   Y$TRMRED: PROC (VDH_DAT);

   6936   1 001C20  EFC7 0028            Y$TRMRED        STB,B6   TMP,AUTO

     2264     6937
     2265     6938        %KV$VDH_DAT (NAME=VDH_DAT, STCLASS=);
     2266     7018        %INCLUDE KH$CLK;
     2267     7388        %INCLUDE KH_CLKFNC_E;
     2268     7433        %KH$CLK;
     2269     7582        %EQU KH@CLK = CHARTEXT('ADDR(FPT)->KH$CLK');
     2270     7583       %KH$CLK (FPTN=KV_CLK_CANCEL, STCLASS=CONSTANT SYMDEF, FNC=%KH#CLK_CANCEL, NO_CTB=YES
              7583            );
     2271     7732    2   DCL KV_SND_RQSDAT_GNR UBIN SYMREF;
     2272     7733    2   DCL KHC$CLOCK ENTRY(1) ALTRET;
     2273     7734        %KV_CLKNMB_E;
     2274     7743
     2275     7744    3      IF %KV_VDI.INPUNT~=%KV_INPUNT_RCR THEN DO;

   7744   1 001C22  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 001C25  CC85                                 LDB,B4   ,B5
          1 001C26  E844 001D                            LDR,R6   29,B4
          1 001C28  6045                                 SOR,R6   5
          1 001C29  E570 0003                            AND,R6   3,IMO
          1 001C2B  6D02                                 CMV,R6   2
          1 001C2C  0901 0040                            BE       s:7765,PREL

     2276     7745        /* This device doesn't give us records as input.                              */
     2277     7746
     2278     7747    3         IF %KV_VDI.INPUNT=%KV_INPUNT_BLK

   7747   1 001C2E  6D03                                 CMV,R6   3
          1 001C2F  0981 003A                            BNE      s:7763,PREL
          1 001C31  BCC5 0006                            LDB,B3   6,B5
          1 001C33  D2C3 0015                            LLH,R5   21,B3
          1 001C35  5D04                                 CMV,R5   4
          1 001C36  0901 0033                            BE       s:7763,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:393  
     2279     7748    4           AND %KV_MVD.ORG~=%KV#VD_ORG_FORM THEN DO;

     2280     7749    4            IF KV$PTR.INPCNDPND.TRN THEN EXIT;

   7749   1 001C38  89C5 001B                            CMZ      27,B5
          1 001C3A  0801 002D                            BAL      s:7762,PREL

     2281     7750        /* This is a block mode device.
     2282     7751        Move the input field end attribute in to just after the last
     2283     7752        input character.                                                           */
     2284     7753
     2285     7754    4            CALL KVI$RSTINPFLDBGNATR;

   7754   1 001C3C  CBF0 0000                            LAB,B4   0,IMO
          1 001C3E  E380 0000 0000  xent                 LNJ,B6   KVI$RSTINPFLDBGNATR
          1 001C41       0001                            DC       s:7755,PREL

     2286     7755    4            CALL Y$RE_DSPINP;

   7755   1 001C42  E3C0 FA64                            LNJ,B6   s:0,PREL
          1 001C44       0001                            DC       s:7756,PREL

     2287     7756    4            IF ADDR(VDH_DAT)~=ADDR(NIL)

   7756   1 001C45  ECC7 002A                            LDB,B6   @VDH_DAT,AUTO
          1 001C47  8DD6                                 CMN      B6
          1 001C48  0901 0019                            BE       s:7761,PREL

     2288     7757    4            THEN IF KV_GRPCHR (ASCBIN(VDH_DAT.DATCTRCHR))

   7757   1 001C4A  E846 0007                            LDR,R6   7,B6
          1 001C4C  E570 00FF                            AND,R6   255,IMO
          1 001C4E  B856                                 LDR,R3   R6
          1 001C4F  82B0 0000 0000  xsym                 LB       KV_GRPCHR_WRD,R3
          1 001C52  0581 000F                            BBF      s:7761,PREL

     2289     7758        /* Echo the activation char if it is printable. */
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:394  
     2290     7759
     2291     7760    4            THEN CALL KVO$OTP1_VRT (ASCBIN(VDH_DAT.DATCTRCHR));

   7760   1 001C54  BF47 003A                            STR,R3   R+2,AUTO
          1 001C56  DBC7 003A                            LAB,B5   R+2,AUTO
          1 001C58  DFC7 003B                            STB,B5   R+3,AUTO
          1 001C5A  BBC7 003B                            LAB,B3   R+3,AUTO
          1 001C5C  CBF0 0100                            LAB,B4   256,IMO
          1 001C5E  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_VRT
          1 001C61       0001                            DC       s:7761,PREL

     2292     7761    4            CALL KVI$RSTINPFLDENDATR;

   7761   1 001C62  CBF0 0000                            LAB,B4   0,IMO
          1 001C64  E380 0000 0000  xent                 LNJ,B6   KVI$RSTINPFLDENDATR
          1 001C67       0001                            DC       s:7762,PREL

     2293     7762    4         END /* IF */;

   7762   1 001C68  0F81 0004                            B        s:7765,PREL

     2294     7763    3         ELSE CALL Y$RE_DSPINP;

   7763   1 001C6A  E3C0 FA3C                            LNJ,B6   s:0,PREL
          1 001C6C       0001                            DC       s:7765,PREL

     2295     7764    3      END /* IF */;

     2296     7765    2      %KV_VDI.USRRQSDAT.RED = '0'B;

   7765   1 001C6D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001C70  DC86                                 LDB,B5   ,B6
          1 001C71  8845 001D                            LBF,'0010'X       29,B5
          1 001C73       0010

     2297     7766    2      %KV_SSN.REDRQSPND = '0'B;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:395  
   7766   1 001C74  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001C76  8845 0028                            LBF,'0002'X       40,B5
          1 001C78       0002

     2298     7767    2      %KV_SSN.TYPCND = KV$PTR.INPCNDPND;

   7767   1 001C79  8CC6 001B                            LDI      27,B6
          1 001C7B  8D45 0039                            SDI      57,B5

     2299     7768
     2300     7769        %EQU REDCLKS=CONCAT(SUBBIT('00'X,0,KV_CLKNMB_REDTIMOUT),'1'B)|'00'X|
     2301     7770         CONCAT(SUBBIT('00'X,0,KV_CLKNMB_USRREDTIMOUT),'1'B);
     2302     7771    3      IF %KV_SSN.CLKSET&%REDCLKS THEN DO;

   7771   1 001C7D  D845 0029                            LDR,R5   41,B5
          1 001C7F  5008                                 SOL,R5   8
          1 001C80  D570 6000                            AND,R5   24576,IMO
          1 001C82  5901 0042                            BEZ,R5   s:7781,PREL

     2303     7772        /* There is a read timeout clock set;  reset it.                              */
     2304     7773    3         %KH@CLK = KV_CLK_CANCEL;

   7773   1 001C84  CB80 0000 0000  00                   LAB,B4   KV_INPFNC_PRMIDS
          1 001C87  5C16                                 LDV,R5   22
          1 001C88  0021                                 ALR      ;
          1 001C89       5004 00F3                                ALPHANUM(243,B4,,16),;
          1 001C8B       4007 0016                                ALPHANUM(FPT,AUTO,,R5,FILL)

     2305     7774    3         %KH@CLK.UID$ = ADDR(%KV_SSN);

   7774   1 001C8D  437F                                 CSYNC    s:7773+8,SPREL
          1 001C8E  DFC7 0018                            STB,B5   FPT+2,AUTO

     2306     7775    3         %KH@CLK.UVAL = %KV_CLKNMB_REDTIMOUT;

   7775   1 001C90  6C01                                 LDV,R6   1
          1 001C91  EF47 001A                            STR,R6   FPT+4,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:396  

     2307     7776    3         IF %KV_SSN.CLKSET(%KV_CLKNMB_REDTIMOUT) THEN CALL KHC$CLOCK (FPT);

   7776   1 001C93  82C5 0029                            LB,'0040'X        41,B5
   7776   1 001C95       0040
          1 001C96  0581 000D                            BBF      s:7777,PREL

   7776   1 001C98  CBC7 0016                            LAB,B4   FPT,AUTO
          1 001C9A  CFC7 003A                            STB,B4   R+2,AUTO
          1 001C9C  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001C9E  CBF0 0100                            LAB,B4   256,IMO
          1 001CA0  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 001CA3       0001                            DC       s:7777,PREL

     2308     7777    3         %KH@CLK.UVAL = %KV_CLKNMB_USRREDTIMOUT;

   7777   1 001CA4  6C02                                 LDV,R6   2
          1 001CA5  EF47 001A                            STR,R6   FPT+4,AUTO

     2309     7778    3         IF %KV_SSN.CLKSET(%KV_CLKNMB_USRREDTIMOUT) THEN CALL KHC$CLOCK (FPT);

   7778   1 001CA7  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001CA9  82C6 0029                            LB,'0020'X        41,B6
          1 001CAB       0020
          1 001CAC  0581 000D                            BBF      s:7779,PREL

   7778   1 001CAE  DBC7 0016                            LAB,B5   FPT,AUTO
          1 001CB0  DFC7 003A                            STB,B5   R+2,AUTO
          1 001CB2  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001CB4  CBF0 0100                            LAB,B4   256,IMO
          1 001CB6  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 001CB9       0001                            DC       s:7779,PREL

     2310     7779    3         %KV_SSN.CLKSET = %KV_SSN.CLKSET&%(~REDCLKS);

   7779   1 001CBA  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001CBC  E846 0029                            LDR,R6   41,B6
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:397  
          1 001CBE  6008                                 SOL,R6   8
          1 001CBF  E570 9F00                            AND,R6   -24832,IMO
          1 001CC1  6048                                 SOR,R6   8
          1 001CC2  EAC6 0029                            SRM,R6,'00FF'X    41,B6
          1 001CC4       00FF

     2311     7780    3      END;

     2312     7781    2      IF NOT %KV_SSN.WATINPDLTMRK THEN %KV_SSN.BRKCNT = 0;

   7781   1 001CC5  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001CC7  82C6 0028                            LB,'1000'X        40,B6
          1 001CC9       1000
          1 001CCA  0501 0003                            BBT      s:7782,PREL

   7781   1 001CCC  87C6 0025                            CLH      37,B6

     2313     7782    2      %KV_SSN.REDSTRID = 0;

   7782   1 001CCE  87C6 0038                            CLH      56,B6

     2314     7783    2      IF %KV_VDI.USREVTENB (%KV_USR_EVT_ID_TRMUSRRQSDAT)

   7783   1 001CD0  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 001CD3  CC85                                 LDB,B4   ,B5
          1 001CD4  82C4 001F                            LB,'0400'X        31,B4
          1 001CD6       0400
          1 001CD7  0581 000A                            BBF      s:7785,PREL

     2315     7784    2      THEN CALL KVV$CALUSR_EVT (%KV_USR_EVT_ID_TRMUSRRQSDAT);

   7784   1 001CD9  BB80 0000 0043  02                   LAB,B3   +67
          1 001CDC  CBF0 0100                            LAB,B4   256,IMO
          1 001CDE  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_EVT
          1 001CE1       0001                            DC       s:7785,PREL

     2316     7785    3      IF %KV_VDI.FULLDUPLEXPAPERTAPE OR %KV_VDI.HALFDUPLEXPAPERTAPE THEN DO;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:398  

   7785   1 001CE2  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001CE5  DC86                                 LDB,B5   ,B6
          1 001CE6  82C5 0019                            LB,'0020'X        25,B5
          1 001CE8       0020
          1 001CE9  0501 0006                            BBT      s:7786,PREL
          1 001CEB  82C5 0019                            LB,'0002'X        25,B5
          1 001CED       0002
          1 001CEE  0581 0043                            BBF      s:7801,PREL

     2317     7786    3         IF %KV_VDI.SSNCNT=1 AND %KV_STR.SNDMAXNMBRCR=1 THEN EXIT;

   7786   1 001CF0  E845 000E                            LDR,R6   14,B5
          1 001CF2  6D01                                 CMV,R6   1
          1 001CF3  0981 0008                            BNE      s:7790,PREL
          1 001CF5  CCC6 0004                            LDB,B4   4,B6
          1 001CF7  D844 0019                            LDR,R5   25,B4
          1 001CF9  5D01                                 CMV,R5   1
          1 001CFA  0901 0037                            BE       s:7801,PREL

     2318     7787        /*
     2319     7788           Send XON again if there's any reads still pending
     2320     7789        */
     2321     7790    3         B3 = %KV_VDI.SSN$;

   7790   1 001CFC  CCC5 0004                            LDB,B4   4,B5
          1 001CFE  CFC7 000C                            STB,B4   B3,AUTO

     2322     7791    4         IF %KV_VDI.SSNCNT>1 THEN DO WHILE B3~=ADDR(NIL);

   7791   1 001D00  6D01                                 CMV,R6   1
          1 001D01  0381 0023                            BLE      s:7797,PREL

   7791   1 001D03  0F81 001E                            B        s:7796,PREL

     2323     7792    4            IF B3->KV$SSN.SNCPTR$->KV$PTR.STR$->KV$STR.SNDMAXNMBRCR>1

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:399  
   7792   1 001D05  ECC7 000C                            LDB,B6   B3,AUTO
          1 001D07  DCC6 0008                            LDB,B5   8,B6
          1 001D09  CCC5 0004                            LDB,B4   4,B5
          1 001D0B  E844 0019                            LDR,R6   25,B4
          1 001D0D  6D01                                 CMV,R6   1
          1 001D0E  0A01 0016                            BAG      s:7797,PREL
          1 001D10  6901 0008                            BEZ,R6   s:7792+20,PREL
          1 001D12  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 001D15  EDC3 0002                            CMB,B6   2,B3
          1 001D17  0981 000D                            BNE      s:7797,PREL
          1 001D19  82C6 0028                            LB,'0002'X        40,B6
          1 001D1B       0002
          1 001D1C  0501 0008                            BBT      s:7797,PREL

     2324     7793    4              OR B3->KV$SSN.SNCPTR$->KV$PTR.STR$->KV$STR.SNDMAXNMBRCR~=0
     2325     7794    4              AND B3~=KV$PTR.SSN$ OR B3->KV$SSN.REDRQSPND THEN EXIT;
     2326     7795    4            B3 = B3->KV$SSN.LNK$;

   7795   1 001D1E  BCC6 0002                            LDB,B3   2,B6
          1 001D20  BFC7 000C                            STB,B3   B3,AUTO

     2327     7796    4         END;

   7796   1 001D22  8DC7 000C                            CMN      B3,AUTO
          1 001D24  09E1                                 BNE      s:7792,SPREL

     2328     7797    3         IF B3=ADDR(NIL) THEN EXIT;

   7797   1 001D25  8DC7 000C                            CMN      B3,AUTO
          1 001D27  0901 000A                            BE       s:7801,PREL

     2329     7798    3         CALL KVO$OTP1_VRT (%ASCIIDC1);

   7798   1 001D29  BB80 0000 0046  02                   LAB,B3   +70
          1 001D2C  CBF0 0100                            LAB,B4   256,IMO
          1 001D2E  E380 0000 0000  xent                 LNJ,B6   KVO$OTP1_VRT
          1 001D31       0001                            DC       s:7801,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:400  

     2330     7799    3      END;

     2331     7800        /* Enable defered message delivery again. */
     2332     7801    2      IF %KV_SSN.TYPAHDBFRHED$=%KV_SSN.TYPAHDBFRINS$

   7801   1 001D32  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001D34  DCC6 000A                            LDB,B5   10,B6
          1 001D36  DDC6 000E                            CMB,B5   14,B6
          1 001D38  0981 0016                            BNE      s:7805,PREL
          1 001D3A  E845 0002                            LDR,R6   2,B5
          1 001D3C  E570 00FF                            AND,R6   255,IMO
          1 001D3E  6D06                                 CMV,R6   6
          1 001D3F  0281 000F                            BGE      s:7805,PREL
          1 001D41  82C6 0028                            LB,'4000'X        40,B6
          1 001D43       4000
          1 001D44  0581 000A                            BBF      s:7805,PREL

     2333     7802    2        AND %KV_SSN.TYPAHDBFRHED$->KV$TYPAHDBFR.CHRX_HI<LENGTHC(KV$TYPAHDBFR)
     2334     7803    2        AND %KV_SSN.OTPBLK
     2335     7804    2      THEN CALL KVM$SND (KV_SND_RQSDAT_GNR);

   7804   1 001D46  BB80 0000 0048  02                   LAB,B3   +72
          1 001D49  CBF0 0100                            LAB,B4   256,IMO
          1 001D4B  E380 0000 0000  xent                 LNJ,B6   KVM$SND
          1 001D4E       0001                            DC       s:7805,PREL

     2336     7805    2      RETURN;

   7805   1 001D4F  ECC7 0028                            LDB,B6   TMP,AUTO
          1 001D51  C3C6 0001                            LNJ,B4   1,B6

     2337     7806    2   END;
     2338     7807        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:401  
     2339     7808    1   Y$TYPAHDTXT: PROC (KV$INPOPR_DUMMY);

   7808   1 001D53  EFC7 0026            Y$TYPAHDTXT     STB,B6   FPT+16,AUTO

     2340     7809
     2341     7810        %KV$INPOPR (STCLASS=PARAM);
     2342     7909
     2343     7910        /*I* NAME: Y$TYPAHDTXT.
     2344     7911             PURPOSE: Moves the text of a INPOPR_TXT with disp=typeahead into
     2345     7912             typeahead buffers. */
     2346     7913        /* R5 has starting index into the text                                        */
     2347     7914
     2348     7915    2      B3 = %KV_SSN.TYPAHDBFRHED$;

   7915   1 001D55  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001D57  CCC5 000A                            LDB,B4   10,B5
          1 001D59  CFC7 000C                            STB,B4   B3,AUTO

     2349     7916        /* This loop is traversed for each typeahead buffer, starting
     2350     7917           at the head, until the last buffer with
     2351     7918           KV$TYPAHDBFR.INPFNCTXT set is found.                                       */
     2352     7919
     2353     7920    2      IF B3->KV$TYPAHDBFR.INPFNCTXT AND ADDR(KV$INPOPR_DUMMY)=INPOPR$

   7920   1 001D5B  89C4 0002                            CMZ      2,B4
          1 001D5D  0881 0016                            BAGE     s:7931,PREL
          1 001D5F  BCC7 0028                            LDB,B3   @KV$INPOPR_DUMMY,AUTO
          1 001D61  BDC7 0006                            CMB,B3   INPOPR$,AUTO
          1 001D63  0981 0010                            BNE      s:7931,PREL

     2354     7921    3      THEN DO WHILE '1'B;

     2355     7922
     2356     7923    3         IF B3->KV$TYPAHDBFR.LNK$=ADDR(NIL) THEN EXIT;

   7923   1 001D65  ECC7 000C                            LDB,B6   B3,AUTO
          1 001D67  8D86                                 CMN      ,B6
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:402  
          1 001D68  0901 0009                            BE       s:7926+1,PREL

     2357     7924    3         IF NOT B3->KV$TYPAHDBFR.LNK$->KV$TYPAHDBFR.INPFNCTXT THEN EXIT;

   7924   1 001D6A  DC86                                 LDB,B5   ,B6
          1 001D6B  89C5 0002                            CMZ      2,B5
          1 001D6D  0881 0004                            BAGE     s:7926+1,PREL

     2358     7925    3         B3 = B3->KV$TYPAHDBFR.LNK$;

   7925   1 001D6F  DFC7 000C                            STB,B5   B3,AUTO

     2359     7926    3      END /* LOOP */;

   7926   1 001D71  0FF4                                 B        s:7923,SPREL
          1 001D72  0F81 0031                            B        s:7944,PREL

     2360     7927    3      ELSE DO;

     2361     7928        /* The head buffer wasn't created by input function text.
     2362     7929           Get a buffer, and queue it on in front of the head. */
     2363     7930
     2364     7931    3         %VDH_GETBFR = KV_VDH_GETBFR;

   7931   1 001D74  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_GETBFR
          1 001D77  2C00                                 LDV,R2   0
          1 001D78  6C16                                 LDV,R6   22
          1 001D79  BB87                                 LAB,B3   ,AUTO
          1 001D7A  3C2C                                 LDV,R3   44
          1 001D7B  0008                                 MMM

     2365     7932    3         %VDH_GETBFR.STRTYP = %KV_STRTYP_TYPAHDBFR;

   7932   1 001D7C  6C19                                 LDV,R6   25
          1 001D7D  E7C7 001C                            STH,R6   FPT+6,AUTO

     2366     7933    3         CALL KVS$GETBFR (FPT)
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:403  

   7933   1 001D7F  EBC7 0016                            LAB,B6   FPT,AUTO
          1 001D81  EFC7 003A                            STB,B6   R+2,AUTO
          1 001D83  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001D85  CBF0 0100                            LAB,B4   256,IMO
          1 001D87  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 001D8A       0003                            DC       s:7934,PREL
          1 001D8B  0F81 0005                            B        s:7935,PREL

     2367     7934    4         WHENALTRETURN DO; RETURN; END;

   7934   1 001D8D  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 001D8F  C3C6 0001                            LNJ,B4   1,B6

     2368     7935    3         B3 = %VDH_GETBFR.BFR$;

   7935   1 001D91  ECC7 0017                            LDB,B6   FPT+1,AUTO
          1 001D93  EFC7 000C                            STB,B6   B3,AUTO

     2369     7936    3         %KV_SSN.TYPAHDBFRCNT = %KV_SSN.TYPAHDBFRCNT+1;

   7936   1 001D95  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001D97  E2C5 0027                            LLH,R6   39,B5
          1 001D99  6E01                                 ADV,R6   1
          1 001D9A  E7C5 0027                            STH,R6   39,B5

     2370     7937    3         B3->KV$TYPAHDBFR.LNK$ = %KV_SSN.TYPAHDBFRHED$;

   7937   1 001D9C  CCC5 000A                            LDB,B4   10,B5
          1 001D9E  CF86                                 STB,B4   ,B6

     2371     7938    3         %KV_SSN.TYPAHDBFRHED$ = B3;

   7938   1 001D9F  EFC5 000A                            STB,B6   10,B5

     2372     7939    3         B3->KV$TYPAHDBFR.INPFNCTXT = '1'B;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:404  
   7939   1 001DA1  8946 0002                            LBT,'8000'X       2,B6
   7939   1 001DA3       8000

     2373     7940    3      END /* IF */;

     2374     7941
     2375     7942        /* B3 points to the buffer to put characters into.                            */
     2376     7943
     2377     7944    3      DO WHILE R5<KV$INPOPR_TXT.L;

   7944   1 001DA4  DCC7 0028                            LDB,B5   @KV$INPOPR_DUMMY,AUTO
          1 001DA6  E2C5 0001                            LLH,R6   1,B5
          1 001DA8  E947 0010                            CMR,R6   R5,AUTO
          1 001DAA  0A81 005C                            BALE     s:7970,PREL

     2378     7945        /* This loop is traversed for each character transferred
     2379     7946           to type-ahead buffers.                                                     */
     2380     7947
     2381     7948    4         IF B3->KV$TYPAHDBFR.CHRX_HI>=%KV_TYPAHDBFR_CHRX_HI THEN DO;

   7948   1 001DAC  ECC7 000C                            LDB,B6   B3,AUTO
          1 001DAE  E846 0002                            LDR,R6   2,B6
          1 001DB0  E570 00FF                            AND,R6   255,IMO
          1 001DB2  6D1F                                 CMV,R6   31
          1 001DB3  0201 0035                            BL       s:7964,PREL

     2382     7949        /* We're at the end of this buffer.                                           */
     2383     7950
     2384     7951    4            %VDH_GETBFR = KV_VDH_GETBFR;

   7951   1 001DB5  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_GETBFR
          1 001DB8  2C00                                 LDV,R2   0
          1 001DB9  6C16                                 LDV,R6   22
          1 001DBA  BB87                                 LAB,B3   ,AUTO
          1 001DBB  3C2C                                 LDV,R3   44
          1 001DBC  0008                                 MMM

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:405  
     2385     7952    4            %VDH_GETBFR.STRTYP = %KV_STRTYP_TYPAHDBFR;

   7952   1 001DBD  6C19                                 LDV,R6   25
          1 001DBE  E7C7 001C                            STH,R6   FPT+6,AUTO

     2386     7953    4            CALL KVS$GETBFR (FPT)

   7953   1 001DC0  EBC7 0016                            LAB,B6   FPT,AUTO
          1 001DC2  EFC7 003A                            STB,B6   R+2,AUTO
          1 001DC4  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001DC6  CBF0 0100                            LAB,B4   256,IMO
          1 001DC8  E380 0000 0000  xent                 LNJ,B6   KVS$GETBFR
          1 001DCB       0003                            DC       s:7954,PREL
          1 001DCC  0F81 0005                            B        s:7955,PREL

     2387     7954    5            WHENALTRETURN DO; RETURN; END;

   7954   1 001DCE  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 001DD0  C3C6 0001                            LNJ,B4   1,B6

     2388     7955    4            %KV_SSN.TYPAHDBFRCNT = %KV_SSN.TYPAHDBFRCNT+1;

   7955   1 001DD2  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001DD4  E2C6 0027                            LLH,R6   39,B6
          1 001DD6  6E01                                 ADV,R6   1
          1 001DD7  E7C6 0027                            STH,R6   39,B6

     2389     7956    4            %VDH_GETBFR.BFR$->KV$TYPAHDBFR.LNK$ = B3->KV$TYPAHDBFR.LNK$;

   7956   1 001DD9  DCC7 000C                            LDB,B5   B3,AUTO
          1 001DDB  CC85                                 LDB,B4   ,B5
          1 001DDC  BCC7 0017                            LDB,B3   FPT+1,AUTO
          1 001DDE  CF83                                 STB,B4   ,B3

     2390     7957    4            B3->KV$TYPAHDBFR.LNK$ = %VDH_GETBFR.BFR$;

   7957   1 001DDF  CCC7 0017                            LDB,B4   FPT+1,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:406  
          1 001DE1  CF85                                 STB,B4   ,B5

     2391     7958    4            B3 = %VDH_GETBFR.BFR$;

   7958   1 001DE2  BCC7 0017                            LDB,B3   FPT+1,AUTO
          1 001DE4  BFC7 000C                            STB,B3   B3,AUTO

     2392     7959    4            B3->KV$TYPAHDBFR.INPFNCTXT = '1'B;

   7959   1 001DE6  8943 0002                            LBT,'8000'X       2,B3
   7959   1 001DE8       8000

     2393     7960    4         END /* IF */;

     2394     7961
     2395     7962        /* Move the character from the INPOPR to the type-ahead buffer.               */
     2396     7963
     2397     7964    3         B3->KV$TYPAHDBFR.CHRX_HI = B3->KV$TYPAHDBFR.CHRX_HI+1;

   7964   1 001DE9  ECC7 000C                            LDB,B6   B3,AUTO
          1 001DEB  E846 0002                            LDR,R6   2,B6
          1 001DED  EA70 0001                            ADD,R6   1,IMO
          1 001DEF  EAC6 0002                            SRM,R6,'00FF'X    2,B6
          1 001DF1       00FF

     2398     7965    3         B3->KV$TYPAHDBFR_CHR(B3->KV$TYPAHDBFR.CHRX_HI) =

   7965   1 001DF2  B846 0002                            LDR,R3   2,B6
          1 001DF4  B570 00FF                            AND,R3   255,IMO
          1 001DF6  DCC7 0028                            LDB,B5   @KV$INPOPR_DUMMY,AUTO
          1 001DF8  E2C5 0001                            LLH,R6   1,B5
          1 001DFA  A847 0010                            LDR,R2   R5,AUTO
          1 001DFC  2E03                                 ADV,R2   3
          1 001DFD  D0A5                                 LDH,R5   ,B5,R2
          1 001DFE  D7B6                                 STH,R5   ,B6,R3

     2399     7966    3           SUBSTR (KV$INPOPR_TXT.T,R5,1);
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:407  
     2400     7967
     2401     7968    3         R5 = R5+1;

   7968   1 001DFF  8AC7 0010                            INC      R5,AUTO

     2402     7969    3      END /* LOOP */;

   7969   1 001E01  E2C5 0001                            LLH,R6   1,B5
          1 001E03  E947 0010                            CMR,R6   R5,AUTO
          1 001E05  0A01 FFA6                            BAG      s:7948,PREL

     2403     7970    2      RETURN;

   7970   1 001E07  ECC7 0026                            LDB,B6   FPT+16,AUTO
          1 001E09  C3C6 0001                            LNJ,B4   1,B6

     2404     7971    2   END;
     2405     7972        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:408  
     2406     7973    1   Y$TYPREDBFRSGM: PROC;

   7973   1 001E0B  EFC7 002A            Y$TYPREDBFRSGM  STB,B6   @VDH_DAT,AUTO

     2407     7974
     2408     7975        /* Type a segment of a read buffer, from EDTLOWX thru EDTHI_X. */
     2409     7976
     2410     7977    2      IF %KV_SSN.REDBFR.EDTHI_X<%KV_SSN.REDBFR.EDTLOWX THEN RETURN;

   7977   1 001E0D  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001E0F  E845 002C                            LDR,R6   44,B5
          1 001E11  E945 002B                            CMR,R6   43,B5
          1 001E13  0881 0005                            BAGE     s:7978,PREL

   7977   1 001E15  ECC7 002A                            LDB,B6   @VDH_DAT,AUTO
          1 001E17  C3C6 0001                            LNJ,B4   1,B6

     2411     7978    2      R5 = %KV_SSN.REDBFR.EDTHI_X-%KV_SSN.REDBFR.EDTLOWX+1;

   7978   1 001E19  E245 002B                            SUB,R6   43,B5
          1 001E1B  6E01                                 ADV,R6   1
          1 001E1C  EF47 0010                            STR,R6   R5,AUTO

     2412     7979    3      IF %KV_SSN.CHNCAS AND NOT %KV_SSN.REDONL THEN DO;

   7979   1 001E1E  82C5 0027                            LB,'0080'X        39,B5
   7979   1 001E20       0080
          1 001E21  0581 0034                            BBF      s:7986,PREL
          1 001E23  82C5 0028                            LB,'0200'X        40,B5
          1 001E25       0200
          1 001E26  0501 002F                            BBT      s:7986,PREL

     2413     7980    3         CALL XLATE (SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR.EDTLOWX,R5),

   7980   1 001E28  D845 002B                            LDR,R5   43,B5
          1 001E2A  B800 0000 004A  02                   LDR,R3   +74
          1 001E2D  EBB0 0000 0000  01                   LAB,B6   s:9,R3
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:409  
          1 001E30  DF47 003A                            STR,R5   R+2,AUTO
          1 001E32  ACC7 0008                            LDB,B2   REDBFR$,AUTO
          1 001E34  A855                                 LDR,R2   R5
          1 001E35  BB82                                 LAB,B3   ,B2
          1 001E36  B852                                 LDR,R3   R2
          1 001E37  F856                                 LDR,R7   R6
          1 001E38  9B80 0000 005C  00                   LAB,B1   Y_CHNCAS
          1 001E3B  1C00                                 LDV,R1   0
          1 001E3C  D870 00FF                            LDR,R5   255,IMO
          1 001E3E  D380 0000 0000  xent                 LNJ,B5   X6C_MAT

     2414     7981    3           Y_CHNCAS, SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR.EDTLOWX,R5));
     2415     7982    3         IF %KV_VDI.RE_DSPINP

   7982   1 001E41  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001E44  DC86                                 LDB,B5   ,B6
          1 001E45  82C5 0019                            LB,'0010'X        25,B5
          1 001E47       0010
          1 001E48  0581 000D                            BBF      s:7986,PREL

     2416     7983    3         THEN IF %KV_SSN.REDBFR.EDTLOWX<%KV_VDI.RE_DSPLOWX

   7983   1 001E4A  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 001E4C  E844 002B                            LDR,R6   43,B4
          1 001E4E  6801 0005                            BLZ,R6   s:7984,PREL
          1 001E50  E945 0016                            CMR,R6   22,B5
          1 001E52  0281 0003                            BGE      s:7986,PREL

     2417     7984    3         THEN %KV_VDI.RE_DSPLOWX = %KV_SSN.REDBFR.EDTLOWX;

   7984   1 001E54  EF45 0016                            STR,R6   22,B5

     2418     7985    3      END;

     2419     7986    2      IF (%KV_MVD.DISPINPUT OR %KV_MVD.RETYPOVR)

   7986   1 001E56  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:410  
          1 001E59  DCC6 0006                            LDB,B5   6,B6
          1 001E5B  82C5 0015                            LB,'0080'X        21,B5
          1 001E5D       0080
          1 001E5E  0501 0006                            BBT      s:7986+15,PREL
          1 001E60  82C5 0016                            LB,'0080'X        22,B5
          1 001E62       0080
          1 001E63  0581 0059                            BBF      s:8003,PREL
          1 001E65  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 001E67  E844 0033                            LDR,R6   51,B4
          1 001E69  6901 0053                            BEZ,R6   s:8003,PREL

     2420     7987    2        AND %KV_SSN.REDBFR__.DATBYTSIZ~=0
     2421     7988    2      THEN IF %KV_VDI.RE_DSPINP THEN %KV_SRD.VRTPSTOK = '0'B;

   7988   1 001E6B  BC86                                 LDB,B3   ,B6
          1 001E6C  82C3 0019                            LB,'0010'X        25,B3
          1 001E6E       0010
          1 001E6F  0581 0008                            BBF      s:7989,PREL

   7988   1 001E71  ACC6 000A                            LDB,B2   10,B6
          1 001E73  8842 000E                            LBF,'0010'X       14,B2
          1 001E75       0010
          1 001E76  0F81 0046                            B        s:8003,PREL

     2422     7989    3      ELSE IF NOT %KV_VDI.HALFDUPLEXPAPERTAPE THEN DO;

   7989   1 001E78  82C3 0019                            LB,'0002'X        25,B3
   7989   1 001E7A       0002
          1 001E7B  0501 0041                            BBT      s:8003,PREL

     2423     7990        /* There is data in the read buffer.                                       */
     2424     7991
     2425     7992    3         %VDH_OTPLCL = KV_VDH_OTPLCL;

   7992   1 001E7D  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_OTPLCL
          1 001E80  2C00                                 LDV,R2   0
          1 001E81  6C0A                                 LDV,R6   10
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:411  
          1 001E82  BB87                                 LAB,B3   ,AUTO
          1 001E83  3C2C                                 LDV,R3   44
          1 001E84  0008                                 MMM

     2426     7993    3         %VDH_OTPLCL.BFR_.ADR$ = REDBFR$;

   7993   1 001E85  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 001E87  EFC7 0017                            STB,B6   FPT+1,AUTO

     2427     7994    3         %VDH_OTPLCL.BFR_.BYTX = %KV_SSN.REDBFR.EDTLOWX;

   7994   1 001E89  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001E8B  E845 002B                            LDR,R6   43,B5
          1 001E8D  EF47 0019                            STR,R6   FPT+3,AUTO

     2428     7995    3         %VDH_OTPLCL.BFR_.BYTSIZ = R5;

   7995   1 001E8F  D847 0010                            LDR,R5   R5,AUTO
          1 001E91  DF47 001A                            STR,R5   FPT+4,AUTO

     2429     7996    3         IF NOT %KV_MVD.DISPINPUT AND %KV_VDI.INPUNT~=%KV_INPUNT_BLK

   7996   1 001E93  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 001E96  ACC4 0006                            LDB,B2   6,B4
          1 001E98  82C2 0015                            LB,'0080'X        21,B2
          1 001E9A       0080
          1 001E9B  0501 000D                            BBT      s:8000,PREL
          1 001E9D  9C84                                 LDB,B1   ,B4
          1 001E9E  C841 001D                            LDR,R4   29,B1
          1 001EA0  4045                                 SOR,R4   5
          1 001EA1  C570 0003                            AND,R4   3,IMO
          1 001EA3  4D03                                 CMV,R4   3
          1 001EA4  0901 0004                            BE       s:8000,PREL

     2430     7997        /* Simulate a hidden field (must be retypovr)                              */
     2431     7998
     2432     7999    3         THEN %VDH_OTPLCL.HDN = '1'B;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:412  

   7999   1 001EA6  8947 0016                            LBT,'0020'X       FPT,AUTO
   7999   1 001EA8       0020

     2433     8000    3         %VDH_OTPLCL.NO_WRAP = %KV_MVD.HRZSCR;

   8000   1 001EA9  ACC4 0006                            LDB,B2   6,B4
          1 001EAB  C842 0016                            LDR,R4   22,B2
          1 001EAD  4002                                 SOL,R4   2
          1 001EAE  CAC7 0016                            SRM,R4,'0010'X    FPT,AUTO
          1 001EB0       0010

     2434     8001    3         CALL KVO$OTPLCL (FPT);

   8001   1 001EB1  ABC7 0016                            LAB,B2   FPT,AUTO
          1 001EB3  AFC7 003A                            STB,B2   R+2,AUTO
          1 001EB5  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001EB7  CBF0 0100                            LAB,B4   256,IMO
          1 001EB9  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 001EBC       0001                            DC       s:8003,PREL

     2435     8002    3      END /* IF */;

     2436     8003    2      %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.EDTHI_X+1;

   8003   1 001EBD  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001EBF  8AC6 002C                            INC      44,B6

     2437     8004    2      %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.EDTHI_X;

   8004   1 001EC1  E846 002C                            LDR,R6   44,B6
          1 001EC3  EF46 002B                            STR,R6   43,B6

     2438     8005    2      IF %KV_MVD.HRZSCR AND NOT %KV_VDI.RE_DSPINP

   8005   1 001EC5  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 001EC8  CCC5 0006                            LDB,B4   6,B5
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:413  
          1 001ECA  82C4 0016                            LB,'0004'X        22,B4
          1 001ECC       0004
          1 001ECD  0581 002F                            BBF      s:8012,PREL
          1 001ECF  BC85                                 LDB,B3   ,B5
          1 001ED0  82C3 0019                            LB,'0010'X        25,B3
          1 001ED2       0010
          1 001ED3  0501 0029                            BBT      s:8012,PREL

     2439     8006    2      THEN IF %KV_MVD.VRTCLM+%KV_MVD.HRZSCRMRG>%KV_MVD.WDT

   8006   1 001ED5  D2C4 0017                            LLH,R5   23,B4
          1 001ED7  DA44 001B                            ADD,R5   27,B4
          1 001ED9  5801 0023                            BLZ,R5   s:8012,PREL
          1 001EDB  D944 0013                            CMR,R5   19,B4
          1 001EDD  0381 001F                            BLE      s:8012,PREL
          1 001EDF  D2C4 0017                            LLH,R5   23,B4
          1 001EE1  DA56                                 ADD,R5   R6
          1 001EE2  D946 002A                            CMR,R5   42,B6
          1 001EE4  0A81 0009                            BALE     s:8009,PREL
          1 001EE6  D844 001B                            LDR,R5   27,B4
          1 001EE8  5801 0014                            BLZ,R5   s:8012,PREL
          1 001EEA  D944 0013                            CMR,R5   19,B4
          1 001EEC  0381 0010                            BLE      s:8012,PREL

     2440     8007    2        AND (%KV_SSN.REDBFR.EDTLOWX+%KV_MVD.HRZSCRMRG<=%KV_SSN.REDBFR.NXTX
     2441     8008    3        OR %KV_MVD.VRTCLM>%KV_MVD.WDT) THEN DO;

     2442     8009    3         CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);

   8009   1 001EEE  ABC4 001B                            LAB,B2   27,B4
          1 001EF0  AFC7 0036                            STB,B2   @VRTCLM,AUTO
          1 001EF2  E3C0 F1F8                            LNJ,B6   s:0,PREL
          1 001EF4       0001                            DC       s:8010,PREL

     2443     8010    3         CALL Y$SHFDSPPST;

   8010   1 001EF5  EB80 0000 0000                       LAB,B6   0
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:414  
          1 001EF8  EFC7 0030                            STB,B6   @SHFCNT,AUTO
          1 001EFA  E3C0 F8FC                            LNJ,B6   s:0,PREL
          1 001EFC       0001                            DC       s:8012,PREL

     2444     8011    3      END;

     2445     8012    2      RETURN;

   8012   1 001EFD  ECC7 002A                            LDB,B6   @VDH_DAT,AUTO
          1 001EFF  C3C6 0001                            LNJ,B4   1,B6

     2446     8013    2   END;
     2447     8014        %EJECT;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:415  
     2448     8015        /* Some of the above subroutines need external entry points. */
     2449     8016
     2450     8017    1   KVI$ABRRED: ENTRY;

   8017   1 001F01  D380 0000 0000  xent KVI$ABRRED      LNJ,B5   X6A_AUTO_1
          1 001F04       003E 0001                       DC       62,1

     2451     8018
     2452     8019    1      SSN$ = KV$PTR.SSN$;

   8019   1 001F06  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001F09  DCC6 0002                            LDB,B5   2,B6
          1 001F0B  DFC7 000A                            STB,B5   SSN$,AUTO

     2453     8020    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8020   1 001F0D  CCC5 0030                            LDB,B4   48,B5
          1 001F0F  CFC7 0008                            STB,B4   REDBFR$,AUTO

     2454     8021    1      CALL Y$ABRRED;

   8021   1 001F11  E3C0 EFF3                            LNJ,B6   s:0,PREL
          1 001F13       0001                            DC       s:8022,PREL

     2455     8022    1      RETURN;

   8022   1 001F14  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2456     8023
     2457     8024    1   KVI$AUTWRP: ENTRY;

   8024   1 001F17  D380 0000 0000  xent KVI$AUTWRP      LNJ,B5   X6A_AUTO_1
          1 001F1A       003E 0001                       DC       62,1

     2458     8025
     2459     8026    1      R5 = %KV_STR.WRDWRPSIZ+%KV_STR.AUTTABCLM;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:416  
   8026   1 001F1C  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001F1F  DCC6 0004                            LDB,B5   4,B6
          1 001F21  E845 001D                            LDR,R6   29,B5
          1 001F23  E570 00FF                            AND,R6   255,IMO
          1 001F25  D2C5 001E                            LLH,R5   30,B5
          1 001F27  EA55                                 ADD,R6   R5
          1 001F28  EF47 0010                            STR,R6   R5,AUTO

     2460     8027    1      SSN$ = KV$PTR.SSN$;

   8027   1 001F2A  DCC6 0002                            LDB,B5   2,B6
          1 001F2C  DFC7 000A                            STB,B5   SSN$,AUTO

     2461     8028    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8028   1 001F2E  CCC5 0030                            LDB,B4   48,B5
          1 001F30  CFC7 0008                            STB,B4   REDBFR$,AUTO

     2462     8029    2      IF REDBFR$=ADDR(NIL) OR R5>%KV_SSN.REDBFR__.BFRBYTSIZ THEN DO;

   8029   1 001F32  8DC7 0008                            CMN      REDBFR$,AUTO
          1 001F34  0901 0007                            BE       s:8030,PREL
          1 001F36  6801 001C                            BLZ,R6   s:8035,PREL
          1 001F38  E945 0034                            CMR,R6   52,B5
          1 001F3A  0381 0018                            BLE      s:8035,PREL

     2463     8030    3         CALL KVS$GETREDBFR(R5) WHENALTRETURN DO;

   8030   1 001F3C  BBC7 0010                            LAB,B3   R5,AUTO
          1 001F3E  BFC7 003A                            STB,B3   R+2,AUTO
          1 001F40  BBC7 003A                            LAB,B3   R+2,AUTO
          1 001F42  CBF0 0100                            LAB,B4   256,IMO
          1 001F44  E380 0000 0000  xent                 LNJ,B6   KVS$GETREDBFR
          1 001F47       0003                            DC       s:8031,PREL
          1 001F48  0F81 0004                            B        s:8033,PREL

     2464     8031    3            RETURN;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:417  

   8031   1 001F4A  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2465     8032    3         END;
     2466     8033    2         REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8033   1 001F4D  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 001F4F  DCC6 0030                            LDB,B5   48,B6
          1 001F51  DFC7 0008                            STB,B5   REDBFR$,AUTO

     2467     8034    2      END;

     2468     8035    1      IF %KV_STR.AUTTABCLM>1

   8035   1 001F53  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001F56  DCC6 0004                            LDB,B5   4,B6
          1 001F58  E2C5 001E                            LLH,R6   30,B5
          1 001F5A  6D01                                 CMV,R6   1
          1 001F5B  0381 0010                            BLE      s:8037,PREL

     2469     8036    1      THEN SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR__.BYTX,%KV_STR.AUTTABCLM-1) = ' ';

   8036   1 001F5D  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 001F5F  D844 0032                            LDR,R5   50,B4
          1 001F61  BCC7 0008                            LDB,B3   REDBFR$,AUTO
          1 001F63  B855                                 LDR,R3   R5
          1 001F64  D856                                 LDR,R5   R6
          1 001F65  DA70 1FFF                            ADD,R5   8191,IMO
          1 001F67  0021                                 ALR      ;
          1 001F68       4178 2000                                ALPHANUM('2000'X,IMO,,1),;
          1 001F6A       4033 0000                                ALPHANUM(0,B3,R3,,R5,FILL)

     2470     8037    1      R2 = %KV_STR.AUTTABCLM;

   8037   1 001F6C  437F                                 CSYNC    s:8036+14,SPREL
          1 001F6D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001F70  DCC6 0004                            LDB,B5   4,B6
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:418  
          1 001F72  E2C5 001E                            LLH,R6   30,B5
          1 001F74  EF47 000E                            STR,R6   R2,AUTO

     2471     8038    1      IF R2~=0 THEN R2 = R2-1;

   8038   1 001F76  6901 0003                            BEZ,R6   s:8039,PREL

   8038   1 001F78  88C7 000E                            DEC      R2,AUTO

     2472     8039    1      R5 = %KV_STR.WRDWRPSIZ;

   8039   1 001F7A  DCC6 0004                            LDB,B5   4,B6
          1 001F7C  E845 001D                            LDR,R6   29,B5
          1 001F7E  E570 00FF                            AND,R6   255,IMO
          1 001F80  EF47 0010                            STR,R6   R5,AUTO

     2473     8040    1      IF R5~=0 THEN SUBSTR(KV$REDBFR_CHR,%KV_SSN.REDBFR__.BYTX+R2,R5) =

   8040   1 001F82  6901 0016                            BEZ,R6   s:8043,PREL

   8040   1 001F84  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001F86  D845 0032                            LDR,R5   50,B5
          1 001F88  DA47 000E                            ADD,R5   R2,AUTO
          1 001F8A  CCC6 0004                            LDB,B4   4,B6
          1 001F8C  BCC4 000C                            LDB,B3   12,B4
          1 001F8E  C844 000F                            LDR,R4   15,B4
          1 001F90  CA44 000E                            ADD,R4   14,B4
          1 001F92  C256                                 SUB,R4   R6
          1 001F93  AB83                                 LAB,B2   ,B3
          1 001F94  A854                                 LDR,R2   R4
          1 001F95  BCC7 0008                            LDB,B3   REDBFR$,AUTO
          1 001F97  B855                                 LDR,R3   R5
          1 001F98  0008                                 MMM

     2474     8041    1        SUBSTR(%KV_STR.EDTBFR__.ADR$->KV$REDBFR_CHR,
     2475     8042    1        %KV_STR.EDTBFR__.DATBYTSIZ+%KV_STR.EDTBFR__.BYTX-R5,R5);
     2476     8043    1      %KV_STR.WRDWRPSIZ = 0;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:419  

   8043   1 001F99  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001F9C  DCC6 0004                            LDB,B5   4,B6
          1 001F9E  8845 001D                            LBF,'00FF'X       29,B5
          1 001FA0       00FF

     2477     8044    1      %KV_SSN.REDBFR__.DATBYTSIZ = R2+R5;

   8044   1 001FA1  E847 000E                            LDR,R6   R2,AUTO
          1 001FA3  EA47 0010                            ADD,R6   R5,AUTO
          1 001FA5  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 001FA7  EF45 0033                            STR,R6   51,B5

     2478     8045    1      %KV_SSN.REDBFR.NXTX = %KV_SSN.REDBFR__.DATBYTSIZ+%KV_SSN.REDBFR__.BYTX;

   8045   1 001FA9  EA45 0032                            ADD,R6   50,B5
          1 001FAB  EF45 002A                            STR,R6   42,B5

     2479     8046    1      %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR.NXTX;

   8046   1 001FAD  EF45 002B                            STR,R6   43,B5

     2480     8047    1      %KV_SSN.REDBFR.EDTHI_X = %KV_SSN.REDBFR.NXTX;

   8047   1 001FAF  EF45 002C                            STR,R6   44,B5

     2481     8048    1      %KV_SSN.REDBFR.INSMODX = %KV_SSN.REDBFR.NXTX;

   8048   1 001FB1  EF45 002E                            STR,R6   46,B5

     2482     8049    1      %KV_SSN.CLMIS_BYTX = '0'B;

   8049   1 001FB3  8845 0037                            LBF,'0080'X       55,B5
   8049   1 001FB5       0080

     2483     8050    1      CALL Y$EDTX_TO_VRTCLM(R2);

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:420  
   8050   1 001FB6  CBC7 000E                            LAB,B4   R2,AUTO
          1 001FB8  CFC7 0036                            STB,B4   OLDCLM+3,AUTO
          1 001FBA  E3C0 F130                            LNJ,B6   s:0,PREL
          1 001FBC       0001                            DC       s:8051,PREL

     2484     8051    1      CALL Y$SHFTYPREDBFR;

   8051   1 001FBD  EB80 0000 0000                       LAB,B6   0
          1 001FC0  EFC7 0030                            STB,B6   DLT+1,AUTO
          1 001FC2  E3C0 FB01                            LNJ,B6   s:0,PREL
          1 001FC4       0001                            DC       s:8052,PREL

     2485     8052    1      RETURN;

   8052   1 001FC5  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2486     8053
     2487     8054    1   KVI$EDTX_TO_VRTCLM: ENTRY (VDH_PARM);

   8054   1 001FC8  D380 0000 0000  xent KVI$EDTX_TO_VRT*LNJ,B5   X6A_AUTO_1
          1 001FCB       003E 0001                       DC       62,1

     2488     8055
     2489     8056    1      SSN$ = KV$PTR.SSN$;

   8056   1 001FCD  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001FD0  DCC6 0002                            LDB,B5   2,B6
          1 001FD2  DFC7 000A                            STB,B5   SSN$,AUTO

     2490     8057    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8057   1 001FD4  CCC5 0030                            LDB,B4   48,B5
          1 001FD6  CFC7 0008                            STB,B4   REDBFR$,AUTO

     2491     8058    1      CALL Y$EDTX_TO_VRTCLM (VDH_VRTCLM);

   8058   1 001FD8  BCC7 0004                            LDB,B3   @VDH_PARM,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:421  
          1 001FDA  BFC7 0036                            STB,B3   OLDCLM+3,AUTO
          1 001FDC  E3C0 F10E                            LNJ,B6   s:0,PREL
          1 001FDE       0001                            DC       s:8059,PREL

     2492     8059    1      RETURN;

   8059   1 001FDF  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2493     8060
     2494     8061    1   KVI$PRGRED: ENTRY;

   8061   1 001FE2  D380 0000 0000  xent KVI$PRGRED      LNJ,B5   X6A_AUTO_1
          1 001FE5       003E 0001                       DC       62,1

     2495     8062
     2496     8063    1      SSN$ = KV$PTR.SSN$;

   8063   1 001FE7  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 001FEA  DCC6 0002                            LDB,B5   2,B6
          1 001FEC  DFC7 000A                            STB,B5   SSN$,AUTO

     2497     8064    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8064   1 001FEE  CCC5 0030                            LDB,B4   48,B5
          1 001FF0  CFC7 0008                            STB,B4   REDBFR$,AUTO

     2498     8065    1      CALL Y$PRGRED;

   8065   1 001FF2  E3C0 F375                            LNJ,B6   s:0,PREL
          1 001FF4       0001                            DC       s:8066,PREL

     2499     8066    1      RETURN;

   8066   1 001FF5  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2500     8067
     2501     8068    1   KVI$PRGTYPAHDINPFNC: ENTRY;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:422  

   8068   1 001FF8  D380 0000 0000  xent KVI$PRGTYPAHDIN*LNJ,B5   X6A_AUTO_1
          1 001FFB       003E 0001                       DC       62,1

     2502     8069
     2503     8070    1      SSN$ = KV$PTR.SSN$;

   8070   1 001FFD  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 002000  DCC6 0002                            LDB,B5   2,B6
          1 002002  DFC7 000A                            STB,B5   SSN$,AUTO

     2504     8071    1      CALL Y$PRGTYPAHDINPFNC;

   8071   1 002004  E3C0 F44B                            LNJ,B6   s:0,PREL
          1 002006       0001                            DC       s:8072,PREL

     2505     8072    1      RETURN;

   8072   1 002007  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2506     8073
     2507     8074    1   KVI$RE_DSPINP: ENTRY;

   8074   1 00200A  D380 0000 0000  xent KVI$RE_DSPINP   LNJ,B5   X6A_AUTO_1
          1 00200D       003E 0001                       DC       62,1

     2508     8075
     2509     8076    1      SSN$ = KV$PTR.SSN$;

   8076   1 00200F  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 002012  DCC6 0002                            LDB,B5   2,B6
          1 002014  DFC7 000A                            STB,B5   SSN$,AUTO

     2510     8077    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8077   1 002016  CCC5 0030                            LDB,B4   48,B5
          1 002018  CFC7 0008                            STB,B4   REDBFR$,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:423  

     2511     8078    1      CALL Y$RE_DSPINP;

   8078   1 00201A  E3C0 F68C                            LNJ,B6   s:0,PREL
          1 00201C       0001                            DC       s:8079,PREL

     2512     8079    1      RETURN;

   8079   1 00201D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2513     8080
     2514     8081    1   KVI$SCPVRTCLMLOWX: ENTRY;

   8081   1 002020  D380 0000 0000  xent KVI$SCPVRTCLMLO*LNJ,B5   X6A_AUTO_1
          1 002023       003E 0001                       DC       62,1

     2515     8082
     2516     8083    1      SSN$ = KV$PTR.SSN$;

   8083   1 002025  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 002028  DCC6 0002                            LDB,B5   2,B6
          1 00202A  DFC7 000A                            STB,B5   SSN$,AUTO

     2517     8084    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8084   1 00202C  CCC5 0030                            LDB,B4   48,B5
          1 00202E  CFC7 0008                            STB,B4   REDBFR$,AUTO

     2518     8085    1      CALL Y$SCPVRTCLMLOWX;

   8085   1 002030  E3C0 F76C                            LNJ,B6   s:0,PREL
          1 002032       0001                            DC       s:8086,PREL

     2519     8086    1      RETURN;

   8086   1 002033  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:424  
     2520     8087
     2521     8088    1   KVI$SHFDSPPST: ENTRY (VDH_PARM);

   8088   1 002036  D380 0000 0000  xent KVI$SHFDSPPST   LNJ,B5   X6A_AUTO_1
          1 002039       003E 0001                       DC       62,1

     2522     8089
     2523     8090    1      SSN$ = KV$PTR.SSN$;

   8090   1 00203B  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00203E  DCC6 0002                            LDB,B5   2,B6
          1 002040  DFC7 000A                            STB,B5   SSN$,AUTO

     2524     8091    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8091   1 002042  CCC5 0030                            LDB,B4   48,B5
          1 002044  CFC7 0008                            STB,B4   REDBFR$,AUTO

     2525     8092    1      CALL Y$SHFDSPPST (VDH_SHFCNT);

   8092   1 002046  BCC7 0004                            LDB,B3   @VDH_PARM,AUTO
          1 002048  BFC7 0030                            STB,B3   DLT+1,AUTO
          1 00204A  E3C0 F7AC                            LNJ,B6   s:0,PREL
          1 00204C       0001                            DC       s:8093,PREL

     2526     8093    1      RETURN;

   8093   1 00204D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2527     8094
     2528     8095    1   KVI$SHFTO_DFL: ENTRY;

   8095   1 002050  D380 0000 0000  xent KVI$SHFTO_DFL   LNJ,B5   X6A_AUTO_1
          1 002053       003E 0001                       DC       62,1

     2529     8096
     2530     8097    1      SSN$ = KV$PTR.SSN$;
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:425  

   8097   1 002055  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 002058  DCC6 0002                            LDB,B5   2,B6
          1 00205A  DFC7 000A                            STB,B5   SSN$,AUTO

     2531     8098    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8098   1 00205C  CCC5 0030                            LDB,B4   48,B5
          1 00205E  CFC7 0008                            STB,B4   REDBFR$,AUTO

     2532     8099    1      R2 = %KV_SSN.REDBFR.EDTLOWX;

   8099   1 002060  E845 002B                            LDR,R6   43,B5
          1 002062  EF47 000E                            STR,R6   R2,AUTO

     2533     8100    1      IF %KV_MVD.ORG=%KV#VD_ORG_SE

   8100   1 002064  BCC6 0006                            LDB,B3   6,B6
          1 002066  D2C3 0015                            LLH,R5   21,B3
          1 002068  5D05                                 CMV,R5   5
          1 002069  0981 002A                            BNE      s:8109,PREL

     2534     8101    1      THEN IF %KV_RCRLST.HRZSCROFS<%KV_SSN.REDBFR.NXTX

   8101   1 00206B  ACC6 000E                            LDB,B2   14,B6
          1 00206D  C842 0003                            LDR,R4   3,B2
          1 00206F  C945 002A                            CMR,R4   42,B5
          1 002071  0881 0009                            BAGE     s:8104,PREL

     2535     8102    1      THEN %KV_SSN.REDBFR.EDTLOWX = %KV_RCRLST.HRZSCROFS+%KV_MVD.HRZSCRMRG;

   8102   1 002073  B2C3 0017                            LLH,R3   23,B3
          1 002075  BA54                                 ADD,R3   R4
          1 002076  E853                                 LDR,R6   R3
          1 002077  EF45 002B                            STR,R6   43,B5
          1 002079  0F81 001E                            B        s:8110,PREL

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:426  
     2536     8103    2      ELSE DO;

     2537     8104    2         %KV_MVD.VRTCLM = %KV_SRD.PRMVRTCLM+1;

   8104   1 00207B  9CC6 000A                            LDB,B1   10,B6
          1 00207D  B841 0012                            LDR,R3   18,B1
          1 00207F  3E01                                 ADV,R3   1
          1 002080  BF43 001B                            STR,R3   27,B3

     2538     8105    2         CALL KVO$PST (KV_VDH_PST_0_VRT);

   8105   1 002082  BB80 0000 0011  02                   LAB,B3   +17
          1 002085  CBF0 0100                            LAB,B4   256,IMO
          1 002087  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 00208A       0001                            DC       s:8106,PREL

     2539     8106    2         CALL KVO$ERSTO_ENDOF_INP;

   8106   1 00208B  CBF0 0000                            LAB,B4   0,IMO
          1 00208D  E380 0000 0000  xent                 LNJ,B6   KVO$ERSTO_ENDOF_INP
          1 002090       0001                            DC       s:8107,PREL

     2540     8107    2         RETURN;

   8107   1 002091  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2541     8108    2      END;
     2542     8109    1      ELSE %KV_SSN.REDBFR.EDTLOWX = %KV_SSN.REDBFR__.BYTX;

   8109   1 002094  E845 0032                            LDR,R6   50,B5
          1 002096  EF45 002B                            STR,R6   43,B5

     2543     8110    1      CALL Y$EDTX_TO_VRTCLM (%KV_MVD.VRTCLM);

   8110   1 002098  BCC6 0006                            LDB,B3   6,B6
          1 00209A  ABC3 001B                            LAB,B2   27,B3
          1 00209C  AFC7 0036                            STB,B2   OLDCLM+3,AUTO
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:427  
          1 00209E  E3C0 F04C                            LNJ,B6   s:0,PREL
          1 0020A0       0001                            DC       s:8111,PREL

     2544     8111    1      CALL Y$SHFTO_DFL;

   8111   1 0020A1  EB80 0000 0000                       LAB,B6   0
          1 0020A4  EFC7 0030                            STB,B6   DLT+1,AUTO
          1 0020A6  E3C0 F947                            LNJ,B6   s:0,PREL
          1 0020A8       0001                            DC       s:8112,PREL

     2545     8112    1      %KV_VDI.RE_DSPINP = '0'B;

   8112   1 0020A9  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0020AC  DC86                                 LDB,B5   ,B6
          1 0020AD  8845 0019                            LBF,'0010'X       25,B5
          1 0020AF       0010

     2546     8113    1      %KV_SSN.REDBFR.EDTLOWX = R2;

   8113   1 0020B0  DCC7 000A                            LDB,B5   SSN$,AUTO
          1 0020B2  E847 000E                            LDR,R6   R2,AUTO
          1 0020B4  EF45 002B                            STR,R6   43,B5

     2547     8114    1      RETURN;

   8114   1 0020B6  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2548     8115
     2549     8116    1   KVI$TRMRED_VDH_DAT: ENTRY (VDH_PARM);

   8116   1 0020B9  D380 0000 0000  xent KVI$TRMRED_VDH_*LNJ,B5   X6A_AUTO_1
          1 0020BC       003E 0001                       DC       62,1

     2550     8117
     2551     8118    1      SSN$ = KV$PTR.SSN$;

   8118   1 0020BE  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:428  
          1 0020C1  DCC6 0002                            LDB,B5   2,B6
          1 0020C3  DFC7 000A                            STB,B5   SSN$,AUTO

     2552     8119    1      REDBFR$ = %KV_SSN.REDBFR__.ADR$;

   8119   1 0020C5  CCC5 0030                            LDB,B4   48,B5
          1 0020C7  CFC7 0008                            STB,B4   REDBFR$,AUTO

     2553     8120    1      IF REDBFR$=%KV_STR.EDTBFR__.ADR$

   8120   1 0020C9  BCC6 0004                            LDB,B3   4,B6
          1 0020CB  CDC3 000C                            CMB,B4   12,B3
          1 0020CD  0981 00AB                            BNE      s:8152,PREL
          1 0020CF  E2C3 001D                            LLH,R6   29,B3
          1 0020D1  6D0B                                 CMV,R6   11
          1 0020D2  0381 00A6                            BLE      s:8152,PREL
          1 0020D4  82C3 001E                            LB,'0040'X        30,B3
          1 0020D6       0040
          1 0020D7  0581 00A1                            BBF      s:8152,PREL
          1 0020D9  E943 000F                            CMR,R6   15,B3
          1 0020DB  0281 009D                            BGE      s:8152,PREL
          1 0020DD  ACC7 0004                            LDB,B2   @VDH_PARM,AUTO
          1 0020DF  8DD2                                 CMN      B2
          1 0020E0  0901 0098                            BE       s:8152,PREL

     2554     8121    1        AND %KV_STR.WRDWRPCLM>11 AND %KV_STR.WRDWRP
     2555     8122    1        AND %KV_STR.EDTBFR__.DATBYTSIZ>%KV_STR.WRDWRPCLM
     2556     8123    2        AND ADDR(VDH_DAT)~=ADDR(NIL) THEN DO;

     2557     8124
     2558     8125        /* We have the wordwrap condition. Do it. */
     2559     8126
     2560     8127    2         R5 = %KV_STR.WRDWRPCLM+%KV_STR.EDTBFR__.BYTX;

   8127   1 0020E2  EA43 000E                            ADD,R6   14,B3
          1 0020E4  EF47 0010                            STR,R6   R5,AUTO

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:429  
     2561     8128    3         DO UNTIL R5<0;

     2562     8129    3            IF KV$REDBFR_BYT(R5)=ASCBIN(' ') THEN EXIT;

   8129   1 0020E6  ECC7 0008                            LDB,B6   REDBFR$,AUTO
          1 0020E8  B847 0010                            LDR,R3   R5,AUTO
          1 0020EA  E0B6                                 LDH,R6   ,B6,R3
          1 0020EB  6D20                                 CMV,R6   32
          1 0020EC  0901 0006                            BE       s:8132,PREL

     2563     8130    3            R5 = R5-1;

   8130   1 0020EE  88C7 0010                            DEC      R5,AUTO

     2564     8131    3         END;

   8131   1 0020F0  E847 0010                            LDR,R6   R5,AUTO
          1 0020F2  68F4                                 BGEZ,R6  s:8129,SPREL

     2565     8132    2         R5 = R5-%KV_STR.EDTBFR__.BYTX;

   8132   1 0020F3  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0020F6  CCC5 0004                            LDB,B4   4,B5
          1 0020F8  E847 0010                            LDR,R6   R5,AUTO
          1 0020FA  E244 000E                            SUB,R6   14,B4
          1 0020FC  EF47 0010                            STR,R6   R5,AUTO

     2566     8133    2         IF R5<%KV_STR.WRDWRPCLM/2 OR R5<%KV_STR.AUTTABCLM

   8133   1 0020FE  CCC5 0004                            LDB,B4   4,B5
          1 002100  D2C4 001D                            LLH,R5   29,B4
          1 002102  5041                                 SOR,R5   1
          1 002103  5801 0009                            BLZ,R5   s:8134,PREL
          1 002105  D956                                 CMR,R5   R6
          1 002106  0A01 0006                            BAG      s:8134,PREL
          1 002108  D2C4 001E                            LLH,R5   30,B4
          1 00210A  D956                                 CMR,R5   R6
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:430  
          1 00210B  0A81 0005                            BALE     s:8135,PREL

     2567     8134    2         THEN R5 = %KV_STR.WRDWRPCLM;

   8134   1 00210D  E2C4 001D                            LLH,R6   29,B4
          1 00210F  EF47 0010                            STR,R6   R5,AUTO

     2568     8135    2         %KV_STR.RE_REDCLM = R5+1;

   8135   1 002111  CCC5 0004                            LDB,B4   4,B5
          1 002113  6E01                                 ADV,R6   1
          1 002114  EF44 0012                            STR,R6   18,B4

     2569     8136    2         R2 = R5+%KV_STR.EDTBFR__.BYTX;

   8136   1 002116  CCC5 0004                            LDB,B4   4,B5
          1 002118  D847 0010                            LDR,R5   R5,AUTO
          1 00211A  DA44 000E                            ADD,R5   14,B4
          1 00211C  DF47 000E                            STR,R5   R2,AUTO

     2570     8137    2         %KV_SSN.REDBFR.EDTLOWX = R2;

   8137   1 00211E  CCC7 000A                            LDB,B4   SSN$,AUTO
          1 002120  DF44 002B                            STR,R5   43,B4

     2571     8138    2         IF %KV_MVD.RETYPOVR

   8138   1 002122  BCC5 0006                            LDB,B3   6,B5
          1 002124  82C3 0016                            LB,'0080'X        22,B3
          1 002126       0080
          1 002127  0581 0018                            BBF      s:8144,PREL
          1 002129  AC85                                 LDB,B2   ,B5
          1 00212A  5801 000A                            BLZ,R5   s:8140,PREL
          1 00212C  D942 0016                            CMR,R5   22,B2
          1 00212E  0201 0006                            BL       s:8140,PREL
          1 002130  82C2 0019                            LB,'0010'X        25,B2
          1 002132       0010
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:431  
          1 002133  0501 000C                            BBT      s:8144,PREL

     2572     8139    3           AND (%KV_VDI.RE_DSPLOWX>R2 OR NOT %KV_VDI.RE_DSPINP) THEN DO;

     2573     8140    3            %KV_VDI.RE_DSPLOWX = R2;

   8140   1 002135  DF42 0016                            STR,R5   22,B2

     2574     8141    3            %KV_VDI.RE_DSPINP = '1'B;

   8141   1 002137  BC85                                 LDB,B3   ,B5
          1 002138  8943 0019                            LBT,'0010'X       25,B3
          1 00213A       0010

     2575     8142    3            %KV_SRD.VRTPSTOK = '0'B;

   8142   1 00213B  BCC5 000A                            LDB,B3   10,B5
          1 00213D  8843 000E                            LBF,'0010'X       14,B3
          1 00213F       0010

     2576     8143    3         END;

     2577     8144    2         IF %KV_SSN.BP AND R5<%KV_STR.WRDWRPCLM THEN R5 = R5+1;

   8144   1 002140  82C4 0037                            LB,'0010'X        55,B4
   8144   1 002142       0010
          1 002143  0581 000B                            BBF      s:8145,PREL
          1 002145  BCC5 0004                            LDB,B3   4,B5
          1 002147  E2C3 001D                            LLH,R6   29,B3
          1 002149  E947 0010                            CMR,R6   R5,AUTO
          1 00214B  0A81 0003                            BALE     s:8145,PREL

   8144   1 00214D  8AC7 0010                            INC      R5,AUTO

     2578     8145    3         DO WHILE R2<%KV_SSN.REDBFR.NXTX AND KV$REDBFR_BYT(R2)=ASCBIN(' ');

   8145   1 00214F  0F81 0003                            B        s:8147,PREL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:432  

     2579     8146    3            R2 = R2+1;

   8146   1 002151  8AC7 000E                            INC      R2,AUTO

     2580     8147    3         END;

   8147   1 002153  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 002155  E847 000E                            LDR,R6   R2,AUTO
          1 002157  E946 002A                            CMR,R6   42,B6
          1 002159  0881 0007                            BAGE     s:8148,PREL
          1 00215B  DCC7 0008                            LDB,B5   REDBFR$,AUTO
          1 00215D  B856                                 LDR,R3   R6
          1 00215E  D0B5                                 LDH,R5   ,B5,R3
          1 00215F  5D20                                 CMV,R5   32
          1 002160  0971                                 BE       s:8146,SPREL

     2581     8148    2         %KV_SSN.REDBFR__.DATBYTSIZ = %KV_SSN.REDBFR.EDTLOWX;

   8148   1 002161  D846 002B                            LDR,R5   43,B6
          1 002163  DF46 0033                            STR,R5   51,B6

     2582     8149    2         VDH_DAT.DAT__.DATBYTSIZ = R5;

   8149   1 002165  DCC7 0004                            LDB,B5   @VDH_PARM,AUTO
          1 002167  C847 0010                            LDR,R4   R5,AUTO
          1 002169  CF45 0004                            STR,R4   4,B5

     2583     8150    2         %KV_STR.WRDWRPSIZ = %KV_STR.EDTBFR__.DATBYTSIZ+%KV_STR.EDTBFR__.BYTX-R2;

   8150   1 00216B  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 00216E  BCC4 0004                            LDB,B3   4,B4
          1 002170  E843 000F                            LDR,R6   15,B3
          1 002172  EA43 000E                            ADD,R6   14,B3
          1 002174  E247 000E                            SUB,R6   R2,AUTO
          1 002176  EAC3 001D                            SRM,R6,'00FF'X    29,B3
          1 002178       00FF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:433  

     2584     8151    2      END;

     2585     8152    1      CALL Y$TRMRED (VDH_DAT);

   8152   1 002179  ECC7 0004                            LDB,B6   @VDH_PARM,AUTO
          1 00217B  EFC7 002A                            STB,B6   @KV$INPOPR_DUMMY+2,AUTO
          1 00217D  E3C0 FAA2                            LNJ,B6   s:0,PREL
          1 00217F       0001                            DC       s:8153,PREL

     2586     8153    1      IF %KV_STR.WRDWRPSIZ~=0 THEN CALL KVO$PST (KV_VDH_PST_NEWLIN_VRT);

   8153   1 002180  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 002183  DCC6 0004                            LDB,B5   4,B6
          1 002185  82C5 001D                            LB,'00FF'X        29,B5
          1 002187       00FF
          1 002188  0581 000A                            BBF      s:8154,PREL

   8153   1 00218A  BB80 0000 0000  02                   LAB,B3   0
          1 00218D  CBF0 0100                            LAB,B4   256,IMO
          1 00218F  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 002192       0001                            DC       s:8154,PREL

     2587     8154    2      IF %KV_SSN.REDBFR__.BFRRLSDSP = %KV_BFRRLSDSP_MSG THEN DO;

   8154   1 002193  ECC7 000A                            LDB,B6   SSN$,AUTO
          1 002195  E846 0035                            LDR,R6   53,B6
          1 002197  E570 00FF                            AND,R6   255,IMO
          1 002199  6D01                                 CMV,R6   1
          1 00219A  0981 000A                            BNE      s:8163,PREL

     2588     8155
     2589     8156        /* We just released the read buffer, so clear the read buffer descriptor. */
     2590     8157
     2591     8158    2         %KV_SSN.REDBFR__ = '0'B;

   8158   1 00219C  5C0C                                 LDV,R5   12
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:434  
          1 00219D  0021                                 ALR      ;
          1 00219E       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0021A0       4006 0030                                ALPHANUM(48,B6,,R5,FILL)

     2592     8159    2      END; ELSE DO;                        /* ELSE IF BFRRLSDSP = MSG            */

   8159   1 0021A2  437F                                 CSYNC    s:8158+5,SPREL
          1 0021A3  0F81 0003                            B        s:8165,PREL

     2593     8160
     2594     8161        /* We didn't release the read buffer, so just reset the data size. */
     2595     8162
     2596     8163    2         %KV_SSN.REDBFR__.DATBYTSIZ = 0;

   8163   1 0021A5  8746 0033                            CL       51,B6

     2597     8164    2      END; /* END ELSE IF BFRRLSDSP = MSG */

     2598     8165    1      %KV_SSN.REDBFR = '0'B;

   8165   1 0021A7  5C0C                                 LDV,R5   12
          1 0021A8  0021                                 ALR      ;
          1 0021A9       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0021AB       4006 002A                                ALPHANUM(42,B6,,R5,FILL)

     2599     8166    1      RETURN;

   8166   1 0021AD  437F                                 CSYNC    s:8165+5,SPREL
          1 0021AE  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     2600     8167    1   END;
     2601     8168        %EOD;

PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:435  
--  Include file information  --

   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   K_CP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_SCODE_C.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV_INT.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KH_SCREECH_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVI$INT.
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:436  

 **** Variables and constants ****

  ****  Section 000 RoData KVI$INT

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    F0-0-0/w STRC(48)    r     1 KVI_INPFNC                F3-0-0/w STRC(128)   r     1 KV_CLK_CANCEL
     0-0-0/c UBIN(8)     r     1 KV_INPFNC_PRMIDS(0:63)
    20-0-0/c CHAR(114)   r     1 KV_PRMACK_TXT
    20-0-0/w UBIN(16)    r     1 KV_PRMACK_TXTU(0:56)
    DE-0-0/w STRC(80)    r     1 VDH_OTPLCL_BNG_HI_BNG
    DC-0-0/c CHAR(4)     r     1 VDH_OTPLCL_BNG_HI_BNG_TEXT
    EB-0-0/w STRC(80)    r     1 VDH_OTPLCL_TYPE           E8-0-0/c CHAR(5)     r     1 VDH_OTPLCL_TYPE_TEXT
    E3-0-0/w STRC(80)    r     1 VDH_OTPLCL_WRT            5C-0-0/c STRC(2048)  r     1 Y_CHNCAS
    59-0-0/w SBIN(16)    r     1 Y_MAXPRMX(0:2)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    28-0-0/w PTR         r     1 @KV$INPOPR_DUMMY          30-0-0/w PTR         r     1 @SHFCNT
    2A-0-0/w PTR         r     1 @VDH_DAT                   4-0-0/w PTR         r     1 @VDH_PARM
    36-0-0/w PTR         r     1 @VRTCLM                    C-0-0/w PTR         r     1 B3
    2A-0-0/w STRC(32)    r     1 CRT                       2F-0-0/w SBIN(16)    r     1 DLT
    2D-0-0/w SBIN(16)    r     1 DLT                       12-0-0/w SBIN(16)    r     1 DSPLOWCLM
    11-0-0/w SBIN(16)    r     1 EDTX                      16-0-0/w UBIN(16)    r     1 FPT(0:15)
    28-0-0/w STRC(32)    r     1 HI_NONBLN                  6-0-0/w PTR         r     1 INPOPR$
    *0-0-0/w STRC(16)    r     1 KV$INPOPR                 *0-0-0/w ACHR        r     1 KV$INPOPR_DUMMY
    *0-0-0/w ASTR(24)    r     1 KV$INPOPR_TXT             33-0-0/w SBIN(16)    r     1 OLDCLM
    13-0-0/w SBIN(16)    r     1 OPRCNT                    13-0-0/w UBIN(16)    r     1 OPRCNTU
    38-0-0/w SBIN(16)    r     1 R                         2E-0-0/w SBIN(16)    r     1 R
    2C-0-0/w SBIN(16)    r     1 R                          E-0-0/w SBIN(16)    r     1 R2
     F-0-0/w SBIN(16)    r     1 R3                        10-0-0/w SBIN(16)    r     1 R5
     8-0-0/w PTR         r     1 REDBFR$                   15-0-0/b BIT         r     1 SAVEBIT
    32-0-0/w SBIN(16)    r     1 SHF                       *0-0-0/w SBIN(16)    r     1 SHFCNT
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:437  
     A-0-0/w PTR         r     1 SSN$                      14-0-0/w UBIN(16)    r     1 STR
    28-0-0/c STRC(32)    r     1 TMP                       28-0-0/w UBIN(32)    r     1 TMPU
    *0-0-0/w STRC(128)   r     1 VDH_DAT                   *0-0-0/w STRC(128)   r     1 VDH_DAT
    *0-0-0/w STRC(96)    r     1 VDH_INTINPOPR             *0-0-0/w ACHR        r     1 VDH_PARM
    *0-0-0/w SBIN(16)    r     1 VDH_SHFCNT                *0-0-0/w UBIN(16)    r     1 VDH_VRTCLM
    *0-0-0/w SBIN(16)    r     1 VRTCLM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$LOW_MEM$                 0-0-0/w PTR         r     1 KV$PTR$
     0-0-0/b BIT         r     1 KV_GRPCHR(0:255)
     0-0-0/b BIT (16)    r     1 KV_GRPCHR_WRD(0:15)
     0-0-0/w UBIN(16)    r     1 KV_SND_EVT_BRK             0-0-0/w UBIN(16)    r     1 KV_SND_EVT_MNTATN
     0-0-0/w UBIN(16)    r     1 KV_SND_RQSDAT_GNR
     0-0-0/w UBIN(16)    r     1 KV_SND_RQSMRK_DLTRCVDAT
     0-0-0/w UBIN(16)    r     1 KV_SND_RQSMRK_DLTRCVRQS
     0-0-0/w UBIN(16)    r     1 KV_SND_RQSSTT              0-0-0/w STRC(48)    r     1 KV_USR_INPPRC
     0-0-0/w STRC(64)    r     1 KV_USR_PST                 0-0-0/w STRC(64)    r     1 KV_USR_SETATR
     0-0-0/w STRC(128)   r     1 KV_VDH_DAT_NRM_NO_ACTCHR
     0-0-0/w STRC(32)    r     1 KV_VDH_DSC                 0-0-0/w STRC(176)   r     1 KV_VDH_GETBFR
     0-0-0/w STRC(160)   r     1 KV_VDH_GETPRM              0-0-0/w STRC(80)    r     1 KV_VDH_OTPLCL
     0-0-0/w UBIN(16)    r     1 KV_VDH_PST_0_VRT           0-0-0/w UBIN(16)    r     1 KV_VDH_PST_BS_FRM
     0-0-0/w UBIN(16)    r     1 KV_VDH_PST_CR_VRT          0-0-0/w UBIN(16)    r     1 KV_VDH_PST_LF
     0-0-0/w UBIN(16)    r     1 KV_VDH_PST_NEWLIN_VRT
     0-0-0/w STRC(64)    r     1 KV_VDH_PST_SPCFRM          0-0-0/w UBIN(16)    r     1 KV_VDH_PST_VRT
     0-0-0/w UBIN(16)    r     1 KV_VDH_PST_WHTSPC          0-0-0/w STRC(112)   r     1 KV_VDH_RLSBFR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(4096)  r     1 G$LOW_MEM                  0-0-0/w STRC(176)   r     1 KH$CLK
     0-0-0/w STRC(32)    r     1 KV$EDTWND                  0-0-0/w CHAR(255)   r     1 KV$INPFNCCHR
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:438  
     0-0-0/c SBIN(16)    r     1 KV$INPFNCOPRX(0:0)
     0-0-0/w STRC(736)   r     1 KV$INPFNCTBL               0-0-0/w STRC(16)    r     1 KV$INPOPR
     0-0-0/w ACHR        r     1 KV$INPOPR_DUMMY            0-0-0/w STRC(12)    r     1 KV$INPOPR_MSC
     0-0-0/w STRC(80)    r     1 KV$INPOPR_PST              0-0-0/w ASTR(24)    r     1 KV$INPOPR_TXT
     0-0-0/w STRC(128)   r     1 KV$LINLST                  0-0-0/w STRC(512)   r     1 KV$MRD
     0-0-0/w STRC(512)   r     1 KV$MVD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(288)   r     1 KV$RCRLST                  0-0-0/w STRC(8)     r     1 KV$REDBFR
     0-0-0/c SBIN(8)     r     1 KV$REDBFR_BYT(0:0)
     0-0-0/w CHAR(512)   r     1 KV$REDBFR_CHR              0-0-0/w STRC(80)    r     1 KV$SHRBFR
     0-0-0/c UBIN(8)     r     1 KV$SHRBFR_BYT(0:0)
     0-0-0/w STRC(496)   r     1 KV$SRD                     0-0-0/w STRC(1024)  r     1 KV$SSN
     0-0-0/w STRC(512)   r     1 KV$STR                     0-0-0/w STRC(48)    r     1 KV$TYPAHDBFR
     0-0-0/w CHAR        r     1 KV$TYPAHDBFR_CHR(0:5)
     0-0-0/w STRC(512)   r     1 KV$VDI                     0-0-0/w STRC(48)    r     1 KV@USR_INPPRC
     0-0-0/w STRC(64)    r     1 KV@USR_PST                 0-0-0/w STRC(64)    r     1 KV@USR_SETATR
     0-0-0/w STRC(128)   r     1 KV@VDH_DAT                 0-0-0/w STRC(32)    r     1 KV@VDH_DSC
     0-0-0/w STRC(176)   r     1 KV@VDH_GETBFR              0-0-0/w STRC(160)   r     1 KV@VDH_GETPRM
     0-0-0/w STRC(80)    r     1 KV@VDH_OTPLCL              0-0-0/w STRC(64)    r     1 KV@VDH_PST
     0-0-0/w STRC(112)   r     1 KV@VDH_RLSBFR              0-0-0/w STRC(128)   r     1 KV@VDH_SETPRM


   Procedure KVI$INT requires 8625 words for executable code.
   Procedure KVI$INT requires 62 words of local(AUTO) storage.
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:439  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:440  
          MINI XREF LISTING

B3
      4880**DCL      5652<<ASSIGN   5653>>DOWHILE  5654>>IF       5656>>ASSIGN   5658>>IF       5660<<ASSIGN
      5660>>ASSIGN   5667<<ASSIGN   5668>>DOWHILE  5669>>IF       5669>>IF       5671>>ASSIGN   5680<<ASSIGN
      5680>>ASSIGN   5810<<ASSIGN   5814>>IF       5815>>IF       5818>>IF       5822>>ASSIGN   5823>>IF
      5829>>DOWHILE  5830>>IF       5830>>IF       5835>>IF       5838>>ASSIGN   5843>>ASSIGN   6274<<ASSIGN
      6275>>IF       6275>>IF       6279>>CALLBLT  6279>>CALLBLT  6279>>CALLBLT  6285<<ASSIGN   6285>>ASSIGN
      6285>>ASSIGN   6285>>ASSIGN   6285>>ASSIGN   6287>>IF       6287>>IF       6289>>IF       6290>>ASSIGN
      6290>>ASSIGN   6291>>IF       6411<<ASSIGN   6412>>IF       6412>>IF       6424>>IF       6424>>IF
      6433>>DOWHILE  6437>>IF       6440>>ASSIGN   6441<<ASSIGN   6441>>ASSIGN   6446>>ASSIGN   6447>>ASSIGN
      6448>>ASSIGN   6451>>ASSIGN   6452>>ASSIGN   6462<<ASSIGN   6464>>IF       6464>>IF       6464>>IF
      6479>>ASSIGN   6480>>ASSIGN   7790<<ASSIGN   7791>>DOWHILE  7792>>IF       7792>>IF       7792>>IF
      7792>>IF       7795<<ASSIGN   7795>>ASSIGN   7797>>IF       7915<<ASSIGN   7920>>IF       7923>>IF
      7924>>IF       7925<<ASSIGN   7925>>ASSIGN   7935<<ASSIGN   7937>>ASSIGN   7938>>ASSIGN   7939>>ASSIGN
      7948>>IF       7956>>ASSIGN   7957>>ASSIGN   7958<<ASSIGN   7959>>ASSIGN   7964>>ASSIGN   7964>>ASSIGN
      7965>>ASSIGN   7965>>ASSIGN
CHKJOIN
      5252**LABEL    5234--GOTO     5240--GOTO
CRT IN PROCEDURE Y$BLKTYPAHD
      6054**DCL      6082<<ASSIGN   6143>>ASSIGN
CRT.LIN IN PROCEDURE Y$BLKTYPAHD
      6058**DCL      6136>>IF       6139<<ASSIGN
DLT IN PROCEDURE Y$SCPVRTCLMHI_X
      6655**DCL      6656<<ASSIGN   6666<<ASSIGN   6666>>ASSIGN   6673<<ASSIGN   6673>>ASSIGN   6674>>IF
DLT IN PROCEDURE Y$SCPVRTCLMLOWX
      6693**DCL      6701<<ASSIGN   6708<<ASSIGN   6708>>ASSIGN   6711>>IF       6717<<ASSIGN   6717>>ASSIGN
DLTSGM
      5352**LABEL    5330--GOTO     5346--GOTO
DSPLOWCLM
      4885**DCL      5343>>IF       5802>>ASSIGN   5849>>ASSIGN   5864>>ASSIGN   6194<<ASSIGN   6197>>ASSIGN
      6211>>IF       6211<<ASSIGN   6213>>IF       6215>>DOWHILE  6225<<ASSIGN   6228>>IF       6229<<ASSIGN
      6229>>ASSIGN   6230>>ASSIGN   6527>>IF       6845<<ASSIGN   6845>>ASSIGN   6894>>IF
EDTX
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:441  
      4884**DCL      6192<<ASSIGN   6197>>ASSIGN   6199>>IF       6201>>DOWHILE  6771<<ASSIGN   6775>>ASSIGN
      6776<<ASSIGN   6776>>ASSIGN   6781>>ASSIGN   6785<<ASSIGN   6798>>ASSIGN   6801>>ASSIGN   6807<<ASSIGN
      6826<<ASSIGN   6827>>ASSIGN   6828>>IF       6830>>ASSIGN   6833>>IF       6833>>IF       6888<<ASSIGN
      6890>>ASSIGN   6891<<ASSIGN   6901>>IF
FPT
      4890**DCL      4938--ASSIGN   4939--ASSIGN   4940<>CALL     4941--IF       4970--ASSIGN   4971--ASSIGN
      4972--IF       4975--ASSIGN   4978--IF       4979--IF       4979--IF       4979--IF       4983--IF
      4985--ASSIGN   4989<>CALL     4990--IF       4990--ASSIGN   4991--ASSIGN   4991--ASSIGN   4996--IF
      4996--IF       4996--IF       4996--IF       5000--ASSIGN   5001--ASSIGN   5002--ASSIGN   5003--IF
      5006--ASSIGN   5007<>CALL     5008--IF       5069--ASSIGN   5070--ASSIGN   5071--ASSIGN   5072--ASSIGN
      5073--ASSIGN   5074<>CALL     5177--ASSIGN   5178--ASSIGN   5179--ASSIGN   5180--ASSIGN   5181--ASSIGN
      5182--ASSIGN   5183<>CALL     5399--ASSIGN   5400--ASSIGN   5401--ASSIGN   5402--ASSIGN   5403<>CALL
      5715--ASSIGN   5716--ASSIGN   5717--ASSIGN   5718--IF       5719--ASSIGN   5719--ASSIGN   5720--IF
      5721<>CALL     5722--ASSIGN   5725--IF       5726--ASSIGN   5727<>CALL     5729--ASSIGN   5730--IF
      5731--ASSIGN   5731--ASSIGN   5732--ASSIGN   5733--ASSIGN   5791--ASSIGN   5792--ASSIGN   5793<>CALL
      6093--ASSIGN   6094--ASSIGN   6095--ASSIGN   6096--ASSIGN   6100--ASSIGN   6101<>CALL     6105--ASSIGN
      6106--ASSIGN   6107--ASSIGN   6108--ASSIGN   6110<>CALL     6136--IF       6178--CALL     6390--ASSIGN
      6391--ASSIGN   6392--ASSIGN   6393--ASSIGN   6394<>CALL     6396<<ASSIGN   6399>>ASSIGN   6438--ASSIGN
      6439--ASSIGN   6440--ASSIGN   6442<>CALL     6764--ASSIGN   6765--ASSIGN   6766--ASSIGN   6767--ASSIGN
      6768--ASSIGN   6769--ASSIGN   6770--ASSIGN   6774--CALL     6776--ASSIGN   6778--ASSIGN   6779--ASSIGN
      6782--ASSIGN   6784--ASSIGN   6787--ASSIGN   6788--DOWHILE  6789--IF       6789--IF       6790--ASSIGN
      6790--ASSIGN   6791--IF       6793--CALL     6795--ASSIGN   6798--ASSIGN   6798--ASSIGN   6799--IF
      6804--ASSIGN   6806--ASSIGN   6808--ASSIGN   6808--ASSIGN   6809--IF       6811--CALL     6867--ASSIGN
      6868--ASSIGN   6869--ASSIGN   6870--ASSIGN   6872--ASSIGN   6875--ASSIGN   6877--IF       6877--IF
      6878--ASSIGN   6878--ASSIGN   6883--ASSIGN   6885--ASSIGN   6899--ASSIGN   6902--ASSIGN   6902--ASSIGN
      6902--ASSIGN   6913<>CALL     6919<>CALL     6928--IF       6929--ASSIGN   7773--ASSIGN   7774--ASSIGN
      7775--ASSIGN   7776<>CALL     7777--ASSIGN   7778<>CALL     7931--ASSIGN   7932--ASSIGN   7933<>CALL
      7935--ASSIGN   7951--ASSIGN   7952--ASSIGN   7953<>CALL     7956--ASSIGN   7957--ASSIGN   7958--ASSIGN
      7992--ASSIGN   7993--ASSIGN   7994--ASSIGN   7995--ASSIGN   7999--ASSIGN   8000--ASSIGN   8001<>CALL
G$LOW_MEM.IV.IL$
      1369**DCL      1369--REDEF
G$LOW_MEM.IV.INT.I#00$
      1369**DCL      1369--REDEF
G$LOW_MEM.IV.INT.I#01$
      1369**DCL      1369--REDEF
G$LOW_MEM.IV.INT.I#02$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:442  
      1370**DCL      1370--REDEF
G$LOW_MEM.IV.INT.I#03$
      1370**DCL      1370--REDEF
G$LOW_MEM.IV.INT.I#04$
      1370**DCL      1371--REDEF
G$LOW_MEM.IV.INT.I#05$
      1371**DCL      1371--REDEF
G$LOW_MEM.IV.INT.I#61$
      1372**DCL      1372--REDEF
G$LOW_MEM.IV.INT.I#62$
      1372**DCL      1372--REDEF
G$LOW_MEM.IV.INT.I#63$
      1372**DCL      1372--REDEF
G$LOW_MEM.TV.T#01$
      1357**DCL      1357--REDEF
G$LOW_MEM.TV.T#02$
      1357**DCL      1357--REDEF
G$LOW_MEM.TV.T#03$
      1356**DCL      1356--REDEF
G$LOW_MEM.TV.T#05$
      1356**DCL      1356--REDEF
G$LOW_MEM.TV.T#06$
      1355**DCL      1355--REDEF
G$LOW_MEM.TV.T#07$
      1355**DCL      1355--REDEF
G$LOW_MEM.TV.T#08$
      1354**DCL      1355--REDEF
G$LOW_MEM.TV.T#09$
      1354**DCL      1354--REDEF
G$LOW_MEM.TV.T#10$
      1354**DCL      1354--REDEF
G$LOW_MEM.TV.T#12$
      1353**DCL      1353--REDEF
G$LOW_MEM.TV.T#13$
      1353**DCL      1353--REDEF
G$LOW_MEM.TV.T#14$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:443  
      1352**DCL      1352--REDEF
G$LOW_MEM.TV.T#15$
      1352**DCL      1352--REDEF
G$LOW_MEM.TV.T#16$
      1351**DCL      1352--REDEF
G$LOW_MEM.TV.T#17$
      1351**DCL      1351--REDEF
G$LOW_MEM.TV.T#19$
      1350**DCL      1351--REDEF
G$LOW_MEM.TV.T#20$
      1350**DCL      1350--REDEF
G$LOW_MEM.TV.T#21$
      1350**DCL      1350--REDEF
G$LOW_MEM.TV.T#22$
      1349**DCL      1349--REDEF
G$LOW_MEM.TV.T#23$
      1349**DCL      1349--REDEF
G$LOW_MEM.TV.T#24$
      1348**DCL      1349--REDEF
G$LOW_MEM.TV.T#25$
      1348**DCL      1348--REDEF
G$LOW_MEM.TV.T#26$
      1348**DCL      1348--REDEF
G$LOW_MEM.TV.T#27$
      1347**DCL      1347--REDEF
G$LOW_MEM.TV.T#28$
      1347**DCL      1347--REDEF
G$LOW_MEM.TV.T#29$
      1346**DCL      1347--REDEF
G$LOW_MEM.TV.T#30$
      1346**DCL      1346--REDEF
G$LOW_MEM.TV.T#31$
      1346**DCL      1346--REDEF
G$LOW_MEM.TV.T#32$
      1345**DCL      1345--REDEF
G$LOW_MEM.TV.T#33$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:444  
      1345**DCL      1345--REDEF
G$LOW_MEM.WDT_CURR
      1333**DCL      4901>>IF
G$LOW_MEM$
      1376**DCL      1332--IMP-PTR  4901>>IF
HI_NONBLN IN PROCEDURE Y$BLKTYPAHD
      6014**DCL      6081<<ASSIGN   6142>>ASSIGN
HI_NONBLN.LIN IN PROCEDURE Y$BLKTYPAHD
      6018**DCL      6140<<ASSIGN
INPOPR$
      4877**DCL      1886--IMP-PTR  1886--IMP-PTR  1889--IMP-PTR  1892--IMP-PTR  1900--IMP-PTR  4897<<ASSIGN
      4905<<ASSIGN   4906<<ASSIGN   4906>>ASSIGN   4906>>ASSIGN   4912>>IF       4919>>IF       4919>>IF
      4924>>IF       4924>>IF       4924>>IF       4931>>DOCASE   4939>>ASSIGN   4953>>ASSIGN   4953>>ASSIGN
      4964>>CALL     4971>>ASSIGN   4986>>IF       4992>>IF       4994>>IF       5019>>IF       5022>>ASSIGN
      5023>>DOCASE   5029>>DOWHILE  5030>>ASSIGN   5030>>ASSIGN   5042>>DOWHILE  5043>>ASSIGN   5043>>ASSIGN
      5051>>CALL     5070>>ASSIGN   5071>>ASSIGN   5072>>ASSIGN   5073>>IF       5087>>IF       5097>>IF
      5098>>IF       5102>>IF       5107>>IF       5161>>IF       5161>>IF       5178>>ASSIGN   5188>>DOCASE
      5238>>IF       5249>>IF       5253>>CALL     5557>>IF       5753>>IF       5918>>CALL     5947>>IF
      5948<<ASSIGN   5948>>ASSIGN   5948>>ASSIGN   5950>>IF       5953>>IF       5954<<ASSIGN   5954>>ASSIGN
      5954>>ASSIGN   5955>>IF       5956<<ASSIGN   5956>>ASSIGN   5957<<ASSIGN   5957>>ASSIGN   6163>>IF
      6163>>IF       6175>>IF       6367>>ASSIGN   6512>>CALL     6564>>CALL     7920>>IF
INPPRC
      5188**LABEL    5254--EXIT     5360--EXIT     5857--EXIT     5920--EXIT
KH$CLK IN PROCEDURE Y$TRMRED
      7447**DCL      7773<<ASSIGN
KH$CLK.UID IN PROCEDURE Y$TRMRED
      7463**DCL      7464--REDEF    7465--REDEF
KH$CLK.UID$ IN PROCEDURE Y$TRMRED
      7464**DCL      7774<<ASSIGN
KH$CLK.UVAL IN PROCEDURE Y$TRMRED
      7470**DCL      7775<<ASSIGN   7777<<ASSIGN
KHC$CLOCK IN PROCEDURE Y$TRMRED
      7733**DCL-ENT  7776--CALL     7778--CALL
KHD$SCREECH
      2757**DCL-ENT  5930--CALL
KV$EDTWND
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:445  
      1791**DCL      5637<>CALL     5714--IF       5714--ASSIGN   5720--IF       5726--ASSIGN
KV$EDTWND.L
      1791**DCL      5732<<ASSIGN
KV$EDTWND.STRBYTSIZ
      1791**DCL      5719>>ASSIGN   5731<<ASSIGN
KV$EDTWND.T
      1791**DCL      5733<<ASSIGN
KV$INPFNCCHR
      2754**DCL      6279>>CALLBLT
KV$INPFNCOPRX
      2755**DCL      6285>>ASSIGN
KV$INPFNCTBL.ESCINT1_CHR
      1860**DCL      5418>>IF       5423>>IF
KV$INPFNCTBL.ID_CHRCNT
      1859**DCL      6275>>IF       6279>>CALLBLT
KV$INPFNCTBL.ID_CHROFS
      1860**DCL      6279>>CALLBLT
KV$INPFNCTBL.INPOPROFS
      1861**DCL      4906>>ASSIGN   6285>>ASSIGN
KV$INPFNCTBL.OPRX_OFS
      1860**DCL      6285>>ASSIGN
KV$INPFNCTBL.SBSLVL
      1859**DCL      4973>>IF
KV$INPFNCTBL.SPCCHR
      1859**DCL      6275>>IF
KV$INPOPR
      1886**DCL      5051<>CALL     5253<>CALL     5918<>CALL     5957--ASSIGN   6512<>CALL     6564<>CALL
KV$INPOPR.ACK
      1888**DCL      4924>>IF       4992>>IF       5097>>IF
KV$INPOPR.CHN
      1888**DCL      5950>>IF
KV$INPOPR.CMPCOD
      1888**DCL      4939>>ASSIGN
KV$INPOPR.ID
      1888**DCL      1886--IMP-SIZ  1888--REDEF    1889--REDEF    1889--REDEF    5178>>ASSIGN   5188>>DOCASE
      5238>>IF       5249>>IF       5557>>IF       5753>>IF       6367>>ASSIGN
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:446  
KV$INPOPR.IMD
      1888**DCL      4919>>IF
KV$INPOPR.INPOPRX
      1889**DCL      4953>>ASSIGN   5948>>ASSIGN
KV$INPOPR.PRMID
      1889**DCL      4971>>ASSIGN   6163>>IF
KV$INPOPR.RED
      1888**DCL      4912>>IF       4919>>IF
KV$INPOPR.TYP
      1888**DCL      4924>>IF       4924>>IF       4931>>DOCASE   4986>>IF       4994>>IF       5947>>IF
      5953>>IF       5955>>IF       6163>>IF       6175>>IF       6287>>IF
KV$INPOPR.ID IN PROCEDURE Y$TYPAHDTXT
      7820**DCL      7818--IMP-SIZ  7820--REDEF    7821--REDEF    7821--REDEF
KV$INPOPR_DUMMY
      1886**DCL      1886--REDEF    1889--REDEF    1892--REDEF    1900--REDEF
KV$INPOPR_DUMMY IN PROCEDURE Y$TYPAHDTXT
      7818**DCL      7808--PROC     7818--REDEF    7821--REDEF    7824--REDEF    7832--REDEF    7920--IF
KV$INPOPR_MSC.ABRRED
      1890**DCL      5102>>IF       5161>>IF
KV$INPOPR_MSC.DLTINP
      1890**DCL      5098>>IF
KV$INPOPR_MSC.DLTOTP
      1890**DCL      5087>>IF
KV$INPOPR_MSC.DLTRED
      1890**DCL      5107>>IF       5161>>IF
KV$INPOPR_PST
      1900**DCL      5956--ASSIGN
KV$INPOPR_PST.VDH_PST
      1930**DCL      4964<>CALL
KV$INPOPR_PST.VDH_PST.PSTVAL
      1966**DCL      1971--REDEF
KV$INPOPR_PST.VDH_PST.PSTVAL IN PROCEDURE Y$TYPAHDTXT
      7898**DCL      7903--REDEF
KV$INPOPR_TXT.DSP
      1897**DCL      5023>>DOCASE   6287>>IF
KV$INPOPR_TXT.ECH
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:447  
      1892**DCL      5022>>ASSIGN
KV$INPOPR_TXT.L
      1897**DCL      1897--IMP-SIZ  5019>>IF       5029>>DOWHILE  5030>>ASSIGN   5042>>DOWHILE  5043>>ASSIGN
      5071>>ASSIGN   5954>>ASSIGN   6289>>IF       6290>>ASSIGN   6291>>IF
KV$INPOPR_TXT.T
      1897**DCL      5030>>ASSIGN   5043>>ASSIGN   6290>>ASSIGN
KV$INPOPR_TXT.TRN
      1892**DCL      5072>>ASSIGN
KV$INPOPR_TXT.VRT
      1892**DCL      5073>>IF
KV$INPOPR_TXT.L IN PROCEDURE Y$TYPAHDTXT
      7829**DCL      7829--IMP-SIZ  7944>>DOWHILE  7965>>ASSIGN
KV$INPOPR_TXT.T IN PROCEDURE Y$TYPAHDTXT
      7829**DCL      7965>>ASSIGN
KV$LINLST.FRMDSP
      2000**DCL      5674<<ASSIGN
KV$MRD.ABSGRPRND
      2044**DCL      6095>>ASSIGN   6105>>ASSIGN
KV$MRD.ATRRQRDSPPST
      2038**DCL      6114>>IF
KV$MRD.BLANKERASES
      2033**DCL      5131>>IF
KV$MRD.CTNFRM
      2039**DCL      5195>>IF
KV$MRD.DCHMOVFLD
      2042**DCL      6744>>IF
KV$MRD.DCLATRWHNOTP
      2039**DCL      6903>>IF
KV$MRD.DVCATR
      2048**DCL      6903>>IF
KV$MRD.DVCLIN
      2048**DCL      5200<<ASSIGN
KV$MRD.FSTERS
      2037**DCL      5131>>IF
KV$MRD.HRZSCR
      2036**DCL      6744>>IF       6760>>IF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:448  
KV$MRD.MVD$
      2029**DCL      5652>>ASSIGN
KV$MRD.PHSFRM
      2039**DCL      5131>>IF       5576>>IF       5740>>IF
KV$MVD.DISPINPUT
      2078**DCL      5288>>IF       5510>>IF       5867>>IF       5905>>IF       6097>>IF       6522>>IF
      6873>>IF       6882>>IF       7986>>IF       7996>>IF
KV$MVD.EDITOVR
      2081**DCL      5293>>IF       5297>>IF       5602>>IF       5905>>IF       6233>>IF
KV$MVD.EDTRHT
      2078**DCL      5625<<ASSIGN   5631<<ASSIGN   5801<<ASSIGN   5804<<ASSIGN   6308>>IF       6337<<ASSIGN
      6361<<ASSIGN
KV$MVD.FRMLIN
      2091**DCL      5144<<ASSIGN   5202<<ASSIGN
KV$MVD.FRMSCNINH
      2082**DCL      6608>>IF
KV$MVD.HRZSCR
      2082**DCL      5343>>IF       5879>>IF       6527>>IF       6766>>ASSIGN   6799>>IF       6875>>ASSIGN
      6876>>IF       6894>>IF       8000>>ASSIGN   8005>>IF
KV$MVD.HRZSCRMRG
      2083**DCL      5343>>IF       5880>>IF       6527>>IF       6832>>ASSIGN   6894>>IF       6894>>IF
      8006>>IF       8006>>IF       8102>>ASSIGN
KV$MVD.HRZSCRSHF
      2080**DCL      6825>>ASSIGN
KV$MVD.INPTAB$
      2073**DCL      5810>>ASSIGN
KV$MVD.INSMOD
      2082**DCL      5238>>IF       5245>>IF       5249>>IF       5252>>IF
KV$MVD.LNG
      2077**DCL      5196>>IF       5201>>ASSIGN   5202>>ASSIGN
KV$MVD.LNK$
      2073**DCL      5660>>ASSIGN
KV$MVD.LOWERCASE
      2079**DCL      5458>>IF
KV$MVD.ORG
      2078**DCL      4941>>IF       4982>>IF       5116>>IF       5165>>IF       5548>>IF       5612>>IF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:449  
      5658>>IF       5669>>IF       5673>>IF       5676>>IF       5677>>IF       5684>>IF       5790>>IF
      5918>>IF       6151>>IF       6398>>IF       6511>>IF       6560>>IF       6565>>IF       6573>>IF
      6608>>IF       6744>>IF       6744>>IF       6818>>IF       6846>>IF       7747>>IF       8100>>IF
KV$MVD.RCRWRAP
      2092**DCL      5252>>IF       6366>>IF       6512>>IF       6563>>IF
KV$MVD.RETYPOVR
      2081**DCL      5284>>IF       5357>>IF       5372>>IF       5602>>IF       5867>>IF       5872>>IF
      5905>>IF       6233>>IF       6522>>IF       6873>>IF       6879>>IF       7986>>IF       8138>>IF
KV$MVD.SPACEINSERT
      2079**DCL      5847>>IF
KV$MVD.SRD$
      2073**DCL      5654>>IF       5656>>ASSIGN   5669>>IF
KV$MVD.SSTINPFNCTBL$
      2075**DCL      4905>>ASSIGN
KV$MVD.TABRELATIVE
      2080**DCL      5805>>IF       5846>>IF
KV$MVD.TABSIM
      2080**DCL      5848>>IF       5856>>IF       5869>>IF
KV$MVD.UPPERCASE
      2080**DCL      5450>>IF
KV$MVD.USRINPFNCTBL$
      2074**DCL      6271>>IF       6274>>ASSIGN
KV$MVD.VRTCLM
      2090**DCL      5282>>ASSIGN   5283<>CALL     5293>>IF       5305>>IF       5342<>CALL     5343>>IF
      5378<<ASSIGN   5378>>ASSIGN   5603<<ASSIGN   5603>>ASSIGN   5687<<ASSIGN   5751<<ASSIGN   5800<<ASSIGN
      5849>>ASSIGN   5876<<ASSIGN   5886<<ASSIGN   6526<>CALL     6527>>IF       6619<>CALL     6625>>ASSIGN
      6642<<ASSIGN   6741>>ASSIGN   6781<<ASSIGN   6781>>ASSIGN   6782>>ASSIGN   6796<<ASSIGN   6796>>ASSIGN
      6801<<ASSIGN   6801>>ASSIGN   6806<<ASSIGN   6806>>ASSIGN   6813<<ASSIGN   6820>>ASSIGN   6834>>IF
      6839>>ASSIGN   6842>>ASSIGN   6848<<ASSIGN   6889>>ASSIGN   6890<<ASSIGN   6897<<ASSIGN   6922>>IF
      6923<<ASSIGN   8006>>IF       8006>>IF       8009<>CALL     8104<<ASSIGN   8110<>CALL
KV$MVD.VRTLIN
      2090**DCL      5201<<ASSIGN
KV$MVD.WDT
      2077**DCL      5880>>IF       6760>>IF       6826>>ASSIGN   6836>>ASSIGN   6876>>IF       6894>>IF
      8006>>IF       8006>>IF
KV$PTR.INPCNDPND
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:450  
      2122**DCL      2131--REDEF    2135--REDEF    7767>>ASSIGN
KV$PTR.INPCNDPND.ESC.SST
      2130**DCL      5422<<ASSIGN   5427<<ASSIGN
KV$PTR.INPCNDPND.INPOPR
      2126**DCL      4952<<ASSIGN   6292<<ASSIGN
KV$PTR.INPCNDPND.OPRX
      2131**DCL      4899>>ASSIGN   4953<<ASSIGN   6164>>ASSIGN
KV$PTR.INPCNDPND.TRN
      2126**DCL      7749>>IF
KV$PTR.LINLST$
      2118**DCL      2119--REDEF    5674>>ASSIGN
KV$PTR.MRD$
      2117**DCL      5131>>IF       5131>>IF       5131>>IF       5195>>IF       5200>>ASSIGN   5576>>IF
      5652>>ASSIGN   5740>>IF       6095>>ASSIGN   6105>>ASSIGN   6114>>IF       6744>>IF       6744>>IF
      6760>>IF       6903>>IF       6903>>IF
KV$PTR.MVD$
      2117**DCL      4905>>ASSIGN   4941>>IF       4982>>IF       5116>>IF       5144>>ASSIGN   5165>>IF
      5196>>IF       5201>>ASSIGN   5201>>ASSIGN   5202>>ASSIGN   5202>>ASSIGN   5238>>IF       5245>>IF
      5249>>IF       5252>>IF       5252>>IF       5282>>ASSIGN   5283>>CALL     5284>>IF       5288>>IF
      5293>>IF       5293>>IF       5297>>IF       5305>>IF       5342>>CALL     5343>>IF       5343>>IF
      5343>>IF       5357>>IF       5372>>IF       5378>>ASSIGN   5378>>ASSIGN   5450>>IF       5458>>IF
      5510>>IF       5548>>IF       5602>>IF       5602>>IF       5603>>ASSIGN   5603>>ASSIGN   5612>>IF
      5625>>ASSIGN   5631>>ASSIGN   5673>>IF       5676>>IF       5677>>IF       5684>>IF       5687>>ASSIGN
      5751>>ASSIGN   5790>>IF       5800>>ASSIGN   5801>>ASSIGN   5804>>ASSIGN   5805>>IF       5810>>ASSIGN
      5846>>IF       5847>>IF       5848>>IF       5849>>ASSIGN   5856>>IF       5867>>IF       5867>>IF
      5869>>IF       5872>>IF       5876>>ASSIGN   5879>>IF       5880>>IF       5880>>IF       5886>>ASSIGN
      5905>>IF       5905>>IF       5905>>IF       5918>>IF       6097>>IF       6151>>IF       6233>>IF
      6233>>IF       6271>>IF       6274>>ASSIGN   6308>>IF       6337>>ASSIGN   6361>>ASSIGN   6366>>IF
      6398>>IF       6511>>IF       6512>>IF       6522>>IF       6522>>IF       6526>>CALL     6527>>IF
      6527>>IF       6527>>IF       6560>>IF       6563>>IF       6565>>IF       6573>>IF       6608>>IF
      6608>>IF       6619>>CALL     6625>>ASSIGN   6642>>ASSIGN   6741>>ASSIGN   6744>>IF       6744>>IF
      6760>>IF       6766>>ASSIGN   6781>>ASSIGN   6781>>ASSIGN   6782>>ASSIGN   6796>>ASSIGN   6796>>ASSIGN
      6799>>IF       6801>>ASSIGN   6801>>ASSIGN   6806>>ASSIGN   6806>>ASSIGN   6813>>ASSIGN   6818>>IF
      6820>>ASSIGN   6825>>ASSIGN   6826>>ASSIGN   6832>>ASSIGN   6834>>IF       6836>>ASSIGN   6839>>ASSIGN
      6842>>ASSIGN   6846>>IF       6848>>ASSIGN   6873>>IF       6873>>IF       6875>>ASSIGN   6876>>IF
      6876>>IF       6879>>IF       6882>>IF       6889>>ASSIGN   6890>>ASSIGN   6894>>IF       6894>>IF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:451  
      6894>>IF       6894>>IF       6897>>ASSIGN   6922>>IF       6923>>ASSIGN   7747>>IF       7986>>IF
      7986>>IF       7996>>IF       8000>>ASSIGN   8005>>IF       8006>>IF       8006>>IF       8006>>IF
      8006>>IF       8006>>IF       8006>>IF       8009>>CALL     8100>>IF       8102>>ASSIGN   8104>>ASSIGN
      8110>>CALL     8138>>IF
KV$PTR.RCRLST$
      2119**DCL      5166>>IF       6819>>ASSIGN   6847>>IF       8101>>IF       8102>>ASSIGN
KV$PTR.SRD$
      2118**DCL      5131>>IF       5133>>ASSIGN   5134>>ASSIGN   5134>>ASSIGN   5137>>ASSIGN   5138>>IF
      5138>>IF       5141>>ASSIGN   5141>>ASSIGN   5142>>ASSIGN   5142>>ASSIGN   5143>>ASSIGN   5143>>ASSIGN
      5145>>ASSIGN   5145>>ASSIGN   5197>>ASSIGN   5197>>ASSIGN   5197>>ASSIGN   5197>>ASSIGN   5199>>ASSIGN
      5199>>ASSIGN   5200>>ASSIGN   5301>>ASSIGN   5315>>ASSIGN   5343>>IF       5357>>IF       5387>>ASSIGN
      5563>>IF       5675>>IF       5684>>IF       5684>>IF       5748>>ASSIGN   5748>>ASSIGN   5750>>ASSIGN
      5750>>ASSIGN   5752>>ASSIGN   5754>>ASSIGN   5754>>ASSIGN   5755>>IF       5756>>ASSIGN   5756>>ASSIGN
      5809>>ASSIGN   5846>>ASSIGN   5866>>ASSIGN   5872>>IF       6081>>ASSIGN   6082>>ASSIGN   6087>>ASSIGN
      6087>>ASSIGN   6094>>ASSIGN   6107>>ASSIGN   6108>>ASSIGN   6117>>ASSIGN   6117>>ASSIGN   6131>>ASSIGN
      6131>>ASSIGN   6132>>ASSIGN   6132>>ASSIGN   6135>>ASSIGN   6139>>ASSIGN   6142>>ASSIGN   6143>>ASSIGN
      6158>>ASSIGN   6159>>ASSIGN   6180>>ASSIGN   6195>>ASSIGN   6229>>ASSIGN   6521>>ASSIGN   6527>>IF
      6618>>IF       6642>>ASSIGN   6644>>ASSIGN   6744>>IF       6744>>IF       6744>>IF       6744>>IF
      6760>>IF       6770>>ASSIGN   6771>>ASSIGN   6772>>IF       6772>>ASSIGN   6772>>ASSIGN   6775>>ASSIGN
      6782>>ASSIGN   6785>>ASSIGN   6787>>ASSIGN   6799>>IF       6804>>ASSIGN   6807>>ASSIGN   6810>>ASSIGN
      6810>>ASSIGN   6826>>ASSIGN   6827>>ASSIGN   6835>>ASSIGN   6848>>ASSIGN   6894>>IF       6903>>IF
      6903>>IF       6903>>IF       6903>>IF       6930>>ASSIGN   7988>>ASSIGN   8104>>ASSIGN   8142>>ASSIGN
KV$PTR.SSN$
      2116**DCL      4898>>ASSIGN   5034>>ASSIGN   5530>>IF       5535>>IF       7792>>IF       8019>>ASSIGN
      8027>>ASSIGN   8056>>ASSIGN   8063>>ASSIGN   8070>>ASSIGN   8076>>ASSIGN   8083>>ASSIGN   8090>>ASSIGN
      8097>>ASSIGN   8118>>ASSIGN
KV$PTR.STR$
      2116**DCL      5004>>ASSIGN   5538>>ASSIGN   5547>>ASSIGN   5571>>IF       5612>>IF       5666>>ASSIGN
      5672>>IF       5683>>IF       5759>>IF       5783>>IF       5941>>IF       5982>>ASSIGN   5982>>ASSIGN
      6069>>IF       6560>>IF       6565>>IF       6579>>ASSIGN   7786>>IF       7792>>IF       7792>>IF
      8026>>ASSIGN   8026>>ASSIGN   8035>>IF       8036>>ASSIGN   8037>>ASSIGN   8039>>ASSIGN   8040>>ASSIGN
      8040>>ASSIGN   8040>>ASSIGN   8043>>ASSIGN   8120>>IF       8120>>IF       8120>>IF       8120>>IF
      8120>>IF       8127>>ASSIGN   8127>>ASSIGN   8132>>ASSIGN   8133>>IF       8133>>IF       8134>>ASSIGN
      8135>>ASSIGN   8136>>ASSIGN   8144>>IF       8150>>ASSIGN   8150>>ASSIGN   8150>>ASSIGN   8153>>IF
KV$PTR.USRINPFNCINH
      2136**DCL      6151>>IF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:452  
KV$PTR.VDI$
      2116**DCL      4912>>IF       4919>>IF       5009>>IF       5009>>IF       5056>>IF       5056>>IF
      5062>>IF       5075>>IF       5075>>IF       5086>>ASSIGN   5114>>IF       5115>>IF       5116>>IF
      5124>>IF       5128>>IF       5150>>IF       5150>>IF       5154>>IF       5154>>IF       5162>>IF
      5162>>IF       5182>>ASSIGN   5281>>IF       5313>>IF       5314>>ASSIGN   5357>>IF       5371>>IF
      5385>>IF       5386>>ASSIGN   5495>>IF       5495>>IF       5510>>IF       5510>>IF       5510>>IF
      5526>>IF       5529>>ASSIGN   5531>>IF       5550>>IF       5550>>IF       5563>>IF       5563>>IF
      5636>>IF       5637>>CALL     5642>>IF       5663>>IF       5694>>ASSIGN   5696>>ASSIGN   5700>>ASSIGN
      5717>>ASSIGN   5729>>ASSIGN   5866>>IF       5868>>IF       5941>>IF       6065>>IF       6109>>ASSIGN
      6118>>ASSIGN   6144>>ASSIGN   6151>>IF       6388>>ASSIGN   6403>>ASSIGN   6459>>IF       6521>>IF
      6523>>IF       6572>>IF       6610>>IF       6613>>ASSIGN   6614>>IF       6618>>IF       6621>>IF
      6622>>ASSIGN   6628>>IF       6629>>ASSIGN   6630>>ASSIGN   6871>>IF       6873>>IF       6882>>IF
      6884>>ASSIGN   6885>>ASSIGN   6928>>IF       6929>>ASSIGN   7744>>IF       7747>>IF       7765>>ASSIGN
      7783>>IF       7785>>IF       7785>>IF       7786>>IF       7790>>ASSIGN   7791>>IF       7982>>IF
      7983>>IF       7984>>ASSIGN   7988>>IF       7989>>IF       7996>>IF       8005>>IF       8112>>ASSIGN
      8138>>IF       8138>>IF       8140>>ASSIGN   8141>>ASSIGN
KV$PTR$
      2110**DCL      2116--IMP-PTR  4898>>ASSIGN   4899>>ASSIGN   4905>>ASSIGN   4912>>IF       4919>>IF
      4941>>IF       4952>>ASSIGN   4953>>ASSIGN   4982>>IF       5004>>ASSIGN   5009>>IF       5009>>IF
      5034>>ASSIGN   5056>>IF       5056>>IF       5062>>IF       5075>>IF       5075>>IF       5086>>ASSIGN
      5114>>IF       5115>>IF       5116>>IF       5116>>IF       5124>>IF       5128>>IF       5131>>IF
      5131>>IF       5131>>IF       5131>>IF       5133>>ASSIGN   5134>>ASSIGN   5134>>ASSIGN   5137>>ASSIGN
      5138>>IF       5138>>IF       5141>>ASSIGN   5141>>ASSIGN   5142>>ASSIGN   5142>>ASSIGN   5143>>ASSIGN
      5143>>ASSIGN   5144>>ASSIGN   5145>>ASSIGN   5145>>ASSIGN   5150>>IF       5150>>IF       5154>>IF
      5154>>IF       5162>>IF       5162>>IF       5165>>IF       5166>>IF       5182>>ASSIGN   5195>>IF
      5196>>IF       5197>>ASSIGN   5197>>ASSIGN   5197>>ASSIGN   5197>>ASSIGN   5199>>ASSIGN   5199>>ASSIGN
      5200>>ASSIGN   5200>>ASSIGN   5201>>ASSIGN   5201>>ASSIGN   5202>>ASSIGN   5202>>ASSIGN   5238>>IF
      5245>>IF       5249>>IF       5252>>IF       5252>>IF       5281>>IF       5282>>ASSIGN   5283>>CALL
      5284>>IF       5288>>IF       5293>>IF       5293>>IF       5297>>IF       5301>>ASSIGN   5305>>IF
      5313>>IF       5314>>ASSIGN   5315>>ASSIGN   5342>>CALL     5343>>IF       5343>>IF       5343>>IF
      5343>>IF       5357>>IF       5357>>IF       5357>>IF       5371>>IF       5372>>IF       5378>>ASSIGN
      5378>>ASSIGN   5385>>IF       5386>>ASSIGN   5387>>ASSIGN   5422>>ASSIGN   5427>>ASSIGN   5450>>IF
      5458>>IF       5495>>IF       5495>>IF       5510>>IF       5510>>IF       5510>>IF       5510>>IF
      5526>>IF       5529>>ASSIGN   5530>>IF       5531>>IF       5535>>IF       5537<<ASSIGN   5538>>ASSIGN
      5547>>ASSIGN   5548>>IF       5550>>IF       5550>>IF       5563>>IF       5563>>IF       5563>>IF
      5571>>IF       5576>>IF       5602>>IF       5602>>IF       5603>>ASSIGN   5603>>ASSIGN   5612>>IF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:453  
      5612>>IF       5625>>ASSIGN   5631>>ASSIGN   5636>>IF       5637>>CALL     5642>>IF       5652>>ASSIGN
      5663>>IF       5666>>ASSIGN   5672>>IF       5673>>IF       5674>>ASSIGN   5675>>IF       5676>>IF
      5677>>IF       5683>>IF       5684>>IF       5684>>IF       5684>>IF       5687>>ASSIGN   5694>>ASSIGN
      5696>>ASSIGN   5700>>ASSIGN   5717>>ASSIGN   5729>>ASSIGN   5740>>IF       5748>>ASSIGN   5748>>ASSIGN
      5750>>ASSIGN   5750>>ASSIGN   5751>>ASSIGN   5752>>ASSIGN   5754>>ASSIGN   5754>>ASSIGN   5755>>IF
      5756>>ASSIGN   5756>>ASSIGN   5759>>IF       5783>>IF       5790>>IF       5800>>ASSIGN   5801>>ASSIGN
      5804>>ASSIGN   5805>>IF       5809>>ASSIGN   5810>>ASSIGN   5846>>IF       5846>>ASSIGN   5847>>IF
      5848>>IF       5849>>ASSIGN   5856>>IF       5866>>IF       5866>>ASSIGN   5867>>IF       5867>>IF
      5868>>IF       5869>>IF       5872>>IF       5872>>IF       5876>>ASSIGN   5879>>IF       5880>>IF
      5880>>IF       5886>>ASSIGN   5905>>IF       5905>>IF       5905>>IF       5918>>IF       5941>>IF
      5941>>IF       5982>>ASSIGN   5982>>ASSIGN   6065>>IF       6069>>IF       6081>>ASSIGN   6082>>ASSIGN
      6087>>ASSIGN   6087>>ASSIGN   6094>>ASSIGN   6095>>ASSIGN   6097>>IF       6105>>ASSIGN   6107>>ASSIGN
      6108>>ASSIGN   6109>>ASSIGN   6114>>IF       6117>>ASSIGN   6117>>ASSIGN   6118>>ASSIGN   6131>>ASSIGN
      6131>>ASSIGN   6132>>ASSIGN   6132>>ASSIGN   6135>>ASSIGN   6139>>ASSIGN   6142>>ASSIGN   6143>>ASSIGN
      6144>>ASSIGN   6151>>IF       6151>>IF       6151>>IF       6158>>ASSIGN   6159>>ASSIGN   6164>>ASSIGN
      6180>>ASSIGN   6195>>ASSIGN   6229>>ASSIGN   6233>>IF       6233>>IF       6271>>IF       6274>>ASSIGN
      6292>>ASSIGN   6308>>IF       6337>>ASSIGN   6361>>ASSIGN   6366>>IF       6388>>ASSIGN   6398>>IF
      6403>>ASSIGN   6459>>IF       6511>>IF       6512>>IF       6521>>IF       6521>>ASSIGN   6522>>IF
      6522>>IF       6523>>IF       6526>>CALL     6527>>IF       6527>>IF       6527>>IF       6527>>IF
      6560>>IF       6560>>IF       6563>>IF       6565>>IF       6565>>IF       6572>>IF       6573>>IF
      6579>>ASSIGN   6608>>IF       6608>>IF       6610>>IF       6613>>ASSIGN   6614>>IF       6618>>IF
      6618>>IF       6619>>CALL     6621>>IF       6622>>ASSIGN   6625>>ASSIGN   6628>>IF       6629>>ASSIGN
      6630>>ASSIGN   6642>>ASSIGN   6642>>ASSIGN   6644>>ASSIGN   6741>>ASSIGN   6744>>IF       6744>>IF
      6744>>IF       6744>>IF       6744>>IF       6744>>IF       6744>>IF       6744>>IF       6760>>IF
      6760>>IF       6760>>IF       6766>>ASSIGN   6770>>ASSIGN   6771>>ASSIGN   6772>>IF       6772>>ASSIGN
      6772>>ASSIGN   6775>>ASSIGN   6781>>ASSIGN   6781>>ASSIGN   6782>>ASSIGN   6782>>ASSIGN   6785>>ASSIGN
      6787>>ASSIGN   6796>>ASSIGN   6796>>ASSIGN   6799>>IF       6799>>IF       6801>>ASSIGN   6801>>ASSIGN
      6804>>ASSIGN   6806>>ASSIGN   6806>>ASSIGN   6807>>ASSIGN   6810>>ASSIGN   6810>>ASSIGN   6813>>ASSIGN
      6818>>IF       6819>>ASSIGN   6820>>ASSIGN   6825>>ASSIGN   6826>>ASSIGN   6826>>ASSIGN   6827>>ASSIGN
      6832>>ASSIGN   6834>>IF       6835>>ASSIGN   6836>>ASSIGN   6839>>ASSIGN   6842>>ASSIGN   6846>>IF
      6847>>IF       6848>>ASSIGN   6848>>ASSIGN   6871>>IF       6873>>IF       6873>>IF       6873>>IF
      6875>>ASSIGN   6876>>IF       6876>>IF       6879>>IF       6882>>IF       6882>>IF       6884>>ASSIGN
      6885>>ASSIGN   6889>>ASSIGN   6890>>ASSIGN   6894>>IF       6894>>IF       6894>>IF       6894>>IF
      6894>>IF       6897>>ASSIGN   6903>>IF       6903>>IF       6903>>IF       6903>>IF       6903>>IF
      6903>>IF       6922>>IF       6923>>ASSIGN   6928>>IF       6929>>ASSIGN   6930>>ASSIGN   7744>>IF
      7747>>IF       7747>>IF       7749>>IF       7765>>ASSIGN   7767>>ASSIGN   7783>>IF       7785>>IF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:454  
      7785>>IF       7786>>IF       7786>>IF       7790>>ASSIGN   7791>>IF       7792>>IF       7982>>IF
      7983>>IF       7984>>ASSIGN   7986>>IF       7986>>IF       7988>>IF       7988>>ASSIGN   7989>>IF
      7996>>IF       7996>>IF       8000>>ASSIGN   8005>>IF       8005>>IF       8006>>IF       8006>>IF
      8006>>IF       8006>>IF       8006>>IF       8006>>IF       8009>>CALL     8019>>ASSIGN   8026>>ASSIGN
      8026>>ASSIGN   8027>>ASSIGN   8035>>IF       8036>>ASSIGN   8037>>ASSIGN   8039>>ASSIGN   8040>>ASSIGN
      8040>>ASSIGN   8040>>ASSIGN   8043>>ASSIGN   8056>>ASSIGN   8063>>ASSIGN   8070>>ASSIGN   8076>>ASSIGN
      8083>>ASSIGN   8090>>ASSIGN   8097>>ASSIGN   8100>>IF       8101>>IF       8102>>ASSIGN   8102>>ASSIGN
      8104>>ASSIGN   8104>>ASSIGN   8110>>CALL     8112>>ASSIGN   8118>>ASSIGN   8120>>IF       8120>>IF
      8120>>IF       8120>>IF       8120>>IF       8127>>ASSIGN   8127>>ASSIGN   8132>>ASSIGN   8133>>IF
      8133>>IF       8134>>ASSIGN   8135>>ASSIGN   8136>>ASSIGN   8138>>IF       8138>>IF       8138>>IF
      8140>>ASSIGN   8141>>ASSIGN   8142>>ASSIGN   8144>>IF       8150>>ASSIGN   8150>>ASSIGN   8150>>ASSIGN
      8153>>IF
KV$RCRLST.HRZSCRALL
      2168**DCL      5166>>IF       6847>>IF
KV$RCRLST.HRZSCROFS
      2161**DCL      6819>>ASSIGN   8101>>IF       8102>>ASSIGN
KV$REDBFR.CHR
      2175**DCL      5323>>IF       5327>>IF       6202>>IF       6202>>IF       6205>>IF       6206>>IF
      6216>>IF       6216>>IF       6218>>IF       6219>>IF       6318>>IF       6322>>DOWHILE  6346>>IF
      6351>>IF       6355>>IF       6666>>IF       6669>>IF       6669>>IF       6702>>IF       6708>>IF
      6711>>IF       6716>>IF       6716>>IF
KV$REDBFR_BYT
      2179**DCL      8129>>IF       8145>>DOWHILE
KV$REDBFR_CHR
      2180**DCL      5268<<CALLBLT  5268>>CALLBLT  5364<<ASSIGN   5364>>ASSIGN   5733>>ASSIGN   6588<<ASSIGN
      7980<<CALLBLT  7980>>CALLBLT  8036<<ASSIGN   8040<<ASSIGN   8040>>ASSIGN
KV$SHRBFR
      2198**DCL      5811--ASSIGN
KV$SHRBFR.BITT
      2213**DCL      2214--REDEF    5783>>IF
KV$SHRBFR.BYT
      2214**DCL      5818>>IF       5822>>ASSIGN   5823>>IF
KV$SHRBFR.BYTSIZ
      2207**DCL      5815>>IF       5829>>DOWHILE
KV$SHRBFR_BYT
      2215**DCL      5830>>IF       5830>>IF       5835>>IF       5838>>ASSIGN   5843>>ASSIGN
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:455  
KV$SRD.BRDEXS
      2344**DCL      5654>>IF       5669>>IF
KV$SRD.BRDUPD
      2345**DCL      5656<<ASSIGN   5675>>IF
KV$SRD.BTMRHT
      2333**DCL      2338--REDEF
KV$SRD.BTMRHT.CLM
      2335**DCL      6087>>ASSIGN   6107>>ASSIGN   6131>>ASSIGN   6771>>ASSIGN   6772<<ASSIGN   6775<<ASSIGN
      6903>>IF
KV$SRD.BTMRHT.LIN
      2335**DCL      5197>>ASSIGN   5199>>ASSIGN   5200>>ASSIGN   5748>>ASSIGN
KV$SRD.BTMRHT_PST
      2338**DCL      6744>>IF
KV$SRD.CRT
      2409**DCL      2414--REDEF    6082>>ASSIGN   6094>>ASSIGN   6143<<ASSIGN   6770>>ASSIGN
KV$SRD.CRT.CLM
      2411**DCL      6117<<ASSIGN   6117>>ASSIGN   6132<<ASSIGN   6810<<ASSIGN
KV$SRD.CRT.LIN
      2411**DCL      5141<<ASSIGN   5197>>ASSIGN   5199<<ASSIGN   5750>>ASSIGN   6804>>ASSIGN
KV$SRD.CRTVRTLINPHSLIN
      2381**DCL      5142<<ASSIGN   5197<<ASSIGN   5197>>ASSIGN   5750<<ASSIGN   5754<<ASSIGN
KV$SRD.DVCLINBIS
      2451**DCL      5145<<ASSIGN   5756<<ASSIGN
KV$SRD.FLDEND
      2373**DCL      2378--REDEF    6108<<ASSIGN   6135<<ASSIGN
KV$SRD.FLDEND.CLM
      2375**DCL      5563>>IF       6131<<ASSIGN   6772>>IF       6772>>ASSIGN   6903>>IF       6903>>IF
KV$SRD.FSTERS
      2344**DCL      6903>>IF
KV$SRD.HI_NONBLN
      2443**DCL      2448--REDEF    5134<<ASSIGN   6081>>ASSIGN   6142<<ASSIGN
KV$SRD.HI_NONBLN.CLM
      2445**DCL      6087<<ASSIGN
KV$SRD.HI_NONBLN.LIN
      2445**DCL      5143<<ASSIGN
KV$SRD.HI_NONBLNVRT
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:456  
      2343**DCL      6644<<ASSIGN
KV$SRD.HI_NONBLN_PST
      2448**DCL      6744>>IF
KV$SRD.LNG
      2341**DCL      5145>>ASSIGN   5684>>IF       5756>>ASSIGN
KV$SRD.NXTNONBLNLIN
      2381**DCL      5748<<ASSIGN
KV$SRD.ORG
      2265**DCL      2270--REDEF
KV$SRD.PRMVRTCLM
      2381**DCL      5343>>IF       5809>>ASSIGN   5846>>ASSIGN   6195>>ASSIGN   6229>>ASSIGN   6527>>IF
      6642>>ASSIGN   6760>>IF       6782>>ASSIGN   6826>>ASSIGN   6827>>ASSIGN   6835>>ASSIGN   6848>>ASSIGN
      6894>>IF       8104>>ASSIGN
KV$SRD.RELPAGE
      2342**DCL      5138>>IF
KV$SRD.SCROLL
      2342**DCL      5131>>IF       5138>>IF       5755>>IF
KV$SRD.SRDEND
      2478**DCL      2483--REDEF    5134>>ASSIGN
KV$SRD.TOPLFT
      2299**DCL      2304--REDEF
KV$SRD.TOPLFT.CLM
      2301**DCL      6132>>ASSIGN   6787>>ASSIGN   6810>>ASSIGN
KV$SRD.TOPLFT.LIN
      2301**DCL      5141>>ASSIGN   5142>>ASSIGN   5143>>ASSIGN   5754>>ASSIGN   6139>>ASSIGN
KV$SRD.TRUNCATE
      2343**DCL      6158>>ASSIGN   6159<<ASSIGN   6180<<ASSIGN   6799>>IF
KV$SRD.UNKPST
      2486**DCL      5133<<ASSIGN   5137<<ASSIGN
KV$SRD.VRTPSTOK
      2342**DCL      5301<<ASSIGN   5315<<ASSIGN   5357>>IF       5387<<ASSIGN   5752<<ASSIGN   5866<<ASSIGN
      5872>>IF       6521<<ASSIGN   6618>>IF       6930<<ASSIGN   7988<<ASSIGN   8142<<ASSIGN
KV$SRD.VRTSCR
      2487**DCL      6744>>IF
KV$SRD.WDT
      2341**DCL      5684>>IF       6744>>IF       6785>>ASSIGN   6807>>ASSIGN
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:457  
KV$SSN
      2514**DCL      7774--ASSIGN
KV$SSN.BP
      2565**DCL      8144>>IF
KV$SSN.BRKCNT
      2524**DCL      7781<<ASSIGN
KV$SSN.CHNCAS
      2526**DCL      7979>>IF
KV$SSN.CLKSET
      2533**DCL      7771>>IF       7776>>IF       7778>>IF       7779<<ASSIGN   7779>>ASSIGN
KV$SSN.CLMIS_BYTX
      2564**DCL      6196>>IF       6199<<ASSIGN   6208<<ASSIGN   6402<<ASSIGN   6496>>IF       6545>>IF
      6554>>IF       6661>>IF       6695>>IF       6744>>IF       6760>>IF       8049<<ASSIGN
KV$SSN.INPCHR
      2532**DCL      5030<<ASSIGN   5043<<ASSIGN   5216<<ASSIGN   5501<<ASSIGN   5786<<ASSIGN   5860<<ASSIGN
      6571<<ASSIGN
KV$SSN.INPECH
      2532**DCL      5022<<ASSIGN   5503>>ASSIGN   5504<<ASSIGN   5514<<ASSIGN   5781>>ASSIGN   5782<<ASSIGN
      5848<<ASSIGN   5855<<ASSIGN   5890<<ASSIGN   6572<<ASSIGN
KV$SSN.LNK$
      2514**DCL      5527>>IF       5528>>ASSIGN   5693>>IF       5695>>ASSIGN   7795>>ASSIGN
KV$SSN.LSTPRMID
      2567**DCL      4985<<ASSIGN   5934<<ASSIGN   6372>>IF
KV$SSN.NO_WATREDTRG
      2532**DCL      5946<<ASSIGN   6072<<ASSIGN   6427<<ASSIGN
KV$SSN.OTPBLK
      2528**DCL      7801>>IF
KV$SSN.REDBFR
      2533**DCL      6397<<ASSIGN   8165<<ASSIGN
KV$SSN.REDBFR.DSPLOWX
      2535**DCL      5163>>IF       5164<<ASSIGN   6194>>ASSIGN   6396>>ASSIGN   6399<<ASSIGN   6778>>ASSIGN
      6782>>ASSIGN   6791>>IF       6820>>ASSIGN   6840>>IF       6841>>ASSIGN   6844<<ASSIGN   6844>>ASSIGN
      6868>>ASSIGN   6899>>ASSIGN
KV$SSN.REDBFR.EDTHI_X
      2534**DCL      5259<<ASSIGN   5264>>ASSIGN   5268>>CALLBLT  5272>>ASSIGN   5273>>IF       5275>>IF
      5610<<ASSIGN   5617<<ASSIGN   6311>>ASSIGN   6330<<ASSIGN   6333<<ASSIGN   6497<<ASSIGN   6498<<ASSIGN
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:458  
      6499>>IF       6500<<ASSIGN   6503>>ASSIGN   6546>>ASSIGN   6555<<ASSIGN   6585<<ASSIGN   6657>>ASSIGN
      6697<<ASSIGN   6722<<ASSIGN   7977>>IF       7978>>ASSIGN   8003<<ASSIGN   8003>>ASSIGN   8004>>ASSIGN
      8047<<ASSIGN
KV$SSN.REDBFR.EDTLOWX
      2534**DCL      5001>>ASSIGN   5237>>IF       5239>>IF       5241>>IF       5249>>IF       5251>>IF
      5259>>ASSIGN   5268>>CALLBLT  5272>>ASSIGN   5313>>IF       5314>>ASSIGN   5320>>ASSIGN   5335>>IF
      5336>>ASSIGN   5337>>ASSIGN   5339>>ASSIGN   5341<<ASSIGN   5351>>ASSIGN   5377>>IF       5385>>IF
      5386>>ASSIGN   5585>>IF       5590<<ASSIGN   5600>>IF       5609>>IF       5612>>IF       5615>>IF
      5616<<ASSIGN   5772>>ASSIGN   5773>>IF       5774>>ASSIGN   5775>>ASSIGN   5900>>ASSIGN   5902>>ASSIGN
      5903>>IF       5904>>ASSIGN   5905>>IF       6192>>ASSIGN   6331>>ASSIGN   6333>>ASSIGN   6334<<ASSIGN
      6343>>ASSIGN   6357<<ASSIGN   6490>>IF       6497>>ASSIGN   6498>>ASSIGN   6503>>ASSIGN   6505>>IF
      6517>>IF       6519>>ASSIGN   6541>>IF       6547>>ASSIGN   6556>>ASSIGN   6560>>IF       6577>>IF
      6588>>ASSIGN   6588>>ASSIGN   6620>>ASSIGN   6622<<ASSIGN   6627<<ASSIGN   6678<<ASSIGN   6683<<ASSIGN
      6695>>IF       6697>>ASSIGN   6700>>ASSIGN   6744>>IF       6744>>IF       6795>>ASSIGN   6869>>ASSIGN
      7977>>IF       7978>>ASSIGN   7980>>CALLBLT  7980>>CALLBLT  7983>>IF       7984>>ASSIGN   7994>>ASSIGN
      8004<<ASSIGN   8006>>IF       8046<<ASSIGN   8099>>ASSIGN   8102<<ASSIGN   8109<<ASSIGN   8113<<ASSIGN
      8137<<ASSIGN   8148>>ASSIGN
KV$SSN.REDBFR.INSLOWX
      2535**DCL      5245>>IF       5275>>IF       5276<<ASSIGN   5276>>ASSIGN   5340>>ASSIGN   5585>>IF
      5585>>IF       5587<<ASSIGN   5590>>ASSIGN   5607<<ASSIGN   5708<<ASSIGN   5712>>ASSIGN   5733>>ASSIGN
      5772<<ASSIGN   5896>>IF       5900<<ASSIGN   6344>>ASSIGN   6505>>IF
KV$SSN.REDBFR.INSMODX
      2535**DCL      5245>>IF       5249>>IF       5273>>IF       5274<<ASSIGN   5274>>ASSIGN   5322>>DOWHILE
      5326>>DOWHILE  5337<<ASSIGN   5352>>ASSIGN   5366<<ASSIGN   5366>>ASSIGN   5377>>IF       5588<<ASSIGN
      5600>>IF       5600>>IF       5606<<ASSIGN   5610>>ASSIGN   5707<<ASSIGN   5712>>ASSIGN   5774<<ASSIGN
      5896>>IF       5902<<ASSIGN   6233>>IF       6313>>ASSIGN   6546>>ASSIGN   6548>>IF       6661>>IF
      6695>>IF       6703>>DOWHILE  8048<<ASSIGN
KV$SSN.REDBFR.NXTX
      2533**DCL      5237>>IF       5239>>IF       5241>>IF       5264>>ASSIGN   5277<<ASSIGN   5277>>ASSIGN
      5335>>IF       5336<<ASSIGN   5362>>ASSIGN   5367<<ASSIGN   5367>>ASSIGN   5368>>ASSIGN   5588>>ASSIGN
      5600>>IF       5606>>ASSIGN   5609>>IF       5615>>IF       5616>>ASSIGN   5617>>ASSIGN   5707>>ASSIGN
      5773>>IF       5775<<ASSIGN   5896>>IF       5903>>IF       5904<<ASSIGN   5905>>IF       6199>>IF
      6233>>IF       6517>>IF       6518>>ASSIGN   6541>>IF       6547>>ASSIGN   6744>>IF       6744>>IF
      6788>>DOWHILE  6789>>IF       6790>>ASSIGN   6799>>IF       6809>>IF       8006>>IF       8045<<ASSIGN
      8046>>ASSIGN   8047>>ASSIGN   8048>>ASSIGN   8101>>IF       8145>>DOWHILE
KV$SSN.REDBFR__
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:459  
      2558**DCL      6395<<ASSIGN   8158<<ASSIGN
KV$SSN.REDBFR__.ADR$
      2560**DCL      4930>>ASSIGN   5035>>ASSIGN   5536>>ASSIGN   5690>>ASSIGN   5701>>ASSIGN   5862>>ASSIGN
      6576>>ASSIGN   6587>>ASSIGN   8020>>ASSIGN   8028>>ASSIGN   8033>>ASSIGN   8057>>ASSIGN   8064>>ASSIGN
      8077>>ASSIGN   8084>>ASSIGN   8091>>ASSIGN   8098>>ASSIGN   8119>>ASSIGN
KV$SSN.REDBFR__.BFRBYTSIZ
      2561**DCL      6393>>ASSIGN   6581>>IF       6583>>ASSIGN   8029>>IF
KV$SSN.REDBFR__.BFRRLSDSP
      2562**DCL      8154>>IF
KV$SSN.REDBFR__.BYTX
      2560**DCL      5251>>IF       5368>>ASSIGN   5585>>IF       5587>>ASSIGN   5607>>ASSIGN   5708>>ASSIGN
      5896>>IF       6200>>ASSIGN   6490>>IF       6499>>IF       6500>>ASSIGN   6518>>ASSIGN   6519>>ASSIGN
      6577>>IF       6579>>ASSIGN   6586>>ASSIGN   6662>>DOWHILE  8036>>ASSIGN   8040>>ASSIGN   8045>>ASSIGN
      8109>>ASSIGN
KV$SSN.REDBFR__.DATBYTSIZ
      2560**DCL      5234>>IF       5278<<ASSIGN   5278>>ASSIGN   5289>>IF       5368<<ASSIGN   5495>>IF
      6385>>IF       6518<<ASSIGN   6519<<ASSIGN   6565>>IF       6579>>ASSIGN   6586<<ASSIGN   6870>>ASSIGN
      7986>>IF       8044<<ASSIGN   8045>>ASSIGN   8148<<ASSIGN   8163<<ASSIGN
KV$SSN.REDONL
      2530**DCL      7979>>IF
KV$SSN.REDRQSPND
      2532**DCL      4983>>IF       5042>>DOWHILE  5531>>IF       5856>>IF       5976>>IF       7766<<ASSIGN
      7792>>IF
KV$SSN.REDRSPCNT
      2520**DCL      2521--REDEF    5979<<ASSIGN   5979>>ASSIGN
KV$SSN.REDSTRID
      2566**DCL      5684>>IF       5759>>IF       7782<<ASSIGN
KV$SSN.SNCPTR$
      2515**DCL      5537>>ASSIGN   5696>>ASSIGN   7792>>IF       7792>>IF
KV$SSN.SSNCNCID
      2523**DCL      5533>>IF
KV$SSN.SSNID
      2564**DCL      5531>>IF       5662>>ASSIGN   5665>>DOUNTIL
KV$SSN.STR$
      2514**DCL      5667>>ASSIGN
KV$SSN.TYPAHD
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:460  
      2526**DCL      6458<<ASSIGN
KV$SSN.TYPAHD.BFRCHR
      2526**DCL      4917<<ASSIGN   5441<<ASSIGN   5960>>IF
KV$SSN.TYPAHD.BFRINPFNCCHR
      2527**DCL      5442<<ASSIGN
KV$SSN.TYPAHDBFRCNT
      2525**DCL      6443<<ASSIGN   6443>>ASSIGN   7936<<ASSIGN   7936>>ASSIGN   7955<<ASSIGN   7955>>ASSIGN
KV$SSN.TYPAHDBFRHED$
      2516**DCL      6411>>ASSIGN   6452<<ASSIGN   6464>>IF       7801>>IF       7801>>IF       7915>>ASSIGN
      7937>>ASSIGN   7938<<ASSIGN
KV$SSN.TYPAHDBFRINPFNC$
      2516**DCL      6424>>IF       6437>>IF       6445>>IF       6462>>ASSIGN   6463<<ASSIGN
KV$SSN.TYPAHDBFRINPFNCX
      2525**DCL      6424>>IF       6451>>ASSIGN   6464>>IF       6480>>ASSIGN
KV$SSN.TYPAHDBFRINS$
      2517**DCL      6448<<ASSIGN   6479<<ASSIGN   7801>>IF
KV$SSN.TYPCND
      2566**DCL      7767<<ASSIGN
KV$SSN.TYPCND.NOT_TRN
      2567**DCL      6449<<ASSIGN
KV$SSN.VDI$
      2514**DCL      6426>>ASSIGN
KV$SSN.WATINPDLTMRK
      2529**DCL      7781>>IF
KV$STR.ACTCHRTBL$
      2594**DCL      5783>>IF
KV$STR.AUTTABCLM
      2654**DCL      8026>>ASSIGN   8035>>IF       8036>>ASSIGN   8037>>ASSIGN   8133>>IF
KV$STR.EDTBFR__.ADR$
      2618**DCL      8040>>ASSIGN   8120>>IF
KV$STR.EDTBFR__.BYTX
      2618**DCL      8040>>ASSIGN   8127>>ASSIGN   8132>>ASSIGN   8136>>ASSIGN   8150>>ASSIGN
KV$STR.EDTBFR__.DATBYTSIZ
      2618**DCL      8040>>ASSIGN   8120>>IF       8150>>ASSIGN
KV$STR.ID
      2652**DCL      5538>>ASSIGN   5547>>ASSIGN   5571>>IF       5666>>ASSIGN   5671>>ASSIGN   5672>>IF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:461  
      5683>>IF       5759>>IF
KV$STR.LNK$
      2592**DCL      5680>>ASSIGN
KV$STR.MAXRCRBYTSIZ
      2649**DCL      5612>>IF       6560>>IF       6565>>IF       6579>>ASSIGN
KV$STR.MVD$
      2592**DCL      5669>>IF       5669>>IF
KV$STR.RE_REDCLM
      2622**DCL      8135<<ASSIGN
KV$STR.SNDMAXNMBRCR
      2650**DCL      5941>>IF       5982<<ASSIGN   5982>>ASSIGN   6069>>IF       7786>>IF       7792>>IF
      7792>>IF
KV$STR.WRDWRP
      2655**DCL      5004<<ASSIGN   8120>>IF
KV$STR.WRDWRPCLM
      2654**DCL      8120>>IF       8120>>IF       8127>>ASSIGN   8133>>IF       8134>>ASSIGN   8144>>IF
KV$STR.WRDWRPSIZ
      2654**DCL      8026>>ASSIGN   8039>>ASSIGN   8043<<ASSIGN   8150<<ASSIGN   8153>>IF
KV$TYPAHDBFR
      2676**DCL      2679--REDEF    6446--ASSIGN   6447--ASSIGN   7801--IF
KV$TYPAHDBFR.CHRX
      2676**DCL      6412>>IF       6424>>IF       6446<<ASSIGN   6451<<ASSIGN   6464>>IF
KV$TYPAHDBFR.CHRX_HI
      2677**DCL      6412>>IF       6447<<ASSIGN   6480<<ASSIGN   7801>>IF       7948>>IF       7964<<ASSIGN
      7964>>ASSIGN   7965>>ASSIGN
KV$TYPAHDBFR.INPFNCTXT
      2676**DCL      7920>>IF       7924>>IF       7939<<ASSIGN   7959<<ASSIGN
KV$TYPAHDBFR.LNK$
      2676**DCL      6433>>DOWHILE  6441>>ASSIGN   7923>>IF       7924>>IF       7925>>ASSIGN   7937<<ASSIGN
      7956<<ASSIGN   7956>>ASSIGN   7957<<ASSIGN
KV$TYPAHDBFR_CHR
      2679**DCL      7965<<ASSIGN
KV$VDI.ASNINPPTR$
      2705**DCL      5696<<ASSIGN
KV$VDI.CRSRED
      2737**DCL      5531>>IF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:462  
KV$VDI.EDTWND$
      2733**DCL      5636>>IF       5637>>CALL     5717>>ASSIGN   5729<<ASSIGN
KV$VDI.FULLDUPLEXPAPERTAPE
      2739**DCL      5495>>IF       7785>>IF
KV$VDI.HALFDUPLEXPAPERTAPE
      2740**DCL      5495>>IF       5510>>IF       5868>>IF       6151>>IF       6523>>IF       6873>>IF
      7785>>IF       7989>>IF
KV$VDI.INPUNT
      2745**DCL      5009>>IF       5056>>IF       5075>>IF       5116>>IF       5162>>IF       5510>>IF
      5550>>IF       5563>>IF       5663>>IF       6618>>IF       6628>>IF       6882>>IF       7744>>IF
      7747>>IF       7996>>IF
KV$VDI.OTPCNDPND.PST
      2741**DCL      5700<<ASSIGN   6118<<ASSIGN   6144<<ASSIGN
KV$VDI.PHSDSC
      2739**DCL      5115>>IF
KV$VDI.PRG
      2737**DCL      5086<<ASSIGN   5114>>IF
KV$VDI.PRG.OTP
      2737**DCL      5128>>IF       5154>>IF
KV$VDI.PRG.RED
      2737**DCL      5124>>IF       5150>>IF       6388<<ASSIGN
KV$VDI.PRG.TYPAHD
      2737**DCL      6426<<ASSIGN
KV$VDI.RE_DSPINP
      2739**DCL      5062>>IF       5281>>IF       5357>>IF       5371>>IF       5642>>IF       5866>>IF
      6521>>IF       6572>>IF       6610>>IF       6613<<ASSIGN   6630<<ASSIGN   6871>>IF       6884<<ASSIGN
      7982>>IF       7988>>IF       8005>>IF       8112<<ASSIGN   8138>>IF       8141<<ASSIGN
KV$VDI.RE_DSPLOWX
      2735**DCL      5313>>IF       5314<<ASSIGN   5385>>IF       5386<<ASSIGN   6403<<ASSIGN   6621>>IF
      6622>>ASSIGN   6629<<ASSIGN   6885<<ASSIGN   6928>>IF       6929<<ASSIGN   7983>>IF       7984<<ASSIGN
      8138>>IF       8140<<ASSIGN
KV$VDI.SSN$
      2704**DCL      5529>>ASSIGN   5694>>ASSIGN   7790>>ASSIGN
KV$VDI.SSNCNT
      2733**DCL      5526>>IF       7786>>IF       7791>>IF
KV$VDI.USREVTENB
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:463  
      2747**DCL      7783>>IF
KV$VDI.USRRQSDAT
      2745**DCL      5162>>IF
KV$VDI.USRRQSDAT.RED
      2745**DCL      4912>>IF       4919>>IF       5009>>IF       5056>>IF       5075>>IF       5150>>IF
      5154>>IF       5182>>ASSIGN   5510>>IF       5550>>IF       5563>>IF       5941>>IF       6065>>IF
      6459>>IF       6614>>IF       7765<<ASSIGN
KV$VDI.USRRQSDAT.TYPAHD
      2746**DCL      6109<<ASSIGN
KV@USR_INPPRC
      4054**DCL      5177<<ASSIGN
KV@USR_INPPRC.CHR
      4060**DCL      5180<<ASSIGN
KV@USR_INPPRC.ID
      4060**DCL      5178<<ASSIGN
KV@USR_INPPRC.IMD
      4060**DCL      5181<<ASSIGN
KV@USR_INPPRC.ORGCHR
      4061**DCL      5179<<ASSIGN
KV@USR_INPPRC.RED
      4060**DCL      5182<<ASSIGN
KV@USR_PST
      4091**DCL      6767<<ASSIGN   6774<>CALL     6811<>CALL
KV@USR_PST.PHSPST
      4124**DCL      4129--REDEF    6770<<ASSIGN
KV@USR_PST.PHSPST.CLM
      4126**DCL      6776>>ASSIGN   6787<<ASSIGN
KV@USR_PST.PHSPST.LIN
      4126**DCL      6804<<ASSIGN   6808<<ASSIGN   6808>>ASSIGN
KV@USR_PST.PHSPSTMOD
      4132**DCL      6768<<ASSIGN
KV@USR_PST.SCRCNT
      4132**DCL      6769<<ASSIGN
KV@USR_SETATR
      4162**DCL      6093<<ASSIGN
KV@USR_SETATR.GRPRND
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:464  
      4251**DCL      6095<<ASSIGN   6105<<ASSIGN
KV@USR_SETATR.GRPRND.HDN
      4253**DCL      6100<<ASSIGN
KV@USR_SETATR.PHSPST
      4195**DCL      4200--REDEF    6094<<ASSIGN   6108>>ASSIGN
KV@USR_SETATR.PHSPST.CLM
      4197**DCL      6107<<ASSIGN
KV@USR_SETATR.PHSPST.LIN
      4197**DCL      6136>>IF
KV@USR_SETATR.QLF.ACPALL
      4226**DCL      6096<<ASSIGN
KV@USR_SETATR.QLF.PRT
      4227**DCL      6106<<ASSIGN
KV@VDH_DAT
      4293**DCL      4938<<ASSIGN
KV@VDH_DAT.CMPCOD
      4333**DCL      4939<<ASSIGN   4941>>IF
KV@VDH_DSC
      4368**DCL      5399<<ASSIGN
KV@VDH_DSC.ALLSSN
      4374**DCL      5401<<ASSIGN
KV@VDH_DSC.NO_IO
      4374**DCL      5400<<ASSIGN
KV@VDH_DSC.RSN
      4374**DCL      5402<<ASSIGN
KV@VDH_GETBFR
      4405**DCL      5715<<ASSIGN   7931<<ASSIGN   7951<<ASSIGN
KV@VDH_GETBFR.BFR$
      4411**DCL      5717<<ASSIGN   5718>>IF       5719>>ASSIGN   5722<<ASSIGN   5725>>IF       5729>>ASSIGN
      5730>>IF       5731>>ASSIGN   5732>>ASSIGN   5733>>ASSIGN   7935>>ASSIGN   7956>>ASSIGN   7957>>ASSIGN
      7958>>ASSIGN
KV@VDH_GETBFR.BYTSIZ
      4411**DCL      5719<<ASSIGN   5720>>IF       5726<<ASSIGN   5731>>ASSIGN
KV@VDH_GETBFR.STRTYP
      4411**DCL      5716<<ASSIGN   7932<<ASSIGN   7952<<ASSIGN
KV@VDH_GETPRM
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:465  
      4471**DCL      4970<<ASSIGN
KV@VDH_GETPRM.MAXBYTSIZ
      4504**DCL      4504--REDEF
KV@VDH_GETPRM.PRMID
      4477**DCL      4971<<ASSIGN   4972>>IF       4975<<ASSIGN   4978>>IF       4979>>IF       4979>>IF
      4979>>IF
KV@VDH_GETPRM.VAL
      4477**DCL      4990<<ASSIGN   4991>>ASSIGN
KV@VDH_OTPLCL
      4543**DCL      5069<<ASSIGN   6764<<ASSIGN   6793<>CALL     6867<<ASSIGN   7992<<ASSIGN
KV@VDH_OTPLCL.BFR_.ADR$
      4576**DCL      5070<<ASSIGN   6765<<ASSIGN   6872<<ASSIGN   7993<<ASSIGN
KV@VDH_OTPLCL.BFR_.BYTSIZ
      4576**DCL      5071<<ASSIGN   6779<<ASSIGN   6784<<ASSIGN   6789>>IF       6790<<ASSIGN   6806>>ASSIGN
      6870<<ASSIGN   6877>>IF       6878<<ASSIGN   6885>>ASSIGN   6902<<ASSIGN   6902>>ASSIGN   7995<<ASSIGN
KV@VDH_OTPLCL.BFR_.BYTX
      4576**DCL      6778<<ASSIGN   6782<<ASSIGN   6788>>DOWHILE  6789>>IF       6790>>ASSIGN   6791>>IF
      6795<<ASSIGN   6798<<ASSIGN   6798>>ASSIGN   6799>>IF       6809>>IF       6868<<ASSIGN   6869<<ASSIGN
      6877>>IF       6878>>ASSIGN   6899<<ASSIGN   6902>>ASSIGN   6928>>IF       6929>>ASSIGN   7994<<ASSIGN
KV@VDH_OTPLCL.HDN
      4549**DCL      6883<<ASSIGN   7999<<ASSIGN
KV@VDH_OTPLCL.NONVRT
      4549**DCL      5073<<ASSIGN
KV@VDH_OTPLCL.NO_WRAP
      4550**DCL      6766<<ASSIGN   6875<<ASSIGN   8000<<ASSIGN
KV@VDH_OTPLCL.TRN
      4549**DCL      5072<<ASSIGN
KV@VDH_PST
      4608**DCL      5791<<ASSIGN
KV@VDH_PST.PSTVAL
      4646**DCL      4651--REDEF
KV@VDH_PST.PSTVAL.CLM
      4648**DCL      5792<<ASSIGN
KV@VDH_RLSBFR
      4683**DCL      6390<<ASSIGN   6438<<ASSIGN
KV@VDH_RLSBFR.BFR$
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:466  
      4689**DCL      6392<<ASSIGN   6440<<ASSIGN
KV@VDH_RLSBFR.BYTSIZ
      4689**DCL      6393<<ASSIGN
KV@VDH_RLSBFR.STRTYP
      4689**DCL      6391<<ASSIGN   6439<<ASSIGN
KV@VDH_SETPRM.PRMID
      4726**DCL      4983>>IF       4985>>ASSIGN   4996>>IF       4996>>IF       4996>>IF       4996>>IF
      5003>>IF       5008>>IF
KV@VDH_SETPRM.SCP
      4753**DCL      5006<<ASSIGN
KV@VDH_SETPRM.VAL
      4726**DCL      4990>>IF       4991<<ASSIGN   5000<<ASSIGN   5001<<ASSIGN   5002<<ASSIGN   6178>>CALL
KVC$DRWBRD
      2758**DCL-ENT  5675--CALL
KVC$DSC
      2759**DCL-ENT  5403--CALL
KVE$DSPALL
      2760**DCL-ENT  5677--CALL
KVE$INPOPR
      2761**DCL-ENT  5253--CALL     5918--CALL     6368--CALL     6512--CALL     6564--CALL
KVE$RE_DSPSE
      2762**DCL-ENT  6609--CALL
KVE$SCRALL
      2763**DCL-ENT  5166--CALL     6847--CALL
KVF$PST
      2764**DCL-ENT  5793--CALL     6562--CALL
KVF$RE_TYPFRM
      2765**DCL-ENT  5676--CALL
KVI$ACTRED
      2766**DCL-ENT  4940--CALL
KVI$ADJINPFLDBGNATR
      2767**DCL-ENT  5011--CALL
KVI$BFRREDCHR
      2768**DCL-ENT  5044--CALL     5505--CALL     5787--CALL     5861--CALL     6574--CALL
KVI$CPYSSNEDTBFRTO_REDBFR
      2769**DCL-ENT  5224--CALL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:467  
KVI$CPYSTREDTBFRTO_REDBFR
      2770**DCL-ENT  5229--CALL
KVI$ENBRED
      2771**DCL-ENT  5158--CALL     5689--CALL     5760--CALL
KVI$INCINPFLDSIZ
      2772**DCL-ENT  5485--CALL
KVI$INPCHR_INPFNC
      2773**DCL-ENT  5033--CALL
KVI$INPCHR_INPFNCIMD
      2774**DCL-ENT  5032--CALL
KVI$INTINPOPRX
      2775**DCL-ENT  5898--CALL     6506--CALL     6553--CALL
KVI$OTPPRTID
      2776**DCL-ENT  5562--CALL
KVI$RSTINPFLDBGNATR
      2777**DCL-ENT  7754--CALL
KVI$RSTINPFLDENDATR
      2778**DCL-ENT  7761--CALL
KVI_INPFNC
      3991**DCL      5930<>CALL
KVI_NEWLIN
      5501**LABEL    5217--GOTO
KVM$SND
      2780**DCL-ENT  5091--CALL     5211--CALL     5519--CALL     5560--CALL     5975--CALL     7804--CALL
KVO$ERSMRD
      2781**DCL-ENT  5664--CALL
KVO$ERSSRD
      2782**DCL-ENT  5749--CALL
KVO$ERSTO_ENDOF_INP
      2783**DCL-ENT  6133--CALL     6912--CALL     6920--CALL     8106--CALL
KVO$OTP1_NONVRT
      2789**DCL-ENT  5125--CALL     5127--CALL     5295--CALL     5300--CALL     5310--CALL     6162--CALL
      6165--CALL     6166--CALL     6171--CALL     6172--CALL     6174--CALL     6178--CALL     6179--CALL
KVO$OTP1_VRT
      2790**DCL-ENT  5885--CALL     5912--CALL     7760--CALL     7798--CALL
KVO$OTPLCL
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:468  
      2784**DCL-ENT  5074--CALL     5559--CALL     6089--CALL     6793--CALL     6913--CALL     6919--CALL
      8001--CALL
KVO$PAGBRK
      2785**DCL-ENT  5577--CALL     5744--CALL
KVO$PST
      2786**DCL-ENT  4945--CALL     4964--CALL     5079--CALL     5147--CALL     5294--CALL     5309--CALL
      5359--CALL     5382--CALL     5490--CALL     5513--CALL     5569--CALL     5604--CALL     5743--CALL
      5875--CALL     5882--CALL     5911--CALL     6511--CALL     6530--CALL     6645--CALL     6755--CALL
      6803--CALL     6814--CALL     6849--CALL     6901--CALL     6925--CALL     8105--CALL     8153--CALL
KVO$PSTAFTHI_NONBLNPHSPST
      2787**DCL-ENT  5061--CALL     5555--CALL     6088--CALL
KVO$SCRENDNO_HLT
      2788**DCL-ENT  5135--CALL     5688--CALL
KVP$GETPRM
      2791**DCL-ENT  4989--CALL
KVP$SETPRM
      2792**DCL-ENT  5007--CALL
KVS$CHNSSN
      2793**DCL-ENT  5697--CALL
KVS$GETBFR
      2794**DCL-ENT  5727--CALL     7933--CALL     7953--CALL
KVS$GETREDBFR
      2795**DCL-ENT  6582--CALL     8030--CALL
KVS$RLSBFR
      2796**DCL-ENT  5721--CALL     6394--CALL     6442--CALL
KVS$SETSTR
      2797**DCL-ENT  5542--CALL     5549--CALL     5571--CALL     5672--CALL     5683--CALL
KVV$CALUSR
      2800**DCL-ENT  5183--CALL     6101--CALL     6110--CALL     6774--CALL     6811--CALL
KVV$CALUSR_EVT
      2798**DCL-ENT  5093--CALL     6125--CALL     7784--CALL
KVV$CALUSR_PST
      2799**DCL-ENT  6119--CALL
KV_CLK_CANCEL IN PROCEDURE Y$TRMRED
      7597**DCL      7773>>ASSIGN
KV_CLK_CANCEL.UID IN PROCEDURE Y$TRMRED
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:469  
      7613**DCL      7614--REDEF    7615--REDEF
KV_GRPCHR
      3724**DCL      7757>>IF
KV_GRPCHR_WRD
      3723**DCL      3724--REDEF
KV_INPFNC_PRMIDS
      3479**DCL      4975>>ASSIGN
KV_PRMACK_TXT
      3707**DCL      3708--REDEF
KV_PRMACK_TXTU
      3708**DCL      6164>>ASSIGN
KV_SND_EVT_BRK
      3462**DCL      5211<>CALL
KV_SND_EVT_MNTATN
      3463**DCL      5519<>CALL
KV_SND_RQSDAT_GNR IN PROCEDURE Y$TRMRED
      7732**DCL      7804<>CALL
KV_SND_RQSMRK_DLTRCVDAT
      3464**DCL      5091<>CALL
KV_SND_RQSMRK_DLTRCVRQS
      3465**DCL      5975<>CALL
KV_SND_RQSSTT
      3466**DCL      5560<>CALL
KV_USR_INPPRC
      2831**DCL      5177>>ASSIGN
KV_USR_PST
      2867**DCL      6767>>ASSIGN
KV_USR_PST.PHSPST
      2900**DCL      2905--REDEF
KV_USR_SETATR
      2937**DCL      6093>>ASSIGN
KV_USR_SETATR.PHSPST
      2970**DCL      2975--REDEF
KV_VDH_DAT_NRM_NO_ACTCHR
      3066**DCL      4938>>ASSIGN
KV_VDH_DSC
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:470  
      3140**DCL      5399>>ASSIGN
KV_VDH_GETBFR
      3176**DCL      5715>>ASSIGN   7931>>ASSIGN   7951>>ASSIGN
KV_VDH_GETPRM
      3241**DCL      4970>>ASSIGN
KV_VDH_GETPRM.MAXBYTSIZ
      3274**DCL      3274--REDEF
KV_VDH_OTPLCL
      3312**DCL      6764>>ASSIGN   6867>>ASSIGN   7992>>ASSIGN
KV_VDH_PST_0_VRT
      3467**DCL      5294<>CALL     5309<>CALL     6530<>CALL     6755<>CALL     6803<>CALL     6814<>CALL
      6849<>CALL     6901<>CALL     6925<>CALL     8105<>CALL
KV_VDH_PST_BS_FRM
      3468**DCL      6511<>CALL
KV_VDH_PST_CR_VRT
      3469**DCL      5743<>CALL
KV_VDH_PST_LF
      3470**DCL      5490<>CALL
KV_VDH_PST_NEWLIN_VRT
      3471**DCL      4945<>CALL     5147<>CALL     5513<>CALL     8153<>CALL
KV_VDH_PST_SPCFRM
      3376**DCL      5791>>ASSIGN   6562<>CALL
KV_VDH_PST_SPCFRM.PSTVAL
      3414**DCL      3419--REDEF
KV_VDH_PST_VRT
      3472**DCL      5079<>CALL     5359<>CALL     5382<>CALL     5569<>CALL     5604<>CALL     5875<>CALL
      5882<>CALL     6645<>CALL
KV_VDH_PST_WHTSPC
      3473**DCL      5911<>CALL
KV_VDH_RLSBFR
      3450**DCL      6390>>ASSIGN   6438>>ASSIGN
OLDCLM IN PROCEDURE Y$SHFDSPPST
      6739**DCL      6741<<ASSIGN   6752<<ASSIGN   6752>>ASSIGN   6813>>ASSIGN   6818<<ASSIGN   6819<<ASSIGN
      6820<<ASSIGN   6820>>ASSIGN   6827<<ASSIGN   6834>>IF       6835<<ASSIGN   6836<<ASSIGN   6839>>ASSIGN
      6842<<ASSIGN   6858<<ASSIGN   6865<<ASSIGN   6868>>IF       6876>>IF       6887>>IF       6888>>ASSIGN
      6889<<ASSIGN   6893<>CALL     6894>>IF       6894>>IF       6897>>ASSIGN   6922>>IF       6923>>ASSIGN
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:471  
OPRCNT
      4886**DCL      4887--REDEF    4899<<ASSIGN   4975>>ASSIGN   4976<<ASSIGN   4995>>IF       4995<<ASSIGN
      5000>>IF       5000>>ASSIGN   5242<<ASSIGN   5531>>IF       5531>>IF       5792>>IF       5792>>ASSIGN
      5803>>IF       5804>>IF       5813>>IF       5813>>ASSIGN   5821>>IF       5843>>IF       5847>>IF
      5849<<ASSIGN   5850>>IF       5851>>IF       5852<<ASSIGN   5852>>ASSIGN   5958<<ASSIGN   6496>>IF
      6498>>ASSIGN   6501<<ASSIGN   6503<<ASSIGN   6503>>ASSIGN   6507>>IF       6545>>IF       6547>>ASSIGN
      6554>>IF       6556<<ASSIGN   6556>>ASSIGN   6557<<ASSIGN   6557>>ASSIGN   6563>>IF       6575<<ASSIGN
      6575>>ASSIGN   6577<<ASSIGN   6579>>ASSIGN   6591<<ASSIGN   6594>>IF
OPRCNTU
      4887**DCL      4973>>IF
PSTLFT
      5617**LABEL    5243--GOTO
R IN PROCEDURE Y$EDTX_TO_VRTCLM
      6190**DCL      6200<<ASSIGN   6201>>DOWHILE  6202>>IF       6202>>IF       6205>>IF       6206>>IF
      6210<<ASSIGN   6210>>ASSIGN   6211>>IF       6215>>DOWHILE  6216>>IF       6216>>IF       6218>>IF
      6219>>IF       6223<<ASSIGN   6223>>ASSIGN
R IN PROCEDURE Y$SCPVRTCLMHI_X
      6653**DCL      6657<<ASSIGN   6661>>IF       6662>>DOWHILE  6663<<ASSIGN   6663>>ASSIGN   6666>>IF
      6669>>IF       6669>>IF       6678>>ASSIGN   6683>>ASSIGN
R IN PROCEDURE Y$SCPVRTCLMLOWX
      6691**DCL      6700<<ASSIGN   6702>>IF       6702<<ASSIGN   6702>>ASSIGN   6703>>DOWHILE  6708>>IF
      6711>>IF       6716>>IF       6716>>IF       6720<<ASSIGN   6720>>ASSIGN   6722>>ASSIGN
R2
      4881**DCL      5264<<ASSIGN   5265>>IF       5268>>CALLBLT  5268>>CALLBLT  5272<<ASSIGN   5274>>ASSIGN
      5276>>ASSIGN   5277>>ASSIGN   5278>>ASSIGN   5282<<ASSIGN   5293>>IF       5305>>IF       5320<<ASSIGN
      5321>>ASSIGN   5340<<ASSIGN   5341>>ASSIGN   5351<<ASSIGN   5354>>IF       5364>>ASSIGN   5365>>ASSIGN
      5671<<ASSIGN   5672>>IF       5672<>CALL     5799<>CALL     5800>>ASSIGN   5802<<ASSIGN   5802>>ASSIGN
      5803<<ASSIGN   5803>>ASSIGN   5809<<ASSIGN   5809>>ASSIGN   5813<<ASSIGN   5818>>IF       5821<<ASSIGN
      5822<<ASSIGN   5835>>IF       5838<<ASSIGN   5843>>IF       5843<<ASSIGN   5846<<ASSIGN   5846>>ASSIGN
      5849>>ASSIGN   5864<<ASSIGN   5864>>ASSIGN   5876>>ASSIGN   5880>>IF       5886>>ASSIGN   6279<<CALLBLT
      6285>>ASSIGN   6311<<ASSIGN   6312<<ASSIGN   6312>>ASSIGN   6317>>DOWHILE  6318>>IF       6319<<ASSIGN
      6319>>ASSIGN   6322>>DOWHILE  6322>>DOWHILE  6323<<ASSIGN   6323>>ASSIGN   6325>>IF       6329<<ASSIGN
      6329>>ASSIGN   6330>>ASSIGN   6331<<ASSIGN   6334>>ASSIGN   6343<<ASSIGN   6345>>DOWHILE  6346>>IF
      6347<<ASSIGN   6347>>ASSIGN   6349>>DOWHILE  6350<<ASSIGN   6350>>ASSIGN   6351>>IF       6351>>IF
      6355>>IF       6355<<ASSIGN   6355>>ASSIGN   6356<<ASSIGN   6356>>ASSIGN   6357>>ASSIGN   6620<<ASSIGN
      6621>>IF       6627>>ASSIGN   8037<<ASSIGN   8038>>IF       8038<<ASSIGN   8038>>ASSIGN   8040>>ASSIGN
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:472  
      8044>>ASSIGN   8050<>CALL     8099<<ASSIGN   8113>>ASSIGN   8136<<ASSIGN   8137>>ASSIGN   8138>>IF
      8140>>ASSIGN   8145>>DOWHILE  8145>>DOWHILE  8146<<ASSIGN   8146>>ASSIGN   8150>>ASSIGN
R3
      4882**DCL      5321<<ASSIGN   5322>>DOWHILE  5323>>IF       5324<<ASSIGN   5324>>ASSIGN   5326>>DOWHILE
      5327>>IF       5328<<ASSIGN   5328>>ASSIGN   5339<<ASSIGN   5352<<ASSIGN   5354>>IF       5362>>ASSIGN
      5364>>ASSIGN   5365>>ASSIGN   5449<<ASSIGN   5450>>IF       5450>>IF       5457<<ASSIGN   5457>>ASSIGN
      5458>>IF       5458>>IF       5476<<ASSIGN   5476>>ASSIGN   5662<<ASSIGN   5665>>DOUNTIL  6270>>ASSIGN
R5
      4883**DCL      5021<<ASSIGN   5029>>DOWHILE  5030>>ASSIGN   5036<<ASSIGN   5036>>ASSIGN   5042>>DOWHILE
      5043>>ASSIGN   5045<<ASSIGN   5045>>ASSIGN   5362<<ASSIGN   5363>>IF       5364>>ASSIGN   5364>>ASSIGN
      5365<<ASSIGN   5366>>ASSIGN   5367>>ASSIGN   5383<>CALL     5635<<ASSIGN   5712<<ASSIGN   5713<<ASSIGN
      5714>>IF       5714<<ASSIGN   5720>>IF       5720>>IF       5725>>IF       5726>>ASSIGN   5732>>ASSIGN
      5733>>ASSIGN   5733>>ASSIGN   5811<<ASSIGN   5815>>IF       5829>>DOWHILE  5830>>IF       5830>>IF
      5835>>IF       5838>>ASSIGN   5841<<ASSIGN   5841>>ASSIGN   5843>>ASSIGN   6164<<ASSIGN   6165<>CALL
      6166>>CALL     6195<<ASSIGN   6197<<ASSIGN   6197>>ASSIGN   6203<<ASSIGN   6203>>ASSIGN   6205<<ASSIGN
      6206<<ASSIGN   6206>>ASSIGN   6207>>IF       6207<<ASSIGN   6207>>ASSIGN   6211>>ASSIGN   6214>>ASSIGN
      6217<<ASSIGN   6217>>ASSIGN   6218<<ASSIGN   6220<<ASSIGN   6220>>ASSIGN   6221>>IF       6221<<ASSIGN
      6221>>ASSIGN   6225>>ASSIGN   6226<<ASSIGN   6230<<ASSIGN   6230>>ASSIGN   6234<<ASSIGN   6234>>ASSIGN
      6237>>ASSIGN   6313<<ASSIGN   6317>>DOWHILE  6322>>DOWHILE  6325>>IF       6344<<ASSIGN   6345>>DOWHILE
      6349>>DOWHILE  6351>>IF       6546<<ASSIGN   6547<<ASSIGN   6548>>IF       6555>>ASSIGN   6556>>ASSIGN
      6579<<ASSIGN   6581>>IF       6582<>CALL     6583<<ASSIGN   6585>>ASSIGN   6586>>ASSIGN   6588>>ASSIGN
      6623<>CALL     6625<<ASSIGN   6626<>CALL     7944>>DOWHILE  7965>>ASSIGN   7968<<ASSIGN   7968>>ASSIGN
      7978<<ASSIGN   7980>>CALLBLT  7980>>CALLBLT  7995>>ASSIGN   8026<<ASSIGN   8029>>IF       8030<>CALL
      8039<<ASSIGN   8040>>IF       8040>>ASSIGN   8040>>ASSIGN   8040>>ASSIGN   8044>>ASSIGN   8127<<ASSIGN
      8128>>DOUNTIL  8129>>IF       8130<<ASSIGN   8130>>ASSIGN   8132<<ASSIGN   8132>>ASSIGN   8133>>IF
      8133>>IF       8134<<ASSIGN   8135>>ASSIGN   8136>>ASSIGN   8144>>IF       8144<<ASSIGN   8144>>ASSIGN
      8149>>ASSIGN
REDBFR$
      4878**DCL      2175--IMP-PTR  2177--IMP-PTR  2178--IMP-PTR  2179--IMP-PTR  2180--IMP-PTR  4930<<ASSIGN
      5035<<ASSIGN   5234>>IF       5268>>CALLBLT  5268>>CALLBLT  5323>>IF       5327>>IF       5364>>ASSIGN
      5364>>ASSIGN   5495>>IF       5536<<ASSIGN   5582>>IF       5597>>IF       5690<<ASSIGN   5701<<ASSIGN
      5709>>IF       5713>>IF       5733>>ASSIGN   5862<<ASSIGN   6202>>IF       6202>>IF       6205>>IF
      6206>>IF       6216>>IF       6216>>IF       6218>>IF       6219>>IF       6304>>IF       6318>>IF
      6322>>DOWHILE  6346>>IF       6351>>IF       6355>>IF       6382>>IF       6392>>ASSIGN   6400<<ASSIGN
      6490>>IF       6541>>IF       6576<<ASSIGN   6587<<ASSIGN   6588>>ASSIGN   6621>>IF       6666>>IF
      6669>>IF       6669>>IF       6702>>IF       6708>>IF       6711>>IF       6716>>IF       6716>>IF
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:473  
      6765>>ASSIGN   6872>>ASSIGN   7980>>CALLBLT  7980>>CALLBLT  7993>>ASSIGN   8020<<ASSIGN   8028<<ASSIGN
      8029>>IF       8033<<ASSIGN   8036>>ASSIGN   8040>>ASSIGN   8057<<ASSIGN   8064<<ASSIGN   8077<<ASSIGN
      8084<<ASSIGN   8091<<ASSIGN   8098<<ASSIGN   8119<<ASSIGN   8120>>IF       8129>>IF       8145>>DOWHILE
RE_DSP_FRM
      5642**LABEL    5195--GOTO
SAVEBIT
      4889**DCL      5503<<ASSIGN   5514>>ASSIGN   5651<<ASSIGN   5655<<ASSIGN   5659<<ASSIGN   5663<<ASSIGN
      5664>>IF       5665>>IF       5684>>IF       5699>>IF       5781<<ASSIGN   5848>>ASSIGN   5855>>ASSIGN
      5890>>ASSIGN   6158<<ASSIGN   6180>>ASSIGN
SCREND
      5743**LABEL    5576--GOTO
SCROLIT IN PROCEDURE Y$SHFDSPPST
      6760**LABEL    6756--GOTO
SETINSHI_X
      5900**LABEL    5379--GOTO     5767--GOTO
SHF IN PROCEDURE Y$SHFDSPPST
      6738**DCL      6743<<ASSIGN   6744>>IF       6744>>IF       6744>>IF       6744>>IF       6752>>IF
      6752>>ASSIGN   6760>>IF       6760>>IF       6769>>ASSIGN   6777>>IF       6779>>ASSIGN   6781>>ASSIGN
      6784>>ASSIGN   6795>>ASSIGN   6796>>ASSIGN   6799>>IF       6802>>IF       6809>>IF       6809>>IF
      6825<<ASSIGN   6828>>IF       6829>>IF       6830<<ASSIGN   6830>>ASSIGN   6831>>IF       6831<<ASSIGN
      6831>>ASSIGN   6832<<ASSIGN   6832>>ASSIGN   6833>>IF       6835>>ASSIGN   6836>>ASSIGN   6839<<ASSIGN
      6840>>IF       6841<<ASSIGN   6842>>ASSIGN   6844>>ASSIGN   6845>>ASSIGN
SHFCNT IN PROCEDURE Y$SHFDSPPST
      6737**DCL      6726--PROC     6742--IF       6742>>IF       6743>>ASSIGN   6791--IF       6791>>IF
      6817--ENTRY    6852--ENTRY    6861--ENTRY    6865>>ASSIGN
SSN$
      4879**DCL      2514--IMP-PTR  4898<<ASSIGN   4917>>ASSIGN   4930>>ASSIGN   4983>>IF       4985>>ASSIGN
      5001>>ASSIGN   5022>>ASSIGN   5030>>ASSIGN   5034<<ASSIGN   5035>>ASSIGN   5042>>DOWHILE  5043>>ASSIGN
      5163>>IF       5164>>ASSIGN   5216>>ASSIGN   5234>>IF       5237>>IF       5237>>IF       5239>>IF
      5239>>IF       5241>>IF       5241>>IF       5245>>IF       5245>>IF       5249>>IF       5249>>IF
      5251>>IF       5251>>IF       5259>>ASSIGN   5259>>ASSIGN   5264>>ASSIGN   5264>>ASSIGN   5268>>CALLBLT
      5268>>CALLBLT  5272>>ASSIGN   5272>>ASSIGN   5273>>IF       5273>>IF       5274>>ASSIGN   5274>>ASSIGN
      5275>>IF       5275>>IF       5276>>ASSIGN   5276>>ASSIGN   5277>>ASSIGN   5277>>ASSIGN   5278>>ASSIGN
      5278>>ASSIGN   5289>>IF       5313>>IF       5314>>ASSIGN   5320>>ASSIGN   5322>>DOWHILE  5326>>DOWHILE
      5335>>IF       5335>>IF       5336>>ASSIGN   5336>>ASSIGN   5337>>ASSIGN   5337>>ASSIGN   5339>>ASSIGN
      5340>>ASSIGN   5341>>ASSIGN   5351>>ASSIGN   5352>>ASSIGN   5362>>ASSIGN   5366>>ASSIGN   5366>>ASSIGN
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:474  
      5367>>ASSIGN   5367>>ASSIGN   5368>>ASSIGN   5368>>ASSIGN   5368>>ASSIGN   5377>>IF       5377>>IF
      5385>>IF       5386>>ASSIGN   5441>>ASSIGN   5442>>ASSIGN   5495>>IF       5501>>ASSIGN   5503>>ASSIGN
      5504>>ASSIGN   5514>>ASSIGN   5527>>IF       5528<<ASSIGN   5528>>ASSIGN   5529<<ASSIGN   5530>>IF
      5531>>IF       5531>>IF       5533>>IF       5535>>IF       5536>>ASSIGN   5537>>ASSIGN   5585>>IF
      5585>>IF       5585>>IF       5585>>IF       5587>>ASSIGN   5587>>ASSIGN   5588>>ASSIGN   5588>>ASSIGN
      5590>>ASSIGN   5590>>ASSIGN   5600>>IF       5600>>IF       5600>>IF       5600>>IF       5606>>ASSIGN
      5606>>ASSIGN   5607>>ASSIGN   5607>>ASSIGN   5609>>IF       5609>>IF       5610>>ASSIGN   5610>>ASSIGN
      5612>>IF       5615>>IF       5615>>IF       5616>>ASSIGN   5616>>ASSIGN   5617>>ASSIGN   5617>>ASSIGN
      5662>>ASSIGN   5665>>DOUNTIL  5667>>ASSIGN   5684>>IF       5690>>ASSIGN   5693>>IF       5694<<ASSIGN
      5695<<ASSIGN   5695>>ASSIGN   5696>>ASSIGN   5701>>ASSIGN   5707>>ASSIGN   5707>>ASSIGN   5708>>ASSIGN
      5708>>ASSIGN   5712>>ASSIGN   5712>>ASSIGN   5733>>ASSIGN   5759>>IF       5772>>ASSIGN   5772>>ASSIGN
      5773>>IF       5773>>IF       5774>>ASSIGN   5774>>ASSIGN   5775>>ASSIGN   5775>>ASSIGN   5781>>ASSIGN
      5782>>ASSIGN   5786>>ASSIGN   5848>>ASSIGN   5855>>ASSIGN   5856>>IF       5860>>ASSIGN   5862>>ASSIGN
      5890>>ASSIGN   5896>>IF       5896>>IF       5896>>IF       5896>>IF       5900>>ASSIGN   5900>>ASSIGN
      5902>>ASSIGN   5902>>ASSIGN   5903>>IF       5903>>IF       5904>>ASSIGN   5904>>ASSIGN   5905>>IF
      5905>>IF       5934>>ASSIGN   5946>>ASSIGN   5960>>IF       5976>>IF       5979>>ASSIGN   5979>>ASSIGN
      6072>>ASSIGN   6192>>ASSIGN   6194>>ASSIGN   6196>>IF       6199>>IF       6199>>ASSIGN   6200>>ASSIGN
      6208>>ASSIGN   6233>>IF       6233>>IF       6311>>ASSIGN   6313>>ASSIGN   6330>>ASSIGN   6331>>ASSIGN
      6333>>ASSIGN   6333>>ASSIGN   6334>>ASSIGN   6343>>ASSIGN   6344>>ASSIGN   6357>>ASSIGN   6372>>IF
      6385>>IF       6393>>ASSIGN   6395>>ASSIGN   6396>>ASSIGN   6397>>ASSIGN   6399>>ASSIGN   6402>>ASSIGN
      6411>>ASSIGN   6424>>IF       6424>>IF       6426>>ASSIGN   6427>>ASSIGN   6437>>IF       6443>>ASSIGN
      6443>>ASSIGN   6445>>IF       6448>>ASSIGN   6449>>ASSIGN   6451>>ASSIGN   6452>>ASSIGN   6458>>ASSIGN
      6462>>ASSIGN   6463>>ASSIGN   6464>>IF       6464>>IF       6479>>ASSIGN   6480>>ASSIGN   6490>>IF
      6490>>IF       6496>>IF       6497>>ASSIGN   6497>>ASSIGN   6498>>ASSIGN   6498>>ASSIGN   6499>>IF
      6499>>IF       6500>>ASSIGN   6500>>ASSIGN   6503>>ASSIGN   6503>>ASSIGN   6505>>IF       6505>>IF
      6517>>IF       6517>>IF       6518>>ASSIGN   6518>>ASSIGN   6518>>ASSIGN   6519>>ASSIGN   6519>>ASSIGN
      6519>>ASSIGN   6541>>IF       6541>>IF       6545>>IF       6546>>ASSIGN   6546>>ASSIGN   6547>>ASSIGN
      6547>>ASSIGN   6548>>IF       6554>>IF       6555>>ASSIGN   6556>>ASSIGN   6560>>IF       6565>>IF
      6571>>ASSIGN   6572>>ASSIGN   6576>>ASSIGN   6577>>IF       6577>>IF       6579>>ASSIGN   6579>>ASSIGN
      6581>>IF       6583>>ASSIGN   6585>>ASSIGN   6586>>ASSIGN   6586>>ASSIGN   6587>>ASSIGN   6588>>ASSIGN
      6588>>ASSIGN   6620>>ASSIGN   6622>>ASSIGN   6627>>ASSIGN   6657>>ASSIGN   6661>>IF       6661>>IF
      6662>>DOWHILE  6678>>ASSIGN   6683>>ASSIGN   6695>>IF       6695>>IF       6695>>IF       6697>>ASSIGN
      6697>>ASSIGN   6700>>ASSIGN   6703>>DOWHILE  6722>>ASSIGN   6744>>IF       6744>>IF       6744>>IF
      6744>>IF       6744>>IF       6760>>IF       6778>>ASSIGN   6782>>ASSIGN   6788>>DOWHILE  6789>>IF
      6790>>ASSIGN   6791>>IF       6795>>ASSIGN   6799>>IF       6809>>IF       6820>>ASSIGN   6840>>IF
      6841>>ASSIGN   6844>>ASSIGN   6844>>ASSIGN   6868>>ASSIGN   6869>>ASSIGN   6870>>ASSIGN   6899>>ASSIGN
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:475  
      7766>>ASSIGN   7767>>ASSIGN   7771>>IF       7774>>ASSIGN   7776>>IF       7778>>IF       7779>>ASSIGN
      7779>>ASSIGN   7781>>IF       7781>>ASSIGN   7782>>ASSIGN   7801>>IF       7801>>IF       7801>>IF
      7801>>IF       7915>>ASSIGN   7936>>ASSIGN   7936>>ASSIGN   7937>>ASSIGN   7938>>ASSIGN   7955>>ASSIGN
      7955>>ASSIGN   7977>>IF       7977>>IF       7978>>ASSIGN   7978>>ASSIGN   7979>>IF       7979>>IF
      7980>>CALLBLT  7980>>CALLBLT  7983>>IF       7984>>ASSIGN   7986>>IF       7994>>ASSIGN   8003>>ASSIGN
      8003>>ASSIGN   8004>>ASSIGN   8004>>ASSIGN   8006>>IF       8006>>IF       8019<<ASSIGN   8020>>ASSIGN
      8027<<ASSIGN   8028>>ASSIGN   8029>>IF       8033>>ASSIGN   8036>>ASSIGN   8040>>ASSIGN   8044>>ASSIGN
      8045>>ASSIGN   8045>>ASSIGN   8045>>ASSIGN   8046>>ASSIGN   8046>>ASSIGN   8047>>ASSIGN   8047>>ASSIGN
      8048>>ASSIGN   8048>>ASSIGN   8049>>ASSIGN   8056<<ASSIGN   8057>>ASSIGN   8063<<ASSIGN   8064>>ASSIGN
      8070<<ASSIGN   8076<<ASSIGN   8077>>ASSIGN   8083<<ASSIGN   8084>>ASSIGN   8090<<ASSIGN   8091>>ASSIGN
      8097<<ASSIGN   8098>>ASSIGN   8099>>ASSIGN   8101>>IF       8102>>ASSIGN   8109>>ASSIGN   8109>>ASSIGN
      8113>>ASSIGN   8118<<ASSIGN   8119>>ASSIGN   8137>>ASSIGN   8144>>IF       8145>>DOWHILE  8148>>ASSIGN
      8148>>ASSIGN   8154>>IF       8158>>ASSIGN   8163>>ASSIGN   8165>>ASSIGN
STR
      4888**DCL      5538<<ASSIGN   5542<>CALL     5547<<ASSIGN   5571>>IF       5571<>CALL     5666<<ASSIGN
      5683>>IF       5683<>CALL     5684>>IF
SUBCOMMON IN PROCEDURE Y$FNDPSTCHR
      6302**LABEL    6298--GOTO
TABLOOP
      5829**LABEL    5839--EXIT
TMP IN PROCEDURE Y$FNDPSTCHR
      6245**DCL      6265--REDEF    6269<<ASSIGN   6368<>CALL
TMP.CHR IN PROCEDURE Y$FNDPSTCHR
      6249**DCL      6270<<ASSIGN   6279>>CALLBLT  6290<<ASSIGN   6318>>IF       6329>>IF       6351>>IF
      6356>>IF
TMP.ID IN PROCEDURE Y$FNDPSTCHR
      6254**DCL      6367<<ASSIGN
TMP.RVRDRC IN PROCEDURE Y$FNDPSTCHR
      6259**DCL      6308>>IF       6369<<ASSIGN   6372>>IF       6374<<ASSIGN
TMP.WRD IN PROCEDURE Y$FNDPSTCHR
      6263**DCL      6312>>IF       6321>>IF       6345>>IF       6351>>IF       6355>>IF
TMPU IN PROCEDURE Y$FNDPSTCHR
      6265**DCL      6302<<ASSIGN
VDH_DAT
      4829**DCL      8120--IF       8152<>CALL
VDH_DAT.DAT__.DATBYTSIZ
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:476  
      4865**DCL      8149<<ASSIGN
VDH_DAT IN PROCEDURE Y$TRMRED
      6971**DCL      6936--PROC     7756--IF
VDH_DAT.DATCTRCHR IN PROCEDURE Y$TRMRED
      7013**DCL      7757>>IF       7760<>CALL
VDH_INTINPOPR.ACKCHR
      4794**DCL      5180>>ASSIGN   5418>>IF       5423>>IF       5449>>ASSIGN   6168>>IF       6171>>CALL
      6174<>CALL     6275>>IF
VDH_INTINPOPR.IMD
      4793**DCL      4919>>IF       5032>>IF       5181>>ASSIGN   5960>>IF
VDH_INTINPOPR.INPFNCTBL$
      4793**DCL      4897>>ASSIGN   4953>>ASSIGN   4973>>IF       5418>>IF       5423>>IF
VDH_INTINPOPR.INPOPRX
      4793**DCL      4897>>ASSIGN
VDH_INTINPOPR.ORGCHR
      4793**DCL      5179>>ASSIGN
VDH_OTPLCL_BNG_HI_BNG
      3778**DCL      5559<>CALL
VDH_OTPLCL_BNG_HI_BNG_TEXT
      3760**DCL      3811--DCLINIT
VDH_OTPLCL_TYPE
      3927**DCL      6089<>CALL
VDH_OTPLCL_TYPE_TEXT
      3909**DCL      3960--DCLINIT
VDH_OTPLCL_WRT
      3852**DCL      5069>>ASSIGN
VDH_PARM
      4757**DCL         9--PROC     4758--REDEF    4759--REDEF    4787--REDEF    4829--REDEF    4892--ENTRY
      8054--ENTRY    8088--ENTRY    8116--ENTRY
VDH_SHFCNT
      4759**DCL      8092<>CALL
VDH_VRTCLM
      4758**DCL      4757--IMP-SIZ  8058<>CALL
VRTCLM IN PROCEDURE Y$EDTX_TO_VRTCLM
      6189**DCL      6185--PROC     6214<<ASSIGN   6226>>ASSIGN   6237<<ASSIGN
Y$ABRRED
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:477  
      5968**PROC     5106--CALL     8021--CALL
Y$BLKTYPAHD
      5986**PROC     5206--CALL
Y$ECHINPOPR
      6149**PROC     4928--CALL     4992--CALL     5097--CALL
Y$EDTX_TO_VRTCLM
      6185**PROC     5283--CALL     5342--CALL     5799--CALL     6526--CALL     6619--CALL     6623--CALL
      6893--CALL     8009--CALL     8050--CALL     8058--CALL     8110--CALL
Y$FNDPSTCHR
      6241**PROC     5477--CALL
Y$FNDPSTWRD IN PROCEDURE Y$FNDPSTCHR
      6300**ENTRY    5480--CALL
Y$PRGRED
      6378**PROC     5110--CALL     5980--CALL     8065--CALL
Y$PRGTYPAHD
      6407**PROC     5101--CALL
Y$PRGTYPAHDINPFNC IN PROCEDURE Y$PRGTYPAHD
      6454**ENTRY    5525--CALL     5965--CALL     8071--CALL
Y$PRGTYPAHDINT IN PROCEDURE Y$PRGTYPAHD
      6427**LABEL    6472--GOTO
Y$PSTLFT
      6486**PROC     5614--CALL     5626--CALL     5853--CALL
Y$PSTLFT_N IN PROCEDURE Y$PSTLFT
      6515**ENTRY    5592--CALL     5618--CALL     6360--CALL
Y$PSTRHT_TYP
      6535**PROC     5632--CALL     5850--CALL
Y$RE_DSPINP
      6598**PROC     5065--CALL     7755--CALL     7763--CALL     8078--CALL
Y$RE_PSTRED
      6637**PROC     5168--CALL     5296--CALL     5375--CALL     5642--CALL
Y$SCPVRTCLMHI_X
      6649**PROC     5260--CALL     6332--CALL     6359--CALL     6504--CALL
Y$SCPVRTCLMLOWX
      6687**PROC     5317--CALL     5370--CALL     5591--CALL     5709--CALL     6336--CALL     6358--CALL
      6559--CALL     8085--CALL
Y$SHFCNT IN PROCEDURE Y$SHFDSPPST
PL6.E3A0      #001=KVI$INT File=KVI$INT.:E05TSI                                  WED 07/30/97 02:01 Page:478  
      6824**PROC     6758--CALL     6898--CALL
Y$SHFCNTDFL IN PROCEDURE Y$SHFCNT
      6838**ENTRY    6821--CALL
Y$SHFDSPPST
      6726**PROC     5287--CALL     5345--CALL     5383--CALL     5881--CALL     6529--CALL     8010--CALL
      8092--CALL
Y$SHFTO_DFL IN PROCEDURE Y$SHFDSPPST
      6817**ENTRY    8111--CALL
Y$SHFTYPREDBFR IN PROCEDURE Y$SHFDSPPST
      6852**ENTRY    5159--CALL     5376--CALL     5647--CALL     5691--CALL     5761--CALL     8051--CALL
Y$SHFTYPREDBFRSGM IN PROCEDURE Y$SHFDSPPST
      6861**ENTRY    6626--CALL
Y$TRMRED
      6936**PROC     5981--CALL     8152--CALL
Y$TYPAHDTXT
      7808**PROC     5051--CALL     5637--CALL
Y$TYPREDBFRSGM
      7973**PROC     5611--CALL     6335--CALL     6558--CALL     6590--CALL
Y@PSTLFT_N IN PROCEDURE Y$PSTLFT
      6512**LABEL    6507--GOTO
Y@PSTN_XIT IN PROCEDURE Y$SHFDSPPST
      6923**LABEL    6876--GOTO
Y@SHFRCR IN PROCEDURE Y$SHFDSPPST
      6752**LABEL    6822--GOTO
Y@SHFTYP IN PROCEDURE Y$SHFDSPPST
      6850**LABEL    6762--GOTO
Y@SHFTYPSGM IN PROCEDURE Y$SHFDSPPST
      6865**LABEL    6753--GOTO     6859--GOTO
Y_CHNCAS
      3726**DCL      7980>>CALLBLT
Y_MAXPRMX
      3709**DCL      4973>>IF

PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:479  
     2602        1        /*T***********************************************************/
     2603        2        /*T*                                                         */
     2604        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2605        4        /*T*                                                         */
     2606        5        /*T***********************************************************/
     2607        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     2608        7        /*F* NAME: KVI$NEWINPFNCTBL.
     2609        8             PURPOSE: Sets up KV$MVD.ESCX to reflect the matchups between
     2610        9             introducer characters for the system and user tables. */
     2611       10
     2612       11        KVI$NEWINPFNCTBL: PROC;
     2613       12
     2614       13 S      %INCLUDE KV$GLB;
     2615       14 S      %INCLUDE KV$GLBCTX;
     2616       15        %INCLUDE KV$INPFNC;
     2617      574
     2618      575        %KV$PTR;
     2619      618        %KV$MRD;
     2620      665        %KV$MVD;
     2621      709        %KV$INPFNCTBL;
     2622      793
     2623      794    1   DCL 1 B BASED ALIGNED,
     2624      795    1          2 B(0:7) BIT(1);
     2625      796
     2626      797    1   DCL 1 BYT BASED ALIGNED,
     2627      798    1          2 B(0:0) BIT(8);
     2628      799
     2629      800    1   DCL FNCTBL$(0:2) PTR;
     2630      801    1   DCL ESCX$ PTR;
     2631      802    1   DCL ESCCNTMSK$ PTR;
     2632      803    1   DCL R0 SBIN;
     2633      804    1   DCL R1 SBIN;
     2634      805    1   DCL R2 SBIN;
     2635      806    1   DCL R3 SBIN;
     2636      807
     2637      808    1      FNCTBL$(0) = %KV_MRD.PRFINPFNCTBL$;
     2638      809    1      FNCTBL$(1) = %KV_MVD.USRINPFNCTBL$;
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:480  
     2639      810    1      FNCTBL$(2) = %KV_MVD.SSTINPFNCTBL$;
     2640      811    1      ESCX$ = ADDR(%KV_MVD.ESCX);
     2641      812    1      ESCCNTMSK$ = ADDR(%KV_MVD.ESCCNTMSK);
     2642      813    1      %KV_MVD.ESCX = '0'B;
     2643      814    1      ESCCNTMSK$->B.B = '0'B;
     2644      815    2      DO R0=0 TO 2;
     2645      816        /* This loop is traversed for the profile, user, and system tables. */
     2646      817
     2647      818    3         IF FNCTBL$(R0)~=ADDR(NIL) THEN DO R1 = 0 TO 1;
     2648      819        /* This loop is traversed once for each level of (R0) (primary/secondary). */
     2649      820
     2650      821    3            IF FNCTBL$(R0)->KV$INPFNCTBL.ESCCNTOK(R1)
     2651      822    3            THEN ESCCNTMSK$->B.B(R1+R0*2) = '1'B;
     2652      823    4            IF R0<2 THEN DO R2 = 0 TO 1;
     2653      824        /* This loop is traversed once per level in the comparison table (R3) */
     2654      825
     2655      826    5               DO R3 = R0 TO 2;
     2656      827        /* This loop is traversed for each kind of table (prf, usr, sst). */
     2657      828
     2658      829    6                  IF FNCTBL$(R3)=ADDR(NIL) THEN DO;
     2659      830    6                     R3 = R3+1;
     2660      831    6                     IF FNCTBL$(R3)=ADDR(NIL) THEN R3 = R3+1;
     2661      832    6                  END;
     2662      833    5                  IF R3>2 THEN EXIT;
     2663      834    5                  IF FNCTBL$(R3)->KV$INPFNCTBL.ESCINT1_CHR(R2)>=0
     2664      835    5                    AND FNCTBL$(R3)->KV$INPFNCTBL.ESCINT1_CHR(R2)=
     2665      836    5                    FNCTBL$(R0)->KV$INPFNCTBL.ESCINT1_CHR(R1)
     2666      837    6                  THEN DO;
     2667      838    6                     IF FNCTBL$(R3)->KV$INPFNCTBL.ESCINT2_CHR(R2)>=0
     2668      839    6                     THEN ESCX$->B.B(R0*16+R1*8+6) = '1'B;
     2669      840    6                     ESCX$->B.B(R0*16+R1*8+R3*2+R2) = '1'B;
     2670      841    6                  END;
     2671      842    5               END /* LOOP */;
     2672      843    4            END /* LOOP */;
     2673      844    3         END /* LOOP */;
     2674      845    2      END /* LOOP */;
     2675      846    2      IF FNCTBL$(0)~=ADDR(NIL) AND FNCTBL$(1)~=ADDR(NIL) THEN DO R0=0 TO 1;
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:481  
     2676      847        /* Disable profile escapes if the introducer is redefined in the user table */
     2677      848    2         IF ESCX$->BYT.B(R0) AND NOT ESCX$->BYT.B(R0)&'30'X
     2678      849    2         THEN IF FNCTBL$(1)->KV$INPFNCTBL.SPCCHR
     2679      850    2           (FNCTBL$(0)->KV$INPFNCTBL.ESCINT1_CHR(R0))
     2680      851    2         THEN ESCX$->BYT.B(R0) = '0'B;
     2681      852    2      END;
     2682      853    1      RETURN;
     2683      854    1   END;
     2684      855        %EOD;

PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:482  
--  Include file information  --

   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVI$NEWINPFNCTBL.

   Procedure KVI$NEWINPFNCTBL requires 234 words for executable code.
   Procedure KVI$NEWINPFNCTBL requires 18 words of local(AUTO) storage.

PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:483  

 Object Unit name= KVI$NEWINPFNCTBL                           File name= KVI$INT.:E05TOU
 UTS= JUL 30 '97 02:04:33.60 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   234     EA  KVI$NEWINPFNCTBL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        0  KVI$NEWINPFNCTBL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                          r    G$ROS$
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:484  


     2602        1        /*T***********************************************************/
     2603        2        /*T*                                                         */
     2604        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2605        4        /*T*                                                         */
     2606        5        /*T***********************************************************/
     2607        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     2608        7        /*F* NAME: KVI$NEWINPFNCTBL.
     2609        8             PURPOSE: Sets up KV$MVD.ESCX to reflect the matchups between
     2610        9             introducer characters for the system and user tables. */
     2611       10
     2612       11        KVI$NEWINPFNCTBL: PROC;

     11   0 000000  D380 0000 0000  xent KVI$NEWINPFNCTBLLNJ,B5   X6A_AUTO_0
          0 000003       0012 0000                       DC       18,0

     2613       12
     2614       13 S      %INCLUDE KV$GLB;
     2615       14 S      %INCLUDE KV$GLBCTX;
     2616       15        %INCLUDE KV$INPFNC;
     2617      574
     2618      575        %KV$PTR;
     2619      618        %KV$MRD;
     2620      665        %KV$MVD;
     2621      709        %KV$INPFNCTBL;
     2622      793
     2623      794    1   DCL 1 B BASED ALIGNED,
     2624      795    1          2 B(0:7) BIT(1);
     2625      796
     2626      797    1   DCL 1 BYT BASED ALIGNED,
     2627      798    1          2 B(0:0) BIT(8);
     2628      799
     2629      800    1   DCL FNCTBL$(0:2) PTR;
     2630      801    1   DCL ESCX$ PTR;
     2631      802    1   DCL ESCCNTMSK$ PTR;
     2632      803    1   DCL R0 SBIN;
     2633      804    1   DCL R1 SBIN;
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:485  
     2634      805    1   DCL R2 SBIN;
     2635      806    1   DCL R3 SBIN;
     2636      807
     2637      808    1      FNCTBL$(0) = %KV_MRD.PRFINPFNCTBL$;

    808   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DCC6 0008                            LDB,B5   8,B6
          0 00000A  CCC5 0006                            LDB,B4   6,B5
          0 00000C  CFC7 0004                            STB,B4   FNCTBL$,AUTO

     2638      809    1      FNCTBL$(1) = %KV_MVD.USRINPFNCTBL$;

    809   0 00000E  BCC6 0006                            LDB,B3   6,B6
          0 000010  ACC3 0008                            LDB,B2   8,B3
          0 000012  AFC7 0006                            STB,B2   FNCTBL$+2,AUTO

     2639      810    1      FNCTBL$(2) = %KV_MVD.SSTINPFNCTBL$;

    810   0 000014  9CC3 000A                            LDB,B1   10,B3
          0 000016  9FC7 0008                            STB,B1   FNCTBL$+4,AUTO

     2640      811    1      ESCX$ = ADDR(%KV_MVD.ESCX);

    811   0 000018  EBC3 0018                            LAB,B6   24,B3
          0 00001A  EFC7 000A                            STB,B6   ESCX$,AUTO

     2641      812    1      ESCCNTMSK$ = ADDR(%KV_MVD.ESCCNTMSK);

    812   0 00001C  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 00001F  BCC5 0006                            LDB,B3   6,B5
          0 000021  EBC3 001C                            LAB,B6   28,B3
          0 000023  EFC7 000C                            STB,B6   ESCCNTMSK$,AUTO

     2642      813    1      %KV_MVD.ESCX = '0'B;

    813   0 000025  8743 0018                            CL       24,B3
          0 000027  8743 0019                            CL       25,B3
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:486  

     2643      814    1      ESCCNTMSK$->B.B = '0'B;

    814   0 000029  8786                                 CLH      ,B6

     2644      815    2      DO R0=0 TO 2;

    815   0 00002A  8747 000E                            CL       R0,AUTO

     2645      816        /* This loop is traversed for the profile, user, and system tables. */
     2646      817
     2647      818    3         IF FNCTBL$(R0)~=ADDR(NIL) THEN DO R1 = 0 TO 1;

    818   0 00002C  B847 000E                            LDR,R3   R0,AUTO
          0 00002E  3E02                                 ADV,R3   2
          0 00002F  8DB7                                 CMN      ,AUTO,R3
          0 000030  0901 0085                            BE       s:845,PREL

    818   0 000032  8747 000F                            CL       R1,AUTO

     2648      819        /* This loop is traversed once for each level of (R0) (primary/secondary). */
     2649      820
     2650      821    3            IF FNCTBL$(R0)->KV$INPFNCTBL.ESCCNTOK(R1)

    821   0 000034  B847 000E                            LDR,R3   R0,AUTO
          0 000036  3E02                                 ADV,R3   2
          0 000037  ECB7                                 LDB,B6   ,AUTO,R3
          0 000038  DBC6 001B                            LAB,B5   27,B6
          0 00003A  A847 000F                            LDR,R2   R1,AUTO
          0 00003C  2E08                                 ADV,R2   8
          0 00003D  82A5                                 LB       ,B5,R2
          0 00003E  0581 000A                            BBF      s:823,PREL

     2651      822    3            THEN ESCCNTMSK$->B.B(R1+R0*2) = '1'B;

    822   0 000040  E847 000E                            LDR,R6   R0,AUTO
          0 000042  6001                                 SOL,R6   1
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:487  
          0 000043  EA47 000F                            ADD,R6   R1,AUTO
          0 000045  DCC7 000C                            LDB,B5   ESCCNTMSK$,AUTO
          0 000047  9856                                 LDR,R1   R6
          0 000048  8915                                 LBT      ,B5,R1

     2652      823    4            IF R0<2 THEN DO R2 = 0 TO 1;

    823   0 000049  E847 000E                            LDR,R6   R0,AUTO
          0 00004B  6D02                                 CMV,R6   2
          0 00004C  0881 0062                            BAGE     s:844,PREL

    823   0 00004E  8747 0010                            CL       R2,AUTO

     2653      824        /* This loop is traversed once per level in the comparison table (R3) */
     2654      825
     2655      826    5               DO R3 = R0 TO 2;

    826   0 000050  E847 000E                            LDR,R6   R0,AUTO
          0 000052  EF47 0011                            STR,R6   R3,AUTO
          0 000054  0F81 004E                            B        s:842+2,PREL

     2656      827        /* This loop is traversed for each kind of table (prf, usr, sst). */
     2657      828
     2658      829    6                  IF FNCTBL$(R3)=ADDR(NIL) THEN DO;

    829   0 000056  B847 0011                            LDR,R3   R3,AUTO
          0 000058  3E02                                 ADV,R3   2
          0 000059  8DB7                                 CMN      ,AUTO,R3
          0 00005A  0981 000B                            BNE      s:833,PREL

     2659      830    6                     R3 = R3+1;

    830   0 00005C  8AC7 0011                            INC      R3,AUTO

     2660      831    6                     IF FNCTBL$(R3)=ADDR(NIL) THEN R3 = R3+1;

    831   0 00005E  B847 0011                            LDR,R3   R3,AUTO
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:488  
          0 000060  3E02                                 ADV,R3   2
          0 000061  8DB7                                 CMN      ,AUTO,R3
          0 000062  0981 0003                            BNE      s:833,PREL

    831   0 000064  8AC7 0011                            INC      R3,AUTO

     2661      832    6                  END;

     2662      833    5                  IF R3>2 THEN EXIT;

    833   0 000066  E847 0011                            LDR,R6   R3,AUTO
          0 000068  6D02                                 CMV,R6   2
          0 000069  0A01 003E                            BAG      s:843,PREL

     2663      834    5                  IF FNCTBL$(R3)->KV$INPFNCTBL.ESCINT1_CHR(R2)>=0

    834   0 00006B  B856                                 LDR,R3   R6
          0 00006C  3E02                                 ADV,R3   2
          0 00006D  ECB7                                 LDB,B6   ,AUTO,R3
          0 00006E  A847 0010                            LDR,R2   R2,AUTO
          0 000070  2E28                                 ADV,R2   40
          0 000071  D826                                 LDR,R5   ,B6,R2
          0 000072  5801 002E                            BLZ,R5   s:842,PREL
          0 000074  9847 000E                            LDR,R1   R0,AUTO
          0 000076  1E02                                 ADV,R1   2
          0 000077  DC97                                 LDB,B5   ,AUTO,R1
          0 000078  B847 000F                            LDR,R3   R1,AUTO
          0 00007A  3E28                                 ADV,R3   40
          0 00007B  D826                                 LDR,R5   ,B6,R2
          0 00007C  D935                                 CMR,R5   ,B5,R3
          0 00007D  0981 0023                            BNE      s:842,PREL

     2664      835    5                    AND FNCTBL$(R3)->KV$INPFNCTBL.ESCINT1_CHR(R2)=
     2665      836    5                    FNCTBL$(R0)->KV$INPFNCTBL.ESCINT1_CHR(R1)
     2666      837    6                  THEN DO;

     2667      838    6                     IF FNCTBL$(R3)->KV$INPFNCTBL.ESCINT2_CHR(R2)>=0
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:489  

    838   0 00007F  B856                                 LDR,R3   R6
          0 000080  3E02                                 ADV,R3   2
          0 000081  ECB7                                 LDB,B6   ,AUTO,R3
          0 000082  B847 0010                            LDR,R3   R2,AUTO
          0 000084  3E2A                                 ADV,R3   42
          0 000085  D836                                 LDR,R5   ,B6,R3
          0 000086  5801 000C                            BLZ,R5   s:840,PREL

     2668      839    6                     THEN ESCX$->B.B(R0*16+R1*8+6) = '1'B;

    839   0 000088  D847 000E                            LDR,R5   R0,AUTO
          0 00008A  5001                                 SOL,R5   1
          0 00008B  DA47 000F                            ADD,R5   R1,AUTO
          0 00008D  ECC7 000A                            LDB,B6   ESCX$,AUTO
          0 00008F  B855                                 LDR,R3   R5
          0 000090  3003                                 SOL,R3   3
          0 000091  3E06                                 ADV,R3   6
          0 000092  8936                                 LBT      ,B6,R3

     2669      840    6                     ESCX$->B.B(R0*16+R1*8+R3*2+R2) = '1'B;

    840   0 000093  D847 000E                            LDR,R5   R0,AUTO
          0 000095  5001                                 SOL,R5   1
          0 000096  DA47 000F                            ADD,R5   R1,AUTO
          0 000098  5002                                 SOL,R5   2
          0 000099  DA56                                 ADD,R5   R6
          0 00009A  5001                                 SOL,R5   1
          0 00009B  DA47 0010                            ADD,R5   R2,AUTO
          0 00009D  ECC7 000A                            LDB,B6   ESCX$,AUTO
          0 00009F  B855                                 LDR,R3   R5
          0 0000A0  8936                                 LBT      ,B6,R3

     2670      841    6                  END;

     2671      842    5               END /* LOOP */;

PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:490  
    842   0 0000A1  8AC7 0011                            INC      R3,AUTO
          0 0000A3  E847 0011                            LDR,R6   R3,AUTO
          0 0000A5  6D02                                 CMV,R6   2
          0 0000A6  0A81 FFAF                            BALE     s:829,PREL

     2672      843    4            END /* LOOP */;

    843   0 0000A8  8AC7 0010                            INC      R2,AUTO
          0 0000AA  D847 0010                            LDR,R5   R2,AUTO
          0 0000AC  5D01                                 CMV,R5   1
          0 0000AD  0A81 FFA2                            BALE     s:826,PREL

     2673      844    3         END /* LOOP */;

    844   0 0000AF  8AC7 000F                            INC      R1,AUTO
          0 0000B1  E847 000F                            LDR,R6   R1,AUTO
          0 0000B3  6D01                                 CMV,R6   1
          0 0000B4  0A81 FF7F                            BALE     s:821,PREL

     2674      845    2      END /* LOOP */;

    845   0 0000B6  8AC7 000E                            INC      R0,AUTO
          0 0000B8  E847 000E                            LDR,R6   R0,AUTO
          0 0000BA  6D02                                 CMV,R6   2
          0 0000BB  0A81 FF70                            BALE     s:818,PREL

     2675      846    2      IF FNCTBL$(0)~=ADDR(NIL) AND FNCTBL$(1)~=ADDR(NIL) THEN DO R0=0 TO 1;

    846   0 0000BD  8DC7 0004                            CMN      FNCTBL$,AUTO
          0 0000BF  0901 0027                            BE       s:853,PREL
          0 0000C1  8DC7 0006                            CMN      FNCTBL$+2,AUTO
          0 0000C3  0901 0023                            BE       s:853,PREL

    846   0 0000C5  8747 000E                            CL       R0,AUTO

     2676      847        /* Disable profile escapes if the introducer is redefined in the user table */
     2677      848    2         IF ESCX$->BYT.B(R0) AND NOT ESCX$->BYT.B(R0)&'30'X
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:491  

    848   0 0000C7  ECC7 000A                            LDB,B6   ESCX$,AUTO
          0 0000C9  B847 000E                            LDR,R3   R0,AUTO
          0 0000CB  E2B6                                 LLH,R6   ,B6,R3
          0 0000CC  6008                                 SOL,R6   8
          0 0000CD  6901 0013                            BEZ,R6   s:852,PREL
          0 0000CF  E570 3000                            AND,R6   12288,IMO
          0 0000D1  6981 000F                            BNEZ,R6  s:852,PREL

     2678      849    2         THEN IF FNCTBL$(1)->KV$INPFNCTBL.SPCCHR

    849   0 0000D3  DCC7 0004                            LDB,B5   FNCTBL$,AUTO
          0 0000D5  3E28                                 ADV,R3   40
          0 0000D6  A835                                 LDR,R2   ,B5,R3
          0 0000D7  CCC7 0006                            LDB,B4   FNCTBL$+2,AUTO
          0 0000D9  BBC4 000B                            LAB,B3   11,B4
          0 0000DB  82A3                                 LB       ,B3,R2
          0 0000DC  0581 0004                            BBF      s:852,PREL

     2679      850    2           (FNCTBL$(0)->KV$INPFNCTBL.ESCINT1_CHR(R0))
     2680      851    2         THEN ESCX$->BYT.B(R0) = '0'B;

    851   0 0000DE  9847 000E                            LDR,R1   R0,AUTO
          0 0000E0  8796                                 CLH      ,B6,R1

     2681      852    2      END;

    852   0 0000E1  8AC7 000E                            INC      R0,AUTO
          0 0000E3  E847 000E                            LDR,R6   R0,AUTO
          0 0000E5  6D01                                 CMV,R6   1
          0 0000E6  0AE1                                 BALE     s:848,SPREL

     2682      853    1      RETURN;

    853   0 0000E7  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     2683      854    1   END;
     2684      855        %EOD;
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:492  

PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:493  
--  Include file information  --

   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVI$NEWINPFNCTBL.
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:494  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     C-0-0/w PTR         r     1 ESCCNTMSK$                 A-0-0/w PTR         r     1 ESCX$
     4-0-0/w PTR         r     1 FNCTBL$(0:2)
     E-0-0/w SBIN(16)    r     1 R0                         F-0-0/w SBIN(16)    r     1 R1
    10-0-0/w SBIN(16)    r     1 R2                        11-0-0/w SBIN(16)    r     1 R3

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(8)     r     1 B                          0-0-0/w STRC(8)     r     1 BYT
     0-0-0/w STRC(736)   r     1 KV$INPFNCTBL               0-0-0/w STRC(512)   r     1 KV$MRD
     0-0-0/w STRC(512)   r     1 KV$MVD                     0-0-0/w STRC(480)   r     1 KV$PTR


   Procedure KVI$NEWINPFNCTBL requires 234 words for executable code.
   Procedure KVI$NEWINPFNCTBL requires 18 words of local(AUTO) storage.
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:495  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:496  
          MINI XREF LISTING

B.B
       795**DCL       814<<ASSIGN    822<<ASSIGN    839<<ASSIGN    840<<ASSIGN
BYT.B
       798**DCL       848>>IF        848>>IF        851<<ASSIGN
ESCCNTMSK$
       802**DCL       812<<ASSIGN    814>>ASSIGN    822>>ASSIGN
ESCX$
       801**DCL       811<<ASSIGN    839>>ASSIGN    840>>ASSIGN    848>>IF        848>>IF        851>>ASSIGN
FNCTBL$
       800**DCL       808<<ASSIGN    809<<ASSIGN    810<<ASSIGN    818>>IF        821>>IF        829>>IF
       831>>IF        834>>IF        834>>IF        834>>IF        838>>IF        846>>IF        846>>IF
       849>>IF        849>>IF
KV$INPFNCTBL.ESCCNTOK
       774**DCL       821>>IF
KV$INPFNCTBL.ESCINT1_CHR
       775**DCL       834>>IF        834>>IF        834>>IF        849>>IF
KV$INPFNCTBL.ESCINT2_CHR
       775**DCL       838>>IF
KV$INPFNCTBL.SPCCHR
       774**DCL       849>>IF
KV$MRD.PRFINPFNCTBL$
       640**DCL       808>>ASSIGN
KV$MVD.ESCCNTMSK
       704**DCL       812--ASSIGN
KV$MVD.ESCX
       700**DCL       811--ASSIGN    813<<ASSIGN
KV$MVD.SSTINPFNCTBL$
       689**DCL       810>>ASSIGN
KV$MVD.USRINPFNCTBL$
       688**DCL       809>>ASSIGN
KV$PTR.INPCNDPND
       602**DCL       611--REDEF     615--REDEF
PL6.E3A0      #002=KVI$NEWINPFNCTBL File=KVI$INT.:E05TSI                         WED 07/30/97 02:04 Page:497  
KV$PTR.LINLST$
       598**DCL       599--REDEF
KV$PTR.MRD$
       597**DCL       808>>ASSIGN
KV$PTR.MVD$
       597**DCL       809>>ASSIGN    810>>ASSIGN    811>>ASSIGN    812>>ASSIGN    813>>ASSIGN
KV$PTR$
       590**DCL       596--IMP-PTR   808>>ASSIGN    809>>ASSIGN    810>>ASSIGN    811>>ASSIGN    812>>ASSIGN
       813>>ASSIGN
R0
       803**DCL       815<<DOINDEX   818>>IF        821>>IF        822>>ASSIGN    823>>IF        826>>DOINDEX
       834>>IF        839>>ASSIGN    840>>ASSIGN    846<<DOINDEX   848>>IF        848>>IF        849>>IF
       851>>ASSIGN
R1
       804**DCL       818<<DOINDEX   821>>IF        822>>ASSIGN    834>>IF        839>>ASSIGN    840>>ASSIGN
R2
       805**DCL       823<<DOINDEX   834>>IF        834>>IF        838>>IF        840>>ASSIGN
R3
       806**DCL       826<<DOINDEX   829>>IF        830<<ASSIGN    830>>ASSIGN    831>>IF        831<<ASSIGN
       831>>ASSIGN    833>>IF        834>>IF        834>>IF        838>>IF        840>>ASSIGN

PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:498  
     2685        1        /*T***********************************************************/
     2686        2        /*T*                                                         */
     2687        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2688        4        /*T*                                                         */
     2689        5        /*T***********************************************************/
     2690        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     2691        7        /*F* NAME: KVI$SETINPFLDBGNATR.
     2692        8             PURPOSE: Manipulates the attributes required to create input fields
     2693        9             on a block-mode device.
     2694       10             ENTRY: KVI$RSTINPFLDBGNATR.
     2695       11             ENTRY: KVI$ADJINPFLDBGNATR.
     2696       12             ENTRY: KVI$SETINPFLDENDATR.
     2697       13             ENTRY: KVI$RSTINPFLDENDATR.
     2698       14        */
     2699       15
     2700       16        KVI$SETINPFLDBGNATR: PROC;
     2701       17
     2702       18 S      %INCLUDE KV$GLB;
     2703       19 S      %INCLUDE KV$GLBCTX;
     2704       20 S      %INCLUDE KV$USR;
     2705       21 S      %INCLUDE KV$VDH;
     2706       22 S      %INCLUDE KV_GLBCNS_E;
     2707       23
     2708       24        %KV_ABSGRPRND_E;
     2709       33        %KV$PTR;
     2710       76        %KV$MRD;
     2711      123        %KV$MVD;
     2712      167        %KV$SRD;
     2713      442
     2714      443        %KV$USR_SETATR (NAME=KV_USR_SETATR, STCLASS=SYMREF);
     2715      566        %KV$VDH_PST (NAME=KV_VDH_PST_SPC_VRT, STCLASS=SYMREF);
     2716      640        %KV$USR_SETATR (NAME=KV@USR_SETATR, STCLASS=AUTO);
     2717      763        %EQU USR_SETATR=CHARTEXT('KV@USR_SETATR');
     2718      764
     2719      765        /* Entry is for set, as opposed to reset.                                     */
     2720      766
     2721      767    1   DCL SET BIT(1);
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:499  
     2722      768
     2723      769        /* Entry is for adjust                                                        */
     2724      770
     2725      771    1   DCL ADJ BIT(1);
     2726      772
     2727      773        /* Word */
     2728      774
     2729      775    1   DCL Y@TMPWRD SBIN;
     2730      776
     2731      777    1   DCL KVO$PST ENTRY(1);
     2732      778    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
     2733      779
     2734      780    1      ADJ = '0'B;
     2735      781    1      SET = '1'B;
     2736      782
     2737      783        /* Reset input field begin attributes.                                        */
     2738      784
     2739      785    1      GOTO BGNATR_SUBCOMMON;               /* LOOK BELOW                         */
     2740      786        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:500  
     2741      787    1   KVI$RSTINPFLDBGNATR: ENTRY;
     2742      788    1      SET = '0'B;
     2743      789    1      ADJ = '0'B;
     2744      790
     2745      791        /* Adjust input field begin attributes (after dispinput change).              */
     2746      792
     2747      793    1      GOTO BGNATR_SUBCOMMON;               /* LOOK BELOW                         */
     2748      794        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:501  
     2749      795    1   KVI$ADJINPFLDBGNATR: ENTRY;
     2750      796    1      SET = '0'B;
     2751      797    1      ADJ = '1'B;
     2752      798        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:502  
     2753      799    1   BGNATR_SUBCOMMON: ;                     /* THERE MUST BE AN ALTENTRY ABOVE ME */
     2754      800    1      %USR_SETATR = KV_USR_SETATR;
     2755      801    1      %USR_SETATR.GRPRND = %KV_MRD.ABSGRPRND(%KV_ABSGRPRND_INPUT);
     2756      802    1      %USR_SETATR.PHSPST.CLM = %KV_SRD.PRMVRTCLM;
     2757      803    2      IF SET THEN DO;
     2758      804        /* This is a set entry.                                                       */
     2759      805
     2760      806    2         IF %KV_MRD.ATRRQRDSPPST THEN %KV_SRD.PRMVRTCLM = %KV_SRD.PRMVRTCLM+1;
     2761      807        /* The attribute requires a display position.                                 */
     2762      808
     2763      809    2         %USR_SETATR.QLF.ACPALL = '1'B;
     2764      810    2      END; ELSE DO;
     2765      811        /* This is the reset or adjust entry.                                        */
     2766      812
     2767      813    2         IF %KV_MRD.ATRRQRDSPPST
     2768      814        /* The attribute requires a display position.                                 */
     2769      815
     2770      816    2         THEN %USR_SETATR.PHSPST.CLM = %USR_SETATR.PHSPST.CLM-1;
     2771      817    2         IF NOT ADJ THEN %USR_SETATR.QLF.PRT = '1'B;
     2772      818    3         ELSE DO;
     2773      819    3            %USR_SETATR.QLF.ACPALL='1'B;
     2774      820    3         END;
     2775      821    2      END /* IF */;
     2776      822    1      %USR_SETATR.PHSPST.LIN =
     2777      823    1        %USR_SETATR.PHSPST.CLM/%KV_SRD.WDT+%KV_SRD.CRTVRTLINPHSLIN;
     2778      824    1      %USR_SETATR.PHSPST.CLM =
     2779      825    1        MOD(%USR_SETATR.PHSPST.CLM,%KV_SRD.WDT)+%KV_SRD.TOPLFT.CLM;
     2780      826    1      IF NOT %KV_MVD.DISPINPUT THEN %USR_SETATR.GRPRND.HDN = '1'B;
     2781      827        /* We aren't to display the input data.                                       */
     2782      828
     2783      829    1      CALL KVV$CALUSR (%USR_SETATR);
     2784      830    2      IF NOT SET AND NOT ADJ THEN DO;
     2785      831    2         %USR_SETATR.DLTFLD = '1'B;
     2786      832    3         IF %KV_SRD.FLDEND.CLM=%KV_SRD.BTMRHT.CLM THEN DO;
     2787      833    3            %KV_SRD.FLDEND.CLM = %KV_SRD.TOPLFT.CLM;
     2788      834    3            %KV_SRD.FLDEND.LIN = %KV_SRD.FLDEND.LIN+1;
     2789      835    2         END; ELSE %KV_SRD.FLDEND.CLM = %KV_SRD.FLDEND.CLM+1;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:503  
     2790      836    2      END;
     2791      837    2      IF %KV_SRD.WDT~=%KV_MRD.WDT OR NOT %KV_MRD.NO_FLDTRM THEN DO;
     2792      838    3         DO WHILE %USR_SETATR.PHSPST.LIN<%KV_SRD.FLDEND.LIN;
     2793      839    4            IF %USR_SETATR.DLTFLD AND %KV_MRD.NO_FLDTRM THEN DO;
     2794      840    4               %USR_SETATR.PHSPST.CLM = %KV_SRD.SRDEND.CLM;
     2795      841    4               CALL KVV$CALUSR (%USR_SETATR);
     2796      842    4            END;
     2797      843    3            %USR_SETATR.PHSPST.LIN = %USR_SETATR.PHSPST.LIN+1;
     2798      844    3            %USR_SETATR.PHSPST.CLM = %KV_SRD.ORG.CLM+1;
     2799      845    3            CALL KVV$CALUSR (%USR_SETATR);
     2800      846    3         END;
     2801      847    2         IF NOT %USR_SETATR.DLTFLD OR %KV_SRD.FLDEND.CLM=%KV_SRD.TOPLFT.CLM
     2802      848    2         THEN EXIT;
     2803      849    2         %USR_SETATR.PHSPST.CLM = %KV_SRD.FLDEND.CLM;
     2804      850    2         CALL KVV$CALUSR (%USR_SETATR);
     2805      851    2      END;
     2806      852    1      RETURN;
     2807      853        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:504  
     2808      854    1   KVI$SETINPFLDENDATR: ENTRY;
     2809      855
     2810      856        /* Set input field end attributes.                                            */
     2811      857
     2812      858    1      SET = '1'B;
     2813      859
     2814      860    1      GOTO ENDATR_SUBCOMMON;               /* LOOK BELOW                         */
     2815      861        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:505  
     2816      862    1   KVI$RSTINPFLDENDATR: ENTRY;
     2817      863
     2818      864        /* Reset input field end attributes.                                          */
     2819      865    1      SET = '0'B;
     2820      866        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:506  
     2821      867    1   ENDATR_SUBCOMMON: ;                     /* THERE MUST BE AN ALTENTRY ABOVE ME */
     2822      868    1      %USR_SETATR = KV_USR_SETATR;
     2823      869    1      %USR_SETATR.GRPRND = %KV_MRD.ABSGRPRND(%KV_ABSGRPRND_OUTPUT);
     2824      870    1      %USR_SETATR.QLF.PRT = '1'B;
     2825      871    1      %USR_SETATR.PHSPST = %KV_SRD.CRT;
     2826      872    1      CALL KVV$CALUSR (%USR_SETATR);
     2827      873    2      IF SET THEN DO;
     2828      874        /* This is the set entry.                                                     */
     2829      875
     2830      876    2         IF %USR_SETATR.PHSPST_PST>%KV_SRD.HI_NONBLN_PST
     2831      877        /* The position of the end of the field + 1 is beyond the hi
     2832      878           non-blank position. Adjust ho non-blank to field end + 1
     2833      879           so erases and the placement of text after the field work ok.               */
     2834      880
     2835      881    2         THEN %KV_SRD.HI_NONBLN = %USR_SETATR.PHSPST;
     2836      882    2         %USR_SETATR.PHSPST.CLM = %USR_SETATR.PHSPST.CLM-1;
     2837      883    3         IF %USR_SETATR.PHSPST.CLM<%KV_SRD.TOPLFT.CLM THEN DO;
     2838      884    3            %USR_SETATR.PHSPST.LIN = %USR_SETATR.PHSPST.LIN-1;
     2839      885    3            %USR_SETATR.PHSPST.CLM = %KV_SRD.BTMRHT.CLM;
     2840      886    3         END /* IF */;
     2841      887    2         %KV_SRD.FLDEND = %USR_SETATR.PHSPST;
     2842      888    2         IF %KV_SRD.ORG.CLM~=0 AND %KV_MRD.NO_FLDTRM
     2843      889    3           OR %KV_SRD.SRDEND.CLM~=%KV_MRD.WDT THEN DO;
     2844      890    3            Y@TMPWRD = %KV_SRD.PRMVRTCLM;
     2845      891    3            IF %KV_MRD.ATRRQRDSPPST THEN Y@TMPWRD = Y@TMPWRD-1;
     2846      892    3            Y@TMPWRD = %KV_SRD.CRTVRTLINPHSLIN+Y@TMPWRD/%KV_SRD.WDT;
     2847      893    3            %USR_SETATR.QLF.ACPNMR = '1'B; /* Set autoskip                       */
     2848      894    3            %USR_SETATR.PHSPST.CLM = %KV_SRD.SRDEND.CLM;
     2849      895    4            DO WHILE Y@TMPWRD<%USR_SETATR.PHSPST.LIN;
     2850      896    4               %USR_SETATR.PHSPST.LIN = %USR_SETATR.PHSPST.LIN-1;
     2851      897    4               CALL KVV$CALUSR (%USR_SETATR);
     2852      898    4            END;
     2853      899    3         END;
     2854      900    2      END; ELSE DO;
     2855      901        /* This is the reset entry.                                                   */
     2856      902
     2857      903    2         IF %KV_MRD.ATRRQRDSPPST
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:507  
     2858      904        /* The attribute declaration requires a display position.
     2859      905           Skip beyond the attribute.                                                 */
     2860      906
     2861      907    2         THEN CALL KVO$PST (KV_VDH_PST_SPC_VRT);
     2862      908    2         %KV_SRD.FLDEND = '0'B;
     2863      909    2      END /* IF */;
     2864      910    1   END;
     2865      911        %EOD;

PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:508  
--  Include file information  --

   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVI$SETINPFLDBGNATR.

   Procedure KVI$SETINPFLDBGNATR requires 489 words for executable code.
   Procedure KVI$SETINPFLDBGNATR requires 14 words of local(AUTO) storage.

PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:509  

 Object Unit name= KVI$SETINPFLDBGNATR                        File name= KVI$INT.:E05TOU
 UTS= JUL 30 '97 02:04:43.52 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   489    1E9  KVI$SETINPFLDBGNATR
    1  RoData even  none     2      2  KVI$SETINPFLDBGNATR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        0  KVI$SETINPFLDBGNATR
     0      C                  yes      Std        0  KVI$RSTINPFLDBGNATR
     0     17                  yes      Std        0  KVI$ADJINPFLDBGNATR
     0    11F                  yes      Std        0  KVI$SETINPFLDENDATR
     0    129                  yes      Std        0  KVI$RSTINPFLDENDATR

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KVV$CALUSR
         yes           Std       1 KVO$PST
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:510  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               KV_USR_SETATR                         KV_VDH_PST_SPC_VRT
r    G$ROS$
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:511  


     2685        1        /*T***********************************************************/
     2686        2        /*T*                                                         */
     2687        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2688        4        /*T*                                                         */
     2689        5        /*T***********************************************************/
     2690        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     2691        7        /*F* NAME: KVI$SETINPFLDBGNATR.
     2692        8             PURPOSE: Manipulates the attributes required to create input fields
     2693        9             on a block-mode device.
     2694       10             ENTRY: KVI$RSTINPFLDBGNATR.
     2695       11             ENTRY: KVI$ADJINPFLDBGNATR.
     2696       12             ENTRY: KVI$SETINPFLDENDATR.
     2697       13             ENTRY: KVI$RSTINPFLDENDATR.
     2698       14        */
     2699       15
     2700       16        KVI$SETINPFLDBGNATR: PROC;

     16   0 000000  D380 0000 0000  xent KVI$SETINPFLDBG*LNJ,B5   X6A_AUTO_0
          0 000003       000E 0000                       DC       14,0

     2701       17
     2702       18 S      %INCLUDE KV$GLB;
     2703       19 S      %INCLUDE KV$GLBCTX;
     2704       20 S      %INCLUDE KV$USR;
     2705       21 S      %INCLUDE KV$VDH;
     2706       22 S      %INCLUDE KV_GLBCNS_E;
     2707       23
     2708       24        %KV_ABSGRPRND_E;
     2709       33        %KV$PTR;
     2710       76        %KV$MRD;
     2711      123        %KV$MVD;
     2712      167        %KV$SRD;
     2713      442
     2714      443        %KV$USR_SETATR (NAME=KV_USR_SETATR, STCLASS=SYMREF);
     2715      566        %KV$VDH_PST (NAME=KV_VDH_PST_SPC_VRT, STCLASS=SYMREF);
     2716      640        %KV$USR_SETATR (NAME=KV@USR_SETATR, STCLASS=AUTO);
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:512  
     2717      763        %EQU USR_SETATR=CHARTEXT('KV@USR_SETATR');
     2718      764
     2719      765        /* Entry is for set, as opposed to reset.                                     */
     2720      766
     2721      767    1   DCL SET BIT(1);
     2722      768
     2723      769        /* Entry is for adjust                                                        */
     2724      770
     2725      771    1   DCL ADJ BIT(1);
     2726      772
     2727      773        /* Word */
     2728      774
     2729      775    1   DCL Y@TMPWRD SBIN;
     2730      776
     2731      777    1   DCL KVO$PST ENTRY(1);
     2732      778    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
     2733      779
     2734      780    1      ADJ = '0'B;

    780   0 000005  8747 0009                            CL       ADJ,AUTO

     2735      781    1      SET = '1'B;

    781   0 000007  8947 0008                            LBT,'8000'X       SET,AUTO
    781   0 000009       8000

     2736      782
     2737      783        /* Reset input field begin attributes.                                        */
     2738      784
     2739      785    1      GOTO BGNATR_SUBCOMMON;               /* LOOK BELOW                         */

    785   0 00000A  0F81 0016                            B        s:797,PREL

     2740      786        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:513  
     2741      787    1   KVI$RSTINPFLDBGNATR: ENTRY;

    787   0 00000C  D380 0000 0000  xent KVI$RSTINPFLDBG*LNJ,B5   X6A_AUTO_0
          0 00000F       000E 0000                       DC       14,0

     2742      788    1      SET = '0'B;

    788   0 000011  8747 0008                            CL       SET,AUTO

     2743      789    1      ADJ = '0'B;

    789   0 000013  8747 0009                            CL       ADJ,AUTO

     2744      790
     2745      791        /* Adjust input field begin attributes (after dispinput change).              */
     2746      792
     2747      793    1      GOTO BGNATR_SUBCOMMON;               /* LOOK BELOW                         */

    793   0 000015  0F81 000B                            B        s:797,PREL

     2748      794        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:514  
     2749      795    1   KVI$ADJINPFLDBGNATR: ENTRY;

    795   0 000017  D380 0000 0000  xent KVI$ADJINPFLDBG*LNJ,B5   X6A_AUTO_0
          0 00001A       000E 0000                       DC       14,0

     2750      796    1      SET = '0'B;

    796   0 00001C  8747 0008                            CL       SET,AUTO

     2751      797    1      ADJ = '1'B;

    797   0 00001E  8947 0009                            LBT,'8000'X       ADJ,AUTO
    797   0 000020       8000

    797   0                              BGNATR_SUBCOMMONnull
     2752      798        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:515  
     2753      799    1   BGNATR_SUBCOMMON: ;                     /* THERE MUST BE AN ALTENTRY ABOVE ME */
     2754      800    1      %USR_SETATR = KV_USR_SETATR;

    800   0 000021  AB80 0000 0000  xsym BGNATR_SUBCOMMONLAB,B2   KV_USR_SETATR
          0 000024  2C00                                 LDV,R2   0
          0 000025  6C08                                 LDV,R6   8
          0 000026  BB87                                 LAB,B3   ,AUTO
          0 000027  3C08                                 LDV,R3   8
          0 000028  0008                                 MMM

     2755      801    1      %USR_SETATR.GRPRND = %KV_MRD.ABSGRPRND(%KV_ABSGRPRND_INPUT);

    801   0 000029  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00002C  DCC6 0008                            LDB,B5   8,B6
          0 00002E  E2C5 001B                            LLH,R6   27,B5
          0 000030  6008                                 SOL,R6   8
          0 000031  6048                                 SOR,R6   8
          0 000032  EAC7 0007                            SRM,R6,'00FF'X    KV@USR_SETATR+3,AUTO
          0 000034       00FF

     2756      802    1      %USR_SETATR.PHSPST.CLM = %KV_SRD.PRMVRTCLM;

    802   0 000035  CCC6 000A                            LDB,B4   10,B6
          0 000037  E844 0012                            LDR,R6   18,B4
          0 000039  EF47 0006                            STR,R6   KV@USR_SETATR+2,AUTO

     2757      803    2      IF SET THEN DO;

    803   0 00003B  89C7 0008                            CMZ      SET,AUTO
          0 00003D  0881 000C                            BAGE     s:813,PREL

     2758      804        /* This is a set entry.                                                       */
     2759      805
     2760      806    2         IF %KV_MRD.ATRRQRDSPPST THEN %KV_SRD.PRMVRTCLM = %KV_SRD.PRMVRTCLM+1;

    806   0 00003F  89C5 0018                            CMZ      24,B5
          0 000041  0881 0003                            BAGE     s:809,PREL
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:516  

    806   0 000043  8AC4 0012                            INC      18,B4

     2761      807        /* The attribute requires a display position.                                 */
     2762      808
     2763      809    2         %USR_SETATR.QLF.ACPALL = '1'B;

    809   0 000045  8947 0007                            LBT,'8000'X       KV@USR_SETATR+3,AUTO
    809   0 000047       8000

     2764      810    2      END; ELSE DO;

    810   0 000048  0F81 0013                            B        s:822,PREL

     2765      811        /* This is the reset or adjust entry.                                        */
     2766      812
     2767      813    2         IF %KV_MRD.ATRRQRDSPPST

    813   0 00004A  89C5 0018                            CMZ      24,B5
          0 00004C  0881 0003                            BAGE     s:817,PREL

     2768      814        /* The attribute requires a display position.                                 */
     2769      815
     2770      816    2         THEN %USR_SETATR.PHSPST.CLM = %USR_SETATR.PHSPST.CLM-1;

    816   0 00004E  88C7 0006                            DEC      KV@USR_SETATR+2,AUTO

     2771      817    2         IF NOT ADJ THEN %USR_SETATR.QLF.PRT = '1'B;

    817   0 000050  89C7 0009                            CMZ      ADJ,AUTO
          0 000052  0801 0006                            BAL      s:819,PREL

    817   0 000054  8947 0007                            LBT,'0400'X       KV@USR_SETATR+3,AUTO
    817   0 000056       0400
          0 000057  0F81 0004                            B        s:822,PREL

     2772      818    3         ELSE DO;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:517  

     2773      819    3            %USR_SETATR.QLF.ACPALL='1'B;

    819   0 000059  8947 0007                            LBT,'8000'X       KV@USR_SETATR+3,AUTO
    819   0 00005B       8000

     2774      820    3         END;

     2775      821    2      END /* IF */;

     2776      822    1      %USR_SETATR.PHSPST.LIN =

    822   0 00005C  DCC6 000A                            LDB,B5   10,B6
          0 00005E  E847 0006                            LDR,R6   KV@USR_SETATR+2,AUTO
          0 000060  E345 000D                            DIV,R6   13,B5
          0 000062  EA45 0013                            ADD,R6   19,B5
          0 000064  EF47 0005                            STR,R6   KV@USR_SETATR+1,AUTO

     2777      823    1        %USR_SETATR.PHSPST.CLM/%KV_SRD.WDT+%KV_SRD.CRTVRTLINPHSLIN;
     2778      824    1      %USR_SETATR.PHSPST.CLM =

    824   0 000066  E847 0006                            LDR,R6   KV@USR_SETATR+2,AUTO
          0 000068  70F0                                 DAR,R7   16
          0 000069  F345 000D                            DIV,R7   13,B5
          0 00006B  EA45 000A                            ADD,R6   10,B5
          0 00006D  EF47 0006                            STR,R6   KV@USR_SETATR+2,AUTO

     2779      825    1        MOD(%USR_SETATR.PHSPST.CLM,%KV_SRD.WDT)+%KV_SRD.TOPLFT.CLM;
     2780      826    1      IF NOT %KV_MVD.DISPINPUT THEN %USR_SETATR.GRPRND.HDN = '1'B;

    826   0 00006F  CCC6 0006                            LDB,B4   6,B6
          0 000071  82C4 0015                            LB,'0080'X        21,B4
          0 000073       0080
          0 000074  0501 0004                            BBT      s:829,PREL

    826   0 000076  8947 0007                            LBT,'0040'X       KV@USR_SETATR+3,AUTO
    826   0 000078       0040
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:518  

     2781      827        /* We aren't to display the input data.                                       */
     2782      828
     2783      829    1      CALL KVV$CALUSR (%USR_SETATR);

    829   0 000079  CBC7 0004                            LAB,B4   KV@USR_SETATR,AUTO
          0 00007B  CFC7 000C                            STB,B4   Y@TMPWRD+2,AUTO
          0 00007D  BBC7 000C                            LAB,B3   Y@TMPWRD+2,AUTO
          0 00007F  CBF0 0100                            LAB,B4   256,IMO
          0 000081  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          0 000084       0001                            DC       s:830,PREL

     2784      830    2      IF NOT SET AND NOT ADJ THEN DO;

    830   0 000085  89C7 0008                            CMZ      SET,AUTO
          0 000087  0801 001F                            BAL      s:837,PREL
          0 000089  89C7 0009                            CMZ      ADJ,AUTO
          0 00008B  0801 001B                            BAL      s:837,PREL

     2785      831    2         %USR_SETATR.DLTFLD = '1'B;

    831   0 00008D  8947 0004                            LBT,'0040'X       KV@USR_SETATR,AUTO
    831   0 00008F       0040

     2786      832    3         IF %KV_SRD.FLDEND.CLM=%KV_SRD.BTMRHT.CLM THEN DO;

    832   0 000090  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000093  DCC6 000A                            LDB,B5   10,B6
          0 000095  E845 0011                            LDR,R6   17,B5
          0 000097  E945 000C                            CMR,R6   12,B5
          0 000099  0981 000B                            BNE      s:835+2,PREL

     2787      833    3            %KV_SRD.FLDEND.CLM = %KV_SRD.TOPLFT.CLM;

    833   0 00009B  E845 000A                            LDR,R6   10,B5
          0 00009D  EF45 0011                            STR,R6   17,B5

PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:519  
     2788      834    3            %KV_SRD.FLDEND.LIN = %KV_SRD.FLDEND.LIN+1;

    834   0 00009F  DCC6 000A                            LDB,B5   10,B6
          0 0000A1  8AC5 0010                            INC      16,B5

     2789      835    2         END; ELSE %KV_SRD.FLDEND.CLM = %KV_SRD.FLDEND.CLM+1;

    835   0 0000A3  0F81 0003                            B        s:837,PREL

    835   0 0000A5  8AC5 0011                            INC      17,B5

     2790      836    2      END;

     2791      837    2      IF %KV_SRD.WDT~=%KV_MRD.WDT OR NOT %KV_MRD.NO_FLDTRM THEN DO;

    837   0 0000A7  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0000AA  DCC6 000A                            LDB,B5   10,B6
          0 0000AC  CCC6 0008                            LDB,B4   8,B6
          0 0000AE  E845 000D                            LDR,R6   13,B5
          0 0000B0  E944 000B                            CMR,R6   11,B4
          0 0000B2  0981 0006                            BNE      s:838,PREL
          0 0000B4  82C4 0016                            LB,'0080'X        22,B4
          0 0000B6       0080
          0 0000B7  0501 0064                            BBT      s:852,PREL

     2792      838    3         DO WHILE %USR_SETATR.PHSPST.LIN<%KV_SRD.FLDEND.LIN;

    838   0 0000B9  D847 0005                            LDR,R5   KV@USR_SETATR+1,AUTO
          0 0000BB  D945 0010                            CMR,R5   16,B5
          0 0000BD  0881 0045                            BAGE     s:847,PREL

     2793      839    4            IF %USR_SETATR.DLTFLD AND %KV_MRD.NO_FLDTRM THEN DO;

    839   0 0000BF  82C7 0004                            LB,'0040'X        KV@USR_SETATR,AUTO
    839   0 0000C1       0040
          0 0000C2  0581 001D                            BBF      s:843,PREL
          0 0000C4  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:520  
          0 0000C7  DCC6 0008                            LDB,B5   8,B6
          0 0000C9  82C5 0016                            LB,'0080'X        22,B5
          0 0000CB       0080
          0 0000CC  0581 0013                            BBF      s:843,PREL

     2794      840    4               %USR_SETATR.PHSPST.CLM = %KV_SRD.SRDEND.CLM;

    840   0 0000CE  CCC6 000A                            LDB,B4   10,B6
          0 0000D0  E844 001B                            LDR,R6   27,B4
          0 0000D2  EF47 0006                            STR,R6   KV@USR_SETATR+2,AUTO

     2795      841    4               CALL KVV$CALUSR (%USR_SETATR);

    841   0 0000D4  BBC7 0004                            LAB,B3   KV@USR_SETATR,AUTO
          0 0000D6  BFC7 000C                            STB,B3   Y@TMPWRD+2,AUTO
          0 0000D8  BBC7 000C                            LAB,B3   Y@TMPWRD+2,AUTO
          0 0000DA  CBF0 0100                            LAB,B4   256,IMO
          0 0000DC  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          0 0000DF       0001                            DC       s:843,PREL

     2796      842    4            END;

     2797      843    3            %USR_SETATR.PHSPST.LIN = %USR_SETATR.PHSPST.LIN+1;

    843   0 0000E0  8AC7 0005                            INC      KV@USR_SETATR+1,AUTO

     2798      844    3            %USR_SETATR.PHSPST.CLM = %KV_SRD.ORG.CLM+1;

    844   0 0000E2  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0000E5  DCC6 000A                            LDB,B5   10,B6
          0 0000E7  E845 0008                            LDR,R6   8,B5
          0 0000E9  6E01                                 ADV,R6   1
          0 0000EA  EF47 0006                            STR,R6   KV@USR_SETATR+2,AUTO

     2799      845    3            CALL KVV$CALUSR (%USR_SETATR);

    845   0 0000EC  CBC7 0004                            LAB,B4   KV@USR_SETATR,AUTO
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:521  
          0 0000EE  CFC7 000C                            STB,B4   Y@TMPWRD+2,AUTO
          0 0000F0  BBC7 000C                            LAB,B3   Y@TMPWRD+2,AUTO
          0 0000F2  CBF0 0100                            LAB,B4   256,IMO
          0 0000F4  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          0 0000F7       0001                            DC       s:846,PREL

     2800      846    3         END;

    846   0 0000F8  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0000FB  DCC6 000A                            LDB,B5   10,B6
          0 0000FD  E847 0005                            LDR,R6   KV@USR_SETATR+1,AUTO
          0 0000FF  E945 0010                            CMR,R6   16,B5
          0 000101  0801 FFBD                            BAL      s:839,PREL

     2801      847    2         IF NOT %USR_SETATR.DLTFLD OR %KV_SRD.FLDEND.CLM=%KV_SRD.TOPLFT.CLM

    847   0 000103  82C7 0004                            LB,'0040'X        KV@USR_SETATR,AUTO
    847   0 000105       0040
          0 000106  0581 0015                            BBF      s:852,PREL
          0 000108  E845 0011                            LDR,R6   17,B5
          0 00010A  E945 000A                            CMR,R6   10,B5
          0 00010C  0901 000F                            BE       s:852,PREL

     2802      848    2         THEN EXIT;
     2803      849    2         %USR_SETATR.PHSPST.CLM = %KV_SRD.FLDEND.CLM;

    849   0 00010E  EF47 0006                            STR,R6   KV@USR_SETATR+2,AUTO

     2804      850    2         CALL KVV$CALUSR (%USR_SETATR);

    850   0 000110  CBC7 0004                            LAB,B4   KV@USR_SETATR,AUTO
          0 000112  CFC7 000C                            STB,B4   Y@TMPWRD+2,AUTO
          0 000114  BBC7 000C                            LAB,B3   Y@TMPWRD+2,AUTO
          0 000116  CBF0 0100                            LAB,B4   256,IMO
          0 000118  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          0 00011B       0001                            DC       s:852,PREL

PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:522  
     2805      851    2      END;

     2806      852    1      RETURN;

    852   0 00011C  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2807      853        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:523  
     2808      854    1   KVI$SETINPFLDENDATR: ENTRY;

    854   0 00011F  D380 0000 0000  xent KVI$SETINPFLDEN*LNJ,B5   X6A_AUTO_0
          0 000122       000E 0000                       DC       14,0

     2809      855
     2810      856        /* Set input field end attributes.                                            */
     2811      857
     2812      858    1      SET = '1'B;

    858   0 000124  8947 0008                            LBT,'8000'X       SET,AUTO
    858   0 000126       8000

     2813      859
     2814      860    1      GOTO ENDATR_SUBCOMMON;               /* LOOK BELOW                         */

    860   0 000127  0F81 0008                            B        s:865,PREL

     2815      861        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:524  
     2816      862    1   KVI$RSTINPFLDENDATR: ENTRY;

    862   0 000129  D380 0000 0000  xent KVI$RSTINPFLDEN*LNJ,B5   X6A_AUTO_0
          0 00012C       000E 0000                       DC       14,0

     2817      863
     2818      864        /* Reset input field end attributes.                                          */
     2819      865    1      SET = '0'B;

    865   0 00012E  8747 0008                            CL       SET,AUTO

    865   0                              ENDATR_SUBCOMMONnull
     2820      866        %EJECT;
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:525  
     2821      867    1   ENDATR_SUBCOMMON: ;                     /* THERE MUST BE AN ALTENTRY ABOVE ME */
     2822      868    1      %USR_SETATR = KV_USR_SETATR;

    868   0 000130  AB80 0000 0000  xsym ENDATR_SUBCOMMONLAB,B2   KV_USR_SETATR
          0 000133  2C00                                 LDV,R2   0
          0 000134  6C08                                 LDV,R6   8
          0 000135  BB87                                 LAB,B3   ,AUTO
          0 000136  3C08                                 LDV,R3   8
          0 000137  0008                                 MMM

     2823      869    1      %USR_SETATR.GRPRND = %KV_MRD.ABSGRPRND(%KV_ABSGRPRND_OUTPUT);

    869   0 000138  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00013B  DCC6 0008                            LDB,B5   8,B6
          0 00013D  E845 001B                            LDR,R6   27,B5
          0 00013F  EAC7 0007                            SRM,R6,'00FF'X    KV@USR_SETATR+3,AUTO
          0 000141       00FF

     2824      870    1      %USR_SETATR.QLF.PRT = '1'B;

    870   0 000142  8947 0007                            LBT,'0400'X       KV@USR_SETATR+3,AUTO
    870   0 000144       0400

     2825      871    1      %USR_SETATR.PHSPST = %KV_SRD.CRT;

    871   0 000145  CCC6 000A                            LDB,B4   10,B6
          0 000147  8CC4 0015                            LDI      21,B4
          0 000149  8D47 0005                            SDI      KV@USR_SETATR+1,AUTO

     2826      872    1      CALL KVV$CALUSR (%USR_SETATR);

    872   0 00014B  ABC7 0004                            LAB,B2   KV@USR_SETATR,AUTO
          0 00014D  AFC7 000C                            STB,B2   Y@TMPWRD+2,AUTO
          0 00014F  BBC7 000C                            LAB,B3   Y@TMPWRD+2,AUTO
          0 000151  CBF0 0100                            LAB,B4   256,IMO
          0 000153  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          0 000156       0001                            DC       s:873,PREL
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:526  

     2827      873    2      IF SET THEN DO;

    873   0 000157  89C7 0008                            CMZ      SET,AUTO
          0 000159  0881 0071                            BAGE     s:903,PREL

     2828      874        /* This is the set entry.                                                     */
     2829      875
     2830      876    2         IF %USR_SETATR.PHSPST_PST>%KV_SRD.HI_NONBLN_PST

    876   0 00015B  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00015E  DCC6 000A                            LDB,B5   10,B6
          0 000160  8CC7 0005                            LDI      KV@USR_SETATR+1,AUTO
          0 000162  84C5 0017                            SID      23,B5
          0 000164  6801 0009                            BLZ,R6   s:882,PREL
          0 000166  6A01 0003                            BGZ,R6   s:881,PREL
          0 000168  7901 0005                            BEZ,R7   s:882,PREL

     2831      877        /* The position of the end of the field + 1 is beyond the hi
     2832      878           non-blank position. Adjust ho non-blank to field end + 1
     2833      879           so erases and the placement of text after the field work ok.               */
     2834      880
     2835      881    2         THEN %KV_SRD.HI_NONBLN = %USR_SETATR.PHSPST;

    881   0 00016A  8CC7 0005                            LDI      KV@USR_SETATR+1,AUTO
          0 00016C  8D45 0017                            SDI      23,B5

     2836      882    2         %USR_SETATR.PHSPST.CLM = %USR_SETATR.PHSPST.CLM-1;

    882   0 00016E  88C7 0006                            DEC      KV@USR_SETATR+2,AUTO

     2837      883    3         IF %USR_SETATR.PHSPST.CLM<%KV_SRD.TOPLFT.CLM THEN DO;

    883   0 000170  DCC6 000A                            LDB,B5   10,B6
          0 000172  E847 0006                            LDR,R6   KV@USR_SETATR+2,AUTO
          0 000174  E945 000A                            CMR,R6   10,B5
          0 000176  0881 0007                            BAGE     s:887,PREL
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:527  

     2838      884    3            %USR_SETATR.PHSPST.LIN = %USR_SETATR.PHSPST.LIN-1;

    884   0 000178  88C7 0005                            DEC      KV@USR_SETATR+1,AUTO

     2839      885    3            %USR_SETATR.PHSPST.CLM = %KV_SRD.BTMRHT.CLM;

    885   0 00017A  E845 000C                            LDR,R6   12,B5
          0 00017C  EF47 0006                            STR,R6   KV@USR_SETATR+2,AUTO

     2840      886    3         END /* IF */;

     2841      887    2         %KV_SRD.FLDEND = %USR_SETATR.PHSPST;

    887   0 00017E  8CC7 0005                            LDI      KV@USR_SETATR+1,AUTO
          0 000180  8D45 0010                            SDI      16,B5

     2842      888    2         IF %KV_SRD.ORG.CLM~=0 AND %KV_MRD.NO_FLDTRM

    888   0 000182  DCC6 000A                            LDB,B5   10,B6
          0 000184  D845 0008                            LDR,R5   8,B5
          0 000186  5901 0008                            BEZ,R5   s:888+13,PREL
          0 000188  CCC6 0008                            LDB,B4   8,B6
          0 00018A  82C4 0016                            LB,'0080'X        22,B4
          0 00018C       0080
          0 00018D  0501 000B                            BBT      s:890,PREL
          0 00018F  CCC6 0008                            LDB,B4   8,B6
          0 000191  C845 001B                            LDR,R4   27,B5
          0 000193  4801 0005                            BLZ,R4   s:890,PREL
          0 000195  C944 000B                            CMR,R4   11,B4
          0 000197  0901 004E                            BE       s:910,PREL

     2843      889    3           OR %KV_SRD.SRDEND.CLM~=%KV_MRD.WDT THEN DO;

     2844      890    3            Y@TMPWRD = %KV_SRD.PRMVRTCLM;

    890   0 000199  C845 0012                            LDR,R4   18,B5
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:528  
          0 00019B  CF47 000A                            STR,R4   Y@TMPWRD,AUTO

     2845      891    3            IF %KV_MRD.ATRRQRDSPPST THEN Y@TMPWRD = Y@TMPWRD-1;

    891   0 00019D  89C4 0018                            CMZ      24,B4
          0 00019F  0881 0003                            BAGE     s:892,PREL

    891   0 0001A1  88C7 000A                            DEC      Y@TMPWRD,AUTO

     2846      892    3            Y@TMPWRD = %KV_SRD.CRTVRTLINPHSLIN+Y@TMPWRD/%KV_SRD.WDT;

    892   0 0001A3  B847 000A                            LDR,R3   Y@TMPWRD,AUTO
          0 0001A5  B345 000D                            DIV,R3   13,B5
          0 0001A7  BA45 0013                            ADD,R3   19,B5
          0 0001A9  BF47 000A                            STR,R3   Y@TMPWRD,AUTO

     2847      893    3            %USR_SETATR.QLF.ACPNMR = '1'B; /* Set autoskip                       */

    893   0 0001AB  8947 0007                            LBT,'1000'X       KV@USR_SETATR+3,AUTO
    893   0 0001AD       1000

     2848      894    3            %USR_SETATR.PHSPST.CLM = %KV_SRD.SRDEND.CLM;

    894   0 0001AE  A845 001B                            LDR,R2   27,B5
          0 0001B0  AF47 0006                            STR,R2   KV@USR_SETATR+2,AUTO

     2849      895    4            DO WHILE Y@TMPWRD<%USR_SETATR.PHSPST.LIN;

    895   0 0001B2  B947 0005                            CMR,R3   KV@USR_SETATR+1,AUTO
          0 0001B4  0881 0031                            BAGE     s:910,PREL

     2850      896    4               %USR_SETATR.PHSPST.LIN = %USR_SETATR.PHSPST.LIN-1;

    896   0 0001B6  88C7 0005                            DEC      KV@USR_SETATR+1,AUTO

     2851      897    4               CALL KVV$CALUSR (%USR_SETATR);

PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:529  
    897   0 0001B8  EBC7 0004                            LAB,B6   KV@USR_SETATR,AUTO
          0 0001BA  EFC7 000C                            STB,B6   Y@TMPWRD+2,AUTO
          0 0001BC  BBC7 000C                            LAB,B3   Y@TMPWRD+2,AUTO
          0 0001BE  CBF0 0100                            LAB,B4   256,IMO
          0 0001C0  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          0 0001C3       0001                            DC       s:898,PREL

     2852      898    4            END;

    898   0 0001C4  E847 000A                            LDR,R6   Y@TMPWRD,AUTO
          0 0001C6  E947 0005                            CMR,R6   KV@USR_SETATR+1,AUTO
          0 0001C8  086E                                 BAL      s:896,SPREL

     2853      899    3         END;

     2854      900    2      END; ELSE DO;

    900   0 0001C9  0F81 001C                            B        s:910,PREL

     2855      901        /* This is the reset entry.                                                   */
     2856      902
     2857      903    2         IF %KV_MRD.ATRRQRDSPPST

    903   0 0001CB  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0001CE  DCC6 0008                            LDB,B5   8,B6
          0 0001D0  89C5 0018                            CMZ      24,B5
          0 0001D2  0881 000A                            BAGE     s:908,PREL

     2858      904        /* The attribute declaration requires a display position.
     2859      905           Skip beyond the attribute.                                                 */
     2860      906
     2861      907    2         THEN CALL KVO$PST (KV_VDH_PST_SPC_VRT);

    907   0 0001D4  BB80 0000 0000  01                   LAB,B3   0
          0 0001D7  CBF0 0100                            LAB,B4   256,IMO
          0 0001D9  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          0 0001DC       0001                            DC       s:908,PREL
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:530  

     2862      908    2         %KV_SRD.FLDEND = '0'B;

    908   0 0001DD  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0001E0  DCC6 000A                            LDB,B5   10,B6
          0 0001E2  8745 0010                            CL       16,B5
          0 0001E4  8745 0011                            CL       17,B5

     2863      909    2      END /* IF */;

     2864      910    1   END;

    910   0 0001E6  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     2865      911        %EOD;

PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:531  
--  Include file information  --

   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVI$SETINPFLDBGNATR.
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:532  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     9-0-0/b BIT         r     1 ADJ                        4-0-0/w STRC(64)    r     1 KV@USR_SETATR
     8-0-0/b BIT         r     1 SET                        A-0-0/w SBIN(16)    r     1 Y@TMPWRD

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(64)    r     1 KV_USR_SETATR
     0-0-0/w STRC(64)    r     1 KV_VDH_PST_SPC_VRT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KV$MRD                     0-0-0/w STRC(512)   r     1 KV$MVD
     0-0-0/w STRC(480)   r     1 KV$PTR                     0-0-0/w STRC(496)   r     1 KV$SRD


   Procedure KVI$SETINPFLDBGNATR requires 489 words for executable code.
   Procedure KVI$SETINPFLDBGNATR requires 14 words of local(AUTO) storage.
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:533  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:534  
          MINI XREF LISTING

ADJ
       771**DCL       780<<ASSIGN    789<<ASSIGN    797<<ASSIGN    817>>IF        830>>IF
BGNATR_SUBCOMMON
       797**LABEL     785--GOTO      793--GOTO
ENDATR_SUBCOMMON
       865**LABEL     860--GOTO
KV$MRD.ABSGRPRND
       116**DCL       801>>ASSIGN    869>>ASSIGN
KV$MRD.ATRRQRDSPPST
       110**DCL       806>>IF        813>>IF        891>>IF        903>>IF
KV$MRD.NO_FLDTRM
       103**DCL       837>>IF        839>>IF        888>>IF
KV$MRD.WDT
        99**DCL       837>>IF        888>>IF
KV$MVD.DISPINPUT
       150**DCL       826>>IF
KV$PTR.INPCNDPND
        60**DCL        69--REDEF      73--REDEF
KV$PTR.LINLST$
        56**DCL        57--REDEF
KV$PTR.MRD$
        55**DCL       801>>ASSIGN    806>>IF        813>>IF        837>>IF        837>>IF        839>>IF
       869>>ASSIGN    888>>IF        888>>IF        891>>IF        903>>IF
KV$PTR.MVD$
        55**DCL       826>>IF
KV$PTR.SRD$
        56**DCL       802>>ASSIGN    806>>ASSIGN    806>>ASSIGN    822>>ASSIGN    822>>ASSIGN    824>>ASSIGN
       824>>ASSIGN    832>>IF        832>>IF        833>>ASSIGN    833>>ASSIGN    834>>ASSIGN    834>>ASSIGN
       835>>ASSIGN    835>>ASSIGN    837>>IF        838>>DOWHILE   840>>ASSIGN    844>>ASSIGN    847>>IF
       847>>IF        849>>ASSIGN    871>>ASSIGN    876>>IF        881>>ASSIGN    883>>IF        885>>ASSIGN
       887>>ASSIGN    888>>IF        888>>IF        890>>ASSIGN    892>>ASSIGN    892>>ASSIGN    894>>ASSIGN
       908>>ASSIGN
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:535  
KV$PTR$
        48**DCL        54--IMP-PTR   801>>ASSIGN    802>>ASSIGN    806>>IF        806>>ASSIGN    806>>ASSIGN
       813>>IF        822>>ASSIGN    822>>ASSIGN    824>>ASSIGN    824>>ASSIGN    826>>IF        832>>IF
       832>>IF        833>>ASSIGN    833>>ASSIGN    834>>ASSIGN    834>>ASSIGN    835>>ASSIGN    835>>ASSIGN
       837>>IF        837>>IF        837>>IF        838>>DOWHILE   839>>IF        840>>ASSIGN    844>>ASSIGN
       847>>IF        847>>IF        849>>ASSIGN    869>>ASSIGN    871>>ASSIGN    876>>IF        881>>ASSIGN
       883>>IF        885>>ASSIGN    887>>ASSIGN    888>>IF        888>>IF        888>>IF        888>>IF
       890>>ASSIGN    891>>IF        892>>ASSIGN    892>>ASSIGN    894>>ASSIGN    903>>IF        908>>ASSIGN
KV$SRD.BTMRHT
       284**DCL       289--REDEF
KV$SRD.BTMRHT.CLM
       286**DCL       832>>IF        885>>ASSIGN
KV$SRD.CRT
       360**DCL       365--REDEF     871>>ASSIGN
KV$SRD.CRTVRTLINPHSLIN
       332**DCL       822>>ASSIGN    892>>ASSIGN
KV$SRD.FLDEND
       324**DCL       329--REDEF     887<<ASSIGN    908<<ASSIGN
KV$SRD.FLDEND.CLM
       326**DCL       832>>IF        833<<ASSIGN    835<<ASSIGN    835>>ASSIGN    847>>IF        849>>ASSIGN
KV$SRD.FLDEND.LIN
       326**DCL       834<<ASSIGN    834>>ASSIGN    838>>DOWHILE
KV$SRD.HI_NONBLN
       394**DCL       399--REDEF     881<<ASSIGN
KV$SRD.HI_NONBLN_PST
       399**DCL       876>>IF
KV$SRD.ORG
       216**DCL       221--REDEF
KV$SRD.ORG.CLM
       218**DCL       844>>ASSIGN    888>>IF
KV$SRD.PRMVRTCLM
       332**DCL       802>>ASSIGN    806<<ASSIGN    806>>ASSIGN    890>>ASSIGN
KV$SRD.SRDEND
       429**DCL       434--REDEF
KV$SRD.SRDEND.CLM
       431**DCL       840>>ASSIGN    888>>IF        894>>ASSIGN
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:536  
KV$SRD.TOPLFT
       250**DCL       255--REDEF
KV$SRD.TOPLFT.CLM
       252**DCL       824>>ASSIGN    833>>ASSIGN    847>>IF        883>>IF
KV$SRD.WDT
       292**DCL       822>>ASSIGN    824>>ASSIGN    837>>IF        892>>ASSIGN
KV@USR_SETATR
       667**DCL       800<<ASSIGN    829<>CALL      841<>CALL      845<>CALL      850<>CALL      868<<ASSIGN
       872<>CALL      897<>CALL
KV@USR_SETATR.DLTFLD
       673**DCL       831<<ASSIGN    839>>IF        847>>IF
KV@USR_SETATR.GRPRND
       756**DCL       801<<ASSIGN    869<<ASSIGN
KV@USR_SETATR.GRPRND.HDN
       758**DCL       826<<ASSIGN
KV@USR_SETATR.PHSPST
       700**DCL       705--REDEF     871<<ASSIGN    881>>ASSIGN    887>>ASSIGN
KV@USR_SETATR.PHSPST.CLM
       702**DCL       802<<ASSIGN    816<<ASSIGN    816>>ASSIGN    822>>ASSIGN    824<<ASSIGN    824>>ASSIGN
       840<<ASSIGN    844<<ASSIGN    849<<ASSIGN    882<<ASSIGN    882>>ASSIGN    883>>IF        885<<ASSIGN
       894<<ASSIGN
KV@USR_SETATR.PHSPST.LIN
       702**DCL       822<<ASSIGN    838>>DOWHILE   843<<ASSIGN    843>>ASSIGN    884<<ASSIGN    884>>ASSIGN
       895>>DOWHILE   896<<ASSIGN    896>>ASSIGN
KV@USR_SETATR.PHSPST_PST
       705**DCL       876>>IF
KV@USR_SETATR.QLF.ACPALL
       731**DCL       809<<ASSIGN    819<<ASSIGN
KV@USR_SETATR.QLF.ACPNMR
       731**DCL       893<<ASSIGN
KV@USR_SETATR.QLF.PRT
       732**DCL       817<<ASSIGN    870<<ASSIGN
KVO$PST
       777**DCL-ENT   907--CALL
KVV$CALUSR
       778**DCL-ENT   829--CALL      841--CALL      845--CALL      850--CALL      872--CALL      897--CALL
PL6.E3A0      #003=KVI$SETINPFLDBGNATR File=KVI$INT.:E05TSI                      WED 07/30/97 02:04 Page:537  
KV_USR_SETATR
       470**DCL       800>>ASSIGN    868>>ASSIGN
KV_USR_SETATR.PHSPST
       503**DCL       508--REDEF
KV_VDH_PST_SPC_VRT
       593**DCL       907<>CALL
KV_VDH_PST_SPC_VRT.PSTVAL
       631**DCL       636--REDEF
SET
       767**DCL       781<<ASSIGN    788<<ASSIGN    796<<ASSIGN    803>>IF        830>>IF        858<<ASSIGN
       865<<ASSIGN    873>>IF
Y@TMPWRD
       775**DCL       890<<ASSIGN    891<<ASSIGN    891>>ASSIGN    892<<ASSIGN    892>>ASSIGN    895>>DOWHILE

PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:538  
     2866        1        /*T***********************************************************/
     2867        2        /*T*                                                         */
     2868        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2869        4        /*T*                                                         */
     2870        5        /*T***********************************************************/
     2871        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     2872        7        /*F* NAME: KVI$INTINPOPRX
     2873        8             PURPOSE: Set up a call to KVI$INTINPOPR to interpret the input
     2874        9             operators in the system input function table whose index is the
     2875       10             (SBIN) parameter. */
     2876       11
     2877       12        KVI$INTINPOPRX: PROC(INPOPRX);
     2878       13
     2879       14 S      %INCLUDE KV$GLB;
     2880       15 S      %INCLUDE KV$GLBCTX;
     2881       16        %INCLUDE KV$INPFNC;
     2882      575 S      %INCLUDE KV$VDH;
     2883      576        %KV$PTR;
     2884      619        %KV$MVD;
     2885      663        %KV$INPFNCTBL;
     2886      747        %KV$VDH_INTINPOPR (NAME=VDH_INTINPOPR, STCLASS=);
     2887      783        %KV$VDH_INTINPOPR (NAME=KV_VDH_INTINPOPR, STCLASS=SYMREF);
     2888      819
     2889      820    1   DCL INPOPRX SBIN;
     2890      821
     2891      822    1   DCL KVI$INTINPOPR ENTRY(1);
     2892      823
     2893      824        /* Set up the FPT. */
     2894      825
     2895      826    1      VDH_INTINPOPR = KV_VDH_INTINPOPR;
     2896      827    1      VDH_INTINPOPR.INPFNCTBL$ = %KV_MVD.SSTINPFNCTBL$;
     2897      828    1      VDH_INTINPOPR.INPOPRX = INPOPRX +
     2898      829    1        VDH_INTINPOPR.INPFNCTBL$->KV$INPFNCTBL.INPOPROFS;
     2899      830    1      CALL KVI$INTINPOPR (VDH_INTINPOPR);
     2900      831    1      RETURN;
     2901      832    1   END;
     2902      833        %EOD;
PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:539  

PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:540  
--  Include file information  --

   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVI$INTINPOPRX.

   Procedure KVI$INTINPOPRX requires 44 words for executable code.
   Procedure KVI$INTINPOPRX requires 14 words of local(AUTO) storage.

PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:541  

 Object Unit name= KVI$INTINPOPRX                             File name= KVI$INT.:E05TOU
 UTS= JUL 30 '97 02:04:58.80 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none    44     2C  KVI$INTINPOPRX

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KVI$INTINPOPRX

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KVI$INTINPOPR
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               KV_VDH_INTINPOPR                 r    G$ROS$
PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:542  


     2866        1        /*T***********************************************************/
     2867        2        /*T*                                                         */
     2868        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2869        4        /*T*                                                         */
     2870        5        /*T***********************************************************/
     2871        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     2872        7        /*F* NAME: KVI$INTINPOPRX
     2873        8             PURPOSE: Set up a call to KVI$INTINPOPR to interpret the input
     2874        9             operators in the system input function table whose index is the
     2875       10             (SBIN) parameter. */
     2876       11
     2877       12        KVI$INTINPOPRX: PROC(INPOPRX);

     12   0 000000  D380 0000 0000  xent KVI$INTINPOPRX  LNJ,B5   X6A_AUTO_1
          0 000003       000E 0001                       DC       14,1

     2878       13
     2879       14 S      %INCLUDE KV$GLB;
     2880       15 S      %INCLUDE KV$GLBCTX;
     2881       16        %INCLUDE KV$INPFNC;
     2882      575 S      %INCLUDE KV$VDH;
     2883      576        %KV$PTR;
     2884      619        %KV$MVD;
     2885      663        %KV$INPFNCTBL;
     2886      747        %KV$VDH_INTINPOPR (NAME=VDH_INTINPOPR, STCLASS=);
     2887      783        %KV$VDH_INTINPOPR (NAME=KV_VDH_INTINPOPR, STCLASS=SYMREF);
     2888      819
     2889      820    1   DCL INPOPRX SBIN;
     2890      821
     2891      822    1   DCL KVI$INTINPOPR ENTRY(1);
     2892      823
     2893      824        /* Set up the FPT. */
     2894      825
     2895      826    1      VDH_INTINPOPR = KV_VDH_INTINPOPR;

    826   0 000005  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_INTINPOPR
PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:543  
          0 000008  2C00                                 LDV,R2   0
          0 000009  6C0C                                 LDV,R6   12
          0 00000A  BB87                                 LAB,B3   ,AUTO
          0 00000B  3C0C                                 LDV,R3   12
          0 00000C  0008                                 MMM

     2896      827    1      VDH_INTINPOPR.INPFNCTBL$ = %KV_MVD.SSTINPFNCTBL$;

    827   0 00000D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000010  DCC6 0006                            LDB,B5   6,B6
          0 000012  CCC5 000A                            LDB,B4   10,B5
          0 000014  CFC7 0007                            STB,B4   VDH_INTINPOPR+1,AUTO

     2897      828    1      VDH_INTINPOPR.INPOPRX = INPOPRX +

    828   0 000016  DCC7 0004                            LDB,B5   @INPOPRX,AUTO
          0 000018  E805                                 LDR,R6   ,B5
          0 000019  EA44 002C                            ADD,R6   44,B4
          0 00001B  EF47 000A                            STR,R6   VDH_INTINPOPR+4,AUTO

     2898      829    1        VDH_INTINPOPR.INPFNCTBL$->KV$INPFNCTBL.INPOPROFS;
     2899      830    1      CALL KVI$INTINPOPR (VDH_INTINPOPR);

    830   0 00001D  ABC7 0006                            LAB,B2   VDH_INTINPOPR,AUTO
          0 00001F  AFC7 000C                            STB,B2   VDH_INTINPOPR+6,AUTO
          0 000021  BBC7 000C                            LAB,B3   VDH_INTINPOPR+6,AUTO
          0 000023  CBF0 0100                            LAB,B4   256,IMO
          0 000025  E380 0000 0000  xent                 LNJ,B6   KVI$INTINPOPR
          0 000028       0001                            DC       s:831,PREL

     2900      831    1      RETURN;

    831   0 000029  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     2901      832    1   END;
     2902      833        %EOD;

PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:544  
--  Include file information  --

   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVI$INTINPOPRX.
PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:545  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @INPOPRX                  *0-0-0/w SBIN(16)    r     1 INPOPRX
     6-0-0/w STRC(96)    r     1 VDH_INTINPOPR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(96)    r     1 KV_VDH_INTINPOPR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(736)   r     1 KV$INPFNCTBL               0-0-0/w STRC(512)   r     1 KV$MVD
     0-0-0/w STRC(480)   r     1 KV$PTR


   Procedure KVI$INTINPOPRX requires 44 words for executable code.
   Procedure KVI$INTINPOPRX requires 14 words of local(AUTO) storage.
PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:546  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KVI$INTINPOPRX File=KVI$INT.:E05TSI                           WED 07/30/97 02:04 Page:547  
          MINI XREF LISTING

INPOPRX
       820**DCL        12--PROC      828>>ASSIGN
KV$INPFNCTBL.INPOPROFS
       730**DCL       828>>ASSIGN
KV$MVD.SSTINPFNCTBL$
       643**DCL       827>>ASSIGN
KV$PTR.INPCNDPND
       603**DCL       612--REDEF     616--REDEF
KV$PTR.LINLST$
       599**DCL       600--REDEF
KV$PTR.MVD$
       598**DCL       827>>ASSIGN
KV$PTR$
       591**DCL       597--IMP-PTR   827>>ASSIGN
KVI$INTINPOPR
       822**DCL-ENT   830--CALL
KV_VDH_INTINPOPR
       810**DCL       826>>ASSIGN
VDH_INTINPOPR
       774**DCL       826<<ASSIGN    830<>CALL
VDH_INTINPOPR.INPFNCTBL$
       780**DCL       827<<ASSIGN    828>>ASSIGN
VDH_INTINPOPR.INPOPRX
       780**DCL       828<<ASSIGN

PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:548  
     2903        1        /*T***********************************************************/
     2904        2        /*T*                                                         */
     2905        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2906        4        /*T*                                                         */
     2907        5        /*T***********************************************************/
     2908        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     2909        7        /*F* NAME: KVI$OTPPRTID
     2910        8             PURPOSE: Types the ESC-G response. */
     2911        9
     2912       10        KVI$OTPPRTID: PROC;
     2913       11
     2914       12        %INCLUDE LCP_6;
     2915      203 S      %INCLUDE KV$GLB;
     2916      204 S      %INCLUDE KV$GLBCTX;
     2917      205 S      %INCLUDE KV_GLBCNS_E;
     2918      206 S      %INCLUDE KV$VDH;
     2919      207        %INCLUDE KH$CHN;
     2920      329
     2921      330        %KV$PTR;
     2922      373        %KV$SSN;
     2923      452        %KV$VDI;
     2924      523        %KH$CHN;
     2925      647    1   DCL KH_NODE# UBIN SYMREF;
     2926      648
     2927      649    1   DCL KVO$OTPLCL ENTRY(1);
     2928      650
     2929      651        %EQU PRTID='<NODE=00 SSNID=00 VDI=00000 PORT=0000>';
     2930      652    1   DCL Y_PRTID_TXT CHAR(0) CONSTANT INIT(%PRTID);
     2931      653    1   DCL HEXES CHAR(0) CONSTANT INIT('0123456789ABCDEF');
     2932      654        %KV$VDH_OTPLCL (NAME=KV_VDH_OTPLCL_PRTID, STCLASS=CONSTANT,
     2933      655         BYTSIZ="LENGTHC(Y_PRTID_TXT)", NONVRT=YES);
     2934      728        %KV$VDH_OTPLCL (NAME=VDH_OTPLCL, STCLASS=AUTO);
     2935      801
     2936      802    1   DCL PRTID_TXT CHAR(%(LENGTHC(PRTID)+12));
     2937      803    1   DCL OFFSET SBIN;
     2938      804    1   DCL PTR_VAL PTR;
     2939      805    1   DCL UBIN_VAL REDEF PTR_VAL UBIN(32);
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:549  
     2940      806    1   DCL 1 NIBBLE(0:7) REDEF PTR_VAL UBIN(4) UNAL;
     2941      807
     2942      808    1      PRTID_TXT = Y_PRTID_TXT;
     2943      809        /* insert session id */
     2944      810    1      CALL BINCHAR (SUBSTR(PRTID_TXT,15,2), %KV_SSN.SSNID);
     2945      811        /* insert VDI address */
     2946      812    1      OFFSET = 26;
     2947      813    1      PTR_VAL = KV$PTR.VDI$;
     2948      814    1      CALL HEX;
     2949      815        /* insert port number */
     2950      816    1      OFFSET = 36;
     2951      817    1      UBIN_VAL = %KH_CHN.TERMID.TERM.CHANNEL;
     2952      818    1      CALL HEX;
     2953      819        /* insert node number */
     2954      820    1      CALL BINCHAR (SUBSTR(PRTID_TXT,6,2), KH_NODE#);
     2955      821    1      VDH_OTPLCL = KV_VDH_OTPLCL_PRTID;
     2956      822    1      VDH_OTPLCL.BFR_.ADR$ = ADDR(PRTID_TXT);
     2957      823    2      IF %KH_CHN.TERMID.LEV>1 THEN DO;
     2958      824    2         OFFSET = %KH_CHN.TERMID.TERM.SUBDEVICE;
     2959      825    2         CALL SUBDEVICE;
     2960      826    2         IF %KH_CHN.TERMID.LEV = 2 THEN EXIT;
     2961      827    2         OFFSET = %KH_CHN.TERMID.TERM.SUBSUBDEVICE;
     2962      828    2         CALL SUBDEVICE;
     2963      829    2      END;
     2964      830    1      CALL KVO$OTPLCL (VDH_OTPLCL);
     2965      831    1      RETURN;
     2966      832        %EJECT;
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:550  
     2967      833    1   SUBDEVICE: PROC;
     2968      834    2   DCL I SBIN;
     2969      835    2      I = 1;
     2970      836    2      IF OFFSET>999 THEN IF OFFSET>9999 THEN I = 5;
     2971      837    2      ELSE I = 4;
     2972      838    2      ELSE IF OFFSET>99 THEN OFFSET = 3;
     2973      839    2      ELSE IF OFFSET>9 THEN OFFSET = 2;
     2974      840    2      SUBSTR (PRTID_TXT, VDH_OTPLCL.BFR_.BYTSIZ-1, 1) = '-';
     2975      841    2      CALL BINCHAR (SUBSTR (PRTID_TXT, VDH_OTPLCL.BFR_.BYTSIZ, I), OFFSET);
     2976      842    2      VDH_OTPLCL.BFR_.BYTSIZ = VDH_OTPLCL.BFR_.BYTSIZ + I + 1;
     2977      843    2      SUBSTR (PRTID_TXT, VDH_OTPLCL.BFR_.BYTSIZ-1, 1) = '>';
     2978      844    2   END SUBDEVICE;
     2979      845
     2980      846    1   HEX: PROC;
     2981      847    3      DO UNTIL UBIN_VAL=0;
     2982      848    3         CALL INSERT (PRTID_TXT,OFFSET,1, SUBSTR(HEXES,NIBBLE(7),1));
     2983      849    3         UBIN_VAL = UBIN_VAL/16;
     2984      850    3         OFFSET = OFFSET-1;
     2985      851    3      END;
     2986      852    2      RETURN;
     2987      853    2   END;
     2988      854    1   END;

PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:551  
--  Include file information  --

   KH$CHN.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVI$OTPPRTID.

   Procedure KVI$OTPPRTID requires 238 words for executable code.
   Procedure KVI$OTPPRTID requires 44 words of local(AUTO) storage.

    No errors detected in file KVI$INT.:E05TSI    .

PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:552  

 Object Unit name= KVI$OTPPRTID                               File name= KVI$INT.:E05TOU
 UTS= JUL 30 '97 02:05:05.16 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     32     20  KVI$OTPPRTID
    1   Proc  even  none   238     EE  KVI$OTPPRTID

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  KVI$OTPPRTID

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KVO$OTPLCL
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               KH_NODE#                         r    G$ROS$
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:553  


     2903        1        /*T***********************************************************/
     2904        2        /*T*                                                         */
     2905        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2906        4        /*T*                                                         */
     2907        5        /*T***********************************************************/
     2908        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     2909        7        /*F* NAME: KVI$OTPPRTID
     2910        8             PURPOSE: Types the ESC-G response. */
     2911        9
     2912       10        KVI$OTPPRTID: PROC;

     10   1 000000  D380 0000 0000  xent KVI$OTPPRTID    LNJ,B5   X6A_AUTO_0
          1 000003       002C 0000                       DC       44,0

     2913       11
     2914       12        %INCLUDE LCP_6;
     2915      203 S      %INCLUDE KV$GLB;
     2916      204 S      %INCLUDE KV$GLBCTX;
     2917      205 S      %INCLUDE KV_GLBCNS_E;
     2918      206 S      %INCLUDE KV$VDH;
     2919      207        %INCLUDE KH$CHN;
     2920      329
     2921      330        %KV$PTR;
     2922      373        %KV$SSN;
     2923      452        %KV$VDI;
     2924      523        %KH$CHN;
     2925      647    1   DCL KH_NODE# UBIN SYMREF;
     2926      648
     2927      649    1   DCL KVO$OTPLCL ENTRY(1);
     2928      650
     2929      651        %EQU PRTID='<NODE=00 SSNID=00 VDI=00000 PORT=0000>';
     2930      652    1   DCL Y_PRTID_TXT CHAR(0) CONSTANT INIT(%PRTID);
     2931      653    1   DCL HEXES CHAR(0) CONSTANT INIT('0123456789ABCDEF');
     2932      654        %KV$VDH_OTPLCL (NAME=KV_VDH_OTPLCL_PRTID, STCLASS=CONSTANT,
     2933      655         BYTSIZ="LENGTHC(Y_PRTID_TXT)", NONVRT=YES);
     2934      728        %KV$VDH_OTPLCL (NAME=VDH_OTPLCL, STCLASS=AUTO);
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:554  
     2935      801
     2936      802    1   DCL PRTID_TXT CHAR(%(LENGTHC(PRTID)+12));
     2937      803    1   DCL OFFSET SBIN;
     2938      804    1   DCL PTR_VAL PTR;
     2939      805    1   DCL UBIN_VAL REDEF PTR_VAL UBIN(32);
     2940      806    1   DCL 1 NIBBLE(0:7) REDEF PTR_VAL UBIN(4) UNAL;
     2941      807
     2942      808    1      PRTID_TXT = Y_PRTID_TXT;

    808   1 000005  EB80 0000 0000  00                   LAB,B6   Y_PRTID_TXT
          1 000008  4C26                                 LDV,R4   38
          1 000009  D870 2032                            LDR,R5   8242,IMO
          1 00000B  0021                                 ALR      ;
          1 00000C       4006 0000                                ALPHANUM(0,B6,,R4),;
          1 00000E       4007 0009                                ALPHANUM(PRTID_TXT,AUTO,,R5,FILL)

     2943      809        /* insert session id */
     2944      810    1      CALL BINCHAR (SUBSTR(PRTID_TXT,15,2), %KV_SSN.SSNID);

    810   1 000010  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000013  437F                                 CSYNC    s:810+2,SPREL
          1 000014  DCC6 0002                            LDB,B5   2,B6
          1 000016  F2C5 0037                            LLH,R7   55,B5
          1 000018  6C00                                 LDV,R6   0
          1 000019  8D47 002A                            SDI      I+2,AUTO
          1 00001B  0027                                 CBD      ;
          1 00001C       0407 002A                                BINARY(I+2,AUTO,,4),;
          1 00001E       8207 0010                                UNPACKED(PRTID_TXT+7,AUTO,1,2,UNSIGNED)

     2945      811        /* insert VDI address */
     2946      812    1      OFFSET = 26;

    812   1 000020  3C1A                                 LDV,R3   26
          1 000021  BF47 0022                            STR,R3   OFFSET,AUTO

     2947      813    1      PTR_VAL = KV$PTR.VDI$;

PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:555  
    813   1 000023  437F                                 CSYNC    s:812+2,SPREL
          1 000024  DC86                                 LDB,B5   ,B6
          1 000025  DFC7 0023                            STB,B5   PTR_VAL,AUTO

     2948      814    1      CALL HEX;

    814   1 000027  E3C0 00A8                            LNJ,B6   s:0,PREL
          1 000029       0001                            DC       s:816,PREL

     2949      815        /* insert port number */
     2950      816    1      OFFSET = 36;

    816   1 00002A  6C24                                 LDV,R6   36
          1 00002B  EF47 0022                            STR,R6   OFFSET,AUTO

     2951      817    1      UBIN_VAL = %KH_CHN.TERMID.TERM.CHANNEL;

    817   1 00002D  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000030  DC86                                 LDB,B5   ,B6
          1 000031  CC85                                 LDB,B4   ,B5
          1 000032  F844 0013                            LDR,R7   19,B4
          1 000034  6C00                                 LDV,R6   0
          1 000035  8D47 0023                            SDI      PTR_VAL,AUTO

     2952      818    1      CALL HEX;

    818   1 000037  E3C0 0098                            LNJ,B6   s:0,PREL
          1 000039       0001                            DC       s:820,PREL

     2953      819        /* insert node number */
     2954      820    1      CALL BINCHAR (SUBSTR(PRTID_TXT,6,2), KH_NODE#);

    820   1 00003A  F800 0000 0000  xsym                 LDR,R7   KH_NODE#
          1 00003D  6C00                                 LDV,R6   0
          1 00003E  8D47 002A                            SDI      I+2,AUTO
          1 000040  0027                                 CBD      ;
          1 000041       0407 002A                                BINARY(I+2,AUTO,,4),;
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:556  
          1 000043       0207 000C                                UNPACKED(PRTID_TXT+3,AUTO,,2,UNSIGNED)

     2955      821    1      VDH_OTPLCL = KV_VDH_OTPLCL_PRTID;

    821   1 000045  AB80 0000 0000  00                   LAB,B2   Y_PRTID_TXT
          1 000048  2C36                                 LDV,R2   54
          1 000049  6C0A                                 LDV,R6   10
          1 00004A  BB87                                 LAB,B3   ,AUTO
          1 00004B  3C08                                 LDV,R3   8
          1 00004C  437F                                 CSYNC    s:821+6,SPREL
          1 00004D  0008                                 MMM

     2956      822    1      VDH_OTPLCL.BFR_.ADR$ = ADDR(PRTID_TXT);

    822   1 00004E  EBC7 0009                            LAB,B6   PRTID_TXT,AUTO
          1 000050  EFC7 0005                            STB,B6   VDH_OTPLCL+1,AUTO

     2957      823    2      IF %KH_CHN.TERMID.LEV>1 THEN DO;

    823   1 000052  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000055  CC85                                 LDB,B4   ,B5
          1 000056  AC84                                 LDB,B2   ,B4
          1 000057  E842 0012                            LDR,R6   18,B2
          1 000059  E570 00FF                            AND,R6   255,IMO
          1 00005B  6D01                                 CMV,R6   1
          1 00005C  0381 001B                            BLE      s:830,PREL

     2958      824    2         OFFSET = %KH_CHN.TERMID.TERM.SUBDEVICE;

    824   1 00005E  D842 0014                            LDR,R5   20,B2
          1 000060  DF47 0022                            STR,R5   OFFSET,AUTO

     2959      825    2         CALL SUBDEVICE;

    825   1 000062  E3C0 0024                            LNJ,B6   s:0,PREL
          1 000064       0001                            DC       s:826,PREL

PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:557  
     2960      826    2         IF %KH_CHN.TERMID.LEV = 2 THEN EXIT;

    826   1 000065  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000068  DC86                                 LDB,B5   ,B6
          1 000069  CC85                                 LDB,B4   ,B5
          1 00006A  E844 0012                            LDR,R6   18,B4
          1 00006C  E570 00FF                            AND,R6   255,IMO
          1 00006E  6D02                                 CMV,R6   2
          1 00006F  0901 0008                            BE       s:830,PREL

     2961      827    2         OFFSET = %KH_CHN.TERMID.TERM.SUBSUBDEVICE;

    827   1 000071  D844 0015                            LDR,R5   21,B4
          1 000073  DF47 0022                            STR,R5   OFFSET,AUTO

     2962      828    2         CALL SUBDEVICE;

    828   1 000075  E3C0 0011                            LNJ,B6   s:0,PREL
          1 000077       0001                            DC       s:830,PREL

     2963      829    2      END;

     2964      830    1      CALL KVO$OTPLCL (VDH_OTPLCL);

    830   1 000078  EBC7 0004                            LAB,B6   VDH_OTPLCL,AUTO
          1 00007A  EFC7 002A                            STB,B6   I+2,AUTO
          1 00007C  BBC7 002A                            LAB,B3   I+2,AUTO
          1 00007E  CBF0 0100                            LAB,B4   256,IMO
          1 000080  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 000083       0001                            DC       s:831,PREL

     2965      831    1      RETURN;

    831   1 000084  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     2966      832        %EJECT;
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:558  
     2967      833    1   SUBDEVICE: PROC;

    833   1 000087  EFC7 0026            SUBDEVICE       STB,B6   PTR_VAL+3,AUTO

     2968      834    2   DCL I SBIN;
     2969      835    2      I = 1;

    835   1 000089  6C01                                 LDV,R6   1
          1 00008A  EF47 0028                            STR,R6   I,AUTO

     2970      836    2      IF OFFSET>999 THEN IF OFFSET>9999 THEN I = 5;

    836   1 00008C  D847 0022                            LDR,R5   OFFSET,AUTO
          1 00008E  D970 03E7                            CMR,R5   999,IMO
          1 000090  0A81 000F                            BALE     s:838,PREL

    836   1 000092  D970 270F                            CMR,R5   9999,IMO
          1 000094  0A81 0006                            BALE     s:837,PREL

    836   1 000096  6C05                                 LDV,R6   5
          1 000097  EF47 0028                            STR,R6   I,AUTO
          1 000099  0F81 0014                            B        s:840,PREL

     2971      837    2      ELSE I = 4;

    837   1 00009B  6C04                                 LDV,R6   4
          1 00009C  EF47 0028                            STR,R6   I,AUTO
          1 00009E  0F81 000F                            B        s:840,PREL

     2972      838    2      ELSE IF OFFSET>99 THEN OFFSET = 3;

    838   1 0000A0  5D63                                 CMV,R5   99
          1 0000A1  0A81 0006                            BALE     s:839,PREL

    838   1 0000A3  5C03                                 LDV,R5   3
          1 0000A4  DF47 0022                            STR,R5   OFFSET,AUTO
          1 0000A6  0F81 0007                            B        s:840,PREL
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:559  

     2973      839    2      ELSE IF OFFSET>9 THEN OFFSET = 2;

    839   1 0000A8  5D09                                 CMV,R5   9
          1 0000A9  0A81 0004                            BALE     s:840,PREL

    839   1 0000AB  5C02                                 LDV,R5   2
          1 0000AC  DF47 0022                            STR,R5   OFFSET,AUTO

     2974      840    2      SUBSTR (PRTID_TXT, VDH_OTPLCL.BFR_.BYTSIZ-1, 1) = '-';

    840   1 0000AE  4C2D                                 LDV,R4   45
          1 0000AF  B847 0008                            LDR,R3   VDH_OTPLCL+4,AUTO
          1 0000B1  3E11                                 ADV,R3   17
          1 0000B2  C7B7                                 STH,R4   ,AUTO,R3

     2975      841    2      CALL BINCHAR (SUBSTR (PRTID_TXT, VDH_OTPLCL.BFR_.BYTSIZ, I), OFFSET);

    841   1 0000B3  E855                                 LDR,R6   R5
          1 0000B4  70F0                                 DAR,R7   16
          1 0000B5  8D47 002A                            SDI      I+2,AUTO
          1 0000B7  B847 0008                            LDR,R3   VDH_OTPLCL+4,AUTO
          1 0000B9  D847 0028                            LDR,R5   I,AUTO
          1 0000BB  0027                                 CBD      ;
          1 0000BC       0407 002A                                BINARY(I+2,AUTO,,4),;
          1 0000BE       0037 0009                                UNPACKED(PRTID_TXT,AUTO,R3,,R5,UNSIGNED)

     2976      842    2      VDH_OTPLCL.BFR_.BYTSIZ = VDH_OTPLCL.BFR_.BYTSIZ + I + 1;

    842   1 0000C0  437F                                 CSYNC    s:841+12,SPREL
          1 0000C1  E847 0008                            LDR,R6   VDH_OTPLCL+4,AUTO
          1 0000C3  EA47 0028                            ADD,R6   I,AUTO
          1 0000C5  6E01                                 ADV,R6   1
          1 0000C6  EF47 0008                            STR,R6   VDH_OTPLCL+4,AUTO

     2977      843    2      SUBSTR (PRTID_TXT, VDH_OTPLCL.BFR_.BYTSIZ-1, 1) = '>';

PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:560  
    843   1 0000C8  5C3E                                 LDV,R5   62
          1 0000C9  B856                                 LDR,R3   R6
          1 0000CA  3E11                                 ADV,R3   17
          1 0000CB  D7B7                                 STH,R5   ,AUTO,R3

     2978      844    2   END SUBDEVICE;

    844   1 0000CC  ECC7 0026                            LDB,B6   PTR_VAL+3,AUTO
          1 0000CE  C3C6 0001                            LNJ,B4   1,B6

     2979      845
     2980      846    1   HEX: PROC;

    846   1 0000D0  EFC7 0026            HEX             STB,B6   PTR_VAL+3,AUTO

     2981      847    3      DO UNTIL UBIN_VAL=0;

     2982      848    3         CALL INSERT (PRTID_TXT,OFFSET,1, SUBSTR(HEXES,NIBBLE(7),1));

    848   1 0000D2  E847 0024                            LDR,R6   PTR_VAL+1,AUTO
          1 0000D4  E570 000F                            AND,R6   15,IMO
          1 0000D6  B856                                 LDR,R3   R6
          1 0000D7  D0B0 0000 0013  00                   LDH,R5   HEXES,R3
          1 0000DA  A847 0022                            LDR,R2   OFFSET,AUTO
          1 0000DC  2E12                                 ADV,R2   18
          1 0000DD  D7A7                                 STH,R5   ,AUTO,R2

     2983      849    3         UBIN_VAL = UBIN_VAL/16;

    849   1 0000DE  8CC7 0023                            LDI      PTR_VAL,AUTO
          1 0000E0  70C4                                 DOR,R7   4
          1 0000E1  8D47 0023                            SDI      PTR_VAL,AUTO

     2984      850    3         OFFSET = OFFSET-1;

    850   1 0000E3  88C7 0022                            DEC      OFFSET,AUTO

PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:561  
     2985      851    3      END;

    851   1 0000E5  84F0 0000 0000                       SID      0,IMO
          1 0000E8  69EA                                 BNEZ,R6  s:848,SPREL
          1 0000E9  79E9                                 BNEZ,R7  s:848,SPREL

     2986      852    2      RETURN;

    852   1 0000EA  ECC7 0026                            LDB,B6   PTR_VAL+3,AUTO
          1 0000EC  C3C6 0001                            LNJ,B4   1,B6
     2987      853    2   END;
     2988      854    1   END;

PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:562  
--  Include file information  --

   KH$CHN.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KVI$OTPPRTID.
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:563  

 **** Variables and constants ****

  ****  Section 000 RoData KVI$OTPPRTID

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    13-0-0/c CHAR(16)    r     1 HEXES                     1B-0-0/w STRC(80)    r     1 KV_VDH_OTPLCL_PRTID
     0-0-0/c CHAR(38)    r     1 Y_PRTID_TXT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    28-0-0/w SBIN(16)    r     1 I                         23-0-0/w UBIN(4)     r     1 NIBBLE(0:7)
    22-0-0/w SBIN(16)    r     1 OFFSET                     9-0-0/c CHAR(50)    r     1 PRTID_TXT
    23-0-0/w PTR         r     1 PTR_VAL                   23-0-0/w UBIN(32)    r     1 UBIN_VAL
     4-0-0/w STRC(80)    r     1 VDH_OTPLCL

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 KH_NODE#                   0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(1024)  r     1 KV$SSN                     0-0-0/w STRC(512)   r     1 KV$VDI

PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:564  

   Procedure KVI$OTPPRTID requires 238 words for executable code.
   Procedure KVI$OTPPRTID requires 44 words of local(AUTO) storage.

    No errors detected in file KVI$INT.:E05TSI    .
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:565  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:566  
          MINI XREF LISTING

HEX
       846**PROC      814--CALL      818--CALL
HEXES
       653**DCL       848>>CALLBLT
I IN PROCEDURE SUBDEVICE
       834**DCL       835<<ASSIGN    836<<ASSIGN    837<<ASSIGN    841>>CALLBLT   842>>ASSIGN
KH$CHN.TERMID.LEV
       634**DCL       823>>IF        826>>IF
KH$CHN.TERMID.TERM
       634**DCL       643--REDEF
KH$CHN.TERMID.TERM.CHANNEL
       640**DCL       817>>ASSIGN
KH$CHN.TERMID.TERM.SUBDEVICE
       640**DCL       824>>ASSIGN
KH$CHN.TERMID.TERM.SUBSUBDEVICE
       640**DCL       827>>ASSIGN
KH_NODE#
       647**DCL       820>>CALLBLT
KV$PTR.INPCNDPND
       357**DCL       366--REDEF     370--REDEF
KV$PTR.LINLST$
       353**DCL       354--REDEF
KV$PTR.SSN$
       351**DCL       810>>CALLBLT
KV$PTR.VDI$
       351**DCL       813>>ASSIGN    817>>ASSIGN    823>>IF        824>>ASSIGN    826>>IF        827>>ASSIGN
KV$PTR$
       345**DCL       351--IMP-PTR   810>>CALLBLT   813>>ASSIGN    817>>ASSIGN    823>>IF        824>>ASSIGN
       826>>IF        827>>ASSIGN
KV$SSN.REDRSPCNT
       402**DCL       403--REDEF
KV$SSN.SSNID
PL6.E3A0      #005=KVI$OTPPRTID File=KVI$INT.:E05TSI                             WED 07/30/97 02:05 Page:567  
       446**DCL       810>>CALLBLT
KV$VDI.CHN$
       473**DCL       817>>ASSIGN    823>>IF        824>>ASSIGN    826>>IF        827>>ASSIGN
KVO$OTPLCL
       649**DCL-ENT   830--CALL
KV_VDH_OTPLCL_PRTID
       691**DCL       821>>ASSIGN
NIBBLE
       806**DCL       848>>CALLBLT
OFFSET
       803**DCL       812<<ASSIGN    816<<ASSIGN    824<<ASSIGN    827<<ASSIGN    836>>IF        836>>IF
       838>>IF        838<<ASSIGN    839>>IF        839<<ASSIGN    841>>CALLBLT   848>>CALLBLT   850<<ASSIGN
       850>>ASSIGN
PRTID_TXT
       802**DCL       808<<ASSIGN    810<<CALLBLT   820<<CALLBLT   822--ASSIGN    840<<ASSIGN    841<<CALLBLT
       843<<ASSIGN    848<<CALLBLT
PTR_VAL
       804**DCL       805--REDEF     806--REDEF     813<<ASSIGN
SUBDEVICE
       833**PROC      825--CALL      828--CALL
UBIN_VAL
       805**DCL       817<<ASSIGN    847>>DOUNTIL   849<<ASSIGN    849>>ASSIGN
VDH_OTPLCL
       764**DCL       821<<ASSIGN    830<>CALL
VDH_OTPLCL.BFR_.ADR$
       797**DCL       822<<ASSIGN
VDH_OTPLCL.BFR_.BYTSIZ
       797**DCL       840>>ASSIGN    841>>CALLBLT   842<<ASSIGN    842>>ASSIGN    843>>ASSIGN
Y_PRTID_TXT
       652**DCL       725--DCLINIT   808>>ASSIGN
