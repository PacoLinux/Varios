VERSION E05

Elsie.D00  KAC$CLC - ASYNC CCP'S / ASSEMBLY INITIALIZATION                      TUE JUL 29 '97 23:55 Page:1
        1                     *M* KAC$CLC ASYNC HANDLER MLCP-RESIDENT PROCEDURE AND DATA
        2                     *T***********************************************************
        3                     *T*                                                         *
        4                     *T* Copyright (c) Bull HN Information Systems Inc., 1997    *
        5                     *T*                                                         *
        6                     *T***********************************************************
        7                     *X* NSO
        8     1                TITLE 'KAC$CLC - ASYNC CCP''S / ASSEMBLY INITIALIZATION'
        9     2                   OUNAME    KAC$MLCP
       10     3                   BIAS      START='200'X,END='BFF'X  Leave room for COLTS, DEBUG, etc.
       11                     *
       12                     *
       13     4                   INCLUDE   KW_LCT_E              COMMON LCT DEFINITONS
       14   311                   INCLUDE   KW_ALCT_E             ASYNC LCT DEFINITIONS
       15   459                   INCLUDE   KA_LCT_E              ASYNC LCT DEFINITIONS
       16   577                   INCLUDE   KV_ASCCHR_E           ASCII CHARACTER EQU'S
       17   708                   INCLUDE   KV_GLBASM_E           FONT DEFINITIONS
       18   714                   INCLUDE   KA_GLBASM_E           INPUT AND OUTPUT FUNCTION DEFINITIONS


Elsie.D00  KAC$CLC - ASYNC CCP'S / LCT INITIALIZATION                           TUE JUL 29 '97 23:55 Page:2
       20   747                TITLE 'KAC$CLC - ASYNC CCP''S / LCT INITIALIZATION'
       21   748               KAC$LCTS    LCTS
       22   749                   LCT     LOC=KW#LCT5,VALUE=1           INHIBIT PAUSE
 LC2-00096-0   WARNING: The byte specified (5) has been defined as
               being reserved for firmware use.
       23   750                   LCT     LOC=KW#LCT37,VALUE=1          INHIBIT PAUSE
       24   751                   LCT     LOC=KW#STPBTS,VALUE=0         8/10
       25   752                   ADDR    LOC=KW#RCVCCP$,REF=Y$INPCCP   RCV CCP POINTER
       26   753                   LCT     LOC=KW#RCVRTRCHNLSB,VALUE=0   RCV RETURN CHANNEL NUMBER
       27   754                   LCT     LOC=KW#RCVSTTMSK,VALUE='E0'X  DSR, CTS, CD
       28   755                   LCT     LOC=KW#CLACTR,VALUE=(KW#CLACTR_DTR@S|;
       29                                                      KW#CLACTR_RTS@S)
       30   756                   ADDR    LOC=KW#TRNCCP$,REF=Y$OTPCCP   TRANSMIT CCP POINTER
       31   757                   LCT     LOC=KW#TRNRTRCHNLSB,VALUE=0   TRN RETURN CHANNEL NUMBER
       32   758                   LCT     LOC=KA_LCT_INTCNF,VALUE=KW#LINSPD300 300 BAUD DEFAULT
       33   759                   ADDR    LOC=KA_LCT_OTPTBL$,REF=OTPTBL  OUTPUT TABLE POINTER
       34   760                   ENDLCTS
                 000 00000000 0001047C 00000000 000000E0
                 010 00000000 C0000000 00000003 18000000
                 020 00000000 0001087D 00000000 00000000
                 030 00000000 00000000 06000000 00000000
                 040 00000000 00000000 00000000 00000000
                 050 00000000 00000000 00000000 00000000
                 060 00000000 00000000 00000000 00000000
                 070 00000000 00000000 00000000 00000000
                 080 00000000 00000000 00000000 00000000
                 090 00000000 00000000 00000000 00000000
                 0A0 00000000 00000000 00000000 00000000
                 0B0 00000000 00000000 00000000 00000000
                 0C0 00000000 00000000 00000000 00000000
                 0D0 00000000 00000000 00000000 00000000
                 0E0 00000000 00000000 00000000 00000000
                 0F0 00000000 00000000 00000000 00000000


Elsie.D00  KAC$CLC - ASYNC CCP'S / AUTO-BAUD TABLES                             TUE JUL 29 '97 23:55 Page:3
       36   762                TITLE 'KAC$CLC - ASYNC CCP''S / AUTO-BAUD TABLES'
       37                     *
       38                     * AUTO-BAUD FUNCTION TABLE
       39                     *
       40                     * Function number
       41   763  000          Y#AUTBADFNC_NUL    EQU    0    null character received
       42   764  001          Y#AUTBADFNC_PNT5X  EQU    1    terminal spd is .5 current spd
       43   765  002          Y#AUTBADFNC_PNT75X EQU    2    terminal spd is .75 current spd
       44   766  003          Y#AUTBADFNC_2X     EQU    3    terminal spd is 2x current spd
       45   767  004          Y#AUTBADFNC_3X     EQU    4    terminal spd is 3x current spd
       46   768  005          Y#AUTBADFNC_4X     EQU    5    terminal spd is 4x current spd
       47   769  006          Y#AUTBADFNC_200BAD EQU    6    terminal spd is 200 baud
       48   770  007          Y#AUTBADFNC_BASLINSPD EQU 7
       49                     * Function 7 is loading speed indicator, i.e.
       50                     *   spd-index = 0  -->  return '04'X in R register (150 baud)
       51                     *   spd-index = 8  -->  return '07'X in R register (600 baud)
       52                     *   spd-index =16  -->  return '0D'X in R register (4800 baud)
       53                     *
       54                     *
       55   771  200          AUTBADFNC TABLE     TLU=Y$INPAUTBADFNCTBL_TLU,SIZE=24,NODEFAULT
       56                     *
       57                     * These entries for base line speed at 150 baud
       58                     *
       59   772                         TRANSFER  IN=Y#AUTBADFNC_NUL,TARGET=Y$INPAUTBAD65
       60   773                         TRANSFER  IN=Y#AUTBADFNC_PNT5X,TARGET=Y$INPAUTBAD62
       61   774                         TRANSLATE IN=Y#AUTBADFNC_PNT75X,;
       62                                         OUT=KW#LINSPD110|KA_LCT_AUTBADFNC_FRMERROK@S
       63   775                         TRANSLATE IN=Y#AUTBADFNC_2X,OUT=KW#LINSPD300
       64   776                         TRANSFER  IN=Y#AUTBADFNC_3X,TARGET=Y$INPAUTBAD62
       65   777                         TRANSLATE IN=Y#AUTBADFNC_4X,OUT=KW#LINSPD600
       66   778                         TRANSLATE IN=Y#AUTBADFNC_200BAD,OUT=KW#LINSPD200
       67   779                         TRANSLATE IN=Y#AUTBADFNC_BASLINSPD,OUT=KW#LINSPD150
       68                     *
       69                     * These entries for base line speed at 600 baud
       70                     *
       71   780                         TRANSLATE IN='08'X|Y#AUTBADFNC_NUL,OUT=KW#LINSPD300
Elsie.D00  KAC$CLC - ASYNC CCP'S / AUTO-BAUD TABLES                             TUE JUL 29 '97 23:55 Page:4
       72   781                         TRANSLATE IN='08'X|Y#AUTBADFNC_PNT5X,OUT=KW#LINSPD300
       73   782                         TRANSFER  IN='08'X|Y#AUTBADFNC_PNT75X,TARGET=Y$INPAUTBAD62
       74   783                         TRANSLATE IN='08'X|Y#AUTBADFNC_2X,OUT=KW#LINSPD1200
       75   784                         TRANSLATE IN='08'X|Y#AUTBADFNC_3X,OUT=KW#LINSPD1800
       76   785                         TRANSLATE IN='08'X|Y#AUTBADFNC_4X,OUT=KW#LINSPD2400
       77   786                         TRANSFER  IN='08'X|Y#AUTBADFNC_200BAD,TARGET=Y$INPAUTBAD62
       78   787                         TRANSLATE IN='08'X|Y#AUTBADFNC_BASLINSPD,OUT=KW#LINSPD600
       79                     *
       80                     * These entries for base line speed at 4800 baud
       81                     *
       82   788                         TRANSLATE IN='10'X|Y#AUTBADFNC_NUL,OUT=KW#LINSPD2400
       83   789                         TRANSLATE IN='10'X|Y#AUTBADFNC_PNT5X,OUT=KW#LINSPD2400
       84   790                         TRANSFER  IN='10'X|Y#AUTBADFNC_PNT75X,TARGET=Y$INPAUTBAD62
       85   791                         TRANSLATE IN='10'X|Y#AUTBADFNC_2X,OUT=KW#LINSPD9600
       86   792                         TRANSFER  IN='10'X|Y#AUTBADFNC_3X,TARGET=Y$INPAUTBAD62
       87   793                         TRANSLATE IN='10'X|Y#AUTBADFNC_4X,OUT=KW#LINSPD19200
       88   794                         TRANSFER  IN='10'X|Y#AUTBADFNC_200BAD,TARGET=Y$INPAUTBAD62
       89   795                         TRANSLATE IN='10'X|Y#AUTBADFNC_BASLINSPD,OUT=KW#LINSPD4800
       90   796               AUTBADFNC ENDTABLE
                 200 A8A24206 A2070504 0606A209 0A0CA207
                 210 0C0CA20E A20FA20D
       91                     *
       92                     * Autobaud character table
       93                     *
       94   797  218          AUTBADCHR TABLE     DTRANSFER=Y$INPAUTBAD60,TLU=Y$INPAUTBADCHRTBL_TLU
       95   798                         TRANSLATE IN='00'X,OUT=Y#AUTBADFNC_NUL
       96   799                         TRANSFER  IN='38'X,TARGET=Y$INPAUTBAD56
       97   800                         TRANSLATE IN='40'X,OUT=Y#AUTBADFNC_PNT5X
       98   801                         TRANSLATE IN='80'X,OUT=Y#AUTBADFNC_PNT5X
       99   802                         TRANSFER  IN='B8'X,TARGET=Y$INPAUTBAD55
      100   803                         TRANSLATE IN='C0'X,OUT=Y#AUTBADFNC_PNT5X
      101   804                         TRANSLATE IN='CC'X,OUT=Y#AUTBADFNC_200BAD
      102   805                         TRANSLATE IN='DC'X,OUT=Y#AUTBADFNC_200BAD
      103   806                         TRANSLATE IN='E0'X,OUT=Y#AUTBADFNC_PNT75X
      104   807                         TRANSLATE IN='EC'X,OUT=Y#AUTBADFNC_200BAD
      105   808                         TRANSLATE IN='F0'X,OUT=Y#AUTBADFNC_PNT75X
Elsie.D00  KAC$CLC - ASYNC CCP'S / AUTO-BAUD TABLES                             TUE JUL 29 '97 23:55 Page:5
      106   809                         TRANSLATE IN='F2'X,OUT=Y#AUTBADFNC_2X
      107   810                         TRANSLATE IN='F6'X,OUT=Y#AUTBADFNC_2X
      108   811                         TRANSLATE IN='FA'X,OUT=Y#AUTBADFNC_2X
      109   812                         TRANSLATE IN='FC'X,OUT=Y#AUTBADFNC_200BAD
      110   813                         TRANSLATE IN='FD'X,OUT=Y#AUTBADFNC_3X
      111   814                         TRANSLATE IN='FE'X,OUT=Y#AUTBADFNC_2X
      112   815                         TRANSLATE IN='FF'X,OUT=Y#AUTBADFNC_4X
      113   816               AUTBADCHR ENDTABLE
                 218 00A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 228 A4A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 238 A4A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 248 A4A4A4A4 A4A4A4A4 9AA4A4A4 A4A4A4A4
                 258 01A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 268 A4A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 278 A4A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 288 A4A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 298 01A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 2A8 A4A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 2B8 A4A4A4A4 A4A4A4A4 A4A4A4A4 A4A4A4A4
                 2C8 A4A4A4A4 A4A4A4A4 94A4A4A4 A4A4A4A4
                 2D8 01A4A4A4 A4A4A4A4 A4A4A4A4 06A4A4A4
                 2E8 A4A4A4A4 A4A4A4A4 A4A4A4A4 06A4A4A4
                 2F8 02A4A4A4 A4A4A4A4 A4A4A4A4 06A4A4A4
                 308 02A403A4 A4A403A4 A4A403A4 06040305

Elsie.D00  KAC$CLC - ASYNC CCP'S / AUTO-BAUD TABLES                             TUE JUL 29 '97 23:55 Page:6
      115                     *
      116                     * OUTPUT JUMP TABLE
      117                     *
      118                     *
      119                     * Asynchronous requests tables
      120                     *
      121   818  318          OTPTBL ;
      122        318              TABLE     SIZE=256,DTRANSLATE=0,TLU=Y$OTPASNRQS_TLU,;
      123        318                        STRINGAREA=127
      124   819                   ASCII     TEXT='',EOS=Y$OTPASNRQS100            HLT
      125   820                   ASCII     TEXT='',EOS=Y$OTPASNRQS200            RSM
      126   821                   ASCII     TEXT='',EOS=Y$OTPASNRQS300            PRG
      127   822                   ASCII     TEXT=ASCIIBEL,EOS=Y$OTPASNRQS080      BEL
      128   823                   ASCII     TEXT=ASCIIDC3,EOS=Y$OTPASNRQS080      DC3
      129   824                   ASCII     TEXT=(ASCIIDC3,ASCIIBEL),EOS=Y$OTPASNRQS080   DC3BEL
      130   825                   ASCII     TEXT='',EOS=Y$OTPASNRQS400            BGNPHSDSC
      131   826                   ASCII     TEXT='',EOS=Y$OTPASNRQS600            ENDPHSDSC
      132   827                   ASCII     TEXT='',EOS=Y$OTPASNRQS405            PHSDSC
      133   828                   ASCII     TEXT=' ##-fep crash-##  ',EOS=Y$OTPASNRQS400  SCREECH
      134   829                   ASCII     TEXT='',EOS=Y$OTPASNRQS036            OTP1_CHR
      135   830                   ASCII     EOS=Y$OTPASNRQS080                    2nd EOS for OTP1_CHR
      136   831                   ASCII     TEXT=', please try later',EOS=Y$OTPASNRQS040
      137   832                   ASCII     TEXT='no context',EOS=Y$OTPASNRQS041
      138   833                   ASCII     TEXT='line disabled',EOS=Y$OTPASNRQS041
      139   834                   ASCII     TEXT='please type a left parenthesis ',EOS=Y$OTPASNRQS080

Elsie.D00  KAC$CLC - ASYNC CCP'S / AUTO-BAUD TABLES                             TUE JUL 29 '97 23:55 Page:7
      141                     *
      142                     *
      143                     * Output jump table
      144                     *    The actions to take are determined by the setting of
      145                     *    the bits in LCT byte KA_LCT_OTPSTT
      146                     *
      147                     * bit 0 (always set)
      148                     * |bit 1 (immediate processing)
      149                     * ||bit 2 (transmitter on)
      150                     * |||bit 3 (valid CCB)
      151                     * ||||bit 4 (halted)
      152                     * |||||bit 5 (output control string)
      153                     * ||||||bit 6 (output purge inhibit)
      154                     * |||||||bit 7 (add parity when sending character)
      155                     * ||||||||    jump to label
      156                     * ||||||||    |
      157                     * ||||||||    |
      158                     * VVVVVVVV    V
      159                     * 100*01**    Y$OTP800
      160                     * 100*11**    Y$OTPLOP_JMP1
      161                     * 1000*0**    Y$OTPLOP_JMP1
      162                     * 100100**    Y$OTP800
      163                     * 100110**    Y$OTPLOP_JMP1
      164                     * 101*01*0    Y$OTP300
      165                     * 101*01*1    Y$OTP400
      166                     * 101*11**    Y$OTP900
      167                     * 1010*0**    Y$OTP900
      168                     * 10110000    Y$OTP120
      169                     * 10110001    Y$OTP220
      170                     * 10110010    Y$OTP100
      171                     * 10110011    Y$OTP200
      172                     * 101110**    Y$OTP900
      173                     * 110*****    Y$OTP800
      174                     * 111*****    Y$OTPASNRQS
      175                     *
      176   836               OTPTBL     ;
Elsie.D00  KAC$CLC - ASYNC CCP'S / AUTO-BAUD TABLES                             TUE JUL 29 '97 23:55 Page:8
      177                         TABLE     TLU=Y$OTPLOP30
      178   837                   TRANSFER  IN='10000100'B,TARGET=Y$OTP800,DONTCARE='00010011'B
      179   838                   TRANSFER  IN='10001100'B,TARGET=Y$OTPLOP_JMP1,DONTCARE='00010011'B
      180   839                   TRANSFER  IN='10000000'B,TARGET=Y$OTPLOP_JMP1,DONTCARE='00001011'B
      181   840                   TRANSFER  IN='10010000'B,TARGET=Y$OTP800,DONTCARE='00000011'B
      182   841                   TRANSFER  IN='10011000'B,TARGET=Y$OTPLOP_JMP1,DONTCARE='00000011'B
      183   842                   TRANSFER  IN='10100100'B,TARGET=Y$OTP300,DONTCARE='00010010'B
      184   843                   TRANSFER  IN='10100101'B,TARGET=Y$OTP400,DONTCARE='00010010'B
      185   844                   TRANSFER  IN='10101100'B,TARGET=Y$OTP900,DONTCARE='00010011'B
      186   845                   TRANSFER  IN='10100000'B,TARGET=Y$OTP900,DONTCARE='00001011'B
      187   846                   TRANSFER  IN='10110000'B,TARGET=Y$OTP120
      188   847                   TRANSFER  IN='10110001'B,TARGET=Y$OTP220
      189   848                   TRANSFER  IN='10110010'B,TARGET=Y$OTP100
      190   849                   TRANSFER  IN='10110011'B,TARGET=Y$OTP200
      191   850                   TRANSFER  IN='10111000'B,TARGET=Y$OTP900,DONTCARE='00000011'B
      192   851                   TRANSFER  IN='11000000'B,TARGET=Y$OTP800,DONTCARE='00011111'B
      193   852                   TRANSFER  IN='11100000'B,TARGET=Y$OTPASNRQS,DONTCARE='00011111'B
      194   853               OTPTBL     ;
      195                         ENDTABLE
                 318 7E7D7C7B 79777473 72715E5C 493E3000
                 328 00A32073 69736568 746E6572 61702074
                 338 66656C20 61206570 79742065 7361656C
                 348 709B6465 6C626173 69642065 6E696C9B
                 358 74786574 6E6F6320 6F6E9972 6574616C
                 368 20797274 20657361 656C7020 2CA38FCA
                 378 07202323 2D687361 72632070 65662D23
                 388 2320CCE8 CAA30713 A313A307 BBB1AA00
                 398 A2A2A2A2 D9D9D9D9 A2A2A2A2 A2A2A2A2
                 3A8 D9D9D9D9 D9D9D9D9 A2A2A2A2 A2A2A2A2
                 3B8 ECECECEC C4CFC4CF ECECECEC ECECECEC
                 3C8 8BAF80A4 C4CFC4CF ECECECEC ECECECEC
                 3D8 D9D9D9D9 D9D9D9D9 D9D9D9D9 D9D9D9D9
                 3E8 D9D9D9D9 D9D9D9D9 D9D9D9D9 D9D9D9D9
                 3F8 F4F4F4F4 F4F4F4F4 F4F4F4F4 F4F4F4F4
                 408 F4F4F4F4 F4F4F4F4 F4F4F4F4 F4F4F4F4
      196                     *
Elsie.D00  KAC$CLC - ASYNC CCP'S / AUTO-BAUD TABLES                             TUE JUL 29 '97 23:55 Page:9
      197                     *
      198                     *

Elsie.D00  KAC$CLC - ASYNC CCP'S / AUTO-BAUD TABLES                             TUE JUL 29 '97 23:55 Page:10
      200                     *
      201                     * Reserve 100 byte patch area filled with NOPs.
      202                     *
      203   855  418          PAT TABLE     SIZE=100,DTRANSLATE=0
      204   856               PAT ENDTABLE
                 418 00000000 00000000 00000000 00000000
                 428 00000000 00000000 00000000 00000000
                 438 00000000 00000000 00000000 00000000
                 448 00000000 00000000 00000000 00000000
                 458 00000000 00000000 00000000 00000000
                 468 00000000 00000000 00000000 00000000
                 478 00000000


Elsie.D00  KAC$CLC - ASYNC INPUT CCP - INITIALIZATION                           TUE JUL 29 '97 23:55 Page:11
      206   858                TITLE 'KAC$CLC - ASYNC INPUT CCP - INITIALIZATION'
      207                     *
      208                     * we get here at MLCP/channel initialization time, and after
      209                     * a disconnect.
      210                     *
      211   859  47C          Y$INPCCP    ;
      212        47C              CCP
      213                     *
      214                     * set up the character formats (LCT2/LR6).
      215                     *
      216   860  47C 90D0         LD       =(KW#CHRLNG8|;       8/10 OR 8/11
      217                                   KW#RCVCHRPRT@S)     EVEN PARITY
      218   861  47E 5102         ST        KW#RCVCHRCNF
      219   862  480 5122         ST        KW#TRNCHRCNF
      220   863  482 36           OUT       LR#CHRCNF
      221                     *
      222                     * set up the CLA control (LCT20/LR2).
      223                     *
      224   864  483 50389320     BSET      KA_LCT_INTCNF,=KA_LCT_INTCNF_ENB@S,Y$INPINT100
                     F205
      225                     *
      226                     * we're disabled, so don't raise DTR or RTS.
      227                     *
      228   865  489 9000         LD       =0
      229   866  48B E003         B         Y$INPINT120
      230                     *
      231                     * we're enabled, so raise DTR and RTS.
      232                     *
      233   867  48D 90C0     Y$INPINT100 ;
      234                         LD       =LR#CLACTR_DTR@S|LR#CLACTR_RTS@S
      235   868  48F 5114     Y$INPINT120 ;
      236                         ST        KW#CLACTR
      237   869  491 32           OUT       LR#CLACTR
      238                     *
      239                     * enable the dataset status scan control.
      240                     *
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - INITIALIZATION                           TUE JUL 29 '97 23:55 Page:12
      241   870  492 9090         LD       =(KW#RCVSCN_SCNCTR@S|KW#RCVSCN_STRCCP@S)
      242   871  494 5108         ST        KW#RCVSCN
      243   872  496 5128         ST        KW#TRNSCN
      244                     *N* Now that we don't get back here until ENDPHSDSC has finished,
      245                     *N* the following basket case can't happen.
      246                     *N* BRESET    KA_LCT_OTPSTT,=KA_LCT_OTPSTT_TRNON@S,;
      247                     *N*           Y$INPINT130
      248                     *N*
      249                     *N*
      250                     *N*
      251                     * we need to cause an interrupt to the transmit CCP because
      252                     * the following may have happened:
      253                     *
      254                     * *  L6 asked transmit CCP for asynchronous request and interrupt
      255                     *    via transmit dataset scan mechanism (KW#TRNSTT).
      256                     *
      257                     * *  transmit CCP went active, noticed the transmitter was on
      258                     *    (KA_LCT_OTPSTT_TRNON) and immediately went back to the wait
      259                     *    at Y$OTPLOP, expecting the transmitter interrupt due shortly
      260                     *    to cause processing of the asynchronous request.
      261                     *
      262                     * *  we got to this point (the code you're reading right now)
      263                     *    and turned the transmitter off.  the processing of the
      264                     *    asynchronous interrupt that was expected to occur will never
      265                     *    happen because the transmitter interrupt will never happen.
      266                     *    so we kick the transmit CCP now, just in case the pathological
      267                     *    case just described occurred, which we believe does.
      268                     *
      269                     *N* LD       ='FF'X                Get transmit CCP interrupt
      270                     *N* ST        KW#TRNSTTMSK
      271                     *N* IN        LR#STT
      272                     *N* XOR      ='FF'X
      273                     *N* ST        KW#TRNSTT
      274                     *N*NPINT130
      275   873  498 9081         LD       =(KA_LCT_OTPSTT_HI_ORDBIT@S|KA_LCT_OTPSTT_PRTENB@S)
      276   874  49A 513D         ST        KA_LCT_OTPSTT


Elsie.D00  KAC$CLC - ASYNC INPUT CCP - WAIT FOR CONNECT                         TUE JUL 29 '97 23:55 Page:13
      278   876                TITLE 'KAC$CLC - ASYNC INPUT CCP - WAIT FOR CONNECT'
      279                     *
      280                     * wait for a connect.
      281                     *
      282   877  49C E002         B         Y$INPWATCNC15
      283   878  49E 01       Y$INPWATCNC10 ;
      284                         WAIT
      285                     *
      286                     * wait for dataset ready (DSR), carrier detect (CD), and
      287                     * clear-to-send (CTS) to all come on.
      288                     *
      289   879  49F 500E     Y$INPWATCNC15 ;
      290                         LD        KW#RCVSTT
      291   880  4A1 93E0         AND      ='E0'X                 MASK FOR CTS, CD, AND DSR
      292   881  4A3 92E0         C        ='E0'X
      293   882  4A5 F1F8         BNE       Y$INPWATCNC10         B/NOT CTS, CD, AND DSR
      294   883  4A7 9000         LD       =0
      295   884  4A9 511A         ST        KA_LCT_CNCSTT
      296   885  4AB 50389320     BRESET    KA_LCT_INTCNF,;     Might be partitioned,
                     E202
      297                                   =KA_LCT_INTCNF_ENB@S,Y$INTR0  if not enabled.
      298   886  4B1 08           INTR
      299   887  4B2          Y$INTR0 LABEL
      300                     *
      301                     * clear out the receiver data registers.
      302                     *
      303   888  4B2 21           IN        1                     LOAD LINE REG 1 (RCV DATA)
      304   889  4B3 21           IN        1                     LOAD LINE REG 1 (RCV DATA)
      305   890  4B4 90025414     SET       KW#CLACTR,=KW#CLACTR_RCVON@S     TURN RECEIVER ON
                     5114
      306   891  4BA 32           OUT       LR#CLACTR
      307   892  4BB 50389340     BSET      KA_LCT_INTCNF,;                    B/AUTO-BAUD
                     F262
      308                                   =KA_LCT_INTCNF_AUTBAD@S,Y$INPAUTBAD10
      309                     *
      310                     * we're not to auto-baud the line.
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - WAIT FOR CONNECT                         TUE JUL 29 '97 23:55 Page:14
      311                     *
      312   893  4C1 5038         LD        KA_LCT_INTCNF         L/INITIAL LINE SPEED
      313   894  4C3 931F         AND      =(KA_LCT_INTCNF_LINSPD@S;
      314                                   |KA_LCT_INTCNF_DC1DC3FLWCTR@S)
      315   895  4C5 34           OUT       LR#LINSPD
      316   896  4C6 94C0         OR       =(KA_LCT_CRTCNF_PRT_EVNODD@S|;  SET PARITY EVEN/ODD
      317                                   KA_LCT_CRTCNF_PRT_NON@S)       SET NONE (NOT KNOWN)
      318   897  4C8 513B         ST        KA_LCT_CRTCNF                  STORE CURRENT CONFIG
      319   898  4CA 9080         LD       =KA_LCT_OTPSTT_HI_ORDBIT@S      SET UP TO OUTPUT PROPERLY
      320   899  4CC 513D         ST        KA_LCT_OTPSTT
      321   900  4CE 9000         LD       =0
      322   901  4D0 5134         ST        KA_LCT_OTPPRTBIT
      323                     *   LD       =KV_FNTCLS_ASC         Font class, 'normal' ASCII
      324                     *   ST        KA_LCT_FNTCLS         Already stored with MLC16 flag in MSCSTT
      325   902  4D2 50389380     BRESET    KA_LCT_INTCNF,;                B/NOT DIRECT CONNECT
                     E20A
      326                                   =KA_LCT_INTCNF_BRKRQ@S,Y$INPWATCNC60
      327                     *
      328                     * wait for a break.
      329                     *
      330   903  4D8 F01B     Y$INPWATCNC40 ;
      331                         BAL       Y$INPCNCRCV           GET CHARACTER
      332   904  4DA F2FD         BNZ       Y$INPWATCNC40         B/NOT NULL (NOT BREAK)
      333   905  4DC 25           IN        LR#STT
      334   906  4DD 9301         AND      =LR#STT_FRMERR@S
      335   907  4DF E2F8         BZ        Y$INPWATCNC40         B/NO FRAMING ERROR
      336   908  4E1 E600E6   Y$INPWATCNC60 ;
      337                         JUMP      Y$INPCNC010           B, DON'T AUTO-BAUD
      338                     *


Elsie.D00  KAC$CLC - ASYNC INPUT CCP - RECEIVE CONNECT CHARACTER                TUE JUL 29 '97 23:55 Page:15
      340   910                TITLE 'KAC$CLC - ASYNC INPUT CCP - RECEIVE CONNECT CHARACTER'
      341                     *
      342                     * wait for a character, and receive it.
      343                     * If disconnect occurs, tell the L6 and set CNCSTT.DSC.
      344                     *
      345   911  4E4 9002     Y$INPCNCWAT ;
      346                         LD       =KW#LINSPD110          LINE SPEED TO 110 BAUD
      347   912  4E6 34           OUT       LR#LINSPD
      348   913  4E7 90085126     SETADDR   KW#TRNCCP$,Y$OTPTMR  SET CCP POINTER TO Y$OTPTMR
                     90565127
      349   914  4EF 90C9         LD       =(LR#CLACTR_DTR@S|;
      350                                   LR#CLACTR_RTS@S|;
      351                                   LR#CLACTR_TRNMRK@S|;
      352                                   LR#CLACTR_TRNON@S)
      353   915  4F1 5114         ST        KW#CLACTR
      354   916  4F3 32           OUT       LR#CLACTR
      355   917  4F4 01       Y$INPCNCRCV ;
      356                         WAIT
      357   918  4F5 500E         LD        KW#RCVSTT
      358   919  4F7 93E0         AND      ='E0'X
      359   920  4F9 95E0         XOR      ='E0'X
      360   921  4FB F20D         BNZ       Y$INPCNCRCV10         B/NOT CD, CTS, AND DSR, DISCONNECT
      361   922  4FD 511A         ST        KA_LCT_CNCSTT         SAY WE'VE SEEN NO DISCONNECTS.
      362   923  4FF 5017         LD        KA_LCT_OTPASNRQS      We might have logon-timeout.
      363   924  501 9207         C        =KA#OTPASNRQS_BGNPHSDSC
      364   925  503 E113         BE        Y$INPCNCRCV20         Yup.  Start the disconnect.
      365   926  505 A0           RECV                            CHR MUST BE IN R WHEN WE RETURN
      366   927  506 5118         ST        KA_LCT_INPCHR
      367   928  508 06           RETURN
      368                     *
      369   929  509 9020     Y$INPCNCRCV10 ;
      370                         LD       =KA_LCT_CNCSTT_DSCARM@S
      371   930  50B 521A         C         KA_LCT_CNCSTT         WAIT FOR TWO SCANS TO BE SURE
      372   931  50D E109         BE        Y$INPCNCRCV20
      373   932  50F 511A         ST        KA_LCT_CNCSTT
      374   933  511 90FF         LD       ='FF'X                 FORCE ANOTHER SCAN INTERRUPT
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - RECEIVE CONNECT CHARACTER                TUE JUL 29 '97 23:55 Page:16
      375   934  513 510E         ST        KW#RCVSTT
      376   935  515 E0DE         B         Y$INPCNCRCV
      377                     *
      378   936  517 9080     Y$INPCNCRCV20 ;
      379                         LD       =KA_LCT_CNCSTT_DSC@S
      380   937  519 511A         ST        KA_LCT_CNCSTT         MARK DSC TO ALLOW L6 TO FINISH
      381   938  51B 9007         LD       =KA#OTPASNRQS_BGNPHSDSC
      382   939  51D F06C         BAL       Y$OTPINTASNRQS_JMP1   DROP DTR FOR A WHILE
      383   940  51F E602FC       JUMP      Y$INPDSC50            Interrupt and wait for ENDPHSDSC
      384                     *


Elsie.D00  KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD                                TUE JUL 29 '97 23:55 Page:17
      386   942                TITLE 'KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD'
      387                     *
      388   943  522 9002511B Y$INPAUTBAD10 ;
                     9000511C
      389                         SETADDR   KA_LCT_AUTBADFNCTBL$,AUTBADFNC
      390   944  52A 9002511D     SETADDR   KA_LCT_AUTBADCHRTBL$,AUTBADCHR
                     9018511E
      391   945  532 90005134     ASSIGN    KA_LCT_OTPPRTBIT,=0          Init output parity bit to 0
      392   946  536 9010         LD       ='10'X
      393   947  538 5119         ST        KA_LCT_BASLINSPDX      INDICATE 4800 BAUD
      394   948  53A 9040         LD       =KA_LCT_AUTBADSTT_ATBASLINSPD@S
      395   949  53C 5139         ST        KA_LCT_AUTBADSTT
      396   950  53E F0A5         BAL       Y$INPCNCWAT           WAIT FOR THE TIMER TO GO OFF.
      397   951  540 900D         LD       =KW#LINSPD4800
      398   952  542 513B     Y$INPAUTBAD20 ;
      399                         ST        KA_LCT_CRTCNF
      400   953  544          Y$INPAUTBAD30 LABEL
      401                     *
      402                     * wait for 300 milliseconds (twice, the first time)
      403                     *
      404   954  544 F09F         BAL       Y$INPCNCWAT           WAIT FOR THE TIMER TO GO OFF.
      405                     *
      406                     * the 300 millisecond timer went off.
      407                     *
      408                     *
      409                     * The following 2 lines make MLC-16s work, and never were needed
      410                     * by MLCPs.
      411                     *
      412   955  546 5014         LD        KW#CLACTR
      413   956  548 32           OUT       LR#CLACTR
      414   957  549 503B         LD        KA_LCT_CRTCNF         SET LINE SPEED
      415   958  54B 930F         AND      =KA_LCT_CRTCNF_LINSPD@S
      416   959  54D 34           OUT       LR#LINSPD
      417   960  54E 90C2         LD       =(LR#CLACTR_DTR@S|;
      418                                   LR#CLACTR_RTS@S|;
      419                                   LR#CLACTR_RCVON@S)
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD                                TUE JUL 29 '97 23:55 Page:18
      420   961  550 5114         ST        KW#CLACTR
      421   962  552 32           OUT       LR#CLACTR
      422   963  553 21           IN        1                     CLEAR CHR REGISTER
      423   964  554 F09F         BAL       Y$INPCNCRCV           GET AN INPUT CHARACTER
      424   965  556 561D     Y$INPAUTBADCHRTBL_TLU  ;
      425                         TLU       KA_LCT_AUTBADCHRTBL$  INTERPRET CHARACTER
      426                     *
      427                     * set the current line speed to that indicated by the
      428                     * character just received.
      429                     *
      430   966  558 5419         OR        KA_LCT_BASLINSPDX
      431   967  55A 561B     Y$INPAUTBADFNCTBL_TLU ;
      432                         TLU       KA_LCT_AUTBADFNCTBL$
      433   968  55C 513A         ST        KA_LCT_AUTBADFNC
      434   969  55E 907F5339     RESET     KA_LCT_AUTBADSTT,=KA_LCT_AUTBADSTT_8_RCV@S
                     5139
      435   970  564 503A9340     BSET      KA_LCT_AUTBADFNC,=KA_LCT_AUTBADFNC_FRMERROK@S,Y$INPAUTBAD50
                     F206
      436   971  56A 25           IN        LR#STT
      437   972  56B 9301         AND      =LR#STT_FRMERR@S
      438   973  56D F240         BNZ       Y$INPAUTBAD65         B/FRAMING ERROR
      439   974  56F 50399340 Y$INPAUTBAD50 ;
                     E22E
      440                     *
      441                     * b/not at base line speed
      442                     *
      443                         BRESET    KA_LCT_AUTBADSTT,;
      444                                   =KA_LCT_AUTBADSTT_ATBASLINSPD@S,Y$INPAUTBAD60
      445   975  575 90BF5339     RESET     KA_LCT_AUTBADSTT,;         NO LONGER AT BASE LINE SPEED
                     5139
      446                                   =KA_LCT_AUTBADSTT_ATBASLINSPD@S
      447   976  57B 503A         LD        KA_LCT_AUTBADFNC
      448   977  57D 930F         AND      =KA_LCT_AUTBADFNC_LINSPD@S
      449   978  57F E0C2         B         Y$INPAUTBAD20         B, SET LINE SPEED
      450                     *
      451                     * we got an '8' (the autobaud character) from the receiver.
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD                                TUE JUL 29 '97 23:55 Page:19
      452                     * it has the parity bit on.
      453                     *
      454   979  582          Y$INPAUTBAD55 ;
      455        582              TARGET    Y$INPAUTBADCHRTBL_TLU
      456   980  582 9040543B     SET       KA_LCT_CRTCNF,=KA_LCT_CRTCNF_PRT_EVNODD@S
                     513B
      457   981  588 E00B         B         Y$INPAUTBAD57
      458                     *
      459   982  58A E604FF   Y$OTPINTASNRQS_JMP1 ;
      460                         JUMP      Y$OTPINTASNRQS           INITIATE ASYNCHRONOUS REQUEST
      461                     *
      462                     * we got an '8' (the autobaud character) from the receiver.
      463                     * it has the parity bit off.
      464                     *
      465   983  58E          Y$INPAUTBAD56 ;
      466        58E              TARGET    Y$INPAUTBADCHRTBL_TLU
      467   984  58E 90BF533B     RESET     KA_LCT_CRTCNF,=KA_LCT_CRTCNF_PRT_EVNODD@S
                     513B
      468   985  594 50399380 Y$INPAUTBAD57 ;
                     F230
      469                         BSET      KA_LCT_AUTBADSTT,;                 B/NOT FIRST '8'
      470                                   =KA_LCT_AUTBADSTT_8_RCV@S,Y$INPCNC010
      471   986  59A 90805439     SET       KA_LCT_AUTBADSTT,=KA_LCT_AUTBADSTT_8_RCV@S SAY WE GOT AN 8
                     5139
      472   987  5A0 E0A3         B         Y$INPAUTBAD30         B, TRY FOR A SECOND 8
      473                     *
      474                     * we received a non-null character that has no special
      475                     * meaning for us.
      476                     *
      477   988  5A2          Y$INPAUTBAD60 ;
      478        5A2              TARGET    Y$INPAUTBADCHRTBL_TLU
      479   989  5A2          Y$INPAUTBAD62 ;
      480        5A2              TARGET    Y$INPAUTBADFNCTBL_TLU
      481   990  5A2 5039         LD        KA_LCT_AUTBADSTT
      482   991  5A4 937F         AND      =(KA_LCT_AUTBADSTT_8_RCV@S\'FF'X)
      483   992  5A6 9440         OR       =KA_LCT_AUTBADSTT_ATBASLINSPD@S
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD                                TUE JUL 29 '97 23:55 Page:20
      484   993  5A8 5139         ST        KA_LCT_AUTBADSTT
      485   994  5AA 5019         LD        KA_LCT_BASLINSPDX     L/BASE LINE SPEED INDEX
      486   995  5AC E012         B         Y$INPAUTBAD70         B
      487                     *
      488                     * set the line speed to:
      489                     *    600 baud if base now at 4800 baud
      490                     *    150 baud if base now at 600 baud
      491                     *   4800 baud if base now at 150 baud
      492                     *
      493   996  5AE          Y$INPAUTBAD65 ;
      494        5AE              TARGET    Y$INPAUTBADFNCTBL_TLU
      495   997  5AE 90405439     SET       KA_LCT_AUTBADSTT,;            AT BASE LINE SPEED
                     5139
      496                                   =KA_LCT_AUTBADSTT_ATBASLINSPD@S
      497   998  5B4 5019         LD        KA_LCT_BASLINSPDX
      498   999  5B6 F203         BNZ       Y$INPAUTBAD67         CHANGE BASLINSPDX ACCORDINGLY
      499  1000  5B8 9020         LD       ='20'X                 '00'X  -->  '10'X
      500  1001  5BA 07       Y$INPAUTBAD67 ;
      501                         SR                              '08'X  -->  '00'X
      502  1002  5BB 9318         AND      ='18'X                 '10'X  -->  '08'X
      503  1003  5BD 5119         ST        KA_LCT_BASLINSPDX
      504  1004  5BF 9407     Y$INPAUTBAD70 ;
      505                         OR       =Y#AUTBADFNC_BASLINSPD
      506  1005  5C1 561B         TLU       KA_LCT_AUTBADFNCTBL$  L/NEW LINE SPEED
      507  1006  5C3 E6FF7D       JUMP      Y$INPAUTBAD20         B
      508                     *
      509  1007  5C6 E6FF2C   Y$INPCNCRCV_JMP1 ;
      510                         JUMP      Y$INPCNCRCV           RECEIVE CHARACTER

Elsie.D00  KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD                                TUE JUL 29 '97 23:55 Page:21
      512                     *
      513  1009  5C9 500E511F Y$INPCNC010 ;
      514                         ASSIGN    KA_LCT_SVDRCVSTT,KW#RCVSTT   SAVE RCV STATUS FOR CHANG
      515  1010  5CD 9000         LD       =0
      516  1011  5CF 5117         ST        KA_LCT_OTPASNRQS
      517  1012  5D1 511D         ST        KA_LCT_OTPCTRSTRCNT
      518  1013  5D3 513C         ST        KA_LCT_OTPINHPRGCHRCNT
      519  1014  5D5 512E         ST        KW#TRNSTT
      520  1015  5D7 512F         ST        KW#TRNSTTMSK
      521  1016  5D9 9003511B     SETADDR   KA_LCT_OTPTBL$,OTPTBL
                     9018511C
      522  1017  5E1 90085126     SETADDR   KW#TRNCCP$,Y$OTPCCP  SET CCP POINTER TO Y$OTPCCP
                     907D5127
      523  1018  5E9 503B         LD        KA_LCT_CRTCNF         L/CURRENT LINE SPEED
      524  1019  5EB 930F         AND      =KA_LCT_CRTCNF_LINSPD@S
      525  1020  5ED 9205         C        =KW#LINSPD200
      526  1021  5EF E105         BE        Y$INPCNC015           B/200 BAUD, 8/11 FORMAT
      527  1022  5F1 9202         C        =KW#LINSPD110
      528  1023  5F3 F108         BNE       Y$INPCNC020           B/NOT 110 BAUD, 8/10 FORMAT
      529  1024  5F5 90085402 Y$INPCNC015 ;
                     5102
      530                         SET       KW#STPBTS,=KW#STPBTS@S 8/11 FORMAT
      531  1025  5FB 36           OUT       LR#CHRCNF
      532  1026  5FC          Y$INPCNC020 LABEL
      533  1027  5FC 50389340     BSET      KA_LCT_INTCNF,;       B/AUTO-BAUDING
                     F204
      534                                   =KA_LCT_INTCNF_AUTBAD@S,Y$INPCNC030
      535  1028  602 E60072       JUMP      Y$INPCNC300           NOT AUTO-BAUDING

Elsie.D00  KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD                                TUE JUL 29 '97 23:55 Page:22
      537                     *
      538                     * identify the character set and the parity.  also strip
      539                     * leading 8's.
      540                     *
      541  1030  605 900F     Y$INPCNC030 ;
      542                         LD       =KA#OTPASNRQS_PLSTYPLFTPRN
      543  1031  607 F082         BAL       Y$OTPINTASNRQS_JMP1   SEND 'TYPE A LEFT PARENTHESES'
      544  1032  609 F0BC     Y$INPCNC040 ;
      545                         BAL       Y$INPCNCRCV_JMP1      GET CHARACTER
      546  1033  60B 25           IN        LR#STT
      547  1034  60C 9303         AND      =(LR#STT_OVRRUN@S|LR#STT_FRMERR@S)
      548  1035  60E F2F6         BNZ       Y$INPCNC030           B/OVER-RUN OR FRAMING ERROR
      549  1036  610 90FC533E     RESET     KA_LCT_MSCSTT,=KA_LCT_MSCSTT_FNTCLS@S
                     513E
      550  1037  616 5018         LD        KA_LCT_INPCHR         L/CHR RECEIVED
      551  1038  618 937F         AND      ='7F'X                 STRIP PARITY
      552  1039  61A 9238         C        =ASCII8
      553  1040  61C E1EC         BE        Y$INPCNC040           B/'8', ASSUME EXTRA, FROM AUTO-BAUD
      554  1041  61E 9228         C        =ASCIILFTPRN
      555  1042  620 F105         BNE       Y$INPCNC050           B/NOT 'NORMAL' ASCII
      556  1043  622 9000         LD       =KV_FNTCLS_ASC         FONT CLASS, 'NORMAL' ASCII
      557  1044  624 E00F         B         Y$INPCNC070
      558  1045  626 922B     Y$INPCNC050 ;
      559                         C        ='2B'X                 BIT-PAIRED APL LEFT PAREN
      560  1046  628 F105         BNE       Y$INPCNC060           B/NOT BIT-PAIRED APL
      561  1047  62A 9001         LD       =KV_FNTCLS_APLB        FONT CLASS = BIT-PAIRED APL
      562  1048  62C E007         B         Y$INPCNC070
      563  1049  62E 923A     Y$INPCNC060 ;
      564                         C        ='3A'X                 TYPEWRITER-PAIRED APL LEFT PAREN
      565  1050  630 F1D4         BNE       Y$INPCNC030           B/NOT 8 OR ANY RECOGNIZED FONT
      566  1051  632 9002         LD       =KV_FNTCLS_APLT        FONT = TYPEWRITER-PAIRED APL
      567  1052  634 543E     Y$INPCNC070 ;
      568                         OR        KA_LCT_FNTCLS
      569  1053  636 513E         ST        KA_LCT_FNTCLS
      570  1054  638 907F533B     RESET     KA_LCT_CRTCNF,=KA_LCT_CRTCNF_PRT_NON@S RESET PARITY=NONE
                     513B
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD                                TUE JUL 29 '97 23:55 Page:23
      571                     *
      572                     * figure out what parity the 8 and left parenthesis characters
      573                     * had.
      574                     *
      575  1055  63E 503B9340     BSET      KA_LCT_CRTCNF,;                    B/8 HAD PARITY ON
                     F21B
      576                                   =KA_LCT_CRTCNF_PRT_EVNODD@S,Y$INPCNC100
      577                     *
      578                     * the characters have odd parity or reset (0) parity.
      579                     *
      580  1056  644 50189380     BRESET    KA_LCT_INPCHR,;           B/EVEN PARITY
                     E227
      581                                   =KA_LCT_INPCHR_PRTBIT@S,Y$INPCNC150
      582                     *
      583                     * (KA_LCT_CRTCNF was reset at the beginning of auto-baud.)
      584                     *
      585                     * the characters had odd parity.
      586                     *
      587  1057  64A 9060543B     SET       KA_LCT_CRTCNF,;    ENABLE PARITY
                     513B
      588                                   =KA_LCT_CRTCNF_PRT_EVNODD@S;  GENERATION/CHECKING
      589                                   |KA_LCT_CRTCNF_PRT_SET@S      AND SET ODD PARITY
      590  1058  650 90EF5302     RESET     KW#RCVCHRPRT,=KW#RCVCHRPRT@S  ODD PARITY FOR RECEIVE
                     5102
      591  1059  656 90EF5322     RESET     KW#TRNCHRPRT,=KW#TRNCHRPRT@S  ODD PARITY FOR TRANSMIT
                     5122
      592  1060  65C E019         B         Y$INPCNC300
      593                     *
      594                     * the characters had even or set (always 1) parity.
      595                     *
      596  1061  65E 50189380 Y$INPCNC100 ;
                     E213
      597                     *
      598                     * if even, CRTCNF is already correct.
      599                     *
      600                         BRESET    KA_LCT_INPCHR,;           B/EVEN PARITY
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD                                TUE JUL 29 '97 23:55 Page:24
      601                                   =KA_LCT_INPCHR_PRTBIT@S,Y$INPCNC300
      602                     *
      603                     * the characters had set (always 1) parity.
      604                     *
      605  1062  664 90805134     ASSIGN    KA_LCT_OTPPRTBIT,='80'X      Set output parity bit to 1
      606  1063  668 503B         LD        KA_LCT_CRTCNF       PARITY BIT SET ON
      607  1064  66A 9420         OR        =KA_LCT_CRTCNF_PRT_SET@S    OTHERWISE EVEN PARITY
      608  1065  66C 93BF         AND       =KA_LCT_CRTCNF_PRT_EVNODD@S\'FF'X
      609  1066  66E 513B         ST        KA_LCT_CRTCNF
      610  1067  670 90FE533D Y$INPCNC150 ;
                     513D
      611                         RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_PRTENB@S
      612  1068  676 50389320 Y$INPCNC300 ;
                     F20F
      613                         BSET      KA_LCT_INTCNF,;           B/ENABLED
      614                                   =KA_LCT_INTCNF_ENB@S,Y$INPCNC400
      615  1069  67C 90FD5314     RESET     KW#CLACTR,=KW#CLACTR_RCVON@S     TURN RECEIVER OFF
                     5114
      616  1070  682 32           OUT       LR#CLACTR
      617  1071  683 900E         LD       =KA#OTPASNRQS_LINDSB   'LINE DISABLED'
      618  1072  685 F044         BAL       Y$OTPINTASNRQS_JMP2
      619  1073  687 01       Y$INPCNC310 ;
      620                         WAIT
      621  1074  688 E0FE         B         Y$INPCNC310           Transmit channel will reinitialize
      622  1075  68A 503E9304 Y$INPCNC400 ;
                     E207
      623                         BRESET    KA_LCT_MSCSTT,;       B/NOT MLC-16 (NMLC)
      624                                   =KA_LCT_MSCSTT_MLC16@S,Y$INPCNC420
      625  1076  690 907F5309     RESET     KW#RCVCHNCTR,='80'X   Reset left/right byte flag (firmware bug)
                     5109
 LC2-00096-0   WARNING: The byte specified (9) has been defined as
               being reserved for firmware use.
      626  1077  696 9000     Y$INPCNC420 ;
      627                         LD       =0                     CLEAR L6_STT TO START
      628  1078  698 511E         ST        KA_LCT_L6_STT
      629  1079  69A 513F         ST        KA_LCT_BFROFS
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - AUTO-BAUD                                TUE JUL 29 '97 23:55 Page:25
      630  1080  69C F033         BAL       Y$INPGETBFR_JMP1      CAUSE ALLOCATION OF CCB'S/BUFFERS
      631  1081  69E 21           IN        1                     Ignore any previous garbage
      632  1082  69F 21           IN        1


Elsie.D00  KAC$CLC - ASYNC INPUT CCP - MAIN RECEIVE LOOP                        TUE JUL 29 '97 23:55 Page:26
      634  1084                TITLE 'KAC$CLC - ASYNC INPUT CCP - MAIN RECEIVE LOOP'
      635                     *
      636                     * main receive loop.
      637                     *
      638  1085  6A0          Y$INPLOP LABEL
      639  1086  6A0 01       Y$INPLOP10 ;
      640                         WAIT                            WAIT FOR INTERRUPT
      641                     *
      642                     * possible sources of interrupts at this point:
      643                     *
      644                     *    we received a character.
      645                     *
      646                     *    a dataset status change (that we're interested in) occured.
      647                     *
      648                     *    the XMT CCP zeroed LCT 14, causing a dataset status
      649                     *    change interrupt.  it does this when going thru disconnect,
      650                     *    to get us to ask for an L6 interrupt to get a new session
      651                     *    going.
      652                     *
      653                     *    the transmit CCP stored a 0 into LCT 14 to get us to change
      654                     *    the line speed (only the receive CCP can do that).
      655                     *
      656  1087  6A1 500E         LD        KW#RCVSTT
      657  1088  6A3 521F         C         KA_LCT_SVDRCVSTT
      658  1089  6A5 E12D         BE        Y$INPLOP30
      659  1090  6A7 511F         ST        KA_LCT_SVDRCVSTT           SAVE RCV STATUS FOR CHANG
      660  1091  6A9 503B         LD        KA_LCT_CRTCNF
      661  1092  6AB 930F         AND      =KA_LCT_CRTCNF_LINSPD@S
      662  1093  6AD 34           OUT       LR#LINSPD
      663                     *
      664                     * if the transmit CCP is doing the PHSDSC output asynchronous
      665                     * request, ignore the status change.
      666                     *
      667  1094  6AE 50089310     BRESET    KW#RCVSCN,=KW#RCVSCN_STRCCP@S,Y$INPLOP10
                     E2ED
      668  1095  6B4 500E         LD        KW#RCVSTT
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - MAIN RECEIVE LOOP                        TUE JUL 29 '97 23:55 Page:27
      669  1096  6B6 93A0         AND      =(KW#RCVSTT_CD@S|KW#RCVSTT_DSR@S)
      670  1097  6B8 92A0         C        =(KW#RCVSTT_CD@S|KW#RCVSTT_DSR@S)
      671  1098  6BA F10B         BNE       Y$INPLOP20            B/NOT CD AND DSR
      672  1099  6BC 90DF531A     RESET     KA_LCT_CNCSTT,;       SAY WE'VE SEEN NO DISCONNECT
                     511A
      673                                   =KA_LCT_CNCSTT_DSCARM@S
      674  1100  6C2 E2C7         BZ        Y$INPCNC400            B
      675  1101  6C4 E0DB         B         Y$INPLOP10            B
      676  1102  6C6 F006     Y$INPLOP20 ;
      677                         BAL       Y$INPDSC_JMP1         CALL DISCONNECT ROUTINE
      678  1103  6C8 E0D7         B         Y$INPLOP10            B
      679                     *
      680  1104  6CA E603BF   Y$OTPINTASNRQS_JMP2 ;
      681                         JUMP      Y$OTPINTASNRQS        INITIATE ASYNCHRONOUS REQUEST
      682                     *
      683  1105  6CD E60123   Y$INPDSC_JMP1 ;
      684                         JUMP      Y$INPDSC              DISCONNECTED
      685                     *
      686  1106  6D0 E600AE   Y$INPGETBFR_JMP1 ;
      687                         JUMP      Y$INPGETBFR
      688                     *
      689                     * get the character from the receiver.
      690                     *
      691  1107  6D3 501A     Y$INPLOP30 ;
      692                         LD        KA_LCT_CNCSTT
      693  1108  6D5 E2B4         BZ        Y$INPCNC400           B/End of LGC DSC - Get new BFRs.
      694  1109  6D7 A0           RECV
      695  1110  6D8 5118         ST        KA_LCT_INPCHR         GET AND SAVE CHARACTER
      696  1111  6DA 25           IN        LR#STT                L/STATUS FROM LINE REG
      697  1112  6DB 9303         AND      =(LR#STT_OVRRUN@S|LR#STT_FRMERR@S)
      698  1113  6DD E207         BZ        Y$INPLOP37            B/NO OVER-RUN OR FRAMING ERROR
      699  1114  6DF 9201         C        =LR#STT_FRMERR@S       B/FRAME ERROR
      700  1115  6E1 E171         BE        Y$INPFRMERR
      701  1116  6E3 E063         B         Y$INPOVRRUN           B/OVER RUN
      702  1117  6E5 503B9310 Y$INPLOP37 ;
                     E21F
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - MAIN RECEIVE LOOP                        TUE JUL 29 '97 23:55 Page:28
      703                         BRESET    KA_LCT_CRTCNF,;       B/NOT USING DC1DC3 FLOW CTR
      704                                  =KA_LCT_CRTCNF_DC1DC3FLWCTR@S,Y$INPLOP40
      705                     *
      706                     * CHECK FOR DC1/DC3 CHARACTER
      707                     *
      708  1118  6EB 5018         LD        KA_LCT_INPCHR
      709  1119  6ED 937F         AND      ='7F'X                 STRIP OFF PARITY
      710  1120  6EF 9213         C        =ASCIIDC3
      711  1121  6F1 F10F         BNE       Y$INPLOP38            B/NOT DC3(XOFF)
      712  1122  6F3 9010543E     SET       KA_LCT_MSCSTT_HLT,=KA_LCT_MSCSTT_HLT_DVC@S
                     513E
      713  1123  6F9 9008543D     SET       KA_LCT_OTPSTT,=KA_LCT_OTPSTT_HLT@S
                     513D
      714  1124  6FF E0A0         B         Y$INPLOP
      715  1125  701 9211     Y$INPLOP38 ;
      716                         C        =ASCIIDC1
      717  1126  703 F105         BNE       Y$INPLOP40            B/NOT DC1(XON)
      718  1127  705 F061         BAL       Y$INPCLRHLT
      719  1128  707 E098         B         Y$INPLOP
      720                     *
      721                     * pass the character thru the CCB to main memory.
      722                     *
      723  1129  709 5018     Y$INPLOP40 ;
      724                         LD        KA_LCT_INPCHR         L/SAVED CHR RECV'D
      725  1130  70B 92FE         C        =KA#INPCTRSTRCHR_INT
      726  1131  70D F103         BNE       Y$INPLOP50            B/NOT INPUT CONTROL STRING CHR
      727  1132  70F F07F         BAL       Y$INPPUTCHR           BUFFER INP CTR STR CHR TWICE
      728  1133  711 E705     Y$INPLOP50 ;
      729                         BVB       Y$INPLOP55            B/VALID CCB
      730  1134  713 F07B         BAL       Y$INPPUTCHR           WAIT FOR CCB, BUFFER CHR
      731  1135  715 E010         B         Y$INPLOP65            B/Skip store of bfrofs
      732  1136  717 11       Y$INPLOP55 ;
      733                         ST
      734  1137  718 503F         LD        KA_LCT_BFROFS         Count chars in buffer
      735  1138  71A 05           DEC
      736  1139  71B F308         BNLC      Y$INPLOP60            B/NOT LAST CHR IN CCB
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - MAIN RECEIVE LOOP                        TUE JUL 29 '97 23:55 Page:29
      737  1140  71D 02           GNCCB                           GET NEXT CCB
      738  1141  71E E703         BVB       Y$INPLOP58            B/VALID CCB
      739  1142  720 F05F         BAL       Y$INPGETBFR           GET BUFFER (CCB)
      740  1143  722 9000     Y$INPLOP58 ;
      741                         LD        =0                    New buffer - no chars there
      742  1144  724 513F     Y$INPLOP60 ;
      743                         ST        KA_LCT_BFROFS
      744  1145  726 501E9380 Y$INPLOP65 ;
                     F20D
      745                         BSET      KA_LCT_L6_STT,;                NO INTERRUPT IF POLLED
      746                                   =KA_LCT_L6_STT_PLD@S,Y$INTR1_PLD
      747  1146  72C 503E9304     BSET      KA_LCT_MSCSTT,;       B/MLC-16 (NMLC)
                     F20D
      748                                   =KA_LCT_MSCSTT_MLC16@S,Y$INTR1_MLC16
      749  1147  732 5009         LD        KW#RCVCHNCTR                  NZ/Already interrupts Q'd
      750  1148  734 93C0         AND       =KW#RCVCHNCTR_DFRINTCNT@S
      751  1149  736 E009         B         Y$INTR1_INTR
      752  1150  738 503F     Y$INTR1_PLD ;
      753                         LD        KA_LCT_BFROFS                 NZ/Not end of data record
      754  1151  73A 553A         XOR       KA_LCT_PLDINTOFS
      755  1152  73C E003         B         Y$INTR1_INTR
      756  1153  73E 504D     Y$INTR1_MLC16 ;
      757                         LD        KW#RCVDFRINTCNT               NZ/Already interrupts Q'd
      758  1154  740 F203     Y$INTR1_INTR ;
      759                         BNZ       Y$INTR1
      760  1155  742 08           INTR
      761  1156  744          Y$INTR1 LABEL
      762  1157  744 E6FF5A       JUMP      Y$INPLOP              B, WAIT FOR NEXT INTERRUPT


Elsie.D00  KAC$CLC - ASYNC Input CCP - Report a linerror or break               TUE JUL 29 '97 23:55 Page:30
      764  1159                TITLE 'KAC$CLC - ASYNC Input CCP - Report a linerror or break'
      765                     *
      766                     * a receive over-run has occurred, i.e., we lost input characters
      767                     * because we didn't get them out of the receiver fast enough.
      768                     *
      769  1160  747 90FE     Y$INPOVRRUN ;
      770                         LD       =KA#INPCTRSTRCHR_INT
      771  1161  749 F045         BAL       Y$INPPUTCHR           BUFFER START-OF-CONTROL-STRING CHR
      772  1162  74B 9002         LD       =KA#INPCTRSTRCHR_CLAOVRRUN INDICATE OVER-RUN
      773  1163  74D F041     Y$INPPUTCHRERR ;
      774                         BAL       Y$INPPUTCHR           BUFFER THE CHR
      775  1164  74F F017         BAL       Y$INPCLRHLT           CLEAR XOFF HALT
      776  1165  751 E0D2         B         Y$INPLOP60            INTERRUPT CPU
      777                     *
      778                     * a Framing Error has occurred, check for long space (break)
      779                     * or real Framing Error condition.
      780                     *
      781  1166  753 5018     Y$INPFRMERR ;
      782                         LD        KA_LCT_INPCHR         B/CHR IS NULL (X'00'), BREAK
      783  1167  755 E209         BZ        Y$INPBRK
      784  1168  757 90FE         LD       =KA#INPCTRSTRCHR_INT
      785  1169  759 F035         BAL       Y$INPPUTCHR           BUFFER START-OF-CONTROL-STRING CHR
      786  1170  75B 9004         LD       =KA#INPCTRSTRCHR_PRTERR   INDICATE PARITY ERROR ON FRAMING ER
      787  1171  75D E0EF         B         Y$INPPUTCHRERR        BFR PARITY ERROR INDICATOR, INT CPU
      788                     *
      789                     * we have received a break (long space) on the line.
      790                     *
      791  1172  75F 90FE     Y$INPBRK ;
      792                         LD       =KA#INPCTRSTRCHR_INT
      793  1173  761 F02D         BAL       Y$INPPUTCHR           BUFFER START-OF-CONTROL-STRING CHR
      794  1174  763 9001         LD       =KA#INPCTRSTRCHR_BRK
      795  1175  765 E0E7         B         Y$INPPUTCHRERR        BUFFER BREAK INDICATOR


Elsie.D00  KAC$CLC - ASYNC Input CCP - Clear XOFF Halt if set                   TUE JUL 29 '97 23:55 Page:31
      797  1177                   TITLE 'KAC$CLC - ASYNC Input CCP - Clear XOFF Halt if set'
      798  1178  767 9010     Y$INPCLRHLT ;
      799                         LD       =KA_LCT_MSCSTT_HLT_DVC@S
      800  1179  769 533E         AND       KA_LCT_MSCSTT_HLT
      801  1180  76B E213         BZ        Y$INPCLRHLTRTN            B/NO HALT ACTIVE
      802  1181  76D 553E         XOR       KA_LCT_MSCSTT_HLT
      803  1182  76F 513E         ST        KA_LCT_MSCSTT_HLT
      804  1183  771 9320         AND      =KA_LCT_MSCSTT_HLT_USR@S
      805  1184  773 F20B         BNZ       Y$INPCLRHLTRTN            B/USER HALT STILL ON
      806                     *
      807                     * Both user and device halt are off. Start TRN CCP.
      808                     *
      809  1185  775 90F7533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_HLT@S
                     513D
      810  1186  77B 90FF         LD       ='FF'X
      811  1187  77D 512F         ST        KW#TRNSTTMSK
      812  1188  77F 06       Y$INPCLRHLTRTN ;
      813                         RETURN


Elsie.D00  KAC$CLC - ASYNC INPUT CCP - BUFFER CHR IN MEMORY                     TUE JUL 29 '97 23:55 Page:32
      815  1190                TITLE 'KAC$CLC - ASYNC INPUT CCP - BUFFER CHR IN MEMORY'
      816  1191  780 90FB531A Y$INPGETBFR ;
                     511A
      817                         RESET     KA_LCT_CNCSTT,;       SAY WE DONT HAVE CHR TO STCCB
      818                                   =KA_LCT_CNCSTT_STCCB@S
      819  1192  786 F71B         BNVB      Y$INPPUTCHR35         B
      820  1193  788 9040541A     SET       KA_LCT_CNCSTT,;       MUST BE CONNECTED IF HAVE CCB
                     511A
      821                                   =KA_LCT_CNCSTT_CNC@S
      822  1194  78E 06           RETURN
      823                     *
      824                     * buffer the character passed in the R register.
      825                     *
      826  1195  78F F70A     Y$INPPUTCHR ;
      827                         BNVB      Y$INPPUTCHR30         B/NO VALID CCB
      828  1196  791 11           ST
      829  1197  792 E302         BLC       Y$INPPUTCHR20         B/LAST CHR IN CCB
      830  1198  794 06       Y$INPPUTCHR10 ;
      831                         RETURN
      832  1199  795 02       Y$INPPUTCHR20 ;
      833                         GNCCB                           GET NEXT CCB
      834  1200  796 E7FD         BVB       Y$INPPUTCHR10         B/VALID CCB
      835  1201  798 E0E7         B         Y$INPGETBFR           B/NO VALID CCB, CHR ALREADY STORED
      836  1202  79A 5118     Y$INPPUTCHR30 ;
      837                         ST        KA_LCT_INPCHR         SAVE INPUT CHARACTER
      838  1203  79C 9004541A     SET       KA_LCT_CNCSTT,;       SAY WE HAVE CHR TO STCCB
                     511A
      839                                   =KA_LCT_CNCSTT_STCCB@S
      840  1204  7A2 90FD5314 Y$INPPUTCHR35 ;
                     5114
      841                         RESET     KW#CLACTR,=KW#CLACTR_RCVON@S     TURN RECEIVER OFF
      842  1205  7A8 32           OUT       LR#CLACTR
      843  1206  7A9 500E511F     ASSIGN    KA_LCT_SVDRCVSTT,KW#RCVSTT  SAVE RCV STATUS FOR CHANG
      844  1207  7AD 9008541A Y$INPPUTCHR40 ;
                     511A
      845                         SET       KA_LCT_CNCSTT,=KA_LCT_CNCSTT_WATFORINT@S
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - BUFFER CHR IN MEMORY                     TUE JUL 29 '97 23:55 Page:33
      846  1208  7B3 503E9304     BSET      KA_LCT_MSCSTT,;       B/MLC-16 (NMLC)
                     F209
      847                                   =KA_LCT_MSCSTT_MLC16@S,Y$INTR2_MLC16
      848  1209  7B9 500993C0     BSET      KW#RCVCHNCTR,;                B/Already interrupts Q'd
                     F20A
      849                                   =KW#RCVCHNCTR_DFRINTCNT@S,Y$INTR2
      850  1210  7BF E007         B         Y$INTR2_INTR
      851  1211  7C1 504D53FF Y$INTR2_MLC16 ;
                     F202
      852                         BSET      KW#RCVDFRINTCNT,'FF'X,Y$INTR2  B/Already interrupts Q'd
      853  1212  7C7 08       Y$INTR2_INTR ;
      854                         INTR
      855  1213  7C8          Y$INTR2 LABEL
      856  1214  7C8 01           WAIT                            WAIT FOR NEXT INTERRUPT
      857  1215  7C9 90F7531A     RESET     KA_LCT_CNCSTT,=KA_LCT_CNCSTT_WATFORINT@S
                     511A
      858  1216  7CF F7DD         BNVB      Y$INPPUTCHR40         B/Still need a CCB.
      859  1217  7D1 9040541A     SET       KA_LCT_CNCSTT,;       SAY WE'RE CONNECTED AGAIN
                     511A
      860                                   =KA_LCT_CNCSTT_CNC@S
      861  1218  7D7 501F510E     ASSIGN    KW#RCVSTT,KA_LCT_SVDRCVSTT   RESTORE ORIGINAL RCV STATUS
      862  1219  7DB 90025414     SET       KW#CLACTR,=KW#CLACTR_RCVON@S TURN RECEIVER ON
                     5114
      863  1220  7E1 32           OUT       LR#CLACTR
      864  1221  7E2 501A9304     BRESET    KA_LCT_CNCSTT,;              B/NO CHR TO STCCB
                     E208
      865                                   =KA_LCT_CNCSTT_STCCB@S,Y$INPPUTCHR75
      866  1222  7E8 90FF         LD        =255                          Init to "1 char stored"
      867  1223  7EA 513F         ST        KA_LCT_BFROFS
      868  1224  7EC 5018         LD        KA_LCT_INPCHR         L/CHR TO STORE THRU CCB
      869  1225  7EE 11           ST
      870  1226  7EF 06       Y$INPPUTCHR75 ;
      871                         RETURN                          RETURN TO CALLER
      872                     *
      873  1227  7F0 E09E     Y$INPPUTCHR_JMP1 ;
      874                         B         Y$INPPUTCHR


Elsie.D00  KAC$CLC - ASYNC INPUT CCP - DISCONNECT                               TUE JUL 29 '97 23:55 Page:34
      876  1229                TITLE 'KAC$CLC - ASYNC INPUT CCP - DISCONNECT'
      877  1230  7F2 501A9320 Y$INPDSC ;
                     F20E
      878                         BSET      KA_LCT_CNCSTT,;       B/DISCONNECT ARMED
      879                                   =KA_LCT_CNCSTT_DSCARM@S,Y$INPDSC20
      880  1231  7F8 9020541A     SET       KA_LCT_CNCSTT,;       INDICATE WE'VE SEEN DISCONNECT
                     511A
      881                                   =KA_LCT_CNCSTT_DSCARM@S
      882  1232  7FE 90FF         LD       ='FF'X                 FORCE ANOTHER INTERRUPT FOR DATASET SCAN
      883  1233  800 510E         ST        KW#RCVSTT
      884  1234  802 511F         ST        KA_LCT_SVDRCVSTT
      885  1235  804 06           RETURN                          RETURN TO CALLER
      886  1236  805 9080541A Y$INPDSC20 ;
                     511A
      887                         SET       KA_LCT_CNCSTT,;       INDICATE WE GOT DISCONNECTED
      888                                   =KA_LCT_CNCSTT_DSC@S
      889  1237  80B 90FD533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_INHPRG@S
                     513D
      890  1238  811 9000         LD       =0
      891  1239  813 513C         ST        KA_LCT_OTPINHPRGCHRCNT
      892  1240  815 90FE         LD       =KA#INPCTRSTRCHR_INT
      893  1241  817 F0D8         BAL       Y$INPPUTCHR_JMP1      BUFFER CHARACTER THRU CCB
      894  1242  819 9003         LD       =KA#INPCTRSTRCHR_DSC
      895  1243  81B F0D4         BAL       Y$INPPUTCHR_JMP1      BUFFER CHARACTER THRU CCB
      896  1244  81D 503E9304 Y$INPDSC50 ;
                     F209
      897                         BSET      KA_LCT_MSCSTT,;       B/MLC-16 (NMLC)
      898                                   =KA_LCT_MSCSTT_MLC16@S,Y$INTR3_MLC16
      899  1245  823 500993C0     BSET      KW#RCVCHNCTR,;                B/Already interrupts Q'd
                     F20A
      900                                   =KW#RCVCHNCTR_DFRINTCNT@S,Y$INTR3
      901  1246  829 E007         B         Y$INTR3_INTR
      902  1247  82B 504D53FF Y$INTR3_MLC16 ;
                     F202
      903                         BSET      KW#RCVDFRINTCNT,'FF'X,Y$INTR3  B/Already interrupts Q'd
      904  1248  831 08       Y$INTR3_INTR ;
Elsie.D00  KAC$CLC - ASYNC INPUT CCP - DISCONNECT                               TUE JUL 29 '97 23:55 Page:35
      905                         INTR
      906  1249  832          Y$INTR3 LABEL
      907  1250  832 9000     Y$INPDSC60 ;
      908                         LD       =0
      909  1251  834 511D         ST        KA_LCT_OTPCTRSTRCNT
      910  1252  836 90FC5314     RESET     KW#CLACTR,=(KW#CLACTR_TRNON@S|KW#CLACTR_RCVON@S)
                     5114
      911  1253  83C 32           OUT       LR#CLACTR            Turn taransmitter and receiver off
      912  1254  83D 503D         LD        KA_LCT_OTPSTT       Clear any output impediments
      913  1255  83F 93D3         AND      =~(KA_LCT_OTPSTT_RPTCHR@S|KA_LCT_OTPSTT_HLT@S|;
      914                                   KA_LCT_OTPSTT_TRNON@S)
      915  1256  841 523D         C         KA_LCT_OTPSTT
      916  1257  843 E109         BE        Y$INPDSC90               Kick the output channel
      917  1258  845 513D         ST        KA_LCT_OTPSTT            if it was running
      918  1259  847 90045429     SET       KW#TRNCHNCTR,=KW#TRNCHNCTR_STRIO@S
                     5129
 LC2-00096-0   WARNING: The byte specified (41) has been defined as
               being reserved for firmware use.
      919  1260  84D 501A9380 Y$INPDSC90 ;
                     E2B3
      920                         BRESET    KA_LCT_CNCSTT,;     Keep trying if LCGDSC got in the way
      921                                   =KA_LCT_CNCSTT_DSC@S,Y$INPDSC20
      922  1261  853 01           WAIT
      923  1262  854 E0F8         B         Y$INPDSC90          ENDPHSDSC will get us back to INPCCP


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP FOR AUTOBAUD TIMING                       TUE JUL 29 '97 23:55 Page:36
      925  1264                TITLE 'KAC$CLC - ASYNC OUTPUT CCP FOR AUTOBAUD TIMING'
      926                     *
      927                     * this output CCP is used to provide a 300 millisecond clock
      928                     * for the receive CCP while it is trying to auto-baud (line
      929                     * speed detect).
      930                     *
      931                     * the basic scheme is to put the transmitter in the 'transmit mark'
      932                     * mode for three character times at 110 baud.
      933                     *
      934  1265  856 501A9380 Y$OTPTMR ;
                     F213
      935                         BSET      KA_LCT_CNCSTT,;              B/DISCONNECTED
      936                                   =KA_LCT_CNCSTT_DSC@S,Y$OTPTMR20
      937  1266  85C 90FF         LD       ='FF'X                        SEND 3 PAD CHRS
      938  1267  85E 60016001     SEND      WAIT,REPEAT=3
                     6001
      939  1268  864 501A9380     BSET      KA_LCT_CNCSTT,;              B/DISCONNECTED
                     F205
      940                                   =KA_LCT_CNCSTT_DSC@S,Y$OTPTMR20
      941                     *
      942                     * start the receive CCP via the dataset scan mechanism
      943                     *
      944  1269  86A 9000     Y$OTPTMR10 ;
      945                         LD       =0
      946  1270  86C 510E         ST        KW#RCVSTT
      947                     *
      948                     * terminate 'transmit mark' mode
      949                     *
      950  1271  86E 90F65314 Y$OTPTMR20 ;
                     5114
      951                         RESET     KW#CLACTR,=(KW#CLACTR_TRNON@S|KW#CLACTR_TRNMRK@S)
      952  1272  874 32           OUT       LR#CLACTR
      953  1273  875 01       Y$OTPTMR40 ;
      954                         WAIT                            WAIT
      955  1274  876 5017         LD        KA_LCT_OTPASNRQS      We might have logon-timeout.
      956  1275  878 F2F1         BNZ       Y$OTPTMR10            Yup.  Start the disconnect.
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP FOR AUTOBAUD TIMING                       TUE JUL 29 '97 23:55 Page:37
      957  1276  87A E0FA         B         Y$OTPTMR40            B

Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP FOR AUTOBAUD TIMING                       TUE JUL 29 '97 23:55 Page:38
      959                     *
      960                     * main output loop.
      961                     *
      962  1278  87C 01       Y$OTPLOP ;
      963                         WAIT                            WAIT FOR INTERRUPT
      964  1279  87D 502F     Y$OTPCCP ;
      965                         LD        KW#TRNSTTMSK          B/NOT START RQS FROM L6 OR RCV CCP
      966  1280  87F E222         BZ        Y$OTPLOP20
      967  1281  881 9000         LD       =0
      968  1282  883 512F         ST        KW#TRNSTTMSK          RESET MASK, NO VALID SCAN INT'S
      969  1283  885 25           IN        LR#STT
      970  1284  886 95FF         XOR      ='FF'X
      971  1285  888 512E         ST        KW#TRNSTT             MAKE STATUS NEVER MATCH
      972  1286  88A F707         BNVB      Y$OTPLOP10            B/NO VALID CCB
      973  1287  88C 9010543D     SET       KA_LCT_OTPSTT,=KA_LCT_OTPSTT_VLDCCB@S
                     513D
      974  1288  892 5017     Y$OTPLOP10 ;
      975                         LD        KA_LCT_OTPASNRQS      B/NOT ASYNCHRONOUS REQUEST
      976  1289  894 E207         BZ        Y$OTPLOP15
      977  1290  896 9040543D     SET       KA_LCT_OTPSTT,;       INDICATE ASYNC REQUEST RECEIVED
                     513D
      978                                   =KA_LCT_OTPSTT_ASNRQS@S
      979  1291  89C 503D9320 Y$OTPLOP15 ;
                     F2DB
      980                         BSET      KA_LCT_OTPSTT,;              B/TRANSMITTER ON
      981                                   =KA_LCT_OTPSTT_TRNON@S,Y$OTPLOP
      982  1292  8A2 503D     Y$OTPLOP20 ;
      983                         LD        KA_LCT_OTPSTT
      984  1293  8A4 561B     Y$OTPLOP30 ;
      985                         TLU       KA_LCT_OTPTBL$        JUMP
      986  1294  8A6 00           NOP                              GIVE 3 BYTES AFTER TLU
      987                     *
      988                     *


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM CCB, NO PARITY            TUE JUL 29 '97 23:55 Page:39
      990  1296                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM CCB, NO PARITY'
      991                     *
      992                     * current status (if entered here from TLU instruction):
      993                     * y = yes,  n = no,  * = don't care
      994                     *
      995                     * n  immediate processing is active
      996                     * y  transmitter is on
      997                     * y  valid CCB
      998                     * n  halted
      999                     * n  output control string active
     1000                     * y  output purge inhibit on
     1001                     * n  add parity when sending character
     1002                     *
     1003  1297  8A8          Y$OTP100 ;
     1004        8A8              TARGET    Y$OTPLOP30
     1005  1298  8A8 503C         LD        KA_LCT_OTPINHPRGCHRCNT DECREMENT PURGE INHIBIT CHR COUNT
     1006  1299  8AA 05           DEC
     1007  1300  8AB 513C         ST        KA_LCT_OTPINHPRGCHRCNT
     1008  1301  8AD F210         BNZ       Y$OTP110              B/STILL PURGE INHIBITING
     1009  1302  8AF 90FD533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_INHPRG@S
                     513D
     1010  1303  8B5 501A9301     BRESET    KA_LCT_OTPMOD_PRG,;       B/NO PURGE REQUESTED
                     E204
     1011                                   =KA_LCT_OTPMOD_PRG@S,Y$OTP110
     1012  1304  8BB E601E7       JUMP      Y$PRGOTP              PURGE CCB'S
     1013  1305  8BE          Y$OTP110 LABEL
     1014                     *
     1015                     * current status (if entered here from TLU instruction):
     1016                     * y = yes,  n = no,  * = don't care
     1017                     *
     1018                     * n  immediate processing is active
     1019                     * y  transmitter is on
     1020                     * y  valid CCB
     1021                     * n  halted
     1022                     * n  output control string active
     1023                     * n  output purge inhibit on
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM CCB, NO PARITY            TUE JUL 29 '97 23:55 Page:40
     1024                     * n  add parity when sending character
     1025                     *
     1026  1306  8BE          Y$OTP120 ;
     1027        8BE              TARGET    Y$OTPLOP30
     1028  1307  8BE 10           LD
     1029  1308  8BF F31D         BNLC      Y$OTP130              B/NOT LAST CHR IN CCB
     1030  1309  8C1 5139         ST        KA_LCT_OTPTMP
     1031  1310  8C3 503E9304     BSET      KA_LCT_MSCSTT,;       B/MLC-16 (NMLC)
                     F20A
     1032                                   =KA_LCT_MSCSTT_MLC16@S,Y$GNB1
     1033  1311  8C9 5029         LD        KW#TRNCHNCTR
     1034  1312  8CB 93C0         AND      =KW#TRNCHNCTR_DFRINTCNT@S
     1035  1313  8CD 92C0         C        =KW#TRNCHNCTR_DFRINTCNT@S
     1036  1314  8CF F102         BNE       Y$GNB1
     1037  1315  8D1 08           INTR
     1038  1316  8D2 02       Y$GNB1        ;
     1039                         GNCCB
     1040  1317  8D3 E707         BVB       Y$VCCB1
     1041  1318  8D5 90EF533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_VLDCCB@S
                     513D
     1042  1319  8DB 5039     Y$VCCB1       ;
     1043                         LD        KA_LCT_OTPTMP
     1044  1320  8DD 92FE     Y$OTP130   ;
     1045                         C        =KA#OTPCTRSTRCHR_BGN
     1046  1321  8DF F103         BNE       Y$OTP140              B/NOT START OF CONTROL STRING
     1047  1322  8E1 F007         BAL       Y$OTPCTRSTR_JMP1      START OF CONTROL STRING
     1048  1323  8E3 5434     Y$OTP140 ;
     1049                         OR        KA_LCT_OTPPRTBIT      OR IN PARITY BIT
     1050  1324  8E5 60           SEND                            SEND (TRANSMIT) CHARACTER, NO PARITY
     1051  1325  8E6 E6FF94       JUMP      Y$OTPLOP              B
     1052                     *
     1053  1326  8E9 E601FD   Y$OTPCTRSTR_JMP1 ;
     1054                         JUMP      Y$OTPCTRSTR
     1055                     *
     1056  1327  8EC          Y$OTPLOP_JMP1 ;
     1057        8EC              TARGET    Y$OTPLOP30
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM CCB, NO PARITY            TUE JUL 29 '97 23:55 Page:41
     1058  1328  8EC E6FF8E       JUMP      Y$OTPLOP


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM CCB, PARITY               TUE JUL 29 '97 23:55 Page:42
     1060  1330                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM CCB, PARITY'
     1061                     *
     1062                     * current status (if entered here from TLU instruction):
     1063                     * y = yes,  n = no,  * = don't care
     1064                     *
     1065                     * n  immediate processing is active
     1066                     * y  transmitter is on
     1067                     * y  valid CCB
     1068                     * n  halted
     1069                     * n  output control string active
     1070                     * y  output purge inhibit on
     1071                     * y  add parity when sending character
     1072                     *
     1073  1331  8F0          Y$OTP200 ;
     1074        8F0              TARGET    Y$OTPLOP30
     1075  1332  8F0 503C         LD        KA_LCT_OTPINHPRGCHRCNT DECREMENT PURGE INHIBIT CHR COUNT
     1076  1333  8F2 05           DEC
     1077  1334  8F3 513C         ST        KA_LCT_OTPINHPRGCHRCNT
     1078  1335  8F5 F210         BNZ       Y$OTP210              B/STILL PURGE INHIBITING
     1079  1336  8F7 90FD533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_INHPRG@S
                     513D
     1080  1337  8FD 501A9301     BRESET    KA_LCT_OTPMOD_PRG,;       B/NO PURGE REQUESTED
                     E204
     1081                                   =KA_LCT_OTPMOD_PRG@S,Y$OTP210
     1082  1338  903 E6019F       JUMP      Y$PRGOTP              PURGE CCB'S
     1083  1339  906          Y$OTP210 LABEL
     1084                     *
     1085                     * current status (if entered here from TLU instruction):
     1086                     * y = yes,  n = no,  * = don't care
     1087                     *
     1088                     * n  immediate processing is active
     1089                     * y  transmitter is on
     1090                     * y  valid CCB
     1091                     * n  halted
     1092                     * n  output control string active
     1093                     * n  output purge inhibit on
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM CCB, PARITY               TUE JUL 29 '97 23:55 Page:43
     1094                     * y  add parity when sending character
     1095                     *
     1096  1340  906          Y$OTP220 ;
     1097        906              TARGET    Y$OTPLOP30
     1098  1341  906 10           LD
     1099  1342  907 F31D         BNLC      Y$OTP230              B/NOT LAST CHR IN CCB
     1100  1343  909 5139         ST        KA_LCT_OTPTMP
     1101  1344  90B 503E9304     BSET      KA_LCT_MSCSTT,;       B/MLC-16 (NMLC)
                     F20A
     1102                                   =KA_LCT_MSCSTT_MLC16@S,Y$GNB2
     1103  1345  911 5029         LD        KW#TRNCHNCTR
     1104  1346  913 93C0         AND      =KW#TRNCHNCTR_DFRINTCNT@S
     1105  1347  915 92C0         C        =KW#TRNCHNCTR_DFRINTCNT@S
     1106  1348  917 F102         BNE       Y$GNB2
     1107  1349  919 08           INTR
     1108  1350  91A 02       Y$GNB2        ;
     1109                         GNCCB
     1110  1351  91B E707         BVB       Y$VCCB2
     1111  1352  91D 90EF533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_VLDCCB@S
                     513D
     1112  1353  923 5039     Y$VCCB2       ;
     1113                         LD        KA_LCT_OTPTMP
     1114  1354  925 92FE     Y$OTP230   ;
     1115                         C        =KA#OTPCTRSTRCHR_BGN
     1116  1355  927 F103         BNE       Y$OTP240              B/NOT START OF CONTROL STRING
     1117  1356  929 F0BF         BAL       Y$OTPCTRSTR_JMP1      START OF CONTROL STRING
     1118  1357  92B 62       Y$OTP240 ;
     1119                         SEND      PARITY           SEND (TRANSMIT) CHARACTER WITH PARITY
     1120  1358  92C E6FF4E       JUMP      Y$OTPLOP              B


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM KA_LCT_OTPCHR, NO PARITY  TUE JUL 29 '97 23:55 Page:44
     1122  1360                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM KA_LCT_OTPCHR, NO PARITY'
     1123                     *
     1124                     * current status (if entered here from TLU instruction):
     1125                     * y = yes,  n = no,  * = don't care
     1126                     *
     1127                     * n  immediate processing is active
     1128                     * y  transmitter is on
     1129                     * *  valid CCB
     1130                     * n  halted
     1131                     * y  output control string active
     1132                     * *  output purge inhibit on
     1133                     * n  add parity when sending character
     1134                     *
     1135  1361  930          Y$OTP300 ;
     1136        930              TARGET    Y$OTPLOP30
     1137  1362  930 501D         LD        KA_LCT_OTPCTRSTRCNT   DECREMENT COUNT
     1138  1363  932 05           DEC
     1139  1364  933 511D         ST        KA_LCT_OTPCTRSTRCNT
     1140  1365  935 F207         BNZ       Y$OTP320              B/CONTROL STRING STILL ACTIVE
     1141  1366  937 90FB533D     RESET     KA_LCT_OTPSTT,;       END OF REPEAT-CHARACTER MODE
                     513D
     1142                                   =KA_LCT_OTPSTT_RPTCHR@S
     1143  1367  93D 5019     Y$OTP320 ;
     1144                         LD        KA_LCT_OTPCHR         L/CHARACTER TO SEND
     1145  1368  93F 5434         OR        KA_LCT_OTPPRTBIT      OR IN PARITY BIT
     1146  1369  941 60           SEND                            SEND CHARACTER, 0 OR 1 PARITY
     1147  1370  942 E6FF38       JUMP      Y$OTPLOP              B


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM KA_LCT_OTPCHR, PARITY     TUE JUL 29 '97 23:55 Page:45
     1149  1372                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - SEND CHR FROM KA_LCT_OTPCHR, PARITY'
     1150                     *
     1151                     * current status (if entered here from TLU instruction):
     1152                     * y = yes,  n = no,  * = don't care
     1153                     *
     1154                     * n  immediate processing is active
     1155                     * y  transmitter is on
     1156                     * *  valid CCB
     1157                     * n  halted
     1158                     * y  output control string active
     1159                     * *  output purge inhibit on
     1160                     * y  add parity when sending character
     1161                     *
     1162  1373  946          Y$OTP400 ;
     1163        946              TARGET    Y$OTPLOP30
     1164  1374  946 501D         LD        KA_LCT_OTPCTRSTRCNT   DECREMENT COUNT
     1165  1375  948 05           DEC
     1166  1376  949 511D         ST        KA_LCT_OTPCTRSTRCNT
     1167  1377  94B F207         BNZ       Y$OTP410              B/CONTROL STRING STILL ACTIVE
     1168  1378  94D 90FB533D     RESET     KA_LCT_OTPSTT,;       END OF REPEAT-CHARACTER MODE
                     513D
     1169                                   =KA_LCT_OTPSTT_RPTCHR@S
     1170  1379  953 5019     Y$OTP410 ;
     1171                         LD        KA_LCT_OTPCHR  SEND (TRANSMIT) CHARACTER WITH PARITY
     1172  1380  955 62           SEND      PARITY
     1173  1381  956 E6FF24       JUMP      Y$OTPLOP              B


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - TURN TRANSMITTER ON                     TUE JUL 29 '97 23:55 Page:46
     1175  1383                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - TURN TRANSMITTER ON'
     1176                     *
     1177                     * current status (if entered here from TLU instruction):
     1178                     * y = yes,  n = no,  * = don't care
     1179                     *
     1180                     *             IMMEDIATE PROCESSING IS ACTIVE
     1181                     *             | TRANSMITTER IS ON
     1182                     *             | | VALID CCB
     1183                     *             | | | HALTED
     1184                     *             | | | | OUTPUT CONTROL STRING ACTIVE
     1185                     *             | | | | | OUTPUT PURGE INHIBIT ON
     1186                     *             | | | | | | ADD PARITY WHEN SENDING CHARACTER
     1187                     *             | | | | | | |
     1188                     *             V V V V V V V
     1189                     *             N N * N Y * *
     1190                     *             N N Y N N * *
     1191                     *             Y N * * * * *
     1192                     *
     1193  1384  95A          Y$OTP800 ;
     1194        95A              TARGET    Y$OTPLOP30
     1195  1385  95A 501A9380     BSET      KA_LCT_CNCSTT,;       B/DISCONNECT OCCURRED
                     F211
     1196                                   =KA_LCT_CNCSTT_DSC@S,Y$OTP830
     1197  1386  960 90415414     SET       KW#CLACTR,=KW#CLACTR_TRNON@S|;   TURN TRANSMITTER ON
                     5114
     1198                                              KW#CLACTR_RTS@S       RTS TOO - JUST IN CASE
     1199  1387  966 32           OUT       LR#CLACTR
     1200  1388  967 9020543D     SET       KA_LCT_OTPSTT,=KA_LCT_OTPSTT_TRNON@S
                     513D
     1201  1389  96D E6FF0D       JUMP      Y$OTPLOP              GO SEE WHAT TO DO NEXT
     1202  1390  970 503D9340 Y$OTP830 ;
                     E208
     1203                         BRESET    KA_LCT_OTPSTT,;       B/NO ASYNC RQS
     1204                                   =KA_LCT_OTPSTT_ASNRQS@S,Y$OTP850
     1205                     *
     1206                     * there is an asynchronous request outstanding.  we can't start the
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - TURN TRANSMITTER ON                     TUE JUL 29 '97 23:55 Page:47
     1207                     * transmitter.  lie to the output dispatcher, and pretend to have
     1208                     * the transmitter on.  if the asynchronous request code tries
     1209                     * to transmit, the characters will be ignored.
     1210                     *
     1211  1391  976 503D         LD        KA_LCT_OTPSTT
     1212  1392  978 9420         OR       =KA_LCT_OTPSTT_TRNON@S   FAKE TRNON
     1213  1393  97A E6FF28       JUMP      Y$OTPLOP30            PROCESS ASYNC RQS
     1214  1394  97D E60125   Y$OTP850 ;
     1215                         JUMP      Y$PRGOTP              PURGE OUTPUT


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - TURN TRANSMITTER OFF                    TUE JUL 29 '97 23:55 Page:48
     1217  1396                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - TURN TRANSMITTER OFF'
     1218                     *
     1219                     * current status (if entered here from TLU instruction):
     1220                     * y = yes,  n = no,  * = don't care
     1221                     *
     1222                     *             IMMEDIATE PROCESSING IS ACTIVE
     1223                     *             | TRANSMITTER IS ON
     1224                     *             | | VALID CCB
     1225                     *             | | | HALTED
     1226                     *             | | | | OUTPUT CONTROL STRING ACTIVE
     1227                     *             | | | | | OUTPUT PURGE INHIBIT ON
     1228                     *             | | | | | | ADD PARITY WHEN SENDING CHARACTER
     1229                     *             | | | | | | |
     1230                     *             V V V V V V V
     1231                     *             N Y * Y Y * *
     1232                     *             N Y N * N * *
     1233                     *             N Y Y Y N * *
     1234                     *
     1235  1397  980          Y$OTP900 ;
     1236        980              TARGET    Y$OTPLOP30
     1237  1398  980 90FE5314     RESET     KW#CLACTR,=KW#CLACTR_TRNON@S     TURN TRANSMITTER OFF
                     5114
     1238  1399  986 32           OUT       LR#CLACTR
     1239  1400  987 90DF533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_TRNON@S INDICATE TRANSMITTER IS OFF
                     513D
     1240  1401  98D E6FEED       JUMP      Y$OTPLOP


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - IMMEDIATE PROCESSING                    TUE JUL 29 '97 23:55 Page:49
     1242  1403                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - IMMEDIATE PROCESSING'
     1243                     *
     1244                     * current status (if entered here from TLU instruction):
     1245                     * y = yes,  n = no,  * = don't care
     1246                     *
     1247                     *             IMMEDIATE PROCESSING IS ACTIVE
     1248                     *             | TRANSMITTER IS ON
     1249                     *             | | VALID CCB
     1250                     *             | | | HALTED
     1251                     *             | | | | OUTPUT CONTROL STRING ACTIVE
     1252                     *             | | | | | OUTPUT PURGE INHIBIT ON
     1253                     *             | | | | | | ADD PARITY WHEN SENDING CHARACTER
     1254                     *             | | | | | | |
     1255                     *             V V V V V V V
     1256                     *             Y Y * * * * *
     1257                     *
     1258  1404  990          Y$OTPASNRQS ;
     1259        990              TARGET    Y$OTPLOP30
     1260  1405  990 5017         LD        KA_LCT_OTPASNRQS      L/ASYNC REQUEST NUMBER
     1261  1406  992 930F         AND       =15                   CHECK FOR INITIAL VALUE
     1262  1407  994 5217         C         KA_LCT_OTPASNRQS      IF LESS THAN 16, NEEDS
     1263  1408  996 E13F         BE        Y$OTPASNRQS046        CONVERSION
     1264  1409  998 5017         LD        KA_LCT_OTPASNRQS
     1265  1410  99A          Y$OTPASNRQS_TLU LABEL
     1266  1411  99A 561B         TLU       KA_LCT_OTPTBL$              LOAD CHR OR DO GOTO
     1267  1412  99C 5139         ST        KA_LCT_OTPTMP         STORE CHARACTER IN TEMP CELL
     1268  1413  99E 503D9320 Y$OTPASNRQS025 ;
                     E226
     1269                         BRESET    KA_LCT_OTPSTT,;       B/TRANSMITTER OFF
     1270                                   =KA_LCT_OTPSTT_TRNON@S,Y$OTPASNRQS037
     1271  1414  9A4 503D9301     BSET      KA_LCT_OTPSTT,;       B/EVEN OR ODD PARITY
                     F208
     1272                                   =KA_LCT_OTPSTT_PRTENB@S,Y$OTPASNRQS030
     1273  1415  9AA 5039         LD        KA_LCT_OTPTMP         LOAD CHR
     1274  1416  9AC 5434         OR        KA_LCT_OTPPRTBIT      OR IN PARITY
     1275  1417  9AE 60           SEND                            SEND CHARACTER
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - IMMEDIATE PROCESSING                    TUE JUL 29 '97 23:55 Page:50
     1276  1418  9AF E004         B         Y$OTPASNRQS035
     1277  1419  9B1 5039     Y$OTPASNRQS030 ;
     1278                         LD        KA_LCT_OTPTMP         SEND CHR, EVEN OR ODD PARITY
     1279  1420  9B3 62           SEND      PARITY
     1280  1421  9B4 5017     Y$OTPASNRQS035 ;
     1281                         LD        KA_LCT_OTPASNRQS      POINT TO NEXT CHR/GOTO
     1282  1422  9B6 05           DEC
     1283  1423  9B7 5117         ST        KA_LCT_OTPASNRQS
     1284  1424  9B9 E6FEC1       JUMP      Y$OTPLOP              WAIT FOR INTERRUPT
     1285                     *
     1286                     * output a single character, synchronously with the buffered output.
     1287                     *
     1288  1425  9BC          Y$OTPASNRQS036 ;
     1289        9BC              TARGET    Y$OTPASNRQS_TLU
     1290  1426  9BC 503D930C     BRESET    KA_LCT_OTPSTT,;       B/NO Rpt Chr or Halt
                     E2DD
     1291                                   =(KA_LCT_OTPSTT_RPTCHR@S|KA_LCT_OTPSTT_HLT@S),;
     1292                                    Y$OTPASNRQS025
     1293                     *
     1294                     * we're in the process of sending a repeated character.
     1295                     * the request to send this single character is synchronous with
     1296                     * the sending of other characters, so we have to wait until the
     1297                     * repeated characters have been sent.  do the output interrupt
     1298                     * dispatching as if the asynchronous request wasn't pending.
     1299                     *
     1300  1427  9C2 503D         LD        KA_LCT_OTPSTT
     1301  1428  9C4 93BF         AND      =(~KA_LCT_OTPSTT_ASNRQS@S)
     1302  1429  9C6 E6FEDC       JUMP      Y$OTPLOP30
     1303                     *
     1304                     * we are processing a character in an output asynchronous
     1305                     * request, and the transmitter is off, indicating we've
     1306                     * had a disconnect.  we continue processing the characters
     1307                     * without sending them because the string being processed
     1308                     * may contain something other than a character to send.
     1309                     * go on to the next character (or whatever else) in the string.
     1310                     *
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - IMMEDIATE PROCESSING                    TUE JUL 29 '97 23:55 Page:51
     1311  1430  9C9 5017     Y$OTPASNRQS037 ;
     1312                         LD        KA_LCT_OTPASNRQS      POINT TO NEXT CHR/GOTO
     1313  1431  9CB 05           DEC
     1314  1432  9CC 5117         ST        KA_LCT_OTPASNRQS
     1315  1433  9CE E0CB         B         Y$OTPASNRQS_TLU       PROCESS NEXT CHARACTER
     1316                     *
     1317                     * do PHSDSC after typing ', please try later'.
     1318                     *
     1319  1434  9D0          Y$OTPASNRQS040 ;
     1320        9D0              TARGET    Y$OTPASNRQS_TLU
     1321  1435  9D0 9007         LD       =KA#OTPASNRQS_BGNPHSDSC
     1322  1436  9D2 E003         B         Y$OTPASNRQS046
     1323                     *
     1324                     * type ', please try later' after typing 'no context'
     1325                     * or 'line disabled'
     1326                     *
     1327  1437  9D4          Y$OTPASNRQS041 ;
     1328        9D4              TARGET    Y$OTPASNRQS_TLU
     1329  1438  9D4 900C         LD       =KA#OTPASNRQS_PLSTRYLTR
     1330  1439  9D6 E20D     Y$OTPASNRQS046 ;
     1331                         BZ        Y$OTPASNRQS080        ZERO REQUEST IS IGNORED
     1332  1440  9D8 05           DEC
     1333  1441  9D9 561B         TLU       KA_LCT_OTPTBL$
     1334  1442  9DB 5117         ST        KA_LCT_OTPASNRQS      S/INDEX
     1335  1443  9DD E0BC         B         Y$OTPASNRQS_TLU       GO GET CHARACTER
     1336                     *
     1337                     * we are to start the receive CCP by resetting the receive
     1338                     * dataset status scan data.
     1339                     *
     1340  1444  9E0          Y$OTPASNRQS060 ;
     1341        9E0              TARGET    Y$OTPASNRQS_TLU
     1342  1445  9E0 9000         LD       =0
     1343  1446  9E2 510E         ST        KW#RCVSTT
     1344                     *
     1345                     * we are done processing the character string.
     1346                     *
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - IMMEDIATE PROCESSING                    TUE JUL 29 '97 23:55 Page:52
     1347  1447  9E4          Y$OTPASNRQS080 ;
     1348        9E4              TARGET    Y$OTPASNRQS_TLU
     1349  1448  9E4 90BF533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_ASNRQS@S
                     513D
     1350  1449  9EA 9000         LD       =0
     1351  1450  9EC 5117         ST        KA_LCT_OTPASNRQS
     1352  1451  9EE E6FE8C       JUMP      Y$OTPLOP              GO WAIT FOR INTERRUPT
     1353                     *
     1354                     * output halt request.
     1355                     *
     1356  1452  9F2          Y$OTPASNRQS100 ;
     1357        9F2              TARGET    Y$OTPASNRQS_TLU
     1358  1453  9F2 9020543E     SET       KA_LCT_MSCSTT_HLT,=KA_LCT_MSCSTT_HLT_USR@S   USER HALT
                     513E
     1359  1454  9F8 9008543D     SET       KA_LCT_OTPSTT,=KA_LCT_OTPSTT_HLT@S   SET OUTPUT HALTED MODE
                     513D
     1360  1455  9FE E0E5         B         Y$OTPASNRQS080        B
     1361                     *
     1362                     * output-resume (clear halt) request.
     1363                     *
     1364  1456  A00          Y$OTPASNRQS200 ;
     1365        A00              TARGET    Y$OTPASNRQS_TLU
     1366  1457  A00 90DF533E     RESET     KA_LCT_MSCSTT_HLT,=KA_LCT_MSCSTT_HLT_USR@S   RESET USER HALT
                     513E
     1367  1458  A06 503E9310     BSET      KA_LCT_MSCSTT_HLT,;                      B/DVC HLT STILL ON
                     F2D9
     1368                                  =KA_LCT_MSCSTT_HLT_DVC@S,Y$OTPASNRQS080
     1369  1459  A0C 90F7533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_HLT@S   RESET OUTPUT HALTED MODE
                     513D
     1370  1460  A12 E0D1         B         Y$OTPASNRQS080        B
     1371                     *
     1372                     * output purge request.
     1373                     *
     1374  1461  A14          Y$OTPASNRQS300 ;
     1375        A14              TARGET    Y$OTPASNRQS_TLU
     1376  1462  A14 9000         LD       =0
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - IMMEDIATE PROCESSING                    TUE JUL 29 '97 23:55 Page:53
     1377  1463  A16 5117         ST        KA_LCT_OTPASNRQS
     1378  1464  A18 90CF533E     RESET     KA_LCT_MSCSTT_HLT,=KA_LCT_MSCSTT_HLT@S
                     513E
     1379  1465  A1E 90B7533D     RESET     KA_LCT_OTPSTT,;       RESET OUTPUT-HALTED MODE
                     513D
     1380                                   =(KA_LCT_OTPSTT_ASNRQS@S|KA_LCT_OTPSTT_HLT@S)
     1381                     *
     1382                     * save RCV status for change
     1383                     *
     1384  1466  A24 503C         LD        KA_LCT_OTPINHPRGCHRCNT
     1385  1467  A26 E27D         BZ        Y$PRGOTP              PURGE OUTPUT
     1386  1468  A28 F707         BNVB      Y$OTPASNRQS350        B/NO VALID CCB, NO CCBS TO PURGE
     1387  1469  A2A 9001541A     SET       KA_LCT_OTPMOD_PRG,=KA_LCT_OTPMOD_PRG@S
                     511A
     1388  1470  A30 E0B3     Y$OTPASNRQS350 ;
     1389                         B         Y$OTPASNRQS080        B
     1390                     *
     1391                     * begin physical disconnect.
     1392                     * we're to drop DTR and RTS to drop the line.
     1393                     * we're probably doing this because KN$CHN_DRPDTR or
     1394                     * KV$VDI_INPPHSDSC is set.
     1395                     *
     1396  1471  A32          Y$OTPASNRQS400 ;
     1397        A32              TARGET    Y$OTPASNRQS_TLU
     1398  1472  A32 F007         BAL       Y$OTPASNRQS407
     1399  1473  A34 E0AF         B         Y$OTPASNRQS080
     1400  1474  A36          Y$OTPASNRQS405 ;
     1401        A36              TARGET    Y$OTPASNRQS_TLU
     1402  1475  A36 F003         BAL       Y$OTPASNRQS407
     1403  1476  A38 E035         B         Y$OTPASNRQS600
     1404  1477  A3A          Y$OTPASNRQS407 ;
     1405        A3A              LABEL
     1406                     *
     1407                     * disable the receive dataset status scan
     1408                     *
     1409  1478  A3A 9080         LD       =KW#RCVSCN_SCNCTR@S
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - IMMEDIATE PROCESSING                    TUE JUL 29 '97 23:55 Page:54
     1410  1479  A3C 5108         ST        KW#RCVSCN
     1411  1480  A3E 25           IN        LR#STT
     1412  1481  A3F 93E0         AND      ='E0'X
     1413  1482  A41 92E0         C        ='E0'X
     1414  1483  A43 F11E         BNE       Y$OTPASNRQS450        B/NOT ALL OF CD, CTS, AND DSR
     1415                     *
     1416                     * enable the transmit dataset status scan control.
     1417                     * this is a legitimate use of the scan control for the transmit
     1418                     * CCP.
     1419                     *
     1420  1484  A45 512F         ST        KW#TRNSTTMSK
     1421  1485  A47 512E         ST        KW#TRNSTT
     1422                     *
     1423                     * send 2 pad characters to flush the transmitter registers
     1424                     * before killing the output path.
     1425                     *
     1426  1486  A49 90C1         LD       =(LR#CLACTR_DTR@S|;
     1427                                   LR#CLACTR_RTS@S|;
     1428                                   LR#CLACTR_TRNON@S)
     1429  1487  A4B 5114         ST        KW#CLACTR
     1430  1488  A4D 32           OUT       LR#CLACTR
     1431  1489  A4E 90FF         LD       ='FF'X                 SEND PAD CHR
     1432  1490  A50 60           SEND
     1433  1491  A51 01           WAIT                            Wait til ready or status change.
     1434  1492  A52 60           SEND                            Ignore Error if status change.
     1435                     *
     1436                     * Say disconnect happened, since the input CCP won't see it,
     1437                     * and the Y$OTP800 would wait forever if CTS goes off.
     1438                     *
     1439  1493  A53 9080541A     SET       KA_LCT_CNCSTT,=KA_LCT_CNCSTT_DSC@S
                     511A
     1440                     *
     1441                     * disable the transmit dataset status scan
     1442                     *
     1443  1494  A59 9000         LD       =0
     1444  1495  A5B 512F         ST        KW#TRNSTTMSK
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - IMMEDIATE PROCESSING                    TUE JUL 29 '97 23:55 Page:55
     1445  1496  A5D 25           IN        LR#STT
     1446  1497  A5E 95FF         XOR      ='FF'X
     1447  1498  A60 512E         ST        KW#TRNSTT             MAKE STATUS NEVER MATCH
     1448                     *
     1449                     * drop DTR and RTS.
     1450                     *
     1451  1499  A62 90DF533D Y$OTPASNRQS450 ;
                     513D
     1452                         RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_TRNON@S
     1453  1500  A68 9000         LD       =0
     1454  1501  A6A 5114         ST        KW#CLACTR
     1455  1502  A6C 32           OUT       LR#CLACTR
     1456  1503  A6D 06           RETURN
     1457                     *
     1458                     * end physical disconnect.  we're done holding DTR and RTS down.
     1459                     * cause the re-initialization of the CCPs.
     1460                     *
     1461  1504  A6E          Y$OTPASNRQS600 ;
     1462        A6E              TARGET    Y$OTPASNRQS_TLU
     1463  1505  A6E 50089310     BSET      KW#RCVSCN,;
                     F209
     1464                                  =KW#RCVSCN_STRCCP@S,Y$OTPASNRQS620
     1465  1506  A74 90045106     SETADDR   KW#RCVCCP$,Y$INPCCP
                     907C5107
     1466  1507  A7C 9090     Y$OTPASNRQS620 ;
     1467                         LD       =(KW#RCVSCN_SCNCTR@S|KW#RCVSCN_STRCCP@S)
     1468  1508  A7E 5108         ST        KW#RCVSCN
     1469  1509  A80 9000         LD       =0
     1470  1510  A82 511A         ST        KA_LCT_CNCSTT
     1471  1511  A84 25           IN        LR#STT
     1472  1512  A85 95FF         XOR      ='FF'X
     1473  1513  A87 510E         ST        KW#RCVSTT             MAKE STATUS NEVER MATCH
     1474  1514  A89 E0A6         B         Y$OTPASNRQS350        B


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - INITIATE ASYNCHRONOUS REQUEST           TUE JUL 29 '97 23:55 Page:56
     1476  1516                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - INITIATE ASYNCHRONOUS REQUEST'
     1477                     *
     1478                     * initiate an output asynchronous request.
     1479                     *
     1480  1517  A8B 5117     Y$OTPINTASNRQS ;
     1481                         ST        KA_LCT_OTPASNRQS
     1482  1518  A8D 9003511B     SETADDR   KA_LCT_OTPTBL$,OTPTBL
                     9018511C
     1483  1519  A95 90085126     SETADDR   KW#TRNCCP$,Y$OTPLOP10  SET CCP POINTER TO Y$OTPLOP10
                     90925127
     1484                     *
     1485                     * make sure the transmit channel runs (CTS might have dropped).
     1486                     *
     1487  1520  A9D 90045429     SET       KW#TRNCHNCTR,=KW#TRNCHNCTR_STRIO@S
                     5129
 LC2-00096-0   WARNING: The byte specified (41) has been defined as
               being reserved for firmware use.
     1488  1521  AA3 06           RETURN


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - OUTPUT PURGE                            TUE JUL 29 '97 23:55 Page:57
     1490  1523                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - OUTPUT PURGE'
     1491                     *
     1492                     * purge CCBs
     1493                     *
     1494  1524  AA4 E714     Y$PRGOTP ;
     1495                         BVB       Y$PRGOTP10            B/VALID CCB
     1496  1525  AA6 9000         LD       =0
     1497  1526  AA8 511D         ST        KA_LCT_OTPCTRSTRCNT   RESET OUTPUT CONTROL STRING COUNT
     1498  1527  AAA 90EB533D     RESET     KA_LCT_OTPSTT,;       RESET REPEAT-CHARACTER COUNT
                     513D
     1499                                   =(KA_LCT_OTPSTT_RPTCHR@S|;  AND VALID CCB FLAG
     1500                                   KA_LCT_OTPSTT_VLDCCB@S)
     1501  1528  AB0 90FE531A     RESET     KA_LCT_OTPMOD_PRG,;       RESET PURGE FLAG
                     511A
     1502                                   =KA_LCT_OTPMOD_PRG@S
     1503  1529  AB6 E6FDC4       JUMP      Y$OTPLOP              GO TO TOP OF OUTPUT LOOP AND WAIT
     1504  1530  AB9 90045430 Y$PRGOTP10 ;
                     5130
     1505                         SET       KW#TRNCCBSTTPRG1,=KW#TRNCCBSTTPRG1@S  Mark the CCB for KAO
     1506  1531  ABF 503E9304     BSET      KA_LCT_MSCSTT,;       B/MLC-16 (NMLC)
                     F20A
     1507                                   =KA_LCT_MSCSTT_MLC16@S,Y$GNB3
     1508  1532  AC5 5029         LD        KW#TRNCHNCTR
     1509  1533  AC7 93C0         AND      =KW#TRNCHNCTR_DFRINTCNT@S
     1510  1534  AC9 92C0         C        =KW#TRNCHNCTR_DFRINTCNT@S
     1511  1535  ACB F102         BNE       Y$GNB3
     1512  1536  ACD 08           INTR
     1513  1537  ACE 02       Y$GNB3        ;
     1514                         GNCCB
     1515  1538  ACF E0D4         B         Y$PRGOTP              LOOP


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - PURGE INHIBIT ACCOUNTING                TUE JUL 29 '97 23:55 Page:58
     1517  1540                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - PURGE INHIBIT ACCOUNTING'
     1518                     *
     1519                     * do accounting for purge inhibit character count, we're
     1520                     * about to do a LDCCB (load character thru CCB).
     1521                     *
     1522  1541  AD1 503C     Y$OTPINHPRGLD_CCB ;
     1523                         LD        KA_LCT_OTPINHPRGCHRCNT DECREMENT PURGE INHIBIT CHR COUNT
     1524  1542  AD3 05           DEC
     1525  1543  AD4 513C         ST        KA_LCT_OTPINHPRGCHRCNT
     1526  1544  AD6 F210         BNZ       Y$OTPINHPRGLD_CCB90   B/COUNT NOT TO 0 YET
     1527  1545  AD8 90FD533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_INHPRG@S
                     513D
     1528  1546  ADE 501A9301     BRESET    KA_LCT_OTPMOD_PRG,;       B/NO PURGE REQUESTED
                     E204
     1529                                   =KA_LCT_OTPMOD_PRG@S,Y$OTPINHPRGLD_CCB90
     1530  1547  AE4 E6FFBE       JUMP      Y$PRGOTP              B/PURGE OUTPUT
     1531  1548  AE7 06       Y$OTPINHPRGLD_CCB90 ;
     1532                         RETURN


Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - OUTPUT CONTROL STRING                   TUE JUL 29 '97 23:55 Page:59
     1534  1550                TITLE 'KAC$CLC - ASYNC OUTPUT CCP - OUTPUT CONTROL STRING'
     1535                     *
     1536                     * current status:
     1537                     * y = yes,  n = no,  * = don't care
     1538                     *
     1539                     *             IMMEDIATE PROCESSING IS ACTIVE
     1540                     *             | TRANSMITTER IS ON
     1541                     *             | | VALID CCB
     1542                     *             | | | HALTED
     1543                     *             | | | | OUTPUT CONTROL STRING ACTIVE
     1544                     *             | | | | | OUTPUT PURGE INHIBIT ON
     1545                     *             | | | | | | ADD PARITY WHEN SENDING CHARACTER
     1546                     *             | | | | | | |
     1547                     *             V V V V V V V
     1548                     *             N Y * N N * *
     1549                     *
     1550                     * we just got the character that introduces control strings.
     1551                     * if the next chr is the same, it indicates we are to send
     1552                     * the character as-is, rather than interpreting it as a
     1553                     * control string.  control strings are never split across buffers.
     1554                     *
     1555  1551  AE8 10       Y$OTPCTRSTR ;
     1556                         LD
     1557  1552  AE9 5119         ST        KA_LCT_OTPCHR
     1558  1553  AEB F31B         BNLC      Y$OTPCTRSTR040        B/NOT LAST CHR IN CCB
     1559  1554  AED 503E9304     BSET      KA_LCT_MSCSTT,;       B/MLC-16 (NMLC)
                     F20A
     1560                                   =KA_LCT_MSCSTT_MLC16@S,Y$GNB4
     1561  1555  AF3 5029         LD        KW#TRNCHNCTR
     1562  1556  AF5 93C0         AND      =KW#TRNCHNCTR_DFRINTCNT@S
     1563  1557  AF7 92C0         C        =KW#TRNCHNCTR_DFRINTCNT@S
     1564  1558  AF9 F102         BNE       Y$GNB4
     1565  1559  AFB 08           INTR
     1566  1560  AFC 02       Y$GNB4        ;
     1567                         GNCCB
     1568  1561  AFD E707         BVB       Y$VCCB4
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - OUTPUT CONTROL STRING                   TUE JUL 29 '97 23:55 Page:60
     1569  1562  AFF 90EF533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_VLDCCB@S
                     513D
     1570  1563  B05 5019     Y$VCCB4       ;
     1571                         LD        KA_LCT_OTPCHR
     1572  1564  B07 92FE     Y$OTPCTRSTR040 ;
     1573                         C        =KA#OTPCTRSTRCHR_BGN
     1574  1565  B09 F102         BNE       Y$OTPCTRSTR050        B/NOT LITERAL CHR, CONTROL STRING
     1575  1566  B0B 06           RETURN                          LITERAL CHR, SEND IT
     1576  1567  B0C 503C     Y$OTPCTRSTR050 ;
     1577                         LD        KA_LCT_OTPINHPRGCHRCNT
     1578  1568  B0E E203         BZ        Y$OTPCTRSTR060
     1579  1569  B10 F0C0         BAL       Y$OTPINHPRGLD_CCB     DO ACCOUNTING FOR PURGE INHIBIT
     1580  1570  B12 5019     Y$OTPCTRSTR060 ;
     1581                         LD        KA_LCT_OTPCHR         RESTORE CHR
     1582  1571  B14 933F         AND      ='3F'X                 MASK COUNT
     1583  1572  B16 511D         ST        KA_LCT_OTPCTRSTRCNT   SAVE COUNT
     1584  1573  B18 5019         LD        KA_LCT_OTPCHR_CTRSTRTYP L/CONTROL STRING TYPE
     1585  1574  B1A 93C0         AND      =KA_LCT_OTPCHR_CTRSTRTYP@S
     1586  1575  B1C E260         BZ        Y$OTPCTRSTR600        B/NOT REPEAT CHR OR PURGE INHIBIT FUNCTION
     1587  1576  B1E 92C0         C        =KA#OTPCTRSTRCHR_RPTSP
     1588  1577  B20 F107         BNE       Y$OTPCTRSTR100        B/NOT 'REPEAT SPACE' CTR STR
     1589  1578  B22 5020         LD        '20'X                 L/ASCII SPACE CHR
     1590  1579  B24 5119         ST        KA_LCT_OTPCHR
     1591  1580  B26 E04A         B         Y$OTPCTRSTR170        B
     1592  1581  B28 9280     Y$OTPCTRSTR100 ;
     1593                         C        =KA#OTPCTRSTRCHR_INHPRG
     1594  1582  B2A F123         BNE       Y$OTPCTRSTR140        B/NOT PURGE-INHIBIT N CHR'S
     1595  1583  B2C 501A9380     BSET      KA_LCT_CNCSTT,=KA_LCT_CNCSTT_DSC@S,Y$OTPCTRSTR130
                     F216
     1596  1584  B32 501A9340     BRESET    KA_LCT_CNCSTT,=KA_LCT_CNCSTT_CNC@S,Y$OTPCTRSTR130
                     E210
     1597  1585  B38 501D         LD        KA_LCT_OTPCTRSTRCNT   L/NUMBER OF CHRS TO PROTECT
     1598  1586  B3A 95FF         XOR      ='FF'X                 THIS IS THE SECRET WAY TO INCREMENT
     1599  1587  B3C 05           DEC                             IN THE MLCP... THE MLCP DESIGNERS
     1600  1588  B3D 95FF         XOR      ='FF'X                 KNEW WE DIDN'T NEED TO DO THAT....
     1601  1589  B3F 513C         ST        KA_LCT_OTPINHPRGCHRCNT S/ADJUSTED PURGE INHIBIT COUNT
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - OUTPUT CONTROL STRING                   TUE JUL 29 '97 23:55 Page:61
     1602  1590  B41 9002543D     SET       KA_LCT_OTPSTT,;        INDICATE PURGE INHIBIT MODE
                     513D
     1603                                   =KA_LCT_OTPSTT_INHPRG@S
     1604  1591  B47 9000     Y$OTPCTRSTR130 ;
     1605                         LD       =0
     1606  1592  B49 511D         ST        KA_LCT_OTPCTRSTRCNT   CLEAR REPEAT COUNT
     1607  1593  B4B E6FD55       JUMP      Y$OTPLOP20            GO SEE WHAT TO DO NEXT
     1608  1594  B4E 503C     Y$OTPCTRSTR140 ;
     1609                         LD        KA_LCT_OTPINHPRGCHRCNT  B/NOT INHIBITING PURGES
     1610  1595  B50 E203         BZ        Y$OTPCTRSTR145
     1611  1596  B52 F027         BAL       Y$OTPINHPRGLD_CCB_JMP1  LDCCB WHILE PURGE INHIBITED
     1612  1597  B54 10       Y$OTPCTRSTR145 ;
     1613                         LD
     1614  1598  B55 5119         ST        KA_LCT_OTPCHR
     1615  1599  B57 F319         BNLC      Y$OTPCTRSTR170        B/NOT LAST CHR IN CCB
     1616  1600  B59 503E9304     BSET      KA_LCT_MSCSTT,;       B/MLC-16 (NMLC)
                     F20A
     1617                                   =KA_LCT_MSCSTT_MLC16@S,Y$GNB5
     1618  1601  B5F 5029         LD        KW#TRNCHNCTR
     1619  1602  B61 93C0         AND      =KW#TRNCHNCTR_DFRINTCNT@S
     1620  1603  B63 92C0         C        =KW#TRNCHNCTR_DFRINTCNT@S
     1621  1604  B65 F102         BNE       Y$GNB5
     1622  1605  B67 08           INTR
     1623  1606  B68 02       Y$GNB5        ;
     1624                         GNCCB
     1625  1607  B69 E707         BVB       Y$OTPCTRSTR170
     1626  1608  B6B 90EF533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_VLDCCB@S
                     513D
     1627  1609  B71 9004543D Y$OTPCTRSTR170 ;
                     513D
     1628                         SET       KA_LCT_OTPSTT,;       INDICATE IN REPEAT-CHARACTER MODE
     1629                                   =KA_LCT_OTPSTT_RPTCHR@S
     1630  1610  B77 E6FD29       JUMP      Y$OTPLOP20            GO SEE WHAT TO DO NEXT
     1631                     *
     1632  1611  B7A E6FF55   Y$OTPINHPRGLD_CCB_JMP1 ;
     1633                         JUMP      Y$OTPINHPRGLD_CCB
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - OUTPUT CONTROL STRING                   TUE JUL 29 '97 23:55 Page:62
     1634                     *
     1635  1612  B7D 5019     Y$OTPCTRSTR600 ;
     1636                         LD        KA_LCT_OTPCHR         L/2ND CHR OF CTRSTR
     1637  1613  B7F 9201         C        =KA#OTPCTRSTRCHR_CRTCNF
     1638  1614  B81 F166         BNE       Y$OTPCTRSTR690        B/NOT CURRENT CONFIGURATION CTR STR
     1639  1615  B83 503C     Y$OTPCTRSTR610 ;
     1640                         LD        KA_LCT_OTPINHPRGCHRCNT  B/NOT INHIBITING PURGES
     1641  1616  B85 E203         BZ        Y$OTPCTRSTR615
     1642  1617  B87 F0F2         BAL       Y$OTPINHPRGLD_CCB_JMP1 LDCCB WHILE PURGE INHIBITED
     1643  1618  B89 10       Y$OTPCTRSTR615 ;
     1644                         LD
     1645  1619  B8A 513B         ST        KA_LCT_CRTCNF
     1646  1620  B8C F319         BNLC      Y$OTPCTRSTR620        B/NOT LAST CHR IN CCB
     1647  1621  B8E 503E9304     BSET      KA_LCT_MSCSTT,;       B/MLC-16 (NMLC)
                     F20A
     1648                                   =KA_LCT_MSCSTT_MLC16@S,Y$GNB6
     1649  1622  B94 5029         LD        KW#TRNCHNCTR
     1650  1623  B96 93C0         AND      =KW#TRNCHNCTR_DFRINTCNT@S
     1651  1624  B98 92C0         C        =KW#TRNCHNCTR_DFRINTCNT@S
     1652  1625  B9A F102         BNE       Y$GNB6
     1653  1626  B9C 08           INTR
     1654  1627  B9D 02       Y$GNB6        ;
     1655                         GNCCB
     1656  1628  B9E E707         BVB       Y$OTPCTRSTR620
     1657  1629  BA0 90EF533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_VLDCCB@S
                     513D
     1658  1630  BA6 9000     Y$OTPCTRSTR620 ;
     1659                         LD       =0
     1660  1631  BA8 510E         ST        KW#RCVSTT             FORCE RECEIVE INTERRUPT
     1661  1632  BAA 511F         ST        KA_LCT_SVDRCVSTT      TO SET LR#LINSPD
     1662  1633  BAC 503B9380     BSET      KA_LCT_CRTCNF,;       B/UNKNOWN/NONE PARITY
                     F223
     1663                                   =KA_LCT_CRTCNF_PRT_NON@S,Y$OTPCTRSTR640
     1664  1634  BB2 503B9340     BRESET    KA_LCT_CRTCNF,;        B/NOT EVEN OR ODD PARITY
                     E221
     1665                                   =KA_LCT_CRTCNF_PRT_EVNODD@S,Y$OTPCTRSTR650
Elsie.D00  KAC$CLC - ASYNC OUTPUT CCP - OUTPUT CONTROL STRING                   TUE JUL 29 '97 23:55 Page:63
     1666  1635  BB8 9001543D     SET       KA_LCT_OTPSTT,=KA_LCT_OTPSTT_PRTENB@S  EVEN/ODD PARITY
                     513D
     1667  1636  BBE 503B9320     BSET      KA_LCT_CRTCNF,;       B/ODD PARITY
                     F209
     1668                                   =KA_LCT_CRTCNF_PRT_SET@S,Y$OTPCTRSTR630
     1669  1637  BC4 90105422     SET       KW#TRNCHRPRT,=KW#TRNCHRPRT@S        EVEN PARITY
                     5122
     1670  1638  BCA E01D         B         Y$OTPCTRSTR690        B
     1671  1639  BCC 90EF5322 Y$OTPCTRSTR630 ;
                     5122
     1672                         RESET     KW#TRNCHRPRT,=KW#TRNCHRPRT@S        ODD PARITY
     1673  1640  BD2 E015         B         Y$OTPCTRSTR690        B
     1674  1641  BD4 9000     Y$OTPCTRSTR640 ;
     1675                         LD       =0                     NO PARITY BIT
     1676  1642  BD6 E009         B         Y$OTPCTRSTR660        B
     1677  1643  BD8 503B9320 Y$OTPCTRSTR650 ;
                     E203
     1678                         BRESET    KA_LCT_CRTCNF,;       B/NOT 'SET' PARITY
     1679                                   =KA_LCT_CRTCNF_PRT_SET@S,Y$OTPCTRSTR660
     1680  1644  BDE 9080         LD       ='80'X                 'SET' (ALWAYS 1) PARITY
     1681  1645  BE0 5134     Y$OTPCTRSTR660 ;
     1682                         ST        KA_LCT_OTPPRTBIT
     1683  1646  BE2 90FE533D     RESET     KA_LCT_OTPSTT,=KA_LCT_OTPSTT_PRTENB@S  DISABLE PARITY GENERATION
                     513D
     1684  1647  BE8 E6FCB8   Y$OTPCTRSTR690 ;
     1685                         JUMP      Y$OTPLOP20            GO SEE WHAT TO DO NEXT


Elsie.D00  KAC$CLC - ASYNC CCP'S - END OF ASSEMBLY                              TUE JUL 29 '97 23:55 Page:64
     1687  1649                TITLE 'KAC$CLC - ASYNC CCP''S - END OF ASSEMBLY'
     1688  1650                   END
 LC0-00001-0              No Errors in this assembly.
