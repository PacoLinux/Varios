VERSION E05

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:1    
        1        1        /*M* NMK$KOMPARE - Perform MIRROR KOMPARE operation                */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DFC=YES, DMC=YES, EDMC=YES                                    */
        8        8        /*F*
        9        9        NAME:           NMK$KOMPARE
       10       10
       11       11        PURSPOSE:       To MIRROR KOMPARE operation.
       12       12        */
       13       13        /*D*
       14       14        NAME:           NMK$KOMPARE
       15       15
       16       16        CALL:           CALL NMK$KOMPARE ALTRET ( error ) ;
       17       17
       18       18        PARAMETERS:     None.
       19       19
       20       20        DESCRIPTION:
       21       21
       22       22        The NMK$KOMPARE procedure is used to do a comparison
       23       23        between two Mirrored Disk devices.
       24       24
       25       25        DPxx and DPyy must be Mirrored Disk devices in the
       26       26        same state.
       27       27
       28       28        The KOMPARE will be done GRANS granules at a time.  There
       29       29        will be a delay of PAUSE seconds within the comparison loop.
       30       30
       31       31        The state of none of the devices are changed during or after
       32       32        the KOMPARE operation.
       33       33        */
       34       34        %EJECT ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:2    
       35       35        NMK$KOMPARE:    PROC            ALTRET ;
       36       36        /*
       37       37                        Includes
       38       38        */
       39       39        %INCLUDE                CP_6 ;
       40     5598        %INCLUDE                FM$GRAN ;
       41     5667        %INCLUDE                NI$TABLES ;
       42     5883        %INCLUDE                NI_DATA_C ;
       43     5996        %INCLUDE                NM_MACRO_M ;
       44     7401        %INCLUDE                NM_PERR_C ;
       45     7478        %INCLUDE                XUF_ENTRY ;
       46     7486        %INCLUDE                XU_FORMAT_C ;
       47     7648        %INCLUDE                XU_MACRO_C ;
       48    10754        /*
       49    10755                        Entries
       50    10756        */
       51    10757    1   DCL 1 NME$ERRMSG        ENTRY(6) ;
       52    10758    1   DCL 1 NMO$DEV           ENTRY(2) ALTRET ;
       53    10759    1   DCL 1 NMO$OPTIONS       ENTRY(2) ALTRET ;
       54    10760    1   DCL 1 NMO$REPORT        ENTRY(1) ALTRET ;
       55    10761    1   DCL 1 NMU$ABORT         ENTRY(2) ALTRET ;
       56    10762    1   DCL 1 NMU$CCCCHHSS      ENTRY(4) ;
       57    10763    1   DCL 1 NMU$FDS           ENTRY    ALTRET ;
       58    10764    1   DCL 1 NMU$FGRAN         ENTRY(2) ;
       59    10765    1   DCL 1 NMU$GDS           ENTRY    ALTRET ;
       60    10766    1   DCL 1 NMU$LGRAN         ENTRY(2) ;
       61    10767    1   DCL 1 NMU$LOCK          ENTRY(1) ALTRET ;
       62    10768    1   DCL 1 NMU$READ          ENTRY(3) ALTRET ;
       63    10769    1   DCL 1 NMU$UNLOCK        ENTRY(1) ALTRET ;
       64    10770    1   DCL 1 NMU$WAIT          ENTRY    ALTRET ;
       65    10771    1   DCL 1 NMV$DGT           ENTRY    ALTRET ;
       66    10772    1   DCL 1 NMV$MIRRORED      ENTRY(1) ALTRET ;
       67    10773    1   DCL 1 NMV$PACKSIZE      ENTRY    ALTRET ;
       68    10774    1   DCL 1 NMV$PAIR          ENTRY    ALTRET ;
       69    10775    1   DCL 1 NMV$PRIMARY       ENTRY(1) ALTRET ;
       70    10776    1   DCL 1 NMV$SAME_STATE    ENTRY    ALTRET ;
       71    10777    1   DCL 1 NMV$CHGSTATE      ENTRY(1) ALTRET ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:3    
       72    10778    1   DCL 1 NMV$VSN           ENTRY    ALTRET ;
       73    10779        /*
       74    10780                        Variables
       75    10781        */
       76    10782                                %B$ALT ( NAME =
       77    10783              B$ALT             ,     STCLASS=BASED
       78    10784                                                                        ) ;
       79    10792                                %B$TCB  ( NAME =
       80    10793              B$TCB             , STCLASS = "BASED(B$TCB$)"
       81    10794                                                                        ) ;
       82    10797    1   DCL 1 B$TCB$            PTR SYMREF ;
       83    10798    1   DCL 1 BUF(0:1)          ALIGNED AUTO,
       84    10799    1         2 L               UBIN BYTE CALIGNED,
       85    10800    1         2 C               CHAR(15) CALIGNED ;
       86    10801                                %NI$DCT ( NAME =
       87    10802              DCT               , STCLASS = BASED
       88    10803                                                                        ) ;
       89    10851    1   DCL 1 FGRAN             SBIN WORD ALIGNED AUTO ;
       90    10852                                %FM$GRAN ( FM$GRAN =
       91    10853              FM$GRAN           , BASED = BASED
       92    10854                                                                        ) ;
       93    10858    1   DCL 1 FMT_DEC           CHAR(0) CALIGNED CONSTANT INIT('%D') ;
       94    10859    1   DCL 1 FMT_OCT           CHAR(0) CALIGNED CONSTANT INIT('.%12ZO') ;
       95    10860                                %F_FDS ( NAME =
       96    10861              F_FDS             , STCLASS = STATIC
       97    10862                                , DCB = NIL
       98    10863                                , DVFC = '*'
       99    10864                                                                        ) ;
      100    10977    1   DCL 1 I                 SBIN WORD ALIGNED AUTO ;
      101    10978    1   DCL 1 J                 SBIN WORD ALIGNED AUTO ;
      102    10979    1   DCL 1 LGRAN             SBIN WORD ALIGNED AUTO ;
      103    10980    1   DCL 1 NGRAN             SBIN WORD ALIGNED AUTO ;
      104    10981                                %NMD_PIT ( FPTN =
      105    10982              NMD_PIT           , STCLASS=SYMREF
      106    10983                                                                        ) ;
      107    11436                                %VLP_ERRCODE ( FPTN =
      108    11437              NMK#DIFF          , STCLASS = CONSTANT
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:4    
      109    11438                                , ERR# = %E$NMD#DIFF
      110    11439                                , FCG  = %NMD#FCG
      111    11440                                , MID  = 'K'
      112    11441                                , MON  = %NO#
      113    11442                                , SEV  = 5
      114    11443                                                                        ) ;
      115    11488                                %VLP_ERRCODE ( FPTN =
      116    11489              NMK#NODIFF        , STCLASS = CONSTANT
      117    11490                                , ERR# = %E$NMD#NODIFF
      118    11491                                , FCG  = %NMD#FCG
      119    11492                                , MID  = 'K'
      120    11493                                , MON  = %NO#
      121    11494                                , SEV  = 0
      122    11495                                                                        ) ;
      123    11540                                %PARSE$OUT ( NAME =
      124    11541              OUT               , STCLASS ="BASED(XUG_GETCMD.OUT$)"
      125    11542                                                                        ) ;
      126    11587    1   DCL 1 VSIZE             SBIN WORD ALIGNED AUTO ;
      127    11588                                %VLP_VECTOR ( FPTN =
      128    11589              V_                , STCLASS = BASED
      129    11590                                                                        ) ;
      130    11605                                %XUG_GETCMD ( NAME =
      131    11606              XUG_GETCMD        , STCLASS = SYMREF
      132    11607                                                                        ) ;
      133    11945        %EJECT ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:5    
      134    11946        /*
      135    11947        Process the devices and options specified on the command.
      136    11948        */
      137    11949    1           CALL NMO$DEV ( 0, OUT.SUBLK$(0) )       ALTRET ( ERROR ) ;
      138    11950    1           CALL NMO$DEV ( 1, OUT.SUBLK$(1) )       ALTRET ( ERROR ) ;
      139    11951    1           CALL NMO$OPTIONS ( 2, OUT.NSUBLKS-1 )   ALTRET ( ERROR ) ;
      140    11952        /*
      141    11953        Verify that these devices are a Mirrored Disk device pair, that
      142    11954        the first device specified is the primary device, and that the
      143    11955        devices are in in the same state.  If they are, read the VIDs,
      144    11956        verify the VSNs, and get the packsize and defective granule tables.
      145    11957        */
      146    11958    1           CALL NMV$MIRRORED ( 0 )                 ALTRET ( ERROR ) ;
      147    11959    1           CALL NMV$MIRRORED ( 1 )                 ALTRET ( ERROR ) ;
      148    11960    1           CALL NMV$PRIMARY  ( 0 )                 ALTRET ( ERROR ) ;
      149    11961    1           CALL NMV$PAIR                           ALTRET ( ERROR ) ;
      150    11962    1           CALL NMV$SAME_STATE                     ALTRET ( ERROR ) ;
      151    11963
      152    11964    1           CALL NMU$READ ( 0, 0, NMD_PIT.DEV.VID_(0) )
      153    11965    1                                                   ALTRET ( ERROR ) ;
      154    11966    1           CALL NMU$READ ( 1, 0, NMD_PIT.DEV.VID_(1) )
      155    11967    1                                                   ALTRET ( ERROR ) ;
      156    11968
      157    11969    1           CALL NMV$VSN                            ALTRET ( ERROR ) ;
      158    11970    1           CALL NMV$PACKSIZE                       ALTRET ( ERROR ) ;
      159    11971    1           CALL NMV$DGT                            ALTRET ( ERROR ) ;
      160    11972        /*
      161    11973        Get buffers to do KOMPARE operation.
      162    11974        */
      163    11975    1           CALL NMU$GDS                            ALTRET ( ERROR ) ;
      164    11976        /*
      165    11977        Initialize the percentage completion report for this KOMPARE operation.
      166    11978        */
      167    11979    1           CALL NMO$REPORT ( 0 ) ;
      168    11980        /*
      169    11981        Loop thru all granules on the Mirrored Disk device starting with the
      170    11982        first granule.  (First granule compared is granule DRZERO.)
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:6    
      171    11983        */
      172    11984    1           LGRAN = NMD_PIT.DEV.DRZERO(0) - 1 ;
      173    11985    1           CALL NMU$FGRAN ( FGRAN, LGRAN ) ;
      174    11986    2           DO UNTIL ( FGRAN >= NMD_PIT.PACKSIZE ) ;
      175    11987        /*
      176    11988        Set up device logical address and size for this granule segment.
      177    11989        This segment may be up to GRANS granules in size.  The size will
      178    11990        be smaller if there are defective granule entries within this
      179    11991        segment.  In that case, the segment is shortened to end before
      180    11992        the first bad granule.
      181    11993        */
      182    11994    2               CALL NMU$LGRAN ( FGRAN, LGRAN ) ;
      183    11995    2               NGRAN = LGRAN - FGRAN + 1 ;
      184    11996    2               VSIZE = ( NGRAN * %NMD#WORDS_PER_GRAN
      185    11997    2                               * %NMD#BYTES_PER_WORD ) - 1 ;
      186    11998
      187    11999    2               ADDR(NMD_PIT.DEV.BUF_(0))->V_.W1.VSIZE# = VSIZE ;
      188    12000    2               ADDR(NMD_PIT.DEV.BUF_(1))->V_.W1.VSIZE# = VSIZE ;
      189    12001
      190    12002        /*
      191    12003        Compare this granule segment between DEV(0) and DEV(1).
      192    12004        */
      193    12005    2               CALL NMU$LOCK    ( 0 )              ALTRET ( ERROR ) ;
      194    12006    2               IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.STATE ~=
      195    12007    2                   NMD_PIT.DEV.STATE(0)
      196    12008    3               THEN DO ;
      197    12009    3                   CALL NMV$CHGSTATE ( 0 )         ALTRET ( ERROR ) ;
      198    12010    3                   GOTO ERROR ;
      199    12011    3                   END ;
      200    12012    2               CALL NMU$READ    ( 0, FGRAN, NMD_PIT.DEV.BUF_(0) )
      201    12013    2                                                   ALTRET ( ERROR ) ;
      202    12014    2               CALL NMU$LOCK    ( 1 )              ALTRET ( ERROR ) ;
      203    12015    2               IF  NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.STATE ~=
      204    12016    2                   NMD_PIT.DEV.STATE(1)
      205    12017    3               THEN DO ;
      206    12018    3                   CALL NMV$CHGSTATE ( 1 )         ALTRET ( ERROR ) ;
      207    12019    3                   GOTO ERROR ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:7    
      208    12020    3                   END ;
      209    12021    2               CALL NMU$UNLOCK  ( 0 )              ALTRET ( ERROR ) ;
      210    12022    2               CALL NMU$READ    ( 1, FGRAN, NMD_PIT.DEV.BUF_(1) )
      211    12023    2                                                   ALTRET ( ERROR ) ;
      212    12024    2               CALL NMU$UNLOCK  ( 1 )              ALTRET ( ERROR ) ;
      213    12025    2               CALL KOMPARE                        ALTRET ( FINIS ) ;
      214    12026        /*
      215    12027        Advance to next granule segment, report completion percentage, and
      216    12028        wait if specified.
      217    12029        */
      218    12030    2               CALL NMU$FGRAN ( FGRAN, LGRAN ) ;
      219    12031    2               IF  NMD_PIT.FLAGS.REPORT#
      220    12032    2               THEN
      221    12033    2                   CALL NMO$REPORT ( FGRAN ) ;
      222    12034    2               IF  NMD_PIT.PAUSE# > 0
      223    12035    2               THEN
      224    12036    2                   CALL NMU$WAIT ;
      225    12037
      226    12038    2               END ; /* of KOMPARE loop. */
      227    12039        /*
      228    12040        Output appropriate differences message and set STEPCC accordingly.
      229    12041        */
      230    12042    1           IF  NMD_PIT.NDIFF# = 0
      231    12043    1           THEN
      232    12044        /*E*
      233    12045        ERROR:  NMK-E$NMD#NODIFF-0
      234    12046        MESSAGE:  No differences found.
      235    12047        DESCRIPTION:  The comparison operation found no differences
      236    12048                      between the contents of the two specified devices.
      237    12049        */
      238    12050    1               CALL NME$ERRMSG ( NMK#NODIFF ) ;
      239    12051    2           ELSE DO ;
      240    12052    2               F_FDS.BUF_ = VECTOR(BUF(0)) ;
      241    12053    2               CALL X$WRITE ( F_FDS, VECTOR(FMT_DEC), VECTOR(NMD_PIT.NDIFF#) ) ;
      242    12054    2               BUF.L(0) = F_FDS.BUFX - 1 ;
      243    12055        /*E*
      244    12056        ERROR:  NMK-E$NMD#DIFF-5
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:8    
      245    12057        MESSAGE:  %U1 differences found.
      246    12058        DESCRIPTION:  The comparison operation found differences between
      247    12059                      the contents of the two specified devices.
      248    12060        */
      249    12061    2               CALL NME$ERRMSG ( NMK#DIFF, , VECTOR(BUF(0)) ) ;
      250    12062    2               END ;
      251    12063        /*
      252    12064        Release buffers used in KOMPARE operation.
      253    12065        */
      254    12066    1   FINIS:  CALL NMU$FDS                            ALTRET ( ERROR ) ;
      255    12067        /*
      256    12068        Return to the calling procedure.
      257    12069        */
      258    12070    1           RETURN ;
      259    12071
      260    12072    1   ERROR:  CALL NMU$ABORT ( /* NULL */, /* NULL */ ) ;
      261    12073    1           ALTRETURN ;
      262    12074
      263    12075        %EJECT ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:9    
      264    12076    1   KOMPARE:        PROC            ALTRET ;
      265    12077        /*
      266    12078                        Variables
      267    12079        */
      268    12080    2   DCL 1 AWORD             SBIN WORD BASED ;
      269    12081    2   DCL 1 CCCC              SBIN WORD ALIGNED AUTO ;
      270    12082    2   DCL 1 FMT_CCCCHHSS      CHAR(0) CALIGNED CONSTANT INIT('%4ZD-%2ZD-%2ZD') ;
      271    12083    2   DCL 1 HH                SBIN WORD ALIGNED AUTO ;
      272    12084    2   DCL 1 I                 SBIN WORD ALIGNED AUTO ;
      273    12085                                %VLP_ERRCODE ( FPTN =
      274    12086              NMK#GRAN_DIFF     , STCLASS = CONSTANT
      275    12087                                , ERR# = %E$NMD#GRAN_DIFF
      276    12088                                , FCG  = %NMD#FCG
      277    12089                                , MID  = 'K'
      278    12090                                , MON  = %NO#
      279    12091                                , SEV  = 2
      280    12092                                                                        ) ;
      281    12137                                %VLP_ERRCODE ( FPTN =
      282    12138              NMK#GRAN_STAMP    , STCLASS = CONSTANT
      283    12139                                , ERR# = %E$NMD#GRAN_STAMP
      284    12140                                , FCG  = %NMD#FCG
      285    12141                                , MID  = 'K'
      286    12142                                , MON  = %NO#
      287    12143                                , SEV  = 2
      288    12144                                                                        ) ;
      289    12189                                %VLP_ERRCODE ( FPTN =
      290    12190              NMK#MXDIFF        , STCLASS = CONSTANT
      291    12191                                , ERR# = %E$NMD#MXDIFF
      292    12192                                , FCG  = %NMD#FCG
      293    12193                                , MID  = 'K'
      294    12194                                , MON  = %NO#
      295    12195                                , SEV  = 3
      296    12196                                                                        ) ;
      297    12241    2   DCL 1 SS                SBIN WORD ALIGNED AUTO ;
      298    12242        %EJECT ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:10   
      299    12243    2           NMD_PIT.DEV.BUF$(0) = ADDR(NMD_PIT.DEV.BUF_(0))->V_.PTR$ ;
      300    12244    2           NMD_PIT.DEV.BUF$(1) = ADDR(NMD_PIT.DEV.BUF_(1))->V_.PTR$ ;
      301    12245
      302    12246    3           DO  I = FGRAN TO LGRAN ;
      303    12247    3               IF  NMD_PIT.DEV.BUF$(0)->FM$GRAN ~=
      304    12248    3                   NMD_PIT.DEV.BUF$(1)->FM$GRAN
      305    12249    4               THEN DO ;
      306    12250    4                   F_FDS.BUF_ = VECTOR(BUF(0)) ;
      307    12251    4                   CALL X$WRITE ( F_FDS, VECTOR(FMT_DEC), VECTOR(I) ) ;
      308    12252    4                   BUF.L(0) = F_FDS.BUFX - 1 ;
      309    12253    4                   CALL NMU$CCCCHHSS ( CCCC, HH, SS, I ) ;
      310    12254    4                   F_FDS.BUF_ = VECTOR(BUF(1)) ;
      311    12255    4                   CALL X$WRITE ( F_FDS,
      312    12256    4                                  VECTOR(FMT_CCCCHHSS),
      313    12257    4                                  VECTOR(CCCC),
      314    12258    4                                  VECTOR(HH),
      315    12259    4                                  VECTOR(SS) ) ;
      316    12260    4                   BUF.L(1) = F_FDS.BUFX - 1 ;
      317    12261        /*E*
      318    12262        ERROR:  NMK-E$NMD#GRAN_DIFF-2
      319    12263        MESSAGE:  Device logical address %U1 (%U2) is different.
      320    12264        DESCRIPTION:  The specified device logical address contains different
      321    12265                      data on the two Mirrored Disk devices.  The device logical
      322    12266                      address is also displayed in CCCC-HH-SS (cylinder-head-sector)
      323    12267                      format.
      324    12268        */
      325    12269    4                   CALL NME$ERRMSG ( NMK#GRAN_DIFF, ,
      326    12270    4                                     VECTOR(BUF(0)),
      327    12271    4                                     VECTOR(BUF(1)) ) ;
      328    12272    4                   F_FDS.BUF_ = VECTOR(BUF(0)) ;
      329    12273    5                   DO  J = 0 TO 1 ;
      330    12274    5                       CALL X$WRITE ( F_FDS,
      331    12275    5                                      VECTOR(FMT_OCT),
      332    12276    5                                      VECTOR(NMD_PIT.DEV.BUF$(J)->AWORD) ) ;
      333    12277    5                       BUF.L(0) = F_FDS.BUFX - 1 ;
      334    12278        /*E*
      335    12279        ERROR:  NMK-E$NMD#GRAN_STAMP-0
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:11   
      336    12280        MESSAGE:  %U1 granule stamp = %U2
      337    12281        DESCRIPTION:  The value displayed is the granule stamp (i.e., word 0)
      338    12282                      for the granule that is different on the specified drive.
      339    12283                      This value may or may not be different from the other
      340    12284                      granule stamp displayed.  This value is displayed in an
      341    12285                      attempt to provide a user with a way to determine which
      342    12286                      Mirrored Disk device contains the "correct" data.
      343    12287        */
      344    12288    5                       CALL NME$ERRMSG ( NMK#GRAN_STAMP, ,
      345    12289    5                                         VECTOR(NMD_PIT.DEV.NAME(J)),
      346    12290    5                                         VECTOR(BUF(0)) ) ;
      347    12291    5                       END ;
      348    12292    4                   NMD_PIT.NDIFF# = NMD_PIT.NDIFF# + 1 ;
      349    12293    4                   IF  NMD_PIT.NDIFF# > NMD_PIT.MXDIFF#
      350    12294    5                   THEN DO ;
      351    12295        /*E*
      352    12296        ERROR:  NMK-E$NMD#MXDIFF-3
      353    12297        MESSAGE:  Maximum differences encountered.
      354    12298        DESCRIPTION:  The number of differences exceed the maximum differences
      355    12299                      limit set by the MXDIFF option.
      356    12300        */
      357    12301    5                       CALL NME$ERRMSG ( NMK#MXDIFF ) ;
      358    12302    5                       ALTRETURN ;
      359    12303    5                       END ;
      360    12304    4                   END ;
      361    12305
      362    12306    3               NMD_PIT.DEV.BUF$(0) = PINCRW ( NMD_PIT.DEV.BUF$(0),
      363    12307    3                                              %NMD#WORDS_PER_GRAN ) ;
      364    12308    3               NMD_PIT.DEV.BUF$(1) = PINCRW ( NMD_PIT.DEV.BUF$(1),
      365    12309    3                                              %NMD#WORDS_PER_GRAN ) ;
      366    12310
      367    12311    3               END ;
      368    12312
      369    12313    2           RETURN ;
      370    12314
      371    12315    2           END KOMPARE ;
      372    12316
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:12   
      373    12317    1           END NMK$KOMPARE ;

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:13   
--  Include file information  --

   XU_MACRO_C.:E05TOU  is referenced.
   XU_FORMAT_C.:E05TOU  is referenced.
   XUF_ENTRY.:E05TOU  cannot be made into a system file and is referenced.
   NM_PERR_C.:E05TOU  is referenced.
   NM_SUBS_C.:E05TOU  is referenced.
   NM_EQU_E.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NM_MACRO_M.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NMK$KOMPARE.

   Procedure NMK$KOMPARE requires 437 words for executable code.
   Procedure NMK$KOMPARE requires 48 words of local(AUTO) storage.

    No errors detected in file NMK$KOMPARE.:E05TSI    .

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:14   

 Object Unit name= NMK$KOMPARE                                File name= NMK$KOMPARE.:E05TOU
 UTS= JUL 30 '97 03:48:54.64 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     12     14  NMK$KOMPARE
    2   Data  even  none    30     36  NMK$KOMPARE
    3   Proc  even  none   437    665  NMK$KOMPARE
    4  RoData even  none    36     44  NMK$KOMPARE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        0  NMK$KOMPARE
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:15   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 NMO$DEV
 yes     yes           Std       1 NMV$MIRRORED
 yes     yes           Std       1 NMV$PRIMARY
         yes           Std       2 NMU$FGRAN
 yes     yes           Std       0 NMV$VSN
 yes     yes           Std       0 NMU$GDS
 yes     yes           Std       1 NMU$UNLOCK
 yes     yes           Std       0 NMU$FDS
 yes     yes           Std       0 NMV$SAME_STATE
 yes     yes           Std       3 NMU$READ
 yes     yes           Std       0 NMV$PACKSIZE
         yes           Std       2 NMU$LGRAN
 yes     yes           Std       2 NMO$OPTIONS
 yes     yes           Std       0 NMV$DGT
 yes     yes           Std       1 NMU$LOCK
 yes     yes           Std       1 NMV$CHGSTATE
 yes     yes           Std       0 NMU$WAIT
         yes           Std      22 X$WRITE
 yes     yes           Std       0 NMV$PAIR
 yes     yes           Std       1 NMO$REPORT
 yes     yes           Std       2 NMU$ABORT
         yes           Std       6 NME$ERRMSG
         yes           Std       4 NMU$CCCCHHSS
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:16   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$TCB$                                NMD_PIT
     XUG_GETCMD                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:17   


        1        1        /*M* NMK$KOMPARE - Perform MIRROR KOMPARE operation                */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DFC=YES, DMC=YES, EDMC=YES                                    */
        8        8        /*F*
        9        9        NAME:           NMK$KOMPARE
       10       10
       11       11        PURSPOSE:       To MIRROR KOMPARE operation.
       12       12        */
       13       13        /*D*
       14       14        NAME:           NMK$KOMPARE
       15       15
       16       16        CALL:           CALL NMK$KOMPARE ALTRET ( error ) ;
       17       17
       18       18        PARAMETERS:     None.
       19       19
       20       20        DESCRIPTION:
       21       21
       22       22        The NMK$KOMPARE procedure is used to do a comparison
       23       23        between two Mirrored Disk devices.
       24       24
       25       25        DPxx and DPyy must be Mirrored Disk devices in the
       26       26        same state.
       27       27
       28       28        The KOMPARE will be done GRANS granules at a time.  There
       29       29        will be a delay of PAUSE seconds within the comparison loop.
       30       30
       31       31        The state of none of the devices are changed during or after
       32       32        the KOMPARE operation.
       33       33        */
       34       34        %EJECT ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:18   
       35       35        NMK$KOMPARE:    PROC            ALTRET ;

     35  3 000000   000000 700200 xent  NMK$KOMPARE  TSX0  ! X66_AUTO_0
         3 000001   000060 000000                    ZERO    48,0

       36       36        /*
       37       37                        Includes
       38       38        */
       39       39        %INCLUDE                CP_6 ;
       40     5598        %INCLUDE                FM$GRAN ;
       41     5667        %INCLUDE                NI$TABLES ;
       42     5883        %INCLUDE                NI_DATA_C ;
       43     5996        %INCLUDE                NM_MACRO_M ;
       44     7401        %INCLUDE                NM_PERR_C ;
       45     7478        %INCLUDE                XUF_ENTRY ;
       46     7486        %INCLUDE                XU_FORMAT_C ;
       47     7648        %INCLUDE                XU_MACRO_C ;
       48    10754        /*
       49    10755                        Entries
       50    10756        */
       51    10757    1   DCL 1 NME$ERRMSG        ENTRY(6) ;
       52    10758    1   DCL 1 NMO$DEV           ENTRY(2) ALTRET ;
       53    10759    1   DCL 1 NMO$OPTIONS       ENTRY(2) ALTRET ;
       54    10760    1   DCL 1 NMO$REPORT        ENTRY(1) ALTRET ;
       55    10761    1   DCL 1 NMU$ABORT         ENTRY(2) ALTRET ;
       56    10762    1   DCL 1 NMU$CCCCHHSS      ENTRY(4) ;
       57    10763    1   DCL 1 NMU$FDS           ENTRY    ALTRET ;
       58    10764    1   DCL 1 NMU$FGRAN         ENTRY(2) ;
       59    10765    1   DCL 1 NMU$GDS           ENTRY    ALTRET ;
       60    10766    1   DCL 1 NMU$LGRAN         ENTRY(2) ;
       61    10767    1   DCL 1 NMU$LOCK          ENTRY(1) ALTRET ;
       62    10768    1   DCL 1 NMU$READ          ENTRY(3) ALTRET ;
       63    10769    1   DCL 1 NMU$UNLOCK        ENTRY(1) ALTRET ;
       64    10770    1   DCL 1 NMU$WAIT          ENTRY    ALTRET ;
       65    10771    1   DCL 1 NMV$DGT           ENTRY    ALTRET ;
       66    10772    1   DCL 1 NMV$MIRRORED      ENTRY(1) ALTRET ;
       67    10773    1   DCL 1 NMV$PACKSIZE      ENTRY    ALTRET ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:19   
       68    10774    1   DCL 1 NMV$PAIR          ENTRY    ALTRET ;
       69    10775    1   DCL 1 NMV$PRIMARY       ENTRY(1) ALTRET ;
       70    10776    1   DCL 1 NMV$SAME_STATE    ENTRY    ALTRET ;
       71    10777    1   DCL 1 NMV$CHGSTATE      ENTRY(1) ALTRET ;
       72    10778    1   DCL 1 NMV$VSN           ENTRY    ALTRET ;
       73    10779        /*
       74    10780                        Variables
       75    10781        */
       76    10782                                %B$ALT ( NAME =
       77    10783              B$ALT             ,     STCLASS=BASED
       78    10784                                                                        ) ;
       79    10792                                %B$TCB  ( NAME =
       80    10793              B$TCB             , STCLASS = "BASED(B$TCB$)"
       81    10794                                                                        ) ;
       82    10797    1   DCL 1 B$TCB$            PTR SYMREF ;
       83    10798    1   DCL 1 BUF(0:1)          ALIGNED AUTO,
       84    10799    1         2 L               UBIN BYTE CALIGNED,
       85    10800    1         2 C               CHAR(15) CALIGNED ;
       86    10801                                %NI$DCT ( NAME =
       87    10802              DCT               , STCLASS = BASED
       88    10803                                                                        ) ;
       89    10851    1   DCL 1 FGRAN             SBIN WORD ALIGNED AUTO ;
       90    10852                                %FM$GRAN ( FM$GRAN =
       91    10853              FM$GRAN           , BASED = BASED
       92    10854                                                                        ) ;
       93    10858    1   DCL 1 FMT_DEC           CHAR(0) CALIGNED CONSTANT INIT('%D') ;
       94    10859    1   DCL 1 FMT_OCT           CHAR(0) CALIGNED CONSTANT INIT('.%12ZO') ;
       95    10860                                %F_FDS ( NAME =
       96    10861              F_FDS             , STCLASS = STATIC
       97    10862                                , DCB = NIL
       98    10863                                , DVFC = '*'
       99    10864                                                                        ) ;
      100    10977    1   DCL 1 I                 SBIN WORD ALIGNED AUTO ;
      101    10978    1   DCL 1 J                 SBIN WORD ALIGNED AUTO ;
      102    10979    1   DCL 1 LGRAN             SBIN WORD ALIGNED AUTO ;
      103    10980    1   DCL 1 NGRAN             SBIN WORD ALIGNED AUTO ;
      104    10981                                %NMD_PIT ( FPTN =
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:20   
      105    10982              NMD_PIT           , STCLASS=SYMREF
      106    10983                                                                        ) ;
      107    11436                                %VLP_ERRCODE ( FPTN =
      108    11437              NMK#DIFF          , STCLASS = CONSTANT
      109    11438                                , ERR# = %E$NMD#DIFF
      110    11439                                , FCG  = %NMD#FCG
      111    11440                                , MID  = 'K'
      112    11441                                , MON  = %NO#
      113    11442                                , SEV  = 5
      114    11443                                                                        ) ;
      115    11488                                %VLP_ERRCODE ( FPTN =
      116    11489              NMK#NODIFF        , STCLASS = CONSTANT
      117    11490                                , ERR# = %E$NMD#NODIFF
      118    11491                                , FCG  = %NMD#FCG
      119    11492                                , MID  = 'K'
      120    11493                                , MON  = %NO#
      121    11494                                , SEV  = 0
      122    11495                                                                        ) ;
      123    11540                                %PARSE$OUT ( NAME =
      124    11541              OUT               , STCLASS ="BASED(XUG_GETCMD.OUT$)"
      125    11542                                                                        ) ;
      126    11587    1   DCL 1 VSIZE             SBIN WORD ALIGNED AUTO ;
      127    11588                                %VLP_VECTOR ( FPTN =
      128    11589              V_                , STCLASS = BASED
      129    11590                                                                        ) ;
      130    11605                                %XUG_GETCMD ( NAME =
      131    11606              XUG_GETCMD        , STCLASS = SYMREF
      132    11607                                                                        ) ;
      133    11945        %EJECT ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:21   
      134    11946        /*
      135    11947        Process the devices and options specified on the command.
      136    11948        */
      137    11949    1           CALL NMO$DEV ( 0, OUT.SUBLK$(0) )       ALTRET ( ERROR ) ;

  11949  3 000002   000001 236000 xsym               LDQ     XUG_GETCMD+1
         3 000003   000003 036003                    ADLQ    3,DU
         3 000004   000000 235000 4                  LDA     0
         3 000005   200030 757100                    STAQ    SS+2,,AUTO
         3 000006   200030 630500                    EPPR0   SS+2,,AUTO
         3 000007   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000010   000000 701000 xent               TSX1    NMO$DEV
         3 000011   000353 702000 3                  TSX2    ERROR

      138    11950    1           CALL NMO$DEV ( 1, OUT.SUBLK$(1) )       ALTRET ( ERROR ) ;

  11950  3 000012   000001 236000 xsym               LDQ     XUG_GETCMD+1
         3 000013   000004 036003                    ADLQ    4,DU
         3 000014   000001 235000 4                  LDA     1
         3 000015   200030 757100                    STAQ    SS+2,,AUTO
         3 000016   200030 630500                    EPPR0   SS+2,,AUTO
         3 000017   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000020   000000 701000 xent               TSX1    NMO$DEV
         3 000021   000353 702000 3                  TSX2    ERROR

      139    11951    1           CALL NMO$OPTIONS ( 2, OUT.NSUBLKS-1 )   ALTRET ( ERROR ) ;

  11951  3 000022   000001 470400 xsym               LDP0    XUG_GETCMD+1
         3 000023   000001 236100                    LDQ     1,,PR0
         3 000024   000022 772000                    QRL     18
         3 000025   000001 136007                    SBLQ    1,DL
         3 000026   200030 756100                    STQ     SS+2,,AUTO
         3 000027   200030 631500                    EPPR1   SS+2,,AUTO
         3 000030   200033 451500                    STP1    SS+5,,AUTO
         3 000031   000002 236000 4                  LDQ     2
         3 000032   200032 756100                    STQ     SS+4,,AUTO
         3 000033   200032 630500                    EPPR0   SS+4,,AUTO
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:22   
         3 000034   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000035   000000 701000 xent               TSX1    NMO$OPTIONS
         3 000036   000353 702000 3                  TSX2    ERROR

      140    11952        /*
      141    11953        Verify that these devices are a Mirrored Disk device pair, that
      142    11954        the first device specified is the primary device, and that the
      143    11955        devices are in in the same state.  If they are, read the VIDs,
      144    11956        verify the VSNs, and get the packsize and defective granule tables.
      145    11957        */
      146    11958    1           CALL NMV$MIRRORED ( 0 )                 ALTRET ( ERROR ) ;

  11958  3 000037   000000 630400 4                  EPPR0   0
         3 000040   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000041   000000 701000 xent               TSX1    NMV$MIRRORED
         3 000042   000353 702000 3                  TSX2    ERROR

      147    11959    1           CALL NMV$MIRRORED ( 1 )                 ALTRET ( ERROR ) ;

  11959  3 000043   000001 630400 4                  EPPR0   1
         3 000044   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000045   000000 701000 xent               TSX1    NMV$MIRRORED
         3 000046   000353 702000 3                  TSX2    ERROR

      148    11960    1           CALL NMV$PRIMARY  ( 0 )                 ALTRET ( ERROR ) ;

  11960  3 000047   000000 630400 4                  EPPR0   0
         3 000050   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000051   000000 701000 xent               TSX1    NMV$PRIMARY
         3 000052   000353 702000 3                  TSX2    ERROR

      149    11961    1           CALL NMV$PAIR                           ALTRET ( ERROR ) ;

  11961  3 000053   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000054   000000 701000 xent               TSX1    NMV$PAIR
         3 000055   000353 702000 3                  TSX2    ERROR

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:23   
      150    11962    1           CALL NMV$SAME_STATE                     ALTRET ( ERROR ) ;

  11962  3 000056   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000057   000000 701000 xent               TSX1    NMV$SAME_STATE
         3 000060   000353 702000 3                  TSX2    ERROR

      151    11963
      152    11964    1           CALL NMU$READ ( 0, 0, NMD_PIT.DEV.VID_(0) )

  11964  3 000061   000003 630400 4                  EPPR0   3
         3 000062   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000063   000000 701000 xent               TSX1    NMU$READ
         3 000064   000353 702000 3                  TSX2    ERROR

      153    11965    1                                                   ALTRET ( ERROR ) ;
      154    11966    1           CALL NMU$READ ( 1, 0, NMD_PIT.DEV.VID_(1) )

  11966  3 000065   000006 630400 4                  EPPR0   6
         3 000066   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000067   000000 701000 xent               TSX1    NMU$READ
         3 000070   000353 702000 3                  TSX2    ERROR

      155    11967    1                                                   ALTRET ( ERROR ) ;
      156    11968
      157    11969    1           CALL NMV$VSN                            ALTRET ( ERROR ) ;

  11969  3 000071   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000072   000000 701000 xent               TSX1    NMV$VSN
         3 000073   000353 702000 3                  TSX2    ERROR

      158    11970    1           CALL NMV$PACKSIZE                       ALTRET ( ERROR ) ;

  11970  3 000074   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000075   000000 701000 xent               TSX1    NMV$PACKSIZE
         3 000076   000353 702000 3                  TSX2    ERROR

      159    11971    1           CALL NMV$DGT                            ALTRET ( ERROR ) ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:24   

  11971  3 000077   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000100   000000 701000 xent               TSX1    NMV$DGT
         3 000101   000353 702000 3                  TSX2    ERROR

      160    11972        /*
      161    11973        Get buffers to do KOMPARE operation.
      162    11974        */
      163    11975    1           CALL NMU$GDS                            ALTRET ( ERROR ) ;

  11975  3 000102   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000103   000000 701000 xent               TSX1    NMU$GDS
         3 000104   000353 702000 3                  TSX2    ERROR

      164    11976        /*
      165    11977        Initialize the percentage completion report for this KOMPARE operation.
      166    11978        */
      167    11979    1           CALL NMO$REPORT ( 0 ) ;

  11979  3 000105   000000 630400 4                  EPPR0   0
         3 000106   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000107   000000 701000 xent               TSX1    NMO$REPORT
         3 000110   000000 011000                    NOP     0

      168    11980        /*
      169    11981        Loop thru all granules on the Mirrored Disk device starting with the
      170    11982        first granule.  (First granule compared is granule DRZERO.)
      171    11983        */
      172    11984    1           LGRAN = NMD_PIT.DEV.DRZERO(0) - 1 ;

  11984  3 000111   000012 235000 xsym               LDA     NMD_PIT+10
         3 000112   000001 135007                    SBLA    1,DL
         3 000113   200016 755100                    STA     LGRAN,,AUTO

      173    11985    1           CALL NMU$FGRAN ( FGRAN, LGRAN ) ;

  11985  3 000114   200016 630500                    EPPR0   LGRAN,,AUTO
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:25   
         3 000115   200031 450500                    STP0    SS+3,,AUTO
         3 000116   200013 631500                    EPPR1   FGRAN,,AUTO
         3 000117   200030 451500                    STP1    SS+2,,AUTO
         3 000120   200030 630500                    EPPR0   SS+2,,AUTO
         3 000121   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000122   000000 701000 xent               TSX1    NMU$FGRAN
         3 000123   000000 011000                    NOP     0

      174    11986    2           DO UNTIL ( FGRAN >= NMD_PIT.PACKSIZE ) ;

      175    11987        /*
      176    11988        Set up device logical address and size for this granule segment.
      177    11989        This segment may be up to GRANS granules in size.  The size will
      178    11990        be smaller if there are defective granule entries within this
      179    11991        segment.  In that case, the segment is shortened to end before
      180    11992        the first bad granule.
      181    11993        */
      182    11994    2               CALL NMU$LGRAN ( FGRAN, LGRAN ) ;

  11994  3 000124   200016 630500                    EPPR0   LGRAN,,AUTO
         3 000125   200031 450500                    STP0    SS+3,,AUTO
         3 000126   200013 631500                    EPPR1   FGRAN,,AUTO
         3 000127   200030 451500                    STP1    SS+2,,AUTO
         3 000130   200030 630500                    EPPR0   SS+2,,AUTO
         3 000131   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000132   000000 701000 xent               TSX1    NMU$LGRAN
         3 000133   000000 011000                    NOP     0

      183    11995    2               NGRAN = LGRAN - FGRAN + 1 ;

  11995  3 000134   200016 236100                    LDQ     LGRAN,,AUTO
         3 000135   200013 136100                    SBLQ    FGRAN,,AUTO
         3 000136   000001 036007                    ADLQ    1,DL
         3 000137   200017 756100                    STQ     NGRAN,,AUTO

      184    11996    2               VSIZE = ( NGRAN * %NMD#WORDS_PER_GRAN

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:26   
  11996  3 000140   200017 235100                    LDA     NGRAN,,AUTO
         3 000141   000014 735000                    ALS     12
         3 000142   000001 135007                    SBLA    1,DL
         3 000143   200020 755100                    STA     VSIZE,,AUTO

      185    11997    2                               * %NMD#BYTES_PER_WORD ) - 1 ;
      186    11998
      187    11999    2               ADDR(NMD_PIT.DEV.BUF_(0))->V_.W1.VSIZE# = VSIZE ;

  11999  3 000144   200020 236100                    LDQ     VSIZE,,AUTO
         3 000145   000020 736000                    QLS     16
         3 000146   000002 676000 xsym               ERQ     NMD_PIT+2
         3 000147   000034 376000 xsym               ANQ     B_VECTNIL+28
         3 000150   000002 656000 xsym               ERSQ    NMD_PIT+2

      188    12000    2               ADDR(NMD_PIT.DEV.BUF_(1))->V_.W1.VSIZE# = VSIZE ;

  12000  3 000151   200020 236100                    LDQ     VSIZE,,AUTO
         3 000152   000020 736000                    QLS     16
         3 000153   000034 676000 xsym               ERQ     NMD_PIT+28
         3 000154   000034 376000 xsym               ANQ     B_VECTNIL+28
         3 000155   000034 656000 xsym               ERSQ    NMD_PIT+28

      189    12001
      190    12002        /*
      191    12003        Compare this granule segment between DEV(0) and DEV(1).
      192    12004        */
      193    12005    2               CALL NMU$LOCK    ( 0 )              ALTRET ( ERROR ) ;

  12005  3 000156   000000 630400 4                  EPPR0   0
         3 000157   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000160   000000 701000 xent               TSX1    NMU$LOCK
         3 000161   000353 702000 3                  TSX2    ERROR

      194    12006    2               IF  NMD_PIT.DEV.DCT$(0)->DCT.DP.MIRROR.STATE ~=

  12006  3 000162   000010 470400 xsym               LDP0    NMD_PIT+8
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:27   
         3 000163   000036 236100                    LDQ     30,,PR0
         3 000164   000030 772000                    QRL     24
         3 000165   000077 376007                    ANQ     63,DL
         3 000166   000025 116000 xsym               CMPQ    NMD_PIT+21
         3 000167   000175 600000 3                  TZE     s:12012

      195    12007    2                   NMD_PIT.DEV.STATE(0)
      196    12008    3               THEN DO ;

      197    12009    3                   CALL NMV$CHGSTATE ( 0 )         ALTRET ( ERROR ) ;

  12009  3 000170   000000 630400 4                  EPPR0   0
         3 000171   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000172   000000 701000 xent               TSX1    NMV$CHGSTATE
         3 000173   000353 702000 3                  TSX2    ERROR

      198    12010    3                   GOTO ERROR ;

  12010  3 000174   000353 710000 3                  TRA     ERROR

      199    12011    3                   END ;
      200    12012    2               CALL NMU$READ    ( 0, FGRAN, NMD_PIT.DEV.BUF_(0) )

  12012  3 000175   000011 236000 4                  LDQ     9
         3 000176   200032 756100                    STQ     SS+4,,AUTO
         3 000177   200013 631500                    EPPR1   FGRAN,,AUTO
         3 000200   200031 451500                    STP1    SS+3,,AUTO
         3 000201   000000 236000 4                  LDQ     0
         3 000202   200030 756100                    STQ     SS+2,,AUTO
         3 000203   200030 630500                    EPPR0   SS+2,,AUTO
         3 000204   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000205   000000 701000 xent               TSX1    NMU$READ
         3 000206   000353 702000 3                  TSX2    ERROR

      201    12013    2                                                   ALTRET ( ERROR ) ;
      202    12014    2               CALL NMU$LOCK    ( 1 )              ALTRET ( ERROR ) ;

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:28   
  12014  3 000207   000001 630400 4                  EPPR0   1
         3 000210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000211   000000 701000 xent               TSX1    NMU$LOCK
         3 000212   000353 702000 3                  TSX2    ERROR

      203    12015    2               IF  NMD_PIT.DEV.DCT$(1)->DCT.DP.MIRROR.STATE ~=

  12015  3 000213   000042 470400 xsym               LDP0    NMD_PIT+34
         3 000214   000036 236100                    LDQ     30,,PR0
         3 000215   000030 772000                    QRL     24
         3 000216   000077 376007                    ANQ     63,DL
         3 000217   000057 116000 xsym               CMPQ    NMD_PIT+47
         3 000220   000226 600000 3                  TZE     s:12021

      204    12016    2                   NMD_PIT.DEV.STATE(1)
      205    12017    3               THEN DO ;

      206    12018    3                   CALL NMV$CHGSTATE ( 1 )         ALTRET ( ERROR ) ;

  12018  3 000221   000001 630400 4                  EPPR0   1
         3 000222   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000223   000000 701000 xent               TSX1    NMV$CHGSTATE
         3 000224   000353 702000 3                  TSX2    ERROR

      207    12019    3                   GOTO ERROR ;

  12019  3 000225   000353 710000 3                  TRA     ERROR

      208    12020    3                   END ;
      209    12021    2               CALL NMU$UNLOCK  ( 0 )              ALTRET ( ERROR ) ;

  12021  3 000226   000000 630400 4                  EPPR0   0
         3 000227   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000230   000000 701000 xent               TSX1    NMU$UNLOCK
         3 000231   000353 702000 3                  TSX2    ERROR

      210    12022    2               CALL NMU$READ    ( 1, FGRAN, NMD_PIT.DEV.BUF_(1) )
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:29   

  12022  3 000232   000012 236000 4                  LDQ     10
         3 000233   200032 756100                    STQ     SS+4,,AUTO
         3 000234   200013 630500                    EPPR0   FGRAN,,AUTO
         3 000235   200031 450500                    STP0    SS+3,,AUTO
         3 000236   000001 236000 4                  LDQ     1
         3 000237   200030 756100                    STQ     SS+2,,AUTO
         3 000240   200030 630500                    EPPR0   SS+2,,AUTO
         3 000241   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000242   000000 701000 xent               TSX1    NMU$READ
         3 000243   000353 702000 3                  TSX2    ERROR

      211    12023    2                                                   ALTRET ( ERROR ) ;
      212    12024    2               CALL NMU$UNLOCK  ( 1 )              ALTRET ( ERROR ) ;

  12024  3 000244   000001 630400 4                  EPPR0   1
         3 000245   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000246   000000 701000 xent               TSX1    NMU$UNLOCK
         3 000247   000353 702000 3                  TSX2    ERROR

      213    12025    2               CALL KOMPARE                        ALTRET ( FINIS ) ;

  12025  3 000250   000357 701000 3                  TSX1    KOMPARE
         3 000251   000347 702000 3                  TSX2    FINIS

      214    12026        /*
      215    12027        Advance to next granule segment, report completion percentage, and
      216    12028        wait if specified.
      217    12029        */
      218    12030    2               CALL NMU$FGRAN ( FGRAN, LGRAN ) ;

  12030  3 000252   200016 630500                    EPPR0   LGRAN,,AUTO
         3 000253   200031 450500                    STP0    SS+3,,AUTO
         3 000254   200013 631500                    EPPR1   FGRAN,,AUTO
         3 000255   200030 451500                    STP1    SS+2,,AUTO
         3 000256   200030 630500                    EPPR0   SS+2,,AUTO
         3 000257   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:30   
         3 000260   000000 701000 xent               TSX1    NMU$FGRAN
         3 000261   000000 011000                    NOP     0

      219    12031    2               IF  NMD_PIT.FLAGS.REPORT#

  12031  3 000262   000273 236000 xsym               LDQ     NMD_PIT+187
         3 000263   020000 316003                    CANQ    8192,DU
         3 000264   000273 600000 3                  TZE     s:12034

      220    12032    2               THEN
      221    12033    2                   CALL NMO$REPORT ( FGRAN ) ;

  12033  3 000265   200013 630500                    EPPR0   FGRAN,,AUTO
         3 000266   200030 450500                    STP0    SS+2,,AUTO
         3 000267   200030 630500                    EPPR0   SS+2,,AUTO
         3 000270   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000271   000000 701000 xent               TSX1    NMO$REPORT
         3 000272   000000 011000                    NOP     0

      222    12034    2               IF  NMD_PIT.PAUSE# > 0

  12034  3 000273   000310 235000 xsym               LDA     NMD_PIT+200
         3 000274   000300 600000 3                  TZE     s:12038

      223    12035    2               THEN
      224    12036    2                   CALL NMU$WAIT ;

  12036  3 000275   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000276   000000 701000 xent               TSX1    NMU$WAIT
         3 000277   000000 011000                    NOP     0

      225    12037
      226    12038    2               END ; /* of KOMPARE loop. */

  12038  3 000300   200013 236100                    LDQ     FGRAN,,AUTO
         3 000301   000124 604000 3                  TMI     s:11994
         3 000302   000307 116000 xsym               CMPQ    NMD_PIT+199
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:31   
         3 000303   000124 602000 3                  TNC     s:11994

      227    12039        /*
      228    12040        Output appropriate differences message and set STEPCC accordingly.
      229    12041        */
      230    12042    1           IF  NMD_PIT.NDIFF# = 0

  12042  3 000304   000305 235000 xsym               LDA     NMD_PIT+197
         3 000305   000313 601000 3                  TNZ     s:12052

      231    12043    1           THEN
      232    12044        /*E*
      233    12045        ERROR:  NMK-E$NMD#NODIFF-0
      234    12046        MESSAGE:  No differences found.
      235    12047        DESCRIPTION:  The comparison operation found no differences
      236    12048                      between the contents of the two specified devices.
      237    12049        */
      238    12050    1               CALL NME$ERRMSG ( NMK#NODIFF ) ;

  12050  3 000306   000013 630400 4                  EPPR0   11
         3 000307   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000310   000000 701000 xent               TSX1    NME$ERRMSG
         3 000311   000000 011000                    NOP     0
         3 000312   000347 710000 3                  TRA     FINIS

      239    12051    2           ELSE DO ;

      240    12052    2               F_FDS.BUF_ = VECTOR(BUF(0)) ;

  12052  3 000313   000014 235000 4                  LDA     12
         3 000314   200030 452500                    STP2    SS+2,,AUTO
         3 000315   200030 236100                    LDQ     SS+2,,AUTO
         3 000316   000003 036003                    ADLQ    3,DU
         3 000317   000005 755000 2                  STA     F_FDS+5
         3 000320   000006 756000 2                  STQ     F_FDS+6

      241    12053    2               CALL X$WRITE ( F_FDS, VECTOR(FMT_DEC), VECTOR(NMD_PIT.NDIFF#) ) ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:32   

  12053  3 000321   000022 630400 4                  EPPR0   18
         3 000322   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000323   000000 701000 xent               TSX1    X$WRITE
         3 000324   000000 011000                    NOP     0

      242    12054    2               BUF.L(0) = F_FDS.BUFX - 1 ;

  12054  3 000325   000007 236000 2                  LDQ     F_FDS+7
         3 000326   000001 136007                    SBLQ    1,DL
         3 000327   000033 736000                    QLS     27
         3 000330   200003 552140                    STBQ    BUF,'40'O,AUTO

      243    12055        /*E*
      244    12056        ERROR:  NMK-E$NMD#DIFF-5
      245    12057        MESSAGE:  %U1 differences found.
      246    12058        DESCRIPTION:  The comparison operation found differences between
      247    12059                      the contents of the two specified devices.
      248    12060        */
      249    12061    2               CALL NME$ERRMSG ( NMK#DIFF, , VECTOR(BUF(0)) ) ;

  12061  3 000331   000014 235000 4                  LDA     12
         3 000332   200030 452500                    STP2    SS+2,,AUTO
         3 000333   200030 236100                    LDQ     SS+2,,AUTO
         3 000334   000003 036003                    ADLQ    3,DU
         3 000335   200032 757100                    STAQ    SS+4,,AUTO
         3 000336   200032 630500                    EPPR0   SS+4,,AUTO
         3 000337   200036 450500                    STP0    SS+8,,AUTO
         3 000340   000001 236000 xsym               LDQ     B_VECTNIL+1
         3 000341   000015 235000 4                  LDA     13
         3 000342   200034 757100                    STAQ    SS+6,,AUTO
         3 000343   200034 630500                    EPPR0   SS+6,,AUTO
         3 000344   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000345   000000 701000 xent               TSX1    NME$ERRMSG
         3 000346   000000 011000                    NOP     0

      250    12062    2               END ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:33   

      251    12063        /*
      252    12064        Release buffers used in KOMPARE operation.
      253    12065        */
      254    12066    1   FINIS:  CALL NMU$FDS                            ALTRET ( ERROR ) ;

  12066  3 000347   000002 631400 xsym  FINIS        EPPR1   B_VECTNIL+2
         3 000350   000000 701000 xent               TSX1    NMU$FDS
         3 000351   000353 702000 3                  TSX2    ERROR

      255    12067        /*
      256    12068        Return to the calling procedure.
      257    12069        */
      258    12070    1           RETURN ;

  12070  3 000352   000000 702200 xent               TSX2  ! X66_ARET

      259    12071
      260    12072    1   ERROR:  CALL NMU$ABORT ( /* NULL */, /* NULL */ ) ;

  12072  3 000353   000002 631400 xsym  ERROR        EPPR1   B_VECTNIL+2
         3 000354   000000 701000 xent               TSX1    NMU$ABORT
         3 000355   000000 011000                    NOP     0

      261    12073    1           ALTRETURN ;

  12073  3 000356   000000 702200 xent               TSX2  ! X66_AALT

      262    12074
      263    12075        %EJECT ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:34   
      264    12076    1   KOMPARE:        PROC            ALTRET ;

  12076  3 000357   200022 741300       KOMPARE      STX1  ! VSIZE+2,,AUTO

      265    12077        /*
      266    12078                        Variables
      267    12079        */
      268    12080    2   DCL 1 AWORD             SBIN WORD BASED ;
      269    12081    2   DCL 1 CCCC              SBIN WORD ALIGNED AUTO ;
      270    12082    2   DCL 1 FMT_CCCCHHSS      CHAR(0) CALIGNED CONSTANT INIT('%4ZD-%2ZD-%2ZD') ;
      271    12083    2   DCL 1 HH                SBIN WORD ALIGNED AUTO ;
      272    12084    2   DCL 1 I                 SBIN WORD ALIGNED AUTO ;
      273    12085                                %VLP_ERRCODE ( FPTN =
      274    12086              NMK#GRAN_DIFF     , STCLASS = CONSTANT
      275    12087                                , ERR# = %E$NMD#GRAN_DIFF
      276    12088                                , FCG  = %NMD#FCG
      277    12089                                , MID  = 'K'
      278    12090                                , MON  = %NO#
      279    12091                                , SEV  = 2
      280    12092                                                                        ) ;
      281    12137                                %VLP_ERRCODE ( FPTN =
      282    12138              NMK#GRAN_STAMP    , STCLASS = CONSTANT
      283    12139                                , ERR# = %E$NMD#GRAN_STAMP
      284    12140                                , FCG  = %NMD#FCG
      285    12141                                , MID  = 'K'
      286    12142                                , MON  = %NO#
      287    12143                                , SEV  = 2
      288    12144                                                                        ) ;
      289    12189                                %VLP_ERRCODE ( FPTN =
      290    12190              NMK#MXDIFF        , STCLASS = CONSTANT
      291    12191                                , ERR# = %E$NMD#MXDIFF
      292    12192                                , FCG  = %NMD#FCG
      293    12193                                , MID  = 'K'
      294    12194                                , MON  = %NO#
      295    12195                                , SEV  = 3
      296    12196                                                                        ) ;
      297    12241    2   DCL 1 SS                SBIN WORD ALIGNED AUTO ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:35   
      298    12242        %EJECT ;
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:36   
      299    12243    2           NMD_PIT.DEV.BUF$(0) = ADDR(NMD_PIT.DEV.BUF_(0))->V_.PTR$ ;

  12243  3 000360   000003 236000 xsym               LDQ     NMD_PIT+3
         3 000361   000004 756000 xsym               STQ     NMD_PIT+4

      300    12244    2           NMD_PIT.DEV.BUF$(1) = ADDR(NMD_PIT.DEV.BUF_(1))->V_.PTR$ ;

  12244  3 000362   000035 236000 xsym               LDQ     NMD_PIT+29
         3 000363   000036 756000 xsym               STQ     NMD_PIT+30

      301    12245
      302    12246    3           DO  I = FGRAN TO LGRAN ;

  12246  3 000364   200013 235100                    LDA     FGRAN,,AUTO
         3 000365   200025 755100                    STA     I,,AUTO
         3 000366   000660 710000 3                  TRA     s:12311+1

      303    12247    3               IF  NMD_PIT.DEV.BUF$(0)->FM$GRAN ~=

  12247  3 000367   000004 470400 xsym               LDP0    NMD_PIT+4
         3 000370   000036 471400 xsym               LDP1    NMD_PIT+30
         3 000371   000100 106500                    CMPC    fill='000'O
         3 000372   000000 000024                    ADSC9   0,,PR0                   cn=0,n=20
         3 000373   100000 000024                    ADSC9   0,,PR1                   cn=0,n=20
         3 000374   000651 600000 3                  TZE     s:12306

      304    12248    3                   NMD_PIT.DEV.BUF$(1)->FM$GRAN
      305    12249    4               THEN DO ;

      306    12250    4                   F_FDS.BUF_ = VECTOR(BUF(0)) ;

  12250  3 000375   000014 235000 4                  LDA     12
         3 000376   200030 452500                    STP2    SS+2,,AUTO
         3 000377   200030 236100                    LDQ     SS+2,,AUTO
         3 000400   000003 036003                    ADLQ    3,DU
         3 000401   000005 755000 2                  STA     F_FDS+5
         3 000402   000006 756000 2                  STQ     F_FDS+6
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:37   

      307    12251    4                   CALL X$WRITE ( F_FDS, VECTOR(FMT_DEC), VECTOR(I) ) ;

  12251  3 000403   777640 235007                    LDA     -96,DL
         3 000404   200030 452500                    STP2    SS+2,,AUTO
         3 000405   200030 236100                    LDQ     SS+2,,AUTO
         3 000406   000025 036003                    ADLQ    21,DU
         3 000407   200032 757100                    STAQ    SS+4,,AUTO
         3 000410   200032 633500                    EPPR3   SS+4,,AUTO
         3 000411   200036 453500                    STP3    SS+8,,AUTO
         3 000412   000022 237000 4                  LDAQ    18
         3 000413   200034 757100                    STAQ    SS+6,,AUTO
         3 000414   200034 630500                    EPPR0   SS+6,,AUTO
         3 000415   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000416   000000 701000 xent               TSX1    X$WRITE
         3 000417   000000 011000                    NOP     0

      308    12252    4                   BUF.L(0) = F_FDS.BUFX - 1 ;

  12252  3 000420   000007 236000 2                  LDQ     F_FDS+7
         3 000421   000001 136007                    SBLQ    1,DL
         3 000422   000033 736000                    QLS     27
         3 000423   200003 552140                    STBQ    BUF,'40'O,AUTO

      309    12253    4                   CALL NMU$CCCCHHSS ( CCCC, HH, SS, I ) ;

  12253  3 000424   200025 630500                    EPPR0   I,,AUTO
         3 000425   200033 450500                    STP0    SS+5,,AUTO
         3 000426   200026 631500                    EPPR1   SS,,AUTO
         3 000427   200032 451500                    STP1    SS+4,,AUTO
         3 000430   200024 633500                    EPPR3   HH,,AUTO
         3 000431   200031 453500                    STP3    SS+3,,AUTO
         3 000432   200023 634500                    EPPR4   CCCC,,AUTO
         3 000433   200030 454500                    STP4    SS+2,,AUTO
         3 000434   200030 630500                    EPPR0   SS+2,,AUTO
         3 000435   000022 631400 xsym               EPPR1   B_VECTNIL+18
         3 000436   000000 701000 xent               TSX1    NMU$CCCCHHSS
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:38   
         3 000437   000000 011000                    NOP     0

      310    12254    4                   F_FDS.BUF_ = VECTOR(BUF(1)) ;

  12254  3 000440   000014 235000 4                  LDA     12
         3 000441   200030 452500                    STP2    SS+2,,AUTO
         3 000442   200030 236100                    LDQ     SS+2,,AUTO
         3 000443   000007 036003                    ADLQ    7,DU
         3 000444   000005 755000 2                  STA     F_FDS+5
         3 000445   000006 756000 2                  STQ     F_FDS+6

      311    12255    4                   CALL X$WRITE ( F_FDS,

  12255  3 000446   777640 235007                    LDA     -96,DL
         3 000447   200030 452500                    STP2    SS+2,,AUTO
         3 000450   200030 236100                    LDQ     SS+2,,AUTO
         3 000451   000023 036003                    ADLQ    19,DU
         3 000452   200032 757100                    STAQ    SS+4,,AUTO
         3 000453   777640 235007                    LDA     -96,DL
         3 000454   200034 452500                    STP2    SS+6,,AUTO
         3 000455   200034 236100                    LDQ     SS+6,,AUTO
         3 000456   000024 036003                    ADLQ    20,DU
         3 000457   200036 757100                    STAQ    SS+8,,AUTO
         3 000460   777640 235007                    LDA     -96,DL
         3 000461   200040 452500                    STP2    SS+10,,AUTO
         3 000462   200040 236100                    LDQ     SS+10,,AUTO
         3 000463   000026 036003                    ADLQ    22,DU
         3 000464   200044 757100                    STAQ    SS+14,,AUTO
         3 000465   200032 237100                    LDAQ    SS+4,,AUTO
         3 000466   200042 757100                    STAQ    SS+12,,AUTO
         3 000467   200036 237100                    LDAQ    SS+8,,AUTO
         3 000470   200046 757100                    STAQ    SS+16,,AUTO
         3 000471   200044 237100                    LDAQ    SS+14,,AUTO
         3 000472   200050 757100                    STAQ    SS+18,,AUTO
         3 000473   200050 630500                    EPPR0   SS+18,,AUTO
         3 000474   200056 450500                    STP0    SS+24,,AUTO
         3 000475   200046 631500                    EPPR1   SS+16,,AUTO
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:39   
         3 000476   200055 451500                    STP1    SS+23,,AUTO
         3 000477   200042 633500                    EPPR3   SS+12,,AUTO
         3 000500   200054 453500                    STP3    SS+22,,AUTO
         3 000501   000030 237000 4                  LDAQ    24
         3 000502   200052 757100                    STAQ    SS+20,,AUTO
         3 000503   200052 630500                    EPPR0   SS+20,,AUTO
         3 000504   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000505   000000 701000 xent               TSX1    X$WRITE
         3 000506   000000 011000                    NOP     0

      312    12256    4                                  VECTOR(FMT_CCCCHHSS),
      313    12257    4                                  VECTOR(CCCC),
      314    12258    4                                  VECTOR(HH),
      315    12259    4                                  VECTOR(SS) ) ;
      316    12260    4                   BUF.L(1) = F_FDS.BUFX - 1 ;

  12260  3 000507   000007 236000 2                  LDQ     F_FDS+7
         3 000510   000001 136007                    SBLQ    1,DL
         3 000511   000033 736000                    QLS     27
         3 000512   200007 552140                    STBQ    BUF+4,'40'O,AUTO

      317    12261        /*E*
      318    12262        ERROR:  NMK-E$NMD#GRAN_DIFF-2
      319    12263        MESSAGE:  Device logical address %U1 (%U2) is different.
      320    12264        DESCRIPTION:  The specified device logical address contains different
      321    12265                      data on the two Mirrored Disk devices.  The device logical
      322    12266                      address is also displayed in CCCC-HH-SS (cylinder-head-sector)
      323    12267                      format.
      324    12268        */
      325    12269    4                   CALL NME$ERRMSG ( NMK#GRAN_DIFF, ,

  12269  3 000513   000014 235000 4                  LDA     12
         3 000514   200030 452500                    STP2    SS+2,,AUTO
         3 000515   200030 236100                    LDQ     SS+2,,AUTO
         3 000516   000003 036003                    ADLQ    3,DU
         3 000517   200032 757100                    STAQ    SS+4,,AUTO
         3 000520   000014 235000 4                  LDA     12
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:40   
         3 000521   200034 452500                    STP2    SS+6,,AUTO
         3 000522   200034 236100                    LDQ     SS+6,,AUTO
         3 000523   000007 036003                    ADLQ    7,DU
         3 000524   200040 757100                    STAQ    SS+10,,AUTO
         3 000525   200032 237100                    LDAQ    SS+4,,AUTO
         3 000526   200036 757100                    STAQ    SS+8,,AUTO
         3 000527   200040 237100                    LDAQ    SS+10,,AUTO
         3 000530   200042 757100                    STAQ    SS+12,,AUTO
         3 000531   200042 630500                    EPPR0   SS+12,,AUTO
         3 000532   200047 450500                    STP0    SS+17,,AUTO
         3 000533   200036 631500                    EPPR1   SS+8,,AUTO
         3 000534   200046 451500                    STP1    SS+16,,AUTO
         3 000535   000001 236000 xsym               LDQ     B_VECTNIL+1
         3 000536   000032 235000 4                  LDA     26
         3 000537   200044 757100                    STAQ    SS+14,,AUTO
         3 000540   200044 630500                    EPPR0   SS+14,,AUTO
         3 000541   000022 631400 xsym               EPPR1   B_VECTNIL+18
         3 000542   000000 701000 xent               TSX1    NME$ERRMSG
         3 000543   000000 011000                    NOP     0

      326    12270    4                                     VECTOR(BUF(0)),
      327    12271    4                                     VECTOR(BUF(1)) ) ;
      328    12272    4                   F_FDS.BUF_ = VECTOR(BUF(0)) ;

  12272  3 000544   000014 235000 4                  LDA     12
         3 000545   200030 452500                    STP2    SS+2,,AUTO
         3 000546   200030 236100                    LDQ     SS+2,,AUTO
         3 000547   000003 036003                    ADLQ    3,DU
         3 000550   000005 755000 2                  STA     F_FDS+5
         3 000551   000006 756000 2                  STQ     F_FDS+6

      329    12273    5                   DO  J = 0 TO 1 ;

  12273  3 000552   200015 450100                    STZ     J,,AUTO

      330    12274    5                       CALL X$WRITE ( F_FDS,

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:41   
  12274  3 000553   200015 236100                    LDQ     J,,AUTO
         3 000554   000032 402007                    MPY     26,DL
         3 000555   000004 470406 xsym               LDP0    NMD_PIT+4,QL
         3 000556   777640 235007                    LDA     -96,DL
         3 000557   200030 450500                    STP0    SS+2,,AUTO
         3 000560   200030 236100                    LDQ     SS+2,,AUTO
         3 000561   200032 757100                    STAQ    SS+4,,AUTO
         3 000562   200032 631500                    EPPR1   SS+4,,AUTO
         3 000563   200036 451500                    STP1    SS+8,,AUTO
         3 000564   000036 237000 4                  LDAQ    30
         3 000565   200034 757100                    STAQ    SS+6,,AUTO
         3 000566   200034 630500                    EPPR0   SS+6,,AUTO
         3 000567   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000570   000000 701000 xent               TSX1    X$WRITE
         3 000571   000000 011000                    NOP     0

      331    12275    5                                      VECTOR(FMT_OCT),
      332    12276    5                                      VECTOR(NMD_PIT.DEV.BUF$(J)->AWORD) ) ;
      333    12277    5                       BUF.L(0) = F_FDS.BUFX - 1 ;

  12277  3 000572   000007 236000 2                  LDQ     F_FDS+7
         3 000573   000001 136007                    SBLQ    1,DL
         3 000574   000033 736000                    QLS     27
         3 000575   200003 552140                    STBQ    BUF,'40'O,AUTO

      334    12278        /*E*
      335    12279        ERROR:  NMK-E$NMD#GRAN_STAMP-0
      336    12280        MESSAGE:  %U1 granule stamp = %U2
      337    12281        DESCRIPTION:  The value displayed is the granule stamp (i.e., word 0)
      338    12282                      for the granule that is different on the specified drive.
      339    12283                      This value may or may not be different from the other
      340    12284                      granule stamp displayed.  This value is displayed in an
      341    12285                      attempt to provide a user with a way to determine which
      342    12286                      Mirrored Disk device contains the "correct" data.
      343    12287        */
      344    12288    5                       CALL NME$ERRMSG ( NMK#GRAN_STAMP, ,

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:42   
  12288  3 000576   000040 235000 4                  LDA     32
         3 000577   200015 236100                    LDQ     J,,AUTO
         3 000600   200030 755100                    STA     SS+2,,AUTO
         3 000601   000032 402003                    MPY     26,DU
         3 000602   000041 036000 4                  ADLQ    33
         3 000603   200030 235100                    LDA     SS+2,,AUTO
         3 000604   200032 757100                    STAQ    SS+4,,AUTO
         3 000605   000014 235000 4                  LDA     12
         3 000606   200034 452500                    STP2    SS+6,,AUTO
         3 000607   200034 236100                    LDQ     SS+6,,AUTO
         3 000610   000003 036003                    ADLQ    3,DU
         3 000611   200040 757100                    STAQ    SS+10,,AUTO
         3 000612   200032 237100                    LDAQ    SS+4,,AUTO
         3 000613   200036 757100                    STAQ    SS+8,,AUTO
         3 000614   200040 237100                    LDAQ    SS+10,,AUTO
         3 000615   200042 757100                    STAQ    SS+12,,AUTO
         3 000616   200042 630500                    EPPR0   SS+12,,AUTO
         3 000617   200047 450500                    STP0    SS+17,,AUTO
         3 000620   200036 631500                    EPPR1   SS+8,,AUTO
         3 000621   200046 451500                    STP1    SS+16,,AUTO
         3 000622   000001 236000 xsym               LDQ     B_VECTNIL+1
         3 000623   000042 235000 4                  LDA     34
         3 000624   200044 757100                    STAQ    SS+14,,AUTO
         3 000625   200044 630500                    EPPR0   SS+14,,AUTO
         3 000626   000022 631400 xsym               EPPR1   B_VECTNIL+18
         3 000627   000000 701000 xent               TSX1    NME$ERRMSG
         3 000630   000000 011000                    NOP     0

      345    12289    5                                         VECTOR(NMD_PIT.DEV.NAME(J)),
      346    12290    5                                         VECTOR(BUF(0)) ) ;
      347    12291    5                       END ;

  12291  3 000631   200015 054100                    AOS     J,,AUTO
         3 000632   200015 235100                    LDA     J,,AUTO
         3 000633   000001 115007                    CMPA    1,DL
         3 000634   000553 604400 3                  TMOZ    s:12274

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:43   
      348    12292    4                   NMD_PIT.NDIFF# = NMD_PIT.NDIFF# + 1 ;

  12292  3 000635   000305 236000 xsym               LDQ     NMD_PIT+197
         3 000636   000001 036007                    ADLQ    1,DL
         3 000637   000305 756000 xsym               STQ     NMD_PIT+197

      349    12293    4                   IF  NMD_PIT.NDIFF# > NMD_PIT.MXDIFF#

  12293  3 000640   000303 116000 xsym               CMPQ    NMD_PIT+195
         3 000641   000651 602000 3                  TNC     s:12306
         3 000642   000651 600000 3                  TZE     s:12306

      350    12294    5                   THEN DO ;

      351    12295        /*E*
      352    12296        ERROR:  NMK-E$NMD#MXDIFF-3
      353    12297        MESSAGE:  Maximum differences encountered.
      354    12298        DESCRIPTION:  The number of differences exceed the maximum differences
      355    12299                      limit set by the MXDIFF option.
      356    12300        */
      357    12301    5                       CALL NME$ERRMSG ( NMK#MXDIFF ) ;

  12301  3 000643   000043 630400 4                  EPPR0   35
         3 000644   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000645   000000 701000 xent               TSX1    NME$ERRMSG
         3 000646   000000 011000                    NOP     0

      358    12302    5                       ALTRETURN ;

  12302  3 000647   200022 221300                    LDX1  ! VSIZE+2,,AUTO
         3 000650   000000 702211                    TSX2  ! 0,X1

      359    12303    5                       END ;
      360    12304    4                   END ;
      361    12305
      362    12306    3               NMD_PIT.DEV.BUF$(0) = PINCRW ( NMD_PIT.DEV.BUF$(0),

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:44   
  12306  3 000651   000004 236000 xsym               LDQ     NMD_PIT+4
         3 000652   002000 036003                    ADLQ    1024,DU
         3 000653   000004 756000 xsym               STQ     NMD_PIT+4

      363    12307    3                                              %NMD#WORDS_PER_GRAN ) ;
      364    12308    3               NMD_PIT.DEV.BUF$(1) = PINCRW ( NMD_PIT.DEV.BUF$(1),

  12308  3 000654   000036 236000 xsym               LDQ     NMD_PIT+30
         3 000655   002000 036003                    ADLQ    1024,DU
         3 000656   000036 756000 xsym               STQ     NMD_PIT+30

      365    12309    3                                              %NMD#WORDS_PER_GRAN ) ;
      366    12310
      367    12311    3               END ;

  12311  3 000657   200025 054100                    AOS     I,,AUTO
         3 000660   200025 236100                    LDQ     I,,AUTO
         3 000661   200016 116100                    CMPQ    LGRAN,,AUTO
         3 000662   000367 604400 3                  TMOZ    s:12247

      368    12312
      369    12313    2           RETURN ;

  12313  3 000663   200022 221300                    LDX1  ! VSIZE+2,,AUTO
         3 000664   000001 702211                    TSX2  ! 1,X1
      370    12314
      371    12315    2           END KOMPARE ;
      372    12316
      373    12317    1           END NMK$KOMPARE ;

PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:45   
--  Include file information  --

   XU_MACRO_C.:E05TOU  is referenced.
   XU_FORMAT_C.:E05TOU  is referenced.
   XUF_ENTRY.:E05TOU  cannot be made into a system file and is referenced.
   NM_PERR_C.:E05TOU  is referenced.
   NM_SUBS_C.:E05TOU  is referenced.
   NM_EQU_E.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   NM_MACRO_M.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NMK$KOMPARE.
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:46   

 **** Variables and constants ****

  ****  Section 001 RoData NMK$KOMPARE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/c CHAR(14)    r     1 FMT_CCCCHHSS               0-0-0/c CHAR(2)     r     1 FMT_DEC
     1-0-0/c CHAR(6)     r     1 FMT_OCT                    3-0-0/w STRC        r     1 NMK#DIFF
    11-0-0/w STRC        r     1 NMK#GRAN_DIFF             12-0-0/w STRC        r     1 NMK#GRAN_STAMP
    13-0-0/w STRC        r     1 NMK#MXDIFF                 4-0-0/w STRC        r     1 NMK#NODIFF

  ****  Section 002  Data  NMK$KOMPARE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1080)  r     1 F_FDS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w STRC(144)   r     1 BUF(0:1)                  23-0-0/w SBIN        r     1 CCCC
    13-0-0/w SBIN        r     1 FGRAN                     24-0-0/w SBIN        r     1 HH
    25-0-0/w SBIN        r     1 I                         15-0-0/w SBIN        r     1 J
    16-0-0/w SBIN        r     1 LGRAN                     17-0-0/w SBIN        r     1 NGRAN
    26-0-0/w SBIN        r     1 SS                        20-0-0/w SBIN        r     1 VSIZE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/d STRC(8892)  r     1 NMD_PIT
     0-0-0/d STRC(1512)  r     1 XUG_GETCMD
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:47   

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 AWORD                      0-0-0/w STRC(1332)  r     1 DCT
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/w STRC(144)   r     1 OUT
     0-0-0/d STRC(72)    r     1 V_


   Procedure NMK$KOMPARE requires 437 words for executable code.
   Procedure NMK$KOMPARE requires 48 words of local(AUTO) storage.

    No errors detected in file NMK$KOMPARE.:E05TSI    .
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:48   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:49   
          MINI XREF LISTING

AWORD IN PROCEDURE KOMPARE
     12080**DCL     12274--CALL
B$ALT.CODE
     10786**DCL     10786--REDEF   10787--REDEF   10787--REDEF
B$ALT.ERR.ERR#
     10788**DCL     10788--REDEF
B$ALT.EVID
     10787**DCL     10787--REDEF   10787--REDEF
B$TCB$
     10797**DCL     10795--IMP-PTR
BUF
     10798**DCL     12052--ASSIGN  12061--CALL    12250--ASSIGN  12254--ASSIGN  12269--CALL    12269--CALL
     12272--ASSIGN  12288--CALL
BUF.L
     10799**DCL     12054<<ASSIGN  12252<<ASSIGN  12260<<ASSIGN  12277<<ASSIGN
CCCC IN PROCEDURE KOMPARE
     12081**DCL     12253<>CALL    12255--CALL
DCT.DP
     10832**DCL     10839--REDEF   10842--REDEF   10843--REDEF   10845--REDEF   10845--REDEF   10846--REDEF
     10847--REDEF   10847--REDEF
DCT.DP.MIRROR.STATE
     10836**DCL     12006>>IF      12015>>IF
DCT.MPC.IOCHANX
     10840**DCL     10840--REDEF
ERROR
     12072**LABEL   11949--CALLALT 11950--CALLALT 11951--CALLALT 11958--CALLALT 11959--CALLALT 11960--CALLALT
     11961--CALLALT 11962--CALLALT 11964--CALLALT 11966--CALLALT 11969--CALLALT 11970--CALLALT 11971--CALLALT
     11975--CALLALT 12005--CALLALT 12009--CALLALT 12010--GOTO    12012--CALLALT 12014--CALLALT 12018--CALLALT
     12019--GOTO    12021--CALLALT 12022--CALLALT 12024--CALLALT 12066--CALLALT
FGRAN
     10851**DCL     11985<>CALL    11986>>DOUNTIL 11994<>CALL    11995>>ASSIGN  12012<>CALL    12022<>CALL
     12030<>CALL    12033<>CALL    12246>>DOINDEX
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:50   
FINIS
     12066**LABEL   12025--CALLALT
FM$GRAN
     10855**DCL     12247>>IF      12247>>IF
FMT_CCCCHHSS IN PROCEDURE KOMPARE
     12082**DCL     12255--CALL
FMT_DEC
     10858**DCL     12053--CALL    12251--CALL
FMT_OCT
     10859**DCL     12274--CALL
F_FDS
     10878**DCL     12053<>CALL    12251<>CALL    12255<>CALL    12274<>CALL
F_FDS.BUFX
     10902**DCL     12054>>ASSIGN  12252>>ASSIGN  12260>>ASSIGN  12277>>ASSIGN
F_FDS.BUF_
     10895**DCL     12052<<ASSIGN  12250<<ASSIGN  12254<<ASSIGN  12272<<ASSIGN
HH IN PROCEDURE KOMPARE
     12083**DCL     12253<>CALL    12255--CALL
I IN PROCEDURE KOMPARE
     12084**DCL     12246<<DOINDEX 12251--CALL    12253<>CALL
J
     10978**DCL     12273<<DOINDEX 12274>>CALL    12288>>CALL
KOMPARE
     12076**PROC    12025--CALL
LGRAN
     10979**DCL     11984<<ASSIGN  11985<>CALL    11994<>CALL    11995>>ASSIGN  12030<>CALL    12246>>DOINDEX
NGRAN
     10980**DCL     11995<<ASSIGN  11996>>ASSIGN
NMD_PIT.DEV.BUF$
     11021**DCL     12243<<ASSIGN  12244<<ASSIGN  12247>>IF      12247>>IF      12274>>CALL    12306<<ASSIGN
     12306>>ASSIGN  12308<<ASSIGN  12308>>ASSIGN
NMD_PIT.DEV.BUF_
     11016**DCL     11999--ASSIGN  12000--ASSIGN  12012<>CALL    12022<>CALL    12243--ASSIGN  12244--ASSIGN
NMD_PIT.DEV.DCT$
     11044**DCL     12006>>IF      12015>>IF
NMD_PIT.DEV.DRZERO
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:51   
     11054**DCL     11984>>ASSIGN
NMD_PIT.DEV.NAME
     11099**DCL     12288--CALL
NMD_PIT.DEV.STATE
     11124**DCL     12006>>IF      12015>>IF
NMD_PIT.DEV.VID_
     11140**DCL     11964<>CALL    11966<>CALL
NMD_PIT.FLAGS.REPORT#
     11255**DCL     12031>>IF
NMD_PIT.MXDIFF#
     11301**DCL     12293>>IF
NMD_PIT.NDIFF#
     11311**DCL     12042>>IF      12053--CALL    12292<<ASSIGN  12292>>ASSIGN  12293>>IF
NMD_PIT.PACKSIZE
     11368**DCL     11986>>DOUNTIL
NMD_PIT.PAUSE#
     11373**DCL     12034>>IF
NME$ERRMSG
     10757**DCL-ENT 12050--CALL    12061--CALL    12269--CALL    12288--CALL    12301--CALL
NMK#DIFF
     11455**DCL     12061<>CALL
NMK#GRAN_DIFF IN PROCEDURE KOMPARE
     12104**DCL     12269<>CALL
NMK#GRAN_STAMP IN PROCEDURE KOMPARE
     12156**DCL     12288<>CALL
NMK#MXDIFF IN PROCEDURE KOMPARE
     12208**DCL     12301<>CALL
NMK#NODIFF
     11507**DCL     12050<>CALL
NMO$DEV
     10758**DCL-ENT 11949--CALL    11950--CALL
NMO$OPTIONS
     10759**DCL-ENT 11951--CALL
NMO$REPORT
     10760**DCL-ENT 11979--CALL    12033--CALL
NMU$ABORT
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:52   
     10761**DCL-ENT 12072--CALL
NMU$CCCCHHSS
     10762**DCL-ENT 12253--CALL
NMU$FDS
     10763**DCL-ENT 12066--CALL
NMU$FGRAN
     10764**DCL-ENT 11985--CALL    12030--CALL
NMU$GDS
     10765**DCL-ENT 11975--CALL
NMU$LGRAN
     10766**DCL-ENT 11994--CALL
NMU$LOCK
     10767**DCL-ENT 12005--CALL    12014--CALL
NMU$READ
     10768**DCL-ENT 11964--CALL    11966--CALL    12012--CALL    12022--CALL
NMU$UNLOCK
     10769**DCL-ENT 12021--CALL    12024--CALL
NMU$WAIT
     10770**DCL-ENT 12036--CALL
NMV$CHGSTATE
     10777**DCL-ENT 12009--CALL    12018--CALL
NMV$DGT
     10771**DCL-ENT 11971--CALL
NMV$MIRRORED
     10772**DCL-ENT 11958--CALL    11959--CALL
NMV$PACKSIZE
     10773**DCL-ENT 11970--CALL
NMV$PAIR
     10774**DCL-ENT 11961--CALL
NMV$PRIMARY
     10775**DCL-ENT 11960--CALL
NMV$SAME_STATE
     10776**DCL-ENT 11962--CALL
NMV$VSN
     10778**DCL-ENT 11969--CALL
OUT.NSUBLKS
PL6.E3A0      #001=NMK$KOMPARE File=NMK$KOMPARE.:E05TSI                          WED 07/30/97 03:48 Page:53   
     11560**DCL     11951>>CALL
OUT.SUBLK$
     11581**DCL     11949<>CALL    11950<>CALL
SS IN PROCEDURE KOMPARE
     12241**DCL     12253<>CALL    12255--CALL
VSIZE
     11587**DCL     11996<<ASSIGN  11999>>ASSIGN  12000>>ASSIGN
V_.PTR$
     11603**DCL     12243>>ASSIGN  12244>>ASSIGN
V_.W1.VSIZE#
     11601**DCL     11999<<ASSIGN  12000<<ASSIGN
V_.W2
     11602**DCL     11603--REDEF
X$WRITE
      7484**DCL-ENT 12053--CALL    12251--CALL    12255--CALL    12274--CALL
XUG_GETCMD.OUT$
     11625**DCL     11548--IMP-PTR 11631--REDEF   11949>>CALL    11950>>CALL    11951>>CALL
