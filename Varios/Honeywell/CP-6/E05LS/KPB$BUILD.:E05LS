VERSION E05

PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:1    
        1        1        /*M* KPB$BUILD - This module implements PIGETTE's BUILD command.              */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,DFC */
        8        8        KPB$BUILD: PROC(OUT$);
        9        9        /**/
       10       10        /*  Include files  */
       11       11        /**/
       12       12        %INCLUDE XU_MACRO_C;
       13     3118        %INCLUDE KP_DATA_R;
       14     4370        %INCLUDE XU_SUBS_C;
       15     4462        %INCLUDE KP_MSG;
       16     4555        %INCLUDE CP_6_SUBS;
       17     5095        %INCLUDE GI_BOOT_C;
       18     5206        /**/
       19     5207        /*  PARAMETERS  */
       20     5208        /**/
       21     5209    1   DCL OUT$ PTR;
       22     5210        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:2    
       23     5211        /**/
       24     5212        /*  Entry declarations  */
       25     5213        /**/
       26     5214        %KP_ENTRIES (OMIT = KPB$BUILD);
       27     5320    1   DCL KFF$FEBOOT ENTRY(4) ALTRET;
       28     5321        /**/
       29     5322        /*  BASED Structures  */
       30     5323        /**/
       31     5324        %B$TCB;
       32     5327        %B$ALT;
       33     5335        %PARSE$OUT    ( NAME = OUT$BLK,
       34     5336                        STCLASS = BASED );
       35     5381        %PARSE$SYM(NAME = OUT$SYM,STCLASS = BASED);
       36     5419    1   DCL UBIN$9 UBIN(9) BASED CALIGNED;
       37     5420        /**/
       38     5421        /*  LOCAL AUTO GOODIES  */
       39     5422        /**/
       40     5423    1   DCL I SBIN;
       41     5424    1   DCL NSECTORS SBIN;
       42     5425    1   DCL NSECTORS_BIG2 SBIN WORD;
       43     5426    1   DCL PACK SBIN WORD;
       44     5427    1   DCL 1 PACK_ REDEF PACK,
       45     5428    1         2 * BIT(20) UNAL,
       46     5429    1         2 HOB UBIN(8) UNAL,
       47     5430    1         2 LOB UBIN(8) UNAL;
       48     5431    1   DCL DEST_FEP UBIN WORD;
       49     5432    1   DCL DEST_DRIVE UBIN WORD;
       50     5433    1   DCL OUTPUT_OPEN BIT(1);
       51     5434    1   DCL FEX_TO_BUILD SBIN;
       52     5435        %VLP_ERRCODE (FPTN = BUILD_ERROR,STCLASS = AUTO);
       53     5480    1   DCL BOOT_L66_WORDS UBIN WORD;
       54     5481    1   DCL PART UBIN WORD;
       55     5482    1   DCL PART$ PTR;
       56     5483    1   DCL OPT UBIN WORD;
       57     5484    1   DCL OPT$ PTR;
       58     5485        %KP_DISKID (FPTN=DISKID,STCLASS=AUTO);
       59     5497        %KP_DISKDIR (FPTN=DISKDIR,STCLASS=AUTO);
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:3    
       60     5507        /**/
       61     5508        /*  LOCAL STATIC  */
       62     5509        /**/
       63     5510    1   DCL BUILD_BUFFER VECTOR STATIC;
       64     5511        %FPT_FDS (FPTN = FPT_FDS,
       65     5512                  RESULTS = BUILD_BUFFER,
       66     5513                  STCLASS = STATIC);
       67     5528        %FPT_TIME (FPTN = FPT_TIME,
       68     5529                   SOURCE = CLOCK,
       69     5530                   DEST = LOCAL,
       70     5531                   STCLASS = STATIC);
       71     5550        /**/
       72     5551        /*  SYMREFS  */
       73     5552        /**/
       74     5553    1   DCL B$TCB$ PTR SYMREF;
       75     5554        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:4    
       76     5555        /**/
       77     5556        /* Make sure he is allowed to do this. */
       78     5557        /**/
       79     5558    1         CALL KPU$SECURITY(%KP_PRIV_WR#) ALTRET(CANT_OPEN);
       80     5559        /**/
       81     5560        /* Set up some things  */
       82     5561        /**/
       83     5562    1         OUTPUT_OPEN = '0'B;
       84     5563    1         BUILD_BUFFER = VECTOR(NIL);
       85     5564    1         CALL KPD$DISK_TYPE (IN_OPTS,%DT_RFEP#);
       86     5565        /**/
       87     5566        /* Loop, processing parts of the command. */
       88     5567        /**/
       89     5568    2         DO PART = 0 TO OUT$ -> OUT$BLK.NSUBLKS -1;
       90     5569    2            PART$ = OUT$ -> OUT$BLK.SUBLK$(PART);
       91     5570    3            DO CASE(PART$ -> OUT$BLK.CODE);
       92     5571        /**/
       93     5572        /* Set disposition (ON/OVER/INTO) */
       94     5573        /**/
       95     5574    3               CASE(2);
       96     5575    4                 DO CASE(PART$ -> OUT$BLK.SUBLK$(0) -> OUT$BLK.CODE);
       97     5576    4                    CASE(1);               /* OVER                               */
       98     5577    4                      KP_OUTPUT_DISP = %NEWFILE#;
       99     5578    4                    CASE(0);               /* TO                                 */
      100     5579    4                      KP_OUTPUT_DISP = %ERROR#;
      101     5580    4                    CASE(2);               /* INTO                               */
      102     5581    4                      KP_OUTPUT_DISP = %OLDFILE#;
      103     5582    4                    END;                   /* END CASE                           */
      104     5583        /**/
      105     5584        /*  The FEP on whose behalf this boot disk is made. */
      106     5585        /**/
      107     5586    3               CASE(1);
      108     5587    3                 CALL KPU$FEP_AND_DRIVE(
      109     5588    3                    PART$ -> OUT$BLK,FEX_TO_BUILD,I) ALTRET(CANT_OPEN);
      110     5589        /**/
      111     5590        /* Process the output specification.  (The FEP we're writing on) */
      112     5591        /**/
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:5    
      113     5592    3               CASE(3);
      114     5593    3                 CALL KPU$FEP_AND_DRIVE(
      115     5594    3                  PART$ -> OUT$BLK,
      116     5595    3                  DEST_FEP,DEST_DRIVE) ALTRET(BAD_FEP_OR_DRIVE);
      117     5596    3                 CALL KPX$OPEN( DEST_FEP, DEST_DRIVE) ALTRET (CANT_OPEN);
      118     5597    3                 OUTPUT_OPEN = '1'B;
      119     5598
      120     5599    3               END;                        /* END DO CASE on node type           */
      121     5600    2            END;                           /* END DO INDEX on node number        */
      122     5601        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:6    
      123     5602        /**/
      124     5603        /* Allocate a buffer and build boot image in it.  */
      125     5604        /**/
      126     5605    1         CALL KFF$FEBOOT (FEX_TO_BUILD,BUILD_BUFFER,BUILD_ERROR,BOOT_L66_WORDS)
      127     5606    1              ALTRET (RIVER_CITY);
      128     5607    1         NSECTORS = (BOOT_L66_WORDS * 4 +255) / 256;
      129     5608        /**/
      130     5609        /*  Touch up the boot image a little.                                         */
      131     5610        /*  Make GI_BOOT_BASE, UBIN (32), zero.                                       */
      132     5611        /**/
      133     5612    2         DO I=0 TO 3;
      134     5613    2            PINCRC(VBASE(BUILD_BUFFER),%GI_BOOTBASE_LOC*2 + I) -> UBIN$9 = 0;
      135     5614    2            END;
      136     5615        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:7    
      137     5616        /**/
      138     5617        /*  We have approved of all the thing user has typed.  Before plowing         */
      139     5618        /*  ahead with time-consuming stuff, let him know that we're working          */
      140     5619        /*  on what he wants.                                                         */
      141     5620        /**/
      142     5621    1         NSECTORS_BIG2 = NSECTORS - %KP_NSEC_BIG1#;
      143     5622    1         CALL KPU$VSEC2DISK (I,PACK,I,%KP_VSEC_BIG2#+NSECTORS_BIG2,I);
      144     5623    1         CALL BINCHAR (SUBSTR(KP_U1.TEXT,0,2), PACK);
      145     5624    1         KP_U1.L = 2;
      146     5625    1         CALL KPT$TERM_MSG( %T$COPYING );
      147     5626        /**/
      148     5627        /* Place the first chunk of BIGFOOT on the diskette.                          */
      149     5628        /**/
      150     5629    1         CALL KPU$WRITE_BLOCK( DEST_FEP,
      151     5630    1                               DEST_DRIVE,
      152     5631    1                               %KP_VSEC_BIG1#,
      153     5632    1                               VBASE(BUILD_BUFFER),
      154     5633    1                               %KP_NSEC_BIG1#)
      155     5634    1                               ALTRET( DISK_ALT );
      156     5635        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:8    
      157     5636        /**/
      158     5637        /* Now comes the reloader sector that shuffles everything down to */
      159     5638        /* the proper address */
      160     5639        /**/
      161     5640    1         CALL KPU$WRITE_BLOCK( DEST_FEP,
      162     5641    1                               DEST_DRIVE,
      163     5642    1                               %KP_VSEC_RELOADER#,
      164     5643    1                               ADDR(RELOADER),
      165     5644    1                               %KP_NSEC_RELOADER#)
      166     5645    1                               ALTRET( DISK_ALT );
      167     5646        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:9    
      168     5647        /**/
      169     5648        /* Place the remainder of BIGFOOT on the diskette.                            */
      170     5649        /**/
      171     5650    1         CALL KPU$WRITE_BLOCK( DEST_FEP,
      172     5651    1                               DEST_DRIVE,
      173     5652    1                               %KP_VSEC_BIG2#,
      174     5653    1                               PINCRC(VBASE(BUILD_BUFFER),%KP_NSEC_BIG1#*256),
      175     5654    1                               NSECTORS_BIG2)
      176     5655    1                               ALTRET( DISK_ALT );
      177     5656        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:10   
      178     5657        /**/
      179     5658        /* Put the PRIMAL BOOT code on the disk where the L6 firmware can             */
      180     5659        /* find it.                                                                   */
      181     5660        /*                                                                            */
      182     5661        /* NOTE:  There is no need to modify PRIMAL BOOT since he always loads the    */
      183     5662        /* same way, no matter what's on the diskette.                                */
      184     5663        /**/
      185     5664    1         CALL KPU$WRITE_BLOCK( DEST_FEP,
      186     5665    1                               DEST_DRIVE,
      187     5666    1                               %KP_VSEC_PRIMAL#,
      188     5667    1                               ADDR(PRIMAL_BOOT),
      189     5668    1                               %KP_NSEC_PRIMAL#)
      190     5669    1                               ALTRET( DISK_ALT );
      191     5670        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:11   
      192     5671        /**/
      193     5672        /*  Put the SECONDARY BOOT code where it can finish up where PRIMAL           */
      194     5673        /*  left off.                                                                 */
      195     5674        /**/
      196     5675    1         CALL KPU$WRITE_BLOCK( DEST_FEP,
      197     5676    1                               DEST_DRIVE,
      198     5677    1                               %KP_VSEC_SECONDARY#,
      199     5678    1                               ADDR(SECONDARY_BOOT),
      200     5679    1                               %KP_NSEC_SECONDARY#)
      201     5680    1                               ALTRET( DISK_ALT );
      202     5681        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:12   
      203     5682        /**/
      204     5683        /*  Put the ID RECORD on the diskette for later observation.                  */
      205     5684        /**/
      206     5685    1         DISKID = '0'B;
      207     5686    1         DISKID.VERITY = 'FUZZY-PIGS';
      208     5687    1         DISKID.REVISION_LEVEL = %KP_REVISION_LEVEL#;
      209     5688    1         FPT_TIME.TIME_ = VECTOR(DISKID.BUILD_TIME);
      210     5689    1         FPT_TIME.DATE_ = VECTOR(DISKID.BUILD_DATE);
      211     5690    1         FPT_TIME.DAY_ = VECTOR(DISKID.BUILD_DAY);
      212     5691    1         CALL M$TIME (FPT_TIME) ALTRET(MONERR);
      213     5692    1         FPT_NODEINFO.V.NODENUM# = FEX_TO_BUILD;
      214     5693    1         FPT_NODEINFO.V.NODENAME# = ' ';
      215     5694    1         CALL M$NODEINFO (FPT_NODEINFO) ALTRET(MONERR);
      216     5695    1         DISKID.DESTINATION_NODE = VLR_NODEINFO.NODENAME#;
      217     5696    1         DISKID.PATCH_WEEK = VLR_SITEINFO.PATCHWEEK#;
      218     5697    1         CALL CONCAT(DISKID.SYS_VERSION,
      219     5698    1                     SUBSTR(VLR_SITEINFO.VERSION#,0,3),
      220     5699    1                     VLR_SITEINFO.MINI_ID#);
      221     5700    1         IF VLR_SITEINFO.SITE_ID# = ' ' THEN
      222     5701    1            DISKID.SITE_ID = VLR_SITEINFO.SITE_NAME#.C;
      223     5702    1         ELSE
      224     5703    1            CALL CONCAT (DISKID.SITE_ID, VLR_SITEINFO.SITE_ID#,' ',
      225     5704    1              VLR_SITEINFO.SITE_NAME#.C);
      226     5705        /**/
      227     5706    1         CALL KPU$WRITE_BLOCK( DEST_FEP,
      228     5707    1                               DEST_DRIVE,
      229     5708    1                               %KP_VSEC_DISKID#,
      230     5709    1                               ADDR(DISKID),
      231     5710    1                               %KP_NSEC_DISKID#)
      232     5711    1                               ALTRET( DISK_ALT );
      233     5712        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:13   
      234     5713        /**/
      235     5714        /*  Put the DISK DIRECTORY on the diskette for later observation.             */
      236     5715        /**/
      237     5716    1         DISKDIR = '0'B;
      238     5717    1         PACK = %KP_VSEC_BIG2# + NSECTORS_BIG2;
      239     5718    1         DISKDIR.FREE_VSEC.HOB = PACK_.HOB;
      240     5719    1         DISKDIR.FREE_VSEC.LOB = PACK_.LOB;
      241     5720    1         DISKDIR.DUMP_VSEC = '0'B;         /* NO DUMP YET                        */
      242     5721        /**/
      243     5722    1         CALL KPU$WRITE_BLOCK( DEST_FEP,
      244     5723    1                               DEST_DRIVE,
      245     5724    1                               %KP_VSEC_DISKDIR#,
      246     5725    1                               ADDR(DISKDIR),
      247     5726    1                               %KP_NSEC_DISKDIR#)
      248     5727    1                               ALTRET( DISK_ALT );
      249     5728        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:14   
      250     5729        /**/
      251     5730    1         CALL KPT$TERM_MSG( %T$COPYDUN );
      252     5731    1         GOTO QUITIT;
      253     5732        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:15   
      254     5733        /**/
      255     5734        /* Now, clean up after ourselves! */
      256     5735        /**/
      257     5736    1   MONERR: ;
      258     5737    1         BUILD_ERROR = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR;
      259     5738
      260     5739    1   RIVER_CITY: ;                           /* TROUBLE!  Code stashed already     */
      261     5740    1         CALL KPE$ERRMSG (BUILD_ERROR);
      262     5741                                                /* Various errors already printed     */
      263     5742    1   CANT_OPEN: ;
      264     5743    1   BAD_FEP_OR_DRIVE: ;
      265     5744    1   DISK_ALT: ;                             /* Error on disk - already printed    */
      266     5745        /**/
      267     5746    1   QUITIT: ;                               /* Universal bailout point            */
      268     5747    1         IF BUILD_BUFFER ~= VECTOR(NIL)
      269     5748    1          THEN                             /* A buffer has been allocated        */
      270     5749    2            DO;
      271     5750    2              FPT_FDS.V.SEGSIZE# = (VBOUND(BUILD_BUFFER)+1) / 4;
      272     5751    2              CALL M$FDS (FPT_FDS) ALTRET(BUFFER_GONE);
      273     5752    2   BUFFER_GONE: ;
      274     5753    2              END;
      275     5754    1         IF OUTPUT_OPEN
      276     5755    1          THEN
      277     5756    1              CALL KPX$CLOSE( DEST_FEP,DEST_DRIVE) ALTRET(OUT_CLOSED);
      278     5757    1   OUT_CLOSED: ;
      279     5758        /**/
      280     5759    1         RETURN;
      281     5760        /**/
      282     5761    1         END KPB$BUILD;

PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:16   
--  Include file information  --

   GI_BOOT_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KP_MSG.:E05TOU  is referenced.
   XU_SUBS_C.:E05TOU  is referenced.
   XU_FORMAT_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   KP_MACRO_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   KP_PERR_C.:E05TOU  is referenced.
   KP_SUBS.:E05TOU  is referenced.
   KP_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KPB$BUILD.

   Procedure KPB$BUILD requires 365 words for executable code.
   Procedure KPB$BUILD requires 150 words of local(AUTO) storage.

    No errors detected in file KPB$BUILD.:E05TSI    .

PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:17   

 Object Unit name= KPB$BUILD                                  File name= KPB$BUILD.:E05TOU
 UTS= JUL 30 '97 01:17:12.00 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none    20     24  KPB$BUILD
    2  RoData even  UTS      3      3  KPB$BUILD
    3   Proc  even  none   365    555  KPB$BUILD
    4  RoData even  none    30     36  KPB$BUILD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes            yes      Std        1  KPB$BUILD
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:18   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KPU$SECURITY
 yes     yes           Std       2 KPX$OPEN
         yes           Std       1 KPT$TERM_MSG
 yes     yes           Std       1 KPE$ERRMSG
 yes     yes           Std       5 KPU$WRITE_BLOCK
         yes           Std       2 KPD$DISK_TYPE
 yes     yes           Std       4 KFF$FEBOOT
         yes           Std       5 KPU$VSEC2DISK
 yes     yes           Std       3 KPU$FEP_AND_DRIVE
 yes     yes           Std       2 KPX$CLOSE
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  KP_INBUF                              KP_RU_OUTBUF
     KP_U1                                 KP_RU_KEY                             KP_OUTPUT_DISP
     IN_OPTS                               PRIMAL_BOOT                           SECONDARY_BOOT
     RELOADER                              FPT_NODEINFO                          VLR_NODEINFO
     VLR_SITEINFO                          B$TCB$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:19   


        1        1        /*M* KPB$BUILD - This module implements PIGETTE's BUILD command.              */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,DFC */
        8        8        KPB$BUILD: PROC(OUT$);

      8  3 000000   000000 700200 xent  KPB$BUILD    TSX0  ! X66_AUTO_1
         3 000001   000226 000001                    ZERO    150,1

        9        9        /**/
       10       10        /*  Include files  */
       11       11        /**/
       12       12        %INCLUDE XU_MACRO_C;
       13     3118        %INCLUDE KP_DATA_R;
       14     4370        %INCLUDE XU_SUBS_C;
       15     4462        %INCLUDE KP_MSG;
       16     4555        %INCLUDE CP_6_SUBS;
       17     5095        %INCLUDE GI_BOOT_C;
       18     5206        /**/
       19     5207        /*  PARAMETERS  */
       20     5208        /**/
       21     5209    1   DCL OUT$ PTR;
       22     5210        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:20   
       23     5211        /**/
       24     5212        /*  Entry declarations  */
       25     5213        /**/
       26     5214        %KP_ENTRIES (OMIT = KPB$BUILD);
       27     5320    1   DCL KFF$FEBOOT ENTRY(4) ALTRET;
       28     5321        /**/
       29     5322        /*  BASED Structures  */
       30     5323        /**/
       31     5324        %B$TCB;
       32     5327        %B$ALT;
       33     5335        %PARSE$OUT    ( NAME = OUT$BLK,
       34     5336                        STCLASS = BASED );
       35     5381        %PARSE$SYM(NAME = OUT$SYM,STCLASS = BASED);
       36     5419    1   DCL UBIN$9 UBIN(9) BASED CALIGNED;
       37     5420        /**/
       38     5421        /*  LOCAL AUTO GOODIES  */
       39     5422        /**/
       40     5423    1   DCL I SBIN;
       41     5424    1   DCL NSECTORS SBIN;
       42     5425    1   DCL NSECTORS_BIG2 SBIN WORD;
       43     5426    1   DCL PACK SBIN WORD;
       44     5427    1   DCL 1 PACK_ REDEF PACK,
       45     5428    1         2 * BIT(20) UNAL,
       46     5429    1         2 HOB UBIN(8) UNAL,
       47     5430    1         2 LOB UBIN(8) UNAL;
       48     5431    1   DCL DEST_FEP UBIN WORD;
       49     5432    1   DCL DEST_DRIVE UBIN WORD;
       50     5433    1   DCL OUTPUT_OPEN BIT(1);
       51     5434    1   DCL FEX_TO_BUILD SBIN;
       52     5435        %VLP_ERRCODE (FPTN = BUILD_ERROR,STCLASS = AUTO);
       53     5480    1   DCL BOOT_L66_WORDS UBIN WORD;
       54     5481    1   DCL PART UBIN WORD;
       55     5482    1   DCL PART$ PTR;
       56     5483    1   DCL OPT UBIN WORD;
       57     5484    1   DCL OPT$ PTR;
       58     5485        %KP_DISKID (FPTN=DISKID,STCLASS=AUTO);
       59     5497        %KP_DISKDIR (FPTN=DISKDIR,STCLASS=AUTO);
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:21   
       60     5507        /**/
       61     5508        /*  LOCAL STATIC  */
       62     5509        /**/
       63     5510    1   DCL BUILD_BUFFER VECTOR STATIC;
       64     5511        %FPT_FDS (FPTN = FPT_FDS,
       65     5512                  RESULTS = BUILD_BUFFER,
       66     5513                  STCLASS = STATIC);
       67     5528        %FPT_TIME (FPTN = FPT_TIME,
       68     5529                   SOURCE = CLOCK,
       69     5530                   DEST = LOCAL,
       70     5531                   STCLASS = STATIC);
       71     5550        /**/
       72     5551        /*  SYMREFS  */
       73     5552        /**/
       74     5553    1   DCL B$TCB$ PTR SYMREF;
       75     5554        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:22   
       76     5555        /**/
       77     5556        /* Make sure he is allowed to do this. */
       78     5557        /**/
       79     5558    1         CALL KPU$SECURITY(%KP_PRIV_WR#) ALTRET(CANT_OPEN);

   5558  3 000002   000000 630400 4                  EPPR0   0
         3 000003   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000004   000000 701000 xent               TSX1    KPU$SECURITY
         3 000005   000525 702000 3                  TSX2    CANT_OPEN

       80     5559        /**/
       81     5560        /* Set up some things  */
       82     5561        /**/
       83     5562    1         OUTPUT_OPEN = '0'B;

   5562  3 000006   200012 450100                    STZ     OUTPUT_OPEN,,AUTO

       84     5563    1         BUILD_BUFFER = VECTOR(NIL);

   5563  3 000007   000002 237000 4                  LDAQ    2
         3 000010   000000 757000 1                  STAQ    BUILD_BUFFER

       85     5564    1         CALL KPD$DISK_TYPE (IN_OPTS,%DT_RFEP#);

   5564  3 000011   000004 630400 4                  EPPR0   4
         3 000012   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000013   000000 701000 xent               TSX1    KPD$DISK_TYPE
         3 000014   000000 011000                    NOP     0

       86     5565        /**/
       87     5566        /* Loop, processing parts of the command. */
       88     5567        /**/
       89     5568    2         DO PART = 0 TO OUT$ -> OUT$BLK.NSUBLKS -1;

   5568  3 000015   200016 450100                    STZ     PART,,AUTO
         3 000016   000116 710000 3                  TRA     s:5600+3

PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:23   
       90     5569    2            PART$ = OUT$ -> OUT$BLK.SUBLK$(PART);

   5569  3 000017   200003 470500                    LDP0    @OUT$,,AUTO
         3 000020   000000 471500                    LDP1    0,,PR0
         3 000021   200016 720100                    LXL0    PART,,AUTO
         3 000022   100003 236110                    LDQ     3,X0,PR1
         3 000023   200017 756100                    STQ     PART$,,AUTO

       91     5570    3            DO CASE(PART$ -> OUT$BLK.CODE);

   5570  3 000024   200017 473500                    LDP3    PART$,,AUTO
         3 000025   300000 721100                    LXL1    0,,PR3
         3 000026   000004 101003                    CMPX1   4,DU
         3 000027   000031 602011 3                  TNC     s:5570+5,X1
         3 000030   000113 710000 3                  TRA     s:5600
         3 000031   000113 710000 3                  TRA     s:5600
         3 000032   000056 710000 3                  TRA     s:5587
         3 000033   000035 710000 3                  TRA     s:5575
         3 000034   000070 710000 3                  TRA     s:5593

       92     5571        /**/
       93     5572        /* Set disposition (ON/OVER/INTO) */
       94     5573        /**/
       95     5574    3               CASE(2);

       96     5575    4                 DO CASE(PART$ -> OUT$BLK.SUBLK$(0) -> OUT$BLK.CODE);

   5575  3 000035   300003 474500                    LDP4    3,,PR3
         3 000036   400000 722100                    LXL2    0,,PR4
         3 000037   000003 102003                    CMPX2   3,DU
         3 000040   000042 602012 3                  TNC     s:5575+5,X2
         3 000041   000113 710000 3                  TRA     s:5600
         3 000042   000050 710000 3                  TRA     s:5579
         3 000043   000045 710000 3                  TRA     s:5577
         3 000044   000053 710000 3                  TRA     s:5581

       97     5576    4                    CASE(1);               /* OVER                               */
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:24   

       98     5577    4                      KP_OUTPUT_DISP = %NEWFILE#;

   5577  3 000045   000003 235007                    LDA     3,DL
         3 000046   000000 755000 xsym               STA     KP_OUTPUT_DISP
         3 000047   000113 710000 3                  TRA     s:5600

       99     5578    4                    CASE(0);               /* TO                                 */

      100     5579    4                      KP_OUTPUT_DISP = %ERROR#;

   5579  3 000050   000001 235007                    LDA     1,DL
         3 000051   000000 755000 xsym               STA     KP_OUTPUT_DISP
         3 000052   000113 710000 3                  TRA     s:5600

      101     5580    4                    CASE(2);               /* INTO                               */

      102     5581    4                      KP_OUTPUT_DISP = %OLDFILE#;

   5581  3 000053   000002 235007                    LDA     2,DL
         3 000054   000000 755000 xsym               STA     KP_OUTPUT_DISP

      103     5582    4                    END;                   /* END CASE                           */

   5582  3 000055   000113 710000 3                  TRA     s:5600

      104     5583        /**/
      105     5584        /*  The FEP on whose behalf this boot disk is made. */
      106     5585        /**/
      107     5586    3               CASE(1);

      108     5587    3                 CALL KPU$FEP_AND_DRIVE(

   5587  3 000056   200004 634500                    EPPR4   I,,AUTO
         3 000057   200222 454500                    STP4    DISKDIR+66,,AUTO
         3 000060   200013 631500                    EPPR1   FEX_TO_BUILD,,AUTO
         3 000061   200221 451500                    STP1    DISKDIR+65,,AUTO
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:25   
         3 000062   200220 756100                    STQ     DISKDIR+64,,AUTO
         3 000063   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000064   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000065   000000 701000 xent               TSX1    KPU$FEP_AND_DRIVE
         3 000066   000525 702000 3                  TSX2    CANT_OPEN
         3 000067   000113 710000 3                  TRA     s:5600

      109     5588    3                    PART$ -> OUT$BLK,FEX_TO_BUILD,I) ALTRET(CANT_OPEN);
      110     5589        /**/
      111     5590        /* Process the output specification.  (The FEP we're writing on) */
      112     5591        /**/
      113     5592    3               CASE(3);

      114     5593    3                 CALL KPU$FEP_AND_DRIVE(

   5593  3 000070   200011 634500                    EPPR4   DEST_DRIVE,,AUTO
         3 000071   200222 454500                    STP4    DISKDIR+66,,AUTO
         3 000072   200010 631500                    EPPR1   DEST_FEP,,AUTO
         3 000073   200221 451500                    STP1    DISKDIR+65,,AUTO
         3 000074   200220 756100                    STQ     DISKDIR+64,,AUTO
         3 000075   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000076   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000077   000000 701000 xent               TSX1    KPU$FEP_AND_DRIVE
         3 000100   000525 702000 3                  TSX2    CANT_OPEN

      115     5594    3                  PART$ -> OUT$BLK,
      116     5595    3                  DEST_FEP,DEST_DRIVE) ALTRET(BAD_FEP_OR_DRIVE);
      117     5596    3                 CALL KPX$OPEN( DEST_FEP, DEST_DRIVE) ALTRET (CANT_OPEN);

   5596  3 000101   200011 630500                    EPPR0   DEST_DRIVE,,AUTO
         3 000102   200221 450500                    STP0    DISKDIR+65,,AUTO
         3 000103   200010 631500                    EPPR1   DEST_FEP,,AUTO
         3 000104   200220 451500                    STP1    DISKDIR+64,,AUTO
         3 000105   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000106   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000107   000000 701000 xent               TSX1    KPX$OPEN
         3 000110   000525 702000 3                  TSX2    CANT_OPEN
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:26   

      118     5597    3                 OUTPUT_OPEN = '1'B;

   5597  3 000111   400000 236003                    LDQ     -131072,DU
         3 000112   200012 756100                    STQ     OUTPUT_OPEN,,AUTO

      119     5598
      120     5599    3               END;                        /* END DO CASE on node type           */

      121     5600    2            END;                           /* END DO INDEX on node number        */

   5600  3 000113   200016 235100                    LDA     PART,,AUTO
         3 000114   000001 035007                    ADLA    1,DL
         3 000115   200016 755100                    STA     PART,,AUTO
         3 000116   200003 470500                    LDP0    @OUT$,,AUTO
         3 000117   000000 471500                    LDP1    0,,PR0
         3 000120   100001 236100                    LDQ     1,,PR1
         3 000121   000022 772000                    QRL     18
         3 000122   200016 116100                    CMPQ    PART,,AUTO
         3 000123   000125 600000 3                  TZE     s:5605
         3 000124   000017 603000 3                  TRC     s:5569

      122     5601        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:27   
      123     5602        /**/
      124     5603        /* Allocate a buffer and build boot image in it.  */
      125     5604        /**/
      126     5605    1         CALL KFF$FEBOOT (FEX_TO_BUILD,BUILD_BUFFER,BUILD_ERROR,BOOT_L66_WORDS)

   5605  3 000125   200015 633500                    EPPR3   BOOT_L66_WORDS,,AUTO
         3 000126   200223 453500                    STP3    DISKDIR+67,,AUTO
         3 000127   200014 631500                    EPPR1   BUILD_ERROR,,AUTO
         3 000130   200222 451500                    STP1    DISKDIR+66,,AUTO
         3 000131   000006 236000 4                  LDQ     6
         3 000132   200221 756100                    STQ     DISKDIR+65,,AUTO
         3 000133   200013 634500                    EPPR4   FEX_TO_BUILD,,AUTO
         3 000134   200220 454500                    STP4    DISKDIR+64,,AUTO
         3 000135   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000136   000022 631400 xsym               EPPR1   B_VECTNIL+18
         3 000137   000000 701000 xent               TSX1    KFF$FEBOOT
         3 000140   000517 702000 3                  TSX2    RIVER_CITY

      127     5606    1              ALTRET (RIVER_CITY);
      128     5607    1         NSECTORS = (BOOT_L66_WORDS * 4 +255) / 256;

   5607  3 000141   200015 236100                    LDQ     BOOT_L66_WORDS,,AUTO
         3 000142   000002 736000                    QLS     2
         3 000143   000377 036007                    ADLQ    255,DL
         3 000144   000010 772000                    QRL     8
         3 000145   200005 756100                    STQ     NSECTORS,,AUTO

      129     5608        /**/
      130     5609        /*  Touch up the boot image a little.                                         */
      131     5610        /*  Make GI_BOOT_BASE, UBIN (32), zero.                                       */
      132     5611        /**/
      133     5612    2         DO I=0 TO 3;

   5612  3 000146   200004 450100                    STZ     I,,AUTO

      134     5613    2            PINCRC(VBASE(BUILD_BUFFER),%GI_BOOTBASE_LOC*2 + I) -> UBIN$9 = 0;

PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:28   
   5613  3 000147   000001 470400 1                  LDP0    BUILD_BUFFER+1
         3 000150   200004 235100                    LDA     I,,AUTO
         3 000151   000105 101400                    MRL     fill='000'O
         3 000152   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         3 000153   000201 000001                    ADSC9   129,A,PR0                cn=0,n=1

      135     5614    2            END;

   5614  3 000154   200004 054100                    AOS     I,,AUTO
         3 000155   200004 235100                    LDA     I,,AUTO
         3 000156   000003 115007                    CMPA    3,DL
         3 000157   000147 604400 3                  TMOZ    s:5613

      136     5615        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:29   
      137     5616        /**/
      138     5617        /*  We have approved of all the thing user has typed.  Before plowing         */
      139     5618        /*  ahead with time-consuming stuff, let him know that we're working          */
      140     5619        /*  on what he wants.                                                         */
      141     5620        /**/
      142     5621    1         NSECTORS_BIG2 = NSECTORS - %KP_NSEC_BIG1#;

   5621  3 000160   200005 236100                    LDQ     NSECTORS,,AUTO
         3 000161   000100 136007                    SBLQ    64,DL
         3 000162   200006 756100                    STQ     NSECTORS_BIG2,,AUTO

      143     5622    1         CALL KPU$VSEC2DISK (I,PACK,I,%KP_VSEC_BIG2#+NSECTORS_BIG2,I);

   5622  3 000163   000113 036007                    ADLQ    75,DL
         3 000164   200220 756100                    STQ     DISKDIR+64,,AUTO
         3 000165   200004 630500                    EPPR0   I,,AUTO
         3 000166   200225 450500                    STP0    DISKDIR+69,,AUTO
         3 000167   200220 631500                    EPPR1   DISKDIR+64,,AUTO
         3 000170   200224 451500                    STP1    DISKDIR+68,,AUTO
         3 000171   200004 633500                    EPPR3   I,,AUTO
         3 000172   200223 453500                    STP3    DISKDIR+67,,AUTO
         3 000173   200007 634500                    EPPR4   PACK,,AUTO
         3 000174   200222 454500                    STP4    DISKDIR+66,,AUTO
         3 000175   200004 635500                    EPPR5   I,,AUTO
         3 000176   200221 455500                    STP5    DISKDIR+65,,AUTO
         3 000177   200221 630500                    EPPR0   DISKDIR+65,,AUTO
         3 000200   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000201   000000 701000 xent               TSX1    KPU$VSEC2DISK
         3 000202   000000 011000                    NOP     0

      144     5623    1         CALL BINCHAR (SUBSTR(KP_U1.TEXT,0,2), PACK);

   5623  3 000203   000000 301500                    BTD
         3 000204   200007 000004                    NDSC9   PACK,,AUTO               cn=0,s=lsgnf,sf=0,n=4
         3 000205   000000 230002 xsym               NDSC9   KP_U1                    cn=1,s=nosgn,sf=0,n=2

      145     5624    1         KP_U1.L = 2;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:30   

   5624  3 000206   002000 236003                    LDQ     1024,DU
         3 000207   000000 552040 xsym               STBQ    KP_U1,'40'O

      146     5625    1         CALL KPT$TERM_MSG( %T$COPYING );

   5625  3 000210   000010 630400 4                  EPPR0   8
         3 000211   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000212   000000 701000 xent               TSX1    KPT$TERM_MSG
         3 000213   000000 011000                    NOP     0

      147     5626        /**/
      148     5627        /* Place the first chunk of BIGFOOT on the diskette.                          */
      149     5628        /**/
      150     5629    1         CALL KPU$WRITE_BLOCK( DEST_FEP,

   5629  3 000214   000012 236000 4                  LDQ     10
         3 000215   200224 756100                    STQ     DISKDIR+68,,AUTO
         3 000216   000014 237000 4                  LDAQ    12
         3 000217   200222 757100                    STAQ    DISKDIR+66,,AUTO
         3 000220   200011 630500                    EPPR0   DEST_DRIVE,,AUTO
         3 000221   200221 450500                    STP0    DISKDIR+65,,AUTO
         3 000222   200010 631500                    EPPR1   DEST_FEP,,AUTO
         3 000223   200220 451500                    STP1    DISKDIR+64,,AUTO
         3 000224   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000225   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000226   000000 701000 xent               TSX1    KPU$WRITE_BLOCK
         3 000227   000525 702000 3                  TSX2    CANT_OPEN

      151     5630    1                               DEST_DRIVE,
      152     5631    1                               %KP_VSEC_BIG1#,
      153     5632    1                               VBASE(BUILD_BUFFER),
      154     5633    1                               %KP_NSEC_BIG1#)
      155     5634    1                               ALTRET( DISK_ALT );
      156     5635        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:31   
      157     5636        /**/
      158     5637        /* Now comes the reloader sector that shuffles everything down to */
      159     5638        /* the proper address */
      160     5639        /**/
      161     5640    1         CALL KPU$WRITE_BLOCK( DEST_FEP,

   5640  3 000230   000017 236000 4                  LDQ     15
         3 000231   200220 756100                    STQ     DISKDIR+64,,AUTO
         3 000232   000000 236000 4                  LDQ     0
         3 000233   200225 756100                    STQ     DISKDIR+69,,AUTO
         3 000234   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000235   200224 450500                    STP0    DISKDIR+68,,AUTO
         3 000236   000020 236000 4                  LDQ     16
         3 000237   200223 756100                    STQ     DISKDIR+67,,AUTO
         3 000240   200011 631500                    EPPR1   DEST_DRIVE,,AUTO
         3 000241   200222 451500                    STP1    DISKDIR+66,,AUTO
         3 000242   200010 633500                    EPPR3   DEST_FEP,,AUTO
         3 000243   200221 453500                    STP3    DISKDIR+65,,AUTO
         3 000244   200221 630500                    EPPR0   DISKDIR+65,,AUTO
         3 000245   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000246   000000 701000 xent               TSX1    KPU$WRITE_BLOCK
         3 000247   000525 702000 3                  TSX2    CANT_OPEN

      162     5641    1                               DEST_DRIVE,
      163     5642    1                               %KP_VSEC_RELOADER#,
      164     5643    1                               ADDR(RELOADER),
      165     5644    1                               %KP_NSEC_RELOADER#)
      166     5645    1                               ALTRET( DISK_ALT );
      167     5646        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:32   
      168     5647        /**/
      169     5648        /* Place the remainder of BIGFOOT on the diskette.                            */
      170     5649        /**/
      171     5650    1         CALL KPU$WRITE_BLOCK( DEST_FEP,

   5650  3 000250   000001 236000 1                  LDQ     BUILD_BUFFER+1
         3 000251   010000 036003                    ADLQ    4096,DU
         3 000252   200220 756100                    STQ     DISKDIR+64,,AUTO
         3 000253   200006 630500                    EPPR0   NSECTORS_BIG2,,AUTO
         3 000254   200225 450500                    STP0    DISKDIR+69,,AUTO
         3 000255   200220 631500                    EPPR1   DISKDIR+64,,AUTO
         3 000256   200224 451500                    STP1    DISKDIR+68,,AUTO
         3 000257   000022 236000 4                  LDQ     18
         3 000260   200223 756100                    STQ     DISKDIR+67,,AUTO
         3 000261   200011 633500                    EPPR3   DEST_DRIVE,,AUTO
         3 000262   200222 453500                    STP3    DISKDIR+66,,AUTO
         3 000263   200010 634500                    EPPR4   DEST_FEP,,AUTO
         3 000264   200221 454500                    STP4    DISKDIR+65,,AUTO
         3 000265   200221 630500                    EPPR0   DISKDIR+65,,AUTO
         3 000266   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000267   000000 701000 xent               TSX1    KPU$WRITE_BLOCK
         3 000270   000525 702000 3                  TSX2    CANT_OPEN

      172     5651    1                               DEST_DRIVE,
      173     5652    1                               %KP_VSEC_BIG2#,
      174     5653    1                               PINCRC(VBASE(BUILD_BUFFER),%KP_NSEC_BIG1#*256),
      175     5654    1                               NSECTORS_BIG2)
      176     5655    1                               ALTRET( DISK_ALT );
      177     5656        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:33   
      178     5657        /**/
      179     5658        /* Put the PRIMAL BOOT code on the disk where the L6 firmware can             */
      180     5659        /* find it.                                                                   */
      181     5660        /*                                                                            */
      182     5661        /* NOTE:  There is no need to modify PRIMAL BOOT since he always loads the    */
      183     5662        /* same way, no matter what's on the diskette.                                */
      184     5663        /**/
      185     5664    1         CALL KPU$WRITE_BLOCK( DEST_FEP,

   5664  3 000271   000023 236000 4                  LDQ     19
         3 000272   200220 756100                    STQ     DISKDIR+64,,AUTO
         3 000273   000000 236000 4                  LDQ     0
         3 000274   200225 756100                    STQ     DISKDIR+69,,AUTO
         3 000275   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000276   200224 450500                    STP0    DISKDIR+68,,AUTO
         3 000277   000024 236000 4                  LDQ     20
         3 000300   200223 756100                    STQ     DISKDIR+67,,AUTO
         3 000301   200011 631500                    EPPR1   DEST_DRIVE,,AUTO
         3 000302   200222 451500                    STP1    DISKDIR+66,,AUTO
         3 000303   200010 633500                    EPPR3   DEST_FEP,,AUTO
         3 000304   200221 453500                    STP3    DISKDIR+65,,AUTO
         3 000305   200221 630500                    EPPR0   DISKDIR+65,,AUTO
         3 000306   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000307   000000 701000 xent               TSX1    KPU$WRITE_BLOCK
         3 000310   000525 702000 3                  TSX2    CANT_OPEN

      186     5665    1                               DEST_DRIVE,
      187     5666    1                               %KP_VSEC_PRIMAL#,
      188     5667    1                               ADDR(PRIMAL_BOOT),
      189     5668    1                               %KP_NSEC_PRIMAL#)
      190     5669    1                               ALTRET( DISK_ALT );
      191     5670        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:34   
      192     5671        /**/
      193     5672        /*  Put the SECONDARY BOOT code where it can finish up where PRIMAL           */
      194     5673        /*  left off.                                                                 */
      195     5674        /**/
      196     5675    1         CALL KPU$WRITE_BLOCK( DEST_FEP,

   5675  3 000311   000025 236000 4                  LDQ     21
         3 000312   200220 756100                    STQ     DISKDIR+64,,AUTO
         3 000313   000000 236000 4                  LDQ     0
         3 000314   200225 756100                    STQ     DISKDIR+69,,AUTO
         3 000315   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000316   200224 450500                    STP0    DISKDIR+68,,AUTO
         3 000317   200223 756100                    STQ     DISKDIR+67,,AUTO
         3 000320   200011 631500                    EPPR1   DEST_DRIVE,,AUTO
         3 000321   200222 451500                    STP1    DISKDIR+66,,AUTO
         3 000322   200010 633500                    EPPR3   DEST_FEP,,AUTO
         3 000323   200221 453500                    STP3    DISKDIR+65,,AUTO
         3 000324   200221 630500                    EPPR0   DISKDIR+65,,AUTO
         3 000325   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000326   000000 701000 xent               TSX1    KPU$WRITE_BLOCK
         3 000327   000525 702000 3                  TSX2    CANT_OPEN

      197     5676    1                               DEST_DRIVE,
      198     5677    1                               %KP_VSEC_SECONDARY#,
      199     5678    1                               ADDR(SECONDARY_BOOT),
      200     5679    1                               %KP_NSEC_SECONDARY#)
      201     5680    1                               ALTRET( DISK_ALT );
      202     5681        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:35   
      203     5682        /**/
      204     5683        /*  Put the ID RECORD on the diskette for later observation.                  */
      205     5684        /**/
      206     5685    1         DISKID = '0'B;

   5685  3 000330   000100 100400                    MLR     fill='000'O
         3 000331   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         3 000332   200022 000370                    ADSC9   DISKID,,AUTO             cn=0,n=248

      207     5686    1         DISKID.VERITY = 'FUZZY-PIGS';

   5686  3 000333   040100 100400                    MLR     fill='040'O
         3 000334   000000 000012 2                  ADSC9   0                        cn=0,n=10
         3 000335   200022 000012                    ADSC9   DISKID,,AUTO             cn=0,n=10

      208     5687    1         DISKID.REVISION_LEVEL = %KP_REVISION_LEVEL#;

   5687  3 000336   002000 236003                    LDQ     1024,DU
         3 000337   200034 552140                    STBQ    DISKID+10,'40'O,AUTO

      209     5688    1         FPT_TIME.TIME_ = VECTOR(DISKID.BUILD_TIME);

   5688  3 000340   000026 235000 4                  LDA     22
         3 000341   200220 452500                    STP2    DISKDIR+64,,AUTO
         3 000342   200220 236100                    LDQ     DISKDIR+64,,AUTO
         3 000343   000027 036000 4                  ADLQ    23
         3 000344   000014 757000 1                  STAQ    FPT_TIME+4

      210     5689    1         FPT_TIME.DATE_ = VECTOR(DISKID.BUILD_DATE);

   5689  3 000345   000030 235000 4                  LDA     24
         3 000346   200220 452500                    STP2    DISKDIR+64,,AUTO
         3 000347   200220 236100                    LDQ     DISKDIR+64,,AUTO
         3 000350   000031 036000 4                  ADLQ    25
         3 000351   000012 757000 1                  STAQ    FPT_TIME+2

      211     5690    1         FPT_TIME.DAY_ = VECTOR(DISKID.BUILD_DAY);
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:36   

   5690  3 000352   577640 235007                    LDA     -65632,DL
         3 000353   200220 452500                    STP2    DISKDIR+64,,AUTO
         3 000354   200220 236100                    LDQ     DISKDIR+64,,AUTO
         3 000355   000032 036000 4                  ADLQ    26
         3 000356   000016 757000 1                  STAQ    FPT_TIME+6

      212     5691    1         CALL M$TIME (FPT_TIME) ALTRET(MONERR);

   5691  3 000357   000010 630400 1                  EPPR0   FPT_TIME
         3 000360   420004 713400                    CLIMB   alt,+8196
         3 000361   402000 401760                    pmme    nvectors=5
         3 000362   000513 702000 3                  TSX2    MONERR

      213     5692    1         FPT_NODEINFO.V.NODENUM# = FEX_TO_BUILD;

   5692  3 000363   200013 236100                    LDQ     FEX_TO_BUILD,,AUTO
         3 000364   000033 736000                    QLS     27
         3 000365   000006 552040 xsym               STBQ    FPT_NODEINFO+6,'40'O

      214     5693    1         FPT_NODEINFO.V.NODENAME# = ' ';

   5693  3 000366   000035 235000 xsym               LDA     B_VECTNIL+29
         3 000367   000035 236000 xsym               LDQ     B_VECTNIL+29
         3 000370   000004 757000 xsym               STAQ    FPT_NODEINFO+4

      215     5694    1         CALL M$NODEINFO (FPT_NODEINFO) ALTRET(MONERR);

   5694  3 000371   000000 630400 xsym               EPPR0   FPT_NODEINFO
         3 000372   560031 713400                    CLIMB   alt,+57369
         3 000373   400400 401760                    pmme    nvectors=2
         3 000374   000513 702000 3                  TSX2    MONERR

      216     5695    1         DISKID.DESTINATION_NODE = VLR_NODEINFO.NODENAME#;

   5695  3 000375   000000 237000 xsym               LDAQ    VLR_NODEINFO
         3 000376   200032 757100                    STAQ    DISKID+8,,AUTO
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:37   

      217     5696    1         DISKID.PATCH_WEEK = VLR_SITEINFO.PATCHWEEK#;

   5696  3 000377   040100 100400                    MLR     fill='040'O
         3 000400   000070 000004 xsym               ADSC9   VLR_SITEINFO+56          cn=0,n=4
         3 000401   200034 200004                    ADSC9   DISKID+10,,AUTO          cn=1,n=4

      218     5697    1         CALL CONCAT(DISKID.SYS_VERSION,

   5697  3 000402   000064 236000 xsym               LDQ     VLR_SITEINFO+52
         3 000403   000011 772000                    QRL     9
         3 000404   200035 552134                    STBQ    DISKID+11,'34'O,AUTO
         3 000405   000000 236000 xsym               LDQ     VLR_SITEINFO
         3 000406   200036 552170                    STBQ    DISKID+12,'70'O,AUTO

      219     5698    1                     SUBSTR(VLR_SITEINFO.VERSION#,0,3),
      220     5699    1                     VLR_SITEINFO.MINI_ID#);
      221     5700    1         IF VLR_SITEINFO.SITE_ID# = ' ' THEN

   5700  3 000407   040000 106400                    CMPC    fill='040'O
         3 000410   000066 000006 xsym               ADSC9   VLR_SITEINFO+54          cn=0,n=6
         3 000411   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         3 000412   000417 601000 3                  TNZ     s:5703

      222     5701    1            DISKID.SITE_ID = VLR_SITEINFO.SITE_NAME#.C;

   5701  3 000413   040100 100400                    MLR     fill='040'O
         3 000414   000001 200167 xsym               ADSC9   VLR_SITEINFO+1           cn=1,n=119
         3 000415   200036 600305                    ADSC9   DISKID+12,,AUTO          cn=3,n=197
         3 000416   000427 710000 3                  TRA     s:5706

      223     5702    1         ELSE
      224     5703    1            CALL CONCAT (DISKID.SITE_ID, VLR_SITEINFO.SITE_ID#,' ',

   5703  3 000417   040100 100400                    MLR     fill='040'O
         3 000420   000066 000006 xsym               ADSC9   VLR_SITEINFO+54          cn=0,n=6
         3 000421   200036 600006                    ADSC9   DISKID+12,,AUTO          cn=3,n=6
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:38   
         3 000422   000040 236003                    LDQ     32,DU
         3 000423   200040 552120                    STBQ    DISKID+14,'20'O,AUTO
         3 000424   040100 100400                    MLR     fill='040'O
         3 000425   000001 200167 xsym               ADSC9   VLR_SITEINFO+1           cn=1,n=119
         3 000426   200040 400276                    ADSC9   DISKID+14,,AUTO          cn=2,n=190

      225     5704    1              VLR_SITEINFO.SITE_NAME#.C);
      226     5705        /**/
      227     5706    1         CALL KPU$WRITE_BLOCK( DEST_FEP,

   5706  3 000427   200022 630500                    EPPR0   DISKID,,AUTO
         3 000430   200220 450500                    STP0    DISKDIR+64,,AUTO
         3 000431   000000 236000 4                  LDQ     0
         3 000432   200225 756100                    STQ     DISKDIR+69,,AUTO
         3 000433   200220 631500                    EPPR1   DISKDIR+64,,AUTO
         3 000434   200224 451500                    STP1    DISKDIR+68,,AUTO
         3 000435   000005 236000 4                  LDQ     5
         3 000436   200223 756100                    STQ     DISKDIR+67,,AUTO
         3 000437   200011 633500                    EPPR3   DEST_DRIVE,,AUTO
         3 000440   200222 453500                    STP3    DISKDIR+66,,AUTO
         3 000441   200010 634500                    EPPR4   DEST_FEP,,AUTO
         3 000442   200221 454500                    STP4    DISKDIR+65,,AUTO
         3 000443   200221 630500                    EPPR0   DISKDIR+65,,AUTO
         3 000444   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000445   000000 701000 xent               TSX1    KPU$WRITE_BLOCK
         3 000446   000525 702000 3                  TSX2    CANT_OPEN

      228     5707    1                               DEST_DRIVE,
      229     5708    1                               %KP_VSEC_DISKID#,
      230     5709    1                               ADDR(DISKID),
      231     5710    1                               %KP_NSEC_DISKID#)
      232     5711    1                               ALTRET( DISK_ALT );
      233     5712        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:39   
      234     5713        /**/
      235     5714        /*  Put the DISK DIRECTORY on the diskette for later observation.             */
      236     5715        /**/
      237     5716    1         DISKDIR = '0'B;

   5716  3 000447   000100 100400                    MLR     fill='000'O
         3 000450   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         3 000451   200120 000400                    ADSC9   DISKDIR,,AUTO            cn=0,n=256

      238     5717    1         PACK = %KP_VSEC_BIG2# + NSECTORS_BIG2;

   5717  3 000452   200006 235100                    LDA     NSECTORS_BIG2,,AUTO
         3 000453   000113 035007                    ADLA    75,DL
         3 000454   200007 755100                    STA     PACK,,AUTO

      239     5718    1         DISKDIR.FREE_VSEC.HOB = PACK_.HOB;

   5718  3 000455   200007 236100                    LDQ     PACK,,AUTO
         3 000456   177400 376007                    ANQ     65280,DL
         3 000457   000001 736000                    QLS     1
         3 000460   200120 552110                    STBQ    DISKDIR,'10'O,AUTO

      240     5719    1         DISKDIR.FREE_VSEC.LOB = PACK_.LOB;

   5719  3 000461   200007 236100                    LDQ     PACK,,AUTO
         3 000462   000377 376007                    ANQ     255,DL
         3 000463   200120 552104                    STBQ    DISKDIR,'04'O,AUTO

      241     5720    1         DISKDIR.DUMP_VSEC = '0'B;         /* NO DUMP YET                        */

   5720  3 000464   000000 220003                    LDX0    0,DU
         3 000465   200120 740100                    STX0    DISKDIR,,AUTO

      242     5721        /**/
      243     5722    1         CALL KPU$WRITE_BLOCK( DEST_FEP,

   5722  3 000466   200120 630500                    EPPR0   DISKDIR,,AUTO
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:40   
         3 000467   200220 450500                    STP0    DISKDIR+64,,AUTO
         3 000470   000000 236000 4                  LDQ     0
         3 000471   200225 756100                    STQ     DISKDIR+69,,AUTO
         3 000472   200220 631500                    EPPR1   DISKDIR+64,,AUTO
         3 000473   200224 451500                    STP1    DISKDIR+68,,AUTO
         3 000474   000033 236000 4                  LDQ     27
         3 000475   200223 756100                    STQ     DISKDIR+67,,AUTO
         3 000476   200011 633500                    EPPR3   DEST_DRIVE,,AUTO
         3 000477   200222 453500                    STP3    DISKDIR+66,,AUTO
         3 000500   200010 634500                    EPPR4   DEST_FEP,,AUTO
         3 000501   200221 454500                    STP4    DISKDIR+65,,AUTO
         3 000502   200221 630500                    EPPR0   DISKDIR+65,,AUTO
         3 000503   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000504   000000 701000 xent               TSX1    KPU$WRITE_BLOCK
         3 000505   000525 702000 3                  TSX2    CANT_OPEN

      244     5723    1                               DEST_DRIVE,
      245     5724    1                               %KP_VSEC_DISKDIR#,
      246     5725    1                               ADDR(DISKDIR),
      247     5726    1                               %KP_NSEC_DISKDIR#)
      248     5727    1                               ALTRET( DISK_ALT );
      249     5728        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:41   
      250     5729        /**/
      251     5730    1         CALL KPT$TERM_MSG( %T$COPYDUN );

   5730  3 000506   000035 630400 4                  EPPR0   29
         3 000507   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000510   000000 701000 xent               TSX1    KPT$TERM_MSG
         3 000511   000000 011000                    NOP     0

      252     5731    1         GOTO QUITIT;

   5731  3 000512   000525 710000 3                  TRA     CANT_OPEN

   5720  3 000513                       MONERR       null
      253     5732        %EJECT;
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:42   
      254     5733        /**/
      255     5734        /* Now, clean up after ourselves! */
      256     5735        /**/
      257     5736    1   MONERR: ;
      258     5737    1         BUILD_ERROR = B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR;

   5737  3 000513   000000 470400 xsym               LDP0    B$TCB$
         3 000514   000000 471500                    LDP1    0,,PR0
         3 000515   100102 236100                    LDQ     66,,PR1
         3 000516   200014 756100                    STQ     BUILD_ERROR,,AUTO

   5737  3 000517                       RIVER_CITY   null
      259     5738
      260     5739    1   RIVER_CITY: ;                           /* TROUBLE!  Code stashed already     */
      261     5740    1         CALL KPE$ERRMSG (BUILD_ERROR);

   5740  3 000517   200014 630500                    EPPR0   BUILD_ERROR,,AUTO
         3 000520   200220 450500                    STP0    DISKDIR+64,,AUTO
         3 000521   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000522   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000523   000000 701000 xent               TSX1    KPE$ERRMSG
         3 000524   000000 011000                    NOP     0

   5737  3 000525                       CANT_OPEN    null
   5737  3 000525                       BAD_FEP_OR_* null
   5737  3 000525                       DISK_ALT     null
   5737  3 000525                       QUITIT       null
      262     5741                                                /* Various errors already printed     */
      263     5742    1   CANT_OPEN: ;
      264     5743    1   BAD_FEP_OR_DRIVE: ;
      265     5744    1   DISK_ALT: ;                             /* Error on disk - already printed    */
      266     5745        /**/
      267     5746    1   QUITIT: ;                               /* Universal bailout point            */
      268     5747    1         IF BUILD_BUFFER ~= VECTOR(NIL)

   5747  3 000525   000000 237000 1                  LDAQ    BUILD_BUFFER
         3 000526   000002 117000 4                  CMPAQ   2
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:43   
         3 000527   000542 600000 3                  TZE     BUFFER_GONE

      269     5748    1          THEN                             /* A buffer has been allocated        */
      270     5749    2            DO;

      271     5750    2              FPT_FDS.V.SEGSIZE# = (VBOUND(BUILD_BUFFER)+1) / 4;

   5750  3 000530   000000 236000 1                  LDQ     BUILD_BUFFER
         3 000531   000020 772000                    QRL     16
         3 000532   000001 036007                    ADLQ    1,DL
         3 000533   000002 772000                    QRL     2
         3 000534   000000 620006                    EAX0    0,QL
         3 000535   000006 440000 1                  SXL0    FPT_FDS+4

      272     5751    2              CALL M$FDS (FPT_FDS) ALTRET(BUFFER_GONE);

   5751  3 000536   000002 630400 1                  EPPR0   FPT_FDS
         3 000537   430002 713400                    CLIMB   alt,fds
         3 000540   400400 401760                    pmme    nvectors=2
         3 000541   000542 702000 3                  TSX2    BUFFER_GONE

   5750  3 000542                       BUFFER_GONE  null
      273     5752    2   BUFFER_GONE: ;
      274     5753    2              END;

      275     5754    1         IF OUTPUT_OPEN

   5754  3 000542   200012 234100                    SZN     OUTPUT_OPEN,,AUTO
         3 000543   000554 605000 3                  TPL     OUT_CLOSED

      276     5755    1          THEN
      277     5756    1              CALL KPX$CLOSE( DEST_FEP,DEST_DRIVE) ALTRET(OUT_CLOSED);

   5756  3 000544   200011 630500                    EPPR0   DEST_DRIVE,,AUTO
         3 000545   200221 450500                    STP0    DISKDIR+65,,AUTO
         3 000546   200010 631500                    EPPR1   DEST_FEP,,AUTO
         3 000547   200220 451500                    STP1    DISKDIR+64,,AUTO
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:44   
         3 000550   200220 630500                    EPPR0   DISKDIR+64,,AUTO
         3 000551   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000552   000000 701000 xent               TSX1    KPX$CLOSE
         3 000553   000554 702000 3                  TSX2    OUT_CLOSED

   5754  3 000554                       OUT_CLOSED   null
      278     5757    1   OUT_CLOSED: ;
      279     5758        /**/
      280     5759    1         RETURN;

   5759  3 000554   000000 702200 xent               TSX2  ! X66_ARET
      281     5760        /**/
      282     5761    1         END KPB$BUILD;

PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:45   
--  Include file information  --

   GI_BOOT_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KP_MSG.:E05TOU  is referenced.
   XU_SUBS_C.:E05TOU  is referenced.
   XU_FORMAT_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   KP_MACRO_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   KP_PERR_C.:E05TOU  is referenced.
   KP_SUBS.:E05TOU  is referenced.
   KP_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KPB$BUILD.
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:46   

 **** Variables and constants ****

  ****  Section 001  Data  KPB$BUILD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d VECT        r     1 BUILD_BUFFER               2-0-0/d STRC(216)   r     1 FPT_FDS
    10-0-0/d STRC(432)   r     1 FPT_TIME

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @OUT$                     15-0-0/w UBIN        r     1 BOOT_L66_WORDS
    14-0-0/w STRC        r     1 BUILD_ERROR               11-0-0/w UBIN        r     1 DEST_DRIVE
    10-0-0/w UBIN        r     1 DEST_FEP                 120-0-0/c STRC(2304)  r     1 DISKDIR
    22-0-0/c STRC(2232)  r     1 DISKID                    13-0-0/w SBIN        r     1 FEX_TO_BUILD
     4-0-0/w SBIN        r     1 I                          5-0-0/w SBIN        r     1 NSECTORS
     6-0-0/w SBIN        r     1 NSECTORS_BIG2             *0-0-0/w PTR         r     1 OUT$
    12-0-0/b BIT         r     1 OUTPUT_OPEN                7-0-0/w SBIN        r     1 PACK
     7-0-0/w STRC        r     1 PACK_                     16-0-0/w UBIN        r     1 PART
    17-0-0/w PTR         r     1 PART$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/d STRC(288)   r     1 FPT_NODEINFO
     0-0-0/w STRC(468)   r     1 IN_OPTS                    0-0-0/w SBIN        r     1 KP_OUTPUT_DISP
     0-0-0/c STRC(288)   r     1 KP_U1                      0-0-0/b BIT         r     1 PRIMAL_BOOT
     0-0-0/b BIT         r     1 RELOADER                   0-0-0/b BIT         r     1 SECONDARY_BOOT
     0-0-0/d STRC(216)   r     1 VLR_NODEINFO               0-0-0/d STRC(2232)  r     1 VLR_SITEINFO

  ****  BASED and DCB variables  ****
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:47   

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/w STRC(144)   r     1 OUT$BLK                    0-0-0/w ASTR(153)   r     1 OUT$SYM
     0-0-0/c UBIN(9)     r     1 UBIN$9


   Procedure KPB$BUILD requires 365 words for executable code.
   Procedure KPB$BUILD requires 150 words of local(AUTO) storage.

    No errors detected in file KPB$BUILD.:E05TSI    .
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:48   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:49   
          MINI XREF LISTING

B$ALT.CODE
      5329**DCL      5329--REDEF    5330--REDEF    5330--REDEF
B$ALT.ERR
      5330**DCL      5737>>ASSIGN
B$ALT.ERR.ERR#
      5331**DCL      5331--REDEF
B$ALT.EVID
      5330**DCL      5330--REDEF    5330--REDEF
B$TCB.ALT$
      5325**DCL      5737>>ASSIGN
B$TCB$
      5553**DCL      5737>>ASSIGN
BAD_FEP_OR_DRIVE
      5737**LABEL    5593--CALLALT
BOOT_L66_WORDS
      5480**DCL      5605<>CALL     5607>>ASSIGN
BUFFER_GONE
      5750**LABEL    5751--CALLALT
BUILD_BUFFER
      5510**DCL      5524--DCLINIT  5563<<ASSIGN   5605<>CALL     5613>>ASSIGN   5629<>CALL     5650>>CALL
      5747>>IF       5750>>ASSIGN
BUILD_ERROR
      5447**DCL      5605<>CALL     5737<<ASSIGN   5740<>CALL
CANT_OPEN
      5737**LABEL    5558--CALLALT  5587--CALLALT  5596--CALLALT
DEST_DRIVE
      5432**DCL      5593<>CALL     5596<>CALL     5629<>CALL     5640<>CALL     5650<>CALL     5664<>CALL
      5675<>CALL     5706<>CALL     5722<>CALL     5756<>CALL
DEST_FEP
      5431**DCL      5593<>CALL     5596<>CALL     5629<>CALL     5640<>CALL     5650<>CALL     5664<>CALL
      5675<>CALL     5706<>CALL     5722<>CALL     5756<>CALL
DISKDIR
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:50   
      5498**DCL      5716<<ASSIGN   5722--CALL
DISKDIR.DUMP_VSEC
      5499**DCL      5720<<ASSIGN
DISKDIR.FREE_VSEC.HOB
      5503**DCL      5718<<ASSIGN
DISKDIR.FREE_VSEC.LOB
      5504**DCL      5719<<ASSIGN
DISKID
      5486**DCL      5685<<ASSIGN   5706--CALL
DISKID.BUILD_DATE
      5489**DCL      5689--ASSIGN
DISKID.BUILD_DAY
      5490**DCL      5690--ASSIGN
DISKID.BUILD_TIME
      5488**DCL      5688--ASSIGN
DISKID.DESTINATION_NODE
      5491**DCL      5695<<ASSIGN
DISKID.PATCH_WEEK
      5493**DCL      5696<<ASSIGN
DISKID.REVISION_LEVEL
      5492**DCL      5687<<ASSIGN
DISKID.SITE_ID
      5495**DCL      5701<<ASSIGN   5703<<CALLBLT
DISKID.SYS_VERSION
      5494**DCL      5697<<CALLBLT
DISKID.VERITY
      5487**DCL      5686<<ASSIGN
DISK_ALT
      5737**LABEL    5629--CALLALT  5640--CALLALT  5650--CALLALT  5664--CALLALT  5675--CALLALT  5706--CALLALT
      5722--CALLALT
FEX_TO_BUILD
      5434**DCL      5587<>CALL     5605<>CALL     5692>>ASSIGN
FPT_FDS
      5524**DCL      5751<>CALL
FPT_FDS.V
      5524**DCL      5524--DCLINIT
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:51   
FPT_FDS.V.SEGSIZE#
      5526**DCL      5750<<ASSIGN
FPT_NODEINFO
      4187**DCL      5694<>CALL
FPT_NODEINFO.V.NODENAME#
      4187**DCL      5693<<ASSIGN
FPT_NODEINFO.V.NODENUM#
      4188**DCL      5692<<ASSIGN
FPT_TIME
      5542**DCL      5691<>CALL
FPT_TIME.DATE_
      5542**DCL      5689<<ASSIGN
FPT_TIME.DAY_
      5545**DCL      5690<<ASSIGN
FPT_TIME.TIME_
      5544**DCL      5688<<ASSIGN
FPT_TIME.V
      5546**DCL      5542--DCLINIT
I
      5423**DCL      5587<>CALL     5612<<DOINDEX  5613>>ASSIGN   5622<>CALL     5622<>CALL     5622<>CALL
IN_OPTS
      4125**DCL      5564<>CALL
KFF$FEBOOT
      5320**DCL-ENT  5605--CALL
KPD$DISK_TYPE
      5231**DCL-ENT  5564--CALL
KPE$ERRMSG
      5299**DCL-ENT  5740--CALL
KPT$TERM_MSG
      5261**DCL-ENT  5625--CALL     5730--CALL
KPU$FEP_AND_DRIVE
      5267**DCL-ENT  5587--CALL     5593--CALL
KPU$SECURITY
      5317**DCL-ENT  5558--CALL
KPU$VSEC2DISK
      5307**DCL-ENT  5622--CALL
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:52   
KPU$WRITE_BLOCK
      5303**DCL-ENT  5629--CALL     5640--CALL     5650--CALL     5664--CALL     5675--CALL     5706--CALL
      5722--CALL
KPX$CLOSE
      5283**DCL-ENT  5756--CALL
KPX$OPEN
      5289**DCL-ENT  5596--CALL
KP_EXIT.V.STEPCC#
      4041**DCL      4041--REDEF
KP_INBUF
      3963**DCL      3963--REDEF
KP_OUTPUT_DISP
      3974**DCL      5577<<ASSIGN   5579<<ASSIGN   5581<<ASSIGN
KP_RU_KEY
      3971**DCL      3972--REDEF
KP_RU_KEY.NODE
      3971**DCL      3971--REDEF
KP_RU_KEY.PAGE
      3972**DCL      3972--REDEF
KP_RU_OUTBUF
      3965**DCL      3965--REDEF
KP_U1.L
      3970**DCL      5624<<ASSIGN
KP_U1.TEXT
      3970**DCL      5623<<CALLBLT
M$FDS
      3764**DCL-ENT  5751--CALL
M$NODEINFO
      3761**DCL-ENT  5694--CALL
M$TIME
      3796**DCL-ENT  5691--CALL
MONERR
      5720**LABEL    5691--CALLALT  5694--CALLALT
NSECTORS
      5424**DCL      5607<<ASSIGN   5621>>ASSIGN
NSECTORS_BIG2
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:53   
      5425**DCL      5621<<ASSIGN   5622>>CALL     5650<>CALL     5717>>ASSIGN
OUT$
      5209**DCL         8--PROC     5568>>DOINDEX  5569>>ASSIGN
OUT$BLK
      5342**DCL      5587<>CALL     5593<>CALL
OUT$BLK.CODE
      5350**DCL      5570>>DOCASE   5575>>DOCASE
OUT$BLK.NSUBLKS
      5354**DCL      5568>>DOINDEX
OUT$BLK.SUBLK$
      5375**DCL      5569>>ASSIGN   5575>>DOCASE
OUT$SYM.COUNT
      5411**DCL      5414--IMP-SIZ
OUTPUT_OPEN
      5433**DCL      5562<<ASSIGN   5597<<ASSIGN   5754>>IF
OUT_CLOSED
      5754**LABEL    5756--CALLALT
PACK
      5426**DCL      5427--REDEF    5622<>CALL     5623>>CALLBLT  5717<<ASSIGN
PACK_.HOB
      5429**DCL      5718>>ASSIGN
PACK_.LOB
      5430**DCL      5719>>ASSIGN
PART
      5481**DCL      5568<<DOINDEX  5569>>ASSIGN
PART$
      5482**DCL      5569<<ASSIGN   5570>>DOCASE   5575>>DOCASE   5587>>CALL     5593>>CALL
PRIMAL_BOOT
      4177**DCL      5664--CALL
QUITIT
      5737**LABEL    5731--GOTO
RELOADER
      4177**DCL      5640--CALL
RIVER_CITY
      5737**LABEL    5605--CALLALT
SECONDARY_BOOT
PL6.E3A0      #001=KPB$BUILD File=KPB$BUILD.:E05TSI                              WED 07/30/97 01:17 Page:54   
      4177**DCL      5675--CALL
UBIN$9
      5419**DCL      5613<<ASSIGN
VLR_NODEINFO.NODENAME#
      4199**DCL      5695>>ASSIGN
VLR_SITEINFO.MINI_ID#
      4344**DCL      5697>>CALLBLT
VLR_SITEINFO.PATCHWEEK#
      4349**DCL      5696>>ASSIGN
VLR_SITEINFO.SITE_ID#
      4348**DCL      5700>>IF       5703>>CALLBLT
VLR_SITEINFO.SITE_NAME#.C
      4345**DCL      5701>>ASSIGN   5703>>CALLBLT
VLR_SITEINFO.VERSION#
      4347**DCL      5697>>CALLBLT
