VERSION E05

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:1    
        1        1        /*M*  IRF$CLSF - Close DCBs during hard system crash */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8        /**/
        9        9        /**/
       10       10        IRF$CLSF: PROC ALTRET;
       11       11        /* LOCAL STORAGE */
       12       12    1   DCL DA UBIN;
       13       13    1   DCL I UBIN;
       14       14    1   DCL J UBIN;
       15       15    1   DCL SJ REDEF J SBIN;
       16       16    1   DCL NUMDCBS UBIN;
       17       17    1   DCL B$JIT$ PTR;
       18       18    1   DCL DCB$ PTR;
       19       19    1   DCL 1 DCBR REDEF DCB$,
       20       20    1         2 * BIT(3),
       21       21    1         2 ADR(0:4) UBIN(3) UNAL,
       22       22    1         2 * BIT(18);
       23       23    1   DCL DCBPTR$ PTR;
       24       24    1   DCL CFU$ PTR;
       25       25    1   DCL 1 CFU REDEF CFU$,
       26       26    1         2 * BIT(3),
       27       27    1         2 ADR(0:4) UBIN(3) UNAL,
       28       28    1         2 * BIT(18);
       29       29    1   DCL DSB$ PTR;
       30       30    1   DCL 1 CTX,
       31       31    1         2 DISP UBIN(24) UNAL,
       32       32    1         2 SID UBIN(12) UNAL;
       33       33    1   DCL CTX$ REDEF CTX PTR;
       34       34    1   DCL CACHE$ PTR;
       35       35    1   DCL SETX UBIN;
       36       36    1   DCL DCTX UBIN;
       37       37    1   DCL CFUX UBIN;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:2    
       38       38    1   DCL ACCTX UBIN;
       39       39    1   DCL ACCT$ PTR;
       40       40    1   DCL NAME$ PTR;
       41       41    1   DCL NAMEX UBIN;
       42       42    1   DCL SN CHAR(6);
       43       43    1   DCL ACCT CHAR(8);
       44       44    1   DCL ASN UBIN;
       45       45    1   DCL ERRCODE UBIN;
       46       46    1   DCL OP UBIN;
       47       47    1   DCL PHASE UBIN;
       48       48    1   DCL REMUNWIND REMEMBER DALIGNED;
       49       49    1   DCL DUMPFLG UBIN;
       50       50    1   DCL FIT$ PTR;
       51       51    1   DCL ALTKEY$ PTR;
       52       52    1   DCL COD$ PTR;
       53       53    1   DCL SYSSETX UBIN;
       54       54    1   DCL MISC1 UBIN;
       55       55    1   DCL MSC1(0:11) REDEF MISC1 UBIN(3) UNAL;
       56       56    1   DCL MISC1B REDEF MISC1 BIT(36);
       57       57    1   DCL MISC1$ REDEF MISC1 PTR;
       58       58    1   DCL MISC2 UBIN;
       59       59    1   DCL MSC2(0:11) REDEF MISC2 UBIN(3) UNAL;
       60       60    1   DCL MISC2$ REDEF MISC2 PTR;
       61       61    1   DCL OLDCTX$ PTR;
       62       62    1   DCL N SBIN;
       63       63    1   DCL PGTBL (0:299) BIT(1) UNAL;
       64       64        /* INCLUDE FILES */
       65       65    1   DCL DCT$ PTR;
       66       66    1   DCL DVT$ PTR;
       67       67    1   DCL SQH$ PTR;
       68       68    1   DCL DQH$ PTR;
       69       69    1   DCL L$N$DCT$$ PTR;
       70       70    1   DCL MIR_DCT$ PTR;
       71       71    1   DCL RV_MIRDCTX UBIN STATIC INIT(0);
       72       72    1   DCL 1 MIR_IOADR REDEF RV_MIRDCTX,
       73       73    1         2 CHAN UBIN(9) UNAL,
       74       74    1         2 DEV UBIN(6) UNAL,
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:3    
       75       75    1         2 IOM UBIN(2) UNAL,
       76       76    1         2 * UBIN(19) UNAL;
       77       77    1   DCL   MIR_FLAG BIT(1) STATIC INIT('0'B);
       78       78    1   DCL   MIR_ERR BIT(1) ALIGNED AUTO ;
       79       79    1   DCL   MIR_DCTX UBIN ALIGNED AUTO ;
       80       80        %INCLUDE B$JIT;
       81      683        %INCLUDE B$MAP;
       82      782        %MACRO B$ROSEG(BASED=BASED);
       83      783        %INCLUDE B$ROSEG;
       84      846        %MEND;
       85      847        %MACRO F$DCB(BASED=BASED);
       86      848        %INCLUDE F$DCB;
       87      897        %MEND;
       88      898        %INCLUDE B_MACROS_C;
       89     1009        %INCLUDE B_SEGIDS_C;
       90     1548        %INCLUDE CP_6_SUBS;
       91     2088        %INCLUDE FM$MACROS;
       92     2463        %INCLUDE FM_CACHE_C;
       93     2529        %INCLUDE FM_FIELD_C;
       94     2570        %INCLUDE FS$FIT;
       95     2613        %INCLUDE FT$LBLS;
       96     2881        %INCLUDE FT_SUBS;
       97     2961        %INCLUDE F_CP6;
       98     3986        %INCLUDE KC$CP6V_C;
       99     4106        %INCLUDE KC_CP6;
      100     4666        %INCLUDE KC$CGBLK;
      101     4714        %INCLUDE KI_CP6;
      102     5810        %INCLUDE KQ_MAC_C;
      103     8360        %INCLUDE KQM_MAC_C;
      104     8733        %INCLUDE KQ_SUBS_C;
      105     9033        %INCLUDE M_INFO_C;
      106     9173        %INCLUDE NI$TABLES;
      107     9389        %INCLUDE NI_DATA_C;
      108     9502        /* This is to take the "READONLY" off of the DCLs in IRF_DATA_R.
      109     9503           The reason this is done is because AARDVARKs "STATIC" data
      110     9504           has to reside in the PROCEDURE because of the way PO tapes
      111     9505           are created by DEV.
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:4    
      112     9506        */
      113     9507        %SUB READONLY = " ";
      114     9508        %INCLUDE IRF_DATA_R;
      115     9524        %INCLUDE IR_DATA_M;
      116     9688        %INCLUDE UE_CP6;
      117    10379        /* EXTERNAL DATA */
      118    10380    1   DCL POBUF UBIN SYMREF;
      119    10381    1   DCL R$CFU$ PTR SYMREF;
      120    10382    1   DCL F$CFU$ REDEF R$CFU$ PTR;
      121    10383    1   DCL FMC_CACHE$ PTR SYMREF;
      122    10384    1   DCL FM_SYSSETX UBIN SYMREF;
      123    10385    1   DCL KQ_MMSD$ PTR SYMREF;
      124    10386    1   DCL R$BUFF$ PTR SYMREF;
      125    10387    1   DCL R$ROSEG$ PTR SYMREF;
      126    10388    1   DCL B$ROSEG$ REDEF R$ROSEG$ PTR;
      127    10389    1   DCL I$RV1$ PTR SYMREF;
      128    10390    1   DCL I$REAL$ PTR SYMREF;
      129    10391    1   DCL I$MONIS$ PTR SYMREF;
      130    10392    1   DCL I$JITU$ PTR SYMREF;
      131    10393    1   DCL R$CGPT$ PTR SYMREF;
      132    10394    1   DCL B$CGPT$ REDEF R$CGPT$ PTR;
      133    10395    1   DCL R$CGCTXT$ PTR SYMREF;
      134    10396    1   DCL R$DVT$ PTR SYMREF;
      135    10397    1   DCL RV_UNWIND1 REMEMBER DALIGNED SYMREF;
      136    10398    1   DCL RV_NXTGRAN UBIN SYMREF;
      137    10399    1   DCL RV_DCTX UBIN SYMREF;
      138    10400    1   DCL 1 IOADR REDEF RV_DCTX,
      139    10401    1         2 CHAN UBIN(9) UNAL,
      140    10402    1         2 DEV UBIN(6) UNAL,
      141    10403    1         2 IOM UBIN(2) UNAL,
      142    10404    1         2 * UBIN(19) UNAL;
      143    10405    1   DCL RV_WDGRAN UBIN SYMREF;
      144    10406    1   DCL RV_NSPG UBIN SYMREF;
      145    10407    1   DCL NI$DVT$ PTR SYMREF;
      146    10408    1   DCL N$DCT$$ PTR SYMREF;
      147    10409    1   DCL 1 MEMDESC SYMREF,
      148    10410    1         2 * UBIN,
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:5    
      149    10411    1         2 BADDR UBIN;
      150    10412    1   DCL I$MEM$ PTR SYMREF;
      151    10413    1   DCL RV_CUN UBIN SYMREF;
      152    10414    1   DCL 1 MSG_IOERR SYMREF,
      153    10415    1         2 NAME CHAR(4),
      154    10416    1         2 TYPE CHAR(12),
      155    10417    1         2 MSG CHAR(28);
      156    10418    1   DCL 1 MSG_PART SYMREF,
      157    10419    1         2 NAME CHAR(4),
      158    10420    1         2 MSG CHAR(24);
      159    10421        %RV_BUFF (STCLASS=SYMREF);
      160    10457        /* LOCAL CONSTANT DATA */
      161    10458    1   DCL FM_FRZERO CONSTANT UBIN INIT(262144);
      162    10459    1   DCL FM_FRMAX  CONSTANT UBIN INIT(67141631);
      163    10460    1   DCL FM_SRZERO CONSTANT UBIN INIT(67174400);
      164    10461    1   DCL FM_SRMAX  CONSTANT UBIN INIT(134217727);
      165    10462    1   DCL FM_GPSDA CONSTANT UBIN INIT(67174401);
      166    10463    1   DCL FM_GPSTAMP BIT(36)INIT('525252525001'O)CONSTANT;
      167    10464    1   DCL POBUF$ PTR CONSTANT INIT(ADDR(POBUF));
      168    10465    1   DCL RVF_DEBUG CONSTANT SYMDEF UBIN INIT(0);
      169    10466    1   DCL RVF_PATCH(0:99) UBIN CONSTANT SYMDEF INIT(0*0);
      170    10467        %FT_LBL1(NAME=EOF1LABEL,STCLASS=CONSTANT,LABEL_ID='EOF',LABEL_NUM='1');
      171    10502    1   DCL ANSPAD CHAR(18) CONSTANT INIT('^^^^^^^^^^^^^^^^^^');
      172    10503    1   DCL ZEROBITS(0:4) UBIN CONSTANT INIT(0,0,0,0,0);
      173    10504    1   DCL NULPAD REDEF ZEROBITS CHAR(20);
      174    10505        /* EXTERNAL ROUTINES */
      175    10506    1   DCL IRR$RPAGE ENTRY ALTRET;
      176    10507    1   DCL IRR$TYPE6 ENTRY(2);
      177    10508    1   DCL IRR$WPOBUFF ENTRY ALTRET;
      178    10509    1   DCL IRR$WPAGE ENTRY ALTRET;
      179    10510    1   DCL IRR$WRASC ENTRY(1) ALTRET;
      180    10511    1   DCL IRR$WRBIN ENTRY(1) ALTRET;
      181    10512    1   DCL IRR$SPRECB ENTRY ALTRET;
      182    10513        /* BASED STRUCTURES */
      183    10514        %F$DCB (BASED="BASED(DCB$)");
      184    10564        %B$EXCFR;
      185    10582        %B$ROSEG (BASED="BASED(R$ROSEG$)");
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:6    
      186    10642        %FM$CFU (BASED="BASED(CFU$)");
      187    10648        %FM$CFUF (BASED="BASED(CFU$)");
      188    10651        %FM$CFUJ (BASED="BASED(CFU$)");
      189    10656        %FM$CFUR (BASED="BASED(CFU$)");
      190    10659        %FM$CFUX;
      191    10664        %FM$SET (BASED="BASED(F$CFU$)");
      192    10669        %FM$CFUN (BASED="BASED(NAME$)");
      193    10672        %FM$CFUA (BASED="BASED(ACCT$)");
      194    10678        %FM$GRAN (BASED="BASED(POBUF$)");
      195    10682        %FMC$CACHE(STCLASS="BASED(CACHE$)");
      196    10705        %FM$FIT  (BASED="BASED(FIT$)");
      197    10708        %CODE01  (BASED="BASED(COD$)");
      198    10712        %CODE02  (BASED="BASED(COD$)");
      199    10716        %CODE03  (BASED="BASED(COD$)");
      200    10723        %CODE04  (BASED="BASED(COD$)");
      201    10731        %FITALTKEYS(FITALTKEYS=ALTKEYS, BASED="BASED(ALTKEY$)");
      202    10737        %FS$DEST (STCLASS="BASED(COD$)");
      203    10745        %CODE14  (BASED="BASED(COD$)");
      204    10755        %CODE16  (BASED="BASED(COD$)");
      205    10763        %CODE20(BASED="BASED(COD$)");
      206    10768        %FMG$IRKEYS(FPTN=IRKEYS, STCLASS="BASED(ALTKEY$)");
      207    10775        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CTX$)");
      208    11514        %KQ_DSB (FPTN=KQ$DSB,STCLASS="BASED(DSB$)");
      209    11557        %KQ_MMSD (FPTN=KQ$MMSD,STCLASS="BASED(KQ_MMSD$)");
      210    11594    1   DCL PTR$(0:0) PTR BASED ALIGNED;
      211    11595    1   DCL PG(0:1023) UBIN BASED ALIGNED;
      212    11596    1   DCL 1 RELBUF BASED(POBUF$) ALIGNED,
      213    11597    1         2 *(0:1022)UBIN,
      214    11598    1         2 LINK UBIN;
      215    11599    1   DCL NCHARS CHAR(N) BASED CALIGNED;
      216    11600        %NI$DCT (NAME=DCT,STCLASS="BASED(DCT$)");
      217    11648        %NI$DVT (NAME=DVT,STCLASS="BASED(DVT$)");
      218    11655        %NI$DQH (NAME=DQH,STCLASS="BASED(DQH$)");
      219    11678        %NI$SQH (NAME=SQH,STCLASS="BASED(SQH$)");
      220    11691        /* SUBS */
      221    11692        %SUB OP_DCBPTR=1;
      222    11693        %SUB OP_FFLSH=2;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:7    
      223    11694        %SUB OP_TFLSH=3;
      224    11695        %SUB OP_SRCHNM=4;
      225    11696        %SUB OP_SRCHAC=5;
      226    11697        %SUB OP_GETFIT1=6;
      227    11698        %SUB OP_GETFIT2=7;
      228    11699        %SUB OP_CHKFIT=8;
      229    11700        %SUB OP_RELFILS=9;
      230    11701        %SUB OP_CGCLS=10;
      231    11702        %SUB OP_DSWRITE=11;
      232    11703        /**/
      233    11704        /**/
      234    11705        /*
      235    11706                   *********************************
      236    11707                   *  Close all DCBs for one user  *
      237    11708                   *********************************
      238    11709        */
      239    11710        /**/
      240    11711    1           RV_DCTX=0;
      241    11712    1           ERRCODE=0;
      242    11713    1           OP=0;
      243    11714    1           PHASE=0;                        /* Closing one user's DCBs            */
      244    11715    1           SN=' ';
      245    11716    1           ACCT=' ';
      246    11717    1           NAME$=ADDR(NIL);
      247    11718    1           CFU$=ADDR(NIL);
      248    11719    1           ASN=0;
      249    11720    1           CALL BINCHAR(RVF_ERRMSG.USR,RV_CUN);
      250    11721    1           MISC1=0;
      251    11722    1           MISC2=0;
      252    11723    1           CALL CVTPTR(ADDR(FMC_CACHE$), CACHE$) ALTRET(ALT);
      253    11724    1           CALL CVTPTR(CACHE$->PTR$(0), CACHE$) ALTRET(ALT);
      254    11725    2           IF RVF_DEBUG~=0 THEN DO;
      255    11726    2              B$JIT$=I$JITU$;
      256    11727    2              CALL BINCHAR(RVF_CLSUSR.SYSID,B$JIT.SYSID);
      257    11728    2              RVF_CLSUSR.ACCN=B$JIT.ACCN;
      258    11729    2              CALL IRR$TYPE6(RVF_CLSUSR,SIZEW(RVF_CLSUSR));
      259    11730    2              END;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:8    
      260    11731    1           CALL CVTPTR(B$ROSEG.DCBPTR$,DCBPTR$) ALTRET(ALT);
      261    11732    1           NUMDCBS=B$ROSEG.NUMDCBS;
      262    11733    2           DO SJ=%M$MAXNEG# TO NUMDCBS;
      263    11734    2              DCB$=DCBPTR$->PTR$(J);
      264    11735    2   CVTDCB:    OP=OP_DCBPTR;
      265    11736    2              SN=' ';
      266    11737    2              ACCT=' ';
      267    11738    2              NAME$=ADDR(NIL);
      268    11739    2              IF DCB$=ADDR(NIL) THEN
      269    11740    2                 GOTO NXTDCB;
      270    11741    2              CALL CVTPTR(DCB$,DCB$) ALTRET(NXTDCB);
      271    11742    2              IF NOT F$DCB.FCD THEN
      272    11743    2                 GOTO NXTDCB;
      273    11744    2              ASN=F$DCB.ASN;
      274    11745    3              DO CASE(F$DCB.IASN);
      275    11746    3               CASE(%FILE#);
      276    11747    3                 IF F$DCB.ASN=%COMGROUP# THEN
      277    11748    3                    GOTO NXTDCB;
      278    11749    3                 NAME$=PINCRC(ADDR(F$DCB.NAME),-2);
      279    11750    3                 IF F$DCB.CFU$ = ADDR(NIL) THEN
      280    11751    3                    GOTO NXTDCB;
      281    11752    3                 CALL CVTPTR(F$DCB.CFU$, CFU$) ALTRET(NXTDCB);
      282    11753    4                 IF F$DCB.STARF THEN DO;   /* STAR FILE                          */
      283    11754    4                    ACCT$=ADDR(NIL);
      284    11755    4                    ACCT='*';
      285    11756    4                    END;
      286    11757    3                 ELSE
      287    11758    4                    IF F$DCB.DISP=%SCRATCH# THEN DO; /* Scratch file             */
      288    11759    4                       ACCT$=ADDR(NIL);
      289    11760    4                       ACCT='*SCRTCH*';
      290    11761    4                       END;
      291    11762    4                    ELSE DO;               /* Permanent file                     */
      292    11763    4                       ACCTX=FM$CFU.ACCTX;
      293    11764    4                       IF ACCTX=0 THEN
      294    11765    4                          ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;
      295    11766    4                       ACCT$=PINCRW(F$CFU$,ACCTX);
      296    11767    4                       ACCT=FM$CFUA.ACCT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:9    
      297    11768    4                       END;
      298    11769    3                 SETX=F$DCB.SETX;
      299    11770    3                 SN=FM$SET.PSN(SETX);
      300    11771    3                 IF FM$CFU.FITSDA=0 THEN
      301    11772    3                    GOTO NXTDCB;
      302    11773        /* Find and verify FIT to make sure DCB and buffers are meaningful */
      303    11774    4                 DO I=0 TO 4;
      304    11775    4                    IF F$DCB.ACS~=%JRNL#
      305    11776    4                      AND F$DCB.BFR.BUFX(I)~=0 AND (F$DCB.BFR.DA(I)=FM$CFU.FITSDA
      306    11777    5                      OR (FM$CFU.AFIT=0 AND F$DCB.BFR.DA(I)=FM_FRZERO)) THEN DO;
      307    11778    5                       POBUF$->PG=PINCRW(R$BUFF$,(F$DCB.BFR.BUFX(I)-1)*
      308    11779    5                         1024)->PG;
      309    11780    5                       OP=OP_CHKFIT;
      310    11781    5                       CALL CHKFIT ALTRET(NXTDCB);
      311    11782    5                       GOTO FLSHDCB;
      312    11783    5                       END;
      313    11784    4                    END;
      314    11785    3                 OP=OP_GETFIT1;
      315    11786    3                 CALL GETFIT ALTRET(NXTDCB);
      316    11787        /**/
      317    11788        /* Flush any updated buffers */
      318    11789        /**/
      319    11790    4   FLSHDCB:      DO I=0 TO 4;
      320    11791    4                    OP=OP_FFLSH;
      321    11792    4                    IF F$DCB.BFR1.CX(I) > 0 THEN
      322    11793    5                    DO;
      323    11794    5                       IF FMC$CACHETBL.FLAGS.BUFUP(F$DCB.BFR1.CX(I)) THEN
      324    11795    5                          F$DCB.BFR.BUFUP(I)='1'B;
      325    11796    5                       END;
      326    11797    5                    IF F$DCB.BFR.BUFUP(I) AND F$DCB.BFR.BUFX(I)~=0 THEN DO;
      327    11798    5                       ADDR(POBUF)->PG=PINCRW(R$BUFF$,(F$DCB.BFR.BUFX(I)-1)
      328    11799    5                         *1024)->PG;
      329    11800    5                       DA=F$DCB.BFR.DA(I);
      330    11801    6                       IF F$DCB.ACS~=%JRNL# OR DA>FM_SRZERO THEN DO;
      331    11802    6                          IF RVF_DEBUG~=0 THEN
      332    11803    6                             CALL PUTNAME(RVF_CLSBFR,RVF_CLSBFR.FID,SIZEC(RVF_CLSBFR.
             11803                                      FID));
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:10   
      333    11804    6                          CALL WRITECHK ALTRET(NXTDCB);
      334    11805    6                          END;
      335    11806    5                       END;
      336    11807    4                    END;
      337    11808    3                 IF F$DCB.ACS=%JRNL# THEN
      338    11809    4                    IF FM$CFUJ.PAGE#~=0 THEN DO;
      339    11810    4                       MEMDESC.BADDR=FM$CFUJ.PAGE#*4096;
      340    11811    4                       POBUF$->PG=I$MEM$->PG;
      341    11812    4                       DA=FM$CFU.LDA;
      342    11813    4                       FM$CFUJ.PAGE#=0;
      343    11814    4                       OP=OP_FFLSH;
      344    11815    4                       CALL WRITECHK ALTRET(NXTDCB);
      345    11816    4                       END;
      346    11817    3                 IF NOT FM$CFU.SHARED OR FM$CFU.USECNT > 1 THEN
      347    11818    3                    GOTO NXTDCB;           /* File doesn't have to be closed     */
      348    11819    3                 FM$CFU.SHARED='0'B;       /* Don't try to close again           */
      349    11820    4                 IF RVF_DEBUG~=0 THEN DO;
      350    11821    4                    CALL PUTNAME(RVF_CLSDCB,RVF_CLSDCB.FID,SIZEC(RVF_CLSDCB.FID));
      351    11822    4                    END;
      352    11823    3                 OP=OP_GETFIT2;
      353    11824    3                 CALL GETFIT ALTRET(NXTDCB);
      354    11825    3                 CALL UPFIT ALTRET(NXTDCB);
      355    11826    3                 IF F$DCB.DISP=%SCRATCH# OR FM$CFU.FUN=%CREATE#
      356    11827    4                   OR F$DCB.ORG=%RANDOM# AND FM$CFU.UGRANS=0 THEN DO;
      357    11828    4                    CALL ADDLIST;
      358    11829    4                    FM$CFU.FITSDA=0;
      359    11830    4                    END;
      360    11831    3                 CALL WRITE;
      361    11832    3                 IF FM$GRAN.ORG=%RANDOM# AND FM$CFU.FUN=%UPDATE# AND
      362    11833    4                   FM$CFUR.HEADPP#~=0 THEN DO;
      363    11834    4                    REMUNWIND=RV_UNWIND1;
      364    11835    4                    REMEMBER DSTRAP1 IN RV_UNWIND1;
      365    11836    4                    CALL DSWRITE;
      366    11837    4   DSTRAP1:         RV_UNWIND1=REMUNWIND;
      367    11838    4                    CALL DSERR;
      368    11839    4                    END;
      369    11840    3                 IF FM$CFU.USECNT>0 THEN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:11   
      370    11841    3                    FM$CFU.USECNT=FM$CFU.USECNT-1;
      371    11842    3               CASE(%STREAM#);
      372    11843    3                 DCB$=F$DCB.CFU$;
      373    11844    4                 IF DCB$=DCBPTR$->PTR$(J) THEN DO; /* Streamed to itsself        */
      374    11845    4                    ERRCODE=31;
      375    11846    4                    CALL ERROR;
      376    11847    4                    GOTO NXTDCB;
      377    11848    4                    END;
      378    11849    3                 GOTO CVTDCB;
      379    11850    3               CASE(%TAPE#);
      380    11851    3                 IF F$DCB.BLKL > 4096      /* Too big                            */
      381    11852    3                   OR (F$DCB.ACS = %JRNL# AND NOT F$DCB.OWNER) /* Owner will do  */
      382    11853    3                   OR NOT F$DCB.BFR.BUFUP(F$DCB.CBUFNUM) /* Not updated          */
      383    11854    3                   OR F$DCB.TAPTYP.USRBUF  /* Not FPOOL                          */
      384    11855    3                   OR F$DCB.TRNC ~= FT_NOTRUNC# /* Already out                   */
      385    11856    3                   OR F$DCB.ASN ~= %TAPE#  /* Not labelled                       */
      386    11857    3                 THEN GOTO NXTDCB;
      387    11858    3                 IF F$DCB.BLKLEN < 20
      388    11859    3                 THEN N = 20;              /* Pad to next word > 18 chars        */
      389    11860    3                 ELSE IF F$DCB.TAPTYP.CP6F
      390    11861    3                    THEN N = 8;            /* Binary write...pad to doubleword   */
      391    11862    3                    ELSE N = 4;            /* ASCII write...pad to word          */
      392    11863    3                 N = ( (F$DCB.BLKLEN + N - 1) / N ) * N - F$DCB.BLKLEN;
      393    11864                                                /* Number of filler bytes             */
      394    11865    3                 IF F$DCB.TAPTYP.CP6F OR (F$DCB.ORG = %VARIABLE# AND F$DCB.EBCDIC)
      395    11866    3                 THEN PINCRC(ADDR(POBUF),F$DCB.BLKLEN)->NCHARS = NULPAD;
      396    11867    3                 ELSE PINCRC(ADDR(POBUF),F$DCB.BLKLEN)->NCHARS = ANSPAD;
      397    11868    3                 N = F$DCB.BLKLEN + N;     /* # bytes to write                   */
      398    11869    3                 IF F$DCB.AFTRBLK
      399    11870    3                 THEN CALL IRR$SPRECB;     /* Back up to rewrite block           */
      400    11871    3                 DCTX = F$DCB.SETX;
      401    11872    3                 CALL DCTCNVRT;
      402    11873    3                 IF F$DCB.TAPTYP.CP6F OR (F$DCB.ORG = %VARIABLE# AND F$DCB.EBCDIC)
      403    11874    3                 THEN CALL IRR$WRBIN( N );
      404    11875    3                 ELSE CALL IRR$WRASC( N );
      405    11876    3               CASE(ELSE);
      406    11877    3               END;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:12   
      407    11878    2   NXTDCB:    END;
      408    11879    1           IF ERRCODE ~= 0 THEN
      409    11880    1              ALTRETURN;
      410    11881    1           ELSE
      411    11882    1              RETURN;
      412    11883        /**/
      413    11884    1   ALT:    ALTRETURN;                      /* Error                              */
      414    11885        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:13   
      415    11886        /*
      416    11887                    ****************************************************
      417    11888                    *  Update FITs for all files and file directories  *
      418    11889                    ****************************************************
      419    11890        */
      420    11891        /**/
      421    11892    1   IRF$CFUS: ENTRY ALTRET;
      422    11893        /**/
      423    11894    1           REMUNWIND=RV_UNWIND1;           /* Remember Linda's trap handler      */
      424    11895    1           RV_BUFF.CURCG='0'B;
      425    11896    1           RV_DCTX=0;
      426    11897    1           ERRCODE=0;
      427    11898    1           PHASE=1;                        /* Closing CFU files                  */
      428    11899    1           ACCT=' ';
      429    11900    1           SN=' ';
      430    11901    1           ASN=0;
      431    11902    1           NAME$=ADDR(NIL);
      432    11903    1           DCB$=ADDR(NIL);
      433    11904    1           RVF_ERRMSG.USR=' ';
      434    11905    1           OP=0;
      435    11906    1           MISC1=0;
      436    11907    1           MISC2=0;
      437    11908    1           NAMEX=FM$CFUX.NAMES;            /* Byte index of first name           */
      438    11909    1           CALL CVTPTR(ADDR(FM_SYSSETX),CFU$);
      439    11910    1           SYSSETX=CFU$->PG(0);
      440    11911    2           DO WHILE(NAMEX<FM$CFUX.NAMEX);
      441    11912    2              OP=OP_SRCHNM;
      442    11913    2              NAME$=PINCRC(F$CFU$,NAMEX);
      443    11914    2              CFUX=FM$CFUN.LNKX;           /* First CFU for this name            */
      444    11915    3              DO WHILE(CFUX~=NAMEX);
      445    11916    3                 ASN=0;
      446    11917    3                 CFU$=PINCRW(F$CFU$,CFUX);
      447    11918    3                 IF FM$CFU.FITSDA=0 OR FM$CFU.FUN=0 OR FM$CFU.USECNT=0 THEN
      448    11919    3                    GOTO NXTCFU;
      449    11920    3                 IF NOT FM$CFU.SHARED THEN
      450    11921    3                    GOTO NXTCFU;           /* Nothing to do here                 */
      451    11922    3                 FM$CFU.SHARED='0'B;       /* Don't try to close again           */
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:14   
      452    11923    4                 IF FM$CFUF.ACCNAM=0 THEN DO; /* Scratch file                    */
      453    11924    4                    ACCT='*SCRTCH*';
      454    11925    4                    ACCT$=ADDR(NIL);
      455    11926    4                    SETX=SYSSETX;
      456    11927    4                    END;
      457    11928    3                 ELSE
      458    11929    4                    IF FM$CFU.STARX.F=0 THEN DO;
      459    11930    4                       ACCTX=FM$CFU.ACCTX;
      460    11931    4                       IF ACCTX=0 THEN
      461    11932    4                          ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;
      462    11933    4                       ACCT$=PINCRW(F$CFU$,ACCTX);
      463    11934    4                       ACCT=FM$CFUA.ACCT;
      464    11935    4                       SETX=FM$CFUA.SETX;
      465    11936    4                       END;
      466    11937    4                    ELSE DO;
      467    11938    4                       ACCT$=ADDR(NIL);
      468    11939    4                       ACCT='*';
      469    11940    4                       SETX=SYSSETX;
      470    11941    4                       END;
      471    11942    3                 SN=FM$SET.PSN(SETX);
      472    11943    3                 IF RVF_DEBUG~=0 THEN
      473    11944    3                    CALL PUTNAME(RVF_CLSCFU,RVF_CLSCFU.FID,SIZEC(RVF_CLSCFU.FID));
      474    11945    3                 CALL GETFIT ALTRET(NXTCFU);
      475    11946    3                 IF FM$GRAN.ORG=%CG# THEN
      476    11947    3                    ASN=%COMGROUP#;
      477    11948    3                 ELSE
      478    11949    3                    ASN=%FILE#;
      479    11950    4                 IF FM$GRAN.ORG=%CG# THEN DO;
      480    11951    4                    REMEMBER CGTRAP1 IN RV_UNWIND1;
      481    11952    4                    CALL CGCLS ALTRET(NXTCFU);
      482    11953    4                    RV_UNWIND1=REMUNWIND;
      483    11954    4                    CALL GETFIT ALTRET(NXTCFU);
      484    11955    4                    END;
      485    11956    3                 CALL UPFIT ALTRET(NXTCFU);
      486    11957    3                 IF FM$CFU.FUN=%CREATE#
      487    11958    3                   OR FM$CFU.FUN=%JRNL# AND FM$CFUJ.DCTX~=0
      488    11959    4                   OR FM$GRAN.ORG=%RANDOM# AND FM$CFU.UGRANS=0 THEN DO;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:15   
      489    11960    4                    CALL ADDLIST;          /* Not catalogued                     */
      490    11961    4                    FM$CFU.FITSDA=0;
      491    11962    4                    END;
      492    11963    3                 CALL WRITE;
      493    11964    3                 IF FM$GRAN.ORG=%RANDOM# AND FM$CFU.FUN=%UPDATE#
      494    11965    4                   AND FM$CFUR.HEADPP#~=0 THEN DO;
      495    11966    4                    REMEMBER DSTRAP2 IN RV_UNWIND1;
      496    11967    4                    CALL DSWRITE;
      497    11968    4   DSTRAP2:         CALL DSERR;
      498    11969    4                    END;
      499    11970    3   NXTCFU:       RV_UNWIND1=REMUNWIND;
      500    11971    3                 CFUX=FM$CFU.NAMEX;        /* Next CFU for this name             */
      501    11972    3                 END;
      502    11973    2   NXTNAME:   NAMEX=NAMEX+FM$CFUN.L+3;
      503    11974    2              END;
      504    11975        /**/
      505    11976        /**/
      506    11977        /* Update FD FITs */
      507    11978        /**/
      508    11979        /**/
      509    11980    1           CFU$=ADDR(NIL);
      510    11981    1           NAME$=ADDR(NIL);
      511    11982    1           PHASE=2;                        /* Updating account FITs              */
      512    11983    1           ACCTX=FM$CFUX.ACCTS;            /* First account block                */
      513    11984    1           OP=OP_SRCHAC;
      514    11985    2           DO WHILE(ACCTX~=0);
      515    11986    2              ACCT$=PINCRW(F$CFU$,ACCTX);
      516    11987    2              IF FM$CFUA.GMOD=0 THEN
      517    11988    2                 GOTO NXTACCT;
      518    11989    2              ACCT=FM$CFUA.ACCT;
      519    11990    2              SETX=FM$CFUA.SETX;
      520    11991    2              SN=FM$SET.PSN(SETX);
      521    11992    2              IF RVF_DEBUG~=0 THEN
      522    11993    2                 CALL PUTNAME(RVF_CLSFD,RVF_CLSFD.FID,SIZEC(RVF_CLSFD.FID));
      523    11994    2              CALL GETFDFIT ALTRET(NXTACCT);
      524    11995    2              CALL UPFDFIT ALTRET(NXTACCT);
      525    11996    2              CALL WRITE;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:16   
      526    11997    2   NXTACCT:   ACCTX=FM$CFUA.LINKX;
      527    11998    2              END;
      528    11999    1           OP=OP_RELFILS;
      529    12000    1           ACCT=' ';
      530    12001    1           SETX=FM$CFUX.SETH;              /* PUT CHAIN OF FILES TO RELEASE      */
      531    12002    2           DO WHILE(SETX~=0);              /* ON BLINK OF FM_GPSDA               */
      532    12003    3              IF FM$SET.SET(SETX) AND FM$SET.CHKSM(SETX)>FM_SRZERO THEN DO;
      533    12004    3                 SN=FM$SET.PSN(SETX);
      534    12005    3                 IF RVF_DEBUG~=0 THEN
      535    12006    3                    CALL PUTNAME(RVF_RELGRAN,RVF_RELGRAN.PSN,SIZEC(RVF_RELGRAN.PSN));
      536    12007    3                 CALL GETGPFIT ALTRET(NXTSET);
      537    12008    3                 FM$GRAN.BLINK=FM$SET.CHKSM(SETX);
      538    12009    3                 FM$SET.CHKSM(SETX)=0;
      539    12010    3                 CALL WRITE;
      540    12011    3                 END;
      541    12012    2   NXTSET:    SETX=FM$SET.SETL(SETX);
      542    12013    2              END;
      543    12014        /**/
      544    12015    1           RVF_ERRCNT=0;                   /* Reset for next screech             */
      545    12016    1           RETURN;
      546    12017        /**/
      547    12018    1   CGTRAP1: REMEMBER CGTRAP2 IN RV_UNWIND1;
      548    12019    1           RV_BUFF.CGQTRAP='1'B;
      549    12020    1           IF DUMPFLG~=0 AND RV_BUFF.CURCG~='0'B THEN
      550    12021    1              RV_BUFF.CURCG.TRAP='1'B;
      551    12022    1           CALL PUTNAME(RVF_CGTRAP,RVF_CGTRAP.FID,SIZEC(RVF_CGTRAP.FID));
      552    12023    1   CGTRAP2: ;
      553    12024    1           GOTO NXTCFU;
      554    12025        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:17   
      555    12026        /*
      556    12027                     *********************************
      557    12028                     * Dump current comgroup, if any *
      558    12029                     *********************************
      559    12030        */
      560    12031        /**/
      561    12032    1   IRF$DUMPCG: ENTRY ALTRET;
      562    12033        /**/
      563    12034    1           ERRCODE=0;
      564    12035    1           PHASE=2;                        /* Dumping comgroup                   */
      565    12036    1           ACCT=' ';
      566    12037    1           SN=' ';
      567    12038    1           ASN=%COMGROUP#;
      568    12039    1           NAME$=ADDR(NIL);
      569    12040    1           DCB$=ADDR(NIL);
      570    12041    1           CFU$=ADDR(NIL);
      571    12042    1           RVF_ERRMSG.USR=' ';
      572    12043    1           OP=0;
      573    12044    1           MISC1=0;
      574    12045    1           MISC2=0;
      575    12046        /**/
      576    12047    1           IF RV_BUFF.CURCG~='0'B THEN
      577    12048    1              RETURN;                      /* Already dumped one                 */
      578    12049    1           CALL CVTPTR(ADDR(KQ_MMSD$),CTX$) ALTRET(DUMPERR);
      579    12050    1           CALL CVTPTR(CTX$->PTR$(0),CTX$) ALTRET(DUMPERR);
      580    12051    1           CTX$=CTX$->KQ$MMSD.CGHEAD$;
      581    12052    1   CHKCG:  ;
      582    12053    1           IF CTX$=ADDR(NIL) THEN
      583    12054    1              RETURN;
      584    12055    1           OLDCTX$=CTX$;
      585    12056    1           CALL CVTPTR(CTX$,CTX$) ALTRET(DUMPERR);
      586    12057    1           IF KQ$CG.MMD.DSB$=ADDR(NIL) THEN
      587    12058    1              GOTO NXTCG;
      588    12059    1           CALL CVTPTR(KQ$CG.MMD.DSB$,DSB$) ALTRET(DUMPERR);
      589    12060    1           IF KQ$DSB.ASR~=ADDR(RV_BUFF.SSFRAME)->B$EXCFR.ASR THEN
      590    12061    2           DO;
      591    12062    2   NXTCG:     ;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:18   
      592    12063    2              CTX$=KQ$CG.LNK$;
      593    12064    2              GOTO CHKCG;
      594    12065    2              END;
      595    12066    1           CALL CVTPTR(KQ$CG.CFU$,CFU$) ALTRET(DUMPERR);
      596    12067    2           IF FM$CFUF.ACCNAM=0 THEN DO;    /* Scratch file                       */
      597    12068    2              ACCT='*SCRTCH*';
      598    12069    2              ACCT$=ADDR(NIL);
      599    12070    2              NAME$=ADDR(NIL);
      600    12071    2              SETX=SYSSETX;
      601    12072    2              END;
      602    12073    1           ELSE
      603    12074    2              IF FM$CFU.STARX.F=0 THEN DO;
      604    12075    2                 ACCTX=FM$CFU.ACCTX;
      605    12076    3                 IF ACCTX=0 THEN DO;
      606    12077    3                    ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;
      607    12078    3                    NAME$=PINCRC(F$CFU$,PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.NAMEX);
      608    12079    3                    END;
      609    12080    2                 ELSE
      610    12081    2                    NAME$=PINCRC(F$CFU$,FM$CFU.NAMEX);
      611    12082    2                 ACCT$=PINCRW(F$CFU$,ACCTX);
      612    12083    2                 ACCT=FM$CFUA.ACCT;
      613    12084    2                 SETX=FM$CFUA.SETX;
      614    12085    2                 END;
      615    12086    2              ELSE DO;
      616    12087    2                 ACCT$=ADDR(NIL);
      617    12088    2                 NAME$=ADDR(NIL);
      618    12089    2                 ACCT='*';
      619    12090    2                 SETX=SYSSETX;
      620    12091    2                 END;
      621    12092    1           SN=FM$SET.PSN(SETX);
      622    12093    1           ASN=%COMGROUP#;
      623    12094    1           CALL DUMPCG;
      624    12095    1           RETURN;
      625    12096        /**/
      626    12097    1   DUMPERR: ;
      627    12098    1           RV_BUFF.CURCG.ERR='1'B;
      628    12099    1           RETURN;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:19   
      629    12100        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:20   
      630    12101
      631    12102        /* CGCLS - Close a comgroup.  FIT must be in POBUF. */
      632    12103
      633    12104    1   CGCLS:  PROC ALTRET;
      634    12105
      635    12106    2   DCL SIZ UBIN;
      636    12107    2   DCL HASH UBIN;
      637    12108    2   DCL DESC# UBIN;
      638    12109    2   DCL PGINDX UBIN;
      639    12110    2   DCL PG$ PTR;
      640    12111    2   DCL RP UBIN;
      641    12112    2   DCL ENTFLG UBIN;
      642    12113        /**/
      643    12114        %KQ_CTLGRAN (FPTN=KQ$CTLGRAN,STCLASS="BASED(POBUF$)");
      644    12200        %KQ_GRAN (FPTN=KQ$GRAN,STCLASS="BASED(POBUF$)");
      645    12255
      646    12256    2           ENTFLG=0;
      647    12257    2           OP=OP_CGCLS;
      648    12258    2           HASH=FM$GRAN.STAMP.HASH;
      649    12259    2           IF FM$CFU.GDA=0 THEN
      650    12260    2              RETURN;
      651    12261    2           CTX.SID=FM$CFU.GDA;
      652    12262    2           CTX.DISP=FM$CFU.LDA;
      653    12263    2           OLDCTX$=CTX$;                   /* Unconverted pointer                */
      654    12264    2           FM$CFU.SHARED='0'B;             /* Don't come here again              */
      655    12265    2           CALL CVTPTR(CTX$,CTX$) ALTRET(ERR2);
      656    12266    2           CALL CVTPTR(KQ$CG.CFU$,COD$) ALTRET(ERR2);
      657    12267    3           IF COD$~=CFU$ THEN DO;
      658    12268    3              MSC1=CTX; MISC2$=KQ$CG.CFU$;
      659    12269    3              ERRCODE=40;
      660    12270    3              GOTO ERR;                    /* CFU$ in context doesn't match      */
      661    12271    3              END;
      662    12272    2           DA=FM_FRZERO;
      663    12273    2           CALL READ ALTRET(ERR2);
      664    12274    2           IF KQ$GRAN.STAMP.HASH~=HASH OR KQ$GRAN.PTYP~=%KQ_PTYP_CTL
      665    12275    3             OR KQ$GRAN.ORG~=%CG# THEN DO;
      666    12276    3              MISC1=POBUF$->PG(0); MISC2=POBUF$->PG(1);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:21   
      667    12277    3              ERRCODE=43;
      668    12278    3              GOTO ERR;
      669    12279    3              END;
      670    12280    2           IF KQ$CTLGRAN.CTXX<SIZEW(KQ$CTLGRAN) OR KQ$CTLGRAN.CTXX>1024-SIZEW(KQ$CG)
      671    12281    3             OR KQ$CTLGRAN.CTXSIZ<SIZEW(KQ$CG) THEN DO;
      672    12282    3              ERRCODE=44;
      673    12283    3              GOTO ERR;
      674    12284    3              END;
      675    12285    2   ENDCTL: ;
      676    12286    2           SIZ=KQ$CG.NGAVAL;
      677    12287    2           IF KQ$CTLGRAN.RCVRSIZ~=0 THEN
      678    12288    2              ENTFLG=1;                    /* Dont't close - just dump           */
      679    12289    2           ELSE
      680    12290    2              PGTBL='0'B;
      681    12291    2           CALL CVTPTR(KQ$CG.MMD.DSB$,DSB$) ALTRET(ERR2);
      682    12292    2           DA=KQ$CG.UGRANS+FM_FRZERO;
      683    12293    2           DESC#=0;
      684    12294    2           PGINDX=0;
      685    12295    2           IF RV_BUFF.CURCG='0'B AND DSB$->KQ$DSB.ASR=ADDR(RV_BUFF.SSFRAME)->
      686    12296    3             B$EXCFR.ASR THEN DO;
      687    12297    3   BEGINDUMP: ;
      688    12298    3              DUMPFLG=1; RV_BUFF.CURCG.DA=RV_NXTGRAN; RV_BUFF.CURCG.CG$=OLDCTX$;
      689    12299    3              POBUF$->KQ$DSB=DSB$->KQ$DSB;
      690    12300    3              CALL IRR$WPOBUFF ALTRET(DUMPERR);
      691    12301    3              RV_BUFF.CURCG.SZ=RV_BUFF.CURCG.SZ+1;
      692    12302    3              RV_BUFF.SIZE=RV_BUFF.SIZE+1;
      693    12303    3              IF RVF_DEBUG~=0 THEN
      694    12304    3                 CALL PUTNAME(RVF_DUMPCG,RVF_DUMPCG.FID,SIZEC(RVF_DUMPCG.FID));
      695    12305    3              END;
      696    12306    2           ELSE
      697    12307    2              DUMPFLG=0;
      698    12308        /**/
      699    12309    2   LOOP:   ;
      700    12310    3           DO WHILE('1'B);
      701    12311    3   NXTP :     ;
      702    12312    3              CALL FINDCGPAGE(DSB$->KQ$DSB,DESC#,PGINDX,PG$,RP) ALTRET(ENDRCVR);
      703    12313    3              MEMDESC.BADDR=RP*4096;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:22   
      704    12314    3              POBUF$->PG=I$MEM$->PG;       /* Move page to POBUF                 */
      705    12315    4              IF DUMPFLG~=0 THEN DO;
      706    12316    4                 CALL IRR$WPOBUFF ALTRET(DUMPERR);
      707    12317    4                 RV_BUFF.CURCG.SZ=RV_BUFF.CURCG.SZ+1;
      708    12318    4                 RV_BUFF.SIZE=RV_BUFF.SIZE+1;
      709    12319    4                 END;
      710    12320    3   ENDDUMP:   ;
      711    12321    4              IF ENTFLG=0 THEN DO;
      712    12322    4                 IF KQ$GRAN.PTYP=0 THEN
      713    12323    4                    GOTO NXTP;             /* Uninitialized page                 */
      714    12324    5                 IF KQ$GRAN.SELF$~=PG$ THEN DO;
      715    12325    5                    ERRCODE=45;
      716    12326    5                    MISC1$=PG$; MISC2$=KQ$GRAN.SELF$;
      717    12327    5                    CALL ERROR;
      718    12328    5                    ENTFLG=1;
      719    12329    5                    GOTO NXTP;
      720    12330    5                    END;
      721    12331    5                 IF HASH~=KQ$GRAN.STAMP.HASH THEN DO;
      722    12332    5                    ERRCODE=41;
      723    12333    5                    MISC1B=KQ$GRAN.STAMP; MISC2=HASH;
      724    12334    5                    CALL ERROR;
      725    12335    5                    ENTFLG=1;              /* Don't write any more               */
      726    12336    5                    GOTO NXTP;
      727    12337    5                    END;
      728    12338    4                 IF KQ$GRAN.PTYP=%KQ_PTYP_DATA AND NOT KQ$GRAN.CHAIN THEN
      729    12339    4                    GOTO NXTP;
      730    12340    5                 IF SIZ=0 THEN DO;
      731    12341    5                    ERRCODE=42;
      732    12342    5                    CALL ERROR;
      733    12343    5                    ENTFLG=1;              /* Don't try to write any more        */
      734    12344    5                    GOTO NXTP;
      735    12345    5                    END;
      736    12346    4                 KQ$GRAN.GTYP=%KQ_PTYP_RCVR;
      737    12347    4                 KQ$GRAN.STAMP.GMOD=DA;
      738    12348    4                 CALL WRITE;
      739    12349    4                 DA=DA+1;
      740    12350    4                 SIZ=SIZ-1;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:23   
      741    12351    4                 PGTBL((DESC#*%CGQ_CHUNK_SIZE)+PGINDX)='1'B;
      742    12352    4                 END;
      743    12353    3              END;
      744    12354        /**/
      745    12355    2   ENDRCVR: ;
      746    12356    3           IF SIZ~=KQ$CG.NGAVAL AND ENTFLG=0 THEN DO;
      747    12357    3              DA=FM_FRZERO;
      748    12358    3              CALL READ ALTRET(ERR2);
      749    12359    3              KQ$CTLGRAN.RCVRDA=KQ$CG.UGRANS+FM_FRZERO;
      750    12360    3              KQ$CTLGRAN.RCVRSIZ=KQ$CG.NGAVAL-SIZ;
      751    12361    3              KQ$CTLGRAN.RCVRTIME=RV_BUFF.UTS1;
      752    12362    3              KQ$CTLGRAN.PGTBL=PGTBL;
      753    12363    3              DSB$=PINCRW(POBUF$,KQ$CTLGRAN.CTXX);
      754    12364    3              DSB$->KQ$CG=KQ$CG;
      755    12365    3              CALL WRITE;
      756    12366    3              END;
      757    12367        /**/
      758    12368    2           RETURN;
      759    12369        /**/
      760    12370        /**/
      761    12371    2   DUMPCG: ENTRY ALTRET;
      762    12372        /**/
      763    12373    2           DESC#=0;
      764    12374    2           PGINDX=0;
      765    12375    2           ENTFLG=1;
      766    12376    2           GOTO BEGINDUMP;
      767    12377        /**/
      768    12378    2   ERR:    ;
      769    12379    2           CALL ERROR;
      770    12380    2   ERR2:   ;
      771    12381    2           ALTRETURN;
      772    12382        /**/
      773    12383    2   DUMPERR: RV_BUFF.CURCG.ERR='1'B;
      774    12384    2           DUMPFLG=0;
      775    12385    2           ENTFLG=1;             /* Don't write any more to file recovery area   */
      776    12386    2           GOTO ENDDUMP;
      777    12387        /**/
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:24   
      778    12388                %LIST;
      779    12389                %KQ_FCGP (MON=NO);
             12390        /**/
             12391    2   FINDCGPAGE: PROC (KQ$DSB,ASNUM,PGNUM,PTR$,PPNO) ALTRET;
             12392        /**/
             12393        %KQ_DSB (FPTN=KQ$DSB,STCLASS="");
             12394         %LSET LISTDIR='0'B;
             12406    3   DCL 1 KQ$DSB DALIGNED,
             12408    3         2 ASR,
             12412    3           3 BOUND UBIN(20) UNAL /*(0)/**/,
             12413    3           3 FLG BIT(9) UNAL /*('110100011'B)/**/,
             12414    3           3 W UBIN(3) UNAL /*(3)/**/,
             12415    3           3 T UBIN(4) UNAL /*(1)/**/,
             12416    3           3 BASE UBIN(36) UNAL /*(0)/**/,
             12417    3         2 CRYPT REDEF ASR,
             12420    3           3 LNK$ PTR,
             12423    3           3 * UBIN,
             12424    3         2 DESC (0:25),
             12427    3           3 BOUND UBIN(20) UNAL /*(40959*0)/**/,
             12428    3           3 FLG BIT(9) UNAL /*('110000010'B*0)/**/,
             12429    3           3 FLGR REDEF FLG,
             12430    3             4 * BIT(8) UNAL,
             12431    3             4 PRESENT BIT(1) UNAL,
             12432    3           3 W UBIN(3) UNAL /*(3*0)/**/,
             12433    3           3 T UBIN(4) UNAL /*(0*0)/**/,
             12434    3           3 BASE UBIN(36) UNAL /*(0*0)/**/;
             12436    3   DCL ASNUM UBIN;
             12437    3   DCL PGNUM UBIN;
             12438    3   DCL PTR$ PTR ALIGNED;
             12439    3   DCL 1 PTR$R REDEF PTR$ ALIGNED,
             12440    3         2 PG# UBIN(8) UNAL,
             12441    3         2 GORGO UBIN(16) UNAL,
             12442    3         2 SEGID UBIN(12) UNAL;
             12443    3   DCL PPNO UBIN;
             12444        %IF MON;
             12487        %ELSE;
             12488    3   DCL S1000_FLG BIT(1) ALIGNED SYMREF;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:25   
             12489        %ENDIF;
             12490    3   DCL B$HALF(0:0) UBIN HALF BASED HALIGNED;
             12491    3   DCL B$IPHYMAP$ PTR SYMREF;
             12492        /**/
             12493    3   DCL K UBIN;
             12494        /**/
             12495    3   LOOP:;
             12496    3       IF PGNUM >= %CGQ_CHUNK_SIZE THEN
             12497    4         DO;
             12498    4   LOOP1:
             12499    4         ASNUM=ASNUM+1;
             12500    4         PGNUM=0;
             12501    4         END;
             12502    3       IF ASNUM > KQM_MDPC# THEN ALTRETURN;
             12503    3       IF NOT KQ$DSB.DESC.FLGR.PRESENT(ASNUM) THEN GOTO LOOP1;
             12504    3       K=KQ$DSB.DESC.BASE(ASNUM)/4096;
             12505    3       PPNO=B$CGPT$->B$MAP.RPN(K+PGNUM);
             12506    3       IF B$CGPT$->B$MAP.CTRL(K+PGNUM) & '40'O /* CPU PRESENT */ THEN
             12507    4         DO;
             12508        %IF MON;
             12510              %ELSE;
             12511    4         IF S1000_FLG THEN
             12512              %ENDIF;
             12513    4         PPNO=B$IPHYMAP$->B$HALF(PPNO);
             12514    4         PTR$R.PG#=PGNUM;
             12515    4         PTR$R.SEGID=BITBIN(%AS0SID)+ASNUM;
             12516    4         PTR$R.GORGO=0;
             12517    4         PGNUM=PGNUM+1;
             12518    4         RETURN;
             12519    4         END;
             12520    3       PGNUM=PGNUM+1;
             12521    3       GOTO LOOP;
             12522    3   END FINDCGPAGE;
      780    12524                %PLIST;
      781    12525        /**/
      782    12526    2   END CGCLS;
      783    12527        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:26   
      784    12528    1   GETFIT: PROC ALTRET;
      785    12529        /* LOCAL AUTOMATIC STORAGE */
      786    12530    2   DCL GMOD UBIN(9);
      787    12531    2   DCL I UBIN;
      788    12532    2   DCL 1 P2,
      789    12533    2         2 X,
      790    12534    2           3 A SBIN,
      791    12535    2           3 AB REDEF A BIT(36),
      792    12536    2           3 B SBIN,
      793    12537    2           3 BB REDEF B BIT(36),
      794    12538    2         2 B(0:71) REDEF X BIT(1),
      795    12539    2         2 Y,
      796    12540    2           3 A SBIN,
      797    12541    2           3 B SBIN,
      798    12542    2         2 Z,
      799    12543    2           3 A UBIN,
      800    12544    2           3 B UBIN,
      801    12545    2         2 I SBIN,
      802    12546    2         2 IB REDEF I BIT(36),
      803    12547    2         2 J SBIN,
      804    12548    2         2 JB REDEF J BIT(36);
      805    12549    2   DCL CNAME REDEF P2 CHAR(32);
      806    12550    2   DCL PNAME BASED CHAR(P2.I);
      807    12551    2   DCL RSLT BIT(36);
      808    12552    2   DCL ENTFLG UBIN;
      809    12553        /**/
      810    12554    2           ENTFLG=0;
      811    12555    2           GOTO COMM;
      812    12556        /**/
      813    12557    2   CHKFIT: ENTRY ALTRET;
      814    12558    2           ENTFLG=1;
      815    12559        /**/
      816    12560    2   COMM:   ;
      817    12561    2           DA=FM$CFU.FITSDA;
      818    12562    2           IF DA<FM_SRZERO THEN
      819    12563    2              GOTO ERR1;
      820    12564    2           IF ENTFLG=0 THEN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:27   
      821    12565    2              CALL READ ALTRET(ERR);
      822    12566    2           GMOD=0;
      823    12567    3           IF FM$CFU.AFIT=1 THEN DO;
      824    12568    3              GMOD=DA;
      825    12569    3              IF FM$GRAN.LVL~=6 THEN
      826    12570    3                 GOTO ERR4;
      827    12571    3              END;
      828    12572    2           ELSE
      829    12573    2              IF FM$GRAN.LVL~=0 THEN
      830    12574    2                 GOTO ERR4;
      831    12575    2           IF GMOD~=FM$GRAN.STAMP.GMOD THEN
      832    12576    2              GOTO ERR5;
      833    12577    2           FIT$=PINCRW(ADDR(POBUF),SIZEW(FM$GRAN));
      834    12578    2           IF FM$FIT.CODES.CODE(1)~=1 THEN
      835    12579    2              GOTO ERR13;
      836    12580    2           I=MOD(FM$FIT.CODES.NDW(1)-1,512);
      837    12581    2           COD$=PINCRW(FIT$,FM$FIT.CODES.ITEMX(1));
      838    12582    2           IF CODE01.NXTNTS~=I THEN
      839    12583    2              GOTO ERR14;
      840    12584    2           IF FM$GRAN.STAMP.HASH~=CODE01.HASH THEN
      841    12585    2              GOTO ERR15;
      842    12586    2           P2.I=FM$CFUN.L+1;
      843    12587    2           CNAME=ADDR(FM$CFUN.L)->PNAME;
      844    12588    2           P2.J=P2.J+P2.I*3+P2.Z.B*5+P2.Z.A*7+P2.Y.B*11+P2.Y.A*13+P2.X.B*17;
      845    12589    2           RSLT=(P2.X.AB|P2.JB)&~(P2.X.AB&P2.JB);
      846    12590    2           CALL LOCCOD(3) ALTRET(ERR20);
      847    12591    2           IF CODE03.NSTAMP~=BITBIN(RSLT) THEN
      848    12592    2              GOTO ERR19;
      849    12593    2           RETURN;
      850    12594        /**/
      851    12595    2   ERR1:   ERRCODE=1; MISC1=DA; MISC2=0; GOTO ERR;
      852    12596    2   ERR4:   ERRCODE=4; MISC1=POBUF$->PG(0); MISC2=POBUF$->PG(1); GOTO ERR;
      853    12597    2   ERR5:   ERRCODE=5; MISC1=DA; MISC2=GMOD*512+FM$GRAN.STAMP.GMOD; GOTO ERR;
      854    12598    2   ERR13:  ERRCODE=13; MISC1=FIT$->PG(0); MISC2=FIT$->PG(1); GOTO ERR;
      855    12599    2   ERR14:  ERRCODE=14; GOTO ERR;
      856    12600    2   ERR15:  ERRCODE=15; GOTO ERR;
      857    12601    2   ERR19:  ERRCODE=19; GOTO ERR;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:28   
      858    12602    2   ERR20:  ERRCODE=20; GOTO ERR;
      859    12603        /**/
      860    12604    2   ERR:    CALL ERROR;
      861    12605    2           ALTRETURN;
      862    12606    2   END GETFIT;
      863    12607        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:29   
      864    12608    1   UPFIT:  PROC ALTRET;
      865    12609        /**/
      866    12610        /* LOCAL AUTOMATIC STORAGE */
      867    12611    2   DCL T$ PTR;
      868    12612    2   DCL I SBIN;
      869    12613        /**/
      870    12614    2           CALL LOCCOD(3) ALTRET(ERR);
      871    12615    2           CODE03.UGRANS=FM$CFU.UGRANS;
      872    12616    2           CODE03.NGAVAL=FM$CFU.NGAVAL;
      873    12617    3           IF FM$CFU.FMOD THEN DO;
      874    12618    3              CODE03.LDA=FM$CFU.LDA;
      875    12619    3              IF FM$GRAN.ORG=%RANDOM# OR FM$GRAN.ORG=%IDS# OR
      876    12620    3                FM$GRAN.ORG=%CG# THEN
      877    12621    3                 CODE03.NRECS=FM$CFU.UGRANS;
      878    12622    3              ELSE
      879    12623    3                 CODE03.NRECS=FM$CFU.NRECS;
      880    12624    3              IF CODE03.RCSZ<FM$CFU.RCSZ THEN
      881    12625    3                 CODE03.RCSZ=FM$CFU.RCSZ;
      882    12626    3              IF DCB$ ~= ADDR(NIL) THEN
      883    12627    3                 IF F$DCB.ALTKEYX > 0 THEN
      884    12628    4                 DO;                       /* UPDATE ALTKEY INFO                 */
      885    12629    4                    ALTKEY$=PINCRW(B$ROSEG$, F$DCB.ALTKEYX);
      886    12630    4                    IF F$DCB.ORG = %INDEXED# THEN
      887    12631    5                    DO;                    /* INDEXED                            */
      888    12632    5                       CODE03.LDA=ALTKEYS.K.LDA(0);
      889    12633    5                       F$DCB.TDA=ALTKEYS.K.TDA(0);
      890    12634    5                       F$DCB.TDALVL=ALTKEYS.K.TDALVL(0);
      891    12635    5                       CALL LOCCOD(8) ALTRET(CHK2);
      892    12636    5                       COD$->ALTKEYS.ALTBLD=FM$CFU.ALTBLD;
      893    12637    6                       DO I=0 TO ALTKEYS.NUMENTS-1;
      894    12638    6                          COD$->ALTKEYS.K.FDA(I)=ALTKEYS.K.FDA(I);
      895    12639    6                          COD$->ALTKEYS.K.LDA(I)=ALTKEYS.K.LDA(I);
      896    12640    6                          COD$->ALTKEYS.K.TDA(I)=ALTKEYS.K.TDA(I);
      897    12641    6                          COD$->ALTKEYS.K.TDALVL(I)=ALTKEYS.K.TDALVL(I);
      898    12642    6                          END;             /* DO I                               */
      899    12643    5                       END;                /* INDEXED                            */
      900    12644    4                    ELSE
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:30   
      901    12645    5                    DO;                    /* IREL                               */
      902    12646    5                       CODE03.LDA=IRKEYS.K.LDA(0);
      903    12647    5                       F$DCB.TDA=IRKEYS.K.TDA(0);
      904    12648    5                       F$DCB.TDALVL=IRKEYS.K.TDALVL(0);
      905    12649    5                       CALL LOCCOD(20) ALTRET(CHK2);
      906    12650    5                       COD$->CODE20.ALTBLD=FM$CFU.ALTBLD;
      907    12651    6                       DO I=0 TO IRKEYS.NKEYS-1;
      908    12652    6                          CODE20.K.FDA(I)=IRKEYS.K.FDA(I);
      909    12653    6                          CODE20.K.LDA(I)=IRKEYS.K.LDA(I);
      910    12654    6                          CODE20.K.TDA(I)=IRKEYS.K.TDA(I);
      911    12655    6                          CODE20.K.TDALVL(I)=IRKEYS.K.TDALVL(I);
      912    12656    6                          END;             /* DO I                               */
      913    12657    5                       END;                /* IREL                               */
      914    12658    4                    END;                   /* UPDATE ALTKEY INFO                 */
      915    12659    3   CHK2:      CALL LOCCOD(2) ALTRET(CHK16);
      916    12660    3              CODE02.SLIDE=FM$CFU.SLIDE;
      917    12661    3              CODE02.GDA=FM$CFU.GDA;
      918    12662    4              IF DCB$~=ADDR(NIL) THEN DO;
      919    12663    4                 CODE02.TDALVL=F$DCB.TDALVL;
      920    12664    4                 CODE02.TDA=F$DCB.TDA;
      921    12665    4                 END;
      922    12666    3   CHK16:     CALL LOCCOD(16) ALTRET(CHK4);
      923    12667    4              IF DCB$~=ADDR(NIL) THEN DO;
      924    12668    4                 CALL CVTPTR(F$DCB.FORM$,T$);
      925    12669    4                 CODE16=T$->CODE16;
      926    12670    4                 END;
      927    12671    3              END;
      928    12672    2   CHK4:   CALL LOCCOD(4) ALTRET(CHK13);
      929    12673    2           IF NOT FM$CFU.FMOD THEN
      930    12674    2              CODE04.MODIFY.TIME=CODE04.SVMODIFY.TIME;
      931    12675    2           CODE04.SVMODIFY.TIME=0;
      932    12676    2   CHK13:  CALL LOCCOD(13) ALTRET(RET);
      933    12677    2           IF ACCT=':SYMO' AND SN='SYS' THEN
      934    12678    2              FS$DEST.CRASHED='1'B;
      935    12679        /**/
      936    12680    2   RET:    RETURN;
      937    12681        /**/
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:31   
      938    12682    2   ERR:    ERRCODE=20;
      939    12683    2           CALL ERROR;
      940    12684    2           ALTRETURN;
      941    12685    2   END UPFIT;
      942    12686        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:32   
      943    12687    1   DSWRITE: PROC;
      944    12688        /**/
      945    12689        /* LOCAL AUTOMATIC STORAGE */
      946    12690    2   DCL PAGE# UBIN;
      947    12691        /* PPUT */
      948    12692    2   DCL 1 MM$PPUT(0:0) BASED(I$PPUT$) ALIGNED,
      949    12693    2         2 * BIT(18),
      950    12694    2         2 PPNO UBIN(18)UNAL;
      951    12695    2   DCL I$PPUT$ PTR SYMREF;
      952    12696        /**/
      953    12697    2           IF FM$CFU.UGRANS=0 THEN GOTO ERR;
      954    12698    2           OP=OP_DSWRITE;
      955    12699    2           PAGE#=FM$CFUR.HEADPP#;
      956    12700    3           DO I=1 TO FM$CFU.NRECS;
      957    12701    3              IF PAGE#=0 THEN GOTO ERRCHN;
      958    12702    3              MEMDESC.BADDR=PAGE#*4096;
      959    12703    3              POBUF$->PG(I)=I$MEM$->PG(0);
      960    12704    3              PAGE#=MM$PPUT.PPNO(PAGE#);
      961    12705    3              END;
      962    12706    2           IF PAGE#~=0 THEN GOTO ERRCHN;
      963    12707    3           DO I=FM$CFU.NRECS+1 TO 1023;
      964    12708    3              POBUF$->PG(I)=0;
      965    12709    3              END;
      966    12710    2           PAGE#=FM$CFUR.HEADPP#;
      967    12711    2           DA=FM_FRZERO;
      968    12712    2           MIR_ERR = '0'B ;
      969    12713    3           DO I=0 TO FM$CFU.NRECS;
      970    12714    3              FM$GRAN.STAMP.GMOD=DA;
      971    12715    3              CALL DISKCNVRT ALTRET(ERR);
      972    12716    3              IF  ( NOT MIR_FLAG )
      973    12717    3                OR ( MIR_FLAG AND DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER )
      974    12718    3              THEN
      975    12719    3                 CALL IRR$WPAGE
      976    12720    4                 WHENALTRETURN DO;
      977    12721    4                    MSG_IOERR.NAME = SUBSTR(DCT.DEVNM,0,4);
      978    12722    4                    CALL IRR$TYPE6(MSG_IOERR,SIZEW(MSG_IOERR));
      979    12723    4                    IF  MIR_FLAG
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:33   
      980    12724    4                      AND MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
      981    12725    5                    THEN DO ;
      982    12726    5                       DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL;
      983    12727    5                       DCT.STATUS.DOWN = '1'B;
      984    12728    5                       MSG_PART.NAME = SUBSTR(DCT.DEVNM,0,4);
      985    12729    5                       CALL IRR$TYPE6(MSG_PART,SIZEW(MSG_PART));
      986    12730    5                       END;
      987    12731    4                    ELSE
      988    12732    4                       MIR_ERR = '1'B ;
      989    12733    4                    END;
      990    12734    3              IF  MIR_FLAG
      991    12735    3                AND MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
      992    12736    4              THEN DO ;
      993    12737    4                 RV_DCTX = RV_MIRDCTX;
      994    12738    4                 CALL IRR$WPAGE
      995    12739    5                 WHENALTRETURN DO;
      996    12740    5                    MSG_IOERR.NAME = SUBSTR(DCT.DEVNM,0,4);
      997    12741    5                    CALL IRR$TYPE6(MSG_IOERR,SIZEW(MSG_IOERR));
      998    12742    5                    IF  MIR_FLAG
      999    12743    5                      AND DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
     1000    12744    6                    THEN DO;
     1001    12745    6                       MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL;
     1002    12746    6                       MIR_DCT$->DCT.STATUS.DOWN = '1'B;
     1003    12747    6                       MSG_PART.NAME = SUBSTR(MIR_DCT$->DCT.DEVNM,0,4);
     1004    12748    6                       CALL IRR$TYPE6(MSG_PART,SIZEW(MSG_PART));
     1005    12749    6                       END;
     1006    12750    5                    ELSE
     1007    12751    5                       MIR_ERR = '1'B ;
     1008    12752    5                    END;
     1009    12753    4                 END ;
     1010    12754    3              IF  MIR_ERR
     1011    12755    3              THEN
     1012    12756    3                 GOTO ERR2 ;
     1013    12757    3              MEMDESC.BADDR=PAGE#*4096;
     1014    12758    3              I$MEM$->PG(0)=POBUF$->PG(0);
     1015    12759    3              POBUF$->PG=I$MEM$->PG;
     1016    12760    3              DA=DA+1;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:34   
     1017    12761    3              PAGE#=MM$PPUT.PPNO(PAGE#);
     1018    12762    3              END;
     1019    12763    2           IF RVF_DEBUG~=0 THEN
     1020    12764    2              CALL PUTNAME(RVF_WRDSMSG,RVF_WRDSMSG.FID,SIZEC(RVF_WRDSMSG.FID));
     1021    12765    2   ERR:    FM$CFUR.HEADPP#=0;              /* DONT TRY TWICE                     */
     1022    12766    2           RETURN;
     1023    12767        /**/
     1024    12768    2   ERR2:   ERRCODE=2;
     1025    12769    2           CALL ERROR;
     1026    12770    2           GOTO ERR;
     1027    12771        /**/
     1028    12772    2   DSERR:  ENTRY;
     1029    12773    2           IF FM$CFUR.HEADPP#=0 THEN RETURN; /* NO ERROR TO REPORT               */
     1030    12774        /**/
     1031    12775    2   ERRCHN: ERRCODE=50;
     1032    12776    2           MISC1=FM$CFUR.HEADPP#;
     1033    12777    2           MISC2=PAGE#;
     1034    12778    2           CALL ERROR;
     1035    12779    2           GOTO ERR;
     1036    12780    2   END DSWRITE;
     1037    12781        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:35   
     1038    12782    1   GETFDFIT: PROC ALTRET;
     1039    12783        /**/
     1040    12784        /* LOCAL AUTOMATIC STORAGE */
     1041    12785    2   DCL 1 STAMP,
     1042    12786    2         2 HASH UBIN(27) UNAL,
     1043    12787    2         2 GMOD UBIN(9) UNAL;
     1044    12788    2   DCL T$ PTR;
     1045    12789        /* BASED */
     1046    12790    2   DCL 1 HSH BASED(T$) ALIGNED,
     1047    12791    2         2 B1 UBIN(27) UNAL,
     1048    12792    2         2 * BIT(18),
     1049    12793    2         2 B2 UBIN(27) UNAL;
     1050    12794    2   DCL 1 HSH1 BASED(T$) ALIGNED,
     1051    12795    2         2 * BIT(24),
     1052    12796    2         2 B3 UBIN(27) UNAL;
     1053    12797        /**/
     1054    12798    2           DA=FM$CFUA.FDFITSDA;
     1055    12799    2           IF DA<FM_SRZERO THEN
     1056    12800    2              GOTO ERR1;
     1057    12801    2           CALL READ ALTRET(ERR);
     1058    12802    2           STAMP.GMOD=DA;
     1059    12803    2           T$=ADDR(FM$CFUA.ACCT);
     1060    12804    2           STAMP.HASH=HSH.B1+HSH.B2+HSH1.B3;
     1061    12805    2           MISC1=POBUF$->PG(0);
     1062    12806    2           MISC2=BITBIN(STAMP);
     1063    12807    2           IF STAMP~=FM$GRAN.STAMP THEN
     1064    12808    2              GOTO ERR5;
     1065    12809    2           MISC2=POBUF$->PG(1);
     1066    12810    2           IF FM$GRAN.ORG~=0 THEN
     1067    12811    2              GOTO ERR3;
     1068    12812    2           IF FM$GRAN.LVL~=FMGTFD THEN
     1069    12813    2              GOTO ERR4;
     1070    12814    2           RETURN;
     1071    12815        /**/
     1072    12816    2   GETGPFIT: ENTRY ALTRET;
     1073    12817    2           DA=FM_GPSDA;
     1074    12818    2           CALL READ ALTRET(ERR);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:36   
     1075    12819    2           IF FM$GRAN.STAMP~=FM_GPSTAMP THEN
     1076    12820    2              GOTO ERR5;
     1077    12821    2           IF FM$GRAN.ORG~=0 THEN
     1078    12822    2              GOTO ERR3;
     1079    12823    2           IF FM$GRAN.LVL~=FMGTGP THEN
     1080    12824    2              GOTO ERR4;
     1081    12825    2           RETURN;
     1082    12826        /**/
     1083    12827    2   ERR1:   ERRCODE=1; GOTO ERR;
     1084    12828    2   ERR3:   ERRCODE=3; GOTO ERR;
     1085    12829    2   ERR4:   ERRCODE=4; GOTO ERR;
     1086    12830    2   ERR5:   ERRCODE=5; GOTO ERR;
     1087    12831        /**/
     1088    12832    2   ERR:    CALL ERROR;
     1089    12833    2           ALTRETURN;
     1090    12834    2   END GETFDFIT;
     1091    12835        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:37   
     1092    12836    1   UPFDFIT: PROC ALTRET;
     1093    12837        /**/
     1094    12838    2           FIT$=PINCRW(POBUF$,SIZEW(FM$GRAN));
     1095    12839    2           CALL LOCCOD(14) ALTRET(ERR20);
     1096    12840    2           CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;
     1097    12841    2           RETURN;
     1098    12842        /**/
     1099    12843    2   ERR20:  ERRCODE=20; GOTO ERR;
     1100    12844        /**/
     1101    12845    2   ERR:    ALTRETURN;
     1102    12846    2   END UPFDFIT;
     1103    12847        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:38   
     1104    12848    1   ADDLIST: PROC;
     1105    12849        /**/
     1106    12850    2           CALL LOCCOD(3) ALTRET(ERR);
     1107    12851    2           CODE03.NSTAMP=BITBIN('442443403400'O); /* Magic stamp                 */
     1108    12852    2           RELBUF.LINK=FM$SET.CHKSM(SETX);
     1109    12853    2           FM$SET.CHKSM(SETX)=DA;
     1110    12854    2           IF DCB$~=ADDR(NIL) AND ACCT$~=ADDR(NIL) THEN
     1111    12855    3              IF F$DCB.BORROW<0 THEN DO;
     1112    12856    3                 FM$CFUA.GRANS=FM$CFUA.GRANS-F$DCB.BORROW;
     1113    12857    3                 FM$CFUA.GMOD=1;
     1114    12858    3                 END;
     1115    12859    2           IF RVF_DEBUG~=0 THEN
     1116    12860    2              CALL PUTNAME(RVF_RELFILE,RVF_RELFILE.FID,SIZEC(RVF_RELFILE.FID));
     1117    12861    2   ERR:    RETURN;
     1118    12862    2   END ADDLIST;
     1119    12863        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:39   
     1120    12864    1   PUTNAME: PROC(MSG,FID,FIDSIZ);
     1121    12865    2   DCL MSG CHAR(112);
     1122    12866    2   DCL FID CHAR(12);
     1123    12867    2   DCL FIDSIZ UBIN;
     1124    12868        /* CONSTANT */
     1125    12869    2   DCL I UBIN;
     1126    12870    2   DCL J UBIN;
     1127    12871        /**/
     1128    12872    2           CALL INSERT(FID,0,FIDSIZ,' ');
     1129    12873    2           I=0;
     1130    12874    3           IF ASN=%FILE# THEN DO;
     1131    12875    3              CALL INSERT(FID,I,2,'DP');
     1132    12876    3              I=I+2;
     1133    12877    3              END;
     1134    12878    2           ELSE
     1135    12879    3              IF ASN=%COMGROUP# THEN DO;
     1136    12880    3                 CALL INSERT(FID,I,2,'CG');
     1137    12881    3                 I=I+2;
     1138    12882    3                 END;
     1139    12883    2           J=0;
     1140    12884    3           DO WHILE(SUBSTR(SN,J,1)~=' ' AND J<6);
     1141    12885    3              J=J+1;
     1142    12886    3              END;
     1143    12887    3           IF J~=0 THEN DO;
     1144    12888    3              CALL INSERT(FID,I,J+1,'#',SUBSTR(SN,0,J));
     1145    12889    3              I=I+J+1;
     1146    12890    3              END;
     1147    12891    3           IF NAME$~=ADDR(NIL) THEN DO;
     1148    12892    3              J=FM$CFUN.L;
     1149    12893    3              IF J>31 THEN J=31;
     1150    12894    3              CALL INSERT(FID,I,J+1,'/',SUBSTR(FM$CFUN.C,0,J));
     1151    12895    3              I=I+J+1;
     1152    12896    3              END;
     1153    12897    3           IF ACCT~=' ' THEN DO;
     1154    12898    3              CALL INSERT(FID,I,9,'.',ACCT);
     1155    12899    3              I=I+9;
     1156    12900    3              END;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:40   
     1157    12901    2           I=(I+POFFC(ADDR(FID),ADDR(MSG))+3)/4;
     1158    12902    2           CALL IRR$TYPE6(MSG,I);
     1159    12903    2           RETURN;
     1160    12904    2   END PUTNAME;
     1161    12905        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:41   
     1162    12906    1   CVTPTR: PROC(IP$,OP$) ALTRET;
     1163    12907        /* PARAMETERS */
     1164    12908    2   DCL 1 IP$ ALIGNED,
     1165    12909    2         2 * BIT(24),
     1166    12910    2         2 SEGID BIT(12);
     1167    12911    2   DCL 1 OP$ ALIGNED,
     1168    12912    2         2 * BIT(24),
     1169    12913    2         2 SEGID BIT(12);
     1170    12914        /* LOCAL AUTOMATIC STORAGE */
     1171    12915    2   DCL I UBIN;
     1172    12916        /* CONSTANT */
     1173    12917        %SUB SEGNUM#=10;
     1174    12918    2   DCL 1 SEGTAB(0:SEGNUM#) CONSTANT SYMDEF,
     1175    12919    2         2 MONSID BIT(12) ALIGNED INIT(
     1176    12920    2           %REALSID,
     1177    12921    2           %TIGRSID,
     1178    12922    2           %ISSID,
     1179    12923    2           %ISBSID,
     1180    12924    2           %DS1SID,
     1181    12925    2           %BUFSID,
     1182    12926    2           %ROSID,
     1183    12927    2           %RONCSID,
     1184    12928    2           %CGPTSID,
     1185    12929    2           %CGCTXTSID,
     1186    12930    2           %DVTTBLSID),
     1187    12931    2         2 RV$ PTR INIT(
     1188    12932    2           ADDR(I$REAL$),
     1189    12933    2           ADDR(I$RV1$),
     1190    12934    2           ADDR(I$MONIS$),
     1191    12935    2           ADDR(I$MONIS$),
     1192    12936    2           ADDR(R$CFU$),
     1193    12937    2           ADDR(R$BUFF$),
     1194    12938    2           ADDR(R$ROSEG$),
     1195    12939    2           ADDR(R$ROSEG$),
     1196    12940    2           ADDR(R$CGPT$),
     1197    12941    2           ADDR(R$CGCTXT$),
     1198    12942    2           ADDR(R$DVT$));
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:42   
     1199    12943        /* BASED */
     1200    12944    2   DCL 1 P BASED ALIGNED,
     1201    12945    2         2 * BIT(24),
     1202    12946    2         2 SEGID BIT(12);
     1203    12947        /**/
     1204    12948    3           DO I=0 TO SEGNUM#;
     1205    12949    4              IF IP$.SEGID=SEGTAB.MONSID(I) THEN DO;
     1206    12950    4                 OP$=IP$;
     1207    12951    4                 OP$.SEGID=SEGTAB.RV$(I)->P.SEGID;
     1208    12952    4                 RETURN;
     1209    12953    4                 END;
     1210    12954    3              END;
     1211    12955    2           MISC1=BITBIN(IP$); MISC2=0;
     1212    12956    2           ERRCODE=30;
     1213    12957    2           CALL ERROR;
     1214    12958    2           ALTRETURN;
     1215    12959    2   END CVTPTR;
     1216    12960        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:43   
     1217    12961    1   WRITECHK: PROC ALTRET;
     1218    12962    2   DCL GMOD UBIN(9);
     1219    12963        /**/
     1220    12964    2           GMOD=DA;
     1221    12965    3           IF GMOD~=FM$GRAN.STAMP.GMOD THEN DO;
     1222    12966    3   ERR5:      ERRCODE=5;
     1223    12967    3              MISC1=POBUF$->PG(0);
     1224    12968    3              ADDR(MISC2)->FM$GRAN.STAMP.HASH=F$DCB.HASH;
     1225    12969    3              ADDR(MISC2)->FM$GRAN.STAMP.GMOD=GMOD;
     1226    12970    3              CALL ERROR;
     1227    12971    3              ALTRETURN;
     1228    12972    3              END;
     1229    12973    2           IF DA<FM_SRZERO THEN
     1230    12974    2              IF F$DCB.HASH~=FM$GRAN.STAMP.HASH THEN
     1231    12975    2                 GOTO ERR5;
     1232    12976        /**/
     1233    12977    2   WRITE:  ENTRY ALTRET;
     1234    12978        /**/
     1235    12979    2           CALL DISKCNVRT ALTRET(ERR);
     1236    12980    2           MIR_ERR = '0'B ;
     1237    12981    2           IF  ( NOT MIR_FLAG )
     1238    12982    2             OR ( MIR_FLAG AND DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER )
     1239    12983    2           THEN
     1240    12984    2              CALL IRR$WPAGE
     1241    12985    3              WHENALTRETURN DO;
     1242    12986    3                 MSG_IOERR.NAME = SUBSTR(DCT.DEVNM,0,4);
     1243    12987    3                 CALL IRR$TYPE6(MSG_IOERR,SIZEW(MSG_IOERR));
     1244    12988    3                 IF  MIR_FLAG
     1245    12989    3                   AND MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
     1246    12990    4                 THEN DO ;
     1247    12991    4                    DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL;
     1248    12992    4                    DCT.STATUS.DOWN = '1'B;
     1249    12993    4                    MSG_PART.NAME = SUBSTR(DCT.DEVNM,0,4);
     1250    12994    4                    CALL IRR$TYPE6(MSG_PART,SIZEW(MSG_PART));
     1251    12995    4                    END;
     1252    12996    3                 ELSE
     1253    12997    3                    MIR_ERR = '1'B ;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:44   
     1254    12998    3                 END;
     1255    12999    2           IF  MIR_FLAG
     1256    13000    2             AND MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
     1257    13001    3           THEN DO ;
     1258    13002    3              RV_DCTX = RV_MIRDCTX;
     1259    13003    3              CALL IRR$WPAGE
     1260    13004    4              WHENALTRETURN DO;
     1261    13005    4                 MSG_IOERR.NAME = SUBSTR(DCT.DEVNM,0,4);
     1262    13006    4                 CALL IRR$TYPE6(MSG_IOERR,SIZEW(MSG_IOERR));
     1263    13007    4                 IF  MIR_FLAG
     1264    13008    4                   AND DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
     1265    13009    5                 THEN DO;
     1266    13010    5                    MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL;
     1267    13011    5                    MIR_DCT$->DCT.STATUS.DOWN = '1'B;
     1268    13012    5                    MSG_PART.NAME = SUBSTR(MIR_DCT$->DCT.DEVNM,0,4);
     1269    13013    5                    CALL IRR$TYPE6(MSG_PART,SIZEW(MSG_PART));
     1270    13014    5                    END;
     1271    13015    4                 ELSE
     1272    13016    4                    MIR_ERR = '1'B ;
     1273    13017    4                 END;
     1274    13018    3              END ;
     1275    13019    2           IF  MIR_ERR
     1276    13020    2           THEN
     1277    13021    2              GOTO ERR2 ;
     1278    13022    2           RETURN;
     1279    13023        /**/
     1280    13024    2   ERR2:   ERRCODE=2;
     1281    13025    2           CALL ERROR;
     1282    13026    2   ERR:    ALTRETURN;
     1283    13027        /**/
     1284    13028    2   READ:   ENTRY ALTRET;
     1285    13029        /**/
     1286    13030    2           CALL DISKCNVRT ALTRET(ERR);
     1287    13031    2           CALL IRR$RPAGE ALTRET(ERR2);
     1288    13032    2           RETURN;
     1289    13033    2   END WRITECHK;
     1290    13034        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:45   
     1291    13035    1   DISKCNVRT: PROC ALTRET;
     1292    13036        /**/
     1293    13037        /* LOCAL AUTOMATIC STORAGE */
     1294    13038    2   DCL SRDA SBIN;
     1295    13039    2   DCL XTX UBIN;
     1296    13040    2   DCL XTX$ PTR;
     1297    13041    2   DCL I UBIN;
     1298    13042    2   DCL NGRAN SBIN;
     1299    13043    2   DCL SIZ UBIN;
     1300    13044    2   DCL RELADDR SBIN;
     1301    13045    2   DCL PACKSIZE UBIN;
     1302    13046    2   DCL NI$DVT$$ PTR;
     1303    13047    2   DCL MPC$ PTR;
     1304    13048    2   DCL MIR_SQH$ PTR;
     1305    13049    2   DCL MIR_DQH$ PTR;
     1306    13050        /* BASED STRUCTURES */
     1307    13051        %FM$CFUEXT (BASED="BASED(XTX$)");
     1308    13055        %FM$VOL (BASED="BASED(F$CFU$)");
     1309    13061        /**/
     1310    13062    3           IF DA<=FM_FRMAX THEN DO;
     1311    13063    3              SRDA=DA-FM_FRZERO;
     1312    13064    3              IF SRDA<0 THEN GOTO ERR1;
     1313    13065    3              IF SRDA>=FM$CFU.UGRANS THEN GOTO ERR1;
     1314    13066    3              XTX=FM$CFU.XTX;
     1315    13067    3              IF XTX~=1 THEN
     1316    13068    4              DO WHILE(XTX~=0);
     1317    13069    4                 XTX$=PINCRW(R$CFU$,XTX);
     1318    13070    4                 I=0;
     1319    13071    5                 DO WHILE(I<FM$CFUEXT.NUM);
     1320    13072    5                    NGRAN=FM$CFUEXT.XTNT.XTNSIZE(I);
     1321    13073    5                    IF NGRAN~=0 THEN
     1322    13074    5                       SIZ=1;
     1323    13075    6                    ELSE DO;
     1324    13076    6                       SIZ=2;
     1325    13077    6                       NGRAN=FM$CFUEXT.EXTNT.XTNSIZE(I);
     1326    13078    6                       END;
     1327    13079    6                    IF NGRAN>SRDA THEN DO;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:46   
     1328    13080    6                       SRDA=SRDA+FM$CFUEXT.XTNT.XTNSDA(I);
     1329    13081    6                       GOTO GOTSR;
     1330    13082    6                       END;
     1331    13083    5                    SRDA=SRDA-NGRAN;
     1332    13084    5                    I=I+SIZ;
     1333    13085    5                    END;
     1334    13086    4                 XTX=FM$CFUEXT.LINKX;
     1335    13087    4                 END;
     1336    13088    4              ELSE DO;
     1337    13089    4                 SRDA=FM$CFU.FITSDA+SRDA;
     1338    13090    4                 GOTO GOTSR;
     1339    13091    4                 END;
     1340    13092    3              GOTO ERR1;
     1341    13093    3              END;
     1342    13094    2           ELSE
     1343    13095    2              SRDA=DA;
     1344    13096        /**/
     1345    13097    2   GOTSR:  IF SRDA<FM_SRZERO THEN GOTO ERR1;
     1346    13098        /**/
     1347    13099    2           RELADDR=FM$CFUX.SETH;
     1348    13100    3           DO WHILE(RELADDR~=0 AND SETX~=RELADDR);
     1349    13101    3              RELADDR=FM$SET.SETL(RELADDR);
     1350    13102    3              END;
     1351    13103    3           IF RELADDR~=0 THEN DO;
     1352    13104    3              IF NOT FM$SET.SET(RELADDR) THEN GOTO ERR1;
     1353    13105    3              END;
     1354    13106    2           IF RELADDR=0 OR SRDA>=FM$SET.NXTSDA(RELADDR)
     1355    13107    2             OR FM$SET.DCTX(RELADDR)=0 THEN GOTO ERR1;
     1356    13108    2           RELADDR=SRDA-FM_SRZERO;
     1357    13109    2           CALL CVTPTR(ADDR(N$DCT$$),L$N$DCT$$) ALTRET(ERR);
     1358    13110    2           CALL CVTPTR(L$N$DCT$$->PTR$(0),L$N$DCT$$);
     1359    13111    2           CALL CVTPTR(ADDR(NI$DVT$),NI$DVT$$) ALTRET(ERR);
     1360    13112    2           DCTX=FM$SET.DCTX(SETX);
     1361    13113    3           DO WHILE(DCTX~=0);
     1362    13114    3              PACKSIZE=FM$VOL.NXTSDA(DCTX)-FM_SRZERO;
     1363    13115    4              IF RELADDR<PACKSIZE THEN DO;
     1364    13116    4                 RELADDR=RELADDR+FM$VOL.DRZERO(DCTX);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:47   
     1365    13117    4                 DCTX=FM$VOL.DCTX(DCTX);
     1366    13118    4                 CALL CVTPTR(L$N$DCT$$->PTR$(DCTX),DCT$) ALTRET(ERR);
     1367    13119    4                 CALL CVTPTR(DCT.DVT$,DVT$) ALTRET(ERR);
     1368    13120    4                 GOTO GOTDR;
     1369    13121    4                 END;
     1370    13122    3              RELADDR=RELADDR-PACKSIZE;
     1371    13123    3              DCTX=FM$VOL.VOLL(DCTX);
     1372    13124    3              END;
     1373    13125    2           GOTO ERR1;
     1374    13126        /**/
     1375    13127    2   GOTDR:  DCTX=DCT.DCTX;
     1376    13128    2           RV_WDGRAN=RELADDR;
     1377    13129    2           RV_NSPG=DVT.GRANSIZE;
     1378    13130    2   GETADR: IOADR.DEV=DCT.DVN;
     1379    13131    2           SQH$=DCT.SQH$;
     1380    13132    2           CALL CVTPTR(SQH$,SQH$) ALTRET(ERR);
     1381    13133    2           CALL CVTPTR(SQH.CQ$,DQH$) ALTRET(ERR);
     1382    13134    2           IOADR.IOM=DQH.IOCHAN.IOM;
     1383    13135    2           IOADR.CHAN=DQH.IOCHAN.CHANNEL;
     1384    13136    3           IF DCT.DP.MIRROR.FLAG THEN DO;
     1385    13137    3              MIR_FLAG = '1'B;
     1386    13138    3              MIR_DCTX = DCT.DP.MIRROR.DCTX;
     1387    13139    3              CALL CVTPTR(L$N$DCT$$->PTR$(MIR_DCTX),MIR_DCT$) ALTRET(ERR);
     1388    13140    3              CALL CVTPTR(MIR_DCT$->DCT.SQH$,MIR_SQH$) ALTRET(ERR);
     1389    13141    3              CALL CVTPTR(MIR_SQH$->SQH.CQ$,MIR_DQH$) ALTRET(ERR);
     1390    13142    3              MIR_IOADR.DEV = MIR_DCT$->DCT.DVN;
     1391    13143    3              MIR_IOADR.IOM = MIR_DQH$->DQH.IOCHAN.IOM;
     1392    13144    3              MIR_IOADR.CHAN = MIR_DQH$->DQH.IOCHAN.CHANNEL;
     1393    13145    3              MSG_IOERR.TYPE = ' MIRRORED ' ;
     1394    13146    3              END;
     1395    13147    3           ELSE DO;
     1396    13148    3              MIR_FLAG = '0'B;
     1397    13149    3              RV_MIRDCTX = 0;
     1398    13150    3              MIR_DCTX = 0;
     1399    13151    3              MSG_IOERR.TYPE = ' UNMIRRORED ' ;
     1400    13152    3              END;
     1401    13153    2           RETURN;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:48   
     1402    13154        /**/
     1403    13155    2   DCTCNVRT: ENTRY ALTRET;
     1404    13156        /**/
     1405    13157    2           CALL CVTPTR(ADDR(N$DCT$$),L$N$DCT$$) ALTRET(ERR);
     1406    13158    2           DCT$=L$N$DCT$$->PTR$(DCTX);
     1407    13159    2           CALL CVTPTR(DCT$,DCT$) ALTRET(ERR);
     1408    13160    2           GOTO GETADR;
     1409    13161        /**/
     1410    13162        /**/
     1411    13163    2   ERR1:   ERRCODE=1;
     1412    13164    2           CALL ERROR;
     1413    13165    2   ERR:    ALTRETURN;
     1414    13166    2   END DISKCNVRT;
     1415    13167        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:49   
     1416    13168    1   LOCCOD: PROC(CODE) ALTRET;
     1417    13169        /* PARAMETERS */
     1418    13170    2   DCL CODE UBIN;
     1419    13171        /* LOCAL AUTOMATIC STORAGE */
     1420    13172    2   DCL N UBIN;
     1421    13173    2   DCL I UBIN;
     1422    13174        /**/
     1423    13175    2           N=FM$FIT.CODES.CODE(0);
     1424    13176    3           DO I=1 TO N;
     1425    13177    4              IF FM$FIT.CODES.CODE(I)=CODE THEN DO;
     1426    13178    4                 COD$=PINCRW(FIT$,FM$FIT.CODES.ITEMX(I));
     1427    13179    4                 RETURN;
     1428    13180    4                 END;
     1429    13181    3              END;
     1430    13182    2           ALTRETURN;
     1431    13183    2   END LOCCOD;
     1432    13184        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:50   
     1433    13185    1   ERROR:  PROC;
     1434    13186        /* LOCAL AUTOMATIC STORAGE */
     1435    13187    2   DCL I UBIN;
     1436    13188        /*
     1437    13189        ERROR CODES:
     1438    13190                1  - Bad DA
     1439    13191                2  - I/O error
     1440    13192                3  - ORG wrong
     1441    13193                4  - LVL wrong
     1442    13194                5  - Granule stamp wrong
     1443    13195                13 - No code 1 in FIT
     1444    13196                14 - Extent entry wrong size
     1445    13197                15 - CODE01.STAMP wrong
     1446    13198                19 - Name hash wrong
     1447    13199                20 - Missing FIT code
     1448    13200                30 - Convert pointer error
     1449    13201                31 - DCB is streamed to itsself
     1450    13202                40 - CG CFU$ not correct
     1451    13203                41 - SELF$ pointer in granule header is wrong
     1452    13204                42 - CG recovery area not big enough
     1453    13205                43 - CG CTL granule header bad
     1454    13206                44 - CG CTL granule doesn't contain a context block
     1455    13207                45 - Granule stamp hash is wrong
     1456    13208                50 - Shared data segment page chain bad
     1457    13209        */
     1458    13210        /**/
     1459    13211        /**/
     1460    13212    2           RVF_ERRCNT=RVF_ERRCNT+1;
     1461    13213    2           IF RVF_ERRCNT>15 THEN
     1462    13214    2              RETURN;                      /* Only print first 15                */
     1463    13215    3           DO I=0 TO 4;
     1464    13216    3              RVF_ERRMSG.DCBA(I)=BINASC(DCBR.ADR(I)+48);
     1465    13217    3              RVF_ERRMSG.CFU(I)=BINASC(CFU.ADR(I)+48);
     1466    13218    3              END;
     1467    13219    2           CALL BINCHAR(RVF_ERRMSG.PH,PHASE);
     1468    13220    2           CALL BINCHAR(RVF_ERRMSG.OP,OP);
     1469    13221    2           CALL BINCHAR(RVF_ERRMSG.ERR,ERRCODE);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:51   
     1470    13222    2           CALL PUTNAME(RVF_ERRMSG,RVF_ERRMSG.FID,SIZEC(RVF_ERRMSG.FID));
     1471    13223    3           IF MISC1~=0 OR MISC2~=0 THEN DO;
     1472    13224    4              DO I=0 TO 11;
     1473    13225    4                 RVF_MISCMSG.M1(I)=BINASC(MSC1(I)+48);
     1474    13226    4                 RVF_MISCMSG.M2(I)=BINASC(MSC2(I)+48);
     1475    13227    4                 END;
     1476    13228    3              CALL IRR$TYPE6(RVF_MISCMSG,SIZEW(RVF_MISCMSG));
     1477    13229    3              MISC1=0; MISC2=0;
     1478    13230    3              END;
     1479    13231    2           RETURN;
     1480    13232    2   END ERROR;
     1481    13233        /**/
     1482    13234    1   END IRF$CLSF;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:52   
--  Include file information  --

   UE_CP6.:E05TOU  is referenced.
   IR_DATA_M.:E05TOU  is referenced.
   IRF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   HF_DATA_R.:E05TOU  is referenced.
   KQM_MAC_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   FT_SUBS.:E05TOU  is referenced.
   FT$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FS$FIT.:E05TOU  is referenced.
   FM_FIELD_C.:E05TOU  is referenced.
   FM_CACHE_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure IRF$CLSF.

   Procedure IRF$CLSF requires 2954 words for executable code.
   Procedure IRF$CLSF requires 112 words of local(AUTO) storage.
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:53   

    No errors detected in file IRF$CLSF.:E05TSI    .

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:54   

 Object Unit name= IRF$CLSF                                   File name= IRF$CLSF.:E05TOU
 UTS= JUL 29 '97 22:43:30.52 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     2      2  IRF$CLSF
    1  RoData even  UTS    174    256  IRF$CLSF
    2   Proc  even  none  2954   5612  IRF$CLSF
    3  RoData even  none    74    112  IRF$CLSF

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        0  IRF$CLSF
     2   1015          yes     yes      Std        0  IRF$CFUS
     2   1555          yes     yes      Std        0  IRF$DUMPCG

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      7  RVF_DEBUG                          1     10  RVF_PATCH
    1    212  SEGTAB
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:55   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 IRR$WRASC
         yes           Std       2 IRR$TYPE6
 yes     yes           Std       1 IRR$WRBIN
 yes     yes           Std       0 IRR$SPRECB
 yes     yes           Std       0 IRR$WPOBUFF
 yes     yes           Std       0 IRR$WPAGE
 yes     yes           Std       0 IRR$RPAGE
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     RVF_ERRCNT                            RVF_ERRMSG                            RVF_CLSDCB
     RVF_CLSCFU                            RVF_CLSFD                             RVF_CLSUSR
     RVF_RELFILE                           RVF_CLSBFR                            RVF_RELGRAN
     RVF_DUMPCG                            RVF_CGTRAP                            RVF_WRDSMSG
     RVF_MISCMSG                           POBUF                                 R$CFU$
     FMC_CACHE$                            FM_SYSSETX                            KQ_MMSD$
     R$BUFF$                               R$ROSEG$                              I$RV1$
     I$REAL$                               I$MONIS$                              I$JITU$
     R$CGPT$                               R$CGCTXT$                             R$DVT$
     RV_UNWIND1                            RV_NXTGRAN                            RV_DCTX
     RV_WDGRAN                             RV_NSPG                               NI$DVT$
     N$DCT$$                               MEMDESC                               I$MEM$
     RV_CUN                                MSG_IOERR                             MSG_PART
     RV_BUFF                               S1000_FLG                             B$IPHYMAP$
     I$PPUT$                               B_VECTNIL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:56   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:57   


        1        1        /*M*  IRF$CLSF - Close DCBs during hard system crash */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8        /**/
        9        9        /**/
       10       10        IRF$CLSF: PROC ALTRET;

     10  2 000000   000000 700200 xent  IRF$CLSF     TSX0  ! X66_AUTO_0
         2 000001   000160 000000                    ZERO    112,0

       11       11        /* LOCAL STORAGE */
       12       12    1   DCL DA UBIN;
       13       13    1   DCL I UBIN;
       14       14    1   DCL J UBIN;
       15       15    1   DCL SJ REDEF J SBIN;
       16       16    1   DCL NUMDCBS UBIN;
       17       17    1   DCL B$JIT$ PTR;
       18       18    1   DCL DCB$ PTR;
       19       19    1   DCL 1 DCBR REDEF DCB$,
       20       20    1         2 * BIT(3),
       21       21    1         2 ADR(0:4) UBIN(3) UNAL,
       22       22    1         2 * BIT(18);
       23       23    1   DCL DCBPTR$ PTR;
       24       24    1   DCL CFU$ PTR;
       25       25    1   DCL 1 CFU REDEF CFU$,
       26       26    1         2 * BIT(3),
       27       27    1         2 ADR(0:4) UBIN(3) UNAL,
       28       28    1         2 * BIT(18);
       29       29    1   DCL DSB$ PTR;
       30       30    1   DCL 1 CTX,
       31       31    1         2 DISP UBIN(24) UNAL,
       32       32    1         2 SID UBIN(12) UNAL;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:58   
       33       33    1   DCL CTX$ REDEF CTX PTR;
       34       34    1   DCL CACHE$ PTR;
       35       35    1   DCL SETX UBIN;
       36       36    1   DCL DCTX UBIN;
       37       37    1   DCL CFUX UBIN;
       38       38    1   DCL ACCTX UBIN;
       39       39    1   DCL ACCT$ PTR;
       40       40    1   DCL NAME$ PTR;
       41       41    1   DCL NAMEX UBIN;
       42       42    1   DCL SN CHAR(6);
       43       43    1   DCL ACCT CHAR(8);
       44       44    1   DCL ASN UBIN;
       45       45    1   DCL ERRCODE UBIN;
       46       46    1   DCL OP UBIN;
       47       47    1   DCL PHASE UBIN;
       48       48    1   DCL REMUNWIND REMEMBER DALIGNED;
       49       49    1   DCL DUMPFLG UBIN;
       50       50    1   DCL FIT$ PTR;
       51       51    1   DCL ALTKEY$ PTR;
       52       52    1   DCL COD$ PTR;
       53       53    1   DCL SYSSETX UBIN;
       54       54    1   DCL MISC1 UBIN;
       55       55    1   DCL MSC1(0:11) REDEF MISC1 UBIN(3) UNAL;
       56       56    1   DCL MISC1B REDEF MISC1 BIT(36);
       57       57    1   DCL MISC1$ REDEF MISC1 PTR;
       58       58    1   DCL MISC2 UBIN;
       59       59    1   DCL MSC2(0:11) REDEF MISC2 UBIN(3) UNAL;
       60       60    1   DCL MISC2$ REDEF MISC2 PTR;
       61       61    1   DCL OLDCTX$ PTR;
       62       62    1   DCL N SBIN;
       63       63    1   DCL PGTBL (0:299) BIT(1) UNAL;
       64       64        /* INCLUDE FILES */
       65       65    1   DCL DCT$ PTR;
       66       66    1   DCL DVT$ PTR;
       67       67    1   DCL SQH$ PTR;
       68       68    1   DCL DQH$ PTR;
       69       69    1   DCL L$N$DCT$$ PTR;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:59   
       70       70    1   DCL MIR_DCT$ PTR;
       71       71    1   DCL RV_MIRDCTX UBIN STATIC INIT(0);
       72       72    1   DCL 1 MIR_IOADR REDEF RV_MIRDCTX,
       73       73    1         2 CHAN UBIN(9) UNAL,
       74       74    1         2 DEV UBIN(6) UNAL,
       75       75    1         2 IOM UBIN(2) UNAL,
       76       76    1         2 * UBIN(19) UNAL;
       77       77    1   DCL   MIR_FLAG BIT(1) STATIC INIT('0'B);
       78       78    1   DCL   MIR_ERR BIT(1) ALIGNED AUTO ;
       79       79    1   DCL   MIR_DCTX UBIN ALIGNED AUTO ;
       80       80        %INCLUDE B$JIT;
       81      683        %INCLUDE B$MAP;
       82      782        %MACRO B$ROSEG(BASED=BASED);
       83      783        %INCLUDE B$ROSEG;
       84      846        %MEND;
       85      847        %MACRO F$DCB(BASED=BASED);
       86      848        %INCLUDE F$DCB;
       87      897        %MEND;
       88      898        %INCLUDE B_MACROS_C;
       89     1009        %INCLUDE B_SEGIDS_C;
       90     1548        %INCLUDE CP_6_SUBS;
       91     2088        %INCLUDE FM$MACROS;
       92     2463        %INCLUDE FM_CACHE_C;
       93     2529        %INCLUDE FM_FIELD_C;
       94     2570        %INCLUDE FS$FIT;
       95     2613        %INCLUDE FT$LBLS;
       96     2881        %INCLUDE FT_SUBS;
       97     2961        %INCLUDE F_CP6;
       98     3986        %INCLUDE KC$CP6V_C;
       99     4106        %INCLUDE KC_CP6;
      100     4666        %INCLUDE KC$CGBLK;
      101     4714        %INCLUDE KI_CP6;
      102     5810        %INCLUDE KQ_MAC_C;
      103     8360        %INCLUDE KQM_MAC_C;
      104     8733        %INCLUDE KQ_SUBS_C;
      105     9033        %INCLUDE M_INFO_C;
      106     9173        %INCLUDE NI$TABLES;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:60   
      107     9389        %INCLUDE NI_DATA_C;
      108     9502        /* This is to take the "READONLY" off of the DCLs in IRF_DATA_R.
      109     9503           The reason this is done is because AARDVARKs "STATIC" data
      110     9504           has to reside in the PROCEDURE because of the way PO tapes
      111     9505           are created by DEV.
      112     9506        */
      113     9507        %SUB READONLY = " ";
      114     9508        %INCLUDE IRF_DATA_R;
      115     9524        %INCLUDE IR_DATA_M;
      116     9688        %INCLUDE UE_CP6;
      117    10379        /* EXTERNAL DATA */
      118    10380    1   DCL POBUF UBIN SYMREF;
      119    10381    1   DCL R$CFU$ PTR SYMREF;
      120    10382    1   DCL F$CFU$ REDEF R$CFU$ PTR;
      121    10383    1   DCL FMC_CACHE$ PTR SYMREF;
      122    10384    1   DCL FM_SYSSETX UBIN SYMREF;
      123    10385    1   DCL KQ_MMSD$ PTR SYMREF;
      124    10386    1   DCL R$BUFF$ PTR SYMREF;
      125    10387    1   DCL R$ROSEG$ PTR SYMREF;
      126    10388    1   DCL B$ROSEG$ REDEF R$ROSEG$ PTR;
      127    10389    1   DCL I$RV1$ PTR SYMREF;
      128    10390    1   DCL I$REAL$ PTR SYMREF;
      129    10391    1   DCL I$MONIS$ PTR SYMREF;
      130    10392    1   DCL I$JITU$ PTR SYMREF;
      131    10393    1   DCL R$CGPT$ PTR SYMREF;
      132    10394    1   DCL B$CGPT$ REDEF R$CGPT$ PTR;
      133    10395    1   DCL R$CGCTXT$ PTR SYMREF;
      134    10396    1   DCL R$DVT$ PTR SYMREF;
      135    10397    1   DCL RV_UNWIND1 REMEMBER DALIGNED SYMREF;
      136    10398    1   DCL RV_NXTGRAN UBIN SYMREF;
      137    10399    1   DCL RV_DCTX UBIN SYMREF;
      138    10400    1   DCL 1 IOADR REDEF RV_DCTX,
      139    10401    1         2 CHAN UBIN(9) UNAL,
      140    10402    1         2 DEV UBIN(6) UNAL,
      141    10403    1         2 IOM UBIN(2) UNAL,
      142    10404    1         2 * UBIN(19) UNAL;
      143    10405    1   DCL RV_WDGRAN UBIN SYMREF;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:61   
      144    10406    1   DCL RV_NSPG UBIN SYMREF;
      145    10407    1   DCL NI$DVT$ PTR SYMREF;
      146    10408    1   DCL N$DCT$$ PTR SYMREF;
      147    10409    1   DCL 1 MEMDESC SYMREF,
      148    10410    1         2 * UBIN,
      149    10411    1         2 BADDR UBIN;
      150    10412    1   DCL I$MEM$ PTR SYMREF;
      151    10413    1   DCL RV_CUN UBIN SYMREF;
      152    10414    1   DCL 1 MSG_IOERR SYMREF,
      153    10415    1         2 NAME CHAR(4),
      154    10416    1         2 TYPE CHAR(12),
      155    10417    1         2 MSG CHAR(28);
      156    10418    1   DCL 1 MSG_PART SYMREF,
      157    10419    1         2 NAME CHAR(4),
      158    10420    1         2 MSG CHAR(24);
      159    10421        %RV_BUFF (STCLASS=SYMREF);
      160    10457        /* LOCAL CONSTANT DATA */
      161    10458    1   DCL FM_FRZERO CONSTANT UBIN INIT(262144);
      162    10459    1   DCL FM_FRMAX  CONSTANT UBIN INIT(67141631);
      163    10460    1   DCL FM_SRZERO CONSTANT UBIN INIT(67174400);
      164    10461    1   DCL FM_SRMAX  CONSTANT UBIN INIT(134217727);
      165    10462    1   DCL FM_GPSDA CONSTANT UBIN INIT(67174401);
      166    10463    1   DCL FM_GPSTAMP BIT(36)INIT('525252525001'O)CONSTANT;
      167    10464    1   DCL POBUF$ PTR CONSTANT INIT(ADDR(POBUF));
      168    10465    1   DCL RVF_DEBUG CONSTANT SYMDEF UBIN INIT(0);
      169    10466    1   DCL RVF_PATCH(0:99) UBIN CONSTANT SYMDEF INIT(0*0);
      170    10467        %FT_LBL1(NAME=EOF1LABEL,STCLASS=CONSTANT,LABEL_ID='EOF',LABEL_NUM='1');
      171    10502    1   DCL ANSPAD CHAR(18) CONSTANT INIT('^^^^^^^^^^^^^^^^^^');
      172    10503    1   DCL ZEROBITS(0:4) UBIN CONSTANT INIT(0,0,0,0,0);
      173    10504    1   DCL NULPAD REDEF ZEROBITS CHAR(20);
      174    10505        /* EXTERNAL ROUTINES */
      175    10506    1   DCL IRR$RPAGE ENTRY ALTRET;
      176    10507    1   DCL IRR$TYPE6 ENTRY(2);
      177    10508    1   DCL IRR$WPOBUFF ENTRY ALTRET;
      178    10509    1   DCL IRR$WPAGE ENTRY ALTRET;
      179    10510    1   DCL IRR$WRASC ENTRY(1) ALTRET;
      180    10511    1   DCL IRR$WRBIN ENTRY(1) ALTRET;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:62   
      181    10512    1   DCL IRR$SPRECB ENTRY ALTRET;
      182    10513        /* BASED STRUCTURES */
      183    10514        %F$DCB (BASED="BASED(DCB$)");
      184    10564        %B$EXCFR;
      185    10582        %B$ROSEG (BASED="BASED(R$ROSEG$)");
      186    10642        %FM$CFU (BASED="BASED(CFU$)");
      187    10648        %FM$CFUF (BASED="BASED(CFU$)");
      188    10651        %FM$CFUJ (BASED="BASED(CFU$)");
      189    10656        %FM$CFUR (BASED="BASED(CFU$)");
      190    10659        %FM$CFUX;
      191    10664        %FM$SET (BASED="BASED(F$CFU$)");
      192    10669        %FM$CFUN (BASED="BASED(NAME$)");
      193    10672        %FM$CFUA (BASED="BASED(ACCT$)");
      194    10678        %FM$GRAN (BASED="BASED(POBUF$)");
      195    10682        %FMC$CACHE(STCLASS="BASED(CACHE$)");
      196    10705        %FM$FIT  (BASED="BASED(FIT$)");
      197    10708        %CODE01  (BASED="BASED(COD$)");
      198    10712        %CODE02  (BASED="BASED(COD$)");
      199    10716        %CODE03  (BASED="BASED(COD$)");
      200    10723        %CODE04  (BASED="BASED(COD$)");
      201    10731        %FITALTKEYS(FITALTKEYS=ALTKEYS, BASED="BASED(ALTKEY$)");
      202    10737        %FS$DEST (STCLASS="BASED(COD$)");
      203    10745        %CODE14  (BASED="BASED(COD$)");
      204    10755        %CODE16  (BASED="BASED(COD$)");
      205    10763        %CODE20(BASED="BASED(COD$)");
      206    10768        %FMG$IRKEYS(FPTN=IRKEYS, STCLASS="BASED(ALTKEY$)");
      207    10775        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CTX$)");
      208    11514        %KQ_DSB (FPTN=KQ$DSB,STCLASS="BASED(DSB$)");
      209    11557        %KQ_MMSD (FPTN=KQ$MMSD,STCLASS="BASED(KQ_MMSD$)");
      210    11594    1   DCL PTR$(0:0) PTR BASED ALIGNED;
      211    11595    1   DCL PG(0:1023) UBIN BASED ALIGNED;
      212    11596    1   DCL 1 RELBUF BASED(POBUF$) ALIGNED,
      213    11597    1         2 *(0:1022)UBIN,
      214    11598    1         2 LINK UBIN;
      215    11599    1   DCL NCHARS CHAR(N) BASED CALIGNED;
      216    11600        %NI$DCT (NAME=DCT,STCLASS="BASED(DCT$)");
      217    11648        %NI$DVT (NAME=DVT,STCLASS="BASED(DVT$)");
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:63   
      218    11655        %NI$DQH (NAME=DQH,STCLASS="BASED(DQH$)");
      219    11678        %NI$SQH (NAME=SQH,STCLASS="BASED(SQH$)");
      220    11691        /* SUBS */
      221    11692        %SUB OP_DCBPTR=1;
      222    11693        %SUB OP_FFLSH=2;
      223    11694        %SUB OP_TFLSH=3;
      224    11695        %SUB OP_SRCHNM=4;
      225    11696        %SUB OP_SRCHAC=5;
      226    11697        %SUB OP_GETFIT1=6;
      227    11698        %SUB OP_GETFIT2=7;
      228    11699        %SUB OP_CHKFIT=8;
      229    11700        %SUB OP_RELFILS=9;
      230    11701        %SUB OP_CGCLS=10;
      231    11702        %SUB OP_DSWRITE=11;
      232    11703        /**/
      233    11704        /**/
      234    11705        /*
      235    11706                   *********************************
      236    11707                   *  Close all DCBs for one user  *
      237    11708                   *********************************
      238    11709        */
      239    11710        /**/
      240    11711    1           RV_DCTX=0;

  11711  2 000002   000000 450000 xsym               STZ     RV_DCTX

      241    11712    1           ERRCODE=0;

  11712  2 000003   200032 450100                    STZ     ERRCODE,,AUTO

      242    11713    1           OP=0;

  11713  2 000004   200033 450100                    STZ     OP,,AUTO

      243    11714    1           PHASE=0;                        /* Closing one user's DCBs            */

  11714  2 000005   200034 450100                    STZ     PHASE,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:64   

      244    11715    1           SN=' ';

  11715  2 000006   040100 100400                    MLR     fill='040'O
         2 000007   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000010   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

      245    11716    1           ACCT=' ';

  11716  2 000011   000035 235000 xsym               LDA     B_VECTNIL+29
         2 000012   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 000013   200027 755100                    STA     ACCT,,AUTO
         2 000014   200030 756100                    STQ     ACCT+1,,AUTO

      246    11717    1           NAME$=ADDR(NIL);

  11717  2 000015   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000016   200023 756100                    STQ     NAME$,,AUTO

      247    11718    1           CFU$=ADDR(NIL);

  11718  2 000017   200012 756100                    STQ     CFU$,,AUTO

      248    11719    1           ASN=0;

  11719  2 000020   200031 450100                    STZ     ASN,,AUTO

      249    11720    1           CALL BINCHAR(RVF_ERRMSG.USR,RV_CUN);

  11720  2 000021   000000 235000 xsym               LDA     RV_CUN
         2 000022   000044 773000                    LRL     36
         2 000023   200144 757100                    STAQ    J+1,,AUTO
         2 000024   000000 301500                    BTD
         2 000025   200144 000010                    NDSC9   J+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
         2 000026   000004 630003 xsym               NDSC9   RVF_ERRMSG+4             cn=3,s=nosgn,sf=0,n=3

      250    11721    1           MISC1=0;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:65   

  11721  2 000027   200045 450100                    STZ     MISC1,,AUTO

      251    11722    1           MISC2=0;

  11722  2 000030   200046 450100                    STZ     MISC2,,AUTO

      252    11723    1           CALL CVTPTR(ADDR(FMC_CACHE$), CACHE$) ALTRET(ALT);

  11723  2 000031   000000 236000 3                  LDQ     0
         2 000032   200151 756100                    STQ     J+6,,AUTO
         2 000033   200015 630500                    EPPR0   CACHE$,,AUTO
         2 000034   200132 450500                    STP0    @IP$+1,,AUTO
         2 000035   200151 631500                    EPPR1   J+6,,AUTO
         2 000036   200131 451500                    STP1    MIR_DQH$+3,,AUTO
         2 000037   004442 701000 2                  TSX1    CVTPTR
         2 000040   001014 702000 2                  TSX2    ALT

      253    11724    1           CALL CVTPTR(CACHE$->PTR$(0), CACHE$) ALTRET(ALT);

  11724  2 000041   200015 630500                    EPPR0   CACHE$,,AUTO
         2 000042   200132 450500                    STP0    @IP$+1,,AUTO
         2 000043   200015 236100                    LDQ     CACHE$,,AUTO
         2 000044   200131 756100                    STQ     MIR_DQH$+3,,AUTO
         2 000045   004442 701000 2                  TSX1    CVTPTR
         2 000046   001014 702000 2                  TSX2    ALT

      254    11725    2           IF RVF_DEBUG~=0 THEN DO;

  11725  2 000047   000007 235000 1                  LDA     RVF_DEBUG
         2 000050   000072 600000 2                  TZE     s:11731

      255    11726    2              B$JIT$=I$JITU$;

  11726  2 000051   000000 236000 xsym               LDQ     I$JITU$
         2 000052   200007 756100                    STQ     B$JIT$,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:66   
      256    11727    2              CALL BINCHAR(RVF_CLSUSR.SYSID,B$JIT.SYSID);

  11727  2 000053   200007 470500                    LDP0    B$JIT$,,AUTO
         2 000054   000000 236100                    LDQ     0,,PR0
         2 000055   777777 376007                    ANQ     -1,DL
         2 000056   000000 235003                    LDA     0,DU
         2 000057   200144 757100                    STAQ    J+1,,AUTO
         2 000060   000000 301500                    BTD
         2 000061   200144 000010                    NDSC9   J+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
         2 000062   000010 030010 xsym               NDSC9   RVF_CLSUSR+8             cn=0,s=nosgn,sf=0,n=8

      257    11728    2              RVF_CLSUSR.ACCN=B$JIT.ACCN;

  11728  2 000063   040000 100500                    MLR     fill='040'O
         2 000064   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         2 000065   000004 000010 xsym               ADSC9   RVF_CLSUSR+4             cn=0,n=8

      258    11729    2              CALL IRR$TYPE6(RVF_CLSUSR,SIZEW(RVF_CLSUSR));

  11729  2 000066   000001 630400 3                  EPPR0   1
         2 000067   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000070   000000 701000 xent               TSX1    IRR$TYPE6
         2 000071   000000 011000                    NOP     0

      259    11730    2              END;

      260    11731    1           CALL CVTPTR(B$ROSEG.DCBPTR$,DCBPTR$) ALTRET(ALT);

  11731  2 000072   200011 630500                    EPPR0   DCBPTR$,,AUTO
         2 000073   200132 450500                    STP0    @IP$+1,,AUTO
         2 000074   000000 236000 xsym               LDQ     R$ROSEG$
         2 000075   200131 756100                    STQ     MIR_DQH$+3,,AUTO
         2 000076   004442 701000 2                  TSX1    CVTPTR
         2 000077   001014 702000 2                  TSX2    ALT

      261    11732    1           NUMDCBS=B$ROSEG.NUMDCBS;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:67   
  11732  2 000100   000000 470400 xsym               LDP0    R$ROSEG$
         2 000101   000002 236100                    LDQ     2,,PR0
         2 000102   000022 772000                    QRL     18
         2 000103   200006 756100                    STQ     NUMDCBS,,AUTO

      262    11733    2           DO SJ=%M$MAXNEG# TO NUMDCBS;

  11733  2 000104   000040 335007                    LCA     32,DL
         2 000105   200005 755100                    STA     J,,AUTO
         2 000106   001004 710000 2                  TRA     NXTDCB+1

      263    11734    2              DCB$=DCBPTR$->PTR$(J);

  11734  2 000107   200011 470500                    LDP0    DCBPTR$,,AUTO
         2 000110   200005 720100                    LXL0    J,,AUTO
         2 000111   000000 236110                    LDQ     0,X0,PR0
         2 000112   200010 756100                    STQ     DCB$,,AUTO

      264    11735    2   CVTDCB:    OP=OP_DCBPTR;

  11735  2 000113   000001 235007       CVTDCB       LDA     1,DL
         2 000114   200033 755100                    STA     OP,,AUTO

      265    11736    2              SN=' ';

  11736  2 000115   040100 100400                    MLR     fill='040'O
         2 000116   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000117   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

      266    11737    2              ACCT=' ';

  11737  2 000120   000035 235000 xsym               LDA     B_VECTNIL+29
         2 000121   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 000122   200027 755100                    STA     ACCT,,AUTO
         2 000123   200030 756100                    STQ     ACCT+1,,AUTO

      267    11738    2              NAME$=ADDR(NIL);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:68   

  11738  2 000124   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000125   200023 756100                    STQ     NAME$,,AUTO

      268    11739    2              IF DCB$=ADDR(NIL) THEN

  11739  2 000126   200010 236100                    LDQ     DCB$,,AUTO
         2 000127   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000130   001003 600000 2                  TZE     NXTDCB

      269    11740    2                 GOTO NXTDCB;
      270    11741    2              CALL CVTPTR(DCB$,DCB$) ALTRET(NXTDCB);

  11741  2 000131   200010 630500                    EPPR0   DCB$,,AUTO
         2 000132   200132 450500                    STP0    @IP$+1,,AUTO
         2 000133   200010 631500                    EPPR1   DCB$,,AUTO
         2 000134   200131 451500                    STP1    MIR_DQH$+3,,AUTO
         2 000135   004442 701000 2                  TSX1    CVTPTR
         2 000136   001003 702000 2                  TSX2    NXTDCB

      271    11742    2              IF NOT F$DCB.FCD THEN

  11742  2 000137   200010 470500                    LDP0    DCB$,,AUTO
         2 000140   000031 236100                    LDQ     25,,PR0
         2 000141   020000 316007                    CANQ    8192,DL
         2 000142   001003 600000 2                  TZE     NXTDCB

      272    11743    2                 GOTO NXTDCB;
      273    11744    2              ASN=F$DCB.ASN;

  11744  2 000143   000032 236100                    LDQ     26,,PR0
         2 000144   000011 772000                    QRL     9
         2 000145   000777 376007                    ANQ     511,DL
         2 000146   200031 756100                    STQ     ASN,,AUTO

      274    11745    3              DO CASE(F$DCB.IASN);

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:69   
  11745  2 000147   000103 720100                    LXL0    67,,PR0
         2 000150   000777 360003                    ANX0    511,DU
         2 000151   000006 100003                    CMPX0   6,DU
         2 000152   000154 602010 2                  TNC     s:11745+5,X0
         2 000153   001003 710000 2                  TRA     NXTDCB
         2 000154   001003 710000 2                  TRA     NXTDCB
         2 000155   000162 710000 2                  TRA     s:11747
         2 000156   000620 710000 2                  TRA     s:11851
         2 000157   001003 710000 2                  TRA     NXTDCB
         2 000160   001003 710000 2                  TRA     NXTDCB
         2 000161   000604 710000 2                  TRA     s:11843

      275    11746    3               CASE(%FILE#);

      276    11747    3                 IF F$DCB.ASN=%COMGROUP# THEN

  11747  2 000162   000011 736000                    QLS     9
         2 000163   004000 116007                    CMPQ    2048,DL
         2 000164   001003 600000 2                  TZE     NXTDCB

      277    11748    3                    GOTO NXTDCB;
      278    11749    3                 NAME$=PINCRC(ADDR(F$DCB.NAME),-2);

  11749  2 000165   200010 236100                    LDQ     DCB$,,AUTO
         2 000166   000003 036000 3                  ADLQ    3
         2 000167   200023 756100                    STQ     NAME$,,AUTO

      279    11750    3                 IF F$DCB.CFU$ = ADDR(NIL) THEN

  11750  2 000170   000066 236100                    LDQ     54,,PR0
         2 000171   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000172   001003 600000 2                  TZE     NXTDCB

      280    11751    3                    GOTO NXTDCB;
      281    11752    3                 CALL CVTPTR(F$DCB.CFU$, CFU$) ALTRET(NXTDCB);

  11752  2 000173   200012 631500                    EPPR1   CFU$,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:70   
         2 000174   200132 451500                    STP1    @IP$+1,,AUTO
         2 000175   200010 236100                    LDQ     DCB$,,AUTO
         2 000176   000066 036003                    ADLQ    54,DU
         2 000177   200131 756100                    STQ     MIR_DQH$+3,,AUTO
         2 000200   004442 701000 2                  TSX1    CVTPTR
         2 000201   001003 702000 2                  TSX2    NXTDCB

      282    11753    4                 IF F$DCB.STARF THEN DO;   /* STAR FILE                          */

  11753  2 000202   200010 470500                    LDP0    DCB$,,AUTO
         2 000203   000064 236100                    LDQ     52,,PR0
         2 000204   200000 316003                    CANQ    65536,DU
         2 000205   000215 600000 2                  TZE     s:11758

      283    11754    4                    ACCT$=ADDR(NIL);

  11754  2 000206   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000207   200022 756100                    STQ     ACCT$,,AUTO

      284    11755    4                    ACCT='*';

  11755  2 000210   000004 235000 3                  LDA     4
         2 000211   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 000212   200027 755100                    STA     ACCT,,AUTO
         2 000213   200030 756100                    STQ     ACCT+1,,AUTO

      285    11756    4                    END;

  11756  2 000214   000250 710000 2                  TRA     s:11769

      286    11757    3                 ELSE
      287    11758    4                    IF F$DCB.DISP=%SCRATCH# THEN DO; /* Scratch file             */

  11758  2 000215   000032 236100                    LDQ     26,,PR0
         2 000216   000777 376007                    ANQ     511,DL
         2 000217   000001 116007                    CMPQ    1,DL
         2 000220   000227 601000 2                  TNZ     s:11763
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:71   

      288    11759    4                       ACCT$=ADDR(NIL);

  11759  2 000221   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000222   200022 756100                    STQ     ACCT$,,AUTO

      289    11760    4                       ACCT='*SCRTCH*';

  11760  2 000223   000240 237000 1                  LDAQ    SEGTAB+22
         2 000224   200027 755100                    STA     ACCT,,AUTO
         2 000225   200030 756100                    STQ     ACCT+1,,AUTO

      290    11761    4                       END;

  11761  2 000226   000250 710000 2                  TRA     s:11769

      291    11762    4                    ELSE DO;               /* Permanent file                     */

      292    11763    4                       ACCTX=FM$CFU.ACCTX;

  11763  2 000227   200012 471500                    LDP1    CFU$,,AUTO
         2 000230   100002 236100                    LDQ     2,,PR1
         2 000231   000022 772000                    QRL     18
         2 000232   200021 756100                    STQ     ACCTX,,AUTO

      293    11764    4                       IF ACCTX=0 THEN

  11764  2 000233   000241 601000 2                  TNZ     s:11766

      294    11765    4                          ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;

  11765  2 000234   100002 720100                    LXL0    2,,PR1
         2 000235   000000 473400 xsym               LDP3    R$CFU$
         2 000236   300002 236110                    LDQ     2,X0,PR3
         2 000237   000022 772000                    QRL     18
         2 000240   200021 756100                    STQ     ACCTX,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:72   
      295    11766    4                       ACCT$=PINCRW(F$CFU$,ACCTX);

  11766  2 000241   000022 736000                    QLS     18
         2 000242   000000 036000 xsym               ADLQ    R$CFU$
         2 000243   200022 756100                    STQ     ACCT$,,AUTO

      296    11767    4                       ACCT=FM$CFUA.ACCT;

  11767  2 000244   200022 473500                    LDP3    ACCT$,,AUTO
         2 000245   040100 100500                    MLR     fill='040'O
         2 000246   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
         2 000247   200027 000010                    ADSC9   ACCT,,AUTO               cn=0,n=8

      297    11768    4                       END;

      298    11769    3                 SETX=F$DCB.SETX;

  11769  2 000250   000051 236100                    LDQ     41,,PR0
         2 000251   777777 376007                    ANQ     -1,DL
         2 000252   200016 756100                    STQ     SETX,,AUTO

      299    11770    3                 SN=FM$SET.PSN(SETX);

  11770  2 000253   200016 235100                    LDA     SETX,,AUTO
         2 000254   000005 735000                    ALS     5
         2 000255   000000 471400 xsym               LDP1    R$CFU$
         2 000256   040100 100505                    MLR     fill='040'O
         2 000257   100000 400006                    ADSC9   0,A,PR1                  cn=2,n=6
         2 000260   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

      300    11771    3                 IF FM$CFU.FITSDA=0 THEN

  11771  2 000261   200012 473500                    LDP3    CFU$,,AUTO
         2 000262   300000 236100                    LDQ     0,,PR3
         2 000263   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 000264   001003 600000 2                  TZE     NXTDCB

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:73   
      301    11772    3                    GOTO NXTDCB;
      302    11773        /* Find and verify FIT to make sure DCB and buffers are meaningful */
      303    11774    4                 DO I=0 TO 4;

  11774  2 000265   200004 450100                    STZ     I,,AUTO

      304    11775    4                    IF F$DCB.ACS~=%JRNL#

  11775  2 000266   200010 470500                    LDP0    DCB$,,AUTO
         2 000267   000036 236100                    LDQ     30,,PR0
         2 000270   000777 376007                    ANQ     511,DL
         2 000271   000004 116007                    CMPQ    4,DL
         2 000272   000331 600000 2                  TZE     s:11784
         2 000273   200004 720100                    LXL0    I,,AUTO
         2 000274   000115 236110                    LDQ     77,X0,PR0
         2 000275   037000 316003                    CANQ    15872,DU
         2 000276   000331 600000 2                  TZE     s:11784
         2 000277   200012 471500                    LDP1    CFU$,,AUTO
         2 000300   100000 676100                    ERQ     0,,PR1
         2 000301   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000302   000312 600000 2                  TZE     s:11778
         2 000303   100000 236100                    LDQ     0,,PR1
         2 000304   001000 316003                    CANQ    512,DU
         2 000305   000331 601000 2                  TNZ     s:11784
         2 000306   000115 236110                    LDQ     77,X0,PR0
         2 000307   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000310   000000 116000 1                  CMPQ    FM_FRZERO
         2 000311   000331 601000 2                  TNZ     s:11784

      305    11776    4                      AND F$DCB.BFR.BUFX(I)~=0 AND (F$DCB.BFR.DA(I)=FM$CFU.FITSDA
      306    11777    5                      OR (FM$CFU.AFIT=0 AND F$DCB.BFR.DA(I)=FM_FRZERO)) THEN DO;

      307    11778    5                       POBUF$->PG=PINCRW(R$BUFF$,(F$DCB.BFR.BUFX(I)-1)*

  11778  2 000312   000115 236110                    LDQ     77,X0,PR0
         2 000313   000033 772000                    QRL     27
         2 000314   000037 376007                    ANQ     31,DL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:74   
         2 000315   000014 736000                    QLS     12
         2 000316   000000 473400 xsym               LDP3    R$BUFF$
         2 000317   010000 221003                    LDX1    4096,DU
         2 000320   000006 474400 1                  LDP4    POBUF$
         2 000321   000140 100546                    MLR     fill='000'O
         2 000322   376000 000011                    ADSC9   -1024,Q,PR3              cn=0,n=*X1
         2 000323   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1

      308    11779    5                         1024)->PG;
      309    11780    5                       OP=OP_CHKFIT;

  11780  2 000324   000010 235007                    LDA     8,DL
         2 000325   200033 755100                    STA     OP,,AUTO

      310    11781    5                       CALL CHKFIT ALTRET(NXTDCB);

  11781  2 000326   002576 701000 2                  TSX1    CHKFIT
         2 000327   001003 702000 2                  TSX2    NXTDCB

      311    11782    5                       GOTO FLSHDCB;

  11782  2 000330   000342 710000 2                  TRA     FLSHDCB

      312    11783    5                       END;
      313    11784    4                    END;

  11784  2 000331   200004 235100                    LDA     I,,AUTO
         2 000332   000001 035007                    ADLA    1,DL
         2 000333   200004 755100                    STA     I,,AUTO
         2 000334   000005 115007                    CMPA    5,DL
         2 000335   000266 602000 2                  TNC     s:11775

      314    11785    3                 OP=OP_GETFIT1;

  11785  2 000336   000006 236007                    LDQ     6,DL
         2 000337   200033 756100                    STQ     OP,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:75   
      315    11786    3                 CALL GETFIT ALTRET(NXTDCB);

  11786  2 000340   002573 701000 2                  TSX1    GETFIT
         2 000341   001003 702000 2                  TSX2    NXTDCB

      316    11787        /**/
      317    11788        /* Flush any updated buffers */
      318    11789        /**/
      319    11790    4   FLSHDCB:      DO I=0 TO 4;

  11790  2 000342   200004 450100       FLSHDCB      STZ     I,,AUTO

      320    11791    4                    OP=OP_FFLSH;

  11791  2 000343   000002 235007                    LDA     2,DL
         2 000344   200033 755100                    STA     OP,,AUTO

      321    11792    4                    IF F$DCB.BFR1.CX(I) > 0 THEN

  11792  2 000345   200010 470500                    LDP0    DCB$,,AUTO
         2 000346   200004 720100                    LXL0    I,,AUTO
         2 000347   000122 721110                    LXL1    82,X0,PR0
         2 000350   000362 600000 2                  TZE     s:11797

      322    11793    5                    DO;

      323    11794    5                       IF FMC$CACHETBL.FLAGS.BUFUP(F$DCB.BFR1.CX(I)) THEN

  11794  2 000351   000122 236110                    LDQ     82,X0,PR0
         2 000352   777777 376007                    ANQ     -1,DL
         2 000353   000006 402007                    MPY     6,DL
         2 000354   200015 471500                    LDP1    CACHE$,,AUTO
         2 000355   100004 236106                    LDQ     4,QL,PR1
         2 000356   000001 316007                    CANQ    1,DL
         2 000357   000362 600000 2                  TZE     s:11797

      324    11795    5                          F$DCB.BFR.BUFUP(I)='1'B;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:76   

  11795  2 000360   400000 236003                    LDQ     -131072,DU
         2 000361   000115 256110                    ORSQ    77,X0,PR0

      325    11796    5                       END;

      326    11797    5                    IF F$DCB.BFR.BUFUP(I) AND F$DCB.BFR.BUFX(I)~=0 THEN DO;

  11797  2 000362   200010 470500                    LDP0    DCB$,,AUTO
         2 000363   000115 234110                    SZN     77,X0,PR0
         2 000364   000425 605000 2                  TPL     s:11807
         2 000365   000115 236110                    LDQ     77,X0,PR0
         2 000366   037000 316003                    CANQ    15872,DU
         2 000367   000425 600000 2                  TZE     s:11807

      327    11798    5                       ADDR(POBUF)->PG=PINCRW(R$BUFF$,(F$DCB.BFR.BUFX(I)-1)

  11798  2 000370   000115 236110                    LDQ     77,X0,PR0
         2 000371   000033 772000                    QRL     27
         2 000372   000037 376007                    ANQ     31,DL
         2 000373   000014 736000                    QLS     12
         2 000374   000000 471400 xsym               LDP1    R$BUFF$
         2 000375   010000 221003                    LDX1    4096,DU
         2 000376   000040 100546                    MLR     fill='000'O
         2 000377   176000 000011                    ADSC9   -1024,Q,PR1              cn=0,n=*X1
         2 000400   000000 000011 xsym               ADSC9   POBUF                    cn=0,n=*X1

      328    11799    5                         *1024)->PG;
      329    11800    5                       DA=F$DCB.BFR.DA(I);

  11800  2 000401   000115 236110                    LDQ     77,X0,PR0
         2 000402   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000403   200003 756100                    STQ     DA,,AUTO

      330    11801    6                       IF F$DCB.ACS~=%JRNL# OR DA>FM_SRZERO THEN DO;

  11801  2 000404   000036 236100                    LDQ     30,,PR0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:77   
         2 000405   000777 376007                    ANQ     511,DL
         2 000406   000004 116007                    CMPQ    4,DL
         2 000407   000413 601000 2                  TNZ     s:11802
         2 000410   000002 236000 1                  LDQ     FM_SRZERO
         2 000411   200003 116100                    CMPQ    DA,,AUTO
         2 000412   000425 603000 2                  TRC     s:11807

      331    11802    6                          IF RVF_DEBUG~=0 THEN

  11802  2 000413   000007 235000 1                  LDA     RVF_DEBUG
         2 000414   000423 600000 2                  TZE     s:11804

      332    11803    6                             CALL PUTNAME(RVF_CLSBFR,RVF_CLSBFR.FID,SIZEC(RVF_CLSBFR.
             11803                                      FID));

  11803  2 000415   000006 237000 3                  LDAQ    6
         2 000416   200140 757100                    STAQ    @MSG+1,,AUTO
         2 000417   000010 236000 3                  LDQ     8
         2 000420   200137 756100                    STQ     I+2,,AUTO
         2 000421   004236 701000 2                  TSX1    PUTNAME
         2 000422   000000 011000                    NOP     0

      333    11804    6                          CALL WRITECHK ALTRET(NXTDCB);

  11804  2 000423   004503 701000 2                  TSX1    WRITECHK
         2 000424   001003 702000 2                  TSX2    NXTDCB

      334    11805    6                          END;

      335    11806    5                       END;

      336    11807    4                    END;

  11807  2 000425   200004 235100                    LDA     I,,AUTO
         2 000426   000001 035007                    ADLA    1,DL
         2 000427   200004 755100                    STA     I,,AUTO
         2 000430   000005 115007                    CMPA    5,DL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:78   
         2 000431   000343 602000 2                  TNC     s:11791

      337    11808    3                 IF F$DCB.ACS=%JRNL# THEN

  11808  2 000432   200010 470500                    LDP0    DCB$,,AUTO
         2 000433   000036 236100                    LDQ     30,,PR0
         2 000434   000777 376007                    ANQ     511,DL
         2 000435   000004 116007                    CMPQ    4,DL
         2 000436   000470 601000 2                  TNZ     s:11817

      338    11809    4                    IF FM$CFUJ.PAGE#~=0 THEN DO;

  11809  2 000437   200012 471500                    LDP1    CFU$,,AUTO
         2 000440   100005 720100                    LXL0    5,,PR1
         2 000441   000470 600000 2                  TZE     s:11817

      339    11810    4                       MEMDESC.BADDR=FM$CFUJ.PAGE#*4096;

  11810  2 000442   100005 236100                    LDQ     5,,PR1
         2 000443   000014 736000                    QLS     12
         2 000444   000011 376000 3                  ANQ     9
         2 000445   000001 756000 xsym               STQ     MEMDESC+1

      340    11811    4                       POBUF$->PG=I$MEM$->PG;

  11811  2 000446   000000 473400 xsym               LDP3    I$MEM$
         2 000447   010000 221003                    LDX1    4096,DU
         2 000450   000006 474400 1                  LDP4    POBUF$
         2 000451   000140 100540                    MLR     fill='000'O
         2 000452   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1
         2 000453   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1

      341    11812    4                       DA=FM$CFU.LDA;

  11812  2 000454   200012 470500                    LDP0    CFU$,,AUTO
         2 000455   000006 235100                    LDA     6,,PR0
         2 000456   000007 236100                    LDQ     7,,PR0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:79   
         2 000457   000033 773000                    LRL     27
         2 000460   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000461   200003 756100                    STQ     DA,,AUTO

      342    11813    4                       FM$CFUJ.PAGE#=0;

  11813  2 000462   000000 220003                    LDX0    0,DU
         2 000463   000005 440100                    SXL0    5,,PR0

      343    11814    4                       OP=OP_FFLSH;

  11814  2 000464   000002 235007                    LDA     2,DL
         2 000465   200033 755100                    STA     OP,,AUTO

      344    11815    4                       CALL WRITECHK ALTRET(NXTDCB);

  11815  2 000466   004503 701000 2                  TSX1    WRITECHK
         2 000467   001003 702000 2                  TSX2    NXTDCB

      345    11816    4                       END;

      346    11817    3                 IF NOT FM$CFU.SHARED OR FM$CFU.USECNT > 1 THEN

  11817  2 000470   200012 470500                    LDP0    CFU$,,AUTO
         2 000471   000000 236100                    LDQ     0,,PR0
         2 000472   002000 316003                    CANQ    1024,DU
         2 000473   001003 600000 2                  TZE     NXTDCB
         2 000474   000003 720100                    LXL0    3,,PR0
         2 000475   000002 100003                    CMPX0   2,DU
         2 000476   001003 603000 2                  TRC     NXTDCB

      347    11818    3                    GOTO NXTDCB;           /* File doesn't have to be closed     */
      348    11819    3                 FM$CFU.SHARED='0'B;       /* Don't try to close again           */

  11819  2 000477   000012 236000 3                  LDQ     10
         2 000500   000000 356100                    ANSQ    0,,PR0

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:80   
      349    11820    4                 IF RVF_DEBUG~=0 THEN DO;

  11820  2 000501   000007 235000 1                  LDA     RVF_DEBUG
         2 000502   000511 600000 2                  TZE     s:11823

      350    11821    4                    CALL PUTNAME(RVF_CLSDCB,RVF_CLSDCB.FID,SIZEC(RVF_CLSDCB.FID));

  11821  2 000503   000014 237000 3                  LDAQ    12
         2 000504   200140 757100                    STAQ    @MSG+1,,AUTO
         2 000505   000016 236000 3                  LDQ     14
         2 000506   200137 756100                    STQ     I+2,,AUTO
         2 000507   004236 701000 2                  TSX1    PUTNAME
         2 000510   000000 011000                    NOP     0

      351    11822    4                    END;

      352    11823    3                 OP=OP_GETFIT2;

  11823  2 000511   000007 235007                    LDA     7,DL
         2 000512   200033 755100                    STA     OP,,AUTO

      353    11824    3                 CALL GETFIT ALTRET(NXTDCB);

  11824  2 000513   002573 701000 2                  TSX1    GETFIT
         2 000514   001003 702000 2                  TSX2    NXTDCB

      354    11825    3                 CALL UPFIT ALTRET(NXTDCB);

  11825  2 000515   003050 701000 2                  TSX1    UPFIT
         2 000516   001003 702000 2                  TSX2    NXTDCB

      355    11826    3                 IF F$DCB.DISP=%SCRATCH# OR FM$CFU.FUN=%CREATE#

  11826  2 000517   200010 470500                    LDP0    DCB$,,AUTO
         2 000520   000032 236100                    LDQ     26,,PR0
         2 000521   000777 376007                    ANQ     511,DL
         2 000522   000001 116007                    CMPQ    1,DL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:81   
         2 000523   000540 600000 2                  TZE     s:11828
         2 000524   200012 471500                    LDP1    CFU$,,AUTO
         2 000525   100000 236100                    LDQ     0,,PR1
         2 000526   700000 376003                    ANQ     -32768,DU
         2 000527   300000 116003                    CMPQ    98304,DU
         2 000530   000540 600000 2                  TZE     s:11828
         2 000531   000032 236100                    LDQ     26,,PR0
         2 000532   777000 376003                    ANQ     -512,DU
         2 000533   003000 116003                    CMPQ    1536,DU
         2 000534   000545 601000 2                  TNZ     s:11831
         2 000535   100004 236100                    LDQ     4,,PR1
         2 000536   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 000537   000545 601000 2                  TNZ     s:11831

      356    11827    4                   OR F$DCB.ORG=%RANDOM# AND FM$CFU.UGRANS=0 THEN DO;

      357    11828    4                    CALL ADDLIST;

  11828  2 000540   004165 701000 2                  TSX1    ADDLIST
         2 000541   000000 011000                    NOP     0

      358    11829    4                    FM$CFU.FITSDA=0;

  11829  2 000542   200012 470500                    LDP0    CFU$,,AUTO
         2 000543   000000 236003                    LDQ     0,DU
         2 000544   000000 552134                    STBQ    0,'34'O,PR0

      359    11830    4                    END;

      360    11831    3                 CALL WRITE;

  11831  2 000545   004547 701000 2                  TSX1    WRITE
         2 000546   000000 011000                    NOP     0

      361    11832    3                 IF FM$GRAN.ORG=%RANDOM# AND FM$CFU.FUN=%UPDATE# AND

  11832  2 000547   000006 470400 1                  LDP0    POBUF$
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:82   
         2 000550   000001 236100                    LDQ     1,,PR0
         2 000551   036000 376007                    ANQ     15360,DL
         2 000552   006000 116007                    CMPQ    3072,DL
         2 000553   000576 601000 2                  TNZ     s:11840
         2 000554   200012 471500                    LDP1    CFU$,,AUTO
         2 000555   100000 236100                    LDQ     0,,PR1
         2 000556   700000 376003                    ANQ     -32768,DU
         2 000557   100000 116003                    CMPQ    32768,DU
         2 000560   000576 601000 2                  TNZ     s:11840
         2 000561   100005 220100                    LDX0    5,,PR1
         2 000562   000576 600000 2                  TZE     s:11840

      362    11833    4                   FM$CFUR.HEADPP#~=0 THEN DO;

      363    11834    4                    REMUNWIND=RV_UNWIND1;

  11834  2 000563   000000 237000 xsym               LDAQ    RV_UNWIND1
         2 000564   200036 757100                    STAQ    REMUNWIND,,AUTO

      364    11835    4                    REMEMBER DSTRAP1 IN RV_UNWIND1;

  11835  2 000565   000572 635000 2                  EAA     DSTRAP1
         2 000566   000000 452400 xsym               STP2    RV_UNWIND1
         2 000567   000001 755000 xsym               STA     RV_UNWIND1+1

      365    11836    4                    CALL DSWRITE;

  11836  2 000570   003474 701000 2                  TSX1    DSWRITE
         2 000571   000000 011000                    NOP     0

      366    11837    4   DSTRAP1:         RV_UNWIND1=REMUNWIND;

  11837  2 000572   200036 237100       DSTRAP1      LDAQ    REMUNWIND,,AUTO
         2 000573   000000 757000 xsym               STAQ    RV_UNWIND1

      367    11838    4                    CALL DSERR;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:83   
  11838  2 000574   003774 701000 2                  TSX1    DSERR
         2 000575   000000 011000                    NOP     0

      368    11839    4                    END;

      369    11840    3                 IF FM$CFU.USECNT>0 THEN

  11840  2 000576   200012 470500                    LDP0    CFU$,,AUTO
         2 000577   000003 720100                    LXL0    3,,PR0
         2 000600   001003 600000 2                  TZE     NXTDCB

      370    11841    3                    FM$CFU.USECNT=FM$CFU.USECNT-1;

  11841  2 000601   777777 621010                    EAX1    -1,X0
         2 000602   000003 441100                    SXL1    3,,PR0
         2 000603   001003 710000 2                  TRA     NXTDCB

      371    11842    3               CASE(%STREAM#);

      372    11843    3                 DCB$=F$DCB.CFU$;

  11843  2 000604   000066 236100                    LDQ     54,,PR0
         2 000605   200010 756100                    STQ     DCB$,,AUTO

      373    11844    4                 IF DCB$=DCBPTR$->PTR$(J) THEN DO; /* Streamed to itsself        */

  11844  2 000606   200011 470500                    LDP0    DCBPTR$,,AUTO
         2 000607   200005 720100                    LXL0    J,,AUTO
         2 000610   000000 116110                    CMPQ    0,X0,PR0
         2 000611   000617 601000 2                  TNZ     s:11849

      374    11845    4                    ERRCODE=31;

  11845  2 000612   000037 235007                    LDA     31,DL
         2 000613   200032 755100                    STA     ERRCODE,,AUTO

      375    11846    4                    CALL ERROR;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:84   

  11846  2 000614   005436 701000 2                  TSX1    ERROR
         2 000615   000000 011000                    NOP     0

      376    11847    4                    GOTO NXTDCB;

  11847  2 000616   001003 710000 2                  TRA     NXTDCB

      377    11848    4                    END;
      378    11849    3                 GOTO CVTDCB;

  11849  2 000617   000113 710000 2                  TRA     CVTDCB

      379    11850    3               CASE(%TAPE#);

      380    11851    3                 IF F$DCB.BLKL > 4096      /* Too big                            */

  11851  2 000620   000033 221100                    LDX1    27,,PR0
         2 000621   010001 101003                    CMPX1   4097,DU
         2 000622   001003 603000 2                  TRC     NXTDCB
         2 000623   000036 236100                    LDQ     30,,PR0
         2 000624   000777 376007                    ANQ     511,DL
         2 000625   000004 116007                    CMPQ    4,DL
         2 000626   000632 601000 2                  TNZ     s:11851+10
         2 000627   000064 236100                    LDQ     52,,PR0
         2 000630   040000 316007                    CANQ    16384,DL
         2 000631   001003 600000 2                  TZE     NXTDCB
         2 000632   000070 236100                    LDQ     56,,PR0
         2 000633   000041 772000                    QRL     33
         2 000634   000115 234106                    SZN     77,QL,PR0
         2 000635   001003 605000 2                  TPL     NXTDCB
         2 000636   000067 236100                    LDQ     55,,PR0
         2 000637   000100 316003                    CANQ    64,DU
         2 000640   001003 601000 2                  TNZ     NXTDCB
         2 000641   000064 236100                    LDQ     52,,PR0
         2 000642   000014 316007                    CANQ    12,DL
         2 000643   001003 601000 2                  TNZ     NXTDCB
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:85   
         2 000644   000032 236100                    LDQ     26,,PR0
         2 000645   777000 376007                    ANQ     -512,DL
         2 000646   002000 116007                    CMPQ    1024,DL
         2 000647   001003 601000 2                  TNZ     NXTDCB

      381    11852    3                   OR (F$DCB.ACS = %JRNL# AND NOT F$DCB.OWNER) /* Owner will do  */
      382    11853    3                   OR NOT F$DCB.BFR.BUFUP(F$DCB.CBUFNUM) /* Not updated          */
      383    11854    3                   OR F$DCB.TAPTYP.USRBUF  /* Not FPOOL                          */
      384    11855    3                   OR F$DCB.TRNC ~= FT_NOTRUNC# /* Already out                   */
      385    11856    3                   OR F$DCB.ASN ~= %TAPE#  /* Not labelled                       */
      386    11857    3                 THEN GOTO NXTDCB;
      387    11858    3                 IF F$DCB.BLKLEN < 20

  11858  2 000650   000074 722100                    LXL2    60,,PR0
         2 000651   000024 102003                    CMPX2   20,DU
         2 000652   000656 603000 2                  TRC     s:11860

      388    11859    3                 THEN N = 20;              /* Pad to next word > 18 chars        */

  11859  2 000653   000024 235007                    LDA     20,DL
         2 000654   200050 755100                    STA     N,,AUTO
         2 000655   000666 710000 2                  TRA     s:11863

      389    11860    3                 ELSE IF F$DCB.TAPTYP.CP6F

  11860  2 000656   000067 236100                    LDQ     55,,PR0
         2 000657   000200 316003                    CANQ    128,DU
         2 000660   000664 600000 2                  TZE     s:11862

      390    11861    3                    THEN N = 8;            /* Binary write...pad to doubleword   */

  11861  2 000661   000010 235007                    LDA     8,DL
         2 000662   200050 755100                    STA     N,,AUTO
         2 000663   000666 710000 2                  TRA     s:11863

      391    11862    3                    ELSE N = 4;            /* ASCII write...pad to word          */

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:86   
  11862  2 000664   000004 235007                    LDA     4,DL
         2 000665   200050 755100                    STA     N,,AUTO

      392    11863    3                 N = ( (F$DCB.BLKLEN + N - 1) / N ) * N - F$DCB.BLKLEN;

  11863  2 000666   000074 236100                    LDQ     60,,PR0
         2 000667   777777 376007                    ANQ     -1,DL
         2 000670   200050 036100                    ADLQ    N,,AUTO
         2 000671   000001 136007                    SBLQ    1,DL
         2 000672   200050 506100                    DIV     N,,AUTO
         2 000673   200050 402100                    MPY     N,,AUTO
         2 000674   200144 756100                    STQ     J+1,,AUTO
         2 000675   000074 236100                    LDQ     60,,PR0
         2 000676   777777 376007                    ANQ     -1,DL
         2 000677   200145 756100                    STQ     J+2,,AUTO
         2 000700   200144 236100                    LDQ     J+1,,AUTO
         2 000701   200145 136100                    SBLQ    J+2,,AUTO
         2 000702   200050 756100                    STQ     N,,AUTO

      393    11864                                                /* Number of filler bytes             */
      394    11865    3                 IF F$DCB.TAPTYP.CP6F OR (F$DCB.ORG = %VARIABLE# AND F$DCB.EBCDIC)

  11865  2 000703   000067 236100                    LDQ     55,,PR0
         2 000704   000200 316003                    CANQ    128,DU
         2 000705   000715 601000 2                  TNZ     s:11866
         2 000706   000032 236100                    LDQ     26,,PR0
         2 000707   777000 376003                    ANQ     -512,DU
         2 000710   020000 116003                    CMPQ    8192,DU
         2 000711   000724 601000 2                  TNZ     s:11867
         2 000712   000031 236100                    LDQ     25,,PR0
         2 000713   100000 316007                    CANQ    32768,DL
         2 000714   000724 600000 2                  TZE     s:11867

      395    11866    3                 THEN PINCRC(ADDR(POBUF),F$DCB.BLKLEN)->NCHARS = NULPAD;

  11866  2 000715   000074 236100                    LDQ     60,,PR0
         2 000716   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:87   
         2 000717   200050 720100                    LXL0    N,,AUTO
         2 000720   040046 100400                    MLR     fill='040'O
         2 000721   000205 000024 1                  ADSC9   ZEROBITS                 cn=0,n=20
         2 000722   000000 000010 xsym               ADSC9   POBUF,Q                  cn=0,n=*X0
         2 000723   000732 710000 2                  TRA     s:11868

      396    11867    3                 ELSE PINCRC(ADDR(POBUF),F$DCB.BLKLEN)->NCHARS = ANSPAD;

  11867  2 000724   000074 236100                    LDQ     60,,PR0
         2 000725   777777 376007                    ANQ     -1,DL
         2 000726   200050 720100                    LXL0    N,,AUTO
         2 000727   040046 100400                    MLR     fill='040'O
         2 000730   000200 000022 1                  ADSC9   ANSPAD                   cn=0,n=18
         2 000731   000000 000010 xsym               ADSC9   POBUF,Q                  cn=0,n=*X0

      397    11868    3                 N = F$DCB.BLKLEN + N;     /* # bytes to write                   */

  11868  2 000732   000074 236100                    LDQ     60,,PR0
         2 000733   777777 376007                    ANQ     -1,DL
         2 000734   200050 036100                    ADLQ    N,,AUTO
         2 000735   200050 756100                    STQ     N,,AUTO

      398    11869    3                 IF F$DCB.AFTRBLK

  11869  2 000736   000064 236100                    LDQ     52,,PR0
         2 000737   000002 316007                    CANQ    2,DL
         2 000740   000744 600000 2                  TZE     s:11871

      399    11870    3                 THEN CALL IRR$SPRECB;     /* Back up to rewrite block           */

  11870  2 000741   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000742   000000 701000 xent               TSX1    IRR$SPRECB
         2 000743   000000 011000                    NOP     0

      400    11871    3                 DCTX = F$DCB.SETX;

  11871  2 000744   200010 470500                    LDP0    DCB$,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:88   
         2 000745   000051 236100                    LDQ     41,,PR0
         2 000746   777777 376007                    ANQ     -1,DL
         2 000747   200017 756100                    STQ     DCTX,,AUTO

      401    11872    3                 CALL DCTCNVRT;

  11872  2 000750   005346 701000 2                  TSX1    DCTCNVRT
         2 000751   000000 011000                    NOP     0

      402    11873    3                 IF F$DCB.TAPTYP.CP6F OR (F$DCB.ORG = %VARIABLE# AND F$DCB.EBCDIC)

  11873  2 000752   200010 470500                    LDP0    DCB$,,AUTO
         2 000753   000067 236100                    LDQ     55,,PR0
         2 000754   000200 316003                    CANQ    128,DU
         2 000755   000765 601000 2                  TNZ     s:11874
         2 000756   000032 236100                    LDQ     26,,PR0
         2 000757   777000 376003                    ANQ     -512,DU
         2 000760   020000 116003                    CMPQ    8192,DU
         2 000761   000774 601000 2                  TNZ     s:11875
         2 000762   000031 236100                    LDQ     25,,PR0
         2 000763   100000 316007                    CANQ    32768,DL
         2 000764   000774 600000 2                  TZE     s:11875

      403    11874    3                 THEN CALL IRR$WRBIN( N );

  11874  2 000765   200050 631500                    EPPR1   N,,AUTO
         2 000766   200144 451500                    STP1    J+1,,AUTO
         2 000767   200144 630500                    EPPR0   J+1,,AUTO
         2 000770   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000771   000000 701000 xent               TSX1    IRR$WRBIN
         2 000772   000000 011000                    NOP     0
         2 000773   001003 710000 2                  TRA     NXTDCB

      404    11875    3                 ELSE CALL IRR$WRASC( N );

  11875  2 000774   200050 631500                    EPPR1   N,,AUTO
         2 000775   200144 451500                    STP1    J+1,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:89   
         2 000776   200144 630500                    EPPR0   J+1,,AUTO
         2 000777   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001000   000000 701000 xent               TSX1    IRR$WRASC
         2 001001   000000 011000                    NOP     0
         2 001002   001003 710000 2                  TRA     NXTDCB

      405    11876    3               CASE(ELSE);

      406    11877    3               END;

      407    11878    2   NXTDCB:    END;

  11878  2 001003   200005 054100       NXTDCB       AOS     J,,AUTO
         2 001004   200006 236100                    LDQ     NUMDCBS,,AUTO
         2 001005   000107 604000 2                  TMI     s:11734
         2 001006   200005 116100                    CMPQ    J,,AUTO
         2 001007   000107 605000 2                  TPL     s:11734

      408    11879    1           IF ERRCODE ~= 0 THEN

  11879  2 001010   200032 235100                    LDA     ERRCODE,,AUTO
         2 001011   001013 600000 2                  TZE     s:11882

      409    11880    1              ALTRETURN;

  11880  2 001012   000000 702200 xent               TSX2  ! X66_AALT

      410    11881    1           ELSE
      411    11882    1              RETURN;

  11882  2 001013   000000 702200 xent               TSX2  ! X66_ARET

      412    11883        /**/
      413    11884    1   ALT:    ALTRETURN;                      /* Error                              */

  11884  2 001014   000000 702200 xent  ALT          TSX2  ! X66_AALT

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:90   
      414    11885        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:91   
      415    11886        /*
      416    11887                    ****************************************************
      417    11888                    *  Update FITs for all files and file directories  *
      418    11889                    ****************************************************
      419    11890        */
      420    11891        /**/
      421    11892    1   IRF$CFUS: ENTRY ALTRET;

  11892  2 001015   000000 700200 xent  IRF$CFUS     TSX0  ! X66_AUTO_0
         2 001016   000160 000000                    ZERO    112,0

      422    11893        /**/
      423    11894    1           REMUNWIND=RV_UNWIND1;           /* Remember Linda's trap handler      */

  11894  2 001017   000000 237000 xsym               LDAQ    RV_UNWIND1
         2 001020   200036 757100                    STAQ    REMUNWIND,,AUTO

      424    11895    1           RV_BUFF.CURCG='0'B;

  11895  2 001021   000000 100400                    MLR     fill='000'O
         2 001022   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 001023   000470 000014 xsym               ADSC9   RV_BUFF+312              cn=0,n=12

      425    11896    1           RV_DCTX=0;

  11896  2 001024   000000 450000 xsym               STZ     RV_DCTX

      426    11897    1           ERRCODE=0;

  11897  2 001025   200032 450100                    STZ     ERRCODE,,AUTO

      427    11898    1           PHASE=1;                        /* Closing CFU files                  */

  11898  2 001026   000001 235007                    LDA     1,DL
         2 001027   200034 755100                    STA     PHASE,,AUTO

      428    11899    1           ACCT=' ';
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:92   

  11899  2 001030   000035 235000 xsym               LDA     B_VECTNIL+29
         2 001031   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 001032   200027 755100                    STA     ACCT,,AUTO
         2 001033   200030 756100                    STQ     ACCT+1,,AUTO

      429    11900    1           SN=' ';

  11900  2 001034   040100 100400                    MLR     fill='040'O
         2 001035   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001036   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

      430    11901    1           ASN=0;

  11901  2 001037   200031 450100                    STZ     ASN,,AUTO

      431    11902    1           NAME$=ADDR(NIL);

  11902  2 001040   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001041   200023 756100                    STQ     NAME$,,AUTO

      432    11903    1           DCB$=ADDR(NIL);

  11903  2 001042   200010 756100                    STQ     DCB$,,AUTO

      433    11904    1           RVF_ERRMSG.USR=' ';

  11904  2 001043   040000 100400                    MLR     fill='040'O
         2 001044   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001045   000004 600003 xsym               ADSC9   RVF_ERRMSG+4             cn=3,n=3

      434    11905    1           OP=0;

  11905  2 001046   200033 450100                    STZ     OP,,AUTO

      435    11906    1           MISC1=0;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:93   
  11906  2 001047   200045 450100                    STZ     MISC1,,AUTO

      436    11907    1           MISC2=0;

  11907  2 001050   200046 450100                    STZ     MISC2,,AUTO

      437    11908    1           NAMEX=FM$CFUX.NAMES;            /* Byte index of first name           */

  11908  2 001051   000000 470400 xsym               LDP0    R$CFU$
         2 001052   000001 236100                    LDQ     1,,PR0
         2 001053   777777 376007                    ANQ     -1,DL
         2 001054   200024 756100                    STQ     NAMEX,,AUTO

      438    11909    1           CALL CVTPTR(ADDR(FM_SYSSETX),CFU$);

  11909  2 001055   000017 236000 3                  LDQ     15
         2 001056   200152 756100                    STQ     J+7,,AUTO
         2 001057   200012 631500                    EPPR1   CFU$,,AUTO
         2 001060   200132 451500                    STP1    @IP$+1,,AUTO
         2 001061   200152 633500                    EPPR3   J+7,,AUTO
         2 001062   200131 453500                    STP3    MIR_DQH$+3,,AUTO
         2 001063   004442 701000 2                  TSX1    CVTPTR
         2 001064   000000 011000                    NOP     0

      439    11910    1           SYSSETX=CFU$->PG(0);

  11910  2 001065   200012 470500                    LDP0    CFU$,,AUTO
         2 001066   000000 235100                    LDA     0,,PR0
         2 001067   200044 755100                    STA     SYSSETX,,AUTO

      440    11911    2           DO WHILE(NAMEX<FM$CFUX.NAMEX);

  11911  2 001070   000000 471400 xsym               LDP1    R$CFU$
         2 001071   100002 236100                    LDQ     2,,PR1
         2 001072   777777 376007                    ANQ     -1,DL
         2 001073   200024 116100                    CMPQ    NAMEX,,AUTO
         2 001074   001357 602000 2                  TNC     s:11980
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:94   
         2 001075   001357 600000 2                  TZE     s:11980

      441    11912    2              OP=OP_SRCHNM;

  11912  2 001076   000004 235007                    LDA     4,DL
         2 001077   200033 755100                    STA     OP,,AUTO

      442    11913    2              NAME$=PINCRC(F$CFU$,NAMEX);

  11913  2 001100   200024 236100                    LDQ     NAMEX,,AUTO
         2 001101   000020 736000                    QLS     16
         2 001102   000000 036000 xsym               ADLQ    R$CFU$
         2 001103   200023 756100                    STQ     NAME$,,AUTO

      443    11914    2              CFUX=FM$CFUN.LNKX;           /* First CFU for this name            */

  11914  2 001104   200023 470500                    LDP0    NAME$,,AUTO
         2 001105   000100 101500                    MRL     fill='000'O
         2 001106   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         2 001107   200020 000004                    ADSC9   CFUX,,AUTO               cn=0,n=4

      444    11915    3              DO WHILE(CFUX~=NAMEX);

  11915  2 001110   200020 236100                    LDQ     CFUX,,AUTO
         2 001111   200024 116100                    CMPQ    NAMEX,,AUTO
         2 001112   001341 600000 2                  TZE     NXTNAME

      445    11916    3                 ASN=0;

  11916  2 001113   200031 450100                    STZ     ASN,,AUTO

      446    11917    3                 CFU$=PINCRW(F$CFU$,CFUX);

  11917  2 001114   200020 236100                    LDQ     CFUX,,AUTO
         2 001115   000022 736000                    QLS     18
         2 001116   000000 036000 xsym               ADLQ    R$CFU$
         2 001117   200012 756100                    STQ     CFU$,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:95   

      447    11918    3                 IF FM$CFU.FITSDA=0 OR FM$CFU.FUN=0 OR FM$CFU.USECNT=0 THEN

  11918  2 001120   200012 470500                    LDP0    CFU$,,AUTO
         2 001121   000000 236100                    LDQ     0,,PR0
         2 001122   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 001123   001331 600000 2                  TZE     NXTCFU
         2 001124   700000 316003                    CANQ    -32768,DU
         2 001125   001331 600000 2                  TZE     NXTCFU
         2 001126   000003 720100                    LXL0    3,,PR0
         2 001127   001331 600000 2                  TZE     NXTCFU

      448    11919    3                    GOTO NXTCFU;
      449    11920    3                 IF NOT FM$CFU.SHARED THEN

  11920  2 001130   002000 316003                    CANQ    1024,DU
         2 001131   001331 600000 2                  TZE     NXTCFU

      450    11921    3                    GOTO NXTCFU;           /* Nothing to do here                 */
      451    11922    3                 FM$CFU.SHARED='0'B;       /* Don't try to close again           */

  11922  2 001132   000012 236000 3                  LDQ     10
         2 001133   000000 356100                    ANSQ    0,,PR0

      452    11923    4                 IF FM$CFUF.ACCNAM=0 THEN DO; /* Scratch file                    */

  11923  2 001134   200012 470500                    LDP0    CFU$,,AUTO
         2 001135   000002 235100                    LDA     2,,PR0
         2 001136   001147 601000 2                  TNZ     s:11929

      453    11924    4                    ACCT='*SCRTCH*';

  11924  2 001137   000240 237000 1                  LDAQ    SEGTAB+22
         2 001140   200027 755100                    STA     ACCT,,AUTO
         2 001141   200030 756100                    STQ     ACCT+1,,AUTO

      454    11925    4                    ACCT$=ADDR(NIL);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:96   

  11925  2 001142   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001143   200022 756100                    STQ     ACCT$,,AUTO

      455    11926    4                    SETX=SYSSETX;

  11926  2 001144   200044 235100                    LDA     SYSSETX,,AUTO
         2 001145   200016 755100                    STA     SETX,,AUTO

      456    11927    4                    END;

  11927  2 001146   001206 710000 2                  TRA     s:11942

      457    11928    3                 ELSE
      458    11929    4                    IF FM$CFU.STARX.F=0 THEN DO;

  11929  2 001147   000002 236100                    LDQ     2,,PR0
         2 001150   400000 316003                    CANQ    -131072,DU
         2 001151   001176 601000 2                  TNZ     s:11938

      459    11930    4                       ACCTX=FM$CFU.ACCTX;

  11930  2 001152   000002 236100                    LDQ     2,,PR0
         2 001153   000022 772000                    QRL     18
         2 001154   200021 756100                    STQ     ACCTX,,AUTO

      460    11931    4                       IF ACCTX=0 THEN

  11931  2 001155   001163 601000 2                  TNZ     s:11933

      461    11932    4                          ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;

  11932  2 001156   000002 720100                    LXL0    2,,PR0
         2 001157   000000 471400 xsym               LDP1    R$CFU$
         2 001160   100002 236110                    LDQ     2,X0,PR1
         2 001161   000022 772000                    QRL     18
         2 001162   200021 756100                    STQ     ACCTX,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:97   

      462    11933    4                       ACCT$=PINCRW(F$CFU$,ACCTX);

  11933  2 001163   000022 736000                    QLS     18
         2 001164   000000 036000 xsym               ADLQ    R$CFU$
         2 001165   200022 756100                    STQ     ACCT$,,AUTO

      463    11934    4                       ACCT=FM$CFUA.ACCT;

  11934  2 001166   200022 471500                    LDP1    ACCT$,,AUTO
         2 001167   040100 100500                    MLR     fill='040'O
         2 001170   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         2 001171   200027 000010                    ADSC9   ACCT,,AUTO               cn=0,n=8

      464    11935    4                       SETX=FM$CFUA.SETX;

  11935  2 001172   100000 236100                    LDQ     0,,PR1
         2 001173   000022 772000                    QRL     18
         2 001174   200016 756100                    STQ     SETX,,AUTO

      465    11936    4                       END;

  11936  2 001175   001206 710000 2                  TRA     s:11942

      466    11937    4                    ELSE DO;

      467    11938    4                       ACCT$=ADDR(NIL);

  11938  2 001176   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001177   200022 756100                    STQ     ACCT$,,AUTO

      468    11939    4                       ACCT='*';

  11939  2 001200   000004 235000 3                  LDA     4
         2 001201   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 001202   200027 755100                    STA     ACCT,,AUTO
         2 001203   200030 756100                    STQ     ACCT+1,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:98   

      469    11940    4                       SETX=SYSSETX;

  11940  2 001204   200044 235100                    LDA     SYSSETX,,AUTO
         2 001205   200016 755100                    STA     SETX,,AUTO

      470    11941    4                       END;

      471    11942    3                 SN=FM$SET.PSN(SETX);

  11942  2 001206   200016 235100                    LDA     SETX,,AUTO
         2 001207   000005 735000                    ALS     5
         2 001210   000000 471400 xsym               LDP1    R$CFU$
         2 001211   040100 100505                    MLR     fill='040'O
         2 001212   100000 400006                    ADSC9   0,A,PR1                  cn=2,n=6
         2 001213   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

      472    11943    3                 IF RVF_DEBUG~=0 THEN

  11943  2 001214   000007 236000 1                  LDQ     RVF_DEBUG
         2 001215   001224 600000 2                  TZE     s:11945

      473    11944    3                    CALL PUTNAME(RVF_CLSCFU,RVF_CLSCFU.FID,SIZEC(RVF_CLSCFU.FID));

  11944  2 001216   000020 237000 3                  LDAQ    16
         2 001217   200140 757100                    STAQ    @MSG+1,,AUTO
         2 001220   000022 236000 3                  LDQ     18
         2 001221   200137 756100                    STQ     I+2,,AUTO
         2 001222   004236 701000 2                  TSX1    PUTNAME
         2 001223   000000 011000                    NOP     0

      474    11945    3                 CALL GETFIT ALTRET(NXTCFU);

  11945  2 001224   002573 701000 2                  TSX1    GETFIT
         2 001225   001331 702000 2                  TSX2    NXTCFU

      475    11946    3                 IF FM$GRAN.ORG=%CG# THEN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:99   

  11946  2 001226   000006 470400 1                  LDP0    POBUF$
         2 001227   000001 236100                    LDQ     1,,PR0
         2 001230   036000 376007                    ANQ     15360,DL
         2 001231   026000 116007                    CMPQ    11264,DL
         2 001232   001236 601000 2                  TNZ     s:11949

      476    11947    3                    ASN=%COMGROUP#;

  11947  2 001233   000004 235007                    LDA     4,DL
         2 001234   200031 755100                    STA     ASN,,AUTO
         2 001235   001240 710000 2                  TRA     s:11950

      477    11948    3                 ELSE
      478    11949    3                    ASN=%FILE#;

  11949  2 001236   000001 235007                    LDA     1,DL
         2 001237   200031 755100                    STA     ASN,,AUTO

      479    11950    4                 IF FM$GRAN.ORG=%CG# THEN DO;

  11950  2 001240   026000 116007                    CMPQ    11264,DL
         2 001241   001253 601000 2                  TNZ     s:11956

      480    11951    4                    REMEMBER CGTRAP1 IN RV_UNWIND1;

  11951  2 001242   001531 635000 2                  EAA     CGTRAP1
         2 001243   000000 452400 xsym               STP2    RV_UNWIND1
         2 001244   000001 755000 xsym               STA     RV_UNWIND1+1

      481    11952    4                    CALL CGCLS ALTRET(NXTCFU);

  11952  2 001245   002006 701000 2                  TSX1    CGCLS
         2 001246   001331 702000 2                  TSX2    NXTCFU

      482    11953    4                    RV_UNWIND1=REMUNWIND;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:100  
  11953  2 001247   200036 237100                    LDAQ    REMUNWIND,,AUTO
         2 001250   000000 757000 xsym               STAQ    RV_UNWIND1

      483    11954    4                    CALL GETFIT ALTRET(NXTCFU);

  11954  2 001251   002573 701000 2                  TSX1    GETFIT
         2 001252   001331 702000 2                  TSX2    NXTCFU

      484    11955    4                    END;

      485    11956    3                 CALL UPFIT ALTRET(NXTCFU);

  11956  2 001253   003050 701000 2                  TSX1    UPFIT
         2 001254   001331 702000 2                  TSX2    NXTCFU

      486    11957    3                 IF FM$CFU.FUN=%CREATE#

  11957  2 001255   200012 470500                    LDP0    CFU$,,AUTO
         2 001256   000000 236100                    LDQ     0,,PR0
         2 001257   700000 376003                    ANQ     -32768,DU
         2 001260   300000 116003                    CMPQ    98304,DU
         2 001261   001277 600000 2                  TZE     s:11960
         2 001262   400000 116003                    CMPQ    -131072,DU
         2 001263   001267 601000 2                  TNZ     s:11957+10
         2 001264   000004 236100                    LDQ     4,,PR0
         2 001265   000777 316003                    CANQ    511,DU
         2 001266   001277 601000 2                  TNZ     s:11960
         2 001267   000006 471400 1                  LDP1    POBUF$
         2 001270   100001 236100                    LDQ     1,,PR1
         2 001271   036000 376007                    ANQ     15360,DL
         2 001272   006000 116007                    CMPQ    3072,DL
         2 001273   001304 601000 2                  TNZ     s:11963
         2 001274   000004 236100                    LDQ     4,,PR0
         2 001275   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 001276   001304 601000 2                  TNZ     s:11963

      487    11958    3                   OR FM$CFU.FUN=%JRNL# AND FM$CFUJ.DCTX~=0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:101  
      488    11959    4                   OR FM$GRAN.ORG=%RANDOM# AND FM$CFU.UGRANS=0 THEN DO;

      489    11960    4                    CALL ADDLIST;          /* Not catalogued                     */

  11960  2 001277   004165 701000 2                  TSX1    ADDLIST
         2 001300   000000 011000                    NOP     0

      490    11961    4                    FM$CFU.FITSDA=0;

  11961  2 001301   200012 470500                    LDP0    CFU$,,AUTO
         2 001302   000000 236003                    LDQ     0,DU
         2 001303   000000 552134                    STBQ    0,'34'O,PR0

      491    11962    4                    END;

      492    11963    3                 CALL WRITE;

  11963  2 001304   004547 701000 2                  TSX1    WRITE
         2 001305   000000 011000                    NOP     0

      493    11964    3                 IF FM$GRAN.ORG=%RANDOM# AND FM$CFU.FUN=%UPDATE#

  11964  2 001306   000006 470400 1                  LDP0    POBUF$
         2 001307   000001 236100                    LDQ     1,,PR0
         2 001310   036000 376007                    ANQ     15360,DL
         2 001311   006000 116007                    CMPQ    3072,DL
         2 001312   001331 601000 2                  TNZ     NXTCFU
         2 001313   200012 471500                    LDP1    CFU$,,AUTO
         2 001314   100000 236100                    LDQ     0,,PR1
         2 001315   700000 376003                    ANQ     -32768,DU
         2 001316   100000 116003                    CMPQ    32768,DU
         2 001317   001331 601000 2                  TNZ     NXTCFU
         2 001320   100005 220100                    LDX0    5,,PR1
         2 001321   001331 600000 2                  TZE     NXTCFU

      494    11965    4                   AND FM$CFUR.HEADPP#~=0 THEN DO;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:102  
      495    11966    4                    REMEMBER DSTRAP2 IN RV_UNWIND1;

  11966  2 001322   001327 635000 2                  EAA     DSTRAP2
         2 001323   000000 452400 xsym               STP2    RV_UNWIND1
         2 001324   000001 755000 xsym               STA     RV_UNWIND1+1

      496    11967    4                    CALL DSWRITE;

  11967  2 001325   003474 701000 2                  TSX1    DSWRITE
         2 001326   000000 011000                    NOP     0

      497    11968    4   DSTRAP2:         CALL DSERR;

  11968  2 001327   003774 701000 2     DSTRAP2      TSX1    DSERR
         2 001330   000000 011000                    NOP     0

      498    11969    4                    END;

      499    11970    3   NXTCFU:       RV_UNWIND1=REMUNWIND;

  11970  2 001331   200036 237100       NXTCFU       LDAQ    REMUNWIND,,AUTO
         2 001332   000000 757000 xsym               STAQ    RV_UNWIND1

      500    11971    3                 CFUX=FM$CFU.NAMEX;        /* Next CFU for this name             */

  11971  2 001333   200012 470500                    LDP0    CFU$,,AUTO
         2 001334   000002 236100                    LDQ     2,,PR0
         2 001335   777777 376007                    ANQ     -1,DL
         2 001336   200020 756100                    STQ     CFUX,,AUTO

      501    11972    3                 END;

  11972  2 001337   200024 116100                    CMPQ    NAMEX,,AUTO
         2 001340   001113 601000 2                  TNZ     s:11916

      502    11973    2   NXTNAME:   NAMEX=NAMEX+FM$CFUN.L+3;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:103  
  11973  2 001341   200023 470500       NXTNAME      LDP0    NAME$,,AUTO
         2 001342   000100 101500                    MRL     fill='000'O
         2 001343   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         2 001344   200144 000004                    ADSC9   J+1,,AUTO                cn=0,n=4
         2 001345   200144 236100                    LDQ     J+1,,AUTO
         2 001346   200024 036100                    ADLQ    NAMEX,,AUTO
         2 001347   000003 036007                    ADLQ    3,DL
         2 001350   200024 756100                    STQ     NAMEX,,AUTO

      503    11974    2              END;

  11974  2 001351   000000 471400 xsym               LDP1    R$CFU$
         2 001352   100002 236100                    LDQ     2,,PR1
         2 001353   777777 376007                    ANQ     -1,DL
         2 001354   200024 116100                    CMPQ    NAMEX,,AUTO
         2 001355   001357 600000 2                  TZE     s:11980
         2 001356   001076 603000 2                  TRC     s:11912

      504    11975        /**/
      505    11976        /**/
      506    11977        /* Update FD FITs */
      507    11978        /**/
      508    11979        /**/
      509    11980    1           CFU$=ADDR(NIL);

  11980  2 001357   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001360   200012 756100                    STQ     CFU$,,AUTO

      510    11981    1           NAME$=ADDR(NIL);

  11981  2 001361   200023 756100                    STQ     NAME$,,AUTO

      511    11982    1           PHASE=2;                        /* Updating account FITs              */

  11982  2 001362   000002 235007                    LDA     2,DL
         2 001363   200034 755100                    STA     PHASE,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:104  
      512    11983    1           ACCTX=FM$CFUX.ACCTS;            /* First account block                */

  11983  2 001364   100000 236100                    LDQ     0,,PR1
         2 001365   777777 376007                    ANQ     -1,DL
         2 001366   200021 756100                    STQ     ACCTX,,AUTO

      513    11984    1           OP=OP_SRCHAC;

  11984  2 001367   000005 235007                    LDA     5,DL
         2 001370   200033 755100                    STA     OP,,AUTO

      514    11985    2           DO WHILE(ACCTX~=0);

  11985  2 001371   000000 116003                    CMPQ    0,DU
         2 001372   001442 600000 2                  TZE     s:11999

      515    11986    2              ACCT$=PINCRW(F$CFU$,ACCTX);

  11986  2 001373   200021 236100                    LDQ     ACCTX,,AUTO
         2 001374   000022 736000                    QLS     18
         2 001375   000000 036000 xsym               ADLQ    R$CFU$
         2 001376   200022 756100                    STQ     ACCT$,,AUTO

      516    11987    2              IF FM$CFUA.GMOD=0 THEN

  11987  2 001377   200022 470500                    LDP0    ACCT$,,AUTO
         2 001400   000005 236100                    LDQ     5,,PR0
         2 001401   100000 316003                    CANQ    32768,DU
         2 001402   001435 600000 2                  TZE     NXTACCT

      517    11988    2                 GOTO NXTACCT;
      518    11989    2              ACCT=FM$CFUA.ACCT;

  11989  2 001403   040100 100500                    MLR     fill='040'O
         2 001404   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         2 001405   200027 000010                    ADSC9   ACCT,,AUTO               cn=0,n=8

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:105  
      519    11990    2              SETX=FM$CFUA.SETX;

  11990  2 001406   000000 236100                    LDQ     0,,PR0
         2 001407   000022 772000                    QRL     18
         2 001410   200016 756100                    STQ     SETX,,AUTO

      520    11991    2              SN=FM$SET.PSN(SETX);

  11991  2 001411   200016 235100                    LDA     SETX,,AUTO
         2 001412   000005 735000                    ALS     5
         2 001413   000000 471400 xsym               LDP1    R$CFU$
         2 001414   040100 100505                    MLR     fill='040'O
         2 001415   100000 400006                    ADSC9   0,A,PR1                  cn=2,n=6
         2 001416   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

      521    11992    2              IF RVF_DEBUG~=0 THEN

  11992  2 001417   000007 235000 1                  LDA     RVF_DEBUG
         2 001420   001427 600000 2                  TZE     s:11994

      522    11993    2                 CALL PUTNAME(RVF_CLSFD,RVF_CLSFD.FID,SIZEC(RVF_CLSFD.FID));

  11993  2 001421   000024 237000 3                  LDAQ    20
         2 001422   200140 757100                    STAQ    @MSG+1,,AUTO
         2 001423   000026 236000 3                  LDQ     22
         2 001424   200137 756100                    STQ     I+2,,AUTO
         2 001425   004236 701000 2                  TSX1    PUTNAME
         2 001426   000000 011000                    NOP     0

      523    11994    2              CALL GETFDFIT ALTRET(NXTACCT);

  11994  2 001427   004014 701000 2                  TSX1    GETFDFIT
         2 001430   001435 702000 2                  TSX2    NXTACCT

      524    11995    2              CALL UPFDFIT ALTRET(NXTACCT);

  11995  2 001431   004140 701000 2                  TSX1    UPFDFIT
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:106  
         2 001432   001435 702000 2                  TSX2    NXTACCT

      525    11996    2              CALL WRITE;

  11996  2 001433   004547 701000 2                  TSX1    WRITE
         2 001434   000000 011000                    NOP     0

      526    11997    2   NXTACCT:   ACCTX=FM$CFUA.LINKX;

  11997  2 001435   200022 470500       NXTACCT      LDP0    ACCT$,,AUTO
         2 001436   000000 236100                    LDQ     0,,PR0
         2 001437   777777 376007                    ANQ     -1,DL
         2 001440   200021 756100                    STQ     ACCTX,,AUTO

      527    11998    2              END;

  11998  2 001441   001373 601000 2                  TNZ     s:11986

      528    11999    1           OP=OP_RELFILS;

  11999  2 001442   000011 235007                    LDA     9,DL
         2 001443   200033 755100                    STA     OP,,AUTO

      529    12000    1           ACCT=' ';

  12000  2 001444   000035 235000 xsym               LDA     B_VECTNIL+29
         2 001445   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 001446   200027 755100                    STA     ACCT,,AUTO
         2 001447   200030 756100                    STQ     ACCT+1,,AUTO

      530    12001    1           SETX=FM$CFUX.SETH;              /* PUT CHAIN OF FILES TO RELEASE      */

  12001  2 001450   000000 470400 xsym               LDP0    R$CFU$
         2 001451   000005 236100                    LDQ     5,,PR0
         2 001452   000022 772000                    QRL     18
         2 001453   200016 756100                    STQ     SETX,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:107  
      531    12002    2           DO WHILE(SETX~=0);              /* ON BLINK OF FM_GPSDA               */

  12002  2 001454   001527 600000 2                  TZE     s:12015

      532    12003    3              IF FM$SET.SET(SETX) AND FM$SET.CHKSM(SETX)>FM_SRZERO THEN DO;

  12003  2 001455   200016 235100                    LDA     SETX,,AUTO
         2 001456   000003 735000                    ALS     3
         2 001457   000000 470400 xsym               LDP0    R$CFU$
         2 001460   000002 236105                    LDQ     2,AL,PR0
         2 001461   200000 316003                    CANQ    65536,DU
         2 001462   001520 600000 2                  TZE     NXTSET
         2 001463   000002 236000 1                  LDQ     FM_SRZERO
         2 001464   000007 116105                    CMPQ    7,AL,PR0
         2 001465   001520 603000 2                  TRC     NXTSET

      533    12004    3                 SN=FM$SET.PSN(SETX);

  12004  2 001466   200016 235100                    LDA     SETX,,AUTO
         2 001467   000005 735000                    ALS     5
         2 001470   040100 100505                    MLR     fill='040'O
         2 001471   000000 400006                    ADSC9   0,A,PR0                  cn=2,n=6
         2 001472   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

      534    12005    3                 IF RVF_DEBUG~=0 THEN

  12005  2 001473   000007 235000 1                  LDA     RVF_DEBUG
         2 001474   001503 600000 2                  TZE     s:12007

      535    12006    3                    CALL PUTNAME(RVF_RELGRAN,RVF_RELGRAN.PSN,SIZEC(RVF_RELGRAN.PSN));

  12006  2 001475   000030 237000 3                  LDAQ    24
         2 001476   200140 757100                    STAQ    @MSG+1,,AUTO
         2 001477   000032 236000 3                  LDQ     26
         2 001500   200137 756100                    STQ     I+2,,AUTO
         2 001501   004236 701000 2                  TSX1    PUTNAME
         2 001502   000000 011000                    NOP     0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:108  

      536    12007    3                 CALL GETGPFIT ALTRET(NXTSET);

  12007  2 001503   004076 701000 2                  TSX1    GETGPFIT
         2 001504   001520 702000 2                  TSX2    NXTSET

      537    12008    3                 FM$GRAN.BLINK=FM$SET.CHKSM(SETX);

  12008  2 001505   200016 235100                    LDA     SETX,,AUTO
         2 001506   000003 735000                    ALS     3
         2 001507   000000 470400 xsym               LDP0    R$CFU$
         2 001510   000007 235105                    LDA     7,AL,PR0
         2 001511   000006 471400 1                  LDP1    POBUF$
         2 001512   100003 755100                    STA     3,,PR1

      538    12009    3                 FM$SET.CHKSM(SETX)=0;

  12009  2 001513   200016 236100                    LDQ     SETX,,AUTO
         2 001514   000003 736000                    QLS     3
         2 001515   000007 450106                    STZ     7,QL,PR0

      539    12010    3                 CALL WRITE;

  12010  2 001516   004547 701000 2                  TSX1    WRITE
         2 001517   000000 011000                    NOP     0

      540    12011    3                 END;

      541    12012    2   NXTSET:    SETX=FM$SET.SETL(SETX);

  12012  2 001520   200016 235100       NXTSET       LDA     SETX,,AUTO
         2 001521   000003 735000                    ALS     3
         2 001522   000000 470400 xsym               LDP0    R$CFU$
         2 001523   000005 236105                    LDQ     5,AL,PR0
         2 001524   000022 772000                    QRL     18
         2 001525   200016 756100                    STQ     SETX,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:109  
      542    12013    2              END;

  12013  2 001526   001455 601000 2                  TNZ     s:12003

      543    12014        /**/
      544    12015    1           RVF_ERRCNT=0;                   /* Reset for next screech             */

  12015  2 001527   000000 450000 xsym               STZ     RVF_ERRCNT

      545    12016    1           RETURN;

  12016  2 001530   000000 702200 xent               TSX2  ! X66_ARET

      546    12017        /**/
      547    12018    1   CGTRAP1: REMEMBER CGTRAP2 IN RV_UNWIND1;

  12018  2 001531   001554 635000 2     CGTRAP1      EAA     CGTRAP2
         2 001532   000000 452400 xsym               STP2    RV_UNWIND1
         2 001533   000001 755000 xsym               STA     RV_UNWIND1+1

      548    12019    1           RV_BUFF.CGQTRAP='1'B;

  12019  2 001534   000400 236007                    LDQ     256,DL
         2 001535   000003 256000 xsym               ORSQ    RV_BUFF+3

      549    12020    1           IF DUMPFLG~=0 AND RV_BUFF.CURCG~='0'B THEN

  12020  2 001536   200040 235100                    LDA     DUMPFLG,,AUTO
         2 001537   001546 600000 2                  TZE     s:12022
         2 001540   000000 106400                    CMPC    fill='000'O
         2 001541   000470 000014 xsym               ADSC9   RV_BUFF+312              cn=0,n=12
         2 001542   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
         2 001543   001546 600000 2                  TZE     s:12022

      550    12021    1              RV_BUFF.CURCG.TRAP='1'B;

  12021  2 001544   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:110  
         2 001545   000471 256000 xsym               ORSQ    RV_BUFF+313

      551    12022    1           CALL PUTNAME(RVF_CGTRAP,RVF_CGTRAP.FID,SIZEC(RVF_CGTRAP.FID));

  12022  2 001546   000034 237000 3                  LDAQ    28
         2 001547   200140 757100                    STAQ    @MSG+1,,AUTO
         2 001550   000036 236000 3                  LDQ     30
         2 001551   200137 756100                    STQ     I+2,,AUTO
         2 001552   004236 701000 2                  TSX1    PUTNAME
         2 001553   000000 011000                    NOP     0

  12020  2 001554                       CGTRAP2      null
      552    12023    1   CGTRAP2: ;
      553    12024    1           GOTO NXTCFU;

  12024  2 001554   001331 710000 2                  TRA     NXTCFU

      554    12025        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:111  
      555    12026        /*
      556    12027                     *********************************
      557    12028                     * Dump current comgroup, if any *
      558    12029                     *********************************
      559    12030        */
      560    12031        /**/
      561    12032    1   IRF$DUMPCG: ENTRY ALTRET;

  12032  2 001555   000000 700200 xent  IRF$DUMPCG   TSX0  ! X66_AUTO_0
         2 001556   000160 000000                    ZERO    112,0

      562    12033        /**/
      563    12034    1           ERRCODE=0;

  12034  2 001557   200032 450100                    STZ     ERRCODE,,AUTO

      564    12035    1           PHASE=2;                        /* Dumping comgroup                   */

  12035  2 001560   000002 235007                    LDA     2,DL
         2 001561   200034 755100                    STA     PHASE,,AUTO

      565    12036    1           ACCT=' ';

  12036  2 001562   000035 235000 xsym               LDA     B_VECTNIL+29
         2 001563   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 001564   200027 755100                    STA     ACCT,,AUTO
         2 001565   200030 756100                    STQ     ACCT+1,,AUTO

      566    12037    1           SN=' ';

  12037  2 001566   040100 100400                    MLR     fill='040'O
         2 001567   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001570   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

      567    12038    1           ASN=%COMGROUP#;

  12038  2 001571   000004 235007                    LDA     4,DL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:112  
         2 001572   200031 755100                    STA     ASN,,AUTO

      568    12039    1           NAME$=ADDR(NIL);

  12039  2 001573   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001574   200023 756100                    STQ     NAME$,,AUTO

      569    12040    1           DCB$=ADDR(NIL);

  12040  2 001575   200010 756100                    STQ     DCB$,,AUTO

      570    12041    1           CFU$=ADDR(NIL);

  12041  2 001576   200012 756100                    STQ     CFU$,,AUTO

      571    12042    1           RVF_ERRMSG.USR=' ';

  12042  2 001577   040000 100400                    MLR     fill='040'O
         2 001600   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001601   000004 600003 xsym               ADSC9   RVF_ERRMSG+4             cn=3,n=3

      572    12043    1           OP=0;

  12043  2 001602   200033 450100                    STZ     OP,,AUTO

      573    12044    1           MISC1=0;

  12044  2 001603   200045 450100                    STZ     MISC1,,AUTO

      574    12045    1           MISC2=0;

  12045  2 001604   200046 450100                    STZ     MISC2,,AUTO

      575    12046        /**/
      576    12047    1           IF RV_BUFF.CURCG~='0'B THEN

  12047  2 001605   000000 106400                    CMPC    fill='000'O
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:113  
         2 001606   000470 000014 xsym               ADSC9   RV_BUFF+312              cn=0,n=12
         2 001607   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
         2 001610   001612 600000 2                  TZE     s:12049

      577    12048    1              RETURN;                      /* Already dumped one                 */

  12048  2 001611   000000 702200 xent               TSX2  ! X66_ARET

      578    12049    1           CALL CVTPTR(ADDR(KQ_MMSD$),CTX$) ALTRET(DUMPERR);

  12049  2 001612   000037 236000 3                  LDQ     31
         2 001613   200153 756100                    STQ     J+8,,AUTO
         2 001614   200014 630500                    EPPR0   CTX,,AUTO
         2 001615   200132 450500                    STP0    @IP$+1,,AUTO
         2 001616   200153 631500                    EPPR1   J+8,,AUTO
         2 001617   200131 451500                    STP1    MIR_DQH$+3,,AUTO
         2 001620   004442 701000 2                  TSX1    CVTPTR
         2 001621   002003 702000 2                  TSX2    DUMPERR

      579    12050    1           CALL CVTPTR(CTX$->PTR$(0),CTX$) ALTRET(DUMPERR);

  12050  2 001622   200014 630500                    EPPR0   CTX,,AUTO
         2 001623   200132 450500                    STP0    @IP$+1,,AUTO
         2 001624   200014 236100                    LDQ     CTX,,AUTO
         2 001625   200131 756100                    STQ     MIR_DQH$+3,,AUTO
         2 001626   004442 701000 2                  TSX1    CVTPTR
         2 001627   002003 702000 2                  TSX2    DUMPERR

      580    12051    1           CTX$=CTX$->KQ$MMSD.CGHEAD$;

  12051  2 001630   200014 470500                    LDP0    CTX,,AUTO
         2 001631   000001 236100                    LDQ     1,,PR0
         2 001632   200014 756100                    STQ     CTX,,AUTO

  12051  2 001633                       CHKCG        null
      581    12052    1   CHKCG:  ;
      582    12053    1           IF CTX$=ADDR(NIL) THEN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:114  

  12053  2 001633   200014 236100                    LDQ     CTX,,AUTO
         2 001634   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001635   001637 601000 2                  TNZ     s:12055

      583    12054    1              RETURN;

  12054  2 001636   000000 702200 xent               TSX2  ! X66_ARET

      584    12055    1           OLDCTX$=CTX$;

  12055  2 001637   200047 756100                    STQ     OLDCTX$,,AUTO

      585    12056    1           CALL CVTPTR(CTX$,CTX$) ALTRET(DUMPERR);

  12056  2 001640   200014 630500                    EPPR0   CTX,,AUTO
         2 001641   200132 450500                    STP0    @IP$+1,,AUTO
         2 001642   200014 631500                    EPPR1   CTX,,AUTO
         2 001643   200131 451500                    STP1    MIR_DQH$+3,,AUTO
         2 001644   004442 701000 2                  TSX1    CVTPTR
         2 001645   002003 702000 2                  TSX2    DUMPERR

      586    12057    1           IF KQ$CG.MMD.DSB$=ADDR(NIL) THEN

  12057  2 001646   200014 470500                    LDP0    CTX,,AUTO
         2 001647   000000 236100                    LDQ     0,,PR0
         2 001650   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001651   001665 600000 2                  TZE     NXTCG

      587    12058    1              GOTO NXTCG;
      588    12059    1           CALL CVTPTR(KQ$CG.MMD.DSB$,DSB$) ALTRET(DUMPERR);

  12059  2 001652   200013 631500                    EPPR1   DSB$,,AUTO
         2 001653   200132 451500                    STP1    @IP$+1,,AUTO
         2 001654   200014 236100                    LDQ     CTX,,AUTO
         2 001655   200131 756100                    STQ     MIR_DQH$+3,,AUTO
         2 001656   004442 701000 2                  TSX1    CVTPTR
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:115  
         2 001657   002003 702000 2                  TSX2    DUMPERR

      589    12060    1           IF KQ$DSB.ASR~=ADDR(RV_BUFF.SSFRAME)->B$EXCFR.ASR THEN

  12060  2 001660   200013 470500                    LDP0    DSB$,,AUTO
         2 001661   000000 106500                    CMPC    fill='000'O
         2 001662   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         2 001663   000052 000010 xsym               ADSC9   RV_BUFF+42               cn=0,n=8
         2 001664   001671 600000 2                  TZE     s:12066

      590    12061    2           DO;

  12057  2 001665                       NXTCG        null
      591    12062    2   NXTCG:     ;
      592    12063    2              CTX$=KQ$CG.LNK$;

  12063  2 001665   200014 470500                    LDP0    CTX,,AUTO
         2 001666   000104 236100                    LDQ     68,,PR0
         2 001667   200014 756100                    STQ     CTX,,AUTO

      593    12064    2              GOTO CHKCG;

  12064  2 001670   001633 710000 2                  TRA     CHKCG

      594    12065    2              END;
      595    12066    1           CALL CVTPTR(KQ$CG.CFU$,CFU$) ALTRET(DUMPERR);

  12066  2 001671   200012 631500                    EPPR1   CFU$,,AUTO
         2 001672   200132 451500                    STP1    @IP$+1,,AUTO
         2 001673   200014 236100                    LDQ     CTX,,AUTO
         2 001674   000214 036003                    ADLQ    140,DU
         2 001675   200131 756100                    STQ     MIR_DQH$+3,,AUTO
         2 001676   004442 701000 2                  TSX1    CVTPTR
         2 001677   002003 702000 2                  TSX2    DUMPERR

      596    12067    2           IF FM$CFUF.ACCNAM=0 THEN DO;    /* Scratch file                       */

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:116  
  12067  2 001700   200012 470500                    LDP0    CFU$,,AUTO
         2 001701   000002 235100                    LDA     2,,PR0
         2 001702   001714 601000 2                  TNZ     s:12074

      597    12068    2              ACCT='*SCRTCH*';

  12068  2 001703   000240 237000 1                  LDAQ    SEGTAB+22
         2 001704   200027 755100                    STA     ACCT,,AUTO
         2 001705   200030 756100                    STQ     ACCT+1,,AUTO

      598    12069    2              ACCT$=ADDR(NIL);

  12069  2 001706   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001707   200022 756100                    STQ     ACCT$,,AUTO

      599    12070    2              NAME$=ADDR(NIL);

  12070  2 001710   200023 756100                    STQ     NAME$,,AUTO

      600    12071    2              SETX=SYSSETX;

  12071  2 001711   200044 235100                    LDA     SYSSETX,,AUTO
         2 001712   200016 755100                    STA     SETX,,AUTO

      601    12072    2              END;

  12072  2 001713   001770 710000 2                  TRA     s:12092

      602    12073    1           ELSE
      603    12074    2              IF FM$CFU.STARX.F=0 THEN DO;

  12074  2 001714   000002 236100                    LDQ     2,,PR0
         2 001715   400000 316003                    CANQ    -131072,DU
         2 001716   001757 601000 2                  TNZ     s:12087

      604    12075    2                 ACCTX=FM$CFU.ACCTX;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:117  
  12075  2 001717   000002 236100                    LDQ     2,,PR0
         2 001720   000022 772000                    QRL     18
         2 001721   200021 756100                    STQ     ACCTX,,AUTO

      605    12076    3                 IF ACCTX=0 THEN DO;

  12076  2 001722   001736 601000 2                  TNZ     s:12081

      606    12077    3                    ACCTX=PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.ACCTX;

  12077  2 001723   000002 720100                    LXL0    2,,PR0
         2 001724   000000 471400 xsym               LDP1    R$CFU$
         2 001725   100002 236110                    LDQ     2,X0,PR1
         2 001726   000022 772000                    QRL     18
         2 001727   200021 756100                    STQ     ACCTX,,AUTO

      607    12078    3                    NAME$=PINCRC(F$CFU$,PINCRW(F$CFU$,FM$CFU.NAMEX)->FM$CFU.NAMEX);

  12078  2 001730   100002 236110                    LDQ     2,X0,PR1
         2 001731   777777 376007                    ANQ     -1,DL
         2 001732   000020 736000                    QLS     16
         2 001733   000000 036000 xsym               ADLQ    R$CFU$
         2 001734   200023 756100                    STQ     NAME$,,AUTO

      608    12079    3                    END;

  12079  2 001735   001743 710000 2                  TRA     s:12082

      609    12080    2                 ELSE
      610    12081    2                    NAME$=PINCRC(F$CFU$,FM$CFU.NAMEX);

  12081  2 001736   000002 236100                    LDQ     2,,PR0
         2 001737   777777 376007                    ANQ     -1,DL
         2 001740   000020 736000                    QLS     16
         2 001741   000000 036000 xsym               ADLQ    R$CFU$
         2 001742   200023 756100                    STQ     NAME$,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:118  
      611    12082    2                 ACCT$=PINCRW(F$CFU$,ACCTX);

  12082  2 001743   200021 236100                    LDQ     ACCTX,,AUTO
         2 001744   000022 736000                    QLS     18
         2 001745   000000 036000 xsym               ADLQ    R$CFU$
         2 001746   200022 756100                    STQ     ACCT$,,AUTO

      612    12083    2                 ACCT=FM$CFUA.ACCT;

  12083  2 001747   200022 471500                    LDP1    ACCT$,,AUTO
         2 001750   040100 100500                    MLR     fill='040'O
         2 001751   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         2 001752   200027 000010                    ADSC9   ACCT,,AUTO               cn=0,n=8

      613    12084    2                 SETX=FM$CFUA.SETX;

  12084  2 001753   100000 236100                    LDQ     0,,PR1
         2 001754   000022 772000                    QRL     18
         2 001755   200016 756100                    STQ     SETX,,AUTO

      614    12085    2                 END;

  12085  2 001756   001770 710000 2                  TRA     s:12092

      615    12086    2              ELSE DO;

      616    12087    2                 ACCT$=ADDR(NIL);

  12087  2 001757   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001760   200022 756100                    STQ     ACCT$,,AUTO

      617    12088    2                 NAME$=ADDR(NIL);

  12088  2 001761   200023 756100                    STQ     NAME$,,AUTO

      618    12089    2                 ACCT='*';

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:119  
  12089  2 001762   000004 235000 3                  LDA     4
         2 001763   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 001764   200027 755100                    STA     ACCT,,AUTO
         2 001765   200030 756100                    STQ     ACCT+1,,AUTO

      619    12090    2                 SETX=SYSSETX;

  12090  2 001766   200044 235100                    LDA     SYSSETX,,AUTO
         2 001767   200016 755100                    STA     SETX,,AUTO

      620    12091    2                 END;

      621    12092    1           SN=FM$SET.PSN(SETX);

  12092  2 001770   200016 235100                    LDA     SETX,,AUTO
         2 001771   000005 735000                    ALS     5
         2 001772   000000 471400 xsym               LDP1    R$CFU$
         2 001773   040100 100505                    MLR     fill='040'O
         2 001774   100000 400006                    ADSC9   0,A,PR1                  cn=2,n=6
         2 001775   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6

      622    12093    1           ASN=%COMGROUP#;

  12093  2 001776   000004 236007                    LDQ     4,DL
         2 001777   200031 756100                    STQ     ASN,,AUTO

      623    12094    1           CALL DUMPCG;

  12094  2 002000   002444 701000 2                  TSX1    DUMPCG
         2 002001   000000 011000                    NOP     0

      624    12095    1           RETURN;

  12095  2 002002   000000 702200 xent               TSX2  ! X66_ARET

  12093  2 002003                       DUMPERR      null
      625    12096        /**/
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:120  
      626    12097    1   DUMPERR: ;
      627    12098    1           RV_BUFF.CURCG.ERR='1'B;

  12098  2 002003   200000 236003                    LDQ     65536,DU
         2 002004   000471 256000 xsym               ORSQ    RV_BUFF+313

      628    12099    1           RETURN;

  12099  2 002005   000000 702200 xent               TSX2  ! X66_ARET

      629    12100        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:121  
      630    12101
      631    12102        /* CGCLS - Close a comgroup.  FIT must be in POBUF. */
      632    12103
      633    12104    1   CGCLS:  PROC ALTRET;

  12104  2 002006   200072 741300       CGCLS        STX1  ! MIR_DCTX+1,,AUTO

      634    12105
      635    12106    2   DCL SIZ UBIN;
      636    12107    2   DCL HASH UBIN;
      637    12108    2   DCL DESC# UBIN;
      638    12109    2   DCL PGINDX UBIN;
      639    12110    2   DCL PG$ PTR;
      640    12111    2   DCL RP UBIN;
      641    12112    2   DCL ENTFLG UBIN;
      642    12113        /**/
      643    12114        %KQ_CTLGRAN (FPTN=KQ$CTLGRAN,STCLASS="BASED(POBUF$)");
      644    12200        %KQ_GRAN (FPTN=KQ$GRAN,STCLASS="BASED(POBUF$)");
      645    12255
      646    12256    2           ENTFLG=0;

  12256  2 002007   200101 450100                    STZ     ENTFLG,,AUTO

      647    12257    2           OP=OP_CGCLS;

  12257  2 002010   000012 235007                    LDA     10,DL
         2 002011   200033 755100                    STA     OP,,AUTO

      648    12258    2           HASH=FM$GRAN.STAMP.HASH;

  12258  2 002012   000006 470400 1                  LDP0    POBUF$
         2 002013   000000 236100                    LDQ     0,,PR0
         2 002014   000011 772000                    QRL     9
         2 002015   200074 756100                    STQ     HASH,,AUTO

      649    12259    2           IF FM$CFU.GDA=0 THEN

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:122  
  12259  2 002016   200012 471500                    LDP1    CFU$,,AUTO
         2 002017   100005 236100                    LDQ     5,,PR1
         2 002020   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 002021   002023 601000 2                  TNZ     s:12261

      650    12260    2              RETURN;

  12260  2 002022   000001 702211                    TSX2  ! 1,X1

      651    12261    2           CTX.SID=FM$CFU.GDA;

  12261  2 002023   200014 752103                    STCQ    CTX,'03'O,AUTO

      652    12262    2           CTX.DISP=FM$CFU.LDA;

  12262  2 002024   100006 235100                    LDA     6,,PR1
         2 002025   100007 236100                    LDQ     7,,PR1
         2 002026   000033 773000                    LRL     27
         2 002027   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002030   000014 736000                    QLS     12
         2 002031   200014 752174                    STCQ    CTX,'74'O,AUTO

      653    12263    2           OLDCTX$=CTX$;                   /* Unconverted pointer                */

  12263  2 002032   200014 236100                    LDQ     CTX,,AUTO
         2 002033   200047 756100                    STQ     OLDCTX$,,AUTO

      654    12264    2           FM$CFU.SHARED='0'B;             /* Don't come here again              */

  12264  2 002034   000012 236000 3                  LDQ     10
         2 002035   100000 356100                    ANSQ    0,,PR1

      655    12265    2           CALL CVTPTR(CTX$,CTX$) ALTRET(ERR2);

  12265  2 002036   200014 631500                    EPPR1   CTX,,AUTO
         2 002037   200132 451500                    STP1    @IP$+1,,AUTO
         2 002040   200014 633500                    EPPR3   CTX,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:123  
         2 002041   200131 453500                    STP3    MIR_DQH$+3,,AUTO
         2 002042   004442 701000 2                  TSX1    CVTPTR
         2 002043   002454 702000 2                  TSX2    ERR2

      656    12266    2           CALL CVTPTR(KQ$CG.CFU$,COD$) ALTRET(ERR2);

  12266  2 002044   200043 630500                    EPPR0   COD$,,AUTO
         2 002045   200132 450500                    STP0    @IP$+1,,AUTO
         2 002046   200014 236100                    LDQ     CTX,,AUTO
         2 002047   000214 036003                    ADLQ    140,DU
         2 002050   200131 756100                    STQ     MIR_DQH$+3,,AUTO
         2 002051   004442 701000 2                  TSX1    CVTPTR
         2 002052   002454 702000 2                  TSX2    ERR2

      657    12267    3           IF COD$~=CFU$ THEN DO;

  12267  2 002053   200043 236100                    LDQ     COD$,,AUTO
         2 002054   200012 116100                    CMPQ    CFU$,,AUTO
         2 002055   002066 600000 2                  TZE     s:12272

      658    12268    3              MSC1=CTX; MISC2$=KQ$CG.CFU$;

  12268  2 002056   200014 236100                    LDQ     CTX,,AUTO
         2 002057   200045 756100                    STQ     MISC1,,AUTO

  12268  2 002060   200014 470500                    LDP0    CTX,,AUTO
         2 002061   000214 236100                    LDQ     140,,PR0
         2 002062   200046 756100                    STQ     MISC2,,AUTO

      659    12269    3              ERRCODE=40;

  12269  2 002063   000050 235007                    LDA     40,DL
         2 002064   200032 755100                    STA     ERRCODE,,AUTO

      660    12270    3              GOTO ERR;                    /* CFU$ in context doesn't match      */

  12270  2 002065   002452 710000 2                  TRA     ERR
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:124  

      661    12271    3              END;
      662    12272    2           DA=FM_FRZERO;

  12272  2 002066   000000 235000 1                  LDA     FM_FRZERO
         2 002067   200003 755100                    STA     DA,,AUTO

      663    12273    2           CALL READ ALTRET(ERR2);

  12273  2 002070   004706 701000 2                  TSX1    READ
         2 002071   002454 702000 2                  TSX2    ERR2

      664    12274    2           IF KQ$GRAN.STAMP.HASH~=HASH OR KQ$GRAN.PTYP~=%KQ_PTYP_CTL

  12274  2 002072   000006 470400 1                  LDP0    POBUF$
         2 002073   000000 236100                    LDQ     0,,PR0
         2 002074   000011 772000                    QRL     9
         2 002075   200074 116100                    CMPQ    HASH,,AUTO
         2 002076   002107 601000 2                  TNZ     s:12276
         2 002077   000001 236100                    LDQ     1,,PR0
         2 002100   000007 376003                    ANQ     7,DU
         2 002101   000003 116003                    CMPQ    3,DU
         2 002102   002107 601000 2                  TNZ     s:12276
         2 002103   000001 236100                    LDQ     1,,PR0
         2 002104   036000 376007                    ANQ     15360,DL
         2 002105   026000 116007                    CMPQ    11264,DL
         2 002106   002116 600000 2                  TZE     s:12280

      665    12275    3             OR KQ$GRAN.ORG~=%CG# THEN DO;

      666    12276    3              MISC1=POBUF$->PG(0); MISC2=POBUF$->PG(1);

  12276  2 002107   000000 235100                    LDA     0,,PR0
         2 002110   200045 755100                    STA     MISC1,,AUTO

  12276  2 002111   000001 235100                    LDA     1,,PR0
         2 002112   200046 755100                    STA     MISC2,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:125  

      667    12277    3              ERRCODE=43;

  12277  2 002113   000053 236007                    LDQ     43,DL
         2 002114   200032 756100                    STQ     ERRCODE,,AUTO

      668    12278    3              GOTO ERR;

  12278  2 002115   002452 710000 2                  TRA     ERR

      669    12279    3              END;
      670    12280    2           IF KQ$CTLGRAN.CTXX<SIZEW(KQ$CTLGRAN) OR KQ$CTLGRAN.CTXX>1024-SIZEW(KQ$CG)

  12280  2 002116   000004 235100                    LDA     4,,PR0
         2 002117   000032 115007                    CMPA    26,DL
         2 002120   002126 602000 2                  TNC     s:12282
         2 002121   001513 115007                    CMPA    843,DL
         2 002122   002126 603000 2                  TRC     s:12282
         2 002123   000005 235100                    LDA     5,,PR0
         2 002124   000266 115007                    CMPA    182,DL
         2 002125   002131 603000 2                  TRC     ENDCTL

      671    12281    3             OR KQ$CTLGRAN.CTXSIZ<SIZEW(KQ$CG) THEN DO;

      672    12282    3              ERRCODE=44;

  12282  2 002126   000054 235007                    LDA     44,DL
         2 002127   200032 755100                    STA     ERRCODE,,AUTO

      673    12283    3              GOTO ERR;

  12283  2 002130   002452 710000 2                  TRA     ERR

  12280  2 002131                       ENDCTL       null
      674    12284    3              END;
      675    12285    2   ENDCTL: ;
      676    12286    2           SIZ=KQ$CG.NGAVAL;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:126  

  12286  2 002131   200014 471500                    LDP1    CTX,,AUTO
         2 002132   100217 235100                    LDA     143,,PR1
         2 002133   200073 755100                    STA     SIZ,,AUTO

      677    12287    2           IF KQ$CTLGRAN.RCVRSIZ~=0 THEN

  12287  2 002134   000007 235100                    LDA     7,,PR0
         2 002135   002141 600000 2                  TZE     s:12290

      678    12288    2              ENTFLG=1;                    /* Dont't close - just dump           */

  12288  2 002136   000001 235007                    LDA     1,DL
         2 002137   200101 755100                    STA     ENTFLG,,AUTO
         2 002140   002144 710000 2                  TRA     s:12291

      679    12289    2           ELSE
      680    12290    2              PGTBL='0'B;

  12290  2 002141   000100 100400                    MLR     fill='000'O
         2 002142   000002 020001 xsym               ADSC6   B_VECTNIL+2              cn=0,n=1
         2 002143   200051 020062                    ADSC6   PGTBL,,AUTO              cn=0,n=50

      681    12291    2           CALL CVTPTR(KQ$CG.MMD.DSB$,DSB$) ALTRET(ERR2);

  12291  2 002144   200013 633500                    EPPR3   DSB$,,AUTO
         2 002145   200132 453500                    STP3    @IP$+1,,AUTO
         2 002146   200014 236100                    LDQ     CTX,,AUTO
         2 002147   200131 756100                    STQ     MIR_DQH$+3,,AUTO
         2 002150   004442 701000 2                  TSX1    CVTPTR
         2 002151   002454 702000 2                  TSX2    ERR2

      682    12292    2           DA=KQ$CG.UGRANS+FM_FRZERO;

  12292  2 002152   200014 470500                    LDP0    CTX,,AUTO
         2 002153   000220 236100                    LDQ     144,,PR0
         2 002154   000000 036000 1                  ADLQ    FM_FRZERO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:127  
         2 002155   200003 756100                    STQ     DA,,AUTO

      683    12293    2           DESC#=0;

  12293  2 002156   200075 450100                    STZ     DESC#,,AUTO

      684    12294    2           PGINDX=0;

  12294  2 002157   200076 450100                    STZ     PGINDX,,AUTO

      685    12295    2           IF RV_BUFF.CURCG='0'B AND DSB$->KQ$DSB.ASR=ADDR(RV_BUFF.SSFRAME)->

  12295  2 002160   000000 106400                    CMPC    fill='000'O
         2 002161   000470 000014 xsym               ADSC9   RV_BUFF+312              cn=0,n=12
         2 002162   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
         2 002163   002226 601000 2                  TNZ     s:12307
         2 002164   200013 471500                    LDP1    DSB$,,AUTO
         2 002165   000000 106500                    CMPC    fill='000'O
         2 002166   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         2 002167   000052 000010 xsym               ADSC9   RV_BUFF+42               cn=0,n=8
         2 002170   002226 601000 2                  TNZ     s:12307

      686    12296    3             B$EXCFR.ASR THEN DO;

  12295  2 002171                       BEGINDUMP    null
      687    12297    3   BEGINDUMP: ;
      688    12298    3              DUMPFLG=1; RV_BUFF.CURCG.DA=RV_NXTGRAN; RV_BUFF.CURCG.CG$=OLDCTX$;

  12298  2 002171   000001 235007                    LDA     1,DL
         2 002172   200040 755100                    STA     DUMPFLG,,AUTO

  12298  2 002173   000000 236000 xsym               LDQ     RV_NXTGRAN
         2 002174   000470 756000 xsym               STQ     RV_BUFF+312

  12298  2 002175   200047 236100                    LDQ     OLDCTX$,,AUTO
         2 002176   000472 756000 xsym               STQ     RV_BUFF+314

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:128  
      689    12299    3              POBUF$->KQ$DSB=DSB$->KQ$DSB;

  12299  2 002177   200013 470500                    LDP0    DSB$,,AUTO
         2 002200   000006 471400 1                  LDP1    POBUF$
         2 002201   000100 100500                    MLR     fill='000'O
         2 002202   000000 000330                    ADSC9   0,,PR0                   cn=0,n=216
         2 002203   100000 000330                    ADSC9   0,,PR1                   cn=0,n=216

      690    12300    3              CALL IRR$WPOBUFF ALTRET(DUMPERR);

  12300  2 002204   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002205   000000 701000 xent               TSX1    IRR$WPOBUFF
         2 002206   002456 702000 2                  TSX2    DUMPERR

      691    12301    3              RV_BUFF.CURCG.SZ=RV_BUFF.CURCG.SZ+1;

  12301  2 002207   000471 720000 xsym               LXL0    RV_BUFF+313
         2 002210   000001 621010                    EAX1    1,X0
         2 002211   000471 441000 xsym               SXL1    RV_BUFF+313

      692    12302    3              RV_BUFF.SIZE=RV_BUFF.SIZE+1;

  12302  2 002212   000002 235000 xsym               LDA     RV_BUFF+2
         2 002213   000001 035007                    ADLA    1,DL
         2 002214   000002 755000 xsym               STA     RV_BUFF+2

      693    12303    3              IF RVF_DEBUG~=0 THEN

  12303  2 002215   000007 236000 1                  LDQ     RVF_DEBUG
         2 002216   002227 600000 2                  TZE     LOOP

      694    12304    3                 CALL PUTNAME(RVF_DUMPCG,RVF_DUMPCG.FID,SIZEC(RVF_DUMPCG.FID));

  12304  2 002217   000040 237000 3                  LDAQ    32
         2 002220   200140 757100                    STAQ    @MSG+1,,AUTO
         2 002221   000042 236000 3                  LDQ     34
         2 002222   200137 756100                    STQ     I+2,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:129  
         2 002223   004236 701000 2                  TSX1    PUTNAME
         2 002224   000000 011000                    NOP     0

      695    12305    3              END;

  12305  2 002225   002227 710000 2                  TRA     LOOP

      696    12306    2           ELSE
      697    12307    2              DUMPFLG=0;

  12307  2 002226   200040 450100                    STZ     DUMPFLG,,AUTO

  12304  2 002227                       LOOP         null
      698    12308        /**/
      699    12309    2   LOOP:   ;
      700    12310    3           DO WHILE('1'B);

      701    12311    3   NXTP :     ;

  12311  2 002227                       NXTP         null
      702    12312    3              CALL FINDCGPAGE(DSB$->KQ$DSB,DESC#,PGINDX,PG$,RP) ALTRET(ENDRCVR);

  12312  2 002227   200100 630500                    EPPR0   RP,,AUTO
         2 002230   200107 450500                    STP0    ENTFLG+1,,AUTO
         2 002231   200077 631500                    EPPR1   PG$,,AUTO
         2 002232   200106 451500                    STP1    RSLT+1,,AUTO
         2 002233   200076 633500                    EPPR3   PGINDX,,AUTO
         2 002234   200105 453500                    STP3    @ASNUM+1,,AUTO
         2 002235   200075 634500                    EPPR4   DESC#,,AUTO
         2 002236   200104 454500                    STP4    @KQ$DSB+1,,AUTO
         2 002237   200013 236100                    LDQ     DSB$,,AUTO
         2 002240   200103 756100                    STQ     ENTFLG+2,,AUTO
         2 002241   002464 701000 2                  TSX1    FINDCGPAGE
         2 002242   002377 702000 2                  TSX2    ENDRCVR

      703    12313    3              MEMDESC.BADDR=RP*4096;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:130  
  12313  2 002243   200100 235100                    LDA     RP,,AUTO
         2 002244   000014 735000                    ALS     12
         2 002245   000001 755000 xsym               STA     MEMDESC+1

      704    12314    3              POBUF$->PG=I$MEM$->PG;       /* Move page to POBUF                 */

  12314  2 002246   000000 470400 xsym               LDP0    I$MEM$
         2 002247   010000 220003                    LDX0    4096,DU
         2 002250   000006 471400 1                  LDP1    POBUF$
         2 002251   000140 100540                    MLR     fill='000'O
         2 002252   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 002253   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

      705    12315    4              IF DUMPFLG~=0 THEN DO;

  12315  2 002254   200040 235100                    LDA     DUMPFLG,,AUTO
         2 002255   002267 600000 2                  TZE     ENDDUMP

      706    12316    4                 CALL IRR$WPOBUFF ALTRET(DUMPERR);

  12316  2 002256   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002257   000000 701000 xent               TSX1    IRR$WPOBUFF
         2 002260   002456 702000 2                  TSX2    DUMPERR

      707    12317    4                 RV_BUFF.CURCG.SZ=RV_BUFF.CURCG.SZ+1;

  12317  2 002261   000471 720000 xsym               LXL0    RV_BUFF+313
         2 002262   000001 621010                    EAX1    1,X0
         2 002263   000471 441000 xsym               SXL1    RV_BUFF+313

      708    12318    4                 RV_BUFF.SIZE=RV_BUFF.SIZE+1;

  12318  2 002264   000002 235000 xsym               LDA     RV_BUFF+2
         2 002265   000001 035007                    ADLA    1,DL
         2 002266   000002 755000 xsym               STA     RV_BUFF+2

      709    12319    4                 END;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:131  

  12315  2 002267                       ENDDUMP      null
      710    12320    3   ENDDUMP:   ;
      711    12321    4              IF ENTFLG=0 THEN DO;

  12321  2 002267   200101 235100                    LDA     ENTFLG,,AUTO
         2 002270   002227 601000 2                  TNZ     LOOP

      712    12322    4                 IF KQ$GRAN.PTYP=0 THEN

  12322  2 002271   000006 470400 1                  LDP0    POBUF$
         2 002272   000001 236100                    LDQ     1,,PR0
         2 002273   000007 316003                    CANQ    7,DU
         2 002274   002227 600000 2                  TZE     LOOP

      713    12323    4                    GOTO NXTP;             /* Uninitialized page                 */
      714    12324    5                 IF KQ$GRAN.SELF$~=PG$ THEN DO;

  12324  2 002275   000002 236100                    LDQ     2,,PR0
         2 002276   200077 116100                    CMPQ    PG$,,AUTO
         2 002277   002313 600000 2                  TZE     s:12331

      715    12325    5                    ERRCODE=45;

  12325  2 002300   000055 235007                    LDA     45,DL
         2 002301   200032 755100                    STA     ERRCODE,,AUTO

      716    12326    5                    MISC1$=PG$; MISC2$=KQ$GRAN.SELF$;

  12326  2 002302   200077 236100                    LDQ     PG$,,AUTO
         2 002303   200045 756100                    STQ     MISC1,,AUTO

  12326  2 002304   000002 236100                    LDQ     2,,PR0
         2 002305   200046 756100                    STQ     MISC2,,AUTO

      717    12327    5                    CALL ERROR;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:132  
  12327  2 002306   005436 701000 2                  TSX1    ERROR
         2 002307   000000 011000                    NOP     0

      718    12328    5                    ENTFLG=1;

  12328  2 002310   000001 235007                    LDA     1,DL
         2 002311   200101 755100                    STA     ENTFLG,,AUTO

      719    12329    5                    GOTO NXTP;

  12329  2 002312   002227 710000 2                  TRA     LOOP

      720    12330    5                    END;
      721    12331    5                 IF HASH~=KQ$GRAN.STAMP.HASH THEN DO;

  12331  2 002313   000000 236100                    LDQ     0,,PR0
         2 002314   000011 772000                    QRL     9
         2 002315   200074 116100                    CMPQ    HASH,,AUTO
         2 002316   002332 600000 2                  TZE     s:12338

      722    12332    5                    ERRCODE=41;

  12332  2 002317   000051 235007                    LDA     41,DL
         2 002320   200032 755100                    STA     ERRCODE,,AUTO

      723    12333    5                    MISC1B=KQ$GRAN.STAMP; MISC2=HASH;

  12333  2 002321   000000 236100                    LDQ     0,,PR0
         2 002322   200045 756100                    STQ     MISC1,,AUTO

  12333  2 002323   200074 235100                    LDA     HASH,,AUTO
         2 002324   200046 755100                    STA     MISC2,,AUTO

      724    12334    5                    CALL ERROR;

  12334  2 002325   005436 701000 2                  TSX1    ERROR
         2 002326   000000 011000                    NOP     0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:133  

      725    12335    5                    ENTFLG=1;              /* Don't write any more               */

  12335  2 002327   000001 235007                    LDA     1,DL
         2 002330   200101 755100                    STA     ENTFLG,,AUTO

      726    12336    5                    GOTO NXTP;

  12336  2 002331   002227 710000 2                  TRA     LOOP

      727    12337    5                    END;
      728    12338    4                 IF KQ$GRAN.PTYP=%KQ_PTYP_DATA AND NOT KQ$GRAN.CHAIN THEN

  12338  2 002332   000001 236100                    LDQ     1,,PR0
         2 002333   000007 376003                    ANQ     7,DU
         2 002334   000001 116003                    CMPQ    1,DU
         2 002335   002341 601000 2                  TNZ     s:12340
         2 002336   000001 236100                    LDQ     1,,PR0
         2 002337   000020 316003                    CANQ    16,DU
         2 002340   002227 600000 2                  TZE     LOOP

      729    12339    4                    GOTO NXTP;
      730    12340    5                 IF SIZ=0 THEN DO;

  12340  2 002341   200073 236100                    LDQ     SIZ,,AUTO
         2 002342   002352 601000 2                  TNZ     s:12346

      731    12341    5                    ERRCODE=42;

  12341  2 002343   000052 235007                    LDA     42,DL
         2 002344   200032 755100                    STA     ERRCODE,,AUTO

      732    12342    5                    CALL ERROR;

  12342  2 002345   005436 701000 2                  TSX1    ERROR
         2 002346   000000 011000                    NOP     0

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:134  
      733    12343    5                    ENTFLG=1;              /* Don't try to write any more        */

  12343  2 002347   000001 235007                    LDA     1,DL
         2 002350   200101 755100                    STA     ENTFLG,,AUTO

      734    12344    5                    GOTO NXTP;

  12344  2 002351   002227 710000 2                  TRA     LOOP

      735    12345    5                    END;
      736    12346    4                 KQ$GRAN.GTYP=%KQ_PTYP_RCVR;

  12346  2 002352   000001 236100                    LDQ     1,,PR0
         2 002353   000043 376000 3                  ANQ     35
         2 002354   100000 276007                    ORQ     32768,DL
         2 002355   000001 756100                    STQ     1,,PR0

      737    12347    4                 KQ$GRAN.STAMP.GMOD=DA;

  12347  2 002356   200003 236100                    LDQ     DA,,AUTO
         2 002357   000000 552104                    STBQ    0,'04'O,PR0

      738    12348    4                 CALL WRITE;

  12348  2 002360   004547 701000 2                  TSX1    WRITE
         2 002361   000000 011000                    NOP     0

      739    12349    4                 DA=DA+1;

  12349  2 002362   200003 235100                    LDA     DA,,AUTO
         2 002363   000001 035007                    ADLA    1,DL
         2 002364   200003 755100                    STA     DA,,AUTO

      740    12350    4                 SIZ=SIZ-1;

  12350  2 002365   200073 236100                    LDQ     SIZ,,AUTO
         2 002366   000001 136007                    SBLQ    1,DL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:135  
         2 002367   200073 756100                    STQ     SIZ,,AUTO

      741    12351    4                 PGTBL((DESC#*%CGQ_CHUNK_SIZE)+PGINDX)='1'B;

  12351  2 002370   200075 236100                    LDQ     DESC#,,AUTO
         2 002371   000012 402007                    MPY     10,DL
         2 002372   200076 036100                    ADLQ    PGINDX,,AUTO
         2 002373   003106 060400                    CSL     bolr='003'O
         2 002374   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         2 002375   200051 000001                    BDSC    PGTBL,Q,AUTO             by=0,bit=0,n=1

      742    12352    4                 END;

      743    12353    3              END;

  12353  2 002376   002227 710000 2                  TRA     LOOP

      744    12354        /**/
      745    12355    2   ENDRCVR: ;

  12355  2 002377                       ENDRCVR      null
      746    12356    3           IF SIZ~=KQ$CG.NGAVAL AND ENTFLG=0 THEN DO;

  12356  2 002377   200014 470500                    LDP0    CTX,,AUTO
         2 002400   200073 236100                    LDQ     SIZ,,AUTO
         2 002401   000217 116100                    CMPQ    143,,PR0
         2 002402   002442 600000 2                  TZE     s:12368
         2 002403   200101 235100                    LDA     ENTFLG,,AUTO
         2 002404   002442 601000 2                  TNZ     s:12368

      747    12357    3              DA=FM_FRZERO;

  12357  2 002405   000000 235000 1                  LDA     FM_FRZERO
         2 002406   200003 755100                    STA     DA,,AUTO

      748    12358    3              CALL READ ALTRET(ERR2);

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:136  
  12358  2 002407   004706 701000 2                  TSX1    READ
         2 002410   002454 702000 2                  TSX2    ERR2

      749    12359    3              KQ$CTLGRAN.RCVRDA=KQ$CG.UGRANS+FM_FRZERO;

  12359  2 002411   200014 470500                    LDP0    CTX,,AUTO
         2 002412   000220 236100                    LDQ     144,,PR0
         2 002413   000000 036000 1                  ADLQ    FM_FRZERO
         2 002414   000006 471400 1                  LDP1    POBUF$
         2 002415   100006 756100                    STQ     6,,PR1

      750    12360    3              KQ$CTLGRAN.RCVRSIZ=KQ$CG.NGAVAL-SIZ;

  12360  2 002416   200014 470500                    LDP0    CTX,,AUTO
         2 002417   000217 236100                    LDQ     143,,PR0
         2 002420   200073 136100                    SBLQ    SIZ,,AUTO
         2 002421   100007 756100                    STQ     7,,PR1

      751    12361    3              KQ$CTLGRAN.RCVRTIME=RV_BUFF.UTS1;

  12361  2 002422   000004 235000 xsym               LDA     RV_BUFF+4
         2 002423   100010 755100                    STA     8,,PR1

      752    12362    3              KQ$CTLGRAN.PGTBL=PGTBL;

  12362  2 002424   000100 100500                    MLR     fill='000'O
         2 002425   200051 000035                    ADSC9   PGTBL,,AUTO              cn=0,n=29
         2 002426   100012 000035                    ADSC9   10,,PR1                  cn=0,n=29

      753    12363    3              DSB$=PINCRW(POBUF$,KQ$CTLGRAN.CTXX);

  12363  2 002427   100004 720100                    LXL0    4,,PR1
         2 002430   000000 636010                    EAQ     0,X0
         2 002431   000006 036000 1                  ADLQ    POBUF$
         2 002432   200013 756100                    STQ     DSB$,,AUTO

      754    12364    3              DSB$->KQ$CG=KQ$CG;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:137  

  12364  2 002433   200014 470500                    LDP0    CTX,,AUTO
         2 002434   200013 473500                    LDP3    DSB$,,AUTO
         2 002435   000100 100500                    MLR     fill='000'O
         2 002436   000000 001324                    ADSC9   0,,PR0                   cn=0,n=724
         2 002437   300000 001324                    ADSC9   0,,PR3                   cn=0,n=724

      755    12365    3              CALL WRITE;

  12365  2 002440   004547 701000 2                  TSX1    WRITE
         2 002441   000000 011000                    NOP     0

      756    12366    3              END;

      757    12367        /**/
      758    12368    2           RETURN;

  12368  2 002442   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 002443   000001 702211                    TSX2  ! 1,X1

      759    12369        /**/
      760    12370        /**/
      761    12371    2   DUMPCG: ENTRY ALTRET;

  12371  2 002444   200072 741300       DUMPCG       STX1  ! MIR_DCTX+1,,AUTO

      762    12372        /**/
      763    12373    2           DESC#=0;

  12373  2 002445   200075 450100                    STZ     DESC#,,AUTO

      764    12374    2           PGINDX=0;

  12374  2 002446   200076 450100                    STZ     PGINDX,,AUTO

      765    12375    2           ENTFLG=1;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:138  
  12375  2 002447   000001 235007                    LDA     1,DL
         2 002450   200101 755100                    STA     ENTFLG,,AUTO

      766    12376    2           GOTO BEGINDUMP;

  12376  2 002451   002171 710000 2                  TRA     BEGINDUMP

  12375  2 002452                       ERR          null
      767    12377        /**/
      768    12378    2   ERR:    ;
      769    12379    2           CALL ERROR;

  12379  2 002452   005436 701000 2                  TSX1    ERROR
         2 002453   000000 011000                    NOP     0

  12375  2 002454                       ERR2         null
      770    12380    2   ERR2:   ;
      771    12381    2           ALTRETURN;

  12381  2 002454   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 002455   000000 702211                    TSX2  ! 0,X1

      772    12382        /**/
      773    12383    2   DUMPERR: RV_BUFF.CURCG.ERR='1'B;

  12383  2 002456   200000 236003       DUMPERR      LDQ     65536,DU
         2 002457   000471 256000 xsym               ORSQ    RV_BUFF+313

      774    12384    2           DUMPFLG=0;

  12384  2 002460   200040 450100                    STZ     DUMPFLG,,AUTO

      775    12385    2           ENTFLG=1;             /* Don't write any more to file recovery area   */

  12385  2 002461   000001 235007                    LDA     1,DL
         2 002462   200101 755100                    STA     ENTFLG,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:139  
      776    12386    2           GOTO ENDDUMP;

  12386  2 002463   002267 710000 2                  TRA     ENDDUMP

      777    12387        /**/
      778    12388                %LIST;
      779    12389                %KQ_FCGP (MON=NO);
             12390        /**/
             12391    2   FINDCGPAGE: PROC (KQ$DSB,ASNUM,PGNUM,PTR$,PPNO) ALTRET;

  12391  2 002464   200102 741300       FINDCGPAGE   STX1  ! ENTFLG+1,,AUTO

             12392        /**/
             12393        %KQ_DSB (FPTN=KQ$DSB,STCLASS="");
             12394         %LSET LISTDIR='0'B;
             12406    3   DCL 1 KQ$DSB DALIGNED,
             12408    3         2 ASR,
             12412    3           3 BOUND UBIN(20) UNAL /*(0)/**/,
             12413    3           3 FLG BIT(9) UNAL /*('110100011'B)/**/,
             12414    3           3 W UBIN(3) UNAL /*(3)/**/,
             12415    3           3 T UBIN(4) UNAL /*(1)/**/,
             12416    3           3 BASE UBIN(36) UNAL /*(0)/**/,
             12417    3         2 CRYPT REDEF ASR,
             12420    3           3 LNK$ PTR,
             12423    3           3 * UBIN,
             12424    3         2 DESC (0:25),
             12427    3           3 BOUND UBIN(20) UNAL /*(40959*0)/**/,
             12428    3           3 FLG BIT(9) UNAL /*('110000010'B*0)/**/,
             12429    3           3 FLGR REDEF FLG,
             12430    3             4 * BIT(8) UNAL,
             12431    3             4 PRESENT BIT(1) UNAL,
             12432    3           3 W UBIN(3) UNAL /*(3*0)/**/,
             12433    3           3 T UBIN(4) UNAL /*(0*0)/**/,
             12434    3           3 BASE UBIN(36) UNAL /*(0*0)/**/;
             12436    3   DCL ASNUM UBIN;
             12437    3   DCL PGNUM UBIN;
             12438    3   DCL PTR$ PTR ALIGNED;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:140  
             12439    3   DCL 1 PTR$R REDEF PTR$ ALIGNED,
             12440    3         2 PG# UBIN(8) UNAL,
             12441    3         2 GORGO UBIN(16) UNAL,
             12442    3         2 SEGID UBIN(12) UNAL;
             12443    3   DCL PPNO UBIN;
             12444        %IF MON;
             12487        %ELSE;
             12488    3   DCL S1000_FLG BIT(1) ALIGNED SYMREF;
             12489        %ENDIF;
             12490    3   DCL B$HALF(0:0) UBIN HALF BASED HALIGNED;
             12491    3   DCL B$IPHYMAP$ PTR SYMREF;
             12492        /**/
             12493    3   DCL K UBIN;

  12493  2 002465                       LOOP         null
             12494        /**/
             12495    3   LOOP:;
             12496    3       IF PGNUM >= %CGQ_CHUNK_SIZE THEN

  12496  2 002465   200105 470500                    LDP0    @PGNUM,,AUTO
         2 002466   000000 235100                    LDA     0,,PR0
         2 002467   000012 115007                    CMPA    10,DL
         2 002470   002477 602000 2                  TNC     s:12502

             12497    4         DO;

             12498    4   LOOP1:
             12499    4         ASNUM=ASNUM+1;

  12499  2 002471   200104 470500       LOOP1        LDP0    @ASNUM,,AUTO
         2 002472   000000 235100                    LDA     0,,PR0
         2 002473   000001 035007                    ADLA    1,DL
         2 002474   000000 755100                    STA     0,,PR0

             12500    4         PGNUM=0;

  12500  2 002475   200105 471500                    LDP1    @PGNUM,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:141  
         2 002476   100000 450100                    STZ     0,,PR1

             12501    4         END;

             12502    3       IF ASNUM > KQM_MDPC# THEN ALTRETURN;

  12502  2 002477   200104 470500                    LDP0    @ASNUM,,AUTO
         2 002500   000000 235100                    LDA     0,,PR0
         2 002501   000032 115007                    CMPA    26,DL
         2 002502   002505 602000 2                  TNC     s:12503

  12502  2 002503   200102 221300                    LDX1  ! ENTFLG+1,,AUTO
         2 002504   000000 702211                    TSX2  ! 0,X1

             12503    3       IF NOT KQ$DSB.DESC.FLGR.PRESENT(ASNUM) THEN GOTO LOOP1;

  12503  2 002505   000000 720100                    LXL0    0,,PR0
         2 002506   000000 636010                    EAQ     0,X0
         2 002507   000021 772000                    QRL     17
         2 002510   200103 471500                    LDP1    @KQ$DSB,,AUTO
         2 002511   100002 236106                    LDQ     2,QL,PR1
         2 002512   000200 316007                    CANQ    128,DL
         2 002513   002471 600000 2                  TZE     LOOP1

             12504    3       K=KQ$DSB.DESC.BASE(ASNUM)/4096;

  12504  2 002514   000000 636010                    EAQ     0,X0
         2 002515   000021 772000                    QRL     17
         2 002516   100003 236106                    LDQ     3,QL,PR1
         2 002517   000014 772000                    QRL     12
         2 002520   200110 756100                    STQ     K,,AUTO

             12505    3       PPNO=B$CGPT$->B$MAP.RPN(K+PGNUM);

  12505  2 002521   200105 473500                    LDP3    @PGNUM,,AUTO
         2 002522   300000 036100                    ADLQ    0,,PR3
         2 002523   000000 474400 xsym               LDP4    R$CGPT$
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:142  
         2 002524   400000 236106                    LDQ     0,QL,PR4
         2 002525   000022 772000                    QRL     18
         2 002526   200107 475500                    LDP5    @PPNO,,AUTO
         2 002527   500000 756100                    STQ     0,,PR5

             12506    3       IF B$CGPT$->B$MAP.CTRL(K+PGNUM) & '40'O /* CPU PRESENT */ THEN

  12506  2 002530   200110 236100                    LDQ     K,,AUTO
         2 002531   300000 036100                    ADLQ    0,,PR3
         2 002532   000000 474400 xsym               LDP4    R$CGPT$
         2 002533   400000 236106                    LDQ     0,QL,PR4
         2 002534   000036 736000                    QLS     30
         2 002535   400000 376003                    ANQ     -131072,DU
         2 002536   002567 600000 2                  TZE     s:12520

             12507    4         DO;

             12508        %IF MON;
             12510              %ELSE;
             12511    4         IF S1000_FLG THEN

  12511  2 002537   000000 234000 xsym               SZN     S1000_FLG
         2 002540   002547 605000 2                  TPL     s:12514

             12512              %ENDIF;
             12513    4         PPNO=B$IPHYMAP$->B$HALF(PPNO);

  12513  2 002541   500000 235100                    LDA     0,,PR5
         2 002542   000001 735000                    ALS     1
         2 002543   000000 476400 xsym               LDP6    B$IPHYMAP$
         2 002544   000100 101505                    MRL     fill='000'O
         2 002545   600000 000002                    ADSC9   0,A,PR6                  cn=0,n=2
         2 002546   500000 000004                    ADSC9   0,,PR5                   cn=0,n=4

             12514    4         PTR$R.PG#=PGNUM;

  12514  2 002547   200106 474500                    LDP4    @PTR$,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:143  
         2 002550   300000 236100                    LDQ     0,,PR3
         2 002551   000034 736000                    QLS     28
         2 002552   400000 676100                    ERQ     0,,PR4
         2 002553   776000 376003                    ANQ     -1024,DU
         2 002554   400000 656100                    ERSQ    0,,PR4

             12515    4         PTR$R.SEGID=BITBIN(%AS0SID)+ASNUM;

  12515  2 002555   000000 236100                    LDQ     0,,PR0
         2 002556   004000 036007                    ADLQ    2048,DL
         2 002557   400000 752103                    STCQ    0,'03'O,PR4

             12516    4         PTR$R.GORGO=0;

  12516  2 002560   000044 236000 3                  LDQ     36
         2 002561   400000 356100                    ANSQ    0,,PR4

             12517    4         PGNUM=PGNUM+1;

  12517  2 002562   300000 235100                    LDA     0,,PR3
         2 002563   000001 035007                    ADLA    1,DL
         2 002564   300000 755100                    STA     0,,PR3

             12518    4         RETURN;

  12518  2 002565   200102 221300                    LDX1  ! ENTFLG+1,,AUTO
         2 002566   000001 702211                    TSX2  ! 1,X1

             12519    4         END;
             12520    3       PGNUM=PGNUM+1;

  12520  2 002567   300000 235100                    LDA     0,,PR3
         2 002570   000001 035007                    ADLA    1,DL
         2 002571   300000 755100                    STA     0,,PR3

             12521    3       GOTO LOOP;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:144  
  12521  2 002572   002465 710000 2                  TRA     LOOP

             12522    3   END FINDCGPAGE;
      780    12524                %PLIST;
      781    12525        /**/
      782    12526    2   END CGCLS;
      783    12527        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:145  
      784    12528    1   GETFIT: PROC ALTRET;

  12528  2 002573   200072 741300       GETFIT       STX1  ! MIR_DCTX+1,,AUTO

      785    12529        /* LOCAL AUTOMATIC STORAGE */
      786    12530    2   DCL GMOD UBIN(9);
      787    12531    2   DCL I UBIN;
      788    12532    2   DCL 1 P2,
      789    12533    2         2 X,
      790    12534    2           3 A SBIN,
      791    12535    2           3 AB REDEF A BIT(36),
      792    12536    2           3 B SBIN,
      793    12537    2           3 BB REDEF B BIT(36),
      794    12538    2         2 B(0:71) REDEF X BIT(1),
      795    12539    2         2 Y,
      796    12540    2           3 A SBIN,
      797    12541    2           3 B SBIN,
      798    12542    2         2 Z,
      799    12543    2           3 A UBIN,
      800    12544    2           3 B UBIN,
      801    12545    2         2 I SBIN,
      802    12546    2         2 IB REDEF I BIT(36),
      803    12547    2         2 J SBIN,
      804    12548    2         2 JB REDEF J BIT(36);
      805    12549    2   DCL CNAME REDEF P2 CHAR(32);
      806    12550    2   DCL PNAME BASED CHAR(P2.I);
      807    12551    2   DCL RSLT BIT(36);
      808    12552    2   DCL ENTFLG UBIN;
      809    12553        /**/
      810    12554    2           ENTFLG=0;

  12554  2 002574   200106 450100                    STZ     ENTFLG,,AUTO

      811    12555    2           GOTO COMM;

  12555  2 002575   002601 710000 2                  TRA     COMM

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:146  
      812    12556        /**/
      813    12557    2   CHKFIT: ENTRY ALTRET;

  12557  2 002576   200072 741300       CHKFIT       STX1  ! MIR_DCTX+1,,AUTO

      814    12558    2           ENTFLG=1;

  12558  2 002577   000001 235007                    LDA     1,DL
         2 002600   200106 755100                    STA     ENTFLG,,AUTO

  12558  2 002601                       COMM         null
      815    12559        /**/
      816    12560    2   COMM:   ;
      817    12561    2           DA=FM$CFU.FITSDA;

  12561  2 002601   200012 470500                    LDP0    CFU$,,AUTO
         2 002602   000000 236100                    LDQ     0,,PR0
         2 002603   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002604   200003 756100                    STQ     DA,,AUTO

      818    12562    2           IF DA<FM_SRZERO THEN

  12562  2 002605   000002 116000 1                  CMPQ    FM_SRZERO
         2 002606   002770 602000 2                  TNC     ERR1

      819    12563    2              GOTO ERR1;
      820    12564    2           IF ENTFLG=0 THEN

  12564  2 002607   200106 235100                    LDA     ENTFLG,,AUTO
         2 002610   002613 601000 2                  TNZ     s:12566

      821    12565    2              CALL READ ALTRET(ERR);

  12565  2 002611   004706 701000 2                  TSX1    READ
         2 002612   003044 702000 2                  TSX2    ERR

      822    12566    2           GMOD=0;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:147  

  12566  2 002613   200073 450100                    STZ     GMOD,,AUTO

      823    12567    3           IF FM$CFU.AFIT=1 THEN DO;

  12567  2 002614   200012 470500                    LDP0    CFU$,,AUTO
         2 002615   000000 236100                    LDQ     0,,PR0
         2 002616   001000 376003                    ANQ     512,DU
         2 002617   001000 116003                    CMPQ    512,DU
         2 002620   002632 601000 2                  TNZ     s:12573

      824    12568    3              GMOD=DA;

  12568  2 002621   200003 235100                    LDA     DA,,AUTO
         2 002622   000033 735000                    ALS     27
         2 002623   200073 755100                    STA     GMOD,,AUTO

      825    12569    3              IF FM$GRAN.LVL~=6 THEN

  12569  2 002624   000006 471400 1                  LDP1    POBUF$
         2 002625   100001 236100                    LDQ     1,,PR1
         2 002626   340000 376007                    ANQ     114688,DL
         2 002627   300000 116007                    CMPQ    98304,DL
         2 002630   002775 601000 2                  TNZ     ERR4

      826    12570    3                 GOTO ERR4;
      827    12571    3              END;

  12571  2 002631   002636 710000 2                  TRA     s:12575

      828    12572    2           ELSE
      829    12573    2              IF FM$GRAN.LVL~=0 THEN

  12573  2 002632   000006 471400 1                  LDP1    POBUF$
         2 002633   100001 236100                    LDQ     1,,PR1
         2 002634   340000 316007                    CANQ    114688,DL
         2 002635   002775 601000 2                  TNZ     ERR4
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:148  

      830    12574    2                 GOTO ERR4;
      831    12575    2           IF GMOD~=FM$GRAN.STAMP.GMOD THEN

  12575  2 002636   100000 236100                    LDQ     0,,PR1
         2 002637   000777 376007                    ANQ     511,DL
         2 002640   200144 756100                    STQ     J+1,,AUTO
         2 002641   200073 236100                    LDQ     GMOD,,AUTO
         2 002642   000033 772000                    QRL     27
         2 002643   200144 116100                    CMPQ    J+1,,AUTO
         2 002644   003004 601000 2                  TNZ     ERR5

      832    12576    2              GOTO ERR5;
      833    12577    2           FIT$=PINCRW(ADDR(POBUF),SIZEW(FM$GRAN));

  12577  2 002645   000045 236000 3                  LDQ     37
         2 002646   200041 756100                    STQ     FIT$,,AUTO

      834    12578    2           IF FM$FIT.CODES.CODE(1)~=1 THEN

  12578  2 002647   200041 473500                    LDP3    FIT$,,AUTO
         2 002650   300001 236100                    LDQ     1,,PR3
         2 002651   760000 376003                    ANQ     -8192,DU
         2 002652   020000 116003                    CMPQ    8192,DU
         2 002653   003021 601000 2                  TNZ     ERR13

      835    12579    2              GOTO ERR13;
      836    12580    2           I=MOD(FM$FIT.CODES.NDW(1)-1,512);

  12580  2 002654   300001 236100                    LDQ     1,,PR3
         2 002655   000012 772000                    QRL     10
         2 002656   001777 376007                    ANQ     1023,DL
         2 002657   000001 136007                    SBLQ    1,DL
         2 002660   001000 506007                    DIV     512,DL
         2 002661   200074 755100                    STA     I,,AUTO

      837    12581    2           COD$=PINCRW(FIT$,FM$FIT.CODES.ITEMX(1));
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:149  

  12581  2 002662   300001 720100                    LXL0    1,,PR3
         2 002663   001777 360003                    ANX0    1023,DU
         2 002664   000000 636010                    EAQ     0,X0
         2 002665   200041 036100                    ADLQ    FIT$,,AUTO
         2 002666   200043 756100                    STQ     COD$,,AUTO

      838    12582    2           IF CODE01.NXTNTS~=I THEN

  12582  2 002667   200043 474500                    LDP4    COD$,,AUTO
         2 002670   400000 236100                    LDQ     0,,PR4
         2 002671   000033 772000                    QRL     27
         2 002672   200074 116100                    CMPQ    I,,AUTO
         2 002673   003030 601000 2                  TNZ     ERR14

      839    12583    2              GOTO ERR14;
      840    12584    2           IF FM$GRAN.STAMP.HASH~=CODE01.HASH THEN

  12584  2 002674   400000 236100                    LDQ     0,,PR4
         2 002675   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002676   200144 756100                    STQ     J+1,,AUTO
         2 002677   100000 236100                    LDQ     0,,PR1
         2 002700   000011 772000                    QRL     9
         2 002701   200144 116100                    CMPQ    J+1,,AUTO
         2 002702   003033 601000 2                  TNZ     ERR15

      841    12585    2              GOTO ERR15;
      842    12586    2           P2.I=FM$CFUN.L+1;

  12586  2 002703   200023 475500                    LDP5    NAME$,,AUTO
         2 002704   000100 101500                    MRL     fill='000'O
         2 002705   500000 400001                    ADSC9   0,,PR5                   cn=2,n=1
         2 002706   200144 000004                    ADSC9   J+1,,AUTO                cn=0,n=4
         2 002707   200144 236100                    LDQ     J+1,,AUTO
         2 002710   000001 036007                    ADLQ    1,DL
         2 002711   200103 756100                    STQ     @KQ$DSB,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:150  
      843    12587    2           CNAME=ADDR(FM$CFUN.L)->PNAME;

  12587  2 002712   000000 620006                    EAX0    0,QL
         2 002713   040100 100540                    MLR     fill='040'O
         2 002714   500000 400010                    ADSC9   0,,PR5                   cn=2,n=*X0
         2 002715   200075 000040                    ADSC9   P2,,AUTO                 cn=0,n=32

      844    12588    2           P2.J=P2.J+P2.I*3+P2.Z.B*5+P2.Z.A*7+P2.Y.B*11+P2.Y.A*13+P2.X.B*17;

  12588  2 002716   200103 236100                    LDQ     @KQ$DSB,,AUTO
         2 002717   000003 402007                    MPY     3,DL
         2 002720   200104 036100                    ADLQ    @ASNUM,,AUTO
         2 002721   200144 756100                    STQ     J+1,,AUTO
         2 002722   200102 236100                    LDQ     ENTFLG+1,,AUTO
         2 002723   000005 402007                    MPY     5,DL
         2 002724   200144 036100                    ADLQ    J+1,,AUTO
         2 002725   200145 756100                    STQ     J+2,,AUTO
         2 002726   200101 236100                    LDQ     ENTFLG,,AUTO
         2 002727   000007 402007                    MPY     7,DL
         2 002730   200145 036100                    ADLQ    J+2,,AUTO
         2 002731   200146 756100                    STQ     J+3,,AUTO
         2 002732   200100 236100                    LDQ     RP,,AUTO
         2 002733   000013 402007                    MPY     11,DL
         2 002734   200146 036100                    ADLQ    J+3,,AUTO
         2 002735   200147 756100                    STQ     J+4,,AUTO
         2 002736   200077 236100                    LDQ     PG$,,AUTO
         2 002737   000015 402007                    MPY     13,DL
         2 002740   200147 036100                    ADLQ    J+4,,AUTO
         2 002741   200150 756100                    STQ     J+5,,AUTO
         2 002742   200076 236100                    LDQ     PGINDX,,AUTO
         2 002743   000021 402007                    MPY     17,DL
         2 002744   200150 036100                    ADLQ    J+5,,AUTO
         2 002745   200104 756100                    STQ     @ASNUM,,AUTO

      845    12589    2           RSLT=(P2.X.AB|P2.JB)&~(P2.X.AB&P2.JB);

  12589  2 002746   200075 236100                    LDQ     P2,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:151  
         2 002747   200104 276100                    ORQ     @ASNUM,,AUTO
         2 002750   200144 756100                    STQ     J+1,,AUTO
         2 002751   200075 236100                    LDQ     P2,,AUTO
         2 002752   200104 376100                    ANQ     @ASNUM,,AUTO
         2 002753   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 002754   200144 376100                    ANQ     J+1,,AUTO
         2 002755   200105 756100                    STQ     RSLT,,AUTO

      846    12590    2           CALL LOCCOD(3) ALTRET(ERR20);

  12590  2 002756   000046 236000 3                  LDQ     38
         2 002757   200111 756100                    STQ     K+1,,AUTO
         2 002760   005400 701000 2                  TSX1    LOCCOD
         2 002761   003041 702000 2                  TSX2    ERR20

      847    12591    2           IF CODE03.NSTAMP~=BITBIN(RSLT) THEN

  12591  2 002762   200043 470500                    LDP0    COD$,,AUTO
         2 002763   000006 236100                    LDQ     6,,PR0
         2 002764   200105 116100                    CMPQ    RSLT,,AUTO
         2 002765   003036 601000 2                  TNZ     ERR19

      848    12592    2              GOTO ERR19;
      849    12593    2           RETURN;

  12593  2 002766   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 002767   000001 702211                    TSX2  ! 1,X1

      850    12594        /**/
      851    12595    2   ERR1:   ERRCODE=1; MISC1=DA; MISC2=0; GOTO ERR;

  12595  2 002770   000001 235007       ERR1         LDA     1,DL
         2 002771   200032 755100                    STA     ERRCODE,,AUTO

  12595  2 002772   200045 756100                    STQ     MISC1,,AUTO

  12595  2 002773   200046 450100                    STZ     MISC2,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:152  

  12595  2 002774   003044 710000 2                  TRA     ERR

      852    12596    2   ERR4:   ERRCODE=4; MISC1=POBUF$->PG(0); MISC2=POBUF$->PG(1); GOTO ERR;

  12596  2 002775   000004 235007       ERR4         LDA     4,DL
         2 002776   200032 755100                    STA     ERRCODE,,AUTO

  12596  2 002777   100000 235100                    LDA     0,,PR1
         2 003000   200045 755100                    STA     MISC1,,AUTO

  12596  2 003001   100001 235100                    LDA     1,,PR1
         2 003002   200046 755100                    STA     MISC2,,AUTO

  12596  2 003003   003044 710000 2                  TRA     ERR

      853    12597    2   ERR5:   ERRCODE=5; MISC1=DA; MISC2=GMOD*512+FM$GRAN.STAMP.GMOD; GOTO ERR;

  12597  2 003004   000005 235007       ERR5         LDA     5,DL
         2 003005   200032 755100                    STA     ERRCODE,,AUTO

  12597  2 003006   200003 235100                    LDA     DA,,AUTO
         2 003007   200045 755100                    STA     MISC1,,AUTO

  12597  2 003010   100000 236100                    LDQ     0,,PR1
         2 003011   000777 376007                    ANQ     511,DL
         2 003012   200144 756100                    STQ     J+1,,AUTO
         2 003013   200073 236100                    LDQ     GMOD,,AUTO
         2 003014   000022 772000                    QRL     18
         2 003015   777000 376007                    ANQ     -512,DL
         2 003016   200144 036100                    ADLQ    J+1,,AUTO
         2 003017   200046 756100                    STQ     MISC2,,AUTO

  12597  2 003020   003044 710000 2                  TRA     ERR

      854    12598    2   ERR13:  ERRCODE=13; MISC1=FIT$->PG(0); MISC2=FIT$->PG(1); GOTO ERR;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:153  
  12598  2 003021   000015 235007       ERR13        LDA     13,DL
         2 003022   200032 755100                    STA     ERRCODE,,AUTO

  12598  2 003023   300000 235100                    LDA     0,,PR3
         2 003024   200045 755100                    STA     MISC1,,AUTO

  12598  2 003025   300001 235100                    LDA     1,,PR3
         2 003026   200046 755100                    STA     MISC2,,AUTO

  12598  2 003027   003044 710000 2                  TRA     ERR

      855    12599    2   ERR14:  ERRCODE=14; GOTO ERR;

  12599  2 003030   000016 235007       ERR14        LDA     14,DL
         2 003031   200032 755100                    STA     ERRCODE,,AUTO

  12599  2 003032   003044 710000 2                  TRA     ERR

      856    12600    2   ERR15:  ERRCODE=15; GOTO ERR;

  12600  2 003033   000017 235007       ERR15        LDA     15,DL
         2 003034   200032 755100                    STA     ERRCODE,,AUTO

  12600  2 003035   003044 710000 2                  TRA     ERR

      857    12601    2   ERR19:  ERRCODE=19; GOTO ERR;

  12601  2 003036   000023 235007       ERR19        LDA     19,DL
         2 003037   200032 755100                    STA     ERRCODE,,AUTO

  12601  2 003040   003044 710000 2                  TRA     ERR

      858    12602    2   ERR20:  ERRCODE=20; GOTO ERR;

  12602  2 003041   000024 235007       ERR20        LDA     20,DL
         2 003042   200032 755100                    STA     ERRCODE,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:154  
  12602  2 003043   003044 710000 2                  TRA     ERR

      859    12603        /**/
      860    12604    2   ERR:    CALL ERROR;

  12604  2 003044   005436 701000 2     ERR          TSX1    ERROR
         2 003045   000000 011000                    NOP     0

      861    12605    2           ALTRETURN;

  12605  2 003046   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 003047   000000 702211                    TSX2  ! 0,X1

      862    12606    2   END GETFIT;
      863    12607        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:155  
      864    12608    1   UPFIT:  PROC ALTRET;

  12608  2 003050   200072 741300       UPFIT        STX1  ! MIR_DCTX+1,,AUTO

      865    12609        /**/
      866    12610        /* LOCAL AUTOMATIC STORAGE */
      867    12611    2   DCL T$ PTR;
      868    12612    2   DCL I SBIN;
      869    12613        /**/
      870    12614    2           CALL LOCCOD(3) ALTRET(ERR);

  12614  2 003051   000046 236000 3                  LDQ     38
         2 003052   200111 756100                    STQ     K+1,,AUTO
         2 003053   005400 701000 2                  TSX1    LOCCOD
         2 003054   003466 702000 2                  TSX2    ERR

      871    12615    2           CODE03.UGRANS=FM$CFU.UGRANS;

  12615  2 003055   200012 470500                    LDP0    CFU$,,AUTO
         2 003056   200043 471500                    LDP1    COD$,,AUTO
         2 003057   000004 236100                    LDQ     4,,PR0
         2 003060   100000 552134                    STBQ    0,'34'O,PR1

      872    12616    2           CODE03.NGAVAL=FM$CFU.NGAVAL;

  12616  2 003061   200012 470500                    LDP0    CFU$,,AUTO
         2 003062   200043 471500                    LDP1    COD$,,AUTO
         2 003063   000007 236100                    LDQ     7,,PR0
         2 003064   100003 552134                    STBQ    3,'34'O,PR1

      873    12617    3           IF FM$CFU.FMOD THEN DO;

  12617  2 003065   200012 470500                    LDP0    CFU$,,AUTO
         2 003066   000000 236100                    LDQ     0,,PR0
         2 003067   004000 316003                    CANQ    2048,DU
         2 003070   003430 600000 2                  TZE     CHK4

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:156  
      874    12618    3              CODE03.LDA=FM$CFU.LDA;

  12618  2 003071   200043 471500                    LDP1    COD$,,AUTO
         2 003072   000006 235100                    LDA     6,,PR0
         2 003073   000007 236100                    LDQ     7,,PR0
         2 003074   000033 773000                    LRL     27
         2 003075   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003076   100004 552134                    STBQ    4,'34'O,PR1

      875    12619    3              IF FM$GRAN.ORG=%RANDOM# OR FM$GRAN.ORG=%IDS# OR

  12619  2 003077   000006 470400 1                  LDP0    POBUF$
         2 003100   000001 236100                    LDQ     1,,PR0
         2 003101   036000 376007                    ANQ     15360,DL
         2 003102   006000 116007                    CMPQ    3072,DL
         2 003103   003110 600000 2                  TZE     s:12621
         2 003104   016000 116007                    CMPQ    7168,DL
         2 003105   003110 600000 2                  TZE     s:12621
         2 003106   026000 116007                    CMPQ    11264,DL
         2 003107   003116 601000 2                  TNZ     s:12623

      876    12620    3                FM$GRAN.ORG=%CG# THEN
      877    12621    3                 CODE03.NRECS=FM$CFU.UGRANS;

  12621  2 003110   200012 471500                    LDP1    CFU$,,AUTO
         2 003111   100004 236100                    LDQ     4,,PR1
         2 003112   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003113   200043 473500                    LDP3    COD$,,AUTO
         2 003114   300002 756100                    STQ     2,,PR3
         2 003115   003122 710000 2                  TRA     s:12624

      878    12622    3              ELSE
      879    12623    3                 CODE03.NRECS=FM$CFU.NRECS;

  12623  2 003116   200012 471500                    LDP1    CFU$,,AUTO
         2 003117   200043 473500                    LDP3    COD$,,AUTO
         2 003120   100001 235100                    LDA     1,,PR1
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:157  
         2 003121   300002 755100                    STA     2,,PR3

      880    12624    3              IF CODE03.RCSZ<FM$CFU.RCSZ THEN

  12624  2 003122   200012 471500                    LDP1    CFU$,,AUTO
         2 003123   100004 236100                    LDQ     4,,PR1
         2 003124   000033 772000                    QRL     27
         2 003125   200144 756100                    STQ     J+1,,AUTO
         2 003126   200043 473500                    LDP3    COD$,,AUTO
         2 003127   300003 236100                    LDQ     3,,PR3
         2 003130   000033 772000                    QRL     27
         2 003131   200144 116100                    CMPQ    J+1,,AUTO
         2 003132   003135 605000 2                  TPL     s:12626

      881    12625    3                 CODE03.RCSZ=FM$CFU.RCSZ;

  12625  2 003133   100004 236100                    LDQ     4,,PR1
         2 003134   300003 552140                    STBQ    3,'40'O,PR3

      882    12626    3              IF DCB$ ~= ADDR(NIL) THEN

  12626  2 003135   200010 236100                    LDQ     DCB$,,AUTO
         2 003136   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003137   003354 600000 2                  TZE     CHK2

      883    12627    3                 IF F$DCB.ALTKEYX > 0 THEN

  12627  2 003140   200010 471500                    LDP1    DCB$,,AUTO
         2 003141   100052 720100                    LXL0    42,,PR1
         2 003142   003354 600000 2                  TZE     CHK2

      884    12628    4                 DO;                       /* UPDATE ALTKEY INFO                 */

      885    12629    4                    ALTKEY$=PINCRW(B$ROSEG$, F$DCB.ALTKEYX);

  12629  2 003143   000000 636010                    EAQ     0,X0
         2 003144   000000 036000 xsym               ADLQ    R$ROSEG$
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:158  
         2 003145   200042 756100                    STQ     ALTKEY$,,AUTO

      886    12630    4                    IF F$DCB.ORG = %INDEXED# THEN

  12630  2 003146   100032 236100                    LDQ     26,,PR1
         2 003147   777000 376003                    ANQ     -512,DU
         2 003150   006000 116003                    CMPQ    3072,DU
         2 003151   003252 601000 2                  TNZ     s:12646

      887    12631    5                    DO;                    /* INDEXED                            */

      888    12632    5                       CODE03.LDA=ALTKEYS.K.LDA(0);

  12632  2 003152   200042 473500                    LDP3    ALTKEY$,,AUTO
         2 003153   200043 474500                    LDP4    COD$,,AUTO
         2 003154   300002 236100                    LDQ     2,,PR3
         2 003155   000011 772000                    QRL     9
         2 003156   400004 552134                    STBQ    4,'34'O,PR4

      889    12633    5                       F$DCB.TDA=ALTKEYS.K.TDA(0);

  12633  2 003157   200010 471500                    LDP1    DCB$,,AUTO
         2 003160   300002 235100                    LDA     2,,PR3
         2 003161   300003 236100                    LDQ     3,,PR3
         2 003162   000022 773000                    LRL     18
         2 003163   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003164   100070 552134                    STBQ    56,'34'O,PR1

      890    12634    5                       F$DCB.TDALVL=ALTKEYS.K.TDALVL(0);

  12634  2 003165   300004 236100                    LDQ     4,,PR3
         2 003166   000006 736000                    QLS     6
         2 003167   100067 676100                    ERQ     55,,PR1
         2 003170   700000 376003                    ANQ     -32768,DU
         2 003171   100067 656100                    ERSQ    55,,PR1

      891    12635    5                       CALL LOCCOD(8) ALTRET(CHK2);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:159  

  12635  2 003172   000047 236000 3                  LDQ     39
         2 003173   200111 756100                    STQ     K+1,,AUTO
         2 003174   005400 701000 2                  TSX1    LOCCOD
         2 003175   003354 702000 2                  TSX2    CHK2

      892    12636    5                       COD$->ALTKEYS.ALTBLD=FM$CFU.ALTBLD;

  12636  2 003176   200043 470500                    LDP0    COD$,,AUTO
         2 003177   200012 471500                    LDP1    CFU$,,AUTO
         2 003200   100006 236100                    LDQ     6,,PR1
         2 003201   000006 736000                    QLS     6
         2 003202   000000 676100                    ERQ     0,,PR0
         2 003203   000400 376003                    ANQ     256,DU
         2 003204   000000 656100                    ERSQ    0,,PR0

      893    12637    6                       DO I=0 TO ALTKEYS.NUMENTS-1;

  12637  2 003205   200074 450100                    STZ     I,,AUTO
         2 003206   003243 710000 2                  TRA     s:12642+1

      894    12638    6                          COD$->ALTKEYS.K.FDA(I)=ALTKEYS.K.FDA(I);

  12638  2 003207   200074 236100                    LDQ     I,,AUTO
         2 003210   000006 402007                    MPY     6,DL
         2 003211   200042 470500                    LDP0    ALTKEY$,,AUTO
         2 003212   200043 471500                    LDP1    COD$,,AUTO
         2 003213   000000 620006                    EAX0    0,QL
         2 003214   000001 236106                    LDQ     1,QL,PR0
         2 003215   100001 676110                    ERQ     1,X0,PR1
         2 003216   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003217   100001 656110                    ERSQ    1,X0,PR1

      895    12639    6                          COD$->ALTKEYS.K.LDA(I)=ALTKEYS.K.LDA(I);

  12639  2 003220   200043 471500                    LDP1    COD$,,AUTO
         2 003221   000002 236110                    LDQ     2,X0,PR0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:160  
         2 003222   100002 676110                    ERQ     2,X0,PR1
         2 003223   000050 376000 3                  ANQ     40
         2 003224   100002 656110                    ERSQ    2,X0,PR1

      896    12640    6                          COD$->ALTKEYS.K.TDA(I)=ALTKEYS.K.TDA(I);

  12640  2 003225   200043 471500                    LDP1    COD$,,AUTO
         2 003226   000000 635010                    EAA     0,X0
         2 003227   000020 731000                    ARS     16
         2 003230   000000 636010                    EAQ     0,X0
         2 003231   000020 732000                    QRS     16
         2 003232   000106 100505                    MLR     fill='000'O
         2 003233   000002 600003                    ADSC9   2,A,PR0                  cn=3,n=3
         2 003234   100002 600003                    ADSC9   2,Q,PR1                  cn=3,n=3

      897    12641    6                          COD$->ALTKEYS.K.TDALVL(I)=ALTKEYS.K.TDALVL(I);

  12641  2 003235   200043 471500                    LDP1    COD$,,AUTO
         2 003236   000004 236110                    LDQ     4,X0,PR0
         2 003237   100004 676110                    ERQ     4,X0,PR1
         2 003240   777000 376003                    ANQ     -512,DU
         2 003241   100004 656110                    ERSQ    4,X0,PR1

      898    12642    6                          END;             /* DO I                               */

  12642  2 003242   200074 054100                    AOS     I,,AUTO
         2 003243   200042 470500                    LDP0    ALTKEY$,,AUTO
         2 003244   000000 236100                    LDQ     0,,PR0
         2 003245   000022 772000                    QRL     18
         2 003246   000377 376007                    ANQ     255,DL
         2 003247   200074 116100                    CMPQ    I,,AUTO
         2 003250   003207 605400 2                  TPNZ    s:12638

      899    12643    5                       END;                /* INDEXED                            */

  12643  2 003251   003354 710000 2                  TRA     CHK2

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:161  
      900    12644    4                    ELSE
      901    12645    5                    DO;                    /* IREL                               */

      902    12646    5                       CODE03.LDA=IRKEYS.K.LDA(0);

  12646  2 003252   200042 473500                    LDP3    ALTKEY$,,AUTO
         2 003253   200043 474500                    LDP4    COD$,,AUTO
         2 003254   300011 236100                    LDQ     9,,PR3
         2 003255   400004 552134                    STBQ    4,'34'O,PR4

      903    12647    5                       F$DCB.TDA=IRKEYS.K.TDA(0);

  12647  2 003256   200010 471500                    LDP1    DCB$,,AUTO
         2 003257   300003 236100                    LDQ     3,,PR3
         2 003260   100070 552134                    STBQ    56,'34'O,PR1

      904    12648    5                       F$DCB.TDALVL=IRKEYS.K.TDALVL(0);

  12648  2 003261   300003 236100                    LDQ     3,,PR3
         2 003262   000006 736000                    QLS     6
         2 003263   100067 676100                    ERQ     55,,PR1
         2 003264   700000 376003                    ANQ     -32768,DU
         2 003265   100067 656100                    ERSQ    55,,PR1

      905    12649    5                       CALL LOCCOD(20) ALTRET(CHK2);

  12649  2 003266   000052 236000 3                  LDQ     42
         2 003267   200111 756100                    STQ     K+1,,AUTO
         2 003270   005400 701000 2                  TSX1    LOCCOD
         2 003271   003354 702000 2                  TSX2    CHK2

      906    12650    5                       COD$->CODE20.ALTBLD=FM$CFU.ALTBLD;

  12650  2 003272   200043 470500                    LDP0    COD$,,AUTO
         2 003273   200012 471500                    LDP1    CFU$,,AUTO
         2 003274   100006 236100                    LDQ     6,,PR1
         2 003275   000017 736000                    QLS     15
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:162  
         2 003276   000001 676100                    ERQ     1,,PR0
         2 003277   400000 376003                    ANQ     -131072,DU
         2 003300   000001 656100                    ERSQ    1,,PR0

      907    12651    6                       DO I=0 TO IRKEYS.NKEYS-1;

  12651  2 003301   200074 450100                    STZ     I,,AUTO
         2 003302   003347 710000 2                  TRA     s:12656+1

      908    12652    6                          CODE20.K.FDA(I)=IRKEYS.K.FDA(I);

  12652  2 003303   200074 236100                    LDQ     I,,AUTO
         2 003304   000003 402007                    MPY     3,DL
         2 003305   000000 620006                    EAX0    0,QL
         2 003306   200074 236100                    LDQ     I,,AUTO
         2 003307   000007 402007                    MPY     7,DL
         2 003310   200042 470500                    LDP0    ALTKEY$,,AUTO
         2 003311   200043 471500                    LDP1    COD$,,AUTO
         2 003312   000007 236106                    LDQ     7,QL,PR0
         2 003313   000011 736000                    QLS     9
         2 003314   100003 676110                    ERQ     3,X0,PR1
         2 003315   000050 376000 3                  ANQ     40
         2 003316   100003 656110                    ERSQ    3,X0,PR1

      909    12653    6                          CODE20.K.LDA(I)=IRKEYS.K.LDA(I);

  12653  2 003317   200074 236100                    LDQ     I,,AUTO
         2 003320   000007 402007                    MPY     7,DL
         2 003321   200043 471500                    LDP1    COD$,,AUTO
         2 003322   000002 736000                    QLS     2
         2 003323   000000 635010                    EAA     0,X0
         2 003324   000020 731000                    ARS     16
         2 003325   000105 100506                    MLR     fill='000'O
         2 003326   000011 200003                    ADSC9   9,Q,PR0                  cn=1,n=3
         2 003327   100003 600003                    ADSC9   3,A,PR1                  cn=3,n=3

      910    12654    6                          CODE20.K.TDA(I)=IRKEYS.K.TDA(I);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:163  

  12654  2 003330   200074 236100                    LDQ     I,,AUTO
         2 003331   000007 402007                    MPY     7,DL
         2 003332   200043 471500                    LDP1    COD$,,AUTO
         2 003333   000003 236106                    LDQ     3,QL,PR0
         2 003334   100002 676110                    ERQ     2,X0,PR1
         2 003335   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003336   100002 656110                    ERSQ    2,X0,PR1

      911    12655    6                          CODE20.K.TDALVL(I)=IRKEYS.K.TDALVL(I);

  12655  2 003337   200074 236100                    LDQ     I,,AUTO
         2 003340   000007 402007                    MPY     7,DL
         2 003341   200043 471500                    LDP1    COD$,,AUTO
         2 003342   000003 236106                    LDQ     3,QL,PR0
         2 003343   100002 676110                    ERQ     2,X0,PR1
         2 003344   777000 376003                    ANQ     -512,DU
         2 003345   100002 656110                    ERSQ    2,X0,PR1

      912    12656    6                          END;             /* DO I                               */

  12656  2 003346   200074 054100                    AOS     I,,AUTO
         2 003347   200042 470500                    LDP0    ALTKEY$,,AUTO
         2 003350   000000 236100                    LDQ     0,,PR0
         2 003351   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003352   200074 116100                    CMPQ    I,,AUTO
         2 003353   003303 605400 2                  TPNZ    s:12652

      913    12657    5                       END;                /* IREL                               */

      914    12658    4                    END;                   /* UPDATE ALTKEY INFO                 */

      915    12659    3   CHK2:      CALL LOCCOD(2) ALTRET(CHK16);

  12659  2 003354   000053 236000 3     CHK2         LDQ     43
         2 003355   200111 756100                    STQ     K+1,,AUTO
         2 003356   005400 701000 2                  TSX1    LOCCOD
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:164  
         2 003357   003406 702000 2                  TSX2    CHK16

      916    12660    3              CODE02.SLIDE=FM$CFU.SLIDE;

  12660  2 003360   200012 470500                    LDP0    CFU$,,AUTO
         2 003361   200043 471500                    LDP1    COD$,,AUTO
         2 003362   000005 236100                    LDQ     5,,PR0
         2 003363   000033 772000                    QRL     27
         2 003364   100000 552104                    STBQ    0,'04'O,PR1

      917    12661    3              CODE02.GDA=FM$CFU.GDA;

  12661  2 003365   200012 470500                    LDP0    CFU$,,AUTO
         2 003366   200043 471500                    LDP1    COD$,,AUTO
         2 003367   000005 236100                    LDQ     5,,PR0
         2 003370   100002 552134                    STBQ    2,'34'O,PR1

      918    12662    4              IF DCB$~=ADDR(NIL) THEN DO;

  12662  2 003371   200010 236100                    LDQ     DCB$,,AUTO
         2 003372   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003373   003406 600000 2                  TZE     CHK16

      919    12663    4                 CODE02.TDALVL=F$DCB.TDALVL;

  12663  2 003374   200010 470500                    LDP0    DCB$,,AUTO
         2 003375   200043 471500                    LDP1    COD$,,AUTO
         2 003376   000067 236100                    LDQ     55,,PR0
         2 003377   700000 376003                    ANQ     -32768,DU
         2 003400   000006 772000                    QRL     6
         2 003401   100001 552140                    STBQ    1,'40'O,PR1

      920    12664    4                 CODE02.TDA=F$DCB.TDA;

  12664  2 003402   200010 470500                    LDP0    DCB$,,AUTO
         2 003403   200043 471500                    LDP1    COD$,,AUTO
         2 003404   000070 236100                    LDQ     56,,PR0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:165  
         2 003405   100001 552134                    STBQ    1,'34'O,PR1

      921    12665    4                 END;

      922    12666    3   CHK16:     CALL LOCCOD(16) ALTRET(CHK4);

  12666  2 003406   000055 236000 3     CHK16        LDQ     45
         2 003407   200111 756100                    STQ     K+1,,AUTO
         2 003410   005400 701000 2                  TSX1    LOCCOD
         2 003411   003430 702000 2                  TSX2    CHK4

      923    12667    4              IF DCB$~=ADDR(NIL) THEN DO;

  12667  2 003412   200010 236100                    LDQ     DCB$,,AUTO
         2 003413   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003414   003430 600000 2                  TZE     CHK4

      924    12668    4                 CALL CVTPTR(F$DCB.FORM$,T$);

  12668  2 003415   200073 630500                    EPPR0   T$,,AUTO
         2 003416   200132 450500                    STP0    @IP$+1,,AUTO
         2 003417   000050 036003                    ADLQ    40,DU
         2 003420   200131 756100                    STQ     MIR_DQH$+3,,AUTO
         2 003421   004442 701000 2                  TSX1    CVTPTR
         2 003422   000000 011000                    NOP     0

      925    12669    4                 CODE16=T$->CODE16;

  12669  2 003423   200073 470500                    LDP0    T$,,AUTO
         2 003424   200043 471500                    LDP1    COD$,,AUTO
         2 003425   000100 100500                    MLR     fill='000'O
         2 003426   000000 000234                    ADSC9   0,,PR0                   cn=0,n=156
         2 003427   100000 000234                    ADSC9   0,,PR1                   cn=0,n=156

      926    12670    4                 END;

      927    12671    3              END;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:166  

      928    12672    2   CHK4:   CALL LOCCOD(4) ALTRET(CHK13);

  12672  2 003430   000056 236000 3     CHK4         LDQ     46
         2 003431   200111 756100                    STQ     K+1,,AUTO
         2 003432   005400 701000 2                  TSX1    LOCCOD
         2 003433   003445 702000 2                  TSX2    CHK13

      929    12673    2           IF NOT FM$CFU.FMOD THEN

  12673  2 003434   200012 470500                    LDP0    CFU$,,AUTO
         2 003435   000000 236100                    LDQ     0,,PR0
         2 003436   004000 316003                    CANQ    2048,DU
         2 003437   003443 601000 2                  TNZ     s:12675

      930    12674    2              CODE04.MODIFY.TIME=CODE04.SVMODIFY.TIME;

  12674  2 003440   200043 471500                    LDP1    COD$,,AUTO
         2 003441   100010 235100                    LDA     8,,PR1
         2 003442   100001 755100                    STA     1,,PR1

      931    12675    2           CODE04.SVMODIFY.TIME=0;

  12675  2 003443   200043 470500                    LDP0    COD$,,AUTO
         2 003444   000010 450100                    STZ     8,,PR0

      932    12676    2   CHK13:  CALL LOCCOD(13) ALTRET(RET);

  12676  2 003445   000060 236000 3     CHK13        LDQ     48
         2 003446   200111 756100                    STQ     K+1,,AUTO
         2 003447   005400 701000 2                  TSX1    LOCCOD
         2 003450   003464 702000 2                  TSX2    RET

      933    12677    2           IF ACCT=':SYMO' AND SN='SYS' THEN

  12677  2 003451   040000 106500                    CMPC    fill='040'O
         2 003452   200027 000010                    ADSC9   ACCT,,AUTO               cn=0,n=8
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:167  
         2 003453   000242 000005 1                  ADSC9   SEGTAB+24                cn=0,n=5
         2 003454   003464 601000 2                  TNZ     RET
         2 003455   040000 106500                    CMPC    fill='040'O
         2 003456   200025 000006                    ADSC9   SN,,AUTO                 cn=0,n=6
         2 003457   000244 000003 1                  ADSC9   SEGTAB+26                cn=0,n=3
         2 003460   003464 601000 2                  TNZ     RET

      934    12678    2              FS$DEST.CRASHED='1'B;

  12678  2 003461   200043 470500                    LDP0    COD$,,AUTO
         2 003462   040000 236003                    LDQ     16384,DU
         2 003463   000005 256100                    ORSQ    5,,PR0

      935    12679        /**/
      936    12680    2   RET:    RETURN;

  12680  2 003464   200072 221300       RET          LDX1  ! MIR_DCTX+1,,AUTO
         2 003465   000001 702211                    TSX2  ! 1,X1

      937    12681        /**/
      938    12682    2   ERR:    ERRCODE=20;

  12682  2 003466   000024 235007       ERR          LDA     20,DL
         2 003467   200032 755100                    STA     ERRCODE,,AUTO

      939    12683    2           CALL ERROR;

  12683  2 003470   005436 701000 2                  TSX1    ERROR
         2 003471   000000 011000                    NOP     0

      940    12684    2           ALTRETURN;

  12684  2 003472   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 003473   000000 702211                    TSX2  ! 0,X1

      941    12685    2   END UPFIT;
      942    12686        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:168  
      943    12687    1   DSWRITE: PROC;

  12687  2 003474   200072 741300       DSWRITE      STX1  ! MIR_DCTX+1,,AUTO

      944    12688        /**/
      945    12689        /* LOCAL AUTOMATIC STORAGE */
      946    12690    2   DCL PAGE# UBIN;
      947    12691        /* PPUT */
      948    12692    2   DCL 1 MM$PPUT(0:0) BASED(I$PPUT$) ALIGNED,
      949    12693    2         2 * BIT(18),
      950    12694    2         2 PPNO UBIN(18)UNAL;
      951    12695    2   DCL I$PPUT$ PTR SYMREF;
      952    12696        /**/
      953    12697    2           IF FM$CFU.UGRANS=0 THEN GOTO ERR;

  12697  2 003475   200012 470500                    LDP0    CFU$,,AUTO
         2 003476   000004 236100                    LDQ     4,,PR0
         2 003477   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 003500   003762 600000 2                  TZE     ERR

      954    12698    2           OP=OP_DSWRITE;

  12698  2 003501   000013 235007                    LDA     11,DL
         2 003502   200033 755100                    STA     OP,,AUTO

      955    12699    2           PAGE#=FM$CFUR.HEADPP#;

  12699  2 003503   000005 236100                    LDQ     5,,PR0
         2 003504   000022 772000                    QRL     18
         2 003505   200073 756100                    STQ     PAGE#,,AUTO

      956    12700    3           DO I=1 TO FM$CFU.NRECS;

  12700  2 003506   000001 235007                    LDA     1,DL
         2 003507   200004 755100                    STA     I,,AUTO
         2 003510   003532 710000 2                  TRA     s:12705+3

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:169  
      957    12701    3              IF PAGE#=0 THEN GOTO ERRCHN;

  12701  2 003511   200073 235100                    LDA     PAGE#,,AUTO
         2 003512   004001 600000 2                  TZE     ERRCHN

      958    12702    3              MEMDESC.BADDR=PAGE#*4096;

  12702  2 003513   000014 735000                    ALS     12
         2 003514   000001 755000 xsym               STA     MEMDESC+1

      959    12703    3              POBUF$->PG(I)=I$MEM$->PG(0);

  12703  2 003515   000000 470400 xsym               LDP0    I$MEM$
         2 003516   000006 471400 1                  LDP1    POBUF$
         2 003517   200004 720100                    LXL0    I,,AUTO
         2 003520   000000 235100                    LDA     0,,PR0
         2 003521   100000 755110                    STA     0,X0,PR1

      960    12704    3              PAGE#=MM$PPUT.PPNO(PAGE#);

  12704  2 003522   000000 470400 xsym               LDP0    I$PPUT$
         2 003523   200073 721100                    LXL1    PAGE#,,AUTO
         2 003524   000000 236111                    LDQ     0,X1,PR0
         2 003525   777777 376007                    ANQ     -1,DL
         2 003526   200073 756100                    STQ     PAGE#,,AUTO

      961    12705    3              END;

  12705  2 003527   200004 235100                    LDA     I,,AUTO
         2 003530   000001 035007                    ADLA    1,DL
         2 003531   200004 755100                    STA     I,,AUTO
         2 003532   200012 470500                    LDP0    CFU$,,AUTO
         2 003533   200004 236100                    LDQ     I,,AUTO
         2 003534   003537 604000 2                  TMI     s:12706
         2 003535   000001 116100                    CMPQ    1,,PR0
         2 003536   003511 604400 2                  TMOZ    s:12701

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:170  
      962    12706    2           IF PAGE#~=0 THEN GOTO ERRCHN;

  12706  2 003537   200073 235100                    LDA     PAGE#,,AUTO
         2 003540   004001 601000 2                  TNZ     ERRCHN

      963    12707    3           DO I=FM$CFU.NRECS+1 TO 1023;

  12707  2 003541   000001 235100                    LDA     1,,PR0
         2 003542   000001 035007                    ADLA    1,DL
         2 003543   200004 755100                    STA     I,,AUTO
         2 003544   003553 710000 2                  TRA     s:12709+3

      964    12708    3              POBUF$->PG(I)=0;

  12708  2 003545   000006 470400 1                  LDP0    POBUF$
         2 003546   200004 720100                    LXL0    I,,AUTO
         2 003547   000000 450110                    STZ     0,X0,PR0

      965    12709    3              END;

  12709  2 003550   200004 235100                    LDA     I,,AUTO
         2 003551   000001 035007                    ADLA    1,DL
         2 003552   200004 755100                    STA     I,,AUTO
         2 003553   002000 115007                    CMPA    1024,DL
         2 003554   003545 602000 2                  TNC     s:12708

      966    12710    2           PAGE#=FM$CFUR.HEADPP#;

  12710  2 003555   200012 470500                    LDP0    CFU$,,AUTO
         2 003556   000005 236100                    LDQ     5,,PR0
         2 003557   000022 772000                    QRL     18
         2 003560   200073 756100                    STQ     PAGE#,,AUTO

      967    12711    2           DA=FM_FRZERO;

  12711  2 003561   000000 235000 1                  LDA     FM_FRZERO
         2 003562   200003 755100                    STA     DA,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:171  

      968    12712    2           MIR_ERR = '0'B ;

  12712  2 003563   200070 450100                    STZ     MIR_ERR,,AUTO

      969    12713    3           DO I=0 TO FM$CFU.NRECS;

  12713  2 003564   200004 450100                    STZ     I,,AUTO
         2 003565   003745 710000 2                  TRA     s:12762+3

      970    12714    3              FM$GRAN.STAMP.GMOD=DA;

  12714  2 003566   000006 470400 1                  LDP0    POBUF$
         2 003567   200003 236100                    LDQ     DA,,AUTO
         2 003570   000000 552104                    STBQ    0,'04'O,PR0

      971    12715    3              CALL DISKCNVRT ALTRET(ERR);

  12715  2 003571   004716 701000 2                  TSX1    DISKCNVRT
         2 003572   003762 702000 2                  TSX2    ERR

      972    12716    3              IF  ( NOT MIR_FLAG )

  12716  2 003573   000001 234000 0                  SZN     MIR_FLAG
         2 003574   003602 605000 2                  TPL     s:12719
         2 003575   003643 605000 2                  TPL     s:12734
         2 003576   200062 470500                    LDP0    DCT$,,AUTO
         2 003577   000036 236100                    LDQ     30,,PR0
         2 003600   007700 316003                    CANQ    4032,DU
         2 003601   003643 601000 2                  TNZ     s:12734

      973    12717    3                OR ( MIR_FLAG AND DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER )
      974    12718    3              THEN
      975    12719    3                 CALL IRR$WPAGE

  12719  2 003602   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003603   000000 701000 xent               TSX1    IRR$WPAGE
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:172  
         2 003604   003606 702000 2                  TSX2    s:12721
         2 003605   003643 710000 2                  TRA     s:12734

      976    12720    4                 WHENALTRETURN DO;

      977    12721    4                    MSG_IOERR.NAME = SUBSTR(DCT.DEVNM,0,4);

  12721  2 003606   200062 470500                    LDP0    DCT$,,AUTO
         2 003607   000002 236100                    LDQ     2,,PR0
         2 003610   000000 756000 xsym               STQ     MSG_IOERR

      978    12722    4                    CALL IRR$TYPE6(MSG_IOERR,SIZEW(MSG_IOERR));

  12722  2 003611   000061 630400 3                  EPPR0   49
         2 003612   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003613   000000 701000 xent               TSX1    IRR$TYPE6
         2 003614   000000 011000                    NOP     0

      979    12723    4                    IF  MIR_FLAG

  12723  2 003615   000001 234000 0                  SZN     MIR_FLAG
         2 003616   003641 605000 2                  TPL     s:12732
         2 003617   200067 470500                    LDP0    MIR_DCT$,,AUTO
         2 003620   000036 236100                    LDQ     30,,PR0
         2 003621   007700 316003                    CANQ    4032,DU
         2 003622   003641 601000 2                  TNZ     s:12732

      980    12724    4                      AND MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
      981    12725    5                    THEN DO ;

      982    12726    5                       DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL;

  12726  2 003623   200062 471500                    LDP1    DCT$,,AUTO
         2 003624   000100 236003                    LDQ     64,DU
         2 003625   100036 752120                    STCQ    30,'20'O,PR1

      983    12727    5                       DCT.STATUS.DOWN = '1'B;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:173  

  12727  2 003626   200062 470500                    LDP0    DCT$,,AUTO
         2 003627   400000 236003                    LDQ     -131072,DU
         2 003630   000027 256100                    ORSQ    23,,PR0

      984    12728    5                       MSG_PART.NAME = SUBSTR(DCT.DEVNM,0,4);

  12728  2 003631   200062 470500                    LDP0    DCT$,,AUTO
         2 003632   000002 236100                    LDQ     2,,PR0
         2 003633   000000 756000 xsym               STQ     MSG_PART

      985    12729    5                       CALL IRR$TYPE6(MSG_PART,SIZEW(MSG_PART));

  12729  2 003634   000063 630400 3                  EPPR0   51
         2 003635   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003636   000000 701000 xent               TSX1    IRR$TYPE6
         2 003637   000000 011000                    NOP     0

      986    12730    5                       END;

  12730  2 003640   003643 710000 2                  TRA     s:12734

      987    12731    4                    ELSE
      988    12732    4                       MIR_ERR = '1'B ;

  12732  2 003641   400000 236003                    LDQ     -131072,DU
         2 003642   200070 756100                    STQ     MIR_ERR,,AUTO

      989    12733    4                    END;

      990    12734    3              IF  MIR_FLAG

  12734  2 003643   000001 234000 0                  SZN     MIR_FLAG
         2 003644   003714 605000 2                  TPL     s:12754
         2 003645   200067 470500                    LDP0    MIR_DCT$,,AUTO
         2 003646   000036 236100                    LDQ     30,,PR0
         2 003647   007700 316003                    CANQ    4032,DU
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:174  
         2 003650   003714 601000 2                  TNZ     s:12754

      991    12735    3                AND MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
      992    12736    4              THEN DO ;

      993    12737    4                 RV_DCTX = RV_MIRDCTX;

  12737  2 003651   000000 235000 0                  LDA     RV_MIRDCTX
         2 003652   000000 755000 xsym               STA     RV_DCTX

      994    12738    4                 CALL IRR$WPAGE

  12738  2 003653   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003654   000000 701000 xent               TSX1    IRR$WPAGE
         2 003655   003657 702000 2                  TSX2    s:12740
         2 003656   003714 710000 2                  TRA     s:12754

      995    12739    5                 WHENALTRETURN DO;

      996    12740    5                    MSG_IOERR.NAME = SUBSTR(DCT.DEVNM,0,4);

  12740  2 003657   200062 470500                    LDP0    DCT$,,AUTO
         2 003660   000002 236100                    LDQ     2,,PR0
         2 003661   000000 756000 xsym               STQ     MSG_IOERR

      997    12741    5                    CALL IRR$TYPE6(MSG_IOERR,SIZEW(MSG_IOERR));

  12741  2 003662   000061 630400 3                  EPPR0   49
         2 003663   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003664   000000 701000 xent               TSX1    IRR$TYPE6
         2 003665   000000 011000                    NOP     0

      998    12742    5                    IF  MIR_FLAG

  12742  2 003666   000001 234000 0                  SZN     MIR_FLAG
         2 003667   003712 605000 2                  TPL     s:12751
         2 003670   200062 470500                    LDP0    DCT$,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:175  
         2 003671   000036 236100                    LDQ     30,,PR0
         2 003672   007700 316003                    CANQ    4032,DU
         2 003673   003712 601000 2                  TNZ     s:12751

      999    12743    5                      AND DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
     1000    12744    6                    THEN DO;

     1001    12745    6                       MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL;

  12745  2 003674   200067 471500                    LDP1    MIR_DCT$,,AUTO
         2 003675   000100 236003                    LDQ     64,DU
         2 003676   100036 752120                    STCQ    30,'20'O,PR1

     1002    12746    6                       MIR_DCT$->DCT.STATUS.DOWN = '1'B;

  12746  2 003677   200067 470500                    LDP0    MIR_DCT$,,AUTO
         2 003700   400000 236003                    LDQ     -131072,DU
         2 003701   000027 256100                    ORSQ    23,,PR0

     1003    12747    6                       MSG_PART.NAME = SUBSTR(MIR_DCT$->DCT.DEVNM,0,4);

  12747  2 003702   200067 470500                    LDP0    MIR_DCT$,,AUTO
         2 003703   000002 236100                    LDQ     2,,PR0
         2 003704   000000 756000 xsym               STQ     MSG_PART

     1004    12748    6                       CALL IRR$TYPE6(MSG_PART,SIZEW(MSG_PART));

  12748  2 003705   000063 630400 3                  EPPR0   51
         2 003706   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003707   000000 701000 xent               TSX1    IRR$TYPE6
         2 003710   000000 011000                    NOP     0

     1005    12749    6                       END;

  12749  2 003711   003714 710000 2                  TRA     s:12754

     1006    12750    5                    ELSE
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:176  
     1007    12751    5                       MIR_ERR = '1'B ;

  12751  2 003712   400000 236003                    LDQ     -131072,DU
         2 003713   200070 756100                    STQ     MIR_ERR,,AUTO

     1008    12752    5                    END;

     1009    12753    4                 END ;

     1010    12754    3              IF  MIR_ERR

  12754  2 003714   200070 234100                    SZN     MIR_ERR,,AUTO
         2 003715   003767 604000 2                  TMI     ERR2

     1011    12755    3              THEN
     1012    12756    3                 GOTO ERR2 ;
     1013    12757    3              MEMDESC.BADDR=PAGE#*4096;

  12757  2 003716   200073 235100                    LDA     PAGE#,,AUTO
         2 003717   000014 735000                    ALS     12
         2 003720   000001 755000 xsym               STA     MEMDESC+1

     1014    12758    3              I$MEM$->PG(0)=POBUF$->PG(0);

  12758  2 003721   000006 470400 1                  LDP0    POBUF$
         2 003722   000000 471400 xsym               LDP1    I$MEM$
         2 003723   000000 235100                    LDA     0,,PR0
         2 003724   100000 755100                    STA     0,,PR1

     1015    12759    3              POBUF$->PG=I$MEM$->PG;

  12759  2 003725   000000 471400 xsym               LDP1    I$MEM$
         2 003726   010000 220003                    LDX0    4096,DU
         2 003727   000140 100540                    MLR     fill='000'O
         2 003730   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         2 003731   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:177  
     1016    12760    3              DA=DA+1;

  12760  2 003732   200003 235100                    LDA     DA,,AUTO
         2 003733   000001 035007                    ADLA    1,DL
         2 003734   200003 755100                    STA     DA,,AUTO

     1017    12761    3              PAGE#=MM$PPUT.PPNO(PAGE#);

  12761  2 003735   000000 471400 xsym               LDP1    I$PPUT$
         2 003736   200073 721100                    LXL1    PAGE#,,AUTO
         2 003737   100000 236111                    LDQ     0,X1,PR1
         2 003740   777777 376007                    ANQ     -1,DL
         2 003741   200073 756100                    STQ     PAGE#,,AUTO

     1018    12762    3              END;

  12762  2 003742   200004 235100                    LDA     I,,AUTO
         2 003743   000001 035007                    ADLA    1,DL
         2 003744   200004 755100                    STA     I,,AUTO
         2 003745   200012 470500                    LDP0    CFU$,,AUTO
         2 003746   200004 236100                    LDQ     I,,AUTO
         2 003747   003752 604000 2                  TMI     s:12763
         2 003750   000001 116100                    CMPQ    1,,PR0
         2 003751   003566 604400 2                  TMOZ    s:12714

     1019    12763    2           IF RVF_DEBUG~=0 THEN

  12763  2 003752   000007 235000 1                  LDA     RVF_DEBUG
         2 003753   003762 600000 2                  TZE     ERR

     1020    12764    2              CALL PUTNAME(RVF_WRDSMSG,RVF_WRDSMSG.FID,SIZEC(RVF_WRDSMSG.FID));

  12764  2 003754   000066 237000 3                  LDAQ    54
         2 003755   200140 757100                    STAQ    @MSG+1,,AUTO
         2 003756   000070 236000 3                  LDQ     56
         2 003757   200137 756100                    STQ     I+2,,AUTO
         2 003760   004236 701000 2                  TSX1    PUTNAME
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:178  
         2 003761   000000 011000                    NOP     0

     1021    12765    2   ERR:    FM$CFUR.HEADPP#=0;              /* DONT TRY TWICE                     */

  12765  2 003762   000000 220003       ERR          LDX0    0,DU
         2 003763   200012 470500                    LDP0    CFU$,,AUTO
         2 003764   000005 740100                    STX0    5,,PR0

     1022    12766    2           RETURN;

  12766  2 003765   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 003766   000001 702211                    TSX2  ! 1,X1

     1023    12767        /**/
     1024    12768    2   ERR2:   ERRCODE=2;

  12768  2 003767   000002 235007       ERR2         LDA     2,DL
         2 003770   200032 755100                    STA     ERRCODE,,AUTO

     1025    12769    2           CALL ERROR;

  12769  2 003771   005436 701000 2                  TSX1    ERROR
         2 003772   000000 011000                    NOP     0

     1026    12770    2           GOTO ERR;

  12770  2 003773   003762 710000 2                  TRA     ERR

     1027    12771        /**/
     1028    12772    2   DSERR:  ENTRY;

  12772  2 003774   200072 741300       DSERR        STX1  ! MIR_DCTX+1,,AUTO

     1029    12773    2           IF FM$CFUR.HEADPP#=0 THEN RETURN; /* NO ERROR TO REPORT               */

  12773  2 003775   200012 470500                    LDP0    CFU$,,AUTO
         2 003776   000005 220100                    LDX0    5,,PR0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:179  
         2 003777   004001 601000 2                  TNZ     ERRCHN

  12773  2 004000   000001 702211                    TSX2  ! 1,X1

     1030    12774        /**/
     1031    12775    2   ERRCHN: ERRCODE=50;

  12775  2 004001   000062 235007       ERRCHN       LDA     50,DL
         2 004002   200032 755100                    STA     ERRCODE,,AUTO

     1032    12776    2           MISC1=FM$CFUR.HEADPP#;

  12776  2 004003   200012 470500                    LDP0    CFU$,,AUTO
         2 004004   000005 236100                    LDQ     5,,PR0
         2 004005   000022 772000                    QRL     18
         2 004006   200045 756100                    STQ     MISC1,,AUTO

     1033    12777    2           MISC2=PAGE#;

  12777  2 004007   200073 235100                    LDA     PAGE#,,AUTO
         2 004010   200046 755100                    STA     MISC2,,AUTO

     1034    12778    2           CALL ERROR;

  12778  2 004011   005436 701000 2                  TSX1    ERROR
         2 004012   000000 011000                    NOP     0

     1035    12779    2           GOTO ERR;

  12779  2 004013   003762 710000 2                  TRA     ERR

     1036    12780    2   END DSWRITE;
     1037    12781        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:180  
     1038    12782    1   GETFDFIT: PROC ALTRET;

  12782  2 004014   200072 741300       GETFDFIT     STX1  ! MIR_DCTX+1,,AUTO

     1039    12783        /**/
     1040    12784        /* LOCAL AUTOMATIC STORAGE */
     1041    12785    2   DCL 1 STAMP,
     1042    12786    2         2 HASH UBIN(27) UNAL,
     1043    12787    2         2 GMOD UBIN(9) UNAL;
     1044    12788    2   DCL T$ PTR;
     1045    12789        /* BASED */
     1046    12790    2   DCL 1 HSH BASED(T$) ALIGNED,
     1047    12791    2         2 B1 UBIN(27) UNAL,
     1048    12792    2         2 * BIT(18),
     1049    12793    2         2 B2 UBIN(27) UNAL;
     1050    12794    2   DCL 1 HSH1 BASED(T$) ALIGNED,
     1051    12795    2         2 * BIT(24),
     1052    12796    2         2 B3 UBIN(27) UNAL;
     1053    12797        /**/
     1054    12798    2           DA=FM$CFUA.FDFITSDA;

  12798  2 004015   200022 470500                    LDP0    ACCT$,,AUTO
         2 004016   000004 235100                    LDA     4,,PR0
         2 004017   200003 755100                    STA     DA,,AUTO

     1055    12799    2           IF DA<FM_SRZERO THEN

  12799  2 004020   200003 236100                    LDQ     DA,,AUTO
         2 004021   000002 116000 1                  CMPQ    FM_SRZERO
         2 004022   004120 602000 2                  TNC     ERR1

     1056    12800    2              GOTO ERR1;
     1057    12801    2           CALL READ ALTRET(ERR);

  12801  2 004023   004706 701000 2                  TSX1    READ
         2 004024   004134 702000 2                  TSX2    ERR

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:181  
     1058    12802    2           STAMP.GMOD=DA;

  12802  2 004025   200003 236100                    LDQ     DA,,AUTO
         2 004026   200073 552104                    STBQ    STAMP,'04'O,AUTO

     1059    12803    2           T$=ADDR(FM$CFUA.ACCT);

  12803  2 004027   200022 236100                    LDQ     ACCT$,,AUTO
         2 004030   000001 036003                    ADLQ    1,DU
         2 004031   200074 756100                    STQ     T$,,AUTO

     1060    12804    2           STAMP.HASH=HSH.B1+HSH.B2+HSH1.B3;

  12804  2 004032   200074 470500                    LDP0    T$,,AUTO
         2 004033   000001 236100                    LDQ     1,,PR0
         2 004034   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004035   200144 756100                    STQ     J+1,,AUTO
         2 004036   000000 236100                    LDQ     0,,PR0
         2 004037   000011 772000                    QRL     9
         2 004040   200144 036100                    ADLQ    J+1,,AUTO
         2 004041   000000 235100                    LDA     0,,PR0
         2 004042   200145 756100                    STQ     J+2,,AUTO
         2 004043   000001 236100                    LDQ     1,,PR0
         2 004044   000025 773000                    LRL     21
         2 004045   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004046   200146 756100                    STQ     J+3,,AUTO
         2 004047   200145 236100                    LDQ     J+2,,AUTO
         2 004050   200146 036100                    ADLQ    J+3,,AUTO
         2 004051   000011 736000                    QLS     9
         2 004052   200073 552170                    STBQ    STAMP,'70'O,AUTO

     1061    12805    2           MISC1=POBUF$->PG(0);

  12805  2 004053   000006 471400 1                  LDP1    POBUF$
         2 004054   100000 235100                    LDA     0,,PR1
         2 004055   200045 755100                    STA     MISC1,,AUTO

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:182  
     1062    12806    2           MISC2=BITBIN(STAMP);

  12806  2 004056   200073 236100                    LDQ     STAMP,,AUTO
         2 004057   200046 756100                    STQ     MISC2,,AUTO

     1063    12807    2           IF STAMP~=FM$GRAN.STAMP THEN

  12807  2 004060   200073 236100                    LDQ     STAMP,,AUTO
         2 004061   100000 116100                    CMPQ    0,,PR1
         2 004062   004131 601000 2                  TNZ     ERR5

     1064    12808    2              GOTO ERR5;
     1065    12809    2           MISC2=POBUF$->PG(1);

  12809  2 004063   100001 235100                    LDA     1,,PR1
         2 004064   200046 755100                    STA     MISC2,,AUTO

     1066    12810    2           IF FM$GRAN.ORG~=0 THEN

  12810  2 004065   100001 236100                    LDQ     1,,PR1
         2 004066   036000 316007                    CANQ    15360,DL
         2 004067   004123 601000 2                  TNZ     ERR3

     1067    12811    2              GOTO ERR3;
     1068    12812    2           IF FM$GRAN.LVL~=FMGTFD THEN

  12812  2 004070   100001 236100                    LDQ     1,,PR1
         2 004071   340000 376007                    ANQ     114688,DL
         2 004072   200000 116007                    CMPQ    65536,DL
         2 004073   004126 601000 2                  TNZ     ERR4

     1069    12813    2              GOTO ERR4;
     1070    12814    2           RETURN;

  12814  2 004074   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 004075   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:183  
     1071    12815        /**/
     1072    12816    2   GETGPFIT: ENTRY ALTRET;

  12816  2 004076   200072 741300       GETGPFIT     STX1  ! MIR_DCTX+1,,AUTO

     1073    12817    2           DA=FM_GPSDA;

  12817  2 004077   000004 235000 1                  LDA     FM_GPSDA
         2 004100   200003 755100                    STA     DA,,AUTO

     1074    12818    2           CALL READ ALTRET(ERR);

  12818  2 004101   004706 701000 2                  TSX1    READ
         2 004102   004134 702000 2                  TSX2    ERR

     1075    12819    2           IF FM$GRAN.STAMP~=FM_GPSTAMP THEN

  12819  2 004103   000006 470400 1                  LDP0    POBUF$
         2 004104   000000 236100                    LDQ     0,,PR0
         2 004105   000005 116000 1                  CMPQ    FM_GPSTAMP
         2 004106   004131 601000 2                  TNZ     ERR5

     1076    12820    2              GOTO ERR5;
     1077    12821    2           IF FM$GRAN.ORG~=0 THEN

  12821  2 004107   000001 236100                    LDQ     1,,PR0
         2 004110   036000 316007                    CANQ    15360,DL
         2 004111   004123 601000 2                  TNZ     ERR3

     1078    12822    2              GOTO ERR3;
     1079    12823    2           IF FM$GRAN.LVL~=FMGTGP THEN

  12823  2 004112   000001 236100                    LDQ     1,,PR0
         2 004113   340000 376007                    ANQ     114688,DL
         2 004114   040000 116007                    CMPQ    16384,DL
         2 004115   004126 601000 2                  TNZ     ERR4

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:184  
     1080    12824    2              GOTO ERR4;
     1081    12825    2           RETURN;

  12825  2 004116   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 004117   000001 702211                    TSX2  ! 1,X1

     1082    12826        /**/
     1083    12827    2   ERR1:   ERRCODE=1; GOTO ERR;

  12827  2 004120   000001 235007       ERR1         LDA     1,DL
         2 004121   200032 755100                    STA     ERRCODE,,AUTO

  12827  2 004122   004134 710000 2                  TRA     ERR

     1084    12828    2   ERR3:   ERRCODE=3; GOTO ERR;

  12828  2 004123   000003 235007       ERR3         LDA     3,DL
         2 004124   200032 755100                    STA     ERRCODE,,AUTO

  12828  2 004125   004134 710000 2                  TRA     ERR

     1085    12829    2   ERR4:   ERRCODE=4; GOTO ERR;

  12829  2 004126   000004 235007       ERR4         LDA     4,DL
         2 004127   200032 755100                    STA     ERRCODE,,AUTO

  12829  2 004130   004134 710000 2                  TRA     ERR

     1086    12830    2   ERR5:   ERRCODE=5; GOTO ERR;

  12830  2 004131   000005 235007       ERR5         LDA     5,DL
         2 004132   200032 755100                    STA     ERRCODE,,AUTO

  12830  2 004133   004134 710000 2                  TRA     ERR

     1087    12831        /**/
     1088    12832    2   ERR:    CALL ERROR;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:185  

  12832  2 004134   005436 701000 2     ERR          TSX1    ERROR
         2 004135   000000 011000                    NOP     0

     1089    12833    2           ALTRETURN;

  12833  2 004136   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 004137   000000 702211                    TSX2  ! 0,X1

     1090    12834    2   END GETFDFIT;
     1091    12835        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:186  
     1092    12836    1   UPFDFIT: PROC ALTRET;

  12836  2 004140   200072 741300       UPFDFIT      STX1  ! MIR_DCTX+1,,AUTO

     1093    12837        /**/
     1094    12838    2           FIT$=PINCRW(POBUF$,SIZEW(FM$GRAN));

  12838  2 004141   000006 236000 1                  LDQ     POBUF$
         2 004142   000005 036003                    ADLQ    5,DU
         2 004143   200041 756100                    STQ     FIT$,,AUTO

     1095    12839    2           CALL LOCCOD(14) ALTRET(ERR20);

  12839  2 004144   000072 236000 3                  LDQ     58
         2 004145   200111 756100                    STQ     K+1,,AUTO
         2 004146   005400 701000 2                  TSX1    LOCCOD
         2 004147   004160 702000 2                  TSX2    ERR20

     1096    12840    2           CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;

  12840  2 004150   200022 470500                    LDP0    ACCT$,,AUTO
         2 004151   200043 471500                    LDP1    COD$,,AUTO
         2 004152   100001 236100                    LDQ     1,,PR1
         2 004153   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004154   000007 136100                    SBLQ    7,,PR0
         2 004155   100002 756100                    STQ     2,,PR1

     1097    12841    2           RETURN;

  12841  2 004156   200072 221300                    LDX1  ! MIR_DCTX+1,,AUTO
         2 004157   000001 702211                    TSX2  ! 1,X1

     1098    12842        /**/
     1099    12843    2   ERR20:  ERRCODE=20; GOTO ERR;

  12843  2 004160   000024 235007       ERR20        LDA     20,DL
         2 004161   200032 755100                    STA     ERRCODE,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:187  

  12843  2 004162   004163 710000 2                  TRA     ERR

     1100    12844        /**/
     1101    12845    2   ERR:    ALTRETURN;

  12845  2 004163   200072 221300       ERR          LDX1  ! MIR_DCTX+1,,AUTO
         2 004164   000000 702211                    TSX2  ! 0,X1

     1102    12846    2   END UPFDFIT;
     1103    12847        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:188  
     1104    12848    1   ADDLIST: PROC;

  12848  2 004165   200072 741300       ADDLIST      STX1  ! MIR_DCTX+1,,AUTO

     1105    12849        /**/
     1106    12850    2           CALL LOCCOD(3) ALTRET(ERR);

  12850  2 004166   000046 236000 3                  LDQ     38
         2 004167   200111 756100                    STQ     K+1,,AUTO
         2 004170   005400 701000 2                  TSX1    LOCCOD
         2 004171   004234 702000 2                  TSX2    ERR

     1107    12851    2           CODE03.NSTAMP=BITBIN('442443403400'O); /* Magic stamp                 */

  12851  2 004172   200043 470500                    LDP0    COD$,,AUTO
         2 004173   000245 235000 1                  LDA     SEGTAB+27
         2 004174   000006 755100                    STA     6,,PR0

     1108    12852    2           RELBUF.LINK=FM$SET.CHKSM(SETX);

  12852  2 004175   200016 236100                    LDQ     SETX,,AUTO
         2 004176   000003 736000                    QLS     3
         2 004177   000000 470400 xsym               LDP0    R$CFU$
         2 004200   000006 471400 1                  LDP1    POBUF$
         2 004201   000007 235106                    LDA     7,QL,PR0
         2 004202   101777 755100                    STA     1023,,PR1

     1109    12853    2           FM$SET.CHKSM(SETX)=DA;

  12853  2 004203   200003 235100                    LDA     DA,,AUTO
         2 004204   000007 755106                    STA     7,QL,PR0

     1110    12854    2           IF DCB$~=ADDR(NIL) AND ACCT$~=ADDR(NIL) THEN

  12854  2 004205   200010 236100                    LDQ     DCB$,,AUTO
         2 004206   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 004207   004224 600000 2                  TZE     s:12859
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:189  
         2 004210   200022 236100                    LDQ     ACCT$,,AUTO
         2 004211   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 004212   004224 600000 2                  TZE     s:12859

     1111    12855    3              IF F$DCB.BORROW<0 THEN DO;

  12855  2 004213   200010 470500                    LDP0    DCB$,,AUTO
         2 004214   000065 235100                    LDA     53,,PR0
         2 004215   004224 605000 2                  TPL     s:12859

     1112    12856    3                 FM$CFUA.GRANS=FM$CFUA.GRANS-F$DCB.BORROW;

  12856  2 004216   200022 473500                    LDP3    ACCT$,,AUTO
         2 004217   300007 236100                    LDQ     7,,PR3
         2 004220   000065 136100                    SBLQ    53,,PR0
         2 004221   300007 756100                    STQ     7,,PR3

     1113    12857    3                 FM$CFUA.GMOD=1;

  12857  2 004222   100000 236003                    LDQ     32768,DU
         2 004223   300005 256100                    ORSQ    5,,PR3

     1114    12858    3                 END;

     1115    12859    2           IF RVF_DEBUG~=0 THEN

  12859  2 004224   000007 235000 1                  LDA     RVF_DEBUG
         2 004225   004234 600000 2                  TZE     ERR

     1116    12860    2              CALL PUTNAME(RVF_RELFILE,RVF_RELFILE.FID,SIZEC(RVF_RELFILE.FID));

  12860  2 004226   000074 237000 3                  LDAQ    60
         2 004227   200140 757100                    STAQ    @MSG+1,,AUTO
         2 004230   000076 236000 3                  LDQ     62
         2 004231   200137 756100                    STQ     I+2,,AUTO
         2 004232   004236 701000 2                  TSX1    PUTNAME
         2 004233   000000 011000                    NOP     0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:190  

     1117    12861    2   ERR:    RETURN;

  12861  2 004234   200072 221300       ERR          LDX1  ! MIR_DCTX+1,,AUTO
         2 004235   000001 702211                    TSX2  ! 1,X1

     1118    12862    2   END ADDLIST;
     1119    12863        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:191  
     1120    12864    1   PUTNAME: PROC(MSG,FID,FIDSIZ);

  12864  2 004236   200136 741300       PUTNAME      STX1  ! I+1,,AUTO

     1121    12865    2   DCL MSG CHAR(112);
     1122    12866    2   DCL FID CHAR(12);
     1123    12867    2   DCL FIDSIZ UBIN;
     1124    12868        /* CONSTANT */
     1125    12869    2   DCL I UBIN;
     1126    12870    2   DCL J UBIN;
     1127    12871        /**/
     1128    12872    2           CALL INSERT(FID,0,FIDSIZ,' ');

  12872  2 004237   200141 470500                    LDP0    @FIDSIZ,,AUTO
         2 004240   000000 720100                    LXL0    0,,PR0
         2 004241   200140 471500                    LDP1    @FID,,AUTO
         2 004242   040140 100400                    MLR     fill='040'O
         2 004243   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 004244   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

     1129    12873    2           I=0;

  12873  2 004245   200142 450100                    STZ     I,,AUTO

     1130    12874    3           IF ASN=%FILE# THEN DO;

  12874  2 004246   200031 235100                    LDA     ASN,,AUTO
         2 004247   000001 115007                    CMPA    1,DL
         2 004250   004261 601000 2                  TNZ     s:12879

     1131    12875    3              CALL INSERT(FID,I,2,'DP');

  12875  2 004251   200142 236100                    LDQ     I,,AUTO
         2 004252   040106 100400                    MLR     fill='040'O
         2 004253   000246 000002 1                  ADSC9   SEGTAB+28                cn=0,n=2
         2 004254   100000 000002                    ADSC9   0,Q,PR1                  cn=0,n=2

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:192  
     1132    12876    3              I=I+2;

  12876  2 004255   200142 236100                    LDQ     I,,AUTO
         2 004256   000002 036007                    ADLQ    2,DL
         2 004257   200142 756100                    STQ     I,,AUTO

     1133    12877    3              END;

  12877  2 004260   004272 710000 2                  TRA     s:12883

     1134    12878    2           ELSE
     1135    12879    3              IF ASN=%COMGROUP# THEN DO;

  12879  2 004261   000004 115007                    CMPA    4,DL
         2 004262   004272 601000 2                  TNZ     s:12883

     1136    12880    3                 CALL INSERT(FID,I,2,'CG');

  12880  2 004263   200142 236100                    LDQ     I,,AUTO
         2 004264   040106 100400                    MLR     fill='040'O
         2 004265   000247 000002 1                  ADSC9   SEGTAB+29                cn=0,n=2
         2 004266   100000 000002                    ADSC9   0,Q,PR1                  cn=0,n=2

     1137    12881    3                 I=I+2;

  12881  2 004267   200142 236100                    LDQ     I,,AUTO
         2 004270   000002 036007                    ADLQ    2,DL
         2 004271   200142 756100                    STQ     I,,AUTO

     1138    12882    3                 END;

     1139    12883    2           J=0;

  12883  2 004272   200143 450100                    STZ     J,,AUTO

     1140    12884    3           DO WHILE(SUBSTR(SN,J,1)~=' ' AND J<6);

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:193  
  12884  2 004273   004277 710000 2                  TRA     s:12886

     1141    12885    3              J=J+1;

  12885  2 004274   200143 235100                    LDA     J,,AUTO
         2 004275   000001 035007                    ADLA    1,DL
         2 004276   200143 755100                    STA     J,,AUTO

     1142    12886    3              END;

  12886  2 004277   200143 235100                    LDA     J,,AUTO
         2 004300   040000 106505                    CMPC    fill='040'O
         2 004301   200025 000001                    ADSC9   SN,A,AUTO                cn=0,n=1
         2 004302   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 004303   004306 600000 2                  TZE     s:12887
         2 004304   000006 115007                    CMPA    6,DL
         2 004305   004274 602000 2                  TNC     s:12885

     1143    12887    3           IF J~=0 THEN DO;

  12887  2 004306   000000 115003                    CMPA    0,DU
         2 004307   004333 600000 2                  TZE     s:12891

     1144    12888    3              CALL INSERT(FID,I,J+1,'#',SUBSTR(SN,0,J));

  12888  2 004310   000001 620005                    EAX0    1,AL
         2 004311   200140 470500                    LDP0    @FID,,AUTO
         2 004312   200142 236100                    LDQ     I,,AUTO
         2 004313   040146 100400                    MLR     fill='040'O
         2 004314   000077 000001 3                  ADSC9   63                       cn=0,n=1
         2 004315   000000 000010                    ADSC9   0,Q,PR0                  cn=0,n=*X0
         2 004316   200143 236100                    LDQ     J,,AUTO
         2 004317   000000 116003                    CMPQ    0,DU
         2 004320   004327 600000 2                  TZE     s:12889
         2 004321   000000 621006                    EAX1    0,QL
         2 004322   000000 622005                    EAX2    0,AL
         2 004323   200142 235100                    LDA     I,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:194  
         2 004324   040145 100540                    MLR     fill='040'O
         2 004325   200025 000011                    ADSC9   SN,,AUTO                 cn=0,n=*X1
         2 004326   000000 200012                    ADSC9   0,A,PR0                  cn=1,n=*X2

     1145    12889    3              I=I+J+1;

  12889  2 004327   200142 236100                    LDQ     I,,AUTO
         2 004330   200143 036100                    ADLQ    J,,AUTO
         2 004331   000001 036007                    ADLQ    1,DL
         2 004332   200142 756100                    STQ     I,,AUTO

     1146    12890    3              END;

     1147    12891    3           IF NAME$~=ADDR(NIL) THEN DO;

  12891  2 004333   200023 236100                    LDQ     NAME$,,AUTO
         2 004334   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 004335   004376 600000 2                  TZE     s:12897

     1148    12892    3              J=FM$CFUN.L;

  12892  2 004336   200023 470500                    LDP0    NAME$,,AUTO
         2 004337   000100 101500                    MRL     fill='000'O
         2 004340   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         2 004341   200143 000004                    ADSC9   J,,AUTO                  cn=0,n=4

     1149    12893    3              IF J>31 THEN J=31;

  12893  2 004342   200143 235100                    LDA     J,,AUTO
         2 004343   000040 115007                    CMPA    32,DL
         2 004344   004347 602000 2                  TNC     s:12894

  12893  2 004345   000037 235007                    LDA     31,DL
         2 004346   200143 755100                    STA     J,,AUTO

     1150    12894    3              CALL INSERT(FID,I,J+1,'/',SUBSTR(FM$CFUN.C,0,J));

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:195  
  12894  2 004347   000100 101500                    MRL     fill='000'O
         2 004350   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         2 004351   200144 000002                    ADSC9   J+1,,AUTO                cn=0,n=2
         2 004352   200144 220100                    LDX0    J+1,,AUTO
         2 004353   000001 621005                    EAX1    1,AL
         2 004354   200140 471500                    LDP1    @FID,,AUTO
         2 004355   200142 235100                    LDA     I,,AUTO
         2 004356   040145 100400                    MLR     fill='040'O
         2 004357   000100 000001 3                  ADSC9   64                       cn=0,n=1
         2 004360   100000 000011                    ADSC9   0,A,PR1                  cn=0,n=*X1
         2 004361   200143 236100                    LDQ     J,,AUTO
         2 004362   000000 116003                    CMPQ    0,DU
         2 004363   004372 600000 2                  TZE     s:12895
         2 004364   000000 622006                    EAX2    0,QL
         2 004365   200143 723100                    LXL3    J,,AUTO
         2 004366   200142 235100                    LDA     I,,AUTO
         2 004367   040145 100540                    MLR     fill='040'O
         2 004370   000000 600012                    ADSC9   0,,PR0                   cn=3,n=*X2
         2 004371   100000 200013                    ADSC9   0,A,PR1                  cn=1,n=*X3

     1151    12895    3              I=I+J+1;

  12895  2 004372   200142 236100                    LDQ     I,,AUTO
         2 004373   200143 036100                    ADLQ    J,,AUTO
         2 004374   000001 036007                    ADLQ    1,DL
         2 004375   200142 756100                    STQ     I,,AUTO

     1152    12896    3              END;

     1153    12897    3           IF ACCT~=' ' THEN DO;

  12897  2 004376   040000 106500                    CMPC    fill='040'O
         2 004377   200027 000010                    ADSC9   ACCT,,AUTO               cn=0,n=8
         2 004400   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 004401   004416 600000 2                  TZE     s:12901

     1154    12898    3              CALL INSERT(FID,I,9,'.',ACCT);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:196  

  12898  2 004402   200140 470500                    LDP0    @FID,,AUTO
         2 004403   200142 235100                    LDA     I,,AUTO
         2 004404   040105 100400                    MLR     fill='040'O
         2 004405   000101 000001 3                  ADSC9   65                       cn=0,n=1
         2 004406   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         2 004407   200142 235100                    LDA     I,,AUTO
         2 004410   040105 100500                    MLR     fill='040'O
         2 004411   200027 000010                    ADSC9   ACCT,,AUTO               cn=0,n=8
         2 004412   000000 200010                    ADSC9   0,A,PR0                  cn=1,n=8

     1155    12899    3              I=I+9;

  12899  2 004413   200142 235100                    LDA     I,,AUTO
         2 004414   000011 035007                    ADLA    9,DL
         2 004415   200142 755100                    STA     I,,AUTO

     1156    12900    3              END;

     1157    12901    2           I=(I+POFFC(ADDR(FID),ADDR(MSG))+3)/4;

  12901  2 004416   200137 236100                    LDQ     @MSG,,AUTO
         2 004417   000020 772000                    QRL     16
         2 004420   200144 756100                    STQ     J+1,,AUTO
         2 004421   200140 236100                    LDQ     @FID,,AUTO
         2 004422   000020 772000                    QRL     16
         2 004423   200144 136100                    SBLQ    J+1,,AUTO
         2 004424   200142 036100                    ADLQ    I,,AUTO
         2 004425   000003 036007                    ADLQ    3,DL
         2 004426   000004 506007                    DIV     4,DL
         2 004427   200142 756100                    STQ     I,,AUTO

     1158    12902    2           CALL IRR$TYPE6(MSG,I);

  12902  2 004430   200142 630500                    EPPR0   I,,AUTO
         2 004431   200145 450500                    STP0    J+2,,AUTO
         2 004432   200137 236100                    LDQ     @MSG,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:197  
         2 004433   200144 756100                    STQ     J+1,,AUTO
         2 004434   200144 630500                    EPPR0   J+1,,AUTO
         2 004435   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004436   000000 701000 xent               TSX1    IRR$TYPE6
         2 004437   000000 011000                    NOP     0

     1159    12903    2           RETURN;

  12903  2 004440   200136 221300                    LDX1  ! I+1,,AUTO
         2 004441   000001 702211                    TSX2  ! 1,X1

     1160    12904    2   END PUTNAME;
     1161    12905        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:198  
     1162    12906    1   CVTPTR: PROC(IP$,OP$) ALTRET;

  12906  2 004442   200130 741300       CVTPTR       STX1  ! MIR_DQH$+2,,AUTO

     1163    12907        /* PARAMETERS */
     1164    12908    2   DCL 1 IP$ ALIGNED,
     1165    12909    2         2 * BIT(24),
     1166    12910    2         2 SEGID BIT(12);
     1167    12911    2   DCL 1 OP$ ALIGNED,
     1168    12912    2         2 * BIT(24),
     1169    12913    2         2 SEGID BIT(12);
     1170    12914        /* LOCAL AUTOMATIC STORAGE */
     1171    12915    2   DCL I UBIN;
     1172    12916        /* CONSTANT */
     1173    12917        %SUB SEGNUM#=10;
     1174    12918    2   DCL 1 SEGTAB(0:SEGNUM#) CONSTANT SYMDEF,
     1175    12919    2         2 MONSID BIT(12) ALIGNED INIT(
     1176    12920    2           %REALSID,
     1177    12921    2           %TIGRSID,
     1178    12922    2           %ISSID,
     1179    12923    2           %ISBSID,
     1180    12924    2           %DS1SID,
     1181    12925    2           %BUFSID,
     1182    12926    2           %ROSID,
     1183    12927    2           %RONCSID,
     1184    12928    2           %CGPTSID,
     1185    12929    2           %CGCTXTSID,
     1186    12930    2           %DVTTBLSID),
     1187    12931    2         2 RV$ PTR INIT(
     1188    12932    2           ADDR(I$REAL$),
     1189    12933    2           ADDR(I$RV1$),
     1190    12934    2           ADDR(I$MONIS$),
     1191    12935    2           ADDR(I$MONIS$),
     1192    12936    2           ADDR(R$CFU$),
     1193    12937    2           ADDR(R$BUFF$),
     1194    12938    2           ADDR(R$ROSEG$),
     1195    12939    2           ADDR(R$ROSEG$),
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:199  
     1196    12940    2           ADDR(R$CGPT$),
     1197    12941    2           ADDR(R$CGCTXT$),
     1198    12942    2           ADDR(R$DVT$));
     1199    12943        /* BASED */
     1200    12944    2   DCL 1 P BASED ALIGNED,
     1201    12945    2         2 * BIT(24),
     1202    12946    2         2 SEGID BIT(12);
     1203    12947        /**/
     1204    12948    3           DO I=0 TO SEGNUM#;

  12948  2 004443   200133 450100                    STZ     I,,AUTO

     1205    12949    4              IF IP$.SEGID=SEGTAB.MONSID(I) THEN DO;

  12949  2 004444   200133 236100                    LDQ     I,,AUTO
         2 004445   000014 402007                    MPY     12,DL
         2 004446   200131 470500                    LDP0    @IP$,,AUTO
         2 004447   000006 106500                    CMPC    fill='000'O
         2 004450   000000 420002                    ADSC6   0,,PR0                   cn=4,n=2
         2 004451   000212 020002 1                  ADSC6   SEGTAB,Q                 cn=0,n=2
         2 004452   004465 601000 2                  TNZ     s:12954

     1206    12950    4                 OP$=IP$;

  12950  2 004453   000000 236100                    LDQ     0,,PR0
         2 004454   200132 471500                    LDP1    @OP$,,AUTO
         2 004455   100000 756100                    STQ     0,,PR1

     1207    12951    4                 OP$.SEGID=SEGTAB.RV$(I)->P.SEGID;

  12951  2 004456   200133 235100                    LDA     I,,AUTO
         2 004457   000001 735000                    ALS     1
         2 004460   000213 473405 1                  LDP3    SEGTAB+1,AL
         2 004461   300000 236100                    LDQ     0,,PR3
         2 004462   100000 752103                    STCQ    0,'03'O,PR1

     1208    12952    4                 RETURN;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:200  

  12952  2 004463   200130 221300                    LDX1  ! MIR_DQH$+2,,AUTO
         2 004464   000001 702211                    TSX2  ! 1,X1

     1209    12953    4                 END;
     1210    12954    3              END;

  12954  2 004465   200133 235100                    LDA     I,,AUTO
         2 004466   000001 035007                    ADLA    1,DL
         2 004467   200133 755100                    STA     I,,AUTO
         2 004470   000013 115007                    CMPA    11,DL
         2 004471   004444 602000 2                  TNC     s:12949

     1211    12955    2           MISC1=BITBIN(IP$); MISC2=0;

  12955  2 004472   000000 235100                    LDA     0,,PR0
         2 004473   200045 755100                    STA     MISC1,,AUTO

  12955  2 004474   200046 450100                    STZ     MISC2,,AUTO

     1212    12956    2           ERRCODE=30;

  12956  2 004475   000036 236007                    LDQ     30,DL
         2 004476   200032 756100                    STQ     ERRCODE,,AUTO

     1213    12957    2           CALL ERROR;

  12957  2 004477   005436 701000 2                  TSX1    ERROR
         2 004500   000000 011000                    NOP     0

     1214    12958    2           ALTRETURN;

  12958  2 004501   200130 221300                    LDX1  ! MIR_DQH$+2,,AUTO
         2 004502   000000 702211                    TSX2  ! 0,X1

     1215    12959    2   END CVTPTR;
     1216    12960        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:201  
     1217    12961    1   WRITECHK: PROC ALTRET;

  12961  2 004503   200110 741300       WRITECHK     STX1  ! K,,AUTO

     1218    12962    2   DCL GMOD UBIN(9);
     1219    12963        /**/
     1220    12964    2           GMOD=DA;

  12964  2 004504   200003 235100                    LDA     DA,,AUTO
         2 004505   000033 735000                    ALS     27
         2 004506   200111 755100                    STA     GMOD,,AUTO

     1221    12965    3           IF GMOD~=FM$GRAN.STAMP.GMOD THEN DO;

  12965  2 004507   000006 470400 1                  LDP0    POBUF$
         2 004510   000000 236100                    LDQ     0,,PR0
         2 004511   000777 376007                    ANQ     511,DL
         2 004512   200144 756100                    STQ     J+1,,AUTO
         2 004513   200111 236100                    LDQ     GMOD,,AUTO
         2 004514   000033 772000                    QRL     27
         2 004515   200144 116100                    CMPQ    J+1,,AUTO
         2 004516   004536 600000 2                  TZE     s:12973

     1222    12966    3   ERR5:      ERRCODE=5;

  12966  2 004517   000005 235007       ERR5         LDA     5,DL
         2 004520   200032 755100                    STA     ERRCODE,,AUTO

     1223    12967    3              MISC1=POBUF$->PG(0);

  12967  2 004521   000006 470400 1                  LDP0    POBUF$
         2 004522   000000 235100                    LDA     0,,PR0
         2 004523   200045 755100                    STA     MISC1,,AUTO

     1224    12968    3              ADDR(MISC2)->FM$GRAN.STAMP.HASH=F$DCB.HASH;

  12968  2 004524   200010 471500                    LDP1    DCB$,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:202  
         2 004525   100073 236100                    LDQ     59,,PR1
         2 004526   200046 552170                    STBQ    MISC2,'70'O,AUTO

     1225    12969    3              ADDR(MISC2)->FM$GRAN.STAMP.GMOD=GMOD;

  12969  2 004527   200111 236100                    LDQ     GMOD,,AUTO
         2 004530   000033 772000                    QRL     27
         2 004531   200046 552104                    STBQ    MISC2,'04'O,AUTO

     1226    12970    3              CALL ERROR;

  12970  2 004532   005436 701000 2                  TSX1    ERROR
         2 004533   000000 011000                    NOP     0

     1227    12971    3              ALTRETURN;

  12971  2 004534   200110 221300                    LDX1  ! K,,AUTO
         2 004535   000000 702211                    TSX2  ! 0,X1

     1228    12972    3              END;
     1229    12973    2           IF DA<FM_SRZERO THEN

  12973  2 004536   200003 236100                    LDQ     DA,,AUTO
         2 004537   000002 116000 1                  CMPQ    FM_SRZERO
         2 004540   004546 603000 2                  TRC     s:12974+5

     1230    12974    2              IF F$DCB.HASH~=FM$GRAN.STAMP.HASH THEN

  12974  2 004541   200010 471500                    LDP1    DCB$,,AUTO
         2 004542   100073 236100                    LDQ     59,,PR1
         2 004543   000000 676100                    ERQ     0,,PR0
         2 004544   000050 376000 3                  ANQ     40
         2 004545   004517 601000 2                  TNZ     ERR5
         2 004546   004550 710000 2                  TRA     s:12979

     1231    12975    2                 GOTO ERR5;
     1232    12976        /**/
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:203  
     1233    12977    2   WRITE:  ENTRY ALTRET;

  12977  2 004547   200110 741300       WRITE        STX1  ! K,,AUTO

     1234    12978        /**/
     1235    12979    2           CALL DISKCNVRT ALTRET(ERR);

  12979  2 004550   004716 701000 2                  TSX1    DISKCNVRT
         2 004551   004704 702000 2                  TSX2    ERR

     1236    12980    2           MIR_ERR = '0'B ;

  12980  2 004552   200070 450100                    STZ     MIR_ERR,,AUTO

     1237    12981    2           IF  ( NOT MIR_FLAG )

  12981  2 004553   000001 234000 0                  SZN     MIR_FLAG
         2 004554   004562 605000 2                  TPL     s:12984
         2 004555   004623 605000 2                  TPL     s:12999
         2 004556   200062 470500                    LDP0    DCT$,,AUTO
         2 004557   000036 236100                    LDQ     30,,PR0
         2 004560   007700 316003                    CANQ    4032,DU
         2 004561   004623 601000 2                  TNZ     s:12999

     1238    12982    2             OR ( MIR_FLAG AND DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER )
     1239    12983    2           THEN
     1240    12984    2              CALL IRR$WPAGE

  12984  2 004562   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004563   000000 701000 xent               TSX1    IRR$WPAGE
         2 004564   004566 702000 2                  TSX2    s:12986
         2 004565   004623 710000 2                  TRA     s:12999

     1241    12985    3              WHENALTRETURN DO;

     1242    12986    3                 MSG_IOERR.NAME = SUBSTR(DCT.DEVNM,0,4);

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:204  
  12986  2 004566   200062 470500                    LDP0    DCT$,,AUTO
         2 004567   000002 236100                    LDQ     2,,PR0
         2 004570   000000 756000 xsym               STQ     MSG_IOERR

     1243    12987    3                 CALL IRR$TYPE6(MSG_IOERR,SIZEW(MSG_IOERR));

  12987  2 004571   000061 630400 3                  EPPR0   49
         2 004572   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004573   000000 701000 xent               TSX1    IRR$TYPE6
         2 004574   000000 011000                    NOP     0

     1244    12988    3                 IF  MIR_FLAG

  12988  2 004575   000001 234000 0                  SZN     MIR_FLAG
         2 004576   004621 605000 2                  TPL     s:12997
         2 004577   200067 470500                    LDP0    MIR_DCT$,,AUTO
         2 004600   000036 236100                    LDQ     30,,PR0
         2 004601   007700 316003                    CANQ    4032,DU
         2 004602   004621 601000 2                  TNZ     s:12997

     1245    12989    3                   AND MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
     1246    12990    4                 THEN DO ;

     1247    12991    4                    DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL;

  12991  2 004603   200062 471500                    LDP1    DCT$,,AUTO
         2 004604   000100 236003                    LDQ     64,DU
         2 004605   100036 752120                    STCQ    30,'20'O,PR1

     1248    12992    4                    DCT.STATUS.DOWN = '1'B;

  12992  2 004606   200062 470500                    LDP0    DCT$,,AUTO
         2 004607   400000 236003                    LDQ     -131072,DU
         2 004610   000027 256100                    ORSQ    23,,PR0

     1249    12993    4                    MSG_PART.NAME = SUBSTR(DCT.DEVNM,0,4);

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:205  
  12993  2 004611   200062 470500                    LDP0    DCT$,,AUTO
         2 004612   000002 236100                    LDQ     2,,PR0
         2 004613   000000 756000 xsym               STQ     MSG_PART

     1250    12994    4                    CALL IRR$TYPE6(MSG_PART,SIZEW(MSG_PART));

  12994  2 004614   000063 630400 3                  EPPR0   51
         2 004615   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004616   000000 701000 xent               TSX1    IRR$TYPE6
         2 004617   000000 011000                    NOP     0

     1251    12995    4                    END;

  12995  2 004620   004623 710000 2                  TRA     s:12999

     1252    12996    3                 ELSE
     1253    12997    3                    MIR_ERR = '1'B ;

  12997  2 004621   400000 236003                    LDQ     -131072,DU
         2 004622   200070 756100                    STQ     MIR_ERR,,AUTO

     1254    12998    3                 END;

     1255    12999    2           IF  MIR_FLAG

  12999  2 004623   000001 234000 0                  SZN     MIR_FLAG
         2 004624   004674 605000 2                  TPL     s:13019
         2 004625   200067 470500                    LDP0    MIR_DCT$,,AUTO
         2 004626   000036 236100                    LDQ     30,,PR0
         2 004627   007700 316003                    CANQ    4032,DU
         2 004630   004674 601000 2                  TNZ     s:13019

     1256    13000    2             AND MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
     1257    13001    3           THEN DO ;

     1258    13002    3              RV_DCTX = RV_MIRDCTX;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:206  
  13002  2 004631   000000 235000 0                  LDA     RV_MIRDCTX
         2 004632   000000 755000 xsym               STA     RV_DCTX

     1259    13003    3              CALL IRR$WPAGE

  13003  2 004633   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004634   000000 701000 xent               TSX1    IRR$WPAGE
         2 004635   004637 702000 2                  TSX2    s:13005
         2 004636   004674 710000 2                  TRA     s:13019

     1260    13004    4              WHENALTRETURN DO;

     1261    13005    4                 MSG_IOERR.NAME = SUBSTR(DCT.DEVNM,0,4);

  13005  2 004637   200062 470500                    LDP0    DCT$,,AUTO
         2 004640   000002 236100                    LDQ     2,,PR0
         2 004641   000000 756000 xsym               STQ     MSG_IOERR

     1262    13006    4                 CALL IRR$TYPE6(MSG_IOERR,SIZEW(MSG_IOERR));

  13006  2 004642   000061 630400 3                  EPPR0   49
         2 004643   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004644   000000 701000 xent               TSX1    IRR$TYPE6
         2 004645   000000 011000                    NOP     0

     1263    13007    4                 IF  MIR_FLAG

  13007  2 004646   000001 234000 0                  SZN     MIR_FLAG
         2 004647   004672 605000 2                  TPL     s:13016
         2 004650   200062 470500                    LDP0    DCT$,,AUTO
         2 004651   000036 236100                    LDQ     30,,PR0
         2 004652   007700 316003                    CANQ    4032,DU
         2 004653   004672 601000 2                  TNZ     s:13016

     1264    13008    4                   AND DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
     1265    13009    5                 THEN DO;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:207  
     1266    13010    5                    MIR_DCT$->DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL;

  13010  2 004654   200067 471500                    LDP1    MIR_DCT$,,AUTO
         2 004655   000100 236003                    LDQ     64,DU
         2 004656   100036 752120                    STCQ    30,'20'O,PR1

     1267    13011    5                    MIR_DCT$->DCT.STATUS.DOWN = '1'B;

  13011  2 004657   200067 470500                    LDP0    MIR_DCT$,,AUTO
         2 004660   400000 236003                    LDQ     -131072,DU
         2 004661   000027 256100                    ORSQ    23,,PR0

     1268    13012    5                    MSG_PART.NAME = SUBSTR(MIR_DCT$->DCT.DEVNM,0,4);

  13012  2 004662   200067 470500                    LDP0    MIR_DCT$,,AUTO
         2 004663   000002 236100                    LDQ     2,,PR0
         2 004664   000000 756000 xsym               STQ     MSG_PART

     1269    13013    5                    CALL IRR$TYPE6(MSG_PART,SIZEW(MSG_PART));

  13013  2 004665   000063 630400 3                  EPPR0   51
         2 004666   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004667   000000 701000 xent               TSX1    IRR$TYPE6
         2 004670   000000 011000                    NOP     0

     1270    13014    5                    END;

  13014  2 004671   004674 710000 2                  TRA     s:13019

     1271    13015    4                 ELSE
     1272    13016    4                    MIR_ERR = '1'B ;

  13016  2 004672   400000 236003                    LDQ     -131072,DU
         2 004673   200070 756100                    STQ     MIR_ERR,,AUTO

     1273    13017    4                 END;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:208  
     1274    13018    3              END ;

     1275    13019    2           IF  MIR_ERR

  13019  2 004674   200070 234100                    SZN     MIR_ERR,,AUTO
         2 004675   004700 604000 2                  TMI     ERR2

     1276    13020    2           THEN
     1277    13021    2              GOTO ERR2 ;
     1278    13022    2           RETURN;

  13022  2 004676   200110 221300                    LDX1  ! K,,AUTO
         2 004677   000001 702211                    TSX2  ! 1,X1

     1279    13023        /**/
     1280    13024    2   ERR2:   ERRCODE=2;

  13024  2 004700   000002 235007       ERR2         LDA     2,DL
         2 004701   200032 755100                    STA     ERRCODE,,AUTO

     1281    13025    2           CALL ERROR;

  13025  2 004702   005436 701000 2                  TSX1    ERROR
         2 004703   000000 011000                    NOP     0

     1282    13026    2   ERR:    ALTRETURN;

  13026  2 004704   200110 221300       ERR          LDX1  ! K,,AUTO
         2 004705   000000 702211                    TSX2  ! 0,X1

     1283    13027        /**/
     1284    13028    2   READ:   ENTRY ALTRET;

  13028  2 004706   200110 741300       READ         STX1  ! K,,AUTO

     1285    13029        /**/
     1286    13030    2           CALL DISKCNVRT ALTRET(ERR);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:209  

  13030  2 004707   004716 701000 2                  TSX1    DISKCNVRT
         2 004710   004704 702000 2                  TSX2    ERR

     1287    13031    2           CALL IRR$RPAGE ALTRET(ERR2);

  13031  2 004711   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004712   000000 701000 xent               TSX1    IRR$RPAGE
         2 004713   004700 702000 2                  TSX2    ERR2

     1288    13032    2           RETURN;

  13032  2 004714   200110 221300                    LDX1  ! K,,AUTO
         2 004715   000001 702211                    TSX2  ! 1,X1

     1289    13033    2   END WRITECHK;
     1290    13034        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:210  
     1291    13035    1   DISKCNVRT: PROC ALTRET;

  13035  2 004716   200112 741300       DISKCNVRT    STX1  ! @CODE+1,,AUTO

     1292    13036        /**/
     1293    13037        /* LOCAL AUTOMATIC STORAGE */
     1294    13038    2   DCL SRDA SBIN;
     1295    13039    2   DCL XTX UBIN;
     1296    13040    2   DCL XTX$ PTR;
     1297    13041    2   DCL I UBIN;
     1298    13042    2   DCL NGRAN SBIN;
     1299    13043    2   DCL SIZ UBIN;
     1300    13044    2   DCL RELADDR SBIN;
     1301    13045    2   DCL PACKSIZE UBIN;
     1302    13046    2   DCL NI$DVT$$ PTR;
     1303    13047    2   DCL MPC$ PTR;
     1304    13048    2   DCL MIR_SQH$ PTR;
     1305    13049    2   DCL MIR_DQH$ PTR;
     1306    13050        /* BASED STRUCTURES */
     1307    13051        %FM$CFUEXT (BASED="BASED(XTX$)");
     1308    13055        %FM$VOL (BASED="BASED(F$CFU$)");
     1309    13061        /**/
     1310    13062    3           IF DA<=FM_FRMAX THEN DO;

  13062  2 004717   000001 236000 1                  LDQ     FM_FRMAX
         2 004720   200003 116100                    CMPQ    DA,,AUTO
         2 004721   005030 602000 2                  TNC     s:13095

     1311    13063    3              SRDA=DA-FM_FRZERO;

  13063  2 004722   200003 236100                    LDQ     DA,,AUTO
         2 004723   000000 136000 1                  SBLQ    FM_FRZERO
         2 004724   200113 756100                    STQ     SRDA,,AUTO

     1312    13064    3              IF SRDA<0 THEN GOTO ERR1;

  13064  2 004725   005372 604000 2                  TMI     ERR1
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:211  

     1313    13065    3              IF SRDA>=FM$CFU.UGRANS THEN GOTO ERR1;

  13065  2 004726   200012 470500                    LDP0    CFU$,,AUTO
         2 004727   000004 236100                    LDQ     4,,PR0
         2 004730   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004731   200113 116100                    CMPQ    SRDA,,AUTO
         2 004732   005372 604400 2                  TMOZ    ERR1

     1314    13066    3              XTX=FM$CFU.XTX;

  13066  2 004733   000003 236100                    LDQ     3,,PR0
         2 004734   000022 772000                    QRL     18
         2 004735   200114 756100                    STQ     XTX,,AUTO

     1315    13067    3              IF XTX~=1 THEN

  13067  2 004736   000001 116007                    CMPQ    1,DL
         2 004737   005022 600000 2                  TZE     s:13089

     1316    13068    4              DO WHILE(XTX~=0);

  13068  2 004740   000000 116003                    CMPQ    0,DU
         2 004741   005027 600000 2                  TZE     s:13092

     1317    13069    4                 XTX$=PINCRW(R$CFU$,XTX);

  13069  2 004742   200114 236100                    LDQ     XTX,,AUTO
         2 004743   000022 736000                    QLS     18
         2 004744   000000 036000 xsym               ADLQ    R$CFU$
         2 004745   200115 756100                    STQ     XTX$,,AUTO

     1318    13070    4                 I=0;

  13070  2 004746   200116 450100                    STZ     I,,AUTO

     1319    13071    5                 DO WHILE(I<FM$CFUEXT.NUM);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:212  

  13071  2 004747   200115 470500                    LDP0    XTX$,,AUTO
         2 004750   000000 236100                    LDQ     0,,PR0
         2 004751   000036 772000                    QRL     30
         2 004752   200116 116100                    CMPQ    I,,AUTO
         2 004753   005015 602000 2                  TNC     s:13086
         2 004754   005015 600000 2                  TZE     s:13086

     1320    13072    5                    NGRAN=FM$CFUEXT.XTNT.XTNSIZE(I);

  13072  2 004755   200115 470500                    LDP0    XTX$,,AUTO
         2 004756   200116 720100                    LXL0    I,,AUTO
         2 004757   000001 236110                    LDQ     1,X0,PR0
         2 004760   000033 772000                    QRL     27
         2 004761   200117 756100                    STQ     NGRAN,,AUTO

     1321    13073    5                    IF NGRAN~=0 THEN

  13073  2 004762   004766 600000 2                  TZE     s:13076

     1322    13074    5                       SIZ=1;

  13074  2 004763   000001 235007                    LDA     1,DL
         2 004764   200120 755100                    STA     SIZ,,AUTO
         2 004765   004772 710000 2                  TRA     s:13079

     1323    13075    6                    ELSE DO;

     1324    13076    6                       SIZ=2;

  13076  2 004766   000002 235007                    LDA     2,DL
         2 004767   200120 755100                    STA     SIZ,,AUTO

     1325    13077    6                       NGRAN=FM$CFUEXT.EXTNT.XTNSIZE(I);

  13077  2 004770   000002 235110                    LDA     2,X0,PR0
         2 004771   200117 755100                    STA     NGRAN,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:213  

     1326    13078    6                       END;

     1327    13079    6                    IF NGRAN>SRDA THEN DO;

  13079  2 004772   200117 236100                    LDQ     NGRAN,,AUTO
         2 004773   200113 116100                    CMPQ    SRDA,,AUTO
         2 004774   005002 604400 2                  TMOZ    s:13083

     1328    13080    6                       SRDA=SRDA+FM$CFUEXT.XTNT.XTNSDA(I);

  13080  2 004775   000001 236110                    LDQ     1,X0,PR0
         2 004776   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004777   200113 036100                    ADLQ    SRDA,,AUTO
         2 005000   200113 756100                    STQ     SRDA,,AUTO

     1329    13081    6                       GOTO GOTSR;

  13081  2 005001   005032 710000 2                  TRA     GOTSR

     1330    13082    6                       END;
     1331    13083    5                    SRDA=SRDA-NGRAN;

  13083  2 005002   200113 236100                    LDQ     SRDA,,AUTO
         2 005003   200117 136100                    SBLQ    NGRAN,,AUTO
         2 005004   200113 756100                    STQ     SRDA,,AUTO

     1332    13084    5                    I=I+SIZ;

  13084  2 005005   200116 236100                    LDQ     I,,AUTO
         2 005006   200120 036100                    ADLQ    SIZ,,AUTO
         2 005007   200116 756100                    STQ     I,,AUTO

     1333    13085    5                    END;

  13085  2 005010   000000 236100                    LDQ     0,,PR0
         2 005011   000036 772000                    QRL     30
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:214  
         2 005012   200116 116100                    CMPQ    I,,AUTO
         2 005013   005015 600000 2                  TZE     s:13086
         2 005014   004755 603000 2                  TRC     s:13072

     1334    13086    4                 XTX=FM$CFUEXT.LINKX;

  13086  2 005015   000000 236100                    LDQ     0,,PR0
         2 005016   777777 376007                    ANQ     -1,DL
         2 005017   200114 756100                    STQ     XTX,,AUTO

     1335    13087    4                 END;

  13087  2 005020   004742 601000 2                  TNZ     s:13069
         2 005021   005027 710000 2                  TRA     s:13092

     1336    13088    4              ELSE DO;

     1337    13089    4                 SRDA=FM$CFU.FITSDA+SRDA;

  13089  2 005022   000000 236100                    LDQ     0,,PR0
         2 005023   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 005024   200113 036100                    ADLQ    SRDA,,AUTO
         2 005025   200113 756100                    STQ     SRDA,,AUTO

     1338    13090    4                 GOTO GOTSR;

  13090  2 005026   005032 710000 2                  TRA     GOTSR

     1339    13091    4                 END;
     1340    13092    3              GOTO ERR1;

  13092  2 005027   005372 710000 2                  TRA     ERR1

     1341    13093    3              END;
     1342    13094    2           ELSE
     1343    13095    2              SRDA=DA;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:215  
  13095  2 005030   200003 235100                    LDA     DA,,AUTO
         2 005031   200113 755100                    STA     SRDA,,AUTO

     1344    13096        /**/
     1345    13097    2   GOTSR:  IF SRDA<FM_SRZERO THEN GOTO ERR1;

  13097  2 005032   200113 236100       GOTSR        LDQ     SRDA,,AUTO
         2 005033   005372 604000 2                  TMI     ERR1
         2 005034   000002 116000 1                  CMPQ    FM_SRZERO
         2 005035   005372 602000 2                  TNC     ERR1

     1346    13098        /**/
     1347    13099    2           RELADDR=FM$CFUX.SETH;

  13099  2 005036   000000 470400 xsym               LDP0    R$CFU$
         2 005037   000005 236100                    LDQ     5,,PR0
         2 005040   000022 772000                    QRL     18
         2 005041   200121 756100                    STQ     RELADDR,,AUTO

     1348    13100    3           DO WHILE(RELADDR~=0 AND SETX~=RELADDR);

  13100  2 005042   005051 710000 2                  TRA     s:13102

     1349    13101    3              RELADDR=FM$SET.SETL(RELADDR);

  13101  2 005043   200121 235100                    LDA     RELADDR,,AUTO
         2 005044   000003 735000                    ALS     3
         2 005045   000000 470400 xsym               LDP0    R$CFU$
         2 005046   000005 236105                    LDQ     5,AL,PR0
         2 005047   000022 772000                    QRL     18
         2 005050   200121 756100                    STQ     RELADDR,,AUTO

     1350    13102    3              END;

  13102  2 005051   005055 600000 2                  TZE     s:13103
         2 005052   005043 604000 2                  TMI     s:13101
         2 005053   200016 116100                    CMPQ    SETX,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:216  
         2 005054   005043 601000 2                  TNZ     s:13101

     1351    13103    3           IF RELADDR~=0 THEN DO;

  13103  2 005055   000000 116003                    CMPQ    0,DU
         2 005056   005064 600000 2                  TZE     s:13106

     1352    13104    3              IF NOT FM$SET.SET(RELADDR) THEN GOTO ERR1;

  13104  2 005057   200121 235100                    LDA     RELADDR,,AUTO
         2 005060   000003 735000                    ALS     3
         2 005061   000002 236105                    LDQ     2,AL,PR0
         2 005062   200000 316003                    CANQ    65536,DU
         2 005063   005372 600000 2                  TZE     ERR1

     1353    13105    3              END;

     1354    13106    2           IF RELADDR=0 OR SRDA>=FM$SET.NXTSDA(RELADDR)

  13106  2 005064   200121 235100                    LDA     RELADDR,,AUTO
         2 005065   005372 600000 2                  TZE     ERR1
         2 005066   000003 735000                    ALS     3
         2 005067   000003 236105                    LDQ     3,AL,PR0
         2 005070   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 005071   200113 116100                    CMPQ    SRDA,,AUTO
         2 005072   005372 604400 2                  TMOZ    ERR1
         2 005073   000000 220105                    LDX0    0,AL,PR0
         2 005074   005372 600000 2                  TZE     ERR1

     1355    13107    2             OR FM$SET.DCTX(RELADDR)=0 THEN GOTO ERR1;
     1356    13108    2           RELADDR=SRDA-FM_SRZERO;

  13108  2 005075   200113 236100                    LDQ     SRDA,,AUTO
         2 005076   000002 136000 1                  SBLQ    FM_SRZERO
         2 005077   200121 756100                    STQ     RELADDR,,AUTO

     1357    13109    2           CALL CVTPTR(ADDR(N$DCT$$),L$N$DCT$$) ALTRET(ERR);
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:217  

  13109  2 005100   000102 236000 3                  LDQ     66
         2 005101   200154 756100                    STQ     J+9,,AUTO
         2 005102   200066 631500                    EPPR1   L$N$DCT$$,,AUTO
         2 005103   200132 451500                    STP1    @OP$,,AUTO
         2 005104   200154 633500                    EPPR3   J+9,,AUTO
         2 005105   200131 453500                    STP3    @IP$,,AUTO
         2 005106   004442 701000 2                  TSX1    CVTPTR
         2 005107   005376 702000 2                  TSX2    ERR

     1358    13110    2           CALL CVTPTR(L$N$DCT$$->PTR$(0),L$N$DCT$$);

  13110  2 005110   200066 630500                    EPPR0   L$N$DCT$$,,AUTO
         2 005111   200132 450500                    STP0    @OP$,,AUTO
         2 005112   200066 236100                    LDQ     L$N$DCT$$,,AUTO
         2 005113   200131 756100                    STQ     @IP$,,AUTO
         2 005114   004442 701000 2                  TSX1    CVTPTR
         2 005115   000000 011000                    NOP     0

     1359    13111    2           CALL CVTPTR(ADDR(NI$DVT$),NI$DVT$$) ALTRET(ERR);

  13111  2 005116   000103 236000 3                  LDQ     67
         2 005117   200155 756100                    STQ     J+10,,AUTO
         2 005120   200123 630500                    EPPR0   NI$DVT$$,,AUTO
         2 005121   200132 450500                    STP0    @OP$,,AUTO
         2 005122   200155 631500                    EPPR1   J+10,,AUTO
         2 005123   200131 451500                    STP1    @IP$,,AUTO
         2 005124   004442 701000 2                  TSX1    CVTPTR
         2 005125   005376 702000 2                  TSX2    ERR

     1360    13112    2           DCTX=FM$SET.DCTX(SETX);

  13112  2 005126   200016 235100                    LDA     SETX,,AUTO
         2 005127   000003 735000                    ALS     3
         2 005130   000000 470400 xsym               LDP0    R$CFU$
         2 005131   000000 236105                    LDQ     0,AL,PR0
         2 005132   000022 772000                    QRL     18
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:218  
         2 005133   200017 756100                    STQ     DCTX,,AUTO

     1361    13113    3           DO WHILE(DCTX~=0);

  13113  2 005134   005203 600000 2                  TZE     s:13125

     1362    13114    3              PACKSIZE=FM$VOL.NXTSDA(DCTX)-FM_SRZERO;

  13114  2 005135   200017 235100                    LDA     DCTX,,AUTO
         2 005136   000003 735000                    ALS     3
         2 005137   000000 470400 xsym               LDP0    R$CFU$
         2 005140   000003 236105                    LDQ     3,AL,PR0
         2 005141   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 005142   000002 136000 1                  SBLQ    FM_SRZERO
         2 005143   200122 756100                    STQ     PACKSIZE,,AUTO

     1363    13115    4              IF RELADDR<PACKSIZE THEN DO;

  13115  2 005144   005147 604000 2                  TMI     s:13116
         2 005145   200121 116100                    CMPQ    RELADDR,,AUTO
         2 005146   005174 604400 2                  TMOZ    s:13122

     1364    13116    4                 RELADDR=RELADDR+FM$VOL.DRZERO(DCTX);

  13116  2 005147   200121 236100                    LDQ     RELADDR,,AUTO
         2 005150   000004 036105                    ADLQ    4,AL,PR0
         2 005151   200121 756100                    STQ     RELADDR,,AUTO

     1365    13117    4                 DCTX=FM$VOL.DCTX(DCTX);

  13117  2 005152   000000 236105                    LDQ     0,AL,PR0
         2 005153   000022 772000                    QRL     18
         2 005154   200017 756100                    STQ     DCTX,,AUTO

     1366    13118    4                 CALL CVTPTR(L$N$DCT$$->PTR$(DCTX),DCT$) ALTRET(ERR);

  13118  2 005155   200062 631500                    EPPR1   DCT$,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:219  
         2 005156   200132 451500                    STP1    @OP$,,AUTO
         2 005157   000022 736000                    QLS     18
         2 005160   200066 036100                    ADLQ    L$N$DCT$$,,AUTO
         2 005161   200131 756100                    STQ     @IP$,,AUTO
         2 005162   004442 701000 2                  TSX1    CVTPTR
         2 005163   005376 702000 2                  TSX2    ERR

     1367    13119    4                 CALL CVTPTR(DCT.DVT$,DVT$) ALTRET(ERR);

  13119  2 005164   200063 630500                    EPPR0   DVT$,,AUTO
         2 005165   200132 450500                    STP0    @OP$,,AUTO
         2 005166   200062 236100                    LDQ     DCT$,,AUTO
         2 005167   000024 036003                    ADLQ    20,DU
         2 005170   200131 756100                    STQ     @IP$,,AUTO
         2 005171   004442 701000 2                  TSX1    CVTPTR
         2 005172   005376 702000 2                  TSX2    ERR

     1368    13120    4                 GOTO GOTDR;

  13120  2 005173   005204 710000 2                  TRA     GOTDR

     1369    13121    4                 END;
     1370    13122    3              RELADDR=RELADDR-PACKSIZE;

  13122  2 005174   200121 236100                    LDQ     RELADDR,,AUTO
         2 005175   200122 136100                    SBLQ    PACKSIZE,,AUTO
         2 005176   200121 756100                    STQ     RELADDR,,AUTO

     1371    13123    3              DCTX=FM$VOL.VOLL(DCTX);

  13123  2 005177   000005 236105                    LDQ     5,AL,PR0
         2 005200   000022 772000                    QRL     18
         2 005201   200017 756100                    STQ     DCTX,,AUTO

     1372    13124    3              END;

  13124  2 005202   005135 601000 2                  TNZ     s:13114
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:220  

     1373    13125    2           GOTO ERR1;

  13125  2 005203   005372 710000 2                  TRA     ERR1

     1374    13126        /**/
     1375    13127    2   GOTDR:  DCTX=DCT.DCTX;

  13127  2 005204   200062 470500       GOTDR        LDP0    DCT$,,AUTO
         2 005205   000006 236100                    LDQ     6,,PR0
         2 005206   000025 772000                    QRL     21
         2 005207   200017 756100                    STQ     DCTX,,AUTO

     1376    13128    2           RV_WDGRAN=RELADDR;

  13128  2 005210   200121 235100                    LDA     RELADDR,,AUTO
         2 005211   000000 755000 xsym               STA     RV_WDGRAN

     1377    13129    2           RV_NSPG=DVT.GRANSIZE;

  13129  2 005212   200063 471500                    LDP1    DVT$,,AUTO
         2 005213   100053 236100                    LDQ     43,,PR1
         2 005214   000777 376007                    ANQ     511,DL
         2 005215   000000 756000 xsym               STQ     RV_NSPG

     1378    13130    2   GETADR: IOADR.DEV=DCT.DVN;

  13130  2 005216   200062 470500       GETADR       LDP0    DCT$,,AUTO
         2 005217   000007 236100                    LDQ     7,,PR0
         2 005220   000003 772000                    QRL     3
         2 005221   000000 676000 xsym               ERQ     RV_DCTX
         2 005222   000770 376003                    ANQ     504,DU
         2 005223   000000 656000 xsym               ERSQ    RV_DCTX

     1379    13131    2           SQH$=DCT.SQH$;

  13131  2 005224   000022 236100                    LDQ     18,,PR0
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:221  
         2 005225   200064 756100                    STQ     SQH$,,AUTO

     1380    13132    2           CALL CVTPTR(SQH$,SQH$) ALTRET(ERR);

  13132  2 005226   200064 631500                    EPPR1   SQH$,,AUTO
         2 005227   200132 451500                    STP1    @OP$,,AUTO
         2 005230   200064 633500                    EPPR3   SQH$,,AUTO
         2 005231   200131 453500                    STP3    @IP$,,AUTO
         2 005232   004442 701000 2                  TSX1    CVTPTR
         2 005233   005376 702000 2                  TSX2    ERR

     1381    13133    2           CALL CVTPTR(SQH.CQ$,DQH$) ALTRET(ERR);

  13133  2 005234   200065 630500                    EPPR0   DQH$,,AUTO
         2 005235   200132 450500                    STP0    @OP$,,AUTO
         2 005236   200064 236100                    LDQ     SQH$,,AUTO
         2 005237   000004 036003                    ADLQ    4,DU
         2 005240   200131 756100                    STQ     @IP$,,AUTO
         2 005241   004442 701000 2                  TSX1    CVTPTR
         2 005242   005376 702000 2                  TSX2    ERR

     1382    13134    2           IOADR.IOM=DQH.IOCHAN.IOM;

  13134  2 005243   200065 470500                    LDP0    DQH$,,AUTO
         2 005244   000001 236100                    LDQ     1,,PR0
         2 005245   000006 772000                    QRL     6
         2 005246   000000 676000 xsym               ERQ     RV_DCTX
         2 005247   000006 376003                    ANQ     6,DU
         2 005250   000000 656000 xsym               ERSQ    RV_DCTX

     1383    13135    2           IOADR.CHAN=DQH.IOCHAN.CHANNEL;

  13135  2 005251   000001 236100                    LDQ     1,,PR0
         2 005252   000177 376003                    ANQ     127,DU
         2 005253   000011 736000                    QLS     9
         2 005254   000000 552040 xsym               STBQ    RV_DCTX,'40'O

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:222  
     1384    13136    3           IF DCT.DP.MIRROR.FLAG THEN DO;

  13136  2 005255   200062 471500                    LDP1    DCT$,,AUTO
         2 005256   100036 234100                    SZN     30,,PR1
         2 005257   005336 605000 2                  TPL     s:13148

     1385    13137    3              MIR_FLAG = '1'B;

  13137  2 005260   400000 236003                    LDQ     -131072,DU
         2 005261   000001 756000 0                  STQ     MIR_FLAG

     1386    13138    3              MIR_DCTX = DCT.DP.MIRROR.DCTX;

  13138  2 005262   100037 236100                    LDQ     31,,PR1
         2 005263   000022 772000                    QRL     18
         2 005264   200071 756100                    STQ     MIR_DCTX,,AUTO

     1387    13139    3              CALL CVTPTR(L$N$DCT$$->PTR$(MIR_DCTX),MIR_DCT$) ALTRET(ERR);

  13139  2 005265   200067 633500                    EPPR3   MIR_DCT$,,AUTO
         2 005266   200132 453500                    STP3    @OP$,,AUTO
         2 005267   000022 736000                    QLS     18
         2 005270   200066 036100                    ADLQ    L$N$DCT$$,,AUTO
         2 005271   200131 756100                    STQ     @IP$,,AUTO
         2 005272   004442 701000 2                  TSX1    CVTPTR
         2 005273   005376 702000 2                  TSX2    ERR

     1388    13140    3              CALL CVTPTR(MIR_DCT$->DCT.SQH$,MIR_SQH$) ALTRET(ERR);

  13140  2 005274   200125 630500                    EPPR0   MIR_SQH$,,AUTO
         2 005275   200132 450500                    STP0    @OP$,,AUTO
         2 005276   200067 236100                    LDQ     MIR_DCT$,,AUTO
         2 005277   000022 036003                    ADLQ    18,DU
         2 005300   200131 756100                    STQ     @IP$,,AUTO
         2 005301   004442 701000 2                  TSX1    CVTPTR
         2 005302   005376 702000 2                  TSX2    ERR

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:223  
     1389    13141    3              CALL CVTPTR(MIR_SQH$->SQH.CQ$,MIR_DQH$) ALTRET(ERR);

  13141  2 005303   200126 630500                    EPPR0   MIR_DQH$,,AUTO
         2 005304   200132 450500                    STP0    @OP$,,AUTO
         2 005305   200125 236100                    LDQ     MIR_SQH$,,AUTO
         2 005306   000004 036003                    ADLQ    4,DU
         2 005307   200131 756100                    STQ     @IP$,,AUTO
         2 005310   004442 701000 2                  TSX1    CVTPTR
         2 005311   005376 702000 2                  TSX2    ERR

     1390    13142    3              MIR_IOADR.DEV = MIR_DCT$->DCT.DVN;

  13142  2 005312   200067 470500                    LDP0    MIR_DCT$,,AUTO
         2 005313   000007 236100                    LDQ     7,,PR0
         2 005314   000003 772000                    QRL     3
         2 005315   000000 676000 0                  ERQ     RV_MIRDCTX
         2 005316   000770 376003                    ANQ     504,DU
         2 005317   000000 656000 0                  ERSQ    RV_MIRDCTX

     1391    13143    3              MIR_IOADR.IOM = MIR_DQH$->DQH.IOCHAN.IOM;

  13143  2 005320   200126 471500                    LDP1    MIR_DQH$,,AUTO
         2 005321   100001 236100                    LDQ     1,,PR1
         2 005322   000006 772000                    QRL     6
         2 005323   000000 676000 0                  ERQ     RV_MIRDCTX
         2 005324   000006 376003                    ANQ     6,DU
         2 005325   000000 656000 0                  ERSQ    RV_MIRDCTX

     1392    13144    3              MIR_IOADR.CHAN = MIR_DQH$->DQH.IOCHAN.CHANNEL;

  13144  2 005326   100001 236100                    LDQ     1,,PR1
         2 005327   000177 376003                    ANQ     127,DU
         2 005330   000011 736000                    QLS     9
         2 005331   000000 552040 0                  STBQ    RV_MIRDCTX,'40'O

     1393    13145    3              MSG_IOERR.TYPE = ' MIRRORED ' ;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:224  
  13145  2 005332   040000 100400                    MLR     fill='040'O
         2 005333   000250 000012 1                  ADSC9   SEGTAB+30                cn=0,n=10
         2 005334   000001 000014 xsym               ADSC9   MSG_IOERR+1              cn=0,n=12

     1394    13146    3              END;

  13146  2 005335   005344 710000 2                  TRA     s:13153

     1395    13147    3           ELSE DO;

     1396    13148    3              MIR_FLAG = '0'B;

  13148  2 005336   000001 450000 0                  STZ     MIR_FLAG

     1397    13149    3              RV_MIRDCTX = 0;

  13149  2 005337   000000 450000 0                  STZ     RV_MIRDCTX

     1398    13150    3              MIR_DCTX = 0;

  13150  2 005340   200071 450100                    STZ     MIR_DCTX,,AUTO

     1399    13151    3              MSG_IOERR.TYPE = ' UNMIRRORED ' ;

  13151  2 005341   040000 100400                    MLR     fill='040'O
         2 005342   000253 000014 1                  ADSC9   SEGTAB+33                cn=0,n=12
         2 005343   000001 000014 xsym               ADSC9   MSG_IOERR+1              cn=0,n=12

     1400    13152    3              END;

     1401    13153    2           RETURN;

  13153  2 005344   200112 221300                    LDX1  ! @CODE+1,,AUTO
         2 005345   000001 702211                    TSX2  ! 1,X1

     1402    13154        /**/
     1403    13155    2   DCTCNVRT: ENTRY ALTRET;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:225  

  13155  2 005346   200112 741300       DCTCNVRT     STX1  ! @CODE+1,,AUTO

     1404    13156        /**/
     1405    13157    2           CALL CVTPTR(ADDR(N$DCT$$),L$N$DCT$$) ALTRET(ERR);

  13157  2 005347   000102 236000 3                  LDQ     66
         2 005350   200156 756100                    STQ     J+11,,AUTO
         2 005351   200066 630500                    EPPR0   L$N$DCT$$,,AUTO
         2 005352   200132 450500                    STP0    @OP$,,AUTO
         2 005353   200156 631500                    EPPR1   J+11,,AUTO
         2 005354   200131 451500                    STP1    @IP$,,AUTO
         2 005355   004442 701000 2                  TSX1    CVTPTR
         2 005356   005376 702000 2                  TSX2    ERR

     1406    13158    2           DCT$=L$N$DCT$$->PTR$(DCTX);

  13158  2 005357   200066 470500                    LDP0    L$N$DCT$$,,AUTO
         2 005360   200017 720100                    LXL0    DCTX,,AUTO
         2 005361   000000 236110                    LDQ     0,X0,PR0
         2 005362   200062 756100                    STQ     DCT$,,AUTO

     1407    13159    2           CALL CVTPTR(DCT$,DCT$) ALTRET(ERR);

  13159  2 005363   200062 631500                    EPPR1   DCT$,,AUTO
         2 005364   200132 451500                    STP1    @OP$,,AUTO
         2 005365   200062 633500                    EPPR3   DCT$,,AUTO
         2 005366   200131 453500                    STP3    @IP$,,AUTO
         2 005367   004442 701000 2                  TSX1    CVTPTR
         2 005370   005376 702000 2                  TSX2    ERR

     1408    13160    2           GOTO GETADR;

  13160  2 005371   005216 710000 2                  TRA     GETADR

     1409    13161        /**/
     1410    13162        /**/
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:226  
     1411    13163    2   ERR1:   ERRCODE=1;

  13163  2 005372   000001 235007       ERR1         LDA     1,DL
         2 005373   200032 755100                    STA     ERRCODE,,AUTO

     1412    13164    2           CALL ERROR;

  13164  2 005374   005436 701000 2                  TSX1    ERROR
         2 005375   000000 011000                    NOP     0

     1413    13165    2   ERR:    ALTRETURN;

  13165  2 005376   200112 221300       ERR          LDX1  ! @CODE+1,,AUTO
         2 005377   000000 702211                    TSX2  ! 0,X1

     1414    13166    2   END DISKCNVRT;
     1415    13167        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:227  
     1416    13168    1   LOCCOD: PROC(CODE) ALTRET;

  13168  2 005400   200110 741300       LOCCOD       STX1  ! K,,AUTO

     1417    13169        /* PARAMETERS */
     1418    13170    2   DCL CODE UBIN;
     1419    13171        /* LOCAL AUTOMATIC STORAGE */
     1420    13172    2   DCL N UBIN;
     1421    13173    2   DCL I UBIN;
     1422    13174        /**/
     1423    13175    2           N=FM$FIT.CODES.CODE(0);

  13175  2 005401   200041 470500                    LDP0    FIT$,,AUTO
         2 005402   000000 236100                    LDQ     0,,PR0
         2 005403   000037 772000                    QRL     31
         2 005404   200112 756100                    STQ     N,,AUTO

     1424    13176    3           DO I=1 TO N;

  13176  2 005405   000001 235007                    LDA     1,DL
         2 005406   200113 755100                    STA     I,,AUTO
         2 005407   005431 710000 2                  TRA     s:13181+3

     1425    13177    4              IF FM$FIT.CODES.CODE(I)=CODE THEN DO;

  13177  2 005410   200111 470500                    LDP0    @CODE,,AUTO
         2 005411   200041 471500                    LDP1    FIT$,,AUTO
         2 005412   200113 720100                    LXL0    I,,AUTO
         2 005413   100000 236110                    LDQ     0,X0,PR1
         2 005414   000037 772000                    QRL     31
         2 005415   000000 116100                    CMPQ    0,,PR0
         2 005416   005426 601000 2                  TNZ     s:13181

     1426    13178    4                 COD$=PINCRW(FIT$,FM$FIT.CODES.ITEMX(I));

  13178  2 005417   100000 721110                    LXL1    0,X0,PR1
         2 005420   001777 361003                    ANX1    1023,DU
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:228  
         2 005421   000000 636011                    EAQ     0,X1
         2 005422   200041 036100                    ADLQ    FIT$,,AUTO
         2 005423   200043 756100                    STQ     COD$,,AUTO

     1427    13179    4                 RETURN;

  13179  2 005424   200110 221300                    LDX1  ! K,,AUTO
         2 005425   000001 702211                    TSX2  ! 1,X1

     1428    13180    4                 END;
     1429    13181    3              END;

  13181  2 005426   200113 235100                    LDA     I,,AUTO
         2 005427   000001 035007                    ADLA    1,DL
         2 005430   200113 755100                    STA     I,,AUTO
         2 005431   200112 236100                    LDQ     N,,AUTO
         2 005432   200113 116100                    CMPQ    I,,AUTO
         2 005433   005410 603000 2                  TRC     s:13177

     1430    13182    2           ALTRETURN;

  13182  2 005434   200110 221300                    LDX1  ! K,,AUTO
         2 005435   000000 702211                    TSX2  ! 0,X1

     1431    13183    2   END LOCCOD;
     1432    13184        %EJECT;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:229  
     1433    13185    1   ERROR:  PROC;

  13185  2 005436   200134 741300       ERROR        STX1  ! I+1,,AUTO

     1434    13186        /* LOCAL AUTOMATIC STORAGE */
     1435    13187    2   DCL I UBIN;
     1436    13188        /*
     1437    13189        ERROR CODES:
     1438    13190                1  - Bad DA
     1439    13191                2  - I/O error
     1440    13192                3  - ORG wrong
     1441    13193                4  - LVL wrong
     1442    13194                5  - Granule stamp wrong
     1443    13195                13 - No code 1 in FIT
     1444    13196                14 - Extent entry wrong size
     1445    13197                15 - CODE01.STAMP wrong
     1446    13198                19 - Name hash wrong
     1447    13199                20 - Missing FIT code
     1448    13200                30 - Convert pointer error
     1449    13201                31 - DCB is streamed to itsself
     1450    13202                40 - CG CFU$ not correct
     1451    13203                41 - SELF$ pointer in granule header is wrong
     1452    13204                42 - CG recovery area not big enough
     1453    13205                43 - CG CTL granule header bad
     1454    13206                44 - CG CTL granule doesn't contain a context block
     1455    13207                45 - Granule stamp hash is wrong
     1456    13208                50 - Shared data segment page chain bad
     1457    13209        */
     1458    13210        /**/
     1459    13211        /**/
     1460    13212    2           RVF_ERRCNT=RVF_ERRCNT+1;

  13212  2 005437   000000 054000 xsym               AOS     RVF_ERRCNT

     1461    13213    2           IF RVF_ERRCNT>15 THEN

  13213  2 005440   000000 235000 xsym               LDA     RVF_ERRCNT
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:230  
         2 005441   000017 115007                    CMPA    15,DL
         2 005442   005444 604400 2                  TMOZ    s:13215

     1462    13214    2              RETURN;                      /* Only print first 15                */

  13214  2 005443   000001 702211                    TSX2  ! 1,X1

     1463    13215    3           DO I=0 TO 4;

  13215  2 005444   200135 450100                    STZ     I,,AUTO

     1464    13216    3              RVF_ERRMSG.DCBA(I)=BINASC(DCBR.ADR(I)+48);

  13216  2 005445   200135 236100                    LDQ     I,,AUTO
         2 005446   000003 402007                    MPY     3,DL
         2 005447   003100 061506                    CSR     bolr='003'O
         2 005450   200010 030003                    BDSC    DCB$,Q,AUTO              by=0,bit=3,n=3
         2 005451   200144 000044                    BDSC    J+1,,AUTO                by=0,bit=0,n=36
         2 005452   200144 236100                    LDQ     J+1,,AUTO
         2 005453   000060 036007                    ADLQ    48,DL
         2 005454   000033 736000                    QLS     27
         2 005455   000104 276000 3                  ORQ     68
         2 005456   200145 756100                    STQ     J+2,,AUTO
         2 005457   200135 235100                    LDA     I,,AUTO
         2 005460   040005 100500                    MLR     fill='040'O
         2 005461   200145 000004                    ADSC9   J+2,,AUTO                cn=0,n=4
         2 005462   000006 600001 xsym               ADSC9   RVF_ERRMSG+6,A           cn=3,n=1

     1465    13217    3              RVF_ERRMSG.CFU(I)=BINASC(CFU.ADR(I)+48);

  13217  2 005463   200135 236100                    LDQ     I,,AUTO
         2 005464   000003 402007                    MPY     3,DL
         2 005465   003100 061506                    CSR     bolr='003'O
         2 005466   200012 030003                    BDSC    CFU$,Q,AUTO              by=0,bit=3,n=3
         2 005467   200144 000044                    BDSC    J+1,,AUTO                by=0,bit=0,n=36
         2 005470   200144 236100                    LDQ     J+1,,AUTO
         2 005471   000060 036007                    ADLQ    48,DL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:231  
         2 005472   000033 736000                    QLS     27
         2 005473   000104 276000 3                  ORQ     68
         2 005474   200145 756100                    STQ     J+2,,AUTO
         2 005475   200135 235100                    LDA     I,,AUTO
         2 005476   040005 100500                    MLR     fill='040'O
         2 005477   200145 000004                    ADSC9   J+2,,AUTO                cn=0,n=4
         2 005500   000011 200001 xsym               ADSC9   RVF_ERRMSG+9,A           cn=1,n=1

     1466    13218    3              END;

  13218  2 005501   000001 035007                    ADLA    1,DL
         2 005502   200135 755100                    STA     I,,AUTO
         2 005503   000005 115007                    CMPA    5,DL
         2 005504   005445 602000 2                  TNC     s:13216

     1467    13219    2           CALL BINCHAR(RVF_ERRMSG.PH,PHASE);

  13219  2 005505   200034 236100                    LDQ     PHASE,,AUTO
         2 005506   000000 235003                    LDA     0,DU
         2 005507   200144 757100                    STAQ    J+1,,AUTO
         2 005510   000000 301500                    BTD
         2 005511   200144 000010                    NDSC9   J+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
         2 005512   000013 630001 xsym               NDSC9   RVF_ERRMSG+11            cn=3,s=nosgn,sf=0,n=1

     1468    13220    2           CALL BINCHAR(RVF_ERRMSG.OP,OP);

  13220  2 005513   200033 236100                    LDQ     OP,,AUTO
         2 005514   000000 235003                    LDA     0,DU
         2 005515   200144 757100                    STAQ    J+1,,AUTO
         2 005516   000000 301500                    BTD
         2 005517   200144 000010                    NDSC9   J+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
         2 005520   000014 230002 xsym               NDSC9   RVF_ERRMSG+12            cn=1,s=nosgn,sf=0,n=2

     1469    13221    2           CALL BINCHAR(RVF_ERRMSG.ERR,ERRCODE);

  13221  2 005521   200032 236100                    LDQ     ERRCODE,,AUTO
         2 005522   000000 235003                    LDA     0,DU
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:232  
         2 005523   200144 757100                    STAQ    J+1,,AUTO
         2 005524   000000 301500                    BTD
         2 005525   200144 000010                    NDSC9   J+1,,AUTO                cn=0,s=lsgnf,sf=0,n=8
         2 005526   000015 030002 xsym               NDSC9   RVF_ERRMSG+13            cn=0,s=nosgn,sf=0,n=2

     1470    13222    2           CALL PUTNAME(RVF_ERRMSG,RVF_ERRMSG.FID,SIZEC(RVF_ERRMSG.FID));

  13222  2 005527   000106 237000 3                  LDAQ    70
         2 005530   200140 757100                    STAQ    @FID,,AUTO
         2 005531   000105 236000 3                  LDQ     69
         2 005532   200137 756100                    STQ     @MSG,,AUTO
         2 005533   004236 701000 2                  TSX1    PUTNAME
         2 005534   000000 011000                    NOP     0

     1471    13223    3           IF MISC1~=0 OR MISC2~=0 THEN DO;

  13223  2 005535   200045 235100                    LDA     MISC1,,AUTO
         2 005536   005541 601000 2                  TNZ     s:13224
         2 005537   200046 236100                    LDQ     MISC2,,AUTO
         2 005540   005610 600000 2                  TZE     s:13231

     1472    13224    4              DO I=0 TO 11;

  13224  2 005541   200135 450100                    STZ     I,,AUTO

     1473    13225    4                 RVF_MISCMSG.M1(I)=BINASC(MSC1(I)+48);

  13225  2 005542   200135 236100                    LDQ     I,,AUTO
         2 005543   000003 402007                    MPY     3,DL
         2 005544   003100 061506                    CSR     bolr='003'O
         2 005545   200045 000003                    BDSC    MISC1,Q,AUTO             by=0,bit=0,n=3
         2 005546   200144 000044                    BDSC    J+1,,AUTO                by=0,bit=0,n=36
         2 005547   200144 236100                    LDQ     J+1,,AUTO
         2 005550   000060 036007                    ADLQ    48,DL
         2 005551   000033 736000                    QLS     27
         2 005552   000104 276000 3                  ORQ     68
         2 005553   200145 756100                    STQ     J+2,,AUTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:233  
         2 005554   200135 235100                    LDA     I,,AUTO
         2 005555   040005 100500                    MLR     fill='040'O
         2 005556   200145 000004                    ADSC9   J+2,,AUTO                cn=0,n=4
         2 005557   000001 000001 xsym               ADSC9   RVF_MISCMSG+1,A          cn=0,n=1

     1474    13226    4                 RVF_MISCMSG.M2(I)=BINASC(MSC2(I)+48);

  13226  2 005560   200135 236100                    LDQ     I,,AUTO
         2 005561   000003 402007                    MPY     3,DL
         2 005562   003100 061506                    CSR     bolr='003'O
         2 005563   200046 000003                    BDSC    MISC2,Q,AUTO             by=0,bit=0,n=3
         2 005564   200144 000044                    BDSC    J+1,,AUTO                by=0,bit=0,n=36
         2 005565   200144 236100                    LDQ     J+1,,AUTO
         2 005566   000060 036007                    ADLQ    48,DL
         2 005567   000033 736000                    QLS     27
         2 005570   000104 276000 3                  ORQ     68
         2 005571   200145 756100                    STQ     J+2,,AUTO
         2 005572   200135 235100                    LDA     I,,AUTO
         2 005573   040005 100500                    MLR     fill='040'O
         2 005574   200145 000004                    ADSC9   J+2,,AUTO                cn=0,n=4
         2 005575   000005 000001 xsym               ADSC9   RVF_MISCMSG+5,A          cn=0,n=1

     1475    13227    4                 END;

  13227  2 005576   000001 035007                    ADLA    1,DL
         2 005577   200135 755100                    STA     I,,AUTO
         2 005600   000014 115007                    CMPA    12,DL
         2 005601   005542 602000 2                  TNC     s:13225

     1476    13228    3              CALL IRR$TYPE6(RVF_MISCMSG,SIZEW(RVF_MISCMSG));

  13228  2 005602   000110 630400 3                  EPPR0   72
         2 005603   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005604   000000 701000 xent               TSX1    IRR$TYPE6
         2 005605   000000 011000                    NOP     0

     1477    13229    3              MISC1=0; MISC2=0;
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:234  

  13229  2 005606   200045 450100                    STZ     MISC1,,AUTO

  13229  2 005607   200046 450100                    STZ     MISC2,,AUTO

     1478    13230    3              END;

     1479    13231    2           RETURN;

  13231  2 005610   200134 221300                    LDX1  ! I+1,,AUTO
         2 005611   000001 702211                    TSX2  ! 1,X1
     1480    13232    2   END ERROR;
     1481    13233        /**/
     1482    13234    1   END IRF$CLSF;

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:235  
--  Include file information  --

   UE_CP6.:E05TOU  is referenced.
   IR_DATA_M.:E05TOU  is referenced.
   IRF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   HF_DATA_R.:E05TOU  is referenced.
   KQM_MAC_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   FT_SUBS.:E05TOU  is referenced.
   FT$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FS$FIT.:E05TOU  is referenced.
   FM_FIELD_C.:E05TOU  is referenced.
   FM_CACHE_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure IRF$CLSF.
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:236  

 **** Variables and constants ****

  ****  Section 000  Data  IRF$CLSF

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/b BIT         r     1 MIR_FLAG                   0-0-0/w STRC        r     1 MIR_IOADR
     0-0-0/w UBIN        r     1 RV_MIRDCTX

  ****  Section 001 RoData IRF$CLSF

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   200-0-0/c CHAR(18)    r     1 ANSPAD                     1-0-0/w UBIN        r     1 FM_FRMAX
     0-0-0/w UBIN        r     1 FM_FRZERO                  4-0-0/w UBIN        r     1 FM_GPSDA
     5-0-0/b BIT         r     1 FM_GPSTAMP                 2-0-0/w UBIN        r     1 FM_SRZERO
   205-0-0/w CHAR(20)    r     1 NULPAD                     6-0-0/w PTR         r     1 POBUF$
     7-0-0/w UBIN        r     1 RVF_DEBUG                212-0-0/w STRC(72)    r     1 SEGTAB(0:10)
   205-0-0/w UBIN        r     1 ZEROBITS(0:4)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   104-0-0/w PTR         r     1 @ASNUM                   111-0-0/w PTR         r     1 @CODE
   140-0-0/w PTR         r     1 @FID                     141-0-0/w PTR         r     1 @FIDSIZ
   131-0-0/w PTR         r     1 @IP$                     103-0-0/w PTR         r     1 @KQ$DSB
   137-0-0/w PTR         r     1 @MSG                     132-0-0/w PTR         r     1 @OP$
   105-0-0/w PTR         r     1 @PGNUM                   107-0-0/w PTR         r     1 @PPNO
   106-0-0/w PTR         r     1 @PTR$                     27-0-0/c CHAR(8)     r     1 ACCT
    22-0-0/w PTR         r     1 ACCT$                     21-0-0/w UBIN        r     1 ACCTX
    42-0-0/w PTR         r     1 ALTKEY$                   31-0-0/w UBIN        r     1 ASN
    *0-0-0/w UBIN        r     1 ASNUM                      7-0-0/w PTR         r     1 B$JIT$
    15-0-0/w PTR         r     1 CACHE$                    12-0-0/w STRC        r     1 CFU
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:237  
    12-0-0/w PTR         r     1 CFU$                      20-0-0/w UBIN        r     1 CFUX
    75-0-0/w CHAR(32)    r     1 CNAME                     43-0-0/w PTR         r     1 COD$
    *0-0-0/w UBIN        r     1 CODE                      14-0-0/b STRC        r     1 CTX
    14-0-0/w PTR         r     1 CTX$                       3-0-0/w UBIN        r     1 DA
    10-0-0/w PTR         r     1 DCB$                      11-0-0/w PTR         r     1 DCBPTR$
    10-0-0/w STRC        r     1 DCBR                      62-0-0/w PTR         r     1 DCT$
    17-0-0/w UBIN        r     1 DCTX                      75-0-0/w UBIN        r     1 DESC#
    65-0-0/w PTR         r     1 DQH$                      13-0-0/w PTR         r     1 DSB$
    40-0-0/w UBIN        r     1 DUMPFLG                   63-0-0/w PTR         r     1 DVT$
   101-0-0/w UBIN        r     1 ENTFLG                   106-0-0/w UBIN        r     1 ENTFLG
    32-0-0/w UBIN        r     1 ERRCODE                   *0-0-0/c CHAR(12)    r     1 FID
    *0-0-0/w UBIN        r     1 FIDSIZ                    41-0-0/w PTR         r     1 FIT$
    73-0-0/w UBIN(9)     r     1 GMOD                     111-0-0/w UBIN(9)     r     1 GMOD
    74-0-0/w UBIN        r     1 HASH                       4-0-0/w UBIN        r     1 I
    74-0-0/w UBIN        r     1 I                         74-0-0/w SBIN        r     1 I
   142-0-0/w UBIN        r     1 I                        133-0-0/w UBIN        r     1 I
   116-0-0/w UBIN        r     1 I                        113-0-0/w UBIN        r     1 I
   135-0-0/w UBIN        r     1 I                         *0-0-0/w STRC        r     1 IP$
     5-0-0/w UBIN        r     1 J                        143-0-0/w UBIN        r     1 J
   110-0-0/w UBIN        r     1 K                         *0-0-0/d STRC(1944)  r     1 KQ$DSB
    66-0-0/w PTR         r     1 L$N$DCT$$                 67-0-0/w PTR         r     1 MIR_DCT$
    71-0-0/w UBIN        r     1 MIR_DCTX                 126-0-0/w PTR         r     1 MIR_DQH$
    70-0-0/w BIT         r     1 MIR_ERR                  125-0-0/w PTR         r     1 MIR_SQH$
    45-0-0/w UBIN        r     1 MISC1                     45-0-0/w PTR         r     1 MISC1$
    45-0-0/w BIT         r     1 MISC1B                    46-0-0/w UBIN        r     1 MISC2
    46-0-0/w PTR         r     1 MISC2$                    45-0-0/w UBIN(3)     r     1 MSC1(0:11)
    46-0-0/w UBIN(3)     r     1 MSC2(0:11)                *0-0-0/c CHAR(112)   r     1 MSG
    50-0-0/w SBIN        r     1 N                        112-0-0/w UBIN        r     1 N
    23-0-0/w PTR         r     1 NAME$                     24-0-0/w UBIN        r     1 NAMEX
   117-0-0/w SBIN        r     1 NGRAN                    123-0-0/w PTR         r     1 NI$DVT$$
     6-0-0/w UBIN        r     1 NUMDCBS                   47-0-0/w PTR         r     1 OLDCTX$
    33-0-0/w UBIN        r     1 OP                        *0-0-0/w STRC        r     1 OP$
    75-0-0/w STRC(288)   r     1 P2                       122-0-0/w UBIN        r     1 PACKSIZE
    73-0-0/w UBIN        r     1 PAGE#                     77-0-0/w PTR         r     1 PG$
    76-0-0/w UBIN        r     1 PGINDX                    *0-0-0/w UBIN        r     1 PGNUM
    51-0-0/b BIT         r     1 PGTBL(0:299)              34-0-0/w UBIN        r     1 PHASE
    *0-0-0/w UBIN        r     1 PPNO                      *0-0-0/w PTR         r     1 PTR$
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:238  
    *0-0-0/w STRC        r     1 PTR$R                    121-0-0/w SBIN        r     1 RELADDR
    36-0-0/d REMB        r     1 REMUNWIND                100-0-0/w UBIN        r     1 RP
   105-0-0/b BIT         r     1 RSLT                      16-0-0/w UBIN        r     1 SETX
    73-0-0/w UBIN        r     1 SIZ                      120-0-0/w UBIN        r     1 SIZ
     5-0-0/w SBIN        r     1 SJ                        25-0-0/c CHAR(6)     r     1 SN
    64-0-0/w PTR         r     1 SQH$                     113-0-0/w SBIN        r     1 SRDA
    73-0-0/b STRC        r     1 STAMP                     44-0-0/w UBIN        r     1 SYSSETX
    73-0-0/w PTR         r     1 T$                        74-0-0/w PTR         r     1 T$
   114-0-0/w UBIN        r     1 XTX                      115-0-0/w PTR         r     1 XTX$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$CGPT$                    0-0-0/w PTR         r     1 B$IPHYMAP$
     0-0-0/w PTR         r     1 B$ROSEG$                   0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FMC_CACHE$                 0-0-0/w UBIN        r     1 FM_SYSSETX
     0-0-0/w PTR         r     1 I$JITU$                    0-0-0/w PTR         r     1 I$MEM$
     0-0-0/w PTR         r     1 I$MONIS$                   0-0-0/w PTR         r     1 I$PPUT$
     0-0-0/w PTR         r     1 I$REAL$                    0-0-0/w PTR         r     1 I$RV1$
     0-0-0/w STRC        r     1 IOADR                      0-0-0/w PTR         r     1 KQ_MMSD$
     0-0-0/w STRC(72)    r     1 MEMDESC                    0-0-0/c STRC(396)   r     1 MSG_IOERR
     0-0-0/c STRC(252)   r     1 MSG_PART                   0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 NI$DVT$                    0-0-0/w UBIN        r     1 POBUF
     0-0-0/w PTR         r     1 R$BUFF$                    0-0-0/w PTR         r     1 R$CFU$
     0-0-0/w PTR         r     1 R$CGCTXT$                  0-0-0/w PTR         r     1 R$CGPT$
     0-0-0/w PTR         r     1 R$DVT$                     0-0-0/w PTR         r     1 R$ROSEG$
     0-0-0/c STRC(684)   r     1 RVF_CGTRAP                 0-0-0/c STRC(630)   r     1 RVF_CLSBFR
     0-0-0/c STRC(612)   r     1 RVF_CLSCFU                 0-0-0/c STRC(612)   r     1 RVF_CLSDCB
     0-0-0/c STRC(360)   r     1 RVF_CLSFD                  0-0-0/c STRC(360)   r     1 RVF_CLSUSR
     0-0-0/c STRC(720)   r     1 RVF_DUMPCG                 0-0-0/w SBIN        r     1 RVF_ERRCNT
     0-0-0/c STRC(972)   r     1 RVF_ERRMSG                 0-0-0/c STRC(288)   r     1 RVF_MISCMSG
     0-0-0/c STRC(612)   r     1 RVF_RELFILE                0-0-0/c STRC(288)   r     1 RVF_RELGRAN
     0-0-0/c STRC(684)   r     1 RVF_WRDSMSG                0-0-0/d STRC(36864) r     1 RV_BUFF
     0-0-0/w UBIN        r     1 RV_CUN                     0-0-0/w UBIN        r     1 RV_DCTX
     0-0-0/w UBIN        r     1 RV_NSPG                    0-0-0/w UBIN        r     1 RV_NXTGRAN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:239  
     0-0-0/d REMB        r     1 RV_UNWIND1                 0-0-0/w UBIN        r     1 RV_WDGRAN
     0-0-0/w BIT         r     1 S1000_FLG

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(4572)  r     1 ALTKEYS                    0-0-0/w STRC(2448)  r     1 B$EXCFR
     0-0-0/h UBIN(18)    r     1 B$HALF(0:0)                0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC        r     1 B$MAP(0:1023)              0-0-0/d STRC(3024)  r     1 B$ROSEG
     0-0-0/w STRC(576)   r     1 CODE01                     0-0-0/w STRC(135)   r     1 CODE02
     0-0-0/w STRC(324)   r     1 CODE03                     0-0-0/w STRC(396)   r     1 CODE04
     0-0-0/w STRC(288)   r     1 CODE14                     0-0-0/w STRC(1404)  r     1 CODE16
     0-0-0/w STRC(180)   r     1 CODE20                     0-0-0/w STRC(1332)  r     1 DCT
     0-0-0/w STRC(648)   r     1 DQH                        0-0-0/w STRC(2844)  r     1 DVT
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(288)   r     1 FM$CFU
     0-0-0/w STRC(288)   r     1 FM$CFUA                    0-0-0/w STRC(288)   r     1 FM$CFUEXT
     0-0-0/w STRC(288)   r     1 FM$CFUF                    0-0-0/w STRC(288)   r     1 FM$CFUJ
     0-0-0/c ASTR(27)    r     1 FM$CFUN                    0-0-0/w STRC(288)   r     1 FM$CFUR
     0-0-0/w STRC(288)   r     1 FM$CFUX                    0-0-0/w STRC(1116)  r     1 FM$FIT
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/w STRC(288)   r     1 FM$SET(0:0)
     0-0-0/w STRC(288)   r     1 FM$VOL(0:0)
     0-0-0/w STRC(216)   r     1 FMC$CACHETBL(0:0)
     0-0-0/w STRC(936)   r     1 FS$DEST                    0-0-0/w STRC(72)    r     1 HSH
     0-0-0/w STRC(51)    r     1 HSH1                       0-0-0/w STRC(360)   r     1 IRKEYS
     0-0-0/d STRC(6516)  r     1 KQ$CG                      0-0-0/d STRC(900)   r     1 KQ$CTLGRAN
     0-0-0/d STRC(1944)  r     1 KQ$DSB                     0-0-0/w STRC(144)   r     1 KQ$GRAN
     0-0-0/d STRC(288)   r     1 KQ$MMSD
     0-0-0/w STRC        r     1 MM$PPUT(0:0)
     0-0-0/c ACHR        r     1 NCHARS                     0-0-0/w STRC        r     1 P
     0-0-0/w UBIN        r     1 PG(0:1023)                 0-0-0/c ACHR        r     1 PNAME
     0-0-0/w PTR         r     1 PTR$(0:0)                  0-0-0/w STRC(36864) r     1 RELBUF
     0-0-0/w STRC(252)   r     1 SQH

PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:240  

   Procedure IRF$CLSF requires 2954 words for executable code.
   Procedure IRF$CLSF requires 112 words of local(AUTO) storage.

    No errors detected in file IRF$CLSF.:E05TSI    .
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:241  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:242  
          MINI XREF LISTING

ACCT
        43**DCL     11716<<ASSIGN  11737<<ASSIGN  11755<<ASSIGN  11760<<ASSIGN  11767<<ASSIGN  11899<<ASSIGN
     11924<<ASSIGN  11934<<ASSIGN  11939<<ASSIGN  11989<<ASSIGN  12000<<ASSIGN  12036<<ASSIGN  12068<<ASSIGN
     12083<<ASSIGN  12089<<ASSIGN  12677>>IF      12897>>IF      12898>>CALLBLT
ACCT$
        39**DCL     10673--IMP-PTR 11754<<ASSIGN  11759<<ASSIGN  11766<<ASSIGN  11767>>ASSIGN  11925<<ASSIGN
     11933<<ASSIGN  11934>>ASSIGN  11935>>ASSIGN  11938<<ASSIGN  11986<<ASSIGN  11987>>IF      11989>>ASSIGN
     11990>>ASSIGN  11997>>ASSIGN  12069<<ASSIGN  12082<<ASSIGN  12083>>ASSIGN  12084>>ASSIGN  12087<<ASSIGN
     12798>>ASSIGN  12803>>ASSIGN  12840>>ASSIGN  12854>>IF      12856>>ASSIGN  12856>>ASSIGN  12857>>ASSIGN
ACCTX
        38**DCL     11763<<ASSIGN  11764>>IF      11765<<ASSIGN  11766>>ASSIGN  11930<<ASSIGN  11931>>IF
     11932<<ASSIGN  11933>>ASSIGN  11983<<ASSIGN  11985>>DOWHILE 11986>>ASSIGN  11997<<ASSIGN  12075<<ASSIGN
     12076>>IF      12077<<ASSIGN  12082>>ASSIGN
ADDLIST
     12848**PROC    11828--CALL    11960--CALL
ALT
     11884**LABEL   11723--CALLALT 11724--CALLALT 11731--CALLALT
ALTKEY$
        51**DCL     10732--IMP-PTR 10769--IMP-PTR 12629<<ASSIGN  12632>>ASSIGN  12633>>ASSIGN  12634>>ASSIGN
     12637>>DOINDEX 12638>>ASSIGN  12639>>ASSIGN  12640>>ASSIGN  12641>>ASSIGN  12646>>ASSIGN  12647>>ASSIGN
     12648>>ASSIGN  12651>>DOINDEX 12652>>ASSIGN  12653>>ASSIGN  12654>>ASSIGN  12655>>ASSIGN
ALTKEYS.ALTBLD
     10732**DCL     12636<<ASSIGN
ALTKEYS.K.FDA
     10733**DCL     12638<<ASSIGN  12638>>ASSIGN
ALTKEYS.K.LDA
     10733**DCL     12632>>ASSIGN  12639<<ASSIGN  12639>>ASSIGN
ALTKEYS.K.TDA
     10733**DCL     12633>>ASSIGN  12640<<ASSIGN  12640>>ASSIGN
ALTKEYS.K.TDALVL
     10733**DCL     12634>>ASSIGN  12641<<ASSIGN  12641>>ASSIGN
ALTKEYS.NUMENTS
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:243  
     10732**DCL     12637>>DOINDEX
ANSPAD
     10502**DCL     11867>>ASSIGN
ASN
        44**DCL     11719<<ASSIGN  11744<<ASSIGN  11901<<ASSIGN  11916<<ASSIGN  11947<<ASSIGN  11949<<ASSIGN
     12038<<ASSIGN  12093<<ASSIGN  12874>>IF      12879>>IF
ASNUM IN PROCEDURE FINDCGPAGE
     12436**DCL     12391--PROC    12499<<ASSIGN  12499>>ASSIGN  12502>>IF      12503>>IF      12504>>ASSIGN
     12515>>ASSIGN
B$CGPT$
     10394**DCL     12505>>ASSIGN  12506>>IF
B$EXCFR.ASL
     10565**DCL     10565--REDEF
B$EXCFR.ASR
     10571**DCL     12060>>IF      12295>>IF
B$EXCFR.ERR.ERR#
     10579**DCL     10579--REDEF
B$EXCFR.EVID
     10578**DCL     10578--REDEF   10579--REDEF
B$EXCFR.IR
     10566**DCL     10566--REDEF
B$EXCFR.PREVSZ
     10565**DCL     10565--REDEF
B$EXCFR.SUBC
     10577**DCL     10577--REDEF   10578--REDEF   10578--REDEF
B$HALF IN PROCEDURE FINDCGPAGE
     12490**DCL     12513>>ASSIGN
B$IPHYMAP$ IN PROCEDURE FINDCGPAGE
     12491**DCL     12513>>ASSIGN
B$JIT.ACCN
       407**DCL     11728>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       501**DCL       501--REDEF
B$JIT.ERR.MID
       408**DCL       408--REDEF
B$JIT.JRESPEAK
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:244  
       569**DCL       570--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       678**DCL       678--REDEF     679--REDEF
B$JIT.PNR
       582**DCL       582--REDEF
B$JIT.SYSID
       407**DCL     11727>>CALLBLT
B$JIT.TSLINE
       676**DCL       677--REDEF
B$JIT$
        17**DCL       402--IMP-PTR 11726<<ASSIGN  11727>>CALLBLT 11728>>ASSIGN
B$MAP.CTRL
       729**DCL     12506>>IF
B$MAP.RPN
       725**DCL     12505>>ASSIGN
B$MAP.SCTRL
       726**DCL       727--REDEF
B$ROSEG.DCBPTR$
     10592**DCL     11731<>CALL
B$ROSEG.NUMDCBS
     10594**DCL     11732>>ASSIGN
B$ROSEG$
     10388**DCL     12629>>ASSIGN
BEGINDUMP IN PROCEDURE CGCLS
     12295**LABEL   12376--GOTO
CACHE$
        34**DCL     10684--IMP-PTR 11723<>CALL    11724>>CALL    11724<>CALL    11794>>IF
CFU.ADR
        27**DCL     13217>>ASSIGN
CFU$
        24**DCL        25--REDEF   10643--IMP-PTR 10649--IMP-PTR 10652--IMP-PTR 10657--IMP-PTR 11718<<ASSIGN
     11752<>CALL    11763>>ASSIGN  11765>>ASSIGN  11771>>IF      11775>>IF      11775>>IF      11809>>IF
     11810>>ASSIGN  11812>>ASSIGN  11813>>ASSIGN  11817>>IF      11817>>IF      11819>>ASSIGN  11826>>IF
     11826>>IF      11829>>ASSIGN  11832>>IF      11832>>IF      11840>>IF      11841>>ASSIGN  11841>>ASSIGN
     11909<>CALL    11910>>ASSIGN  11917<<ASSIGN  11918>>IF      11918>>IF      11918>>IF      11920>>IF
     11922>>ASSIGN  11923>>IF      11929>>IF      11930>>ASSIGN  11932>>ASSIGN  11957>>IF      11957>>IF
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:245  
     11957>>IF      11957>>IF      11961>>ASSIGN  11964>>IF      11964>>IF      11971>>ASSIGN  11980<<ASSIGN
     12041<<ASSIGN  12066<>CALL    12067>>IF      12074>>IF      12075>>ASSIGN  12077>>ASSIGN  12078>>ASSIGN
     12081>>ASSIGN  12259>>IF      12261>>ASSIGN  12262>>ASSIGN  12264>>ASSIGN  12267>>IF      12561>>ASSIGN
     12567>>IF      12615>>ASSIGN  12616>>ASSIGN  12617>>IF      12618>>ASSIGN  12621>>ASSIGN  12623>>ASSIGN
     12624>>IF      12625>>ASSIGN  12636>>ASSIGN  12650>>ASSIGN  12660>>ASSIGN  12661>>ASSIGN  12673>>IF
     12697>>IF      12699>>ASSIGN  12700>>DOINDEX 12707>>DOINDEX 12710>>ASSIGN  12713>>DOINDEX 12765>>ASSIGN
     12773>>IF      12776>>ASSIGN  13065>>IF      13066>>ASSIGN  13089>>ASSIGN
CFUX
        37**DCL     11914<<ASSIGN  11915>>DOWHILE 11917>>ASSIGN  11971<<ASSIGN
CGCLS
     12104**PROC    11952--CALL
CGTRAP1
     12018**LABEL   11951--REMEMBR
CGTRAP2
     12020**LABEL   12018--REMEMBR
CHK13 IN PROCEDURE UPFIT
     12676**LABEL   12672--CALLALT
CHK16 IN PROCEDURE UPFIT
     12666**LABEL   12659--CALLALT
CHK2 IN PROCEDURE UPFIT
     12659**LABEL   12635--CALLALT 12649--CALLALT
CHK4 IN PROCEDURE UPFIT
     12672**LABEL   12666--CALLALT
CHKCG
     12051**LABEL   12064--GOTO
CHKFIT IN PROCEDURE GETFIT
     12557**ENTRY   11781--CALL
CNAME IN PROCEDURE GETFIT
     12549**DCL     12587<<ASSIGN
COD$
        52**DCL     10709--IMP-PTR 10713--IMP-PTR 10717--IMP-PTR 10726--IMP-PTR 10738--IMP-PTR 10748--IMP-PTR
     10756--IMP-PTR 10764--IMP-PTR 12266<>CALL    12267>>IF      12581<<ASSIGN  12582>>IF      12584>>IF
     12591>>IF      12615>>ASSIGN  12616>>ASSIGN  12618>>ASSIGN  12621>>ASSIGN  12623>>ASSIGN  12624>>IF
     12625>>ASSIGN  12632>>ASSIGN  12636>>ASSIGN  12638>>ASSIGN  12639>>ASSIGN  12640>>ASSIGN  12641>>ASSIGN
     12646>>ASSIGN  12650>>ASSIGN  12652>>ASSIGN  12653>>ASSIGN  12654>>ASSIGN  12655>>ASSIGN  12660>>ASSIGN
     12661>>ASSIGN  12663>>ASSIGN  12664>>ASSIGN  12669>>ASSIGN  12674>>ASSIGN  12674>>ASSIGN  12675>>ASSIGN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:246  
     12678>>ASSIGN  12840>>ASSIGN  12840>>ASSIGN  12851>>ASSIGN  13178<<ASSIGN
CODE IN PROCEDURE LOCCOD
     13170**DCL     13168--PROC    13177>>IF
CODE01.HASH
     10709**DCL     12584>>IF
CODE01.NXTNTS
     10709**DCL     12582>>IF
CODE01.XTNT
     10709**DCL     10710--REDEF
CODE02.GDA
     10714**DCL     12661<<ASSIGN
CODE02.SLIDE
     10713**DCL     12660<<ASSIGN
CODE02.TDA
     10713**DCL     12664<<ASSIGN
CODE02.TDALVL
     10713**DCL     12663<<ASSIGN
CODE03.LDA
     10720**DCL     12618<<ASSIGN  12632<<ASSIGN  12646<<ASSIGN
CODE03.NGAVAL
     10719**DCL     12616<<ASSIGN
CODE03.NRECS
     10719**DCL     12621<<ASSIGN  12623<<ASSIGN
CODE03.NSTAMP
     10720**DCL     12591>>IF      12851<<ASSIGN
CODE03.RCSZ
     10719**DCL     12624>>IF      12625<<ASSIGN
CODE03.UGRANS
     10717**DCL     12615<<ASSIGN
CODE04.MODIFY.TIME
     10728**DCL     12674<<ASSIGN
CODE04.SVMODIFY.TIME
     10729**DCL     12674>>ASSIGN  12675<<ASSIGN
CODE14.CGRANS
     10753**DCL     12840<<ASSIGN
CODE14.MGRANS
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:247  
     10753**DCL     12840>>ASSIGN
CODE16
     10756**DCL     12669<<ASSIGN  12669>>ASSIGN
CODE20.ALTBLD
     10764**DCL     12650<<ASSIGN
CODE20.K.FDA
     10765**DCL     12652<<ASSIGN
CODE20.K.LDA
     10765**DCL     12653<<ASSIGN
CODE20.K.TDA
     10764**DCL     12654<<ASSIGN
CODE20.K.TDALVL
     10764**DCL     12655<<ASSIGN
COMM IN PROCEDURE GETFIT
     12558**LABEL   12555--GOTO
CTX
        30**DCL        33--REDEF   12268>>ASSIGN
CTX.DISP
        31**DCL     12262<<ASSIGN
CTX.SID
        32**DCL     12261<<ASSIGN
CTX$
        33**DCL     10790--IMP-PTR 12049<>CALL    12050>>CALL    12050<>CALL    12051<<ASSIGN  12051>>ASSIGN
     12053>>IF      12055>>ASSIGN  12056<>CALL    12056<>CALL    12057>>IF      12059>>CALL    12063<<ASSIGN
     12063>>ASSIGN  12066>>CALL    12263>>ASSIGN  12265<>CALL    12265<>CALL    12266>>CALL    12268>>ASSIGN
     12286>>ASSIGN  12291>>CALL    12292>>ASSIGN  12356>>IF      12359>>ASSIGN  12360>>ASSIGN  12364>>ASSIGN
CVTDCB
     11735**LABEL   11849--GOTO
CVTPTR
     12906**PROC    11723--CALL    11724--CALL    11731--CALL    11741--CALL    11752--CALL    11909--CALL
     12049--CALL    12050--CALL    12056--CALL    12059--CALL    12066--CALL    12265--CALL    12266--CALL
     12291--CALL    12668--CALL    13109--CALL    13110--CALL    13111--CALL    13118--CALL    13119--CALL
     13132--CALL    13133--CALL    13139--CALL    13140--CALL    13141--CALL    13157--CALL    13159--CALL
DA
        12**DCL     11800<<ASSIGN  11801>>IF      11812<<ASSIGN  12272<<ASSIGN  12292<<ASSIGN  12347>>ASSIGN
     12349<<ASSIGN  12349>>ASSIGN  12357<<ASSIGN  12561<<ASSIGN  12562>>IF      12568>>ASSIGN  12595>>ASSIGN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:248  
     12597>>ASSIGN  12711<<ASSIGN  12714>>ASSIGN  12760<<ASSIGN  12760>>ASSIGN  12798<<ASSIGN  12799>>IF
     12802>>ASSIGN  12817<<ASSIGN  12853>>ASSIGN  12964>>ASSIGN  12973>>IF      13062>>IF      13063>>ASSIGN
     13095>>ASSIGN
DCB$
        18**DCL        19--REDEF   10515--IMP-PTR 11734<<ASSIGN  11739>>IF      11741<>CALL    11741<>CALL
     11742>>IF      11744>>ASSIGN  11745>>DOCASE  11747>>IF      11749>>ASSIGN  11750>>IF      11752>>CALL
     11753>>IF      11758>>IF      11769>>ASSIGN  11775>>IF      11775>>IF      11775>>IF      11775>>IF
     11778>>ASSIGN  11792>>IF      11794>>IF      11795>>ASSIGN  11797>>IF      11797>>IF      11798>>ASSIGN
     11800>>ASSIGN  11801>>IF      11808>>IF      11826>>IF      11826>>IF      11843<<ASSIGN  11843>>ASSIGN
     11844>>IF      11851>>IF      11851>>IF      11851>>IF      11851>>IF      11851>>IF      11851>>IF
     11851>>IF      11851>>IF      11858>>IF      11860>>IF      11863>>ASSIGN  11863>>ASSIGN  11865>>IF
     11865>>IF      11865>>IF      11866>>ASSIGN  11867>>ASSIGN  11868>>ASSIGN  11869>>IF      11871>>ASSIGN
     11873>>IF      11873>>IF      11873>>IF      11903<<ASSIGN  12040<<ASSIGN  12626>>IF      12627>>IF
     12629>>ASSIGN  12630>>IF      12633>>ASSIGN  12634>>ASSIGN  12647>>ASSIGN  12648>>ASSIGN  12662>>IF
     12663>>ASSIGN  12664>>ASSIGN  12667>>IF      12668>>CALL    12854>>IF      12855>>IF      12856>>ASSIGN
     12968>>ASSIGN  12974>>IF
DCBPTR$
        23**DCL     11731<>CALL    11734>>ASSIGN  11844>>IF
DCBR.ADR
        21**DCL     13216>>ASSIGN
DCT.DCTX
     11610**DCL     13127>>ASSIGN
DCT.DEVNM
     11609**DCL     12721>>ASSIGN  12728>>ASSIGN  12740>>ASSIGN  12747>>ASSIGN  12986>>ASSIGN  12993>>ASSIGN
     13005>>ASSIGN  13012>>ASSIGN
DCT.DP
     11629**DCL     11636--REDEF   11639--REDEF   11640--REDEF   11642--REDEF   11642--REDEF   11643--REDEF
     11644--REDEF   11644--REDEF
DCT.DP.MIRROR.DCTX
     11634**DCL     13138>>ASSIGN
DCT.DP.MIRROR.FLAG
     11631**DCL     13136>>IF
DCT.DP.MIRROR.STATE
     11633**DCL     12716>>IF      12723>>IF      12726<<ASSIGN  12734>>IF      12742>>IF      12745<<ASSIGN
     12981>>IF      12988>>IF      12991<<ASSIGN  12999>>IF      13007>>IF      13010<<ASSIGN
DCT.DVN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:249  
     11618**DCL     13130>>ASSIGN  13142>>ASSIGN
DCT.DVT$
     11625**DCL     13119<>CALL
DCT.MPC.IOCHANX
     11637**DCL     11637--REDEF
DCT.SQH$
     11624**DCL     13131>>ASSIGN  13140<>CALL
DCT.STATUS.DOWN
     11626**DCL     12727<<ASSIGN  12746<<ASSIGN  12992<<ASSIGN  13011<<ASSIGN
DCT$
        65**DCL     11609--IMP-PTR 12716>>IF      12721>>ASSIGN  12726>>ASSIGN  12727>>ASSIGN  12728>>ASSIGN
     12740>>ASSIGN  12742>>IF      12981>>IF      12986>>ASSIGN  12991>>ASSIGN  12992>>ASSIGN  12993>>ASSIGN
     13005>>ASSIGN  13007>>IF      13118<>CALL    13119>>CALL    13127>>ASSIGN  13130>>ASSIGN  13131>>ASSIGN
     13136>>IF      13138>>ASSIGN  13158<<ASSIGN  13159<>CALL    13159<>CALL
DCTCNVRT IN PROCEDURE DISKCNVRT
     13155**ENTRY   11872--CALL
DCTX
        36**DCL     11871<<ASSIGN  13112<<ASSIGN  13113>>DOWHILE 13114>>ASSIGN  13116>>ASSIGN  13117<<ASSIGN
     13117>>ASSIGN  13118>>CALL    13123<<ASSIGN  13123>>ASSIGN  13127<<ASSIGN  13158>>ASSIGN
DESC# IN PROCEDURE CGCLS
     12108**DCL     12293<<ASSIGN  12312<>CALL    12351>>ASSIGN  12373<<ASSIGN
DISKCNVRT
     13035**PROC    12715--CALL    12979--CALL    13030--CALL
DQH.IOCHAN.CHANNEL
     11667**DCL     13135>>ASSIGN  13144>>ASSIGN
DQH.IOCHAN.IOM
     11667**DCL     13134>>ASSIGN  13143>>ASSIGN
DQH.IOCHANX
     11666**DCL     11667--REDEF
DQH.MBX$
     11675**DCL     11676--REDEF
DQH$
        68**DCL     11664--IMP-PTR 13133<>CALL    13134>>ASSIGN  13135>>ASSIGN
DSB$
        29**DCL     11527--IMP-PTR 12059<>CALL    12060>>IF      12291<>CALL    12295>>IF      12299>>ASSIGN
     12312>>CALL    12363<<ASSIGN  12364>>ASSIGN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:250  
DSERR IN PROCEDURE DSWRITE
     12772**ENTRY   11838--CALL    11968--CALL
DSTRAP1
     11837**LABEL   11835--REMEMBR
DSTRAP2
     11968**LABEL   11966--REMEMBR
DSWRITE
     12687**PROC    11836--CALL    11967--CALL
DUMPCG IN PROCEDURE CGCLS
     12371**ENTRY   12094--CALL
DUMPERR
     12093**LABEL   12049--CALLALT 12050--CALLALT 12056--CALLALT 12059--CALLALT 12066--CALLALT
DUMPERR IN PROCEDURE CGCLS
     12383**LABEL   12300--CALLALT 12316--CALLALT
DUMPFLG
        49**DCL     12020>>IF      12298<<ASSIGN  12307<<ASSIGN  12315>>IF      12384<<ASSIGN
DVT.GRANSIZE
     11650**DCL     13129>>ASSIGN
DVT.MPC
     11651**DCL     11652--REDEF
DVT$
        66**DCL     11649--IMP-PTR 13119<>CALL    13129>>ASSIGN
ENDDUMP IN PROCEDURE CGCLS
     12315**LABEL   12386--GOTO
ENDRCVR IN PROCEDURE CGCLS
     12355**LABEL   12312--CALLALT
ENTFLG IN PROCEDURE CGCLS
     12112**DCL     12256<<ASSIGN  12288<<ASSIGN  12321>>IF      12328<<ASSIGN  12335<<ASSIGN  12343<<ASSIGN
     12356>>IF      12375<<ASSIGN  12385<<ASSIGN
ENTFLG IN PROCEDURE GETFIT
     12552**DCL     12554<<ASSIGN  12558<<ASSIGN  12564>>IF
EOF1LABEL.SYSTEM_ID#
     10495**DCL     10496--REDEF
ERR IN PROCEDURE ADDLIST
     12861**LABEL   12850--CALLALT
ERR IN PROCEDURE CGCLS
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:251  
     12375**LABEL   12270--GOTO    12278--GOTO    12283--GOTO
ERR IN PROCEDURE DISKCNVRT
     13165**LABEL   13109--CALLALT 13111--CALLALT 13118--CALLALT 13119--CALLALT 13132--CALLALT 13133--CALLALT
     13139--CALLALT 13140--CALLALT 13141--CALLALT 13157--CALLALT 13159--CALLALT
ERR IN PROCEDURE DSWRITE
     12765**LABEL   12697--GOTO    12715--CALLALT 12770--GOTO    12779--GOTO
ERR IN PROCEDURE GETFDFIT
     12832**LABEL   12801--CALLALT 12818--CALLALT 12827--GOTO    12828--GOTO    12829--GOTO    12830--GOTO
ERR IN PROCEDURE GETFIT
     12604**LABEL   12565--CALLALT 12595--GOTO    12596--GOTO    12597--GOTO    12598--GOTO    12599--GOTO
     12600--GOTO    12601--GOTO    12602--GOTO
ERR IN PROCEDURE UPFDFIT
     12845**LABEL   12843--GOTO
ERR IN PROCEDURE UPFIT
     12682**LABEL   12614--CALLALT
ERR IN PROCEDURE WRITECHK
     13026**LABEL   12979--CALLALT 13030--CALLALT
ERR1 IN PROCEDURE DISKCNVRT
     13163**LABEL   13064--GOTO    13065--GOTO    13092--GOTO    13097--GOTO    13104--GOTO    13107--GOTO
     13125--GOTO
ERR1 IN PROCEDURE GETFDFIT
     12827**LABEL   12800--GOTO
ERR1 IN PROCEDURE GETFIT
     12595**LABEL   12563--GOTO
ERR13 IN PROCEDURE GETFIT
     12598**LABEL   12579--GOTO
ERR14 IN PROCEDURE GETFIT
     12599**LABEL   12583--GOTO
ERR15 IN PROCEDURE GETFIT
     12600**LABEL   12585--GOTO
ERR19 IN PROCEDURE GETFIT
     12601**LABEL   12592--GOTO
ERR2 IN PROCEDURE CGCLS
     12375**LABEL   12265--CALLALT 12266--CALLALT 12273--CALLALT 12291--CALLALT 12358--CALLALT
ERR2 IN PROCEDURE DSWRITE
     12768**LABEL   12756--GOTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:252  
ERR2 IN PROCEDURE WRITECHK
     13024**LABEL   13021--GOTO    13031--CALLALT
ERR20 IN PROCEDURE GETFIT
     12602**LABEL   12590--CALLALT
ERR20 IN PROCEDURE UPFDFIT
     12843**LABEL   12839--CALLALT
ERR3 IN PROCEDURE GETFDFIT
     12828**LABEL   12811--GOTO    12822--GOTO
ERR4 IN PROCEDURE GETFDFIT
     12829**LABEL   12813--GOTO    12824--GOTO
ERR4 IN PROCEDURE GETFIT
     12596**LABEL   12570--GOTO    12574--GOTO
ERR5 IN PROCEDURE GETFDFIT
     12830**LABEL   12808--GOTO    12820--GOTO
ERR5 IN PROCEDURE GETFIT
     12597**LABEL   12576--GOTO
ERR5 IN PROCEDURE WRITECHK
     12966**LABEL   12975--GOTO
ERRCHN IN PROCEDURE DSWRITE
     12775**LABEL   12701--GOTO    12706--GOTO
ERRCODE
        45**DCL     11712<<ASSIGN  11845<<ASSIGN  11879>>IF      11897<<ASSIGN  12034<<ASSIGN  12269<<ASSIGN
     12277<<ASSIGN  12282<<ASSIGN  12325<<ASSIGN  12332<<ASSIGN  12341<<ASSIGN  12595<<ASSIGN  12596<<ASSIGN
     12597<<ASSIGN  12598<<ASSIGN  12599<<ASSIGN  12600<<ASSIGN  12601<<ASSIGN  12602<<ASSIGN  12682<<ASSIGN
     12768<<ASSIGN  12775<<ASSIGN  12827<<ASSIGN  12828<<ASSIGN  12829<<ASSIGN  12830<<ASSIGN  12843<<ASSIGN
     12956<<ASSIGN  12966<<ASSIGN  13024<<ASSIGN  13163<<ASSIGN  13221>>CALLBLT
ERROR
     13185**PROC    11846--CALL    12327--CALL    12334--CALL    12342--CALL    12379--CALL    12604--CALL
     12683--CALL    12769--CALL    12778--CALL    12832--CALL    12957--CALL    12970--CALL    13025--CALL
     13164--CALL
F$CFU$
     10382**DCL     10660--IMP-PTR 10665--IMP-PTR 11765>>ASSIGN  11766>>ASSIGN  11770>>ASSIGN  11908>>ASSIGN
     11911>>DOWHILE 11913>>ASSIGN  11917>>ASSIGN  11932>>ASSIGN  11933>>ASSIGN  11942>>ASSIGN  11983>>ASSIGN
     11986>>ASSIGN  11991>>ASSIGN  12001>>ASSIGN  12003>>IF      12003>>IF      12004>>ASSIGN  12008>>ASSIGN
     12009>>ASSIGN  12012>>ASSIGN  12077>>ASSIGN  12078>>ASSIGN  12078>>ASSIGN  12081>>ASSIGN  12082>>ASSIGN
     12092>>ASSIGN  12852>>ASSIGN  12853>>ASSIGN  13056--IMP-PTR 13099>>ASSIGN  13101>>ASSIGN  13104>>IF
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:253  
     13106>>IF      13106>>IF      13112>>ASSIGN  13114>>ASSIGN  13116>>ASSIGN  13117>>ASSIGN  13123>>ASSIGN
F$DCB.ACS
     10532**DCL     11775>>IF      11801>>IF      11808>>IF      11851>>IF
F$DCB.ACTPOS
     10540**DCL     10540--REDEF
F$DCB.AFTRBLK
     10547**DCL     11869>>IF
F$DCB.ALTKEYX
     10538**DCL     12627>>IF      12629>>ASSIGN
F$DCB.ARS
     10515**DCL     10515--REDEF
F$DCB.ASN
     10530**DCL     11744>>ASSIGN  11747>>IF      11851>>IF
F$DCB.ATTR
     10533**DCL     10534--REDEF
F$DCB.BFR.BUFUP
     10559**DCL     11795<<ASSIGN  11797>>IF      11851>>IF
F$DCB.BFR.BUFX
     10560**DCL     11775>>IF      11778>>ASSIGN  11797>>IF      11798>>ASSIGN
F$DCB.BFR.DA
     10560**DCL     11775>>IF      11775>>IF      11800>>ASSIGN
F$DCB.BFR1.CX
     10561**DCL     11792>>IF      11794>>IF
F$DCB.BLKL
     10530**DCL     11851>>IF
F$DCB.BLKLEN
     10553**DCL     11858>>IF      11863>>ASSIGN  11863>>ASSIGN  11866>>ASSIGN  11867>>ASSIGN  11868>>ASSIGN
F$DCB.BORROW
     10548**DCL     10548--REDEF   10548--REDEF   10548--REDEF   12855>>IF      12856>>ASSIGN
F$DCB.CBUFNUM
     10551**DCL     11851>>IF
F$DCB.CFU$
     10549**DCL     11750>>IF      11752<>CALL    11843>>ASSIGN
F$DCB.DCBNAME.L
     10562**DCL     10562--IMP-SIZ
F$DCB.DISP
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:254  
     10530**DCL     11758>>IF      11826>>IF
F$DCB.EBCDIC
     10527**DCL     11865>>IF      11873>>IF
F$DCB.EOMCHAR
     10519**DCL     10519--REDEF
F$DCB.FCD
     10528**DCL     11742>>IF
F$DCB.FLDID
     10543**DCL     10543--REDEF
F$DCB.FORM$
     10537**DCL     10537--REDEF   12668<>CALL
F$DCB.FSECT
     10553**DCL     10553--REDEF
F$DCB.FSN
     10530**DCL     10530--REDEF   10530--REDEF   10531--REDEF
F$DCB.HASH
     10552**DCL     12968>>ASSIGN  12974>>IF
F$DCB.HEADER$
     10536**DCL     10536--REDEF
F$DCB.IASN
     10556**DCL     11745>>DOCASE
F$DCB.IXTNSIZE
     10534**DCL     10534--REDEF
F$DCB.LASTSTA$
     10524**DCL     10524--REDEF
F$DCB.LVL
     10549**DCL     10549--REDEF
F$DCB.NAME
     10524**DCL     11749--ASSIGN
F$DCB.NAME.C
     10524**DCL     10524--REDEF
F$DCB.NOEOF
     10545**DCL     10545--REDEF
F$DCB.NRECS
     10535**DCL     10535--REDEF
F$DCB.NRECX
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:255  
     10554**DCL     10554--REDEF
F$DCB.OHDR
     10546**DCL     10546--REDEF
F$DCB.ORG
     10529**DCL     10529--REDEF   11826>>IF      11865>>IF      11873>>IF      12630>>IF
F$DCB.OWNER
     10546**DCL     11851>>IF
F$DCB.PRECNO
     10552**DCL     10552--REDEF
F$DCB.RCSZ
     10557**DCL     10557--REDEF
F$DCB.RES
     10525**DCL     10525--REDEF
F$DCB.SETX
     10537**DCL     10537--REDEF   11769>>ASSIGN  11871>>ASSIGN
F$DCB.STARF
     10544**DCL     11753>>IF
F$DCB.TAB$
     10536**DCL     10537--REDEF
F$DCB.TAPTYP.CP6F
     10550**DCL     11860>>IF      11865>>IF      11873>>IF
F$DCB.TAPTYP.USRBUF
     10550**DCL     11851>>IF
F$DCB.TDA
     10551**DCL     10551--REDEF   12633<<ASSIGN  12647<<ASSIGN  12664>>ASSIGN
F$DCB.TDALVL
     10549**DCL     12634<<ASSIGN  12648<<ASSIGN  12663>>ASSIGN
F$DCB.TRNC
     10547**DCL     11851>>IF
F$DCB.WSN
     10526**DCL     10526--REDEF
FID IN PROCEDURE PUTNAME
     12866**DCL     12864--PROC    12872<<CALLBLT 12875<<CALLBLT 12880<<CALLBLT 12888<<CALLBLT 12894<<CALLBLT
     12898<<CALLBLT 12901--ASSIGN
FIDSIZ IN PROCEDURE PUTNAME
     12867**DCL     12864--PROC    12872>>CALLBLT
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:256  
FINDCGPAGE IN PROCEDURE CGCLS
     12391**PROC    12312--CALL
FIT$
        50**DCL     10706--IMP-PTR 12577<<ASSIGN  12578>>IF      12580>>ASSIGN  12581>>ASSIGN  12581>>ASSIGN
     12598>>ASSIGN  12598>>ASSIGN  12838<<ASSIGN  13175>>ASSIGN  13177>>IF      13178>>ASSIGN  13178>>ASSIGN
FLSHDCB
     11790**LABEL   11782--GOTO
FM$CFU.ACCTX
     10644**DCL     10644--REDEF   11763>>ASSIGN  11765>>ASSIGN  11930>>ASSIGN  11932>>ASSIGN  12075>>ASSIGN
     12077>>ASSIGN
FM$CFU.AFIT
     10643**DCL     11775>>IF      12567>>IF
FM$CFU.ALTBLD
     10646**DCL     12636>>ASSIGN  12650>>ASSIGN
FM$CFU.FITSDA
     10644**DCL     11771>>IF      11775>>IF      11829<<ASSIGN  11918>>IF      11961<<ASSIGN  12561>>ASSIGN
     13089>>ASSIGN
FM$CFU.FMOD
     10643**DCL     12617>>IF      12673>>IF
FM$CFU.FUN
     10643**DCL     11826>>IF      11832>>IF      11918>>IF      11957>>IF      11957>>IF      11964>>IF
FM$CFU.GDA
     10645**DCL     12259>>IF      12261>>ASSIGN  12661>>ASSIGN
FM$CFU.LDA
     10646**DCL     11812>>ASSIGN  12262>>ASSIGN  12618>>ASSIGN
FM$CFU.NAMEX
     10644**DCL     11765>>ASSIGN  11932>>ASSIGN  11971>>ASSIGN  12077>>ASSIGN  12078>>ASSIGN  12078>>ASSIGN
     12081>>ASSIGN
FM$CFU.NGAVAL
     10646**DCL     12616>>ASSIGN
FM$CFU.NRECS
     10644**DCL     12623>>ASSIGN  12700>>DOINDEX 12707>>DOINDEX 12713>>DOINDEX
FM$CFU.RCSZ
     10645**DCL     12624>>IF      12625>>ASSIGN
FM$CFU.SHARED
     10643**DCL     11817>>IF      11819<<ASSIGN  11920>>IF      11922<<ASSIGN  12264<<ASSIGN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:257  
FM$CFU.SLIDE
     10645**DCL     12660>>ASSIGN
FM$CFU.STARX.F
     10644**DCL     11929>>IF      12074>>IF
FM$CFU.UGRANS
     10645**DCL     11826>>IF      11957>>IF      12615>>ASSIGN  12621>>ASSIGN  12697>>IF      13065>>IF
FM$CFU.USECNT
     10645**DCL     11817>>IF      11840>>IF      11841<<ASSIGN  11841>>ASSIGN  11918>>IF
FM$CFU.XTX
     10645**DCL     13066>>ASSIGN
FM$CFUA.ACCT
     10673**DCL     11767>>ASSIGN  11934>>ASSIGN  11989>>ASSIGN  12083>>ASSIGN  12803--ASSIGN
FM$CFUA.FDFITSDA
     10673**DCL     12798>>ASSIGN
FM$CFUA.GMOD
     10674**DCL     11987>>IF      12857<<ASSIGN
FM$CFUA.GRANS
     10676**DCL     12840>>ASSIGN  12856<<ASSIGN  12856>>ASSIGN
FM$CFUA.LINKX
     10673**DCL     11997>>ASSIGN
FM$CFUA.SETX
     10673**DCL     11935>>ASSIGN  11990>>ASSIGN  12084>>ASSIGN
FM$CFUEXT.EXTNT.XTNSIZE IN PROCEDURE DISKCNVRT
     13053**DCL     13077>>ASSIGN
FM$CFUEXT.LINKX IN PROCEDURE DISKCNVRT
     13052**DCL     13086>>ASSIGN
FM$CFUEXT.NUM IN PROCEDURE DISKCNVRT
     13052**DCL     13071>>DOWHILE
FM$CFUEXT.XTNT IN PROCEDURE DISKCNVRT
     13052**DCL     13053--REDEF
FM$CFUEXT.XTNT.XTNSDA IN PROCEDURE DISKCNVRT
     13053**DCL     13080>>ASSIGN
FM$CFUEXT.XTNT.XTNSIZE IN PROCEDURE DISKCNVRT
     13052**DCL     13072>>ASSIGN
FM$CFUF.ACCNAM
     10649**DCL     11923>>IF      12067>>IF
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:258  
FM$CFUJ.DCTX
     10652**DCL     11957>>IF
FM$CFUJ.PAGE#
     10653**DCL     11809>>IF      11810>>ASSIGN  11813<<ASSIGN
FM$CFUN.C
     10670**DCL     12894>>CALLBLT
FM$CFUN.L
     10670**DCL     10670--IMP-SIZ 11973>>ASSIGN  12586>>ASSIGN  12587--ASSIGN  12892>>ASSIGN  12894>>CALLBLT
FM$CFUN.LNKX
     10670**DCL     11914>>ASSIGN
FM$CFUR.HEADPP#
     10657**DCL     11832>>IF      11964>>IF      12699>>ASSIGN  12710>>ASSIGN  12765<<ASSIGN  12773>>IF
     12776>>ASSIGN
FM$CFUX.ACCTS
     10660**DCL     11983>>ASSIGN
FM$CFUX.NAMES
     10660**DCL     11908>>ASSIGN
FM$CFUX.NAMEX
     10661**DCL     11911>>DOWHILE
FM$CFUX.SETH
     10661**DCL     12001>>ASSIGN  13099>>ASSIGN
FM$FIT.CODES.CODE
     10706**DCL     12578>>IF      13175>>ASSIGN  13177>>IF
FM$FIT.CODES.ITEMX
     10706**DCL     12581>>ASSIGN  13178>>ASSIGN
FM$FIT.CODES.NDW
     10706**DCL     12580>>ASSIGN
FM$GRAN
     10679**DCL     12577--ASSIGN  12838--ASSIGN
FM$GRAN.BLINK
     10680**DCL     12008<<ASSIGN
FM$GRAN.LVL
     10679**DCL     12569>>IF      12573>>IF      12812>>IF      12823>>IF
FM$GRAN.ORG
     10679**DCL     11832>>IF      11946>>IF      11950>>IF      11957>>IF      11964>>IF      12619>>IF
     12619>>IF      12619>>IF      12810>>IF      12821>>IF
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:259  
FM$GRAN.STAMP
     10679**DCL     12807>>IF      12819>>IF
FM$GRAN.STAMP.GMOD
     10679**DCL     12575>>IF      12597>>ASSIGN  12714<<ASSIGN  12965>>IF      12969<<ASSIGN
FM$GRAN.STAMP.HASH
     10679**DCL     12258>>ASSIGN  12584>>IF      12968<<ASSIGN  12974>>IF
FM$SET.CHKSM
     10667**DCL     12003>>IF      12008>>ASSIGN  12009<<ASSIGN  12852>>ASSIGN  12853<<ASSIGN
FM$SET.DCTX
     10665**DCL     13106>>IF      13112>>ASSIGN
FM$SET.NXTSDA
     10667**DCL     13106>>IF
FM$SET.PSN
     10665**DCL     11770>>ASSIGN  11942>>ASSIGN  11991>>ASSIGN  12004>>ASSIGN  12092>>ASSIGN
FM$SET.SET
     10665**DCL     12003>>IF      13104>>IF
FM$SET.SETL
     10667**DCL     12012>>ASSIGN  13101>>ASSIGN
FM$SET.USERLIST
     10666**DCL     10666--REDEF
FM$VOL.DCTX IN PROCEDURE DISKCNVRT
     13056**DCL     13117>>ASSIGN
FM$VOL.DRZERO IN PROCEDURE DISKCNVRT
     13058**DCL     13116>>ASSIGN
FM$VOL.NXTSDA IN PROCEDURE DISKCNVRT
     13058**DCL     13114>>ASSIGN
FM$VOL.USERLIST IN PROCEDURE DISKCNVRT
     13057**DCL     13058--REDEF
FM$VOL.VOLL IN PROCEDURE DISKCNVRT
     13058**DCL     13123>>ASSIGN
FMC$CACHETBL.FLAGS.BUFUP
     10702**DCL     11794>>IF
FMC_CACHE$
     10383**DCL     11723--CALL
FM_FRMAX
     10459**DCL     13062>>IF
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:260  
FM_FRZERO
     10458**DCL     11775>>IF      12272>>ASSIGN  12292>>ASSIGN  12357>>ASSIGN  12359>>ASSIGN  12711>>ASSIGN
     13063>>ASSIGN
FM_GPSDA
     10462**DCL     12817>>ASSIGN
FM_GPSTAMP
     10463**DCL     12819>>IF
FM_SRZERO
     10460**DCL     11801>>IF      12003>>IF      12562>>IF      12799>>IF      12973>>IF      13097>>IF
     13108>>ASSIGN  13114>>ASSIGN
FM_SYSSETX
     10384**DCL     11909--CALL
FS$DEST.CRASHED
     10739**DCL     12678<<ASSIGN
FT$LBL1.SYSTEM_ID
      2703**DCL      2704--REDEF
FT$LBL2.CP6
      2776**DCL      2794--REDEF
FT$ULBL.LABEL_NBIN
      2870**DCL      2871--REDEF
GETADR IN PROCEDURE DISKCNVRT
     13130**LABEL   13160--GOTO
GETFDFIT
     12782**PROC    11994--CALL
GETFIT
     12528**PROC    11786--CALL    11824--CALL    11945--CALL    11954--CALL
GETGPFIT IN PROCEDURE GETFDFIT
     12816**ENTRY   12007--CALL
GMOD IN PROCEDURE GETFIT
     12530**DCL     12566<<ASSIGN  12568<<ASSIGN  12575>>IF      12597>>ASSIGN
GMOD IN PROCEDURE WRITECHK
     12962**DCL     12964<<ASSIGN  12965>>IF      12969>>ASSIGN
GOTDR IN PROCEDURE DISKCNVRT
     13127**LABEL   13120--GOTO
GOTSR IN PROCEDURE DISKCNVRT
     13097**LABEL   13081--GOTO    13090--GOTO
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:261  
HASH IN PROCEDURE CGCLS
     12107**DCL     12258<<ASSIGN  12274>>IF      12331>>IF      12333>>ASSIGN
HSH.B1 IN PROCEDURE GETFDFIT
     12791**DCL     12804>>ASSIGN
HSH.B2 IN PROCEDURE GETFDFIT
     12793**DCL     12804>>ASSIGN
HSH1.B3 IN PROCEDURE GETFDFIT
     12796**DCL     12804>>ASSIGN
I
        13**DCL     11774<<DOINDEX 11775>>IF      11775>>IF      11775>>IF      11778>>ASSIGN  11790<<DOINDEX
     11792>>IF      11794>>IF      11795>>ASSIGN  11797>>IF      11797>>IF      11798>>ASSIGN  11800>>ASSIGN
     12700<<DOINDEX 12703>>ASSIGN  12707<<DOINDEX 12708>>ASSIGN  12713<<DOINDEX
I IN PROCEDURE CVTPTR
     12915**DCL     12948<<DOINDEX 12949>>IF      12951>>ASSIGN
I IN PROCEDURE DISKCNVRT
     13041**DCL     13070<<ASSIGN  13071>>DOWHILE 13072>>ASSIGN  13077>>ASSIGN  13080>>ASSIGN  13084<<ASSIGN
     13084>>ASSIGN
I IN PROCEDURE ERROR
     13187**DCL     13215<<DOINDEX 13216>>ASSIGN  13216>>ASSIGN  13217>>ASSIGN  13217>>ASSIGN  13224<<DOINDEX
     13225>>ASSIGN  13225>>ASSIGN  13226>>ASSIGN  13226>>ASSIGN
I IN PROCEDURE GETFIT
     12531**DCL     12580<<ASSIGN  12582>>IF
I IN PROCEDURE LOCCOD
     13173**DCL     13176<<DOINDEX 13177>>IF      13178>>ASSIGN
I IN PROCEDURE PUTNAME
     12869**DCL     12873<<ASSIGN  12875>>CALLBLT 12876<<ASSIGN  12876>>ASSIGN  12880>>CALLBLT 12881<<ASSIGN
     12881>>ASSIGN  12888>>CALLBLT 12889<<ASSIGN  12889>>ASSIGN  12894>>CALLBLT 12895<<ASSIGN  12895>>ASSIGN
     12898>>CALLBLT 12899<<ASSIGN  12899>>ASSIGN  12901<<ASSIGN  12901>>ASSIGN  12902<>CALL
I IN PROCEDURE UPFIT
     12612**DCL     12637<<DOINDEX 12638>>ASSIGN  12638>>ASSIGN  12639>>ASSIGN  12639>>ASSIGN  12640>>ASSIGN
     12640>>ASSIGN  12641>>ASSIGN  12641>>ASSIGN  12651<<DOINDEX 12652>>ASSIGN  12652>>ASSIGN  12653>>ASSIGN
     12653>>ASSIGN  12654>>ASSIGN  12654>>ASSIGN  12655>>ASSIGN  12655>>ASSIGN
I$JITU$
     10392**DCL     11726>>ASSIGN
I$MEM$
     10412**DCL     11811>>ASSIGN  12314>>ASSIGN  12703>>ASSIGN  12758>>ASSIGN  12759>>ASSIGN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:262  
I$MONIS$
     10391**DCL     12934--DCLINIT 12935--DCLINIT
I$PPUT$ IN PROCEDURE DSWRITE
     12695**DCL     12692--IMP-PTR 12704>>ASSIGN  12761>>ASSIGN
I$REAL$
     10390**DCL     12932--DCLINIT
I$RV1$
     10389**DCL     12933--DCLINIT
IOADR.CHAN
     10401**DCL     13135<<ASSIGN
IOADR.DEV
     10402**DCL     13130<<ASSIGN
IOADR.IOM
     10403**DCL     13134<<ASSIGN
IP$ IN PROCEDURE CVTPTR
     12908**DCL     12906--PROC    12950>>ASSIGN  12955>>ASSIGN
IP$.SEGID IN PROCEDURE CVTPTR
     12910**DCL     12949>>IF
IRKEYS.K.FDA
     10772**DCL     12652>>ASSIGN
IRKEYS.K.LDA
     10773**DCL     12646>>ASSIGN  12653>>ASSIGN
IRKEYS.K.TDA
     10770**DCL     12647>>ASSIGN  12654>>ASSIGN
IRKEYS.K.TDALVL
     10770**DCL     12648>>ASSIGN  12655>>ASSIGN
IRKEYS.NKEYS
     10769**DCL     12651>>DOINDEX
IRR$RPAGE
     10506**DCL-ENT 13031--CALL
IRR$SPRECB
     10512**DCL-ENT 11870--CALL
IRR$TYPE6
     10507**DCL-ENT 11729--CALL    12722--CALL    12729--CALL    12741--CALL    12748--CALL    12902--CALL
     12987--CALL    12994--CALL    13006--CALL    13013--CALL    13228--CALL
IRR$WPAGE
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:263  
     10509**DCL-ENT 12719--CALL    12738--CALL    12984--CALL    13003--CALL
IRR$WPOBUFF
     10508**DCL-ENT 12300--CALL    12316--CALL
IRR$WRASC
     10510**DCL-ENT 11875--CALL
IRR$WRBIN
     10511**DCL-ENT 11874--CALL
J
        14**DCL        15--REDEF   11734>>ASSIGN  11844>>IF
J IN PROCEDURE PUTNAME
     12870**DCL     12883<<ASSIGN  12884>>DOWHILE 12884>>DOWHILE 12885<<ASSIGN  12885>>ASSIGN  12887>>IF
     12888>>CALLBLT 12888>>CALLBLT 12889>>ASSIGN  12892<<ASSIGN  12893>>IF      12893<<ASSIGN  12894>>CALLBLT
     12894>>CALLBLT 12895>>ASSIGN
K IN PROCEDURE FINDCGPAGE
     12493**DCL     12504<<ASSIGN  12505>>ASSIGN  12506>>IF
KQ$CG
     10790**DCL     12280--IF      12280--IF      12364<<ASSIGN  12364>>ASSIGN
KQ$CG.AUCTL.DVBYTE.REREAD
     11233**DCL     11234--REDEF
KQ$CG.CFU$
     11301**DCL     12066<>CALL    12266<>CALL    12268>>ASSIGN
KQ$CG.LNK$
     11154**DCL     12063>>ASSIGN
KQ$CG.MMD.DSB$
     10799**DCL     12057>>IF      12059<>CALL    12291<>CALL
KQ$CG.NGAVAL
     11315**DCL     12286>>ASSIGN  12356>>IF      12360>>ASSIGN
KQ$CG.UGRANS
     11317**DCL     12292>>ASSIGN  12359>>ASSIGN
KQ$CTLGRAN IN PROCEDURE CGCLS
     12127**DCL     12280--IF
KQ$CTLGRAN.CTXSIZ IN PROCEDURE CGCLS
     12186**DCL     12280>>IF
KQ$CTLGRAN.CTXX IN PROCEDURE CGCLS
     12184**DCL     12280>>IF      12280>>IF      12363>>ASSIGN
KQ$CTLGRAN.PGTBL IN PROCEDURE CGCLS
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:264  
     12197**DCL     12362<<ASSIGN
KQ$CTLGRAN.RCVRDA IN PROCEDURE CGCLS
     12188**DCL     12359<<ASSIGN
KQ$CTLGRAN.RCVRSIZ IN PROCEDURE CGCLS
     12190**DCL     12287>>IF      12360<<ASSIGN
KQ$CTLGRAN.RCVRTIME IN PROCEDURE CGCLS
     12192**DCL     12361<<ASSIGN
KQ$DSB
     11527**DCL     12299<<ASSIGN  12299>>ASSIGN  12312<>CALL
KQ$DSB.ASR
     11529**DCL     11538--REDEF   12060>>IF      12295>>IF
KQ$DSB.DESC.FLG
     11549**DCL     11550--REDEF
KQ$DSB IN PROCEDURE FINDCGPAGE
     12406**DCL     12391--PROC
KQ$DSB.ASR IN PROCEDURE FINDCGPAGE
     12408**DCL     12417--REDEF
KQ$DSB.DESC.BASE IN PROCEDURE FINDCGPAGE
     12434**DCL     12504>>ASSIGN
KQ$DSB.DESC.FLG IN PROCEDURE FINDCGPAGE
     12428**DCL     12429--REDEF
KQ$DSB.DESC.FLGR.PRESENT IN PROCEDURE FINDCGPAGE
     12431**DCL     12503>>IF
KQ$GRAN.CHAIN IN PROCEDURE CGCLS
     12234**DCL     12338>>IF
KQ$GRAN.GTYP IN PROCEDURE CGCLS
     12243**DCL     12346<<ASSIGN
KQ$GRAN.ORG IN PROCEDURE CGCLS
     12246**DCL     12274>>IF
KQ$GRAN.PTYP IN PROCEDURE CGCLS
     12238**DCL     12274>>IF      12322>>IF      12338>>IF
KQ$GRAN.SELF$ IN PROCEDURE CGCLS
     12250**DCL     12324>>IF      12326>>ASSIGN
KQ$GRAN.STAMP IN PROCEDURE CGCLS
     12218**DCL     12333>>ASSIGN
KQ$GRAN.STAMP.GMOD IN PROCEDURE CGCLS
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:265  
     12222**DCL     12347<<ASSIGN
KQ$GRAN.STAMP.HASH IN PROCEDURE CGCLS
     12220**DCL     12274>>IF      12331>>IF
KQ$MMSD.CGHEAD$
     11575**DCL     12051>>ASSIGN
KQ_MMSD$
     10385**DCL     11570--IMP-PTR 12049--CALL
L$N$DCT$$
        69**DCL     13109<>CALL    13110>>CALL    13110<>CALL    13118>>CALL    13139>>CALL    13157<>CALL
     13158>>ASSIGN
LOCCOD
     13168**PROC    12590--CALL    12614--CALL    12635--CALL    12649--CALL    12659--CALL    12666--CALL
     12672--CALL    12676--CALL    12839--CALL    12850--CALL
LOOP IN PROCEDURE FINDCGPAGE
     12493**LABEL   12521--GOTO
LOOP1 IN PROCEDURE FINDCGPAGE
     12499**LABEL   12503--GOTO
MEMDESC.BADDR
     10411**DCL     11810<<ASSIGN  12313<<ASSIGN  12702<<ASSIGN  12757<<ASSIGN
MIR_DCT$
        70**DCL     12723>>IF      12734>>IF      12745>>ASSIGN  12746>>ASSIGN  12747>>ASSIGN  12988>>IF
     12999>>IF      13010>>ASSIGN  13011>>ASSIGN  13012>>ASSIGN  13139<>CALL    13140>>CALL    13142>>ASSIGN
MIR_DCTX
        79**DCL     13138<<ASSIGN  13139>>CALL    13150<<ASSIGN
MIR_DQH$ IN PROCEDURE DISKCNVRT
     13049**DCL     13141<>CALL    13143>>ASSIGN  13144>>ASSIGN
MIR_ERR
        78**DCL     12712<<ASSIGN  12732<<ASSIGN  12751<<ASSIGN  12754>>IF      12980<<ASSIGN  12997<<ASSIGN
     13016<<ASSIGN  13019>>IF
MIR_FLAG
        77**DCL     12716>>IF      12716>>IF      12723>>IF      12734>>IF      12742>>IF      12981>>IF
     12981>>IF      12988>>IF      12999>>IF      13007>>IF      13137<<ASSIGN  13148<<ASSIGN
MIR_IOADR.CHAN
        73**DCL     13144<<ASSIGN
MIR_IOADR.DEV
        74**DCL     13142<<ASSIGN
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:266  
MIR_IOADR.IOM
        75**DCL     13143<<ASSIGN
MIR_SQH$ IN PROCEDURE DISKCNVRT
     13048**DCL     13140<>CALL    13141>>CALL
MISC1
        54**DCL        55--REDEF      56--REDEF      57--REDEF   11721<<ASSIGN  11906<<ASSIGN  12044<<ASSIGN
     12276<<ASSIGN  12595<<ASSIGN  12596<<ASSIGN  12597<<ASSIGN  12598<<ASSIGN  12776<<ASSIGN  12805<<ASSIGN
     12955<<ASSIGN  12967<<ASSIGN  13223>>IF      13229<<ASSIGN
MISC1$
        57**DCL     12326<<ASSIGN
MISC1B
        56**DCL     12333<<ASSIGN
MISC2
        58**DCL        59--REDEF      60--REDEF   11722<<ASSIGN  11907<<ASSIGN  12045<<ASSIGN  12276<<ASSIGN
     12333<<ASSIGN  12595<<ASSIGN  12596<<ASSIGN  12597<<ASSIGN  12598<<ASSIGN  12777<<ASSIGN  12806<<ASSIGN
     12809<<ASSIGN  12955<<ASSIGN  12968--ASSIGN  12969--ASSIGN  13223>>IF      13229<<ASSIGN
MISC2$
        60**DCL     12268<<ASSIGN  12326<<ASSIGN
MM$PPUT.PPNO IN PROCEDURE DSWRITE
     12694**DCL     12704>>ASSIGN  12761>>ASSIGN
MSC1
        55**DCL     12268<<ASSIGN  13225>>ASSIGN
MSC2
        59**DCL     13226>>ASSIGN
MSG IN PROCEDURE PUTNAME
     12865**DCL     12864--PROC    12901--ASSIGN  12902<>CALL
MSG_IOERR
     10414**DCL     12722<>CALL    12722--CALL    12741<>CALL    12741--CALL    12987<>CALL    12987--CALL
     13006<>CALL    13006--CALL
MSG_IOERR.NAME
     10415**DCL     12721<<ASSIGN  12740<<ASSIGN  12986<<ASSIGN  13005<<ASSIGN
MSG_IOERR.TYPE
     10416**DCL     13145<<ASSIGN  13151<<ASSIGN
MSG_PART
     10418**DCL     12729<>CALL    12729--CALL    12748<>CALL    12748--CALL    12994<>CALL    12994--CALL
     13013<>CALL    13013--CALL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:267  
MSG_PART.NAME
     10419**DCL     12728<<ASSIGN  12747<<ASSIGN  12993<<ASSIGN  13012<<ASSIGN
N
        62**DCL     11599--IMP-SIZ 11859<<ASSIGN  11861<<ASSIGN  11862<<ASSIGN  11863<<ASSIGN  11863>>ASSIGN
     11863>>ASSIGN  11863>>ASSIGN  11866>>ASSIGN  11867>>ASSIGN  11868<<ASSIGN  11868>>ASSIGN  11874<>CALL
     11875<>CALL
N IN PROCEDURE LOCCOD
     13172**DCL     13175<<ASSIGN  13176>>DOINDEX
N$DCT$$
     10408**DCL     13109--CALL    13157--CALL
NAME$
        40**DCL     10670--IMP-PTR 11717<<ASSIGN  11738<<ASSIGN  11749<<ASSIGN  11902<<ASSIGN  11913<<ASSIGN
     11914>>ASSIGN  11973>>ASSIGN  11981<<ASSIGN  12039<<ASSIGN  12070<<ASSIGN  12078<<ASSIGN  12081<<ASSIGN
     12088<<ASSIGN  12586>>ASSIGN  12587>>ASSIGN  12891>>IF      12892>>ASSIGN  12894>>CALLBLT 12894>>CALLBLT
NAMEX
        41**DCL     11908<<ASSIGN  11911>>DOWHILE 11913>>ASSIGN  11915>>DOWHILE 11973<<ASSIGN  11973>>ASSIGN
NCHARS
     11599**DCL     11866<<ASSIGN  11867<<ASSIGN
NGRAN IN PROCEDURE DISKCNVRT
     13042**DCL     13072<<ASSIGN  13073>>IF      13077<<ASSIGN  13079>>IF      13083>>ASSIGN
NI$DVT$
     10407**DCL     13111--CALL
NI$DVT$$ IN PROCEDURE DISKCNVRT
     13046**DCL     13111<>CALL
NULPAD
     10504**DCL     11866>>ASSIGN
NUMDCBS
        16**DCL     11732<<ASSIGN  11733>>DOINDEX
NXTACCT
     11997**LABEL   11988--GOTO    11994--CALLALT 11995--CALLALT
NXTCFU
     11970**LABEL   11919--GOTO    11921--GOTO    11945--CALLALT 11952--CALLALT 11954--CALLALT 11956--CALLALT
     12024--GOTO
NXTCG
     12057**LABEL   12058--GOTO
NXTDCB
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:268  
     11878**LABEL   11740--GOTO    11741--CALLALT 11743--GOTO    11748--GOTO    11751--GOTO    11752--CALLALT
     11772--GOTO    11781--CALLALT 11786--CALLALT 11804--CALLALT 11815--CALLALT 11818--GOTO    11824--CALLALT
     11825--CALLALT 11847--GOTO    11857--GOTO
NXTP IN PROCEDURE CGCLS
     12311**LABEL   12323--GOTO    12329--GOTO    12336--GOTO    12339--GOTO    12344--GOTO
NXTSET
     12012**LABEL   12007--CALLALT
OLDCTX$
        61**DCL     12055<<ASSIGN  12263<<ASSIGN  12298>>ASSIGN
OP
        46**DCL     11713<<ASSIGN  11735<<ASSIGN  11780<<ASSIGN  11785<<ASSIGN  11791<<ASSIGN  11814<<ASSIGN
     11823<<ASSIGN  11905<<ASSIGN  11912<<ASSIGN  11984<<ASSIGN  11999<<ASSIGN  12043<<ASSIGN  12257<<ASSIGN
     12698<<ASSIGN  13220>>CALLBLT
OP$ IN PROCEDURE CVTPTR
     12911**DCL     12906--PROC    12950<<ASSIGN
OP$.SEGID IN PROCEDURE CVTPTR
     12913**DCL     12951<<ASSIGN
P.SEGID IN PROCEDURE CVTPTR
     12946**DCL     12951>>ASSIGN
P2 IN PROCEDURE GETFIT
     12532**DCL     12549--REDEF
P2.I IN PROCEDURE GETFIT
     12545**DCL     12546--REDEF   12550--IMP-SIZ 12586<<ASSIGN  12587>>ASSIGN  12588>>ASSIGN
P2.J IN PROCEDURE GETFIT
     12547**DCL     12548--REDEF   12588<<ASSIGN  12588>>ASSIGN
P2.JB IN PROCEDURE GETFIT
     12548**DCL     12589>>ASSIGN  12589>>ASSIGN
P2.X IN PROCEDURE GETFIT
     12533**DCL     12538--REDEF
P2.X.A IN PROCEDURE GETFIT
     12534**DCL     12535--REDEF
P2.X.AB IN PROCEDURE GETFIT
     12535**DCL     12589>>ASSIGN  12589>>ASSIGN
P2.X.B IN PROCEDURE GETFIT
     12536**DCL     12537--REDEF   12588>>ASSIGN
P2.Y.A IN PROCEDURE GETFIT
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:269  
     12540**DCL     12588>>ASSIGN
P2.Y.B IN PROCEDURE GETFIT
     12541**DCL     12588>>ASSIGN
P2.Z.A IN PROCEDURE GETFIT
     12543**DCL     12588>>ASSIGN
P2.Z.B IN PROCEDURE GETFIT
     12544**DCL     12588>>ASSIGN
PACKSIZE IN PROCEDURE DISKCNVRT
     13045**DCL     13114<<ASSIGN  13115>>IF      13122>>ASSIGN
PAGE# IN PROCEDURE DSWRITE
     12690**DCL     12699<<ASSIGN  12701>>IF      12702>>ASSIGN  12704<<ASSIGN  12704>>ASSIGN  12706>>IF
     12710<<ASSIGN  12757>>ASSIGN  12761<<ASSIGN  12761>>ASSIGN  12777>>ASSIGN
PG
     11595**DCL     11778<<ASSIGN  11778>>ASSIGN  11798<<ASSIGN  11798>>ASSIGN  11811<<ASSIGN  11811>>ASSIGN
     11910>>ASSIGN  12276>>ASSIGN  12276>>ASSIGN  12314<<ASSIGN  12314>>ASSIGN  12596>>ASSIGN  12596>>ASSIGN
     12598>>ASSIGN  12598>>ASSIGN  12703<<ASSIGN  12703>>ASSIGN  12708<<ASSIGN  12758<<ASSIGN  12758>>ASSIGN
     12759<<ASSIGN  12759>>ASSIGN  12805>>ASSIGN  12809>>ASSIGN  12967>>ASSIGN
PG$ IN PROCEDURE CGCLS
     12110**DCL     12312<>CALL    12324>>IF      12326>>ASSIGN
PGINDX IN PROCEDURE CGCLS
     12109**DCL     12294<<ASSIGN  12312<>CALL    12351>>ASSIGN  12374<<ASSIGN
PGNUM IN PROCEDURE FINDCGPAGE
     12437**DCL     12391--PROC    12496>>IF      12500<<ASSIGN  12505>>ASSIGN  12506>>IF      12514>>ASSIGN
     12517<<ASSIGN  12517>>ASSIGN  12520<<ASSIGN  12520>>ASSIGN
PGTBL
        63**DCL     12290<<ASSIGN  12351<<ASSIGN  12362>>ASSIGN
PHASE
        47**DCL     11714<<ASSIGN  11898<<ASSIGN  11982<<ASSIGN  12035<<ASSIGN  13219>>CALLBLT
PNAME IN PROCEDURE GETFIT
     12550**DCL     12587>>ASSIGN
POBUF
     10380**DCL     10464--DCLINIT 11798--ASSIGN  11866--ASSIGN  11867--ASSIGN  12577--ASSIGN
POBUF$
     10464**DCL     10679--IMP-PTR 11596--IMP-PTR 11778>>ASSIGN  11811>>ASSIGN  11832>>IF      11946>>IF
     11950>>IF      11957>>IF      11964>>IF      12008>>ASSIGN  12127--IMP-PTR 12214--IMP-PTR 12258>>ASSIGN
     12274>>IF      12274>>IF      12274>>IF      12276>>ASSIGN  12276>>ASSIGN  12280>>IF      12280>>IF
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:270  
     12280>>IF      12287>>IF      12299>>ASSIGN  12314>>ASSIGN  12322>>IF      12324>>IF      12326>>ASSIGN
     12331>>IF      12333>>ASSIGN  12338>>IF      12338>>IF      12346>>ASSIGN  12347>>ASSIGN  12359>>ASSIGN
     12360>>ASSIGN  12361>>ASSIGN  12362>>ASSIGN  12363>>ASSIGN  12363>>ASSIGN  12569>>IF      12573>>IF
     12575>>IF      12584>>IF      12596>>ASSIGN  12596>>ASSIGN  12597>>ASSIGN  12619>>IF      12619>>IF
     12619>>IF      12703>>ASSIGN  12708>>ASSIGN  12714>>ASSIGN  12758>>ASSIGN  12759>>ASSIGN  12805>>ASSIGN
     12807>>IF      12809>>ASSIGN  12810>>IF      12812>>IF      12819>>IF      12821>>IF      12823>>IF
     12838>>ASSIGN  12852>>ASSIGN  12965>>IF      12967>>ASSIGN  12974>>IF
PPNO IN PROCEDURE FINDCGPAGE
     12443**DCL     12391--PROC    12505<<ASSIGN  12513<<ASSIGN  12513>>ASSIGN
PTR$
     11594**DCL     11724<>CALL    11734>>ASSIGN  11844>>IF      12050<>CALL    13110<>CALL    13118<>CALL
     13139<>CALL    13158>>ASSIGN
PTR$ IN PROCEDURE FINDCGPAGE
     12438**DCL     12391--PROC    12439--REDEF
PTR$R.GORGO IN PROCEDURE FINDCGPAGE
     12441**DCL     12516<<ASSIGN
PTR$R.PG# IN PROCEDURE FINDCGPAGE
     12440**DCL     12514<<ASSIGN
PTR$R.SEGID IN PROCEDURE FINDCGPAGE
     12442**DCL     12515<<ASSIGN
PUTNAME
     12864**PROC    11803--CALL    11821--CALL    11944--CALL    11993--CALL    12006--CALL    12022--CALL
     12304--CALL    12764--CALL    12860--CALL    13222--CALL
R$BUFF$
     10386**DCL     11778>>ASSIGN  11798>>ASSIGN  12937--DCLINIT
R$CFU$
     10381**DCL     10382--REDEF   12936--DCLINIT 13069>>ASSIGN
R$CGCTXT$
     10395**DCL     12941--DCLINIT
R$CGPT$
     10393**DCL     10394--REDEF   12940--DCLINIT
R$DVT$
     10396**DCL     12942--DCLINIT
R$ROSEG$
     10387**DCL     10388--REDEF   10591--IMP-PTR 10627--IMP-PTR 10629--IMP-PTR 11731>>CALL    11732>>ASSIGN
     12938--DCLINIT 12939--DCLINIT
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:271  
READ IN PROCEDURE WRITECHK
     13028**ENTRY   12273--CALL    12358--CALL    12565--CALL    12801--CALL    12818--CALL
RELADDR IN PROCEDURE DISKCNVRT
     13044**DCL     13099<<ASSIGN  13100>>DOWHILE 13100>>DOWHILE 13101<<ASSIGN  13101>>ASSIGN  13103>>IF
     13104>>IF      13106>>IF      13106>>IF      13106>>IF      13108<<ASSIGN  13115>>IF      13116<<ASSIGN
     13116>>ASSIGN  13122<<ASSIGN  13122>>ASSIGN  13128>>ASSIGN
RELBUF.LINK
     11598**DCL     12852<<ASSIGN
REMUNWIND
        48**DCL     11834<<ASSIGN  11837>>ASSIGN  11894<<ASSIGN  11953>>ASSIGN  11970>>ASSIGN
RET IN PROCEDURE UPFIT
     12680**LABEL   12676--CALLALT
RP IN PROCEDURE CGCLS
     12111**DCL     12312<>CALL    12313>>ASSIGN
RSLT IN PROCEDURE GETFIT
     12551**DCL     12589<<ASSIGN  12591>>IF
RVF_CGTRAP
      9521**DCL     12022<>CALL
RVF_CGTRAP.FID
      9522**DCL     12022<>CALL    12022--CALL
RVF_CLSBFR
      9520**DCL     11803<>CALL
RVF_CLSBFR.FID
      9520**DCL     11803<>CALL    11803--CALL
RVF_CLSCFU
      9518**DCL     11944<>CALL
RVF_CLSCFU.FID
      9518**DCL     11944<>CALL    11944--CALL
RVF_CLSDCB
      9517**DCL     11821<>CALL
RVF_CLSDCB.FID
      9518**DCL     11821<>CALL    11821--CALL
RVF_CLSFD
      9518**DCL     11993<>CALL
RVF_CLSFD.FID
      9519**DCL     11993<>CALL    11993--CALL
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:272  
RVF_CLSUSR
      9519**DCL     11729<>CALL    11729--CALL
RVF_CLSUSR.ACCN
      9519**DCL     11728<<ASSIGN
RVF_CLSUSR.SYSID
      9519**DCL     11727<<CALLBLT
RVF_DEBUG
     10465**DCL     11725>>IF      11802>>IF      11820>>IF      11943>>IF      11992>>IF      12005>>IF
     12303>>IF      12763>>IF      12859>>IF
RVF_DUMPCG
      9521**DCL     12304<>CALL
RVF_DUMPCG.FID
      9521**DCL     12304<>CALL    12304--CALL
RVF_ERRCNT
      9516**DCL     12015<<ASSIGN  13212<<ASSIGN  13212>>ASSIGN  13213>>IF
RVF_ERRMSG
      9516**DCL     13222<>CALL
RVF_ERRMSG.CFU
      9517**DCL     13217<<ASSIGN
RVF_ERRMSG.DCBA
      9516**DCL     13216<<ASSIGN
RVF_ERRMSG.ERR
      9517**DCL     13221<<CALLBLT
RVF_ERRMSG.FID
      9517**DCL     13222<>CALL    13222--CALL
RVF_ERRMSG.OP
      9517**DCL     13220<<CALLBLT
RVF_ERRMSG.PH
      9517**DCL     13219<<CALLBLT
RVF_ERRMSG.USR
      9516**DCL     11720<<CALLBLT 11904<<ASSIGN  12042<<ASSIGN
RVF_MISCMSG
      9522**DCL     13228<>CALL    13228--CALL
RVF_MISCMSG.M1
      9523**DCL     13225<<ASSIGN
RVF_MISCMSG.M2
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:273  
      9523**DCL     13226<<ASSIGN
RVF_RELFILE
      9520**DCL     12860<>CALL
RVF_RELFILE.FID
      9520**DCL     12860<>CALL    12860--CALL
RVF_RELGRAN
      9521**DCL     12006<>CALL
RVF_RELGRAN.PSN
      9521**DCL     12006<>CALL    12006--CALL
RVF_WRDSMSG
      9522**DCL     12764<>CALL
RVF_WRDSMSG.FID
      9522**DCL     12764<>CALL    12764--CALL
RV_BUFF.CGQTRAP
     10423**DCL     12019<<ASSIGN
RV_BUFF.CURCG
     10444**DCL     11895<<ASSIGN  12020>>IF      12047>>IF      12295>>IF
RV_BUFF.CURCG.CG$
     10445**DCL     12298<<ASSIGN
RV_BUFF.CURCG.DA
     10444**DCL     12298<<ASSIGN
RV_BUFF.CURCG.ERR
     10445**DCL     12098<<ASSIGN  12383<<ASSIGN
RV_BUFF.CURCG.SZ
     10445**DCL     12301<<ASSIGN  12301>>ASSIGN  12317<<ASSIGN  12317>>ASSIGN
RV_BUFF.CURCG.TRAP
     10444**DCL     12021<<ASSIGN
RV_BUFF.SIZE
     10422**DCL     12302<<ASSIGN  12302>>ASSIGN  12318<<ASSIGN  12318>>ASSIGN
RV_BUFF.SSFRAME
     10432**DCL     12060--IF      12295--IF
RV_BUFF.UTS1
     10424**DCL     12361>>ASSIGN
RV_CUN
     10413**DCL     11720>>CALLBLT
RV_DCTX
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:274  
     10399**DCL     10400--REDEF   11711<<ASSIGN  11896<<ASSIGN  12737<<ASSIGN  13002<<ASSIGN
RV_MIRDCTX
        71**DCL        72--REDEF   12737>>ASSIGN  13002>>ASSIGN  13149<<ASSIGN
RV_NSPG
     10406**DCL     13129<<ASSIGN
RV_NXTGRAN
     10398**DCL     12298>>ASSIGN
RV_UNWIND1
     10397**DCL     11834>>ASSIGN  11835<<REMEMBR 11837<<ASSIGN  11894>>ASSIGN  11951<<REMEMBR 11953<<ASSIGN
     11966<<REMEMBR 11970<<ASSIGN  12018<<REMEMBR
RV_WDGRAN
     10405**DCL     13128<<ASSIGN
S1000_FLG IN PROCEDURE FINDCGPAGE
     12488**DCL     12511>>IF
SEGTAB.MONSID IN PROCEDURE CVTPTR
     12919**DCL     12949>>IF
SEGTAB.RV$ IN PROCEDURE CVTPTR
     12931**DCL     12951>>ASSIGN
SETX
        35**DCL     11769<<ASSIGN  11770>>ASSIGN  11926<<ASSIGN  11935<<ASSIGN  11940<<ASSIGN  11942>>ASSIGN
     11990<<ASSIGN  11991>>ASSIGN  12001<<ASSIGN  12002>>DOWHILE 12003>>IF      12003>>IF      12004>>ASSIGN
     12008>>ASSIGN  12009>>ASSIGN  12012<<ASSIGN  12012>>ASSIGN  12071<<ASSIGN  12084<<ASSIGN  12090<<ASSIGN
     12092>>ASSIGN  12852>>ASSIGN  12853>>ASSIGN  13100>>DOWHILE 13112>>ASSIGN
SIZ IN PROCEDURE CGCLS
     12106**DCL     12286<<ASSIGN  12340>>IF      12350<<ASSIGN  12350>>ASSIGN  12356>>IF      12360>>ASSIGN
SIZ IN PROCEDURE DISKCNVRT
     13043**DCL     13074<<ASSIGN  13076<<ASSIGN  13084>>ASSIGN
SJ
        15**DCL     11733<<DOINDEX
SN
        42**DCL     11715<<ASSIGN  11736<<ASSIGN  11770<<ASSIGN  11900<<ASSIGN  11942<<ASSIGN  11991<<ASSIGN
     12004<<ASSIGN  12037<<ASSIGN  12092<<ASSIGN  12677>>IF      12884>>DOWHILE 12888>>CALLBLT
SQH.CQ$
     11688**DCL     13133<>CALL    13141<>CALL
SQH.DOOR
     11687**DCL     11687--REDEF
PL6.E3A0      #001=IRF$CLSF File=IRF$CLSF.:E05TSI                                TUE 07/29/97 22:43 Page:275  
SQH$
        67**DCL     11687--IMP-PTR 13131<<ASSIGN  13132<>CALL    13132<>CALL    13133>>CALL
SRDA IN PROCEDURE DISKCNVRT
     13038**DCL     13063<<ASSIGN  13064>>IF      13065>>IF      13079>>IF      13080<<ASSIGN  13080>>ASSIGN
     13083<<ASSIGN  13083>>ASSIGN  13089<<ASSIGN  13089>>ASSIGN  13095<<ASSIGN  13097>>IF      13106>>IF
     13108>>ASSIGN
STAMP IN PROCEDURE GETFDFIT
     12785**DCL     12806>>ASSIGN  12807>>IF
STAMP.GMOD IN PROCEDURE GETFDFIT
     12787**DCL     12802<<ASSIGN
STAMP.HASH IN PROCEDURE GETFDFIT
     12786**DCL     12804<<ASSIGN
SYSSETX
        53**DCL     11910<<ASSIGN  11926>>ASSIGN  11940>>ASSIGN  12071>>ASSIGN  12090>>ASSIGN
T$ IN PROCEDURE GETFDFIT
     12788**DCL     12790--IMP-PTR 12794--IMP-PTR 12803<<ASSIGN  12804>>ASSIGN  12804>>ASSIGN  12804>>ASSIGN
T$ IN PROCEDURE UPFIT
     12611**DCL     12668<>CALL    12669>>ASSIGN
UPFDFIT
     12836**PROC    11995--CALL
UPFIT
     12608**PROC    11825--CALL    11956--CALL
WRITE IN PROCEDURE WRITECHK
     12977**ENTRY   11831--CALL    11963--CALL    11996--CALL    12010--CALL    12348--CALL    12365--CALL
WRITECHK
     12961**PROC    11804--CALL    11815--CALL
XTX IN PROCEDURE DISKCNVRT
     13039**DCL     13066<<ASSIGN  13067>>IF      13068>>DOWHILE 13069>>ASSIGN  13086<<ASSIGN
XTX$ IN PROCEDURE DISKCNVRT
     13040**DCL     13052--IMP-PTR 13069<<ASSIGN  13071>>DOWHILE 13072>>ASSIGN  13077>>ASSIGN  13080>>ASSIGN
     13086>>ASSIGN
ZEROBITS
     10503**DCL     10504--REDEF
