VERSION E05

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:1    
        1        1        /*M* ASA$LINE_C0NTROLLER - Processes the LINE profile. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*  DMC,DMR,CCC,PLM=0,IND=3,CTI=5,DCI=6,IAD=0,DTI=0,IDT=0,ENI=3,
        8        8              ECU=3,CSU=3,SDI=3                                           */
        9        9
       10       10        ASA$LINE_CONTROLLER: PROC;
       11       11
       12       12
       13       13        /*********************************************************************/
       14       14        /*   Include files   include files   include files   include files   */
       15       15        /*********************************************************************/
       16       16                                                              /**/
       17       17              %INCLUDE  AS_ENTRIES_M  ;
       18     1067              %INCLUDE  AS_MAC_C      ;
       19     1147              %INCLUDE  AS_SUPER_C    ;
       20     1582              %INCLUDE  AS_SUBS_C     ;
       21     2996              %INCLUDE  AS_SSUBS_C    ;
       22     3088              %INCLUDE  AS_PERR_C     ;
       23     3690              %INCLUDE  CP_6          ;
       24     3771              %INCLUDE  CP_6_SUBS     ;
       25     4311              %INCLUDE  KL_CONFIG_M   ;
       26     5073              %INCLUDE  KL_SUPER_C    ;
       27     7975              %INCLUDE  B_ERRORS_C    ;
       28     9102              %INCLUDE  XU_MACRO_C    ;
       29    12208              %INCLUDE  XU_FORMAT_C   ;
       30    12370              %INCLUDE  AS_SUPER_R    ;
       31    15386        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:2    
       32    15387        /********************************************************************/
       33    15388        /*   Auto data       auto data       auto data       auto data       */
       34    15389        /*********************************************************************/
       35    15390                                                              /**/
       36    15391    1   DCL SUBNDS SBIN WORD ;
       37    15392    1   DCL SUBS SBIN WORD ;
       38    15393    1   DCL PTR$ PTR ;
       39    15394    1   DCL CNT SBIN WORD ;
       40    15395    1   DCL I SBIN WORD ;
       41    15396    1   DCL J SBIN WORD ;
       42    15397    1   DCL K SBIN WORD ;
       43    15398    1   DCL ARS SBIN WORD ;
       44    15399    1   DCL CONT# SBIN WORD ;
       45    15400    1   DCL CONT_INDEX SBIN WORD ;
       46    15401    1   DCL DEV# SBIN WORD ;
       47    15402    1   DCL CONT_EXISTS BIT(1);
       48    15403    1   DCL ROWS SBIN WORD ;
       49    15404    1   DCL COLUMNS SBIN WORD ;
       50    15405    1   DCL MOVE_SIZE SBIN WORD ;
       51    15406    1   DCL SIZE SBIN WORD ;
       52    15407    1   DCL MORE BIT(1) ;
       53    15408    1   DCL CODE2 SBIN WORD ;
       54    15409    1   DCL CONTPTR$ PTR;
       55    15410    1   DCL CONT$ PTR;
       56    15411    1   DCL BLK$ PTR ;
       57    15412    1   DCL DEV$ PTR ;
       58    15413    1   DCL TYPE$ PTR ;
       59    15414    1   DCL DEV_END$ PTR;
       60    15415    1   DCL DEV_START$ PTR;
       61    15416    1   DCL DEV_STOP$ PTR;
       62    15417    1   DCL DEV_SIZEW SBIN;
       63    15418    1   DCL FOUND BIT(1);
       64    15419    1   DCL DONE  BIT(1);
       65    15420    1   DCL LINE BIT(1);
       66    15421    1   DCL CONTROLLER BIT(1);
       67    15422    1   DCL DEVICE BIT(1);
       68    15423    1   DCL PRO$ PTR ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:3    
       69    15424    1   DCL CREATE BIT(1) ;
       70    15425    1   DCL DEV_CREATE BIT(1) ;
       71    15426    1   DCL PRO_BUF CHAR(AS_PRO_BUF_SIZEC);
       72    15427    1   DCL 1 LINE_NAME,
       73    15428    1          2 COUNT UBIN BYTE UNAL,
       74    15429    1          2 TEXT CHAR(8) UNAL;
       75    15430        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:4    
       76    15431        /********************************************************************/
       77    15432        /*   Symref's        symref's        symref's        symref's        */
       78    15433        /*********************************************************************/
       79    15434                                                              /**/
       80    15435    1   DCL LINE_CMD UBIN SYMREF;
       81    15436    1   DCL LINE_OPTS_LIST UBIN SYMREF;
       82    15437    1   DCL CONTROLLER_CMD  UBIN SYMREF;
       83    15438    1   DCL CONT_OPTS_LIST UBIN SYMREF;
       84    15439    1   DCL LINE_DEV_CMD UBIN SYMREF;
       85    15440    1   DCL CONT_DEV_OPTS_LIST UBIN SYMREF;
       86    15441    1   DCL B$TCB$ PTR SYMREF;
       87    15442                                                              /**/
       88    15443        /********************************************************************/
       89    15444        /*   Static data     static data     static data     static data     */
       90    15445        /*********************************************************************/
       91    15446                                                              /**/
       92    15447    1   DCL 1 LINE_KEY ALIGNED STATIC ,
       93    15448    1          2 CNT UBIN BYTE UNAL INIT( 9 ),
       94    15449    1          2 TXT UNAL ,
       95    15450    1             3 LINE CHAR(8) UNAL INIT(' ') ,
       96    15451    1             3 ASTR CHAR(1) UNAL INIT('*') ;
       97    15452    1   DCL 1 LNGTH ALIGNED STATIC,
       98    15453    1          2 T UBIN(28) UNAL INIT(0),
       99    15454    1          2 B UBIN(8) UNAL INIT(0);
      100    15455    1   DCL LNG_CNT REDEF LNGTH UBIN;
      101    15456        %KL$TERM (NAME=KL_TERM_REC,STCLASS=STATIC);
      102    15505        %KL$TERM_KEY (NAME=KL_TERM_KEY,STCLASS=STATIC);
      103    15551                                                              /**/
      104    15552        /********************************************************************/
      105    15553        /*   Constant data   constant data   constant data   constant data   */
      106    15554        /*********************************************************************/
      107    15555                                                              /**/
      108    15556        %KL_DREC( NAME = LINE_DREC ,
      109    15557                  STCLASS = CONSTANT ,
      110    15558                  TYP = %KLAT_LINE# ,
      111    15559                  SUPR = AS_LINE# ,
      112    15560                  WSN = ' ' ,
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:5    
      113    15561                  TNM = ' ' ,
      114    15562                  RNAME = ' ' ,
      115    15563                  PASS = ' ' ,
      116    15564                  PRO = ' ' ,
      117    15565                  WORG = ' ',
      118    15566                  LAST = "," );
      119    15679        %KL_LN3270( NAME = LN,
      120    15680                    LVL = 2,
      121    15681                    STCLASS = CONSTANT);
      122    15823        %KL_CONTROLLER(
      123    15824                  LVL=1,
      124    15825                  STCLASS=CONSTANT,
      125    15826                  LAST=";" );
      126    15975        %KL_LINEDEV(
      127    15976                  LVL=1,
      128    15977                  STCLASS=CONSTANT );
      129    16126    1   DCL TYPE_(0:15) UBIN CONSTANT INIT(0,
      130    16127    1                                      2780,
      131    16128    1                                      3271,
      132    16129    1                                      3274,
      133    16130    1                                      3275,
      134    16131    1                                      3276,
      135    16132    1                                      3277,
      136    16133    1                                      3278,
      137    16134    1                                      3279,
      138    16135    1                                      3284,
      139    16136    1                                      3286,
      140    16137    1                                      3287,
      141    16138    1                                      3288,
      142    16139    1                                      3289,
      143    16140    1                                      7700,
      144    16141    1                                      7804 );
      145    16142
      146    16143        %PLIST ;
      147    16144        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:6    
      148    16145        /*********************************************************************/
      149    16146        /*   Local based     local based     local based     local based     */
      150    16147        /*********************************************************************/
      151    16148                                                              /**/
      152    16149        %PARSE$OUT( NAME=P$NODE, STCLASS="BASED(NODE$)",
      153    16150                    NDTYPE=TYPE, NSUBLKS=SUBNODES) ;
      154    16195        %PARSE$SYM( NAME = OUT$SYM ,
      155    16196                    STCLASS="BASED(BLK$)") ;
      156    16234        %KL_DREC (NAME = KL$DREC ,
      157    16235                  LAST=",",
      158    16236                  STCLASS="BASED( DSEG1$ )");
      159    16349        %KL_LN3270( NAME = LN,
      160    16350                    LVL = 2,
      161    16351                    STCLASS = BASED );
      162    16493        %KL_CONTROLLER( NAME=KL$CONTROLLER,
      163    16494                        LVL=1,
      164    16495                        LAST=";",
      165    16496                        STCLASS="BASED(CONTPTR$)" );
      166    16645        %KL_LINEDEV( NAME=KL$LINEDEV,
      167    16646                     LVL=1,
      168    16647                     STCLASS="BASED(DSEG3$)" );
      169    16796        %KL_PHDR( NAME = KL$PHDR, STCLASS="BASED( PRO$ )" );
      170    16837        %KL$UWORD( NAME = KL$UWORD, STCLASS="BASED( TYPE$ )" );
      171    16842        %KL$UBWORD( NAME = KL$UBWORD, STCLASS=AUTO );
      172    16852    1   DCL MOVE$TEMP CHAR(MOVE_SIZE) BASED;
      173    16853        %B$TCB;
      174    16856        %B$ALT;
      175    16864        %PLIST ;
      176    16865        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:7    
      177    16866        /********************************************************************/
      178    16867        /*   Entry dcls      entry dcls      entry dcls      entry dcls      */
      179    16868        /*********************************************************************/
      180    16869                                                              /**/
      181    16870    1   DCL X$PARSE ENTRY(1) ALTRET ;
      182    16871        %ASB$ENQ_HLP ;
      183    16874        %ASB$DEQ_HLP ;
      184    16877        %ASB$READ_HLP ;
      185    16880        %ASB$WRITE_HLP ;
      186    16883        %ASB$WRITE_LO ;
      187    16886        %ASB$GETSEG ;
      188    16889        %ASB$READ_SI ;
      189    16892        %ASB$FIND_NUM ;
      190    16895        %ASB$SET_PROMPT ;
      191    16898        %ASD$READ_PRO ;
      192    16901        %ASH$ERROR ;
      193    16904        %ASH$WARN ;
      194    16907        %ASH$INFO ;
      195    16910        %ASZ$SCRAMBLE ;
      196    16913        %ASH$HELP ;
      197    16916        %ASH$QUEST ;
      198    16919        %ASH$DQUEST ;
      199    16922        %ASB$GET_MORE_SEG ;
      200    16925        %ASA$ERROR ;
      201    16928        %ASB$CHECK_TYPE ;
      202    16931        %ASB$READ_NETCON ;
      203    16934        %ASB$WRITE_NETCON ;
      204    16937        %ASB$CLOSE_NETCON ;
      205    16940        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:8    
      206    16941        /********************************************************************/
      207    16942        /*   Procedure       procedure       procedure       procedure       */
      208    16943        /*********************************************************************/
      209    16944                                                              /**/
      210    16945        /*
      211    16946            ***            Begin procedure                    ***
      212    16947        */
      213    16948    1   LINE = (P$NODE.CODE = CR_MOD_LINE_VAL);
      214    16949    1   CONTROLLER = (P$NODE.CODE = CR_MOD_CONT_VAL);
      215    16950    1   DEVICE = (P$NODE.CODE = CR_MOD_LINE_DEV_VAL);
      216    16951    1   IF LINE THEN
      217    16952    1      P_PCB.ROOT$ = ADDR( LINE_CMD ) ;
      218    16953    1   ELSE
      219    16954    1      IF CONTROLLER THEN
      220    16955    1         P_PCB.ROOT$ = ADDR( CONTROLLER_CMD ) ;
      221    16956    1      ELSE
      222    16957    1         P_PCB.ROOT$ = ADDR( LINE_DEV_CMD );
      223    16958    1   CALL X$PARSE( P_PCB ) ALTRET( CMD_ERR ) ;
      224    16959                                                              /**/
      225    16960    1   NODE$ = P_PCB.OUT$ ;
      226    16961                                                              /**/
      227    16962    1   CREATE = ( P$NODE.CODE = CREATE_VAL );
      228    16963                                                              /**/
      229    16964    1   USERS_KEY = '0'B ;
      230    16965    1   IF NOT DSEG_FLG THEN CALL ASB$GETSEG ALTRET( GETSEG_ERR );
      231    16966                                                          /* Check existence of line */
      232    16967    1   IF LINE THEN
      233    16968    1      BLK$ = NODE$ -> P$NODE.SUBLK$(0) -> P$NODE.SUBLK$(0) ;
      234    16969    1   ELSE
      235    16970    1      BLK$ = NODE$ -> P$NODE.SUBLK$(1) -> P$NODE.SUBLK$(0) ;
      236    16971    2   IF OUT$SYM.COUNT > 8 THEN DO;
      237    16972        /*E*  ERROR:    ASA-E$LNAMETOOBIG-C
      238    16973              MESSAGE:  Line name too long.
      239    16974              MESSAGE1: Line names can be at most 8 characters.
      240    16975        */
      241    16976           %SCREAM( ERR#=E$LNAMETOOBIG, LEVEL=ERROR, MID='A' );
      242    16991    2      RETURN ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:9    
      243    16992    2      END ;    /* Then do */
      244    16993    1   LINE_NAME.COUNT = OUT$SYM.COUNT ;
      245    16994    1   LINE_NAME.TEXT  = OUT$SYM.TEXT ;
      246    16995    1   LINE_KEY.TXT.LINE = OUT$SYM.TEXT ;
      247    16996    1   USERS_KEY = LINE_KEY ;
      248    16997    1   CALL ASB$ENQ_HLP ALTRET( ENQ_ERR ) ;
      249    16998    1   ARS = DSEG1SIZE ;
      250    16999    1   CALL ASB$READ_HLP( DSEG1$, ARS, 1 ) ALTRET( CM_LINE_ERR ) ;
      251    17000    1   CALL ASB$CHECK_TYPE( DSEG1$, ARS, AS_LINE#, CREATE & LINE, LINE_NAME ) ALTRET(EXIT#)
             17000            ;
      252    17001    2   IF LINE AND CREATE THEN DO;
      253    17002        /*E*  ERROR:    ASA-E$LINE_ALREADY_EXISTS-C
      254    17003              MESSAGE0: Line %%U1 %already exists.
      255    17004              MESSAGE1: Cannot CREATE a line that already exists.
      256    17005        */
      257    17006    2      AS_FIELD1 = LINE_NAME;
      258    17007           %SCREAM( ERR#=E$LINE_ALREADY_EXISTS, LEVEL=ERROR, MID='A') ;
      259    17022    2      CALL ASB$DEQ_HLP ;
      260    17023    2      RETURN ;
      261    17024    2      END ; /* Then do */
      262    17025    1   CREATE_LINE: ;
      263    17026                                                              /**/
      264    17027    2   IF NOT LINE THEN DO;
      265    17028    2      DEV_START$ = PINCRW(ADDR(KL$DREC.LN), SIZEW(KL$DREC.LN) );
      266    17029    2      DEV_SIZEW = KL$DREC.NWINFO - POFFW(DEV_START$,ADDR(KL$DREC.LN));
      267    17030    2      CONTPTR$ = PINCRC( DSEG3$, DSEG3SIZE/2 );
      268    17031    2      CALL FIND_CONTROLLER ALTRET(EXIT#);
      269    17032    2      IF DEVICE THEN CALL FIND_DEVICE ALTRET(EXIT#);
      270    17033    2      END;
      271    17034    1   ELSE
      272    17035    2      IF CREATE THEN DO;          /* Initialize the line record */
      273    17036    2         KL$DREC = LINE_DREC;
      274    17037    2         KL$DREC.PASSWORD = BLANK_PASS;
      275    17038    2         KL$DREC.LN = LINE_DREC.LN;
      276    17039    2         KL$DREC.LN.BLKHDR.LEV = 1;
      277    17040    2         KL$DREC.LN.BLKHDR.NSUBS = 0;
      278    17041    2         KL$DREC.LN.BLKHDR.BLKTYP = %KLTY_3270#;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:10   
      279    17042    2         LNG_CNT = LENGTHC( LINE_DREC.LN );
      280    17043    2         KL$UBWORD.NUM = 0;
      281    17044    2         KL$UBWORD.REPLACE.T = LNGTH.T;
      282    17045    2         KL$UBWORD.REPLACE.B = LNGTH.B;
      283    17046    2         KL$DREC.LN.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;
      284    17047    2         KL$DREC.LN.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;
      285    17048    2         END;
      286    17049                                                              /*  Do options  */
      287    17050    1   MORE = AS_TRUE ;
      288    17051                                                              /**/
      289    17052    1   LINE_LOOP: ;
      290    17053    1   IF LINE THEN
      291    17054    1      P_PCB.ROOT$ = ADDR( LINE_OPTS_LIST ) ;
      292    17055    1   ELSE
      293    17056    1      IF CONTROLLER THEN
      294    17057    1         P_PCB.ROOT$ = ADDR( CONT_OPTS_LIST );
      295    17058    1      ELSE
      296    17059    1         P_PCB.ROOT$ = ADDR( CONT_DEV_OPTS_LIST );
      297    17060    2   DO WHILE( MORE ) ;
      298    17061                                                              /* Set prompt */
      299    17062    2      CALL ASB$SET_PROMPT ( %PROMPT_OPT ) ;
      300    17063                                                              /* Read input */
      301    17064    2      CALL ASB$READ_SI( IN_BUF, ARS ) ;
      302    17065    2      P_PCB.NCHARS = ARS ;
      303    17066    2      CALL X$PARSE( P_PCB ) ALTRET( LINE_OPT_ERR ) ;
      304    17067    2      NODE$ = P_PCB.OUT$ ;
      305    17068                                                              /**/
      306    17069    3      DO I = 0 TO P$NODE.SUBNODES-1 ;
      307    17070    3         PTR$ = P$NODE.SUBLK$(I) ;
      308    17071    3         CODE = PTR$ -> P$NODE.CODE ;
      309    17072    4         DO SELECT( CODE ) ;
      310    17073                                                              /**/
      311    17074                                                              /**/
      312    17075    4            SELECT( LINE_PRO_VAL ) ;
      313    17076    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;
      314    17077    5            IF OUT$SYM.COUNT > 11 THEN DO;
      315    17078        /*E*  ERROR: ASA-E$PRO_TOO_LONG-C
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:11   
      316    17079              MESSAGE:  Profile name too long.
      317    17080              MESSAGE1: Profile name can be at most 11 characters long.
      318    17081        */
      319    17082                    %SCREAM( ERR#=E$PRO_TOO_LONG, LEVEL=ERROR, MID='A') ;
      320    17097    5               GOTO LOOP_END;
      321    17098    5               END ;    /* Then do */
      322    17099    4            PRO$ = ADDR(PRO_BUF);
      323    17100    4            ARS = LENGTHC(PRO_BUF);
      324    17101    4            USERS_KEY.COUNT=OUT$SYM.COUNT;
      325    17102    4            USERS_KEY.TXTC=OUT$SYM.TEXT;
      326    17103    4            CALL ASD$READ_PRO(USERS_KEY,KL$PHDR,ARS) ALTRET(LINE_PRO_ERR);
      327    17104                                                   /* If polled vip devtype */
      328    17105    5            IF KL$PHDR.TTYP = %KLTY_HIP_DEV# THEN DO;
      329    17106    5               KL$DREC.LN.BLKHDR.BLKTYP= %KLTY_3270#;   /* Bisync */
      330    17107    5               IF CONTROLLER THEN
      331    17108    5                  KL$CONTROLLER.BLKHDR.BLKTYP=%KLTY_HIP_CONT#;
      332    17109    5               ELSE
      333    17110    5                  IF LINE THEN
      334    17111    5                     KL$LINEDEV.BLKHDR.BLKTYP=%KLTY_HIP_LINE#;
      335    17112    5               END;
      336    17113
      337    17114                    /* If not rbt and not polled vip device profiles */
      338    17115    4            IF (KL$PHDR.TTYP ~= %KLTY_STRM#) AND (KL$PHDR.TTYP~=%KLTY_HIP_DEV#) THEN
      339    17116        /*E* ERROR: ASA-E$LINEPROTYPE-0
      340    17117             MESSAGE: You must specify a profile that defines a line.
      341    17118             MESSAGE1: Possible line profiles would be $ASYNC or $RBT.
      342    17119        */
      343    17120                    %SCREAM( ERR#=E$LINEPROTYPE, LEVEL=ERROR, MID='A' );
      344    17135    5            ELSE DO;
      345    17136    5               KL$DREC.PNAME.CNT = OUT$SYM.COUNT ;
      346    17137    5               KL$DREC.PNAME.TXT = OUT$SYM.TEXT ;
      347    17138    5               END;
      348    17139    5            DO WHILE( '0'B );
      349    17140        /*   ERROR: ASA-E$PRO_NO_EXIST-C
      350    17141             MESSAGE: Profile %%U1 %does not exist.
      351    17142             MESSAGE1: The profile %%U1 %must exist in :PRO before
      352    17143                       you can use it.
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:12   
      353    17144        */
      354    17145    5   LINE_PRO_ERR: AS_FIELD1 = USERS_KEY ;
      355    17146                    %SCREAM( ERR#=E$PRO_NO_EXIST, LEVEL=ERROR, MID='A' ) ;
      356    17161    5               END;
      357    17162                                                              /**/
      358    17163    4            SELECT( %LINE_SLAVE_VAL );
      359    17164
      360    17165    4            IF PTR$->P$NODE.SUBNODES = 0 THEN
      361    17166    4               KL$DREC.LN.SLAVE# = %YES#;
      362    17167    5            ELSE DO;
      363    17168    5               BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      364    17169    5               IF BLK$ -> P$NODE.CODE = YES_VAL THEN
      365    17170    5                  KL$DREC.LN.SLAVE# = %YES#;
      366    17171    5               ELSE
      367    17172    5                  KL$DREC.LN.SLAVE# = %NO#;
      368    17173    5               END;
      369    17174                                                              /**/
      370    17175    4            SELECT( CONT_ROWS_VAL, DEV_ROWS_VAL );
      371    17176    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      372    17177    4            CALL CHARBIN(ROWS, OUT$SYM.TEXT);
      373    17178    5            IF ROWS < 12 OR ROWS > 255 THEN DO;
      374    17179        /*E*  ERROR:  ASA-E$INVALID_ROWS-C
      375    17180              MESSAGE: Invalid ROWS value.
      376    17181              MESSAGE1: ROWS must be between 12 and 255.
      377    17182        */
      378    17183                    %SCREAM( ERR#=E$INVALID_ROWS, LEVEL=ERROR, MID='A' );
      379    17198    5               END;
      380    17199    4            ELSE
      381    17200    4               IF CODE = CONT_ROWS_VAL THEN
      382    17201    4                  KL$CONTROLLER.ROWS = ROWS;
      383    17202    4               ELSE
      384    17203    4                  KL$LINEDEV.ROWS = ROWS;
      385    17204                                                              /**/
      386    17205    4            SELECT( CONT_COLUMNS_VAL, DEV_COLUMNS_VAL );
      387    17206    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      388    17207    4            CALL CHARBIN(COLUMNS, OUT$SYM.TEXT);
      389    17208    5            IF COLUMNS < 40 OR COLUMNS > 255 THEN DO;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:13   
      390    17209        /*E*  ERROR:  ASA-E$INVALID_COLUMNS-C
      391    17210              MESSAGE: Invalid COLUMNS value.
      392    17211              MESSAGE1: COLUMNS must be between 40 and 255.
      393    17212        */
      394    17213                    %SCREAM( ERR#=E$INVALID_COLUMNS, LEVEL=ERROR, MID='A' );
      395    17228    5               END;
      396    17229    4            ELSE
      397    17230    4               IF CODE = CONT_COLUMNS_VAL THEN
      398    17231    4                  KL$CONTROLLER.COLUMNS = COLUMNS;
      399    17232    4               ELSE
      400    17233    4                  KL$LINEDEV.COLUMNS = COLUMNS;
      401    17234                                                              /**/
      402    17235    4            SELECT( CONT_TYPE_VAL );
      403    17236    4            TYPE$ = ADDR( TYPE_(PTR$->P$NODE.SUBLK$(0)->P$NODE.CODE) );
      404    17237    4            KL$UBWORD.NUM = 0 ;
      405    17238    4            KL$UBWORD.REPLACE.T = KL$UWORD.T;
      406    17239    4            KL$UBWORD.REPLACE.B = KL$UWORD.B;
      407    17240    4            KL$CONTROLLER.TYPE = KL$UBWORD.NUM;
      408    17241                                                              /**/
      409    17242    4            SELECT( LINE_DEV_TYPE_VAL );
      410    17243    4            TYPE$ = ADDR( TYPE_(PTR$->P$NODE.SUBLK$(0)->P$NODE.CODE) );
      411    17244    4            KL$UBWORD.NUM = 0 ;
      412    17245    4            KL$UBWORD.REPLACE.T = KL$UWORD.T;
      413    17246    4            KL$UBWORD.REPLACE.B = KL$UWORD.B;
      414    17247    4            KL$LINEDEV.TYPE = KL$UBWORD.NUM;
      415    17248                                                              /**/
      416    17249                                                              /**/
      417    17250    4            SELECT( END_VAL, BLANK_LINE_VAL );
      418    17251    5            IF CONTROLLER THEN DO;
      419    17252    6               IF NOT FOUND THEN DO;
      420    17253    6                  KL$DREC.LN.BLKHDR.NSUBS = KL$DREC.LN.BLKHDR.NSUBS + 1;
      421    17254    6                  PTR$ = CONT$;
      422    17255    6                  DEV_SIZEW = DEV_SIZEW + SIZEW(KL_CONTROLLER);
      423    17256    6                  END;
      424    17257    5               MOVE_SIZE = POFFC(DEV_STOP$, PTR$);
      425    17258    6               IF MOVE_SIZE > 0 THEN DO;
      426    17259    6                  IF MOVE_SIZE > DSEG2SIZE THEN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:14   
      427    17260    6                     CALL ASB$GET_MORE_SEG(2,4096) ALTRET(GETSEG_ERR);
      428    17261    6                  DSEG2$->MOVE$TEMP = PTR$->MOVE$TEMP;
      429    17262    6                  END;
      430    17263    5               SIZE = POFFC(CONT$,DSEG1$)+SIZEW(KL_CONTROLLER)*4+MOVE_SIZE;
      431    17264    6               IF SIZE > DSEG1SIZE THEN DO;
      432    17265    6                  CALL ASB$GET_MORE_SEG(1,SIZE) ALTRET(GETSEG_ERR);
      433    17266    6                  END;
      434    17267    5               CONT$->KL$CONTROLLER = KL$CONTROLLER;
      435    17268    6               IF MOVE_SIZE > 0 THEN DO;
      436    17269    6                  PTR$ = PINCRW(CONT$, SIZEW(KL_CONTROLLER));
      437    17270    6                  PTR$->MOVE$TEMP = DSEG2$->MOVE$TEMP;
      438    17271    6                  END;
      439    17272    5               END;
      440    17273    5            IF DEVICE THEN DO;
      441    17274    6               IF NOT FOUND THEN DO;
      442    17275    6                  KL$CONTROLLER.BLKHDR.NSUBS = KL$CONTROLLER.BLKHDR.NSUBS + 1;
      443    17276    6                  PTR$ = DEV$;
      444    17277    6                  DEV_SIZEW = DEV_SIZEW + SIZEW(KL_LINEDEV);
      445    17278    6                  END;
      446    17279    5               MOVE_SIZE = POFFC(DEV_STOP$, PTR$);
      447    17280    6               IF MOVE_SIZE > 0 THEN DO;
      448    17281    6                  IF MOVE_SIZE > DSEG2SIZE THEN
      449    17282    6                     CALL ASB$GET_MORE_SEG(2,4096) ALTRET(GETSEG_ERR);
      450    17283    6                  DSEG2$->MOVE$TEMP = PTR$->MOVE$TEMP;
      451    17284    6                  END;
      452    17285    5               SIZE = POFFC(DEV$,DSEG1$)+SIZEW(KL_LINEDEV)*4+MOVE_SIZE;
      453    17286    6               IF SIZE > DSEG1SIZE THEN DO;
      454    17287    6                  CALL ASB$GET_MORE_SEG(1,SIZE) ALTRET(GETSEG_ERR);
      455    17288    6                  END;
      456    17289    5               DEV$->KL$LINEDEV = KL$LINEDEV;
      457    17290    5               CONT$->KL$CONTROLLER = KL$CONTROLLER;
      458    17291    6               IF MOVE_SIZE > 0 THEN DO;
      459    17292    6                  PTR$ = PINCRW(DEV$, SIZEW(KL_LINEDEV));
      460    17293    6                  PTR$->MOVE$TEMP = DSEG2$->MOVE$TEMP;
      461    17294    6                  END;
      462    17295    5               END;
      463    17296    4            MORE = '0'B;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:15   
      464    17297                                                              /**/
      465    17298    4            SELECT( EOL_VAL ) ;
      466    17299                                                              /**/
      467    17300    4            SELECT( HELP_VAL ) ;
      468    17301    4            CALL ASH$HELP ;
      469    17302                                                              /**/
      470    17303    4            SELECT( QUESTION_VAL ) ;
      471    17304    4            CALL ASH$QUEST ;
      472    17305                                                              /**/
      473    17306    4            SELECT( DQUESTION_VAL ) ;
      474    17307    4            CALL ASH$DQUEST ;
      475    17308                                                              /**/
      476    17309    4            END ; /* Do case( code ) */
      477    17310    3   LOOP_END:
      478    17311    3         END ; /* Do i */
      479    17312    3      DO WHILE( '0'B );
      480    17313    3   LINE_OPT_ERR: CALL ASH$ERROR( P_PCB.ERROR );
      481    17314    3         END;
      482    17315    2      END ; /* Do while */
      483    17316    1   DONE_OPTIONS: ;
      484    17317                                                              /* Output term rec */
      485    17318    1   IF NOT LINE THEN
      486    17319    1      KL$DREC.NWINFO = LINE_DREC.NWINFO + SIZEW( LINE_DREC.LN) + DEV_SIZEW;
      487    17320    1   ELSE IF CREATE THEN
      488    17321    1         KL$DREC.NWINFO = SIZEW( LINE_DREC.LN );
      489    17322    1   ARS = LENGTHC(KL_DREC_CNT) + ( KL$DREC.NWINFO * 4 ) ;
      490    17323    1   USERS_KEY = LINE_KEY ;
      491    17324    1   CALL ASB$WRITE_HLP( DSEG1$, ARS ) ALTRET ( WRITE_LINE_ERR ) ;
      492    17325    2   IF CREATE THEN DO;
      493    17326    2      KL_TERM_REC = '0'B;
      494    17327    2      KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINE_NAME.TEXT;
      495    17328    2      CALL ASB$WRITE_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC)) ALTRET(NETCON_ERR)
             17328               ;
      496    17329    2      CALL ASB$CLOSE_NETCON;
      497    17330    2      END; /* If create */
      498    17331    2   ELSE DO;
      499    17332    2      KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINE_NAME.TEXT;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:16   
      500    17333    2      CALL ASB$READ_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC))
      501    17334    3      WHENALTRETURN DO;
      502    17335    3         IF (MERR_CODE.CODE = %E$NOKEY)
      503    17336    4         THEN DO;
      504    17337    4            KL_TERM_REC = '0'B;
      505    17338    4            KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINE_NAME.TEXT;
      506    17339    4            CALL ASB$WRITE_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC)) ALTRET(
             17339                     NETCON_ERR);
      507    17340    4            END;
      508    17341    4         ELSE DO;
      509    17342    4            GOTO NETCON_ERR;
      510    17343    4            END;
      511    17344    3         END;
      512    17345    2      CALL ASB$CLOSE_NETCON;
      513    17346    2      END;
      514    17347    1   EXIT#:
      515    17348    1   CALL ASB$DEQ_HLP ALTRET( DEQ_ERR ) ;
      516    17349    1   RETURN ;
      517    17350                                                              /* Errors */
      518    17351    1   GETSEG_ERR: ;
      519    17352        %SCREAM( ERR#=%E$GETSEGERR, LEVEL=ERROR, MID='A') ;
      520    17367    1   RETURN ;
      521    17368                                                              /**/
      522    17369                                                              /**/
      523    17370    1   WRITE_LINE_ERR: ;
      524    17371    1   CALL ASH$ERROR( ERR_CODE ) ;
      525    17372    1   RETURN ;
      526    17373                                                              /**/
      527    17374    1   CMD_ERR: ;
      528    17375    1   CALL ASH$ERROR( P_PCB.ERROR ) ;
      529    17376    1   RETURN ;
      530    17377                                      /**/
      531    17378    1   NETCON_ERR:;
      532    17379    1   ERR_CODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      533    17380    1   CALL ASH$ERROR(ERR_CODE);
      534    17381    1   RETURN;
      535    17382                                                              /**/
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:17   
      536    17383    1   CM_LINE_ERR: ;
      537    17384    2   IF MERR_CODE.CODE ~= %E$NOKEY THEN DO;
      538    17385    2      CALL ASA$ERROR( USERS_KEY, E$UNABLE_TO_READ_HLP );
      539    17386    2      RETURN;
      540    17387    2      END;
      541    17388    2   IF LINE THEN DO;
      542    17389    3      IF NOT CREATE THEN DO;
      543    17390        /*E*  ERROR:    ASA-E$LINE_NO_EXIST1-C
      544    17391              MESSAGE0: Line %%U1 %does not exist. Switching to CREATE mode.
      545    17392        */
      546    17393    3         AS_FIELD1 = LINE_NAME;
      547    17394              %SCREAM( ERR#=E$LINE_NO_EXIST1, LEVEL=WARN, MID='A') ;
      548    17409    3         CREATE = AS_TRUE ;
      549    17410    3         END;
      550    17411    2      GOTO CREATE_LINE ;
      551    17412    2      END;
      552    17413    2   ELSE DO;
      553    17414        /*E*  ERROR:    ASA-E$LINE_NO_EXIST2-C
      554    17415              MESSAGE0: Line %%U1 %does not exist.
      555    17416        */
      556    17417    2      AS_FIELD1 = LINE_NAME;
      557    17418           %SCREAM( ERR#=E$LINE_NO_EXIST2, LEVEL=WARN, MID='A') ;
      558    17433    2      RETURN;
      559    17434    2      END;
      560    17435                                                              /**/
      561    17436    1   ENQ_ERR: ;
      562    17437                                                              /**/
      563    17438    1   DEQ_ERR: ;
      564    17439    1   RETURN ;
      565    17440
      566    17441        %EJECT;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:18   
      567    17442    1   FIND_CONTROLLER: PROC ALTRET;
      568    17443
      569    17444
      570    17445                                                          /* Get controller # */
      571    17446    2   IF CONTROLLER THEN
      572    17447    2      BLK$ = P$NODE.SUBLK$(0);
      573    17448    2   ELSE
      574    17449    2      BLK$ = P$NODE.SUBLK$(2);
      575    17450    2   CALL CHARBIN( CONT#, OUT$SYM.TEXT );
      576    17451    3   IF CONT# > 31 THEN DO;
      577    17452        /*E*  ERROR:  ASA-E$BAD_CONT_NUM-C
      578    17453              MESSAGE: Illegal CONTROLLER number.
      579    17454              MESSAGE1: A CONTROLLER number must be between 0 and 31.
      580    17455        */
      581    17456           %SCREAM( ERR#=E$BAD_CONT_NUM, LEVEL=ERROR, MID='A' );
      582    17471    3      ALTRETURN;
      583    17472    3      END;
      584    17473                                                      /* See if the controller exists.*/
      585    17474    2   CONT$ = DEV_START$;
      586    17475    2   DEV_STOP$ = PINCRW( CONT$, DEV_SIZEW);
      587    17476    2   FOUND = '0'B;
      588    17477    2   DONE = '0'B;
      589    17478    3   DO WHILE(CONT$ < DEV_STOP$  AND NOT FOUND  AND NOT DONE );
      590    17479    3      IF CONT$ -> KL$CONTROLLER.CONT# = CONT# THEN
      591    17480    3         FOUND = AS_TRUE;
      592    17481    3      ELSE
      593    17482    3         IF CONT$ -> KL$CONTROLLER.CONT# > CONT# THEN
      594    17483    3            DONE = AS_TRUE;
      595    17484    4         ELSE DO;
      596    17485    4            CONT_INDEX = CONT$ -> KL$CONTROLLER.BLKHDR.NSUBS;
      597    17486    4            CONT$ = PINCRW( CONT$, SIZEW(KL_CONTROLLER)+(CONT_INDEX*SIZEW(KL_LINEDEV)))
             17486                     ;
      598    17487    4            END;
      599    17488    3      END;
      600    17489    2   IF FOUND THEN
      601    17490    3      IF CREATE AND CONTROLLER THEN DO;
      602    17491        /*E*  ERROR:  ASA-E$CONT_EXISTS-C
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:19   
      603    17492              MESSAGE: Controller %U1 already exists.
      604    17493              MESSAGE1: You cannot create a controller that already exists.
      605    17494        */
      606    17495    3         AS_FIELD1.COUNT = OUT$SYM.COUNT;
      607    17496    3         AS_FIELD1.TEXT  = OUT$SYM.TEXT;
      608    17497              %SCREAM( ERR#=E$CONT_EXISTS, LEVEL=ERROR, MID='A' );
      609    17512    3         ALTRETURN;
      610    17513    3         END;
      611    17514    2      ELSE KL$CONTROLLER = CONT$ -> KL$CONTROLLER;
      612    17515    2   ELSE
      613    17516    3      IF DEVICE THEN DO;
      614    17517        /*E*  ERROR:  ASA-E$CONT_NO_EXIST2-C
      615    17518              MESSAGE: Controller %U1 does not exist.
      616    17519              MESSAGE1: Controller %U1 does not exist for line %U2.
      617    17520        */
      618    17521    3         AS_FIELD1.COUNT = OUT$SYM.COUNT;
      619    17522    3         AS_FIELD1.TEXT  = OUT$SYM.TEXT;
      620    17523    3         AS_FIELD2 = LINE_NAME;
      621    17524              %SCREAM( ERR#=E$CONT_NO_EXIST2, LEVEL=ERROR, MID='A' );
      622    17539    3         ALTRETURN;
      623    17540    3         END;
      624    17541    2      ELSE
      625    17542    3         IF NOT CREATE THEN DO;
      626    17543        /*E*  ERROR:  ASA-E$CONT_NO_EXIST1-C
      627    17544              MESSAGE: Controller %U1 does not exist. Switching to CREATE mode.
      628    17545        */
      629    17546    3            AS_FIELD1.COUNT = OUT$SYM.COUNT;
      630    17547    3            AS_FIELD1.TEXT  = OUT$SYM.TEXT;
      631    17548                 %SCREAM( ERR#=E$CONT_NO_EXIST1, LEVEL=WARN, MID='A' );
      632    17563    3            CREATE = AS_TRUE;
      633    17564    3            END;
      634    17565
      635    17566    3   IF CONTROLLER AND CREATE THEN DO;    /* Initialize controller field */
      636    17567    3      KL$CONTROLLER = KL_CONTROLLER;
      637    17568    3      KL$CONTROLLER.CONT# = CONT#;
      638    17569    3      KL$CONTROLLER.BLKHDR.NSUBS = 0;
      639    17570    3      KL$CONTROLLER.BLKHDR.LEV = 2;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:20   
      640    17571    3      KL$CONTROLLER.BLKHDR.DEVNUM = CONT#;
      641    17572    3      KL$CONTROLLER.BLKHDR.BLKTYP = %KLTY_CONT#;
      642    17573    3      LNG_CNT = LENGTHC(KL_CONTROLLER);
      643    17574    3      KL$UBWORD.NUM = 0;
      644    17575    3      KL$UBWORD.REPLACE.T = LNGTH.T;
      645    17576    3      KL$UBWORD.REPLACE.B = LNGTH.B;
      646    17577    3      KL$CONTROLLER.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;
      647    17578    3      KL$CONTROLLER.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;
      648    17579    3      END;
      649    17580    2   END FIND_CONTROLLER;
      650    17581        %EJECT;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:21   
      651    17582    1   FIND_DEVICE: PROC ALTRET;
      652    17583
      653    17584
      654    17585    2   BLK$ = P$NODE.SUBLK$(0);
      655    17586    2   CALL CHARBIN(DEV#, OUT$SYM.TEXT);
      656    17587    3   IF DEV# > 31 THEN DO;
      657    17588        /*E*  ERROR:  ASA-E$BAD_CONT_DEV_NUM-C
      658    17589              MESSAGE: Invalid DEVICE number.
      659    17590              MESSAGE1: A DEVICE number must be between 0 and 31.
      660    17591        */
      661    17592           %SCREAM( ERR#=E$BAD_CONT_DEV_NUM, LEVEL=ERROR, MID='A' );
      662    17607    3      ALTRETURN;
      663    17608    3      END;
      664    17609
      665    17610    2   DEV$ = PINCRW (CONT$, SIZEW( KL_CONTROLLER));
      666    17611    2   DEV_END$ = PINCRW(DEV$, KL$CONTROLLER.BLKHDR.NSUBS*SIZEW(KL_LINEDEV));
      667    17612    2   FOUND = '0'B;
      668    17613    2   DONE = '0'B;
      669    17614    3   DO WHILE( DEV$ < DEV_END$  AND  NOT FOUND  AND  NOT DONE );
      670    17615    3      IF DEV$->KL$LINEDEV.DEVICE# = DEV# AND DEV$->KL$LINEDEV.CONTROLLER# = CONT# THEN
      671    17616    3         FOUND = '1'B;
      672    17617    3      ELSE
      673    17618    3         IF DEV$->KL$LINEDEV.DEVICE# > DEV# AND DEV$->KL$LINEDEV.CONTROLLER# = CONT#
             17618                  THEN
      674    17619    3            DONE = '1'B;
      675    17620    3         ELSE
      676    17621    3            DEV$ = PINCRW(DEV$, SIZEW(KL_LINEDEV));
      677    17622    3      END;
      678    17623
      679    17624    3   IF FOUND THEN DO;
      680    17625    4      IF CREATE THEN DO;
      681    17626        /*E*  ERROR:  ASA-E$CONT_DEV_EXISTS-C
      682    17627              MESSAGE: Device %U1 already exists.
      683    17628              MESSAGE1: Device %U1 for line %U3 controller %U2 already exists.
      684    17629                        You cannot create a device that already exists.
      685    17630        */
      686    17631              %NUMBER( NUM1=DEV#, NUM2=CONT# );
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:22   
             17639    4         CALL ASB$BINCHAR( AS_FIELD1.TEXT, 0, -1, DEV# );
             17647    4         CALL ASB$BINCHAR( AS_FIELD2.TEXT, 0, -2, CONT# );
      687    17661    4         AS_FIELD3 = LINE_NAME;
      688    17662              %SCREAM( ERR#=E$CONT_DEV_EXISTS, LEVEL=ERROR,MID='A');
      689    17677    4         ALTRETURN;
      690    17678    4         END;
      691    17679    3      KL$LINEDEV = DEV$->KL$LINEDEV;
      692    17680    3      END;
      693    17681    3   ELSE DO;
      694    17682    4      IF NOT CREATE THEN DO;
      695    17683        /*E*  ERROR:  ASA-E$LINEDEV_NO_EXIST2-C
      696    17684              MESSAGE: Device %U1 does not exist. Switching to CREATE mode.
      697    17685        */
      698    17686              %NUMBER( NUM1=DEV# );
             17694    4         CALL ASB$BINCHAR( AS_FIELD1.TEXT, 0, -1, DEV# );
      699    17716              %SCREAM(ERR#=E$LINEDEV_NO_EXIST2,LEVEL=WARN,MID='A');
      700    17731    4         CREATE = AS_TRUE;
      701    17732    4         END;
      702    17733    3      KL$LINEDEV = KL_LINEDEV;
      703    17734    3      KL$LINEDEV.CONTROLLER# = CONT#;
      704    17735    3      KL$LINEDEV.DEVICE#  = DEV#;
      705    17736    3      KL$LINEDEV.BLKHDR.LEV = 3;
      706    17737    3      KL$LINEDEV.BLKHDR.NSUBS = 0;
      707    17738    3      KL$LINEDEV.BLKHDR.DEVNUM = DEV#;
      708    17739    3      KL$LINEDEV.BLKHDR.BLKTYP = %KLTY_LINEDEV#;
      709    17740    3      LNG_CNT = LENGTHC(KL_LINEDEV);
      710    17741    3      KL$UBWORD.NUM = 0;
      711    17742    3      KL$UBWORD.REPLACE.T = LNGTH.T;
      712    17743    3      KL$UBWORD.REPLACE.B = LNGTH.B;
      713    17744    3      KL$LINEDEV.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;
      714    17745    3      KL$LINEDEV.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;
      715    17746    3      END;
      716    17747
      717    17748    2   END FIND_DEVICE;
      718    17749    1   END   ASA$LINE_CONTROLLER ;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:23   
--  Include file information  --

   AS_SUPER_R.:E05TOU  cannot be made into a system file and is referenced.
   XU_FORMAT_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_CONFIG_M.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   AS_PERR_C.:E05TOU  is referenced.
   AS_SSUBS_C.:E05TOU  is referenced.
   AS_SUBS_C.:E05TOU  is referenced.
   AS_SUPER_C.:E05TOU  is referenced.
   AS_MAC_C.:E05TOU  cannot be made into a system file and is referenced.
   AS_ENTRIES_M.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ASA$LINE_CONTROLLER.

   Procedure ASA$LINE_CONTROLLER requires 1201 words for executable code.
   Procedure ASA$LINE_CONTROLLER requires 310 words of local(AUTO) storage.

    No errors detected in file ASA$LINE_CONTROLLER.:E05TSI    .

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:24   

 Object Unit name= ASA$LINE_CONTROLLER                        File name= ASA$LINE_CONTROLLER.:E05TOU
 UTS= JUL 29 '97 08:38:35.52 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$LO
    2   Data  even  none    14     16  ASA$LINE_CONTROLLER
    3  RoData even  UTS     60     74  ASA$LINE_CONTROLLER
    4   Proc  even  none  1201   2261  ASA$LINE_CONTROLLER
    5  RoData even  none    54     66  ASA$LINE_CONTROLLER

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes            yes      Std        0  ASA$LINE_CONTROLLER
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:25   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 XU_OUTPUT_OPTIONS
         yes           Std       2 ASB$READ_SI
 yes     yes           Std       2 ASB$WRITE_HLP
 yes     yes           Std       1 X$PARSE
 yes     yes           Std       0 ASB$GETSEG
         yes           Std       2 ASH$ERROR
 yes     yes           Std       0 ASB$ENQ_HLP
 yes     yes           Std       3 ASB$READ_HLP
 yes     yes           Std       3 ASD$READ_PRO
 yes     yes           Std       2 ASB$GET_MORE_SEG
         yes           Std       0 ASH$HELP
         yes           Std       0 ASH$QUEST
 yes     yes           Std       3 ASB$WRITE_NETCON
 yes     yes           Std       3 ASB$READ_NETCON
         yes           Std       3 ASA$ERROR
 yes     yes           Std       0 ASB$DEQ_HLP
 yes     yes           Std       3 ASB$SET_PROMPT
         yes           Std       2 ASH$WARN
         yes           Std       0 ASH$DQUEST
 yes     yes           Std       5 ASB$CHECK_TYPE
 yes     yes           Std       0 ASB$CLOSE_NETCON
         yes           Std       4 ASB$BINCHAR
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:26   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    AS_TRUE                          r    AS_MODE
r    AS_FE_MODE                            M$LO                                  USERS_KEY
     BLANK_PASS                            IN_BUF                                NODE$
     CODE                                  ERR_CODE                              AS_FIELD1
     AS_FIELD2                             AS_FIELD3                             REMEM_VAR
     REM_FCMD                              ASA_BRKS_LOC                          DSEG_FLG
     DSEG1$                                DSEG1SIZE                             DSEG2$
     DSEG2SIZE                             DSEG3$                                DSEG3SIZE
     P_PCB                                 KL_DREC_CNT                           LINE_CMD
     LINE_OPTS_LIST                        CONTROLLER_CMD                        CONT_OPTS_LIST
     LINE_DEV_CMD                          CONT_DEV_OPTS_LIST                    B$TCB$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:27   


        1        1        /*M* ASA$LINE_C0NTROLLER - Processes the LINE profile. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*  DMC,DMR,CCC,PLM=0,IND=3,CTI=5,DCI=6,IAD=0,DTI=0,IDT=0,ENI=3,
        8        8              ECU=3,CSU=3,SDI=3                                           */
        9        9
       10       10        ASA$LINE_CONTROLLER: PROC;

     10  4 000000   000000 700200 xent  ASA$LINE_CO* TSX0  ! X66_AUTO_0
         4 000001   000466 000000                    ZERO    310,0

       11       11
       12       12
       13       13        /*********************************************************************/
       14       14        /*   Include files   include files   include files   include files   */
       15       15        /*********************************************************************/
       16       16                                                              /**/
       17       17              %INCLUDE  AS_ENTRIES_M  ;
       18     1067              %INCLUDE  AS_MAC_C      ;
       19     1147              %INCLUDE  AS_SUPER_C    ;
       20     1582              %INCLUDE  AS_SUBS_C     ;
       21     2996              %INCLUDE  AS_SSUBS_C    ;
       22     3088              %INCLUDE  AS_PERR_C     ;
       23     3690              %INCLUDE  CP_6          ;
       24     3771              %INCLUDE  CP_6_SUBS     ;
       25     4311              %INCLUDE  KL_CONFIG_M   ;
       26     5073              %INCLUDE  KL_SUPER_C    ;
       27     7975              %INCLUDE  B_ERRORS_C    ;
       28     9102              %INCLUDE  XU_MACRO_C    ;
       29    12208              %INCLUDE  XU_FORMAT_C   ;
       30    12370              %INCLUDE  AS_SUPER_R    ;
       31    15386        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:28   
       32    15387        /********************************************************************/
       33    15388        /*   Auto data       auto data       auto data       auto data       */
       34    15389        /*********************************************************************/
       35    15390                                                              /**/
       36    15391    1   DCL SUBNDS SBIN WORD ;
       37    15392    1   DCL SUBS SBIN WORD ;
       38    15393    1   DCL PTR$ PTR ;
       39    15394    1   DCL CNT SBIN WORD ;
       40    15395    1   DCL I SBIN WORD ;
       41    15396    1   DCL J SBIN WORD ;
       42    15397    1   DCL K SBIN WORD ;
       43    15398    1   DCL ARS SBIN WORD ;
       44    15399    1   DCL CONT# SBIN WORD ;
       45    15400    1   DCL CONT_INDEX SBIN WORD ;
       46    15401    1   DCL DEV# SBIN WORD ;
       47    15402    1   DCL CONT_EXISTS BIT(1);
       48    15403    1   DCL ROWS SBIN WORD ;
       49    15404    1   DCL COLUMNS SBIN WORD ;
       50    15405    1   DCL MOVE_SIZE SBIN WORD ;
       51    15406    1   DCL SIZE SBIN WORD ;
       52    15407    1   DCL MORE BIT(1) ;
       53    15408    1   DCL CODE2 SBIN WORD ;
       54    15409    1   DCL CONTPTR$ PTR;
       55    15410    1   DCL CONT$ PTR;
       56    15411    1   DCL BLK$ PTR ;
       57    15412    1   DCL DEV$ PTR ;
       58    15413    1   DCL TYPE$ PTR ;
       59    15414    1   DCL DEV_END$ PTR;
       60    15415    1   DCL DEV_START$ PTR;
       61    15416    1   DCL DEV_STOP$ PTR;
       62    15417    1   DCL DEV_SIZEW SBIN;
       63    15418    1   DCL FOUND BIT(1);
       64    15419    1   DCL DONE  BIT(1);
       65    15420    1   DCL LINE BIT(1);
       66    15421    1   DCL CONTROLLER BIT(1);
       67    15422    1   DCL DEVICE BIT(1);
       68    15423    1   DCL PRO$ PTR ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:29   
       69    15424    1   DCL CREATE BIT(1) ;
       70    15425    1   DCL DEV_CREATE BIT(1) ;
       71    15426    1   DCL PRO_BUF CHAR(AS_PRO_BUF_SIZEC);
       72    15427    1   DCL 1 LINE_NAME,
       73    15428    1          2 COUNT UBIN BYTE UNAL,
       74    15429    1          2 TEXT CHAR(8) UNAL;
       75    15430        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:30   
       76    15431        /********************************************************************/
       77    15432        /*   Symref's        symref's        symref's        symref's        */
       78    15433        /*********************************************************************/
       79    15434                                                              /**/
       80    15435    1   DCL LINE_CMD UBIN SYMREF;
       81    15436    1   DCL LINE_OPTS_LIST UBIN SYMREF;
       82    15437    1   DCL CONTROLLER_CMD  UBIN SYMREF;
       83    15438    1   DCL CONT_OPTS_LIST UBIN SYMREF;
       84    15439    1   DCL LINE_DEV_CMD UBIN SYMREF;
       85    15440    1   DCL CONT_DEV_OPTS_LIST UBIN SYMREF;
       86    15441    1   DCL B$TCB$ PTR SYMREF;
       87    15442                                                              /**/
       88    15443        /********************************************************************/
       89    15444        /*   Static data     static data     static data     static data     */
       90    15445        /*********************************************************************/
       91    15446                                                              /**/
       92    15447    1   DCL 1 LINE_KEY ALIGNED STATIC ,
       93    15448    1          2 CNT UBIN BYTE UNAL INIT( 9 ),
       94    15449    1          2 TXT UNAL ,
       95    15450    1             3 LINE CHAR(8) UNAL INIT(' ') ,
       96    15451    1             3 ASTR CHAR(1) UNAL INIT('*') ;
       97    15452    1   DCL 1 LNGTH ALIGNED STATIC,
       98    15453    1          2 T UBIN(28) UNAL INIT(0),
       99    15454    1          2 B UBIN(8) UNAL INIT(0);
      100    15455    1   DCL LNG_CNT REDEF LNGTH UBIN;
      101    15456        %KL$TERM (NAME=KL_TERM_REC,STCLASS=STATIC);
      102    15505        %KL$TERM_KEY (NAME=KL_TERM_KEY,STCLASS=STATIC);
      103    15551                                                              /**/
      104    15552        /********************************************************************/
      105    15553        /*   Constant data   constant data   constant data   constant data   */
      106    15554        /*********************************************************************/
      107    15555                                                              /**/
      108    15556        %KL_DREC( NAME = LINE_DREC ,
      109    15557                  STCLASS = CONSTANT ,
      110    15558                  TYP = %KLAT_LINE# ,
      111    15559                  SUPR = AS_LINE# ,
      112    15560                  WSN = ' ' ,
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:31   
      113    15561                  TNM = ' ' ,
      114    15562                  RNAME = ' ' ,
      115    15563                  PASS = ' ' ,
      116    15564                  PRO = ' ' ,
      117    15565                  WORG = ' ',
      118    15566                  LAST = "," );
      119    15679        %KL_LN3270( NAME = LN,
      120    15680                    LVL = 2,
      121    15681                    STCLASS = CONSTANT);
      122    15823        %KL_CONTROLLER(
      123    15824                  LVL=1,
      124    15825                  STCLASS=CONSTANT,
      125    15826                  LAST=";" );
      126    15975        %KL_LINEDEV(
      127    15976                  LVL=1,
      128    15977                  STCLASS=CONSTANT );
      129    16126    1   DCL TYPE_(0:15) UBIN CONSTANT INIT(0,
      130    16127    1                                      2780,
      131    16128    1                                      3271,
      132    16129    1                                      3274,
      133    16130    1                                      3275,
      134    16131    1                                      3276,
      135    16132    1                                      3277,
      136    16133    1                                      3278,
      137    16134    1                                      3279,
      138    16135    1                                      3284,
      139    16136    1                                      3286,
      140    16137    1                                      3287,
      141    16138    1                                      3288,
      142    16139    1                                      3289,
      143    16140    1                                      7700,
      144    16141    1                                      7804 );
      145    16142
      146    16143        %PLIST ;
      147    16144        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:32   
      148    16145        /*********************************************************************/
      149    16146        /*   Local based     local based     local based     local based     */
      150    16147        /*********************************************************************/
      151    16148                                                              /**/
      152    16149        %PARSE$OUT( NAME=P$NODE, STCLASS="BASED(NODE$)",
      153    16150                    NDTYPE=TYPE, NSUBLKS=SUBNODES) ;
      154    16195        %PARSE$SYM( NAME = OUT$SYM ,
      155    16196                    STCLASS="BASED(BLK$)") ;
      156    16234        %KL_DREC (NAME = KL$DREC ,
      157    16235                  LAST=",",
      158    16236                  STCLASS="BASED( DSEG1$ )");
      159    16349        %KL_LN3270( NAME = LN,
      160    16350                    LVL = 2,
      161    16351                    STCLASS = BASED );
      162    16493        %KL_CONTROLLER( NAME=KL$CONTROLLER,
      163    16494                        LVL=1,
      164    16495                        LAST=";",
      165    16496                        STCLASS="BASED(CONTPTR$)" );
      166    16645        %KL_LINEDEV( NAME=KL$LINEDEV,
      167    16646                     LVL=1,
      168    16647                     STCLASS="BASED(DSEG3$)" );
      169    16796        %KL_PHDR( NAME = KL$PHDR, STCLASS="BASED( PRO$ )" );
      170    16837        %KL$UWORD( NAME = KL$UWORD, STCLASS="BASED( TYPE$ )" );
      171    16842        %KL$UBWORD( NAME = KL$UBWORD, STCLASS=AUTO );
      172    16852    1   DCL MOVE$TEMP CHAR(MOVE_SIZE) BASED;
      173    16853        %B$TCB;
      174    16856        %B$ALT;
      175    16864        %PLIST ;
      176    16865        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:33   
      177    16866        /********************************************************************/
      178    16867        /*   Entry dcls      entry dcls      entry dcls      entry dcls      */
      179    16868        /*********************************************************************/
      180    16869                                                              /**/
      181    16870    1   DCL X$PARSE ENTRY(1) ALTRET ;
      182    16871        %ASB$ENQ_HLP ;
      183    16874        %ASB$DEQ_HLP ;
      184    16877        %ASB$READ_HLP ;
      185    16880        %ASB$WRITE_HLP ;
      186    16883        %ASB$WRITE_LO ;
      187    16886        %ASB$GETSEG ;
      188    16889        %ASB$READ_SI ;
      189    16892        %ASB$FIND_NUM ;
      190    16895        %ASB$SET_PROMPT ;
      191    16898        %ASD$READ_PRO ;
      192    16901        %ASH$ERROR ;
      193    16904        %ASH$WARN ;
      194    16907        %ASH$INFO ;
      195    16910        %ASZ$SCRAMBLE ;
      196    16913        %ASH$HELP ;
      197    16916        %ASH$QUEST ;
      198    16919        %ASH$DQUEST ;
      199    16922        %ASB$GET_MORE_SEG ;
      200    16925        %ASA$ERROR ;
      201    16928        %ASB$CHECK_TYPE ;
      202    16931        %ASB$READ_NETCON ;
      203    16934        %ASB$WRITE_NETCON ;
      204    16937        %ASB$CLOSE_NETCON ;
      205    16940        %EJECT ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:34   
      206    16941        /********************************************************************/
      207    16942        /*   Procedure       procedure       procedure       procedure       */
      208    16943        /*********************************************************************/
      209    16944                                                              /**/
      210    16945        /*
      211    16946            ***            Begin procedure                    ***
      212    16947        */
      213    16948    1   LINE = (P$NODE.CODE = CR_MOD_LINE_VAL);

  16948  4 000002   400000 220003                    LDX0    -131072,DU
         4 000003   000000 470400 xsym               LDP0    NODE$
         4 000004   000000 721100                    LXL1    0,,PR0
         4 000005   000071 101003                    CMPX1   57,DU
         4 000006   000010 600000 4                  TZE     s:16948+6
         4 000007   000000 220003                    LDX0    0,DU
         4 000010   000000 636010                    EAQ     0,X0
         4 000011   200040 756100                    STQ     LINE,,AUTO

      214    16949    1   CONTROLLER = (P$NODE.CODE = CR_MOD_CONT_VAL);

  16949  4 000012   400000 220003                    LDX0    -131072,DU
         4 000013   000072 101003                    CMPX1   58,DU
         4 000014   000016 600000 4                  TZE     s:16949+4
         4 000015   000000 220003                    LDX0    0,DU
         4 000016   000000 636010                    EAQ     0,X0
         4 000017   200041 756100                    STQ     CONTROLLER,,AUTO

      215    16950    1   DEVICE = (P$NODE.CODE = CR_MOD_LINE_DEV_VAL);

  16950  4 000020   400000 220003                    LDX0    -131072,DU
         4 000021   000075 101003                    CMPX1   61,DU
         4 000022   000024 600000 4                  TZE     s:16950+4
         4 000023   000000 220003                    LDX0    0,DU
         4 000024   000000 636010                    EAQ     0,X0
         4 000025   200042 756100                    STQ     DEVICE,,AUTO

      216    16951    1   IF LINE THEN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:35   

  16951  4 000026   200040 234100                    SZN     LINE,,AUTO
         4 000027   000033 605000 4                  TPL     s:16954

      217    16952    1      P_PCB.ROOT$ = ADDR( LINE_CMD ) ;

  16952  4 000030   000000 236000 5                  LDQ     0
         4 000031   000001 756000 xsym               STQ     P_PCB+1
         4 000032   000042 710000 4                  TRA     s:16958

      218    16953    1   ELSE
      219    16954    1      IF CONTROLLER THEN

  16954  4 000033   200041 234100                    SZN     CONTROLLER,,AUTO
         4 000034   000040 605000 4                  TPL     s:16957

      220    16955    1         P_PCB.ROOT$ = ADDR( CONTROLLER_CMD ) ;

  16955  4 000035   000001 236000 5                  LDQ     1
         4 000036   000001 756000 xsym               STQ     P_PCB+1
         4 000037   000042 710000 4                  TRA     s:16958

      221    16956    1      ELSE
      222    16957    1         P_PCB.ROOT$ = ADDR( LINE_DEV_CMD );

  16957  4 000040   000002 236000 5                  LDQ     2
         4 000041   000001 756000 xsym               STQ     P_PCB+1

      223    16958    1   CALL X$PARSE( P_PCB ) ALTRET( CMD_ERR ) ;

  16958  4 000042   000003 630400 5                  EPPR0   3
         4 000043   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000044   000000 701000 xent               TSX1    X$PARSE
         4 000045   001431 702000 4                  TSX2    CMD_ERR

      224    16959                                                              /**/
      225    16960    1   NODE$ = P_PCB.OUT$ ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:36   

  16960  4 000046   000003 236000 xsym               LDQ     P_PCB+3
         4 000047   000000 756000 xsym               STQ     NODE$

      226    16961                                                              /**/
      227    16962    1   CREATE = ( P$NODE.CODE = CREATE_VAL );

  16962  4 000050   400000 220003                    LDX0    -131072,DU
         4 000051   000000 470400 xsym               LDP0    NODE$
         4 000052   000000 721100                    LXL1    0,,PR0
         4 000053   000043 101003                    CMPX1   35,DU
         4 000054   000056 600000 4                  TZE     s:16962+6
         4 000055   000000 220003                    LDX0    0,DU
         4 000056   000000 636010                    EAQ     0,X0
         4 000057   200044 756100                    STQ     CREATE,,AUTO

      228    16963                                                              /**/
      229    16964    1   USERS_KEY = '0'B ;

  16964  4 000060   000000 100400                    MLR     fill='000'O
         4 000061   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         4 000062   000000 000052 xsym               ADSC9   USERS_KEY                cn=0,n=42

      230    16965    1   IF NOT DSEG_FLG THEN CALL ASB$GETSEG ALTRET( GETSEG_ERR );

  16965  4 000063   000000 234000 xsym               SZN     DSEG_FLG
         4 000064   000070 604000 4                  TMI     s:16967

  16965  4 000065   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 000066   000000 701000 xent               TSX1    ASB$GETSEG
         4 000067   001417 702000 4                  TSX2    GETSEG_ERR

      231    16966                                                          /* Check existence of line */
      232    16967    1   IF LINE THEN

  16967  4 000070   200040 234100                    SZN     LINE,,AUTO
         4 000071   000077 605000 4                  TPL     s:16970
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:37   

      233    16968    1      BLK$ = NODE$ -> P$NODE.SUBLK$(0) -> P$NODE.SUBLK$(0) ;

  16968  4 000072   000000 470400 xsym               LDP0    NODE$
         4 000073   000003 471500                    LDP1    3,,PR0
         4 000074   100003 236100                    LDQ     3,,PR1
         4 000075   200027 756100                    STQ     BLK$,,AUTO
         4 000076   000103 710000 4                  TRA     s:16971

      234    16969    1   ELSE
      235    16970    1      BLK$ = NODE$ -> P$NODE.SUBLK$(1) -> P$NODE.SUBLK$(0) ;

  16970  4 000077   000000 470400 xsym               LDP0    NODE$
         4 000100   000004 471500                    LDP1    4,,PR0
         4 000101   100003 236100                    LDQ     3,,PR1
         4 000102   200027 756100                    STQ     BLK$,,AUTO

      236    16971    2   IF OUT$SYM.COUNT > 8 THEN DO;

  16971  4 000103   200027 471500                    LDP1    BLK$,,AUTO
         4 000104   100004 236100                    LDQ     4,,PR1
         4 000105   777000 376003                    ANQ     -512,DU
         4 000106   011000 116003                    CMPQ    4608,DU
         4 000107   000115 602000 4                  TNC     s:16993

      237    16972        /*E*  ERROR:    ASA-E$LNAMETOOBIG-C
      238    16973              MESSAGE:  Line name too long.
      239    16974              MESSAGE1: Line names can be at most 8 characters.
      240    16975        */
      241    16976           %SCREAM( ERR#=E$LNAMETOOBIG, LEVEL=ERROR, MID='A' );

  16988  4 000110   000004 630400 5                  EPPR0   4
         4 000111   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000112   000000 701000 xent               TSX1    ASH$ERROR
         4 000113   000000 011000                    NOP     0

      242    16991    2      RETURN ;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:38   

  16991  4 000114   000000 702200 xent               TSX2  ! X66_ARET

      243    16992    2      END ;    /* Then do */
      244    16993    1   LINE_NAME.COUNT = OUT$SYM.COUNT ;

  16993  4 000115   100004 236100                    LDQ     4,,PR1
         4 000116   200446 552140                    STBQ    LINE_NAME,'40'O,AUTO

      245    16994    1   LINE_NAME.TEXT  = OUT$SYM.TEXT ;

  16994  4 000117   100004 236100                    LDQ     4,,PR1
         4 000120   000033 772000                    QRL     27
         4 000121   000000 620006                    EAX0    0,QL
         4 000122   040100 100540                    MLR     fill='040'O
         4 000123   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
         4 000124   200446 200010                    ADSC9   LINE_NAME,,AUTO          cn=1,n=8

      246    16995    1   LINE_KEY.TXT.LINE = OUT$SYM.TEXT ;

  16995  4 000125   100004 236100                    LDQ     4,,PR1
         4 000126   000033 772000                    QRL     27
         4 000127   000000 620006                    EAX0    0,QL
         4 000130   040000 100540                    MLR     fill='040'O
         4 000131   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
         4 000132   000000 200010 2                  ADSC9   LINE_KEY                 cn=1,n=8

      247    16996    1   USERS_KEY = LINE_KEY ;

  16996  4 000133   000000 100400                    MLR     fill='000'O
         4 000134   000000 000012 2                  ADSC9   LINE_KEY                 cn=0,n=10
         4 000135   000000 000052 xsym               ADSC9   USERS_KEY                cn=0,n=42

      248    16997    1   CALL ASB$ENQ_HLP ALTRET( ENQ_ERR ) ;

  16997  4 000136   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 000137   000000 701000 xent               TSX1    ASB$ENQ_HLP
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:39   
         4 000140   001507 702000 4                  TSX2    ENQ_ERR

      249    16998    1   ARS = DSEG1SIZE ;

  16998  4 000141   000000 235000 xsym               LDA     DSEG1SIZE
         4 000142   200012 755100                    STA     ARS,,AUTO

      250    16999    1   CALL ASB$READ_HLP( DSEG1$, ARS, 1 ) ALTRET( CM_LINE_ERR ) ;

  16999  4 000143   000005 236000 5                  LDQ     5
         4 000144   200456 756100                    STQ     KL$UBWORD+5,,AUTO
         4 000145   200012 630500                    EPPR0   ARS,,AUTO
         4 000146   200455 450500                    STP0    KL$UBWORD+4,,AUTO
         4 000147   000006 236000 5                  LDQ     6
         4 000150   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 000151   200454 630500                    EPPR0   KL$UBWORD+3,,AUTO
         4 000152   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 000153   000000 701000 xent               TSX1    ASB$READ_HLP
         4 000154   001447 702000 4                  TSX2    CM_LINE_ERR

      251    17000    1  CALL ASB$CHECK_TYPE( DSEG1$, ARS, AS_LINE#, CREATE & LINE, LINE_NAME ) ALTRET(EXIT#)
             17000            ;

  17000  4 000155   200040 236100                    LDQ     LINE,,AUTO
         4 000156   400000 376003                    ANQ     -131072,DU
         4 000157   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 000160   200044 236100                    LDQ     CREATE,,AUTO
         4 000161   400000 376003                    ANQ     -131072,DU
         4 000162   200454 376100                    ANQ     KL$UBWORD+3,,AUTO
         4 000163   200456 676100                    ERQ     KL$UBWORD+5,,AUTO
         4 000164   400000 376003                    ANQ     -131072,DU
         4 000165   200456 656100                    ERSQ    KL$UBWORD+5,,AUTO
         4 000166   200446 630500                    EPPR0   LINE_NAME,,AUTO
         4 000167   200464 450500                    STP0    KL$UBWORD+11,,AUTO
         4 000170   200456 631500                    EPPR1   KL$UBWORD+5,,AUTO
         4 000171   200463 451500                    STP1    KL$UBWORD+10,,AUTO
         4 000172   000007 236000 5                  LDQ     7
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:40   
         4 000173   200462 756100                    STQ     KL$UBWORD+9,,AUTO
         4 000174   200012 633500                    EPPR3   ARS,,AUTO
         4 000175   200461 453500                    STP3    KL$UBWORD+8,,AUTO
         4 000176   000006 236000 5                  LDQ     6
         4 000177   200460 756100                    STQ     KL$UBWORD+7,,AUTO
         4 000200   200460 630500                    EPPR0   KL$UBWORD+7,,AUTO
         4 000201   000023 631400 xsym               EPPR1   B_VECTNIL+19
         4 000202   000000 701000 xent               TSX1    ASB$CHECK_TYPE
         4 000203   001413 702000 4                  TSX2    EXIT#

      252    17001    2   IF LINE AND CREATE THEN DO;

  17001  4 000204   200040 234100                    SZN     LINE,,AUTO
         4 000205   000223 605000 4                  TPL     CREATE_LINE
         4 000206   200044 234100                    SZN     CREATE,,AUTO
         4 000207   000223 605000 4                  TPL     CREATE_LINE

      253    17002        /*E*  ERROR:    ASA-E$LINE_ALREADY_EXISTS-C
      254    17003              MESSAGE0: Line %%U1 %already exists.
      255    17004              MESSAGE1: Cannot CREATE a line that already exists.
      256    17005        */
      257    17006    2      AS_FIELD1 = LINE_NAME;

  17006  4 000210   000000 100500                    MLR     fill='000'O
         4 000211   200446 000011                    ADSC9   LINE_NAME,,AUTO          cn=0,n=9
         4 000212   000000 000051 xsym               ADSC9   AS_FIELD1                cn=0,n=41

      258    17007           %SCREAM( ERR#=E$LINE_ALREADY_EXISTS, LEVEL=ERROR, MID='A') ;

  17019  4 000213   000010 630400 5                  EPPR0   8
         4 000214   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000215   000000 701000 xent               TSX1    ASH$ERROR
         4 000216   000000 011000                    NOP     0

      259    17022    2      CALL ASB$DEQ_HLP ;

  17022  4 000217   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:41   
         4 000220   000000 701000 xent               TSX1    ASB$DEQ_HLP
         4 000221   000000 011000                    NOP     0

      260    17023    2      RETURN ;

  17023  4 000222   000000 702200 xent               TSX2  ! X66_ARET

  17001  4 000223                       CREATE_LINE  null
      261    17024    2      END ; /* Then do */
      262    17025    1   CREATE_LINE: ;
      263    17026                                                              /**/
      264    17027    2   IF NOT LINE THEN DO;

  17027  4 000223   200040 234100                    SZN     LINE,,AUTO
         4 000224   000260 604000 4                  TMI     s:17035

      265    17028    2      DEV_START$ = PINCRW(ADDR(KL$DREC.LN), SIZEW(KL$DREC.LN) );

  17028  4 000225   000000 236000 xsym               LDQ     DSEG1$
         4 000226   000023 036003                    ADLQ    19,DU
         4 000227   200033 756100                    STQ     DEV_START$,,AUTO

      266    17029    2      DEV_SIZEW = KL$DREC.NWINFO - POFFW(DEV_START$,ADDR(KL$DREC.LN));

  17029  4 000230   000000 236000 xsym               LDQ     DSEG1$
         4 000231   000020 036003                    ADLQ    16,DU
         4 000232   000022 772000                    QRL     18
         4 000233   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 000234   200033 236100                    LDQ     DEV_START$,,AUTO
         4 000235   000022 772000                    QRL     18
         4 000236   200454 136100                    SBLQ    KL$UBWORD+3,,AUTO
         4 000237   200455 756100                    STQ     KL$UBWORD+4,,AUTO
         4 000240   000000 470400 xsym               LDP0    DSEG1$
         4 000241   000017 236100                    LDQ     15,,PR0
         4 000242   200455 136100                    SBLQ    KL$UBWORD+4,,AUTO
         4 000243   200035 756100                    STQ     DEV_SIZEW,,AUTO

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:42   
      267    17030    2      CONTPTR$ = PINCRC( DSEG3$, DSEG3SIZE/2 );

  17030  4 000244   000000 236000 xsym               LDQ     DSEG3SIZE
         4 000245   000001 772000                    QRL     1
         4 000246   000020 736000                    QLS     16
         4 000247   000000 036000 xsym               ADLQ    DSEG3$
         4 000250   200025 756100                    STQ     CONTPTR$,,AUTO

      268    17031    2      CALL FIND_CONTROLLER ALTRET(EXIT#);

  17031  4 000251   001510 701000 4                  TSX1    FIND_CONTROLLER
         4 000252   001413 702000 4                  TSX2    EXIT#

      269    17032    2      IF DEVICE THEN CALL FIND_DEVICE ALTRET(EXIT#);

  17032  4 000253   200042 234100                    SZN     DEVICE,,AUTO
         4 000254   000330 605000 4                  TPL     s:17050

  17032  4 000255   001774 701000 4                  TSX1    FIND_DEVICE
         4 000256   001413 702000 4                  TSX2    EXIT#

      270    17033    2      END;

  17033  4 000257   000330 710000 4                  TRA     s:17050

      271    17034    1   ELSE
      272    17035    2      IF CREATE THEN DO;          /* Initialize the line record */

  17035  4 000260   200044 234100                    SZN     CREATE,,AUTO
         4 000261   000330 605000 4                  TPL     s:17050

      273    17036    2         KL$DREC = LINE_DREC;

  17036  4 000262   000000 470400 xsym               LDP0    DSEG1$
         4 000263   000100 100400                    MLR     fill='000'O
         4 000264   000000 000114 3                  ADSC9   LINE_DREC                cn=0,n=76
         4 000265   000000 000114                    ADSC9   0,,PR0                   cn=0,n=76
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:43   

      274    17037    2         KL$DREC.PASSWORD = BLANK_PASS;

  17037  4 000266   000000 470400 xsym               LDP0    DSEG1$
         4 000267   040100 100400                    MLR     fill='040'O
         4 000270   000000 000010 xsym               ADSC9   BLANK_PASS               cn=0,n=8
         4 000271   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8

      275    17038    2         KL$DREC.LN = LINE_DREC.LN;

  17038  4 000272   000100 100400                    MLR     fill='000'O
         4 000273   000020 000014 3                  ADSC9   LINE_DREC+16             cn=0,n=12
         4 000274   000020 000014                    ADSC9   16,,PR0                  cn=0,n=12

      276    17039    2         KL$DREC.LN.BLKHDR.LEV = 1;

  17039  4 000275   001000 236003                    LDQ     512,DU
         4 000276   000020 552140                    STBQ    16,'40'O,PR0

      277    17040    2         KL$DREC.LN.BLKHDR.NSUBS = 0;

  17040  4 000277   000000 236003                    LDQ     0,DU
         4 000300   000020 552120                    STBQ    16,'20'O,PR0

      278    17041    2         KL$DREC.LN.BLKHDR.BLKTYP = %KLTY_3270#;

  17041  4 000301   007000 236003                    LDQ     3584,DU
         4 000302   000021 552140                    STBQ    17,'40'O,PR0

      279    17042    2         LNG_CNT = LENGTHC( LINE_DREC.LN );

  17042  4 000303   000014 235007                    LDA     12,DL
         4 000304   000003 755000 2                  STA     LNGTH

      280    17043    2         KL$UBWORD.NUM = 0;

  17043  4 000305   000000 220003                    LDX0    0,DU
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:44   
         4 000306   200451 440100                    SXL0    KL$UBWORD,,AUTO

      281    17044    2         KL$UBWORD.REPLACE.T = LNGTH.T;

  17044  4 000307   000003 236000 2                  LDQ     LNGTH
         4 000310   000001 736000                    QLS     1
         4 000311   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 000312   377000 376007                    ANQ     130560,DL
         4 000313   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      282    17045    2         KL$UBWORD.REPLACE.B = LNGTH.B;

  17045  4 000314   000003 236000 2                  LDQ     LNGTH
         4 000315   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 000316   000377 376007                    ANQ     255,DL
         4 000317   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      283    17046    2         KL$DREC.LN.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;

  17046  4 000320   200451 236100                    LDQ     KL$UBWORD,,AUTO
         4 000321   000020 676100                    ERQ     16,,PR0
         4 000322   377000 376007                    ANQ     130560,DL
         4 000323   000020 656100                    ERSQ    16,,PR0

      284    17047    2         KL$DREC.LN.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;

  17047  4 000324   200451 236100                    LDQ     KL$UBWORD,,AUTO
         4 000325   000020 676100                    ERQ     16,,PR0
         4 000326   000377 376007                    ANQ     255,DL
         4 000327   000020 656100                    ERSQ    16,,PR0

      285    17048    2         END;

      286    17049                                                              /*  Do options  */
      287    17050    1   MORE = AS_TRUE ;

  17050  4 000330   000000 236000 xsym               LDQ     AS_TRUE
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:45   
         4 000331   400000 376003                    ANQ     -131072,DU
         4 000332   200023 756100                    STQ     MORE,,AUTO

  17050  4 000333                       LINE_LOOP    null
      288    17051                                                              /**/
      289    17052    1   LINE_LOOP: ;
      290    17053    1   IF LINE THEN

  17053  4 000333   200040 234100                    SZN     LINE,,AUTO
         4 000334   000340 605000 4                  TPL     s:17056

      291    17054    1      P_PCB.ROOT$ = ADDR( LINE_OPTS_LIST ) ;

  17054  4 000335   000011 236000 5                  LDQ     9
         4 000336   000001 756000 xsym               STQ     P_PCB+1
         4 000337   000347 710000 4                  TRA     s:17060

      292    17055    1   ELSE
      293    17056    1      IF CONTROLLER THEN

  17056  4 000340   200041 234100                    SZN     CONTROLLER,,AUTO
         4 000341   000345 605000 4                  TPL     s:17059

      294    17057    1         P_PCB.ROOT$ = ADDR( CONT_OPTS_LIST );

  17057  4 000342   000012 236000 5                  LDQ     10
         4 000343   000001 756000 xsym               STQ     P_PCB+1
         4 000344   000347 710000 4                  TRA     s:17060

      295    17058    1      ELSE
      296    17059    1         P_PCB.ROOT$ = ADDR( CONT_DEV_OPTS_LIST );

  17059  4 000345   000013 236000 5                  LDQ     11
         4 000346   000001 756000 xsym               STQ     P_PCB+1

      297    17060    2   DO WHILE( MORE ) ;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:46   
  17060  4 000347   200023 234100                    SZN     MORE,,AUTO
         4 000350   001303 605000 4                  TPL     DONE_OPTIONS

      298    17061                                                              /* Set prompt */
      299    17062    2      CALL ASB$SET_PROMPT ( %PROMPT_OPT ) ;

  17062  4 000351   000005 630400 5                  EPPR0   5
         4 000352   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000353   000000 701000 xent               TSX1    ASB$SET_PROMPT
         4 000354   000000 011000                    NOP     0

      300    17063                                                              /* Read input */
      301    17064    2      CALL ASB$READ_SI( IN_BUF, ARS ) ;

  17064  4 000355   200012 630500                    EPPR0   ARS,,AUTO
         4 000356   200455 450500                    STP0    KL$UBWORD+4,,AUTO
         4 000357   000014 236000 5                  LDQ     12
         4 000360   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 000361   200454 630500                    EPPR0   KL$UBWORD+3,,AUTO
         4 000362   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000363   000000 701000 xent               TSX1    ASB$READ_SI
         4 000364   000000 011000                    NOP     0

      302    17065    2      P_PCB.NCHARS = ARS ;

  17065  4 000365   200012 235100                    LDA     ARS,,AUTO
         4 000366   000011 755000 xsym               STA     P_PCB+9

      303    17066    2      CALL X$PARSE( P_PCB ) ALTRET( LINE_OPT_ERR ) ;

  17066  4 000367   000003 630400 5                  EPPR0   3
         4 000370   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000371   000000 701000 xent               TSX1    X$PARSE
         4 000372   001275 702000 4                  TSX2    LINE_OPT_ERR

      304    17067    2      NODE$ = P_PCB.OUT$ ;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:47   
  17067  4 000373   000003 236000 xsym               LDQ     P_PCB+3
         4 000374   000000 756000 xsym               STQ     NODE$

      305    17068                                                              /**/
      306    17069    3      DO I = 0 TO P$NODE.SUBNODES-1 ;

  17069  4 000375   200007 450100                    STZ     I,,AUTO
         4 000376   001267 710000 4                  TRA     LOOP_END+1

      307    17070    3         PTR$ = P$NODE.SUBLK$(I) ;

  17070  4 000377   000000 470400 xsym               LDP0    NODE$
         4 000400   200007 720100                    LXL0    I,,AUTO
         4 000401   000003 236110                    LDQ     3,X0,PR0
         4 000402   200005 756100                    STQ     PTR$,,AUTO

      308    17071    3         CODE = PTR$ -> P$NODE.CODE ;

  17071  4 000403   200005 471500                    LDP1    PTR$,,AUTO
         4 000404   100000 236100                    LDQ     0,,PR1
         4 000405   777777 376007                    ANQ     -1,DL
         4 000406   000000 756000 xsym               STQ     CODE

      309    17072    4         DO SELECT( CODE ) ;

  17072  4 000407   000015 116007                    CMPQ    13,DL
         4 000410   000437 602000 4                  TNC     s:17072+24
         4 000411   000645 600000 4                  TZE     s:17176
         4 000412   000032 116007                    CMPQ    26,DL
         4 000413   000426 602000 4                  TNC     s:17072+15
         4 000414   001015 600000 4                  TZE     s:17251
         4 000415   000455 116007                    CMPQ    301,DL
         4 000416   000423 602000 4                  TNC     s:17072+12
         4 000417   001257 600000 4                  TZE     s:17304
         4 000420   000456 116007                    CMPQ    302,DL
         4 000421   001266 601000 4                  TNZ     LOOP_END
         4 000422   001253 710000 4                  TRA     s:17301
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:48   
         4 000423   000454 116007                    CMPQ    300,DL
         4 000424   001266 601000 4                  TNZ     LOOP_END
         4 000425   001263 710000 4                  TRA     s:17307
         4 000426   000017 116007                    CMPQ    15,DL
         4 000427   000434 602000 4                  TNC     s:17072+21
         4 000430   000615 600000 4                  TZE     s:17165
         4 000431   000020 116007                    CMPQ    16,DL
         4 000432   001266 601000 4                  TNZ     LOOP_END
         4 000433   001252 710000 4                  TRA     s:17298
         4 000434   000016 116007                    CMPQ    14,DL
         4 000435   001266 601000 4                  TNZ     LOOP_END
         4 000436   000705 710000 4                  TRA     s:17206
         4 000437   000011 116007                    CMPQ    9,DL
         4 000440   000453 602000 4                  TNC     s:17072+36
         4 000441   000645 600000 4                  TZE     s:17176
         4 000442   000013 116007                    CMPQ    11,DL
         4 000443   000450 602000 4                  TNC     s:17072+33
         4 000444   000771 600000 4                  TZE     s:17243
         4 000445   000014 116007                    CMPQ    12,DL
         4 000446   001266 601000 4                  TNZ     LOOP_END
         4 000447   001015 710000 4                  TRA     s:17251
         4 000450   000012 116007                    CMPQ    10,DL
         4 000451   001266 601000 4                  TNZ     LOOP_END
         4 000452   000705 710000 4                  TRA     s:17206
         4 000453   000001 116007                    CMPQ    1,DL
         4 000454   001266 602000 4                  TNC     LOOP_END
         4 000455   000461 600000 4                  TZE     s:17076
         4 000456   000010 116007                    CMPQ    8,DL
         4 000457   001266 601000 4                  TNZ     LOOP_END
         4 000460   000745 710000 4                  TRA     s:17236

      310    17073                                                              /**/
      311    17074                                                              /**/
      312    17075    4            SELECT( LINE_PRO_VAL ) ;

      313    17076    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:49   
  17076  4 000461   100003 236100                    LDQ     3,,PR1
         4 000462   200027 756100                    STQ     BLK$,,AUTO

      314    17077    5            IF OUT$SYM.COUNT > 11 THEN DO;

  17077  4 000463   200027 473500                    LDP3    BLK$,,AUTO
         4 000464   300004 236100                    LDQ     4,,PR3
         4 000465   777000 376003                    ANQ     -512,DU
         4 000466   014000 116003                    CMPQ    6144,DU
         4 000467   000475 602000 4                  TNC     s:17099

      315    17078        /*E*  ERROR: ASA-E$PRO_TOO_LONG-C
      316    17079              MESSAGE:  Profile name too long.
      317    17080              MESSAGE1: Profile name can be at most 11 characters long.
      318    17081        */
      319    17082                    %SCREAM( ERR#=E$PRO_TOO_LONG, LEVEL=ERROR, MID='A') ;

  17094  4 000470   000015 630400 5                  EPPR0   13
         4 000471   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000472   000000 701000 xent               TSX1    ASH$ERROR
         4 000473   000000 011000                    NOP     0

      320    17097    5               GOTO LOOP_END;

  17097  4 000474   001266 710000 4                  TRA     LOOP_END

      321    17098    5               END ;    /* Then do */
      322    17099    4            PRO$ = ADDR(PRO_BUF);

  17099  4 000475   200046 634500                    EPPR4   PRO_BUF,,AUTO
         4 000476   200043 454500                    STP4    PRO$,,AUTO

      323    17100    4            ARS = LENGTHC(PRO_BUF);

  17100  4 000477   002000 235007                    LDA     1024,DL
         4 000500   200012 755100                    STA     ARS,,AUTO

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:50   
      324    17101    4            USERS_KEY.COUNT=OUT$SYM.COUNT;

  17101  4 000501   300004 236100                    LDQ     4,,PR3
         4 000502   000000 552040 xsym               STBQ    USERS_KEY,'40'O

      325    17102    4            USERS_KEY.TXTC=OUT$SYM.TEXT;

  17102  4 000503   300004 236100                    LDQ     4,,PR3
         4 000504   000033 772000                    QRL     27
         4 000505   000000 621006                    EAX1    0,QL
         4 000506   040000 100540                    MLR     fill='040'O
         4 000507   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
         4 000510   000000 200051 xsym               ADSC9   USERS_KEY                cn=1,n=41

      326    17103    4            CALL ASD$READ_PRO(USERS_KEY,KL$PHDR,ARS) ALTRET(LINE_PRO_ERR);

  17103  4 000511   200012 635500                    EPPR5   ARS,,AUTO
         4 000512   200456 455500                    STP5    KL$UBWORD+5,,AUTO
         4 000513   200043 236100                    LDQ     PRO$,,AUTO
         4 000514   000016 235000 5                  LDA     14
         4 000515   200454 757100                    STAQ    KL$UBWORD+3,,AUTO
         4 000516   200454 630500                    EPPR0   KL$UBWORD+3,,AUTO
         4 000517   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 000520   000000 701000 xent               TSX1    ASD$READ_PRO
         4 000521   000605 702000 4                  TSX2    LINE_PRO_ERR

      327    17104                                                   /* If polled vip devtype */
      328    17105    5            IF KL$PHDR.TTYP = %KLTY_HIP_DEV# THEN DO;

  17105  4 000522   200043 470500                    LDP0    PRO$,,AUTO
         4 000523   000100 101500                    MRL     fill='000'O
         4 000524   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         4 000525   200454 000004                    ADSC9   KL$UBWORD+3,,AUTO        cn=0,n=4
         4 000526   200454 236100                    LDQ     KL$UBWORD+3,,AUTO
         4 000527   000016 116007                    CMPQ    14,DL
         4 000530   000551 601000 4                  TNZ     s:17115

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:51   
      329    17106    5               KL$DREC.LN.BLKHDR.BLKTYP= %KLTY_3270#;   /* Bisync */

  17106  4 000531   000000 471400 xsym               LDP1    DSEG1$
         4 000532   007000 236003                    LDQ     3584,DU
         4 000533   100021 552140                    STBQ    17,'40'O,PR1

      330    17107    5               IF CONTROLLER THEN

  17107  4 000534   200041 234100                    SZN     CONTROLLER,,AUTO
         4 000535   000543 605000 4                  TPL     s:17110

      331    17108    5                  KL$CONTROLLER.BLKHDR.BLKTYP=%KLTY_HIP_CONT#;

  17108  4 000536   200025 473500                    LDP3    CONTPTR$,,AUTO
         4 000537   000100 101400                    MRL     fill='000'O
         4 000540   000017 000004 5                  ADSC9   15                       cn=0,n=4
         4 000541   300001 000001                    ADSC9   1,,PR3                   cn=0,n=1
         4 000542   000551 710000 4                  TRA     s:17115

      332    17109    5               ELSE
      333    17110    5                  IF LINE THEN

  17110  4 000543   200040 234100                    SZN     LINE,,AUTO
         4 000544   000551 605000 4                  TPL     s:17115

      334    17111    5                     KL$LINEDEV.BLKHDR.BLKTYP=%KLTY_HIP_LINE#;

  17111  4 000545   000000 473400 xsym               LDP3    DSEG3$
         4 000546   000100 101400                    MRL     fill='000'O
         4 000547   000020 000004 5                  ADSC9   16                       cn=0,n=4
         4 000550   300001 000001                    ADSC9   1,,PR3                   cn=0,n=1

      335    17112    5               END;

      336    17113
      337    17114                    /* If not rbt and not polled vip device profiles */
      338    17115    4            IF (KL$PHDR.TTYP ~= %KLTY_STRM#) AND (KL$PHDR.TTYP~=%KLTY_HIP_DEV#) THEN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:52   

  17115  4 000551   000100 101500                    MRL     fill='000'O
         4 000552   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         4 000553   200454 000004                    ADSC9   KL$UBWORD+3,,AUTO        cn=0,n=4
         4 000554   200454 236100                    LDQ     KL$UBWORD+3,,AUTO
         4 000555   000003 116007                    CMPQ    3,DL
         4 000556   000572 600000 4                  TZE     s:17136
         4 000557   000100 101500                    MRL     fill='000'O
         4 000560   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         4 000561   200455 000004                    ADSC9   KL$UBWORD+4,,AUTO        cn=0,n=4
         4 000562   200455 236100                    LDQ     KL$UBWORD+4,,AUTO
         4 000563   000016 116007                    CMPQ    14,DL
         4 000564   000572 600000 4                  TZE     s:17136

      339    17116        /*E* ERROR: ASA-E$LINEPROTYPE-0
      340    17117             MESSAGE: You must specify a profile that defines a line.
      341    17118             MESSAGE1: Possible line profiles would be $ASYNC or $RBT.
      342    17119        */
      343    17120                    %SCREAM( ERR#=E$LINEPROTYPE, LEVEL=ERROR, MID='A' );

  17132  4 000565   000021 630400 5                  EPPR0   17
         4 000566   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000567   000000 701000 xent               TSX1    ASH$ERROR
         4 000570   000000 011000                    NOP     0
         4 000571   000604 710000 4                  TRA     s:17139

      344    17135    5            ELSE DO;

      345    17136    5               KL$DREC.PNAME.CNT = OUT$SYM.COUNT ;

  17136  4 000572   200027 471500                    LDP1    BLK$,,AUTO
         4 000573   000000 473400 xsym               LDP3    DSEG1$
         4 000574   100004 236100                    LDQ     4,,PR1
         4 000575   300004 552140                    STBQ    4,'40'O,PR3

      346    17137    5               KL$DREC.PNAME.TXT = OUT$SYM.TEXT ;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:53   
  17137  4 000576   100004 236100                    LDQ     4,,PR1
         4 000577   000033 772000                    QRL     27
         4 000600   000000 620006                    EAX0    0,QL
         4 000601   040100 100540                    MLR     fill='040'O
         4 000602   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
         4 000603   300004 200013                    ADSC9   4,,PR3                   cn=1,n=11

      347    17138    5               END;

      348    17139    5            DO WHILE( '0'B );

  17139  4 000604   001266 710000 4                  TRA     LOOP_END

      349    17140        /*   ERROR: ASA-E$PRO_NO_EXIST-C
      350    17141             MESSAGE: Profile %%U1 %does not exist.
      351    17142             MESSAGE1: The profile %%U1 %must exist in :PRO before
      352    17143                       you can use it.
      353    17144        */
      354    17145    5   LINE_PRO_ERR: AS_FIELD1 = USERS_KEY ;

  17145  4 000605   000000 100400       LINE_PRO_ERR MLR     fill='000'O
         4 000606   000000 000051 xsym               ADSC9   USERS_KEY                cn=0,n=41
         4 000607   000000 000051 xsym               ADSC9   AS_FIELD1                cn=0,n=41

      355    17146                    %SCREAM( ERR#=E$PRO_NO_EXIST, LEVEL=ERROR, MID='A' ) ;

  17158  4 000610   000022 630400 5                  EPPR0   18
         4 000611   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000612   000000 701000 xent               TSX1    ASH$ERROR
         4 000613   000000 011000                    NOP     0

      356    17161    5               END;

  17161  4 000614   001266 710000 4                  TRA     LOOP_END

      357    17162                                                              /**/
      358    17163    4            SELECT( %LINE_SLAVE_VAL );
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:54   

      359    17164
      360    17165    4            IF PTR$->P$NODE.SUBNODES = 0 THEN

  17165  4 000615   100001 221100                    LDX1    1,,PR1
         4 000616   000625 601000 4                  TNZ     s:17168

      361    17166    4               KL$DREC.LN.SLAVE# = %YES#;

  17166  4 000617   000000 473400 xsym               LDP3    DSEG1$
         4 000620   300022 236100                    LDQ     18,,PR3
         4 000621   000023 376000 5                  ANQ     19
         4 000622   200000 276003                    ORQ     65536,DU
         4 000623   300022 756100                    STQ     18,,PR3
         4 000624   001266 710000 4                  TRA     LOOP_END

      362    17167    5            ELSE DO;

      363    17168    5               BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17168  4 000625   100003 236100                    LDQ     3,,PR1
         4 000626   200027 756100                    STQ     BLK$,,AUTO

      364    17169    5               IF BLK$ -> P$NODE.CODE = YES_VAL THEN

  17169  4 000627   200027 473500                    LDP3    BLK$,,AUTO
         4 000630   300000 722100                    LXL2    0,,PR3
         4 000631   000001 102003                    CMPX2   1,DU
         4 000632   000641 601000 4                  TNZ     s:17172

      365    17170    5                  KL$DREC.LN.SLAVE# = %YES#;

  17170  4 000633   000000 474400 xsym               LDP4    DSEG1$
         4 000634   400022 236100                    LDQ     18,,PR4
         4 000635   000023 376000 5                  ANQ     19
         4 000636   200000 276003                    ORQ     65536,DU
         4 000637   400022 756100                    STQ     18,,PR4
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:55   
         4 000640   001266 710000 4                  TRA     LOOP_END

      366    17171    5               ELSE
      367    17172    5                  KL$DREC.LN.SLAVE# = %NO#;

  17172  4 000641   000000 474400 xsym               LDP4    DSEG1$
         4 000642   000023 236000 5                  LDQ     19
         4 000643   400022 356100                    ANSQ    18,,PR4

      368    17173    5               END;

  17173  4 000644   001266 710000 4                  TRA     LOOP_END

      369    17174                                                              /**/
      370    17175    4            SELECT( CONT_ROWS_VAL, DEV_ROWS_VAL );

      371    17176    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17176  4 000645   100003 236100                    LDQ     3,,PR1
         4 000646   200027 756100                    STQ     BLK$,,AUTO

      372    17177    4            CALL CHARBIN(ROWS, OUT$SYM.TEXT);

  17177  4 000647   200027 473500                    LDP3    BLK$,,AUTO
         4 000650   300004 236100                    LDQ     4,,PR3
         4 000651   000033 772000                    QRL     27
         4 000652   000000 621006                    EAX1    0,QL
         4 000653   000100 305540                    DTB
         4 000654   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 000655   200017 000004                    NDSC9   ROWS,,AUTO               cn=0,s=lsgnf,sf=0,n=4

      373    17178    5            IF ROWS < 12 OR ROWS > 255 THEN DO;

  17178  4 000656   200017 235100                    LDA     ROWS,,AUTO
         4 000657   000014 115007                    CMPA    12,DL
         4 000660   000663 604000 4                  TMI     s:17195
         4 000661   000377 115007                    CMPA    255,DL
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:56   
         4 000662   000670 604400 4                  TMOZ    s:17200

      374    17179        /*E*  ERROR:  ASA-E$INVALID_ROWS-C
      375    17180              MESSAGE: Invalid ROWS value.
      376    17181              MESSAGE1: ROWS must be between 12 and 255.
      377    17182        */
      378    17183                    %SCREAM( ERR#=E$INVALID_ROWS, LEVEL=ERROR, MID='A' );

  17195  4 000663   000024 630400 5                  EPPR0   20
         4 000664   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000665   000000 701000 xent               TSX1    ASH$ERROR
         4 000666   000000 011000                    NOP     0

      379    17198    5               END;

  17198  4 000667   001266 710000 4                  TRA     LOOP_END

      380    17199    4            ELSE
      381    17200    4               IF CODE = CONT_ROWS_VAL THEN

  17200  4 000670   000000 235000 xsym               LDA     CODE
         4 000671   000011 115007                    CMPA    9,DL
         4 000672   000700 601000 4                  TNZ     s:17203

      382    17201    4                  KL$CONTROLLER.ROWS = ROWS;

  17201  4 000673   200025 474500                    LDP4    CONTPTR$,,AUTO
         4 000674   000100 101500                    MRL     fill='000'O
         4 000675   200017 000004                    ADSC9   ROWS,,AUTO               cn=0,n=4
         4 000676   400002 200001                    ADSC9   2,,PR4                   cn=1,n=1
         4 000677   001266 710000 4                  TRA     LOOP_END

      383    17202    4               ELSE
      384    17203    4                  KL$LINEDEV.ROWS = ROWS;

  17203  4 000700   000000 474400 xsym               LDP4    DSEG3$
         4 000701   000100 101500                    MRL     fill='000'O
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:57   
         4 000702   200017 000004                    ADSC9   ROWS,,AUTO               cn=0,n=4
         4 000703   400003 000001                    ADSC9   3,,PR4                   cn=0,n=1
         4 000704   001266 710000 4                  TRA     LOOP_END

      385    17204                                                              /**/
      386    17205    4            SELECT( CONT_COLUMNS_VAL, DEV_COLUMNS_VAL );

      387    17206    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17206  4 000705   100003 236100                    LDQ     3,,PR1
         4 000706   200027 756100                    STQ     BLK$,,AUTO

      388    17207    4            CALL CHARBIN(COLUMNS, OUT$SYM.TEXT);

  17207  4 000707   200027 473500                    LDP3    BLK$,,AUTO
         4 000710   300004 236100                    LDQ     4,,PR3
         4 000711   000033 772000                    QRL     27
         4 000712   000000 621006                    EAX1    0,QL
         4 000713   000100 305540                    DTB
         4 000714   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 000715   200020 000004                    NDSC9   COLUMNS,,AUTO            cn=0,s=lsgnf,sf=0,n=4

      389    17208    5            IF COLUMNS < 40 OR COLUMNS > 255 THEN DO;

  17208  4 000716   200020 235100                    LDA     COLUMNS,,AUTO
         4 000717   000050 115007                    CMPA    40,DL
         4 000720   000723 604000 4                  TMI     s:17225
         4 000721   000377 115007                    CMPA    255,DL
         4 000722   000730 604400 4                  TMOZ    s:17230

      390    17209        /*E*  ERROR:  ASA-E$INVALID_COLUMNS-C
      391    17210              MESSAGE: Invalid COLUMNS value.
      392    17211              MESSAGE1: COLUMNS must be between 40 and 255.
      393    17212        */
      394    17213                    %SCREAM( ERR#=E$INVALID_COLUMNS, LEVEL=ERROR, MID='A' );

  17225  4 000723   000025 630400 5                  EPPR0   21
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:58   
         4 000724   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000725   000000 701000 xent               TSX1    ASH$ERROR
         4 000726   000000 011000                    NOP     0

      395    17228    5               END;

  17228  4 000727   001266 710000 4                  TRA     LOOP_END

      396    17229    4            ELSE
      397    17230    4               IF CODE = CONT_COLUMNS_VAL THEN

  17230  4 000730   000000 235000 xsym               LDA     CODE
         4 000731   000012 115007                    CMPA    10,DL
         4 000732   000740 601000 4                  TNZ     s:17233

      398    17231    4                  KL$CONTROLLER.COLUMNS = COLUMNS;

  17231  4 000733   200025 474500                    LDP4    CONTPTR$,,AUTO
         4 000734   000100 101500                    MRL     fill='000'O
         4 000735   200020 000004                    ADSC9   COLUMNS,,AUTO            cn=0,n=4
         4 000736   400002 400001                    ADSC9   2,,PR4                   cn=2,n=1
         4 000737   001266 710000 4                  TRA     LOOP_END

      399    17232    4               ELSE
      400    17233    4                  KL$LINEDEV.COLUMNS = COLUMNS;

  17233  4 000740   000000 474400 xsym               LDP4    DSEG3$
         4 000741   000100 101500                    MRL     fill='000'O
         4 000742   200020 000004                    ADSC9   COLUMNS,,AUTO            cn=0,n=4
         4 000743   400003 200001                    ADSC9   3,,PR4                   cn=1,n=1
         4 000744   001266 710000 4                  TRA     LOOP_END

      401    17234                                                              /**/
      402    17235    4            SELECT( CONT_TYPE_VAL );

      403    17236    4            TYPE$ = ADDR( TYPE_(PTR$->P$NODE.SUBLK$(0)->P$NODE.CODE) );

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:59   
  17236  4 000745   100003 473500                    LDP3    3,,PR1
         4 000746   300000 721100                    LXL1    0,,PR3
         4 000747   000033 634411 3                  EPPR4   TYPE_,X1
         4 000750   200031 454500                    STP4    TYPE$,,AUTO

      404    17237    4            KL$UBWORD.NUM = 0 ;

  17237  4 000751   000000 222003                    LDX2    0,DU
         4 000752   200451 442100                    SXL2    KL$UBWORD,,AUTO

      405    17238    4            KL$UBWORD.REPLACE.T = KL$UWORD.T;

  17238  4 000753   400000 236100                    LDQ     0,,PR4
         4 000754   000001 736000                    QLS     1
         4 000755   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 000756   377000 376007                    ANQ     130560,DL
         4 000757   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      406    17239    4            KL$UBWORD.REPLACE.B = KL$UWORD.B;

  17239  4 000760   400000 236100                    LDQ     0,,PR4
         4 000761   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 000762   000377 376007                    ANQ     255,DL
         4 000763   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      407    17240    4            KL$CONTROLLER.TYPE = KL$UBWORD.NUM;

  17240  4 000764   200025 475500                    LDP5    CONTPTR$,,AUTO
         4 000765   000100 100500                    MLR     fill='000'O
         4 000766   200451 400002                    ADSC9   KL$UBWORD,,AUTO          cn=2,n=2
         4 000767   500003 000002                    ADSC9   3,,PR5                   cn=0,n=2
         4 000770   001266 710000 4                  TRA     LOOP_END

      408    17241                                                              /**/
      409    17242    4            SELECT( LINE_DEV_TYPE_VAL );

      410    17243    4            TYPE$ = ADDR( TYPE_(PTR$->P$NODE.SUBLK$(0)->P$NODE.CODE) );
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:60   

  17243  4 000771   100003 473500                    LDP3    3,,PR1
         4 000772   300000 721100                    LXL1    0,,PR3
         4 000773   000033 634411 3                  EPPR4   TYPE_,X1
         4 000774   200031 454500                    STP4    TYPE$,,AUTO

      411    17244    4            KL$UBWORD.NUM = 0 ;

  17244  4 000775   000000 222003                    LDX2    0,DU
         4 000776   200451 442100                    SXL2    KL$UBWORD,,AUTO

      412    17245    4            KL$UBWORD.REPLACE.T = KL$UWORD.T;

  17245  4 000777   400000 236100                    LDQ     0,,PR4
         4 001000   000001 736000                    QLS     1
         4 001001   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 001002   377000 376007                    ANQ     130560,DL
         4 001003   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      413    17246    4            KL$UBWORD.REPLACE.B = KL$UWORD.B;

  17246  4 001004   400000 236100                    LDQ     0,,PR4
         4 001005   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 001006   000377 376007                    ANQ     255,DL
         4 001007   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      414    17247    4            KL$LINEDEV.TYPE = KL$UBWORD.NUM;

  17247  4 001010   000000 475400 xsym               LDP5    DSEG3$
         4 001011   000100 100500                    MLR     fill='000'O
         4 001012   200451 400002                    ADSC9   KL$UBWORD,,AUTO          cn=2,n=2
         4 001013   500002 400002                    ADSC9   2,,PR5                   cn=2,n=2
         4 001014   001266 710000 4                  TRA     LOOP_END

      415    17248                                                              /**/
      416    17249                                                              /**/
      417    17250    4            SELECT( END_VAL, BLANK_LINE_VAL );
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:61   

      418    17251    5            IF CONTROLLER THEN DO;

  17251  4 001015   200041 234100                    SZN     CONTROLLER,,AUTO
         4 001016   001125 605000 4                  TPL     s:17273

      419    17252    6               IF NOT FOUND THEN DO;

  17252  4 001017   200036 234100                    SZN     FOUND,,AUTO
         4 001020   001031 604000 4                  TMI     s:17257

      420    17253    6                  KL$DREC.LN.BLKHDR.NSUBS = KL$DREC.LN.BLKHDR.NSUBS + 1;

  17253  4 001021   000000 473400 xsym               LDP3    DSEG1$
         4 001022   300020 236100                    LDQ     16,,PR3
         4 001023   000001 036003                    ADLQ    1,DU
         4 001024   300020 552120                    STBQ    16,'20'O,PR3

      421    17254    6                  PTR$ = CONT$;

  17254  4 001025   200026 236100                    LDQ     CONT$,,AUTO
         4 001026   200005 756100                    STQ     PTR$,,AUTO

      422    17255    6                  DEV_SIZEW = DEV_SIZEW + SIZEW(KL_CONTROLLER);

  17255  4 001027   000004 236007                    LDQ     4,DL
         4 001030   200035 056100                    ASQ     DEV_SIZEW,,AUTO

      423    17256    6                  END;

      424    17257    5               MOVE_SIZE = POFFC(DEV_STOP$, PTR$);

  17257  4 001031   200005 236100                    LDQ     PTR$,,AUTO
         4 001032   000020 772000                    QRL     16
         4 001033   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 001034   200034 236100                    LDQ     DEV_STOP$,,AUTO
         4 001035   000020 772000                    QRL     16
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:62   
         4 001036   200454 136100                    SBLQ    KL$UBWORD+3,,AUTO
         4 001037   200021 756100                    STQ     MOVE_SIZE,,AUTO

      425    17258    6               IF MOVE_SIZE > 0 THEN DO;

  17258  4 001040   001057 604400 4                  TMOZ    s:17263

      426    17259    6                  IF MOVE_SIZE > DSEG2SIZE THEN

  17259  4 001041   001051 604000 4                  TMI     s:17261
         4 001042   000000 116000 xsym               CMPQ    DSEG2SIZE
         4 001043   001051 602000 4                  TNC     s:17261
         4 001044   001051 600000 4                  TZE     s:17261

      427    17260    6                     CALL ASB$GET_MORE_SEG(2,4096) ALTRET(GETSEG_ERR);

  17260  4 001045   000027 630400 5                  EPPR0   23
         4 001046   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 001047   000000 701000 xent               TSX1    ASB$GET_MORE_SEG
         4 001050   001417 702000 4                  TSX2    GETSEG_ERR

      428    17261    6                  DSEG2$->MOVE$TEMP = PTR$->MOVE$TEMP;

  17261  4 001051   200005 470500                    LDP0    PTR$,,AUTO
         4 001052   200021 720100                    LXL0    MOVE_SIZE,,AUTO
         4 001053   000000 471400 xsym               LDP1    DSEG2$
         4 001054   040140 100540                    MLR     fill='040'O
         4 001055   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         4 001056   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

      429    17262    6                  END;

      430    17263    5               SIZE = POFFC(CONT$,DSEG1$)+SIZEW(KL_CONTROLLER)*4+MOVE_SIZE;

  17263  4 001057   000000 236000 xsym               LDQ     DSEG1$
         4 001060   000020 772000                    QRL     16
         4 001061   200454 756100                    STQ     KL$UBWORD+3,,AUTO
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:63   
         4 001062   200026 236100                    LDQ     CONT$,,AUTO
         4 001063   000020 772000                    QRL     16
         4 001064   200454 136100                    SBLQ    KL$UBWORD+3,,AUTO
         4 001065   200021 036100                    ADLQ    MOVE_SIZE,,AUTO
         4 001066   000020 036007                    ADLQ    16,DL
         4 001067   200022 756100                    STQ     SIZE,,AUTO

      431    17264    6               IF SIZE > DSEG1SIZE THEN DO;

  17264  4 001070   001104 604000 4                  TMI     s:17267
         4 001071   000000 116000 xsym               CMPQ    DSEG1SIZE
         4 001072   001104 602000 4                  TNC     s:17267
         4 001073   001104 600000 4                  TZE     s:17267

      432    17265    6                  CALL ASB$GET_MORE_SEG(1,SIZE) ALTRET(GETSEG_ERR);

  17265  4 001074   200022 630500                    EPPR0   SIZE,,AUTO
         4 001075   200455 450500                    STP0    KL$UBWORD+4,,AUTO
         4 001076   000005 236000 5                  LDQ     5
         4 001077   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 001100   200454 630500                    EPPR0   KL$UBWORD+3,,AUTO
         4 001101   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 001102   000000 701000 xent               TSX1    ASB$GET_MORE_SEG
         4 001103   001417 702000 4                  TSX2    GETSEG_ERR

      433    17266    6                  END;

      434    17267    5               CONT$->KL$CONTROLLER = KL$CONTROLLER;

  17267  4 001104   200025 470500                    LDP0    CONTPTR$,,AUTO
         4 001105   200026 471500                    LDP1    CONT$,,AUTO
         4 001106   000100 100500                    MLR     fill='000'O
         4 001107   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16
         4 001110   100000 000020                    ADSC9   0,,PR1                   cn=0,n=16

      435    17268    6               IF MOVE_SIZE > 0 THEN DO;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:64   
  17268  4 001111   200021 235100                    LDA     MOVE_SIZE,,AUTO
         4 001112   001125 604400 4                  TMOZ    s:17273

      436    17269    6                  PTR$ = PINCRW(CONT$, SIZEW(KL_CONTROLLER));

  17269  4 001113   200026 236100                    LDQ     CONT$,,AUTO
         4 001114   000004 036003                    ADLQ    4,DU
         4 001115   200005 756100                    STQ     PTR$,,AUTO

      437    17270    6                  PTR$->MOVE$TEMP = DSEG2$->MOVE$TEMP;

  17270  4 001116   000000 473400 xsym               LDP3    DSEG2$
         4 001117   000000 620005                    EAX0    0,AL
         4 001120   200005 474500                    LDP4    PTR$,,AUTO
         4 001121   200021 721100                    LXL1    MOVE_SIZE,,AUTO
         4 001122   040140 100540                    MLR     fill='040'O
         4 001123   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         4 001124   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1

      438    17271    6                  END;

      439    17272    5               END;

      440    17273    5            IF DEVICE THEN DO;

  17273  4 001125   200042 234100                    SZN     DEVICE,,AUTO
         4 001126   001250 605000 4                  TPL     s:17296

      441    17274    6               IF NOT FOUND THEN DO;

  17274  4 001127   200036 234100                    SZN     FOUND,,AUTO
         4 001130   001147 604000 4                  TMI     s:17279

      442    17275    6                  KL$CONTROLLER.BLKHDR.NSUBS = KL$CONTROLLER.BLKHDR.NSUBS + 1;

  17275  4 001131   200025 470500                    LDP0    CONTPTR$,,AUTO
         4 001132   000100 101500                    MRL     fill='000'O
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:65   
         4 001133   000000 200001                    ADSC9   0,,PR0                   cn=1,n=1
         4 001134   200455 000004                    ADSC9   KL$UBWORD+4,,AUTO        cn=0,n=4
         4 001135   200455 236100                    LDQ     KL$UBWORD+4,,AUTO
         4 001136   000001 036007                    ADLQ    1,DL
         4 001137   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 001140   000100 101500                    MRL     fill='000'O
         4 001141   200454 000004                    ADSC9   KL$UBWORD+3,,AUTO        cn=0,n=4
         4 001142   000000 200001                    ADSC9   0,,PR0                   cn=1,n=1

      443    17276    6                  PTR$ = DEV$;

  17276  4 001143   200030 236100                    LDQ     DEV$,,AUTO
         4 001144   200005 756100                    STQ     PTR$,,AUTO

      444    17277    6                  DEV_SIZEW = DEV_SIZEW + SIZEW(KL_LINEDEV);

  17277  4 001145   000004 236007                    LDQ     4,DL
         4 001146   200035 056100                    ASQ     DEV_SIZEW,,AUTO

      445    17278    6                  END;

      446    17279    5               MOVE_SIZE = POFFC(DEV_STOP$, PTR$);

  17279  4 001147   200005 236100                    LDQ     PTR$,,AUTO
         4 001150   000020 772000                    QRL     16
         4 001151   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 001152   200034 236100                    LDQ     DEV_STOP$,,AUTO
         4 001153   000020 772000                    QRL     16
         4 001154   200454 136100                    SBLQ    KL$UBWORD+3,,AUTO
         4 001155   200021 756100                    STQ     MOVE_SIZE,,AUTO

      447    17280    6               IF MOVE_SIZE > 0 THEN DO;

  17280  4 001156   001175 604400 4                  TMOZ    s:17285

      448    17281    6                  IF MOVE_SIZE > DSEG2SIZE THEN

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:66   
  17281  4 001157   001167 604000 4                  TMI     s:17283
         4 001160   000000 116000 xsym               CMPQ    DSEG2SIZE
         4 001161   001167 602000 4                  TNC     s:17283
         4 001162   001167 600000 4                  TZE     s:17283

      449    17282    6                     CALL ASB$GET_MORE_SEG(2,4096) ALTRET(GETSEG_ERR);

  17282  4 001163   000027 630400 5                  EPPR0   23
         4 001164   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 001165   000000 701000 xent               TSX1    ASB$GET_MORE_SEG
         4 001166   001417 702000 4                  TSX2    GETSEG_ERR

      450    17283    6                  DSEG2$->MOVE$TEMP = PTR$->MOVE$TEMP;

  17283  4 001167   200005 470500                    LDP0    PTR$,,AUTO
         4 001170   200021 720100                    LXL0    MOVE_SIZE,,AUTO
         4 001171   000000 471400 xsym               LDP1    DSEG2$
         4 001172   040140 100540                    MLR     fill='040'O
         4 001173   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         4 001174   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

      451    17284    6                  END;

      452    17285    5               SIZE = POFFC(DEV$,DSEG1$)+SIZEW(KL_LINEDEV)*4+MOVE_SIZE;

  17285  4 001175   000000 236000 xsym               LDQ     DSEG1$
         4 001176   000020 772000                    QRL     16
         4 001177   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 001200   200030 236100                    LDQ     DEV$,,AUTO
         4 001201   000020 772000                    QRL     16
         4 001202   200454 136100                    SBLQ    KL$UBWORD+3,,AUTO
         4 001203   200021 036100                    ADLQ    MOVE_SIZE,,AUTO
         4 001204   000020 036007                    ADLQ    16,DL
         4 001205   200022 756100                    STQ     SIZE,,AUTO

      453    17286    6               IF SIZE > DSEG1SIZE THEN DO;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:67   
  17286  4 001206   001222 604000 4                  TMI     s:17289
         4 001207   000000 116000 xsym               CMPQ    DSEG1SIZE
         4 001210   001222 602000 4                  TNC     s:17289
         4 001211   001222 600000 4                  TZE     s:17289

      454    17287    6                  CALL ASB$GET_MORE_SEG(1,SIZE) ALTRET(GETSEG_ERR);

  17287  4 001212   200022 630500                    EPPR0   SIZE,,AUTO
         4 001213   200455 450500                    STP0    KL$UBWORD+4,,AUTO
         4 001214   000005 236000 5                  LDQ     5
         4 001215   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 001216   200454 630500                    EPPR0   KL$UBWORD+3,,AUTO
         4 001217   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 001220   000000 701000 xent               TSX1    ASB$GET_MORE_SEG
         4 001221   001417 702000 4                  TSX2    GETSEG_ERR

      455    17288    6                  END;

      456    17289    5               DEV$->KL$LINEDEV = KL$LINEDEV;

  17289  4 001222   000000 470400 xsym               LDP0    DSEG3$
         4 001223   200030 471500                    LDP1    DEV$,,AUTO
         4 001224   000100 100500                    MLR     fill='000'O
         4 001225   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16
         4 001226   100000 000020                    ADSC9   0,,PR1                   cn=0,n=16

      457    17290    5               CONT$->KL$CONTROLLER = KL$CONTROLLER;

  17290  4 001227   200025 470500                    LDP0    CONTPTR$,,AUTO
         4 001230   200026 473500                    LDP3    CONT$,,AUTO
         4 001231   000100 100500                    MLR     fill='000'O
         4 001232   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16
         4 001233   300000 000020                    ADSC9   0,,PR3                   cn=0,n=16

      458    17291    6               IF MOVE_SIZE > 0 THEN DO;

  17291  4 001234   200021 235100                    LDA     MOVE_SIZE,,AUTO
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:68   
         4 001235   001250 604400 4                  TMOZ    s:17296

      459    17292    6                  PTR$ = PINCRW(DEV$, SIZEW(KL_LINEDEV));

  17292  4 001236   200030 236100                    LDQ     DEV$,,AUTO
         4 001237   000004 036003                    ADLQ    4,DU
         4 001240   200005 756100                    STQ     PTR$,,AUTO

      460    17293    6                  PTR$->MOVE$TEMP = DSEG2$->MOVE$TEMP;

  17293  4 001241   000000 474400 xsym               LDP4    DSEG2$
         4 001242   000000 620005                    EAX0    0,AL
         4 001243   200005 475500                    LDP5    PTR$,,AUTO
         4 001244   200021 721100                    LXL1    MOVE_SIZE,,AUTO
         4 001245   040140 100540                    MLR     fill='040'O
         4 001246   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0
         4 001247   500000 000011                    ADSC9   0,,PR5                   cn=0,n=*X1

      461    17294    6                  END;

      462    17295    5               END;

      463    17296    4            MORE = '0'B;

  17296  4 001250   200023 450100                    STZ     MORE,,AUTO
         4 001251   001266 710000 4                  TRA     LOOP_END

      464    17297                                                              /**/
      465    17298    4            SELECT( EOL_VAL ) ;

  17298  4 001252   001266 710000 4                  TRA     LOOP_END

      466    17299                                                              /**/
      467    17300    4            SELECT( HELP_VAL ) ;

      468    17301    4            CALL ASH$HELP ;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:69   
  17301  4 001253   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 001254   000000 701000 xent               TSX1    ASH$HELP
         4 001255   000000 011000                    NOP     0
         4 001256   001266 710000 4                  TRA     LOOP_END

      469    17302                                                              /**/
      470    17303    4            SELECT( QUESTION_VAL ) ;

      471    17304    4            CALL ASH$QUEST ;

  17304  4 001257   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 001260   000000 701000 xent               TSX1    ASH$QUEST
         4 001261   000000 011000                    NOP     0
         4 001262   001266 710000 4                  TRA     LOOP_END

      472    17305                                                              /**/
      473    17306    4            SELECT( DQUESTION_VAL ) ;

      474    17307    4            CALL ASH$DQUEST ;

  17307  4 001263   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 001264   000000 701000 xent               TSX1    ASH$DQUEST
         4 001265   000000 011000                    NOP     0

      475    17308                                                              /**/
      476    17309    4            END ; /* Do case( code ) */

      477    17310    3   LOOP_END:
      478    17311    3         END ; /* Do i */

  17311  4 001266   200007 054100       LOOP_END     AOS     I,,AUTO
         4 001267   000000 470400 xsym               LDP0    NODE$
         4 001270   000001 236100                    LDQ     1,,PR0
         4 001271   000022 772000                    QRL     18
         4 001272   200007 116100                    CMPQ    I,,AUTO
         4 001273   000377 605400 4                  TPNZ    s:17070

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:70   
      479    17312    3      DO WHILE( '0'B );

  17312  4 001274   001301 710000 4                  TRA     s:17315

      480    17313    3   LINE_OPT_ERR: CALL ASH$ERROR( P_PCB.ERROR );

  17313  4 001275   000031 630400 5     LINE_OPT_ERR EPPR0   25
         4 001276   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001277   000000 701000 xent               TSX1    ASH$ERROR
         4 001300   000000 011000                    NOP     0

      481    17314    3         END;

      482    17315    2      END ; /* Do while */

  17315  4 001301   200023 234100                    SZN     MORE,,AUTO
         4 001302   000351 604000 4                  TMI     s:17062

  17314  4 001303                       DONE_OPTIONS null
      483    17316    1   DONE_OPTIONS: ;
      484    17317                                                              /* Output term rec */
      485    17318    1   IF NOT LINE THEN

  17318  4 001303   200040 234100                    SZN     LINE,,AUTO
         4 001304   001313 604000 4                  TMI     s:17320

      486    17319    1      KL$DREC.NWINFO = LINE_DREC.NWINFO + SIZEW( LINE_DREC.LN) + DEV_SIZEW;

  17319  4 001305   000017 236000 3                  LDQ     LINE_DREC+15
         4 001306   200035 036100                    ADLQ    DEV_SIZEW,,AUTO
         4 001307   000003 036007                    ADLQ    3,DL
         4 001310   000000 470400 xsym               LDP0    DSEG1$
         4 001311   000017 756100                    STQ     15,,PR0
         4 001312   001320 710000 4                  TRA     s:17322

      487    17320    1   ELSE IF CREATE THEN

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:71   
  17320  4 001313   200044 234100                    SZN     CREATE,,AUTO
         4 001314   001320 605000 4                  TPL     s:17322

      488    17321    1         KL$DREC.NWINFO = SIZEW( LINE_DREC.LN );

  17321  4 001315   000003 235007                    LDA     3,DL
         4 001316   000000 470400 xsym               LDP0    DSEG1$
         4 001317   000017 755100                    STA     15,,PR0

      489    17322    1   ARS = LENGTHC(KL_DREC_CNT) + ( KL$DREC.NWINFO * 4 ) ;

  17322  4 001320   000000 470400 xsym               LDP0    DSEG1$
         4 001321   000017 235100                    LDA     15,,PR0
         4 001322   000002 735000                    ALS     2
         4 001323   000100 035007                    ADLA    64,DL
         4 001324   200012 755100                    STA     ARS,,AUTO

      490    17323    1   USERS_KEY = LINE_KEY ;

  17323  4 001325   000000 100400                    MLR     fill='000'O
         4 001326   000000 000012 2                  ADSC9   LINE_KEY                 cn=0,n=10
         4 001327   000000 000052 xsym               ADSC9   USERS_KEY                cn=0,n=42

      491    17324    1   CALL ASB$WRITE_HLP( DSEG1$, ARS ) ALTRET ( WRITE_LINE_ERR ) ;

  17324  4 001330   200012 631500                    EPPR1   ARS,,AUTO
         4 001331   200455 451500                    STP1    KL$UBWORD+4,,AUTO
         4 001332   000006 236000 5                  LDQ     6
         4 001333   200454 756100                    STQ     KL$UBWORD+3,,AUTO
         4 001334   200454 630500                    EPPR0   KL$UBWORD+3,,AUTO
         4 001335   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 001336   000000 701000 xent               TSX1    ASB$WRITE_HLP
         4 001337   001424 702000 4                  TSX2    WRITE_LINE_ERR

      492    17325    2   IF CREATE THEN DO;

  17325  4 001340   200044 234100                    SZN     CREATE,,AUTO
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:72   
         4 001341   001360 605000 4                  TPL     s:17332

      493    17326    2      KL_TERM_REC = '0'B;

  17326  4 001342   000000 100400                    MLR     fill='000'O
         4 001343   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         4 001344   000004 000023 2                  ADSC9   KL_TERM_REC              cn=0,n=19

      494    17327    2      KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINE_NAME.TEXT;

  17327  4 001345   040000 100500                    MLR     fill='040'O
         4 001346   200446 200010                    ADSC9   LINE_NAME,,AUTO          cn=1,n=8
         4 001347   000013 400010 2                  ADSC9   KL_TERM_KEY+2            cn=2,n=8

      495    17328    2     CALL ASB$WRITE_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC)) ALTRET(NETCON_ERR)
             17328               ;

  17328  4 001350   000036 630400 5                  EPPR0   30
         4 001351   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 001352   000000 701000 xent               TSX1    ASB$WRITE_NETCON
         4 001353   001436 702000 4                  TSX2    NETCON_ERR

      496    17329    2      CALL ASB$CLOSE_NETCON;

  17329  4 001354   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 001355   000000 701000 xent               TSX1    ASB$CLOSE_NETCON
         4 001356   000000 011000                    NOP     0

      497    17330    2      END; /* If create */

  17330  4 001357   001413 710000 4                  TRA     EXIT#

      498    17331    2   ELSE DO;

      499    17332    2      KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINE_NAME.TEXT;

  17332  4 001360   040000 100500                    MLR     fill='040'O
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:73   
         4 001361   200446 200010                    ADSC9   LINE_NAME,,AUTO          cn=1,n=8
         4 001362   000013 400010 2                  ADSC9   KL_TERM_KEY+2            cn=2,n=8

      500    17333    2      CALL ASB$READ_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC))

  17333  4 001363   000036 630400 5                  EPPR0   30
         4 001364   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 001365   000000 701000 xent               TSX1    ASB$READ_NETCON
         4 001366   001370 702000 4                  TSX2    s:17335
         4 001367   001410 710000 4                  TRA     s:17345

      501    17334    3      WHENALTRETURN DO;

      502    17335    3         IF (MERR_CODE.CODE = %E$NOKEY)

  17335  4 001370   000000 236000 xsym               LDQ     ERR_CODE
         4 001371   377770 376007                    ANQ     131064,DL
         4 001372   001020 116007                    CMPQ    528,DL
         4 001373   001407 601000 4                  TNZ     s:17342

      503    17336    4         THEN DO;

      504    17337    4            KL_TERM_REC = '0'B;

  17337  4 001374   000000 100400                    MLR     fill='000'O
         4 001375   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         4 001376   000004 000023 2                  ADSC9   KL_TERM_REC              cn=0,n=19

      505    17338    4            KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINE_NAME.TEXT;

  17338  4 001377   040000 100500                    MLR     fill='040'O
         4 001400   200446 200010                    ADSC9   LINE_NAME,,AUTO          cn=1,n=8
         4 001401   000013 400010 2                  ADSC9   KL_TERM_KEY+2            cn=2,n=8

      506    17339    4            CALL ASB$WRITE_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC)) ALTRET(
             17339                     NETCON_ERR);

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:74   
  17339  4 001402   000036 630400 5                  EPPR0   30
         4 001403   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 001404   000000 701000 xent               TSX1    ASB$WRITE_NETCON
         4 001405   001436 702000 4                  TSX2    NETCON_ERR

      507    17340    4            END;

  17340  4 001406   001410 710000 4                  TRA     s:17345

      508    17341    4         ELSE DO;

      509    17342    4            GOTO NETCON_ERR;

  17342  4 001407   001436 710000 4                  TRA     NETCON_ERR

      510    17343    4            END;
      511    17344    3         END;
      512    17345    2      CALL ASB$CLOSE_NETCON;

  17345  4 001410   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 001411   000000 701000 xent               TSX1    ASB$CLOSE_NETCON
         4 001412   000000 011000                    NOP     0

      513    17346    2      END;

      514    17347    1   EXIT#:
      515    17348    1   CALL ASB$DEQ_HLP ALTRET( DEQ_ERR ) ;

  17348  4 001413   000002 631400 xsym  EXIT#        EPPR1   B_VECTNIL+2
         4 001414   000000 701000 xent               TSX1    ASB$DEQ_HLP
         4 001415   001507 702000 4                  TSX2    ENQ_ERR

      516    17349    1   RETURN ;

  17349  4 001416   000000 702200 xent               TSX2  ! X66_ARET

  17339  4 001417                       GETSEG_ERR   null
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:75   
      517    17350                                                              /* Errors */
      518    17351    1   GETSEG_ERR: ;
      519    17352        %SCREAM( ERR#=%E$GETSEGERR, LEVEL=ERROR, MID='A') ;

  17364  4 001417   000040 630400 5                  EPPR0   32
         4 001420   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001421   000000 701000 xent               TSX1    ASH$ERROR
         4 001422   000000 011000                    NOP     0

      520    17367    1   RETURN ;

  17367  4 001423   000000 702200 xent               TSX2  ! X66_ARET

  17364  4 001424                       WRITE_LINE_* null
      521    17368                                                              /**/
      522    17369                                                              /**/
      523    17370    1   WRITE_LINE_ERR: ;
      524    17371    1   CALL ASH$ERROR( ERR_CODE ) ;

  17371  4 001424   000041 630400 5                  EPPR0   33
         4 001425   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001426   000000 701000 xent               TSX1    ASH$ERROR
         4 001427   000000 011000                    NOP     0

      525    17372    1   RETURN ;

  17372  4 001430   000000 702200 xent               TSX2  ! X66_ARET

  17364  4 001431                       CMD_ERR      null
      526    17373                                                              /**/
      527    17374    1   CMD_ERR: ;
      528    17375    1   CALL ASH$ERROR( P_PCB.ERROR ) ;

  17375  4 001431   000031 630400 5                  EPPR0   25
         4 001432   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001433   000000 701000 xent               TSX1    ASH$ERROR
         4 001434   000000 011000                    NOP     0
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:76   

      529    17376    1   RETURN ;

  17376  4 001435   000000 702200 xent               TSX2  ! X66_ARET

  17364  4 001436                       NETCON_ERR   null
      530    17377                                      /**/
      531    17378    1   NETCON_ERR:;
      532    17379    1   ERR_CODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR;

  17379  4 001436   000000 470400 xsym               LDP0    B$TCB$
         4 001437   000000 471500                    LDP1    0,,PR0
         4 001440   100102 236100                    LDQ     66,,PR1
         4 001441   000000 756000 xsym               STQ     ERR_CODE

      533    17380    1   CALL ASH$ERROR(ERR_CODE);

  17380  4 001442   000041 630400 5                  EPPR0   33
         4 001443   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001444   000000 701000 xent               TSX1    ASH$ERROR
         4 001445   000000 011000                    NOP     0

      534    17381    1   RETURN;

  17381  4 001446   000000 702200 xent               TSX2  ! X66_ARET

  17379  4 001447                       CM_LINE_ERR  null
      535    17382                                                              /**/
      536    17383    1   CM_LINE_ERR: ;
      537    17384    2   IF MERR_CODE.CODE ~= %E$NOKEY THEN DO;

  17384  4 001447   000000 236000 xsym               LDQ     ERR_CODE
         4 001450   377770 376007                    ANQ     131064,DL
         4 001451   001020 116007                    CMPQ    528,DL
         4 001452   001460 600000 4                  TZE     s:17388

      538    17385    2      CALL ASA$ERROR( USERS_KEY, E$UNABLE_TO_READ_HLP );
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:77   

  17385  4 001453   000043 630400 5                  EPPR0   35
         4 001454   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 001455   000000 701000 xent               TSX1    ASA$ERROR
         4 001456   000000 011000                    NOP     0

      539    17386    2      RETURN;

  17386  4 001457   000000 702200 xent               TSX2  ! X66_ARET

      540    17387    2      END;
      541    17388    2   IF LINE THEN DO;

  17388  4 001460   200040 234100                    SZN     LINE,,AUTO
         4 001461   001477 605000 4                  TPL     s:17417

      542    17389    3      IF NOT CREATE THEN DO;

  17389  4 001462   200044 234100                    SZN     CREATE,,AUTO
         4 001463   001476 604000 4                  TMI     s:17411

      543    17390        /*E*  ERROR:    ASA-E$LINE_NO_EXIST1-C
      544    17391              MESSAGE0: Line %%U1 %does not exist. Switching to CREATE mode.
      545    17392        */
      546    17393    3         AS_FIELD1 = LINE_NAME;

  17393  4 001464   000000 100500                    MLR     fill='000'O
         4 001465   200446 000011                    ADSC9   LINE_NAME,,AUTO          cn=0,n=9
         4 001466   000000 000051 xsym               ADSC9   AS_FIELD1                cn=0,n=41

      547    17394              %SCREAM( ERR#=E$LINE_NO_EXIST1, LEVEL=WARN, MID='A') ;

  17404  4 001467   000045 630400 5                  EPPR0   37
         4 001470   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001471   000000 701000 xent               TSX1    ASH$WARN
         4 001472   000000 011000                    NOP     0

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:78   
      548    17409    3         CREATE = AS_TRUE ;

  17409  4 001473   000000 236000 xsym               LDQ     AS_TRUE
         4 001474   400000 376003                    ANQ     -131072,DU
         4 001475   200044 756100                    STQ     CREATE,,AUTO

      549    17410    3         END;

      550    17411    2      GOTO CREATE_LINE ;

  17411  4 001476   000223 710000 4                  TRA     CREATE_LINE

      551    17412    2      END;
      552    17413    2   ELSE DO;

      553    17414        /*E*  ERROR:    ASA-E$LINE_NO_EXIST2-C
      554    17415              MESSAGE0: Line %%U1 %does not exist.
      555    17416        */
      556    17417    2      AS_FIELD1 = LINE_NAME;

  17417  4 001477   000000 100500                    MLR     fill='000'O
         4 001500   200446 000011                    ADSC9   LINE_NAME,,AUTO          cn=0,n=9
         4 001501   000000 000051 xsym               ADSC9   AS_FIELD1                cn=0,n=41

      557    17418           %SCREAM( ERR#=E$LINE_NO_EXIST2, LEVEL=WARN, MID='A') ;

  17428  4 001502   000046 630400 5                  EPPR0   38
         4 001503   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001504   000000 701000 xent               TSX1    ASH$WARN
         4 001505   000000 011000                    NOP     0

      558    17433    2      RETURN;

  17433  4 001506   000000 702200 xent               TSX2  ! X66_ARET

  17388  4 001507                       ENQ_ERR      null
      559    17434    2      END;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:79   
      560    17435                                                              /**/
      561    17436    1   ENQ_ERR: ;
      562    17437                                                              /**/
      563    17438    1   DEQ_ERR: ;

  17438  4 001507                       DEQ_ERR      null
      564    17439    1   RETURN ;

  17439  4 001507   000000 702200 xent               TSX2  ! X66_ARET

      565    17440
      566    17441        %EJECT;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:80   
      567    17442    1   FIND_CONTROLLER: PROC ALTRET;

  17442  4 001510   200452 741300       FIND_CONTRO* STX1  ! KL$UBWORD+1,,AUTO

      568    17443
      569    17444
      570    17445                                                          /* Get controller # */
      571    17446    2   IF CONTROLLER THEN

  17446  4 001511   200041 234100                    SZN     CONTROLLER,,AUTO
         4 001512   001517 605000 4                  TPL     s:17449

      572    17447    2      BLK$ = P$NODE.SUBLK$(0);

  17447  4 001513   000000 470400 xsym               LDP0    NODE$
         4 001514   000003 236100                    LDQ     3,,PR0
         4 001515   200027 756100                    STQ     BLK$,,AUTO
         4 001516   001522 710000 4                  TRA     s:17450

      573    17448    2   ELSE
      574    17449    2      BLK$ = P$NODE.SUBLK$(2);

  17449  4 001517   000000 470400 xsym               LDP0    NODE$
         4 001520   000005 236100                    LDQ     5,,PR0
         4 001521   200027 756100                    STQ     BLK$,,AUTO

      575    17450    2   CALL CHARBIN( CONT#, OUT$SYM.TEXT );

  17450  4 001522   200027 471500                    LDP1    BLK$,,AUTO
         4 001523   100004 236100                    LDQ     4,,PR1
         4 001524   000033 772000                    QRL     27
         4 001525   000000 620006                    EAX0    0,QL
         4 001526   000100 305540                    DTB
         4 001527   100004 230010                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X0
         4 001530   200013 000004                    NDSC9   CONT#,,AUTO              cn=0,s=lsgnf,sf=0,n=4

      576    17451    3   IF CONT# > 31 THEN DO;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:81   

  17451  4 001531   200013 235100                    LDA     CONT#,,AUTO
         4 001532   000037 115007                    CMPA    31,DL
         4 001533   001542 604400 4                  TMOZ    s:17474

      577    17452        /*E*  ERROR:  ASA-E$BAD_CONT_NUM-C
      578    17453              MESSAGE: Illegal CONTROLLER number.
      579    17454              MESSAGE1: A CONTROLLER number must be between 0 and 31.
      580    17455        */
      581    17456           %SCREAM( ERR#=E$BAD_CONT_NUM, LEVEL=ERROR, MID='A' );

  17468  4 001534   000047 630400 5                  EPPR0   39
         4 001535   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001536   000000 701000 xent               TSX1    ASH$ERROR
         4 001537   000000 011000                    NOP     0

      582    17471    3      ALTRETURN;

  17471  4 001540   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 001541   000000 702211                    TSX2  ! 0,X1

      583    17472    3      END;
      584    17473                                                      /* See if the controller exists.*/
      585    17474    2   CONT$ = DEV_START$;

  17474  4 001542   200033 236100                    LDQ     DEV_START$,,AUTO
         4 001543   200026 756100                    STQ     CONT$,,AUTO

      586    17475    2   DEV_STOP$ = PINCRW( CONT$, DEV_SIZEW);

  17475  4 001544   200035 236100                    LDQ     DEV_SIZEW,,AUTO
         4 001545   000022 736000                    QLS     18
         4 001546   200026 036100                    ADLQ    CONT$,,AUTO
         4 001547   200034 756100                    STQ     DEV_STOP$,,AUTO

      587    17476    2   FOUND = '0'B;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:82   
  17476  4 001550   200036 450100                    STZ     FOUND,,AUTO

      588    17477    2   DONE = '0'B;

  17477  4 001551   200037 450100                    STZ     DONE,,AUTO

      589    17478    3   DO WHILE(CONT$ < DEV_STOP$  AND NOT FOUND  AND NOT DONE );

  17478  4 001552   001610 710000 4                  TRA     s:17488

      590    17479    3      IF CONT$ -> KL$CONTROLLER.CONT# = CONT# THEN

  17479  4 001553   200026 470500                    LDP0    CONT$,,AUTO
         4 001554   000100 101500                    MRL     fill='000'O
         4 001555   000002 000001                    ADSC9   2,,PR0                   cn=0,n=1
         4 001556   200454 000004                    ADSC9   KL$UBWORD+3,,AUTO        cn=0,n=4
         4 001557   200454 236100                    LDQ     KL$UBWORD+3,,AUTO
         4 001560   200013 116100                    CMPQ    CONT#,,AUTO
         4 001561   001566 601000 4                  TNZ     s:17482

      591    17480    3         FOUND = AS_TRUE;

  17480  4 001562   000000 236000 xsym               LDQ     AS_TRUE
         4 001563   400000 376003                    ANQ     -131072,DU
         4 001564   200036 756100                    STQ     FOUND,,AUTO
         4 001565   001610 710000 4                  TRA     s:17488

      592    17481    3      ELSE
      593    17482    3         IF CONT$ -> KL$CONTROLLER.CONT# > CONT# THEN

  17482  4 001566   000100 101500                    MRL     fill='000'O
         4 001567   000002 000001                    ADSC9   2,,PR0                   cn=0,n=1
         4 001570   200454 000004                    ADSC9   KL$UBWORD+3,,AUTO        cn=0,n=4
         4 001571   200454 236100                    LDQ     KL$UBWORD+3,,AUTO
         4 001572   200013 116100                    CMPQ    CONT#,,AUTO
         4 001573   001600 604400 4                  TMOZ    s:17485

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:83   
      594    17483    3            DONE = AS_TRUE;

  17483  4 001574   000000 236000 xsym               LDQ     AS_TRUE
         4 001575   400000 376003                    ANQ     -131072,DU
         4 001576   200037 756100                    STQ     DONE,,AUTO
         4 001577   001610 710000 4                  TRA     s:17488

      595    17484    4         ELSE DO;

      596    17485    4            CONT_INDEX = CONT$ -> KL$CONTROLLER.BLKHDR.NSUBS;

  17485  4 001600   000100 101500                    MRL     fill='000'O
         4 001601   000000 200001                    ADSC9   0,,PR0                   cn=1,n=1
         4 001602   200014 000004                    ADSC9   CONT_INDEX,,AUTO         cn=0,n=4

      597    17486    4           CONT$ = PINCRW( CONT$, SIZEW(KL_CONTROLLER)+(CONT_INDEX*SIZEW(KL_LINEDEV)))
             17486                     ;

  17486  4 001603   200014 236100                    LDQ     CONT_INDEX,,AUTO
         4 001604   000024 736000                    QLS     20
         4 001605   000004 036003                    ADLQ    4,DU
         4 001606   200026 036100                    ADLQ    CONT$,,AUTO
         4 001607   200026 756100                    STQ     CONT$,,AUTO

      598    17487    4            END;

      599    17488    3      END;

  17488  4 001610   200026 236100                    LDQ     CONT$,,AUTO
         4 001611   200034 116100                    CMPQ    DEV_STOP$,,AUTO
         4 001612   001617 603000 4                  TRC     s:17489
         4 001613   200036 234100                    SZN     FOUND,,AUTO
         4 001614   001617 604000 4                  TMI     s:17489
         4 001615   200037 234100                    SZN     DONE,,AUTO
         4 001616   001553 605000 4                  TPL     s:17479

      600    17489    2   IF FOUND THEN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:84   

  17489  4 001617   200036 234100                    SZN     FOUND,,AUTO
         4 001620   001652 605000 4                  TPL     s:17516

      601    17490    3      IF CREATE AND CONTROLLER THEN DO;

  17490  4 001621   200044 234100                    SZN     CREATE,,AUTO
         4 001622   001644 605000 4                  TPL     s:17514
         4 001623   200041 234100                    SZN     CONTROLLER,,AUTO
         4 001624   001644 605000 4                  TPL     s:17514

      602    17491        /*E*  ERROR:  ASA-E$CONT_EXISTS-C
      603    17492              MESSAGE: Controller %U1 already exists.
      604    17493              MESSAGE1: You cannot create a controller that already exists.
      605    17494        */
      606    17495    3         AS_FIELD1.COUNT = OUT$SYM.COUNT;

  17495  4 001625   200027 470500                    LDP0    BLK$,,AUTO
         4 001626   000004 236100                    LDQ     4,,PR0
         4 001627   000000 552040 xsym               STBQ    AS_FIELD1,'40'O

      607    17496    3         AS_FIELD1.TEXT  = OUT$SYM.TEXT;

  17496  4 001630   000004 236100                    LDQ     4,,PR0
         4 001631   000033 772000                    QRL     27
         4 001632   000000 620006                    EAX0    0,QL
         4 001633   040000 100540                    MLR     fill='040'O
         4 001634   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
         4 001635   000000 200050 xsym               ADSC9   AS_FIELD1                cn=1,n=40

      608    17497              %SCREAM( ERR#=E$CONT_EXISTS, LEVEL=ERROR, MID='A' );

  17509  4 001636   000050 630400 5                  EPPR0   40
         4 001637   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001640   000000 701000 xent               TSX1    ASH$ERROR
         4 001641   000000 011000                    NOP     0

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:85   
      609    17512    3         ALTRETURN;

  17512  4 001642   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 001643   000000 702211                    TSX2  ! 0,X1

      610    17513    3         END;
      611    17514    2      ELSE KL$CONTROLLER = CONT$ -> KL$CONTROLLER;

  17514  4 001644   200026 470500                    LDP0    CONT$,,AUTO
         4 001645   200025 471500                    LDP1    CONTPTR$,,AUTO
         4 001646   000100 100500                    MLR     fill='000'O
         4 001647   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16
         4 001650   100000 000020                    ADSC9   0,,PR1                   cn=0,n=16
         4 001651   001720 710000 4                  TRA     s:17566

      612    17515    2   ELSE
      613    17516    3      IF DEVICE THEN DO;

  17516  4 001652   200042 234100                    SZN     DEVICE,,AUTO
         4 001653   001676 605000 4                  TPL     s:17542

      614    17517        /*E*  ERROR:  ASA-E$CONT_NO_EXIST2-C
      615    17518              MESSAGE: Controller %U1 does not exist.
      616    17519              MESSAGE1: Controller %U1 does not exist for line %U2.
      617    17520        */
      618    17521    3         AS_FIELD1.COUNT = OUT$SYM.COUNT;

  17521  4 001654   200027 470500                    LDP0    BLK$,,AUTO
         4 001655   000004 236100                    LDQ     4,,PR0
         4 001656   000000 552040 xsym               STBQ    AS_FIELD1,'40'O

      619    17522    3         AS_FIELD1.TEXT  = OUT$SYM.TEXT;

  17522  4 001657   000004 236100                    LDQ     4,,PR0
         4 001660   000033 772000                    QRL     27
         4 001661   000000 620006                    EAX0    0,QL
         4 001662   040000 100540                    MLR     fill='040'O
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:86   
         4 001663   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
         4 001664   000000 200050 xsym               ADSC9   AS_FIELD1                cn=1,n=40

      620    17523    3         AS_FIELD2 = LINE_NAME;

  17523  4 001665   000000 100500                    MLR     fill='000'O
         4 001666   200446 000011                    ADSC9   LINE_NAME,,AUTO          cn=0,n=9
         4 001667   000000 000051 xsym               ADSC9   AS_FIELD2                cn=0,n=41

      621    17524              %SCREAM( ERR#=E$CONT_NO_EXIST2, LEVEL=ERROR, MID='A' );

  17536  4 001670   000051 630400 5                  EPPR0   41
         4 001671   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001672   000000 701000 xent               TSX1    ASH$ERROR
         4 001673   000000 011000                    NOP     0

      622    17539    3         ALTRETURN;

  17539  4 001674   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 001675   000000 702211                    TSX2  ! 0,X1

      623    17540    3         END;
      624    17541    2      ELSE
      625    17542    3         IF NOT CREATE THEN DO;

  17542  4 001676   200044 234100                    SZN     CREATE,,AUTO
         4 001677   001720 604000 4                  TMI     s:17566

      626    17543        /*E*  ERROR:  ASA-E$CONT_NO_EXIST1-C
      627    17544              MESSAGE: Controller %U1 does not exist. Switching to CREATE mode.
      628    17545        */
      629    17546    3            AS_FIELD1.COUNT = OUT$SYM.COUNT;

  17546  4 001700   200027 470500                    LDP0    BLK$,,AUTO
         4 001701   000004 236100                    LDQ     4,,PR0
         4 001702   000000 552040 xsym               STBQ    AS_FIELD1,'40'O

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:87   
      630    17547    3            AS_FIELD1.TEXT  = OUT$SYM.TEXT;

  17547  4 001703   000004 236100                    LDQ     4,,PR0
         4 001704   000033 772000                    QRL     27
         4 001705   000000 620006                    EAX0    0,QL
         4 001706   040000 100540                    MLR     fill='040'O
         4 001707   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
         4 001710   000000 200050 xsym               ADSC9   AS_FIELD1                cn=1,n=40

      631    17548                 %SCREAM( ERR#=E$CONT_NO_EXIST1, LEVEL=WARN, MID='A' );

  17558  4 001711   000052 630400 5                  EPPR0   42
         4 001712   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001713   000000 701000 xent               TSX1    ASH$WARN
         4 001714   000000 011000                    NOP     0

      632    17563    3            CREATE = AS_TRUE;

  17563  4 001715   000000 236000 xsym               LDQ     AS_TRUE
         4 001716   400000 376003                    ANQ     -131072,DU
         4 001717   200044 756100                    STQ     CREATE,,AUTO

      633    17564    3            END;

      634    17565
      635    17566    3   IF CONTROLLER AND CREATE THEN DO;    /* Initialize controller field */

  17566  4 001720   200041 234100                    SZN     CONTROLLER,,AUTO
         4 001721   001772 605000 4                  TPL     s:17580
         4 001722   200044 234100                    SZN     CREATE,,AUTO
         4 001723   001772 605000 4                  TPL     s:17580

      636    17567    3      KL$CONTROLLER = KL_CONTROLLER;

  17567  4 001724   200025 470500                    LDP0    CONTPTR$,,AUTO
         4 001725   000100 100400                    MLR     fill='000'O
         4 001726   000023 000020 3                  ADSC9   KL_CONTROLLER            cn=0,n=16
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:88   
         4 001727   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16

      637    17568    3      KL$CONTROLLER.CONT# = CONT#;

  17568  4 001730   000100 101500                    MRL     fill='000'O
         4 001731   200013 000004                    ADSC9   CONT#,,AUTO              cn=0,n=4
         4 001732   000002 000001                    ADSC9   2,,PR0                   cn=0,n=1

      638    17569    3      KL$CONTROLLER.BLKHDR.NSUBS = 0;

  17569  4 001733   000100 101400                    MRL     fill='000'O
         4 001734   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         4 001735   000000 200001                    ADSC9   0,,PR0                   cn=1,n=1

      639    17570    3      KL$CONTROLLER.BLKHDR.LEV = 2;

  17570  4 001736   000100 101400                    MRL     fill='000'O
         4 001737   000004 000004 xsym               ADSC9   B_VECTNIL+4              cn=0,n=4
         4 001740   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

      640    17571    3      KL$CONTROLLER.BLKHDR.DEVNUM = CONT#;

  17571  4 001741   000100 101500                    MRL     fill='000'O
         4 001742   200013 000004                    ADSC9   CONT#,,AUTO              cn=0,n=4
         4 001743   000001 400001                    ADSC9   1,,PR0                   cn=2,n=1

      641    17572    3      KL$CONTROLLER.BLKHDR.BLKTYP = %KLTY_CONT#;

  17572  4 001744   000100 101400                    MRL     fill='000'O
         4 001745   000013 000004 xsym               ADSC9   B_VECTNIL+11             cn=0,n=4
         4 001746   000001 000001                    ADSC9   1,,PR0                   cn=0,n=1

      642    17573    3      LNG_CNT = LENGTHC(KL_CONTROLLER);

  17573  4 001747   000020 235007                    LDA     16,DL
         4 001750   000003 755000 2                  STA     LNGTH

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:89   
      643    17574    3      KL$UBWORD.NUM = 0;

  17574  4 001751   000000 220003                    LDX0    0,DU
         4 001752   200451 440100                    SXL0    KL$UBWORD,,AUTO

      644    17575    3      KL$UBWORD.REPLACE.T = LNGTH.T;

  17575  4 001753   000003 236000 2                  LDQ     LNGTH
         4 001754   000001 736000                    QLS     1
         4 001755   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 001756   377000 376007                    ANQ     130560,DL
         4 001757   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      645    17576    3      KL$UBWORD.REPLACE.B = LNGTH.B;

  17576  4 001760   000003 236000 2                  LDQ     LNGTH
         4 001761   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 001762   000377 376007                    ANQ     255,DL
         4 001763   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      646    17577    3      KL$CONTROLLER.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;

  17577  4 001764   003100 060500                    CSL     bolr='003'O
         4 001765   200451 410010                    BDSC    KL$UBWORD,,AUTO          by=2,bit=1,n=8
         4 001766   000000 410010                    BDSC    0,,PR0                   by=2,bit=1,n=8

      647    17578    3      KL$CONTROLLER.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;

  17578  4 001767   003100 060500                    CSL     bolr='003'O
         4 001770   200451 610010                    BDSC    KL$UBWORD,,AUTO          by=3,bit=1,n=8
         4 001771   000000 610010                    BDSC    0,,PR0                   by=3,bit=1,n=8

      648    17579    3      END;

      649    17580    2   END FIND_CONTROLLER;

  17580  4 001772   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:90   
         4 001773   000001 702211                    TSX2  ! 1,X1

      650    17581        %EJECT;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:91   
      651    17582    1   FIND_DEVICE: PROC ALTRET;

  17582  4 001774   200452 741300       FIND_DEVICE  STX1  ! KL$UBWORD+1,,AUTO

      652    17583
      653    17584
      654    17585    2   BLK$ = P$NODE.SUBLK$(0);

  17585  4 001775   000000 470400 xsym               LDP0    NODE$
         4 001776   000003 236100                    LDQ     3,,PR0
         4 001777   200027 756100                    STQ     BLK$,,AUTO

      655    17586    2   CALL CHARBIN(DEV#, OUT$SYM.TEXT);

  17586  4 002000   200027 471500                    LDP1    BLK$,,AUTO
         4 002001   100004 236100                    LDQ     4,,PR1
         4 002002   000033 772000                    QRL     27
         4 002003   000000 620006                    EAX0    0,QL
         4 002004   000100 305540                    DTB
         4 002005   100004 230010                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X0
         4 002006   200015 000004                    NDSC9   DEV#,,AUTO               cn=0,s=lsgnf,sf=0,n=4

      656    17587    3   IF DEV# > 31 THEN DO;

  17587  4 002007   200015 235100                    LDA     DEV#,,AUTO
         4 002010   000037 115007                    CMPA    31,DL
         4 002011   002020 604400 4                  TMOZ    s:17610

      657    17588        /*E*  ERROR:  ASA-E$BAD_CONT_DEV_NUM-C
      658    17589              MESSAGE: Invalid DEVICE number.
      659    17590              MESSAGE1: A DEVICE number must be between 0 and 31.
      660    17591        */
      661    17592           %SCREAM( ERR#=E$BAD_CONT_DEV_NUM, LEVEL=ERROR, MID='A' );

  17604  4 002012   000053 630400 5                  EPPR0   43
         4 002013   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002014   000000 701000 xent               TSX1    ASH$ERROR
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:92   
         4 002015   000000 011000                    NOP     0

      662    17607    3      ALTRETURN;

  17607  4 002016   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 002017   000000 702211                    TSX2  ! 0,X1

      663    17608    3      END;
      664    17609
      665    17610    2   DEV$ = PINCRW (CONT$, SIZEW( KL_CONTROLLER));

  17610  4 002020   200026 236100                    LDQ     CONT$,,AUTO
         4 002021   000004 036003                    ADLQ    4,DU
         4 002022   200030 756100                    STQ     DEV$,,AUTO

      666    17611    2   DEV_END$ = PINCRW(DEV$, KL$CONTROLLER.BLKHDR.NSUBS*SIZEW(KL_LINEDEV));

  17611  4 002023   200025 473500                    LDP3    CONTPTR$,,AUTO
         4 002024   000100 101500                    MRL     fill='000'O
         4 002025   300000 200001                    ADSC9   0,,PR3                   cn=1,n=1
         4 002026   200454 000002                    ADSC9   KL$UBWORD+3,,AUTO        cn=0,n=2
         4 002027   200454 220100                    LDX0    KL$UBWORD+3,,AUTO
         4 002030   000000 636010                    EAQ     0,X0
         4 002031   000002 736000                    QLS     2
         4 002032   200030 036100                    ADLQ    DEV$,,AUTO
         4 002033   200032 756100                    STQ     DEV_END$,,AUTO

      667    17612    2   FOUND = '0'B;

  17612  4 002034   200036 450100                    STZ     FOUND,,AUTO

      668    17613    2   DONE = '0'B;

  17613  4 002035   200037 450100                    STZ     DONE,,AUTO

      669    17614    3   DO WHILE( DEV$ < DEV_END$  AND  NOT FOUND  AND  NOT DONE );

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:93   
  17614  4 002036   002101 710000 4                  TRA     s:17622

      670    17615    3      IF DEV$->KL$LINEDEV.DEVICE# = DEV# AND DEV$->KL$LINEDEV.CONTROLLER# = CONT# THEN

  17615  4 002037   200030 470500                    LDP0    DEV$,,AUTO
         4 002040   000100 101500                    MRL     fill='000'O
         4 002041   000002 200001                    ADSC9   2,,PR0                   cn=1,n=1
         4 002042   200454 000004                    ADSC9   KL$UBWORD+3,,AUTO        cn=0,n=4
         4 002043   200454 236100                    LDQ     KL$UBWORD+3,,AUTO
         4 002044   200015 116100                    CMPQ    DEV#,,AUTO
         4 002045   002057 601000 4                  TNZ     s:17618
         4 002046   000100 101500                    MRL     fill='000'O
         4 002047   000002 000001                    ADSC9   2,,PR0                   cn=0,n=1
         4 002050   200455 000004                    ADSC9   KL$UBWORD+4,,AUTO        cn=0,n=4
         4 002051   200455 236100                    LDQ     KL$UBWORD+4,,AUTO
         4 002052   200013 116100                    CMPQ    CONT#,,AUTO
         4 002053   002057 601000 4                  TNZ     s:17618

      671    17616    3         FOUND = '1'B;

  17616  4 002054   400000 236003                    LDQ     -131072,DU
         4 002055   200036 756100                    STQ     FOUND,,AUTO
         4 002056   002101 710000 4                  TRA     s:17622

      672    17617    3      ELSE
      673    17618    3         IF DEV$->KL$LINEDEV.DEVICE# > DEV# AND DEV$->KL$LINEDEV.CONTROLLER# = CONT#
             17618                  THEN

  17618  4 002057   000100 101500                    MRL     fill='000'O
         4 002060   000002 200001                    ADSC9   2,,PR0                   cn=1,n=1
         4 002061   200454 000004                    ADSC9   KL$UBWORD+3,,AUTO        cn=0,n=4
         4 002062   200454 236100                    LDQ     KL$UBWORD+3,,AUTO
         4 002063   200015 116100                    CMPQ    DEV#,,AUTO
         4 002064   002076 604400 4                  TMOZ    s:17621
         4 002065   000100 101500                    MRL     fill='000'O
         4 002066   000002 000001                    ADSC9   2,,PR0                   cn=0,n=1
         4 002067   200455 000004                    ADSC9   KL$UBWORD+4,,AUTO        cn=0,n=4
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:94   
         4 002070   200455 236100                    LDQ     KL$UBWORD+4,,AUTO
         4 002071   200013 116100                    CMPQ    CONT#,,AUTO
         4 002072   002076 601000 4                  TNZ     s:17621

      674    17619    3            DONE = '1'B;

  17619  4 002073   400000 236003                    LDQ     -131072,DU
         4 002074   200037 756100                    STQ     DONE,,AUTO
         4 002075   002101 710000 4                  TRA     s:17622

      675    17620    3         ELSE
      676    17621    3            DEV$ = PINCRW(DEV$, SIZEW(KL_LINEDEV));

  17621  4 002076   200030 236100                    LDQ     DEV$,,AUTO
         4 002077   000004 036003                    ADLQ    4,DU
         4 002100   200030 756100                    STQ     DEV$,,AUTO

      677    17622    3      END;

  17622  4 002101   200030 236100                    LDQ     DEV$,,AUTO
         4 002102   200032 116100                    CMPQ    DEV_END$,,AUTO
         4 002103   002110 603000 4                  TRC     s:17624
         4 002104   200036 234100                    SZN     FOUND,,AUTO
         4 002105   002110 604000 4                  TMI     s:17624
         4 002106   200037 234100                    SZN     DONE,,AUTO
         4 002107   002037 605000 4                  TPL     s:17615

      678    17623
      679    17624    3   IF FOUND THEN DO;

  17624  4 002110   200036 234100                    SZN     FOUND,,AUTO
         4 002111   002157 605000 4                  TPL     s:17682

      680    17625    4      IF CREATE THEN DO;

  17625  4 002112   200044 234100                    SZN     CREATE,,AUTO
         4 002113   002151 605000 4                  TPL     s:17679
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:95   

      681    17626        /*E*  ERROR:  ASA-E$CONT_DEV_EXISTS-C
      682    17627              MESSAGE: Device %U1 already exists.
      683    17628              MESSAGE1: Device %U1 for line %U3 controller %U2 already exists.
      684    17629                        You cannot create a device that already exists.
      685    17630        */
      686    17631              %NUMBER( NUM1=DEV#, NUM2=CONT# );
             17639    4         CALL ASB$BINCHAR( AS_FIELD1.TEXT, 0, -1, DEV# );

  17639  4 002114   200015 630500                    EPPR0   DEV#,,AUTO
         4 002115   200457 450500                    STP0    KL$UBWORD+6,,AUTO
         4 002116   000054 236000 5                  LDQ     44
         4 002117   200456 756100                    STQ     KL$UBWORD+5,,AUTO
         4 002120   000056 237000 5                  LDAQ    46
         4 002121   200454 757100                    STAQ    KL$UBWORD+3,,AUTO
         4 002122   200454 630500                    EPPR0   KL$UBWORD+3,,AUTO
         4 002123   000022 631400 xsym               EPPR1   B_VECTNIL+18
         4 002124   000000 701000 xent               TSX1    ASB$BINCHAR
         4 002125   000000 011000                    NOP     0

             17647    4         CALL ASB$BINCHAR( AS_FIELD2.TEXT, 0, -2, CONT# );

  17647  4 002126   200013 630500                    EPPR0   CONT#,,AUTO
         4 002127   200457 450500                    STP0    KL$UBWORD+6,,AUTO
         4 002130   000061 236000 5                  LDQ     49
         4 002131   200456 756100                    STQ     KL$UBWORD+5,,AUTO
         4 002132   000062 237000 5                  LDAQ    50
         4 002133   200454 757100                    STAQ    KL$UBWORD+3,,AUTO
         4 002134   200454 630500                    EPPR0   KL$UBWORD+3,,AUTO
         4 002135   000022 631400 xsym               EPPR1   B_VECTNIL+18
         4 002136   000000 701000 xent               TSX1    ASB$BINCHAR
         4 002137   000000 011000                    NOP     0

      687    17661    4         AS_FIELD3 = LINE_NAME;

  17661  4 002140   000000 100500                    MLR     fill='000'O
         4 002141   200446 000011                    ADSC9   LINE_NAME,,AUTO          cn=0,n=9
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:96   
         4 002142   000000 000051 xsym               ADSC9   AS_FIELD3                cn=0,n=41

      688    17662              %SCREAM( ERR#=E$CONT_DEV_EXISTS, LEVEL=ERROR,MID='A');

  17674  4 002143   000064 630400 5                  EPPR0   52
         4 002144   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002145   000000 701000 xent               TSX1    ASH$ERROR
         4 002146   000000 011000                    NOP     0

      689    17677    4         ALTRETURN;

  17677  4 002147   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 002150   000000 702211                    TSX2  ! 0,X1

      690    17678    4         END;
      691    17679    3      KL$LINEDEV = DEV$->KL$LINEDEV;

  17679  4 002151   200030 470500                    LDP0    DEV$,,AUTO
         4 002152   000000 471400 xsym               LDP1    DSEG3$
         4 002153   000100 100500                    MLR     fill='000'O
         4 002154   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16
         4 002155   100000 000020                    ADSC9   0,,PR1                   cn=0,n=16

      692    17680    3      END;

  17680  4 002156   002257 710000 4                  TRA     s:17748

      693    17681    3   ELSE DO;

      694    17682    4      IF NOT CREATE THEN DO;

  17682  4 002157   200044 234100                    SZN     CREATE,,AUTO
         4 002160   002202 604000 4                  TMI     s:17733

      695    17683        /*E*  ERROR:  ASA-E$LINEDEV_NO_EXIST2-C
      696    17684              MESSAGE: Device %U1 does not exist. Switching to CREATE mode.
      697    17685        */
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:97   
      698    17686              %NUMBER( NUM1=DEV# );
             17694    4         CALL ASB$BINCHAR( AS_FIELD1.TEXT, 0, -1, DEV# );

  17694  4 002161   200015 630500                    EPPR0   DEV#,,AUTO
         4 002162   200457 450500                    STP0    KL$UBWORD+6,,AUTO
         4 002163   000054 236000 5                  LDQ     44
         4 002164   200456 756100                    STQ     KL$UBWORD+5,,AUTO
         4 002165   000056 237000 5                  LDAQ    46
         4 002166   200454 757100                    STAQ    KL$UBWORD+3,,AUTO
         4 002167   200454 630500                    EPPR0   KL$UBWORD+3,,AUTO
         4 002170   000022 631400 xsym               EPPR1   B_VECTNIL+18
         4 002171   000000 701000 xent               TSX1    ASB$BINCHAR
         4 002172   000000 011000                    NOP     0

      699    17716              %SCREAM(ERR#=E$LINEDEV_NO_EXIST2,LEVEL=WARN,MID='A');

  17726  4 002173   000065 630400 5                  EPPR0   53
         4 002174   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002175   000000 701000 xent               TSX1    ASH$WARN
         4 002176   000000 011000                    NOP     0

      700    17731    4         CREATE = AS_TRUE;

  17731  4 002177   000000 236000 xsym               LDQ     AS_TRUE
         4 002200   400000 376003                    ANQ     -131072,DU
         4 002201   200044 756100                    STQ     CREATE,,AUTO

      701    17732    4         END;

      702    17733    3      KL$LINEDEV = KL_LINEDEV;

  17733  4 002202   000000 470400 xsym               LDP0    DSEG3$
         4 002203   000100 100400                    MLR     fill='000'O
         4 002204   000027 000020 3                  ADSC9   KL_LINEDEV               cn=0,n=16
         4 002205   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16

      703    17734    3      KL$LINEDEV.CONTROLLER# = CONT#;
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:98   

  17734  4 002206   000000 470400 xsym               LDP0    DSEG3$
         4 002207   000100 101500                    MRL     fill='000'O
         4 002210   200013 000004                    ADSC9   CONT#,,AUTO              cn=0,n=4
         4 002211   000002 000001                    ADSC9   2,,PR0                   cn=0,n=1

      704    17735    3      KL$LINEDEV.DEVICE#  = DEV#;

  17735  4 002212   000100 101500                    MRL     fill='000'O
         4 002213   200015 000004                    ADSC9   DEV#,,AUTO               cn=0,n=4
         4 002214   000002 200001                    ADSC9   2,,PR0                   cn=1,n=1

      705    17736    3      KL$LINEDEV.BLKHDR.LEV = 3;

  17736  4 002215   000100 101400                    MRL     fill='000'O
         4 002216   000005 000004 xsym               ADSC9   B_VECTNIL+5              cn=0,n=4
         4 002217   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

      706    17737    3      KL$LINEDEV.BLKHDR.NSUBS = 0;

  17737  4 002220   000000 470400 xsym               LDP0    DSEG3$
         4 002221   000100 101400                    MRL     fill='000'O
         4 002222   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         4 002223   000000 200001                    ADSC9   0,,PR0                   cn=1,n=1

      707    17738    3      KL$LINEDEV.BLKHDR.DEVNUM = DEV#;

  17738  4 002224   000000 470400 xsym               LDP0    DSEG3$
         4 002225   000100 101500                    MRL     fill='000'O
         4 002226   200015 000004                    ADSC9   DEV#,,AUTO               cn=0,n=4
         4 002227   000001 400001                    ADSC9   1,,PR0                   cn=2,n=1

      708    17739    3      KL$LINEDEV.BLKHDR.BLKTYP = %KLTY_LINEDEV#;

  17739  4 002230   000100 101400                    MRL     fill='000'O
         4 002231   000014 000004 xsym               ADSC9   B_VECTNIL+12             cn=0,n=4
         4 002232   000001 000001                    ADSC9   1,,PR0                   cn=0,n=1
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:99   

      709    17740    3      LNG_CNT = LENGTHC(KL_LINEDEV);

  17740  4 002233   000020 235007                    LDA     16,DL
         4 002234   000003 755000 2                  STA     LNGTH

      710    17741    3      KL$UBWORD.NUM = 0;

  17741  4 002235   000000 220003                    LDX0    0,DU
         4 002236   200451 440100                    SXL0    KL$UBWORD,,AUTO

      711    17742    3      KL$UBWORD.REPLACE.T = LNGTH.T;

  17742  4 002237   000003 236000 2                  LDQ     LNGTH
         4 002240   000001 736000                    QLS     1
         4 002241   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 002242   377000 376007                    ANQ     130560,DL
         4 002243   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      712    17743    3      KL$UBWORD.REPLACE.B = LNGTH.B;

  17743  4 002244   000003 236000 2                  LDQ     LNGTH
         4 002245   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 002246   000377 376007                    ANQ     255,DL
         4 002247   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      713    17744    3      KL$LINEDEV.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;

  17744  4 002250   003100 060500                    CSL     bolr='003'O
         4 002251   200451 410010                    BDSC    KL$UBWORD,,AUTO          by=2,bit=1,n=8
         4 002252   000000 410010                    BDSC    0,,PR0                   by=2,bit=1,n=8

      714    17745    3      KL$LINEDEV.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;

  17745  4 002253   000000 470400 xsym               LDP0    DSEG3$
         4 002254   003100 060500                    CSL     bolr='003'O
         4 002255   200451 610010                    BDSC    KL$UBWORD,,AUTO          by=3,bit=1,n=8
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:100  
         4 002256   000000 610010                    BDSC    0,,PR0                   by=3,bit=1,n=8

      715    17746    3      END;

      716    17747
      717    17748    2   END FIND_DEVICE;

  17748  4 002257   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 002260   000001 702211                    TSX2  ! 1,X1
      718    17749    1   END   ASA$LINE_CONTROLLER ;

PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:101  
--  Include file information  --

   AS_SUPER_R.:E05TOU  cannot be made into a system file and is referenced.
   XU_FORMAT_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_CONFIG_M.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   AS_PERR_C.:E05TOU  is referenced.
   AS_SSUBS_C.:E05TOU  is referenced.
   AS_SUBS_C.:E05TOU  is referenced.
   AS_SUPER_C.:E05TOU  is referenced.
   AS_MAC_C.:E05TOU  cannot be made into a system file and is referenced.
   AS_ENTRIES_M.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ASA$LINE_CONTROLLER.
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:102  

 **** Variables and constants ****

  ****  Section 002  Data  ASA$LINE_CONTROLLER

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    11-0-0/w STRC(162)   r     1 KL_TERM_KEY                4-0-0/c STRC(171)   r     1 KL_TERM_REC
     0-0-0/w STRC(90)    r     1 LINE_KEY                   3-0-0/w STRC        r     1 LNGTH
     3-0-0/w UBIN        r     1 LNG_CNT

  ****  Section 003 RoData ASA$LINE_CONTROLLER

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    23-0-0/c STRC(144)   r     1 KL_CONTROLLER             27-0-0/c STRC(144)   r     1 KL_LINEDEV
     0-0-0/w STRC(684)   r     1 LINE_DREC                 33-0-0/w UBIN        r     1 TYPE_(0:15)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    12-0-0/w SBIN        r     1 ARS                       27-0-0/w PTR         r     1 BLK$
    20-0-0/w SBIN        r     1 COLUMNS                   13-0-0/w SBIN        r     1 CONT#
    26-0-0/w PTR         r     1 CONT$                     25-0-0/w PTR         r     1 CONTPTR$
    41-0-0/b BIT         r     1 CONTROLLER                14-0-0/w SBIN        r     1 CONT_INDEX
    44-0-0/b BIT         r     1 CREATE                    15-0-0/w SBIN        r     1 DEV#
    30-0-0/w PTR         r     1 DEV$                      42-0-0/b BIT         r     1 DEVICE
    32-0-0/w PTR         r     1 DEV_END$                  35-0-0/w SBIN        r     1 DEV_SIZEW
    33-0-0/w PTR         r     1 DEV_START$                34-0-0/w PTR         r     1 DEV_STOP$
    37-0-0/b BIT         r     1 DONE                      36-0-0/b BIT         r     1 FOUND
     7-0-0/w SBIN        r     1 I                        451-0-0/w STRC        r     1 KL$UBWORD
    40-0-0/b BIT         r     1 LINE                     446-0-0/c STRC(81)    r     1 LINE_NAME
    23-0-0/b BIT         r     1 MORE                      21-0-0/w SBIN        r     1 MOVE_SIZE
    43-0-0/w PTR         r     1 PRO$                      46-0-0/c CHAR(1024)  r     1 PRO_BUF
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:103  
     5-0-0/w PTR         r     1 PTR$                      17-0-0/w SBIN        r     1 ROWS
    22-0-0/w SBIN        r     1 SIZE                      31-0-0/w PTR         r     1 TYPE$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(369)   r     1 AS_FIELD1                  0-0-0/w STRC(369)   r     1 AS_FIELD2
     0-0-0/w STRC(369)   r     1 AS_FIELD3                  0-0-0/b BIT         r     1 AS_TRUE
     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/c CHAR(8)     r     1 BLANK_PASS
     0-0-0/w UBIN        r     1 CODE                       0-0-0/w UBIN        r     1 CONTROLLER_CMD
     0-0-0/w UBIN        r     1 CONT_DEV_OPTS_LIST         0-0-0/w UBIN        r     1 CONT_OPTS_LIST
     0-0-0/w PTR         r     1 DSEG1$                     0-0-0/w UBIN        r     1 DSEG1SIZE
     0-0-0/w PTR         r     1 DSEG2$                     0-0-0/w UBIN        r     1 DSEG2SIZE
     0-0-0/w PTR         r     1 DSEG3$                     0-0-0/w UBIN        r     1 DSEG3SIZE
     0-0-0/b BIT         r     1 DSEG_FLG                   0-0-0/b STRC        r     1 ERR_CODE
     0-0-0/c CHAR(255)   r     1 IN_BUF                     0-0-0/w STRC(576)   r     1 KL_DREC_CNT
     0-0-0/w UBIN        r     1 LINE_CMD                   0-0-0/w UBIN        r     1 LINE_DEV_CMD
     0-0-0/w UBIN        r     1 LINE_OPTS_LIST             0-0-0/b STRC        r     1 MERR_CODE
     0-0-0/w PTR         r     1 NODE$                      0-0-0/w STRC(504)   r     1 P_PCB
     0-0-0/c STRC(378)   r     1 USERS_KEY

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/c STRC(144)   r     1 KL$CONTROLLER              0-0-0/w STRC(684)   r     1 KL$DREC
     0-0-0/c STRC(144)   r     1 KL$LINEDEV                 0-0-0/c STRC(720)   r     1 KL$PHDR
     0-0-0/w STRC        r     1 KL$UWORD                   0-0-0/c ACHR        r     1 MOVE$TEMP
     0-0-0/w ASTR(153)   r     1 OUT$SYM                    0-0-0/w STRC(144)   r     1 P$NODE


   Procedure ASA$LINE_CONTROLLER requires 1201 words for executable code.
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:104  
   Procedure ASA$LINE_CONTROLLER requires 310 words of local(AUTO) storage.

    No errors detected in file ASA$LINE_CONTROLLER.:E05TSI    .
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:105  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:106  
          MINI XREF LISTING

ARS
     15398**DCL     16998<<ASSIGN  16999<>CALL    17000<>CALL    17064<>CALL    17065>>ASSIGN  17100<<ASSIGN
     17103<>CALL    17322<<ASSIGN  17324<>CALL
ASA$ERROR
     16926**DCL-ENT 17385--CALL
ASA_BRKS_LOC
     12534**DCL     12534--REDEF
ASB$BINCHAR
      1145**DCL-ENT 17639--CALL    17647--CALL    17694--CALL
ASB$CHECK_TYPE
     16929**DCL-ENT 17000--CALL
ASB$CLOSE_NETCON
     16938**DCL-ENT 17329--CALL    17345--CALL
ASB$DEQ_HLP
     16875**DCL-ENT 17022--CALL    17348--CALL
ASB$ENQ_HLP
     16872**DCL-ENT 16997--CALL
ASB$GETSEG
     16887**DCL-ENT 16965--CALL
ASB$GET_MORE_SEG
     16923**DCL-ENT 17260--CALL    17265--CALL    17282--CALL    17287--CALL
ASB$READ_HLP
     16878**DCL-ENT 16999--CALL
ASB$READ_NETCON
     16932**DCL-ENT 17333--CALL
ASB$READ_SI
     16890**DCL-ENT 17064--CALL
ASB$SET_PROMPT
     16896**DCL-ENT 17062--CALL
ASB$WRITE_HLP
     16881**DCL-ENT 17324--CALL
ASB$WRITE_NETCON
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:107  
     16935**DCL-ENT 17328--CALL    17339--CALL
ASD$READ_PRO
     16899**DCL-ENT 17103--CALL
ASH$DQUEST
     16920**DCL-ENT 17307--CALL
ASH$ERROR
     16902**DCL-ENT 16988--CALL    17019--CALL    17094--CALL    17132--CALL    17158--CALL    17195--CALL
     17225--CALL    17313--CALL    17364--CALL    17371--CALL    17375--CALL    17380--CALL    17468--CALL
     17509--CALL    17536--CALL    17604--CALL    17674--CALL
ASH$HELP
     16914**DCL-ENT 17301--CALL
ASH$QUEST
     16917**DCL-ENT 17304--CALL
ASH$WARN
     16905**DCL-ENT 17404--CALL    17428--CALL    17558--CALL    17726--CALL
AS_DEFAULT.BANNER_PERM
     13227**DCL     13228--REDEF
AS_DEFAULT.BUDGET.MACCT
     13132**DCL     13136--REDEF
AS_DEFAULT.BUDGET.MAX_PROJECTS
     13145**DCL     13148--REDEF
AS_DEFAULT.BUDGET.PACCUM
     13128**DCL     13130--REDEF
AS_DEFAULT.BUDGET.PMAXC
     13123**DCL     13125--REDEF
AS_DEFAULT.SETUP_CHRA.TXT
     13243**DCL     13244--REDEF   13245--REDEF
AS_DEFAULT_DREC.PASSWORD
     14497**DCL     14501--REDEF
AS_DEFAULT_DREC.RENAME
     14520**DCL     14521--REDEF
AS_DFLT.BANNER_PERM
     13049**DCL     13050--REDEF
AS_DFLT.BUDGET.MACCT
     12954**DCL     12958--REDEF
AS_DFLT.BUDGET.MAX_PROJECTS
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:108  
     12967**DCL     12970--REDEF
AS_DFLT.BUDGET.PACCUM
     12950**DCL     12952--REDEF
AS_DFLT.BUDGET.PMAXC
     12945**DCL     12947--REDEF
AS_DFLT.SETUP_CHRA.TXT
     13065**DCL     13066--REDEF   13067--REDEF
AS_FE_MODE
     12400**DCL     12401--REDEF
AS_FIELD1
     12530**DCL     17006<<ASSIGN  17145<<ASSIGN  17393<<ASSIGN  17417<<ASSIGN
AS_FIELD1.COUNT
     12531**DCL     17495<<ASSIGN  17521<<ASSIGN  17546<<ASSIGN
AS_FIELD1.TEXT
     12531**DCL     17496<<ASSIGN  17522<<ASSIGN  17547<<ASSIGN  17639<>CALL    17694<>CALL
AS_FIELD2
     12531**DCL     17523<<ASSIGN
AS_FIELD2.TEXT
     12531**DCL     17647<>CALL
AS_FIELD3
     12531**DCL     17661<<ASSIGN
AS_MODE
     12397**DCL     12399--REDEF
AS_MOD_USER.ACCESS
     15262**DCL     15263--REDEF
AS_MOD_USER.BANNER
     15249**DCL     15250--REDEF
AS_MOD_USER.BANNER_PERM
     15251**DCL     15252--REDEF
AS_MOD_USER.BILL
     15257**DCL     15258--REDEF
AS_MOD_USER.CPROC
     15253**DCL     15254--REDEF
AS_MOD_USER.FEBILL
     15333**DCL     15334--REDEF
AS_MOD_USER.FECXTMEM
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:109  
     15350**DCL     15351--REDEF
AS_MOD_USER.FEMINTS
     15335**DCL     15336--REDEF
AS_MOD_USER.FEMMEM
     15346**DCL     15347--REDEF
AS_MOD_USER.FEMTIME
     15344**DCL     15345--REDEF
AS_MOD_USER.FEPPRIV
     15341**DCL     15343--REDEF
AS_MOD_USER.FEPRIV
     15338**DCL     15340--REDEF
AS_MOD_USER.FORCE_BIT
     15247**DCL     15248--REDEF
AS_MOD_USER.KEY
     15329**DCL     15331--REDEF
AS_MOD_USER.LASTCPROC
     15255**DCL     15256--REDEF
AS_MOD_USER.LIMITS.DO_
     15303**DCL     15304--REDEF
AS_MOD_USER.LIMITS.FPOOLS
     15319**DCL     15320--REDEF
AS_MOD_USER.LIMITS.LO
     15299**DCL     15300--REDEF
AS_MOD_USER.LIMITS.MEM
     15295**DCL     15296--REDEF
AS_MOD_USER.LIMITS.MPRIO
     15323**DCL     15324--REDEF
AS_MOD_USER.LIMITS.PDIS
     15311**DCL     15312--REDEF
AS_MOD_USER.LIMITS.PO
     15307**DCL     15308--REDEF
AS_MOD_USER.LIMITS.TDIS
     15315**DCL     15316--REDEF
AS_MOD_USER.LIMITS.TIME
     15291**DCL     15292--REDEF
AS_MOD_USER.MAXENQ
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:110  
     15272**DCL     15273--REDEF
AS_MOD_USER.PERM_BIT
     15245**DCL     15246--REDEF
AS_MOD_USER.PPRIV
     15267**DCL     15269--REDEF
AS_MOD_USER.PRIOB
     15274**DCL     15275--REDEF
AS_MOD_USER.PRIV
     15264**DCL     15266--REDEF
AS_MOD_USER.QUAN
     15270**DCL     15271--REDEF
AS_MOD_USER.SETUP
     15243**DCL     15244--REDEF
AS_PROJECT.BANNER_PERM
     13583**DCL     13584--REDEF
AS_PROJECT.BUDGET.MACCT
     13488**DCL     13492--REDEF
AS_PROJECT.BUDGET.MAX_PROJECTS
     13501**DCL     13504--REDEF
AS_PROJECT.BUDGET.PACCUM
     13484**DCL     13486--REDEF
AS_PROJECT.BUDGET.PMAXC
     13479**DCL     13481--REDEF
AS_PROJECT.SETUP_CHRA.TXT
     13599**DCL     13600--REDEF   13601--REDEF
AS_PROJECT_DFLT.BANNER_PERM
     13761**DCL     13762--REDEF
AS_PROJECT_DFLT.BUDGET.MACCT
     13666**DCL     13670--REDEF
AS_PROJECT_DFLT.BUDGET.MAX_PROJECTS
     13679**DCL     13682--REDEF
AS_PROJECT_DFLT.BUDGET.PACCUM
     13662**DCL     13664--REDEF
AS_PROJECT_DFLT.BUDGET.PMAXC
     13657**DCL     13659--REDEF
AS_PROJECT_DFLT.SETUP_CHRA.TXT
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:111  
     13777**DCL     13778--REDEF   13779--REDEF
AS_PROJECT_DFLT_DREC.PASSWORD
     14983**DCL     14987--REDEF
AS_PROJECT_DFLT_DREC.RENAME
     15006**DCL     15007--REDEF
AS_PROJECT_DREC.PASSWORD
     14821**DCL     14825--REDEF
AS_PROJECT_DREC.RENAME
     14844**DCL     14845--REDEF
AS_PROJ_ADMIN.BANNER_PERM
     13405**DCL     13406--REDEF
AS_PROJ_ADMIN.BUDGET.MACCT
     13310**DCL     13314--REDEF
AS_PROJ_ADMIN.BUDGET.MAX_PROJECTS
     13323**DCL     13326--REDEF
AS_PROJ_ADMIN.BUDGET.PACCUM
     13306**DCL     13308--REDEF
AS_PROJ_ADMIN.BUDGET.PMAXC
     13301**DCL     13303--REDEF
AS_PROJ_ADMIN.SETUP_CHRA.TXT
     13421**DCL     13422--REDEF   13423--REDEF
AS_PROJ_ADMIN_DREC.PASSWORD
     14659**DCL     14663--REDEF
AS_PROJ_ADMIN_DREC.RENAME
     14682**DCL     14683--REDEF
AS_TRUE
     12394**DCL     17050>>ASSIGN  17409>>ASSIGN  17480>>ASSIGN  17483>>ASSIGN  17563>>ASSIGN  17731>>ASSIGN
AS_USERS.BANNER_PERM
     12871**DCL     12872--REDEF
AS_USERS.BUDGET.MACCT
     12776**DCL     12780--REDEF
AS_USERS.BUDGET.MAX_PROJECTS
     12789**DCL     12792--REDEF
AS_USERS.BUDGET.PACCUM
     12772**DCL     12774--REDEF
AS_USERS.BUDGET.PMAXC
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:112  
     12767**DCL     12769--REDEF
AS_USERS.SETUP_CHRA.TXT
     12887**DCL     12888--REDEF   12889--REDEF
AS_USERS_CONSTANT.BANNER_PERM
     13939**DCL     13940--REDEF
AS_USERS_CONSTANT.BUDGET.MACCT
     13844**DCL     13848--REDEF
AS_USERS_CONSTANT.BUDGET.MAX_PROJECTS
     13857**DCL     13860--REDEF
AS_USERS_CONSTANT.BUDGET.PACCUM
     13840**DCL     13842--REDEF
AS_USERS_CONSTANT.BUDGET.PMAXC
     13835**DCL     13837--REDEF
AS_USERS_CONSTANT.SETUP_CHRA.TXT
     13955**DCL     13956--REDEF   13957--REDEF
B$ALT.CODE
     16858**DCL     16858--REDEF   16859--REDEF   16859--REDEF
B$ALT.ERR
     16859**DCL     17379>>ASSIGN
B$ALT.ERR.ERR#
     16860**DCL     16860--REDEF
B$ALT.EVID
     16859**DCL     16859--REDEF   16859--REDEF
B$TCB.ALT$
     16854**DCL     17379>>ASSIGN
B$TCB$
     15441**DCL     17379>>ASSIGN
BLANK_PASS
     12525**DCL     17037>>ASSIGN
BLK$
     15411**DCL     16203--IMP-PTR 16968<<ASSIGN  16970<<ASSIGN  16971>>IF      16993>>ASSIGN  16994>>ASSIGN
     16994>>ASSIGN  16995>>ASSIGN  16995>>ASSIGN  17076<<ASSIGN  17077>>IF      17101>>ASSIGN  17102>>ASSIGN
     17102>>ASSIGN  17136>>ASSIGN  17137>>ASSIGN  17137>>ASSIGN  17168<<ASSIGN  17169>>IF      17176<<ASSIGN
     17177>>CALLBLT 17177>>CALLBLT 17206<<ASSIGN  17207>>CALLBLT 17207>>CALLBLT 17447<<ASSIGN  17449<<ASSIGN
     17450>>CALLBLT 17450>>CALLBLT 17495>>ASSIGN  17496>>ASSIGN  17496>>ASSIGN  17521>>ASSIGN  17522>>ASSIGN
     17522>>ASSIGN  17546>>ASSIGN  17547>>ASSIGN  17547>>ASSIGN  17585<<ASSIGN  17586>>CALLBLT 17586>>CALLBLT
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:113  
CMD_ERR
     17364**LABEL   16958--CALLALT
CM_LINE_ERR
     17379**LABEL   16999--CALLALT
CODE
     12527**DCL     17071<<ASSIGN  17072>>DOSELCT 17200>>IF      17230>>IF
COLUMNS
     15404**DCL     17207<<CALLBLT 17208>>IF      17208>>IF      17231>>ASSIGN  17233>>ASSIGN
CONT#
     15399**DCL     17450<<CALLBLT 17451>>IF      17479>>IF      17482>>IF      17568>>ASSIGN  17571>>ASSIGN
     17615>>IF      17618>>IF      17647<>CALL    17734>>ASSIGN
CONT$
     15410**DCL     17254>>ASSIGN  17263>>ASSIGN  17267>>ASSIGN  17269>>ASSIGN  17290>>ASSIGN  17474<<ASSIGN
     17475>>ASSIGN  17478>>DOWHILE 17479>>IF      17482>>IF      17485>>ASSIGN  17486<<ASSIGN  17486>>ASSIGN
     17514>>ASSIGN  17610>>ASSIGN
CONTPTR$
     15409**DCL     16511--IMP-PTR 17030<<ASSIGN  17108>>ASSIGN  17201>>ASSIGN  17231>>ASSIGN  17240>>ASSIGN
     17267>>ASSIGN  17275>>ASSIGN  17275>>ASSIGN  17290>>ASSIGN  17514>>ASSIGN  17567>>ASSIGN  17568>>ASSIGN
     17569>>ASSIGN  17570>>ASSIGN  17571>>ASSIGN  17572>>ASSIGN  17577>>ASSIGN  17578>>ASSIGN  17611>>ASSIGN
CONTROLLER
     15421**DCL     16949<<ASSIGN  16954>>IF      17056>>IF      17107>>IF      17251>>IF      17446>>IF
     17490>>IF      17566>>IF
CONTROLLER_CMD
     15437**DCL     16955--ASSIGN
CONT_DEV_OPTS_LIST
     15440**DCL     17059--ASSIGN
CONT_INDEX
     15400**DCL     17485<<ASSIGN  17486>>ASSIGN
CONT_OPTS_LIST
     15438**DCL     17057--ASSIGN
CREATE
     15424**DCL     16962<<ASSIGN  17000>>CALL    17001>>IF      17035>>IF      17320>>IF      17325>>IF
     17389>>IF      17409<<ASSIGN  17490>>IF      17542>>IF      17563<<ASSIGN  17566>>IF      17625>>IF
     17682>>IF      17731<<ASSIGN
CREATE_LINE
     17001**LABEL   17411--GOTO
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:114  
DEQ_ERR
     17438**LABEL   17348--CALLALT
DEV#
     15401**DCL     17586<<CALLBLT 17587>>IF      17615>>IF      17618>>IF      17639<>CALL    17694<>CALL
     17735>>ASSIGN  17738>>ASSIGN
DEV$
     15412**DCL     17276>>ASSIGN  17285>>ASSIGN  17289>>ASSIGN  17292>>ASSIGN  17610<<ASSIGN  17611>>ASSIGN
     17614>>DOWHILE 17615>>IF      17615>>IF      17618>>IF      17618>>IF      17621<<ASSIGN  17621>>ASSIGN
     17679>>ASSIGN
DEVICE
     15422**DCL     16950<<ASSIGN  17032>>IF      17273>>IF      17516>>IF
DEV_END$
     15414**DCL     17611<<ASSIGN  17614>>DOWHILE
DEV_SIZEW
     15417**DCL     17029<<ASSIGN  17255<<ASSIGN  17255>>ASSIGN  17277<<ASSIGN  17277>>ASSIGN  17319>>ASSIGN
     17475>>ASSIGN
DEV_START$
     15415**DCL     17028<<ASSIGN  17029>>ASSIGN  17474>>ASSIGN
DEV_STOP$
     15416**DCL     17257>>ASSIGN  17279>>ASSIGN  17475<<ASSIGN  17478>>DOWHILE
DONE
     15419**DCL     17477<<ASSIGN  17478>>DOWHILE 17483<<ASSIGN  17613<<ASSIGN  17614>>DOWHILE 17619<<ASSIGN
DSEG1$
     12535**DCL     16249--IMP-PTR 16999<>CALL    17000<>CALL    17028>>ASSIGN  17029>>ASSIGN  17029>>ASSIGN
     17036>>ASSIGN  17037>>ASSIGN  17038>>ASSIGN  17039>>ASSIGN  17040>>ASSIGN  17041>>ASSIGN  17046>>ASSIGN
     17047>>ASSIGN  17106>>ASSIGN  17136>>ASSIGN  17137>>ASSIGN  17166>>ASSIGN  17170>>ASSIGN  17172>>ASSIGN
     17253>>ASSIGN  17253>>ASSIGN  17263>>ASSIGN  17285>>ASSIGN  17319>>ASSIGN  17321>>ASSIGN  17322>>ASSIGN
     17324<>CALL
DSEG1SIZE
     12536**DCL     16998>>ASSIGN  17264>>IF      17286>>IF
DSEG2$
     12536**DCL     17261>>ASSIGN  17270>>ASSIGN  17283>>ASSIGN  17293>>ASSIGN
DSEG2SIZE
     12536**DCL     17259>>IF      17281>>IF
DSEG3$
     12536**DCL     16662--IMP-PTR 17030>>ASSIGN  17111>>ASSIGN  17203>>ASSIGN  17233>>ASSIGN  17247>>ASSIGN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:115  
     17289>>ASSIGN  17679>>ASSIGN  17733>>ASSIGN  17734>>ASSIGN  17735>>ASSIGN  17736>>ASSIGN  17737>>ASSIGN
     17738>>ASSIGN  17739>>ASSIGN  17744>>ASSIGN  17745>>ASSIGN
DSEG3SIZE
     12536**DCL     17030>>ASSIGN
DSEG_FLG
     12535**DCL     16965>>IF
ENQ_ERR
     17388**LABEL   16997--CALLALT
ERR_CODE
     12529**DCL     12530--REDEF   17371<>CALL    17379<<ASSIGN  17380<>CALL
EXIT#
     17348**LABEL   17000--CALLALT 17031--CALLALT 17032--CALLALT
FIND_CONTROLLER
     17442**PROC    17031--CALL
FIND_DEVICE
     17582**PROC    17032--CALL
FOUND
     15418**DCL     17252>>IF      17274>>IF      17476<<ASSIGN  17478>>DOWHILE 17480<<ASSIGN  17489>>IF
     17612<<ASSIGN  17614>>DOWHILE 17616<<ASSIGN  17624>>IF
GETSEG_ERR
     17339**LABEL   16965--CALLALT 17260--CALLALT 17265--CALLALT 17282--CALLALT 17287--CALLALT
I
     15395**DCL     17069<<DOINDEX 17070>>ASSIGN
IN_BUF
     12525**DCL     17064<>CALL
KL$CONTROLLER
     16511**DCL     17267<<ASSIGN  17267>>ASSIGN  17290<<ASSIGN  17290>>ASSIGN  17514<<ASSIGN  17514>>ASSIGN
     17567<<ASSIGN
KL$CONTROLLER.BLKHDR.BLKTYP
     16572**DCL     17108<<ASSIGN  17572<<ASSIGN
KL$CONTROLLER.BLKHDR.DEVNUM
     16599**DCL     17571<<ASSIGN
KL$CONTROLLER.BLKHDR.LEN.BYT
     16565**DCL     17577<<ASSIGN  17578<<ASSIGN
KL$CONTROLLER.BLKHDR.LEV
     16548**DCL     17570<<ASSIGN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:116  
KL$CONTROLLER.BLKHDR.NSUBS
     16559**DCL     17275<<ASSIGN  17275>>ASSIGN  17485>>ASSIGN  17569<<ASSIGN  17611>>ASSIGN
KL$CONTROLLER.COLUMNS
     16636**DCL     17231<<ASSIGN
KL$CONTROLLER.CONT#
     16628**DCL     17479>>IF      17482>>IF      17568<<ASSIGN
KL$CONTROLLER.ROWS
     16632**DCL     17201<<ASSIGN
KL$CONTROLLER.TYPE
     16642**DCL     17240<<ASSIGN
KL$DREC
     16249**DCL     17036<<ASSIGN
KL$DREC.LN
     16368**DCL     17028--ASSIGN  17028--ASSIGN  17029--ASSIGN  17038<<ASSIGN
KL$DREC.LN.BLKHDR.BLKTYP
     16412**DCL     17041<<ASSIGN  17106<<ASSIGN
KL$DREC.LN.BLKHDR.LEN.BYT
     16405**DCL     17046<<ASSIGN  17047<<ASSIGN
KL$DREC.LN.BLKHDR.LEV
     16388**DCL     17039<<ASSIGN
KL$DREC.LN.BLKHDR.NSUBS
     16399**DCL     17040<<ASSIGN  17253<<ASSIGN  17253>>ASSIGN
KL$DREC.LN.SLAVE#
     16485**DCL     17166<<ASSIGN  17170<<ASSIGN  17172<<ASSIGN
KL$DREC.NWINFO
     16347**DCL     17029>>ASSIGN  17319<<ASSIGN  17321<<ASSIGN  17322>>ASSIGN
KL$DREC.PASSWORD
     16307**DCL     16311--REDEF   17037<<ASSIGN
KL$DREC.PNAME.CNT
     16321**DCL     17136<<ASSIGN
KL$DREC.PNAME.TXT
     16324**DCL     17137<<ASSIGN
KL$DREC.RENAME
     16330**DCL     16331--REDEF
KL$LINEDEV
     16662**DCL     17289<<ASSIGN  17289>>ASSIGN  17679<<ASSIGN  17679>>ASSIGN  17733<<ASSIGN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:117  
KL$LINEDEV.BLKHDR.BLKTYP
     16722**DCL     17111<<ASSIGN  17739<<ASSIGN
KL$LINEDEV.BLKHDR.DEVNUM
     16749**DCL     17738<<ASSIGN
KL$LINEDEV.BLKHDR.LEN.BYT
     16715**DCL     17744<<ASSIGN  17745<<ASSIGN
KL$LINEDEV.BLKHDR.LEV
     16698**DCL     17736<<ASSIGN
KL$LINEDEV.BLKHDR.NSUBS
     16709**DCL     17737<<ASSIGN
KL$LINEDEV.COLUMNS
     16793**DCL     17233<<ASSIGN
KL$LINEDEV.CONTROLLER#
     16777**DCL     17615>>IF      17618>>IF      17734<<ASSIGN
KL$LINEDEV.DEVICE#
     16780**DCL     17615>>IF      17618>>IF      17735<<ASSIGN
KL$LINEDEV.ROWS
     16789**DCL     17203<<ASSIGN
KL$LINEDEV.TYPE
     16785**DCL     17247<<ASSIGN
KL$PHDR
     16809**DCL     17103<>CALL
KL$PHDR.TTYP
     16810**DCL     17105>>IF      17115>>IF      17115>>IF
KL$UBWORD.NUM
     16845**DCL     16846--REDEF   17043<<ASSIGN  17237<<ASSIGN  17240>>ASSIGN  17244<<ASSIGN  17247>>ASSIGN
     17574<<ASSIGN  17741<<ASSIGN
KL$UBWORD.REPLACE.B
     16850**DCL     17045<<ASSIGN  17047>>ASSIGN  17239<<ASSIGN  17246<<ASSIGN  17576<<ASSIGN  17578>>ASSIGN
     17743<<ASSIGN  17745>>ASSIGN
KL$UBWORD.REPLACE.T
     16848**DCL     17044<<ASSIGN  17046>>ASSIGN  17238<<ASSIGN  17245<<ASSIGN  17575<<ASSIGN  17577>>ASSIGN
     17742<<ASSIGN  17744>>ASSIGN
KL$UWORD.B
     16840**DCL     17239>>ASSIGN  17246>>ASSIGN
KL$UWORD.T
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:118  
     16839**DCL     17238>>ASSIGN  17245>>ASSIGN
KL_CONTROLLER
     15841**DCL     17255--ASSIGN  17263--ASSIGN  17269--ASSIGN  17486--ASSIGN  17567>>ASSIGN  17573--ASSIGN
     17610--ASSIGN
KL_DEFAULT.PASSWORD
     15145**DCL     15149--REDEF
KL_DEFAULT.RENAME
     15168**DCL     15169--REDEF
KL_DFLT.PASSWORD
     14335**DCL     14339--REDEF
KL_DFLT.RENAME
     14358**DCL     14359--REDEF
KL_DREC.PASSWORD
     14173**DCL     14177--REDEF
KL_DREC.RENAME
     14196**DCL     14197--REDEF
KL_DREC_CNT
     14002**DCL     17322--ASSIGN
KL_DREC_CNT.PASSWORD
     14060**DCL     14064--REDEF
KL_DREC_CNT.RENAME
     14083**DCL     14084--REDEF
KL_LINEDEV
     15992**DCL     17277--ASSIGN  17285--ASSIGN  17292--ASSIGN  17486--ASSIGN  17611--ASSIGN  17621--ASSIGN
     17733>>ASSIGN  17740--ASSIGN
KL_TERM_KEY
     15518**DCL     17328--CALL    17333--CALL    17339--CALL
KL_TERM_KEY.TERMID.TERM
     15539**DCL     15548--REDEF
KL_TERM_KEY.TERMID.TERM.TERM_NAME
     15548**DCL     17327<<ASSIGN  17332<<ASSIGN  17338<<ASSIGN
KL_TERM_REC
     15470**DCL     17326<<ASSIGN  17328--CALL    17333--CALL    17337<<ASSIGN  17339--CALL
KL_TERM_REC.TERMID.TERM
     15492**DCL     15501--REDEF
LINE
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:119  
     15420**DCL     16948<<ASSIGN  16951>>IF      16967>>IF      17000>>CALL    17001>>IF      17027>>IF
     17053>>IF      17110>>IF      17318>>IF      17388>>IF
LINE_CMD
     15435**DCL     16952--ASSIGN
LINE_DEV_CMD
     15439**DCL     16957--ASSIGN
LINE_DREC
     15579**DCL     17036>>ASSIGN
LINE_DREC.LN
     15698**DCL     17038>>ASSIGN  17042--ASSIGN  17319--ASSIGN  17321--ASSIGN
LINE_DREC.NWINFO
     15677**DCL     17319>>ASSIGN
LINE_DREC.PASSWORD
     15637**DCL     15641--REDEF
LINE_DREC.RENAME
     15660**DCL     15661--REDEF
LINE_KEY
     15447**DCL     16996>>ASSIGN  17323>>ASSIGN
LINE_KEY.TXT.LINE
     15450**DCL     16995<<ASSIGN
LINE_NAME
     15427**DCL     17000<>CALL    17006>>ASSIGN  17393>>ASSIGN  17417>>ASSIGN  17523>>ASSIGN  17661>>ASSIGN
LINE_NAME.COUNT
     15428**DCL     16993<<ASSIGN
LINE_NAME.TEXT
     15429**DCL     16994<<ASSIGN  17327>>ASSIGN  17332>>ASSIGN  17338>>ASSIGN
LINE_OPTS_LIST
     15436**DCL     17054--ASSIGN
LINE_OPT_ERR
     17313**LABEL   17066--CALLALT
LINE_PRO_ERR
     17145**LABEL   17103--CALLALT
LNGTH
     15452**DCL     15455--REDEF
LNGTH.B
     15454**DCL     17045>>ASSIGN  17576>>ASSIGN  17743>>ASSIGN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:120  
LNGTH.T
     15453**DCL     17044>>ASSIGN  17575>>ASSIGN  17742>>ASSIGN
LNG_CNT
     15455**DCL     17042<<ASSIGN  17573<<ASSIGN  17740<<ASSIGN
LOOP_END
     17311**LABEL   17097--GOTO
MERR_CODE.CODE
     12530**DCL     17335>>IF      17384>>IF
MORE
     15407**DCL     17050<<ASSIGN  17060>>DOWHILE 17296<<ASSIGN
MOVE$TEMP
     16852**DCL     17261<<ASSIGN  17261>>ASSIGN  17270<<ASSIGN  17270>>ASSIGN  17283<<ASSIGN  17283>>ASSIGN
     17293<<ASSIGN  17293>>ASSIGN
MOVE_SIZE
     15405**DCL     16852--IMP-SIZ 17257<<ASSIGN  17258>>IF      17259>>IF      17261>>ASSIGN  17261>>ASSIGN
     17263>>ASSIGN  17268>>IF      17270>>ASSIGN  17270>>ASSIGN  17279<<ASSIGN  17280>>IF      17281>>IF
     17283>>ASSIGN  17283>>ASSIGN  17285>>ASSIGN  17291>>IF      17293>>ASSIGN  17293>>ASSIGN
NETCON_ERR
     17364**LABEL   17328--CALLALT 17339--CALLALT 17342--GOTO
NODE$
     12527**DCL     16156--IMP-PTR 16948>>ASSIGN  16949>>ASSIGN  16950>>ASSIGN  16960<<ASSIGN  16962>>ASSIGN
     16968>>ASSIGN  16970>>ASSIGN  17067<<ASSIGN  17069>>DOINDEX 17070>>ASSIGN  17447>>ASSIGN  17449>>ASSIGN
     17585>>ASSIGN
OUT$SYM.COUNT
     16226**DCL     16229--IMP-SIZ 16971>>IF      16993>>ASSIGN  16994>>ASSIGN  16995>>ASSIGN  17077>>IF
     17101>>ASSIGN  17102>>ASSIGN  17136>>ASSIGN  17137>>ASSIGN  17177>>CALLBLT 17207>>CALLBLT 17450>>CALLBLT
     17495>>ASSIGN  17496>>ASSIGN  17521>>ASSIGN  17522>>ASSIGN  17546>>ASSIGN  17547>>ASSIGN  17586>>CALLBLT
OUT$SYM.TEXT
     16229**DCL     16994>>ASSIGN  16995>>ASSIGN  17102>>ASSIGN  17137>>ASSIGN  17177>>CALLBLT 17207>>CALLBLT
     17450>>CALLBLT 17496>>ASSIGN  17522>>ASSIGN  17547>>ASSIGN  17586>>CALLBLT
P$NODE.CODE
     16164**DCL     16948>>ASSIGN  16949>>ASSIGN  16950>>ASSIGN  16962>>ASSIGN  17071>>ASSIGN  17169>>IF
     17236>>ASSIGN  17243>>ASSIGN
P$NODE.SUBLK$
     16189**DCL     16968>>ASSIGN  16968>>ASSIGN  16970>>ASSIGN  16970>>ASSIGN  17070>>ASSIGN  17076>>ASSIGN
     17168>>ASSIGN  17176>>ASSIGN  17206>>ASSIGN  17236>>ASSIGN  17243>>ASSIGN  17447>>ASSIGN  17449>>ASSIGN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:121  
     17585>>ASSIGN
P$NODE.SUBNODES
     16168**DCL     17069>>DOINDEX 17165>>IF
PRO$
     15423**DCL     16809--IMP-PTR 17099<<ASSIGN  17103>>CALL    17105>>IF      17115>>IF      17115>>IF
PROJ_KEY.TEXT
     12407**DCL     12407--REDEF
PROJ_KEY.TXT.PROJECT
     12407**DCL     12407--REDEF
PRO_BUF
     15426**DCL     17099--ASSIGN  17100--ASSIGN
PTR$
     15393**DCL     17070<<ASSIGN  17071>>ASSIGN  17076>>ASSIGN  17165>>IF      17168>>ASSIGN  17176>>ASSIGN
     17206>>ASSIGN  17236>>ASSIGN  17243>>ASSIGN  17254<<ASSIGN  17257>>ASSIGN  17261>>ASSIGN  17269<<ASSIGN
     17270>>ASSIGN  17276<<ASSIGN  17279>>ASSIGN  17283>>ASSIGN  17292<<ASSIGN  17293>>ASSIGN
P_PCB
     12562**DCL     16958<>CALL    17066<>CALL
P_PCB.ERROR
     12666**DCL     17313<>CALL    17375<>CALL
P_PCB.NCHARS
     12709**DCL     17065<<ASSIGN
P_PCB.OUT$
     12575**DCL     16960>>ASSIGN  17067>>ASSIGN
P_PCB.ROOT$
     12567**DCL     16952<<ASSIGN  16955<<ASSIGN  16957<<ASSIGN  17054<<ASSIGN  17057<<ASSIGN  17059<<ASSIGN
REMEM_VAR
     12533**DCL     12533--REDEF
REM_FCMD
     12533**DCL     12534--REDEF
ROWS
     15403**DCL     17177<<CALLBLT 17178>>IF      17178>>IF      17201>>ASSIGN  17203>>ASSIGN
SIZE
     15406**DCL     17263<<ASSIGN  17264>>IF      17265<>CALL    17285<<ASSIGN  17286>>IF      17287<>CALL
TYPE$
     15413**DCL     16838--IMP-PTR 17236<<ASSIGN  17238>>ASSIGN  17239>>ASSIGN  17243<<ASSIGN  17245>>ASSIGN
     17246>>ASSIGN
PL6.E3A0      #001=ASA$LINE_CONTROLLER File=ASA$LINE_CONTROLLER.:E05TSI          TUE 07/29/97 08:38 Page:122  
TYPE_
     16126**DCL     17236--ASSIGN  17243--ASSIGN
USERS_KEY
     12404**DCL     16964<<ASSIGN  16996<<ASSIGN  17103<>CALL    17145>>ASSIGN  17323<<ASSIGN  17385<>CALL
USERS_KEY.COUNT
     12404**DCL     17101<<ASSIGN
USERS_KEY.TEXT
     12404**DCL     12405--REDEF   12405--REDEF   12405--REDEF   12406--REDEF
USERS_KEY.TXTC
     12405**DCL     17102<<ASSIGN
WRITE_LINE_ERR
     17364**LABEL   17324--CALLALT
X$PARSE
     16870**DCL-ENT 16958--CALL    17066--CALL
