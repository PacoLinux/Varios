VERSION E05

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:1    
        1        1        /*M*  RBT device manager services for use by CLM                   */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
        8        8        /*P*  NAME:    KZR$RBT
        9        9              PURPOSE:
       10       10                 To provide RBT device oriented services for the Common
       11       11                 Line Manager.
       12       12                                                                           */
       13       13        /*D*  NAME:    KZR$RBT
       14       14              CALL:
       15       15                       CALL KZR$RBT (CLM-fpt) ALTRET(label);
       16       16              PARAMETERS:
       17       17                       CLM-fpt is an FPT structure containing the following
       18       18                       information;
       19       19
       20       20                       An Event or Function-code describing the process to be
       21       21                       performed. This must be one of the following:
       22       22                          KZ#LINFCN_BLDCTX    To build device context and
       23       23                                              initialize VDH interface.
       24       24                          KZ#LINFCN_INP       Process an input block.
       25       25                          KZ#LINFCN_GETOTP    Prepare an output block
       26       26                          KZ#LINFCN_DSC       Disconnect all devices associated
       27       27                                              with the line.
       28       28
       29       29                       A pointer to a B$TERMINAL_ID for the device being
       30       30                       initialized when Function-code is KZ#LINFCN_BLDCTX or
       31       31                       KZ#LINFCN_DSC.
       32       32                       It is unused for other functions.
       33       33
       34       34                       A pointer to a Line Context block.
       35       35
       36       36                       The ALTRETURN to label is taken if an input block is
       37       37                       found to contain a 'signon string'.
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:2    
       38       38
       39       39
       40       40
       41       41              DESCRIPTION:
       42       42                       This procedure is called by the Common Line Manager
       43       43                       to perform the administrative functions, BLDCTX and
       44       44                       DSC, via an EPTR in KZ$LINCTX.DEVMGR@.  It is called
       45       45                       from the 'line handler', either KZB$BSCIO or KZB$HASPIO
       46       46                       to perform the I/O functions, GETOTP or INP.  See the
       47       47                       individual descriptions below to see what it does.
       48       48
       49       49                                                                           */
       50       50
       51       51
       52       52
       53       53        KZR$RBT: PROC (EVENT_FPT) ALTRET;
       54       54
       55       55        %INCLUDE KH$CHN;
       56      177        %INCLUDE KZ$LINCTX;
       57      797        %INCLUDE KZ_LIN_C;
       58      853        %INCLUDE KZ_CLM_E;
       59     1025        %INCLUDE KZ_PERR_C;
       60     1107        %INCLUDE KL_SUPER_C;
       61     4009        %INCLUDE KZ$NJE_M;
       62     4247        %INCLUDE KZ$OTPBFR;
       63     4348        %INCLUDE KZ$RBT_M;
       64     4907        %INCLUDE KV_GLBCNS_E;
       65     5248        %INCLUDE KZ_3270_C;
       66     5406        %INCLUDE KZ_HASP_C;
       67     5748        %INCLUDE KZ_BSC_C;
       68     6730        %INCLUDE KZ$BSCSTT;
       69     6836        %INCLUDE KH$STT;
       70     6866        %INCLUDE KL_MACRO_C;
       71    10218        %INCLUDE KL_AFCN_C;
       72    10319        %INCLUDE K_ID_E;
       73    10369        %INCLUDE KZ$INPBFR;
       74    10429        %INCLUDE KHC_MAC_C;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:3    
       75    10470        %INCLUDE CP_6_SUBS;
       76    11010        %INCLUDE LCP_6;
       77    15289        %INCLUDE KV$VDH;
       78    15720        %INCLUDE KV$GLB;
       79    16139        %INCLUDE KV$INT;
       80    16771        %INCLUDE KV$GLBCTX;
       81    17216        %INCLUDE KV_GLB_M;
       82    17338        %INCLUDE KV_PRMID_E;
       83    17512        %INCLUDE KV$VDO;
       84    18527
       85    18528
       86    18529
       87    18530        %K#ENTID_E;
       88    18549        %KV_INPOPRX_E;
       89    18561        %KV_DATCTRCHRTYP_E;
       90    18567        %KV#DATMOD_E;
       91    18573        %KZ_3270_E;
       92    18701        %K#LYRID_E;
       93    18708        %KH$CHN;
       94    18832        %KZ$SDVCTX (NAME=DEVCTX,STCLASS="BASED(CTX$)");
       95    19144        %KZ$LINCTX (NAME=KZ$LINCTX,STCLASS="BASED(LCTX$)");
       96    19575        %KZ$HASPBLK (NAME=HSPBLK,STCLASS="BASED(BFR$)");
       97    19608        %KZ$HASPSRCB (NAME=HASPSRCB,STCLASS=BASED);
       98    19632        %KZ$NJE_SIGNON (STCLASS="BASED(BFR$)");
       99    19712        %KZ$RBTERR (NAME=ERRCTX);
      100    19733        %KZ$OTPBFR (STCLASS="BASED(BFR$)");
      101    19798        %KZ$INPBFR (STCLASS="BASED(BFR$)");
      102    19831
      103    19832        %B$TERMINAL_ID (STCLASS=BASED);
      104    19861        %KL_HASPDEV (STCLASS=BASED);
      105    20095
      106    20096        %KV$VDH_INT (STCLASS="");
      107    20133        %KV$VDH_INT (NAME=KV_VDH_INT,STCLASS="SYMREF READONLY");
      108    20170        %KV$VDH_DAT (NAME=KV_VDH_DAT,STCLASS="SYMREF READONLY");
      109    20250        %KV$VDH_CNC (STCLASS="");
      110    20342        %KV$VDH_CNC (NAME=KV_VDH_CNC,STCLASS="SYMREF READONLY");
      111    20434        %KV$VDH_EVT (STCLASS="");
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:4    
      112    20469        %KV$VDH_EVT (NAME=KV_VDH_EVT,STCLASS="SYMREF READONLY");
      113    20504        %KV$VDH_DSC (NAME=KV_VDH_DSC,STCLASS="SYMREF READONLY");
      114    20540        %KV$VDH_DSC (STCLASS="");
      115    20576        %KV$VDH_OTPMRK (NAME=KV_VDH_OTPMRK,STCLASS="SYMREF READONLY");
      116    20638    1   DCL KV_VDH_EVT_RQSOTP UBIN SYMREF READONLY;
      117    20639        %KV$VDH_OTPMRK (STCLASS="");
      118    20701        %KV_PRMID_E;
      119    20857        %KV_STRTYP_E;
      120    20895        %KV_SCHRSN_E;
      121    20902        %KV_INPUNT_E;
      122    20907        %KV_CMPCOD_E;
      123    20921
      124    20922        %KV$TRNTBL;
      125    20980        %KV$USRPRM_INT;
      126    20994        %KV$SETPRMPREPRC (PRMID=KV_PRMID_PRFNAM);
      127    21007        %KV$SETPRMPREPRC (PRMID=KV_PRMID_BIN);
      128    21020        %KV$SETPRMPREPRC (PRMID=KV_PRMID_INPUT);
      129    21033        %KV$SETPRMPREPRC (PRMID=KV_PRMID_OUTPUT);
      130    21046        %KV$SETPRMPREPRC (PRMID=KV_PRMID_PRINTTYPE);
      131    21059        %KV$SETPRMPREPRC (PRMID=KV_PRMID_VFU);
      132    21072        %KV$SETPRMPREPRC (PRMID=KV_PRMID_FIRSTLINE);
      133    21085        %KV$STREVTENB (STRTYP=KV_STRTYP_VDI);
      134    21090        %KV$USRPRM (NAME=KV_USRPRM,STCLASS=CONSTANT,USRSBR=KZD$DEVMGR,
      135    21091                    INPFNCTBLHEDPTR$=KV_VDH_INT.USRPRM$,
      136    21092                    TRNTBLHEDPTR$=TRN$);
      137    21143        %KV$USRPRM;
      138    21194        %KV$USRPRM (NAME=KV@USRPRM,STCLASS="BASED(TPTR$)");
      139    21245        %KV$MRD;
      140    21292        %KV$VDI;
      141    21363        %KV$OTPMRK;
      142    21390        %KV$PTR;
      143    21433        %KV$SSN;
      144    21512        %KV$STT;
      145    21906        %KV@USRENT;
      146    21926        %KZ$EVENT (FPTN=CNCDSC_EVENT,STCLASS=CONSTANT);
      147    22008        %KZ$EVENT (FPTN=KZ_EVENT,STCLASS="");
      148    22090        %KV$VDH_DAT (STCLASS="");
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:5    
      149    22170
      150    22171
      151    22172    1   DCL KZD_MINSP_FORPST UBIN SYMREF;
      152    22173    1   DCL KZR_THRTL_UNBLK UBIN SYMREF;
      153    22174    1   DCL KZ_RBT_EBCI UBIN SYMREF;
      154    22175    1   DCL KZ_RBTVDHSTT$ PTR SYMREF;
      155    22176    1   DCL KZ_USRPRM$ PTR SYMREF;
      156    22177    1   DCL KZ_VDHTRCBFRBYTSIZ UBIN SYMREF; /* It's in KZ_DTBLS_D */
      157    22178        %KZ_HASP_HDR (STCLASS=SYMREF);
      158    22202        %KZ_HASP_HDR (NAME=KZ_HASPS_HDR,STCLASS=SYMREF);
      159    22226        %KZ_BSC_HDR (STCLASS=SYMREF);
      160    22250        %KZ_BSC_HDR (NAME=KZ_BSCS_HDR,STCLASS=SYMREF);
      161    22274        %KZ$BSCSTT (NAME=KZ_RBTSTT,STCLASS="BASED(TPTR$)");
      162    22655        %KZ$BSCSTT (NAME=KZ@RBTSTT,STCLASS=CONSTANT);
      163    23036
      164    23037        %KZ$RBT_E;
      165    23067        %KV_USR_EVT_ID_E;
      166    23087        %KV_VDH_EVT_ID_E;
      167    23093        %KV_BFRRLSDSP_E;
      168    23099        %KZ$SDVCTX (NAME=KZ@SDVCTX,STCLASS=CONSTANT);
      169    23411
      170    23412        /*    Parameter   */
      171    23413        %KZ$EVENT (FPTN=EVENT_FPT,STCLASS="");
      172    23495
      173    23496
      174    23497    1   DCL KZR_THRTL_INIT UBIN CONSTANT SYMDEF INIT(1000);
      175    23498    1   DCL TRN$ PTR CONSTANT INIT(ADDR(KZ_RBT_EBCI));
      176    23499
      177    23500    1   DCL KVV$VDI ENTRY(1) ALTRET;
      178    23501    1   DCL KVV$INT ENTRY(1) ALTRET;
      179    23502    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      180    23503    1   DCL KVB$RLS ENTRY(2) ALTRET;
      181    23504    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
      182    23505    1   DCL KZD$ACKSIGNON ENTRY(1) ALTRET;
      183    23506    1   DCL KZD$SNDSIGNON ENTRY(1) ALTRET;
      184    23507    1   DCL KZL$BBLK ENTRY(1) ALTRET;
      185    23508    1   DCL KZL$DBLK ENTRY(1) ALTRET;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:6    
      186    23509    1   DCL KZR_CNCDSC@ EPTR SYMREF;
      187    23510    1   DCL KHA$RQSLINPRO ENTRY(2);
      188    23511    1   DCL KHA$ERRLOG ENTRY(2) ALTRET;
      189    23512    1   DCL KHI$DISABLE ENTRY(1);
      190    23513    1   DCL KHI$ENABLE ENTRY;
      191    23514    1   DCL KZD$DEVMGR ENTRY(1) ALTRET;
      192    23515    1   DCL KZD$DQ ENTRY(1);
      193    23516
      194    23517
      195    23518        %FPT_WRSYSLOG ( FPTN=WRSYSLOG,
      196    23519                        FCG='KZ',
      197    23520                        MID='R',
      198    23521                        STCLASS=CONSTANT,
      199    23522                        SEV=%G_WRSYSLOG_SEV_LINE_ABORT# );
      200    23617
      201    23618        %FPT_WRSYSLOG ( STCLASS="" );
      202    23713
      203    23714    1   DCL LGNTXT CHAR(80);
      204    23715    1   DCL BSCTXT(0:0) UBIN BYTE BASED(BFR$) CALIGNED;
      205    23716    1   DCL SSTR CHAR(I) BASED(BFR$);
      206    23717    1   DCL Y$CHR CHAR(256) BASED;
      207    23718    1   DCL CHR32 CHAR(32) BASED;
      208    23719
      209    23720
      210    23721
      211    23722    1   DCL LCTX$ PTR;
      212    23723    1   DCL CTX$ PTR;
      213    23724    1   DCL BFR$ PTR;
      214    23725    1   DCL TBFR$ PTR;
      215    23726    1   DCL I UBIN WORD;
      216    23727    1   DCL TPTR$ PTR;
      217    23728    1   DCL LEV UBIN;
      218    23729    1   DCL SZ UBIN;
      219    23730
      220    23731        /*N*  KLUDGE AREA *** KLUDGE AREA *** KLUDGE AREA *** KLUDGE AREA *** KLUD  *N*/
      221    23732        /*N*  To make some site-specific patches easier, here's where we're         *N*/
      222    23733        /*N*  stashing away some CONSTANT SYMDEF values for HASP/2780/3780.         *N*/
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:7    
      223    23734        /*N*  These "defaults" should be made into SUPER options on                 *N*/
      224    23735        /*N*  TERM/PROFILE/DEVICE creation commands.                                *N*/
      225    23736    1   DCL KZ_SLCCHR2780PNC BIT(8) ALIGNED SYMREF;
      226    23737    1   DCL KZ_SLCCHR3780PNC1 BIT(8) ALIGNED SYMREF;
      227    23738    1   DCL KZ_SLCCHR3780PNC2 BIT(8) ALIGNED SYMREF;
      228    23739    1   DCL KZ_SLCCHR3780PRN BIT(8) ALIGNED SYMREF;
      229    23740        /*N*  KLUDGE AREA *** KLUDGE AREA *** KLUDGE AREA *** KLUDGE AREA *** KLUD  *N*/
      230    23741        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:8    
      231    23742    1         LCTX$=EVENT_FPT.LINCTX$;
      232    23743    2         DO CASE EVENT_FPT.EVENT;
      233    23744
      234    23745    2          CASE (%KZ#LINFCN_BLDCTX);
      235    23746
      236    23747        /*D*
      237    23748              When Function-code is KZ#LINFCN_BLDCTX, a device context block
      238    23749              is allocated, initialized, and added to a list of those
      239    23750              maintained in the line context block.
      240    23751
      241    23752                                                                          */
      242    23753    2            IF EVENT_FPT.TERMID$->B$TERMINAL_ID.LEV ~= %TERMINAL_ID_LEV_SUBCHAN# THEN
      243    23754    2               RETURN;
      244    23755              %DISABLE (DISLVL=LEV,INHLVL=KZ$LINCTX.INHLVL);
      245    23759    2            SZ = SIZEW(DEVCTX);
      246    23760    2            CALL KVB$GETSYS (SZ,CTX$)
      247    23761    2            WHENALTRETURN
      248    23762    3            DO;
      249    23763    3   NO_MEMORY:
      250    23764                   /*    Log "Out of MEMory" error and kill the line.    */
      251    23765    3               FPT_WRSYSLOG=WRSYSLOG;
      252    23766    3               FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$NOBFR;
      253    23767    3               FPT_WRSYSLOG.V.TERMID = KZ$LINCTX.LINID;
      254    23768    3               FPT_WRSYSLOG.V.VALUES (0) = SZ;
      255    23769    3               CALL KHA$ERRLOG (FPT_WRSYSLOG);
      256    23770        /*E*  ERROR:        KZR-E$NOBFR-6
      257    23771              MESSAGE:      Insufficient BISYNC MEMory (a NETCON parameter).
      258    23772              DESCRIPTION:  A KVB call ALTRETed to indicate that BISYNC is out of
      259    23773                            MEMory.  Since a necessary device context
      260    23774                            could not be allocated, the HASP/2780/3780 TERMinal
      261    23775                            associated with the request has been disconnected.
      262    23776                            V0 = Size of buffer, in words, which could not be allocated.
      263    23777        */
      264    23778
      265    23779    3               CALL KZR$KILL_LINE (KZ$LINCTX);
      266    23780    3               ALTRETURN;
      267    23781    3               END;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:9    
      268    23782    2            DEVCTX = KZ@SDVCTX;
      269    23783    2            EVENT_FPT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_SDEV#;
      270    23784    2            DEVCTX.LCLENDPNTID = EVENT_FPT.TERMID$->B$TERMINAL_ID;
      271    23785    2            DEVCTX.STATE=%KZ_S_SLOGON#;
      272    23786    2            DEVCTX.LIN$=LCTX$;
      273    23787    2            DEVCTX.RCB_CODE=EVENT_FPT.CHNCTX$->KL_HASPDEV.DADR.DEVNUM#;
      274    23788    2            DEVCTX.SUSBIT_MASK=EVENT_FPT.CHNCTX$->KL_HASPDEV.DADR.DEVCTL;
      275    23789
      276    23790    3            IF KZ$LINCTX.CTRHD$ ~= ADDR(NIL) THEN DO;
      277    23791    3               TPTR$ = KZ$LINCTX.CTRHD$;
      278    23792    4               DO WHILE (TPTR$->DEVCTX.LNK$ ~= ADDR(NIL));
      279    23793    4                  TPTR$ = TPTR$->DEVCTX.LNK$;
      280    23794    4                  END;
      281    23795    3               TPTR$->DEVCTX.LNK$ = CTX$;
      282    23796    3               END;
      283    23797    2            ELSE
      284    23798    2               KZ$LINCTX.CTRHD$ = CTX$;
      285    23799    2            KZ$LINCTX.POLSIZ = KZ$LINCTX.POLSIZ + 1;
      286    23800    3            IF KZ_RBTVDHSTT$ = ADDR(NIL) THEN DO;
      287    23801    3               SZ = SIZEW(KV$STT);
      288    23802    3               CALL KVB$GETSYS (SZ,KZ_RBTVDHSTT$) ALTRET (NO_MEMORY);
      289    23803    3               KZ_RBTVDHSTT$->KV$STT='0'B;
      290    23804    3               KZ_RBTVDHSTT$->KV$STT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;
      291    23805    3               KZ_RBTVDHSTT$->KV$STT.REQSTATS.SLCENT(%KH#ENTID_RBT)='1'B;
      292    23806    3               SZ = SIZEW(KZ_RBTSTT);
      293    23807    3               CALL KVB$GETSYS (SZ,TPTR$) ALTRET (NO_MEMORY);
      294    23808    3               KZ_HASP_HDR.STTBFR$=TPTR$;
      295    23809    3               KZ_BSC_HDR.STTBFR$=TPTR$;
      296    23810    3               KZ_BSCS_HDR.STTBFR$=TPTR$;
      297    23811    3               KZ_HASPS_HDR.STTBFR$=TPTR$;
      298    23812    3               KZ_RBTSTT=KZ@RBTSTT;
      299    23813    3               KZ_RBTVDHSTT$->KV$STT.REQSTATS.FNC=%IGA_REQSTATS;
      300    23814    3               KZ_RBTVDHSTT$->KV$STT.REQSTATS.DSPENT(%KH#ENTID_VDH)='1'B;
      301    23815    3               KZ_RBTSTT.REQSTATS.DSPENT(%KH#ENTID_RBT)='1'B;
      302    23816    3               KZ_RBTSTT.REQSTATS.SLCENT(%KH#ENTID_RBT)='1'B;
      303    23817    3               KZ_RBTSTT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;
      304    23818    3               SZ = SIZEW(KV@USRPRM);
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:10   
      305    23819    3               CALL KVB$GETSYS (SZ,TPTR$) ALTRET (NO_MEMORY);
      306    23820    3               KZ_USRPRM$=TPTR$;
      307    23821    3               KV@USRPRM=KV_USRPRM;
      308    23822    3               KV@USRPRM.STT$=KZ_RBTVDHSTT$;
      309    23823    3               KV@USRPRM.INHLVL=KZ$LINCTX.INHLVL;
      310    23824    3               END;
      311    23825              %ENABLE (DISLVL=LEV,INHLVL=KZ$LINCTX.INHLVL);
      312    23831        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:11   
      313    23832    2          CASE (%KZ#LINFCN_CTXCMP);
      314    23833
      315    23834        /*D*
      316    23835              When Function-code is KZ#LINFCN_CTXCMP, all build context calls
      317    23836              have been made for the line.  KZ$LINCTX.POLX is set so that the
      318    23837              EVT_ID_ENDSETPRM code can tell when VDH is finished with its
      319    23838              context building and can report LGNCMP back to KZP$CNCDSC.   */
      320    23839
      321    23840    2            KZ$LINCTX.POLX = 7;
      322    23841
      323    23842        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:12   
      324    23843
      325    23844
      326    23845    2          CASE (%KZ#LINFCN_ENABL);
      327    23846
      328    23847        /*D*
      329    23848              When Function_code is KZ#LINFCN_ENABL, Node Admin is telling
      330    23849              us that all information required for the VDH connection has
      331    23850              been received from the host.  VDH is called to connect the
      332    23851              device.
      333    23852                                                                           */
      334    23853    2            CTX$ = KZ$LINCTX.CTRHD$;
      335    23854    3            DO WHILE ( CTX$ ~= ADDR(NIL));
      336    23855    3               EVENT_FPT.TERMID$->B$TERMINAL_ID.TTYP = DEVCTX.LCLENDPNTID.TTYP;
      337    23856    4               IF DEVCTX.LCLENDPNTID = EVENT_FPT.TERMID$->B$TERMINAL_ID THEN DO;
      338    23857    4                  CALL TELLVDH ALTRET(ALT_RET);
      339    23858    4                  RETURN;
      340    23859    4                  END;
      341    23860    3               CTX$=DEVCTX.LNK$;
      342    23861    3               END;
      343    23862    2            ALTRETURN;
      344    23863
      345    23864        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:13   
      346    23865
      347    23866    2          CASE (%KZ#LINFCN_INP);
      348    23867
      349    23868        /*D*
      350    23869              When Function-code is KZ#LINFCN_INP, an input block is available
      351    23870              for processing.  There are two cases here depending if it is
      352    23871              or is not a HASP device.  If it is not HASP and there has not
      353    23872              been a signon, the signon string in the input buffer is passed
      354    23873              along to KHA$RQSLINPRO to get things initialized for this
      355    23874              device.  If a signon has been received the state of the first
      356    23875              input device on this line is examined.  If the device is OPEN
      357    23876              or AWAITING_CLOSE, KZL$DBLK is called to process the input.
      358    23877
      359    23878              If this is a HASP line some HASP block sequence checking is done
      360    23879              and then the same sort of signon and input processing described
      361    23880              above is done.
      362    23881                                                                           */
      363    23882    2            BFR$=KZ$LINCTX.INPBFR$;
      364    23883    2            IF KZ$LINCTX.PRO.PROTYP ~= %KLPT_HASP#
      365    23884    3               AND KZ$LINCTX.PRO.PROTYP ~= %KLPT_NJE# THEN DO;
      366    23885
      367    23886                         /*    2780/3780                                  */
      368    23887
      369    23888    4               IF NOT KZ$LINCTX.FLAGS.SIGNON THEN DO;
      370    23889    4                  KZ$LINCTX.FLAGS.SIGNON = '1'B;
      371    23890    4                  I = 0;
      372    23891    5                  DO WHILE ( I < 80 AND I < KZ$LINCTX.INPDATSIZ AND
      373    23892    5                     ( BSCTXT(I) ~= BITBIN('03'X) AND
      374    23893    5                     BSCTXT(I) ~= BITBIN('26'X) AND
      375    23894    5                     BSCTXT(I) ~= BITBIN('1D'X) AND
      376    23895    5                     BSCTXT(I) ~= BITBIN(KZ$LINCTX.PRO.IRSCHR /* Default '1E'X */) ) );
      377    23896    5                     I = I + 1;
      378    23897    5                     END;
      379    23898                       %KV$TRNINP (INPBFR=SSTR,OTPBFR="SUBSTR(LGNTXT,0,I)",
      380    23899                          TRNTBL$="ADDR(KZ_RBT_EBCI)");
             23904    4   CALL XLATE(SUBSTR(LGNTXT,0,I), ADDR(KZ_RBT_EBCI)->KV$TRNTBL.INPTRN1$->Y$CHR, SSTR);
      381    23906
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:14   
      382    23907    4                  GOTO LIN_ACK;
      383    23908    4                  END;
      384    23909    3               ELSE
      385    23910    3                  IF KZ$LINCTX.PTHSTT = %KZ#CLM_STATE_VAMOOSE THEN
      386    23911    3                     GOTO DBLK_INP;
      387    23912    3                  ELSE
      388    23913    3                     GOTO ALT_RET;
      389    23914    3               END;
      390    23915        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:15   
      391    23916                                                /*   HASP                             */
      392    23917
      393    23918    3            IF KZ$LINCTX.INPDATSIZ = 0 THEN DO;
      394    23919    3               KZ$LINCTX.FLAGS.RCVWAB = '0'B;
      395    23920    3               RETURN;
      396    23921    3               END;
      397    23922    2            KZ$LINCTX.FLAGS.RCVWAB = HSPBLK.FCS.WAB;
      398    23923    2            KZ$LINCTX.RCVFCS = HSPBLK.FCS;
      399    23924
      400    23925
      401    23926
      402    23927    3            DO CASE ( HSPBLK.BCB.CTL ); /* Perform BCB validation             */
      403    23928    3             CASE (0);
      404    23929                                      /* Normal block, check for normal sequencing    */
      405    23930
      406    23931    3               IF HSPBLK.BCB.CNT = MOD(KZ$LINCTX.BCB.RCV+1,16) THEN
      407    23932    3                  KZ$LINCTX.BCB.RCV = HSPBLK.BCB.CNT;
      408    23933    4               ELSE DO;
      409    23934    5                  IF HSPBLK.BCB.CNT = MOD(KZ$LINCTX.BCB.RCV,16) THEN DO;
      410    23935
      411    23936                                 /* Repeats prior block ... error log and ignore it   */
      412    23937
      413    23938    5                     FPT_WRSYSLOG=WRSYSLOG;
      414    23939    5                     FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;
      415    23940    5                     FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$DUPBLK;
      416    23941    5                     FPT_WRSYSLOG.BUF_ = VECTOR(KZ$LINCTX.INPBFR$->CHR32);
      417    23942    5                     ADDR(FPT_WRSYSLOG.V.VALUES(0))->ERRCTX.LCTX$ = ADDR(KZ$LINCTX);
      418    23943    5                     CALL KHA$ERRLOG (FPT_WRSYSLOG);
      419    23944
      420    23945
      421    23946        /*E* ERROR:        KZR-E$DUPBLK-4
      422    23947             MESSAGE:      HASP duplicate block received and ignored.
      423    23948             DESCRIPTION:  A received HASP block contained a block sequence that
      424    23949                           was the same as the previous block sequence received.
      425    23950                           The block was assumed to be a duplicate of the previous
      426    23951                           block and was ignored.
      427    23952                           V0/V1 = Line context pointer.
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:16   
      428    23953                           DATA = First 32 characters of the input block.
      429    23954        */
      430    23955
      431    23956    5                     RETURN;
      432    23957
      433    23958    5                     END;
      434    23959    5                  ELSE DO;
      435    23960
      436    23961                                                /* Sequence error. Disconnect         */
      437    23962
      438    23963    5                     FPT_WRSYSLOG=WRSYSLOG;
      439    23964    5                     FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;
      440    23965    5                     FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$BLKSEQERR;
      441    23966    5                     FPT_WRSYSLOG.BUF_ = VECTOR(KZ$LINCTX.INPBFR$->CHR32);
      442    23967    5                     ADDR(FPT_WRSYSLOG.V.VALUES(0))->ERRCTX.LCTX$ = ADDR(KZ$LINCTX);
      443    23968    5                     CALL KHA$ERRLOG (FPT_WRSYSLOG);
      444    23969
      445    23970
      446    23971        /*E* ERROR:        KZR-E$BLKSEQERR-6
      447    23972             MESSAGE:      HASP block sequence error.
      448    23973             DESCRIPTION:  A sequence error in the received HASP block
      449    23974                           was detected.  A line disconnect resulted.
      450    23975                           V0/V1 = Line context pointer.
      451    23976                           DATA = First 32 characters of the input block.
      452    23977        */
      453    23978    5                     CALL KILL_LINE;
      454    23979    5                     RETURN;
      455    23980    5                     END;
      456    23981    4                  END;
      457    23982    3             CASE (1);                  /* Ignore sequencing                  */
      458    23983
      459    23984    3             CASE (2);                  /* Set expected sequencing count      */
      460    23985
      461    23986    3               KZ$LINCTX.BCB.RCV = MOD(HSPBLK.BCB.CNT-1,16);
      462    23987
      463    23988    3             END;
      464    23989
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:17   
      465    23990
      466    23991
      467    23992    3            IF NOT KZ$LINCTX.FLAGS.SIGNON THEN DO;
      468    23993                 /* Not yet signed on:  this should be a SIGNON string.
      469    23994                    Note that we're operating under the KZ_INIT_C table here,
      470    23995                    and so think we're KLPT_HASP#, even though we may really be
      471    23996                    KLPT_NJE#.  We'll have to use the RCB/SRCB of the input block
      472    23997                    to decide which one we are. */
      473    23998    3               IF HSPBLK.FLG = 'F0C1'X /* HASP */
      474    23999    4                  OR HSPBLK.FLG = 'F0C9'X /* NJE */ THEN DO;
      475    24000    4                  KZ$LINCTX.FLAGS.SIGNON = '1'B;
      476    24001    5                  IF HSPBLK.FLG = 'F0C1'X /* HASP */ THEN DO;
      477    24002    5                     I = 0;
      478    24003    6                     DO WHILE  I < 80 AND I < KZ$LINCTX.INPDATSIZ AND
      479    24004    6                        HSPBLK.TXT(I) ~= 0;
      480    24005    6                        I = I + 1;
      481    24006    6                        END;
      482    24007                          %KV$TRNINP (INPBFR="ADDR(HSPBLK.TXT)->SSTR",
      483    24008                                      OTPBFR="SUBSTR(LGNTXT,0,I)",
      484    24009                                      TRNTBL$="ADDR(KZ_RBT_EBCI)");
             24014    5   CALL XLATE(SUBSTR(LGNTXT,0,I), ADDR(KZ_RBT_EBCI)->KV$TRNTBL.INPTRN1$->Y$CHR, ADDR(
             24014            HSPBLK.TXT)->SSTR);
      485    24016    5                     END;
      486    24017    5                  ELSE DO;
      487    24018    5                     I = LENGTHC(KZ$NJE_SIGNON.NCC.INODE);
      488    24019                          %KV$TRNINP (INPBFR="KZ$NJE_SIGNON.NCC.INODE",
      489    24020                                      OTPBFR="SUBSTR(LGNTXT,0,I)",
      490    24021                                      TRNTBL$="ADDR(KZ_RBT_EBCI)");
             24026    5   CALL XLATE(SUBSTR(LGNTXT,0,I), ADDR(KZ_RBT_EBCI)->KV$TRNTBL.INPTRN1$->Y$CHR,
             24026            KZ$NJE_SIGNON.NCC.INODE);
      491    24028    5                     END;
      492    24029
      493    24030                    /* Request CLM to get profiles.  Altreturn to indicate
      494    24031                       this was a signon string.                           */
      495    24032    4   LIN_ACK:
      496    24033    4                  KZ_EVENT=CNCDSC_EVENT;
      497    24034    4                  KZ_EVENT.EVENT=%KZ#CLM_EVENT_RQSLPR;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:18   
      498    24035    4                  KZ_EVENT.LGNVEC=VECTOR(ADDR(LGNTXT)->SSTR);
      499    24036    4                  KZ_EVENT.LINCTX$=LCTX$;
      500    24037    4                  CALL KZR_CNCDSC@ (KZ_EVENT);
      501    24038    4   ALT_RET:
      502    24039    4                  ALTRETURN;
      503    24040    4                  END;
      504    24041    4               ELSE DO;
      505    24042    4                  FPT_WRSYSLOG=WRSYSLOG;
      506    24043    4                  FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;
      507    24044    4                  FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$LINLGNREJ;
      508    24045    4                  FPT_WRSYSLOG.BUF_ = VECTOR(KZ$LINCTX.INPBFR$->CHR32);
      509    24046    4                  CALL KHA$ERRLOG (FPT_WRSYSLOG);
      510    24047
      511    24048
      512    24049        /*E* ERROR:        KZR-E$LINLGNREJ-6
      513    24050             MESSAGE:      Missing required SIGNON record.
      514    24051             DESCRIPTION:  The first record received on a HASP line
      515    24052                           was not a SIGNON control record.
      516    24053                           DATA = First 32 characters of the input block.
      517    24054        */
      518    24055    4                  CALL KILL_LINE;
      519    24056    4                  END;
      520    24057    3               END;
      521    24058    2            ELSE
      522    24059    2               IF KZ$LINCTX.PRO.PROTYP = %KLPT_NJE#
      523    24060    2                  AND ( HSPBLK.FLG = 'F0D1'X
      524    24061                    /* NJE SIGNON type-J record:  positive response to type-I.
      525    24062                       Should we care what the remote site considers our name to be?
      526    24063                       Should we "negotiate" KZ$NJE_SIGNON.NCCIDL? */
      527    24064    2                  OR HSPBLK.FLG = 'F0D2'X
      528    24065    2                  OR HSPBLK.FLG = 'F0D3'X
      529    24066    2                  OR HSPBLK.FLG = 'F0D4'X
      530    24067    3                  OR HSPBLK.FLG = 'F0D5'X ) THEN DO;
      531    24068                    /* Also ignoring type-K, -L, -M, and -N records.
      532    24069                       Since NJE says that a given transmission block may not contain
      533    24070                       records with different RCBs, this should all work. */
      534    24071    3                  END;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:19   
      535    24072    3               ELSE DO;
      536    24073                    /* Parse input block.  Only 2780/3780 will altreturn and
      537    24074                       then only if he can't accept any input at this time. */
      538    24075    3   DBLK_INP:
      539    24076    3                  CALL KZL$DBLK (KZ$LINCTX) ALTRET(ALT_RET);
      540    24077    3                  END;
      541    24078        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:20   
      542    24079    2          CASE (%KZ#LINFCN_SNDSIGNON);
      543    24080
      544    24081        /*D*
      545    24082              When Function-code is KZ#LINFCN_SNDSIGNON, a block containing the
      546    24083              SIGNON string may be queued for output, depending on the PROFILE type:
      547    24084                  HASP:  do nothing (SUPER-defined SIGNON string was already queued
      548    24085                         onto a DEVCTX by KZD$DEVMGR previously)
      549    24086                  NJE:  queue an 'I'-type signon block (waiting in RMTSS$)
      550    24087                  2780/3780:  don't call this routine.
      551    24088                                                                           */
      552    24089    2            IF KZ$LINCTX.PRO.PROTYP ~= %KLPT_NJE# THEN
      553    24090    2               ALTRETURN;  /* Line manager will send previously queued SIGNON */
      554    24091    2            CALL KZD$SNDSIGNON ( KZ$LINCTX.CTRHD$->DEVCTX );
      555    24092
      556    24093    2          CASE (%KZ#LINFCN_ACKSIGNON);
      557    24094
      558    24095        /*D*
      559    24096              When Function-code is KZ#LINFCN_ACKSIGNON, a block containing a
      560    24097              legal SIGNON string has been received.  This case queues up the proper
      561    24098              response, depending on the PROFILE type:
      562    24099                  HASP:  do nothing (line manager will send ACK0)
      563    24100                  NJE:  queue a 'J'-type signon response (waiting in RMTSS$)
      564    24101                  2780/3780:  don't call this routine.
      565    24102                                                                           */
      566    24103    2            IF KZ$LINCTX.PRO.PROTYP ~= %KLPT_NJE# THEN
      567    24104    2               ALTRETURN;  /* Line manager will send ACK0 */
      568    24105    2            CALL KZD$ACKSIGNON ( KZ$LINCTX.CTRHD$->DEVCTX );
      569    24106        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:21   
      570    24107    2          CASE (%KZ#LINFCN_GETOTP);
      571    24108
      572    24109        /*D*
      573    24110              When Function-code is KZ#LINFCN_GETOTP, an output block has been
      574    24111              sent and the line manager wants to send another.  The previous
      575    24112              block is relaeased by calling RELOTP and then KZL$BBLK is called
      576    24113              to obtain the next outptut.  If another block is not available,
      577    24114              the ALTRETURN is taken.
      578    24115                                                                           */
      579    24116    2   GETOTP:  BFR$=KZ$LINCTX.OTPHD$;
      580    24117    3            IF BFR$ ~= ADDR(NIL) THEN DO;
      581    24118    3               CTX$=KZ$OTPBFR.DEV$;
      582    24119    3               KZ$LINCTX.OTPHD$ = ADDR(NIL);
      583    24120    3               CALL RELOTP;         /* Release output block   */
      584    24121    3               END;
      585    24122    2            CALL KZL$BBLK (KZ$LINCTX) ALTRET(NOOTP);
      586    24123    2            IF KZ$LINCTX.OTPDATSIZ = 0 AND KZ$LINCTX.OTPHD$ ~= ADDR(NIL) THEN
      587    24124    2               GOTO GETOTP;
      588    24125    2            RETURN;
      589    24126    2   NOOTP:   ALTRETURN;
      590    24127
      591    24128
      592    24129        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:22   
      593    24130        /*D*
      594    24131              When function-code is KZ#LINFCN_KILL, B$TERMINAL_ID must be a
      595    24132              line level ID. A disconnect event is reported to VDH for all
      596    24133              devices on the line.  After VDH has completed disconnecting,
      597    24134              the device context is relaesed and the Common Line Manager is
      598    24135              notified with a DSCDEV event.
      599    24136                                                                           */
      600    24137
      601    24138    2          CASE (%KZ#LINFCN_KILL,
      602    24139    2               %KZ#LINFCN_DSCTRM,%KZ#LINFCN_DISABL);
      603    24140
      604    24141    2            IF EVENT_FPT.TERMID$->B$TERMINAL_ID.LEV ~= %TERMINAL_ID_LEV_CHAN# THEN
      605    24142    2               RETURN;
      606    24143
      607    24144    2            CTX$=KZ$LINCTX.CTRHD$;
      608    24145    2            TPTR$=ADDR(NIL);
      609    24146
      610    24147                 /* If there are no devices, report LINDSC to indicate that
      611    24148                 the disconnect is completed                               */
      612    24149
      613    24150    3            IF CTX$ = ADDR(NIL) THEN DO;
      614    24151    3   REPLINDSC:  KZ_EVENT=CNCDSC_EVENT;
      615    24152    3               KZ_EVENT.EVENT=%KZ#CLM_EVENT_LINDSC;
      616    24153    3               KZ_EVENT.LINCTX$=LCTX$;
      617    24154    3               KZ_EVENT.TERMID$=EVENT_FPT.TERMID$;
      618    24155    3               CALL KZR_CNCDSC@ (KZ_EVENT);
      619    24156    3               END;
      620    24157    3            ELSE DO;
      621    24158    4               DO WHILE(CTX$ ~= ADDR(NIL));
      622    24159
      623    24160    4                  IF DEVCTX.DSC THEN
      624    24161    4                     GOTO NXTDEV;
      625    24162
      626    24163    5                  IF DEVCTX.VDI$ = ADDR(NIL) THEN DO;
      627    24164
      628    24165                          /* Discard device context if never enabled.      */
      629    24166
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:23   
      630    24167    5                     IF TPTR$ = ADDR(NIL) THEN
      631    24168    5                        KZ$LINCTX.CTRHD$=DEVCTX.LNK$;
      632    24169    5                     ELSE
      633    24170    5                        TPTR$->DEVCTX.LNK$=DEVCTX.LNK$;
      634    24171    5                     TBFR$=CTX$;
      635    24172    5                     CTX$=DEVCTX.LNK$;
      636    24173    5                     CALL KVB$RLS (SIZEW(DEVCTX),TBFR$);
      637    24174    5                     END;
      638    24175    5                  ELSE DO;
      639    24176    5                     CALL KZD$DQ(DEVCTX);
      640    24177                       %KV$USRENT (VDI$=DEVCTX.VDI$,DFR$=DFRDSC,
      641    24178                                   SCHRSN=%KV_SCHRSN_DFR1);
             24191    5           DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24191                    DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24192    6           IF NOT DEVCTX.VDI$->KV$VDI.BSY THEN DO;
             24193    6              DEVCTX.VDI$->KV$VDI.BSY = '1'B;
             24194    6              KV@USRENT.SVDPTR$ = KV$PTR$;
             24195    6              KV$PTR$ = DEVCTX.VDI$->KV$VDI.ASNINPPTR$;
             24196    6              END;                         /* ELSE IF ~BSY                       */
             24197    6           ELSE DO;
             24198    6              DEVCTX.VDI$->KV$VDI.DFR.USR(1) = '1'B;
             24199    6           DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24199                    DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24200    6              GOTO DFRDSC;
             24201    6              END;                         /* END IF                             */
      642    24204    5                     DEVCTX.DSC.TOLD_VDH = '1'B;
      643    24205    5                     DEVCTX.FLAGS.SUSPEND_OUT='1'B;
      644    24206    5                     KV$VDH_DSC = KV_VDH_DSC;
      645    24207    5                     KV$VDH_DSC.RSN = KZ$LINCTX.DSCRSN;
      646    24208    5                     KV$VDH_DSC.NO_IO='1'B;
      647    24209    5                     CALL KVV$VDI (KV$VDH_DSC);
      648    24210    5                     CALL DFR;
      649    24211
      650    24212                       %KV$USREXT;
             24218    5           KV$PTR.VDI$->KV$VDI.BSY = '0'B;
             24220    5           KV$PTR$ = KV@USRENT.SVDPTR$;
      651    24222
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:24   
      652    24223    6                     DO WHILE ('0'B);
      653    24224    6   DFRDSC:              DEVCTX.DFR.DSCI='1'B;
      654    24225    6                        END;
      655    24226
      656    24227    5   NXTDEV:           TPTR$=CTX$;
      657    24228    5                     CTX$=DEVCTX.LNK$;
      658    24229    5                     END;
      659    24230    4                  IF KZ$LINCTX.CTRHD$=ADDR(NIL) THEN
      660    24231    4                     GOTO REPLINDSC;
      661    24232    4                  END;
      662    24233
      663    24234    3               END;
      664    24235    2          END;
      665    24236    1         RETURN;
      666    24237        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:25   
      667    24238        /*D*  NAME: KZR$DFR
      668    24239              CALL:
      669    24240                    CALL KZR$DFR (Device_context) ALTRET(label);
      670    24241              PARAMETERS:
      671    24242                    Device-context is the device context block.
      672    24243              DESCRIPTION:
      673    24244                    This procedure is called when a device's DEFER queue is to
      674    24245                    be processed.  The call should be from a routine which is
      675    24246                    already "in" VDH.
      676    24247                    Output buffers are released; they ended up on the DEFER queue
      677    24248                    due to VDH being busy when we attempted to release them earlier
      678    24249                    (we need VDH to acknowledge markers and/or change RQSOTP status).
      679    24250                    Input records are processed, and the buffers associated with
      680    24251                    them (a KZ$INPBFR and a buffer the size of the record itself)
      681    24252                    are released.  These also ended up on the DEFER queue due to
      682    24253                    a busy VDH.
      683    24254                    For consoles, both input and output devices are searched.
      684    24255                                                                           */
      685    24256
      686    24257    1   KZR$DFR: ENTRY (EVENT_FPT) ALTRET;
      687    24258
      688    24259    1         CTX$=ADDR(EVENT_FPT);
      689    24260    1         LCTX$=DEVCTX.LIN$;
      690    24261    1         CALL DFR;
      691    24262    1         IF (DEVCTX.MGR_TYPE = %KZ_S_DMCONSOLE# OR
      692    24263    1            DEVCTX.MGR_TYPE = %KZ_S_DMINPUT#) AND
      693    24264    1            DEVCTX.DFRHD$ = ADDR(NIL) THEN
      694    24265    1            DEVCTX.FLAGS.SUSPEND_IN = '0'B;
      695    24266    2         IF DEVCTX.MGR_TYPE = %KZ_S_DMCONSOLE# THEN DO;
      696    24267    2            CTX$ = DEVCTX.LNK$;
      697    24268    2            IF CTX$ ~= ADDR(NIL) THEN
      698    24269    2               CALL DFR;
      699    24270    2            END;
      700    24271    1         RETURN;
      701    24272
      702    24273    1   DFR:  PROC;
      703    24274
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:26   
      704    24275    2         TBFR$ = ADDR(DEVCTX.DFRHD$);
      705    24276    2         BFR$ = DEVCTX.DFRHD$;
      706    24277    3         DO WHILE ( BFR$ ~= ADDR(NIL));
      707    24278    3            IF KZ$OTPBFR.TYP = %KZ#BFRTYP_INP AND
      708    24279    3               NOT DEVCTX.DSC.VDH_FINAL AND
      709    24280    4               NOT DEVCTX.VDI$->KV$VDI.USRRQSDAT.RED THEN DO;
      710    24281    4               TBFR$ = BFR$;
      711    24282    4               BFR$ = BFR$->KZ$INPBFR.LNK$;
      712    24283    4               END;
      713    24284    4            ELSE DO;
      714    24285    4               TBFR$->KZ$OTPBFR.LNK$ = BFR$->KZ$OTPBFR.LNK$;
      715    24286    5               DO CASE (KZ$OTPBFR.TYP);
      716    24287    5                CASE(%KZ#BFRTYP_OTP);
      717    24288    5                  CALL RELOTPDFR;
      718    24289    5                CASE(%KZ#BFRTYP_INP);
      719    24290    5                  IF NOT DEVCTX.DSC.VDH_FINAL THEN
      720    24291    5                     CALL SNDINP;
      721    24292    5                  IF KZ$INPBFR.DATA$ ~= ADDR(NIL) THEN
      722    24293    5                     CALL KVB$RLS ((KZ$INPBFR.BFR_SIZ+1)/2,KZ$INPBFR.DATA$);
      723    24294    5                  CALL KVB$RLS (SIZEW(KZ$INPBFR),BFR$);
      724    24295    5                END;
      725    24296    4               BFR$ = TBFR$->KZ$OTPBFR.LNK$;
      726    24297    4               END;
      727    24298    3            END;
      728    24299    2         IF TBFR$ = ADDR(DEVCTX.DFRHD$) THEN
      729    24300    2            DEVCTX.DFRTL$ = ADDR(NIL);
      730    24301    2         ELSE
      731    24302    2            DEVCTX.DFRTL$ = TBFR$;
      732    24303    2         RETURN;
      733    24304    2   END DFR;
      734    24305        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:27   
      735    24306        /*D*  NAME: KZR$DSC_CONT
      736    24307              CALL:
      737    24308                 CALL KZR$DSC_CONT (Device-context) ALTRET(label);
      738    24309              PARAMETERS:
      739    24310                 Device-context is a device context block.
      740    24311              DESCRIPTION:
      741    24312                 This procedure continues the disconnect process that was
      742    24313                 unable to complete because of rentry to VDH..
      743    24314                                                                           */
      744    24315
      745    24316    1   KZR$DSC_CONT: ENTRY (EVENT_FPT) ALTRET;
      746    24317
      747    24318    1         CTX$=ADDR(EVENT_FPT);
      748    24319    1         LCTX$=DEVCTX.LIN$;
      749    24320    2         IF DEVCTX.DFR.DSCI THEN DO;
      750    24321    2            DEVCTX.DFR.DSCI = '0'B;
      751    24322    2            DEVCTX.DSC.TOLD_VDH = '1'B;
      752    24323    2            KV$VDH_DSC = KV_VDH_DSC;
      753    24324    2            KV$VDH_DSC.RSN = KZ$LINCTX.DSCRSN;
      754    24325    2            CALL KVV$VDI (KV$VDH_DSC);
      755    24326    2            CALL DFR;
      756    24327    2            END;
      757    24328    1         RETURN;
      758    24329
      759    24330
      760    24331
      761    24332
      762    24333        /*D*  NAME: KZR$RELOPTBFR
      763    24334              CALL:
      764    24335                 CALL KZR$RELOTPBFR (Device-context);
      765    24336              PARAMETER:
      766    24337                 The  device context block pointer.
      767    24338              DESCRIPTION:
      768    24339                 This is an external entry to the RELOTP procedure to permit
      769    24340                 other procedures to release buffers.
      770    24341                                                                           */
      771    24342
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:28   
      772    24343    1   KZR$RELOTPBFR: ENTRY (EVENT_FPT) ALTRET;
      773    24344
      774    24345    1         BFR$=ADDR(EVENT_FPT);
      775    24346    1         CTX$=KZ$OTPBFR.DEV$;
      776    24347    1         LCTX$=DEVCTX.LIN$;
      777    24348    1         CALL RELOTP;
      778    24349    1         RETURN;
      779    24350
      780    24351
      781    24352
      782    24353
      783    24354        /*    Release Output Block                                         */
      784    24355        /*D*
      785    24356              RELOTP is an internal routine whose purpose is to release the
      786    24357              output block pointed to by BFR$.  If there are
      787    24358              Markers in the block, and we can't get to VDH to tell him
      788    24359              just now, the block is added to the tail of a defer list
      789    24360              for releasing later.
      790    24361
      791    24362              VDH is informed of any markers noted in the output block and
      792    24363              the throttling threshold is checked.  VDH is informed if more
      793    24364              output is required.
      794    24365
      795    24366                                                                           */
      796    24367
      797    24368    1   RELOTP: PROC;
      798    24369
      799    24370    2   DCL TBFR$ PTR;
      800    24371    2   DCL ENTFLG BIT(1);
      801    24372
      802    24373
      803    24374    2         ENTFLG='1'B;
      804    24375
      805    24376              %KV$USRENT (VDI$=DEVCTX.VDI$,DFR$=DFRREL,SCHRSN=%KV_SCHRSN_DFR1);
             24389    2           DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24389                    DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;
             24390    3           IF NOT DEVCTX.VDI$->KV$VDI.BSY THEN DO;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:29   
             24391    3              DEVCTX.VDI$->KV$VDI.BSY = '1'B;
             24392    3              KV@USRENT.SVDPTR$ = KV$PTR$;
             24393    3              KV$PTR$ = DEVCTX.VDI$->KV$VDI.ASNINPPTR$;
             24394    3              END;                         /* ELSE IF ~BSY                       */
             24395    3           ELSE DO;
             24396    3              DEVCTX.VDI$->KV$VDI.DFR.USR(1) = '1'B;
             24397    3           DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24397                    DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;
             24398    3              GOTO DFRREL;
             24399    3              END;                         /* END IF                             */
      806    24402    3         DO WHILE ('0'B);
      807    24403    3   DFRREL:  /* Can't get to VDH right now.   */
      808    24404    3            IF DEVCTX.DFRTL$~=ADDR(NIL) THEN
      809    24405    3               DEVCTX.DFRTL$->KZ$OTPBFR.LNK$=BFR$;
      810    24406    3            ELSE
      811    24407    3               DEVCTX.DFRHD$=BFR$;
      812    24408    3            DEVCTX.DFRTL$=BFR$;
      813    24409    3            KZ$OTPBFR.LNK$=ADDR(NIL);
      814    24410    3            RETURN;
      815    24411    3            END;
      816    24412
      817    24413    3   RELOTP1: IF KZ$OTPBFR.MRKCNT ~= 0 THEN DO;
      818    24414
      819    24415
      820    24416    4            DO I = 1 TO KZ$OTPBFR.MRKCNT;
      821    24417    4               TBFR$=PINCRW(BFR$,KZ$OTPBFR.BFRSIZ-SIZEW(KV$OTPMRK)*I);
      822    24418    4               KV$VDH_OTPMRK=KV_VDH_OTPMRK;
      823    24419    4               KV$VDH_OTPMRK.DAT=TBFR$->KV$OTPMRK;
      824    24420                    /* KZ$OTPBFR.CMPCOD is actually never filled in by anyone...
      825    24421                       it probably should be, since there are values indicating
      826    24422                       "device error", "buffer allocation exceeded", etc.
      827    24423                       Here we're filling it in with "disconnected" if that's what's
      828    24424                       going on.  This may be done more nicely at the point of
      829    24425                       disconnect, but placing the check here ensures that ALL
      830    24426                       buffers with OTPMRKs will return CMPCOD = DSC after a
      831    24427                       disconnect.  The only OTPMRK we're really concerned with,
      832    24428                       however, is the last one, with MSTRTR set. */
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:30   
      833    24429    4               IF DEVCTX.DSC OR
      834    24430    4                  DEVCTX.DFR.DSCI THEN
      835    24431    4                  KZ$OTPBFR.CMPCOD=%KV_CMPCOD_DSC;
      836    24432    4               KV$VDH_OTPMRK.CMPCOD=KZ$OTPBFR.CMPCOD;
      837    24433    4               CALL KVV$VDI(KV$VDH_OTPMRK);
      838    24434    4               END;
      839    24435    3            END;
      840    24436
      841    24437
      842    24438
      843    24439    2   RELOTP2: IF KZ$OTPBFR.FLAGS.CNT# THEN
      844    24440    2            DEVCTX.OTPBYTES=DEVCTX.OTPBYTES-KZ$LINCTX.PRO.BLKBYTES;
      845    24441    2         IF DEVCTX.OTPBYTES~=0 AND DEVCTX.OTPHD$=ADDR(NIL) AND
      846    24442    3            KZ$LINCTX.OTPHD$ = ADDR(NIL) AND DEVCTX.DFRHD$=ADDR(NIL) THEN DO;
      847    24443    3            FPT_WRSYSLOG=WRSYSLOG;
      848    24444    3            FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;
      849    24445    3            FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$THRTLERR;
      850    24446    3            ADDR(FPT_WRSYSLOG.V.VALUES(0))->ERRCTX.DVCTX$ = CTX$;
      851    24447    3            ADDR(FPT_WRSYSLOG.V.VALUES(0))->ERRCTX.VAL1 = DEVCTX.OTPBYTES;
      852    24448    3            CALL KHA$ERRLOG (FPT_WRSYSLOG);
      853    24449        /*E* ERROR:        KZR-E$THRTLERR-3
      854    24450             MESSAGE:      Throttling is out of sync.
      855    24451             DESCRIPTION:  A device's output byte count is nonzero, but no output
      856    24452                           is pending (or in progress).
      857    24453                           V0/V1 = Device context pointer.
      858    24454                           V2 = Current output byte count.
      859    24455        */
      860    24456    3            DEVCTX.OTPBYTES=0;
      861    24457    3            END;
      862    24458    2         IF DEVCTX.FLAGS.THROTL AND
      863    24459    3            DEVCTX.OTPBYTES <= KZ$LINCTX.CHN$->KH$CHN.UNBLOCK THEN DO;
      864    24460    3            DEVCTX.FLAGS.THROTL='0'B;
      865    24461                 %KV$RQSOTP (RQSOTP=YES);
             24473    4           IF NOT KV$PTR.VDI$->KV$VDI.RQSOTP  THEN DO;
             24474    4              KV$PTR.VDI$->KV$VDI.RQSOTP = '1'B;
             24475    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);
             24476    4              END;                         /* END IF                             */
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:31   
      866    24479    3            END;
      867    24480
      868    24481    2         I = KZ$OTPBFR.BFRSIZ;
      869    24482              %DISABLE (DISLVL=LEV,INHLVL=KZ$LINCTX.INHLVL);
      870    24486    2         CALL KVB$RLS2NSYS (I,BFR$);
      871    24487              %ENABLE (DISLVL=LEV,INHLVL=KZ$LINCTX.INHLVL);
      872    24493
      873    24494
      874    24495
      875    24496
      876    24497    3         IF ENTFLG THEN DO;
      877    24498              %KV$USREXT;
             24504    3           KV$PTR.VDI$->KV$VDI.BSY = '0'B;
             24506    3           KV$PTR$ = KV@USRENT.SVDPTR$;
      878    24508    3            END;
      879    24509
      880    24510    2         RETURN;
      881    24511
      882    24512
      883    24513    2   RELOTPDFR: ENTRY;
      884    24514    2         ENTFLG= '0'B;                 /* Already in VDH  */
      885    24515    2         IF DEVCTX.DSC.VDH_FINAL THEN
      886    24516    2            GOTO RELOTP2;
      887    24517    2         ELSE
      888    24518    2            GOTO RELOTP1;
      889    24519
      890    24520    2   END RELOTP;
      891    24521
      892    24522        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:32   
      893    24523
      894    24524    1   TELLVDH: PROC ALTRET;
      895    24525
      896    24526              %KV$USRENT (VDI$="ADDR(NIL)");
             24532    2              KV@USRENT.SVDPTR$ = KV$PTR$;
      897    24552    2         KV$VDH_INT=KV_VDH_INT;
      898    24553    2         KV$VDH_INT.USRPRM$=KZ_USRPRM$;
      899    24554    2         KV$VDH_INT.CHN$=KZ$LINCTX.CHN$;
      900    24555    2         KV$VDH_INT.USRCTX$=CTX$;
      901    24556    2         KV$VDH_INT.RCVFLWCTRMAXCRD=KZ$LINCTX.CHN$->KH$CHN.BLOCK;
      902    24557    2         KV$VDH_INT.TRCBFRBYTSIZ=KZ_VDHTRCBFRBYTSIZ;
      903    24558    2         CALL KVV$INT(KV$VDH_INT) ALTRET(TELALT);
      904    24559
      905    24560    2         KV$VDH_CNC=KV_VDH_CNC;
      906    24561    2         DEVCTX.VDI$ = KV$VDH_INT.VDI$;
      907    24562        /*    KV$VDH_CNC.VDI$ = KV$VDH_INT.VDI$;  */
      908    24563    2         KV$VDH_CNC.LCLENDPNTID = EVENT_FPT.TERMID$->B$TERMINAL_ID;
      909    24564    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DSC)='1'B;
      910    24565    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNRJC)='1'B;
      911    24566    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNACP)='1'B;
      912    24567    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSVDI)='1'B;
      913    24568    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_SCH)='1'B;
      914    24569    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_OPN)='1'B;
      915    24570    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_CLS)='1'B;
      916    24571    2         %KV_VDI.INPUNT=%KV_INPUNT_RCR;
      917    24572    2         CALL KVV$VDI(KV$VDH_CNC) ALTRET(XXXCNC);
      918    24573
      919    24574    3         DO WHILE ('0'B);
      920    24575    3   XXXCNC:  KV$VDH_EVT=KV_VDH_EVT;
      921    24576    3            KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;
      922    24577    3            CALL KVV$VDI(KV$VDH_EVT);
      923    24578    3   TELALT:  DEVCTX.VDI$=ADDR(NIL);
      924    24579                 %KV$USREXT (VDI$="ADDR(NIL)");
             24587    3           KV$PTR$ = KV@USRENT.SVDPTR$;
      925    24589    3            RETURN;
      926    24590    3            END;
      927    24591    2         %KV_MRD.MINSP_FORPST = KZD_MINSP_FORPST;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:33   
      928    24592              %KV$USREXT (VDI$="ADDR(NIL)");
             24600    2           KV$PTR$ = KV@USRENT.SVDPTR$;
      929    24602    2         RETURN;
      930    24603    2   END;
      931    24604
      932    24605         /*   Pass defered input record on to VDH      */
      933    24606
      934    24607    1   SNDINP: PROC;
      935    24608
      936    24609    2         KV$VDH_DAT = KV_VDH_DAT;
      937    24610    2         KV$VDH_DAT.DAT__.BFRBYTSIZ = KZ$INPBFR.BFR_SIZ;
      938    24611    2         KV$VDH_DAT.DAT__.ADR$ = KZ$INPBFR.DATA$;
      939    24612    2         KV$VDH_DAT.DAT__.DATBYTSIZ = KZ$INPBFR.DATA_SIZ;
      940    24613    3         IF DEVCTX.ACCESS_METHOD = %KZ_S_ACSPRINT# THEN DO;
      941    24614    3            KV$VDH_DAT.DATCTRCHR = BINASC(KZ$INPBFR.BYTX);
      942    24615    3            KV$VDH_DAT.DATCTRCHRTYP=%KV_DATCTRCHRTYP_VFC;
      943    24616    3            END;
      944    24617    2         ELSE
      945    24618    2            IF ( KZ$LINCTX.PRO.PROTYP = %KLPT_HASP#
      946    24619    2               OR KZ$LINCTX.PRO.PROTYP = %KLPT_NJE# )
      947    24620    2               AND DEVCTX.FLAGS.BINARY_OK
      948    24621    2               AND ADDR(KZ$INPBFR.BYTX)->HASPSRCB.V.BIN THEN
      949    24622    2               KV$VDH_DAT.DATMOD=%KV#DATMOD_BNR;
      950    24623    2         KV$VDH_DAT.CTN = KZ$INPBFR.FLAGS.CTN#;
      951    24624    2         IF KV$VDH_DAT.DAT__.DATBYTSIZ ~= 0 THEN
      952    24625    2            CALL KVV$VDI (KV$VDH_DAT);
      953    24626    3         IF KZ$INPBFR.FLAGS.LAST# THEN DO;
      954    24627    3            KV$VDH_DAT.DAT__.DATBYTSIZ = 0;
      955    24628    3            KV$VDH_DAT.CMPCOD = %KV_CMPCOD_EOF;
      956    24629    3            CALL KVV$VDI (KV$VDH_DAT);
      957    24630    3            END;
      958    24631    2         RETURN;
      959    24632    2   END SNDINP;
      960    24633
      961    24634        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:34   
      962    24635
      963    24636        /*F*  NAME: KZR$KILL_LINE;
      964    24637              PURPOSE:
      965    24638                 To provide a procedure to report a line KILL event to CLM
      966    24639                                                                           */
      967    24640
      968    24641
      969    24642    1   KZR$KILL_LINE: ENTRY (EVENT_FPT) ALTRET;
      970    24643
      971    24644    1         LCTX$=ADDR(EVENT_FPT);
      972    24645    1         CALL KILL_LINE;
      973    24646    1         RETURN;
      974    24647
      975    24648
      976    24649        /*    Report KILL event to CLM                                     */
      977    24650
      978    24651    1   KILL_LINE: PROC;
      979    24652
      980    24653    2         KZ_EVENT=CNCDSC_EVENT;
      981    24654    2         KZ_EVENT.EVENT=%KZ#CLM_EVENT_KILLED;
      982    24655    2         KZ_EVENT.LINCTX$=LCTX$;
      983    24656    2         KZ_EVENT.TERMID$=ADDR(KZ$LINCTX.LINID);
      984    24657    2         CALL KZR_CNCDSC@ (KZ_EVENT);
      985    24658    2         RETURN;
      986    24659    2   END;
      987    24660
      988    24661    1   END KZR$RBT;
      989    24662        %EOD;

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:35   
--  Include file information  --

   KV$VDO.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$INT.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KZ$INPBFR.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   KZ_BSC_C.:E05TOU  is referenced.
   KZ_HASP_C.:E05TOU  is referenced.
   KZ_3270_C.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KZ$RBT_M.:E05TOU  is referenced.
   KZ$OTPBFR.:E05TOU  is referenced.
   KZ$NJE_M.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:36   
   KZ_LIN_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
      No diagnostics issued in procedure KZR$RBT.

   Procedure KZR$RBT requires 2405 words for executable code.
   Procedure KZR$RBT requires 163 words of local(AUTO) storage.

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:37   

 Object Unit name= KZR$RBT                                    File name= KZR$RBT.:E05TOU
 UTS= JUL 30 '97 02:59:36.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    283    11B  KZR$RBT
    1   Proc  even  none  2405    965  KZR$RBT
    2  RoData even  none     5      5  KZR$RBT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KZR$RBT
     1    55E          yes     yes      Std        1  KZR$DFR
     1    62E          yes     yes      Std        1  KZR$DSC_CONT
     1    663          yes     yes      Std        1  KZR$RELOTPBFR
     1    930          yes     yes      Std        1  KZR$KILL_LINE

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0    103  KZR_THRTL_INIT
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:38   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KZD$DEVMGR
 yes     yes           Std       2 KVB$GETSYS
 yes     yes           Std       1 KZD$ACKSIGNON
 yes     yes           Std       2 KVB$RLS
         yes           Std       1 KHI$DISABLE
 yes     yes           Std       2 KHA$ERRLOG
         yes           Std       0 KHI$ENABLE
 yes     yes           Std       1 KZL$DBLK
 yes     yes           Std       1 KZD$SNDSIGNON
 yes     yes           Std       1 KVV$VDI
 yes     yes           Std       1 KZL$BBLK
         yes           Std       1 KZD$DQ
 yes     yes           Std       2 KVB$RLS2NSYS
 yes     yes           Std       1 KVV$INT
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT
                       nStd      0 X6C_ALRZ
                       nStd      0 X6C_MAT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KV_VDH_INT                       r    KV_VDH_DAT                       r    KV_VDH_CNC
r    KV_VDH_EVT                       r    KV_VDH_DSC                       r    KV_VDH_OTPMRK
r    KV_VDH_EVT_RQSOTP                     KV$PTR$                               KZD_MINSP_FORPST
     KZ_RBT_EBCI                           KZ_RBTVDHSTT$                         KZ_USRPRM$
     KZ_VDHTRCBFRBYTSIZ                    KZ_HASP_HDR                           KZ_HASPS_HDR
     KZ_BSC_HDR                            KZ_BSCS_HDR                           KZR_CNCDSC@
r    G$ROS$
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:39   


        1        1        /*M*  RBT device manager services for use by CLM                   */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
        8        8        /*P*  NAME:    KZR$RBT
        9        9              PURPOSE:
       10       10                 To provide RBT device oriented services for the Common
       11       11                 Line Manager.
       12       12                                                                           */
       13       13        /*D*  NAME:    KZR$RBT
       14       14              CALL:
       15       15                       CALL KZR$RBT (CLM-fpt) ALTRET(label);
       16       16              PARAMETERS:
       17       17                       CLM-fpt is an FPT structure containing the following
       18       18                       information;
       19       19
       20       20                       An Event or Function-code describing the process to be
       21       21                       performed. This must be one of the following:
       22       22                          KZ#LINFCN_BLDCTX    To build device context and
       23       23                                              initialize VDH interface.
       24       24                          KZ#LINFCN_INP       Process an input block.
       25       25                          KZ#LINFCN_GETOTP    Prepare an output block
       26       26                          KZ#LINFCN_DSC       Disconnect all devices associated
       27       27                                              with the line.
       28       28
       29       29                       A pointer to a B$TERMINAL_ID for the device being
       30       30                       initialized when Function-code is KZ#LINFCN_BLDCTX or
       31       31                       KZ#LINFCN_DSC.
       32       32                       It is unused for other functions.
       33       33
       34       34                       A pointer to a Line Context block.
       35       35
       36       36                       The ALTRETURN to label is taken if an input block is
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:40   
       37       37                       found to contain a 'signon string'.
       38       38
       39       39
       40       40
       41       41              DESCRIPTION:
       42       42                       This procedure is called by the Common Line Manager
       43       43                       to perform the administrative functions, BLDCTX and
       44       44                       DSC, via an EPTR in KZ$LINCTX.DEVMGR@.  It is called
       45       45                       from the 'line handler', either KZB$BSCIO or KZB$HASPIO
       46       46                       to perform the I/O functions, GETOTP or INP.  See the
       47       47                       individual descriptions below to see what it does.
       48       48
       49       49                                                                           */
       50       50
       51       51
       52       52
       53       53        KZR$RBT: PROC (EVENT_FPT) ALTRET;

     53   1 000000  D380 0000 0000  xent KZR$RBT         LNJ,B5   X6A_AUTO_1
          1 000003       00A3 0001                       DC       163,1

       54       54
       55       55        %INCLUDE KH$CHN;
       56      177        %INCLUDE KZ$LINCTX;
       57      797        %INCLUDE KZ_LIN_C;
       58      853        %INCLUDE KZ_CLM_E;
       59     1025        %INCLUDE KZ_PERR_C;
       60     1107        %INCLUDE KL_SUPER_C;
       61     4009        %INCLUDE KZ$NJE_M;
       62     4247        %INCLUDE KZ$OTPBFR;
       63     4348        %INCLUDE KZ$RBT_M;
       64     4907        %INCLUDE KV_GLBCNS_E;
       65     5248        %INCLUDE KZ_3270_C;
       66     5406        %INCLUDE KZ_HASP_C;
       67     5748        %INCLUDE KZ_BSC_C;
       68     6730        %INCLUDE KZ$BSCSTT;
       69     6836        %INCLUDE KH$STT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:41   
       70     6866        %INCLUDE KL_MACRO_C;
       71    10218        %INCLUDE KL_AFCN_C;
       72    10319        %INCLUDE K_ID_E;
       73    10369        %INCLUDE KZ$INPBFR;
       74    10429        %INCLUDE KHC_MAC_C;
       75    10470        %INCLUDE CP_6_SUBS;
       76    11010        %INCLUDE LCP_6;
       77    15289        %INCLUDE KV$VDH;
       78    15720        %INCLUDE KV$GLB;
       79    16139        %INCLUDE KV$INT;
       80    16771        %INCLUDE KV$GLBCTX;
       81    17216        %INCLUDE KV_GLB_M;
       82    17338        %INCLUDE KV_PRMID_E;
       83    17512        %INCLUDE KV$VDO;
       84    18527
       85    18528
       86    18529
       87    18530        %K#ENTID_E;
       88    18549        %KV_INPOPRX_E;
       89    18561        %KV_DATCTRCHRTYP_E;
       90    18567        %KV#DATMOD_E;
       91    18573        %KZ_3270_E;
       92    18701        %K#LYRID_E;
       93    18708        %KH$CHN;
       94    18832        %KZ$SDVCTX (NAME=DEVCTX,STCLASS="BASED(CTX$)");
       95    19144        %KZ$LINCTX (NAME=KZ$LINCTX,STCLASS="BASED(LCTX$)");
       96    19575        %KZ$HASPBLK (NAME=HSPBLK,STCLASS="BASED(BFR$)");
       97    19608        %KZ$HASPSRCB (NAME=HASPSRCB,STCLASS=BASED);
       98    19632        %KZ$NJE_SIGNON (STCLASS="BASED(BFR$)");
       99    19712        %KZ$RBTERR (NAME=ERRCTX);
      100    19733        %KZ$OTPBFR (STCLASS="BASED(BFR$)");
      101    19798        %KZ$INPBFR (STCLASS="BASED(BFR$)");
      102    19831
      103    19832        %B$TERMINAL_ID (STCLASS=BASED);
      104    19861        %KL_HASPDEV (STCLASS=BASED);
      105    20095
      106    20096        %KV$VDH_INT (STCLASS="");
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:42   
      107    20133        %KV$VDH_INT (NAME=KV_VDH_INT,STCLASS="SYMREF READONLY");
      108    20170        %KV$VDH_DAT (NAME=KV_VDH_DAT,STCLASS="SYMREF READONLY");
      109    20250        %KV$VDH_CNC (STCLASS="");
      110    20342        %KV$VDH_CNC (NAME=KV_VDH_CNC,STCLASS="SYMREF READONLY");
      111    20434        %KV$VDH_EVT (STCLASS="");
      112    20469        %KV$VDH_EVT (NAME=KV_VDH_EVT,STCLASS="SYMREF READONLY");
      113    20504        %KV$VDH_DSC (NAME=KV_VDH_DSC,STCLASS="SYMREF READONLY");
      114    20540        %KV$VDH_DSC (STCLASS="");
      115    20576        %KV$VDH_OTPMRK (NAME=KV_VDH_OTPMRK,STCLASS="SYMREF READONLY");
      116    20638    1   DCL KV_VDH_EVT_RQSOTP UBIN SYMREF READONLY;
      117    20639        %KV$VDH_OTPMRK (STCLASS="");
      118    20701        %KV_PRMID_E;
      119    20857        %KV_STRTYP_E;
      120    20895        %KV_SCHRSN_E;
      121    20902        %KV_INPUNT_E;
      122    20907        %KV_CMPCOD_E;
      123    20921
      124    20922        %KV$TRNTBL;
      125    20980        %KV$USRPRM_INT;
      126    20994        %KV$SETPRMPREPRC (PRMID=KV_PRMID_PRFNAM);
      127    21007        %KV$SETPRMPREPRC (PRMID=KV_PRMID_BIN);
      128    21020        %KV$SETPRMPREPRC (PRMID=KV_PRMID_INPUT);
      129    21033        %KV$SETPRMPREPRC (PRMID=KV_PRMID_OUTPUT);
      130    21046        %KV$SETPRMPREPRC (PRMID=KV_PRMID_PRINTTYPE);
      131    21059        %KV$SETPRMPREPRC (PRMID=KV_PRMID_VFU);
      132    21072        %KV$SETPRMPREPRC (PRMID=KV_PRMID_FIRSTLINE);
      133    21085        %KV$STREVTENB (STRTYP=KV_STRTYP_VDI);
      134    21090        %KV$USRPRM (NAME=KV_USRPRM,STCLASS=CONSTANT,USRSBR=KZD$DEVMGR,
      135    21091                    INPFNCTBLHEDPTR$=KV_VDH_INT.USRPRM$,
      136    21092                    TRNTBLHEDPTR$=TRN$);
      137    21143        %KV$USRPRM;
      138    21194        %KV$USRPRM (NAME=KV@USRPRM,STCLASS="BASED(TPTR$)");
      139    21245        %KV$MRD;
      140    21292        %KV$VDI;
      141    21363        %KV$OTPMRK;
      142    21390        %KV$PTR;
      143    21433        %KV$SSN;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:43   
      144    21512        %KV$STT;
      145    21906        %KV@USRENT;
      146    21926        %KZ$EVENT (FPTN=CNCDSC_EVENT,STCLASS=CONSTANT);
      147    22008        %KZ$EVENT (FPTN=KZ_EVENT,STCLASS="");
      148    22090        %KV$VDH_DAT (STCLASS="");
      149    22170
      150    22171
      151    22172    1   DCL KZD_MINSP_FORPST UBIN SYMREF;
      152    22173    1   DCL KZR_THRTL_UNBLK UBIN SYMREF;
      153    22174    1   DCL KZ_RBT_EBCI UBIN SYMREF;
      154    22175    1   DCL KZ_RBTVDHSTT$ PTR SYMREF;
      155    22176    1   DCL KZ_USRPRM$ PTR SYMREF;
      156    22177    1   DCL KZ_VDHTRCBFRBYTSIZ UBIN SYMREF; /* It's in KZ_DTBLS_D */
      157    22178        %KZ_HASP_HDR (STCLASS=SYMREF);
      158    22202        %KZ_HASP_HDR (NAME=KZ_HASPS_HDR,STCLASS=SYMREF);
      159    22226        %KZ_BSC_HDR (STCLASS=SYMREF);
      160    22250        %KZ_BSC_HDR (NAME=KZ_BSCS_HDR,STCLASS=SYMREF);
      161    22274        %KZ$BSCSTT (NAME=KZ_RBTSTT,STCLASS="BASED(TPTR$)");
      162    22655        %KZ$BSCSTT (NAME=KZ@RBTSTT,STCLASS=CONSTANT);
      163    23036
      164    23037        %KZ$RBT_E;
      165    23067        %KV_USR_EVT_ID_E;
      166    23087        %KV_VDH_EVT_ID_E;
      167    23093        %KV_BFRRLSDSP_E;
      168    23099        %KZ$SDVCTX (NAME=KZ@SDVCTX,STCLASS=CONSTANT);
      169    23411
      170    23412        /*    Parameter   */
      171    23413        %KZ$EVENT (FPTN=EVENT_FPT,STCLASS="");
      172    23495
      173    23496
      174    23497    1   DCL KZR_THRTL_INIT UBIN CONSTANT SYMDEF INIT(1000);
      175    23498    1   DCL TRN$ PTR CONSTANT INIT(ADDR(KZ_RBT_EBCI));
      176    23499
      177    23500    1   DCL KVV$VDI ENTRY(1) ALTRET;
      178    23501    1   DCL KVV$INT ENTRY(1) ALTRET;
      179    23502    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      180    23503    1   DCL KVB$RLS ENTRY(2) ALTRET;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:44   
      181    23504    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
      182    23505    1   DCL KZD$ACKSIGNON ENTRY(1) ALTRET;
      183    23506    1   DCL KZD$SNDSIGNON ENTRY(1) ALTRET;
      184    23507    1   DCL KZL$BBLK ENTRY(1) ALTRET;
      185    23508    1   DCL KZL$DBLK ENTRY(1) ALTRET;
      186    23509    1   DCL KZR_CNCDSC@ EPTR SYMREF;
      187    23510    1   DCL KHA$RQSLINPRO ENTRY(2);
      188    23511    1   DCL KHA$ERRLOG ENTRY(2) ALTRET;
      189    23512    1   DCL KHI$DISABLE ENTRY(1);
      190    23513    1   DCL KHI$ENABLE ENTRY;
      191    23514    1   DCL KZD$DEVMGR ENTRY(1) ALTRET;
      192    23515    1   DCL KZD$DQ ENTRY(1);
      193    23516
      194    23517
      195    23518        %FPT_WRSYSLOG ( FPTN=WRSYSLOG,
      196    23519                        FCG='KZ',
      197    23520                        MID='R',
      198    23521                        STCLASS=CONSTANT,
      199    23522                        SEV=%G_WRSYSLOG_SEV_LINE_ABORT# );
      200    23617
      201    23618        %FPT_WRSYSLOG ( STCLASS="" );
      202    23713
      203    23714    1   DCL LGNTXT CHAR(80);
      204    23715    1   DCL BSCTXT(0:0) UBIN BYTE BASED(BFR$) CALIGNED;
      205    23716    1   DCL SSTR CHAR(I) BASED(BFR$);
      206    23717    1   DCL Y$CHR CHAR(256) BASED;
      207    23718    1   DCL CHR32 CHAR(32) BASED;
      208    23719
      209    23720
      210    23721
      211    23722    1   DCL LCTX$ PTR;
      212    23723    1   DCL CTX$ PTR;
      213    23724    1   DCL BFR$ PTR;
      214    23725    1   DCL TBFR$ PTR;
      215    23726    1   DCL I UBIN WORD;
      216    23727    1   DCL TPTR$ PTR;
      217    23728    1   DCL LEV UBIN;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:45   
      218    23729    1   DCL SZ UBIN;
      219    23730
      220    23731        /*N*  KLUDGE AREA *** KLUDGE AREA *** KLUDGE AREA *** KLUDGE AREA *** KLUD  *N*/
      221    23732        /*N*  To make some site-specific patches easier, here's where we're         *N*/
      222    23733        /*N*  stashing away some CONSTANT SYMDEF values for HASP/2780/3780.         *N*/
      223    23734        /*N*  These "defaults" should be made into SUPER options on                 *N*/
      224    23735        /*N*  TERM/PROFILE/DEVICE creation commands.                                *N*/
      225    23736    1   DCL KZ_SLCCHR2780PNC BIT(8) ALIGNED SYMREF;
      226    23737    1   DCL KZ_SLCCHR3780PNC1 BIT(8) ALIGNED SYMREF;
      227    23738    1   DCL KZ_SLCCHR3780PNC2 BIT(8) ALIGNED SYMREF;
      228    23739    1   DCL KZ_SLCCHR3780PRN BIT(8) ALIGNED SYMREF;
      229    23740        /*N*  KLUDGE AREA *** KLUDGE AREA *** KLUDGE AREA *** KLUDGE AREA *** KLUD  *N*/
      230    23741        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:46   
      231    23742    1         LCTX$=EVENT_FPT.LINCTX$;

  23742   1 000005  ECC7 0004                            LDB,B6   @EVENT_FPT,AUTO
          1 000007  DCC6 0003                            LDB,B5   3,B6
          1 000009  DFC7 0088                            STB,B5   LCTX$,AUTO

      232    23743    2         DO CASE EVENT_FPT.EVENT;

  23743   1 00000B  B806                                 LDR,R3   ,B6
          1 00000C  3D1A                                 CMV,R3   26
          1 00000D  0281 054D                            BGE      s:24236,PREL
          1 00000F  A830 0000 0015  01                   LDR,R2   s:23743+10,R3
          1 000012  83A0 0000 002F  01                   JMP      s:23753,R2
          1 000015       052C                            DC       s:24236,PREL
          1 000016       0406                            DC       s:24107,PREL
          1 000017       052C                            DC       s:24236,PREL
          1 000018       052C                            DC       s:24236,PREL
          1 000019       0196                            DC       s:23882,PREL
          1 00001A       052C                            DC       s:24236,PREL
          1 00001B       052C                            DC       s:24236,PREL
          1 00001C       052C                            DC       s:24236,PREL
          1 00001D       0000                            DC       s:23753,PREL
          1 00001E       016D                            DC       s:23853,PREL
          1 00001F       052C                            DC       s:24236,PREL
          1 000020       052C                            DC       s:24236,PREL
          1 000021       052C                            DC       s:24236,PREL
          1 000022       052C                            DC       s:24236,PREL
          1 000023       052C                            DC       s:24236,PREL
          1 000024       052C                            DC       s:24236,PREL
          1 000025       052C                            DC       s:24236,PREL
          1 000026       052C                            DC       s:24236,PREL
          1 000027       052C                            DC       s:24236,PREL
          1 000028       052C                            DC       s:24236,PREL
          1 000029       0167                            DC       s:23840,PREL
          1 00002A       0433                            DC       s:24141,PREL
          1 00002B       0433                            DC       s:24141,PREL
          1 00002C       0433                            DC       s:24141,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:47   
          1 00002D       03DC                            DC       s:24089,PREL
          1 00002E       03F1                            DC       s:24103,PREL

      233    23744
      234    23745    2          CASE (%KZ#LINFCN_BLDCTX);

      235    23746
      236    23747        /*D*
      237    23748              When Function-code is KZ#LINFCN_BLDCTX, a device context block
      238    23749              is allocated, initialized, and added to a list of those
      239    23750              maintained in the line context block.
      240    23751
      241    23752                                                                          */
      242    23753    2            IF EVENT_FPT.TERMID$->B$TERMINAL_ID.LEV ~= %TERMINAL_ID_LEV_SUBCHAN# THEN

  23753   1 00002F  CCC6 0005                            LDB,B4   5,B6
          1 000031  E804                                 LDR,R6   ,B4
          1 000032  E570 00FF                            AND,R6   255,IMO
          1 000034  6D02                                 CMV,R6   2
          1 000035  0901 0004                            BE       s:23756,PREL

      243    23754    2               RETURN;

  23754   1 000037  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      244    23755              %DISABLE (DISLVL=LEV,INHLVL=KZ$LINCTX.INHLVL);

  23756   1 00003A  D845 0035                            LDR,R5   53,B5
          1 00003C  DF47 0093                            STR,R5   LEV,AUTO

  23757   1 00003E  CBC7 0093                            LAB,B4   LEV,AUTO
          1 000040  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 000042  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000044  CBF0 0100                            LAB,B4   256,IMO
          1 000046  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 000049       0001                            DC       s:23759,PREL

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:48   
      245    23759    2            SZ = SIZEW(DEVCTX);

  23759   1 00004A  6C3A                                 LDV,R6   58
          1 00004B  EF47 0094                            STR,R6   SZ,AUTO

      246    23760    2            CALL KVB$GETSYS (SZ,CTX$)

  23760   1 00004D  EBC7 008A                            LAB,B6   CTX$,AUTO
          1 00004F  EFC7 00A0                            STB,B6   ENTFLG+4,AUTO
          1 000051  DBC7 0094                            LAB,B5   SZ,AUTO
          1 000053  DFC7 009E                            STB,B5   ENTFLG+2,AUTO
          1 000055  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000057  CBF0 0200                            LAB,B4   512,IMO
          1 000059  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 00005C       0003                            DC       s:23762,PREL
          1 00005D  0F81 0031                            B        s:23782,PREL

      247    23761    2            WHENALTRETURN
      248    23762    3            DO;

      249    23763    3   NO_MEMORY:
      250    23764                   /*    Log "Out of MEMory" error and kill the line.    */
      251    23765    3               FPT_WRSYSLOG=WRSYSLOG;

  23765   1 00005F  AB80 0000 0106  00   NO_MEMORY       LAB,B2   WRSYSLOG
          1 000062  2C00                                 LDV,R2   0
          1 000063  6C2A                                 LDV,R6   42
          1 000064  BBC7 004B                            LAB,B3   FPT_WRSYSLOG,AUTO
          1 000066  3C00                                 LDV,R3   0
          1 000067  0008                                 MMM

      252    23766    3               FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$NOBFR;

  23766   1 000068  E870 0380                            LDR,R6   896,IMO
          1 00006A  EAC7 0052                            SRM,R6,'FFF8'X    FPT_WRSYSLOG+7,AUTO
          1 00006C       FFF8

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:49   
      253    23767    3               FPT_WRSYSLOG.V.TERMID = KZ$LINCTX.LINID;

  23767   1 00006D  ACC7 0088                            LDB,B2   LCTX$,AUTO
          1 00006F  2C08                                 LDV,R2   8
          1 000070  6C10                                 LDV,R6   16
          1 000071  BBC7 0053                            LAB,B3   FPT_WRSYSLOG+8,AUTO
          1 000073  3C00                                 LDV,R3   0
          1 000074  0008                                 MMM

      254    23768    3               FPT_WRSYSLOG.V.VALUES (0) = SZ;

  23768   1 000075  E847 0094                            LDR,R6   SZ,AUTO
          1 000077  EF47 005B                            STR,R6   FPT_WRSYSLOG+16,AUTO

      255    23769    3               CALL KHA$ERRLOG (FPT_WRSYSLOG);

  23769   1 000079  EBC7 004B                            LAB,B6   FPT_WRSYSLOG,AUTO
          1 00007B  EFC7 009E                            STB,B6   ENTFLG+2,AUTO
          1 00007D  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 00007F  CBF0 0100                            LAB,B4   256,IMO
          1 000081  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          1 000084       0001                            DC       s:23779,PREL

      256    23770        /*E*  ERROR:        KZR-E$NOBFR-6
      257    23771              MESSAGE:      Insufficient BISYNC MEMory (a NETCON parameter).
      258    23772              DESCRIPTION:  A KVB call ALTRETed to indicate that BISYNC is out of
      259    23773                            MEMory.  Since a necessary device context
      260    23774                            could not be allocated, the HASP/2780/3780 TERMinal
      261    23775                            associated with the request has been disconnected.
      262    23776                            V0 = Size of buffer, in words, which could not be allocated.
      263    23777        */
      264    23778
      265    23779    3               CALL KZR$KILL_LINE (KZ$LINCTX);

  23779   1 000085  BBC7 0088                            LAB,B3   LCTX$,AUTO
          1 000087  CBF0 0100                            LAB,B4   256,IMO
          1 000089  E3C0 08A6                            LNJ,B6   s:24642,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:50   
          1 00008B       0001                            DC       s:23780,PREL

      266    23780    3               ALTRETURN;

  23780   1 00008C  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      267    23781    3               END;
      268    23782    2            DEVCTX = KZ@SDVCTX;

  23782   1 00008F  AB80 0000 00C9  00                   LAB,B2   KZ@SDVCTX
          1 000092  2C00                                 LDV,R2   0
          1 000093  6C74                                 LDV,R6   116
          1 000094  BCC7 008A                            LDB,B3   CTX$,AUTO
          1 000096  3C00                                 LDV,R3   0
          1 000097  0008                                 MMM

      269    23783    2            EVENT_FPT.CHN$->KH$CHN.TERMID.TTYP = %KLTY_SDEV#;

  23783   1 000098  ECC7 0004                            LDB,B6   @EVENT_FPT,AUTO
          1 00009A  DCC6 0007                            LDB,B5   7,B6
          1 00009C  6C01                                 LDV,R6   1
          1 00009D  E7C5 0012                            STH,R6   18,B5

      270    23784    2            DEVCTX.LCLENDPNTID = EVENT_FPT.TERMID$->B$TERMINAL_ID;

  23784   1 00009F  DCC6 0005                            LDB,B5   5,B6
          1 0000A1  AB85                                 LAB,B2   ,B5
          1 0000A2  2C00                                 LDV,R2   0
          1 0000A3  6C10                                 LDV,R6   16
          1 0000A4  BCC7 008A                            LDB,B3   CTX$,AUTO
          1 0000A6  3C04                                 LDV,R3   4
          1 0000A7  0008                                 MMM

      271    23785    2            DEVCTX.STATE=%KZ_S_SLOGON#;

  23785   1 0000A8  6C01                                 LDV,R6   1
          1 0000A9  CCC7 008A                            LDB,B4   CTX$,AUTO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:51   
          1 0000AB  E7C4 000A                            STH,R6   10,B4

      272    23786    2            DEVCTX.LIN$=LCTX$;

  23786   1 0000AD  CCC7 0088                            LDB,B4   LCTX$,AUTO
          1 0000AF  BCC7 008A                            LDB,B3   CTX$,AUTO
          1 0000B1  CFC3 000D                            STB,B4   13,B3

      273    23787    2            DEVCTX.RCB_CODE=EVENT_FPT.CHNCTX$->KL_HASPDEV.DADR.DEVNUM#;

  23787   1 0000B3  BCC6 0001                            LDB,B3   1,B6
          1 0000B5  D2C3 000C                            LLH,R5   12,B3
          1 0000B7  5008                                 SOL,R5   8
          1 0000B8  5048                                 SOR,R5   8
          1 0000B9  9CC7 008A                            LDB,B1   CTX$,AUTO
          1 0000BB  D7C1 0024                            STH,R5   36,B1

      274    23788    2            DEVCTX.SUSBIT_MASK=EVENT_FPT.CHNCTX$->KL_HASPDEV.DADR.DEVCTL;

  23788   1 0000BD  BCC6 0001                            LDB,B3   1,B6
          1 0000BF  9CC7 008A                            LDB,B1   CTX$,AUTO
          1 0000C1  D843 000D                            LDR,R5   13,B3
          1 0000C3  DF41 0023                            STR,R5   35,B1

      275    23789
      276    23790    3            IF KZ$LINCTX.CTRHD$ ~= ADDR(NIL) THEN DO;

  23790   1 0000C5  8D84                                 CMN      ,B4
          1 0000C6  0901 0014                            BE       s:23798,PREL

      277    23791    3               TPTR$ = KZ$LINCTX.CTRHD$;

  23791   1 0000C8  BC84                                 LDB,B3   ,B4
          1 0000C9  BFC7 0091                            STB,B3   TPTR$,AUTO

      278    23792    4               DO WHILE (TPTR$->DEVCTX.LNK$ ~= ADDR(NIL));

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:52   
  23792   1 0000CB  0F81 0006                            B        s:23794,PREL

      279    23793    4                  TPTR$ = TPTR$->DEVCTX.LNK$;

  23793   1 0000CD  ECC7 0091                            LDB,B6   TPTR$,AUTO
          1 0000CF  DC86                                 LDB,B5   ,B6
          1 0000D0  DFC7 0091                            STB,B5   TPTR$,AUTO

      280    23794    4                  END;

  23794   1 0000D2  ECC7 0091                            LDB,B6   TPTR$,AUTO
          1 0000D4  8D86                                 CMN      ,B6
          1 0000D5  09F8                                 BNE      s:23793,SPREL

      281    23795    3               TPTR$->DEVCTX.LNK$ = CTX$;

  23795   1 0000D6  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 0000D8  DF86                                 STB,B5   ,B6

      282    23796    3               END;

  23796   1 0000D9  0F81 0004                            B        s:23799,PREL

      283    23797    2            ELSE
      284    23798    2               KZ$LINCTX.CTRHD$ = CTX$;

  23798   1 0000DB  BCC7 008A                            LDB,B3   CTX$,AUTO
          1 0000DD  BF84                                 STB,B3   ,B4

      285    23799    2            KZ$LINCTX.POLSIZ = KZ$LINCTX.POLSIZ + 1;

  23799   1 0000DE  ECC7 0088                            LDB,B6   LCTX$,AUTO
          1 0000E0  8AC6 0065                            INC      101,B6

      286    23800    3            IF KZ_RBTVDHSTT$ = ADDR(NIL) THEN DO;

  23800   1 0000E2  8D80 0000 0000  xsym                 CMN      KZ_RBTVDHSTT$
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:53   
          1 0000E5  0981 00A0                            BNE      s:23826,PREL

      287    23801    3               SZ = SIZEW(KV$STT);

  23801   1 0000E7  E870 0230                            LDR,R6   560,IMO
          1 0000E9  EF47 0094                            STR,R6   SZ,AUTO

      288    23802    3               CALL KVB$GETSYS (SZ,KZ_RBTVDHSTT$) ALTRET (NO_MEMORY);

  23802   1 0000EB  DB80 0000 0000  xsym                 LAB,B5   KZ_RBTVDHSTT$
          1 0000EE  DFC7 00A0                            STB,B5   ENTFLG+4,AUTO
          1 0000F0  CBC7 0094                            LAB,B4   SZ,AUTO
          1 0000F2  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 0000F4  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 0000F6  CBF0 0200                            LAB,B4   512,IMO
          1 0000F8  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 0000FB       FF64                            DC       s:23762,PREL

      289    23803    3               KZ_RBTVDHSTT$->KV$STT='0'B;

  23803   1 0000FC  AB80 0000 0000  02                   LAB,B2   0
          1 0000FF  2C00                                 LDV,R2   0
          1 000100  6C01                                 LDV,R6   1
          1 000101  BC80 0000 0000  xsym                 LDB,B3   KZ_RBTVDHSTT$
          1 000104  3C00                                 LDV,R3   0
          1 000105  F870 0460                            LDR,R7   1120,IMO
          1 000107  D380 0000 0000  xent                 LNJ,B5   X6C_ALRZ

      290    23804    3               KZ_RBTVDHSTT$->KV$STT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;

  23804   1 00010A  EC80 0000 0000  xsym                 LDB,B6   KZ_RBTVDHSTT$
          1 00010D  8946 0012                            LBT,'0020'X       18,B6
          1 00010F       0020

      291    23805    3               KZ_RBTVDHSTT$->KV$STT.REQSTATS.SLCENT(%KH#ENTID_RBT)='1'B;

  23805   1 000110  8946 0012                            LBT,'0080'X       18,B6
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:54   
  23805   1 000112       0080

      292    23806    3               SZ = SIZEW(KZ_RBTSTT);

  23806   1 000113  E870 0082                            LDR,R6   130,IMO
          1 000115  EF47 0094                            STR,R6   SZ,AUTO

      293    23807    3               CALL KVB$GETSYS (SZ,TPTR$) ALTRET (NO_MEMORY);

  23807   1 000117  DBC7 0091                            LAB,B5   TPTR$,AUTO
          1 000119  DFC7 00A0                            STB,B5   ENTFLG+4,AUTO
          1 00011B  CBC7 0094                            LAB,B4   SZ,AUTO
          1 00011D  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 00011F  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000121  CBF0 0200                            LAB,B4   512,IMO
          1 000123  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 000126       FF39                            DC       s:23762,PREL

      294    23808    3               KZ_HASP_HDR.STTBFR$=TPTR$;

  23808   1 000127  ECC7 0091                            LDB,B6   TPTR$,AUTO
          1 000129  EF80 0000 0006  xsym                 STB,B6   KZ_HASP_HDR+6

      295    23809    3               KZ_BSC_HDR.STTBFR$=TPTR$;

  23809   1 00012C  EF80 0000 0006  xsym                 STB,B6   KZ_BSC_HDR+6

      296    23810    3               KZ_BSCS_HDR.STTBFR$=TPTR$;

  23810   1 00012F  EF80 0000 0006  xsym                 STB,B6   KZ_BSCS_HDR+6

      297    23811    3               KZ_HASPS_HDR.STTBFR$=TPTR$;

  23811   1 000132  EF80 0000 0006  xsym                 STB,B6   KZ_HASPS_HDR+6

      298    23812    3               KZ_RBTSTT=KZ@RBTSTT;

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:55   
  23812   1 000135  AB80 0000 0047  00                   LAB,B2   KZ@RBTSTT
          1 000138  2C00                                 LDV,R2   0
          1 000139  E870 0104                            LDR,R6   260,IMO
          1 00013B  BB86                                 LAB,B3   ,B6
          1 00013C  3C00                                 LDV,R3   0
          1 00013D  0008                                 MMM

      299    23813    3               KZ_RBTVDHSTT$->KV$STT.REQSTATS.FNC=%IGA_REQSTATS;

  23813   1 00013E  6C24                                 LDV,R6   36
          1 00013F  DC80 0000 0000  xsym                 LDB,B5   KZ_RBTVDHSTT$
          1 000142  E785                                 STH,R6   ,B5

      300    23814    3               KZ_RBTVDHSTT$->KV$STT.REQSTATS.DSPENT(%KH#ENTID_VDH)='1'B;

  23814   1 000143  DC80 0000 0000  xsym                 LDB,B5   KZ_RBTVDHSTT$
          1 000146  8945 0010                            LBT,'0020'X       16,B5
          1 000148       0020

      301    23815    3               KZ_RBTSTT.REQSTATS.DSPENT(%KH#ENTID_RBT)='1'B;

  23815   1 000149  CCC7 0091                            LDB,B4   TPTR$,AUTO
          1 00014B  8944 0010                            LBT,'0080'X       16,B4
          1 00014D       0080

      302    23816    3               KZ_RBTSTT.REQSTATS.SLCENT(%KH#ENTID_RBT)='1'B;

  23816   1 00014E  CCC7 0091                            LDB,B4   TPTR$,AUTO
          1 000150  8944 0012                            LBT,'0080'X       18,B4
          1 000152       0080

      303    23817    3               KZ_RBTSTT.REQSTATS.SLCENT(%KH#ENTID_VDH)='1'B;

  23817   1 000153  CCC7 0091                            LDB,B4   TPTR$,AUTO
          1 000155  8944 0012                            LBT,'0020'X       18,B4
          1 000157       0020

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:56   
      304    23818    3               SZ = SIZEW(KV@USRPRM);

  23818   1 000158  5C39                                 LDV,R5   57
          1 000159  DF47 0094                            STR,R5   SZ,AUTO

      305    23819    3               CALL KVB$GETSYS (SZ,TPTR$) ALTRET (NO_MEMORY);

  23819   1 00015B  CBC7 0091                            LAB,B4   TPTR$,AUTO
          1 00015D  CFC7 00A0                            STB,B4   ENTFLG+4,AUTO
          1 00015F  ABC7 0094                            LAB,B2   SZ,AUTO
          1 000161  AFC7 009E                            STB,B2   ENTFLG+2,AUTO
          1 000163  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000165  CBF0 0200                            LAB,B4   512,IMO
          1 000167  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 00016A       FEF5                            DC       s:23762,PREL

      306    23820    3               KZ_USRPRM$=TPTR$;

  23820   1 00016B  ECC7 0091                            LDB,B6   TPTR$,AUTO
          1 00016D  EF80 0000 0000  xsym                 STB,B6   KZ_USRPRM$

      307    23821    3               KV@USRPRM=KV_USRPRM;

  23821   1 000170  AB80 0000 0000  00                   LAB,B2   KV_USRPRM
          1 000173  2C00                                 LDV,R2   0
          1 000174  6C72                                 LDV,R6   114
          1 000175  BB86                                 LAB,B3   ,B6
          1 000176  3C00                                 LDV,R3   0
          1 000177  0008                                 MMM

      308    23822    3               KV@USRPRM.STT$=KZ_RBTVDHSTT$;

  23822   1 000178  DC80 0000 0000  xsym                 LDB,B5   KZ_RBTVDHSTT$
          1 00017B  CCC7 0091                            LDB,B4   TPTR$,AUTO
          1 00017D  DFC4 0033                            STB,B5   51,B4

      309    23823    3               KV@USRPRM.INHLVL=KZ$LINCTX.INHLVL;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:57   

  23823   1 00017F  CCC7 0091                            LDB,B4   TPTR$,AUTO
          1 000181  ACC7 0088                            LDB,B2   LCTX$,AUTO
          1 000183  E842 0035                            LDR,R6   53,B2
          1 000185  EF04                                 STR,R6   ,B4

      310    23824    3               END;

      311    23825              %ENABLE (DISLVL=LEV,INHLVL=KZ$LINCTX.INHLVL);

  23826   1 000186  ECC7 0088                            LDB,B6   LCTX$,AUTO
          1 000188  E847 0093                            LDR,R6   LEV,AUTO
          1 00018A  E946 0035                            CMR,R6   53,B6
          1 00018C  0901 03CE                            BE       s:24236,PREL

  23828   1 00018E  CBF0 0000                            LAB,B4   0,IMO
          1 000190  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 000193       0001                            DC       s:23829,PREL

  23829   1 000194  0F81 03C6                            B        s:24236,PREL

      312    23831        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:58   
      313    23832    2          CASE (%KZ#LINFCN_CTXCMP);

      314    23833
      315    23834        /*D*
      316    23835              When Function-code is KZ#LINFCN_CTXCMP, all build context calls
      317    23836              have been made for the line.  KZ$LINCTX.POLX is set so that the
      318    23837              EVT_ID_ENDSETPRM code can tell when VDH is finished with its
      319    23838              context building and can report LGNCMP back to KZP$CNCDSC.   */
      320    23839
      321    23840    2            KZ$LINCTX.POLX = 7;

  23840   1 000196  6C07                                 LDV,R6   7
          1 000197  EAC5 006C                            SRM,R6,'00FF'X    108,B5
          1 000199       00FF
          1 00019A  0F81 03C0                            B        s:24236,PREL

      322    23841
      323    23842        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:59   
      324    23843
      325    23844
      326    23845    2          CASE (%KZ#LINFCN_ENABL);

      327    23846
      328    23847        /*D*
      329    23848              When Function_code is KZ#LINFCN_ENABL, Node Admin is telling
      330    23849              us that all information required for the VDH connection has
      331    23850              been received from the host.  VDH is called to connect the
      332    23851              device.
      333    23852                                                                           */
      334    23853    2            CTX$ = KZ$LINCTX.CTRHD$;

  23853   1 00019C  CC85                                 LDB,B4   ,B5
          1 00019D  CFC7 008A                            STB,B4   CTX$,AUTO

      335    23854    3            DO WHILE ( CTX$ ~= ADDR(NIL));

  23854   1 00019F  0F81 001F                            B        s:23861,PREL

      336    23855    3               EVENT_FPT.TERMID$->B$TERMINAL_ID.TTYP = DEVCTX.LCLENDPNTID.TTYP;

  23855   1 0001A1  ECC7 0004                            LDB,B6   @EVENT_FPT,AUTO
          1 0001A3  DCC6 0005                            LDB,B5   5,B6
          1 0001A5  CCC7 008A                            LDB,B4   CTX$,AUTO
          1 0001A7  E2C4 0002                            LLH,R6   2,B4
          1 0001A9  E785                                 STH,R6   ,B5

      337    23856    4               IF DEVCTX.LCLENDPNTID = EVENT_FPT.TERMID$->B$TERMINAL_ID THEN DO;

  23856   1 0001AA  DCC6 0005                            LDB,B5   5,B6
          1 0001AC  CCC7 008A                            LDB,B4   CTX$,AUTO
          1 0001AE  5C10                                 LDV,R5   16
          1 0001AF  0022                                 ACM      ;
          1 0001B0       5004 0002                                ALPHANUM(2,B4,,16,FILL),;
          1 0001B2       4005 0000                                ALPHANUM(0,B5,,R5,FILL)
          1 0001B4  5301 0007                            CBNE     s:23860,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:60   

      338    23857    4                  CALL TELLVDH ALTRET(ALT_RET);

  23857   1 0001B6  E3C0 064B                            LNJ,B6   s:0,PREL
          1 0001B8       01C9                            DC       s:24039,PREL

      339    23858    4                  RETURN;

  23858   1 0001B9  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      340    23859    4                  END;
      341    23860    3               CTX$=DEVCTX.LNK$;

  23860   1 0001BC  BC84                                 LDB,B3   ,B4
          1 0001BD  BFC7 008A                            STB,B3   CTX$,AUTO

      342    23861    3               END;

  23861   1 0001BF  8DC7 008A                            CMN      CTX$,AUTO
          1 0001C1  09E0                                 BNE      s:23855,SPREL

      343    23862    2            ALTRETURN;

  23862   1 0001C2  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      344    23863
      345    23864        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:61   
      346    23865
      347    23866    2          CASE (%KZ#LINFCN_INP);

      348    23867
      349    23868        /*D*
      350    23869              When Function-code is KZ#LINFCN_INP, an input block is available
      351    23870              for processing.  There are two cases here depending if it is
      352    23871              or is not a HASP device.  If it is not HASP and there has not
      353    23872              been a signon, the signon string in the input buffer is passed
      354    23873              along to KHA$RQSLINPRO to get things initialized for this
      355    23874              device.  If a signon has been received the state of the first
      356    23875              input device on this line is examined.  If the device is OPEN
      357    23876              or AWAITING_CLOSE, KZL$DBLK is called to process the input.
      358    23877
      359    23878              If this is a HASP line some HASP block sequence checking is done
      360    23879              and then the same sort of signon and input processing described
      361    23880              above is done.
      362    23881                                                                           */
      363    23882    2            BFR$=KZ$LINCTX.INPBFR$;

  23882   1 0001C5  CCC5 0056                            LDB,B4   86,B5
          1 0001C7  CFC7 008C                            STB,B4   BFR$,AUTO

      364    23883    2            IF KZ$LINCTX.PRO.PROTYP ~= %KLPT_HASP#

  23883   1 0001C9  E845 003A                            LDR,R6   58,B5
          1 0001CB  6D03                                 CMV,R6   3
          1 0001CC  0901 004F                            BE       s:23918,PREL
          1 0001CE  6D07                                 CMV,R6   7
          1 0001CF  0901 004C                            BE       s:23918,PREL

      365    23884    3               AND KZ$LINCTX.PRO.PROTYP ~= %KLPT_NJE# THEN DO;

      366    23885
      367    23886                         /*    2780/3780                                  */
      368    23887
      369    23888    4               IF NOT KZ$LINCTX.FLAGS.SIGNON THEN DO;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:62   

  23888   1 0001D1  82C5 0034                            LB,'0040'X        52,B5
  23888   1 0001D3       0040
          1 0001D4  0501 0040                            BBT      s:23910,PREL

      370    23889    4                  KZ$LINCTX.FLAGS.SIGNON = '1'B;

  23889   1 0001D6  8945 0034                            LBT,'0040'X       52,B5
  23889   1 0001D8       0040

      371    23890    4                  I = 0;

  23890   1 0001D9  8747 0090                            CL       I,AUTO

      372    23891    5                  DO WHILE ( I < 80 AND I < KZ$LINCTX.INPDATSIZ AND

  23891   1 0001DB  0F81 0003                            B        s:23897,PREL

      373    23892    5                     ( BSCTXT(I) ~= BITBIN('03'X) AND
      374    23893    5                     BSCTXT(I) ~= BITBIN('26'X) AND
      375    23894    5                     BSCTXT(I) ~= BITBIN('1D'X) AND
      376    23895    5                    BSCTXT(I) ~= BITBIN(KZ$LINCTX.PRO.IRSCHR /* Default '1E'X */) ) );
      377    23896    5                     I = I + 1;

  23896   1 0001DD  8AC7 0090                            INC      I,AUTO

      378    23897    5                     END;

  23897   1 0001DF  E847 0090                            LDR,R6   I,AUTO
          1 0001E1  6D50                                 CMV,R6   80
          1 0001E2  0281 001A                            BGE      s:23904,PREL
          1 0001E4  ECC7 0088                            LDB,B6   LCTX$,AUTO
          1 0001E6  E946 0059                            CMR,R6   89,B6
          1 0001E8  0281 0014                            BGE      s:23904,PREL
          1 0001EA  DCC7 008C                            LDB,B5   BFR$,AUTO
          1 0001EC  B856                                 LDR,R3   R6
          1 0001ED  D2B5                                 LLH,R5   ,B5,R3
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:63   
          1 0001EE  5D03                                 CMV,R5   3
          1 0001EF  0901 000D                            BE       s:23904,PREL
          1 0001F1  5D26                                 CMV,R5   38
          1 0001F2  0901 000A                            BE       s:23904,PREL
          1 0001F4  5D1D                                 CMV,R5   29
          1 0001F5  0901 0007                            BE       s:23904,PREL
          1 0001F7  C846 0042                            LDR,R4   66,B6
          1 0001F9  C570 00FF                            AND,R4   255,IMO
          1 0001FB  D954                                 CMR,R5   R4
          1 0001FC  09E1                                 BNE      s:23896,SPREL

      379    23898                       %KV$TRNINP (INPBFR=SSTR,OTPBFR="SUBSTR(LGNTXT,0,I)",
      380    23899                          TRNTBL$="ADDR(KZ_RBT_EBCI)");
             23904    4   CALL XLATE(SUBSTR(LGNTXT,0,I), ADDR(KZ_RBT_EBCI)->KV$TRNTBL.INPTRN1$->Y$CHR, SSTR);

  23904   1 0001FD  B800 0000 0001  02                   LDR,R3   +1
          1 000200  EBB0 0000 0000  01                   LAB,B6   s:53,R3
          1 000203  ACC7 008C                            LDB,B2   BFR$,AUTO
          1 000205  2C00                                 LDV,R2   0
          1 000206  BBC7 0060                            LAB,B3   LGNTXT,AUTO
          1 000208  3C00                                 LDV,R3   0
          1 000209  F856                                 LDR,R7   R6
          1 00020A  9C80 0000 0008  xsym                 LDB,B1   KZ_RBT_EBCI+8
          1 00020D  1C00                                 LDV,R1   0
          1 00020E  D870 00FF                            LDR,R5   255,IMO
          1 000210  D380 0000 0000  xent                 LNJ,B5   X6C_MAT

      381    23906
      382    23907    4                  GOTO LIN_ACK;

  23907   1 000213  0F81 0140                            B        s:24028,PREL

      383    23908    4                  END;
      384    23909    3               ELSE
      385    23910    3                  IF KZ$LINCTX.PTHSTT = %KZ#CLM_STATE_VAMOOSE THEN

  23910   1 000215  D845 000D                            LDR,R5   13,B5
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:64   
          1 000217  5D0A                                 CMV,R5   10
          1 000218  0901 01E8                            BE       s:24072,PREL

      386    23911    3                     GOTO DBLK_INP;
      387    23912    3                  ELSE
      388    23913    3                     GOTO ALT_RET;

  23913   1 00021A  0F81 0166                            B        s:24039,PREL

      389    23914    3               END;
      390    23915        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:65   
      391    23916                                                /*   HASP                             */
      392    23917
      393    23918    3            IF KZ$LINCTX.INPDATSIZ = 0 THEN DO;

  23918   1 00021C  D845 0059                            LDR,R5   89,B5
          1 00021E  5981 0007                            BNEZ,R5  s:23922,PREL

      394    23919    3               KZ$LINCTX.FLAGS.RCVWAB = '0'B;

  23919   1 000220  8845 0034                            LBF,'0800'X       52,B5
  23919   1 000222       0800

      395    23920    3               RETURN;

  23920   1 000223  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      396    23921    3               END;
      397    23922    2            KZ$LINCTX.FLAGS.RCVWAB = HSPBLK.FCS.WAB;

  23922   1 000226  C804                                 LDR,R4   ,B4
          1 000227  4005                                 SOL,R4   5
          1 000228  CAC5 0034                            SRM,R4,'0800'X    52,B5
          1 00022A       0800

      398    23923    2            KZ$LINCTX.RCVFCS = HSPBLK.FCS;

  23923   1 00022B  ACC7 008C                            LDB,B2   BFR$,AUTO
          1 00022D  2C01                                 LDV,R2   1
          1 00022E  6C02                                 LDV,R6   2
          1 00022F  BB85                                 LAB,B3   ,B5
          1 000230  3C6C                                 LDV,R3   108
          1 000231  0008                                 MMM

      399    23924
      400    23925
      401    23926
      402    23927    3            DO CASE ( HSPBLK.BCB.CTL ); /* Perform BCB validation             */
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:66   

  23927   1 000232  CCC7 008C                            LDB,B4   BFR$,AUTO
          1 000234  B804                                 LDR,R3   ,B4
          1 000235  304C                                 SOR,R3   12
          1 000236  B570 0007                            AND,R3   7,IMO
          1 000238  3D03                                 CMV,R3   3
          1 000239  0281 00A8                            BGE      s:23992,PREL
          1 00023B  A830 0000 0241  01                   LDR,R2   s:23927+15,R3
          1 00023E  83A0 0000 0244  01                   JMP      s:23931,R2
          1 000241       0000                            DC       s:23931,PREL
          1 000242       009E                            DC       s:23992,PREL
          1 000243       0090                            DC       s:23986,PREL

      403    23928    3             CASE (0);

      404    23929                                      /* Normal block, check for normal sequencing    */
      405    23930
      406    23931    3               IF HSPBLK.BCB.CNT = MOD(KZ$LINCTX.BCB.RCV+1,16) THEN

  23931   1 000244  ACC7 0088                            LDB,B2   LCTX$,AUTO
          1 000246  E2C2 004D                            LLH,R6   77,B2
          1 000248  6E01                                 ADV,R6   1
          1 000249  E570 000F                            AND,R6   15,IMO
          1 00024B  D804                                 LDR,R5   ,B4
          1 00024C  5048                                 SOR,R5   8
          1 00024D  D570 000F                            AND,R5   15,IMO
          1 00024F  D956                                 CMR,R5   R6
          1 000250  0981 0005                            BNE      s:23934,PREL

      407    23932    3                  KZ$LINCTX.BCB.RCV = HSPBLK.BCB.CNT;

  23932   1 000252  D7C2 004D                            STH,R5   77,B2
          1 000254  0F81 008D                            B        s:23992,PREL

      408    23933    4               ELSE DO;

      409    23934    5                  IF HSPBLK.BCB.CNT = MOD(KZ$LINCTX.BCB.RCV,16) THEN DO;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:67   

  23934   1 000256  E2C2 004D                            LLH,R6   77,B2
          1 000258  E570 000F                            AND,R6   15,IMO
          1 00025A  D956                                 CMR,R5   R6
          1 00025B  0981 003B                            BNE      s:23963,PREL

      410    23935
      411    23936                                 /* Repeats prior block ... error log and ignore it   */
      412    23937
      413    23938    5                     FPT_WRSYSLOG=WRSYSLOG;

  23938   1 00025D  AB80 0000 0106  00                   LAB,B2   WRSYSLOG
          1 000260  2C00                                 LDV,R2   0
          1 000261  6C2A                                 LDV,R6   42
          1 000262  BBC7 004B                            LAB,B3   FPT_WRSYSLOG,AUTO
          1 000264  3C00                                 LDV,R3   0
          1 000265  0008                                 MMM

      414    23939    5                     FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;

  23939   1 000266  ACC7 0088                            LDB,B2   LCTX$,AUTO
          1 000268  2C08                                 LDV,R2   8
          1 000269  6C10                                 LDV,R6   16
          1 00026A  BBC7 0053                            LAB,B3   FPT_WRSYSLOG+8,AUTO
          1 00026C  3C00                                 LDV,R3   0
          1 00026D  0008                                 MMM

      415    23940    5                     FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$DUPBLK;

  23940   1 00026E  E870 0368                            LDR,R6   872,IMO
          1 000270  EAC7 0052                            SRM,R6,'FFF8'X    FPT_WRSYSLOG+7,AUTO
          1 000272       FFF8

      416    23941    5                     FPT_WRSYSLOG.BUF_ = VECTOR(KZ$LINCTX.INPBFR$->CHR32);

  23941   1 000273  CCC7 0088                            LDB,B4   LCTX$,AUTO
          1 000275  BCC4 0056                            LDB,B3   86,B4
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:68   
          1 000277  BFC7 009F                            STB,B3   ENTFLG+3,AUTO
          1 000279  5C1F                                 LDV,R5   31
          1 00027A  DF47 009E                            STR,R5   ENTFLG+2,AUTO
          1 00027C  ABC7 009E                            LAB,B2   ENTFLG+2,AUTO
          1 00027E  2C00                                 LDV,R2   0
          1 00027F  6C06                                 LDV,R6   6
          1 000280  BBC7 004E                            LAB,B3   FPT_WRSYSLOG+3,AUTO
          1 000282  3C00                                 LDV,R3   0
          1 000283  0008                                 MMM

      417    23942    5                     ADDR(FPT_WRSYSLOG.V.VALUES(0))->ERRCTX.LCTX$ = ADDR(KZ$LINCTX);

  23942   1 000284  CCC7 0088                            LDB,B4   LCTX$,AUTO
          1 000286  CFC7 005B                            STB,B4   FPT_WRSYSLOG+16,AUTO

      418    23943    5                     CALL KHA$ERRLOG (FPT_WRSYSLOG);

  23943   1 000288  BBC7 004B                            LAB,B3   FPT_WRSYSLOG,AUTO
          1 00028A  BFC7 009E                            STB,B3   ENTFLG+2,AUTO
          1 00028C  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 00028E  CBF0 0100                            LAB,B4   256,IMO
          1 000290  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          1 000293       0001                            DC       s:23956,PREL

      419    23944
      420    23945
      421    23946        /*E* ERROR:        KZR-E$DUPBLK-4
      422    23947             MESSAGE:      HASP duplicate block received and ignored.
      423    23948             DESCRIPTION:  A received HASP block contained a block sequence that
      424    23949                           was the same as the previous block sequence received.
      425    23950                           The block was assumed to be a duplicate of the previous
      426    23951                           block and was ignored.
      427    23952                           V0/V1 = Line context pointer.
      428    23953                           DATA = First 32 characters of the input block.
      429    23954        */
      430    23955
      431    23956    5                     RETURN;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:69   

  23956   1 000294  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      432    23957
      433    23958    5                     END;
      434    23959    5                  ELSE DO;

      435    23960
      436    23961                                                /* Sequence error. Disconnect         */
      437    23962
      438    23963    5                     FPT_WRSYSLOG=WRSYSLOG;

  23963   1 000297  AB80 0000 0106  00                   LAB,B2   WRSYSLOG
          1 00029A  2C00                                 LDV,R2   0
          1 00029B  6C2A                                 LDV,R6   42
          1 00029C  BBC7 004B                            LAB,B3   FPT_WRSYSLOG,AUTO
          1 00029E  3C00                                 LDV,R3   0
          1 00029F  0008                                 MMM

      439    23964    5                     FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;

  23964   1 0002A0  ACC7 0088                            LDB,B2   LCTX$,AUTO
          1 0002A2  2C08                                 LDV,R2   8
          1 0002A3  6C10                                 LDV,R6   16
          1 0002A4  BBC7 0053                            LAB,B3   FPT_WRSYSLOG+8,AUTO
          1 0002A6  3C00                                 LDV,R3   0
          1 0002A7  0008                                 MMM

      440    23965    5                     FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$BLKSEQERR;

  23965   1 0002A8  E870 0370                            LDR,R6   880,IMO
          1 0002AA  EAC7 0052                            SRM,R6,'FFF8'X    FPT_WRSYSLOG+7,AUTO
          1 0002AC       FFF8

      441    23966    5                     FPT_WRSYSLOG.BUF_ = VECTOR(KZ$LINCTX.INPBFR$->CHR32);

  23966   1 0002AD  CCC7 0088                            LDB,B4   LCTX$,AUTO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:70   
          1 0002AF  BCC4 0056                            LDB,B3   86,B4
          1 0002B1  BFC7 009F                            STB,B3   ENTFLG+3,AUTO
          1 0002B3  5C1F                                 LDV,R5   31
          1 0002B4  DF47 009E                            STR,R5   ENTFLG+2,AUTO
          1 0002B6  ABC7 009E                            LAB,B2   ENTFLG+2,AUTO
          1 0002B8  2C00                                 LDV,R2   0
          1 0002B9  6C06                                 LDV,R6   6
          1 0002BA  BBC7 004E                            LAB,B3   FPT_WRSYSLOG+3,AUTO
          1 0002BC  3C00                                 LDV,R3   0
          1 0002BD  0008                                 MMM

      442    23967    5                     ADDR(FPT_WRSYSLOG.V.VALUES(0))->ERRCTX.LCTX$ = ADDR(KZ$LINCTX);

  23967   1 0002BE  CCC7 0088                            LDB,B4   LCTX$,AUTO
          1 0002C0  CFC7 005B                            STB,B4   FPT_WRSYSLOG+16,AUTO

      443    23968    5                     CALL KHA$ERRLOG (FPT_WRSYSLOG);

  23968   1 0002C2  BBC7 004B                            LAB,B3   FPT_WRSYSLOG,AUTO
          1 0002C4  BFC7 009E                            STB,B3   ENTFLG+2,AUTO
          1 0002C6  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 0002C8  CBF0 0100                            LAB,B4   256,IMO
          1 0002CA  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          1 0002CD       0001                            DC       s:23978,PREL

      444    23969
      445    23970
      446    23971        /*E* ERROR:        KZR-E$BLKSEQERR-6
      447    23972             MESSAGE:      HASP block sequence error.
      448    23973             DESCRIPTION:  A sequence error in the received HASP block
      449    23974                           was detected.  A line disconnect resulted.
      450    23975                           V0/V1 = Line context pointer.
      451    23976                           DATA = First 32 characters of the input block.
      452    23977        */
      453    23978    5                     CALL KILL_LINE;

  23978   1 0002CE  E3C0 0670                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:71   
          1 0002D0       0001                            DC       s:23979,PREL

      454    23979    5                     RETURN;

  23979   1 0002D1  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      455    23980    5                     END;
      456    23981    4                  END;
      457    23982    3             CASE (1);                  /* Ignore sequencing                  */

      458    23983
      459    23984    3             CASE (2);                  /* Set expected sequencing count      */

      460    23985
      461    23986    3               KZ$LINCTX.BCB.RCV = MOD(HSPBLK.BCB.CNT-1,16);

  23986   1 0002D4  F804                                 LDR,R7   ,B4
          1 0002D5  7048                                 SOR,R7   8
          1 0002D6  F570 000F                            AND,R7   15,IMO
          1 0002D8  6C00                                 LDV,R6   0
          1 0002D9  8470 FFFF FFFF                       AID      -1,IMO
          1 0002DC  F370 0010                            DIV,R7   16,IMO
          1 0002DE  ACC7 0088                            LDB,B2   LCTX$,AUTO
          1 0002E0  E7C2 004D                            STH,R6   77,B2

      462    23987
      463    23988    3             END;

      464    23989
      465    23990
      466    23991
      467    23992    3            IF NOT KZ$LINCTX.FLAGS.SIGNON THEN DO;

  23992   1 0002E2  CCC7 0088                            LDB,B4   LCTX$,AUTO
          1 0002E4  82C4 0034                            LB,'0040'X        52,B4
          1 0002E6       0040
          1 0002E7  0501 00D3                            BBT      s:24059,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:72   

      468    23993                 /* Not yet signed on:  this should be a SIGNON string.
      469    23994                    Note that we're operating under the KZ_INIT_C table here,
      470    23995                    and so think we're KLPT_HASP#, even though we may really be
      471    23996                    KLPT_NJE#.  We'll have to use the RCB/SRCB of the input block
      472    23997                    to decide which one we are. */
      473    23998    3               IF HSPBLK.FLG = 'F0C1'X /* HASP */

  23998   1 0002E9  ACC7 008C                            LDB,B2   BFR$,AUTO
          1 0002EB  5C02                                 LDV,R5   2
          1 0002EC  0021                                 ALR      ;
          1 0002ED       C202 0001                                ALPHANUM(1,B2,1,2),;
          1 0002EF       4007 009E                                ALPHANUM(ENTFLG+2,AUTO,,R5,FILL)
          1 0002F1  437F                                 CSYNC    s:23998+7,SPREL
          1 0002F2  E847 009E                            LDR,R6   ENTFLG+2,AUTO
          1 0002F4  E970 F0C1                            CMR,R6   -3903,IMO
          1 0002F6  0901 000D                            BE       s:24000,PREL
          1 0002F8  0021                                 ALR      ;
          1 0002F9       C202 0001                                ALPHANUM(1,B2,1,2),;
          1 0002FB       4007 009F                                ALPHANUM(ENTFLG+3,AUTO,,R5,FILL)
          1 0002FD  437F                                 CSYNC    s:23998+19,SPREL
          1 0002FE  C847 009F                            LDR,R4   ENTFLG+3,AUTO
          1 000300  C970 F0C9                            CMR,R4   -3895,IMO
          1 000302  0981 0081                            BNE      s:24042,PREL

      474    23999    4                  OR HSPBLK.FLG = 'F0C9'X /* NJE */ THEN DO;

      475    24000    4                  KZ$LINCTX.FLAGS.SIGNON = '1'B;

  24000   1 000304  8944 0034                            LBT,'0040'X       52,B4
  24000   1 000306       0040

      476    24001    5                  IF HSPBLK.FLG = 'F0C1'X /* HASP */ THEN DO;

  24001   1 000307  ACC7 008C                            LDB,B2   BFR$,AUTO
          1 000309  0021                                 ALR      ;
          1 00030A       C202 0001                                ALPHANUM(1,B2,1,2),;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:73   
          1 00030C       4007 009E                                ALPHANUM(ENTFLG+2,AUTO,,R5,FILL)
          1 00030E  437F                                 CSYNC    s:24001+6,SPREL
          1 00030F  E847 009E                            LDR,R6   ENTFLG+2,AUTO
          1 000311  E970 F0C1                            CMR,R6   -3903,IMO
          1 000313  0981 0030                            BNE      s:24018,PREL

      477    24002    5                     I = 0;

  24002   1 000315  8747 0090                            CL       I,AUTO

      478    24003    6                     DO WHILE  I < 80 AND I < KZ$LINCTX.INPDATSIZ AND

  24003   1 000317  0F81 0003                            B        s:24006,PREL

      479    24004    6                        HSPBLK.TXT(I) ~= 0;
      480    24005    6                        I = I + 1;

  24005   1 000319  8AC7 0090                            INC      I,AUTO

      481    24006    6                        END;

  24006   1 00031B  E847 0090                            LDR,R6   I,AUTO
          1 00031D  6D50                                 CMV,R6   80
          1 00031E  0281 000D                            BGE      s:24014,PREL
          1 000320  ECC7 0088                            LDB,B6   LCTX$,AUTO
          1 000322  E946 0059                            CMR,R6   89,B6
          1 000324  0281 0007                            BGE      s:24014,PREL
          1 000326  DCC7 008C                            LDB,B5   BFR$,AUTO
          1 000328  B856                                 LDR,R3   R6
          1 000329  3E05                                 ADV,R3   5
          1 00032A  D2B5                                 LLH,R5   ,B5,R3
          1 00032B  59EE                                 BNEZ,R5  s:24005,SPREL

      482    24007                          %KV$TRNINP (INPBFR="ADDR(HSPBLK.TXT)->SSTR",
      483    24008                                      OTPBFR="SUBSTR(LGNTXT,0,I)",
      484    24009                                      TRNTBL$="ADDR(KZ_RBT_EBCI)");
             24014    5   CALL XLATE(SUBSTR(LGNTXT,0,I), ADDR(KZ_RBT_EBCI)->KV$TRNTBL.INPTRN1$->Y$CHR, ADDR(
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:74   
             24014            HSPBLK.TXT)->SSTR);

  24014   1 00032C  B800 0000 0002  02                   LDR,R3   +2
          1 00032F  EBB0 0000 0000  01                   LAB,B6   s:53,R3
          1 000332  ACC7 008C                            LDB,B2   BFR$,AUTO
          1 000334  2C05                                 LDV,R2   5
          1 000335  BBC7 0060                            LAB,B3   LGNTXT,AUTO
          1 000337  3C00                                 LDV,R3   0
          1 000338  F856                                 LDR,R7   R6
          1 000339  9C80 0000 0008  xsym                 LDB,B1   KZ_RBT_EBCI+8
          1 00033C  1C00                                 LDV,R1   0
          1 00033D  D870 00FF                            LDR,R5   255,IMO
          1 00033F  D380 0000 0000  xent                 LNJ,B5   X6C_MAT

      485    24016    5                     END;

  24016   1 000342  0F81 0011                            B        s:24028,PREL

      486    24017    5                  ELSE DO;

      487    24018    5                     I = LENGTHC(KZ$NJE_SIGNON.NCC.INODE);

  24018   1 000344  4C08                                 LDV,R4   8
          1 000345  CF47 0090                            STR,R4   I,AUTO

      488    24019                          %KV$TRNINP (INPBFR="KZ$NJE_SIGNON.NCC.INODE",
      489    24020                                      OTPBFR="SUBSTR(LGNTXT,0,I)",
      490    24021                                      TRNTBL$="ADDR(KZ_RBT_EBCI)");
             24026    5   CALL XLATE(SUBSTR(LGNTXT,0,I), ADDR(KZ_RBT_EBCI)->KV$TRNTBL.INPTRN1$->Y$CHR,
             24026            KZ$NJE_SIGNON.NCC.INODE);

  24026   1 000347  D854                                 LDR,R5   R4
          1 000348  9C80 0000 0008  xsym                 LDB,B1   KZ_RBT_EBCI+8
          1 00034B  E870 00FF                            LDR,R6   255,IMO
          1 00034D  0023                                 MAT      ;
          1 00034E       4802 0003                                ALPHANUM(3,B2,,8),;
          1 000350       4007 0060                                ALPHANUM(LGNTXT,AUTO,,R5,FILL),;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:75   
          1 000352       4001 0000                                ALPHANUM(0,B1,,256)

      491    24028    5                     END;

      492    24029
      493    24030                    /* Request CLM to get profiles.  Altreturn to indicate
      494    24031                       this was a signon string.                           */
      495    24032    4   LIN_ACK:
      496    24033    4                  KZ_EVENT=CNCDSC_EVENT;

  24033   1 000354  AB80 0000 0000  00   LIN_ACK         LAB,B2   KV_USRPRM
          1 000357  437F                                 CSYNC    s:24028+2,SPREL
          1 000358  2C72                                 LDV,R2   114
          1 000359  6C1C                                 LDV,R6   28
          1 00035A  BB87                                 LAB,B3   ,AUTO
          1 00035B  3C6A                                 LDV,R3   106
          1 00035C  0008                                 MMM

      497    24034    4                  KZ_EVENT.EVENT=%KZ#CLM_EVENT_RQSLPR;

  24034   1 00035D  6C01                                 LDV,R6   1
          1 00035E  EF47 0035                            STR,R6   KZ_EVENT,AUTO

      498    24035    4                  KZ_EVENT.LGNVEC=VECTOR(ADDR(LGNTXT)->SSTR);

  24035   1 000360  EBC7 0060                            LAB,B6   LGNTXT,AUTO
          1 000362  EFC7 009F                            STB,B6   ENTFLG+3,AUTO
          1 000364  D847 0090                            LDR,R5   I,AUTO
          1 000366  5EFF                                 ADV,R5   -1
          1 000367  DF47 009E                            STR,R5   ENTFLG+2,AUTO
          1 000369  ABC7 009E                            LAB,B2   ENTFLG+2,AUTO
          1 00036B  2C00                                 LDV,R2   0
          1 00036C  6C06                                 LDV,R6   6
          1 00036D  BB87                                 LAB,B3   ,AUTO
          1 00036E  3C7C                                 LDV,R3   124
          1 00036F  0008                                 MMM

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:76   
      499    24036    4                  KZ_EVENT.LINCTX$=LCTX$;

  24036   1 000370  ECC7 0088                            LDB,B6   LCTX$,AUTO
          1 000372  EFC7 0038                            STB,B6   KZ_EVENT+3,AUTO

      500    24037    4                  CALL KZR_CNCDSC@ (KZ_EVENT);

  24037   1 000374  DBC7 0035                            LAB,B5   KZ_EVENT,AUTO
          1 000376  DFC7 009E                            STB,B5   ENTFLG+2,AUTO
          1 000378  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 00037A  9C80 0000 0000  xsym                 LDB,B1   KZR_CNCDSC@
          1 00037D  CBF0 0100                            LAB,B4   256,IMO
          1 00037F  E381                                 LNJ,B6   ,B1
          1 000380       0001                            DC       s:24039,PREL

      501    24038    4   ALT_RET:
      502    24039    4                  ALTRETURN;

  24039   1 000381  C380 0000 0000  xent ALT_RET         LNJ,B4   X6A_AALT

      503    24040    4                  END;
      504    24041    4               ELSE DO;

      505    24042    4                  FPT_WRSYSLOG=WRSYSLOG;

  24042   1 000384  AB80 0000 0106  00                   LAB,B2   WRSYSLOG
          1 000387  2C00                                 LDV,R2   0
          1 000388  6C2A                                 LDV,R6   42
          1 000389  BBC7 004B                            LAB,B3   FPT_WRSYSLOG,AUTO
          1 00038B  3C00                                 LDV,R3   0
          1 00038C  0008                                 MMM

      506    24043    4                  FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;

  24043   1 00038D  ACC7 0088                            LDB,B2   LCTX$,AUTO
          1 00038F  2C08                                 LDV,R2   8
          1 000390  6C10                                 LDV,R6   16
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:77   
          1 000391  BBC7 0053                            LAB,B3   FPT_WRSYSLOG+8,AUTO
          1 000393  3C00                                 LDV,R3   0
          1 000394  0008                                 MMM

      507    24044    4                  FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$LINLGNREJ;

  24044   1 000395  6C10                                 LDV,R6   16
          1 000396  EAC7 0052                            SRM,R6,'FFF8'X    FPT_WRSYSLOG+7,AUTO
          1 000398       FFF8

      508    24045    4                  FPT_WRSYSLOG.BUF_ = VECTOR(KZ$LINCTX.INPBFR$->CHR32);

  24045   1 000399  CCC7 0088                            LDB,B4   LCTX$,AUTO
          1 00039B  BCC4 0056                            LDB,B3   86,B4
          1 00039D  BFC7 009F                            STB,B3   ENTFLG+3,AUTO
          1 00039F  4C1F                                 LDV,R4   31
          1 0003A0  CF47 009E                            STR,R4   ENTFLG+2,AUTO
          1 0003A2  ABC7 009E                            LAB,B2   ENTFLG+2,AUTO
          1 0003A4  2C00                                 LDV,R2   0
          1 0003A5  6C06                                 LDV,R6   6
          1 0003A6  BBC7 004E                            LAB,B3   FPT_WRSYSLOG+3,AUTO
          1 0003A8  3C00                                 LDV,R3   0
          1 0003A9  0008                                 MMM

      509    24046    4                  CALL KHA$ERRLOG (FPT_WRSYSLOG);

  24046   1 0003AA  CBC7 004B                            LAB,B4   FPT_WRSYSLOG,AUTO
          1 0003AC  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 0003AE  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 0003B0  CBF0 0100                            LAB,B4   256,IMO
          1 0003B2  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          1 0003B5       0001                            DC       s:24055,PREL

      510    24047
      511    24048
      512    24049        /*E* ERROR:        KZR-E$LINLGNREJ-6
      513    24050             MESSAGE:      Missing required SIGNON record.
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:78   
      514    24051             DESCRIPTION:  The first record received on a HASP line
      515    24052                           was not a SIGNON control record.
      516    24053                           DATA = First 32 characters of the input block.
      517    24054        */
      518    24055    4                  CALL KILL_LINE;

  24055   1 0003B6  E3C0 0588                            LNJ,B6   s:0,PREL
          1 0003B8       0001                            DC       s:24057,PREL

      519    24056    4                  END;

      520    24057    3               END;

  24057   1 0003B9  0F81 01A1                            B        s:24236,PREL

      521    24058    2            ELSE
      522    24059    2               IF KZ$LINCTX.PRO.PROTYP = %KLPT_NJE#

  24059   1 0003BB  E844 003A                            LDR,R6   58,B4
          1 0003BD  6D07                                 CMV,R6   7
          1 0003BE  0981 0042                            BNE      s:24072,PREL
          1 0003C0  ACC7 008C                            LDB,B2   BFR$,AUTO
          1 0003C2  5C02                                 LDV,R5   2
          1 0003C3  0021                                 ALR      ;
          1 0003C4       C202 0001                                ALPHANUM(1,B2,1,2),;
          1 0003C6       4007 009E                                ALPHANUM(ENTFLG+2,AUTO,,R5,FILL)
          1 0003C8  437F                                 CSYNC    s:24059+12,SPREL
          1 0003C9  E847 009E                            LDR,R6   ENTFLG+2,AUTO
          1 0003CB  E970 F0D1                            CMR,R6   -3887,IMO
          1 0003CD  0901 0031                            BE       s:24071,PREL
          1 0003CF  0021                                 ALR      ;
          1 0003D0       C202 0001                                ALPHANUM(1,B2,1,2),;
          1 0003D2       4007 009F                                ALPHANUM(ENTFLG+3,AUTO,,R5,FILL)
          1 0003D4  437F                                 CSYNC    s:24059+24,SPREL
          1 0003D5  C847 009F                            LDR,R4   ENTFLG+3,AUTO
          1 0003D7  C970 F0D2                            CMR,R4   -3886,IMO
          1 0003D9  0901 0025                            BE       s:24071,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:79   
          1 0003DB  0021                                 ALR      ;
          1 0003DC       C202 0001                                ALPHANUM(1,B2,1,2),;
          1 0003DE       4007 00A0                                ALPHANUM(ENTFLG+4,AUTO,,R5,FILL)
          1 0003E0  437F                                 CSYNC    s:24059+36,SPREL
          1 0003E1  B847 00A0                            LDR,R3   ENTFLG+4,AUTO
          1 0003E3  B970 F0D3                            CMR,R3   -3885,IMO
          1 0003E5  0901 0019                            BE       s:24071,PREL
          1 0003E7  0021                                 ALR      ;
          1 0003E8       C202 0001                                ALPHANUM(1,B2,1,2),;
          1 0003EA       4007 00A1                                ALPHANUM(ENTFLG+5,AUTO,,R5,FILL)
          1 0003EC  437F                                 CSYNC    s:24059+48,SPREL
          1 0003ED  A847 00A1                            LDR,R2   ENTFLG+5,AUTO
          1 0003EF  A970 F0D4                            CMR,R2   -3884,IMO
          1 0003F1  0901 000D                            BE       s:24071,PREL
          1 0003F3  0021                                 ALR      ;
          1 0003F4       C202 0001                                ALPHANUM(1,B2,1,2),;
          1 0003F6       4007 00A2                                ALPHANUM(ENTFLG+6,AUTO,,R5,FILL)
          1 0003F8  437F                                 CSYNC    s:24059+60,SPREL
          1 0003F9  9847 00A2                            LDR,R1   ENTFLG+6,AUTO
          1 0003FB  9970 F0D5                            CMR,R1   -3883,IMO
          1 0003FD  0981 0003                            BNE      s:24072,PREL

      523    24060    2                  AND ( HSPBLK.FLG = 'F0D1'X
      524    24061                    /* NJE SIGNON type-J record:  positive response to type-I.
      525    24062                       Should we care what the remote site considers our name to be?
      526    24063                       Should we "negotiate" KZ$NJE_SIGNON.NCCIDL? */
      527    24064    2                  OR HSPBLK.FLG = 'F0D2'X
      528    24065    2                  OR HSPBLK.FLG = 'F0D3'X
      529    24066    2                  OR HSPBLK.FLG = 'F0D4'X
      530    24067    3                  OR HSPBLK.FLG = 'F0D5'X ) THEN DO;

      531    24068                    /* Also ignoring type-K, -L, -M, and -N records.
      532    24069                       Since NJE says that a given transmission block may not contain
      533    24070                       records with different RCBs, this should all work. */
      534    24071    3                  END;

  24071   1 0003FF  0F81 015B                            B        s:24236,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:80   

      535    24072    3               ELSE DO;

      536    24073                    /* Parse input block.  Only 2780/3780 will altreturn and
      537    24074                       then only if he can't accept any input at this time. */
      538    24075    3   DBLK_INP:
      539    24076    3                  CALL KZL$DBLK (KZ$LINCTX) ALTRET(ALT_RET);

  24076   1 000401  BBC7 0088            DBLK_INP        LAB,B3   LCTX$,AUTO
          1 000403  CBF0 0100                            LAB,B4   256,IMO
          1 000405  E380 0000 0000  xent                 LNJ,B6   KZL$DBLK
          1 000408       FF79                            DC       s:24039,PREL

      540    24077    3                  END;

  24077   1 000409  0F81 0151                            B        s:24236,PREL

      541    24078        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:81   
      542    24079    2          CASE (%KZ#LINFCN_SNDSIGNON);

      543    24080
      544    24081        /*D*
      545    24082              When Function-code is KZ#LINFCN_SNDSIGNON, a block containing the
      546    24083              SIGNON string may be queued for output, depending on the PROFILE type:
      547    24084                  HASP:  do nothing (SUPER-defined SIGNON string was already queued
      548    24085                         onto a DEVCTX by KZD$DEVMGR previously)
      549    24086                  NJE:  queue an 'I'-type signon block (waiting in RMTSS$)
      550    24087                  2780/3780:  don't call this routine.
      551    24088                                                                           */
      552    24089    2            IF KZ$LINCTX.PRO.PROTYP ~= %KLPT_NJE# THEN

  24089   1 00040B  E845 003A                            LDR,R6   58,B5
          1 00040D  6D07                                 CMV,R6   7
          1 00040E  0901 0004                            BE       s:24091,PREL

      553    24090    2               ALTRETURN;  /* Line manager will send previously queued SIGNON */

  24090   1 000410  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      554    24091    2            CALL KZD$SNDSIGNON ( KZ$LINCTX.CTRHD$->DEVCTX );

  24091   1 000413  CC85                                 LDB,B4   ,B5
          1 000414  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 000416  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000418  CBF0 0100                            LAB,B4   256,IMO
          1 00041A  E380 0000 0000  xent                 LNJ,B6   KZD$SNDSIGNON
          1 00041D       0001                            DC       s:24091+11,PREL
          1 00041E  0F81 013C                            B        s:24236,PREL

      555    24092
      556    24093    2          CASE (%KZ#LINFCN_ACKSIGNON);

      557    24094
      558    24095        /*D*
      559    24096              When Function-code is KZ#LINFCN_ACKSIGNON, a block containing a
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:82   
      560    24097              legal SIGNON string has been received.  This case queues up the proper
      561    24098              response, depending on the PROFILE type:
      562    24099                  HASP:  do nothing (line manager will send ACK0)
      563    24100                  NJE:  queue a 'J'-type signon response (waiting in RMTSS$)
      564    24101                  2780/3780:  don't call this routine.
      565    24102                                                                           */
      566    24103    2            IF KZ$LINCTX.PRO.PROTYP ~= %KLPT_NJE# THEN

  24103   1 000420  E845 003A                            LDR,R6   58,B5
          1 000422  6D07                                 CMV,R6   7
          1 000423  0901 0004                            BE       s:24105,PREL

      567    24104    2               ALTRETURN;  /* Line manager will send ACK0 */

  24104   1 000425  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      568    24105    2            CALL KZD$ACKSIGNON ( KZ$LINCTX.CTRHD$->DEVCTX );

  24105   1 000428  CC85                                 LDB,B4   ,B5
          1 000429  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 00042B  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 00042D  CBF0 0100                            LAB,B4   256,IMO
          1 00042F  E380 0000 0000  xent                 LNJ,B6   KZD$ACKSIGNON
          1 000432       0001                            DC       s:24105+11,PREL
          1 000433  0F81 0127                            B        s:24236,PREL

      569    24106        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:83   
      570    24107    2          CASE (%KZ#LINFCN_GETOTP);

      571    24108
      572    24109        /*D*
      573    24110              When Function-code is KZ#LINFCN_GETOTP, an output block has been
      574    24111              sent and the line manager wants to send another.  The previous
      575    24112              block is relaeased by calling RELOTP and then KZL$BBLK is called
      576    24113              to obtain the next outptut.  If another block is not available,
      577    24114              the ALTRETURN is taken.
      578    24115                                                                           */
      579    24116    2   GETOTP:  BFR$=KZ$LINCTX.OTPHD$;

  24116   1 000435  ECC7 0088            GETOTP          LDB,B6   LCTX$,AUTO
          1 000437  DCC6 0052                            LDB,B5   82,B6
          1 000439  DFC7 008C                            STB,B5   BFR$,AUTO

      580    24117    3            IF BFR$ ~= ADDR(NIL) THEN DO;

  24117   1 00043B  8DC7 008C                            CMN      BFR$,AUTO
          1 00043D  0901 000D                            BE       s:24122,PREL

      581    24118    3               CTX$=KZ$OTPBFR.DEV$;

  24118   1 00043F  CCC5 0006                            LDB,B4   6,B5
          1 000441  CFC7 008A                            STB,B4   CTX$,AUTO

      582    24119    3               KZ$LINCTX.OTPHD$ = ADDR(NIL);

  24119   1 000443  BB80 0000 0000                       LAB,B3   0
          1 000446  BFC6 0052                            STB,B3   82,B6

      583    24120    3               CALL RELOTP;         /* Release output block   */

  24120   1 000448  E3C0 0231                            LNJ,B6   s:0,PREL
          1 00044A       0001                            DC       s:24122,PREL

      584    24121    3               END;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:84   

      585    24122    2            CALL KZL$BBLK (KZ$LINCTX) ALTRET(NOOTP);

  24122   1 00044B  BBC7 0088                            LAB,B3   LCTX$,AUTO
          1 00044D  CBF0 0100                            LAB,B4   256,IMO
          1 00044F  E380 0000 0000  xent                 LNJ,B6   KZL$BBLK
          1 000452       000D                            DC       s:24126,PREL

      586    24123    2            IF KZ$LINCTX.OTPDATSIZ = 0 AND KZ$LINCTX.OTPHD$ ~= ADDR(NIL) THEN

  24123   1 000453  ECC7 0088                            LDB,B6   LCTX$,AUTO
          1 000455  E846 005D                            LDR,R6   93,B6
          1 000457  6981 0004                            BNEZ,R6  s:24125,PREL
          1 000459  8DC6 0052                            CMN      82,B6
          1 00045B  09DA                                 BNE      s:24107,SPREL

      587    24124    2               GOTO GETOTP;
      588    24125    2            RETURN;

  24125   1 00045C  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      589    24126    2   NOOTP:   ALTRETURN;

  24126   1 00045F  C380 0000 0000  xent NOOTP           LNJ,B4   X6A_AALT

      590    24127
      591    24128
      592    24129        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:85   
      593    24130        /*D*
      594    24131              When function-code is KZ#LINFCN_KILL, B$TERMINAL_ID must be a
      595    24132              line level ID. A disconnect event is reported to VDH for all
      596    24133              devices on the line.  After VDH has completed disconnecting,
      597    24134              the device context is relaesed and the Common Line Manager is
      598    24135              notified with a DSCDEV event.
      599    24136                                                                           */
      600    24137
      601    24138    2          CASE (%KZ#LINFCN_KILL,

      602    24139    2               %KZ#LINFCN_DSCTRM,%KZ#LINFCN_DISABL);
      603    24140
      604    24141    2            IF EVENT_FPT.TERMID$->B$TERMINAL_ID.LEV ~= %TERMINAL_ID_LEV_CHAN# THEN

  24141   1 000462  CCC6 0005                            LDB,B4   5,B6
          1 000464  E804                                 LDR,R6   ,B4
          1 000465  E570 00FF                            AND,R6   255,IMO
          1 000467  6D01                                 CMV,R6   1
          1 000468  0901 0004                            BE       s:24144,PREL

      605    24142    2               RETURN;

  24142   1 00046A  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      606    24143
      607    24144    2            CTX$=KZ$LINCTX.CTRHD$;

  24144   1 00046D  BC85                                 LDB,B3   ,B5
          1 00046E  BFC7 008A                            STB,B3   CTX$,AUTO

      608    24145    2            TPTR$=ADDR(NIL);

  24145   1 000470  CB80 0000 0000                       LAB,B4   0
          1 000473  CFC7 0091                            STB,B4   TPTR$,AUTO

      609    24146
      610    24147                 /* If there are no devices, report LINDSC to indicate that
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:86   
      611    24148                 the disconnect is completed                               */
      612    24149
      613    24150    3            IF CTX$ = ADDR(NIL) THEN DO;

  24150   1 000475  8DC7 008A                            CMN      CTX$,AUTO
          1 000477  0981 0025                            BNE      s:24158,PREL

      614    24151    3   REPLINDSC:  KZ_EVENT=CNCDSC_EVENT;

  24151   1 000479  AB80 0000 0000  00   REPLINDSC       LAB,B2   KV_USRPRM
          1 00047C  2C72                                 LDV,R2   114
          1 00047D  6C1C                                 LDV,R6   28
          1 00047E  BB87                                 LAB,B3   ,AUTO
          1 00047F  3C6A                                 LDV,R3   106
          1 000480  0008                                 MMM

      615    24152    3               KZ_EVENT.EVENT=%KZ#CLM_EVENT_LINDSC;

  24152   1 000481  6C0A                                 LDV,R6   10
          1 000482  EF47 0035                            STR,R6   KZ_EVENT,AUTO

      616    24153    3               KZ_EVENT.LINCTX$=LCTX$;

  24153   1 000484  ECC7 0088                            LDB,B6   LCTX$,AUTO
          1 000486  EFC7 0038                            STB,B6   KZ_EVENT+3,AUTO

      617    24154    3               KZ_EVENT.TERMID$=EVENT_FPT.TERMID$;

  24154   1 000488  DCC7 0004                            LDB,B5   @EVENT_FPT,AUTO
          1 00048A  CCC5 0005                            LDB,B4   5,B5
          1 00048C  CFC7 003A                            STB,B4   KZ_EVENT+5,AUTO

      618    24155    3               CALL KZR_CNCDSC@ (KZ_EVENT);

  24155   1 00048E  ABC7 0035                            LAB,B2   KZ_EVENT,AUTO
          1 000490  AFC7 009E                            STB,B2   ENTFLG+2,AUTO
          1 000492  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:87   
          1 000494  9C80 0000 0000  xsym                 LDB,B1   KZR_CNCDSC@
          1 000497  CBF0 0100                            LAB,B4   256,IMO
          1 000499  E381                                 LNJ,B6   ,B1
          1 00049A       0001                            DC       s:24156,PREL

      619    24156    3               END;

  24156   1 00049B  0F81 00BF                            B        s:24236,PREL

      620    24157    3            ELSE DO;

      621    24158    4               DO WHILE(CTX$ ~= ADDR(NIL));

  24158   1 00049D  0F81 00B9                            B        s:24232,PREL

      622    24159
      623    24160    4                  IF DEVCTX.DSC THEN

  24160   1 00049F  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 0004A1  82C6 001E                            LB,'000F'X        30,B6
          1 0004A3       000F
          1 0004A4  0501 00A6                            BBT      s:24225,PREL

      624    24161    4                     GOTO NXTDEV;
      625    24162
      626    24163    5                  IF DEVCTX.VDI$ = ADDR(NIL) THEN DO;

  24163   1 0004A6  8DC6 000B                            CMN      11,B6
          1 0004A8  0981 0028                            BNE      s:24176,PREL

      627    24164
      628    24165                          /* Discard device context if never enabled.      */
      629    24166
      630    24167    5                     IF TPTR$ = ADDR(NIL) THEN

  24167   1 0004AA  8DC7 0091                            CMN      TPTR$,AUTO
          1 0004AC  0981 0007                            BNE      s:24170,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:88   

      631    24168    5                        KZ$LINCTX.CTRHD$=DEVCTX.LNK$;

  24168   1 0004AE  DC86                                 LDB,B5   ,B6
          1 0004AF  CCC7 0088                            LDB,B4   LCTX$,AUTO
          1 0004B1  DF84                                 STB,B5   ,B4
          1 0004B2  0F81 0005                            B        s:24171,PREL

      632    24169    5                     ELSE
      633    24170    5                        TPTR$->DEVCTX.LNK$=DEVCTX.LNK$;

  24170   1 0004B4  DC86                                 LDB,B5   ,B6
          1 0004B5  CCC7 0091                            LDB,B4   TPTR$,AUTO
          1 0004B7  DF84                                 STB,B5   ,B4

      634    24171    5                     TBFR$=CTX$;

  24171   1 0004B8  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 0004BA  EFC7 008E                            STB,B6   TBFR$,AUTO

      635    24172    5                     CTX$=DEVCTX.LNK$;

  24172   1 0004BC  DC86                                 LDB,B5   ,B6
          1 0004BD  DFC7 008A                            STB,B5   CTX$,AUTO

      636    24173    5                     CALL KVB$RLS (SIZEW(DEVCTX),TBFR$);

  24173   1 0004BF  CBF0 003A                            LAB,B4   58,IMO
          1 0004C1  BBC7 008E                            LAB,B3   TBFR$,AUTO
          1 0004C3  BFC7 00A0                            STB,B3   ENTFLG+4,AUTO
          1 0004C5  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 0004C7  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 0004C9  CBF0 0200                            LAB,B4   512,IMO
          1 0004CB  E380 0000 0000  xent                 LNJ,B6   KVB$RLS
          1 0004CE       0001                            DC       s:24174,PREL

      637    24174    5                     END;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:89   

  24174   1 0004CF  0F81 0082                            B        s:24230,PREL

      638    24175    5                  ELSE DO;

      639    24176    5                     CALL KZD$DQ(DEVCTX);

  24176   1 0004D1  BBC7 008A                            LAB,B3   CTX$,AUTO
          1 0004D3  CBF0 0100                            LAB,B4   256,IMO
          1 0004D5  E380 0000 0000  xent                 LNJ,B6   KZD$DQ
          1 0004D8       0001                            DC       s:24191,PREL

      640    24177                       %KV$USRENT (VDI$=DEVCTX.VDI$,DFR$=DFRDSC,
      641    24178                                   SCHRSN=%KV_SCHRSN_DFR1);
             24191    5           DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24191                    DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24191   1 0004D9  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 0004DB  DCC6 000B                            LDB,B5   11,B6
          1 0004DD  CCC5 0008                            LDB,B4   8,B5
          1 0004DF  BCC4 0033                            LDB,B3   51,B4
          1 0004E1  8AC3 0039                            INC      57,B3
          1 0004E3  8EC3 0038                            CAD      56,B3

             24192    6           IF NOT DEVCTX.VDI$->KV$VDI.BSY THEN DO;

  24192   1 0004E5  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 0004E7  DCC6 000B                            LDB,B5   11,B6
          1 0004E9  82C5 0019                            LB,'0080'X        25,B5
          1 0004EB       0080
          1 0004EC  0501 0014                            BBT      s:24198,PREL

             24193    6              DEVCTX.VDI$->KV$VDI.BSY = '1'B;

  24193   1 0004EE  8945 0019                            LBT,'0080'X       25,B5
  24193   1 0004F0       0080

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:90   
             24194    6              KV@USRENT.SVDPTR$ = KV$PTR$;

  24194   1 0004F1  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0004F4  EFC7 0033                            STB,B6   KV@USRENT,AUTO

             24195    6              KV$PTR$ = DEVCTX.VDI$->KV$VDI.ASNINPPTR$;

  24195   1 0004F6  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 0004F8  CCC5 000B                            LDB,B4   11,B5
          1 0004FA  BCC4 0006                            LDB,B3   6,B4
          1 0004FC  BF80 0000 0000  xsym                 STB,B3   KV$PTR$

             24196    6              END;                         /* ELSE IF ~BSY                       */

  24196   1 0004FF  0F81 0012                            B        s:24204,PREL

             24197    6           ELSE DO;

             24198    6              DEVCTX.VDI$->KV$VDI.DFR.USR(1) = '1'B;

  24198   1 000501  8945 0018                            LBT,'4000'X       24,B5
  24198   1 000503       4000

             24199    6           DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24199                    DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24199   1 000504  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 000506  DCC6 000B                            LDB,B5   11,B6
          1 000508  CCC5 0008                            LDB,B4   8,B5
          1 00050A  BCC4 0033                            LDB,B3   51,B4
          1 00050C  8AC3 003B                            INC      59,B3
          1 00050E  8EC3 003A                            CAD      58,B3

             24200    6              GOTO DFRDSC;

  24200   1 000510  0F81 0035                            B        s:24224,PREL

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:91   
             24201    6              END;                         /* END IF                             */
      642    24204    5                     DEVCTX.DSC.TOLD_VDH = '1'B;

  24204   1 000512  8945 001E                            LBT,'0004'X       30,B5
  24204   1 000514       0004

      643    24205    5                     DEVCTX.FLAGS.SUSPEND_OUT='1'B;

  24205   1 000515  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 000517  8945 001E                            LBT,'4000'X       30,B5
          1 000519       4000

      644    24206    5                     KV$VDH_DSC = KV_VDH_DSC;

  24206   1 00051A  8C80 0000 0000  xsym                 LDI      KV_VDH_DSC
          1 00051D  8D47 002C                            SDI      KV$VDH_DSC,AUTO

      645    24207    5                     KV$VDH_DSC.RSN = KZ$LINCTX.DSCRSN;

  24207   1 00051F  DCC7 0088                            LDB,B5   LCTX$,AUTO
          1 000521  D845 0038                            LDR,R5   56,B5
          1 000523  DAC7 002C                            SRM,R5,'00FF'X    KV$VDH_DSC,AUTO
          1 000525       00FF

      646    24208    5                     KV$VDH_DSC.NO_IO='1'B;

  24208   1 000526  8947 002D                            LBT,'8000'X       KV$VDH_DSC+1,AUTO
  24208   1 000528       8000

      647    24209    5                     CALL KVV$VDI (KV$VDH_DSC);

  24209   1 000529  CBC7 002C                            LAB,B4   KV$VDH_DSC,AUTO
          1 00052B  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 00052D  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 00052F  CBF0 0100                            LAB,B4   256,IMO
          1 000531  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000534       0001                            DC       s:24210,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:92   

      648    24210    5                     CALL DFR;

  24210   1 000535  E3C0 005D                            LNJ,B6   s:0,PREL
          1 000537       0001                            DC       s:24218,PREL

      649    24211
      650    24212                       %KV$USREXT;
             24218    5           KV$PTR.VDI$->KV$VDI.BSY = '0'B;

  24218   1 000538  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00053B  DC86                                 LDB,B5   ,B6
          1 00053C  8845 0019                            LBF,'0080'X       25,B5
          1 00053E       0080

             24220    5           KV$PTR$ = KV@USRENT.SVDPTR$;

  24220   1 00053F  DCC7 0033                            LDB,B5   KV@USRENT,AUTO
          1 000541  DF80 0000 0000  xsym                 STB,B5   KV$PTR$

      651    24222
      652    24223    6                     DO WHILE ('0'B);

  24223   1 000544  0F81 0006                            B        s:24225,PREL

      653    24224    6   DFRDSC:              DEVCTX.DFR.DSCI='1'B;

  24224   1 000546  ECC7 008A            DFRDSC          LDB,B6   CTX$,AUTO
          1 000548  8946 001F                            LBT,'8000'X       31,B6
          1 00054A       8000

      654    24225    6                        END;

      655    24226
      656    24227    5   NXTDEV:           TPTR$=CTX$;

  24227   1 00054B  ECC7 008A            NXTDEV          LDB,B6   CTX$,AUTO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:93   
          1 00054D  EFC7 0091                            STB,B6   TPTR$,AUTO

      657    24228    5                     CTX$=DEVCTX.LNK$;

  24228   1 00054F  DC86                                 LDB,B5   ,B6
          1 000550  DFC7 008A                            STB,B5   CTX$,AUTO

      658    24229    5                     END;

      659    24230    4                  IF KZ$LINCTX.CTRHD$=ADDR(NIL) THEN

  24230   1 000552  ECC7 0088                            LDB,B6   LCTX$,AUTO
          1 000554  8D86                                 CMN      ,B6
          1 000555  0901 FF23                            BE       s:24151,PREL

      660    24231    4                     GOTO REPLINDSC;
      661    24232    4                  END;

  24232   1 000557  8DC7 008A                            CMN      CTX$,AUTO
          1 000559  0981 FF45                            BNE      s:24160,PREL

      662    24233
      663    24234    3               END;

      664    24235    2          END;

      665    24236    1         RETURN;

  24236   1 00055B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      666    24237        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:94   
      667    24238        /*D*  NAME: KZR$DFR
      668    24239              CALL:
      669    24240                    CALL KZR$DFR (Device_context) ALTRET(label);
      670    24241              PARAMETERS:
      671    24242                    Device-context is the device context block.
      672    24243              DESCRIPTION:
      673    24244                    This procedure is called when a device's DEFER queue is to
      674    24245                    be processed.  The call should be from a routine which is
      675    24246                    already "in" VDH.
      676    24247                    Output buffers are released; they ended up on the DEFER queue
      677    24248                    due to VDH being busy when we attempted to release them earlier
      678    24249                    (we need VDH to acknowledge markers and/or change RQSOTP status).
      679    24250                    Input records are processed, and the buffers associated with
      680    24251                    them (a KZ$INPBFR and a buffer the size of the record itself)
      681    24252                    are released.  These also ended up on the DEFER queue due to
      682    24253                    a busy VDH.
      683    24254                    For consoles, both input and output devices are searched.
      684    24255                                                                           */
      685    24256
      686    24257    1   KZR$DFR: ENTRY (EVENT_FPT) ALTRET;

  24257   1 00055E  D380 0000 0000  xent KZR$DFR         LNJ,B5   X6A_AUTO_1
          1 000561       00A3 0001                       DC       163,1

      687    24258
      688    24259    1         CTX$=ADDR(EVENT_FPT);

  24259   1 000563  ECC7 0004                            LDB,B6   @EVENT_FPT,AUTO
          1 000565  EFC7 008A                            STB,B6   CTX$,AUTO

      689    24260    1         LCTX$=DEVCTX.LIN$;

  24260   1 000567  DCC6 000D                            LDB,B5   13,B6
          1 000569  DFC7 0088                            STB,B5   LCTX$,AUTO

      690    24261    1         CALL DFR;

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:95   
  24261   1 00056B  E3C0 0027                            LNJ,B6   s:0,PREL
          1 00056D       0001                            DC       s:24262,PREL

      691    24262    1         IF (DEVCTX.MGR_TYPE = %KZ_S_DMCONSOLE# OR

  24262   1 00056E  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 000570  E2C6 0022                            LLH,R6   34,B6
          1 000572  6D03                                 CMV,R6   3
          1 000573  0901 0004                            BE       s:24262+10,PREL
          1 000575  6D01                                 CMV,R6   1
          1 000576  0981 0008                            BNE      s:24266,PREL
          1 000578  8DC6 0013                            CMN      19,B6
          1 00057A  0981 0004                            BNE      s:24266,PREL

      692    24263    1            DEVCTX.MGR_TYPE = %KZ_S_DMINPUT#) AND
      693    24264    1            DEVCTX.DFRHD$ = ADDR(NIL) THEN
      694    24265    1            DEVCTX.FLAGS.SUSPEND_IN = '0'B;

  24265   1 00057C  8846 001E                            LBF,'8000'X       30,B6
  24265   1 00057E       8000

      695    24266    2         IF DEVCTX.MGR_TYPE = %KZ_S_DMCONSOLE# THEN DO;

  24266   1 00057F  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 000581  E2C6 0022                            LLH,R6   34,B6
          1 000583  6D03                                 CMV,R6   3
          1 000584  0981 000B                            BNE      s:24271,PREL

      696    24267    2            CTX$ = DEVCTX.LNK$;

  24267   1 000586  DC86                                 LDB,B5   ,B6
          1 000587  DFC7 008A                            STB,B5   CTX$,AUTO

      697    24268    2            IF CTX$ ~= ADDR(NIL) THEN

  24268   1 000589  8DC7 008A                            CMN      CTX$,AUTO
          1 00058B  0901 0004                            BE       s:24271,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:96   

      698    24269    2               CALL DFR;

  24269   1 00058D  E3C0 0005                            LNJ,B6   s:0,PREL
          1 00058F       0001                            DC       s:24271,PREL

      699    24270    2            END;

      700    24271    1         RETURN;

  24271   1 000590  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      701    24272
      702    24273    1   DFR:  PROC;

  24273   1 000593  EFC7 0096            DFR             STB,B6   SZ+2,AUTO

      703    24274
      704    24275    2         TBFR$ = ADDR(DEVCTX.DFRHD$);

  24275   1 000595  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 000597  CBC5 0013                            LAB,B4   19,B5
          1 000599  CFC7 008E                            STB,B4   TBFR$,AUTO

      705    24276    2         BFR$ = DEVCTX.DFRHD$;

  24276   1 00059B  BCC5 0013                            LDB,B3   19,B5
          1 00059D  BFC7 008C                            STB,B3   BFR$,AUTO

      706    24277    3         DO WHILE ( BFR$ ~= ADDR(NIL));

  24277   1 00059F  0F81 0071                            B        s:24298,PREL

      707    24278    3            IF KZ$OTPBFR.TYP = %KZ#BFRTYP_INP AND

  24278   1 0005A1  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 0005A3  E2C6 0002                            LLH,R6   2,B6
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:97   
          1 0005A5  6D01                                 CMV,R6   1
          1 0005A6  0981 0016                            BNE      s:24285,PREL
          1 0005A8  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 0005AA  82C5 001E                            LB,'0002'X        30,B5
          1 0005AC       0002
          1 0005AD  0501 000F                            BBT      s:24285,PREL
          1 0005AF  CCC5 000B                            LDB,B4   11,B5
          1 0005B1  82C4 001D                            LB,'0010'X        29,B4
          1 0005B3       0010
          1 0005B4  0501 0008                            BBT      s:24285,PREL

      708    24279    3               NOT DEVCTX.DSC.VDH_FINAL AND
      709    24280    4               NOT DEVCTX.VDI$->KV$VDI.USRRQSDAT.RED THEN DO;

      710    24281    4               TBFR$ = BFR$;

  24281   1 0005B6  EFC7 008E                            STB,B6   TBFR$,AUTO

      711    24282    4               BFR$ = BFR$->KZ$INPBFR.LNK$;

  24282   1 0005B8  CC86                                 LDB,B4   ,B6
          1 0005B9  CFC7 008C                            STB,B4   BFR$,AUTO

      712    24283    4               END;

  24283   1 0005BB  0F81 0055                            B        s:24298,PREL

      713    24284    4            ELSE DO;

      714    24285    4               TBFR$->KZ$OTPBFR.LNK$ = BFR$->KZ$OTPBFR.LNK$;

  24285   1 0005BD  DC86                                 LDB,B5   ,B6
          1 0005BE  CCC7 008E                            LDB,B4   TBFR$,AUTO
          1 0005C0  DF84                                 STB,B5   ,B4

      715    24286    5               DO CASE (KZ$OTPBFR.TYP);

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:98   
  24286   1 0005C1  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 0005C3  B2C6 0002                            LLH,R3   2,B6
          1 0005C5  3D03                                 CMV,R3   3
          1 0005C6  0281 0045                            BGE      s:24296,PREL
          1 0005C8  A830 0000 05CE  01                   LDR,R2   s:24286+13,R3
          1 0005CB  83A0 0000 05D1  01                   JMP      s:24288,R2
          1 0005CE       003B                            DC       s:24296,PREL
          1 0005CF       0005                            DC       s:24290,PREL
          1 0005D0       0000                            DC       s:24288,PREL

      716    24287    5                CASE(%KZ#BFRTYP_OTP);

      717    24288    5                  CALL RELOTPDFR;

  24288   1 0005D1  E3C0 0223                            LNJ,B6   s:0,PREL
          1 0005D3       0001                            DC       s:24288+3,PREL
          1 0005D4  0F81 0037                            B        s:24296,PREL

      718    24289    5                CASE(%KZ#BFRTYP_INP);

      719    24290    5                  IF NOT DEVCTX.DSC.VDH_FINAL THEN

  24290   1 0005D6  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 0005D8  82C5 001E                            LB,'0002'X        30,B5
          1 0005DA       0002
          1 0005DB  0501 0004                            BBT      s:24292,PREL

      720    24291    5                     CALL SNDINP;

  24291   1 0005DD  E3C0 02DB                            LNJ,B6   s:0,PREL
          1 0005DF       0001                            DC       s:24292,PREL

      721    24292    5                  IF KZ$INPBFR.DATA$ ~= ADDR(NIL) THEN

  24292   1 0005E0  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 0005E2  8DC6 0006                            CMN      6,B6
          1 0005E4  0901 0017                            BE       s:24294,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:99   

      722    24293    5                     CALL KVB$RLS ((KZ$INPBFR.BFR_SIZ+1)/2,KZ$INPBFR.DATA$);

  24293   1 0005E6  E846 0004                            LDR,R6   4,B6
          1 0005E8  6E01                                 ADV,R6   1
          1 0005E9  6041                                 SOR,R6   1
          1 0005EA  EF47 009E                            STR,R6   ENTFLG+2,AUTO
          1 0005EC  DBC6 0006                            LAB,B5   6,B6
          1 0005EE  DFC7 00A1                            STB,B5   ENTFLG+5,AUTO
          1 0005F0  CBC7 009E                            LAB,B4   ENTFLG+2,AUTO
          1 0005F2  CFC7 009F                            STB,B4   ENTFLG+3,AUTO
          1 0005F4  BBC7 009F                            LAB,B3   ENTFLG+3,AUTO
          1 0005F6  CBF0 0200                            LAB,B4   512,IMO
          1 0005F8  E380 0000 0000  xent                 LNJ,B6   KVB$RLS
          1 0005FB       0001                            DC       s:24294,PREL

      723    24294    5                  CALL KVB$RLS (SIZEW(KZ$INPBFR),BFR$);

  24294   1 0005FC  EBF0 0008                            LAB,B6   8,IMO
          1 0005FE  DBC7 008C                            LAB,B5   BFR$,AUTO
          1 000600  DFC7 00A0                            STB,B5   ENTFLG+4,AUTO
          1 000602  EFC7 009E                            STB,B6   ENTFLG+2,AUTO
          1 000604  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000606  CBF0 0200                            LAB,B4   512,IMO
          1 000608  E380 0000 0000  xent                 LNJ,B6   KVB$RLS
          1 00060B       0001                            DC       s:24296,PREL

      724    24295    5                END;

      725    24296    4               BFR$ = TBFR$->KZ$OTPBFR.LNK$;

  24296   1 00060C  ECC7 008E                            LDB,B6   TBFR$,AUTO
          1 00060E  DC86                                 LDB,B5   ,B6
          1 00060F  DFC7 008C                            STB,B5   BFR$,AUTO

      726    24297    4               END;

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:100  
      727    24298    3            END;

  24298   1 000611  8DC7 008C                            CMN      BFR$,AUTO
          1 000613  0981 FF8D                            BNE      s:24278,PREL

      728    24299    2         IF TBFR$ = ADDR(DEVCTX.DFRHD$) THEN

  24299   1 000615  ECC7 008E                            LDB,B6   TBFR$,AUTO
          1 000617  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 000619  CBC5 0013                            LAB,B4   19,B5
          1 00061B  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 00061D  EDC7 009E                            CMB,B6   ENTFLG+2,AUTO
          1 00061F  0981 0008                            BNE      s:24302,PREL

      729    24300    2            DEVCTX.DFRTL$ = ADDR(NIL);

  24300   1 000621  BB80 0000 0000                       LAB,B3   0
          1 000624  BFC5 0015                            STB,B3   21,B5
          1 000626  0F81 0003                            B        s:24303,PREL

      730    24301    2         ELSE
      731    24302    2            DEVCTX.DFRTL$ = TBFR$;

  24302   1 000628  EFC5 0015                            STB,B6   21,B5

      732    24303    2         RETURN;

  24303   1 00062A  ECC7 0096                            LDB,B6   SZ+2,AUTO
          1 00062C  C3C6 0001                            LNJ,B4   1,B6

      733    24304    2   END DFR;
      734    24305        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:101  
      735    24306        /*D*  NAME: KZR$DSC_CONT
      736    24307              CALL:
      737    24308                 CALL KZR$DSC_CONT (Device-context) ALTRET(label);
      738    24309              PARAMETERS:
      739    24310                 Device-context is a device context block.
      740    24311              DESCRIPTION:
      741    24312                 This procedure continues the disconnect process that was
      742    24313                 unable to complete because of rentry to VDH..
      743    24314                                                                           */
      744    24315
      745    24316    1   KZR$DSC_CONT: ENTRY (EVENT_FPT) ALTRET;

  24316   1 00062E  D380 0000 0000  xent KZR$DSC_CONT    LNJ,B5   X6A_AUTO_1
          1 000631       00A3 0001                       DC       163,1

      746    24317
      747    24318    1         CTX$=ADDR(EVENT_FPT);

  24318   1 000633  ECC7 0004                            LDB,B6   @EVENT_FPT,AUTO
          1 000635  EFC7 008A                            STB,B6   CTX$,AUTO

      748    24319    1         LCTX$=DEVCTX.LIN$;

  24319   1 000637  DCC6 000D                            LDB,B5   13,B6
          1 000639  DFC7 0088                            STB,B5   LCTX$,AUTO

      749    24320    2         IF DEVCTX.DFR.DSCI THEN DO;

  24320   1 00063B  89C6 001F                            CMZ      31,B6
          1 00063D  0881 0022                            BAGE     s:24328,PREL

      750    24321    2            DEVCTX.DFR.DSCI = '0'B;

  24321   1 00063F  8846 001F                            LBF,'8000'X       31,B6
  24321   1 000641       8000

      751    24322    2            DEVCTX.DSC.TOLD_VDH = '1'B;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:102  

  24322   1 000642  CCC7 008A                            LDB,B4   CTX$,AUTO
          1 000644  8944 001E                            LBT,'0004'X       30,B4
          1 000646       0004

      752    24323    2            KV$VDH_DSC = KV_VDH_DSC;

  24323   1 000647  8C80 0000 0000  xsym                 LDI      KV_VDH_DSC
          1 00064A  8D47 002C                            SDI      KV$VDH_DSC,AUTO

      753    24324    2            KV$VDH_DSC.RSN = KZ$LINCTX.DSCRSN;

  24324   1 00064C  D845 0038                            LDR,R5   56,B5
          1 00064E  DAC7 002C                            SRM,R5,'00FF'X    KV$VDH_DSC,AUTO
          1 000650       00FF

      754    24325    2            CALL KVV$VDI (KV$VDH_DSC);

  24325   1 000651  CBC7 002C                            LAB,B4   KV$VDH_DSC,AUTO
          1 000653  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 000655  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000657  CBF0 0100                            LAB,B4   256,IMO
          1 000659  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 00065C       0001                            DC       s:24326,PREL

      755    24326    2            CALL DFR;

  24326   1 00065D  E3C0 FF35                            LNJ,B6   s:0,PREL
          1 00065F       0001                            DC       s:24328,PREL

      756    24327    2            END;

      757    24328    1         RETURN;

  24328   1 000660  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      758    24329
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:103  
      759    24330
      760    24331
      761    24332
      762    24333        /*D*  NAME: KZR$RELOPTBFR
      763    24334              CALL:
      764    24335                 CALL KZR$RELOTPBFR (Device-context);
      765    24336              PARAMETER:
      766    24337                 The  device context block pointer.
      767    24338              DESCRIPTION:
      768    24339                 This is an external entry to the RELOTP procedure to permit
      769    24340                 other procedures to release buffers.
      770    24341                                                                           */
      771    24342
      772    24343    1   KZR$RELOTPBFR: ENTRY (EVENT_FPT) ALTRET;

  24343   1 000663  D380 0000 0000  xent KZR$RELOTPBFR   LNJ,B5   X6A_AUTO_1
          1 000666       00A3 0001                       DC       163,1

      773    24344
      774    24345    1         BFR$=ADDR(EVENT_FPT);

  24345   1 000668  ECC7 0004                            LDB,B6   @EVENT_FPT,AUTO
          1 00066A  EFC7 008C                            STB,B6   BFR$,AUTO

      775    24346    1         CTX$=KZ$OTPBFR.DEV$;

  24346   1 00066C  DCC6 0006                            LDB,B5   6,B6
          1 00066E  DFC7 008A                            STB,B5   CTX$,AUTO

      776    24347    1         LCTX$=DEVCTX.LIN$;

  24347   1 000670  CCC5 000D                            LDB,B4   13,B5
          1 000672  CFC7 0088                            STB,B4   LCTX$,AUTO

      777    24348    1         CALL RELOTP;

  24348   1 000674  E3C0 0005                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:104  
          1 000676       0001                            DC       s:24349,PREL

      778    24349    1         RETURN;

  24349   1 000677  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      779    24350
      780    24351
      781    24352
      782    24353
      783    24354        /*    Release Output Block                                         */
      784    24355        /*D*
      785    24356              RELOTP is an internal routine whose purpose is to release the
      786    24357              output block pointed to by BFR$.  If there are
      787    24358              Markers in the block, and we can't get to VDH to tell him
      788    24359              just now, the block is added to the tail of a defer list
      789    24360              for releasing later.
      790    24361
      791    24362              VDH is informed of any markers noted in the output block and
      792    24363              the throttling threshold is checked.  VDH is informed if more
      793    24364              output is required.
      794    24365
      795    24366                                                                           */
      796    24367
      797    24368    1   RELOTP: PROC;

  24368   1 00067A  EFC7 0098            RELOTP          STB,B6   SZ+4,AUTO

      798    24369
      799    24370    2   DCL TBFR$ PTR;
      800    24371    2   DCL ENTFLG BIT(1);
      801    24372
      802    24373
      803    24374    2         ENTFLG='1'B;

  24374   1 00067C  8947 009C                            LBT,'8000'X       ENTFLG,AUTO
  24374   1 00067E       8000
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:105  

      804    24375
      805    24376              %KV$USRENT (VDI$=DEVCTX.VDI$,DFR$=DFRREL,SCHRSN=%KV_SCHRSN_DFR1);
             24389    2           DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT =
             24389                    DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTCNT + 1;

  24389   1 00067F  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 000681  CCC5 000B                            LDB,B4   11,B5
          1 000683  BCC4 0008                            LDB,B3   8,B4
          1 000685  ACC3 0033                            LDB,B2   51,B3
          1 000687  8AC2 0039                            INC      57,B2
          1 000689  8EC2 0038                            CAD      56,B2

             24390    3           IF NOT DEVCTX.VDI$->KV$VDI.BSY THEN DO;

  24390   1 00068B  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 00068D  DCC6 000B                            LDB,B5   11,B6
          1 00068F  82C5 0019                            LB,'0080'X        25,B5
          1 000691       0080
          1 000692  0501 0014                            BBT      s:24396,PREL

             24391    3              DEVCTX.VDI$->KV$VDI.BSY = '1'B;

  24391   1 000694  8945 0019                            LBT,'0080'X       25,B5
  24391   1 000696       0080

             24392    3              KV@USRENT.SVDPTR$ = KV$PTR$;

  24392   1 000697  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 00069A  EFC7 0033                            STB,B6   KV@USRENT,AUTO

             24393    3              KV$PTR$ = DEVCTX.VDI$->KV$VDI.ASNINPPTR$;

  24393   1 00069C  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 00069E  CCC5 000B                            LDB,B4   11,B5
          1 0006A0  BCC4 0006                            LDB,B3   6,B4
          1 0006A2  BF80 0000 0000  xsym                 STB,B3   KV$PTR$
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:106  

             24394    3              END;                         /* ELSE IF ~BSY                       */

  24394   1 0006A5  0F81 0012                            B        s:24402,PREL

             24395    3           ELSE DO;

             24396    3              DEVCTX.VDI$->KV$VDI.DFR.USR(1) = '1'B;

  24396   1 0006A7  8945 0018                            LBT,'4000'X       24,B5
  24396   1 0006A9       4000

             24397    3           DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT =
             24397                    DEVCTX.VDI$->KV$VDI.USRPRM$->KV$USRPRM.STT$->KV$STT.USRENTDFRCNT + 1;

  24397   1 0006AA  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 0006AC  DCC6 000B                            LDB,B5   11,B6
          1 0006AE  CCC5 0008                            LDB,B4   8,B5
          1 0006B0  BCC4 0033                            LDB,B3   51,B4
          1 0006B2  8AC3 003B                            INC      59,B3
          1 0006B4  8EC3 003A                            CAD      58,B3

             24398    3              GOTO DFRREL;

  24398   1 0006B6  0F81 0003                            B        s:24404,PREL

             24399    3              END;                         /* END IF                             */
      806    24402    3         DO WHILE ('0'B);

  24402   1 0006B8  0F81 0022                            B        s:24411,PREL

      807    24403    3   DFRREL:  /* Can't get to VDH right now.   */
      808    24404    3            IF DEVCTX.DFRTL$~=ADDR(NIL) THEN

  24404   1 0006BA  ECC7 008A            DFRREL          LDB,B6   CTX$,AUTO
          1 0006BC  8DC6 0015                            CMN      21,B6
          1 0006BE  0901 0008                            BE       s:24407,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:107  

      809    24405    3               DEVCTX.DFRTL$->KZ$OTPBFR.LNK$=BFR$;

  24405   1 0006C0  DCC6 0015                            LDB,B5   21,B6
          1 0006C2  CCC7 008C                            LDB,B4   BFR$,AUTO
          1 0006C4  CF85                                 STB,B4   ,B5
          1 0006C5  0F81 0005                            B        s:24408,PREL

      810    24406    3            ELSE
      811    24407    3               DEVCTX.DFRHD$=BFR$;

  24407   1 0006C7  DCC7 008C                            LDB,B5   BFR$,AUTO
          1 0006C9  DFC6 0013                            STB,B5   19,B6

      812    24408    3            DEVCTX.DFRTL$=BFR$;

  24408   1 0006CB  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 0006CD  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 0006CF  EFC5 0015                            STB,B6   21,B5

      813    24409    3            KZ$OTPBFR.LNK$=ADDR(NIL);

  24409   1 0006D1  EB80 0000 0000                       LAB,B6   0
          1 0006D4  DCC7 008C                            LDB,B5   BFR$,AUTO
          1 0006D6  EF85                                 STB,B6   ,B5

      814    24410    3            RETURN;

  24410   1 0006D7  ECC7 0098                            LDB,B6   SZ+4,AUTO
          1 0006D9  C3C6 0001                            LNJ,B4   1,B6

      815    24411    3            END;

      816    24412
      817    24413    3   RELOTP1: IF KZ$OTPBFR.MRKCNT ~= 0 THEN DO;

  24413   1 0006DB  ECC7 008C            RELOTP1         LDB,B6   BFR$,AUTO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:108  
          1 0006DD  82C6 0005                            LB,'00FF'X        5,B6
          1 0006DF       00FF
          1 0006E0  0581 004E                            BBF      s:24435,PREL

      818    24414
      819    24415
      820    24416    4            DO I = 1 TO KZ$OTPBFR.MRKCNT;

  24416   1 0006E2  6C01                                 LDV,R6   1
          1 0006E3  EF47 0090                            STR,R6   I,AUTO
          1 0006E5  0F81 003F                            B        s:24434+2,PREL

      821    24417    4               TBFR$=PINCRW(BFR$,KZ$OTPBFR.BFRSIZ-SIZEW(KV$OTPMRK)*I);

  24417   1 0006E7  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 0006E9  E847 0090                            LDR,R6   I,AUTO
          1 0006EB  6FFD                                 MLV,R6   -3
          1 0006EC  EA46 0004                            ADD,R6   4,B6
          1 0006EE  B856                                 LDR,R3   R6
          1 0006EF  DBB6                                 LAB,B5   ,B6,R3
          1 0006F0  DFC7 009A                            STB,B5   TBFR$,AUTO

      822    24418    4               KV$VDH_OTPMRK=KV_VDH_OTPMRK;

  24418   1 0006F2  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_OTPMRK
          1 0006F5  2C00                                 LDV,R2   0
          1 0006F6  6C0A                                 LDV,R6   10
          1 0006F7  BB87                                 LAB,B3   ,AUTO
          1 0006F8  3C5C                                 LDV,R3   92
          1 0006F9  0008                                 MMM

      823    24419    4               KV$VDH_OTPMRK.DAT=TBFR$->KV$OTPMRK;

  24419   1 0006FA  ACC7 009A                            LDB,B2   TBFR$,AUTO
          1 0006FC  2C00                                 LDV,R2   0
          1 0006FD  6C06                                 LDV,R6   6
          1 0006FE  BB87                                 LAB,B3   ,AUTO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:109  
          1 0006FF  3C5E                                 LDV,R3   94
          1 000700  0008                                 MMM

      824    24420                    /* KZ$OTPBFR.CMPCOD is actually never filled in by anyone...
      825    24421                       it probably should be, since there are values indicating
      826    24422                       "device error", "buffer allocation exceeded", etc.
      827    24423                       Here we're filling it in with "disconnected" if that's what's
      828    24424                       going on.  This may be done more nicely at the point of
      829    24425                       disconnect, but placing the check here ensures that ALL
      830    24426                       buffers with OTPMRKs will return CMPCOD = DSC after a
      831    24427                       disconnect.  The only OTPMRK we're really concerned with,
      832    24428                       however, is the last one, with MSTRTR set. */
      833    24429    4               IF DEVCTX.DSC OR

  24429   1 000701  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 000703  82C6 001E                            LB,'000F'X        30,B6
          1 000705       000F
          1 000706  0501 0005                            BBT      s:24431,PREL
          1 000708  89C6 001F                            CMZ      31,B6
          1 00070A  0881 0006                            BAGE     s:24432,PREL

      834    24430    4                  DEVCTX.DFR.DSCI THEN
      835    24431    4                  KZ$OTPBFR.CMPCOD=%KV_CMPCOD_DSC;

  24431   1 00070C  6C05                                 LDV,R6   5
          1 00070D  DCC7 008C                            LDB,B5   BFR$,AUTO
          1 00070F  E7C5 0005                            STH,R6   5,B5

      836    24432    4               KV$VDH_OTPMRK.CMPCOD=KZ$OTPBFR.CMPCOD;

  24432   1 000711  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 000713  E2C6 0005                            LLH,R6   5,B6
          1 000715  EF47 0032                            STR,R6   KV$VDH_OTPMRK+4,AUTO

      837    24433    4               CALL KVV$VDI(KV$VDH_OTPMRK);

  24433   1 000717  DBC7 002E                            LAB,B5   KV$VDH_OTPMRK,AUTO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:110  
          1 000719  DFC7 009E                            STB,B5   ENTFLG+2,AUTO
          1 00071B  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 00071D  CBF0 0100                            LAB,B4   256,IMO
          1 00071F  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000722       0001                            DC       s:24434,PREL

      838    24434    4               END;

  24434   1 000723  8AC7 0090                            INC      I,AUTO
          1 000725  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 000727  E846 0005                            LDR,R6   5,B6
          1 000729  E570 00FF                            AND,R6   255,IMO
          1 00072B  E947 0090                            CMR,R6   I,AUTO
          1 00072D  0281 FFB9                            BGE      s:24417,PREL

      839    24435    3            END;

      840    24436
      841    24437
      842    24438
      843    24439    2   RELOTP2: IF KZ$OTPBFR.FLAGS.CNT# THEN

  24439   1 00072F  ECC7 008C            RELOTP2         LDB,B6   BFR$,AUTO
          1 000731  82C6 0002                            LB,'0020'X        2,B6
          1 000733       0020
          1 000734  0581 000B                            BBF      s:24441,PREL

      844    24440    2            DEVCTX.OTPBYTES=DEVCTX.OTPBYTES-KZ$LINCTX.PRO.BLKBYTES;

  24440   1 000736  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 000738  CCC7 0088                            LDB,B4   LCTX$,AUTO
          1 00073A  E845 0017                            LDR,R6   23,B5
          1 00073C  E244 003C                            SUB,R6   60,B4
          1 00073E  EF45 0017                            STR,R6   23,B5

      845    24441    2         IF DEVCTX.OTPBYTES~=0 AND DEVCTX.OTPHD$=ADDR(NIL) AND

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:111  
  24441   1 000740  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 000742  E846 0017                            LDR,R6   23,B6
          1 000744  6901 003D                            BEZ,R6   s:24458,PREL
          1 000746  8DC6 000F                            CMN      15,B6
          1 000748  0981 0039                            BNE      s:24458,PREL
          1 00074A  DCC7 0088                            LDB,B5   LCTX$,AUTO
          1 00074C  8DC5 0052                            CMN      82,B5
          1 00074E  0981 0033                            BNE      s:24458,PREL
          1 000750  8DC6 0013                            CMN      19,B6
          1 000752  0981 002F                            BNE      s:24458,PREL

      846    24442    3            KZ$LINCTX.OTPHD$ = ADDR(NIL) AND DEVCTX.DFRHD$=ADDR(NIL) THEN DO;

      847    24443    3            FPT_WRSYSLOG=WRSYSLOG;

  24443   1 000754  AB80 0000 0106  00                   LAB,B2   WRSYSLOG
          1 000757  2C00                                 LDV,R2   0
          1 000758  6C2A                                 LDV,R6   42
          1 000759  BBC7 004B                            LAB,B3   FPT_WRSYSLOG,AUTO
          1 00075B  3C00                                 LDV,R3   0
          1 00075C  0008                                 MMM

      848    24444    3            FPT_WRSYSLOG.V.TERMID=KZ$LINCTX.LINID;

  24444   1 00075D  ACC7 0088                            LDB,B2   LCTX$,AUTO
          1 00075F  2C08                                 LDV,R2   8
          1 000760  6C10                                 LDV,R6   16
          1 000761  BBC7 0053                            LAB,B3   FPT_WRSYSLOG+8,AUTO
          1 000763  3C00                                 LDV,R3   0
          1 000764  0008                                 MMM

      849    24445    3            FPT_WRSYSLOG.V.ERRCODE.ERR# = %E$THRTLERR;

  24445   1 000765  E870 0378                            LDR,R6   888,IMO
          1 000767  EAC7 0052                            SRM,R6,'FFF8'X    FPT_WRSYSLOG+7,AUTO
          1 000769       FFF8

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:112  
      850    24446    3            ADDR(FPT_WRSYSLOG.V.VALUES(0))->ERRCTX.DVCTX$ = CTX$;

  24446   1 00076A  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 00076C  EFC7 005B                            STB,B6   FPT_WRSYSLOG+16,AUTO

      851    24447    3            ADDR(FPT_WRSYSLOG.V.VALUES(0))->ERRCTX.VAL1 = DEVCTX.OTPBYTES;

  24447   1 00076E  D846 0017                            LDR,R5   23,B6
          1 000770  DF47 005D                            STR,R5   FPT_WRSYSLOG+18,AUTO

      852    24448    3            CALL KHA$ERRLOG (FPT_WRSYSLOG);

  24448   1 000772  DBC7 004B                            LAB,B5   FPT_WRSYSLOG,AUTO
          1 000774  DFC7 009E                            STB,B5   ENTFLG+2,AUTO
          1 000776  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000778  CBF0 0100                            LAB,B4   256,IMO
          1 00077A  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          1 00077D       0001                            DC       s:24456,PREL

      853    24449        /*E* ERROR:        KZR-E$THRTLERR-3
      854    24450             MESSAGE:      Throttling is out of sync.
      855    24451             DESCRIPTION:  A device's output byte count is nonzero, but no output
      856    24452                           is pending (or in progress).
      857    24453                           V0/V1 = Device context pointer.
      858    24454                           V2 = Current output byte count.
      859    24455        */
      860    24456    3            DEVCTX.OTPBYTES=0;

  24456   1 00077E  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 000780  8746 0017                            CL       23,B6

      861    24457    3            END;

      862    24458    2         IF DEVCTX.FLAGS.THROTL AND

  24458   1 000782  ECC7 008A                            LDB,B6   CTX$,AUTO
          1 000784  82C6 001E                            LB,'0010'X        30,B6
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:113  
          1 000786       0010
          1 000787  0581 0023                            BBF      s:24481,PREL
          1 000789  DCC7 0088                            LDB,B5   LCTX$,AUTO
          1 00078B  CCC5 0002                            LDB,B4   2,B5
          1 00078D  E846 0017                            LDR,R6   23,B6
          1 00078F  E944 0011                            CMR,R6   17,B4
          1 000791  0301 0019                            BG       s:24481,PREL

      863    24459    3            DEVCTX.OTPBYTES <= KZ$LINCTX.CHN$->KH$CHN.UNBLOCK THEN DO;

      864    24460    3            DEVCTX.FLAGS.THROTL='0'B;

  24460   1 000793  8846 001E                            LBF,'0010'X       30,B6
  24460   1 000795       0010

      865    24461                 %KV$RQSOTP (RQSOTP=YES);
             24473    4           IF NOT KV$PTR.VDI$->KV$VDI.RQSOTP  THEN DO;

  24473   1 000796  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000799  CC86                                 LDB,B4   ,B6
          1 00079A  82C4 0019                            LB,'0008'X        25,B4
          1 00079C       0008
          1 00079D  0501 000D                            BBT      s:24481,PREL

             24474    4              KV$PTR.VDI$->KV$VDI.RQSOTP = '1'B;

  24474   1 00079F  8944 0019                            LBT,'0008'X       25,B4
  24474   1 0007A1       0008

             24475    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);

  24475   1 0007A2  BB80 0000 0003  02                   LAB,B3   +3
          1 0007A5  CBF0 0100                            LAB,B4   256,IMO
          1 0007A7  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 0007AA       0001                            DC       s:24481,PREL

             24476    4              END;                         /* END IF                             */
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:114  

      866    24479    3            END;

      867    24480
      868    24481    2         I = KZ$OTPBFR.BFRSIZ;

  24481   1 0007AB  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 0007AD  E846 0004                            LDR,R6   4,B6
          1 0007AF  EF47 0090                            STR,R6   I,AUTO

      869    24482              %DISABLE (DISLVL=LEV,INHLVL=KZ$LINCTX.INHLVL);

  24483   1 0007B1  DCC7 0088                            LDB,B5   LCTX$,AUTO
          1 0007B3  D845 0035                            LDR,R5   53,B5
          1 0007B5  DF47 0093                            STR,R5   LEV,AUTO

  24484   1 0007B7  CBC7 0093                            LAB,B4   LEV,AUTO
          1 0007B9  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 0007BB  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 0007BD  CBF0 0100                            LAB,B4   256,IMO
          1 0007BF  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          1 0007C2       0001                            DC       s:24486,PREL

      870    24486    2         CALL KVB$RLS2NSYS (I,BFR$);

  24486   1 0007C3  EBC7 008C                            LAB,B6   BFR$,AUTO
          1 0007C5  EFC7 00A0                            STB,B6   ENTFLG+4,AUTO
          1 0007C7  DBC7 0090                            LAB,B5   I,AUTO
          1 0007C9  DFC7 009E                            STB,B5   ENTFLG+2,AUTO
          1 0007CB  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 0007CD  CBF0 0200                            LAB,B4   512,IMO
          1 0007CF  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          1 0007D2       0001                            DC       s:24488,PREL

      871    24487              %ENABLE (DISLVL=LEV,INHLVL=KZ$LINCTX.INHLVL);

  24488   1 0007D3  ECC7 0088                            LDB,B6   LCTX$,AUTO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:115  
          1 0007D5  E847 0093                            LDR,R6   LEV,AUTO
          1 0007D7  E946 0035                            CMR,R6   53,B6
          1 0007D9  0901 0007                            BE       s:24497,PREL

  24490   1 0007DB  CBF0 0000                            LAB,B4   0,IMO
          1 0007DD  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          1 0007E0       0001                            DC       s:24497,PREL

      872    24493
      873    24494
      874    24495
      875    24496
      876    24497    3         IF ENTFLG THEN DO;

  24497   1 0007E1  89C7 009C                            CMZ      ENTFLG,AUTO
          1 0007E3  0881 000D                            BAGE     s:24510,PREL

      877    24498              %KV$USREXT;
             24504    3           KV$PTR.VDI$->KV$VDI.BSY = '0'B;

  24504   1 0007E5  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0007E8  DC86                                 LDB,B5   ,B6
          1 0007E9  8845 0019                            LBF,'0080'X       25,B5
          1 0007EB       0080

             24506    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  24506   1 0007EC  DCC7 0033                            LDB,B5   KV@USRENT,AUTO
          1 0007EE  DF80 0000 0000  xsym                 STB,B5   KV$PTR$

      878    24508    3            END;

      879    24509
      880    24510    2         RETURN;

  24510   1 0007F1  ECC7 0098                            LDB,B6   SZ+4,AUTO
          1 0007F3  C3C6 0001                            LNJ,B4   1,B6
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:116  

      881    24511
      882    24512
      883    24513    2   RELOTPDFR: ENTRY;

  24513   1 0007F5  EFC7 0098            RELOTPDFR       STB,B6   SZ+4,AUTO

      884    24514    2         ENTFLG= '0'B;                 /* Already in VDH  */

  24514   1 0007F7  8747 009C                            CL       ENTFLG,AUTO

      885    24515    2         IF DEVCTX.DSC.VDH_FINAL THEN

  24515   1 0007F9  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 0007FB  82C5 001E                            LB,'0002'X        30,B5
          1 0007FD       0002
          1 0007FE  0501 FF30                            BBT      s:24435,PREL

      886    24516    2            GOTO RELOTP2;
      887    24517    2         ELSE
      888    24518    2            GOTO RELOTP1;

  24518   1 000800  0F81 FEDA                            B        s:24411,PREL

      889    24519
      890    24520    2   END RELOTP;
      891    24521
      892    24522        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:117  
      893    24523
      894    24524    1   TELLVDH: PROC ALTRET;

  24524   1 000802  EFC7 0096            TELLVDH         STB,B6   SZ+2,AUTO

      895    24525
      896    24526              %KV$USRENT (VDI$="ADDR(NIL)");
             24532    2              KV@USRENT.SVDPTR$ = KV$PTR$;

  24532   1 000804  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 000807  DFC7 0033                            STB,B5   KV@USRENT,AUTO

      897    24552    2         KV$VDH_INT=KV_VDH_INT;

  24552   1 000809  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_INT
          1 00080C  2C00                                 LDV,R2   0
          1 00080D  6C16                                 LDV,R6   22
          1 00080E  BB87                                 LAB,B3   ,AUTO
          1 00080F  3C0C                                 LDV,R3   12
          1 000810  0008                                 MMM

      898    24553    2         KV$VDH_INT.USRPRM$=KZ_USRPRM$;

  24553   1 000811  EC80 0000 0000  xsym                 LDB,B6   KZ_USRPRM$
          1 000814  EFC7 000D                            STB,B6   KV$VDH_INT+7,AUTO

      899    24554    2         KV$VDH_INT.CHN$=KZ$LINCTX.CHN$;

  24554   1 000816  DCC7 0088                            LDB,B5   LCTX$,AUTO
          1 000818  CCC5 0002                            LDB,B4   2,B5
          1 00081A  CFC7 0007                            STB,B4   KV$VDH_INT+1,AUTO

      900    24555    2         KV$VDH_INT.USRCTX$=CTX$;

  24555   1 00081C  ACC7 008A                            LDB,B2   CTX$,AUTO
          1 00081E  AFC7 0009                            STB,B2   KV$VDH_INT+3,AUTO

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:118  
      901    24556    2         KV$VDH_INT.RCVFLWCTRMAXCRD=KZ$LINCTX.CHN$->KH$CHN.BLOCK;

  24556   1 000820  9CC5 0002                            LDB,B1   2,B5
          1 000822  E841 0010                            LDR,R6   16,B1
          1 000824  EF47 000F                            STR,R6   KV$VDH_INT+9,AUTO

      902    24557    2         KV$VDH_INT.TRCBFRBYTSIZ=KZ_VDHTRCBFRBYTSIZ;

  24557   1 000826  D800 0000 0000  xsym                 LDR,R5   KZ_VDHTRCBFRBYTSIZ
          1 000829  DF47 0010                            STR,R5   KV$VDH_INT+10,AUTO

      903    24558    2         CALL KVV$INT(KV$VDH_INT) ALTRET(TELALT);

  24558   1 00082B  9BC7 0006                            LAB,B1   KV$VDH_INT,AUTO
          1 00082D  9FC7 009E                            STB,B1   ENTFLG+2,AUTO
          1 00082F  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000831  CBF0 0100                            LAB,B4   256,IMO
          1 000833  E380 0000 0000  xent                 LNJ,B6   KVV$INT
          1 000836       0060                            DC       s:24578,PREL

      904    24559
      905    24560    2         KV$VDH_CNC=KV_VDH_CNC;

  24560   1 000837  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_CNC
          1 00083A  2C00                                 LDV,R2   0
          1 00083B  6C32                                 LDV,R6   50
          1 00083C  BB87                                 LAB,B3   ,AUTO
          1 00083D  3C22                                 LDV,R3   34
          1 00083E  0008                                 MMM

      906    24561    2         DEVCTX.VDI$ = KV$VDH_INT.VDI$;

  24561   1 00083F  ECC7 000B                            LDB,B6   KV$VDH_INT+5,AUTO
          1 000841  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 000843  EFC5 000B                            STB,B6   11,B5

      907    24562        /*    KV$VDH_CNC.VDI$ = KV$VDH_INT.VDI$;  */
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:119  
      908    24563    2         KV$VDH_CNC.LCLENDPNTID = EVENT_FPT.TERMID$->B$TERMINAL_ID;

  24563   1 000845  ECC7 0004                            LDB,B6   @EVENT_FPT,AUTO
          1 000847  DCC6 0005                            LDB,B5   5,B6
          1 000849  AB85                                 LAB,B2   ,B5
          1 00084A  2C00                                 LDV,R2   0
          1 00084B  6C10                                 LDV,R6   16
          1 00084C  BB87                                 LAB,B3   ,AUTO
          1 00084D  3C38                                 LDV,R3   56
          1 00084E  0008                                 MMM

      909    24564    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_DSC)='1'B;

  24564   1 00084F  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          1 000852  9C84                                 LDB,B1   ,B4
          1 000853  8941 001E                            LBT,'0008'X       30,B1
          1 000855       0008

      910    24565    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNRJC)='1'B;

  24565   1 000856  9C84                                 LDB,B1   ,B4
          1 000857  8941 001F                            LBT,'4000'X       31,B1
          1 000859       4000

      911    24566    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_LGNACP)='1'B;

  24566   1 00085A  9C84                                 LDB,B1   ,B4
          1 00085B  8941 001F                            LBT,'8000'X       31,B1
          1 00085D       8000

      912    24567    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_RLSVDI)='1'B;

  24567   1 00085E  9C84                                 LDB,B1   ,B4
          1 00085F  8941 001F                            LBT,'0100'X       31,B1
          1 000861       0100

      913    24568    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_SCH)='1'B;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:120  

  24568   1 000862  9C84                                 LDB,B1   ,B4
          1 000863  8941 001F                            LBT,'0800'X       31,B1
          1 000865       0800

      914    24569    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_OPN)='1'B;

  24569   1 000866  9C84                                 LDB,B1   ,B4
          1 000867  8941 001F                            LBT,'2000'X       31,B1
          1 000869       2000

      915    24570    2         %KV_VDI.USREVTENB(%KV_USR_EVT_ID_CLS)='1'B;

  24570   1 00086A  9C84                                 LDB,B1   ,B4
          1 00086B  8941 001E                            LBT,'0020'X       30,B1
          1 00086D       0020

      916    24571    2         %KV_VDI.INPUNT=%KV_INPUNT_RCR;

  24571   1 00086E  9C84                                 LDB,B1   ,B4
          1 00086F  6C40                                 LDV,R6   64
          1 000870  EAC1 001D                            SRM,R6,'0060'X    29,B1
          1 000872       0060

      917    24572    2         CALL KVV$VDI(KV$VDH_CNC) ALTRET(XXXCNC);

  24572   1 000873  9BC7 0011                            LAB,B1   KV$VDH_CNC,AUTO
          1 000875  9FC7 009E                            STB,B1   ENTFLG+2,AUTO
          1 000877  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000879  CBF0 0100                            LAB,B4   256,IMO
          1 00087B  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 00087E       0003                            DC       s:24575,PREL

      918    24573
      919    24574    3         DO WHILE ('0'B);

  24574   1 00087F  0F81 0026                            B        s:24591,PREL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:121  

      920    24575    3   XXXCNC:  KV$VDH_EVT=KV_VDH_EVT;

  24575   1 000881  8C80 0000 0000  xsym XXXCNC          LDI      KV_VDH_EVT
          1 000884  8D47 002A                            SDI      KV$VDH_EVT,AUTO

      921    24576    3            KV$VDH_EVT.ID=%KV_VDH_EVT_ID_RLSVDI;

  24576   1 000886  5C03                                 LDV,R5   3
          1 000887  DAC7 002A                            SRM,R5,'00FF'X    KV$VDH_EVT,AUTO
          1 000889       00FF

      922    24577    3            CALL KVV$VDI(KV$VDH_EVT);

  24577   1 00088A  EBC7 002A                            LAB,B6   KV$VDH_EVT,AUTO
          1 00088C  EFC7 009E                            STB,B6   ENTFLG+2,AUTO
          1 00088E  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000890  CBF0 0100                            LAB,B4   256,IMO
          1 000892  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000895       0001                            DC       s:24578,PREL

      923    24578    3   TELALT:  DEVCTX.VDI$=ADDR(NIL);

  24578   1 000896  EB80 0000 0000       TELALT          LAB,B6   0
          1 000899  DCC7 008A                            LDB,B5   CTX$,AUTO
          1 00089B  EFC5 000B                            STB,B6   11,B5

      924    24579                 %KV$USREXT (VDI$="ADDR(NIL)");
             24587    3           KV$PTR$ = KV@USRENT.SVDPTR$;

  24587   1 00089D  ECC7 0033                            LDB,B6   KV@USRENT,AUTO
          1 00089F  EF80 0000 0000  xsym                 STB,B6   KV$PTR$

      925    24589    3            RETURN;

  24589   1 0008A2  ECC7 0096                            LDB,B6   SZ+2,AUTO
          1 0008A4  C3C6 0001                            LNJ,B4   1,B6
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:122  

      926    24590    3            END;

      927    24591    2         %KV_MRD.MINSP_FORPST = KZD_MINSP_FORPST;

  24591   1 0008A6  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0008A9  DCC6 0008                            LDB,B5   8,B6
          1 0008AB  E800 0000 0000  xsym                 LDR,R6   KZD_MINSP_FORPST
          1 0008AE  E7C5 000C                            STH,R6   12,B5

      928    24592              %KV$USREXT (VDI$="ADDR(NIL)");
             24600    2           KV$PTR$ = KV@USRENT.SVDPTR$;

  24600   1 0008B0  DCC7 0033                            LDB,B5   KV@USRENT,AUTO
          1 0008B2  DF80 0000 0000  xsym                 STB,B5   KV$PTR$

      929    24602    2         RETURN;

  24602   1 0008B5  ECC7 0096                            LDB,B6   SZ+2,AUTO
          1 0008B7  C3C6 0001                            LNJ,B4   1,B6

      930    24603    2   END;
      931    24604
      932    24605         /*   Pass defered input record on to VDH      */
      933    24606
      934    24607    1   SNDINP: PROC;

  24607   1 0008B9  EFC7 0098            SNDINP          STB,B6   SZ+4,AUTO

      935    24608
      936    24609    2         KV$VDH_DAT = KV_VDH_DAT;

  24609   1 0008BB  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_DAT
          1 0008BE  2C00                                 LDV,R2   0
          1 0008BF  6C10                                 LDV,R6   16
          1 0008C0  BBC7 0043                            LAB,B3   KV$VDH_DAT,AUTO
          1 0008C2  3C00                                 LDV,R3   0
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:123  
          1 0008C3  0008                                 MMM

      937    24610    2         KV$VDH_DAT.DAT__.BFRBYTSIZ = KZ$INPBFR.BFR_SIZ;

  24610   1 0008C4  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 0008C6  E846 0004                            LDR,R6   4,B6
          1 0008C8  EF47 0048                            STR,R6   KV$VDH_DAT+5,AUTO

      938    24611    2         KV$VDH_DAT.DAT__.ADR$ = KZ$INPBFR.DATA$;

  24611   1 0008CA  DCC6 0006                            LDB,B5   6,B6
          1 0008CC  DFC7 0044                            STB,B5   KV$VDH_DAT+1,AUTO

      939    24612    2         KV$VDH_DAT.DAT__.DATBYTSIZ = KZ$INPBFR.DATA_SIZ;

  24612   1 0008CE  D846 0003                            LDR,R5   3,B6
          1 0008D0  DF47 0047                            STR,R5   KV$VDH_DAT+4,AUTO

      940    24613    3         IF DEVCTX.ACCESS_METHOD = %KZ_S_ACSPRINT# THEN DO;

  24613   1 0008D2  CCC7 008A                            LDB,B4   CTX$,AUTO
          1 0008D4  C844 0022                            LDR,R4   34,B4
          1 0008D6  C570 00FF                            AND,R4   255,IMO
          1 0008D8  4D01                                 CMV,R4   1
          1 0008D9  0981 000E                            BNE      s:24618,PREL

      941    24614    3            KV$VDH_DAT.DATCTRCHR = BINASC(KZ$INPBFR.BYTX);

  24614   1 0008DB  B846 0005                            LDR,R3   5,B6
          1 0008DD  3008                                 SOL,R3   8
          1 0008DE  3068                                 SAR,R3   8
          1 0008DF  BAC7 004A                            SRM,R3,'00FF'X    KV$VDH_DAT+7,AUTO
          1 0008E1       00FF

      942    24615    3            KV$VDH_DAT.DATCTRCHRTYP=%KV_DATCTRCHRTYP_VFC;

  24615   1 0008E2  4C20                                 LDV,R4   32
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:124  
          1 0008E3  CAC7 0043                            SRM,R4,'0030'X    KV$VDH_DAT,AUTO
          1 0008E5       0030

      943    24616    3            END;

  24616   1 0008E6  0F81 0019                            B        s:24623,PREL

      944    24617    2         ELSE
      945    24618    2            IF ( KZ$LINCTX.PRO.PROTYP = %KLPT_HASP#

  24618   1 0008E8  BCC7 0088                            LDB,B3   LCTX$,AUTO
          1 0008EA  B843 003A                            LDR,R3   58,B3
          1 0008EC  3D03                                 CMV,R3   3
          1 0008ED  0901 0004                            BE       s:24618+10,PREL
          1 0008EF  3D07                                 CMV,R3   7
          1 0008F0  0981 000F                            BNE      s:24623,PREL
          1 0008F2  82C4 001E                            LB,'0200'X        30,B4
          1 0008F4       0200
          1 0008F5  0581 000A                            BBF      s:24623,PREL
          1 0008F7  82C6 0005                            LB,'1000'X        5,B6
          1 0008F9       1000
          1 0008FA  0581 0005                            BBF      s:24623,PREL

      946    24619    2               OR KZ$LINCTX.PRO.PROTYP = %KLPT_NJE# )
      947    24620    2               AND DEVCTX.FLAGS.BINARY_OK
      948    24621    2               AND ADDR(KZ$INPBFR.BYTX)->HASPSRCB.V.BIN THEN
      949    24622    2               KV$VDH_DAT.DATMOD=%KV#DATMOD_BNR;

  24622   1 0008FC  2C08                                 LDV,R2   8
          1 0008FD  AAC7 0043                            SRM,R2,'000C'X    KV$VDH_DAT,AUTO
          1 0008FF       000C

      950    24623    2         KV$VDH_DAT.CTN = KZ$INPBFR.FLAGS.CTN#;

  24623   1 000900  C846 0002                            LDR,R4   2,B6
          1 000902  4001                                 SOL,R4   1
          1 000903  CAC7 0043                            SRM,R4,'0040'X    KV$VDH_DAT,AUTO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:125  
          1 000905       0040

      951    24624    2         IF KV$VDH_DAT.DAT__.DATBYTSIZ ~= 0 THEN

  24624   1 000906  5901 000D                            BEZ,R5   s:24626,PREL

      952    24625    2            CALL KVV$VDI (KV$VDH_DAT);

  24625   1 000908  BBC7 0043                            LAB,B3   KV$VDH_DAT,AUTO
          1 00090A  BFC7 009E                            STB,B3   ENTFLG+2,AUTO
          1 00090C  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 00090E  CBF0 0100                            LAB,B4   256,IMO
          1 000910  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 000913       0001                            DC       s:24626,PREL

      953    24626    3         IF KZ$INPBFR.FLAGS.LAST# THEN DO;

  24626   1 000914  ECC7 008C                            LDB,B6   BFR$,AUTO
          1 000916  82C6 0002                            LB,'0040'X        2,B6
          1 000918       0040
          1 000919  0581 0012                            BBF      s:24631,PREL

      954    24627    3            KV$VDH_DAT.DAT__.DATBYTSIZ = 0;

  24627   1 00091B  8747 0047                            CL       KV$VDH_DAT+4,AUTO

      955    24628    3            KV$VDH_DAT.CMPCOD = %KV_CMPCOD_EOF;

  24628   1 00091D  6C01                                 LDV,R6   1
          1 00091E  E7C7 004A                            STH,R6   KV$VDH_DAT+7,AUTO

      956    24629    3            CALL KVV$VDI (KV$VDH_DAT);

  24629   1 000920  DBC7 0043                            LAB,B5   KV$VDH_DAT,AUTO
          1 000922  DFC7 009E                            STB,B5   ENTFLG+2,AUTO
          1 000924  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 000926  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:126  
          1 000928  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          1 00092B       0001                            DC       s:24631,PREL

      957    24630    3            END;

      958    24631    2         RETURN;

  24631   1 00092C  ECC7 0098                            LDB,B6   SZ+4,AUTO
          1 00092E  C3C6 0001                            LNJ,B4   1,B6

      959    24632    2   END SNDINP;
      960    24633
      961    24634        %EJECT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:127  
      962    24635
      963    24636        /*F*  NAME: KZR$KILL_LINE;
      964    24637              PURPOSE:
      965    24638                 To provide a procedure to report a line KILL event to CLM
      966    24639                                                                           */
      967    24640
      968    24641
      969    24642    1   KZR$KILL_LINE: ENTRY (EVENT_FPT) ALTRET;

  24642   1 000930  D380 0000 0000  xent KZR$KILL_LINE   LNJ,B5   X6A_AUTO_1
          1 000933       00A3 0001                       DC       163,1

      970    24643
      971    24644    1         LCTX$=ADDR(EVENT_FPT);

  24644   1 000935  ECC7 0004                            LDB,B6   @EVENT_FPT,AUTO
          1 000937  EFC7 0088                            STB,B6   LCTX$,AUTO

      972    24645    1         CALL KILL_LINE;

  24645   1 000939  E3C0 0005                            LNJ,B6   s:0,PREL
          1 00093B       0001                            DC       s:24646,PREL

      973    24646    1         RETURN;

  24646   1 00093C  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      974    24647
      975    24648
      976    24649        /*    Report KILL event to CLM                                     */
      977    24650
      978    24651    1   KILL_LINE: PROC;

  24651   1 00093F  EFC7 0096            KILL_LINE       STB,B6   SZ+2,AUTO

      979    24652
      980    24653    2         KZ_EVENT=CNCDSC_EVENT;
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:128  

  24653   1 000941  AB80 0000 0000  00                   LAB,B2   KV_USRPRM
          1 000944  2C72                                 LDV,R2   114
          1 000945  6C1C                                 LDV,R6   28
          1 000946  BB87                                 LAB,B3   ,AUTO
          1 000947  3C6A                                 LDV,R3   106
          1 000948  0008                                 MMM

      981    24654    2         KZ_EVENT.EVENT=%KZ#CLM_EVENT_KILLED;

  24654   1 000949  6C07                                 LDV,R6   7
          1 00094A  EF47 0035                            STR,R6   KZ_EVENT,AUTO

      982    24655    2         KZ_EVENT.LINCTX$=LCTX$;

  24655   1 00094C  ECC7 0088                            LDB,B6   LCTX$,AUTO
          1 00094E  EFC7 0038                            STB,B6   KZ_EVENT+3,AUTO

      983    24656    2         KZ_EVENT.TERMID$=ADDR(KZ$LINCTX.LINID);

  24656   1 000950  DBC6 0004                            LAB,B5   4,B6
          1 000952  DFC7 003A                            STB,B5   KZ_EVENT+5,AUTO

      984    24657    2         CALL KZR_CNCDSC@ (KZ_EVENT);

  24657   1 000954  CBC7 0035                            LAB,B4   KZ_EVENT,AUTO
          1 000956  CFC7 009E                            STB,B4   ENTFLG+2,AUTO
          1 000958  BBC7 009E                            LAB,B3   ENTFLG+2,AUTO
          1 00095A  9C80 0000 0000  xsym                 LDB,B1   KZR_CNCDSC@
          1 00095D  CBF0 0100                            LAB,B4   256,IMO
          1 00095F  E381                                 LNJ,B6   ,B1
          1 000960       0001                            DC       s:24658,PREL

      985    24658    2         RETURN;

  24658   1 000961  ECC7 0096                            LDB,B6   SZ+2,AUTO
          1 000963  C3C6 0001                            LNJ,B4   1,B6
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:129  
      986    24659    2   END;
      987    24660
      988    24661    1   END KZR$RBT;
      989    24662        %EOD;

PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:130  
--  Include file information  --

   KV$VDO.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$INT.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KZ$INPBFR.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   KZ_BSC_C.:E05TOU  is referenced.
   KZ_HASP_C.:E05TOU  is referenced.
   KZ_3270_C.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KZ$RBT_M.:E05TOU  is referenced.
   KZ$OTPBFR.:E05TOU  is referenced.
   KZ$NJE_M.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:131  
   KZ_LIN_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
      No diagnostics issued in procedure KZR$RBT.
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:132  

 **** Variables and constants ****

  ****  Section 000 RoData KZR$RBT

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    39-0-0/w STRC(224)   r     1 CNCDSC_EVENT               0-0-0/w STRC(912)   r     1 KV_USRPRM
    47-0-0/w STRC(2080)  r     1 KZ@RBTSTT                 C9-0-0/w STRC(928)   r     1 KZ@SDVCTX
   104-0-0/w PTR         r     1 TRN$                     106-0-0/w STRC(336)   r     1 WRSYSLOG

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @EVENT_FPT                8C-0-0/w PTR         r     1 BFR$
    8A-0-0/w PTR         r     1 CTX$                      9C-0-0/b BIT         r     1 ENTFLG
    *0-0-0/w STRC(224)   r     1 EVENT_FPT                 4B-0-0/w STRC(336)   r     1 FPT_WRSYSLOG
    90-0-0/w UBIN(16)    r     1 I                         11-0-0/w STRC(400)   r     1 KV$VDH_CNC
    43-0-0/w STRC(128)   r     1 KV$VDH_DAT                2C-0-0/w STRC(32)    r     1 KV$VDH_DSC
    2A-0-0/w STRC(32)    r     1 KV$VDH_EVT                 6-0-0/w STRC(176)   r     1 KV$VDH_INT
    2E-0-0/w STRC(80)    r     1 KV$VDH_OTPMRK             33-0-0/w STRC(32)    r     1 KV@USRENT
    35-0-0/w STRC(224)   r     1 KZ_EVENT                  88-0-0/w PTR         r     1 LCTX$
    93-0-0/w UBIN(16)    r     1 LEV                       60-0-0/c CHAR(80)    r     1 LGNTXT
    94-0-0/w UBIN(16)    r     1 SZ                        8E-0-0/w PTR         r     1 TBFR$
    9A-0-0/w PTR         r     1 TBFR$                     91-0-0/w PTR         r     1 TPTR$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(400)   r     1 KV_VDH_CNC
     0-0-0/w STRC(128)   r     1 KV_VDH_DAT                 0-0-0/w STRC(32)    r     1 KV_VDH_DSC
     0-0-0/w STRC(32)    r     1 KV_VDH_EVT                 0-0-0/w UBIN(16)    r     1 KV_VDH_EVT_RQSOTP
     0-0-0/w STRC(176)   r     1 KV_VDH_INT                 0-0-0/w STRC(80)    r     1 KV_VDH_OTPMRK
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:133  
     0-0-0/w UBIN(16)    r     1 KZD_MINSP_FORPST           0-0-0/w EPTR        r     1 KZR_CNCDSC@
     0-0-0/w STRC(272)   r     1 KZ_BSCS_HDR                0-0-0/w STRC(272)   r     1 KZ_BSC_HDR
     0-0-0/w STRC(272)   r     1 KZ_HASPS_HDR               0-0-0/w STRC(272)   r     1 KZ_HASP_HDR
     0-0-0/w PTR         r     1 KZ_RBTVDHSTT$              0-0-0/w UBIN(16)    r     1 KZ_RBT_EBCI
     0-0-0/w PTR         r     1 KZ_USRPRM$                 0-0-0/w UBIN(16)    r     1 KZ_VDHTRCBFRBYTSIZ

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(128)   r     1 B$TERMINAL_ID              0-0-0/c UBIN(8)     r     1 BSCTXT(0:0)
     0-0-0/c CHAR(32)    r     1 CHR32                      0-0-0/w STRC(928)   r     1 DEVCTX
     0-0-0/w STRC(64)    r     1 ERRCTX                     0-0-0/c STRC(8)     r     1 HASPSRCB
     0-0-0/w STRC(48)    r     1 HSPBLK                     0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w STRC(224)   r     1 KL_HASPDEV                 0-0-0/w STRC(512)   r     1 KV$MRD
     0-0-0/w STRC(48)    r     1 KV$OTPMRK                  0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(8960)  r     1 KV$STT                     0-0-0/w STRC(499)   r     1 KV$TRNTBL
     0-0-0/w STRC(912)   r     1 KV$USRPRM                  0-0-0/w STRC(512)   r     1 KV$VDI
     0-0-0/w STRC(912)   r     1 KV@USRPRM                  0-0-0/w STRC(128)   r     1 KZ$INPBFR
     0-0-0/w STRC(2192)  r     1 KZ$LINCTX                  0-0-0/c STRC(320)   r     1 KZ$NJE_SIGNON
     0-0-0/w STRC(128)   r     1 KZ$OTPBFR                  0-0-0/w STRC(2080)  r     1 KZ_RBTSTT
     0-0-0/c ACHR        r     1 SSTR                       0-0-0/c CHAR(256)   r     1 Y$CHR


   Procedure KZR$RBT requires 2405 words for executable code.
   Procedure KZR$RBT requires 163 words of local(AUTO) storage.
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:134  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:135  
          MINI XREF LISTING

ALT_RET
     24039**LABEL   23857--CALLALT 23913--GOTO    24076--CALLALT
B$TERMINAL_ID
     19846**DCL     23784>>ASSIGN  23856>>IF      24563>>ASSIGN
B$TERMINAL_ID.LEV
     19850**DCL     23753>>IF      24141>>IF
B$TERMINAL_ID.TERM
     19850**DCL     19859--REDEF
B$TERMINAL_ID.TTYP
     19850**DCL     23855<<ASSIGN
BFR$
     23724**DCL     19588--IMP-PTR 19645--IMP-PTR 19744--IMP-PTR 19809--IMP-PTR 23715--IMP-PTR 23716--IMP-PTR
     23882<<ASSIGN  23891>>DOWHILE 23891>>DOWHILE 23891>>DOWHILE 23891>>DOWHILE 23904>>CALLBLT 23922>>ASSIGN
     23923>>ASSIGN  23927>>DOCASE  23931>>IF      23932>>ASSIGN  23934>>IF      23986>>ASSIGN  23998>>IF
     23998>>IF      24001>>IF      24003>>DOWHILE 24014>>CALLBLT 24026>>CALLBLT 24059>>IF      24059>>IF
     24059>>IF      24059>>IF      24059>>IF      24116<<ASSIGN  24117>>IF      24118>>ASSIGN  24276<<ASSIGN
     24277>>DOWHILE 24278>>IF      24281>>ASSIGN  24282<<ASSIGN  24282>>ASSIGN  24285>>ASSIGN  24286>>DOCASE
     24292>>IF      24293>>CALL    24293>>CALL    24294<>CALL    24296<<ASSIGN  24345<<ASSIGN  24346>>ASSIGN
     24405>>ASSIGN  24407>>ASSIGN  24408>>ASSIGN  24409>>ASSIGN  24413>>IF      24416>>DOINDEX 24417>>ASSIGN
     24417>>ASSIGN  24431>>ASSIGN  24432>>ASSIGN  24439>>IF      24481>>ASSIGN  24486<>CALL    24610>>ASSIGN
     24611>>ASSIGN  24612>>ASSIGN  24614>>ASSIGN  24618>>IF      24623>>ASSIGN  24626>>IF
BSCTXT
     23715**DCL     23891>>DOWHILE 23891>>DOWHILE 23891>>DOWHILE 23891>>DOWHILE
CHR32
     23718**DCL     23941--ASSIGN  23966--ASSIGN  24045--ASSIGN
CNCDSC_EVENT
     21940**DCL     24033>>ASSIGN  24151>>ASSIGN  24653>>ASSIGN
CTX$
     23723**DCL     18845--IMP-PTR 23760<>CALL    23782>>ASSIGN  23784>>ASSIGN  23785>>ASSIGN  23786>>ASSIGN
     23787>>ASSIGN  23788>>ASSIGN  23795>>ASSIGN  23798>>ASSIGN  23853<<ASSIGN  23854>>DOWHILE 23855>>ASSIGN
     23856>>IF      23860<<ASSIGN  23860>>ASSIGN  24118<<ASSIGN  24144<<ASSIGN  24150>>IF      24158>>DOWHILE
     24160>>IF      24163>>IF      24168>>ASSIGN  24170>>ASSIGN  24171>>ASSIGN  24172<<ASSIGN  24172>>ASSIGN
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:136  
     24176>>CALL    24191>>ASSIGN  24191>>ASSIGN  24192>>IF      24193>>ASSIGN  24195>>ASSIGN  24198>>ASSIGN
     24199>>ASSIGN  24199>>ASSIGN  24204>>ASSIGN  24205>>ASSIGN  24224>>ASSIGN  24227>>ASSIGN  24228<<ASSIGN
     24228>>ASSIGN  24259<<ASSIGN  24260>>ASSIGN  24262>>IF      24262>>IF      24262>>IF      24265>>ASSIGN
     24266>>IF      24267<<ASSIGN  24267>>ASSIGN  24268>>IF      24275>>ASSIGN  24276>>ASSIGN  24278>>IF
     24278>>IF      24290>>IF      24299>>IF      24300>>ASSIGN  24302>>ASSIGN  24318<<ASSIGN  24319>>ASSIGN
     24320>>IF      24321>>ASSIGN  24322>>ASSIGN  24346<<ASSIGN  24347>>ASSIGN  24389>>ASSIGN  24389>>ASSIGN
     24390>>IF      24391>>ASSIGN  24393>>ASSIGN  24396>>ASSIGN  24397>>ASSIGN  24397>>ASSIGN  24404>>IF
     24405>>ASSIGN  24407>>ASSIGN  24408>>ASSIGN  24429>>IF      24429>>IF      24440>>ASSIGN  24440>>ASSIGN
     24441>>IF      24441>>IF      24441>>IF      24446>>ASSIGN  24447>>ASSIGN  24456>>ASSIGN  24458>>IF
     24458>>IF      24460>>ASSIGN  24515>>IF      24555>>ASSIGN  24561>>ASSIGN  24578>>ASSIGN  24613>>IF
     24618>>IF
DBLK_INP
     24076**LABEL   23911--GOTO
DEVCTX
     18845**DCL     23759--ASSIGN  23782<<ASSIGN  24091<>CALL    24105<>CALL    24173--CALL    24176<>CALL
DEVCTX.ACCESS_METHOD
     19072**DCL     24613>>IF
DEVCTX.DFR.DSCI
     19050**DCL     24224<<ASSIGN  24320>>IF      24321<<ASSIGN  24429>>IF
DEVCTX.DFRHD$
     18912**DCL     24262>>IF      24275--ASSIGN  24276>>ASSIGN  24299--IF      24407<<ASSIGN  24441>>IF
DEVCTX.DFRTL$
     18917**DCL     24300<<ASSIGN  24302<<ASSIGN  24404>>IF      24405>>ASSIGN  24408<<ASSIGN
DEVCTX.DSC
     19031**DCL     24160>>IF      24429>>IF
DEVCTX.DSC.TOLD_VDH
     19036**DCL     24204<<ASSIGN  24322<<ASSIGN
DEVCTX.DSC.VDH_FINAL
     19039**DCL     24278>>IF      24290>>IF      24515>>IF
DEVCTX.FLAGS.BINARY_OK
     18998**DCL     24618>>IF
DEVCTX.FLAGS.SUSPEND_IN
     18962**DCL     24265<<ASSIGN
DEVCTX.FLAGS.SUSPEND_OUT
     18969**DCL     24205<<ASSIGN
DEVCTX.FLAGS.THROTL
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:137  
     19025**DCL     24458>>IF      24460<<ASSIGN
DEVCTX.LCLENDPNTID
     18867**DCL     23784<<ASSIGN  23856>>IF
DEVCTX.LCLENDPNTID.TERM
     18869**DCL     18878--REDEF
DEVCTX.LCLENDPNTID.TTYP
     18869**DCL     23855>>ASSIGN
DEVCTX.LIN$
     18896**DCL     23786<<ASSIGN  24260>>ASSIGN  24319>>ASSIGN  24347>>ASSIGN
DEVCTX.LNK$
     18846**DCL     23792>>DOWHILE 23793>>ASSIGN  23795<<ASSIGN  23860>>ASSIGN  24168>>ASSIGN  24170<<ASSIGN
     24170>>ASSIGN  24172>>ASSIGN  24228>>ASSIGN  24267>>ASSIGN
DEVCTX.MGR_TYPE
     19064**DCL     19066--REDEF   24262>>IF      24262>>IF      24266>>IF
DEVCTX.OTPBYTES
     18921**DCL     24440<<ASSIGN  24440>>ASSIGN  24441>>IF      24447>>ASSIGN  24456<<ASSIGN  24458>>IF
DEVCTX.OTPHD$
     18901**DCL     24441>>IF
DEVCTX.RCB_CODE
     19082**DCL     23787<<ASSIGN
DEVCTX.STATE
     18884**DCL     23785<<ASSIGN
DEVCTX.SUSBIT_MASK
     19077**DCL     23788<<ASSIGN
DEVCTX.VDI$
     18891**DCL     24163>>IF      24191>>ASSIGN  24191>>ASSIGN  24192>>IF      24193>>ASSIGN  24195>>ASSIGN
     24198>>ASSIGN  24199>>ASSIGN  24199>>ASSIGN  24278>>IF      24389>>ASSIGN  24389>>ASSIGN  24390>>IF
     24391>>ASSIGN  24393>>ASSIGN  24396>>ASSIGN  24397>>ASSIGN  24397>>ASSIGN  24561<<ASSIGN  24578<<ASSIGN
DFR
     24273**PROC    24210--CALL    24261--CALL    24269--CALL    24326--CALL
DFRDSC
     24224**LABEL   24200--GOTO
DFRREL IN PROCEDURE RELOTP
     24404**LABEL   24398--GOTO
ENTFLG IN PROCEDURE RELOTP
     24371**DCL     24374<<ASSIGN  24497>>IF      24514<<ASSIGN
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:138  
ERRCTX.DVCTX$
     19727**DCL     24446<<ASSIGN
ERRCTX.LCTX$
     19726**DCL     19727--REDEF   23942<<ASSIGN  23967<<ASSIGN
ERRCTX.SNDFCS
     19728**DCL     19729--REDEF
ERRCTX.VAL1
     19729**DCL     24447<<ASSIGN
EVENT_FPT
     23427**DCL        53--PROC    24257--ENTRY   24259--ASSIGN  24316--ENTRY   24318--ASSIGN  24343--ENTRY
     24345--ASSIGN  24642--ENTRY   24644--ASSIGN
EVENT_FPT.CHN$
     23440**DCL     23783>>ASSIGN
EVENT_FPT.CHNCTX$
     23431**DCL     23787>>ASSIGN  23788>>ASSIGN
EVENT_FPT.EVENT
     23428**DCL     23743>>DOCASE
EVENT_FPT.LINCTX$
     23434**DCL     23742>>ASSIGN
EVENT_FPT.TERMID$
     23437**DCL     23753>>IF      23784>>ASSIGN  23855>>ASSIGN  23856>>IF      24141>>IF      24154>>ASSIGN
     24563>>ASSIGN
FPT_WRSYSLOG
     23631**DCL     23765<<ASSIGN  23769<>CALL    23938<<ASSIGN  23943<>CALL    23963<<ASSIGN  23968<>CALL
     24042<<ASSIGN  24046<>CALL    24443<<ASSIGN  24448<>CALL
FPT_WRSYSLOG.BUF_
     23633**DCL     23941<<ASSIGN  23966<<ASSIGN  24045<<ASSIGN
FPT_WRSYSLOG.V.ERRCODE.ERR#
     23679**DCL     23766<<ASSIGN  23940<<ASSIGN  23965<<ASSIGN  24044<<ASSIGN  24445<<ASSIGN
FPT_WRSYSLOG.V.TERMID
     23698**DCL     23767<<ASSIGN  23939<<ASSIGN  23964<<ASSIGN  24043<<ASSIGN  24444<<ASSIGN
FPT_WRSYSLOG.V.TERMID.TERM
     23700**DCL     23709--REDEF
FPT_WRSYSLOG.V.VALUES
     23711**DCL     23768<<ASSIGN  23942--ASSIGN  23967--ASSIGN  24446--ASSIGN  24447--ASSIGN
GETOTP
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:139  
     24116**LABEL   24124--GOTO
HASPSRCB.SKIP_TO
     19627**DCL     19628--REDEF
HASPSRCB.V.BIN
     19626**DCL     24618>>IF
HASPSRCB.VFC_TYPE
     19623**DCL     19624--REDEF
HSPBLK.BCB.CNT
     19593**DCL     23931>>IF      23932>>ASSIGN  23934>>IF      23986>>ASSIGN
HSPBLK.BCB.CTL
     19591**DCL     23927>>DOCASE
HSPBLK.FCS
     19594**DCL     23923>>ASSIGN
HSPBLK.FCS.WAB
     19596**DCL     23922>>ASSIGN
HSPBLK.FLG
     19603**DCL     23998>>IF      23998>>IF      24001>>IF      24059>>IF      24059>>IF      24059>>IF
     24059>>IF      24059>>IF
HSPBLK.TXT
     19606**DCL     24003>>DOWHILE 24014--CALLBLT
I
     23726**DCL     23716--IMP-SIZ 23890<<ASSIGN  23891>>DOWHILE 23891>>DOWHILE 23891>>DOWHILE 23891>>DOWHILE
     23891>>DOWHILE 23891>>DOWHILE 23896<<ASSIGN  23896>>ASSIGN  23904>>CALLBLT 23904>>CALLBLT 24002<<ASSIGN
     24003>>DOWHILE 24003>>DOWHILE 24003>>DOWHILE 24005<<ASSIGN  24005>>ASSIGN  24014>>CALLBLT 24014>>CALLBLT
     24018<<ASSIGN  24026>>CALLBLT 24035>>ASSIGN  24416<<DOINDEX 24417>>ASSIGN  24481<<ASSIGN  24486<>CALL
KH$CHN.BLOCK
     18799**DCL     24556>>ASSIGN
KH$CHN.TERMID.TERM
     18819**DCL     18828--REDEF
KH$CHN.TERMID.TTYP
     18819**DCL     23783<<ASSIGN
KH$CHN.UNBLOCK
     18799**DCL     24458>>IF
KHA$ERRLOG
     23511**DCL-ENT 23769--CALL    23943--CALL    23968--CALL    24046--CALL    24448--CALL
KHI$DISABLE
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:140  
     23512**DCL-ENT 23757--CALL    24484--CALL
KHI$ENABLE
     23513**DCL-ENT 23828--CALL    24490--CALL
KILL_LINE
     24651**PROC    23978--CALL    24055--CALL    24645--CALL
KL_HASPDEV.DADR.DEVCTL
     20091**DCL     23788>>ASSIGN
KL_HASPDEV.DADR.DEVNUM#
     20071**DCL     23787>>ASSIGN
KL_HASPDEV.TERMID.TERM
     20026**DCL     20035--REDEF
KV$MRD.MINSP_FORPST
     21269**DCL     24591<<ASSIGN
KV$OTPMRK
     21382**DCL     24417--ASSIGN  24419>>ASSIGN
KV$OTPMRK.ID
     21387**DCL     21387--REDEF   21388--REDEF
KV$PTR.INPCNDPND
     21417**DCL     21426--REDEF   21430--REDEF
KV$PTR.LINLST$
     21413**DCL     21414--REDEF
KV$PTR.MRD$
     21412**DCL     24591>>ASSIGN
KV$PTR.VDI$
     21411**DCL     24218>>ASSIGN  24473>>IF      24474>>ASSIGN  24504>>ASSIGN  24564>>ASSIGN  24565>>ASSIGN
     24566>>ASSIGN  24567>>ASSIGN  24568>>ASSIGN  24569>>ASSIGN  24570>>ASSIGN  24571>>ASSIGN
KV$PTR$
     21405**DCL     21411--IMP-PTR 24194>>ASSIGN  24195<<ASSIGN  24218>>ASSIGN  24220<<ASSIGN  24392>>ASSIGN
     24393<<ASSIGN  24473>>IF      24474>>ASSIGN  24504>>ASSIGN  24506<<ASSIGN  24532>>ASSIGN  24564>>ASSIGN
     24565>>ASSIGN  24566>>ASSIGN  24567>>ASSIGN  24568>>ASSIGN  24569>>ASSIGN  24570>>ASSIGN  24571>>ASSIGN
     24587<<ASSIGN  24591>>ASSIGN  24600<<ASSIGN
KV$SSN.REDRSPCNT
     21462**DCL     21463--REDEF
KV$STT
     21539**DCL     23801--ASSIGN  23803<<ASSIGN
KV$STT.REQSTATS.DSPENT
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:141  
     21791**DCL     23814<<ASSIGN
KV$STT.REQSTATS.DSPMSK
     21785**DCL     21791--REDEF
KV$STT.REQSTATS.FNC
     21703**DCL     23813<<ASSIGN
KV$STT.REQSTATS.SLCENT
     21833**DCL     23804<<ASSIGN  23805<<ASSIGN
KV$STT.REQSTATS.SLCMSK
     21826**DCL     21833--REDEF
KV$STT.USRENTCNT
     21895**DCL     24191<<ASSIGN  24191>>ASSIGN  24389<<ASSIGN  24389>>ASSIGN
KV$STT.USRENTDFRCNT
     21896**DCL     24199<<ASSIGN  24199>>ASSIGN  24397<<ASSIGN  24397>>ASSIGN
KV$TRNTBL.INPTRN1$
     20970**DCL     23904>>CALLBLT 24014>>CALLBLT 24026>>CALLBLT
KV$TRNTBL.OTPESCCHR
     20973**DCL     20973--REDEF
KV$USRPRM.STT$
     21191**DCL     24191>>ASSIGN  24191>>ASSIGN  24199>>ASSIGN  24199>>ASSIGN  24389>>ASSIGN  24389>>ASSIGN
     24397>>ASSIGN  24397>>ASSIGN
KV$VDH_CNC
     20277**DCL     24560<<ASSIGN  24572<>CALL
KV$VDH_CNC.LCLENDPNTID
     20327**DCL     24563<<ASSIGN
KV$VDH_CNC.LCLENDPNTID.TERM
     20329**DCL     20338--REDEF
KV$VDH_DAT
     22123**DCL     24609<<ASSIGN  24625<>CALL    24629<>CALL
KV$VDH_DAT.CMPCOD
     22163**DCL     24628<<ASSIGN
KV$VDH_DAT.CTN
     22130**DCL     24623<<ASSIGN
KV$VDH_DAT.DATCTRCHR
     22165**DCL     24614<<ASSIGN
KV$VDH_DAT.DATCTRCHRTYP
     22130**DCL     24615<<ASSIGN
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:142  
KV$VDH_DAT.DATMOD
     22131**DCL     24622<<ASSIGN
KV$VDH_DAT.DAT__.ADR$
     22159**DCL     24611<<ASSIGN
KV$VDH_DAT.DAT__.BFRBYTSIZ
     22160**DCL     24610<<ASSIGN
KV$VDH_DAT.DAT__.DATBYTSIZ
     22159**DCL     24612<<ASSIGN  24624>>IF      24627<<ASSIGN
KV$VDH_DSC
     20567**DCL     24206<<ASSIGN  24209<>CALL    24323<<ASSIGN  24325<>CALL
KV$VDH_DSC.NO_IO
     20573**DCL     24208<<ASSIGN
KV$VDH_DSC.RSN
     20573**DCL     24207<<ASSIGN  24324<<ASSIGN
KV$VDH_EVT
     20461**DCL     24575<<ASSIGN  24577<>CALL
KV$VDH_EVT.ID
     20467**DCL     24576<<ASSIGN
KV$VDH_INT
     20123**DCL     24552<<ASSIGN  24558<>CALL
KV$VDH_INT.CHN$
     20129**DCL     24554<<ASSIGN
KV$VDH_INT.RCVFLWCTRMAXCRD
     20130**DCL     24556<<ASSIGN
KV$VDH_INT.TRCBFRBYTSIZ
     20131**DCL     24557<<ASSIGN
KV$VDH_INT.USRCTX$
     20129**DCL     24555<<ASSIGN
KV$VDH_INT.USRPRM$
     20130**DCL     24553<<ASSIGN
KV$VDH_INT.VDI$
     20130**DCL     24561>>ASSIGN
KV$VDH_OTPMRK
     20666**DCL     24418<<ASSIGN  24433<>CALL
KV$VDH_OTPMRK.CMPCOD
     20699**DCL     24432<<ASSIGN
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:143  
KV$VDH_OTPMRK.DAT
     20693**DCL     24419<<ASSIGN
KV$VDH_OTPMRK.DAT.ID
     20696**DCL     20696--REDEF   20697--REDEF
KV$VDI.ASNINPPTR$
     21314**DCL     24195>>ASSIGN  24393>>ASSIGN
KV$VDI.BSY
     21348**DCL     24192>>IF      24193<<ASSIGN  24218<<ASSIGN  24390>>IF      24391<<ASSIGN  24504<<ASSIGN
KV$VDI.DFR.USR
     21345**DCL     24198<<ASSIGN  24396<<ASSIGN
KV$VDI.INPUNT
     21354**DCL     24571<<ASSIGN
KV$VDI.RQSOTP
     21349**DCL     24473>>IF      24474<<ASSIGN
KV$VDI.USREVTENB
     21356**DCL     24564<<ASSIGN  24565<<ASSIGN  24566<<ASSIGN  24567<<ASSIGN  24568<<ASSIGN  24569<<ASSIGN
     24570<<ASSIGN
KV$VDI.USRPRM$
     21314**DCL     24191>>ASSIGN  24191>>ASSIGN  24199>>ASSIGN  24199>>ASSIGN  24389>>ASSIGN  24389>>ASSIGN
     24397>>ASSIGN  24397>>ASSIGN
KV$VDI.USRRQSDAT.RED
     21354**DCL     24278>>IF
KV@USRENT.SVDPTR$
     21924**DCL     24194<<ASSIGN  24220>>ASSIGN  24392<<ASSIGN  24506>>ASSIGN  24532<<ASSIGN  24587>>ASSIGN
     24600>>ASSIGN
KV@USRPRM
     21215**DCL     23818--ASSIGN  23821<<ASSIGN
KV@USRPRM.INHLVL
     21215**DCL     23823<<ASSIGN
KV@USRPRM.STT$
     21242**DCL     23822<<ASSIGN
KVB$GETSYS
     23502**DCL-ENT 23760--CALL    23802--CALL    23807--CALL    23819--CALL
KVB$RLS
     23503**DCL-ENT 24173--CALL    24293--CALL    24294--CALL
KVB$RLS2NSYS
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:144  
     23504**DCL-ENT 24486--CALL
KVV$INT
     23501**DCL-ENT 24558--CALL
KVV$VDI
     23500**DCL-ENT 24209--CALL    24325--CALL    24433--CALL    24475--CALL    24572--CALL    24577--CALL
     24625--CALL    24629--CALL
KV_USRPRM
     21113**DCL     23821>>ASSIGN
KV_VDH_CNC
     20369**DCL     24560>>ASSIGN
KV_VDH_CNC.LCLENDPNTID.TERM
     20421**DCL     20430--REDEF
KV_VDH_DAT
     20203**DCL     24609>>ASSIGN
KV_VDH_DSC
     20531**DCL     24206>>ASSIGN  24323>>ASSIGN
KV_VDH_EVT
     20496**DCL     24575>>ASSIGN
KV_VDH_EVT_RQSOTP
     20638**DCL     24475<>CALL
KV_VDH_INT
     20160**DCL     24552>>ASSIGN
KV_VDH_INT.USRPRM$
     20167**DCL     21139--DCLINIT
KV_VDH_OTPMRK
     20603**DCL     24418>>ASSIGN
KV_VDH_OTPMRK.DAT.ID
     20633**DCL     20633--REDEF   20634--REDEF
KZ$INPBFR
     19809**DCL     24294--CALL
KZ$INPBFR.BFR_SIZ
     19824**DCL     24293>>CALL    24610>>ASSIGN
KZ$INPBFR.BYTX
     19826**DCL     24614>>ASSIGN  24618--IF
KZ$INPBFR.DATA$
     19828**DCL     24292>>IF      24293<>CALL    24611>>ASSIGN
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:145  
KZ$INPBFR.DATA_SIZ
     19822**DCL     24612>>ASSIGN
KZ$INPBFR.FLAGS.CTN#
     19819**DCL     24623>>ASSIGN
KZ$INPBFR.FLAGS.LAST#
     19817**DCL     24626>>IF
KZ$INPBFR.LNK$
     19810**DCL     24282>>ASSIGN
KZ$LINCTX
     19155**DCL     23779<>CALL    23942--ASSIGN  23967--ASSIGN  24076<>CALL    24122<>CALL
KZ$LINCTX.BCB.RCV
     19447**DCL     23931>>IF      23932<<ASSIGN  23934>>IF      23986<<ASSIGN
KZ$LINCTX.CHN$
     19158**DCL     24458>>IF      24554>>ASSIGN  24556>>ASSIGN
KZ$LINCTX.CTRHD$
     19156**DCL     23790>>IF      23791>>ASSIGN  23798<<ASSIGN  23853>>ASSIGN  24091>>CALL    24105>>CALL
     24144>>ASSIGN  24168<<ASSIGN  24230>>IF
KZ$LINCTX.DSCRSN
     19326**DCL     24207>>ASSIGN  24324>>ASSIGN
KZ$LINCTX.FLAGS.RCVWAB
     19265**DCL     23919<<ASSIGN  23922<<ASSIGN
KZ$LINCTX.FLAGS.SIGNON
     19294**DCL     23888>>IF      23889<<ASSIGN  23992>>IF      24000<<ASSIGN
KZ$LINCTX.INHLVL
     19316**DCL     23756>>ASSIGN  23823>>ASSIGN  23826>>IF      24483>>ASSIGN  24488>>IF
KZ$LINCTX.INPBFR$
     19461**DCL     23882>>ASSIGN  23941>>ASSIGN  23966>>ASSIGN  24045>>ASSIGN
KZ$LINCTX.INPDATSIZ
     19465**DCL     23891>>DOWHILE 23918>>IF      24003>>DOWHILE
KZ$LINCTX.LINID
     19176**DCL     23767>>ASSIGN  23939>>ASSIGN  23964>>ASSIGN  24043>>ASSIGN  24444>>ASSIGN  24656--ASSIGN
KZ$LINCTX.LINID.TERM
     19178**DCL     19187--REDEF
KZ$LINCTX.OTPCNT
     19443**DCL     19446--REDEF
KZ$LINCTX.OTPDATSIZ
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:146  
     19471**DCL     24123>>IF
KZ$LINCTX.OTPHD$
     19456**DCL     24116>>ASSIGN  24119<<ASSIGN  24123>>IF      24441>>IF
KZ$LINCTX.POLSIZ
     19489**DCL     19491--REDEF   23799<<ASSIGN  23799>>ASSIGN
KZ$LINCTX.POLX
     19509**DCL     23840<<ASSIGN
KZ$LINCTX.PRO.BLKBYTES
     19346**DCL     24440>>ASSIGN
KZ$LINCTX.PRO.IRSCHR
     19380**DCL     23891>>DOWHILE
KZ$LINCTX.PRO.PROTYP
     19339**DCL     23883>>IF      23883>>IF      24059>>IF      24089>>IF      24103>>IF      24618>>IF
     24618>>IF
KZ$LINCTX.PTHSTT
     19193**DCL     23910>>IF
KZ$LINCTX.RCVFCS
     19318**DCL     23923<<ASSIGN
KZ$NJE_SIGNON.NCC.ILPAS_INIT
     19696**DCL     19697--REDEF
KZ$NJE_SIGNON.NCC.INODE
     19663**DCL     24018--ASSIGN  24026>>CALLBLT
KZ$NJE_SIGNON.NCC.INODE_INIT
     19662**DCL     19663--REDEF
KZ$NJE_SIGNON.NCC.INPAS_INIT
     19700**DCL     19701--REDEF
KZ$OTPBFR.BFRSIZ
     19787**DCL     24417>>ASSIGN  24481>>ASSIGN
KZ$OTPBFR.CMPCOD
     19790**DCL     24431<<ASSIGN  24432>>ASSIGN
KZ$OTPBFR.DEV$
     19795**DCL     24118>>ASSIGN  24346>>ASSIGN
KZ$OTPBFR.FLAGS.CNT#
     19759**DCL     24439>>IF
KZ$OTPBFR.LNK$
     19745**DCL     24285<<ASSIGN  24285>>ASSIGN  24296>>ASSIGN  24405<<ASSIGN  24409<<ASSIGN
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:147  
KZ$OTPBFR.MRKCNT
     19792**DCL     24413>>IF      24416>>DOINDEX
KZ$OTPBFR.TYP
     19747**DCL     24278>>IF      24286>>DOCASE
KZ@RBTSTT
     22673**DCL     23812>>ASSIGN
KZ@RBTSTT.REQSTATS.DSPMSK
     22922**DCL     22928--REDEF
KZ@RBTSTT.REQSTATS.SLCMSK
     22963**DCL     22970--REDEF
KZ@SDVCTX
     23112**DCL     23782>>ASSIGN
KZ@SDVCTX.LCLENDPNTID.TERM
     23136**DCL     23145--REDEF
KZ@SDVCTX.MGR_TYPE
     23331**DCL     23333--REDEF
KZD$ACKSIGNON
     23505**DCL-ENT 24105--CALL
KZD$DEVMGR
     23514**DCL-ENT 21140--DCLINIT
KZD$DQ
     23515**DCL-ENT 24176--CALL
KZD$SNDSIGNON
     23506**DCL-ENT 24091--CALL
KZD_MINSP_FORPST
     22172**DCL     24591>>ASSIGN
KZL$BBLK
     23507**DCL-ENT 24122--CALL
KZL$DBLK
     23508**DCL-ENT 24076--CALL
KZR$KILL_LINE
     24642**ENTRY   23779--CALL
KZR_CNCDSC@
     23509**DCL     24037>>CALL    24155>>CALL    24657>>CALL
KZ_BSCS_HDR.STTBFR$
     22266**DCL     23810<<ASSIGN
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:148  
KZ_BSC_HDR.STTBFR$
     22242**DCL     23809<<ASSIGN
KZ_EVENT
     22022**DCL     24033<<ASSIGN  24037<>CALL    24151<<ASSIGN  24155<>CALL    24653<<ASSIGN  24657<>CALL
KZ_EVENT.EVENT
     22023**DCL     24034<<ASSIGN  24152<<ASSIGN  24654<<ASSIGN
KZ_EVENT.LGNVEC
     22038**DCL     24035<<ASSIGN
KZ_EVENT.LINCTX$
     22029**DCL     24036<<ASSIGN  24153<<ASSIGN  24655<<ASSIGN
KZ_EVENT.TERMID$
     22032**DCL     24154<<ASSIGN  24656<<ASSIGN
KZ_HASPS_HDR.STTBFR$
     22218**DCL     23811<<ASSIGN
KZ_HASP_HDR.STTBFR$
     22194**DCL     23808<<ASSIGN
KZ_RBTSTT
     22292**DCL     23806--ASSIGN  23812<<ASSIGN
KZ_RBTSTT.REQSTATS.DSPENT
     22547**DCL     23815<<ASSIGN
KZ_RBTSTT.REQSTATS.DSPMSK
     22541**DCL     22547--REDEF
KZ_RBTSTT.REQSTATS.SLCENT
     22589**DCL     23816<<ASSIGN  23817<<ASSIGN
KZ_RBTSTT.REQSTATS.SLCMSK
     22582**DCL     22589--REDEF
KZ_RBTVDHSTT$
     22175**DCL     23800>>IF      23802<>CALL    23803>>ASSIGN  23804>>ASSIGN  23805>>ASSIGN  23813>>ASSIGN
     23814>>ASSIGN  23822>>ASSIGN
KZ_RBT_EBCI
     22174**DCL     23498--DCLINIT 23904--CALLBLT 24014--CALLBLT 24026--CALLBLT
KZ_USRPRM$
     22176**DCL     23820<<ASSIGN  24553>>ASSIGN
KZ_VDHTRCBFRBYTSIZ
     22177**DCL     24557>>ASSIGN
LCTX$
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:149  
     23722**DCL     19155--IMP-PTR 23742<<ASSIGN  23756>>ASSIGN  23767>>ASSIGN  23779>>CALL    23786>>ASSIGN
     23790>>IF      23791>>ASSIGN  23798>>ASSIGN  23799>>ASSIGN  23799>>ASSIGN  23823>>ASSIGN  23826>>IF
     23840>>ASSIGN  23853>>ASSIGN  23882>>ASSIGN  23883>>IF      23883>>IF      23888>>IF      23889>>ASSIGN
     23891>>DOWHILE 23891>>DOWHILE 23910>>IF      23918>>IF      23919>>ASSIGN  23922>>ASSIGN  23923>>ASSIGN
     23931>>IF      23932>>ASSIGN  23934>>IF      23939>>ASSIGN  23941>>ASSIGN  23942>>ASSIGN  23964>>ASSIGN
     23966>>ASSIGN  23967>>ASSIGN  23986>>ASSIGN  23992>>IF      24000>>ASSIGN  24003>>DOWHILE 24036>>ASSIGN
     24043>>ASSIGN  24045>>ASSIGN  24059>>IF      24076>>CALL    24089>>IF      24091>>CALL    24103>>IF
     24105>>CALL    24116>>ASSIGN  24119>>ASSIGN  24122>>CALL    24123>>IF      24123>>IF      24144>>ASSIGN
     24153>>ASSIGN  24168>>ASSIGN  24207>>ASSIGN  24230>>IF      24260<<ASSIGN  24319<<ASSIGN  24324>>ASSIGN
     24347<<ASSIGN  24440>>ASSIGN  24441>>IF      24444>>ASSIGN  24458>>IF      24483>>ASSIGN  24488>>IF
     24554>>ASSIGN  24556>>ASSIGN  24618>>IF      24618>>IF      24644<<ASSIGN  24655>>ASSIGN  24656>>ASSIGN
LEV
     23728**DCL     23756<<ASSIGN  23757<>CALL    23826>>IF      24483<<ASSIGN  24484<>CALL    24488>>IF
LGNTXT
     23714**DCL     23904<<CALLBLT 24014<<CALLBLT 24026<<CALLBLT 24035--ASSIGN
LIN_ACK
     24033**LABEL   23907--GOTO
NOOTP
     24126**LABEL   24122--CALLALT
NO_MEMORY
     23765**LABEL   23802--CALLALT 23807--CALLALT 23819--CALLALT
NXTDEV
     24227**LABEL   24161--GOTO
RELOTP
     24368**PROC    24120--CALL    24348--CALL
RELOTP1 IN PROCEDURE RELOTP
     24413**LABEL   24518--GOTO
RELOTP2 IN PROCEDURE RELOTP
     24439**LABEL   24516--GOTO
RELOTPDFR IN PROCEDURE RELOTP
     24513**ENTRY   24288--CALL
REPLINDSC
     24151**LABEL   24231--GOTO
SNDINP
     24607**PROC    24291--CALL
SSTR
PL6.E3A0      #001=KZR$RBT File=KZR$RBT.:E05TSI                                  WED 07/30/97 02:59 Page:150  
     23716**DCL     23904>>CALLBLT 24014>>CALLBLT 24035--ASSIGN
SZ
     23729**DCL     23759<<ASSIGN  23760<>CALL    23768>>ASSIGN  23801<<ASSIGN  23802<>CALL    23806<<ASSIGN
     23807<>CALL    23818<<ASSIGN  23819<>CALL
TBFR$
     23725**DCL     24171<<ASSIGN  24173<>CALL    24275<<ASSIGN  24281<<ASSIGN  24285>>ASSIGN  24296>>ASSIGN
     24299>>IF      24302>>ASSIGN
TBFR$ IN PROCEDURE RELOTP
     24370**DCL     24417<<ASSIGN  24419>>ASSIGN
TELALT IN PROCEDURE TELLVDH
     24578**LABEL   24558--CALLALT
TELLVDH
     24524**PROC    23857--CALL
TPTR$
     23727**DCL     21215--IMP-PTR 22292--IMP-PTR 23791<<ASSIGN  23792>>DOWHILE 23793<<ASSIGN  23793>>ASSIGN
     23795>>ASSIGN  23807<>CALL    23808>>ASSIGN  23809>>ASSIGN  23810>>ASSIGN  23811>>ASSIGN  23812>>ASSIGN
     23815>>ASSIGN  23816>>ASSIGN  23817>>ASSIGN  23819<>CALL    23820>>ASSIGN  23821>>ASSIGN  23822>>ASSIGN
     23823>>ASSIGN  24145<<ASSIGN  24167>>IF      24170>>ASSIGN  24227<<ASSIGN
TRN$
     23498**DCL     21140--DCLINIT
WRSYSLOG
     23535**DCL     23765>>ASSIGN  23938>>ASSIGN  23963>>ASSIGN  24042>>ASSIGN  24443>>ASSIGN
WRSYSLOG.V
     23539**DCL     23537--DCLINIT
WRSYSLOG.V.TERMID.TERM
     23604**DCL     23613--REDEF
XXXCNC IN PROCEDURE TELLVDH
     24575**LABEL   24572--CALLALT
Y$CHR
     23717**DCL     23904>>CALLBLT 24014>>CALLBLT 24026>>CALLBLT

PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:151  
      990        1        /*T***********************************************************/
      991        2        /*T*                                                         */
      992        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      993        4        /*T*                                                         */
      994        5        /*T***********************************************************/
      995        6        %EJECT;
PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:152  
      996        7        /*F*  NAME:  KZR$RBTSTATS
      997        8              PURPOSE:
      998        9                 To return VECTORs of the RBT and VDH stats buffers.
      999       10              CALL:
     1000       11                    CALL KZR$RBTSTATS (VDH-vector,RBT-vector);
     1001       12              PARAMETERS:
     1002       13                 Vectors describing the VDH and RBT statistics buffers are returned
     1003       14                 in VDH-vector and RBT-vector.
     1004       15              DESCRIPTION:
     1005       16                 This routine is called from the Common Line Manager via
     1006       17                 an EPTR in KZ_HASP_HDR.  Note that the other RBT header tables
     1007       18                 specify STTHND = ENTADDR(NIL) so this routine is only called once.
     1008       19                 All the RBT headers are set with the address of a common stats
     1009       20                 buffer to allow the CLM to update its data.
     1010       21        */
     1011       22        %EJECT;
PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:153  
     1012       23        KZR$RBTSTATS: PROC (V1,V2);
     1013       24
     1014       25        %INCLUDE KZ$BSCSTT;
     1015      131        %INCLUDE KZ$RBT_M;
     1016      690        %INCLUDE LCP_6;
     1017     4969        %INCLUDE KL_MACRO_C;
     1018     8321        %INCLUDE KL_AFCN_C;
     1019     8422        %INCLUDE K_ID_E;
     1020     8472        %INCLUDE KZ_HASP_C;
     1021     8814        %INCLUDE KV$GLB;
     1022     9233        %INCLUDE KV_GLBCNS_E;
     1023     9574        %INCLUDE KH$STT;
     1024     9604        %K#ENTID_E;
     1025     9623        %K#LYRID_E;
     1026     9630
     1027     9631        %KZ$SYNCSTAT;
     1028    10045
     1029    10046    1   DCL V1 VECTOR;
     1030    10047    1   DCL V2 VECTOR;
     1031    10048
     1032    10049        %KZ_HASP_HDR (STCLASS=SYMREF);
     1033    10073
     1034    10074    1   DCL KZ_RBTVDHSTT$ PTR SYMREF;
     1035    10075
     1036    10076        %KV$STT;
     1037    10470    1         V1 = VECTOR(KZ_RBTVDHSTT$->KV$STT);
     1038    10471    1         V2 = VECTOR(KZ_HASP_HDR.STTBFR$->KZ$SYNCSTAT);
     1039    10472    1         RETURN;
     1040    10473
     1041    10474    1   END KZR$RBTSTATS;
     1042    10475        %EOD;

PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:154  
--  Include file information  --

   KH$STT.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KZ_HASP_C.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KZ$RBT_M.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
      No diagnostics issued in procedure KZR$RBTSTATS.

   Procedure KZR$RBTSTATS requires 42 words for executable code.
   Procedure KZR$RBTSTATS requires 11 words of local(AUTO) storage.

PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:155  

 Object Unit name= KZR$RBTSTATS                               File name= KZR$RBT.:E05TOU
 UTS= JUL 30 '97 03:02:40.68 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none    42     2A  KZR$RBTSTATS

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        2  KZR$RBTSTATS

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZ_HASP_HDR                           KZ_RBTVDHSTT$                    r    G$ROS$
PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:156  


      990        1        /*T***********************************************************/
      991        2        /*T*                                                         */
      992        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      993        4        /*T*                                                         */
      994        5        /*T***********************************************************/
      995        6        %EJECT;
PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:157  
      996        7        /*F*  NAME:  KZR$RBTSTATS
      997        8              PURPOSE:
      998        9                 To return VECTORs of the RBT and VDH stats buffers.
      999       10              CALL:
     1000       11                    CALL KZR$RBTSTATS (VDH-vector,RBT-vector);
     1001       12              PARAMETERS:
     1002       13                 Vectors describing the VDH and RBT statistics buffers are returned
     1003       14                 in VDH-vector and RBT-vector.
     1004       15              DESCRIPTION:
     1005       16                 This routine is called from the Common Line Manager via
     1006       17                 an EPTR in KZ_HASP_HDR.  Note that the other RBT header tables
     1007       18                 specify STTHND = ENTADDR(NIL) so this routine is only called once.
     1008       19                 All the RBT headers are set with the address of a common stats
     1009       20                 buffer to allow the CLM to update its data.
     1010       21        */
     1011       22        %EJECT;
PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:158  
     1012       23        KZR$RBTSTATS: PROC (V1,V2);

     23   0 000000  D380 0000 0000  xent KZR$RBTSTATS    LNJ,B5   X6A_AUTO_2
          0 000003       000B 0002                       DC       11,2

     1013       24
     1014       25        %INCLUDE KZ$BSCSTT;
     1015      131        %INCLUDE KZ$RBT_M;
     1016      690        %INCLUDE LCP_6;
     1017     4969        %INCLUDE KL_MACRO_C;
     1018     8321        %INCLUDE KL_AFCN_C;
     1019     8422        %INCLUDE K_ID_E;
     1020     8472        %INCLUDE KZ_HASP_C;
     1021     8814        %INCLUDE KV$GLB;
     1022     9233        %INCLUDE KV_GLBCNS_E;
     1023     9574        %INCLUDE KH$STT;
     1024     9604        %K#ENTID_E;
     1025     9623        %K#LYRID_E;
     1026     9630
     1027     9631        %KZ$SYNCSTAT;
     1028    10045
     1029    10046    1   DCL V1 VECTOR;
     1030    10047    1   DCL V2 VECTOR;
     1031    10048
     1032    10049        %KZ_HASP_HDR (STCLASS=SYMREF);
     1033    10073
     1034    10074    1   DCL KZ_RBTVDHSTT$ PTR SYMREF;
     1035    10075
     1036    10076        %KV$STT;
     1037    10470    1         V1 = VECTOR(KZ_RBTVDHSTT$->KV$STT);

  10470   0 000005  EC80 0000 0000  xsym                 LDB,B6   KZ_RBTVDHSTT$
          0 000008  EFC7 0009                            STB,B6   @V2+3,AUTO
          0 00000A  E870 045F                            LDR,R6   1119,IMO
          0 00000C  EF47 0008                            STR,R6   @V2+2,AUTO
          0 00000E  ABC7 0008                            LAB,B2   @V2+2,AUTO
          0 000010  2C00                                 LDV,R2   0
PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:159  
          0 000011  6C06                                 LDV,R6   6
          0 000012  BCC7 0004                            LDB,B3   @V1,AUTO
          0 000014  3C00                                 LDV,R3   0
          0 000015  0008                                 MMM

     1038    10471    1         V2 = VECTOR(KZ_HASP_HDR.STTBFR$->KZ$SYNCSTAT);

  10471   0 000016  EC80 0000 0006  xsym                 LDB,B6   KZ_HASP_HDR+6
          0 000019  EFC7 0009                            STB,B6   @V2+3,AUTO
          0 00001B  E870 010B                            LDR,R6   267,IMO
          0 00001D  EF47 0008                            STR,R6   @V2+2,AUTO
          0 00001F  ABC7 0008                            LAB,B2   @V2+2,AUTO
          0 000021  2C00                                 LDV,R2   0
          0 000022  6C06                                 LDV,R6   6
          0 000023  BCC7 0006                            LDB,B3   @V2,AUTO
          0 000025  3C00                                 LDV,R3   0
          0 000026  0008                                 MMM

     1039    10472    1         RETURN;

  10472   0 000027  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1040    10473
     1041    10474    1   END KZR$RBTSTATS;
     1042    10475        %EOD;

PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:160  
--  Include file information  --

   KH$STT.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KZ_HASP_C.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KZ$RBT_M.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
      No diagnostics issued in procedure KZR$RBTSTATS.
PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:161  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @V1                        6-0-0/w PTR         r     1 @V2
    *0-0-0/w VECT        r     1 V1                        *0-0-0/w VECT        r     1 V2

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(272)   r     1 KZ_HASP_HDR                0-0-0/w PTR         r     1 KZ_RBTVDHSTT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(8960)  r     1 KV$STT                     0-0-0/w STRC(2144)  r     1 KZ$SYNCSTAT


   Procedure KZR$RBTSTATS requires 42 words for executable code.
   Procedure KZR$RBTSTATS requires 11 words of local(AUTO) storage.
PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:162  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KZR$RBTSTATS File=KZR$RBT.:E05TSI                             WED 07/30/97 03:02 Page:163  
          MINI XREF LISTING

KV$STT
     10103**DCL     10470--ASSIGN
KV$STT.REQSTATS.DSPMSK
     10349**DCL     10355--REDEF
KV$STT.REQSTATS.SLCMSK
     10390**DCL     10397--REDEF
KZ$SYNCSTAT
      9651**DCL     10471--ASSIGN
KZ$SYNCSTAT.REQSTATS.DSPMSK
      9922**DCL      9928--REDEF
KZ$SYNCSTAT.REQSTATS.SLCMSK
      9963**DCL      9970--REDEF
KZ_HASP_HDR.STTBFR$
     10065**DCL     10471>>ASSIGN
KZ_RBTVDHSTT$
     10074**DCL     10470>>ASSIGN
V1
     10046**DCL        23--PROC    10470<<ASSIGN
V2
     10047**DCL        23--PROC    10471<<ASSIGN

PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:164  
     1043        1        /*T***********************************************************/
     1044        2        /*T*                                                         */
     1045        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1046        4        /*T*                                                         */
     1047        5        /*T***********************************************************/
     1048        6        /*F*  NAME: KZR$RBTINIT
     1049        7              PURPOSE:
     1050        8                 To provide initialization for RBT library procedures.
     1051        9              CALL:
     1052       10                 CALL KZR$RBTINIT (header_array);
     1053       11              PARAMETERS:
     1054       12                 Header-array is an array of pointers to the various state
     1055       13                 table headers, arranged by protocol types.
     1056       14              DESCRIPTION:
     1057       15                 This procedure is called by the Common Line Manager during
     1058       16                 initialization.  It initializes each entry in the header
     1059       17                 pointer table with a pointer to the state table header of
     1060       18                 the protocol types that it is designed to handle.
     1061       19                 This guy sets the entries for HASP, NJE, 2780 and 3780 master
     1062       20                 and slave protocols.
     1063       21        DCL I(0:3) UBIN CONSTANT INIT(
     1064       22              %KLPT_2780#,
     1065       23              %KLPT_3780#,
     1066       24              %KLPT_HASP#,
     1067       25              %KLPT_NJE#);
     1068       26        DCL P(0:3) PTR CONSTANT INIT(
     1069       27              ADDR(KZ_BSC_HDR),
     1070       28              ADDR(KZ_BSC_HDR),
     1071       29              ADDR(KZ_HASP_HDR),
     1072       30              ADDR(KZ_HASP_HDR));
     1073       31        DCL PS(0:3) PTR CONSTANT INIT(
     1074       32              ADDR(KZ_BSCS_HDR),
     1075       33              ADDR(KZ_BSCS_HDR),
     1076       34              ADDR(KZ_HASPS_HDR),
     1077       35              ADDR(KZ_HASPS_HDR));
     1078       36                                                                           */
     1079       37
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:165  
     1080       38        KZR$RBTINIT: PROC (HDR_INIT);
     1081       39
     1082       40        %INCLUDE KZ$LINCTX;
     1083      660        %INCLUDE KL_SUPER_C;
     1084     3562
     1085     3563    1   DCL KZ_HDR$(0:13) PTR BASED;
     1086     3564
     1087     3565
     1088     3566        %KZ$INIT (FPTN=HDR_INIT,STCLASS="");
     1089     3588
     1090     3589
     1091     3590    1   DCL KZ_BSCS_HDR UBIN SYMREF;
     1092     3591    1   DCL KZ_BSC_HDR UBIN SYMREF;
     1093     3592    1   DCL KZ_HASP_HDR UBIN SYMREF;
     1094     3593    1   DCL KZ_HASPS_HDR UBIN SYMREF;
     1095     3594
     1096     3595    1   DCL KZR_ORDERS@ EPTR SYMREF;
     1097     3596    1   DCL KZR_ABORT@ EPTR SYMREF;
     1098     3597    1   DCL KZR_CNCDSC@ EPTR SYMREF;
     1099     3598    1   DCL KZR_DRIVER@ EPTR SYMREF;
     1100     3599
     1101     3600
     1102     3601    1   DCL I(0:2) UBIN CONSTANT INIT(
     1103     3602    1         %KLPT_2780#,
     1104     3603    1         %KLPT_3780#,
     1105     3604    1         %KLPT_HASP#);
     1106     3605    1   DCL P(0:2) PTR CONSTANT INIT(
     1107     3606    1         ADDR(KZ_BSC_HDR),
     1108     3607    1         ADDR(KZ_BSC_HDR),
     1109     3608    1         ADDR(KZ_HASP_HDR));
     1110     3609    1   DCL PS(0:2) PTR CONSTANT INIT(
     1111     3610    1         ADDR(KZ_BSCS_HDR),
     1112     3611    1         ADDR(KZ_BSCS_HDR),
     1113     3612    1         ADDR(KZ_HASPS_HDR));
     1114     3613    1   DCL J UBIN;
     1115     3614    1   DCL P$ PTR;
     1116     3615
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:166  
     1117     3616    1         P$=HDR_INIT.HDR$;
     1118     3617    2         DO J = 0 TO (SIZEW(I)/SIZEW(I(0))-1);
     1119     3618    2            P$->KZ_HDR$(I(J)*2)=P(J);
     1120     3619    2            P$->KZ_HDR$(I(J)*2+1)=PS(J);
     1121     3620    2            END;
     1122     3621    1         KZR_ORDERS@=HDR_INIT.ORDERS;
     1123     3622    1         KZR_CNCDSC@=HDR_INIT.CNCDSC;
     1124     3623    1         KZR_DRIVER@=HDR_INIT.DRIVER;
     1125     3624    1         KZR_ABORT@=HDR_INIT.ABORT;
     1126     3625    1         RETURN;
     1127     3626    1   END;

PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:167  
--  Include file information  --

   KL_SUPER_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZR$RBTINIT.

   Procedure KZR$RBTINIT requires 66 words for executable code.
   Procedure KZR$RBTINIT requires 10 words of local(AUTO) storage.

    No errors detected in file KZR$RBT.:E05TSI    .

PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:168  

 Object Unit name= KZR$RBTINIT                                File name= KZR$RBT.:E05TOU
 UTS= JUL 30 '97 03:03:15.68 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     15      F  KZR$RBTINIT
    1   Proc  even  none    66     42  KZR$RBTINIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KZR$RBTINIT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZ_BSCS_HDR                           KZ_BSC_HDR                            KZ_HASP_HDR
     KZ_HASPS_HDR                          KZR_ORDERS@                           KZR_ABORT@
     KZR_CNCDSC@                           KZR_DRIVER@                      r    G$ROS$
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:169  


     1043        1        /*T***********************************************************/
     1044        2        /*T*                                                         */
     1045        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1046        4        /*T*                                                         */
     1047        5        /*T***********************************************************/
     1048        6        /*F*  NAME: KZR$RBTINIT
     1049        7              PURPOSE:
     1050        8                 To provide initialization for RBT library procedures.
     1051        9              CALL:
     1052       10                 CALL KZR$RBTINIT (header_array);
     1053       11              PARAMETERS:
     1054       12                 Header-array is an array of pointers to the various state
     1055       13                 table headers, arranged by protocol types.
     1056       14              DESCRIPTION:
     1057       15                 This procedure is called by the Common Line Manager during
     1058       16                 initialization.  It initializes each entry in the header
     1059       17                 pointer table with a pointer to the state table header of
     1060       18                 the protocol types that it is designed to handle.
     1061       19                 This guy sets the entries for HASP, NJE, 2780 and 3780 master
     1062       20                 and slave protocols.
     1063       21        DCL I(0:3) UBIN CONSTANT INIT(
     1064       22              %KLPT_2780#,
     1065       23              %KLPT_3780#,
     1066       24              %KLPT_HASP#,
     1067       25              %KLPT_NJE#);
     1068       26        DCL P(0:3) PTR CONSTANT INIT(
     1069       27              ADDR(KZ_BSC_HDR),
     1070       28              ADDR(KZ_BSC_HDR),
     1071       29              ADDR(KZ_HASP_HDR),
     1072       30              ADDR(KZ_HASP_HDR));
     1073       31        DCL PS(0:3) PTR CONSTANT INIT(
     1074       32              ADDR(KZ_BSCS_HDR),
     1075       33              ADDR(KZ_BSCS_HDR),
     1076       34              ADDR(KZ_HASPS_HDR),
     1077       35              ADDR(KZ_HASPS_HDR));
     1078       36                                                                           */
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:170  
     1079       37
     1080       38        KZR$RBTINIT: PROC (HDR_INIT);

     38   1 000000  D380 0000 0000  xent KZR$RBTINIT     LNJ,B5   X6A_AUTO_1
          1 000003       000A 0001                       DC       10,1

     1081       39
     1082       40        %INCLUDE KZ$LINCTX;
     1083      660        %INCLUDE KL_SUPER_C;
     1084     3562
     1085     3563    1   DCL KZ_HDR$(0:13) PTR BASED;
     1086     3564
     1087     3565
     1088     3566        %KZ$INIT (FPTN=HDR_INIT,STCLASS="");
     1089     3588
     1090     3589
     1091     3590    1   DCL KZ_BSCS_HDR UBIN SYMREF;
     1092     3591    1   DCL KZ_BSC_HDR UBIN SYMREF;
     1093     3592    1   DCL KZ_HASP_HDR UBIN SYMREF;
     1094     3593    1   DCL KZ_HASPS_HDR UBIN SYMREF;
     1095     3594
     1096     3595    1   DCL KZR_ORDERS@ EPTR SYMREF;
     1097     3596    1   DCL KZR_ABORT@ EPTR SYMREF;
     1098     3597    1   DCL KZR_CNCDSC@ EPTR SYMREF;
     1099     3598    1   DCL KZR_DRIVER@ EPTR SYMREF;
     1100     3599
     1101     3600
     1102     3601    1   DCL I(0:2) UBIN CONSTANT INIT(
     1103     3602    1         %KLPT_2780#,
     1104     3603    1         %KLPT_3780#,
     1105     3604    1         %KLPT_HASP#);
     1106     3605    1   DCL P(0:2) PTR CONSTANT INIT(
     1107     3606    1         ADDR(KZ_BSC_HDR),
     1108     3607    1         ADDR(KZ_BSC_HDR),
     1109     3608    1         ADDR(KZ_HASP_HDR));
     1110     3609    1   DCL PS(0:2) PTR CONSTANT INIT(
     1111     3610    1         ADDR(KZ_BSCS_HDR),
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:171  
     1112     3611    1         ADDR(KZ_BSCS_HDR),
     1113     3612    1         ADDR(KZ_HASPS_HDR));
     1114     3613    1   DCL J UBIN;
     1115     3614    1   DCL P$ PTR;
     1116     3615
     1117     3616    1         P$=HDR_INIT.HDR$;

   3616   1 000005  ECC7 0004                            LDB,B6   @HDR_INIT,AUTO
          1 000007  DC86                                 LDB,B5   ,B6
          1 000008  DFC7 0007                            STB,B5   P$,AUTO

     1118     3617    2         DO J = 0 TO (SIZEW(I)/SIZEW(I(0))-1);

   3617   1 00000A  8747 0006                            CL       J,AUTO
          1 00000C  0F81 0018                            B        s:3620+2,PREL

     1119     3618    2            P$->KZ_HDR$(I(J)*2)=P(J);

   3618   1 00000E  B847 0006                            LDR,R3   J,AUTO
          1 000010  A830 0000 0000  00                   LDR,R2   I,R3
          1 000013  ECB0 0000 0003  00                   LDB,B6   P,R3
          1 000016  DCC7 0007                            LDB,B5   P$,AUTO
          1 000018  2001                                 SOL,R2   1
          1 000019  EFA5                                 STB,B6   ,B5,R2

     1120     3619    2            P$->KZ_HDR$(I(J)*2+1)=PS(J);

   3619   1 00001A  A830 0000 0000  00                   LDR,R2   I,R3
          1 00001D  CCB0 0000 0009  00                   LDB,B4   PS,R3
          1 000020  2001                                 SOL,R2   1
          1 000021  2E01                                 ADV,R2   1
          1 000022  CFA5                                 STB,B4   ,B5,R2

     1121     3620    2            END;

   3620   1 000023  8AC7 0006                            INC      J,AUTO
          1 000025  E847 0006                            LDR,R6   J,AUTO
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:172  
          1 000027  6D02                                 CMV,R6   2
          1 000028  03E6                                 BLE      s:3618,SPREL

     1122     3621    1         KZR_ORDERS@=HDR_INIT.ORDERS;

   3621   1 000029  ECC7 0004                            LDB,B6   @HDR_INIT,AUTO
          1 00002B  CCC6 0006                            LDB,B4   6,B6
          1 00002D  CF80 0000 0000  xsym                 STB,B4   KZR_ORDERS@

     1123     3622    1         KZR_CNCDSC@=HDR_INIT.CNCDSC;

   3622   1 000030  BCC6 0004                            LDB,B3   4,B6
          1 000032  BF80 0000 0000  xsym                 STB,B3   KZR_CNCDSC@

     1124     3623    1         KZR_DRIVER@=HDR_INIT.DRIVER;

   3623   1 000035  ACC6 0008                            LDB,B2   8,B6
          1 000037  AF80 0000 0000  xsym                 STB,B2   KZR_DRIVER@

     1125     3624    1         KZR_ABORT@=HDR_INIT.ABORT;

   3624   1 00003A  9CC6 0002                            LDB,B1   2,B6
          1 00003C  9F80 0000 0000  xsym                 STB,B1   KZR_ABORT@

     1126     3625    1         RETURN;

   3625   1 00003F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1127     3626    1   END;

PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:173  
--  Include file information  --

   KL_SUPER_C.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
      No diagnostics issued in procedure KZR$RBTINIT.
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:174  

 **** Variables and constants ****

  ****  Section 000 RoData KZR$RBTINIT

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 I(0:2)                     3-0-0/w PTR         r     1 P(0:2)
     9-0-0/w PTR         r     1 PS(0:2)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @HDR_INIT                 *0-0-0/w STRC(192)   r     1 HDR_INIT
     6-0-0/w UBIN(16)    r     1 J                          7-0-0/w PTR         r     1 P$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w EPTR        r     1 KZR_ABORT@                 0-0-0/w EPTR        r     1 KZR_CNCDSC@
     0-0-0/w EPTR        r     1 KZR_DRIVER@                0-0-0/w EPTR        r     1 KZR_ORDERS@
     0-0-0/w UBIN(16)    r     1 KZ_BSCS_HDR                0-0-0/w UBIN(16)    r     1 KZ_BSC_HDR
     0-0-0/w UBIN(16)    r     1 KZ_HASPS_HDR               0-0-0/w UBIN(16)    r     1 KZ_HASP_HDR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KZ_HDR$(0:13)

PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:175  

   Procedure KZR$RBTINIT requires 66 words for executable code.
   Procedure KZR$RBTINIT requires 10 words of local(AUTO) storage.

    No errors detected in file KZR$RBT.:E05TSI    .
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:176  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:177  
          MINI XREF LISTING

HDR_INIT
      3580**DCL        38--PROC
HDR_INIT.ABORT
      3582**DCL      3624>>ASSIGN
HDR_INIT.CNCDSC
      3583**DCL      3622>>ASSIGN
HDR_INIT.DRIVER
      3585**DCL      3623>>ASSIGN
HDR_INIT.HDR$
      3581**DCL      3616>>ASSIGN
HDR_INIT.ORDERS
      3584**DCL      3621>>ASSIGN
I
      3601**DCL      3617--DOINDEX  3617--DOINDEX  3618>>ASSIGN   3619>>ASSIGN
J
      3613**DCL      3617<<DOINDEX  3618>>ASSIGN   3618>>ASSIGN   3619>>ASSIGN   3619>>ASSIGN
KZR_ABORT@
      3596**DCL      3624<<ASSIGN
KZR_CNCDSC@
      3597**DCL      3622<<ASSIGN
KZR_DRIVER@
      3598**DCL      3623<<ASSIGN
KZR_ORDERS@
      3595**DCL      3621<<ASSIGN
KZ_BSCS_HDR
      3590**DCL      3610--DCLINIT  3611--DCLINIT
KZ_BSC_HDR
      3591**DCL      3606--DCLINIT  3607--DCLINIT
KZ_HASPS_HDR
      3593**DCL      3612--DCLINIT
KZ_HASP_HDR
      3592**DCL      3608--DCLINIT
PL6.E3A0      #003=KZR$RBTINIT File=KZR$RBT.:E05TSI                              WED 07/30/97 03:03 Page:178  
KZ_HDR$
      3563**DCL      3618<<ASSIGN   3619<<ASSIGN
P
      3605**DCL      3618>>ASSIGN
P$
      3614**DCL      3616<<ASSIGN   3618>>ASSIGN   3619>>ASSIGN
PS
      3609**DCL      3619>>ASSIGN
