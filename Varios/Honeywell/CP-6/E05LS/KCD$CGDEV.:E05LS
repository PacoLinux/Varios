VERSION E05

PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:1    
        1        1        /*M* KCD$CGDEV Device control routines for comgroups */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8
        9        9        /*P* NAME:         KCD$CGDEV
       10       10             PURPOSE:      To provide various facets of comgroup
       11       11                           device management.
       12       12             DESCRIPTION:  KCD, together with KCF and KCL, contains
       13       13                           the 'terminal side' of comgroup managment.
       14       14                           The two main issues dealt with in KCD
       15       15                           are disconnection/activation/deactivation,
       16       16                           and read/write.  Refer to the individual
       17       17                           *F* commentary for details. */
       18       18
       19       19        /*F* NAME:         KCD$DSCTRM
       20       20             PURPOSE:      To begin terminal disconnect for comgroup devices
       21       21             DESCRIPTION:  Called from:
       22       22                           o KCF$FEIN when a DISC msg is received from
       23       23                             the FEP
       24       24                           o NKL$ADDEV and KIS$FEABT when the device's
       25       25                             FEP crashes or is partitioned or whatever
       26       26                           o NKL$PARTRTN for local devices, when the
       27       27                             device is partitioned or made a resource
       28       28
       29       29                 The disconnect process works as follows.
       30       30            KCD$DSCTRM clears a bunch of flags in the LDCT, and
       31       31            then calls KQP$DISC, unless this is an OUTSYM device
       32       32            that's active, in which case we call FOM$SYMBIN.
       33       33            This call to FOM$SYMBIN tells MOOS to run down
       34       34            his activity with the device, and call KQP$DISC
       35       35            when he's ready, but still with the SYMBIONT
       36       36            bit set in the LDCT.
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:2    
       37       37                 KQP$DISC runs down all activity on the
       38       38            comgroup side of the device and dissociates
       39       39            the LDCT from the station context in the comgroup.
       40       40            It then calls KCO$DSCTRM, which releases the
       41       41            comgroup's station context for the device,
       42       42            tells the AU about the disconnect, and finally
       43       43        calls
       44       44            KCD$PREL to indicate the comgroup is finished
       45       45            with it.  KCD$PREL sends the RLSE (path release)
       46       46            msg to the FEP (if not local device), and then
       47       47            calls NKL$RELDCTL to get rid of the LDCT, or
       48       48            if an OUTSYM device, calls FOM$SBREL.  FOM$SBREL
       49       49            turns off the SYMBIONT bit, releases the
       50       50            symbiont context block (which is pointed to
       51       51            in the LDCT), and then calls NKL$RELDCTL.
       52       52                 NKL$RELDCTL essentially waits 'till we
       53       53            get PRLSE (final path release) from the FEP
       54       54            in response to our RLSE message,
       55       55            before releasing the LDCT.  It does this
       56       56            so that crud coming in on this path from
       57       57            the FEP doesn't cause us to get confused.
       58       58            We do this by recording the receipt of PRLSE
       59       59            in the LDCT, and recording the call to
       60       60            NKL$RELDCTL.  Whichever occurs last causes
       61       61            the LDCT to get released.
       62       62        */
       63       63        KCD$DSCTRM: PROC (NK$LDCT,K$RWPARM);
       64       64
       65       65
       66       66
       67       67
       68       68
       69       69        /* INCLUDES */
       70       70
       71       71        %INCLUDE B_ERRORS_C;
       72     1198        %INCLUDE F_MACROS_C;
       73     1209        %INCLUDE NK$LDCT;
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:3    
       74     1311        %INCLUDE NI$TABLES;
       75     1527        %INCLUDE KV$VDO;
       76     2542        %INCLUDE KL_MACRO_C;
       77     5894        %INCLUDE HF_LOCK_C;
       78     5908        %INCLUDE NK_LDCT_R;
       79     5917        %INCLUDE K_DATA_R;
       80     6628        %INCLUDE KC_DATA_R;
       81     6641        %INCLUDE NK_SUBS;
       82     6666        %INCLUDE FOM_SUBS_C;
       83     6729        %INCLUDE SS_SCHED_C;
       84     6962
       85     6963
       86     6964
       87     6965        /* Equates */
       88     6966        %KV_VDO_E;
       89     7002
       90     7003
       91     7004        /* PARAMETERS */
       92     7005
       93     7006        %NK$LDCT (STCLASS="");
       94     7052        %K$RWPARM (NAME=K$RWPARM);
       95     7368
       96     7369
       97     7370
       98     7371
       99     7372        /* BASED STRUCTURES */
      100     7373
      101     7374        %NI$DCT (NAME=DCT);
      102     7422        %NK$LDCT (NAME=LD$CT,STCLASS=BASED);
      103     7468
      104     7469
      105     7470
      106     7471
      107     7472        /* AUTO */
      108     7473
      109     7474
      110     7475        %K$RWPARM (NAME=RWPARM);
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:4    
      111     7791    1   DCL FEX SBIN;
      112     7792
      113     7793
      114     7794        /* SUBS */
      115     7795        %SUB FCG# = '1303'O;
      116     7796        %SUB MID# = '04'O;
      117     7797
      118     7798
      119     7799        /* CONSTANT */
      120     7800        %ERRCODE (NAME=E_LDSC,COD#=%E$LDSC);
      121     7804
      122     7805
      123     7806        /* REFS */
      124     7807
      125     7808    1   DCL FOM$SBREL     ENTRY(1);
      126     7809    1   DCL FOM$SYMBIN    ENTRY(3) ALTRET;
      127     7810    1   DCL KCF$QFL       ENTRY(1) ALTRET;
      128     7811    1   DCL KIA$FCNO ENTRY(3) ALTRET;
      129     7812    1   DCL KIA$DSC ENTRY(3) ALTRET;
      130     7813    1   DCL KQP$DISC      ENTRY(1) ALTRET;
      131     7814    1   DCL NIQ$REL       ENTRY(1) ALTRET;
      132     7815    1   DCL NKL$RELDCTL   ENTRY(1) ALTRET;
      133     7816    1   DCL SSR$RUE ENTRY(4);
      134     7817    1   DCL SSS$BLOCK     ENTRY;
      135     7818    1   DCL S_PNO UBIN WORD SYMREF;
      136     7819        %EJECT;
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:5    
      137     7820
      138     7821
      139     7822                %LOCK (G=NK$LDCT.LOCK);
      140     7825        /**/
      141     7826        /**/
      142     7827    1   KCD$DSCTRML: ENTRY(NK$LDCT);
      143     7828        /**/
      144     7829        /**/
      145     7830    2         IF LDCT.DFLG.OLDSC THEN DO;
      146     7831    2   UNLKRET: ;
      147     7832                %UNLOCK (G=NK$LDCT.LOCK);
      148     7835    2           RETURN;
      149     7836    2           END;
      150     7837    1         LDCT.DFLG.OLDSC='1'B;
      151     7838    1         LDCT.LKFLG.ACTIVE='0'B;
      152     7839    1         LDCT.QFL='0'B;
      153     7840    1         IF LDCT.RESCOD=NK_CGFPRG AND LDCT.LKFLG.FPPM THEN GOTO UNLKRET;
      154     7841                          /* This disconnect will be continued by KIF$FPRG noticing  */
      155     7842                          /* OLDSC set and, as a result, calling KCD$CDSCTRM to      */
      156     7843                          /* complete the process. We have to hold it up for         */
      157     7844                          /* KIF$FPRG so that the LDCT does not disappear out from   */
      158     7845                          /* underneath us.                                          */
      159     7846              %UNLOCK (G=NK$LDCT.LOCK);
      160     7849        /**/
      161     7850        /**/
      162     7851    1   KCD$CDSCTRM: ENTRY(NK$LDCT);
      163     7852        /**/
      164     7853        /**/
      165     7854    1         IF LDCT.LKFLG.RLTRM THEN RETURN;
      166     7855    1         IF LDCT.DFLG.SYMBIONT THEN CALL FOM$SYMBIN (LDCT,K$RWPARM,FOMI_FNC_DSC_RQS#);
      167     7856    1         ELSE CALL KQP$DISC (LDCT);
      168     7857    1         RETURN;
      169     7858
      170     7859        /*F* NAME:         KCD$PREL
      171     7860             PURPOSE:      To start path release for a disconnecting
      172     7861                           comgroup device.
      173     7862             DESCRIPTION:  See the *F* for KCD$DSCTRM */
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:6    
      174     7863    1   KCD$PREL: ENTRY (LDCT);
      175     7864
      176     7865    1         IF LDCT.LKFLG.QFL THEN GOTO QFULLK;
      177     7866    1         IF LDCT.LKFLG.RLTRM THEN
      178     7867    2           DO;
      179     7868    2           IF S_PNO~=0 THEN CALL SSS$BLOCK;
      180     7869    3             DO INHIBIT;
      181     7870    3             IF LDCT.DFLG.OLDSC='0'B THEN
      182     7871    4               DO;
      183     7872    4               LDCT.RESCOD=NK_NOCG;
      184     7873    4               CALL LNKLDCT;
      185     7874    4               RETURN;
      186     7875    4               END;
      187     7876    3             END;
      188     7877    2           END;
      189     7878    1         FEX = LDCT.RLCID.NODE;
      190     7879    1         IF LDCT.DFLG.LOCAL
      191     7880    1         THEN
      192     7881    2           DO;
      193     7882    2           IF NK$LDCT$(LDCT.RLCID.LDCTX)->DCT.STATUS.DOWN THEN LDCT.RESCOD=NK_PART;
      194     7883    2           ELSE LDCT.RESCOD=NK_QTRM;
      195     7884    2           CALL LNKLDCT;
      196     7885    2           RETURN;
      197     7886    2           END;
      198     7887              %LOCK (G=NK$LDCT.LOCK);
      199     7890    1         RWPARM = K_RWPARM_CON;
      200     7891    1         CALL KIA$DSC (LDCT,%KV_VDO_FNC_DSC_RSP,RWPARM) ALTRET (QFUL);
      201     7892              %UNLOCK (G=NK$LDCT.LOCK);
      202     7895    1   RELL: ;
      203     7896    1         IF LDCT.DFLG.SYMBIONT THEN CALL FOM$SBREL (LDCT);
      204     7897    1         ELSE CALL NKL$RELDCTL (ADDR(LDCT));
      205     7898    1         RETURN;
      206     7899    1   QFULLK:;
      207     7900              %LOCK (G=NK$LDCT.LOCK);
      208     7903    1   QFUL: ;
      209     7904    1         LDCT.QFL.RLS='1'B;
      210     7905    1         CALL KCF$QFL (LDCT) ALTRET (RELL);
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:7    
      211     7906    1         RETURN;
      212     7907
      213     7908
      214     7909    1   LNKLDCT: PROC;
      215     7910
      216     7911    3           DO INHIBIT;
      217     7912    3           LDCT.LNK$=KC_NOCG$;
      218     7913    3           KC_NOCG$=ADDR(LDCT);
      219     7914    3           END;
      220     7915
      221     7916    2   CLRLDCT: ENTRY;
      222     7917
      223     7918    3           DO INHIBIT;
      224     7919    3           LDCT.DFLG=LDCT.DFLG&NK_CGF;
      225     7920    3           LDCT.LKFLG=LDCT.LKFLG & NK_QDP;
      226     7921    3           LDCT.LKFLG.OBLK = '1'B;
      227     7922    3           LDCT.QFL='0'B;
      228     7923    3           LDCT.TH = '0'B;
      229     7924    3           LDCT.RDSOUT=0;
      230     7925    3           END;
      231     7926    2         RETURN;
      232     7927    2   END;
      233     7928
      234     7929    1   END;
      235     7930
      236     7931
      237     7932        %EOD;

PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:8    
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KCD$DSCTRM.

   Procedure KCD$DSCTRM requires 204 words for executable code.
   Procedure KCD$DSCTRM requires 54 words of local(AUTO) storage.

PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:9    

 Object Unit name= KCD$DSCTRM                                 File name= KCD$CGDEV.:E05TOU
 UTS= JUL 30 '97 00:10:58.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  KCD$DSCTRM
    1   Proc  even  none   204    314  KCD$DSCTRM
    2  RoData even  none     5      5  KCD$DSCTRM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        2  KCD$DSCTRM
     1     12                  yes      Std        1  KCD$DSCTRML
     1     55                  yes      Std        1  KCD$CDSCTRM
     1    106                  yes      Std        1  KCD$PREL
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:10   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 KQP$DISC
         yes           Std       1 FOM$SBREL
 yes     yes           Std       1 NKL$RELDCTL
 yes     yes           Std       3 FOM$SYMBIN
         yes           Std       0 SSS$BLOCK
 yes     yes           Std       3 KIA$DSC
 yes     yes           Std       1 KCF$QFL
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                          r    K_RWPARM_CON                          KC_NOCG$
     S_PNO                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:11   


        1        1        /*M* KCD$CGDEV Device control routines for comgroups */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8
        9        9        /*P* NAME:         KCD$CGDEV
       10       10             PURPOSE:      To provide various facets of comgroup
       11       11                           device management.
       12       12             DESCRIPTION:  KCD, together with KCF and KCL, contains
       13       13                           the 'terminal side' of comgroup managment.
       14       14                           The two main issues dealt with in KCD
       15       15                           are disconnection/activation/deactivation,
       16       16                           and read/write.  Refer to the individual
       17       17                           *F* commentary for details. */
       18       18
       19       19        /*F* NAME:         KCD$DSCTRM
       20       20             PURPOSE:      To begin terminal disconnect for comgroup devices
       21       21             DESCRIPTION:  Called from:
       22       22                           o KCF$FEIN when a DISC msg is received from
       23       23                             the FEP
       24       24                           o NKL$ADDEV and KIS$FEABT when the device's
       25       25                             FEP crashes or is partitioned or whatever
       26       26                           o NKL$PARTRTN for local devices, when the
       27       27                             device is partitioned or made a resource
       28       28
       29       29                 The disconnect process works as follows.
       30       30            KCD$DSCTRM clears a bunch of flags in the LDCT, and
       31       31            then calls KQP$DISC, unless this is an OUTSYM device
       32       32            that's active, in which case we call FOM$SYMBIN.
       33       33            This call to FOM$SYMBIN tells MOOS to run down
       34       34            his activity with the device, and call KQP$DISC
       35       35            when he's ready, but still with the SYMBIONT
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:12   
       36       36            bit set in the LDCT.
       37       37                 KQP$DISC runs down all activity on the
       38       38            comgroup side of the device and dissociates
       39       39            the LDCT from the station context in the comgroup.
       40       40            It then calls KCO$DSCTRM, which releases the
       41       41            comgroup's station context for the device,
       42       42            tells the AU about the disconnect, and finally
       43       43        calls
       44       44            KCD$PREL to indicate the comgroup is finished
       45       45            with it.  KCD$PREL sends the RLSE (path release)
       46       46            msg to the FEP (if not local device), and then
       47       47            calls NKL$RELDCTL to get rid of the LDCT, or
       48       48            if an OUTSYM device, calls FOM$SBREL.  FOM$SBREL
       49       49            turns off the SYMBIONT bit, releases the
       50       50            symbiont context block (which is pointed to
       51       51            in the LDCT), and then calls NKL$RELDCTL.
       52       52                 NKL$RELDCTL essentially waits 'till we
       53       53            get PRLSE (final path release) from the FEP
       54       54            in response to our RLSE message,
       55       55            before releasing the LDCT.  It does this
       56       56            so that crud coming in on this path from
       57       57            the FEP doesn't cause us to get confused.
       58       58            We do this by recording the receipt of PRLSE
       59       59            in the LDCT, and recording the call to
       60       60            NKL$RELDCTL.  Whichever occurs last causes
       61       61            the LDCT to get released.
       62       62        */
       63       63        KCD$DSCTRM: PROC (NK$LDCT,K$RWPARM);

     63  1 000000   000000 700200 xent  KCD$DSCTRM   TSX0  ! X66_AUTO_2
         1 000001   000066 000002                    ZERO    54,2

       64       64
       65       65
       66       66
       67       67
       68       68
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:13   
       69       69        /* INCLUDES */
       70       70
       71       71        %INCLUDE B_ERRORS_C;
       72     1198        %INCLUDE F_MACROS_C;
       73     1209        %INCLUDE NK$LDCT;
       74     1311        %INCLUDE NI$TABLES;
       75     1527        %INCLUDE KV$VDO;
       76     2542        %INCLUDE KL_MACRO_C;
       77     5894        %INCLUDE HF_LOCK_C;
       78     5908        %INCLUDE NK_LDCT_R;
       79     5917        %INCLUDE K_DATA_R;
       80     6628        %INCLUDE KC_DATA_R;
       81     6641        %INCLUDE NK_SUBS;
       82     6666        %INCLUDE FOM_SUBS_C;
       83     6729        %INCLUDE SS_SCHED_C;
       84     6962
       85     6963
       86     6964
       87     6965        /* Equates */
       88     6966        %KV_VDO_E;
       89     7002
       90     7003
       91     7004        /* PARAMETERS */
       92     7005
       93     7006        %NK$LDCT (STCLASS="");
       94     7052        %K$RWPARM (NAME=K$RWPARM);
       95     7368
       96     7369
       97     7370
       98     7371
       99     7372        /* BASED STRUCTURES */
      100     7373
      101     7374        %NI$DCT (NAME=DCT);
      102     7422        %NK$LDCT (NAME=LD$CT,STCLASS=BASED);
      103     7468
      104     7469
      105     7470
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:14   
      106     7471
      107     7472        /* AUTO */
      108     7473
      109     7474
      110     7475        %K$RWPARM (NAME=RWPARM);
      111     7791    1   DCL FEX SBIN;
      112     7792
      113     7793
      114     7794        /* SUBS */
      115     7795        %SUB FCG# = '1303'O;
      116     7796        %SUB MID# = '04'O;
      117     7797
      118     7798
      119     7799        /* CONSTANT */
      120     7800        %ERRCODE (NAME=E_LDSC,COD#=%E$LDSC);
      121     7804
      122     7805
      123     7806        /* REFS */
      124     7807
      125     7808    1   DCL FOM$SBREL     ENTRY(1);
      126     7809    1   DCL FOM$SYMBIN    ENTRY(3) ALTRET;
      127     7810    1   DCL KCF$QFL       ENTRY(1) ALTRET;
      128     7811    1   DCL KIA$FCNO ENTRY(3) ALTRET;
      129     7812    1   DCL KIA$DSC ENTRY(3) ALTRET;
      130     7813    1   DCL KQP$DISC      ENTRY(1) ALTRET;
      131     7814    1   DCL NIQ$REL       ENTRY(1) ALTRET;
      132     7815    1   DCL NKL$RELDCTL   ENTRY(1) ALTRET;
      133     7816    1   DCL SSR$RUE ENTRY(4);
      134     7817    1   DCL SSS$BLOCK     ENTRY;
      135     7818    1   DCL S_PNO UBIN WORD SYMREF;
      136     7819        %EJECT;
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:15   
      137     7820
      138     7821
      139     7822                %LOCK (G=NK$LDCT.LOCK);

   7823  1 000002   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000003   000020 036003                    ADLQ    16,DU
         1 000004   200062 756100                    STQ     FEX+4,,AUTO
         1 000005   200062 630500                    EPPR0   FEX+4,,AUTO
         1 000006   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000007   000000 701000 xent               TSX1    HFC$LOCK
         1 000010   000000 011000                    NOP     0
         1 000011   000014 710000 1                  TRA     s:7830

      140     7825        /**/
      141     7826        /**/
      142     7827    1   KCD$DSCTRML: ENTRY(NK$LDCT);

   7827  1 000012   000000 700200 xent  KCD$DSCTRML  TSX0  ! X66_AUTO_2
         1 000013   000066 000002                    ZERO    54,2

      143     7828        /**/
      144     7829        /**/
      145     7830    2         IF LDCT.DFLG.OLDSC THEN DO;

   7830  1 000014   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000015   000006 236100                    LDQ     6,,PR0
         1 000016   010000 316007                    CANQ    4096,DL
         1 000017   000030 600000 1                  TZE     s:7837

   7830  1 000020                       UNLKRET      null
      146     7831    2   UNLKRET: ;
      147     7832                %UNLOCK (G=NK$LDCT.LOCK);

   7833  1 000020   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000021   000020 036003                    ADLQ    16,DU
         1 000022   200062 756100                    STQ     FEX+4,,AUTO
         1 000023   200062 630500                    EPPR0   FEX+4,,AUTO
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:16   
         1 000024   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000025   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000026   000000 011000                    NOP     0

      148     7835    2           RETURN;

   7835  1 000027   000000 702200 xent               TSX2  ! X66_ARET

      149     7836    2           END;
      150     7837    1         LDCT.DFLG.OLDSC='1'B;

   7837  1 000030   010000 236007                    LDQ     4096,DL
         1 000031   000006 256100                    ORSQ    6,,PR0

      151     7838    1         LDCT.LKFLG.ACTIVE='0'B;

   7838  1 000032   000000 236000 2                  LDQ     0
         1 000033   000011 356100                    ANSQ    9,,PR0

      152     7839    1         LDCT.QFL='0'B;

   7839  1 000034   000001 236000 2                  LDQ     1
         1 000035   000010 356100                    ANSQ    8,,PR0

      153     7840    1         IF LDCT.RESCOD=NK_CGFPRG AND LDCT.LKFLG.FPPM THEN GOTO UNLKRET;

   7840  1 000036   000006 236100                    LDQ     6,,PR0
         1 000037   000017 376007                    ANQ     15,DL
         1 000040   000011 116007                    CMPQ    9,DL
         1 000041   000045 601000 1                  TNZ     s:7847
         1 000042   000011 236100                    LDQ     9,,PR0
         1 000043   000004 316003                    CANQ    4,DU
         1 000044   000020 601000 1                  TNZ     UNLKRET

      154     7841                          /* This disconnect will be continued by KIF$FPRG noticing  */
      155     7842                          /* OLDSC set and, as a result, calling KCD$CDSCTRM to      */
      156     7843                          /* complete the process. We have to hold it up for         */
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:17   
      157     7844                          /* KIF$FPRG so that the LDCT does not disappear out from   */
      158     7845                          /* underneath us.                                          */
      159     7846              %UNLOCK (G=NK$LDCT.LOCK);

   7847  1 000045   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000046   000020 036003                    ADLQ    16,DU
         1 000047   200062 756100                    STQ     FEX+4,,AUTO
         1 000050   200062 630500                    EPPR0   FEX+4,,AUTO
         1 000051   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000052   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000053   000000 011000                    NOP     0
         1 000054   000057 710000 1                  TRA     s:7854

      160     7849        /**/
      161     7850        /**/
      162     7851    1   KCD$CDSCTRM: ENTRY(NK$LDCT);

   7851  1 000055   000000 700200 xent  KCD$CDSCTRM  TSX0  ! X66_AUTO_2
         1 000056   000066 000002                    ZERO    54,2

      163     7852        /**/
      164     7853        /**/
      165     7854    1         IF LDCT.LKFLG.RLTRM THEN RETURN;

   7854  1 000057   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000060   000011 236100                    LDQ     9,,PR0
         1 000061   000002 316003                    CANQ    2,DU
         1 000062   000064 600000 1                  TZE     s:7855

   7854  1 000063   000000 702200 xent               TSX2  ! X66_ARET

      166     7855    1         IF LDCT.DFLG.SYMBIONT THEN CALL FOM$SYMBIN (LDCT,K$RWPARM,FOMI_FNC_DSC_RQS#);

   7855  1 000064   000006 236100                    LDQ     6,,PR0
         1 000065   020000 316007                    CANQ    8192,DL
         1 000066   000101 600000 1                  TZE     s:7856

PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:18   
   7855  1 000067   000002 236000 2                  LDQ     2
         1 000070   200064 756100                    STQ     FEX+6,,AUTO
         1 000071   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 000072   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000073   200062 757100                    STAQ    FEX+4,,AUTO
         1 000074   200062 630500                    EPPR0   FEX+4,,AUTO
         1 000075   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000076   000000 701000 xent               TSX1    FOM$SYMBIN
         1 000077   000000 011000                    NOP     0
         1 000100   000105 710000 1                  TRA     s:7857

      167     7856    1         ELSE CALL KQP$DISC (LDCT);

   7856  1 000101   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000102   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000103   000000 701000 xent               TSX1    KQP$DISC
         1 000104   000000 011000                    NOP     0

      168     7857    1         RETURN;

   7857  1 000105   000000 702200 xent               TSX2  ! X66_ARET

      169     7858
      170     7859        /*F* NAME:         KCD$PREL
      171     7860             PURPOSE:      To start path release for a disconnecting
      172     7861                           comgroup device.
      173     7862             DESCRIPTION:  See the *F* for KCD$DSCTRM */
      174     7863    1   KCD$PREL: ENTRY (LDCT);

   7863  1 000106   000000 700200 xent  KCD$PREL     TSX0  ! X66_AUTO_2
         1 000107   000066 000002                    ZERO    54,2

      175     7864
      176     7865    1         IF LDCT.LKFLG.QFL THEN GOTO QFULLK;

   7865  1 000110   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000111   000011 236100                    LDQ     9,,PR0
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:19   
         1 000112   000100 316003                    CANQ    64,DU
         1 000113   000236 601000 1                  TNZ     QFULLK

      177     7866    1         IF LDCT.LKFLG.RLTRM THEN

   7866  1 000114   000002 316003                    CANQ    2,DU
         1 000115   000135 600000 1                  TZE     s:7878

      178     7867    2           DO;

      179     7868    2           IF S_PNO~=0 THEN CALL SSS$BLOCK;

   7868  1 000116   000000 235000 xsym               LDA     S_PNO
         1 000117   000123 600000 1                  TZE     s:7870

   7868  1 000120   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000121   000000 701000 xent               TSX1    SSS$BLOCK
         1 000122   000000 011000                    NOP     0

      180     7869    3             DO INHIBIT;

      181     7870    3             IF LDCT.DFLG.OLDSC='0'B THEN

   7870  1 000123   200003 470700                    LDP0  ! @NK$LDCT,,AUTO
         1 000124   000006 236300                    LDQ   ! 6,,PR0
         1 000125   010000 316207                    CANQ  ! 4096,DL
         1 000126   000135 601200 1                  TNZ   ! s:7878

      182     7871    4               DO;

      183     7872    4               LDCT.RESCOD=NK_NOCG;

   7872  1 000127   000003 376200 2                  ANQ   ! 3
         1 000130   000006 276207                    ORQ   ! 6,DL
         1 000131   000006 756300                    STQ   ! 6,,PR0

      184     7873    4               CALL LNKLDCT;
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:20   

   7873  1 000132   000255 701200 1                  TSX1  ! LNKLDCT
         1 000133   000000 011200                    NOP   ! 0

      185     7874    4               RETURN;

   7874  1 000134   000000 702200 xent               TSX2  ! X66_ARET

      186     7875    4               END;
      187     7876    3             END;

      188     7877    2           END;

      189     7878    1         FEX = LDCT.RLCID.NODE;

   7878  1 000135   000015 236100                    LDQ     13,,PR0
         1 000136   000033 772000                    QRL     27
         1 000137   200056 756100                    STQ     FEX,,AUTO

      190     7879    1         IF LDCT.DFLG.LOCAL

   7879  1 000140   000006 236100                    LDQ     6,,PR0
         1 000141   002000 316007                    CANQ    1024,DL
         1 000142   000162 600000 1                  TZE     s:7888

      191     7880    1         THEN
      192     7881    2           DO;

      193     7882    2           IF NK$LDCT$(LDCT.RLCID.LDCTX)->DCT.STATUS.DOWN THEN LDCT.RESCOD=NK_PART;

   7882  1 000143   000015 720100                    LXL0    13,,PR0
         1 000144   000000 471400 xsym               LDP1    N$DCT$$
         1 000145   100000 473510                    LDP3    0,X0,PR1
         1 000146   300027 234100                    SZN     23,,PR3
         1 000147   000154 605000 1                  TPL     s:7883

   7882  1 000150   000003 376000 2                  ANQ     3
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:21   
         1 000151   000007 276007                    ORQ     7,DL
         1 000152   000006 756100                    STQ     6,,PR0
         1 000153   000157 710000 1                  TRA     s:7884

      194     7883    2           ELSE LDCT.RESCOD=NK_QTRM;

   7883  1 000154   000003 376000 2                  ANQ     3
         1 000155   000003 276007                    ORQ     3,DL
         1 000156   000006 756100                    STQ     6,,PR0

      195     7884    2           CALL LNKLDCT;

   7884  1 000157   000255 701000 1                  TSX1    LNKLDCT
         1 000160   000000 011000                    NOP     0

      196     7885    2           RETURN;

   7885  1 000161   000000 702200 xent               TSX2  ! X66_ARET

      197     7886    2           END;
      198     7887              %LOCK (G=NK$LDCT.LOCK);

   7888  1 000162   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000163   000020 036003                    ADLQ    16,DU
         1 000164   200062 756100                    STQ     FEX+4,,AUTO
         1 000165   200062 630500                    EPPR0   FEX+4,,AUTO
         1 000166   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000167   000000 701000 xent               TSX1    HFC$LOCK
         1 000170   000000 011000                    NOP     0

      199     7890    1         RWPARM = K_RWPARM_CON;

   7890  1 000171   000100 100400                    MLR     fill='000'O
         1 000172   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000173   200006 000234                    ADSC9   RWPARM,,AUTO             cn=0,n=156

      200     7891    1         CALL KIA$DSC (LDCT,%KV_VDO_FNC_DSC_RSP,RWPARM) ALTRET (QFUL);
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:22   

   7891  1 000174   200006 630500                    EPPR0   RWPARM,,AUTO
         1 000175   200064 450500                    STP0    FEX+6,,AUTO
         1 000176   000004 236000 2                  LDQ     4
         1 000177   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000200   200062 757100                    STAQ    FEX+4,,AUTO
         1 000201   200062 630500                    EPPR0   FEX+4,,AUTO
         1 000202   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000203   000000 701000 xent               TSX1    KIA$DSC
         1 000204   000245 702000 1                  TSX2    QFUL

      201     7892              %UNLOCK (G=NK$LDCT.LOCK);

   7893  1 000205   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000206   000020 036003                    ADLQ    16,DU
         1 000207   200062 756100                    STQ     FEX+4,,AUTO
         1 000210   200062 630500                    EPPR0   FEX+4,,AUTO
         1 000211   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000212   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000213   000000 011000                    NOP     0

   7890  1 000214                       RELL         null
      202     7895    1   RELL: ;
      203     7896    1         IF LDCT.DFLG.SYMBIONT THEN CALL FOM$SBREL (LDCT);

   7896  1 000214   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000215   000006 236100                    LDQ     6,,PR0
         1 000216   020000 316007                    CANQ    8192,DL
         1 000217   000225 600000 1                  TZE     s:7897

   7896  1 000220   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000221   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000222   000000 701000 xent               TSX1    FOM$SBREL
         1 000223   000000 011000                    NOP     0
         1 000224   000235 710000 1                  TRA     s:7898

      204     7897    1         ELSE CALL NKL$RELDCTL (ADDR(LDCT));
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:23   

   7897  1 000225   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000226   200062 756100                    STQ     FEX+4,,AUTO
         1 000227   200062 631500                    EPPR1   FEX+4,,AUTO
         1 000230   200063 451500                    STP1    FEX+5,,AUTO
         1 000231   200063 630500                    EPPR0   FEX+5,,AUTO
         1 000232   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000233   000000 701000 xent               TSX1    NKL$RELDCTL
         1 000234   000000 011000                    NOP     0

      205     7898    1         RETURN;

   7898  1 000235   000000 702200 xent               TSX2  ! X66_ARET

   7896  1 000236                       QFULLK       null
      206     7899    1   QFULLK:;
      207     7900              %LOCK (G=NK$LDCT.LOCK);

   7901  1 000236   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000237   000020 036003                    ADLQ    16,DU
         1 000240   200062 756100                    STQ     FEX+4,,AUTO
         1 000241   200062 630500                    EPPR0   FEX+4,,AUTO
         1 000242   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000243   000000 701000 xent               TSX1    HFC$LOCK
         1 000244   000000 011000                    NOP     0

   7896  1 000245                       QFUL         null
      208     7903    1   QFUL: ;
      209     7904    1         LDCT.QFL.RLS='1'B;

   7904  1 000245   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000246   000040 236007                    LDQ     32,DL
         1 000247   000010 256100                    ORSQ    8,,PR0

      210     7905    1         CALL KCF$QFL (LDCT) ALTRET (RELL);

   7905  1 000250   200003 630500                    EPPR0   @NK$LDCT,,AUTO
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:24   
         1 000251   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000252   000000 701000 xent               TSX1    KCF$QFL
         1 000253   000214 702000 1                  TSX2    RELL

      211     7906    1         RETURN;

   7906  1 000254   000000 702200 xent               TSX2  ! X66_ARET

      212     7907
      213     7908
      214     7909    1   LNKLDCT: PROC;

   7909  1 000255   200060 741300       LNKLDCT      STX1  ! FEX+2,,AUTO

      215     7910
      216     7911    3           DO INHIBIT;

      217     7912    3           LDCT.LNK$=KC_NOCG$;

   7912  1 000256   000000 236200 xsym               LDQ   ! KC_NOCG$
         1 000257   200003 470700                    LDP0  ! @NK$LDCT,,AUTO
         1 000260   000004 756300                    STQ   ! 4,,PR0

      218     7913    3           KC_NOCG$=ADDR(LDCT);

   7913  1 000261   200003 236300                    LDQ   ! @NK$LDCT,,AUTO
         1 000262   000000 756200 xsym               STQ   ! KC_NOCG$

      219     7914    3           END;

   7914  1 000263   000265 710000 1                  TRA     s:7919

      220     7915
      221     7916    2   CLRLDCT: ENTRY;

   7916  1 000264   200060 741300       CLRLDCT      STX1  ! FEX+2,,AUTO

PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:25   
      222     7917
      223     7918    3           DO INHIBIT;

      224     7919    3           LDCT.DFLG=LDCT.DFLG&NK_CGF;

   7919  1 000265   200003 470700                    LDP0  ! @NK$LDCT,,AUTO
         1 000266   000006 236300                    LDQ   ! 6,,PR0
         1 000267   000022 736200                    QLS   ! 18
         1 000270   777760 376203                    ANQ   ! -16,DU
         1 000271   742000 376203                    ANQ   ! -15360,DU
         1 000272   000022 772200                    QRL   ! 18
         1 000273   000006 676300                    ERQ   ! 6,,PR0
         1 000274   777760 376207                    ANQ   ! -16,DL
         1 000275   000006 656300                    ERSQ  ! 6,,PR0

      225     7920    3           LDCT.LKFLG=LDCT.LKFLG & NK_QDP;

   7920  1 000276   000011 220300                    LDX0  ! 9,,PR0
         1 000277   002000 360203                    ANX0  ! 1024,DU
         1 000300   000011 740300                    STX0  ! 9,,PR0

      226     7921    3           LDCT.LKFLG.OBLK = '1'B;

   7921  1 000301   200000 236203                    LDQ   ! 65536,DU
         1 000302   000011 256300                    ORSQ  ! 9,,PR0

      227     7922    3           LDCT.QFL='0'B;

   7922  1 000303   000001 236200 2                  LDQ   ! 1
         1 000304   000010 356300                    ANSQ  ! 8,,PR0

      228     7923    3           LDCT.TH = '0'B;

   7923  1 000305   000100 100600                    MLR   ! fill='000'O
         1 000306   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000307   000016 200007                    ADSC9   14,,PR0                  cn=1,n=7

PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:26   
      229     7924    3           LDCT.RDSOUT=0;

   7924  1 000310   000000 236203                    LDQ   ! 0,DU
         1 000311   000007 752340                    STCQ  ! 7,'40'O,PR0

      230     7925    3           END;

      231     7926    2         RETURN;

   7926  1 000312   200060 221300                    LDX1  ! FEX+2,,AUTO
         1 000313   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   0     000   130304 000142                                                    X..b

(unnamed)
 Sect OctLoc
   2     000   777737 777777   777777 777003   000005 006000   777777 777760    ................
   2     004   000015 006000                                                    ....
      232     7927    2   END;
      233     7928
      234     7929    1   END;
      235     7930
      236     7931
      237     7932        %EOD;

PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:27   
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   FOM_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KCD$DSCTRM.
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:28   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
    56-0-0/w SBIN        r     1 FEX                       *0-0-0/d STRC(1404)  r     1 K$RWPARM
    *0-0-0/d STRC(864)   r     1 NK$LDCT                    6-0-0/d STRC(1404)  r     1 RWPARM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KC_NOCG$                   0-0-0/d STRC(1404)  r     1 K_RWPARM_CON
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w UBIN        r     1 S_PNO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)


   Procedure KCD$DSCTRM requires 204 words for executable code.
   Procedure KCD$DSCTRM requires 54 words of local(AUTO) storage.
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:29   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:30   
          MINI XREF LISTING

DCT.DP
      7403**DCL      7410--REDEF    7413--REDEF    7414--REDEF    7416--REDEF    7416--REDEF    7417--REDEF
      7418--REDEF    7418--REDEF
DCT.MPC.IOCHANX
      7411**DCL      7411--REDEF
DCT.STATUS.DOWN
      7400**DCL      7882>>IF
FEX
      7791**DCL      7878<<ASSIGN
FOM$SBREL
      7808**DCL-ENT  7896--CALL
FOM$SYMBIN
      7809**DCL-ENT  7855--CALL
HFC$LOCK
      5907**DCL-ENT  7823--CALL     7888--CALL     7901--CALL
HFC$UNLOCK
      5907**DCL-ENT  7833--CALL     7847--CALL     7893--CALL
K$RWPARM
      7073**DCL        63--PROC     7855<>CALL
K$RWPARM.BLKREC
      7099**DCL      7124--REDEF
K$RWPARM.BLKREC.BLKU#
      7100**DCL      7102--REDEF
K$RWPARM.BLKREC.RECU#
      7112**DCL      7114--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      7139**DCL      7140--REDEF
K$RWPARM.DVE.EOMCHAR
      7147**DCL      7151--REDEF
K$RWPARM.ERR
      7211**DCL      7216--REDEF
K$RWPARM.FC
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:31   
      7175**DCL      7176--REDEF
K$RWPARM.FLDID
      7357**DCL      7358--REDEF
K$RWPARM.FPT$
      7238**DCL      7245--REDEF
K$RWPARM.KEYTYPE
      7364**DCL      7365--REDEF
K$RWPARM.MSG$
      7074**DCL      7080--REDEF
K$RWPARM.MSGID
      7186**DCL      7191--REDEF
K$RWPARM.MSGIDXT
      7199**DCL      7203--REDEF
K$RWPARM.ORG
      7335**DCL      7336--REDEF
K$RWPARM.THDRSZ
      7279**DCL      7283--REDEF
K$RWPARM.VDOFLGS
      7337**DCL      7348--REDEF
KCF$QFL
      7810**DCL-ENT  7905--CALL
KC_NOCG$
      6639**DCL      7912>>ASSIGN   7913<<ASSIGN
KIA$DSC
      7812**DCL-ENT  7891--CALL
KQP$DISC
      7813**DCL-ENT  7856--CALL
K_RWPARM_CON
      6332**DCL      7890>>ASSIGN
K_RWPARM_CON.BLKREC
      6358**DCL      6383--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      6359**DCL      6361--REDEF
K_RWPARM_CON.BLKREC.RECU#
      6371**DCL      6373--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:32   
      6398**DCL      6399--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      6406**DCL      6410--REDEF
K_RWPARM_CON.ERR
      6470**DCL      6475--REDEF
K_RWPARM_CON.FC
      6434**DCL      6435--REDEF
K_RWPARM_CON.FLDID
      6616**DCL      6617--REDEF
K_RWPARM_CON.FPT$
      6497**DCL      6504--REDEF
K_RWPARM_CON.KEYTYPE
      6623**DCL      6624--REDEF
K_RWPARM_CON.MSG$
      6333**DCL      6339--REDEF
K_RWPARM_CON.MSGID
      6445**DCL      6450--REDEF
K_RWPARM_CON.MSGIDXT
      6458**DCL      6462--REDEF
K_RWPARM_CON.ORG
      6594**DCL      6595--REDEF
K_RWPARM_CON.THDRSZ
      6538**DCL      6542--REDEF
K_RWPARM_CON.VDOFLGS
      6596**DCL      6607--REDEF
LD$CT.DDT$
      7437**DCL      7437--REDEF
LD$CT.IOQ$
      7436**DCL      7437--REDEF
LD$CT.LDCTX
      7438**DCL      7438--REDEF
LD$CT.LKFLG.ABORTED
      7450**DCL      7451--REDEF
LD$CT.RLCID.LDCTX
      7460**DCL      7460--REDEF
LD$CT.STA$
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:33   
      7456**DCL      7457--REDEF
LD$CT.SYMB$
      7435**DCL      7435--REDEF    7435--REDEF    7436--REDEF
LNKLDCT
      7909**PROC     7873--CALL     7884--CALL
N$DCT$$
      5915**DCL      5915--IMP-PTR  7882>>IF
NK$LDCT
      7019**DCL        63--PROC     7827--ENTRY    7851--ENTRY    7855<>CALL     7856<>CALL     7863--ENTRY
      7891<>CALL     7896<>CALL     7897--CALL     7905<>CALL     7913--ASSIGN
NK$LDCT.DDT$
      7021**DCL      7021--REDEF
NK$LDCT.DFLG
      7023**DCL      7919<<ASSIGN   7919>>ASSIGN
NK$LDCT.DFLG.LOCAL
      7025**DCL      7879>>IF
NK$LDCT.DFLG.OLDSC
      7024**DCL      7830>>IF       7837<<ASSIGN   7870>>IF
NK$LDCT.DFLG.SYMBIONT
      7024**DCL      7855>>IF       7896>>IF
NK$LDCT.IOQ$
      7020**DCL      7021--REDEF
NK$LDCT.LDCTX
      7022**DCL      7022--REDEF
NK$LDCT.LKFLG
      7034**DCL      7920<<ASSIGN   7920>>ASSIGN
NK$LDCT.LKFLG.ABORTED
      7034**DCL      7035--REDEF
NK$LDCT.LKFLG.ACTIVE
      7038**DCL      7838<<ASSIGN
NK$LDCT.LKFLG.FPPM
      7039**DCL      7840>>IF
NK$LDCT.LKFLG.OBLK
      7034**DCL      7921<<ASSIGN
NK$LDCT.LKFLG.QFL
      7038**DCL      7865>>IF
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:34   
NK$LDCT.LKFLG.RLTRM
      7039**DCL      7854>>IF       7866>>IF
NK$LDCT.LNK$
      7021**DCL      7912<<ASSIGN
NK$LDCT.LOCK
      7047**DCL      7823<>CALL     7833<>CALL     7847<>CALL     7888<>CALL     7893<>CALL     7901<>CALL
NK$LDCT.QFL
      7031**DCL      7839<<ASSIGN   7922<<ASSIGN
NK$LDCT.QFL.RLS
      7032**DCL      7904<<ASSIGN
NK$LDCT.RDSOUT
      7028**DCL      7924<<ASSIGN
NK$LDCT.RESCOD
      7027**DCL      7840>>IF       7872<<ASSIGN   7882<<ASSIGN   7883<<ASSIGN
NK$LDCT.RLCID.LDCTX
      7044**DCL      7044--REDEF    7882>>IF
NK$LDCT.RLCID.NODE
      7043**DCL      7878>>ASSIGN
NK$LDCT.STA$
      7040**DCL      7041--REDEF
NK$LDCT.SYMB$
      7019**DCL      7019--REDEF    7019--REDEF    7020--REDEF
NK$LDCT.TH
      7045**DCL      7923<<ASSIGN
NK$LDCT$
      5915**DCL      7882>>IF
NKL$RELDCTL
      7815**DCL-ENT  7897--CALL
QFUL
      7896**LABEL    7891--CALLALT
QFULLK
      7896**LABEL    7865--GOTO
RELL
      7890**LABEL    7905--CALLALT
RWPARM
      7496**DCL      7890<<ASSIGN   7891<>CALL
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:35   
RWPARM.BLKREC
      7522**DCL      7547--REDEF
RWPARM.BLKREC.BLKU#
      7523**DCL      7525--REDEF
RWPARM.BLKREC.RECU#
      7535**DCL      7537--REDEF
RWPARM.DVE.DVBYTE.VFC
      7562**DCL      7563--REDEF
RWPARM.DVE.EOMCHAR
      7570**DCL      7574--REDEF
RWPARM.ERR
      7634**DCL      7639--REDEF
RWPARM.FC
      7598**DCL      7599--REDEF
RWPARM.FLDID
      7780**DCL      7781--REDEF
RWPARM.FPT$
      7661**DCL      7668--REDEF
RWPARM.KEYTYPE
      7787**DCL      7788--REDEF
RWPARM.MSG$
      7497**DCL      7503--REDEF
RWPARM.MSGID
      7609**DCL      7614--REDEF
RWPARM.MSGIDXT
      7622**DCL      7626--REDEF
RWPARM.ORG
      7758**DCL      7759--REDEF
RWPARM.THDRSZ
      7702**DCL      7706--REDEF
RWPARM.VDOFLGS
      7760**DCL      7771--REDEF
SSS$BLOCK
      7817**DCL-ENT  7868--CALL
S_PNO
      7818**DCL      7868>>IF
PL6.E3A0      #001=KCD$DSCTRM File=KCD$CGDEV.:E05TSI                             WED 07/30/97 00:10 Page:36   
UNLKRET
      7830**LABEL    7840--GOTO

PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:37   
      238        1        /*T***********************************************************/
      239        2        /*T*                                                         */
      240        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      241        4        /*T*                                                         */
      242        5        /*T***********************************************************/
      243        6
      244        7        /*F* NAME:         KCD$RDGO
      245        8             PURPOSE:      To read INPUT comgroup terminals
      246        9             DESCRIPTION:  Called from KQP$PUT the comgroup has
      247       10                           space to put the data we requested a place
      248       11                           for in a previous call to KQP$PUT.
      249       12
      250       13                           The basic idea here is to stuff the buffer
      251       14                           and then call KQP$DONE to tell the comgroup
      252       15                           to send the completed message to its destination.
      253       16                           This, however, takes many possible forms:
      254       17
      255       18                           o For local devices, call KCL$CNSRD (HOGs) or
      256       19                             NIO$QUE (others) to read the data.
      257       20                           o For FEP devices, the data is (or
      258       21                             should be) still in the input circular queue
      259       22                             where we left it upon discovering that KQP$PUT
      260       23                             couldn't find a place for it then.  The
      261       24                             message is retrieved & we stuff the buffer.
      262       25        */
      263       26
      264       27        KCD$RDGO: PROC (NK$LDCT,K$RWPARM) ALTRET;
      265       28
      266       29
      267       30
      268       31
      269       32
      270       33        /* INCLUDES */
      271       34
      272       35        %INCLUDE NK$LDCT;
      273      137        %INCLUDE N$REQ;
      274      211        %INCLUDE KC_DATA_R;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:38   
      275      224        %INCLUDE KV$VDO;
      276     1239        %INCLUDE KQ_SUBS_C;
      277     1539        %INCLUDE NK_SUBS;
      278     1564        %INCLUDE KC_SUBS_C;
      279     1580        %INCLUDE K_DATA_R;
      280     2291        %INCLUDE HF_LOCK_C;
      281     2305        %INCLUDE K_SUBS_C;
      282     2338        %INCLUDE KI$MHDR;
      283     2479        %INCLUDE KQ_MAC_C;
      284     5029        %INCLUDE KC$CP6V_C;
      285     5149        %INCLUDE KC_CP6;
      286     5709
      287     5710
      288     5711
      289     5712
      290     5713        /* PARAMETERS */
      291     5714
      292     5715        %NK$LDCT (STCLASS="");
      293     5761        %K$RWPARM (STCLASS="",NAME=K$RWPARM);
      294     6077
      295     6078        %KQ_CG (STCLASS=BASED);
      296     6817        %KQ_STA(STCLASS=BASED);
      297     7156
      298     7157
      299     7158
      300     7159        /* Equates */
      301     7160        %KV_VDO_ALL_E;
      302     7239
      303     7240
      304     7241
      305     7242
      306     7243        /* BASED STRUCTURES */
      307     7244
      308     7245    1   DCL VCHR CHAR(SIZ) BASED;
      309     7246        %N$REQ;
      310     7304        %KI$QMHDR;
      311     7353
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:39   
      312     7354
      313     7355
      314     7356
      315     7357        /* AUTO */
      316     7358
      317     7359    1   DCL SIZ UBIN WORD;
      318     7360    1   DCL MINRD UBIN HALF;
      319     7361    1   DCL IOQ$ PTR;
      320     7362    1   DCL FEX REDEF IOQ$ UBIN WORD;
      321     7363    1   DCL RDSOUT SBIN;
      322     7364        %K$RWPARM (NAME=IPARM,STCLASS="");
      323     7680
      324     7681
      325     7682
      326     7683
      327     7684        /* REFS */
      328     7685
      329     7686    1   DCL KCF$FEWRT     ENTRY(2) ALTRET;
      330     7687    1   DCL KCF$FERDS     ENTRY(1) ALTRET;
      331     7688    1   DCL KCF$INCMP     ENTRY(2) ALTRET;
      332     7689    1   DCL KCF$QFL       ENTRY(1) ALTRET;
      333     7690    1   DCL KCL$CNSRD     ENTRY(2);
      334     7691    1   DCL KIA$FCNO      ENTRY(3) ALTRET;
      335     7692    1   DCL KIA$MSG       ENTRY(1) ALTRET;
      336     7693    1   DCL KIQ$MAPFEP     ENTRY(1);
      337     7694    1   DCL KQG$DONE      ENTRY(2) ALTRET;
      338     7695    1   DCL KQP$DONE      ENTRY(2) ALTRET;
      339     7696    1   DCL KIS$SEND      ENTRY(1) ALTRET;
      340     7697    1   DCL KIS$OSI_SEND  ENTRY(2) ALTRET;
      341     7698    1   DCL NIO$QUE       ENTRY(1) ALTRET;
      342     7699    1   DCL OCI$SPINTCON  ENTRY(1);
      343     7700    1   DCL SC_ICQLCG     ENTRY    CONV(2,0);
      344     7701    1   DCL SC_CGNOTIMP   ENTRY    CONV(2,0);
      345     7702        %EJECT;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:40   
      346     7703
      347     7704
      348     7705    1         IF ~LDCT.DFLG.LOCAL THEN
      349     7706    2           DO;
      350     7707    2           IF LDCT.IP$ = ADDR(NIL)
      351     7708    2           THEN
      352     7709    2            GOTO DCK;
      353     7710                %LOCK (G=NK$LDCT.LOCK);
      354     7713    2           CALL KIQ$MAPFEP(LDCT.IPFEI#);
      355     7714    2           IPARM = K_RWPARM_CON;
      356     7715    2           IPARM.IP$ = LDCT.IP$;
      357     7716    2           IPARM.UHDR$ = PINCRC(LDCT.IP$,LDCT.IP$->KI$QMHDR.OFFSET);
      358     7717    2           IPARM.UHDRSZ = LDCT.IP$->KI$QMHDR.SIZE;
      359     7718    2           CALL KIA$MSG (IPARM);
      360     7719        /*N* Need work */
      361     7720    2           SIZ=IPARM.MSGSZ;
      362     7721    2           IF SIZ>K$RWPARM.MSGSZ THEN SIZ=K$RWPARM.MSGSZ;
      363     7722    2           K$RWPARM.MSG$->VCHR=IPARM.MSG$->VCHR;
      364     7723                %UNLOCK (G=NK$LDCT.LOCK);
      365     7726    2           CALL KQP$DONE (LDCT,K$RWPARM);
      366     7727    2           IF LDCT.DFLG.RRR THEN
      367     7728    3             DO;
      368     7729    3             IF K$RWPARM.ERR ~= KQPE_ILTR# THEN
      369     7730    3              CALL KCF$INCMP (LDCT,K$RWPARM);
      370     7731    3             END;
      371     7732    2           ELSE
      372     7733    3             DO INHIBIT;
      373     7734    3             LDCT.DFLG.PPND='0'B;
      374     7735    3             LDCT.IP$ = ADDR(NIL);
      375     7736    3             END;
      376     7737    3             DO INHIBIT;
      377     7738    3             RDSOUT=LDCT.RDSOUT;
      378     7739    3             IF RDSOUT~=0 THEN RDSOUT=RDSOUT-1;
      379     7740    3             LDCT.RDSOUT=RDSOUT;
      380     7741    3             IF (LDCT.STA$ = ADDR(NIL)) OR (LDCT.STA$->KQ_STA.MINRD = 0)
      381     7742    3             THEN MINRD = LDCT.CG$->KQ_CG.AUCTL.MINRD; /* CG DEFAULTS */
      382     7743    3             ELSE MINRD = LDCT.STA$->KQ_STA.MINRD; /*STATION SPECIFIC*/
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:41   
      383     7744    3             IF RDSOUT<= MINRD
      384     7745    3             THEN CALL KCF$FERDS (LDCT);
      385     7746    3             END;
      386     7747    2           IPARM.LDCT$ = ADDR(LDCT);
      387     7748    2           IPARM.FUNCTION = %K_READDONE;
      388     7749    2           CALL KIS$SEND (IPARM);
      389     7750    2   RTN:    ;
      390     7751    2           RETURN;
      391     7752
      392     7753    2   DCK:    ;
      393     7754    2           IF IPARM.ERR=0 THEN CALL SC_ICQLCG;
      394     7755        /*S*  SCREECH_CODE:  KCD-S$ICQLDT
      395     7756              TYPE:          Screech
      396     7757              MESSAGE:       FEP input circular queue data inconsistancy (comgroup)
      397     7758              REMARKS:       When comgroup input data is recieved into the
      398     7759                             ICQ at interrupt time it is sometimes left there
      399     7760                             to be picked up later.  This occurs when the queue
      400     7761                             must go to disk to get a buffer.  This screech occurs
      401     7762                             when the data disappears during this time.  If LDCT.
      402     7763                             PPND is reset, blame the queue, otherwise it is the
      403     7764                             FEP or the frontend interface.                        */
      404     7765    2   POUT:   ;
      405     7766    3             DO INHIBIT;
      406     7767    3             LDCT.DFLG.PPND='0'B;
      407     7768    3             LDCT.IP$ = ADDR(NIL);
      408     7769    3             END;
      409     7770    2           IF K$RWPARM.ERR=0 THEN K$RWPARM.ERR=IPARM.ERR;
      410     7771    2   ALTRT:  ;
      411     7772    2           ALTRETURN;
      412     7773    2           END;
      413     7774    1         ELSE
      414     7775    2           DO;
      415     7776    2           IF LDCT.DFLG.CONSOLE THEN
      416     7777    3             DO;
      417     7778    3             IF K$RWPARM.ERR~=0 THEN
      418     7779    4               DO;
      419     7780    5                 DO INHIBIT;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:42   
      420     7781    5                 LDCT.DFLG.PPND='0'B;
      421     7782    5                 END;
      422     7783    4               CALL OCI$SPINTCON (LDCT);
      423     7784    4               ALTRETURN;
      424     7785    4               END;
      425     7786    3             CALL KCL$CNSRD (LDCT,K$RWPARM);
      426     7787    3             END;
      427     7788    2           ELSE
      428     7789    3             DO;
      429     7790    3             IF K$RWPARM.ERR~=0 THEN ALTRETURN;
      430     7791    3             CALL SETQ;
      431     7792    3             END;
      432     7793    2           END;
      433     7794    1         RETURN;
      434     7795
      435     7796        /*F* NAME:         KCD$INCMP
      436     7797             PURPOSE:      To finish a PUT when RRR was set and the
      437     7798                           message ID wasn't immediately available
      438     7799             DESCRIPTION:  KQP$PUT/KQP$DONE will sometimes ALTRET
      439     7800                           with the error KQPE_ILTR (ID later), to
      440     7801                           indicate the comgroup doesn't want to
      441     7802                           tell anyone about the message ID of
      442     7803                           the newly-created message yet.  When
      443     7804                           the comgroup is ready (i.e. the message
      444     7805                           is safely stashed somewhere (e.g. journaled)),
      445     7806                           it calls here with MSGID in the K$RWPARM
      446     7807                           being the ID of the message. */
      447     7808    1   KCD$INCMP: ENTRY (LDCT,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */
      448     7809
      449     7810    1         IF LDCT.DFLG.LOCAL THEN
      450     7811    2           DO;
      451     7812                          /*    SCREECH because
      452     7813                           *    LOCAL devices can't
      453     7814                           *    possibly submit
      454     7815                           *    messages with RRR.
      455     7816                           *    So even if one attaches
      456     7817                           *    a local device to a
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:43   
      457     7818                           *    journalling comgroup,
      458     7819                           *    we should never get here.
      459     7820                           */
      460     7821    2           CALL SC_CGNOTIMP;
      461     7822    2           END;
      462     7823    1         ELSE CALL KCF$INCMP (LDCT,K$RWPARM);
      463     7824    1         RETURN;
      464     7825        %EJECT;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:44   
      465     7826
      466     7827        /*F* NAME:         KCD$WRITE
      467     7828             PURPOSE:      To WRITE to OUTPUT comgroup terminals
      468     7829             DESCRIPTION:  Called from KQG$GET when a message
      469     7830                           (which we requested by a previous call
      470     7831                           to KQG$GET) becomes available.
      471     7832
      472     7833                           The basic idea here is to write the message
      473     7834                           to the device, and then call KQG$DONE
      474     7835                           when we're finished to let him delete
      475     7836                           it.  This takes multiple forms:
      476     7837
      477     7838                           o For local devices, we write the data
      478     7839                             via NIO$QUE, using the device's real
      479     7840                             DCT and dedicated IOQ packet.
      480     7841                             KQG$DONE will be called by the endaction
      481     7842                             of that I/O request.
      482     7843                           o For FEP-connected devices, we call
      483     7844                             KCF$FEWRT to write the data, either
      484     7845                             crossing-coupler, or directly into
      485     7846                             the circular queue.  He will return
      486     7847                             if he unloads the data successfully,
      487     7848                             thus causing us to call KQG$DONE.
      488     7849                             Else he is reponsible for calling
      489     7850                             KQG$DONE.  See the *F* for KCF$FEWRT.
      490     7851        */
      491     7852    1   KCD$WRITE: ENTRY (LDCT,K$RWPARM) ALTRET;
      492     7853
      493     7854    1         IF ~LDCT.DFLG.LOCAL THEN
      494     7855    2           DO;
      495     7856    2           IF LDCT.RESCOD = %NK_OSISTA THEN
      496     7857    2            CALL KIS$OSI_SEND (LDCT,K$RWPARM) ALTRET (ALTRT);
      497     7858    2           ELSE
      498     7859    2            CALL KCF$FEWRT (LDCT,K$RWPARM) ALTRET (ALTRT);
      499     7860    2           CALL KQG$DONE (LDCT,K$RWPARM);
      500     7861    2           RETURN;
      501     7862    2           END;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:45   
      502     7863    1         ELSE
      503     7864    2           DO;
      504     7865    2           IF K$RWPARM.ERR=KQGE_QFUL# OR LDCT.LKFLG.ACTIVE='0'B THEN
      505     7866    3             DO;
      506     7867    3             K$RWPARM.ERR=KQGE_SZ2BIG#;
      507     7868    3             ALTRETURN;
      508     7869    3             END;
      509     7870    2           K$RWPARM.ERR=KQGE_DLTR#;
      510     7871    2           SIZ=(((K$RWPARM.MSGSZ+3)/4)*4)-K$RWPARM.MSGSZ;
      511     7872    2           IF SIZ~=0 THEN PINCRC(K$RWPARM.MSG$,K$RWPARM.MSGSZ)->VCHR=' ';
      512     7873    2           IOQ$=LDCT.IOQ$;
      513     7874    2           IOQ$->N$REQ.DVE=K$RWPARM.DVE;
      514     7875    2           IOQ$->N$REQ.FC=K$RWPARM.FC;
      515     7876    2           CALL SETQ1;
      516     7877    2           ALTRETURN;
      517     7878    2           END;
      518     7879
      519     7880    1   SETQ: PROC ALTRET;
      520     7881
      521     7882    2         IOQ$=LDCT.IOQ$;
      522     7883
      523     7884    2   SETQ1: ENTRY ALTRET;
      524     7885
      525     7886    2         IOQ$->N$REQ.BUF$=K$RWPARM.MSG$;
      526     7887    2         IOQ$->N$REQ.BUFSIZE=K$RWPARM.MSGSZ;
      527     7888    2         IOQ$->N$REQ.OPFLG.BPF='1'B;
      528     7889    2         CALL NIO$QUE (IOQ$->N$REQ);
      529     7890    2         RETURN;
      530     7891
      531     7892    2   RWER: ENTRY ALTRET;
      532     7893
      533     7894    2         IF LDCT.DFLG.RRR
      534     7895    3         THEN DO;
      535     7896                %LOCK (G=NK$LDCT.LOCK);
      536     7899    3           IPARM = K_RWPARM_CON;
      537     7900    3           IPARM.MSG_ERRCODE = K$RWPARM.ERP;
      538     7901    3           CALL KIA$FCNO (LDCT,%KV_VDO_FNC_DAT,IPARM) ALTRET (ALTIT);
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:46   
      539     7902                %UNLOCK (G=NK$LDCT.LOCK);
      540     7905    3           END;
      541     7906    2         CALL KQP$DONE (LDCT,K$RWPARM);
      542     7907    3           DO INHIBIT;
      543     7908    3           LDCT.DFLG.PPND='0'B;
      544     7909    3           END;
      545     7910    2         RETURN;
      546     7911    2   ALTIT:;
      547     7912    2         ALTRETURN;
      548     7913    2   END;
      549     7914
      550     7915    1   END;
      551     7916
      552     7917
      553     7918        %EOD;

PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:47   
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KI$MHDR.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure KCD$RDGO.

   Procedure KCD$RDGO requires 318 words for executable code.
   Procedure KCD$RDGO requires 56 words of local(AUTO) storage.

PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:48   

 Object Unit name= KCD$RDGO                                   File name= KCD$CGDEV.:E05TOU
 UTS= JUL 30 '97 00:12:08.92 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   318    476  KCD$RDGO
    1  RoData even  none     3      3  KCD$RDGO

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        2  KCD$RDGO
     0    253          yes     yes      Std        2  KCD$INCMP
     0    271          yes     yes      Std        2  KCD$WRITE
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:49   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 KIQ$MAPFEP
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       2 KCF$INCMP
 yes     yes           Std       2 KCF$FEWRT
 yes     yes           Std       2 KQP$DONE
 yes     yes           Std       1 KIS$SEND
 yes     yes           Std       2 KIS$OSI_SEND
 yes     yes           Std       1 KCF$FERDS
 yes     yes           Std       2 KQG$DONE
 yes     yes           Std       1 KIA$MSG
         yes           Std       1 OCI$SPINTCON
         yes           Std       2 KCL$CNSRD
 yes     yes           Std       1 NIO$QUE
 yes     yes           Std       3 KIA$FCNO
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_ICQLCG                             SC_CGNOTIMP                      r    K_RWPARM_CON
     B_VECTNIL
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:50   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:51   


      238        1        /*T***********************************************************/
      239        2        /*T*                                                         */
      240        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      241        4        /*T*                                                         */
      242        5        /*T***********************************************************/
      243        6
      244        7        /*F* NAME:         KCD$RDGO
      245        8             PURPOSE:      To read INPUT comgroup terminals
      246        9             DESCRIPTION:  Called from KQP$PUT the comgroup has
      247       10                           space to put the data we requested a place
      248       11                           for in a previous call to KQP$PUT.
      249       12
      250       13                           The basic idea here is to stuff the buffer
      251       14                           and then call KQP$DONE to tell the comgroup
      252       15                           to send the completed message to its destination.
      253       16                           This, however, takes many possible forms:
      254       17
      255       18                           o For local devices, call KCL$CNSRD (HOGs) or
      256       19                             NIO$QUE (others) to read the data.
      257       20                           o For FEP devices, the data is (or
      258       21                             should be) still in the input circular queue
      259       22                             where we left it upon discovering that KQP$PUT
      260       23                             couldn't find a place for it then.  The
      261       24                             message is retrieved & we stuff the buffer.
      262       25        */
      263       26
      264       27        KCD$RDGO: PROC (NK$LDCT,K$RWPARM) ALTRET;

     27  0 000000   000000 700200 xent  KCD$RDGO     TSX0  ! X66_AUTO_2
         0 000001   000070 000002                    ZERO    56,2

      265       28
      266       29
      267       30
      268       31
      269       32
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:52   
      270       33        /* INCLUDES */
      271       34
      272       35        %INCLUDE NK$LDCT;
      273      137        %INCLUDE N$REQ;
      274      211        %INCLUDE KC_DATA_R;
      275      224        %INCLUDE KV$VDO;
      276     1239        %INCLUDE KQ_SUBS_C;
      277     1539        %INCLUDE NK_SUBS;
      278     1564        %INCLUDE KC_SUBS_C;
      279     1580        %INCLUDE K_DATA_R;
      280     2291        %INCLUDE HF_LOCK_C;
      281     2305        %INCLUDE K_SUBS_C;
      282     2338        %INCLUDE KI$MHDR;
      283     2479        %INCLUDE KQ_MAC_C;
      284     5029        %INCLUDE KC$CP6V_C;
      285     5149        %INCLUDE KC_CP6;
      286     5709
      287     5710
      288     5711
      289     5712
      290     5713        /* PARAMETERS */
      291     5714
      292     5715        %NK$LDCT (STCLASS="");
      293     5761        %K$RWPARM (STCLASS="",NAME=K$RWPARM);
      294     6077
      295     6078        %KQ_CG (STCLASS=BASED);
      296     6817        %KQ_STA(STCLASS=BASED);
      297     7156
      298     7157
      299     7158
      300     7159        /* Equates */
      301     7160        %KV_VDO_ALL_E;
      302     7239
      303     7240
      304     7241
      305     7242
      306     7243        /* BASED STRUCTURES */
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:53   
      307     7244
      308     7245    1   DCL VCHR CHAR(SIZ) BASED;
      309     7246        %N$REQ;
      310     7304        %KI$QMHDR;
      311     7353
      312     7354
      313     7355
      314     7356
      315     7357        /* AUTO */
      316     7358
      317     7359    1   DCL SIZ UBIN WORD;
      318     7360    1   DCL MINRD UBIN HALF;
      319     7361    1   DCL IOQ$ PTR;
      320     7362    1   DCL FEX REDEF IOQ$ UBIN WORD;
      321     7363    1   DCL RDSOUT SBIN;
      322     7364        %K$RWPARM (NAME=IPARM,STCLASS="");
      323     7680
      324     7681
      325     7682
      326     7683
      327     7684        /* REFS */
      328     7685
      329     7686    1   DCL KCF$FEWRT     ENTRY(2) ALTRET;
      330     7687    1   DCL KCF$FERDS     ENTRY(1) ALTRET;
      331     7688    1   DCL KCF$INCMP     ENTRY(2) ALTRET;
      332     7689    1   DCL KCF$QFL       ENTRY(1) ALTRET;
      333     7690    1   DCL KCL$CNSRD     ENTRY(2);
      334     7691    1   DCL KIA$FCNO      ENTRY(3) ALTRET;
      335     7692    1   DCL KIA$MSG       ENTRY(1) ALTRET;
      336     7693    1   DCL KIQ$MAPFEP     ENTRY(1);
      337     7694    1   DCL KQG$DONE      ENTRY(2) ALTRET;
      338     7695    1   DCL KQP$DONE      ENTRY(2) ALTRET;
      339     7696    1   DCL KIS$SEND      ENTRY(1) ALTRET;
      340     7697    1   DCL KIS$OSI_SEND  ENTRY(2) ALTRET;
      341     7698    1   DCL NIO$QUE       ENTRY(1) ALTRET;
      342     7699    1   DCL OCI$SPINTCON  ENTRY(1);
      343     7700    1   DCL SC_ICQLCG     ENTRY    CONV(2,0);
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:54   
      344     7701    1   DCL SC_CGNOTIMP   ENTRY    CONV(2,0);
      345     7702        %EJECT;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:55   
      346     7703
      347     7704
      348     7705    1         IF ~LDCT.DFLG.LOCAL THEN

   7705  0 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000003   000006 236100                    LDQ     6,,PR0
         0 000004   000031 736000                    QLS     25
         0 000005   400000 376003                    ANQ     -131072,DU
         0 000006   400000 676003                    ERQ     -131072,DU
         0 000007   000222 600000 0                  TZE     s:7776

      349     7706    2           DO;

      350     7707    2           IF LDCT.IP$ = ADDR(NIL)

   7707  0 000010   000013 236100                    LDQ     11,,PR0
         0 000011   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000012   000203 600000 0                  TZE     DCK

      351     7708    2           THEN
      352     7709    2            GOTO DCK;
      353     7710                %LOCK (G=NK$LDCT.LOCK);

   7711  0 000013   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000014   000020 036003                    ADLQ    16,DU
         0 000015   200064 756100                    STQ     IPARM+42,,AUTO
         0 000016   200064 630500                    EPPR0   IPARM+42,,AUTO
         0 000017   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000020   000000 701000 xent               TSX1    HFC$LOCK
         0 000021   000000 011000                    NOP     0

      354     7713    2           CALL KIQ$MAPFEP(LDCT.IPFEI#);

   7713  0 000022   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000023   000000 036000 1                  ADLQ    0
         0 000024   200064 756100                    STQ     IPARM+42,,AUTO
         0 000025   200064 630500                    EPPR0   IPARM+42,,AUTO
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:56   
         0 000026   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000027   000000 701000 xent               TSX1    KIQ$MAPFEP
         0 000030   000000 011000                    NOP     0

      355     7714    2           IPARM = K_RWPARM_CON;

   7714  0 000031   000100 100400                    MLR     fill='000'O
         0 000032   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         0 000033   200012 000234                    ADSC9   IPARM,,AUTO              cn=0,n=156

      356     7715    2           IPARM.IP$ = LDCT.IP$;

   7715  0 000034   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000035   000013 236100                    LDQ     11,,PR0
         0 000036   200024 756100                    STQ     IPARM+10,,AUTO

      357     7716    2           IPARM.UHDR$ = PINCRC(LDCT.IP$,LDCT.IP$->KI$QMHDR.OFFSET);

   7716  0 000037   000013 471500                    LDP1    11,,PR0
         0 000040   100001 236100                    LDQ     1,,PR1
         0 000041   000022 772000                    QRL     18
         0 000042   000011 402007                    MPY     9,DL
         0 000043   100000 503506                    ABD     0,QL,PR1
         0 000044   200026 451500                    STP1    IPARM+12,,AUTO

      358     7717    2           IPARM.UHDRSZ = LDCT.IP$->KI$QMHDR.SIZE;

   7717  0 000045   000013 473500                    LDP3    11,,PR0
         0 000046   300001 236100                    LDQ     1,,PR3
         0 000047   777777 376007                    ANQ     -1,DL
         0 000050   200027 756100                    STQ     IPARM+13,,AUTO

      359     7718    2           CALL KIA$MSG (IPARM);

   7718  0 000051   200012 633500                    EPPR3   IPARM,,AUTO
         0 000052   200064 453500                    STP3    IPARM+42,,AUTO
         0 000053   200064 630500                    EPPR0   IPARM+42,,AUTO
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:57   
         0 000054   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000055   000000 701000 xent               TSX1    KIA$MSG
         0 000056   000000 011000                    NOP     0

      360     7719        /*N* Need work */
      361     7720    2           SIZ=IPARM.MSGSZ;

   7720  0 000057   200013 235100                    LDA     IPARM+1,,AUTO
         0 000060   200005 755100                    STA     SIZ,,AUTO

      362     7721    2           IF SIZ>K$RWPARM.MSGSZ THEN SIZ=K$RWPARM.MSGSZ;

   7721  0 000061   200004 470500                    LDP0    @K$RWPARM,,AUTO
         0 000062   200005 236100                    LDQ     SIZ,,AUTO
         0 000063   000066 604000 0                  TMI     s:7721+5
         0 000064   000001 116100                    CMPQ    1,,PR0
         0 000065   000070 604400 0                  TMOZ    s:7722

   7721  0 000066   000001 235100                    LDA     1,,PR0
         0 000067   200005 755100                    STA     SIZ,,AUTO

      363     7722    2           K$RWPARM.MSG$->VCHR=IPARM.MSG$->VCHR;

   7722  0 000070   000000 471500                    LDP1    0,,PR0
         0 000071   200012 473500                    LDP3    IPARM,,AUTO
         0 000072   000000 620005                    EAX0    0,AL
         0 000073   200005 721100                    LXL1    SIZ,,AUTO
         0 000074   040140 100540                    MLR     fill='040'O
         0 000075   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         0 000076   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      364     7723                %UNLOCK (G=NK$LDCT.LOCK);

   7724  0 000077   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000100   000020 036003                    ADLQ    16,DU
         0 000101   200064 756100                    STQ     IPARM+42,,AUTO
         0 000102   200064 630500                    EPPR0   IPARM+42,,AUTO
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:58   
         0 000103   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000104   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000105   000000 011000                    NOP     0

      365     7726    2           CALL KQP$DONE (LDCT,K$RWPARM);

   7726  0 000106   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000107   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000110   000000 701000 xent               TSX1    KQP$DONE
         0 000111   000000 011000                    NOP     0

      366     7727    2           IF LDCT.DFLG.RRR THEN

   7727  0 000112   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000113   000006 236100                    LDQ     6,,PR0
         0 000114   001000 316007                    CANQ    512,DL
         0 000115   000127 600000 0                  TZE     s:7734

      367     7728    3             DO;

      368     7729    3             IF K$RWPARM.ERR ~= KQPE_ILTR# THEN

   7729  0 000116   200004 471500                    LDP1    @K$RWPARM,,AUTO
         0 000117   100013 235100                    LDA     11,,PR1
         0 000120   000010 115007                    CMPA    8,DL
         0 000121   000133 600000 0                  TZE     s:7738

      369     7730    3              CALL KCF$INCMP (LDCT,K$RWPARM);

   7730  0 000122   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000123   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000124   000000 701000 xent               TSX1    KCF$INCMP
         0 000125   000000 011000                    NOP     0

      370     7731    3             END;

   7731  0 000126   000133 710000 0                  TRA     s:7738
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:59   

      371     7732    2           ELSE
      372     7733    3             DO INHIBIT;

      373     7734    3             LDCT.DFLG.PPND='0'B;

   7734  0 000127   000001 236200 1                  LDQ   ! 1
         0 000130   000006 356300                    ANSQ  ! 6,,PR0

      374     7735    3             LDCT.IP$ = ADDR(NIL);

   7735  0 000131   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         0 000132   000013 756300                    STQ   ! 11,,PR0

      375     7736    3             END;

      376     7737    3             DO INHIBIT;

      377     7738    3             RDSOUT=LDCT.RDSOUT;

   7738  0 000133   200003 470700                    LDP0  ! @NK$LDCT,,AUTO
         0 000134   000007 236300                    LDQ   ! 7,,PR0
         0 000135   000036 772200                    QRL   ! 30
         0 000136   200010 756300                    STQ   ! RDSOUT,,AUTO

      378     7739    3             IF RDSOUT~=0 THEN RDSOUT=RDSOUT-1;

   7739  0 000137   000142 600200 0                  TZE   ! s:7740

   7739  0 000140   000001 336207                    LCQ   ! 1,DL
         0 000141   200010 056300                    ASQ   ! RDSOUT,,AUTO

      379     7740    3             LDCT.RDSOUT=RDSOUT;

   7740  0 000142   200010 236300                    LDQ   ! RDSOUT,,AUTO
         0 000143   000036 736200                    QLS   ! 30
         0 000144   000007 752340                    STCQ  ! 7,'40'O,PR0
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:60   

      380     7741    3             IF (LDCT.STA$ = ADDR(NIL)) OR (LDCT.STA$->KQ_STA.MINRD = 0)

   7741  0 000145   000012 236300                    LDQ   ! 10,,PR0
         0 000146   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         0 000147   000153 600200 0                  TZE   ! s:7742
         0 000150   000012 471700                    LDP1  ! 10,,PR0
         0 000151   100032 220300                    LDX0  ! 26,,PR1
         0 000152   000157 601200 0                  TNZ   ! s:7743

      381     7742    3             THEN MINRD = LDCT.CG$->KQ_CG.AUCTL.MINRD; /* CG DEFAULTS */

   7742  0 000153   000027 471700                    LDP1  ! 23,,PR0
         0 000154   100140 220300                    LDX0  ! 96,,PR1
         0 000155   200006 740300                    STX0  ! MINRD,,AUTO
         0 000156   000160 710200 0                  TRA   ! s:7744

      382     7743    3             ELSE MINRD = LDCT.STA$->KQ_STA.MINRD; /*STATION SPECIFIC*/

   7743  0 000157   200006 740300                    STX0  ! MINRD,,AUTO

      383     7744    3             IF RDSOUT<= MINRD

   7744  0 000160   200006 236300                    LDQ   ! MINRD,,AUTO
         0 000161   000022 772200                    QRL   ! 18
         0 000162   200010 116300                    CMPQ  ! RDSOUT,,AUTO
         0 000163   000170 604200 0                  TMI   ! s:7747

      384     7745    3             THEN CALL KCF$FERDS (LDCT);

   7745  0 000164   200003 630700                    EPPR0 ! @NK$LDCT,,AUTO
         0 000165   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         0 000166   000000 701200 xent               TSX1  ! KCF$FERDS
         0 000167   000000 011200                    NOP   ! 0

      385     7746    3             END;

PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:61   
      386     7747    2           IPARM.LDCT$ = ADDR(LDCT);

   7747  0 000170   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000171   200030 756100                    STQ     IPARM+14,,AUTO

      387     7748    2           IPARM.FUNCTION = %K_READDONE;

   7748  0 000172   000011 235007                    LDA     9,DL
         0 000173   200032 755100                    STA     IPARM+16,,AUTO

      388     7749    2           CALL KIS$SEND (IPARM);

   7749  0 000174   200012 630500                    EPPR0   IPARM,,AUTO
         0 000175   200064 450500                    STP0    IPARM+42,,AUTO
         0 000176   200064 630500                    EPPR0   IPARM+42,,AUTO
         0 000177   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000200   000000 701000 xent               TSX1    KIS$SEND
         0 000201   000000 011000                    NOP     0

   7748  0 000202                       RTN          null
      389     7750    2   RTN:    ;
      390     7751    2           RETURN;

   7751  0 000202   000000 702200 xent               TSX2  ! X66_ARET

   7748  0 000203                       DCK          null
      391     7752
      392     7753    2   DCK:    ;
      393     7754    2           IF IPARM.ERR=0 THEN CALL SC_ICQLCG;

   7754  0 000203   200025 235100                    LDA     IPARM+11,,AUTO
         0 000204   000207 601000 0                  TNZ     POUT

   7754  0 000205   000000 713400 xsym               CLIMB   SC_ICQLCG
         0 000206   000000 600000 xsid               climb   nvectors=         0

   7754  0 000207                       POUT         null
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:62   
      394     7755        /*S*  SCREECH_CODE:  KCD-S$ICQLDT
      395     7756              TYPE:          Screech
      396     7757              MESSAGE:       FEP input circular queue data inconsistancy (comgroup)
      397     7758              REMARKS:       When comgroup input data is recieved into the
      398     7759                             ICQ at interrupt time it is sometimes left there
      399     7760                             to be picked up later.  This occurs when the queue
      400     7761                             must go to disk to get a buffer.  This screech occurs
      401     7762                             when the data disappears during this time.  If LDCT.
      402     7763                             PPND is reset, blame the queue, otherwise it is the
      403     7764                             FEP or the frontend interface.                        */
      404     7765    2   POUT:   ;
      405     7766    3             DO INHIBIT;

      406     7767    3             LDCT.DFLG.PPND='0'B;

   7767  0 000207   200003 470700                    LDP0  ! @NK$LDCT,,AUTO
         0 000210   000001 236200 1                  LDQ   ! 1
         0 000211   000006 356300                    ANSQ  ! 6,,PR0

      407     7768    3             LDCT.IP$ = ADDR(NIL);

   7768  0 000212   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         0 000213   000013 756300                    STQ   ! 11,,PR0

      408     7769    3             END;

      409     7770    2           IF K$RWPARM.ERR=0 THEN K$RWPARM.ERR=IPARM.ERR;

   7770  0 000214   200004 471500                    LDP1    @K$RWPARM,,AUTO
         0 000215   100013 235100                    LDA     11,,PR1
         0 000216   000221 601000 0                  TNZ     ALTRT

   7770  0 000217   200025 235100                    LDA     IPARM+11,,AUTO
         0 000220   100013 755100                    STA     11,,PR1

   7770  0 000221                       ALTRT        null
      410     7771    2   ALTRT:  ;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:63   
      411     7772    2           ALTRETURN;

   7772  0 000221   000000 702200 xent               TSX2  ! X66_AALT

      412     7773    2           END;
      413     7774    1         ELSE
      414     7775    2           DO;

      415     7776    2           IF LDCT.DFLG.CONSOLE THEN

   7776  0 000222   000006 236100                    LDQ     6,,PR0
         0 000223   040000 316007                    CANQ    16384,DL
         0 000224   000244 600000 0                  TZE     s:7790

      416     7777    3             DO;

      417     7778    3             IF K$RWPARM.ERR~=0 THEN

   7778  0 000225   200004 471500                    LDP1    @K$RWPARM,,AUTO
         0 000226   100013 235100                    LDA     11,,PR1
         0 000227   000237 600000 0                  TZE     s:7786

      418     7779    4               DO;

      419     7780    5                 DO INHIBIT;

      420     7781    5                 LDCT.DFLG.PPND='0'B;

   7781  0 000230   000001 236200 1                  LDQ   ! 1
         0 000231   000006 356300                    ANSQ  ! 6,,PR0

      421     7782    5                 END;

      422     7783    4               CALL OCI$SPINTCON (LDCT);

   7783  0 000232   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000233   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:64   
         0 000234   000000 701000 xent               TSX1    OCI$SPINTCON
         0 000235   000000 011000                    NOP     0

      423     7784    4               ALTRETURN;

   7784  0 000236   000000 702200 xent               TSX2  ! X66_AALT

      424     7785    4               END;
      425     7786    3             CALL KCL$CNSRD (LDCT,K$RWPARM);

   7786  0 000237   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000240   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000241   000000 701000 xent               TSX1    KCL$CNSRD
         0 000242   000000 011000                    NOP     0

      426     7787    3             END;

   7787  0 000243   000252 710000 0                  TRA     s:7794

      427     7788    2           ELSE
      428     7789    3             DO;

      429     7790    3             IF K$RWPARM.ERR~=0 THEN ALTRETURN;

   7790  0 000244   200004 471500                    LDP1    @K$RWPARM,,AUTO
         0 000245   100013 235100                    LDA     11,,PR1
         0 000246   000250 600000 0                  TZE     s:7791

   7790  0 000247   000000 702200 xent               TSX2  ! X66_AALT

      430     7791    3             CALL SETQ;

   7791  0 000250   000372 701000 0                  TSX1    SETQ
         0 000251   000000 011000                    NOP     0

      431     7792    3             END;

PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:65   
      432     7793    2           END;

      433     7794    1         RETURN;

   7794  0 000252   000000 702200 xent               TSX2  ! X66_ARET

      434     7795
      435     7796        /*F* NAME:         KCD$INCMP
      436     7797             PURPOSE:      To finish a PUT when RRR was set and the
      437     7798                           message ID wasn't immediately available
      438     7799             DESCRIPTION:  KQP$PUT/KQP$DONE will sometimes ALTRET
      439     7800                           with the error KQPE_ILTR (ID later), to
      440     7801                           indicate the comgroup doesn't want to
      441     7802                           tell anyone about the message ID of
      442     7803                           the newly-created message yet.  When
      443     7804                           the comgroup is ready (i.e. the message
      444     7805                           is safely stashed somewhere (e.g. journaled)),
      445     7806                           it calls here with MSGID in the K$RWPARM
      446     7807                           being the ID of the message. */
      447     7808    1   KCD$INCMP: ENTRY (LDCT,K$RWPARM) ALTRET; /* !!Doesn't ALTRET!! */

   7808  0 000253   000000 700200 xent  KCD$INCMP    TSX0  ! X66_AUTO_2
         0 000254   000070 000002                    ZERO    56,2

      448     7809
      449     7810    1         IF LDCT.DFLG.LOCAL THEN

   7810  0 000255   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000256   000006 236100                    LDQ     6,,PR0
         0 000257   002000 316007                    CANQ    1024,DL
         0 000260   000264 600000 0                  TZE     s:7823

      450     7811    2           DO;

      451     7812                          /*    SCREECH because
      452     7813                           *    LOCAL devices can't
      453     7814                           *    possibly submit
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:66   
      454     7815                           *    messages with RRR.
      455     7816                           *    So even if one attaches
      456     7817                           *    a local device to a
      457     7818                           *    journalling comgroup,
      458     7819                           *    we should never get here.
      459     7820                           */
      460     7821    2           CALL SC_CGNOTIMP;

   7821  0 000261   000000 713400 xsym               CLIMB   SC_CGNOTIMP
         0 000262   000000 600000 xsid               climb   nvectors=         0

      461     7822    2           END;

   7822  0 000263   000270 710000 0                  TRA     s:7824

      462     7823    1         ELSE CALL KCF$INCMP (LDCT,K$RWPARM);

   7823  0 000264   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000265   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000266   000000 701000 xent               TSX1    KCF$INCMP
         0 000267   000000 011000                    NOP     0

      463     7824    1         RETURN;

   7824  0 000270   000000 702200 xent               TSX2  ! X66_ARET

      464     7825        %EJECT;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:67   
      465     7826
      466     7827        /*F* NAME:         KCD$WRITE
      467     7828             PURPOSE:      To WRITE to OUTPUT comgroup terminals
      468     7829             DESCRIPTION:  Called from KQG$GET when a message
      469     7830                           (which we requested by a previous call
      470     7831                           to KQG$GET) becomes available.
      471     7832
      472     7833                           The basic idea here is to write the message
      473     7834                           to the device, and then call KQG$DONE
      474     7835                           when we're finished to let him delete
      475     7836                           it.  This takes multiple forms:
      476     7837
      477     7838                           o For local devices, we write the data
      478     7839                             via NIO$QUE, using the device's real
      479     7840                             DCT and dedicated IOQ packet.
      480     7841                             KQG$DONE will be called by the endaction
      481     7842                             of that I/O request.
      482     7843                           o For FEP-connected devices, we call
      483     7844                             KCF$FEWRT to write the data, either
      484     7845                             crossing-coupler, or directly into
      485     7846                             the circular queue.  He will return
      486     7847                             if he unloads the data successfully,
      487     7848                             thus causing us to call KQG$DONE.
      488     7849                             Else he is reponsible for calling
      489     7850                             KQG$DONE.  See the *F* for KCF$FEWRT.
      490     7851        */
      491     7852    1   KCD$WRITE: ENTRY (LDCT,K$RWPARM) ALTRET;

   7852  0 000271   000000 700200 xent  KCD$WRITE    TSX0  ! X66_AUTO_2
         0 000272   000070 000002                    ZERO    56,2

      492     7853
      493     7854    1         IF ~LDCT.DFLG.LOCAL THEN

   7854  0 000273   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000274   000006 236100                    LDQ     6,,PR0
         0 000275   000031 736000                    QLS     25
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:68   
         0 000276   400000 376003                    ANQ     -131072,DU
         0 000277   400000 676003                    ERQ     -131072,DU
         0 000300   000323 600000 0                  TZE     s:7865

      494     7855    2           DO;

      495     7856    2           IF LDCT.RESCOD = %NK_OSISTA THEN

   7856  0 000301   000006 236100                    LDQ     6,,PR0
         0 000302   000017 376007                    ANQ     15,DL
         0 000303   000015 116007                    CMPQ    13,DL
         0 000304   000312 601000 0                  TNZ     s:7859

      496     7857    2            CALL KIS$OSI_SEND (LDCT,K$RWPARM) ALTRET (ALTRT);

   7857  0 000305   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000306   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000307   000000 701000 xent               TSX1    KIS$OSI_SEND
         0 000310   000221 702000 0                  TSX2    ALTRT
         0 000311   000316 710000 0                  TRA     s:7860

      497     7858    2           ELSE
      498     7859    2            CALL KCF$FEWRT (LDCT,K$RWPARM) ALTRET (ALTRT);

   7859  0 000312   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000313   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000314   000000 701000 xent               TSX1    KCF$FEWRT
         0 000315   000221 702000 0                  TSX2    ALTRT

      499     7860    2           CALL KQG$DONE (LDCT,K$RWPARM);

   7860  0 000316   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000317   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000320   000000 701000 xent               TSX1    KQG$DONE
         0 000321   000000 011000                    NOP     0

      500     7861    2           RETURN;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:69   

   7861  0 000322   000000 702200 xent               TSX2  ! X66_ARET

      501     7862    2           END;
      502     7863    1         ELSE
      503     7864    2           DO;

      504     7865    2           IF K$RWPARM.ERR=KQGE_QFUL# OR LDCT.LKFLG.ACTIVE='0'B THEN

   7865  0 000323   200004 471500                    LDP1    @K$RWPARM,,AUTO
         0 000324   100013 235100                    LDA     11,,PR1
         0 000325   000001 115007                    CMPA    1,DL
         0 000326   000332 600000 0                  TZE     s:7867
         0 000327   000011 236100                    LDQ     9,,PR0
         0 000330   000040 316003                    CANQ    32,DU
         0 000331   000335 601000 0                  TNZ     s:7870

      505     7866    3             DO;

      506     7867    3             K$RWPARM.ERR=KQGE_SZ2BIG#;

   7867  0 000332   000007 236007                    LDQ     7,DL
         0 000333   100013 756100                    STQ     11,,PR1

      507     7868    3             ALTRETURN;

   7868  0 000334   000000 702200 xent               TSX2  ! X66_AALT

      508     7869    3             END;
      509     7870    2           K$RWPARM.ERR=KQGE_DLTR#;

   7870  0 000335   000011 235007                    LDA     9,DL
         0 000336   100013 755100                    STA     11,,PR1

      510     7871    2           SIZ=(((K$RWPARM.MSGSZ+3)/4)*4)-K$RWPARM.MSGSZ;

   7871  0 000337   100001 236100                    LDQ     1,,PR1
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:70   
         0 000340   000003 036007                    ADLQ    3,DL
         0 000341   000004 506007                    DIV     4,DL
         0 000342   000002 736000                    QLS     2
         0 000343   000027 676000 xsym               ERQ     B_VECTNIL+23
         0 000344   000001 036007                    ADLQ    1,DL
         0 000345   100001 036100                    ADLQ    1,,PR1
         0 000346   000027 676000 xsym               ERQ     B_VECTNIL+23
         0 000347   000001 036007                    ADLQ    1,DL
         0 000350   200005 756100                    STQ     SIZ,,AUTO

      511     7872    2           IF SIZ~=0 THEN PINCRC(K$RWPARM.MSG$,K$RWPARM.MSGSZ)->VCHR=' ';

   7872  0 000351   000360 600000 0                  TZE     s:7873

   7872  0 000352   100001 236100                    LDQ     1,,PR1
         0 000353   100000 473500                    LDP3    0,,PR1
         0 000354   200005 720100                    LXL0    SIZ,,AUTO
         0 000355   040146 100400                    MLR     fill='040'O
         0 000356   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         0 000357   300000 000010                    ADSC9   0,Q,PR3                  cn=0,n=*X0

      512     7873    2           IOQ$=LDCT.IOQ$;

   7873  0 000360   000001 236100                    LDQ     1,,PR0
         0 000361   200007 756100                    STQ     IOQ$,,AUTO

      513     7874    2           IOQ$->N$REQ.DVE=K$RWPARM.DVE;

   7874  0 000362   100010 220100                    LDX0    8,,PR1
         0 000363   200007 473500                    LDP3    IOQ$,,AUTO
         0 000364   300031 740100                    STX0    25,,PR3

      514     7875    2           IOQ$->N$REQ.FC=K$RWPARM.FC;

   7875  0 000365   100010 236100                    LDQ     8,,PR1
         0 000366   300003 552104                    STBQ    3,'04'O,PR3

PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:71   
      515     7876    2           CALL SETQ1;

   7876  0 000367   000377 701000 0                  TSX1    SETQ1
         0 000370   000000 011000                    NOP     0

      516     7877    2           ALTRETURN;

   7877  0 000371   000000 702200 xent               TSX2  ! X66_AALT

      517     7878    2           END;
      518     7879
      519     7880    1   SETQ: PROC ALTRET;

   7880  0 000372   200062 741300       SETQ         STX1  ! IPARM+40,,AUTO

      520     7881
      521     7882    2         IOQ$=LDCT.IOQ$;

   7882  0 000373   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000374   000001 236100                    LDQ     1,,PR0
         0 000375   200007 756100                    STQ     IOQ$,,AUTO
         0 000376   000400 710000 0                  TRA     s:7886

      522     7883
      523     7884    2   SETQ1: ENTRY ALTRET;

   7884  0 000377   200062 741300       SETQ1        STX1  ! IPARM+40,,AUTO

      524     7885
      525     7886    2         IOQ$->N$REQ.BUF$=K$RWPARM.MSG$;

   7886  0 000400   200004 470500                    LDP0    @K$RWPARM,,AUTO
         0 000401   000000 236100                    LDQ     0,,PR0
         0 000402   200007 471500                    LDP1    IOQ$,,AUTO
         0 000403   100005 756100                    STQ     5,,PR1

      526     7887    2         IOQ$->N$REQ.BUFSIZE=K$RWPARM.MSGSZ;
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:72   

   7887  0 000404   000001 236100                    LDQ     1,,PR0
         0 000405   000020 736000                    QLS     16
         0 000406   100004 676100                    ERQ     4,,PR1
         0 000407   000034 376000 xsym               ANQ     B_VECTNIL+28
         0 000410   100004 656100                    ERSQ    4,,PR1

      527     7888    2         IOQ$->N$REQ.OPFLG.BPF='1'B;

   7888  0 000411   000010 236007                    LDQ     8,DL
         0 000412   100004 256100                    ORSQ    4,,PR1

      528     7889    2         CALL NIO$QUE (IOQ$->N$REQ);

   7889  0 000413   200007 630500                    EPPR0   IOQ$,,AUTO
         0 000414   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000415   000000 701000 xent               TSX1    NIO$QUE
         0 000416   000000 011000                    NOP     0

      529     7890    2         RETURN;

   7890  0 000417   200062 221300                    LDX1  ! IPARM+40,,AUTO
         0 000420   000001 702211                    TSX2  ! 1,X1

      530     7891
      531     7892    2   RWER: ENTRY ALTRET;

   7892  0 000421   200062 741300       RWER         STX1  ! IPARM+40,,AUTO

      532     7893
      533     7894    2         IF LDCT.DFLG.RRR

   7894  0 000422   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000423   000006 236100                    LDQ     6,,PR0
         0 000424   001000 316007                    CANQ    512,DL
         0 000425   000463 600000 0                  TZE     s:7906

PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:73   
      534     7895    3         THEN DO;

      535     7896                %LOCK (G=NK$LDCT.LOCK);

   7897  0 000426   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000427   000020 036003                    ADLQ    16,DU
         0 000430   200064 756100                    STQ     IPARM+42,,AUTO
         0 000431   200064 630500                    EPPR0   IPARM+42,,AUTO
         0 000432   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000433   000000 701000 xent               TSX1    HFC$LOCK
         0 000434   000000 011000                    NOP     0

      536     7899    3           IPARM = K_RWPARM_CON;

   7899  0 000435   000100 100400                    MLR     fill='000'O
         0 000436   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         0 000437   200012 000234                    ADSC9   IPARM,,AUTO              cn=0,n=156

      537     7900    3           IPARM.MSG_ERRCODE = K$RWPARM.ERP;

   7900  0 000440   200004 470500                    LDP0    @K$RWPARM,,AUTO
         0 000441   000013 236100                    LDQ     11,,PR0
         0 000442   200051 756100                    STQ     IPARM+31,,AUTO

      538     7901    3           CALL KIA$FCNO (LDCT,%KV_VDO_FNC_DAT,IPARM) ALTRET (ALTIT);

   7901  0 000443   200012 631500                    EPPR1   IPARM,,AUTO
         0 000444   200066 451500                    STP1    IPARM+44,,AUTO
         0 000445   000002 236000 1                  LDQ     2
         0 000446   200003 235100                    LDA     @NK$LDCT,,AUTO
         0 000447   200064 757100                    STAQ    IPARM+42,,AUTO
         0 000450   200064 630500                    EPPR0   IPARM+42,,AUTO
         0 000451   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000452   000000 701000 xent               TSX1    KIA$FCNO
         0 000453   000474 702000 0                  TSX2    ALTIT

      539     7902                %UNLOCK (G=NK$LDCT.LOCK);
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:74   

   7903  0 000454   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000455   000020 036003                    ADLQ    16,DU
         0 000456   200064 756100                    STQ     IPARM+42,,AUTO
         0 000457   200064 630500                    EPPR0   IPARM+42,,AUTO
         0 000460   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000461   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000462   000000 011000                    NOP     0

      540     7905    3           END;

      541     7906    2         CALL KQP$DONE (LDCT,K$RWPARM);

   7906  0 000463   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000464   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000465   000000 701000 xent               TSX1    KQP$DONE
         0 000466   000000 011000                    NOP     0

      542     7907    3           DO INHIBIT;

      543     7908    3           LDCT.DFLG.PPND='0'B;

   7908  0 000467   200003 470700                    LDP0  ! @NK$LDCT,,AUTO
         0 000470   000001 236200 1                  LDQ   ! 1
         0 000471   000006 356300                    ANSQ  ! 6,,PR0

      544     7909    3           END;

      545     7910    2         RETURN;

   7910  0 000472   200062 221300                    LDX1  ! IPARM+40,,AUTO
         0 000473   000001 702211                    TSX2  ! 1,X1

   7908  0 000474                       ALTIT        null
      546     7911    2   ALTIT:;
      547     7912    2         ALTRETURN;

PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:75   
   7912  0 000474   200062 221300                    LDX1  ! IPARM+40,,AUTO
         0 000475   000000 702211                    TSX2  ! 0,X1

(unnamed)
 Sect OctLoc
   1     000   000014 400000   777777 777737   000007 006000                    ............
      548     7913    2   END;
      549     7914
      550     7915    1   END;
      551     7916
      552     7917
      553     7918        %EOD;

PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:76   
--  Include file information  --

   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KI$MHDR.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure KCD$RDGO.
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:77   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
     7-0-0/w PTR         r     1 IOQ$                      12-0-0/d STRC(1404)  r     1 IPARM
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                   6-0-0/w UBIN(18)    r     1 MINRD
    *0-0-0/d STRC(864)   r     1 NK$LDCT                   10-0-0/w SBIN        r     1 RDSOUT
     5-0-0/w UBIN        r     1 SIZ

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1404)  r     1 K_RWPARM_CON

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(144)   r     1 KI$QMHDR                   0-0-0/d STRC(6516)  r     1 KQ_CG
     0-0-0/d STRC(1296)  r     1 KQ_STA                     0-0-0/d STRC(1080)  r     1 N$REQ
     0-0-0/c ACHR        r     1 VCHR


   Procedure KCD$RDGO requires 318 words for executable code.
   Procedure KCD$RDGO requires 56 words of local(AUTO) storage.
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:78   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:79   
          MINI XREF LISTING

ALTIT IN PROCEDURE SETQ
      7908**LABEL    7901--CALLALT
ALTRT
      7770**LABEL    7857--CALLALT  7859--CALLALT
DCK
      7748**LABEL    7709--GOTO
HFC$LOCK
      2304**DCL-ENT  7711--CALL     7897--CALL
HFC$UNLOCK
      2304**DCL-ENT  7724--CALL     7903--CALL
IOQ$
      7361**DCL      7362--REDEF    7873<<ASSIGN   7874>>ASSIGN   7875>>ASSIGN   7882<<ASSIGN   7886>>ASSIGN
      7887>>ASSIGN   7888>>ASSIGN   7889>>CALL
IPARM
      7385**DCL      7714<<ASSIGN   7718<>CALL     7749<>CALL     7899<<ASSIGN   7901<>CALL
IPARM.BLKREC
      7411**DCL      7436--REDEF
IPARM.BLKREC.BLKU#
      7412**DCL      7414--REDEF
IPARM.BLKREC.RECU#
      7424**DCL      7426--REDEF
IPARM.DVE.DVBYTE.VFC
      7451**DCL      7452--REDEF
IPARM.DVE.EOMCHAR
      7459**DCL      7463--REDEF
IPARM.ERR
      7523**DCL      7528--REDEF    7754>>IF       7770>>ASSIGN
IPARM.FC
      7487**DCL      7488--REDEF
IPARM.FLDID
      7669**DCL      7670--REDEF
IPARM.FPT$
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:80   
      7550**DCL      7557--REDEF
IPARM.FUNCTION
      7564**DCL      7748<<ASSIGN
IPARM.IP$
      7515**DCL      7715<<ASSIGN
IPARM.KEYTYPE
      7676**DCL      7677--REDEF
IPARM.LDCT$
      7546**DCL      7747<<ASSIGN
IPARM.MSG$
      7386**DCL      7392--REDEF    7722>>ASSIGN
IPARM.MSGID
      7498**DCL      7503--REDEF
IPARM.MSGIDXT
      7511**DCL      7515--REDEF
IPARM.MSGSZ
      7393**DCL      7720>>ASSIGN
IPARM.MSG_ERRCODE
      7646**DCL      7900<<ASSIGN
IPARM.ORG
      7647**DCL      7648--REDEF
IPARM.THDRSZ
      7591**DCL      7595--REDEF
IPARM.UHDR$
      7536**DCL      7716<<ASSIGN
IPARM.UHDRSZ
      7541**DCL      7717<<ASSIGN
IPARM.VDOFLGS
      7649**DCL      7660--REDEF
K$RWPARM
      5782**DCL        27--PROC     7726<>CALL     7730<>CALL     7786<>CALL     7808--ENTRY    7823<>CALL
      7852--ENTRY    7857<>CALL     7859<>CALL     7860<>CALL     7906<>CALL
K$RWPARM.BLKREC
      5808**DCL      5833--REDEF
K$RWPARM.BLKREC.BLKU#
      5809**DCL      5811--REDEF
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:81   
K$RWPARM.BLKREC.RECU#
      5821**DCL      5823--REDEF
K$RWPARM.DVE
      5839**DCL      7874>>ASSIGN
K$RWPARM.DVE.DVBYTE.VFC
      5848**DCL      5849--REDEF
K$RWPARM.DVE.EOMCHAR
      5856**DCL      5860--REDEF
K$RWPARM.ERP
      5925**DCL      7900>>ASSIGN
K$RWPARM.ERR
      5920**DCL      5925--REDEF    7729>>IF       7770>>IF       7770<<ASSIGN   7778>>IF       7790>>IF
      7865>>IF       7867<<ASSIGN   7870<<ASSIGN
K$RWPARM.FC
      5884**DCL      5885--REDEF    7875>>ASSIGN
K$RWPARM.FLDID
      6066**DCL      6067--REDEF
K$RWPARM.FPT$
      5947**DCL      5954--REDEF
K$RWPARM.KEYTYPE
      6073**DCL      6074--REDEF
K$RWPARM.MSG$
      5783**DCL      5789--REDEF    7722>>ASSIGN   7872>>ASSIGN   7886>>ASSIGN
K$RWPARM.MSGID
      5895**DCL      5900--REDEF
K$RWPARM.MSGIDXT
      5908**DCL      5912--REDEF
K$RWPARM.MSGSZ
      5790**DCL      7721>>IF       7721>>ASSIGN   7871>>ASSIGN   7871>>ASSIGN   7872>>ASSIGN   7887>>ASSIGN
K$RWPARM.ORG
      6044**DCL      6045--REDEF
K$RWPARM.THDRSZ
      5988**DCL      5992--REDEF
K$RWPARM.VDOFLGS
      6046**DCL      6057--REDEF
KCF$FERDS
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:82   
      7687**DCL-ENT  7745--CALL
KCF$FEWRT
      7686**DCL-ENT  7859--CALL
KCF$INCMP
      7688**DCL-ENT  7730--CALL     7823--CALL
KCL$CNSRD
      7690**DCL-ENT  7786--CALL
KI$QMHDR.FPTSZ
      7340**DCL      7341--REDEF
KI$QMHDR.MSGSZ
      7346**DCL      7347--REDEF
KI$QMHDR.OFFSET
      7334**DCL      7716>>ASSIGN
KI$QMHDR.SIZE
      7335**DCL      7717>>ASSIGN
KI$QMHDR.UID
      7336**DCL      7337--REDEF
KIA$FCNO
      7691**DCL-ENT  7901--CALL
KIA$MSG
      7692**DCL-ENT  7718--CALL
KIQ$MAPFEP
      7693**DCL-ENT  7713--CALL
KIS$OSI_SEND
      7697**DCL-ENT  7857--CALL
KIS$SEND
      7696**DCL-ENT  7749--CALL
KQG$DONE
      7694**DCL-ENT  7860--CALL
KQP$DONE
      7695**DCL-ENT  7726--CALL     7906--CALL
KQ_CG.AUCTL.DVBYTE.REREAD
      6536**DCL      6537--REDEF
KQ_CG.AUCTL.MINRD
      6542**DCL      7742>>ASSIGN
KQ_STA.ACTTYC
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:83   
      6883**DCL      6887--REDEF
KQ_STA.DCBLNK$
      6890**DCL      6893--REDEF    6897--REDEF
KQ_STA.EVCNT
      6976**DCL      6979--REDEF
KQ_STA.EVNT
      6942**DCL      6946--REDEF    6949--REDEF
KQ_STA.MINRD
      7074**DCL      7741>>IF       7743>>ASSIGN
KQ_STA.OPNBLKED
      7003**DCL      7006--REDEF
KQ_STA.OPNREJ
      7009**DCL      7011--REDEF
KQ_STA.SUCCREAD
      6932**DCL      6936--REDEF
KQ_STA.TCOUNT
      7061**DCL      7067--REDEF
KQ_STA.VGOT$
      7046**DCL      7050--REDEF    7054--REDEF
K_RWPARM_CON
      1995**DCL      7714>>ASSIGN   7899>>ASSIGN
K_RWPARM_CON.BLKREC
      2021**DCL      2046--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      2022**DCL      2024--REDEF
K_RWPARM_CON.BLKREC.RECU#
      2034**DCL      2036--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      2061**DCL      2062--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      2069**DCL      2073--REDEF
K_RWPARM_CON.ERR
      2133**DCL      2138--REDEF
K_RWPARM_CON.FC
      2097**DCL      2098--REDEF
K_RWPARM_CON.FLDID
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:84   
      2279**DCL      2280--REDEF
K_RWPARM_CON.FPT$
      2160**DCL      2167--REDEF
K_RWPARM_CON.KEYTYPE
      2286**DCL      2287--REDEF
K_RWPARM_CON.MSG$
      1996**DCL      2002--REDEF
K_RWPARM_CON.MSGID
      2108**DCL      2113--REDEF
K_RWPARM_CON.MSGIDXT
      2121**DCL      2125--REDEF
K_RWPARM_CON.ORG
      2257**DCL      2258--REDEF
K_RWPARM_CON.THDRSZ
      2201**DCL      2205--REDEF
K_RWPARM_CON.VDOFLGS
      2259**DCL      2270--REDEF
MINRD
      7360**DCL      7742<<ASSIGN   7743<<ASSIGN   7744>>IF
N$REQ
      7255**DCL      7889<>CALL
N$REQ.BUF$
      7264**DCL      7886<<ASSIGN
N$REQ.BUFADDR
      7264**DCL      7265--REDEF    7265--REDEF
N$REQ.BUFSIZE
      7258**DCL      7887<<ASSIGN
N$REQ.DLA.DRELADDR
      7256**DCL      7256--REDEF
N$REQ.DVE
      7290**DCL      7874<<ASSIGN
N$REQ.DVE.EOMCHAR
      7293**DCL      7294--REDEF
N$REQ.EAINFO
      7287**DCL      7287--REDEF
N$REQ.EAINFOX
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:85   
      7287**DCL      7288--REDEF
N$REQ.EVNTINFO
      7288**DCL      7288--REDEF
N$REQ.FC
      7258**DCL      7875<<ASSIGN
N$REQ.OPFLG.BPF
      7263**DCL      7888<<ASSIGN
N$REQ.STATUS
      7269**DCL      7275--REDEF
NIO$QUE
      7698**DCL-ENT  7889--CALL
NK$LDCT
      5728**DCL        27--PROC     7726<>CALL     7730<>CALL     7745<>CALL     7747--ASSIGN   7783<>CALL
      7786<>CALL     7808--ENTRY    7823<>CALL     7852--ENTRY    7857<>CALL     7859<>CALL     7860<>CALL
      7901<>CALL     7906<>CALL
NK$LDCT.CG$
      5759**DCL      7742>>ASSIGN
NK$LDCT.DDT$
      5730**DCL      5730--REDEF
NK$LDCT.DFLG.CONSOLE
      5733**DCL      7776>>IF
NK$LDCT.DFLG.LOCAL
      5734**DCL      7705>>IF       7810>>IF       7854>>IF
NK$LDCT.DFLG.PPND
      5736**DCL      7734<<ASSIGN   7767<<ASSIGN   7781<<ASSIGN   7908<<ASSIGN
NK$LDCT.DFLG.RRR
      5734**DCL      7727>>IF       7894>>IF
NK$LDCT.IOQ$
      5729**DCL      5730--REDEF    7873>>ASSIGN   7882>>ASSIGN
NK$LDCT.IP$
      5750**DCL      7707>>IF       7715>>ASSIGN   7716>>ASSIGN   7716>>ASSIGN   7717>>ASSIGN   7735<<ASSIGN
      7768<<ASSIGN
NK$LDCT.IPFEI#
      5751**DCL      7713<>CALL
NK$LDCT.LDCTX
      5731**DCL      5731--REDEF
PL6.E3A0      #002=KCD$RDGO File=KCD$CGDEV.:E05TSI                               WED 07/30/97 00:12 Page:86   
NK$LDCT.LKFLG.ABORTED
      5743**DCL      5744--REDEF
NK$LDCT.LKFLG.ACTIVE
      5747**DCL      7865>>IF
NK$LDCT.LOCK
      5756**DCL      7711<>CALL     7724<>CALL     7897<>CALL     7903<>CALL
NK$LDCT.RDSOUT
      5737**DCL      7738>>ASSIGN   7740<<ASSIGN
NK$LDCT.RESCOD
      5736**DCL      7856>>IF
NK$LDCT.RLCID.LDCTX
      5753**DCL      5753--REDEF
NK$LDCT.STA$
      5749**DCL      5750--REDEF    7741>>IF       7741>>IF       7743>>ASSIGN
NK$LDCT.SYMB$
      5728**DCL      5728--REDEF    5728--REDEF    5729--REDEF
OCI$SPINTCON
      7699**DCL-ENT  7783--CALL
RDSOUT
      7363**DCL      7738<<ASSIGN   7739>>IF       7739<<ASSIGN   7739>>ASSIGN   7740>>ASSIGN   7744>>IF
SC_CGNOTIMP
      7701**DCL-ENT  7821--CALL
SC_ICQLCG
      7700**DCL-ENT  7754--CALL
SETQ
      7880**PROC     7791--CALL
SETQ1 IN PROCEDURE SETQ
      7884**ENTRY    7876--CALL
SIZ
      7359**DCL      7245--IMP-SIZ  7720<<ASSIGN   7721>>IF       7721<<ASSIGN   7722>>ASSIGN   7722>>ASSIGN
      7871<<ASSIGN   7872>>IF       7872>>ASSIGN
VCHR
      7245**DCL      7722<<ASSIGN   7722>>ASSIGN   7872<<ASSIGN

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:87   
      554        1        /*T***********************************************************/
      555        2        /*T*                                                         */
      556        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      557        4        /*T*                                                         */
      558        5        /*T***********************************************************/
      559        6
      560        7        /*F* NAME:         KCD$ACTRM
      561        8             PURPOSE:      To activate comgroup devices
      562        9             DESCRIPTION:  Called from KQC$CTL when the comgroup
      563       10                           wants to activate the device.  Called
      564       11                           from FOM$PMME when OUTSYM/MOOS start
      565       12                           symbiont output on an OUTSYM device.
      566       13
      567       14                           To activate a comgroup terminal means
      568       15                           to start it reading and/or writing
      569       16                           the comgroup, in order to (respectively)
      570       17                           write and read the device.  This
      571       18                           takes many forms:
      572       19
      573       20                           o For OUTSYM FEP-connected devices,
      574       21                             we send an OPEN-SYMBIONT msg to
      575       22                             the FEP.
      576       23                           o For other FEP-connected devices, we
      577       24                             send an OPEN msg to the FEP.  Then,
      578       25                             if it's an INPUT device, we call
      579       26                             KCF$FERDS to start reading the
      580       27                             device.
      581       28                           o For non-OUTSYM local devices (note
      582       29                             that the SYMBIONT bit in the LDCT
      583       30                             is only on when an OUTSYM device
      584       31                             is active), we start the I/O process
      585       32                             by calling KCL (see the *P* for
      586       33                             KCL$CGLCL).
      587       34        */
      588       35
      589       36        KCD$ACTRM: PROC (NK$LDCT);
      590       37
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:88   
      591       38
      592       39
      593       40
      594       41
      595       42        /* INCLUDES */
      596       43
      597       44        %INCLUDE KC_CP6;
      598      604        %INCLUDE KI_CP6;
      599     1700        %INCLUDE KC$CP6V_C;
      600     1820        %INCLUDE NK$LDCT;
      601     1922        %INCLUDE KC$CGBLK;
      602     1970        %INCLUDE KQ_MAC_C;
      603     4520        %INCLUDE HF_LOCK_C;
      604     4534        %INCLUDE KV$VDO;
      605     5549        %INCLUDE KQ_SUBS_C;
      606     5849        %INCLUDE K_DATA_R;
      607     6560        %INCLUDE NK_SUBS;
      608     6585        %INCLUDE SS_SCHED_C;
      609     6818        %INCLUDE JG_GHOSTS_C;
      610     6908
      611     6909
      612     6910        /* Equates */
      613     6911        %KV_VDO_ALL_E;
      614     6990
      615     6991
      616     6992
      617     6993        /* PARAMETERS */
      618     6994
      619     6995        %NK$LDCT (STCLASS=PARAM);
      620     7041
      621     7042
      622     7043
      623     7044        /* BASED STRUCTURES */
      624     7045
      625     7046        %KQ_CG (FPTN=KQ$CG,STCLASS=BASED);
      626     7785        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      627     8124        %NK$LDCT (NAME=LD$CT,STCLASS=BASED);
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:89   
      628     8170
      629     8171
      630     8172
      631     8173
      632     8174        /* AUTO */
      633     8175
      634     8176        %K$RWPARM (STCLASS=AUTO,NAME=K$RWPARM);
      635     8492    1   DCL FCN UBIN WORD;
      636     8493    1   DCL CLDQ UBIN WORD;
      637     8494    1   DCL LDCT$ PTR;
      638     8495
      639     8496
      640     8497
      641     8498
      642     8499        /* CONSTANT */
      643     8500
      644     8501    1   DCL NOCGM CHAR(0) CONSTANT INIT('*** Your comgroup is no longer available ***');
      645     8502
      646     8503
      647     8504
      648     8505
      649     8506        /* REFS */
      650     8507
      651     8508    1   DCL KCD$DSCTRM     ENTRY(2);
      652     8509    1   DCL KCD$DSCTRML     ENTRY(1);
      653     8510    1   DCL KCF$FERDS     ENTRY(1) ALTRET;
      654     8511    1   DCL KCF$QFL       ENTRY(1) ALTRET;
      655     8512    1   DCL KCL$GET       ENTRY(1);
      656     8513    1   DCL KCL$PUT       ENTRY(1);
      657     8514    1   DCL KIA$DSC ENTRY(3) ALTRET;
      658     8515    1   DCL KIA$FCNO      ENTRY(3) ALTRET;
      659     8516    1   DCL KIA$FCNOU     ENTRY(3) ALTRET;
      660     8517    1   DCL KIA$OQFL      ENTRY(1) ALTRET;
      661     8518    1   DCL KQP$DISC      ENTRY(1) ALTRET;
      662     8519    1   DCL KQX$LDASR     ENTRY(1);
      663     8520    1   DCL SSR$REG       ENTRY(3) ALTRET;
      664     8521        %K$RWPARM (NAME=KC_CRWP,STCLASS=SYMREF);
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:90   
      665     8837    1   DCL S_CUN UBIN SYMREF;
      666     8838        %EJECT;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:91   
      667     8839
      668     8840
      669     8841              %LOCK (G=NK$LDCT.LOCK);
      670     8844    2           DO WHILE (LDCT.QFL ~= '0'B);
      671     8845    2           CALL KIA$OQFL(LDCT)
      672     8846    3           WHENALTRETURN DO;
      673     8847                  %UNLOCK (G=LDCT.LOCK);
      674     8850    3             RETURN;
      675     8851    3             END;
      676     8852    2           END;
      677     8853    1         IF LDCT.DFLG.OLDSC THEN
      678     8854    2           DO;
      679     8855                %UNLOCK (G=NK$LDCT.LOCK);
      680     8858    2           RETURN;
      681     8859    2           END;
      682     8860
      683     8861    1         FCN=BITBIN(LDCT.LKFLG.ACTIVE);
      684     8862    1         IF ~LDCT.DFLG.LOCAL THEN
      685     8863    2           DO;
      686     8864    2           IF FCN = 0 THEN
      687     8865    3             DO;
      688     8866    3             LDCT.TH.MAXNMBBYT=-1;
      689     8867    3             FCN=%KV_VDO_FNC_OPNSSN_RQS;
      690     8868    3             LDCT.LKFLG.ACTIVE='1'B;
      691     8869    3             K$RWPARM = K_RWPARM_CON;
      692     8870    3             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_LSTRCRID;
      693     8871    3             K$RWPARM.STATION = LDCT.DEVNM;
      694     8872    3             K$RWPARM.MSGTYP = '?';
      695     8873    3             CALL KIA$FCNOU (LDCT,FCN,K$RWPARM)
      696     8874    4             WHENALTRETURN DO;
      697     8875                    %UNLOCK (G=NK$LDCT.LOCK);
      698     8878    4               RETURN;
      699     8879    4               END;
      700     8880    3             END;
      701     8881                %UNLOCK (G=NK$LDCT.LOCK);
      702     8884    2           IF LDCT.DFLG.INPUT THEN CALL KCF$FERDS (LDCT);
      703     8885    2           END;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:92   
      704     8886    2         ELSE DO;
      705     8887    2           LDCT.LKFLG.ACTIVE='1'B;
      706     8888                %UNLOCK (G=NK$LDCT.LOCK);
      707     8891    2           IF LDCT.DFLG.SYMBIONT='0'B AND FCN=0 THEN
      708     8892    3             DO;
      709     8893    3             IF LDCT.DFLG.OUTPUT THEN CALL KCL$GET (ADDR(LDCT));
      710     8894    3             ELSE CALL KCL$PUT (ADDR(LDCT));
      711     8895    3             END;
      712     8896    2           END;
      713     8897    1   RTN:  ;
      714     8898    1         RETURN;
      715     8899        %EJECT;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:93   
      716     8900
      717     8901        /*F* NAME:         KCD$DACDSC
      718     8902             PURPOSE:      To deactivate-disconnect a comgroup terminal
      719     8903             DESCRIPTION:  Just like KCD$DACTRM but sends a DREQ message
      720     8904                           to the FEP instead of CLOSE.  This tells the
      721     8905                           FEP to 'pretend' the device disconnected, and
      722     8906                           start the disconnect sequence by sending us
      723     8907                           DISC. */
      724     8908    1   KCD$DACDSC: ENTRY (LDCT);
      725     8909
      726     8910    1         CALL LKCK ALTRET (RTN);
      727     8911    1   DSC:  ;
      728     8912    1         LDCT.CLDQ=0;
      729     8913    1         CLDQ=3;
      730     8914    1         FCN=%KV_VDO_FNC_DSC_RQS;
      731     8915    1         CALL CLRFCND;
      732     8916    1         RETURN;
      733     8917
      734     8918        /*F* NAME:         KCD$RELTRM
      735     8919             PURPOSE:      To put a comgroup terminal in 'limbo'.
      736     8920             DESCRIPTION:  This action is only slightly less extreme
      737     8921                           than deactivate-disconnect.  It first
      738     8922                           deactivates the device.  Then it essentially
      739     8923                           pretends to the comgroup that the terminal
      740     8924                           disconnected, and
      741     8925                           pretends to the terminal that its comgroup
      742     8926                           just went away.  Depending on how the device
      743     8927                           is defined by SUPER, that situation would
      744     8928                           causes real disconnect, and so that's what
      745     8929                           we do here to such terminals.  If, on the
      746     8930                           other hand, the terminal is SUPER-defined
      747     8931                           to wait around in limbo, that is, connected
      748     8932                           to CP-6 but not to a comgroup, waiting for
      749     8933                           the comgroup to become available, then we
      750     8934                           pretend to the comgroup that the terminal
      751     8935                           disconnected, and put the terminal on the
      752     8936                           'NOCG' chain when the disconnection is
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:94   
      753     8937                           complete on the comgroup side.
      754     8938                           FPRG terminals coming through here will always
      755     8939                           deactivate since they may not exist in a
      756     8940                           limbo state. */
      757     8941    1   KCD$RELTRM: ENTRY (LDCT);
      758     8942
      759     8943    1         CALL LKCK ALTRET (RTN);
      760     8944    1         IF LDCT.NOCGREJ OR LDCT.RESCOD=NK_CGFPRG THEN GOTO DSC;
      761     8945    1         IF LDCT.NOCGINF AND LDCT.LKFLG.ACTIVE THEN
      762     8946    2           DO;
      763     8947                %UNLOCK (G=NK$LDCT.LOCK);
      764     8950    2           K$RWPARM = KC_CRWP;
      765     8951    2           K$RWPARM.MSG$ = ADDR(NOCGM);
      766     8952    2           K$RWPARM.MSGSZ = LENGTHC(NOCGM);
      767     8953    2           K$RWPARM.DVE.VFC = 'd';
      768     8954    2           K$RWPARM.DVE.DVBYTE.VFC = '1'B;
      769     8955    2           CALL KIA$FCNO(NK$LDCT,%KV_VDO_FNC_DAT_IMD,K$RWPARM)
      770     8956    2           ALTRET (QFLRLT);
      771     8957    2           CALL LKCK ALTRET (RTN);
      772     8958    2           END;
      773     8959    1         LDCT.CLDQ=0;
      774     8960    1         LDCT.LKFLG.RLTRM='1'B;
      775     8961    1         IF LDCT.LKFLG.ACTIVE THEN
      776     8962    2           DO;
      777     8963    2           CLDQ=2;
      778     8964    2   RLT:    ;
      779     8965    2           CALL CLRFCN ALTRET (RTN);
      780     8966    2           END;
      781     8967    1         ELSE
      782     8968    2           DO;
      783     8969                %UNLOCK (G=NK$LDCT.LOCK);
      784     8972    2           END;
      785     8973    1         CALL KQP$DISC (LDCT);
      786     8974    1         RETURN;
      787     8975
      788     8976        /*F* NAME:         KCD$DACTRM
      789     8977             PURPOSE:      To deactivate a comgroup terminal
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:95   
      790     8978             DESCRIPTION:  Deactivation means to stop doing I/O
      791     8979                           on the device.  This first means zapping
      792     8980                           ACTIVE in the LDCT.  Millions of people
      793     8981                           look at this bit and quit mucking around
      794     8982                           if they find it reset, thus all I/O activity
      795     8983                           will stop rather quickly when we zap the
      796     8984                           bit.  Next, for FEP-connected devices we
      797     8985                           send a CLOSE message to the FEP.  This
      798     8986                           tells the FEP to perform a partial lobotomy
      799     8987                           on the device's path, throwing away all
      800     8988                           data, sending EOF to HASP output devices,
      801     8989                           and suchlike. */
      802     8990    1   KCD$DACTRM: ENTRY(LDCT);
      803     8991
      804     8992    1         CALL LKCK ALTRET (RTN);
      805     8993    1         IF LDCT.RESCOD=NK_CGFPRG THEN GOTO DSC;
      806     8994                                /* Always DACDSC an FPRG path on deactivate          */
      807     8995    1         IF LDCT.LKFLG.ACTIVE THEN CALL CLRFCNC ALTRET (RTN);
      808     8996    1         ELSE GOTO UOUT;
      809     8997    1         RETURN;
      810     8998
      811     8999        /*F* NAME:         KCD$CLDQ
      812     9000             PURPOSE:      To try again to send a message which was
      813     9001                           delayed due to a full circular queue.
      814     9002             DESCRIPTION:  LDCT.QFL.CLDQ set says that we need to
      815     9003                           send the message encoded in LDCT.CLDQ.
      816     9004                           The various routines in this module
      817     9005                           do that when the msg they need to send
      818     9006                           to the FEP can't be sent because the
      819     9007                           output circular queue is full or a
      820     9008                           write-crossing-coupler is going on.
      821     9009                           When the blocking condition is removed
      822     9010                           (the WCC finishes or the output circular
      823     9011                           queue gets some space), KCF calls here
      824     9012                           to give us another shot at sending the
      825     9013                           message.  This delay mechanism is the
      826     9014                           reason that one need not call KCD$DACTRM
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:96   
      827     9015                           (and similar routines) on behalf of any
      828     9016                           user.  Note that KCD$ACTRM doesn't work
      829     9017                           this way and MUST be called on behalf
      830     9018                           of a user. */
      831     9019    1   KCD$CLDQ: ENTRY (LDCT);
      832     9020
      833     9021              %LOCK (G=NK$LDCT.LOCK);
      834     9024    1         CLDQ=LDCT.CLDQ;
      835     9025    1         LDCT.CLDQ=0;
      836     9026    1         IF LDCT.DFLG.OLDSC THEN
      837     9027    2           DO;
      838     9028    2   UOUT:   ;
      839     9029                %UNLOCK (G=NK$LDCT.LOCK);
      840     9032    2           RETURN;
      841     9033    2           END;
      842     9034    2           DO CASE (CLDQ);
      843     9035    2             CASE(ELSE);
      844     9036    2               GOTO UOUT;
      845     9037    2             CASE(1);
      846     9038    2               CALL CLRFCNC ALTRET (RTN);
      847     9039    2             CASE(2);
      848     9040    2               LDCT.LKFLG.RLTRM='1'B;
      849     9041    2               GOTO RLT;
      850     9042    2             CASE(3);
      851     9043    2               GOTO DSC;
      852     9044    2           END;
      853     9045    1         RETURN;
      854     9046
      855     9047    1   QFLRLT:;
      856     9048    1         LDCT.QFL.RLT='1'B;
      857     9049    1         CALL KCF$QFL (LDCT);
      858     9050    1         RETURN;
      859     9051
      860     9052
      861     9053
      862     9054
      863     9055    1   LKCK: PROC ALTRET;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:97   
      864     9056
      865     9057              %LOCK (G=NK$LDCT.LOCK);
      866     9060    2         IF LDCT.DFLG.OLDSC
      867     9061    2         OR LDCT.LKFLG.RLTRM
      868     9062    2         OR LDCT.CLDQ>1 THEN GOTO UALT;
      869     9063    2         RETURN;
      870     9064
      871     9065    2   CLRFCNC: ENTRY ALTRET;
      872     9066
      873     9067    2         CLDQ=1;
      874     9068
      875     9069    2   CLRFCN: ENTRY ALTRET;
      876     9070
      877     9071    2         FCN=%KV_VDO_FNC_CLSSSN_RQS;
      878     9072
      879     9073    2   CLRFCND: ENTRY ALTRET;
      880     9074
      881     9075    2         LDCT.LKFLG.ACTIVE='0'B;
      882     9076    2         IF LDCT.DFLG.LOCAL THEN
      883     9077    3           DO;
      884     9078                %UNLOCK (G=NK$LDCT.LOCK);
      885     9081    3           RETURN;
      886     9082    3           END;
      887     9083    2         LDCT.TH = '0'B;
      888     9084    2         LDCT.LKFLG.OBLK = '1'B;
      889     9085    2         LDCT.RDSOUT=0;
      890     9086    2         K$RWPARM = K_RWPARM_CON;
      891     9087        /* Do a cancel */
      892     9088    2         CALL KIA$FCNO (LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM) ALTRET (QFL);
      893     9089    2         IF FCN = %KV_VDO_FNC_DSC_RQS
      894     9090    3         THEN DO;
      895     9091    3           CALL KCD$DSCTRML(LDCT);
      896     9092    3           END;
      897     9093    2         ELSE
      898     9094    2          IF (S_CUN < %JG_FROG#)  /* A GHOST THAT YOU CAN'T REG */
      899     9095    3          THEN DO;
      900     9096    3            CALL KIA$FCNO(LDCT,FCN,K$RWPARM) ALTRET (QFL);
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:98   
      901     9097                 %UNLOCK (G=NK$LDCT.LOCK);
      902     9100    3            END;
      903     9101    3          ELSE DO;
      904     9102                   /* Request that a marker be sent back, and wait for it */
      905     9103    3            K$RWPARM.MRKTYP = %KV_VDOMRKTYP_MRK;
      906     9104    3            CALL KIA$FCNO (LDCT,FCN,K$RWPARM) ALTRET (QFL);
      907     9105    3            LDCT.USER = S_CUN;
      908     9106    3            LDCT.LKFLG.WTMRK = '1'B;  /* WaiT for the MaRKer */
      909     9107    3            CALL SSR$REG(%SS_CW,ADDR(NK$LDCT));
      910     9108    3            END;
      911     9109    2         RETURN;
      912     9110    2   QFL:  ;
      913     9111    2         LDCT.LKFLG.RLTRM='0'B;
      914     9112    2         LDCT.CLDQ=CLDQ;
      915     9113    2         LDCT.QFL.CLDQ='1'B;
      916     9114    2         CALL KCF$QFL (LDCT);
      917     9115    2         ALTRETURN;
      918     9116    2   UALT: ;
      919     9117              %UNLOCK (G=NK$LDCT.LOCK);
      920     9120    2         ALTRETURN;
      921     9121    2   END;
      922     9122
      923     9123    1   END;
      924     9124        %EOD;

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:99   
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
      No diagnostics issued in procedure KCD$ACTRM.

   Procedure KCD$ACTRM requires 438 words for executable code.
   Procedure KCD$ACTRM requires 54 words of local(AUTO) storage.

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:100  

 Object Unit name= KCD$ACTRM                                  File name= KCD$CGDEV.:E05TOU
 UTS= JUL 30 '97 00:12:39.56 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     11     13  KCD$ACTRM
    1   Proc  even  none   438    666  KCD$ACTRM
    2  RoData even  none    10     12  KCD$ACTRM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KCD$ACTRM
     1    212                  yes      Std        1  KCD$DACDSC
     1    230                  yes      Std        1  KCD$RELTRM
     1    340                  yes      Std        1  KCD$DACTRM
     1    360                  yes      Std        1  KCD$CLDQ
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:101  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
 yes     yes           Std       1 KIA$OQFL
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 KIA$FCNOU
 yes     yes           Std       1 KCF$FERDS
         yes           Std       1 KCL$GET
         yes           Std       1 KCL$PUT
 yes     yes           Std       1 KQP$DISC
 yes     yes           Std       3 KIA$FCNO
 yes     yes           Std       1 KCF$QFL
 yes     yes           Std       3 SSR$REG
         yes           Std       1 KCD$DSCTRML
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    K_RWPARM_CON                          KC_CRWP                               S_CUN
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:102  


      554        1        /*T***********************************************************/
      555        2        /*T*                                                         */
      556        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      557        4        /*T*                                                         */
      558        5        /*T***********************************************************/
      559        6
      560        7        /*F* NAME:         KCD$ACTRM
      561        8             PURPOSE:      To activate comgroup devices
      562        9             DESCRIPTION:  Called from KQC$CTL when the comgroup
      563       10                           wants to activate the device.  Called
      564       11                           from FOM$PMME when OUTSYM/MOOS start
      565       12                           symbiont output on an OUTSYM device.
      566       13
      567       14                           To activate a comgroup terminal means
      568       15                           to start it reading and/or writing
      569       16                           the comgroup, in order to (respectively)
      570       17                           write and read the device.  This
      571       18                           takes many forms:
      572       19
      573       20                           o For OUTSYM FEP-connected devices,
      574       21                             we send an OPEN-SYMBIONT msg to
      575       22                             the FEP.
      576       23                           o For other FEP-connected devices, we
      577       24                             send an OPEN msg to the FEP.  Then,
      578       25                             if it's an INPUT device, we call
      579       26                             KCF$FERDS to start reading the
      580       27                             device.
      581       28                           o For non-OUTSYM local devices (note
      582       29                             that the SYMBIONT bit in the LDCT
      583       30                             is only on when an OUTSYM device
      584       31                             is active), we start the I/O process
      585       32                             by calling KCL (see the *P* for
      586       33                             KCL$CGLCL).
      587       34        */
      588       35
      589       36        KCD$ACTRM: PROC (NK$LDCT);
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:103  

     36  1 000000   000000 700200 xent  KCD$ACTRM    TSX0  ! X66_AUTO_1
         1 000001   000066 000001                    ZERO    54,1

      590       37
      591       38
      592       39
      593       40
      594       41
      595       42        /* INCLUDES */
      596       43
      597       44        %INCLUDE KC_CP6;
      598      604        %INCLUDE KI_CP6;
      599     1700        %INCLUDE KC$CP6V_C;
      600     1820        %INCLUDE NK$LDCT;
      601     1922        %INCLUDE KC$CGBLK;
      602     1970        %INCLUDE KQ_MAC_C;
      603     4520        %INCLUDE HF_LOCK_C;
      604     4534        %INCLUDE KV$VDO;
      605     5549        %INCLUDE KQ_SUBS_C;
      606     5849        %INCLUDE K_DATA_R;
      607     6560        %INCLUDE NK_SUBS;
      608     6585        %INCLUDE SS_SCHED_C;
      609     6818        %INCLUDE JG_GHOSTS_C;
      610     6908
      611     6909
      612     6910        /* Equates */
      613     6911        %KV_VDO_ALL_E;
      614     6990
      615     6991
      616     6992
      617     6993        /* PARAMETERS */
      618     6994
      619     6995        %NK$LDCT (STCLASS=PARAM);
      620     7041
      621     7042
      622     7043
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:104  
      623     7044        /* BASED STRUCTURES */
      624     7045
      625     7046        %KQ_CG (FPTN=KQ$CG,STCLASS=BASED);
      626     7785        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      627     8124        %NK$LDCT (NAME=LD$CT,STCLASS=BASED);
      628     8170
      629     8171
      630     8172
      631     8173
      632     8174        /* AUTO */
      633     8175
      634     8176        %K$RWPARM (STCLASS=AUTO,NAME=K$RWPARM);
      635     8492    1   DCL FCN UBIN WORD;
      636     8493    1   DCL CLDQ UBIN WORD;
      637     8494    1   DCL LDCT$ PTR;
      638     8495
      639     8496
      640     8497
      641     8498
      642     8499        /* CONSTANT */
      643     8500
      644     8501    1   DCL NOCGM CHAR(0) CONSTANT INIT('*** Your comgroup is no longer available ***');
      645     8502
      646     8503
      647     8504
      648     8505
      649     8506        /* REFS */
      650     8507
      651     8508    1   DCL KCD$DSCTRM     ENTRY(2);
      652     8509    1   DCL KCD$DSCTRML     ENTRY(1);
      653     8510    1   DCL KCF$FERDS     ENTRY(1) ALTRET;
      654     8511    1   DCL KCF$QFL       ENTRY(1) ALTRET;
      655     8512    1   DCL KCL$GET       ENTRY(1);
      656     8513    1   DCL KCL$PUT       ENTRY(1);
      657     8514    1   DCL KIA$DSC ENTRY(3) ALTRET;
      658     8515    1   DCL KIA$FCNO      ENTRY(3) ALTRET;
      659     8516    1   DCL KIA$FCNOU     ENTRY(3) ALTRET;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:105  
      660     8517    1   DCL KIA$OQFL      ENTRY(1) ALTRET;
      661     8518    1   DCL KQP$DISC      ENTRY(1) ALTRET;
      662     8519    1   DCL KQX$LDASR     ENTRY(1);
      663     8520    1   DCL SSR$REG       ENTRY(3) ALTRET;
      664     8521        %K$RWPARM (NAME=KC_CRWP,STCLASS=SYMREF);
      665     8837    1   DCL S_CUN UBIN SYMREF;
      666     8838        %EJECT;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:106  
      667     8839
      668     8840
      669     8841              %LOCK (G=NK$LDCT.LOCK);

   8842  1 000002   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000003   000020 036003                    ADLQ    16,DU
         1 000004   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000005   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000006   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000007   000000 701000 xent               TSX1    HFC$LOCK
         1 000010   000000 011000                    NOP     0

      670     8844    2           DO WHILE (LDCT.QFL ~= '0'B);

   8844  1 000011   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000012   000010 236100                    LDQ     8,,PR0
         1 000013   000774 316007                    CANQ    508,DL
         1 000014   000036 600000 1                  TZE     s:8853

      671     8845    2           CALL KIA$OQFL(LDCT)

   8845  1 000015   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000016   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000017   000000 701000 xent               TSX1    KIA$OQFL
         1 000020   000022 702000 1                  TSX2    s:8848
         1 000021   000032 710000 1                  TRA     s:8852

      672     8846    3           WHENALTRETURN DO;

      673     8847                  %UNLOCK (G=LDCT.LOCK);

   8848  1 000022   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000023   000020 036003                    ADLQ    16,DU
         1 000024   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000025   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000026   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000027   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:107  
         1 000030   000000 011000                    NOP     0

      674     8850    3             RETURN;

   8850  1 000031   000000 702200 xent               TSX2  ! X66_ARET

      675     8851    3             END;
      676     8852    2           END;

   8852  1 000032   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000033   000010 236100                    LDQ     8,,PR0
         1 000034   000774 316007                    CANQ    508,DL
         1 000035   000015 601000 1                  TNZ     s:8845

      677     8853    1         IF LDCT.DFLG.OLDSC THEN

   8853  1 000036   000006 236100                    LDQ     6,,PR0
         1 000037   010000 316007                    CANQ    4096,DL
         1 000040   000051 600000 1                  TZE     s:8861

      678     8854    2           DO;

      679     8855                %UNLOCK (G=NK$LDCT.LOCK);

   8856  1 000041   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000042   000020 036003                    ADLQ    16,DU
         1 000043   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000044   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000045   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000046   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000047   000000 011000                    NOP     0

      680     8858    2           RETURN;

   8858  1 000050   000000 702200 xent               TSX2  ! X66_ARET

      681     8859    2           END;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:108  
      682     8860
      683     8861    1         FCN=BITBIN(LDCT.LKFLG.ACTIVE);

   8861  1 000051   000011 236100                    LDQ     9,,PR0
         1 000052   000027 772000                    QRL     23
         1 000053   000001 376007                    ANQ     1,DL
         1 000054   200054 756100                    STQ     FCN,,AUTO

      684     8862    1         IF ~LDCT.DFLG.LOCAL THEN

   8862  1 000055   000006 236100                    LDQ     6,,PR0
         1 000056   000031 736000                    QLS     25
         1 000057   400000 376003                    ANQ     -131072,DU
         1 000060   400000 676003                    ERQ     -131072,DU
         1 000061   000147 600000 1                  TZE     s:8887

      685     8863    2           DO;

      686     8864    2           IF FCN = 0 THEN

   8864  1 000062   200054 235100                    LDA     FCN,,AUTO
         1 000063   000127 601000 1                  TNZ     s:8882

      687     8865    3             DO;

      688     8866    3             LDCT.TH.MAXNMBBYT=-1;

   8866  1 000064   777777 220003                    LDX0    -1,DU
         1 000065   000017 440100                    SXL0    15,,PR0

      689     8867    3             FCN=%KV_VDO_FNC_OPNSSN_RQS;

   8867  1 000066   000020 235007                    LDA     16,DL
         1 000067   200054 755100                    STA     FCN,,AUTO

      690     8868    3             LDCT.LKFLG.ACTIVE='1'B;

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:109  
   8868  1 000070   000040 236003                    LDQ     32,DU
         1 000071   000011 256100                    ORSQ    9,,PR0

      691     8869    3             K$RWPARM = K_RWPARM_CON;

   8869  1 000072   000100 100400                    MLR     fill='000'O
         1 000073   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000074   200004 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      692     8870    3             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_LSTRCRID;

   8870  1 000075   002000 236007                    LDQ     1024,DL
         1 000076   200044 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      693     8871    3             K$RWPARM.STATION = LDCT.DEVNM;

   8871  1 000077   000002 237100                    LDAQ    2,,PR0
         1 000100   200006 757100                    STAQ    K$RWPARM+2,,AUTO

      694     8872    3             K$RWPARM.MSGTYP = '?';

   8872  1 000101   000000 235000 2                  LDA     0
         1 000102   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000103   200010 757100                    STAQ    K$RWPARM+4,,AUTO

      695     8873    3             CALL KIA$FCNOU (LDCT,FCN,K$RWPARM)

   8873  1 000104   200004 631500                    EPPR1   K$RWPARM,,AUTO
         1 000105   200064 451500                    STP1    CLDQ+7,,AUTO
         1 000106   200054 633500                    EPPR3   FCN,,AUTO
         1 000107   200063 453500                    STP3    CLDQ+6,,AUTO
         1 000110   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000111   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000112   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000113   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000114   000000 701000 xent               TSX1    KIA$FCNOU
         1 000115   000117 702000 1                  TSX2    s:8876
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:110  
         1 000116   000127 710000 1                  TRA     s:8882

      696     8874    4             WHENALTRETURN DO;

      697     8875                    %UNLOCK (G=NK$LDCT.LOCK);

   8876  1 000117   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000120   000020 036003                    ADLQ    16,DU
         1 000121   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000122   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000123   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000124   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000125   000000 011000                    NOP     0

      698     8878    4               RETURN;

   8878  1 000126   000000 702200 xent               TSX2  ! X66_ARET

      699     8879    4               END;
      700     8880    3             END;

      701     8881                %UNLOCK (G=NK$LDCT.LOCK);

   8882  1 000127   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000130   000020 036003                    ADLQ    16,DU
         1 000131   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000132   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000133   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000134   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000135   000000 011000                    NOP     0

      702     8884    2           IF LDCT.DFLG.INPUT THEN CALL KCF$FERDS (LDCT);

   8884  1 000136   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000137   000006 236100                    LDQ     6,,PR0
         1 000140   400000 316007                    CANQ    -131072,DL
         1 000141   000211 600000 1                  TZE     RTN
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:111  

   8884  1 000142   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000143   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000144   000000 701000 xent               TSX1    KCF$FERDS
         1 000145   000000 011000                    NOP     0

      703     8885    2           END;

   8885  1 000146   000211 710000 1                  TRA     RTN

      704     8886    2         ELSE DO;

      705     8887    2           LDCT.LKFLG.ACTIVE='1'B;

   8887  1 000147   000040 236003                    LDQ     32,DU
         1 000150   000011 256100                    ORSQ    9,,PR0

      706     8888                %UNLOCK (G=NK$LDCT.LOCK);

   8889  1 000151   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000152   000020 036003                    ADLQ    16,DU
         1 000153   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000154   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000155   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000156   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000157   000000 011000                    NOP     0

      707     8891    2           IF LDCT.DFLG.SYMBIONT='0'B AND FCN=0 THEN

   8891  1 000160   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000161   000006 236100                    LDQ     6,,PR0
         1 000162   020000 316007                    CANQ    8192,DL
         1 000163   000211 601000 1                  TNZ     RTN
         1 000164   200054 235100                    LDA     FCN,,AUTO
         1 000165   000211 601000 1                  TNZ     RTN

      708     8892    3             DO;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:112  

      709     8893    3             IF LDCT.DFLG.OUTPUT THEN CALL KCL$GET (ADDR(LDCT));

   8893  1 000166   200000 316007                    CANQ    65536,DL
         1 000167   000201 600000 1                  TZE     s:8894

   8893  1 000170   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000171   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000172   200062 631500                    EPPR1   CLDQ+5,,AUTO
         1 000173   200063 451500                    STP1    CLDQ+6,,AUTO
         1 000174   200063 630500                    EPPR0   CLDQ+6,,AUTO
         1 000175   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000176   000000 701000 xent               TSX1    KCL$GET
         1 000177   000000 011000                    NOP     0
         1 000200   000211 710000 1                  TRA     RTN

      710     8894    3             ELSE CALL KCL$PUT (ADDR(LDCT));

   8894  1 000201   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000202   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000203   200062 631500                    EPPR1   CLDQ+5,,AUTO
         1 000204   200063 451500                    STP1    CLDQ+6,,AUTO
         1 000205   200063 630500                    EPPR0   CLDQ+6,,AUTO
         1 000206   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000207   000000 701000 xent               TSX1    KCL$PUT
         1 000210   000000 011000                    NOP     0

      711     8895    3             END;

      712     8896    2           END;

   8893  1 000211                       RTN          null
      713     8897    1   RTN:  ;
      714     8898    1         RETURN;

   8898  1 000211   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:113  
      715     8899        %EJECT;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:114  
      716     8900
      717     8901        /*F* NAME:         KCD$DACDSC
      718     8902             PURPOSE:      To deactivate-disconnect a comgroup terminal
      719     8903             DESCRIPTION:  Just like KCD$DACTRM but sends a DREQ message
      720     8904                           to the FEP instead of CLOSE.  This tells the
      721     8905                           FEP to 'pretend' the device disconnected, and
      722     8906                           start the disconnect sequence by sending us
      723     8907                           DISC. */
      724     8908    1   KCD$DACDSC: ENTRY (LDCT);

   8908  1 000212   000000 700200 xent  KCD$DACDSC   TSX0  ! X66_AUTO_1
         1 000213   000066 000001                    ZERO    54,1

      725     8909
      726     8910    1         CALL LKCK ALTRET (RTN);

   8910  1 000214   000443 701000 1                  TSX1    LKCK
         1 000215   000211 702000 1                  TSX2    RTN

   8893  1 000216                       DSC          null
      727     8911    1   DSC:  ;
      728     8912    1         LDCT.CLDQ=0;

   8912  1 000216   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000217   000001 236000 2                  LDQ     1
         1 000220   000010 356100                    ANSQ    8,,PR0

      729     8913    1         CLDQ=3;

   8913  1 000221   000003 235007                    LDA     3,DL
         1 000222   200055 755100                    STA     CLDQ,,AUTO

      730     8914    1         FCN=%KV_VDO_FNC_DSC_RQS;

   8914  1 000223   000012 235007                    LDA     10,DL
         1 000224   200054 755100                    STA     FCN,,AUTO

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:115  
      731     8915    1         CALL CLRFCND;

   8915  1 000225   000500 701000 1                  TSX1    CLRFCND
         1 000226   000000 011000                    NOP     0

      732     8916    1         RETURN;

   8916  1 000227   000000 702200 xent               TSX2  ! X66_ARET

      733     8917
      734     8918        /*F* NAME:         KCD$RELTRM
      735     8919             PURPOSE:      To put a comgroup terminal in 'limbo'.
      736     8920             DESCRIPTION:  This action is only slightly less extreme
      737     8921                           than deactivate-disconnect.  It first
      738     8922                           deactivates the device.  Then it essentially
      739     8923                           pretends to the comgroup that the terminal
      740     8924                           disconnected, and
      741     8925                           pretends to the terminal that its comgroup
      742     8926                           just went away.  Depending on how the device
      743     8927                           is defined by SUPER, that situation would
      744     8928                           causes real disconnect, and so that's what
      745     8929                           we do here to such terminals.  If, on the
      746     8930                           other hand, the terminal is SUPER-defined
      747     8931                           to wait around in limbo, that is, connected
      748     8932                           to CP-6 but not to a comgroup, waiting for
      749     8933                           the comgroup to become available, then we
      750     8934                           pretend to the comgroup that the terminal
      751     8935                           disconnected, and put the terminal on the
      752     8936                           'NOCG' chain when the disconnection is
      753     8937                           complete on the comgroup side.
      754     8938                           FPRG terminals coming through here will always
      755     8939                           deactivate since they may not exist in a
      756     8940                           limbo state. */
      757     8941    1   KCD$RELTRM: ENTRY (LDCT);

   8941  1 000230   000000 700200 xent  KCD$RELTRM   TSX0  ! X66_AUTO_1
         1 000231   000066 000001                    ZERO    54,1
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:116  

      758     8942
      759     8943    1         CALL LKCK ALTRET (RTN);

   8943  1 000232   000443 701000 1                  TSX1    LKCK
         1 000233   000211 702000 1                  TSX2    RTN

      760     8944    1         IF LDCT.NOCGREJ OR LDCT.RESCOD=NK_CGFPRG THEN GOTO DSC;

   8944  1 000234   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000235   000007 236100                    LDQ     7,,PR0
         1 000236   004000 316003                    CANQ    2048,DU
         1 000237   000216 601000 1                  TNZ     DSC
         1 000240   000006 236100                    LDQ     6,,PR0
         1 000241   000017 376007                    ANQ     15,DL
         1 000242   000011 116007                    CMPQ    9,DL
         1 000243   000216 600000 1                  TZE     DSC

      761     8945    1         IF LDCT.NOCGINF AND LDCT.LKFLG.ACTIVE THEN

   8945  1 000244   000007 236100                    LDQ     7,,PR0
         1 000245   002000 316003                    CANQ    1024,DU
         1 000246   000307 600000 1                  TZE     s:8959
         1 000247   000011 236100                    LDQ     9,,PR0
         1 000250   000040 316003                    CANQ    32,DU
         1 000251   000307 600000 1                  TZE     s:8959

      762     8946    2           DO;

      763     8947                %UNLOCK (G=NK$LDCT.LOCK);

   8948  1 000252   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000253   000020 036003                    ADLQ    16,DU
         1 000254   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000255   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000256   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000257   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:117  
         1 000260   000000 011000                    NOP     0

      764     8950    2           K$RWPARM = KC_CRWP;

   8950  1 000261   000100 100400                    MLR     fill='000'O
         1 000262   000000 000234 xsym               ADSC9   KC_CRWP                  cn=0,n=156
         1 000263   200004 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      765     8951    2           K$RWPARM.MSG$ = ADDR(NOCGM);

   8951  1 000264   000002 236000 2                  LDQ     2
         1 000265   200004 756100                    STQ     K$RWPARM,,AUTO

      766     8952    2           K$RWPARM.MSGSZ = LENGTHC(NOCGM);

   8952  1 000266   000054 235007                    LDA     44,DL
         1 000267   200005 755100                    STA     K$RWPARM+1,,AUTO

      767     8953    2           K$RWPARM.DVE.VFC = 'd';

   8953  1 000270   000144 236003                    LDQ     100,DU
         1 000271   200014 552120                    STBQ    K$RWPARM+8,'20'O,AUTO

      768     8954    2           K$RWPARM.DVE.DVBYTE.VFC = '1'B;

   8954  1 000272   100000 236003                    LDQ     32768,DU
         1 000273   200014 256100                    ORSQ    K$RWPARM+8,,AUTO

      769     8955    2           CALL KIA$FCNO(NK$LDCT,%KV_VDO_FNC_DAT_IMD,K$RWPARM)

   8955  1 000274   200004 630500                    EPPR0   K$RWPARM,,AUTO
         1 000275   200064 450500                    STP0    CLDQ+7,,AUTO
         1 000276   000003 236000 2                  LDQ     3
         1 000277   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000300   200062 757100                    STAQ    CLDQ+5,,AUTO
         1 000301   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000302   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:118  
         1 000303   000000 701000 xent               TSX1    KIA$FCNO
         1 000304   000433 702000 1                  TSX2    QFLRLT

      770     8956    2           ALTRET (QFLRLT);
      771     8957    2           CALL LKCK ALTRET (RTN);

   8957  1 000305   000443 701000 1                  TSX1    LKCK
         1 000306   000211 702000 1                  TSX2    RTN

      772     8958    2           END;

      773     8959    1         LDCT.CLDQ=0;

   8959  1 000307   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000310   000001 236000 2                  LDQ     1
         1 000311   000010 356100                    ANSQ    8,,PR0

      774     8960    1         LDCT.LKFLG.RLTRM='1'B;

   8960  1 000312   000002 236003                    LDQ     2,DU
         1 000313   000011 256100                    ORSQ    9,,PR0

      775     8961    1         IF LDCT.LKFLG.ACTIVE THEN

   8961  1 000314   000011 236100                    LDQ     9,,PR0
         1 000315   000040 316003                    CANQ    32,DU
         1 000316   000324 600000 1                  TZE     s:8970

      776     8962    2           DO;

      777     8963    2           CLDQ=2;

   8963  1 000317   000002 235007                    LDA     2,DL
         1 000320   200055 755100                    STA     CLDQ,,AUTO

   8963  1 000321                       RLT          null
      778     8964    2   RLT:    ;
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:119  
      779     8965    2           CALL CLRFCN ALTRET (RTN);

   8965  1 000321   000474 701000 1                  TSX1    CLRFCN
         1 000322   000211 702000 1                  TSX2    RTN

      780     8966    2           END;

   8966  1 000323   000333 710000 1                  TRA     s:8973

      781     8967    1         ELSE
      782     8968    2           DO;

      783     8969                %UNLOCK (G=NK$LDCT.LOCK);

   8970  1 000324   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000325   000020 036003                    ADLQ    16,DU
         1 000326   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000327   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000330   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000331   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000332   000000 011000                    NOP     0

      784     8972    2           END;

      785     8973    1         CALL KQP$DISC (LDCT);

   8973  1 000333   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000334   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000335   000000 701000 xent               TSX1    KQP$DISC
         1 000336   000000 011000                    NOP     0

      786     8974    1         RETURN;

   8974  1 000337   000000 702200 xent               TSX2  ! X66_ARET

      787     8975
      788     8976        /*F* NAME:         KCD$DACTRM
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:120  
      789     8977             PURPOSE:      To deactivate a comgroup terminal
      790     8978             DESCRIPTION:  Deactivation means to stop doing I/O
      791     8979                           on the device.  This first means zapping
      792     8980                           ACTIVE in the LDCT.  Millions of people
      793     8981                           look at this bit and quit mucking around
      794     8982                           if they find it reset, thus all I/O activity
      795     8983                           will stop rather quickly when we zap the
      796     8984                           bit.  Next, for FEP-connected devices we
      797     8985                           send a CLOSE message to the FEP.  This
      798     8986                           tells the FEP to perform a partial lobotomy
      799     8987                           on the device's path, throwing away all
      800     8988                           data, sending EOF to HASP output devices,
      801     8989                           and suchlike. */
      802     8990    1   KCD$DACTRM: ENTRY(LDCT);

   8990  1 000340   000000 700200 xent  KCD$DACTRM   TSX0  ! X66_AUTO_1
         1 000341   000066 000001                    ZERO    54,1

      803     8991
      804     8992    1         CALL LKCK ALTRET (RTN);

   8992  1 000342   000443 701000 1                  TSX1    LKCK
         1 000343   000211 702000 1                  TSX2    RTN

      805     8993    1         IF LDCT.RESCOD=NK_CGFPRG THEN GOTO DSC;

   8993  1 000344   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000345   000006 236100                    LDQ     6,,PR0
         1 000346   000017 376007                    ANQ     15,DL
         1 000347   000011 116007                    CMPQ    9,DL
         1 000350   000216 600000 1                  TZE     DSC

      806     8994                                /* Always DACDSC an FPRG path on deactivate          */
      807     8995    1         IF LDCT.LKFLG.ACTIVE THEN CALL CLRFCNC ALTRET (RTN);

   8995  1 000351   000011 236100                    LDQ     9,,PR0
         1 000352   000040 316003                    CANQ    32,DU
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:121  
         1 000353   000402 600000 1                  TZE     UOUT

   8995  1 000354   000470 701000 1                  TSX1    CLRFCNC
         1 000355   000211 702000 1                  TSX2    RTN
         1 000356   000357 710000 1                  TRA     s:8997

      808     8996    1         ELSE GOTO UOUT;
      809     8997    1         RETURN;

   8997  1 000357   000000 702200 xent               TSX2  ! X66_ARET

      810     8998
      811     8999        /*F* NAME:         KCD$CLDQ
      812     9000             PURPOSE:      To try again to send a message which was
      813     9001                           delayed due to a full circular queue.
      814     9002             DESCRIPTION:  LDCT.QFL.CLDQ set says that we need to
      815     9003                           send the message encoded in LDCT.CLDQ.
      816     9004                           The various routines in this module
      817     9005                           do that when the msg they need to send
      818     9006                           to the FEP can't be sent because the
      819     9007                           output circular queue is full or a
      820     9008                           write-crossing-coupler is going on.
      821     9009                           When the blocking condition is removed
      822     9010                           (the WCC finishes or the output circular
      823     9011                           queue gets some space), KCF calls here
      824     9012                           to give us another shot at sending the
      825     9013                           message.  This delay mechanism is the
      826     9014                           reason that one need not call KCD$DACTRM
      827     9015                           (and similar routines) on behalf of any
      828     9016                           user.  Note that KCD$ACTRM doesn't work
      829     9017                           this way and MUST be called on behalf
      830     9018                           of a user. */
      831     9019    1   KCD$CLDQ: ENTRY (LDCT);

   9019  1 000360   000000 700200 xent  KCD$CLDQ     TSX0  ! X66_AUTO_1
         1 000361   000066 000001                    ZERO    54,1

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:122  
      832     9020
      833     9021              %LOCK (G=NK$LDCT.LOCK);

   9022  1 000362   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000363   000020 036003                    ADLQ    16,DU
         1 000364   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000365   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000366   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000367   000000 701000 xent               TSX1    HFC$LOCK
         1 000370   000000 011000                    NOP     0

      834     9024    1         CLDQ=LDCT.CLDQ;

   9024  1 000371   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000372   000010 236100                    LDQ     8,,PR0
         1 000373   000003 376007                    ANQ     3,DL
         1 000374   200055 756100                    STQ     CLDQ,,AUTO

      835     9025    1         LDCT.CLDQ=0;

   9025  1 000375   000001 236000 2                  LDQ     1
         1 000376   000010 356100                    ANSQ    8,,PR0

      836     9026    1         IF LDCT.DFLG.OLDSC THEN

   9026  1 000377   000006 236100                    LDQ     6,,PR0
         1 000400   010000 316007                    CANQ    4096,DL
         1 000401   000412 600000 1                  TZE     s:9034

      837     9027    2           DO;

   8995  1 000402                       UOUT         null
      838     9028    2   UOUT:   ;
      839     9029                %UNLOCK (G=NK$LDCT.LOCK);

   9030  1 000402   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000403   000020 036003                    ADLQ    16,DU
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:123  
         1 000404   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000405   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000406   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000407   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000410   000000 011000                    NOP     0

      840     9032    2           RETURN;

   9032  1 000411   000000 702200 xent               TSX2  ! X66_ARET

      841     9033    2           END;
      842     9034    2           DO CASE (CLDQ);

   9034  1 000412   200055 235100                    LDA     CLDQ,,AUTO
         1 000413   000004 115007                    CMPA    4,DL
         1 000414   000416 602005 1                  TNC     s:9034+4,AL
         1 000415   000422 710000 1                  TRA     s:9036
         1 000416   000422 710000 1                  TRA     s:9036
         1 000417   000423 710000 1                  TRA     s:9038
         1 000420   000426 710000 1                  TRA     s:9040
         1 000421   000431 710000 1                  TRA     s:9043

      843     9035    2             CASE(ELSE);

      844     9036    2               GOTO UOUT;

   9036  1 000422   000402 710000 1                  TRA     UOUT

      845     9037    2             CASE(1);

      846     9038    2               CALL CLRFCNC ALTRET (RTN);

   9038  1 000423   000470 701000 1                  TSX1    CLRFCNC
         1 000424   000211 702000 1                  TSX2    RTN
         1 000425   000432 710000 1                  TRA     s:9045

      847     9039    2             CASE(2);
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:124  

      848     9040    2               LDCT.LKFLG.RLTRM='1'B;

   9040  1 000426   000002 236003                    LDQ     2,DU
         1 000427   000011 256100                    ORSQ    9,,PR0

      849     9041    2               GOTO RLT;

   9041  1 000430   000321 710000 1                  TRA     RLT

      850     9042    2             CASE(3);

      851     9043    2               GOTO DSC;

   9043  1 000431   000216 710000 1                  TRA     DSC

      852     9044    2           END;

      853     9045    1         RETURN;

   9045  1 000432   000000 702200 xent               TSX2  ! X66_ARET

   9045  1 000433                       QFLRLT       null
      854     9046
      855     9047    1   QFLRLT:;
      856     9048    1         LDCT.QFL.RLT='1'B;

   9048  1 000433   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000434   000010 236007                    LDQ     8,DL
         1 000435   000010 256100                    ORSQ    8,,PR0

      857     9049    1         CALL KCF$QFL (LDCT);

   9049  1 000436   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000437   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000440   000000 701000 xent               TSX1    KCF$QFL
         1 000441   000000 011000                    NOP     0
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:125  

      858     9050    1         RETURN;

   9050  1 000442   000000 702200 xent               TSX2  ! X66_ARET

      859     9051
      860     9052
      861     9053
      862     9054
      863     9055    1   LKCK: PROC ALTRET;

   9055  1 000443   200060 741300       LKCK         STX1  ! CLDQ+3,,AUTO

      864     9056
      865     9057              %LOCK (G=NK$LDCT.LOCK);

   9058  1 000444   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000445   000020 036003                    ADLQ    16,DU
         1 000446   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000447   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000450   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000451   000000 701000 xent               TSX1    HFC$LOCK
         1 000452   000000 011000                    NOP     0

      866     9060    2         IF LDCT.DFLG.OLDSC

   9060  1 000453   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000454   000006 236100                    LDQ     6,,PR0
         1 000455   010000 316007                    CANQ    4096,DL
         1 000456   000655 601000 1                  TNZ     UALT
         1 000457   000011 236100                    LDQ     9,,PR0
         1 000460   000002 316003                    CANQ    2,DU
         1 000461   000655 601000 1                  TNZ     UALT
         1 000462   000010 236100                    LDQ     8,,PR0
         1 000463   000003 376007                    ANQ     3,DL
         1 000464   000002 116007                    CMPQ    2,DL
         1 000465   000655 603000 1                  TRC     UALT
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:126  

      867     9061    2         OR LDCT.LKFLG.RLTRM
      868     9062    2         OR LDCT.CLDQ>1 THEN GOTO UALT;
      869     9063    2         RETURN;

   9063  1 000466   200060 221300                    LDX1  ! CLDQ+3,,AUTO
         1 000467   000001 702211                    TSX2  ! 1,X1

      870     9064
      871     9065    2   CLRFCNC: ENTRY ALTRET;

   9065  1 000470   200060 741300       CLRFCNC      STX1  ! CLDQ+3,,AUTO

      872     9066
      873     9067    2         CLDQ=1;

   9067  1 000471   000001 235007                    LDA     1,DL
         1 000472   200055 755100                    STA     CLDQ,,AUTO
         1 000473   000475 710000 1                  TRA     s:9071

      874     9068
      875     9069    2   CLRFCN: ENTRY ALTRET;

   9069  1 000474   200060 741300       CLRFCN       STX1  ! CLDQ+3,,AUTO

      876     9070
      877     9071    2         FCN=%KV_VDO_FNC_CLSSSN_RQS;

   9071  1 000475   000003 235007                    LDA     3,DL
         1 000476   200054 755100                    STA     FCN,,AUTO
         1 000477   000501 710000 1                  TRA     s:9075

      878     9072
      879     9073    2   CLRFCND: ENTRY ALTRET;

   9073  1 000500   200060 741300       CLRFCND      STX1  ! CLDQ+3,,AUTO

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:127  
      880     9074
      881     9075    2         LDCT.LKFLG.ACTIVE='0'B;

   9075  1 000501   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000502   000004 236000 2                  LDQ     4
         1 000503   000011 356100                    ANSQ    9,,PR0

      882     9076    2         IF LDCT.DFLG.LOCAL THEN

   9076  1 000504   000006 236100                    LDQ     6,,PR0
         1 000505   002000 316007                    CANQ    1024,DL
         1 000506   000520 600000 1                  TZE     s:9083

      883     9077    3           DO;

      884     9078                %UNLOCK (G=NK$LDCT.LOCK);

   9079  1 000507   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000510   000020 036003                    ADLQ    16,DU
         1 000511   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000512   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000513   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000514   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000515   000000 011000                    NOP     0

      885     9081    3           RETURN;

   9081  1 000516   200060 221300                    LDX1  ! CLDQ+3,,AUTO
         1 000517   000001 702211                    TSX2  ! 1,X1

      886     9082    3           END;
      887     9083    2         LDCT.TH = '0'B;

   9083  1 000520   000100 100400                    MLR     fill='000'O
         1 000521   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000522   000016 200007                    ADSC9   14,,PR0                  cn=1,n=7

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:128  
      888     9084    2         LDCT.LKFLG.OBLK = '1'B;

   9084  1 000523   200000 236003                    LDQ     65536,DU
         1 000524   000011 256100                    ORSQ    9,,PR0

      889     9085    2         LDCT.RDSOUT=0;

   9085  1 000525   000000 236003                    LDQ     0,DU
         1 000526   000007 752140                    STCQ    7,'40'O,PR0

      890     9086    2         K$RWPARM = K_RWPARM_CON;

   9086  1 000527   000100 100400                    MLR     fill='000'O
         1 000530   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000531   200004 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      891     9087        /* Do a cancel */
      892     9088    2         CALL KIA$FCNO (LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM) ALTRET (QFL);

   9088  1 000532   200004 631500                    EPPR1   K$RWPARM,,AUTO
         1 000533   200064 451500                    STP1    CLDQ+7,,AUTO
         1 000534   000006 236000 2                  LDQ     6
         1 000535   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000536   200062 757100                    STAQ    CLDQ+5,,AUTO
         1 000537   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000540   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000541   000000 701000 xent               TSX1    KIA$FCNO
         1 000542   000636 702000 1                  TSX2    QFL

      893     9089    2         IF FCN = %KV_VDO_FNC_DSC_RQS

   9089  1 000543   200054 235100                    LDA     FCN,,AUTO
         1 000544   000012 115007                    CMPA    10,DL
         1 000545   000553 601000 1                  TNZ     s:9094

      894     9090    3         THEN DO;

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:129  
      895     9091    3           CALL KCD$DSCTRML(LDCT);

   9091  1 000546   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000547   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000550   000000 701000 xent               TSX1    KCD$DSCTRML
         1 000551   000000 011000                    NOP     0

      896     9092    3           END;

   9092  1 000552   000634 710000 1                  TRA     s:9109

      897     9093    2         ELSE
      898     9094    2          IF (S_CUN < %JG_FROG#)  /* A GHOST THAT YOU CAN'T REG */

   9094  1 000553   000000 236000 xsym               LDQ     S_CUN
         1 000554   000010 116007                    CMPQ    8,DL
         1 000555   000600 603000 1                  TRC     s:9103

      899     9095    3          THEN DO;

      900     9096    3            CALL KIA$FCNO(LDCT,FCN,K$RWPARM) ALTRET (QFL);

   9096  1 000556   200004 630500                    EPPR0   K$RWPARM,,AUTO
         1 000557   200064 450500                    STP0    CLDQ+7,,AUTO
         1 000560   200054 631500                    EPPR1   FCN,,AUTO
         1 000561   200063 451500                    STP1    CLDQ+6,,AUTO
         1 000562   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000563   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000564   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000565   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000566   000000 701000 xent               TSX1    KIA$FCNO
         1 000567   000636 702000 1                  TSX2    QFL

      901     9097                 %UNLOCK (G=NK$LDCT.LOCK);

   9098  1 000570   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000571   000020 036003                    ADLQ    16,DU
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:130  
         1 000572   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000573   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000574   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000575   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000576   000000 011000                    NOP     0

      902     9100    3            END;

   9100  1 000577   000634 710000 1                  TRA     s:9109

      903     9101    3          ELSE DO;

      904     9102                   /* Request that a marker be sent back, and wait for it */
      905     9103    3            K$RWPARM.MRKTYP = %KV_VDOMRKTYP_MRK;

   9103  1 000600   003000 236007                    LDQ     1536,DL
         1 000601   200044 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      906     9104    3            CALL KIA$FCNO (LDCT,FCN,K$RWPARM) ALTRET (QFL);

   9104  1 000602   200004 630500                    EPPR0   K$RWPARM,,AUTO
         1 000603   200064 450500                    STP0    CLDQ+7,,AUTO
         1 000604   200054 631500                    EPPR1   FCN,,AUTO
         1 000605   200063 451500                    STP1    CLDQ+6,,AUTO
         1 000606   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000607   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000610   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000611   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000612   000000 701000 xent               TSX1    KIA$FCNO
         1 000613   000636 702000 1                  TSX2    QFL

      907     9105    3            LDCT.USER = S_CUN;

   9105  1 000614   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000615   000000 236000 xsym               LDQ     S_CUN
         1 000616   000022 736000                    QLS     18
         1 000617   000007 552120                    STBQ    7,'20'O,PR0
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:131  

      908     9106    3            LDCT.LKFLG.WTMRK = '1'B;  /* WaiT for the MaRKer */

   9106  1 000620   020000 236003                    LDQ     8192,DU
         1 000621   000011 256100                    ORSQ    9,,PR0

      909     9107    3            CALL SSR$REG(%SS_CW,ADDR(NK$LDCT));

   9107  1 000622   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000623   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000624   200062 631500                    EPPR1   CLDQ+5,,AUTO
         1 000625   200065 451500                    STP1    CLDQ+8,,AUTO
         1 000626   000010 236000 2                  LDQ     8
         1 000627   200064 756100                    STQ     CLDQ+7,,AUTO
         1 000630   200064 630500                    EPPR0   CLDQ+7,,AUTO
         1 000631   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000632   000000 701000 xent               TSX1    SSR$REG
         1 000633   000000 011000                    NOP     0

      910     9108    3            END;

      911     9109    2         RETURN;

   9109  1 000634   200060 221300                    LDX1  ! CLDQ+3,,AUTO
         1 000635   000001 702211                    TSX2  ! 1,X1

      912     9110    2   QFL:  ;

   9110  1 000636                       QFL          null
      913     9111    2         LDCT.LKFLG.RLTRM='0'B;

   9111  1 000636   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000637   000011 236000 2                  LDQ     9
         1 000640   000011 356100                    ANSQ    9,,PR0

      914     9112    2         LDCT.CLDQ=CLDQ;

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:132  
   9112  1 000641   200055 236100                    LDQ     CLDQ,,AUTO
         1 000642   000010 676100                    ERQ     8,,PR0
         1 000643   000003 376007                    ANQ     3,DL
         1 000644   000010 656100                    ERSQ    8,,PR0

      915     9113    2         LDCT.QFL.CLDQ='1'B;

   9113  1 000645   000004 236007                    LDQ     4,DL
         1 000646   000010 256100                    ORSQ    8,,PR0

      916     9114    2         CALL KCF$QFL (LDCT);

   9114  1 000647   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000650   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000651   000000 701000 xent               TSX1    KCF$QFL
         1 000652   000000 011000                    NOP     0

      917     9115    2         ALTRETURN;

   9115  1 000653   200060 221300                    LDX1  ! CLDQ+3,,AUTO
         1 000654   000000 702211                    TSX2  ! 0,X1

   9113  1 000655                       UALT         null
      918     9116    2   UALT: ;
      919     9117              %UNLOCK (G=NK$LDCT.LOCK);

   9118  1 000655   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000656   000020 036003                    ADLQ    16,DU
         1 000657   200062 756100                    STQ     CLDQ+5,,AUTO
         1 000660   200062 630500                    EPPR0   CLDQ+5,,AUTO
         1 000661   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000662   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000663   000000 011000                    NOP     0

      920     9120    2         ALTRETURN;

   9120  1 000664   200060 221300                    LDX1  ! CLDQ+3,,AUTO
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:133  
         1 000665   000000 702211                    TSX2  ! 0,X1

NOCGM
 Sect OctLoc
   0     000   052052 052040   131157 165162   040143 157155   147162 157165    *** Your comgrou
   0     004   160040 151163   040156 157040   154157 156147   145162 040141    p is no longer a
   0     010   166141 151154   141142 154145   040052 052052                    vailable ***

(unnamed)
 Sect OctLoc
   2     000   077040 040040   777777 777774   000000 006000   000010 006000    ?   ............
   2     004   777737 777777   000000 000026   000005 006000   000000 000047    ...............'
   2     010   000007 006000   777775 777777                                    ........
      921     9121    2   END;
      922     9122
      923     9123    1   END;
      924     9124        %EOD;

PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:134  
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
      No diagnostics issued in procedure KCD$ACTRM.
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:135  

 **** Variables and constants ****

  ****  Section 000 RoData KCD$ACTRM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(44)    r     1 NOCGM

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NK$LDCT                  55-0-0/w UBIN        r     1 CLDQ
    54-0-0/w UBIN        r     1 FCN                        4-0-0/d STRC(1404)  r     1 K$RWPARM
    *0-0-0/d STRC(864)   r     1 NK$LDCT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1404)  r     1 KC_CRWP                    0-0-0/d STRC(1404)  r     1 K_RWPARM_CON
     0-0-0/w UBIN        r     1 S_CUN


   Procedure KCD$ACTRM requires 438 words for executable code.
   Procedure KCD$ACTRM requires 54 words of local(AUTO) storage.
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:136  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:137  
          MINI XREF LISTING

CLDQ
      8493**DCL      8913<<ASSIGN   8963<<ASSIGN   9024<<ASSIGN   9034>>DOCASE   9067<<ASSIGN   9112>>ASSIGN
CLRFCN IN PROCEDURE LKCK
      9069**ENTRY    8965--CALL
CLRFCNC IN PROCEDURE LKCK
      9065**ENTRY    8995--CALL     9038--CALL
CLRFCND IN PROCEDURE LKCK
      9073**ENTRY    8915--CALL
DSC
      8893**LABEL    8944--GOTO     8993--GOTO     9043--GOTO
FCN
      8492**DCL      8861<<ASSIGN   8864>>IF       8867<<ASSIGN   8873<>CALL     8891>>IF       8914<<ASSIGN
      9071<<ASSIGN   9089>>IF       9096<>CALL     9104<>CALL
HFC$LOCK
      4533**DCL-ENT  8842--CALL     9022--CALL     9058--CALL
HFC$UNLOCK
      4533**DCL-ENT  8848--CALL     8856--CALL     8876--CALL     8882--CALL     8889--CALL     8948--CALL
      8970--CALL     9030--CALL     9079--CALL     9098--CALL     9118--CALL
K$RWPARM
      8197**DCL      8869<<ASSIGN   8873<>CALL     8950<<ASSIGN   8955<>CALL     9086<<ASSIGN   9088<>CALL
      9096<>CALL     9104<>CALL
K$RWPARM.BLKREC
      8223**DCL      8248--REDEF
K$RWPARM.BLKREC.BLKU#
      8224**DCL      8226--REDEF
K$RWPARM.BLKREC.RECU#
      8236**DCL      8238--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      8263**DCL      8264--REDEF    8954<<ASSIGN
K$RWPARM.DVE.EOMCHAR
      8271**DCL      8275--REDEF
K$RWPARM.DVE.VFC
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:138  
      8275**DCL      8953<<ASSIGN
K$RWPARM.ERR
      8335**DCL      8340--REDEF
K$RWPARM.FC
      8299**DCL      8300--REDEF
K$RWPARM.FLDID
      8481**DCL      8482--REDEF
K$RWPARM.FPT$
      8362**DCL      8369--REDEF
K$RWPARM.KEYTYPE
      8488**DCL      8489--REDEF
K$RWPARM.MRKTYP
      8473**DCL      8870<<ASSIGN   9103<<ASSIGN
K$RWPARM.MSG$
      8198**DCL      8204--REDEF    8951<<ASSIGN
K$RWPARM.MSGID
      8310**DCL      8315--REDEF
K$RWPARM.MSGIDXT
      8323**DCL      8327--REDEF
K$RWPARM.MSGSZ
      8205**DCL      8952<<ASSIGN
K$RWPARM.MSGTYP
      8214**DCL      8872<<ASSIGN
K$RWPARM.ORG
      8459**DCL      8460--REDEF
K$RWPARM.STATION
      8209**DCL      8871<<ASSIGN
K$RWPARM.THDRSZ
      8403**DCL      8407--REDEF
K$RWPARM.VDOFLGS
      8461**DCL      8472--REDEF
KCD$DSCTRML
      8509**DCL-ENT  9091--CALL
KCF$FERDS
      8510**DCL-ENT  8884--CALL
KCF$QFL
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:139  
      8511**DCL-ENT  9049--CALL     9114--CALL
KCL$GET
      8512**DCL-ENT  8893--CALL
KCL$PUT
      8513**DCL-ENT  8894--CALL
KC_CRWP
      8542**DCL      8950>>ASSIGN
KC_CRWP.BLKREC
      8568**DCL      8593--REDEF
KC_CRWP.BLKREC.BLKU#
      8569**DCL      8571--REDEF
KC_CRWP.BLKREC.RECU#
      8581**DCL      8583--REDEF
KC_CRWP.DVE.DVBYTE.VFC
      8608**DCL      8609--REDEF
KC_CRWP.DVE.EOMCHAR
      8616**DCL      8620--REDEF
KC_CRWP.ERR
      8680**DCL      8685--REDEF
KC_CRWP.FC
      8644**DCL      8645--REDEF
KC_CRWP.FLDID
      8826**DCL      8827--REDEF
KC_CRWP.FPT$
      8707**DCL      8714--REDEF
KC_CRWP.KEYTYPE
      8833**DCL      8834--REDEF
KC_CRWP.MSG$
      8543**DCL      8549--REDEF
KC_CRWP.MSGID
      8655**DCL      8660--REDEF
KC_CRWP.MSGIDXT
      8668**DCL      8672--REDEF
KC_CRWP.ORG
      8804**DCL      8805--REDEF
KC_CRWP.THDRSZ
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:140  
      8748**DCL      8752--REDEF
KC_CRWP.VDOFLGS
      8806**DCL      8817--REDEF
KIA$FCNO
      8515**DCL-ENT  8955--CALL     9088--CALL     9096--CALL     9104--CALL
KIA$FCNOU
      8516**DCL-ENT  8873--CALL
KIA$OQFL
      8517**DCL-ENT  8845--CALL
KQ$CG.AUCTL.DVBYTE.REREAD
      7504**DCL      7505--REDEF
KQ$STA.ACTTYC
      7851**DCL      7855--REDEF
KQ$STA.DCBLNK$
      7858**DCL      7861--REDEF    7865--REDEF
KQ$STA.EVCNT
      7944**DCL      7947--REDEF
KQ$STA.EVNT
      7910**DCL      7914--REDEF    7917--REDEF
KQ$STA.OPNBLKED
      7971**DCL      7974--REDEF
KQ$STA.OPNREJ
      7977**DCL      7979--REDEF
KQ$STA.SUCCREAD
      7900**DCL      7904--REDEF
KQ$STA.TCOUNT
      8029**DCL      8035--REDEF
KQ$STA.VGOT$
      8014**DCL      8018--REDEF    8022--REDEF
KQP$DISC
      8518**DCL-ENT  8973--CALL
K_RWPARM_CON
      6264**DCL      8869>>ASSIGN   9086>>ASSIGN
K_RWPARM_CON.BLKREC
      6290**DCL      6315--REDEF
K_RWPARM_CON.BLKREC.BLKU#
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:141  
      6291**DCL      6293--REDEF
K_RWPARM_CON.BLKREC.RECU#
      6303**DCL      6305--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      6330**DCL      6331--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      6338**DCL      6342--REDEF
K_RWPARM_CON.ERR
      6402**DCL      6407--REDEF
K_RWPARM_CON.FC
      6366**DCL      6367--REDEF
K_RWPARM_CON.FLDID
      6548**DCL      6549--REDEF
K_RWPARM_CON.FPT$
      6429**DCL      6436--REDEF
K_RWPARM_CON.KEYTYPE
      6555**DCL      6556--REDEF
K_RWPARM_CON.MSG$
      6265**DCL      6271--REDEF
K_RWPARM_CON.MSGID
      6377**DCL      6382--REDEF
K_RWPARM_CON.MSGIDXT
      6390**DCL      6394--REDEF
K_RWPARM_CON.ORG
      6526**DCL      6527--REDEF
K_RWPARM_CON.THDRSZ
      6470**DCL      6474--REDEF
K_RWPARM_CON.VDOFLGS
      6528**DCL      6539--REDEF
LD$CT.DDT$
      8139**DCL      8139--REDEF
LD$CT.IOQ$
      8138**DCL      8139--REDEF
LD$CT.LDCTX
      8140**DCL      8140--REDEF
LD$CT.LKFLG.ABORTED
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:142  
      8152**DCL      8153--REDEF
LD$CT.RLCID.LDCTX
      8162**DCL      8162--REDEF
LD$CT.STA$
      8158**DCL      8159--REDEF
LD$CT.SYMB$
      8137**DCL      8137--REDEF    8137--REDEF    8138--REDEF
LKCK
      9055**PROC     8910--CALL     8943--CALL     8957--CALL     8992--CALL
NK$LDCT
      7008**DCL        36--PROC     8845<>CALL     8873<>CALL     8884<>CALL     8893--CALL     8894--CALL
      8908--ENTRY    8941--ENTRY    8955<>CALL     8973<>CALL     8990--ENTRY    9019--ENTRY    9049<>CALL
      9088<>CALL     9091<>CALL     9096<>CALL     9104<>CALL     9107--CALL     9114<>CALL
NK$LDCT.CLDQ
      7022**DCL      8912<<ASSIGN   8959<<ASSIGN   9024>>ASSIGN   9025<<ASSIGN   9060>>IF       9112<<ASSIGN
NK$LDCT.DDT$
      7010**DCL      7010--REDEF
NK$LDCT.DEVNM
      7010**DCL      8871>>ASSIGN
NK$LDCT.DFLG.INPUT
      7012**DCL      8884>>IF
NK$LDCT.DFLG.LOCAL
      7014**DCL      8862>>IF       9076>>IF
NK$LDCT.DFLG.OLDSC
      7013**DCL      8853>>IF       9026>>IF       9060>>IF
NK$LDCT.DFLG.OUTPUT
      7012**DCL      8893>>IF
NK$LDCT.DFLG.SYMBIONT
      7013**DCL      8891>>IF
NK$LDCT.IOQ$
      7009**DCL      7010--REDEF
NK$LDCT.LDCTX
      7011**DCL      7011--REDEF
NK$LDCT.LKFLG.ABORTED
      7023**DCL      7024--REDEF
NK$LDCT.LKFLG.ACTIVE
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:143  
      7027**DCL      8861>>ASSIGN   8868<<ASSIGN   8887<<ASSIGN   8945>>IF       8961>>IF       8995>>IF
      9075<<ASSIGN
NK$LDCT.LKFLG.OBLK
      7023**DCL      9084<<ASSIGN
NK$LDCT.LKFLG.RLTRM
      7028**DCL      8960<<ASSIGN   9040<<ASSIGN   9060>>IF       9111<<ASSIGN
NK$LDCT.LKFLG.WTMRK
      7024**DCL      9106<<ASSIGN
NK$LDCT.LOCK
      7036**DCL      8842<>CALL     8848<>CALL     8856<>CALL     8876<>CALL     8882<>CALL     8889<>CALL
      8948<>CALL     8970<>CALL     9022<>CALL     9030<>CALL     9058<>CALL     9079<>CALL     9098<>CALL
      9118<>CALL
NK$LDCT.NOCGINF
      7017**DCL      8945>>IF
NK$LDCT.NOCGREJ
      7017**DCL      8944>>IF
NK$LDCT.QFL
      7020**DCL      8844>>DOWHILE
NK$LDCT.QFL.CLDQ
      7022**DCL      9113<<ASSIGN
NK$LDCT.QFL.RLT
      7022**DCL      9048<<ASSIGN
NK$LDCT.RDSOUT
      7017**DCL      9085<<ASSIGN
NK$LDCT.RESCOD
      7016**DCL      8944>>IF       8993>>IF
NK$LDCT.RLCID.LDCTX
      7033**DCL      7033--REDEF
NK$LDCT.STA$
      7029**DCL      7030--REDEF
NK$LDCT.SYMB$
      7008**DCL      7008--REDEF    7008--REDEF    7009--REDEF
NK$LDCT.TH
      7034**DCL      9083<<ASSIGN
NK$LDCT.TH.MAXNMBBYT
      7035**DCL      8866<<ASSIGN
PL6.E3A0      #003=KCD$ACTRM File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:12 Page:144  
NK$LDCT.USER
      7018**DCL      9105<<ASSIGN
NOCGM
      8501**DCL      8951--ASSIGN   8952--ASSIGN
QFL IN PROCEDURE LKCK
      9110**LABEL    9088--CALLALT  9096--CALLALT  9104--CALLALT
QFLRLT
      9045**LABEL    8955--CALLALT
RLT
      8963**LABEL    9041--GOTO
RTN
      8893**LABEL    8910--CALLALT  8943--CALLALT  8957--CALLALT  8965--CALLALT  8992--CALLALT  8995--CALLALT
      9038--CALLALT
SSR$REG
      8520**DCL-ENT  9107--CALL
S_CUN
      8837**DCL      9094>>IF       9105>>ASSIGN
UALT IN PROCEDURE LKCK
      9113**LABEL    9062--GOTO
UOUT
      8995**LABEL    8996--GOTO     9036--GOTO

PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:145  
      925        1        /*T***********************************************************/
      926        2        /*T*                                                         */
      927        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      928        4        /*T*                                                         */
      929        5        /*T***********************************************************/
      930        6        /*D* NAME:        KCD$PFPRG
      931        7             PURPOSE:     To create a pure FPRG station
      932        8             CALL:        CALL KCD$PFPRG(KQ_STA,VLP_STATION) ALTRET(LBL);
      933        9             INPUT:       KQ_STA - Station from which to build the new
      934       10                                   pure FPRG station
      935       11                          VLP_STATION - Station name of the new pure FPRG
      936       12                                        station
      937       13             OUTPUT:      A new pure FPRG station
      938       14             DESCRIPTION: KCD$PFPRG is called with no gates locked but with
      939       15                          KQ_STA.LOCKCNT counted up. A new station is obtained
      940       16                          (or a PERM station is used), an LDCT is obtained and
      941       17                          connected to the new station and a KL_STRTU message
      942       18                          is sent to the appropriate node's Node Admin process.
      943       19                          The calling user is REGged awaiting response from
      944       20                          this message. When we are un-REGged, KCD$PFPRG will
      945       21                          RETURN normally if the path was successfully
      946       22                          established, otherwise we will ALTRETURN with an
      947       23                          error in B$JIT.ERR.
      948       24
      949       25                          Must be called on behalf of the AU user.
      950       26                          KQ_STA's LDCT need not be inACTIVE.
      951       27        */
      952       28        KCD$PFPRG: PROC(KQ_STA,VLP_STATION) ALTRET;
      953       29        %INCLUDE B$JIT;
      954      632        %INCLUDE B_ERRORS_C;
      955     1759        %INCLUDE CP_6_SUBS;
      956     2299        %INCLUDE F_MACROS_C;
      957     2310        %INCLUDE G_JIT_M;
      958     2575        %INCLUDE HF_LOCK_C;
      959     2589        %INCLUDE KC$CP6V_C;
      960     2709        %INCLUDE KC_CP6;
      961     3269        %INCLUDE KC_DATA_R;
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:146  
      962     3282        %INCLUDE KL_AFCN_C;
      963     3383        %INCLUDE KL_MACRO_C;
      964     6735        %INCLUDE KL_SUPER_C;
      965     9637        %INCLUDE KQ_MAC_C;
      966    12187        %INCLUDE K_DATA_R;
      967    12898        %INCLUDE NK$LDCT;
      968    13000        %INCLUDE NK_SUBS;
      969    13025        %INCLUDE SS_SCHED_C;
      970    13258                    /***************************/
      971    13259                    /*    PARAMETERS           */
      972    13260                    /***************************/
      973    13261        %KQ_STA (FPTN=KQ_STA,STCLASS=PARAM);
      974    13600        %VLP_STATION (FPTN=VLP_STATION,STCLASS=PARAM);
      975    13627                    /***************************/
      976    13628                    /*    AUTO                 */
      977    13629                    /***************************/
      978    13630    1   DCL NLDCT$ PTR;
      979    13631    1   DCL FPSTA$ PTR;
      980    13632    1   DCL LDCT$ PTR;
      981    13633    1   DCL CG$ PTR;
      982    13634    1   DCL I SBIN;
      983    13635    1   DCL KEY CHAR(8);
      984    13636        %KL_STRTU (FPTN=STRTU,STCLASS=AUTO);
      985    13809    1   DCL T$ PTR;
      986    13810                    /***************************/
      987    13811                    /*    BASED                */
      988    13812                    /***************************/
      989    13813        %FPT$ACTIVATE_V;
      990    13819        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CG$)");
      991    14558        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      992    14897        %NK$LDCT (NAME=LDCT,STCLASS="BASED(LDCT$)");
      993    14943        %NK$LDCT (NAME=NLDCT,STCLASS="BASED(NLDCT$)");
      994    14989                    /***************************/
      995    14990                    /*    EQUs                 */
      996    14991                    /***************************/
      997    14992        %G$JIT_E;
      998    15054                    /***************************/
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:147  
      999    15055                    /*    CONSTANTS            */
     1000    15056                    /***************************/
     1001    15057        %SUB FCG#='1303'O;
     1002    15058        %SUB MID#='04'O;
     1003    15059        %ERRCODE (NAME=E_DUPNM,COD#=%E$DUPNM);
     1004    15063        %ERRCODE (NAME=E_NOMEM,COD#=%E$NOMEM);
     1005    15067        %ERRCODE (NAME=E_PCNLDCT,COD#=%E$PCNLDCT);
     1006    15071        %ERRCODE (NAME=E_STACHAR,COD#=%E$STACHAR);
     1007    15075                    /***************************/
     1008    15076                    /*    SYMREFs              */
     1009    15077                    /***************************/
     1010    15078    1   DCL B$JIT$ PTR SYMREF;
     1011    15079    1   DCL B$PS0$ PTR SYMREF READONLY;
     1012    15080    1   DCL S_CUN UBIN SYMREF;
     1013    15081                    /***************************/
     1014    15082                    /*    ENTREFs              */
     1015    15083                    /***************************/
     1016    15084    1   DCL KCF$FERDS ENTRY(1) ALTRET;
     1017    15085    1   DCL KQB$SRCH ENTRY(3) ALTRET;
     1018    15086    1   DCL KQL$DELMLH ENTRY(2) ALTRET;
     1019    15087    1   DCL KQP$UNLOCK ENTRY(1) ALTRET;
     1020    15088    1   DCL KQT$GETSTA ENTRY(3) ALTRET;
     1021    15089    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1022    15090    1   DCL NKL$GETDCT ENTRY(1) ALTRET;
     1023    15091    1   DCL NKL$RELDCT ENTRY(1) ALTRET;
     1024    15092    1   DCL SSR$REG ENTRY(3) ALTRET;
     1025    15093        /**/
     1026    15094        /**/
     1027    15095    1         KEY=VLP_STATION.STATION#;
     1028    15096    1         CALL INDEX(I,SUBSTR(KEY,0,1),KC_LGL1ST)
     1029    15097    2         WHENALTRETURN DO;
     1030    15098    2           B$JIT$->B$JIT.ERR=E_STACHAR;
     1031    15099        /*E* ERROR: KCD-E$STACHAR-E
     1032    15100           MESSAGE: Illegal first character in new FPRG station name
     1033    15101        */
     1034    15102    2           ALTRETURN;
     1035    15103    2           END;
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:148  
     1036    15104    1         CALL SETUP ALTRET(JUSTALT);
     1037    15105              %LOCK (G=KQ$CG.STREE.GATE);
     1038    15108    1         CALL KQB$SRCH(KQ$CG.STREE,KEY,T$)
     1039    15109    2         WHENRETURN DO;
     1040    15110    2           FPSTA$=T$;
     1041    15111                %LOCK (G=FPSTA$->KQ$STA.GATE);
     1042    15114    2           IF FPSTA$->KQ$STA.LDCT$~=ADDR(NIL) OR FPSTA$->KQ$STA.IDSC
     1043    15115    3           THEN DO;
     1044    15116                  %UNLOCK (G=FPSTA$->KQ$STA.GATE);
     1045    15119    3             B$JIT$->B$JIT.ERR=E_DUPNM;
     1046    15120        /*E* ERROR: KCD-E$DUPNM-E
     1047    15121           MESSAGE: The station name you intended for your FPRG is already in use
     1048    15122        */
     1049    15123                  %UNLOCK (G=KQ$CG.STREE.GATE);
     1050    15126    3             GOTO RELDCT;
     1051    15127    3             END;
     1052    15128    2           END;
     1053    15129    2         WHENALTRETURN DO;
     1054    15130    2           CALL KQT$GETSTA(KQ$CG,T$,KEY)
     1055    15131    3           WHENALTRETURN DO;
     1056    15132    3             B$JIT$->B$JIT.ERR=E_NOMEM;
     1057    15133        /*E* ERROR: KCD-E$NOMEM-E
     1058    15134           MESSAGE: No room available in your comgroup to create your FPRG station
     1059    15135        */
     1060    15136    3   RELDCT:   T$=NLDCT$; CALL NKL$RELDCT(T$);
     1061    15137    3             ALTRETURN;
     1062    15138    3             END;
     1063    15139    2           FPSTA$=T$;
     1064    15140                %LOCK (G=FPSTA$->KQ$STA.GATE);
     1065    15143    2           END;
     1066    15144              %UNLOCK (G=KQ$CG.STREE.GATE);
     1067    15147    1         FPSTA$->KQ$STA.TOLDAU='0'B;
     1068    15148    1         FPSTA$->KQ$STA.USEAUACCT=KQ_STA.USEAUACCT;
     1069    15149    1         FPSTA$->KQ$STA.OPNBLKED='0'B;
     1070    15150    1         FPSTA$->KQ$STA.DSCREQW='0'B;
     1071    15151    1         FPSTA$->KQ$STA.DSCREQS='0'B;
     1072    15152    1         FPSTA$->KQ$STA.STARSDUN='0'B;
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:149  
     1073    15153    1         FPSTA$->KQ$STA.PVGSENSE='0'B;
     1074    15154    1         FPSTA$->KQ$STA.SUCCREAD='0'B;
     1075    15155    1         FPSTA$->KQ$STA.IDSC='0'B;
     1076    15156    1         FPSTA$->KQ$STA.SAVIDSC='0'B;
     1077    15157    1         FPSTA$->KQ$STA.AU='0'B;
     1078    15158    1         FPSTA$->KQ$STA.EVNT='0'B;
     1079    15159    1         FPSTA$->KQ$STA.DSID=KQ$CG.MSGID;
     1080    15160    1         FPSTA$->KQ$STA.WRITES=0;
     1081    15161    1         FPSTA$->KQ$STA.READS=0;
     1082    15162    1         FPSTA$->KQ$STA.CNNCTDDA=0;
     1083    15163    1         FPSTA$->KQ$STA.USR#=0;
     1084    15164    1         FPSTA$->KQ$STA.TERM='1'B;
     1085    15165    1         KQ$CG.STATS.NUMTERMS=KQ$CG.STATS.NUMTERMS+1;
     1086    15166    1         GOTO CMN;
     1087    15167        /**/
     1088    15168        /**/
     1089    15169        /*D* NAME:        KCD$TFPRG
     1090    15170             PURPOSE:     To transform an existing TERMINAL station into an FPRG station
     1091    15171             CALL:        CALL KCD$TFPRG(KQ_STA) ALTRET(LBL);
     1092    15172             INPUT:       KQ_STA - The station block to be transformed
     1093    15173             OUTPUT:      KQ_STA - A transformed station
     1094    15174             DESCRIPTION: KCD$TFPRG is called with no gates locked but
     1095    15175                          KQ_STA.LOCKCNT counted up. If KQ_STA's LDCT is
     1096    15176                          ACTIVE, we RETURN immediately.
     1097    15177                          An LDCT is obtained and attached to KQ_STA; KQ_STA's
     1098    15178                          original LDCT is saved in KQ_STA.SAVLDCT$.
     1099    15179                          A KL_STRTU message is sent to Node Admin and the
     1100    15180                          calling user is REGged awaiting the results. If
     1101    15181                          the path is successfully established, we RETURN
     1102    15182                          otherwise we ALTRETURN with an error in B$JIT.ERR.
     1103    15183        */
     1104    15184    1   KCD$TFPRG: ENTRY(KQ_STA) ALTRET;
     1105    15185        /**/
     1106    15186        /**/
     1107    15187    1         IF KQ_STA.LDCT$->LDCT.LKFLG.ACTIVE THEN RETURN;
     1108    15188    1         CALL SETUP ALTRET(JUSTALT);
     1109    15189              %LOCK (G=KQ_STA.GATE);
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:150  
     1110    15192    1         KQ_STA.SAVLDCT$=KQ_STA.LDCT$;
     1111    15193    1         KQ_STA.LDCT$=ADDR(NIL);
     1112    15194    1         FPSTA$=ADDR(KQ_STA);
     1113    15195
     1114    15196
     1115    15197    1   CMN:  ;
     1116    15198    1         IF B$PS0$->FPT$ACTIVATE_V.FLUSH
     1117    15199    1         THEN CALL KQL$DELMLH(KQ$CG,ADDR(FPSTA$->KQ$STA.MLH));
     1118    15200    1         FPSTA$->KQ$STA.DVBYTE=B$PS0$->FPT$ACTIVATE_V.DVBYTE;
     1119    15201    1         NLDCT.DEVNM=FPSTA$->KQ$STA.BTN.KEY;
     1120    15202    1         NLDCT.CG$=LDCT.CG$;
     1121    15203              /* Allow FPRG to do both INPUT and OUTPUT;  don't take values from term sta */
     1122    15204    1         NLDCT.DFLG.INPUT='1'B;
     1123    15205    1         NLDCT.DFLG.OUTPUT='1'B;
     1124    15206    1         NLDCT.DFLG.CM='1'B;
     1125    15207    1         NLDCT.DFLG.CONSOLE=LDCT.DFLG.CONSOLE;
     1126    15208    1         NLDCT.DFLG.SYMBIONT=LDCT.DFLG.SYMBIONT;
     1127    15209    1         NLDCT.RESCOD=NK_CGFPRG;
     1128    15210    1         NLDCT.USER=S_CUN;
     1129    15211    1         NLDCT.TERMID.TTYP=LDCT.TERMID.TTYP;
     1130    15212    1         NLDCT.RLCID.NODE=LDCT.RLCID.NODE;
     1131    15213    1         NLDCT.RLCID.LDCTX = 0;
     1132    15214    1         NLDCT.ERR = '0'B;
     1133    15215    1         NLDCT.STA$=FPSTA$;
     1134    15216    1         NLDCT.LOGON_ACCT = LDCT.LOGON_ACCT;
     1135    15217    1         FPSTA$->KQ$STA.LDCT$=NLDCT$;
     1136    15218
     1137    15219    1         STRTU='0'B;
     1138    15220    2         IF FPSTA$->KQ$STA.USEAUACCT THEN DO;
     1139    15221    2           STRTU.ACCT = B$JIT$->B$JIT.ACCN;
     1140    15222    2           STRTU.UNAME = B$JIT$->B$JIT.UNAME;
     1141    15223    2           END;
     1142    15224    2         ELSE DO;
     1143    15225    2           STRTU.ACCT=NLDCT.LOGON_ACCT;
     1144    15226    2           STRTU.UNAME=B$JIT$->B$JIT.ACCN;
     1145    15227    2           END;
     1146    15228    1         STRTU.FCN=IGA_STRTU;
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:151  
     1147    15229    1         STRTU.NODE=NLDCT.RLCID.NODE;
     1148    15230    1         STRTU.NETADR_FROM.NODE=K_NODE#;
     1149    15231    1         STRTU.NETADR_FROM.GENERATION=NLDCT.GENERATION;
     1150    15232    1         STRTU.NETADR_FROM.LDX.BYT(0)=NLDCT.LDCTX/256;
     1151    15233    1         STRTU.NETADR_FROM.LDX.BYT(1)=NLDCT.LDCTX-STRTU.NETADR_FROM.LDX.BYT(0)*256;
     1152    15234    1         STRTU.NETADR_TO=LDCT.RLCID;
     1153    15235    1         STRTU.MODE=%G_M_CG#;
     1154    15236    1   /*N*/ STRTU.DB_ACCT='?';               /* For now, anyway */
     1155    15237
     1156    15238    1         FPSTA$->KQ$STA.LOCKCNT=FPSTA$->KQ$STA.LOCKCNT+1;
     1157    15239                                               /* To keep any disconnect of the LDCT */
     1158    15240                                               /* from causing the LDCT to disappear */
     1159    15241                                               /* in the window between path         */
     1160    15242                                               /* completion (first possible disc)   */
     1161    15243                                               /* and our locking of the LDCT after  */
     1162    15244                                               /* returning from the REG             */
     1163    15245              %UNLOCK (G=FPSTA$->KQ$STA.GATE);
     1164    15248
     1165    15249    1         I=SIZEC(STRTU);
     1166    15250    1         CALL KUB$WRITE(STRTU,I,'HLPADMIN');
     1167    15251                       /* Now we REG the user until this process completes so that
     1168    15252                          we may ALTRET to him if any error occurs.
     1169    15253
     1170    15254                          When we return from the REG, we may be in any of
     1171    15255                          several states:
     1172    15256                             1) NLDCT.ERR ~=0
     1173    15257                                We got an error BEFORE establishing the path.
     1174    15258                                We must report NLDCT.ERR to the user and fake
     1175    15259                                up a disconnect on this station so that
     1176    15260                                KQP$UNLOCK will continue with the disconnect
     1177    15261                                process and repair the damage.
     1178    15262                             2) NLDCT.ERR=0 but NLDCT.LKFLG.OLDSC has been set
     1179    15263                                No need to do anything for this since KQP$UNLOCK
     1180    15264                                will do all that is necessary.
     1181    15265                             3) Everything OK
     1182    15266                                We must set LDCT.LKFLG.ACTIVE and call
     1183    15267                                KCF$FERDS to get reads to the new station
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:152  
     1184    15268                                started.
     1185    15269        */
     1186    15270
     1187    15271              %LOCK (G=NLDCT.LOCK);
     1188    15274    2         IF (NLDCT.RLCID.LDCTX = 0) AND (NLDCT.ERR = '0'B) THEN DO;
     1189    15275    2           NLDCT.LKFLG.REGGED='1'B;
     1190    15276    2           CALL SSR$REG(%SS_CW,FPSTA$->KQ$STA.LDCT$);
     1191    15277                %LOCK (G=NLDCT.LOCK);
     1192    15280    2           END;
     1193    15281    1         IF NLDCT.ERR
     1194    15282    1         THEN IF (NLDCT.ERR.CODE=%E$NO_START OR /* unix fep? */
     1195    15283    1          NLDCT.ERR.CODE=1872)
     1196    15284    1          AND NLDCT.TERMID.TTYP=%KLTY_LINEDEV# /* running cp6fprg? */
     1197    15285    2          AND FPSTA$->KQ$STA.SAVLDCT$~=ADDR(NIL) THEN DO;
     1198    15286    2            FPSTA$->KQ$STA.SAVLDCT$=ADDR(NIL);
     1199    15287    2            FPSTA$->KQ$STA.LDCT$=LDCT$;
     1200    15288                 %UNLOCK (G=NLDCT.LOCK);
     1201    15291    2            T$=NLDCT$; CALL NKL$RELDCT(T$);
     1202    15292    2            LDCT.RESCOD=NK_CGFPRG;
     1203    15293    2            LDCT.DFLG.INPUT='1'B;
     1204    15294    2            LDCT.LKFLG.FPSTEP='1'B;
     1205    15295    2            LDCT.LKFLG.ACTIVE='1'B;
     1206    15296    2            CALL KCF$FERDS(LDCT);
     1207    15297    2            END;
     1208    15298    2          ELSE DO;
     1209    15299    2            B$JIT$->B$JIT.ERR=NLDCT.ERR;
     1210    15300    2            NLDCT.ERR='0'B;
     1211    15301    2            NLDCT.DFLG.FEDN='1'B;         /* So that we don't try to write      */
     1212    15302                                               /* to the FEP since we have no path.  */
     1213    15303    2            NLDCT.DFLG.PRLS='1'B;         /* Release LDCT when done. */
     1214    15304                 %UNLOCK (G=NLDCT.LOCK);
     1215    15307                 %LOCK (G=FPSTA$->KQ$STA.GATE);
     1216    15310    2            FPSTA$->KQ$STA.IDSC='1'B;     /* To get KQP$UNLOCK to continue disc */
     1217    15311                 %UNLOCK (G=FPSTA$->KQ$STA.GATE);
     1218    15314    2            END;
     1219    15315    2         ELSE DO;
     1220    15316    2           NLDCT.LKFLG.ACTIVE='1'B;
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:153  
     1221    15317                %UNLOCK (G=NLDCT.LOCK);
     1222    15320    2           CALL KCF$FERDS(NLDCT);
     1223    15321    2           END;
     1224    15322    1         CALL KQP$UNLOCK(FPSTA$->KQ$STA);
     1225    15323    1         IF B$JIT$->B$JIT.ERR.CODE~=0 THEN
     1226    15324    1   JUSTALT: ALTRETURN;
     1227    15325    1         RETURN;
     1228    15326
     1229    15327
     1230    15328    1   SETUP: PROC ALTRET;
     1231    15329    2         LDCT$=KQ_STA.LDCT$;
     1232    15330    2         CG$=LDCT.CG$;
     1233    15331    3         CALL NKL$GETDCT(T$) WHENALTRETURN DO;
     1234    15332    3           B$JIT$->B$JIT.ERR=E_PCNLDCT;
     1235    15333        /*E* ERROR: KCD-E$PCNLDCT-E
     1236    15334             MESSAGE: No LDCTs available to ACTIVATE your FPRG user
     1237    15335        */
     1238    15336    3           ALTRETURN;
     1239    15337    3           END;
     1240    15338    2         NLDCT$=T$;
     1241    15339    2         RETURN;
     1242    15340    2   END SETUP;
     1243    15341    1   END KCD$PFPRG;

PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:154  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   G_JIT_M.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KCD$PFPRG.

   Procedure KCD$PFPRG requires 474 words for executable code.
   Procedure KCD$PFPRG requires 64 words of local(AUTO) storage.

    No errors detected in file KCD$CGDEV.:E05TSI    .

PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:155  

 Object Unit name= KCD$PFPRG                                  File name= KCD$CGDEV.:E05TOU
 UTS= JUL 30 '97 00:13:18.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      6      6  KCD$PFPRG
    1   Proc  even  none   474    732  KCD$PFPRG
    2  RoData even  none    14     16  KCD$PFPRG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KCD$PFPRG
     1    222          yes     yes      Std        1  KCD$TFPRG
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:156  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 SSR$REG
         yes           Std       1 HFC$LOCK
 yes     yes           Std       3 KQB$SRCH
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 KQP$UNLOCK
 yes     yes           Std       3 KQT$GETSTA
 yes     yes           Std       2 KQL$DELMLH
 yes     yes           Std       1 KCF$FERDS
 yes     yes           Std       1 NKL$RELDCT
 yes     yes           Std       3 KUB$WRITE
 yes     yes           Std       1 NKL$GETDCT
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KC_LGL1ST                             K_NODE#                               B$JIT$
r    B$PS0$                                S_CUN                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:157  


      925        1        /*T***********************************************************/
      926        2        /*T*                                                         */
      927        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      928        4        /*T*                                                         */
      929        5        /*T***********************************************************/
      930        6        /*D* NAME:        KCD$PFPRG
      931        7             PURPOSE:     To create a pure FPRG station
      932        8             CALL:        CALL KCD$PFPRG(KQ_STA,VLP_STATION) ALTRET(LBL);
      933        9             INPUT:       KQ_STA - Station from which to build the new
      934       10                                   pure FPRG station
      935       11                          VLP_STATION - Station name of the new pure FPRG
      936       12                                        station
      937       13             OUTPUT:      A new pure FPRG station
      938       14             DESCRIPTION: KCD$PFPRG is called with no gates locked but with
      939       15                          KQ_STA.LOCKCNT counted up. A new station is obtained
      940       16                          (or a PERM station is used), an LDCT is obtained and
      941       17                          connected to the new station and a KL_STRTU message
      942       18                          is sent to the appropriate node's Node Admin process.
      943       19                          The calling user is REGged awaiting response from
      944       20                          this message. When we are un-REGged, KCD$PFPRG will
      945       21                          RETURN normally if the path was successfully
      946       22                          established, otherwise we will ALTRETURN with an
      947       23                          error in B$JIT.ERR.
      948       24
      949       25                          Must be called on behalf of the AU user.
      950       26                          KQ_STA's LDCT need not be inACTIVE.
      951       27        */
      952       28        KCD$PFPRG: PROC(KQ_STA,VLP_STATION) ALTRET;

     28  1 000000   000000 700200 xent  KCD$PFPRG    TSX0  ! X66_AUTO_2
         1 000001   000100 000002                    ZERO    64,2

      953       29        %INCLUDE B$JIT;
      954      632        %INCLUDE B_ERRORS_C;
      955     1759        %INCLUDE CP_6_SUBS;
      956     2299        %INCLUDE F_MACROS_C;
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:158  
      957     2310        %INCLUDE G_JIT_M;
      958     2575        %INCLUDE HF_LOCK_C;
      959     2589        %INCLUDE KC$CP6V_C;
      960     2709        %INCLUDE KC_CP6;
      961     3269        %INCLUDE KC_DATA_R;
      962     3282        %INCLUDE KL_AFCN_C;
      963     3383        %INCLUDE KL_MACRO_C;
      964     6735        %INCLUDE KL_SUPER_C;
      965     9637        %INCLUDE KQ_MAC_C;
      966    12187        %INCLUDE K_DATA_R;
      967    12898        %INCLUDE NK$LDCT;
      968    13000        %INCLUDE NK_SUBS;
      969    13025        %INCLUDE SS_SCHED_C;
      970    13258                    /***************************/
      971    13259                    /*    PARAMETERS           */
      972    13260                    /***************************/
      973    13261        %KQ_STA (FPTN=KQ_STA,STCLASS=PARAM);
      974    13600        %VLP_STATION (FPTN=VLP_STATION,STCLASS=PARAM);
      975    13627                    /***************************/
      976    13628                    /*    AUTO                 */
      977    13629                    /***************************/
      978    13630    1   DCL NLDCT$ PTR;
      979    13631    1   DCL FPSTA$ PTR;
      980    13632    1   DCL LDCT$ PTR;
      981    13633    1   DCL CG$ PTR;
      982    13634    1   DCL I SBIN;
      983    13635    1   DCL KEY CHAR(8);
      984    13636        %KL_STRTU (FPTN=STRTU,STCLASS=AUTO);
      985    13809    1   DCL T$ PTR;
      986    13810                    /***************************/
      987    13811                    /*    BASED                */
      988    13812                    /***************************/
      989    13813        %FPT$ACTIVATE_V;
      990    13819        %KQ_CG (FPTN=KQ$CG,STCLASS="BASED(CG$)");
      991    14558        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      992    14897        %NK$LDCT (NAME=LDCT,STCLASS="BASED(LDCT$)");
      993    14943        %NK$LDCT (NAME=NLDCT,STCLASS="BASED(NLDCT$)");
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:159  
      994    14989                    /***************************/
      995    14990                    /*    EQUs                 */
      996    14991                    /***************************/
      997    14992        %G$JIT_E;
      998    15054                    /***************************/
      999    15055                    /*    CONSTANTS            */
     1000    15056                    /***************************/
     1001    15057        %SUB FCG#='1303'O;
     1002    15058        %SUB MID#='04'O;
     1003    15059        %ERRCODE (NAME=E_DUPNM,COD#=%E$DUPNM);
     1004    15063        %ERRCODE (NAME=E_NOMEM,COD#=%E$NOMEM);
     1005    15067        %ERRCODE (NAME=E_PCNLDCT,COD#=%E$PCNLDCT);
     1006    15071        %ERRCODE (NAME=E_STACHAR,COD#=%E$STACHAR);
     1007    15075                    /***************************/
     1008    15076                    /*    SYMREFs              */
     1009    15077                    /***************************/
     1010    15078    1   DCL B$JIT$ PTR SYMREF;
     1011    15079    1   DCL B$PS0$ PTR SYMREF READONLY;
     1012    15080    1   DCL S_CUN UBIN SYMREF;
     1013    15081                    /***************************/
     1014    15082                    /*    ENTREFs              */
     1015    15083                    /***************************/
     1016    15084    1   DCL KCF$FERDS ENTRY(1) ALTRET;
     1017    15085    1   DCL KQB$SRCH ENTRY(3) ALTRET;
     1018    15086    1   DCL KQL$DELMLH ENTRY(2) ALTRET;
     1019    15087    1   DCL KQP$UNLOCK ENTRY(1) ALTRET;
     1020    15088    1   DCL KQT$GETSTA ENTRY(3) ALTRET;
     1021    15089    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1022    15090    1   DCL NKL$GETDCT ENTRY(1) ALTRET;
     1023    15091    1   DCL NKL$RELDCT ENTRY(1) ALTRET;
     1024    15092    1   DCL SSR$REG ENTRY(3) ALTRET;
     1025    15093        /**/
     1026    15094        /**/
     1027    15095    1         KEY=VLP_STATION.STATION#;

  15095  1 000002   200004 470500                    LDP0    @VLP_STATION,,AUTO
         1 000003   040100 100500                    MLR     fill='040'O
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:160  
         1 000004   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 000005   200012 000010                    ADSC9   KEY,,AUTO                cn=0,n=8

     1028    15096    1         CALL INDEX(I,SUBSTR(KEY,0,1),KC_LGL1ST)

  15096  1 000006   000100 124400                    SCM     mask='000'O
         1 000007   000000 000104 xsym               ADSC9   KC_LGL1ST                cn=0,n=68
         1 000010   200012 000001                    ADSC9   KEY,,AUTO                cn=0,n=1
         1 000011   200011 000100                    ARG     I,,AUTO
         1 000012   000014 606400 1                  TTN     s:15098
         1 000013   000020 710000 1                  TRA     s:15104

     1029    15097    2         WHENALTRETURN DO;

     1030    15098    2           B$JIT$->B$JIT.ERR=E_STACHAR;

  15098  1 000014   000003 236000 0                  LDQ     E_STACHAR
         1 000015   000000 470400 xsym               LDP0    B$JIT$
         1 000016   000012 756100                    STQ     10,,PR0

     1031    15099        /*E* ERROR: KCD-E$STACHAR-E
     1032    15100           MESSAGE: Illegal first character in new FPRG station name
     1033    15101        */
     1034    15102    2           ALTRETURN;

  15102  1 000017   000000 702200 xent               TSX2  ! X66_AALT

     1035    15103    2           END;
     1036    15104    1         CALL SETUP ALTRET(JUSTALT);

  15104  1 000020   000703 701000 1                  TSX1    SETUP
         1 000021   000701 702000 1                  TSX2    JUSTALT

     1037    15105              %LOCK (G=KQ$CG.STREE.GATE);

  15106  1 000022   200010 236100                    LDQ     CG$,,AUTO
         1 000023   000075 036003                    ADLQ    61,DU
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:161  
         1 000024   200074 756100                    STQ     T$+3,,AUTO
         1 000025   200074 630500                    EPPR0   T$+3,,AUTO
         1 000026   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000027   000000 701000 xent               TSX1    HFC$LOCK
         1 000030   000000 011000                    NOP     0

     1038    15108    1         CALL KQB$SRCH(KQ$CG.STREE,KEY,T$)

  15108  1 000031   200071 630500                    EPPR0   T$,,AUTO
         1 000032   200076 450500                    STP0    T$+5,,AUTO
         1 000033   200012 631500                    EPPR1   KEY,,AUTO
         1 000034   200075 451500                    STP1    T$+4,,AUTO
         1 000035   200010 236100                    LDQ     CG$,,AUTO
         1 000036   000075 036003                    ADLQ    61,DU
         1 000037   200074 756100                    STQ     T$+3,,AUTO
         1 000040   200074 630500                    EPPR0   T$+3,,AUTO
         1 000041   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000042   000000 701000 xent               TSX1    KQB$SRCH
         1 000043   000105 702000 1                  TSX2    s:15130

     1039    15109    2         WHENRETURN DO;

     1040    15110    2           FPSTA$=T$;

  15110  1 000044   200071 236100                    LDQ     T$,,AUTO
         1 000045   200006 756100                    STQ     FPSTA$,,AUTO

     1041    15111                %LOCK (G=FPSTA$->KQ$STA.GATE);

  15112  1 000046   000016 036003                    ADLQ    14,DU
         1 000047   200074 756100                    STQ     T$+3,,AUTO
         1 000050   200074 630500                    EPPR0   T$+3,,AUTO
         1 000051   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000052   000000 701000 xent               TSX1    HFC$LOCK
         1 000053   000000 011000                    NOP     0

     1042    15114    2           IF FPSTA$->KQ$STA.LDCT$~=ADDR(NIL) OR FPSTA$->KQ$STA.IDSC
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:162  

  15114  1 000054   200006 470500                    LDP0    FPSTA$,,AUTO
         1 000055   000010 236100                    LDQ     8,,PR0
         1 000056   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000057   000062 601000 1                  TNZ     s:15117
         1 000060   000020 234100                    SZN     16,,PR0
         1 000061   000104 605000 1                  TPL     s:15126+1

     1043    15115    3           THEN DO;

     1044    15116                  %UNLOCK (G=FPSTA$->KQ$STA.GATE);

  15117  1 000062   200006 236100                    LDQ     FPSTA$,,AUTO
         1 000063   000016 036003                    ADLQ    14,DU
         1 000064   200074 756100                    STQ     T$+3,,AUTO
         1 000065   200074 630500                    EPPR0   T$+3,,AUTO
         1 000066   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000067   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000070   000000 011000                    NOP     0

     1045    15119    3             B$JIT$->B$JIT.ERR=E_DUPNM;

  15119  1 000071   000000 236000 0                  LDQ     E_DUPNM
         1 000072   000000 470400 xsym               LDP0    B$JIT$
         1 000073   000012 756100                    STQ     10,,PR0

     1046    15120        /*E* ERROR: KCD-E$DUPNM-E
     1047    15121           MESSAGE: The station name you intended for your FPRG is already in use
     1048    15122        */
     1049    15123                  %UNLOCK (G=KQ$CG.STREE.GATE);

  15124  1 000074   200010 236100                    LDQ     CG$,,AUTO
         1 000075   000075 036003                    ADLQ    61,DU
         1 000076   200074 756100                    STQ     T$+3,,AUTO
         1 000077   200074 630500                    EPPR0   T$+3,,AUTO
         1 000100   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000101   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:163  
         1 000102   000000 011000                    NOP     0

     1050    15126    3             GOTO RELDCT;

  15126  1 000103   000123 710000 1                  TRA     RELDCT
         1 000104   000144 710000 1                  TRA     s:15145

     1051    15127    3             END;
     1052    15128    2           END;
     1053    15129    2         WHENALTRETURN DO;

     1054    15130    2           CALL KQT$GETSTA(KQ$CG,T$,KEY)

  15130  1 000105   200012 630500                    EPPR0   KEY,,AUTO
         1 000106   200076 450500                    STP0    T$+5,,AUTO
         1 000107   200071 631500                    EPPR1   T$,,AUTO
         1 000110   200075 451500                    STP1    T$+4,,AUTO
         1 000111   200010 236100                    LDQ     CG$,,AUTO
         1 000112   200074 756100                    STQ     T$+3,,AUTO
         1 000113   200074 630500                    EPPR0   T$+3,,AUTO
         1 000114   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000115   000000 701000 xent               TSX1    KQT$GETSTA
         1 000116   000120 702000 1                  TSX2    s:15132
         1 000117   000134 710000 1                  TRA     s:15139

     1055    15131    3           WHENALTRETURN DO;

     1056    15132    3             B$JIT$->B$JIT.ERR=E_NOMEM;

  15132  1 000120   000001 236000 0                  LDQ     E_NOMEM
         1 000121   000000 470400 xsym               LDP0    B$JIT$
         1 000122   000012 756100                    STQ     10,,PR0

     1057    15133        /*E* ERROR: KCD-E$NOMEM-E
     1058    15134           MESSAGE: No room available in your comgroup to create your FPRG station
     1059    15135        */
     1060    15136    3   RELDCT:   T$=NLDCT$; CALL NKL$RELDCT(T$);
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:164  

  15136  1 000123   200005 236100       RELDCT       LDQ     NLDCT$,,AUTO
         1 000124   200071 756100                    STQ     T$,,AUTO

  15136  1 000125   200071 630500                    EPPR0   T$,,AUTO
         1 000126   200074 450500                    STP0    T$+3,,AUTO
         1 000127   200074 630500                    EPPR0   T$+3,,AUTO
         1 000130   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000131   000000 701000 xent               TSX1    NKL$RELDCT
         1 000132   000000 011000                    NOP     0

     1061    15137    3             ALTRETURN;

  15137  1 000133   000000 702200 xent               TSX2  ! X66_AALT

     1062    15138    3             END;
     1063    15139    2           FPSTA$=T$;

  15139  1 000134   200071 236100                    LDQ     T$,,AUTO
         1 000135   200006 756100                    STQ     FPSTA$,,AUTO

     1064    15140                %LOCK (G=FPSTA$->KQ$STA.GATE);

  15141  1 000136   000016 036003                    ADLQ    14,DU
         1 000137   200074 756100                    STQ     T$+3,,AUTO
         1 000140   200074 630500                    EPPR0   T$+3,,AUTO
         1 000141   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000142   000000 701000 xent               TSX1    HFC$LOCK
         1 000143   000000 011000                    NOP     0

     1065    15143    2           END;

     1066    15144              %UNLOCK (G=KQ$CG.STREE.GATE);

  15145  1 000144   200010 236100                    LDQ     CG$,,AUTO
         1 000145   000075 036003                    ADLQ    61,DU
         1 000146   200074 756100                    STQ     T$+3,,AUTO
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:165  
         1 000147   200074 630500                    EPPR0   T$+3,,AUTO
         1 000150   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000151   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000152   000000 011000                    NOP     0

     1067    15147    1         FPSTA$->KQ$STA.TOLDAU='0'B;

  15147  1 000153   200006 470500                    LDP0    FPSTA$,,AUTO
         1 000154   000000 236000 2                  LDQ     0
         1 000155   000020 356100                    ANSQ    16,,PR0

     1068    15148    1         FPSTA$->KQ$STA.USEAUACCT=KQ_STA.USEAUACCT;

  15148  1 000156   200003 471500                    LDP1    @KQ_STA,,AUTO
         1 000157   100023 236100                    LDQ     19,,PR1
         1 000160   000023 676100                    ERQ     19,,PR0
         1 000161   000200 376007                    ANQ     128,DL
         1 000162   000023 656100                    ERSQ    19,,PR0

     1069    15149    1         FPSTA$->KQ$STA.OPNBLKED='0'B;

  15149  1 000163   000001 236000 2                  LDQ     1
         1 000164   000023 356100                    ANSQ    19,,PR0

     1070    15150    1         FPSTA$->KQ$STA.DSCREQW='0'B;

  15150  1 000165   000023 356100                    ANSQ    19,,PR0

     1071    15151    1         FPSTA$->KQ$STA.DSCREQS='0'B;

  15151  1 000166   000002 236000 2                  LDQ     2
         1 000167   000023 356100                    ANSQ    19,,PR0

     1072    15152    1         FPSTA$->KQ$STA.STARSDUN='0'B;

  15152  1 000170   000003 236000 2                  LDQ     3
         1 000171   000023 356100                    ANSQ    19,,PR0
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:166  

     1073    15153    1         FPSTA$->KQ$STA.PVGSENSE='0'B;

  15153  1 000172   000004 236000 2                  LDQ     4
         1 000173   000023 356100                    ANSQ    19,,PR0

     1074    15154    1         FPSTA$->KQ$STA.SUCCREAD='0'B;

  15154  1 000174   000005 236000 2                  LDQ     5
         1 000175   000020 356100                    ANSQ    16,,PR0

     1075    15155    1         FPSTA$->KQ$STA.IDSC='0'B;

  15155  1 000176   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000177   000020 356100                    ANSQ    16,,PR0

     1076    15156    1         FPSTA$->KQ$STA.SAVIDSC='0'B;

  15156  1 000200   000006 236000 2                  LDQ     6
         1 000201   000023 356100                    ANSQ    19,,PR0

     1077    15157    1         FPSTA$->KQ$STA.AU='0'B;

  15157  1 000202   000007 236000 2                  LDQ     7
         1 000203   000020 356100                    ANSQ    16,,PR0

     1078    15158    1         FPSTA$->KQ$STA.EVNT='0'B;

  15158  1 000204   000010 236000 2                  LDQ     8
         1 000205   000020 356100                    ANSQ    16,,PR0

     1079    15159    1         FPSTA$->KQ$STA.DSID=KQ$CG.MSGID;

  15159  1 000206   200010 473500                    LDP3    CG$,,AUTO
         1 000207   300113 235100                    LDA     75,,PR3
         1 000210   000022 755100                    STA     18,,PR0

PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:167  
     1080    15160    1         FPSTA$->KQ$STA.WRITES=0;

  15160  1 000211   000027 450100                    STZ     23,,PR0

     1081    15161    1         FPSTA$->KQ$STA.READS=0;

  15161  1 000212   000026 450100                    STZ     22,,PR0

     1082    15162    1         FPSTA$->KQ$STA.CNNCTDDA=0;

  15162  1 000213   000021 450100                    STZ     17,,PR0

     1083    15163    1         FPSTA$->KQ$STA.USR#=0;

  15163  1 000214   000000 236003                    LDQ     0,DU
         1 000215   000020 552110                    STBQ    16,'10'O,PR0

     1084    15164    1         FPSTA$->KQ$STA.TERM='1'B;

  15164  1 000216   040000 236003                    LDQ     16384,DU
         1 000217   000020 256100                    ORSQ    16,,PR0

     1085    15165    1         KQ$CG.STATS.NUMTERMS=KQ$CG.STATS.NUMTERMS+1;

  15165  1 000220   300174 054100                    AOS     124,,PR3

     1086    15166    1         GOTO CMN;

  15166  1 000221   000252 710000 1                  TRA     CMN

     1087    15167        /**/
     1088    15168        /**/
     1089    15169        /*D* NAME:        KCD$TFPRG
     1090    15170             PURPOSE:     To transform an existing TERMINAL station into an FPRG station
     1091    15171             CALL:        CALL KCD$TFPRG(KQ_STA) ALTRET(LBL);
     1092    15172             INPUT:       KQ_STA - The station block to be transformed
     1093    15173             OUTPUT:      KQ_STA - A transformed station
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:168  
     1094    15174             DESCRIPTION: KCD$TFPRG is called with no gates locked but
     1095    15175                          KQ_STA.LOCKCNT counted up. If KQ_STA's LDCT is
     1096    15176                          ACTIVE, we RETURN immediately.
     1097    15177                          An LDCT is obtained and attached to KQ_STA; KQ_STA's
     1098    15178                          original LDCT is saved in KQ_STA.SAVLDCT$.
     1099    15179                          A KL_STRTU message is sent to Node Admin and the
     1100    15180                          calling user is REGged awaiting the results. If
     1101    15181                          the path is successfully established, we RETURN
     1102    15182                          otherwise we ALTRETURN with an error in B$JIT.ERR.
     1103    15183        */
     1104    15184    1   KCD$TFPRG: ENTRY(KQ_STA) ALTRET;

  15184  1 000222   000000 700200 xent  KCD$TFPRG    TSX0  ! X66_AUTO_2
         1 000223   000100 000002                    ZERO    64,2

     1105    15185        /**/
     1106    15186        /**/
     1107    15187    1         IF KQ_STA.LDCT$->LDCT.LKFLG.ACTIVE THEN RETURN;

  15187  1 000224   200003 470500                    LDP0    @KQ_STA,,AUTO
         1 000225   000010 471500                    LDP1    8,,PR0
         1 000226   100011 236100                    LDQ     9,,PR1
         1 000227   000040 316003                    CANQ    32,DU
         1 000230   000232 600000 1                  TZE     s:15188

  15187  1 000231   000000 702200 xent               TSX2  ! X66_ARET

     1108    15188    1         CALL SETUP ALTRET(JUSTALT);

  15188  1 000232   000703 701000 1                  TSX1    SETUP
         1 000233   000701 702000 1                  TSX2    JUSTALT

     1109    15189              %LOCK (G=KQ_STA.GATE);

  15190  1 000234   200003 236100                    LDQ     @KQ_STA,,AUTO
         1 000235   000016 036003                    ADLQ    14,DU
         1 000236   200074 756100                    STQ     T$+3,,AUTO
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:169  
         1 000237   200074 630500                    EPPR0   T$+3,,AUTO
         1 000240   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000241   000000 701000 xent               TSX1    HFC$LOCK
         1 000242   000000 011000                    NOP     0

     1110    15192    1         KQ_STA.SAVLDCT$=KQ_STA.LDCT$;

  15192  1 000243   200003 470500                    LDP0    @KQ_STA,,AUTO
         1 000244   000010 236100                    LDQ     8,,PR0
         1 000245   000031 756100                    STQ     25,,PR0

     1111    15193    1         KQ_STA.LDCT$=ADDR(NIL);

  15193  1 000246   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000247   000010 756100                    STQ     8,,PR0

     1112    15194    1         FPSTA$=ADDR(KQ_STA);

  15194  1 000250   200003 236100                    LDQ     @KQ_STA,,AUTO
         1 000251   200006 756100                    STQ     FPSTA$,,AUTO

  15194  1 000252                       CMN          null
     1113    15195
     1114    15196
     1115    15197    1   CMN:  ;
     1116    15198    1         IF B$PS0$->FPT$ACTIVATE_V.FLUSH

  15198  1 000252   000000 470400 xsym               LDP0    B$PS0$
         1 000253   000002 236100                    LDQ     2,,PR0
         1 000254   200000 316003                    CANQ    65536,DU
         1 000255   000271 600000 1                  TZE     s:15200

     1117    15199    1         THEN CALL KQL$DELMLH(KQ$CG,ADDR(FPSTA$->KQ$STA.MLH));

  15199  1 000256   200006 236100                    LDQ     FPSTA$,,AUTO
         1 000257   000034 036003                    ADLQ    28,DU
         1 000260   200074 756100                    STQ     T$+3,,AUTO
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:170  
         1 000261   200074 631500                    EPPR1   T$+3,,AUTO
         1 000262   200077 451500                    STP1    T$+6,,AUTO
         1 000263   200010 236100                    LDQ     CG$,,AUTO
         1 000264   200076 756100                    STQ     T$+5,,AUTO
         1 000265   200076 630500                    EPPR0   T$+5,,AUTO
         1 000266   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000267   000000 701000 xent               TSX1    KQL$DELMLH
         1 000270   000000 011000                    NOP     0

     1118    15200    1         FPSTA$->KQ$STA.DVBYTE=B$PS0$->FPT$ACTIVATE_V.DVBYTE;

  15200  1 000271   200006 470500                    LDP0    FPSTA$,,AUTO
         1 000272   000000 471400 xsym               LDP1    B$PS0$
         1 000273   100000 236100                    LDQ     0,,PR1
         1 000274   000022 736000                    QLS     18
         1 000275   000023 552120                    STBQ    19,'20'O,PR0

     1119    15201    1         NLDCT.DEVNM=FPSTA$->KQ$STA.BTN.KEY;

  15201  1 000276   200005 473500                    LDP3    NLDCT$,,AUTO
         1 000277   040100 100500                    MLR     fill='040'O
         1 000300   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 000301   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8

     1120    15202    1         NLDCT.CG$=LDCT.CG$;

  15202  1 000302   200007 474500                    LDP4    LDCT$,,AUTO
         1 000303   400027 236100                    LDQ     23,,PR4
         1 000304   300027 756100                    STQ     23,,PR3

     1121    15203              /* Allow FPRG to do both INPUT and OUTPUT; don't take values from term sta */
     1122    15204    1         NLDCT.DFLG.INPUT='1'B;

  15204  1 000305   400000 236007                    LDQ     -131072,DL
         1 000306   300006 256100                    ORSQ    6,,PR3

     1123    15205    1         NLDCT.DFLG.OUTPUT='1'B;
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:171  

  15205  1 000307   200000 236007                    LDQ     65536,DL
         1 000310   300006 256100                    ORSQ    6,,PR3

     1124    15206    1         NLDCT.DFLG.CM='1'B;

  15206  1 000311   100000 236007                    LDQ     32768,DL
         1 000312   300006 256100                    ORSQ    6,,PR3

     1125    15207    1         NLDCT.DFLG.CONSOLE=LDCT.DFLG.CONSOLE;

  15207  1 000313   400006 236100                    LDQ     6,,PR4
         1 000314   300006 676100                    ERQ     6,,PR3
         1 000315   040000 376007                    ANQ     16384,DL
         1 000316   300006 656100                    ERSQ    6,,PR3

     1126    15208    1         NLDCT.DFLG.SYMBIONT=LDCT.DFLG.SYMBIONT;

  15208  1 000317   400006 236100                    LDQ     6,,PR4
         1 000320   300006 676100                    ERQ     6,,PR3
         1 000321   020000 376007                    ANQ     8192,DL
         1 000322   300006 656100                    ERSQ    6,,PR3

     1127    15209    1         NLDCT.RESCOD=NK_CGFPRG;

  15209  1 000323   300006 236100                    LDQ     6,,PR3
         1 000324   000011 376000 2                  ANQ     9
         1 000325   000011 276007                    ORQ     9,DL
         1 000326   300006 756100                    STQ     6,,PR3

     1128    15210    1         NLDCT.USER=S_CUN;

  15210  1 000327   000000 236000 xsym               LDQ     S_CUN
         1 000330   000022 736000                    QLS     18
         1 000331   300007 552120                    STBQ    7,'20'O,PR3

     1129    15211    1         NLDCT.TERMID.TTYP=LDCT.TERMID.TTYP;
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:172  

  15211  1 000332   400022 236100                    LDQ     18,,PR4
         1 000333   300022 552120                    STBQ    18,'20'O,PR3

     1130    15212    1         NLDCT.RLCID.NODE=LDCT.RLCID.NODE;

  15212  1 000334   400015 236100                    LDQ     13,,PR4
         1 000335   300015 552140                    STBQ    13,'40'O,PR3

     1131    15213    1         NLDCT.RLCID.LDCTX = 0;

  15213  1 000336   000000 220003                    LDX0    0,DU
         1 000337   300015 440100                    SXL0    13,,PR3

     1132    15214    1         NLDCT.ERR = '0'B;

  15214  1 000340   300000 450100                    STZ     0,,PR3

     1133    15215    1         NLDCT.STA$=FPSTA$;

  15215  1 000341   200006 236100                    LDQ     FPSTA$,,AUTO
         1 000342   300012 756100                    STQ     10,,PR3

     1134    15216    1         NLDCT.LOGON_ACCT = LDCT.LOGON_ACCT;

  15216  1 000343   400024 237100                    LDAQ    20,,PR4
         1 000344   300024 757100                    STAQ    20,,PR3

     1135    15217    1         FPSTA$->KQ$STA.LDCT$=NLDCT$;

  15217  1 000345   200005 236100                    LDQ     NLDCT$,,AUTO
         1 000346   000010 756100                    STQ     8,,PR0

     1136    15218
     1137    15219    1         STRTU='0'B;

  15219  1 000347   000100 100400                    MLR     fill='000'O
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:173  
         1 000350   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000351   200014 000264                    ADSC9   STRTU,,AUTO              cn=0,n=180

     1138    15220    2         IF FPSTA$->KQ$STA.USEAUACCT THEN DO;

  15220  1 000352   000023 236100                    LDQ     19,,PR0
         1 000353   000200 316007                    CANQ    128,DL
         1 000354   000365 600000 1                  TZE     s:15225

     1139    15221    2           STRTU.ACCT = B$JIT$->B$JIT.ACCN;

  15221  1 000355   000000 475400 xsym               LDP5    B$JIT$
         1 000356   040100 100500                    MLR     fill='040'O
         1 000357   500001 000010                    ADSC9   1,,PR5                   cn=0,n=8
         1 000360   200021 400010                    ADSC9   STRTU+5,,AUTO            cn=2,n=8

     1140    15222    2           STRTU.UNAME = B$JIT$->B$JIT.UNAME;

  15222  1 000361   040100 100500                    MLR     fill='040'O
         1 000362   500003 000014                    ADSC9   3,,PR5                   cn=0,n=12
         1 000363   200016 400014                    ADSC9   STRTU+2,,AUTO            cn=2,n=12

     1141    15223    2           END;

  15223  1 000364   000374 710000 1                  TRA     s:15228

     1142    15224    2         ELSE DO;

     1143    15225    2           STRTU.ACCT=NLDCT.LOGON_ACCT;

  15225  1 000365   040100 100500                    MLR     fill='040'O
         1 000366   300024 000010                    ADSC9   20,,PR3                  cn=0,n=8
         1 000367   200021 400010                    ADSC9   STRTU+5,,AUTO            cn=2,n=8

     1144    15226    2           STRTU.UNAME=B$JIT$->B$JIT.ACCN;

  15226  1 000370   000000 475400 xsym               LDP5    B$JIT$
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:174  
         1 000371   040100 100500                    MLR     fill='040'O
         1 000372   500001 000010                    ADSC9   1,,PR5                   cn=0,n=8
         1 000373   200016 400014                    ADSC9   STRTU+2,,AUTO            cn=2,n=12

     1145    15227    2           END;

     1146    15228    1         STRTU.FCN=IGA_STRTU;

  15228  1 000374   033000 236003                    LDQ     13824,DU
         1 000375   200014 552140                    STBQ    STRTU,'40'O,AUTO

     1147    15229    1         STRTU.NODE=NLDCT.RLCID.NODE;

  15229  1 000376   300015 236100                    LDQ     13,,PR3
         1 000377   000011 772000                    QRL     9
         1 000400   200014 552120                    STBQ    STRTU,'20'O,AUTO

     1148    15230    1         STRTU.NETADR_FROM.NODE=K_NODE#;

  15230  1 000401   000000 236000 xsym               LDQ     K_NODE#
         1 000402   000011 736000                    QLS     9
         1 000403   200014 552110                    STBQ    STRTU,'10'O,AUTO

     1149    15231    1         STRTU.NETADR_FROM.GENERATION=NLDCT.GENERATION;

  15231  1 000404   300014 236100                    LDQ     12,,PR3
         1 000405   000377 376003                    ANQ     255,DU
         1 000406   000022 772000                    QRL     18
         1 000407   200014 552104                    STBQ    STRTU,'04'O,AUTO

     1150    15232    1         STRTU.NETADR_FROM.LDX.BYT(0)=NLDCT.LDCTX/256;

  15232  1 000410   300006 236100                    LDQ     6,,PR3
         1 000411   000022 772000                    QRL     18
         1 000412   000010 772000                    QRL     8
         1 000413   000033 736000                    QLS     27
         1 000414   200015 676100                    ERQ     STRTU+1,,AUTO
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:175  
         1 000415   377000 376003                    ANQ     130560,DU
         1 000416   200015 656100                    ERSQ    STRTU+1,,AUTO

     1151    15233    1         STRTU.NETADR_FROM.LDX.BYT(1)=NLDCT.LDCTX-STRTU.NETADR_FROM.LDX.BYT(0)*256;

  15233  1 000417   300006 236100                    LDQ     6,,PR3
         1 000420   000022 772000                    QRL     18
         1 000421   200074 756100                    STQ     T$+3,,AUTO
         1 000422   200015 236100                    LDQ     STRTU+1,,AUTO
         1 000423   000023 772000                    QRL     19
         1 000424   177400 376007                    ANQ     65280,DL
         1 000425   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 000426   000001 036007                    ADLQ    1,DL
         1 000427   200074 036100                    ADLQ    T$+3,,AUTO
         1 000430   000022 736000                    QLS     18
         1 000431   200015 676100                    ERQ     STRTU+1,,AUTO
         1 000432   000377 376003                    ANQ     255,DU
         1 000433   200015 656100                    ERSQ    STRTU+1,,AUTO

     1152    15234    1         STRTU.NETADR_TO=LDCT.RLCID;

  15234  1 000434   000100 100500                    MLR     fill='000'O
         1 000435   400015 000004                    ADSC9   13,,PR4                  cn=0,n=4
         1 000436   200015 400004                    ADSC9   STRTU+1,,AUTO            cn=2,n=4

     1153    15235    1         STRTU.MODE=%G_M_CG#;

  15235  1 000437   002000 236007                    LDQ     1024,DL
         1 000440   200025 552110                    STBQ    STRTU+9,'10'O,AUTO

     1154    15236    1   /*N*/ STRTU.DB_ACCT='?';               /* For now, anyway */

  15236  1 000441   040100 100400                    MLR     fill='040'O
         1 000442   000012 000001 2                  ADSC9   10                       cn=0,n=1
         1 000443   200023 400010                    ADSC9   STRTU+7,,AUTO            cn=2,n=8

     1155    15237
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:176  
     1156    15238    1         FPSTA$->KQ$STA.LOCKCNT=FPSTA$->KQ$STA.LOCKCNT+1;

  15238  1 000444   000020 236100                    LDQ     16,,PR0
         1 000445   000001 036007                    ADLQ    1,DL
         1 000446   000020 552104                    STBQ    16,'04'O,PR0

     1157    15239                                               /* To keep any disconnect of the LDCT */
     1158    15240                                               /* from causing the LDCT to disappear */
     1159    15241                                               /* in the window between path         */
     1160    15242                                               /* completion (first possible disc)   */
     1161    15243                                               /* and our locking of the LDCT after  */
     1162    15244                                               /* returning from the REG             */
     1163    15245              %UNLOCK (G=FPSTA$->KQ$STA.GATE);

  15246  1 000447   200006 236100                    LDQ     FPSTA$,,AUTO
         1 000450   000016 036003                    ADLQ    14,DU
         1 000451   200074 756100                    STQ     T$+3,,AUTO
         1 000452   200074 630500                    EPPR0   T$+3,,AUTO
         1 000453   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000454   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000455   000000 011000                    NOP     0

     1164    15248
     1165    15249    1         I=SIZEC(STRTU);

  15249  1 000456   000264 235007                    LDA     180,DL
         1 000457   200011 755100                    STA     I,,AUTO

     1166    15250    1         CALL KUB$WRITE(STRTU,I,'HLPADMIN');

  15250  1 000460   000013 236000 2                  LDQ     11
         1 000461   200076 756100                    STQ     T$+5,,AUTO
         1 000462   200011 630500                    EPPR0   I,,AUTO
         1 000463   200075 450500                    STP0    T$+4,,AUTO
         1 000464   200014 631500                    EPPR1   STRTU,,AUTO
         1 000465   200074 451500                    STP1    T$+3,,AUTO
         1 000466   200074 630500                    EPPR0   T$+3,,AUTO
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:177  
         1 000467   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000470   000000 701000 xent               TSX1    KUB$WRITE
         1 000471   000000 011000                    NOP     0

     1167    15251                       /* Now we REG the user until this process completes so that
     1168    15252                          we may ALTRET to him if any error occurs.
     1169    15253
     1170    15254                          When we return from the REG, we may be in any of
     1171    15255                          several states:
     1172    15256                             1) NLDCT.ERR ~=0
     1173    15257                                We got an error BEFORE establishing the path.
     1174    15258                                We must report NLDCT.ERR to the user and fake
     1175    15259                                up a disconnect on this station so that
     1176    15260                                KQP$UNLOCK will continue with the disconnect
     1177    15261                                process and repair the damage.
     1178    15262                             2) NLDCT.ERR=0 but NLDCT.LKFLG.OLDSC has been set
     1179    15263                                No need to do anything for this since KQP$UNLOCK
     1180    15264                                will do all that is necessary.
     1181    15265                             3) Everything OK
     1182    15266                                We must set LDCT.LKFLG.ACTIVE and call
     1183    15267                                KCF$FERDS to get reads to the new station
     1184    15268                                started.
     1185    15269        */
     1186    15270
     1187    15271              %LOCK (G=NLDCT.LOCK);

  15272  1 000472   200005 236100                    LDQ     NLDCT$,,AUTO
         1 000473   000020 036003                    ADLQ    16,DU
         1 000474   200074 756100                    STQ     T$+3,,AUTO
         1 000475   200074 630500                    EPPR0   T$+3,,AUTO
         1 000476   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000477   000000 701000 xent               TSX1    HFC$LOCK
         1 000500   000000 011000                    NOP     0

     1188    15274    2         IF (NLDCT.RLCID.LDCTX = 0) AND (NLDCT.ERR = '0'B) THEN DO;

  15274  1 000501   200005 470500                    LDP0    NLDCT$,,AUTO
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:178  
         1 000502   000015 720100                    LXL0    13,,PR0
         1 000503   000527 601000 1                  TNZ     s:15281
         1 000504   000000 235100                    LDA     0,,PR0
         1 000505   000527 601000 1                  TNZ     s:15281

     1189    15275    2           NLDCT.LKFLG.REGGED='1'B;

  15275  1 000506   100000 236003                    LDQ     32768,DU
         1 000507   000011 256100                    ORSQ    9,,PR0

     1190    15276    2           CALL SSR$REG(%SS_CW,FPSTA$->KQ$STA.LDCT$);

  15276  1 000510   200006 236100                    LDQ     FPSTA$,,AUTO
         1 000511   000010 036003                    ADLQ    8,DU
         1 000512   000015 235000 2                  LDA     13
         1 000513   200074 757100                    STAQ    T$+3,,AUTO
         1 000514   200074 630500                    EPPR0   T$+3,,AUTO
         1 000515   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000516   000000 701000 xent               TSX1    SSR$REG
         1 000517   000000 011000                    NOP     0

     1191    15277                %LOCK (G=NLDCT.LOCK);

  15278  1 000520   200005 236100                    LDQ     NLDCT$,,AUTO
         1 000521   000020 036003                    ADLQ    16,DU
         1 000522   200074 756100                    STQ     T$+3,,AUTO
         1 000523   200074 630500                    EPPR0   T$+3,,AUTO
         1 000524   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000525   000000 701000 xent               TSX1    HFC$LOCK
         1 000526   000000 011000                    NOP     0

     1192    15280    2           END;

     1193    15281    1         IF NLDCT.ERR

  15281  1 000527   200005 470500                    LDP0    NLDCT$,,AUTO
         1 000530   000000 235100                    LDA     0,,PR0
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:179  
         1 000531   000654 600000 1                  TZE     s:15316

     1194    15282    1         THEN IF (NLDCT.ERR.CODE=%E$NO_START OR /* unix fep? */

  15282  1 000532   000000 236100                    LDQ     0,,PR0
         1 000533   377770 376007                    ANQ     131064,DL
         1 000534   003140 116007                    CMPQ    1632,DL
         1 000535   000540 600000 1                  TZE     s:15282+6
         1 000536   035200 116007                    CMPQ    14976,DL
         1 000537   000613 601000 1                  TNZ     s:15299
         1 000540   000022 236100                    LDQ     18,,PR0
         1 000541   000777 376003                    ANQ     511,DU
         1 000542   000012 116003                    CMPQ    10,DU
         1 000543   000613 601000 1                  TNZ     s:15299
         1 000544   200006 471500                    LDP1    FPSTA$,,AUTO
         1 000545   100031 236100                    LDQ     25,,PR1
         1 000546   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000547   000613 600000 1                  TZE     s:15299

     1195    15283    1          NLDCT.ERR.CODE=1872)
     1196    15284    1          AND NLDCT.TERMID.TTYP=%KLTY_LINEDEV# /* running cp6fprg? */
     1197    15285    2          AND FPSTA$->KQ$STA.SAVLDCT$~=ADDR(NIL) THEN DO;

     1198    15286    2            FPSTA$->KQ$STA.SAVLDCT$=ADDR(NIL);

  15286  1 000550   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000551   100031 756100                    STQ     25,,PR1

     1199    15287    2            FPSTA$->KQ$STA.LDCT$=LDCT$;

  15287  1 000552   200007 236100                    LDQ     LDCT$,,AUTO
         1 000553   100010 756100                    STQ     8,,PR1

     1200    15288                 %UNLOCK (G=NLDCT.LOCK);

  15289  1 000554   200005 236100                    LDQ     NLDCT$,,AUTO
         1 000555   000020 036003                    ADLQ    16,DU
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:180  
         1 000556   200074 756100                    STQ     T$+3,,AUTO
         1 000557   200074 630500                    EPPR0   T$+3,,AUTO
         1 000560   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000561   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000562   000000 011000                    NOP     0

     1201    15291    2            T$=NLDCT$; CALL NKL$RELDCT(T$);

  15291  1 000563   200005 236100                    LDQ     NLDCT$,,AUTO
         1 000564   200071 756100                    STQ     T$,,AUTO

  15291  1 000565   200071 630500                    EPPR0   T$,,AUTO
         1 000566   200074 450500                    STP0    T$+3,,AUTO
         1 000567   200074 630500                    EPPR0   T$+3,,AUTO
         1 000570   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000571   000000 701000 xent               TSX1    NKL$RELDCT
         1 000572   000000 011000                    NOP     0

     1202    15292    2            LDCT.RESCOD=NK_CGFPRG;

  15292  1 000573   200007 470500                    LDP0    LDCT$,,AUTO
         1 000574   000006 236100                    LDQ     6,,PR0
         1 000575   000011 376000 2                  ANQ     9
         1 000576   000011 276007                    ORQ     9,DL
         1 000577   000006 756100                    STQ     6,,PR0

     1203    15293    2            LDCT.DFLG.INPUT='1'B;

  15293  1 000600   400000 236007                    LDQ     -131072,DL
         1 000601   000006 256100                    ORSQ    6,,PR0

     1204    15294    2            LDCT.LKFLG.FPSTEP='1'B;

  15294  1 000602   000010 236003                    LDQ     8,DU
         1 000603   000011 256100                    ORSQ    9,,PR0

     1205    15295    2            LDCT.LKFLG.ACTIVE='1'B;
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:181  

  15295  1 000604   000040 236003                    LDQ     32,DU
         1 000605   000011 256100                    ORSQ    9,,PR0

     1206    15296    2            CALL KCF$FERDS(LDCT);

  15296  1 000606   200007 630500                    EPPR0   LDCT$,,AUTO
         1 000607   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000610   000000 701000 xent               TSX1    KCF$FERDS
         1 000611   000000 011000                    NOP     0

     1207    15297    2            END;

  15297  1 000612   000671 710000 1                  TRA     s:15322

     1208    15298    2          ELSE DO;

     1209    15299    2            B$JIT$->B$JIT.ERR=NLDCT.ERR;

  15299  1 000613   000000 236100                    LDQ     0,,PR0
         1 000614   000000 471400 xsym               LDP1    B$JIT$
         1 000615   100012 756100                    STQ     10,,PR1

     1210    15300    2            NLDCT.ERR='0'B;

  15300  1 000616   000000 450100                    STZ     0,,PR0

     1211    15301    2            NLDCT.DFLG.FEDN='1'B;         /* So that we don't try to write      */

  15301  1 000617   000020 236007                    LDQ     16,DL
         1 000620   000006 256100                    ORSQ    6,,PR0

     1212    15302                                               /* to the FEP since we have no path.  */
     1213    15303    2            NLDCT.DFLG.PRLS='1'B;         /* Release LDCT when done. */

  15303  1 000621   000200 236007                    LDQ     128,DL
         1 000622   000006 256100                    ORSQ    6,,PR0
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:182  

     1214    15304                 %UNLOCK (G=NLDCT.LOCK);

  15305  1 000623   200005 236100                    LDQ     NLDCT$,,AUTO
         1 000624   000020 036003                    ADLQ    16,DU
         1 000625   200074 756100                    STQ     T$+3,,AUTO
         1 000626   200074 630500                    EPPR0   T$+3,,AUTO
         1 000627   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000630   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000631   000000 011000                    NOP     0

     1215    15307                 %LOCK (G=FPSTA$->KQ$STA.GATE);

  15308  1 000632   200006 236100                    LDQ     FPSTA$,,AUTO
         1 000633   000016 036003                    ADLQ    14,DU
         1 000634   200074 756100                    STQ     T$+3,,AUTO
         1 000635   200074 630500                    EPPR0   T$+3,,AUTO
         1 000636   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000637   000000 701000 xent               TSX1    HFC$LOCK
         1 000640   000000 011000                    NOP     0

     1216    15310    2            FPSTA$->KQ$STA.IDSC='1'B;     /* To get KQP$UNLOCK to continue disc */

  15310  1 000641   200006 470500                    LDP0    FPSTA$,,AUTO
         1 000642   400000 236003                    LDQ     -131072,DU
         1 000643   000020 256100                    ORSQ    16,,PR0

     1217    15311                 %UNLOCK (G=FPSTA$->KQ$STA.GATE);

  15312  1 000644   200006 236100                    LDQ     FPSTA$,,AUTO
         1 000645   000016 036003                    ADLQ    14,DU
         1 000646   200074 756100                    STQ     T$+3,,AUTO
         1 000647   200074 630500                    EPPR0   T$+3,,AUTO
         1 000650   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000651   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000652   000000 011000                    NOP     0

PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:183  
     1218    15314    2            END;

  15314  1 000653   000671 710000 1                  TRA     s:15322

     1219    15315    2         ELSE DO;

     1220    15316    2           NLDCT.LKFLG.ACTIVE='1'B;

  15316  1 000654   000040 236003                    LDQ     32,DU
         1 000655   000011 256100                    ORSQ    9,,PR0

     1221    15317                %UNLOCK (G=NLDCT.LOCK);

  15318  1 000656   200005 236100                    LDQ     NLDCT$,,AUTO
         1 000657   000020 036003                    ADLQ    16,DU
         1 000660   200074 756100                    STQ     T$+3,,AUTO
         1 000661   200074 630500                    EPPR0   T$+3,,AUTO
         1 000662   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000663   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000664   000000 011000                    NOP     0

     1222    15320    2           CALL KCF$FERDS(NLDCT);

  15320  1 000665   200005 630500                    EPPR0   NLDCT$,,AUTO
         1 000666   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000667   000000 701000 xent               TSX1    KCF$FERDS
         1 000670   000000 011000                    NOP     0

     1223    15321    2           END;

     1224    15322    1         CALL KQP$UNLOCK(FPSTA$->KQ$STA);

  15322  1 000671   200006 630500                    EPPR0   FPSTA$,,AUTO
         1 000672   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000673   000000 701000 xent               TSX1    KQP$UNLOCK
         1 000674   000000 011000                    NOP     0

PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:184  
     1225    15323    1         IF B$JIT$->B$JIT.ERR.CODE~=0 THEN

  15323  1 000675   000000 470400 xsym               LDP0    B$JIT$
         1 000676   000012 236100                    LDQ     10,,PR0
         1 000677   377770 316007                    CANQ    131064,DL
         1 000700   000702 600000 1                  TZE     s:15325

     1226    15324    1   JUSTALT: ALTRETURN;

  15324  1 000701   000000 702200 xent  JUSTALT      TSX2  ! X66_AALT

     1227    15325    1         RETURN;

  15325  1 000702   000000 702200 xent               TSX2  ! X66_ARET

     1228    15326
     1229    15327
     1230    15328    1   SETUP: PROC ALTRET;

  15328  1 000703   200072 741300       SETUP        STX1  ! T$+1,,AUTO

     1231    15329    2         LDCT$=KQ_STA.LDCT$;

  15329  1 000704   200003 470500                    LDP0    @KQ_STA,,AUTO
         1 000705   000010 236100                    LDQ     8,,PR0
         1 000706   200007 756100                    STQ     LDCT$,,AUTO

     1232    15330    2         CG$=LDCT.CG$;

  15330  1 000707   200007 471500                    LDP1    LDCT$,,AUTO
         1 000710   100027 236100                    LDQ     23,,PR1
         1 000711   200010 756100                    STQ     CG$,,AUTO

     1233    15331    3         CALL NKL$GETDCT(T$) WHENALTRETURN DO;

  15331  1 000712   200071 633500                    EPPR3   T$,,AUTO
         1 000713   200074 453500                    STP3    T$+3,,AUTO
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:185  
         1 000714   200074 630500                    EPPR0   T$+3,,AUTO
         1 000715   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000716   000000 701000 xent               TSX1    NKL$GETDCT
         1 000717   000721 702000 1                  TSX2    s:15332
         1 000720   000726 710000 1                  TRA     s:15338

     1234    15332    3           B$JIT$->B$JIT.ERR=E_PCNLDCT;

  15332  1 000721   000002 236000 0                  LDQ     E_PCNLDCT
         1 000722   000000 470400 xsym               LDP0    B$JIT$
         1 000723   000012 756100                    STQ     10,,PR0

     1235    15333        /*E* ERROR: KCD-E$PCNLDCT-E
     1236    15334             MESSAGE: No LDCTs available to ACTIVATE your FPRG user
     1237    15335        */
     1238    15336    3           ALTRETURN;

  15336  1 000724   200072 221300                    LDX1  ! T$+1,,AUTO
         1 000725   000000 702211                    TSX2  ! 0,X1

     1239    15337    3           END;
     1240    15338    2         NLDCT$=T$;

  15338  1 000726   200071 236100                    LDQ     T$,,AUTO
         1 000727   200005 756100                    STQ     NLDCT$,,AUTO

     1241    15339    2         RETURN;

  15339  1 000730   200072 221300                    LDX1  ! T$+1,,AUTO
         1 000731   000001 702211                    TSX2  ! 1,X1

E_DUPNM
 Sect OctLoc
   0     000   130304 015432                                                    X...

E_NOMEM
 Sect OctLoc
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:186  
   0     001   130304 015442                                                    X...

E_PCNLDCT
 Sect OctLoc
   0     002   130304 022612                                                    X...

E_STACHAR
 Sect OctLoc
   0     003   130304 015362                                                    X...

(unnamed)
 Sect OctLoc
   0     004   110114 120101   104115 111116                                    HLPADMIN

(unnamed)
 Sect OctLoc
   2     000   773777 777777   777777 757777   777777 767777   777777 775777    ................
   2     004   777777 776777   767777 777777   777777 777377   577777 777777    ................
   2     010   775777 777777   777777 777760   077040 040040   000004 006000    ........?   ....
   2     014   000000 000047   000014 006000                                    ...'....
     1242    15340    2   END SETUP;
     1243    15341    1   END KCD$PFPRG;

PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:187  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   G_JIT_M.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KCD$PFPRG.
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:188  

 **** Variables and constants ****

  ****  Section 000 RoData KCD$PFPRG

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 E_DUPNM                    1-0-0/b STRC        r     1 E_NOMEM
     2-0-0/b STRC        r     1 E_PCNLDCT                  3-0-0/b STRC        r     1 E_STACHAR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @KQ_STA                    4-0-0/w PTR         r     1 @VLP_STATION
    10-0-0/w PTR         r     1 CG$                        6-0-0/w PTR         r     1 FPSTA$
    11-0-0/w SBIN        r     1 I                         12-0-0/c CHAR(8)     r     1 KEY
    *0-0-0/d STRC(1296)  r     1 KQ_STA                     7-0-0/w PTR         r     1 LDCT$
     5-0-0/w PTR         r     1 NLDCT$                    14-0-0/w STRC(1620)  r     1 STRTU
    71-0-0/w PTR         r     1 T$                        *0-0-0/w STRC(288)   r     1 VLP_STATION

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/c CHAR(68)    r     1 KC_LGL1ST                  0-0-0/w UBIN        r     1 K_NODE#
     0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(288)   r     1 FPT$ACTIVATE_V
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:189  
     0-0-0/d STRC(6516)  r     1 KQ$CG                      0-0-0/d STRC(1296)  r     1 KQ$STA
     0-0-0/d STRC(864)   r     1 NK$LDCT                    0-0-0/d STRC(864)   r     1 NLDCT


   Procedure KCD$PFPRG requires 474 words for executable code.
   Procedure KCD$PFPRG requires 64 words of local(AUTO) storage.

    No errors detected in file KCD$CGDEV.:E05TSI    .
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:190  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:191  
          MINI XREF LISTING

B$JIT.ACCN
       356**DCL     15221>>ASSIGN  15226>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       450**DCL       450--REDEF
B$JIT.ERR
       356**DCL     15098<<ASSIGN  15119<<ASSIGN  15132<<ASSIGN  15299<<ASSIGN  15332<<ASSIGN
B$JIT.ERR.CODE
       357**DCL     15323>>IF
B$JIT.ERR.MID
       357**DCL       357--REDEF
B$JIT.JRESPEAK
       518**DCL       519--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       627**DCL       627--REDEF     628--REDEF
B$JIT.PNR
       531**DCL       531--REDEF
B$JIT.TSLINE
       625**DCL       626--REDEF
B$JIT.UNAME
       356**DCL     15222>>ASSIGN
B$JIT$
     15078**DCL       351--IMP-PTR 15098>>ASSIGN  15119>>ASSIGN  15132>>ASSIGN  15221>>ASSIGN  15222>>ASSIGN
     15226>>ASSIGN  15299>>ASSIGN  15323>>IF      15332>>ASSIGN
B$PS0$
     15079**DCL     15198>>IF      15200>>ASSIGN
CG$
     13633**DCL     13834--IMP-PTR 15106>>CALL    15108>>CALL    15124>>CALL    15130>>CALL    15145>>CALL
     15159>>ASSIGN  15165>>ASSIGN  15165>>ASSIGN  15199>>CALL    15330<<ASSIGN
CMN
     15194**LABEL   15166--GOTO
E_DUPNM
     15060**DCL     15119>>ASSIGN
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:192  
E_NOMEM
     15064**DCL     15132>>ASSIGN
E_PCNLDCT
     15068**DCL     15332>>ASSIGN
E_STACHAR
     15072**DCL     15098>>ASSIGN
FPSTA$
     13631**DCL     15110<<ASSIGN  15112>>CALL    15114>>IF      15114>>IF      15117>>CALL    15139<<ASSIGN
     15141>>CALL    15147>>ASSIGN  15148>>ASSIGN  15149>>ASSIGN  15150>>ASSIGN  15151>>ASSIGN  15152>>ASSIGN
     15153>>ASSIGN  15154>>ASSIGN  15155>>ASSIGN  15156>>ASSIGN  15157>>ASSIGN  15158>>ASSIGN  15159>>ASSIGN
     15160>>ASSIGN  15161>>ASSIGN  15162>>ASSIGN  15163>>ASSIGN  15164>>ASSIGN  15194<<ASSIGN  15199>>CALL
     15200>>ASSIGN  15201>>ASSIGN  15215>>ASSIGN  15217>>ASSIGN  15220>>IF      15238>>ASSIGN  15238>>ASSIGN
     15246>>CALL    15276>>CALL    15282>>IF      15286>>ASSIGN  15287>>ASSIGN  15308>>CALL    15310>>ASSIGN
     15312>>CALL    15322>>CALL
FPT$ACTIVATE_V.DVBYTE
     13814**DCL     15200>>ASSIGN
FPT$ACTIVATE_V.DVBYTE.REREAD
     13814**DCL     13814--REDEF
FPT$ACTIVATE_V.FLUSH
     13815**DCL     15198>>IF
HFC$LOCK
      2588**DCL-ENT 15106--CALL    15112--CALL    15141--CALL    15190--CALL    15272--CALL    15278--CALL
     15308--CALL
HFC$UNLOCK
      2588**DCL-ENT 15117--CALL    15124--CALL    15145--CALL    15246--CALL    15289--CALL    15305--CALL
     15312--CALL    15318--CALL
I
     13634**DCL     15096<<CALLBLT 15249<<ASSIGN  15250<>CALL
JUSTALT
     15324**LABEL   15104--CALLALT 15188--CALLALT
KCF$FERDS
     15084**DCL-ENT 15296--CALL    15320--CALL
KC_LGL1ST
      3279**DCL     15096>>CALLBLT
KEY
     13635**DCL     15095<<ASSIGN  15096>>CALLBLT 15108<>CALL    15130<>CALL
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:193  
KQ$CG
     13834**DCL     15130<>CALL    15199<>CALL
KQ$CG.AUCTL.DVBYTE.REREAD
     14277**DCL     14278--REDEF
KQ$CG.MSGID
     14228**DCL     15159>>ASSIGN
KQ$CG.STATS.NUMTERMS
     14327**DCL     15165<<ASSIGN  15165>>ASSIGN
KQ$CG.STREE
     14166**DCL     15108<>CALL
KQ$CG.STREE.GATE
     14168**DCL     15106<>CALL    15124<>CALL    15145<>CALL
KQ$STA
     14572**DCL     15322<>CALL
KQ$STA.ACTTYC
     14624**DCL     14628--REDEF
KQ$STA.AU
     14654**DCL     15157<<ASSIGN
KQ$STA.BTN.KEY
     14608**DCL     15201>>ASSIGN
KQ$STA.CNNCTDDA
     14709**DCL     15162<<ASSIGN
KQ$STA.DCBLNK$
     14631**DCL     14634--REDEF   14638--REDEF
KQ$STA.DSCREQS
     14752**DCL     15151<<ASSIGN
KQ$STA.DSCREQW
     14747**DCL     15150<<ASSIGN
KQ$STA.DSID
     14711**DCL     15159<<ASSIGN
KQ$STA.DVBYTE
     14723**DCL     15200<<ASSIGN
KQ$STA.EVCNT
     14717**DCL     14720--REDEF
KQ$STA.EVNT
     14683**DCL     14687--REDEF   14690--REDEF   15158<<ASSIGN
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:194  
KQ$STA.GATE
     14650**DCL     15112<>CALL    15117<>CALL    15141<>CALL    15246<>CALL    15308<>CALL    15312<>CALL
KQ$STA.IDSC
     14652**DCL     15114>>IF      15155<<ASSIGN  15310<<ASSIGN
KQ$STA.LDCT$
     14613**DCL     15114>>IF      15217<<ASSIGN  15276<>CALL    15287<<ASSIGN
KQ$STA.LOCKCNT
     14706**DCL     15238<<ASSIGN  15238>>ASSIGN
KQ$STA.MLH
     14840**DCL     15199--CALL
KQ$STA.OPNBLKED
     14744**DCL     14747--REDEF   15149<<ASSIGN
KQ$STA.OPNREJ
     14750**DCL     14752--REDEF
KQ$STA.PVGSENSE
     14767**DCL     15153<<ASSIGN
KQ$STA.READS
     14798**DCL     15161<<ASSIGN
KQ$STA.SAVIDSC
     14771**DCL     15156<<ASSIGN
KQ$STA.SAVLDCT$
     14811**DCL     15282>>IF      15286<<ASSIGN
KQ$STA.STARSDUN
     14760**DCL     15152<<ASSIGN
KQ$STA.SUCCREAD
     14673**DCL     14677--REDEF   15154<<ASSIGN
KQ$STA.TCOUNT
     14802**DCL     14808--REDEF
KQ$STA.TERM
     14668**DCL     15164<<ASSIGN
KQ$STA.TOLDAU
     14680**DCL     15147<<ASSIGN
KQ$STA.USEAUACCT
     14775**DCL     15148<<ASSIGN  15220>>IF
KQ$STA.USR#
     14703**DCL     15163<<ASSIGN
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:195  
KQ$STA.VGOT$
     14787**DCL     14791--REDEF   14795--REDEF
KQ$STA.WRITES
     14800**DCL     15160<<ASSIGN
KQB$SRCH
     15085**DCL-ENT 15108--CALL
KQL$DELMLH
     15086**DCL-ENT 15199--CALL
KQP$UNLOCK
     15087**DCL-ENT 15322--CALL
KQT$GETSTA
     15088**DCL-ENT 15130--CALL
KQ_STA
     13275**DCL        28--PROC    15184--ENTRY   15194--ASSIGN
KQ_STA.ACTTYC
     13327**DCL     13331--REDEF
KQ_STA.DCBLNK$
     13334**DCL     13337--REDEF   13341--REDEF
KQ_STA.EVCNT
     13420**DCL     13423--REDEF
KQ_STA.EVNT
     13386**DCL     13390--REDEF   13393--REDEF
KQ_STA.GATE
     13353**DCL     15190<>CALL
KQ_STA.LDCT$
     13316**DCL     15187>>IF      15192>>ASSIGN  15193<<ASSIGN  15329>>ASSIGN
KQ_STA.OPNBLKED
     13447**DCL     13450--REDEF
KQ_STA.OPNREJ
     13453**DCL     13455--REDEF
KQ_STA.SAVLDCT$
     13514**DCL     15192<<ASSIGN
KQ_STA.SUCCREAD
     13376**DCL     13380--REDEF
KQ_STA.TCOUNT
     13505**DCL     13511--REDEF
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:196  
KQ_STA.USEAUACCT
     13478**DCL     15148>>ASSIGN
KQ_STA.VGOT$
     13490**DCL     13494--REDEF   13498--REDEF
KUB$WRITE
     15089**DCL-ENT 15250--CALL
K_NODE#
     12897**DCL     15230>>ASSIGN
K_RWPARM_CON.BLKREC
     12628**DCL     12653--REDEF
K_RWPARM_CON.BLKREC.BLKU#
     12629**DCL     12631--REDEF
K_RWPARM_CON.BLKREC.RECU#
     12641**DCL     12643--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
     12668**DCL     12669--REDEF
K_RWPARM_CON.DVE.EOMCHAR
     12676**DCL     12680--REDEF
K_RWPARM_CON.ERR
     12740**DCL     12745--REDEF
K_RWPARM_CON.FC
     12704**DCL     12705--REDEF
K_RWPARM_CON.FLDID
     12886**DCL     12887--REDEF
K_RWPARM_CON.FPT$
     12767**DCL     12774--REDEF
K_RWPARM_CON.KEYTYPE
     12893**DCL     12894--REDEF
K_RWPARM_CON.MSG$
     12603**DCL     12609--REDEF
K_RWPARM_CON.MSGID
     12715**DCL     12720--REDEF
K_RWPARM_CON.MSGIDXT
     12728**DCL     12732--REDEF
K_RWPARM_CON.ORG
     12864**DCL     12865--REDEF
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:197  
K_RWPARM_CON.THDRSZ
     12808**DCL     12812--REDEF
K_RWPARM_CON.VDOFLGS
     12866**DCL     12877--REDEF
LDCT$
     13632**DCL     14910--IMP-PTR 15202>>ASSIGN  15207>>ASSIGN  15208>>ASSIGN  15211>>ASSIGN  15212>>ASSIGN
     15216>>ASSIGN  15234>>ASSIGN  15287>>ASSIGN  15292>>ASSIGN  15293>>ASSIGN  15294>>ASSIGN  15295>>ASSIGN
     15296>>CALL    15329<<ASSIGN  15330>>ASSIGN
NK$LDCT
     14910**DCL     15296<>CALL
NK$LDCT.CG$
     14941**DCL     15202>>ASSIGN  15330>>ASSIGN
NK$LDCT.DDT$
     14912**DCL     14912--REDEF
NK$LDCT.DFLG.CONSOLE
     14915**DCL     15207>>ASSIGN
NK$LDCT.DFLG.INPUT
     14914**DCL     15293<<ASSIGN
NK$LDCT.DFLG.SYMBIONT
     14915**DCL     15208>>ASSIGN
NK$LDCT.IOQ$
     14911**DCL     14912--REDEF
NK$LDCT.LDCTX
     14913**DCL     14913--REDEF
NK$LDCT.LKFLG.ABORTED
     14925**DCL     14926--REDEF
NK$LDCT.LKFLG.ACTIVE
     14929**DCL     15187>>IF      15295<<ASSIGN
NK$LDCT.LKFLG.FPSTEP
     14930**DCL     15294<<ASSIGN
NK$LDCT.LOGON_ACCT
     14940**DCL     15216>>ASSIGN
NK$LDCT.RESCOD
     14918**DCL     15292<<ASSIGN
NK$LDCT.RLCID
     14934**DCL     15234>>ASSIGN
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:198  
NK$LDCT.RLCID.LDCTX
     14935**DCL     14935--REDEF
NK$LDCT.RLCID.NODE
     14934**DCL     15212>>ASSIGN
NK$LDCT.STA$
     14931**DCL     14932--REDEF
NK$LDCT.SYMB$
     14910**DCL     14910--REDEF   14910--REDEF   14911--REDEF
NK$LDCT.TERMID.TTYP
     14938**DCL     15211>>ASSIGN
NKL$GETDCT
     15090**DCL-ENT 15331--CALL
NKL$RELDCT
     15091**DCL-ENT 15136--CALL    15291--CALL
NLDCT
     14956**DCL     15320<>CALL
NLDCT.CG$
     14987**DCL     15202<<ASSIGN
NLDCT.DDT$
     14958**DCL     14958--REDEF
NLDCT.DEVNM
     14958**DCL     15201<<ASSIGN
NLDCT.DFLG.CM
     14960**DCL     15206<<ASSIGN
NLDCT.DFLG.CONSOLE
     14961**DCL     15207<<ASSIGN
NLDCT.DFLG.FEDN
     14964**DCL     15301<<ASSIGN
NLDCT.DFLG.INPUT
     14960**DCL     15204<<ASSIGN
NLDCT.DFLG.OUTPUT
     14960**DCL     15205<<ASSIGN
NLDCT.DFLG.PRLS
     14963**DCL     15303<<ASSIGN
NLDCT.DFLG.SYMBIONT
     14961**DCL     15208<<ASSIGN
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:199  
NLDCT.ERR
     14957**DCL     15214<<ASSIGN  15274>>IF      15281>>IF      15299>>ASSIGN  15300<<ASSIGN
NLDCT.ERR.CODE
     14957**DCL     15282>>IF      15282>>IF
NLDCT.GENERATION
     14979**DCL     15231>>ASSIGN
NLDCT.IOQ$
     14957**DCL     14958--REDEF
NLDCT.LDCTX
     14959**DCL     14959--REDEF   15232>>ASSIGN  15233>>ASSIGN
NLDCT.LKFLG.ABORTED
     14971**DCL     14972--REDEF
NLDCT.LKFLG.ACTIVE
     14975**DCL     15316<<ASSIGN
NLDCT.LKFLG.REGGED
     14972**DCL     15275<<ASSIGN
NLDCT.LOCK
     14984**DCL     15272<>CALL    15278<>CALL    15289<>CALL    15305<>CALL    15318<>CALL
NLDCT.LOGON_ACCT
     14986**DCL     15216<<ASSIGN  15225>>ASSIGN
NLDCT.RESCOD
     14964**DCL     15209<<ASSIGN
NLDCT.RLCID.LDCTX
     14981**DCL     14981--REDEF   15213<<ASSIGN  15274>>IF
NLDCT.RLCID.NODE
     14980**DCL     15212<<ASSIGN  15229>>ASSIGN
NLDCT.STA$
     14977**DCL     14978--REDEF   15215<<ASSIGN
NLDCT.SYMB$
     14956**DCL     14956--REDEF   14956--REDEF   14957--REDEF
NLDCT.TERMID.TTYP
     14984**DCL     15211<<ASSIGN  15282>>IF
NLDCT.USER
     14966**DCL     15210<<ASSIGN
NLDCT$
     13630**DCL     14956--IMP-PTR 15136>>ASSIGN  15201>>ASSIGN  15202>>ASSIGN  15204>>ASSIGN  15205>>ASSIGN
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:200  
     15206>>ASSIGN  15207>>ASSIGN  15208>>ASSIGN  15209>>ASSIGN  15210>>ASSIGN  15211>>ASSIGN  15212>>ASSIGN
     15213>>ASSIGN  15214>>ASSIGN  15215>>ASSIGN  15216>>ASSIGN  15217>>ASSIGN  15225>>ASSIGN  15229>>ASSIGN
     15231>>ASSIGN  15232>>ASSIGN  15233>>ASSIGN  15272>>CALL    15274>>IF      15274>>IF      15275>>ASSIGN
     15278>>CALL    15281>>IF      15282>>IF      15282>>IF      15282>>IF      15289>>CALL    15291>>ASSIGN
     15299>>ASSIGN  15300>>ASSIGN  15301>>ASSIGN  15303>>ASSIGN  15305>>CALL    15316>>ASSIGN  15318>>CALL
     15320>>CALL    15338<<ASSIGN
RELDCT
     15136**LABEL   15126--GOTO
SETUP
     15328**PROC    15104--CALL    15188--CALL
SSR$REG
     15092**DCL-ENT 15276--CALL
STRTU
     13651**DCL     15219<<ASSIGN  15249--ASSIGN  15250<>CALL
STRTU.ACCT
     13692**DCL     15221<<ASSIGN  15225<<ASSIGN
STRTU.DB_ACCT
     13696**DCL     15236<<ASSIGN
STRTU.FCN
     13652**DCL     15228<<ASSIGN
STRTU.MODE
     13700**DCL     15235<<ASSIGN
STRTU.NETADR_FROM.GENERATION
     13664**DCL     15231<<ASSIGN
STRTU.NETADR_FROM.LDX.BYT
     13668**DCL     15232<<ASSIGN  15233<<ASSIGN  15233>>ASSIGN
STRTU.NETADR_FROM.NODE
     13663**DCL     15230<<ASSIGN
STRTU.NETADR_TO
     13675**DCL     15234<<ASSIGN
STRTU.NODE
     13658**DCL     15229<<ASSIGN
STRTU.UNAME
     13688**DCL     15222<<ASSIGN  15226<<ASSIGN
S_CUN
     15080**DCL     15210>>ASSIGN
PL6.E3A0      #004=KCD$PFPRG File=KCD$CGDEV.:E05TSI                              WED 07/30/97 00:13 Page:201  
T$
     13809**DCL     15108<>CALL    15110>>ASSIGN  15130<>CALL    15136<<ASSIGN  15136<>CALL    15139>>ASSIGN
     15291<<ASSIGN  15291<>CALL    15331<>CALL    15338>>ASSIGN
VLP_STATION
     13612**DCL        28--PROC
VLP_STATION.MSGIDXT
     13622**DCL     13625--REDEF
VLP_STATION.STATION#
     13616**DCL     15095>>ASSIGN
