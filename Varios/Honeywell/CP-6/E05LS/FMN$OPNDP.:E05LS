VERSION E05

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:1    
        1        1        /*M*  FMN$OPNDP - Open routines for access to pack(set)s.  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9                    /*F*     NAME: FMN$SETX
       10       10                    *        PURPOSE: To put a non-zero into DCB.SETX if PSN isnt blank
       11       11                    *        or after a MAD search. Input parameter is a 6-char psn to find
       12       12                    *        in FM$SET. If up for another user or not up, FMN$SETX altrets.
       13       13                    */
       14       14        FMN$SETX: PROC(PSN) ALTRET;
       15       15        %INCLUDE F$JIT_C;
       16      445        %MACRO F$DCB#(BASED=BASED);
       17      446        %INCLUDE F$DCB;
       18      495        %MEND;
       19      496        %F$DCB#(BASED="BASED(JDCB$)");
       20      546        %INCLUDE FM$MACROS;
       21      921        %FM$SET(BASED="BASED(FM$SET$)");
       22      926        %FM$DEV(BASED="BASED(FM$SET$)");
       23      932        %FM$VOL(BASED="BASED(FM$SET$)");
       24      938        %FM$CFUX;
       25      943        %FM$VID(FM$VID=VID,BASED="BASED(VID$)");
       26      949        %FM$VID(FM$VID=VID0,BASED="BASED(VID0$)");
       27      955        %CODE04(BASED="BASED(VID0$)");
       28      963        %CODE14(BASED="BASED(VID0$)");
       29      973        %FM$GRAN;
       30      977        %INCLUDE FR$RAT;
       31     1030        %FR$RAT(STCLASS="BASED(RAT$)");
       32     1070        %INCLUDE NI$TABLES;
       33     1286        %NI$DCT;
       34     1334        %INCLUDE F_ERRORS_C;
       35     1574        %INCLUDE FR_ERRORS_C;
       36     1605        %INCLUDE UD_ERRORS_C;
       37     1647        %INCLUDE CP_6_SUBS;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:2    
       38     2187        %INCLUDE JG_GHOSTS_C;
       39     2277        %SUB FCG#='0615'O;
       40     2278        %SUB MID#='16'O;
       41     2279        %ERRCODE(NAME=FMN$E$XCLSET,COD#=%E$XCLSET);
       42     2283        %ERRCODE(NAME=FMN$E$SETDOWN,COD#=%E$SETDOWN);
       43     2287        %ERRCODE(NAME=FMN$E$BADVOL,COD#=%E$BADVOL);
       44     2291        %ERRCODE(NAME=FMN$E$NOTAUTH,COD#=%E$NOTAUTH);
       45     2295        %ERRCODE(NAME=FMN$E$SPLITRES,COD#=%E$SPLITRES);
       46     2299                    /**/
       47     2300                    /* AUTO/PARAM DATA */
       48     2301                    /**/
       49     2302    1   DCL PSN CHAR(6); /* INPUT PSN */
       50     2303    1   DCL I UBIN; /* INDEX TO SET TABLES */
       51     2304    1   DCL 1 IC REDEF I,
       52     2305    1         2 * BIT(18),
       53     2306    1         2 DCTX CHAR(2);
       54     2307    1   DCL JDCB$ PTR;
       55     2308    1   DCL J UBIN;
       56     2309    1   DCL VID$ PTR;
       57     2310    1   DCL VID0$ PTR;
       58     2311    1   DCL VOL UBIN;
       59     2312    1   DCL RAT$ PTR;
       60     2313    1   DCL SYSID UBIN;
       61     2314    1   DCL MODE UBIN;
       62     2315                    /**/
       63     2316                    /* SYMREF */
       64     2317                    /**/
       65     2318    1   DCL B$JIT$ SYMREF PTR;
       66     2319    1   DCL FM$SET$ SYMREF PTR;
       67     2320    1   DCL F$CFU$ PTR SYMREF;
       68     2321    1   DCL N$DCT$$ PTR SYMREF;
       69     2322    1   DCL N$DCT$(0:0)BASED(N$DCT$$)PTR;
       70     2323    1   DCL FM_SRZERO UBIN SYMREF;
       71     2324    1   DCL FM_PADSDA UBIN SYMREF;
       72     2325    1   DCL FM_GPSDA UBIN SYMREF;
       73     2326                    /**/
       74     2327                    /**/
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:3    
       75     2328                    /* ENTREFS */
       76     2329                    /**/
       77     2330    1   DCL FAG$CGRANS ENTRY ALTRET;
       78     2331    1   DCL FMD$GETBUF ENTRY(3);
       79     2332    1   DCL FMD$RELBUF ENTRY(1);
       80     2333    1   DCL FMN$RDGRAN ENTRY(2)ALTRET;
       81     2334    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
       82     2335    1   DCL FMR$L8 ENTRY;
       83     2336    1   DCL FMR$U8 ENTRY;
       84     2337    1   DCL FMP$ULIST ENTRY(2)ALTRET;
       85     2338    1   DCL FMP$UDLIST ENTRY(2)ALTRET;
       86     2339    1   DCL FRA$OPR ENTRY ALTRET;
       87     2340    1   DCL FRZ$GETRES ENTRY(5)ALTRET;
       88     2341    1   DCL FRZ$RRES ENTRY(2);
       89     2342    1   DCL FRZ$RRESNA ENTRY(2);
       90     2343    1   DCL SC_SETRES ENTRY CONV(2,0);
       91     2344                    /**/
       92     2345                    /* BASED */
       93     2346                    /**/
       94     2347    1   DCL CHAR4 CHAR(4) BASED;
       95     2348        %EJECT;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:4    
       96     2349                    /**/
       97     2350                    /* PROCEDUER */
       98     2351                    /**/
       99     2352    1      JDCB$=B$JIT.DCB$;
      100     2353    1      F$DCB.SETX=0;
      101     2354    1      CALL FMR$L8;
      102     2355    1      I=FM$CFUX.SETH;
      103     2356    2      IF PSN>' ' THEN DO WHILE(I~=0);
      104     2357    3         IF FM$SET.PSN(I)=PSN THEN DO;
      105     2358    3   GOTONE:  ;
      106     2359    3            IF FM$SET.XCL(I) THEN IF FM$SET.SYSID(I)~=B$JIT.SYSID
      107     2360    3                 AND (FM$SET.SYSID(I)~=0
      108     2361    3                 OR F$DCB.IASN~=%FMDIAG# AND B$JIT.SYSID~=JG_SLUG#)
      109     2362    3               THEN IF FM$SET.SYSID(I)=0 THEN GOTO FMNE$SETDOWN;
      110     2363    3                  ELSE GOTO FMNE$XCLSET;
      111     2364                    /*E*     ERROR: FMN-E$XCLSET-E
      112     2365                    *         MESSAGE: Packset %DP#%SN %is busy
      113     2366                    */
      114     2367    3               ELSE IF NOT FM$SET.SET(I) AND
      115     2368    4                    FM$SET.DCTX(I)~=FM$SET.DCTX(FM$SET.DCTX(I)) THEN DO;
      116     2369    4                     FM$SET.ONEU(I)='1'B;
      117     2370    4                     IF FM$SET.SYSID(I)=0 THEN FM$SET.DIAGOPN(I)='1'B;
      118     2371    4                     FM$SET.SYSID(I)=B$JIT.SYSID;
      119     2372    4                     CALL FMR$U8;
      120     2373    4                     CALL FMD$GETBUF(3,1,VID0$);
      121     2374    4                     CALL FMD$GETBUF(4,1,VID$);
      122     2375    4                     J=175;/* NO VOLUMES HERE YET */
      123     2376    4                     CALL READVID0 ALTRET(RETALTREL);
      124     2377    5                     DO J=0 TO VID0.VOLCNT-1;
      125     2378    5                        CALL READVID ALTRET(RETALTREL);
      126     2379    5                        FM$SET.NXTSDA(I)=FM$SET.NXTSDA(I)+VID.SNLIST.SIZE(J);
      127     2380    5                        END;
      128     2381    4                     F$DCB.SETX=I;
      129     2382    4                     FM$SET.SET(I)='1'B;
      130     2383    4                     CALL FMN$RDGRAN(VID$,FM_PADSDA);
      131     2384    4                     VID0$=PINCRW(VID$,SIZEW(FM$GRAN));
      132     2385    4                     CALL FMO$LOCCODP(VID0$,4);
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:5    
      133     2386    4                     FM$SET.GACTIME(I)=CODE04.GAC.TIME;
      134     2387    4                     VID0$=PINCRW(VID$,SIZEW(FM$GRAN));
      135     2388    4                     CALL FMO$LOCCODP(VID0$,14);
      136     2389    4                     FM$SET.GACSHELF(I)=CODE14.ACCESS.GACSHELF;
      137     2390    4                     FM$SET.WRCMP(I)=CODE14.ACCESS.WRCMP|CODE14.ACCESS.WCDATA;
      138     2391    4                     CALL FMD$RELBUF(3);
      139     2392    4                     CALL FMD$RELBUF(4);
      140     2393    4                     IF F$DCB.IASN~=%FMDIAG# THEN CALL FAG$CGRANS;
      141     2394    4                     B$JIT.ERR='0'B;/* CLEAR POSSIBLE ERROR FROM FAG$CGRANS */
      142     2395    4                     CALL FMR$L8;
      143     2396    4                     END;
      144     2397    4                  ELSE IF NOT FM$SET.SET(I) THEN DO;
      145     2398    4                        J=FM$SET.DCTX(I);
      146     2399    4                        IF FM$SET.SYSID(J)~=0 AND FM$SET.SYSID(J)~=B$JIT.SYSID
      147     2400    4                        THEN GOTO FMNE$XCLSET;
      148     2401    4                        CALL FMP$ULIST(FM$SET(J))ALTRET(RETALT);
      149     2402    4                        END;
      150     2403    3            CALL FMP$ULIST(FM$SET(I))ALTRET(RETALT);
      151     2404    3            FM$DEV.AVR(I)='0'B;
      152     2405    3            F$DCB.SETX=I;
      153     2406    3            CALL FMR$U8;
      154     2407    3            RETURN;
      155     2408    3            END;
      156     2409    2         I=FM$SET.SETL(I); /* FLINK */
      157     2410    2         END;
      158     2411    1      I=FM$CFUX.DSETH;
      159     2412    2      IF PSN<=' ' THEN DO WHILE(I~=0);
      160     2413    2         IF PSN=' ' AND FM$DEV.AVR(I) AND B$JIT.SYSID<=JG_PIG#
      161     2414    2         THEN GOTO GOTONE;
      162     2415    2         IF NOT FM$DEV.MIRROR(I) OR FM$DEV.SECTL(I)~=0
      163     2416    2           OR F$DCB.FUN=%IN# OR B$JIT.SYSID=JG_SLUG#
      164     2417    2         THEN IF FM$DEV.VSN(I)~=0
      165     2418    2              AND SUBSTR(PSN,0,4)=ADDR(FM$DEV.VSN(I))->CHAR4
      166     2419    2              OR SUBSTR(PSN,4,2)=IC.DCTX
      167     2420    2            THEN GOTO GOTONE;
      168     2421    2            ELSE IF I=FM$DEV.DCTX(I) THEN IF SUBSTR(PSN,1,4)=
      169     2422    2                    SUBSTR(N$DCT$(I)->NI$DCT.DEVNM,0,4) THEN GOTO GOTONE;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:6    
      170     2423    2         IF FM$VOL.SECTL(I)~=0 THEN I=FM$VOL.SECTL(I);
      171     2424    2         ELSE I=FM$DEV.DEVL(FM$VOL.DCTX(I));
      172     2425    2         END;
      173     2426                    /*E*     ERROR: FMN-E$SETDOWN-E
      174     2427                    *        MESSAGE:Packset% DP#%SN% is not ready to use.
      175     2428                   *        MESSAGE1:Packset% #%SN% is either not up, is use by an exclusive
      176     2429                    *        user, or is waiting for the operator to make it available.
      177     2430                    */
      178     2431    1   FMNE$SETDOWN:B$JIT.ERR=FMN$E$SETDOWN;
      179     2432    1      IF F$DCB.IASN=%DEVICE# AND PSN<=' ' THEN B$JIT.ERR=FMN$E$NOTAUTH;
      180     2433    1      GOTO RETALT;
      181     2434    1   FMNE$XCLSET: B$JIT.ERR=FMN$E$XCLSET;
      182     2435    1   RETALT:;
      183     2436    1      F$DCB.SETX=I;
      184     2437    1      CALL FMR$U8;
      185     2438    1      ALTRETURN;
      186     2439    1   RETALTREL:;
      187     2440    1      VOL=FM$SET.DCTX(I);
      188     2441    2      DO WHILE(VOL~=0);
      189     2442    2         RAT$=N$DCT$(FM$VOL.DCTX(VOL))->NI$DCT.RAT$;
      190     2443    3         IF FR$RAT.RES.SISID=SYSID THEN DO;
      191     2444    3            FR$RAT.FLG.OPN='0'B;
      192     2445    3            FR$RAT.FLG.MBIT='0'B;
      193     2446    3            FR$RAT.REEL.ASID=0;
      194     2447    3            IF FR$RAT.RES.RFLG.OLT THEN CALL FRZ$RRESNA(FR$RAT,MODE);
      195     2448    3            END;
      196     2449    2         VOL=FM$VOL.VOLL(VOL);
      197     2450    2         END;
      198     2451    1      IF J<175 THEN CALL BINCHAR(F$DCB.PSN,VID.VSN);
      199     2452    1      CALL FMD$RELBUF(3);
      200     2453    1      CALL FMD$RELBUF(4);
      201     2454    1      IF FM$SET.DIAGOPN(I) THEN CALL FMP$UDLIST(FM$SET(I));
      202     2455    1      IF B$JIT.ERR='0'B THEN B$JIT.ERR=FMN$E$SETDOWN;
      203     2456    1      ALTRETURN;
      204     2457        %EJECT;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:7    
      205     2458    1   READVID0: PROC ALTRET;
      206     2459    2      MODE=B$JIT.MODE;
      207     2460    2      SYSID=B$JIT.SYSID;
      208     2461    2      VOL=FM$SET.DCTX(I);
      209     2462    2      IF VOL=0 THEN VID.VSN=0;
      210     2463    2      ELSE VID.VSN=FM$VOL.VSN(VOL);
      211     2464    2      FM$SET.NXTSDA(I)=FM_SRZERO;
      212     2465    2      GOTO COMMON;
      213     2466    2   READVID: ENTRY ALTRET;
      214     2467    2      VID.VSN=VID0.SNLIST.VSN.N(J);
      215     2468    2      IF VID.VSN=0 THEN GOTO FMNE$BADVOL;
      216     2469    2      VID.VOLCNT=0;
      217     2470    2   COMMON:;
      218     2471    2      F$DCB.CSEED=VID.VSN;
      219     2472    2      F$DCB.SETX=0;
      220     2473    2      VOL=FM$SET.DCTX(I);
      221     2474    3      DO WHILE(VOL~=0 AND F$DCB.SETX=0);
      222     2475    3         IF J=175 THEN F$DCB.SETX=FM$VOL.DCTX(VOL);
      223     2476    3         ELSE IF FM$DEV.VSN(VOL)=BITBIN(VID0.SNLIST.VSN(J))
      224     2477    3            THEN F$DCB.SETX=FM$VOL.DCTX(VOL);
      225     2478    3            ELSE VOL=FM$VOL.VOLL(VOL);
      226     2479    3         END;
      227     2480    2      IF F$DCB.RESNT.TYP~='DP' THEN F$DCB.RES='DP';
      228     2481    2      IF F$DCB.IASN=%FMDIAG# OR SYSID=JG_SLUG# THEN IF VOL=0 THEN ALTRETURN;
      229     2482    2         ELSE F$DCB.ATTR=N$DCT$(F$DCB.SETX)->NI$DCT.RAT$->FR$RAT.M1;
      230     2483    3      IF VOL=0 THEN DO;
      231     2484    3         CALL FRA$OPR ALTRET(RETALT);
      232     2485                    /* NOW WHERE DID IT APPEAR */
      233     2486    3         VOL=FM$SET.DCTX(I);
      234     2487    4         DO WHILE(VOL~=0 AND FM$VOL.DCTX(VOL)~=F$DCB.SETX);
      235     2488    4            VOL=FM$VOL.VOLL(VOL);
      236     2489    4            END;
      237     2490    3         IF VOL=0 THEN GOTO FMNE$BADVOL;
      238     2491    3         END;
      239     2492    3      ELSE DO;
      240     2493    3         RAT$=N$DCT$(F$DCB.SETX)->NI$DCT.RAT$;
      241     2494    3         IF NOT FR$RAT.FLG.OPN THEN IF FM$VOL.SECT#(VOL)=0
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:8    
      242     2495    3            THEN CALL FRA$OPR ALTRET(RETALT);
      243     2496    4            ELSE IF FR$RAT.RES.SISID=JG_PIG# OR B$JIT.SYSID=JG_SLUG# THEN DO;
      244     2497    4                  FR$RAT.FLG.MBIT.MTD='1'B;
      245     2498    4                  FR$RAT.FLG.OPN='1'B;
      246     2499    4                  END;
      247     2500    3               ELSE GOTO FMNE$SPLITRES;
      248     2501                    /*E*     ERROR: FMN-E$SPLITRES-E
      249     2502                    *        MESSAGE:No DP resource available to mount split set% %UF%.
      250     2503                    *        MESSAGE1:Set% #%UF% occupies a multi-set volume and PIG
      251     2504                    *                 was unable to allocate its resource when it AVR'ed.
      252     2505                    */
      253     2506    3         ELSE IF FR$RAT.RES.SISID~=SYSID AND FM$VOL.SECT#(VOL)=0
      254     2507    3            THEN CALL SC_SETRES;
      255     2508                    /*S*     SCREECH_CODE: FMR-S$SETRES
      256     2509                    *        TYPE: SUA
      257     2510              *        MESSAGE:Another user is using a volume of a properly reserved set.
      258     2511              */
      259     2512    3         END;
      260     2513
      261     2514    2      F$DCB.SETX=VOL;
      262     2515    2      CALL FMN$RDGRAN(VID$,FM_SRZERO);
      263     2516    2      IF J=175 THEN VID0=VID;
      264     2517    3      ELSE DO;
      265     2518    3         IF B$JIT.ERR='0'B THEN
      266     2519    3            IF VID.PSN~=VID0.PSN
      267     2520    3              OR VID.VOLCNT~=VID0.VOLCNT
      268     2521    3              OR VID.SNLIST(0)~=VID0.SNLIST(0)
      269     2522    3              OR VID.SNLIST(J)~=VID0.SNLIST(J)
      270     2523    3              OR VID.SNLIST.SIZE(J)~=FM$SET.NXTSDA(F$DCB.SETX)-FM_SRZERO
      271     2524    3            THEN B$JIT.ERR=FMN$E$BADVOL;
      272     2525                    /*E*     ERROR: FMN-E$BADVOL-E
      273     2526                    *        MESSAGE: Packset volume #%SN is not part of its set.
      274     2527                    */
      275     2528    3         END;
      276     2529    2      FM$VOL.RGRANS(VOL)=0;
      277     2530    2      FM$VOL.GPSDA(VOL)=FM_GPSDA;
      278     2531    2      IF B$JIT.ERR='0'B THEN RETURN;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:9    
      279     2532    2      ALTRETURN;
      280     2533    2   FMNE$BADVOL:B$JIT.ERR=FMN$E$BADVOL;
      281     2534    2      ALTRETURN;
      282     2535    2   FMNE$SPLITRES: B$JIT.ERR=FMN$E$SPLITRES;
      283     2536    2      ALTRETURN;
      284     2537    2   RETALT:;
      285     2538    2      IF B$JIT.ERR.CODE=%E$NORES AND (F$DCB.IASN=%FMDIAG# OR SYSID=JG_SLUG#)
      286     2539    3        OR B$JIT.ERR.CODE=%E$BDATTR AND SYSID=JG_PIG# THEN DO;
      287     2540    3         B$JIT.ERR='0'B;
      288     2541    3         CALL FRZ$GETRES(F$DCB.RES,F$DCB.ATTR,SYSID,
      289     2542    3           MODE,RAT$)ALTRET(RETALT);
      290     2543    3         FR$RAT.RES.RFLG.OLT='1'B;
      291     2544    3         FR$RAT.RES.NUMB=' ';
      292     2545    3         FR$RAT.RES.ACTX=0;
      293     2546    3         GOTO COMMON;
      294     2547    3         END;
      295     2548    2      ALTRETURN;
      296     2549    2   END READVID0;
      297     2550    1   END FMN$SETX;
      298     2551        %EOD;

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:10   
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMN$SETX.

   Procedure FMN$SETX requires 769 words for executable code.
   Procedure FMN$SETX requires 22 words of local(AUTO) storage.

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:11   

 Object Unit name= FMN$SETX                                   File name= FMN$OPNDP.:E05TOU
 UTS= JUL 29 '97 16:52:02.56 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      6      6  FMN$SETX
    1   Proc  even  none   769   1401  FMN$SETX
    2  RoData even  none    13     15  FMN$SETX

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  FMN$SETX
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:12   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FMR$L8
         yes           Std       3 FMD$GETBUF
 yes     yes           Std       2 FMO$LOCCODP
         yes           Std       1 FMD$RELBUF
 yes     yes           Std       2 FMP$UDLIST
 yes     yes           Std       0 FAG$CGRANS
 yes     yes           Std       2 FMN$RDGRAN
         yes           Std       0 FMR$U8
 yes     yes           Std       2 FMP$ULIST
         yes           Std       2 FRZ$RRESNA
 yes     yes           Std       0 FRA$OPR
 yes     yes           Std       5 FRZ$GETRES
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_SETRES                             B$JIT$                                FM$SET$
     F$CFU$                                N$DCT$$                               FM_SRZERO
     FM_PADSDA                             FM_GPSDA                              B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:13   


        1        1        /*M*  FMN$OPNDP - Open routines for access to pack(set)s.  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9                    /*F*     NAME: FMN$SETX
       10       10                    *        PURPOSE: To put a non-zero into DCB.SETX if PSN isnt blank
       11       11                    *        or after a MAD search. Input parameter is a 6-char psn to find
       12       12                    *        in FM$SET. If up for another user or not up, FMN$SETX altrets.
       13       13                    */
       14       14        FMN$SETX: PROC(PSN) ALTRET;

     14  1 000000   000000 700200 xent  FMN$SETX     TSX0  ! X66_AUTO_1
         1 000001   000026 000001                    ZERO    22,1

       15       15        %INCLUDE F$JIT_C;
       16      445        %MACRO F$DCB#(BASED=BASED);
       17      446        %INCLUDE F$DCB;
       18      495        %MEND;
       19      496        %F$DCB#(BASED="BASED(JDCB$)");
       20      546        %INCLUDE FM$MACROS;
       21      921        %FM$SET(BASED="BASED(FM$SET$)");
       22      926        %FM$DEV(BASED="BASED(FM$SET$)");
       23      932        %FM$VOL(BASED="BASED(FM$SET$)");
       24      938        %FM$CFUX;
       25      943        %FM$VID(FM$VID=VID,BASED="BASED(VID$)");
       26      949        %FM$VID(FM$VID=VID0,BASED="BASED(VID0$)");
       27      955        %CODE04(BASED="BASED(VID0$)");
       28      963        %CODE14(BASED="BASED(VID0$)");
       29      973        %FM$GRAN;
       30      977        %INCLUDE FR$RAT;
       31     1030        %FR$RAT(STCLASS="BASED(RAT$)");
       32     1070        %INCLUDE NI$TABLES;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:14   
       33     1286        %NI$DCT;
       34     1334        %INCLUDE F_ERRORS_C;
       35     1574        %INCLUDE FR_ERRORS_C;
       36     1605        %INCLUDE UD_ERRORS_C;
       37     1647        %INCLUDE CP_6_SUBS;
       38     2187        %INCLUDE JG_GHOSTS_C;
       39     2277        %SUB FCG#='0615'O;
       40     2278        %SUB MID#='16'O;
       41     2279        %ERRCODE(NAME=FMN$E$XCLSET,COD#=%E$XCLSET);
       42     2283        %ERRCODE(NAME=FMN$E$SETDOWN,COD#=%E$SETDOWN);
       43     2287        %ERRCODE(NAME=FMN$E$BADVOL,COD#=%E$BADVOL);
       44     2291        %ERRCODE(NAME=FMN$E$NOTAUTH,COD#=%E$NOTAUTH);
       45     2295        %ERRCODE(NAME=FMN$E$SPLITRES,COD#=%E$SPLITRES);
       46     2299                    /**/
       47     2300                    /* AUTO/PARAM DATA */
       48     2301                    /**/
       49     2302    1   DCL PSN CHAR(6); /* INPUT PSN */
       50     2303    1   DCL I UBIN; /* INDEX TO SET TABLES */
       51     2304    1   DCL 1 IC REDEF I,
       52     2305    1         2 * BIT(18),
       53     2306    1         2 DCTX CHAR(2);
       54     2307    1   DCL JDCB$ PTR;
       55     2308    1   DCL J UBIN;
       56     2309    1   DCL VID$ PTR;
       57     2310    1   DCL VID0$ PTR;
       58     2311    1   DCL VOL UBIN;
       59     2312    1   DCL RAT$ PTR;
       60     2313    1   DCL SYSID UBIN;
       61     2314    1   DCL MODE UBIN;
       62     2315                    /**/
       63     2316                    /* SYMREF */
       64     2317                    /**/
       65     2318    1   DCL B$JIT$ SYMREF PTR;
       66     2319    1   DCL FM$SET$ SYMREF PTR;
       67     2320    1   DCL F$CFU$ PTR SYMREF;
       68     2321    1   DCL N$DCT$$ PTR SYMREF;
       69     2322    1   DCL N$DCT$(0:0)BASED(N$DCT$$)PTR;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:15   
       70     2323    1   DCL FM_SRZERO UBIN SYMREF;
       71     2324    1   DCL FM_PADSDA UBIN SYMREF;
       72     2325    1   DCL FM_GPSDA UBIN SYMREF;
       73     2326                    /**/
       74     2327                    /**/
       75     2328                    /* ENTREFS */
       76     2329                    /**/
       77     2330    1   DCL FAG$CGRANS ENTRY ALTRET;
       78     2331    1   DCL FMD$GETBUF ENTRY(3);
       79     2332    1   DCL FMD$RELBUF ENTRY(1);
       80     2333    1   DCL FMN$RDGRAN ENTRY(2)ALTRET;
       81     2334    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
       82     2335    1   DCL FMR$L8 ENTRY;
       83     2336    1   DCL FMR$U8 ENTRY;
       84     2337    1   DCL FMP$ULIST ENTRY(2)ALTRET;
       85     2338    1   DCL FMP$UDLIST ENTRY(2)ALTRET;
       86     2339    1   DCL FRA$OPR ENTRY ALTRET;
       87     2340    1   DCL FRZ$GETRES ENTRY(5)ALTRET;
       88     2341    1   DCL FRZ$RRES ENTRY(2);
       89     2342    1   DCL FRZ$RRESNA ENTRY(2);
       90     2343    1   DCL SC_SETRES ENTRY CONV(2,0);
       91     2344                    /**/
       92     2345                    /* BASED */
       93     2346                    /**/
       94     2347    1   DCL CHAR4 CHAR(4) BASED;
       95     2348        %EJECT;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:16   
       96     2349                    /**/
       97     2350                    /* PROCEDUER */
       98     2351                    /**/
       99     2352    1      JDCB$=B$JIT.DCB$;

   2352  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200005 756100                    STQ     JDCB$,,AUTO

      100     2353    1      F$DCB.SETX=0;

   2353  1 000005   000000 220003                    LDX0    0,DU
         1 000006   200005 471500                    LDP1    JDCB$,,AUTO
         1 000007   100051 440100                    SXL0    41,,PR1

      101     2354    1      CALL FMR$L8;

   2354  1 000010   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000011   000000 701000 xent               TSX1    FMR$L8
         1 000012   000000 011000                    NOP     0

      102     2355    1      I=FM$CFUX.SETH;

   2355  1 000013   000000 470400 xsym               LDP0    F$CFU$
         1 000014   000005 236100                    LDQ     5,,PR0
         1 000015   000022 772000                    QRL     18
         1 000016   200004 756100                    STQ     I,,AUTO

      103     2356    2      IF PSN>' ' THEN DO WHILE(I~=0);

   2356  1 000017   200003 471500                    LDP1    @PSN,,AUTO
         1 000020   040100 106400                    CMPC    fill='040'O
         1 000021   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000022   100000 000006                    ADSC9   0,,PR1                   cn=0,n=6
         1 000023   000402 603000 1                  TRC     s:2411

   2356  1 000024   000000 116003                    CMPQ    0,DU
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:17   
         1 000025   000402 600000 1                  TZE     s:2411

      104     2357    3         IF FM$SET.PSN(I)=PSN THEN DO;

   2357  1 000026   200004 235100                    LDA     I,,AUTO
         1 000027   000005 735000                    ALS     5
         1 000030   000000 470400 xsym               LDP0    FM$SET$
         1 000031   200003 471500                    LDP1    @PSN,,AUTO
         1 000032   040100 106505                    CMPC    fill='040'O
         1 000033   000000 400006                    ADSC9   0,A,PR0                  cn=2,n=6
         1 000034   100000 000006                    ADSC9   0,,PR1                   cn=0,n=6
         1 000035   000374 601000 1                  TNZ     s:2409

      105     2358    3   GOTONE:  ;

   2358  1 000036                       GOTONE       null
      106     2359    3            IF FM$SET.XCL(I) THEN IF FM$SET.SYSID(I)~=B$JIT.SYSID

   2359  1 000036   200004 235100                    LDA     I,,AUTO
         1 000037   000003 735000                    ALS     3
         1 000040   000000 470400 xsym               LDP0    FM$SET$
         1 000041   000002 234105                    SZN     2,AL,PR0
         1 000042   000350 605000 1                  TPL     s:2403

   2359  1 000043   000000 471400 xsym               LDP1    B$JIT$
         1 000044   000002 236105                    LDQ     2,AL,PR0
         1 000045   100000 676100                    ERQ     0,,PR1
         1 000046   777777 376007                    ANQ     -1,DL
         1 000047   000065 600000 1                  TZE     s:2367
         1 000050   000002 720105                    LXL0    2,AL,PR0
         1 000051   000062 601000 1                  TNZ     s:2362
         1 000052   200005 473500                    LDP3    JDCB$,,AUTO
         1 000053   300103 236100                    LDQ     67,,PR3
         1 000054   000777 376007                    ANQ     511,DL
         1 000055   000007 116007                    CMPQ    7,DL
         1 000056   000065 600000 1                  TZE     s:2367
         1 000057   100000 721100                    LXL1    0,,PR1
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:18   
         1 000060   000001 101003                    CMPX1   1,DU
         1 000061   000065 600000 1                  TZE     s:2367

      107     2360    3                 AND (FM$SET.SYSID(I)~=0
      108     2361    3                 OR F$DCB.IASN~=%FMDIAG# AND B$JIT.SYSID~=JG_SLUG#)
      109     2362    3               THEN IF FM$SET.SYSID(I)=0 THEN GOTO FMNE$SETDOWN;

   2362  1 000062   000000 100003                    CMPX0   0,DU
         1 000063   000522 600000 1                  TZE     FMNE$SETDOWN

      110     2363    3                  ELSE GOTO FMNE$XCLSET;

   2363  1 000064   000542 710000 1                  TRA     FMNE$XCLSET

      111     2364                    /*E*     ERROR: FMN-E$XCLSET-E
      112     2365                    *         MESSAGE: Packset %DP#%SN %is busy
      113     2366                    */
      114     2367    3               ELSE IF NOT FM$SET.SET(I) AND

   2367  1 000065   000002 236105                    LDQ     2,AL,PR0
         1 000066   200000 316003                    CANQ    65536,DU
         1 000067   000322 601000 1                  TNZ     s:2397
         1 000070   000000 236105                    LDQ     0,AL,PR0
         1 000071   000017 772000                    QRL     15
         1 000072   000000 376000 2                  ANQ     0
         1 000073   000000 220105                    LDX0    0,AL,PR0
         1 000074   000000 100106                    CMPX0   0,QL,PR0
         1 000075   000322 600000 1                  TZE     s:2397

      115     2368    4                    FM$SET.DCTX(I)~=FM$SET.DCTX(FM$SET.DCTX(I)) THEN DO;

      116     2369    4                     FM$SET.ONEU(I)='1'B;

   2369  1 000076   000001 236003                    LDQ     1,DU
         1 000077   000002 256105                    ORSQ    2,AL,PR0

      117     2370    4                     IF FM$SET.SYSID(I)=0 THEN FM$SET.DIAGOPN(I)='1'B;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:19   

   2370  1 000100   000000 470400 xsym               LDP0    FM$SET$
         1 000101   000002 720105                    LXL0    2,AL,PR0
         1 000102   000105 601000 1                  TNZ     s:2371

   2370  1 000103   004000 236003                    LDQ     2048,DU
         1 000104   000002 256105                    ORSQ    2,AL,PR0

      118     2371    4                     FM$SET.SYSID(I)=B$JIT.SYSID;

   2371  1 000105   000000 470400 xsym               LDP0    B$JIT$
         1 000106   000000 720100                    LXL0    0,,PR0
         1 000107   000000 471400 xsym               LDP1    FM$SET$
         1 000110   100002 440105                    SXL0    2,AL,PR1

      119     2372    4                     CALL FMR$U8;

   2372  1 000111   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000112   000000 701000 xent               TSX1    FMR$U8
         1 000113   000000 011000                    NOP     0

      120     2373    4                     CALL FMD$GETBUF(3,1,VID0$);

   2373  1 000114   200010 630500                    EPPR0   VID0$,,AUTO
         1 000115   200022 450500                    STP0    MODE+6,,AUTO
         1 000116   000002 237000 2                  LDAQ    2
         1 000117   200020 757100                    STAQ    MODE+4,,AUTO
         1 000120   200020 630500                    EPPR0   MODE+4,,AUTO
         1 000121   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000122   000000 701000 xent               TSX1    FMD$GETBUF
         1 000123   000000 011000                    NOP     0

      121     2374    4                     CALL FMD$GETBUF(4,1,VID$);

   2374  1 000124   200007 630500                    EPPR0   VID$,,AUTO
         1 000125   200022 450500                    STP0    MODE+6,,AUTO
         1 000126   000004 237000 2                  LDAQ    4
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:20   
         1 000127   200020 757100                    STAQ    MODE+4,,AUTO
         1 000130   200020 630500                    EPPR0   MODE+4,,AUTO
         1 000131   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000132   000000 701000 xent               TSX1    FMD$GETBUF
         1 000133   000000 011000                    NOP     0

      122     2375    4                     J=175;/* NO VOLUMES HERE YET */

   2375  1 000134   000257 235007                    LDA     175,DL
         1 000135   200006 755100                    STA     J,,AUTO

      123     2376    4                     CALL READVID0 ALTRET(RETALTREL);

   2376  1 000136   000702 701000 1                  TSX1    READVID0
         1 000137   000553 702000 1                  TSX2    RETALTREL

      124     2377    5                     DO J=0 TO VID0.VOLCNT-1;

   2377  1 000140   200006 450100                    STZ     J,,AUTO
         1 000141   000164 710000 1                  TRA     s:2380+3

      125     2378    5                        CALL READVID ALTRET(RETALTREL);

   2378  1 000142   000741 701000 1                  TSX1    READVID
         1 000143   000553 702000 1                  TSX2    RETALTREL

      126     2379    5                        FM$SET.NXTSDA(I)=FM$SET.NXTSDA(I)+VID.SNLIST.SIZE(J);

   2379  1 000144   200004 235100                    LDA     I,,AUTO
         1 000145   000003 735000                    ALS     3
         1 000146   200006 236100                    LDQ     J,,AUTO
         1 000147   000002 736000                    QLS     2
         1 000150   200007 470500                    LDP0    VID$,,AUTO
         1 000151   000000 620006                    EAX0    0,QL
         1 000152   000000 471400 xsym               LDP1    FM$SET$
         1 000153   100003 236105                    LDQ     3,AL,PR1
         1 000154   000032 376000 xsym               ANQ     B_VECTNIL+26
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:21   
         1 000155   000501 036110                    ADLQ    321,X0,PR0
         1 000156   100003 676105                    ERQ     3,AL,PR1
         1 000157   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000160   100003 656105                    ERSQ    3,AL,PR1

      127     2380    5                        END;

   2380  1 000161   200006 236100                    LDQ     J,,AUTO
         1 000162   000001 036007                    ADLQ    1,DL
         1 000163   200006 756100                    STQ     J,,AUTO
         1 000164   200010 470500                    LDP0    VID0$,,AUTO
         1 000165   000004 236100                    LDQ     4,,PR0
         1 000166   777777 376007                    ANQ     -1,DL
         1 000167   200006 116100                    CMPQ    J,,AUTO
         1 000170   000172 600000 1                  TZE     s:2381
         1 000171   000142 603000 1                  TRC     s:2378

      128     2381    4                     F$DCB.SETX=I;

   2381  1 000172   200004 720100                    LXL0    I,,AUTO
         1 000173   200005 471500                    LDP1    JDCB$,,AUTO
         1 000174   100051 440100                    SXL0    41,,PR1

      129     2382    4                     FM$SET.SET(I)='1'B;

   2382  1 000175   200004 235100                    LDA     I,,AUTO
         1 000176   000003 735000                    ALS     3
         1 000177   000000 473400 xsym               LDP3    FM$SET$
         1 000200   200000 236003                    LDQ     65536,DU
         1 000201   300002 256105                    ORSQ    2,AL,PR3

      130     2383    4                     CALL FMN$RDGRAN(VID$,FM_PADSDA);

   2383  1 000202   000001 236000 2                  LDQ     1
         1 000203   200021 756100                    STQ     MODE+5,,AUTO
         1 000204   200007 630500                    EPPR0   VID$,,AUTO
         1 000205   200020 450500                    STP0    MODE+4,,AUTO
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:22   
         1 000206   200020 630500                    EPPR0   MODE+4,,AUTO
         1 000207   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000210   000000 701000 xent               TSX1    FMN$RDGRAN
         1 000211   000000 011000                    NOP     0

      131     2384    4                     VID0$=PINCRW(VID$,SIZEW(FM$GRAN));

   2384  1 000212   200007 236100                    LDQ     VID$,,AUTO
         1 000213   000005 036003                    ADLQ    5,DU
         1 000214   200010 756100                    STQ     VID0$,,AUTO

      132     2385    4                     CALL FMO$LOCCODP(VID0$,4);

   2385  1 000215   000004 236000 2                  LDQ     4
         1 000216   200021 756100                    STQ     MODE+5,,AUTO
         1 000217   200010 630500                    EPPR0   VID0$,,AUTO
         1 000220   200020 450500                    STP0    MODE+4,,AUTO
         1 000221   200020 630500                    EPPR0   MODE+4,,AUTO
         1 000222   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000223   000000 701000 xent               TSX1    FMO$LOCCODP
         1 000224   000000 011000                    NOP     0

      133     2386    4                     FM$SET.GACTIME(I)=CODE04.GAC.TIME;

   2386  1 000225   200004 235100                    LDA     I,,AUTO
         1 000226   000003 735000                    ALS     3
         1 000227   200010 470500                    LDP0    VID0$,,AUTO
         1 000230   000000 471400 xsym               LDP1    FM$SET$
         1 000231   000000 620005                    EAX0    0,AL
         1 000232   000012 235100                    LDA     10,,PR0
         1 000233   100004 755110                    STA     4,X0,PR1

      134     2387    4                     VID0$=PINCRW(VID$,SIZEW(FM$GRAN));

   2387  1 000234   200007 236100                    LDQ     VID$,,AUTO
         1 000235   000005 036003                    ADLQ    5,DU
         1 000236   200010 756100                    STQ     VID0$,,AUTO
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:23   

      135     2388    4                     CALL FMO$LOCCODP(VID0$,14);

   2388  1 000237   000007 236000 2                  LDQ     7
         1 000240   200021 756100                    STQ     MODE+5,,AUTO
         1 000241   200010 630500                    EPPR0   VID0$,,AUTO
         1 000242   200020 450500                    STP0    MODE+4,,AUTO
         1 000243   200020 630500                    EPPR0   MODE+4,,AUTO
         1 000244   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000245   000000 701000 xent               TSX1    FMO$LOCCODP
         1 000246   000000 011000                    NOP     0

      136     2389    4                     FM$SET.GACSHELF(I)=CODE14.ACCESS.GACSHELF;

   2389  1 000247   200004 235100                    LDA     I,,AUTO
         1 000250   000003 735000                    ALS     3
         1 000251   000000 470400 xsym               LDP0    FM$SET$
         1 000252   200010 471500                    LDP1    VID0$,,AUTO
         1 000253   100000 236100                    LDQ     0,,PR1
         1 000254   000002 676105                    ERQ     2,AL,PR0
         1 000255   000002 376003                    ANQ     2,DU
         1 000256   000002 656105                    ERSQ    2,AL,PR0

      137     2390    4                     FM$SET.WRCMP(I)=CODE14.ACCESS.WRCMP|CODE14.ACCESS.WCDATA;

   2390  1 000257   200010 470500                    LDP0    VID0$,,AUTO
         1 000260   000000 236100                    LDQ     0,,PR0
         1 000261   400000 376003                    ANQ     -131072,DU
         1 000262   200020 756100                    STQ     MODE+4,,AUTO
         1 000263   000000 236100                    LDQ     0,,PR0
         1 000264   000002 736000                    QLS     2
         1 000265   400000 376003                    ANQ     -131072,DU
         1 000266   200020 276100                    ORQ     MODE+4,,AUTO
         1 000267   000000 471400 xsym               LDP1    FM$SET$
         1 000270   000002 772000                    QRL     2
         1 000271   100002 676105                    ERQ     2,AL,PR1
         1 000272   100000 376003                    ANQ     32768,DU
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:24   
         1 000273   100002 656105                    ERSQ    2,AL,PR1

      138     2391    4                     CALL FMD$RELBUF(3);

   2391  1 000274   000002 630400 2                  EPPR0   2
         1 000275   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000276   000000 701000 xent               TSX1    FMD$RELBUF
         1 000277   000000 011000                    NOP     0

      139     2392    4                     CALL FMD$RELBUF(4);

   2392  1 000300   000004 630400 2                  EPPR0   4
         1 000301   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000302   000000 701000 xent               TSX1    FMD$RELBUF
         1 000303   000000 011000                    NOP     0

      140     2393    4                     IF F$DCB.IASN~=%FMDIAG# THEN CALL FAG$CGRANS;

   2393  1 000304   200005 470500                    LDP0    JDCB$,,AUTO
         1 000305   000103 236100                    LDQ     67,,PR0
         1 000306   000777 376007                    ANQ     511,DL
         1 000307   000007 116007                    CMPQ    7,DL
         1 000310   000314 600000 1                  TZE     s:2394

   2393  1 000311   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000312   000000 701000 xent               TSX1    FAG$CGRANS
         1 000313   000000 011000                    NOP     0

      141     2394    4                     B$JIT.ERR='0'B;/* CLEAR POSSIBLE ERROR FROM FAG$CGRANS */

   2394  1 000314   000000 470400 xsym               LDP0    B$JIT$
         1 000315   000012 450100                    STZ     10,,PR0

      142     2395    4                     CALL FMR$L8;

   2395  1 000316   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000317   000000 701000 xent               TSX1    FMR$L8
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:25   
         1 000320   000000 011000                    NOP     0

      143     2396    4                     END;

   2396  1 000321   000350 710000 1                  TRA     s:2403

      144     2397    4                  ELSE IF NOT FM$SET.SET(I) THEN DO;

   2397  1 000322   000002 236105                    LDQ     2,AL,PR0
         1 000323   200000 316003                    CANQ    65536,DU
         1 000324   000350 601000 1                  TNZ     s:2403

      145     2398    4                        J=FM$SET.DCTX(I);

   2398  1 000325   000000 236105                    LDQ     0,AL,PR0
         1 000326   000022 772000                    QRL     18
         1 000327   200006 756100                    STQ     J,,AUTO

      146     2399    4                        IF FM$SET.SYSID(J)~=0 AND FM$SET.SYSID(J)~=B$JIT.SYSID

   2399  1 000330   200006 235100                    LDA     J,,AUTO
         1 000331   000003 735000                    ALS     3
         1 000332   000002 720105                    LXL0    2,AL,PR0
         1 000333   000340 600000 1                  TZE     s:2401
         1 000334   000002 236105                    LDQ     2,AL,PR0
         1 000335   100000 676100                    ERQ     0,,PR1
         1 000336   777777 376007                    ANQ     -1,DL
         1 000337   000542 601000 1                  TNZ     FMNE$XCLSET

      147     2400    4                        THEN GOTO FMNE$XCLSET;
      148     2401    4                        CALL FMP$ULIST(FM$SET(J))ALTRET(RETALT);

   2401  1 000340   200006 236100                    LDQ     J,,AUTO
         1 000341   000025 736000                    QLS     21
         1 000342   000000 036000 xsym               ADLQ    FM$SET$
         1 000343   200020 756100                    STQ     MODE+4,,AUTO
         1 000344   200020 630500                    EPPR0   MODE+4,,AUTO
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:26   
         1 000345   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000346   000000 701000 xent               TSX1    FMP$ULIST
         1 000347   000544 702000 1                  TSX2    RETALT

      149     2402    4                        END;

      150     2403    3            CALL FMP$ULIST(FM$SET(I))ALTRET(RETALT);

   2403  1 000350   200004 236100                    LDQ     I,,AUTO
         1 000351   000025 736000                    QLS     21
         1 000352   000000 036000 xsym               ADLQ    FM$SET$
         1 000353   200020 756100                    STQ     MODE+4,,AUTO
         1 000354   200020 630500                    EPPR0   MODE+4,,AUTO
         1 000355   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000356   000000 701000 xent               TSX1    FMP$ULIST
         1 000357   000544 702000 1                  TSX2    RETALT

      151     2404    3            FM$DEV.AVR(I)='0'B;

   2404  1 000360   200004 235100                    LDA     I,,AUTO
         1 000361   000003 735000                    ALS     3
         1 000362   000000 470400 xsym               LDP0    FM$SET$
         1 000363   000010 236000 2                  LDQ     8
         1 000364   000002 356105                    ANSQ    2,AL,PR0

      152     2405    3            F$DCB.SETX=I;

   2405  1 000365   200004 720100                    LXL0    I,,AUTO
         1 000366   200005 470500                    LDP0    JDCB$,,AUTO
         1 000367   000051 440100                    SXL0    41,,PR0

      153     2406    3            CALL FMR$U8;

   2406  1 000370   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000371   000000 701000 xent               TSX1    FMR$U8
         1 000372   000000 011000                    NOP     0

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:27   
      154     2407    3            RETURN;

   2407  1 000373   000000 702200 xent               TSX2  ! X66_ARET

      155     2408    3            END;
      156     2409    2         I=FM$SET.SETL(I); /* FLINK */

   2409  1 000374   200004 236100                    LDQ     I,,AUTO
         1 000375   000003 736000                    QLS     3
         1 000376   000005 236106                    LDQ     5,QL,PR0
         1 000377   000022 772000                    QRL     18
         1 000400   200004 756100                    STQ     I,,AUTO

      157     2410    2         END;

   2410  1 000401   000026 601000 1                  TNZ     s:2357

      158     2411    1      I=FM$CFUX.DSETH;

   2411  1 000402   000000 470400 xsym               LDP0    F$CFU$
         1 000403   000005 236100                    LDQ     5,,PR0
         1 000404   777777 376007                    ANQ     -1,DL
         1 000405   200004 756100                    STQ     I,,AUTO

      159     2412    2      IF PSN<=' ' THEN DO WHILE(I~=0);

   2412  1 000406   040100 106400                    CMPC    fill='040'O
         1 000407   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000410   100000 000006                    ADSC9   0,,PR1                   cn=0,n=6
         1 000411   000522 602000 1                  TNC     FMNE$SETDOWN

   2412  1 000412   000000 116003                    CMPQ    0,DU
         1 000413   000522 600000 1                  TZE     FMNE$SETDOWN

      160     2413    2         IF PSN=' ' AND FM$DEV.AVR(I) AND B$JIT.SYSID<=JG_PIG#

   2413  1 000414   200003 470500                    LDP0    @PSN,,AUTO
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:28   
         1 000415   040000 106500                    CMPC    fill='040'O
         1 000416   000000 000006                    ADSC9   0,,PR0                   cn=0,n=6
         1 000417   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000420   000433 601000 1                  TNZ     s:2415
         1 000421   200004 235100                    LDA     I,,AUTO
         1 000422   000003 735000                    ALS     3
         1 000423   000000 471400 xsym               LDP1    FM$SET$
         1 000424   100002 236105                    LDQ     2,AL,PR1
         1 000425   010000 316003                    CANQ    4096,DU
         1 000426   000433 600000 1                  TZE     s:2415
         1 000427   000000 473400 xsym               LDP3    B$JIT$
         1 000430   300000 720100                    LXL0    0,,PR3
         1 000431   000010 100003                    CMPX0   8,DU
         1 000432   000036 602000 1                  TNC     GOTONE

      161     2414    2         THEN GOTO GOTONE;
      162     2415    2         IF NOT FM$DEV.MIRROR(I) OR FM$DEV.SECTL(I)~=0

   2415  1 000433   200004 235100                    LDA     I,,AUTO
         1 000434   000003 735000                    ALS     3
         1 000435   000000 471400 xsym               LDP1    FM$SET$
         1 000436   100002 236105                    LDQ     2,AL,PR1
         1 000437   002000 316003                    CANQ    1024,DU
         1 000440   000454 600000 1                  TZE     s:2417
         1 000441   100005 720105                    LXL0    5,AL,PR1
         1 000442   000454 601000 1                  TNZ     s:2417
         1 000443   200005 473500                    LDP3    JDCB$,,AUTO
         1 000444   300032 236100                    LDQ     26,,PR3
         1 000445   000777 376003                    ANQ     511,DU
         1 000446   000002 116003                    CMPQ    2,DU
         1 000447   000454 600000 1                  TZE     s:2417
         1 000450   000000 474400 xsym               LDP4    B$JIT$
         1 000451   400000 721100                    LXL1    0,,PR4
         1 000452   000001 101003                    CMPX1   1,DU
         1 000453   000505 601000 1                  TNZ     s:2423

      163     2416    2           OR F$DCB.FUN=%IN# OR B$JIT.SYSID=JG_SLUG#
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:29   
      164     2417    2         THEN IF FM$DEV.VSN(I)~=0

   2417  1 000454   100001 235105                    LDA     1,AL,PR1
         1 000455   000464 600000 1                  TZE     s:2417+8
         1 000456   200004 235100                    LDA     I,,AUTO
         1 000457   000005 735000                    ALS     5
         1 000460   040105 106500                    CMPC    fill='040'O
         1 000461   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000462   100001 000004                    ADSC9   1,A,PR1                  cn=0,n=4
         1 000463   000036 600000 1                  TZE     GOTONE
         1 000464   040100 106500                    CMPC    fill='040'O
         1 000465   000001 000002                    ADSC9   1,,PR0                   cn=0,n=2
         1 000466   200004 400002                    ADSC9   I,,AUTO                  cn=2,n=2
         1 000467   000036 600000 1                  TZE     GOTONE

      165     2418    2              AND SUBSTR(PSN,0,4)=ADDR(FM$DEV.VSN(I))->CHAR4
      166     2419    2              OR SUBSTR(PSN,4,2)=IC.DCTX
      167     2420    2            THEN GOTO GOTONE;
      168     2421    2            ELSE IF I=FM$DEV.DCTX(I) THEN IF SUBSTR(PSN,1,4)=

   2421  1 000470   200004 235100                    LDA     I,,AUTO
         1 000471   000003 735000                    ALS     3
         1 000472   100000 236105                    LDQ     0,AL,PR1
         1 000473   000022 772000                    QRL     18
         1 000474   200004 116100                    CMPQ    I,,AUTO
         1 000475   000505 601000 1                  TNZ     s:2423

   2421  1 000476   000000 473400 xsym               LDP3    N$DCT$$
         1 000477   200004 720100                    LXL0    I,,AUTO
         1 000500   300000 474510                    LDP4    0,X0,PR3
         1 000501   040100 106500                    CMPC    fill='040'O
         1 000502   000000 200004                    ADSC9   0,,PR0                   cn=1,n=4
         1 000503   400002 000004                    ADSC9   2,,PR4                   cn=0,n=4
         1 000504   000036 600000 1                  TZE     GOTONE

      169     2422    2                    SUBSTR(N$DCT$(I)->NI$DCT.DEVNM,0,4) THEN GOTO GOTONE;
      170     2423    2         IF FM$VOL.SECTL(I)~=0 THEN I=FM$VOL.SECTL(I);
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:30   

   2423  1 000505   100005 720105                    LXL0    5,AL,PR1
         1 000506   000513 600000 1                  TZE     s:2424

   2423  1 000507   100005 236105                    LDQ     5,AL,PR1
         1 000510   777777 376007                    ANQ     -1,DL
         1 000511   200004 756100                    STQ     I,,AUTO
         1 000512   000521 710000 1                  TRA     s:2425

      171     2424    2         ELSE I=FM$DEV.DEVL(FM$VOL.DCTX(I));

   2424  1 000513   100000 236105                    LDQ     0,AL,PR1
         1 000514   000017 772000                    QRL     15
         1 000515   000000 376000 2                  ANQ     0
         1 000516   100005 236106                    LDQ     5,QL,PR1
         1 000517   000022 772000                    QRL     18
         1 000520   200004 756100                    STQ     I,,AUTO

      172     2425    2         END;

   2425  1 000521   000414 601000 1                  TNZ     s:2413

      173     2426                    /*E*     ERROR: FMN-E$SETDOWN-E
      174     2427                    *        MESSAGE:Packset% DP#%SN% is not ready to use.
      175     2428                   *       MESSAGE1:Packset% #%SN% is either not up, is use by an exclusive
      176     2429                    *        user, or is waiting for the operator to make it available.
      177     2430                    */
      178     2431    1   FMNE$SETDOWN:B$JIT.ERR=FMN$E$SETDOWN;

   2431  1 000522   000001 236000 0     FMNE$SETDOWN LDQ     FMN$E$SETDOWN
         1 000523   000000 470400 xsym               LDP0    B$JIT$
         1 000524   000012 756100                    STQ     10,,PR0

      179     2432    1      IF F$DCB.IASN=%DEVICE# AND PSN<=' ' THEN B$JIT.ERR=FMN$E$NOTAUTH;

   2432  1 000525   200005 471500                    LDP1    JDCB$,,AUTO
         1 000526   100103 236100                    LDQ     67,,PR1
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:31   
         1 000527   000777 376007                    ANQ     511,DL
         1 000530   000003 116007                    CMPQ    3,DL
         1 000531   000541 601000 1                  TNZ     s:2433
         1 000532   200003 473500                    LDP3    @PSN,,AUTO
         1 000533   040100 106400                    CMPC    fill='040'O
         1 000534   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000535   300000 000006                    ADSC9   0,,PR3                   cn=0,n=6
         1 000536   000541 602000 1                  TNC     s:2433

   2432  1 000537   000003 236000 0                  LDQ     FMN$E$NOTAUTH
         1 000540   000012 756100                    STQ     10,,PR0

      180     2433    1      GOTO RETALT;

   2433  1 000541   000544 710000 1                  TRA     RETALT

      181     2434    1   FMNE$XCLSET: B$JIT.ERR=FMN$E$XCLSET;

   2434  1 000542   000000 236000 0     FMNE$XCLSET  LDQ     FMN$E$XCLSET
         1 000543   100012 756100                    STQ     10,,PR1

   2432  1 000544                       RETALT       null
      182     2435    1   RETALT:;
      183     2436    1      F$DCB.SETX=I;

   2436  1 000544   200004 720100                    LXL0    I,,AUTO
         1 000545   200005 470500                    LDP0    JDCB$,,AUTO
         1 000546   000051 440100                    SXL0    41,,PR0

      184     2437    1      CALL FMR$U8;

   2437  1 000547   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000550   000000 701000 xent               TSX1    FMR$U8
         1 000551   000000 011000                    NOP     0

      185     2438    1      ALTRETURN;

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:32   
   2438  1 000552   000000 702200 xent               TSX2  ! X66_AALT

   2436  1 000553                       RETALTREL    null
      186     2439    1   RETALTREL:;
      187     2440    1      VOL=FM$SET.DCTX(I);

   2440  1 000553   200004 235100                    LDA     I,,AUTO
         1 000554   000003 735000                    ALS     3
         1 000555   000000 470400 xsym               LDP0    FM$SET$
         1 000556   000000 236105                    LDQ     0,AL,PR0
         1 000557   000022 772000                    QRL     18
         1 000560   200011 756100                    STQ     VOL,,AUTO

      188     2441    2      DO WHILE(VOL~=0);

   2441  1 000561   000633 600000 1                  TZE     s:2451

      189     2442    2         RAT$=N$DCT$(FM$VOL.DCTX(VOL))->NI$DCT.RAT$;

   2442  1 000562   200011 235100                    LDA     VOL,,AUTO
         1 000563   000003 735000                    ALS     3
         1 000564   000000 470400 xsym               LDP0    FM$SET$
         1 000565   000000 220105                    LDX0    0,AL,PR0
         1 000566   000000 471400 xsym               LDP1    N$DCT$$
         1 000567   100000 473510                    LDP3    0,X0,PR1
         1 000570   300005 236100                    LDQ     5,,PR3
         1 000571   200012 756100                    STQ     RAT$,,AUTO

      190     2443    3         IF FR$RAT.RES.SISID=SYSID THEN DO;

   2443  1 000572   200012 473500                    LDP3    RAT$,,AUTO
         1 000573   300001 236100                    LDQ     1,,PR3
         1 000574   000022 732000                    QRS     18
         1 000575   000624 604000 1                  TMI     s:2449
         1 000576   200013 116100                    CMPQ    SYSID,,AUTO
         1 000577   000624 601000 1                  TNZ     s:2449

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:33   
      191     2444    3            FR$RAT.FLG.OPN='0'B;

   2444  1 000600   000011 236000 2                  LDQ     9
         1 000601   300010 356100                    ANSQ    8,,PR3

      192     2445    3            FR$RAT.FLG.MBIT='0'B;

   2445  1 000602   200012 473500                    LDP3    RAT$,,AUTO
         1 000603   000012 236000 2                  LDQ     10
         1 000604   300010 356100                    ANSQ    8,,PR3

      193     2446    3            FR$RAT.REEL.ASID=0;

   2446  1 000605   000000 220003                    LDX0    0,DU
         1 000606   200012 473500                    LDP3    RAT$,,AUTO
         1 000607   300004 740100                    STX0    4,,PR3

      194     2447    3            IF FR$RAT.RES.RFLG.OLT THEN CALL FRZ$RRESNA(FR$RAT,MODE);

   2447  1 000610   200012 473500                    LDP3    RAT$,,AUTO
         1 000611   300003 236100                    LDQ     3,,PR3
         1 000612   020000 316003                    CANQ    8192,DU
         1 000613   000624 600000 1                  TZE     s:2449

   2447  1 000614   200014 634500                    EPPR4   MODE,,AUTO
         1 000615   200021 454500                    STP4    MODE+5,,AUTO
         1 000616   200012 236100                    LDQ     RAT$,,AUTO
         1 000617   200020 756100                    STQ     MODE+4,,AUTO
         1 000620   200020 630500                    EPPR0   MODE+4,,AUTO
         1 000621   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000622   000000 701000 xent               TSX1    FRZ$RRESNA
         1 000623   000000 011000                    NOP     0

      195     2448    3            END;

      196     2449    2         VOL=FM$VOL.VOLL(VOL);

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:34   
   2449  1 000624   200011 235100                    LDA     VOL,,AUTO
         1 000625   000003 735000                    ALS     3
         1 000626   000000 470400 xsym               LDP0    FM$SET$
         1 000627   000005 236105                    LDQ     5,AL,PR0
         1 000630   000022 772000                    QRL     18
         1 000631   200011 756100                    STQ     VOL,,AUTO

      197     2450    2         END;

   2450  1 000632   000562 601000 1                  TNZ     s:2442

      198     2451    1      IF J<175 THEN CALL BINCHAR(F$DCB.PSN,VID.VSN);

   2451  1 000633   200006 235100                    LDA     J,,AUTO
         1 000634   000257 115007                    CMPA    175,DL
         1 000635   000646 603000 1                  TRC     s:2452

   2451  1 000636   200007 471500                    LDP1    VID$,,AUTO
         1 000637   100002 235100                    LDA     2,,PR1
         1 000640   000044 773000                    LRL     36
         1 000641   200020 757100                    STAQ    MODE+4,,AUTO
         1 000642   200005 473500                    LDP3    JDCB$,,AUTO
         1 000643   000100 301500                    BTD
         1 000644   200020 000010                    NDSC9   MODE+4,,AUTO             cn=0,s=lsgnf,sf=0,n=8
         1 000645   300024 030006                    NDSC9   20,,PR3                  cn=0,s=nosgn,sf=0,n=6

      199     2452    1      CALL FMD$RELBUF(3);

   2452  1 000646   000002 630400 2                  EPPR0   2
         1 000647   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000650   000000 701000 xent               TSX1    FMD$RELBUF
         1 000651   000000 011000                    NOP     0

      200     2453    1      CALL FMD$RELBUF(4);

   2453  1 000652   000004 630400 2                  EPPR0   4
         1 000653   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:35   
         1 000654   000000 701000 xent               TSX1    FMD$RELBUF
         1 000655   000000 011000                    NOP     0

      201     2454    1      IF FM$SET.DIAGOPN(I) THEN CALL FMP$UDLIST(FM$SET(I));

   2454  1 000656   200004 235100                    LDA     I,,AUTO
         1 000657   000003 735000                    ALS     3
         1 000660   000000 470400 xsym               LDP0    FM$SET$
         1 000661   000002 236105                    LDQ     2,AL,PR0
         1 000662   004000 316003                    CANQ    2048,DU
         1 000663   000674 600000 1                  TZE     s:2455

   2454  1 000664   200004 236100                    LDQ     I,,AUTO
         1 000665   000025 736000                    QLS     21
         1 000666   000000 036000 xsym               ADLQ    FM$SET$
         1 000667   200020 756100                    STQ     MODE+4,,AUTO
         1 000670   200020 630500                    EPPR0   MODE+4,,AUTO
         1 000671   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000672   000000 701000 xent               TSX1    FMP$UDLIST
         1 000673   000000 011000                    NOP     0

      202     2455    1      IF B$JIT.ERR='0'B THEN B$JIT.ERR=FMN$E$SETDOWN;

   2455  1 000674   000000 470400 xsym               LDP0    B$JIT$
         1 000675   000012 235100                    LDA     10,,PR0
         1 000676   000701 601000 1                  TNZ     s:2456

   2455  1 000677   000001 236000 0                  LDQ     FMN$E$SETDOWN
         1 000700   000012 756100                    STQ     10,,PR0

      203     2456    1      ALTRETURN;

   2456  1 000701   000000 702200 xent               TSX2  ! X66_AALT

      204     2457        %EJECT;
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:36   
      205     2458    1   READVID0: PROC ALTRET;

   2458  1 000702   200016 741300       READVID0     STX1  ! MODE+2,,AUTO

      206     2459    2      MODE=B$JIT.MODE;

   2459  1 000703   000000 470400 xsym               LDP0    B$JIT$
         1 000704   000000 236100                    LDQ     0,,PR0
         1 000705   000040 772000                    QRL     32
         1 000706   200014 756100                    STQ     MODE,,AUTO

      207     2460    2      SYSID=B$JIT.SYSID;

   2460  1 000707   000000 236100                    LDQ     0,,PR0
         1 000710   777777 376007                    ANQ     -1,DL
         1 000711   200013 756100                    STQ     SYSID,,AUTO

      208     2461    2      VOL=FM$SET.DCTX(I);

   2461  1 000712   200004 235100                    LDA     I,,AUTO
         1 000713   000003 735000                    ALS     3
         1 000714   000000 471400 xsym               LDP1    FM$SET$
         1 000715   100000 236105                    LDQ     0,AL,PR1
         1 000716   000022 772000                    QRL     18
         1 000717   200011 756100                    STQ     VOL,,AUTO

      209     2462    2      IF VOL=0 THEN VID.VSN=0;

   2462  1 000720   000724 601000 1                  TNZ     s:2463

   2462  1 000721   200007 473500                    LDP3    VID$,,AUTO
         1 000722   300002 450100                    STZ     2,,PR3
         1 000723   000732 710000 1                  TRA     s:2464

      210     2463    2      ELSE VID.VSN=FM$VOL.VSN(VOL);

   2463  1 000724   200011 235100                    LDA     VOL,,AUTO
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:37   
         1 000725   000003 735000                    ALS     3
         1 000726   200007 473500                    LDP3    VID$,,AUTO
         1 000727   100001 236105                    LDQ     1,AL,PR1
         1 000730   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000731   300002 756100                    STQ     2,,PR3

      211     2464    2      FM$SET.NXTSDA(I)=FM_SRZERO;

   2464  1 000732   200004 235100                    LDA     I,,AUTO
         1 000733   000003 735000                    ALS     3
         1 000734   000000 236000 xsym               LDQ     FM_SRZERO
         1 000735   100003 676105                    ERQ     3,AL,PR1
         1 000736   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000737   100003 656105                    ERSQ    3,AL,PR1

      212     2465    2      GOTO COMMON;

   2465  1 000740   000756 710000 1                  TRA     COMMON

      213     2466    2   READVID: ENTRY ALTRET;

   2466  1 000741   200016 741300       READVID      STX1  ! MODE+2,,AUTO

      214     2467    2      VID.VSN=VID0.SNLIST.VSN.N(J);

   2467  1 000742   200006 235100                    LDA     J,,AUTO
         1 000743   000002 735000                    ALS     2
         1 000744   200010 470500                    LDP0    VID0$,,AUTO
         1 000745   200007 471500                    LDP1    VID$,,AUTO
         1 000746   000500 236105                    LDQ     320,AL,PR0
         1 000747   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000750   100002 756100                    STQ     2,,PR1

      215     2468    2      IF VID.VSN=0 THEN GOTO FMNE$BADVOL;

   2468  1 000751   200007 470500                    LDP0    VID$,,AUTO
         1 000752   000002 235100                    LDA     2,,PR0
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:38   
         1 000753   001307 600000 1                  TZE     FMNE$BADVOL

      216     2469    2      VID.VOLCNT=0;

   2469  1 000754   000000 220003                    LDX0    0,DU
         1 000755   000004 440100                    SXL0    4,,PR0

   2469  1 000756                       COMMON       null
      217     2470    2   COMMON:;
      218     2471    2      F$DCB.CSEED=VID.VSN;

   2471  1 000756   200007 470500                    LDP0    VID$,,AUTO
         1 000757   000002 235100                    LDA     2,,PR0
         1 000760   200005 471500                    LDP1    JDCB$,,AUTO
         1 000761   100072 755100                    STA     58,,PR1

      219     2472    2      F$DCB.SETX=0;

   2472  1 000762   000000 220003                    LDX0    0,DU
         1 000763   100051 440100                    SXL0    41,,PR1

      220     2473    2      VOL=FM$SET.DCTX(I);

   2473  1 000764   200004 236100                    LDQ     I,,AUTO
         1 000765   000003 736000                    QLS     3
         1 000766   000000 473400 xsym               LDP3    FM$SET$
         1 000767   300000 236106                    LDQ     0,QL,PR3
         1 000770   000022 772000                    QRL     18
         1 000771   200011 756100                    STQ     VOL,,AUTO

      221     2474    3      DO WHILE(VOL~=0 AND F$DCB.SETX=0);

   2474  1 000772   001030 710000 1                  TRA     s:2479

      222     2475    3         IF J=175 THEN F$DCB.SETX=FM$VOL.DCTX(VOL);

   2475  1 000773   200006 235100                    LDA     J,,AUTO
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:39   
         1 000774   000257 115007                    CMPA    175,DL
         1 000775   001005 601000 1                  TNZ     s:2476

   2475  1 000776   200011 236100                    LDQ     VOL,,AUTO
         1 000777   000003 736000                    QLS     3
         1 001000   000000 470400 xsym               LDP0    FM$SET$
         1 001001   000000 220106                    LDX0    0,QL,PR0
         1 001002   200005 471500                    LDP1    JDCB$,,AUTO
         1 001003   100051 440100                    SXL0    41,,PR1
         1 001004   001030 710000 1                  TRA     s:2479

      223     2476    3         ELSE IF FM$DEV.VSN(VOL)=BITBIN(VID0.SNLIST.VSN(J))

   2476  1 001005   000002 735000                    ALS     2
         1 001006   200010 470500                    LDP0    VID0$,,AUTO
         1 001007   200011 236100                    LDQ     VOL,,AUTO
         1 001010   000003 736000                    QLS     3
         1 001011   000000 471400 xsym               LDP1    FM$SET$
         1 001012   100001 236106                    LDQ     1,QL,PR1
         1 001013   000500 116105                    CMPQ    320,AL,PR0
         1 001014   001023 601000 1                  TNZ     s:2478

      224     2477    3            THEN F$DCB.SETX=FM$VOL.DCTX(VOL);

   2477  1 001015   200011 236100                    LDQ     VOL,,AUTO
         1 001016   000003 736000                    QLS     3
         1 001017   100000 220106                    LDX0    0,QL,PR1
         1 001020   200005 473500                    LDP3    JDCB$,,AUTO
         1 001021   300051 440100                    SXL0    41,,PR3
         1 001022   001030 710000 1                  TRA     s:2479

      225     2478    3            ELSE VOL=FM$VOL.VOLL(VOL);

   2478  1 001023   200011 236100                    LDQ     VOL,,AUTO
         1 001024   000003 736000                    QLS     3
         1 001025   100005 236106                    LDQ     5,QL,PR1
         1 001026   000022 772000                    QRL     18
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:40   
         1 001027   200011 756100                    STQ     VOL,,AUTO

      226     2479    3         END;

   2479  1 001030   200011 235100                    LDA     VOL,,AUTO
         1 001031   001035 600000 1                  TZE     s:2480
         1 001032   200005 470500                    LDP0    JDCB$,,AUTO
         1 001033   000051 720100                    LXL0    41,,PR0
         1 001034   000773 600000 1                  TZE     s:2475

      227     2480    2      IF F$DCB.RESNT.TYP~='DP' THEN F$DCB.RES='DP';

   2480  1 001035   200005 470500                    LDP0    JDCB$,,AUTO
         1 001036   000026 220100                    LDX0    22,,PR0
         1 001037   000005 100000 0                  CMPX0   FMN$E$SPLITRES+1
         1 001040   001045 600000 1                  TZE     s:2481

   2480  1 001041   000005 236000 0                  LDQ     FMN$E$SPLITRES+1
         1 001042   777777 376003                    ANQ     -1,DU
         1 001043   040040 276007                    ORQ     16416,DL
         1 001044   000026 756100                    STQ     22,,PR0

      228     2481    2      IF F$DCB.IASN=%FMDIAG# OR SYSID=JG_SLUG# THEN IF VOL=0 THEN ALTRETURN;

   2481  1 001045   000103 236100                    LDQ     67,,PR0
         1 001046   000777 376007                    ANQ     511,DL
         1 001047   000007 116007                    CMPQ    7,DL
         1 001050   001054 600000 1                  TZE     s:2481+7
         1 001051   200013 235100                    LDA     SYSID,,AUTO
         1 001052   000001 115007                    CMPA    1,DL
         1 001053   001066 601000 1                  TNZ     s:2483

   2481  1 001054   200011 235100                    LDA     VOL,,AUTO
         1 001055   001060 601000 1                  TNZ     s:2482

   2481  1 001056   200016 221300                    LDX1  ! MODE+2,,AUTO
         1 001057   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:41   

      229     2482    2         ELSE F$DCB.ATTR=N$DCT$(F$DCB.SETX)->NI$DCT.RAT$->FR$RAT.M1;

   2482  1 001060   000051 720100                    LXL0    41,,PR0
         1 001061   000000 471400 xsym               LDP1    N$DCT$$
         1 001062   100000 473510                    LDP3    0,X0,PR1
         1 001063   300005 474500                    LDP4    5,,PR3
         1 001064   400006 221100                    LDX1    6,,PR4
         1 001065   000040 441100                    SXL1    32,,PR0

      230     2483    3      IF VOL=0 THEN DO;

   2483  1 001066   200011 235100                    LDA     VOL,,AUTO
         1 001067   001122 601000 1                  TNZ     s:2493

      231     2484    3         CALL FRA$OPR ALTRET(RETALT);

   2484  1 001070   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001071   000000 701000 xent               TSX1    FRA$OPR
         1 001072   001320 702000 1                  TSX2    RETALT

      232     2485                    /* NOW WHERE DID IT APPEAR */
      233     2486    3         VOL=FM$SET.DCTX(I);

   2486  1 001073   200004 235100                    LDA     I,,AUTO
         1 001074   000003 735000                    ALS     3
         1 001075   000000 470400 xsym               LDP0    FM$SET$
         1 001076   000000 236105                    LDQ     0,AL,PR0
         1 001077   000022 772000                    QRL     18
         1 001100   200011 756100                    STQ     VOL,,AUTO

      234     2487    4         DO WHILE(VOL~=0 AND FM$VOL.DCTX(VOL)~=F$DCB.SETX);

   2487  1 001101   001110 710000 1                  TRA     s:2489

      235     2488    4            VOL=FM$VOL.VOLL(VOL);

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:42   
   2488  1 001102   200011 235100                    LDA     VOL,,AUTO
         1 001103   000003 735000                    ALS     3
         1 001104   000000 470400 xsym               LDP0    FM$SET$
         1 001105   000005 236105                    LDQ     5,AL,PR0
         1 001106   000022 772000                    QRL     18
         1 001107   200011 756100                    STQ     VOL,,AUTO

      236     2489    4            END;

   2489  1 001110   001117 600000 1                  TZE     s:2490
         1 001111   200005 471500                    LDP1    JDCB$,,AUTO
         1 001112   100051 720100                    LXL0    41,,PR1
         1 001113   200011 235100                    LDA     VOL,,AUTO
         1 001114   000003 735000                    ALS     3
         1 001115   000000 100105                    CMPX0   0,AL,PR0
         1 001116   001102 601000 1                  TNZ     s:2488

      237     2490    3         IF VOL=0 THEN GOTO FMNE$BADVOL;

   2490  1 001117   000000 116003                    CMPQ    0,DU
         1 001120   001307 600000 1                  TZE     FMNE$BADVOL

      238     2491    3         END;

   2491  1 001121   001175 710000 1                  TRA     s:2514

      239     2492    3      ELSE DO;

      240     2493    3         RAT$=N$DCT$(F$DCB.SETX)->NI$DCT.RAT$;

   2493  1 001122   000051 720100                    LXL0    41,,PR0
         1 001123   000000 471400 xsym               LDP1    N$DCT$$
         1 001124   100000 473510                    LDP3    0,X0,PR1
         1 001125   300005 236100                    LDQ     5,,PR3
         1 001126   200012 756100                    STQ     RAT$,,AUTO

      241     2494    3         IF NOT FR$RAT.FLG.OPN THEN IF FM$VOL.SECT#(VOL)=0
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:43   

   2494  1 001127   200012 473500                    LDP3    RAT$,,AUTO
         1 001130   300010 236100                    LDQ     8,,PR3
         1 001131   000020 316007                    CANQ    16,DL
         1 001132   001161 601000 1                  TNZ     s:2506

   2494  1 001133   000003 735000                    ALS     3
         1 001134   000000 474400 xsym               LDP4    FM$SET$
         1 001135   400001 236105                    LDQ     1,AL,PR4
         1 001136   777000 316003                    CANQ    -512,DU
         1 001137   001144 601000 1                  TNZ     s:2496

      242     2495    3            THEN CALL FRA$OPR ALTRET(RETALT);

   2495  1 001140   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001141   000000 701000 xent               TSX1    FRA$OPR
         1 001142   001320 702000 1                  TSX2    RETALT
         1 001143   001175 710000 1                  TRA     s:2514

      243     2496    4            ELSE IF FR$RAT.RES.SISID=JG_PIG# OR B$JIT.SYSID=JG_SLUG# THEN DO;

   2496  1 001144   300001 221100                    LDX1    1,,PR3
         1 001145   000007 101003                    CMPX1   7,DU
         1 001146   001153 600000 1                  TZE     s:2497
         1 001147   000000 475400 xsym               LDP5    B$JIT$
         1 001150   500000 722100                    LXL2    0,,PR5
         1 001151   000001 102003                    CMPX2   1,DU
         1 001152   001314 601000 1                  TNZ     FMNE$SPLITRES

      244     2497    4                  FR$RAT.FLG.MBIT.MTD='1'B;

   2497  1 001153   000400 236007                    LDQ     256,DL
         1 001154   300010 256100                    ORSQ    8,,PR3

      245     2498    4                  FR$RAT.FLG.OPN='1'B;

   2498  1 001155   200012 473500                    LDP3    RAT$,,AUTO
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:44   
         1 001156   000020 236007                    LDQ     16,DL
         1 001157   300010 256100                    ORSQ    8,,PR3

      246     2499    4                  END;

   2499  1 001160   001175 710000 1                  TRA     s:2514

      247     2500    3               ELSE GOTO FMNE$SPLITRES;
      248     2501                    /*E*     ERROR: FMN-E$SPLITRES-E
      249     2502                    *        MESSAGE:No DP resource available to mount split set% %UF%.
      250     2503                    *        MESSAGE1:Set% #%UF% occupies a multi-set volume and PIG
      251     2504                    *                 was unable to allocate its resource when it AVR'ed.
      252     2505                    */
      253     2506    3         ELSE IF FR$RAT.RES.SISID~=SYSID AND FM$VOL.SECT#(VOL)=0

   2506  1 001161   300001 236100                    LDQ     1,,PR3
         1 001162   000022 732000                    QRS     18
         1 001163   001166 604000 1                  TMI     s:2506+5
         1 001164   200013 116100                    CMPQ    SYSID,,AUTO
         1 001165   001175 600000 1                  TZE     s:2514
         1 001166   000003 735000                    ALS     3
         1 001167   000000 474400 xsym               LDP4    FM$SET$
         1 001170   400001 236105                    LDQ     1,AL,PR4
         1 001171   777000 316003                    CANQ    -512,DU
         1 001172   001175 601000 1                  TNZ     s:2514

      254     2507    3            THEN CALL SC_SETRES;

   2507  1 001173   000000 713400 xsym               CLIMB   SC_SETRES
         1 001174   000000 600000 xsid               climb   nvectors=         0

      255     2508                    /*S*     SCREECH_CODE: FMR-S$SETRES
      256     2509                    *        TYPE: SUA
      257     2510              *        MESSAGE:Another user is using a volume of a properly reserved set.
      258     2511              */
      259     2512    3         END;

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:45   
      260     2513
      261     2514    2      F$DCB.SETX=VOL;

   2514  1 001175   200011 720100                    LXL0    VOL,,AUTO
         1 001176   200005 470500                    LDP0    JDCB$,,AUTO
         1 001177   000051 440100                    SXL0    41,,PR0

      262     2515    2      CALL FMN$RDGRAN(VID$,FM_SRZERO);

   2515  1 001200   000013 236000 2                  LDQ     11
         1 001201   200021 756100                    STQ     MODE+5,,AUTO
         1 001202   200007 631500                    EPPR1   VID$,,AUTO
         1 001203   200020 451500                    STP1    MODE+4,,AUTO
         1 001204   200020 630500                    EPPR0   MODE+4,,AUTO
         1 001205   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001206   000000 701000 xent               TSX1    FMN$RDGRAN
         1 001207   000000 011000                    NOP     0

      263     2516    2      IF J=175 THEN VID0=VID;

   2516  1 001210   200006 235100                    LDA     J,,AUTO
         1 001211   000257 115007                    CMPA    175,DL
         1 001212   001222 601000 1                  TNZ     s:2518

   2516  1 001213   200007 470500                    LDP0    VID$,,AUTO
         1 001214   010000 220003                    LDX0    4096,DU
         1 001215   200010 471500                    LDP1    VID0$,,AUTO
         1 001216   000140 100540                    MLR     fill='000'O
         1 001217   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 001220   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 001221   001271 710000 1                  TRA     s:2529

      264     2517    3      ELSE DO;

      265     2518    3         IF B$JIT.ERR='0'B THEN

   2518  1 001222   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:46   
         1 001223   000012 235100                    LDA     10,,PR0
         1 001224   001271 601000 1                  TNZ     s:2529

      266     2519    3            IF VID.PSN~=VID0.PSN

   2519  1 001225   200007 471500                    LDP1    VID$,,AUTO
         1 001226   200010 473500                    LDP3    VID0$,,AUTO
         1 001227   040100 106500                    CMPC    fill='040'O
         1 001230   100003 000006                    ADSC9   3,,PR1                   cn=0,n=6
         1 001231   300003 000006                    ADSC9   3,,PR3                   cn=0,n=6
         1 001232   001267 601000 1                  TNZ     s:2524
         1 001233   100004 236100                    LDQ     4,,PR1
         1 001234   300004 676100                    ERQ     4,,PR3
         1 001235   777777 376007                    ANQ     -1,DL
         1 001236   001267 601000 1                  TNZ     s:2524
         1 001237   000100 106500                    CMPC    fill='000'O
         1 001240   100500 000020                    ADSC9   320,,PR1                 cn=0,n=16
         1 001241   300500 000020                    ADSC9   320,,PR3                 cn=0,n=16
         1 001242   001267 601000 1                  TNZ     s:2524
         1 001243   200006 236100                    LDQ     J,,AUTO
         1 001244   000004 736000                    QLS     4
         1 001245   000106 106506                    CMPC    fill='000'O
         1 001246   100500 000020                    ADSC9   320,Q,PR1                cn=0,n=16
         1 001247   300500 000020                    ADSC9   320,Q,PR3                cn=0,n=16
         1 001250   001267 601000 1                  TNZ     s:2524
         1 001251   200005 474500                    LDP4    JDCB$,,AUTO
         1 001252   400051 236100                    LDQ     41,,PR4
         1 001253   000003 736000                    QLS     3
         1 001254   000000 376000 2                  ANQ     0
         1 001255   000000 475400 xsym               LDP5    FM$SET$
         1 001256   500003 236106                    LDQ     3,QL,PR5
         1 001257   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001260   000000 136000 xsym               SBLQ    FM_SRZERO
         1 001261   200006 235100                    LDA     J,,AUTO
         1 001262   000002 735000                    ALS     2
         1 001263   000000 116003                    CMPQ    0,DU
         1 001264   001267 604000 1                  TMI     s:2524
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:47   
         1 001265   100501 116105                    CMPQ    321,AL,PR1
         1 001266   001271 600000 1                  TZE     s:2529

      267     2520    3              OR VID.VOLCNT~=VID0.VOLCNT
      268     2521    3              OR VID.SNLIST(0)~=VID0.SNLIST(0)
      269     2522    3              OR VID.SNLIST(J)~=VID0.SNLIST(J)
      270     2523    3              OR VID.SNLIST.SIZE(J)~=FM$SET.NXTSDA(F$DCB.SETX)-FM_SRZERO
      271     2524    3            THEN B$JIT.ERR=FMN$E$BADVOL;

   2524  1 001267   000002 236000 0                  LDQ     FMN$E$BADVOL
         1 001270   000012 756100                    STQ     10,,PR0

      272     2525                    /*E*     ERROR: FMN-E$BADVOL-E
      273     2526                    *        MESSAGE: Packset volume #%SN is not part of its set.
      274     2527                    */
      275     2528    3         END;

      276     2529    2      FM$VOL.RGRANS(VOL)=0;

   2529  1 001271   200011 235100                    LDA     VOL,,AUTO
         1 001272   000003 735000                    ALS     3
         1 001273   000000 470400 xsym               LDP0    FM$SET$
         1 001274   000006 450105                    STZ     6,AL,PR0

      277     2530    2      FM$VOL.GPSDA(VOL)=FM_GPSDA;

   2530  1 001275   000000 470400 xsym               LDP0    FM$SET$
         1 001276   000000 236000 xsym               LDQ     FM_GPSDA
         1 001277   000007 756105                    STQ     7,AL,PR0

      278     2531    2      IF B$JIT.ERR='0'B THEN RETURN;

   2531  1 001300   000000 470400 xsym               LDP0    B$JIT$
         1 001301   000012 235100                    LDA     10,,PR0
         1 001302   001305 601000 1                  TNZ     s:2532

   2531  1 001303   200016 221300                    LDX1  ! MODE+2,,AUTO
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:48   
         1 001304   000001 702211                    TSX2  ! 1,X1

      279     2532    2      ALTRETURN;

   2532  1 001305   200016 221300                    LDX1  ! MODE+2,,AUTO
         1 001306   000000 702211                    TSX2  ! 0,X1

      280     2533    2   FMNE$BADVOL:B$JIT.ERR=FMN$E$BADVOL;

   2533  1 001307   000002 236000 0     FMNE$BADVOL  LDQ     FMN$E$BADVOL
         1 001310   000000 470400 xsym               LDP0    B$JIT$
         1 001311   000012 756100                    STQ     10,,PR0

      281     2534    2      ALTRETURN;

   2534  1 001312   200016 221300                    LDX1  ! MODE+2,,AUTO
         1 001313   000000 702211                    TSX2  ! 0,X1

      282     2535    2   FMNE$SPLITRES: B$JIT.ERR=FMN$E$SPLITRES;

   2535  1 001314   000004 236000 0     FMNE$SPLITR* LDQ     FMN$E$SPLITRES
         1 001315   500012 756100                    STQ     10,,PR5

      283     2536    2      ALTRETURN;

   2536  1 001316   200016 221300                    LDX1  ! MODE+2,,AUTO
         1 001317   000000 702211                    TSX2  ! 0,X1

   2531  1 001320                       RETALT       null
      284     2537    2   RETALT:;
      285     2538    2      IF B$JIT.ERR.CODE=%E$NORES AND (F$DCB.IASN=%FMDIAG# OR SYSID=JG_SLUG#)

   2538  1 001320   000000 470400 xsym               LDP0    B$JIT$
         1 001321   000012 236100                    LDQ     10,,PR0
         1 001322   377770 376007                    ANQ     131064,DL
         1 001323   012150 116007                    CMPQ    5224,DL
         1 001324   001335 601000 1                  TNZ     RETALT+13
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:49   
         1 001325   200005 471500                    LDP1    JDCB$,,AUTO
         1 001326   100103 236100                    LDQ     67,,PR1
         1 001327   000777 376007                    ANQ     511,DL
         1 001330   000007 116007                    CMPQ    7,DL
         1 001331   001344 600000 1                  TZE     s:2540
         1 001332   200013 235100                    LDA     SYSID,,AUTO
         1 001333   000001 115007                    CMPA    1,DL
         1 001334   001344 600000 1                  TZE     s:2540
         1 001335   000012 236100                    LDQ     10,,PR0
         1 001336   377770 376007                    ANQ     131064,DL
         1 001337   012310 116007                    CMPQ    5320,DL
         1 001340   001377 601000 1                  TNZ     s:2548
         1 001341   200013 235100                    LDA     SYSID,,AUTO
         1 001342   000007 115007                    CMPA    7,DL
         1 001343   001377 601000 1                  TNZ     s:2548

      286     2539    3        OR B$JIT.ERR.CODE=%E$BDATTR AND SYSID=JG_PIG# THEN DO;

      287     2540    3         B$JIT.ERR='0'B;

   2540  1 001344   000012 450100                    STZ     10,,PR0

      288     2541    3         CALL FRZ$GETRES(F$DCB.RES,F$DCB.ATTR,SYSID,

   2541  1 001345   200012 631500                    EPPR1   RAT$,,AUTO
         1 001346   200024 451500                    STP1    MODE+8,,AUTO
         1 001347   200014 633500                    EPPR3   MODE,,AUTO
         1 001350   200023 453500                    STP3    MODE+7,,AUTO
         1 001351   200013 634500                    EPPR4   SYSID,,AUTO
         1 001352   200022 454500                    STP4    MODE+6,,AUTO
         1 001353   200005 236100                    LDQ     JDCB$,,AUTO
         1 001354   000014 036000 2                  ADLQ    12
         1 001355   200021 756100                    STQ     MODE+5,,AUTO
         1 001356   200005 236100                    LDQ     JDCB$,,AUTO
         1 001357   000026 036003                    ADLQ    22,DU
         1 001360   200020 756100                    STQ     MODE+4,,AUTO
         1 001361   200020 630500                    EPPR0   MODE+4,,AUTO
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:50   
         1 001362   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001363   000000 701000 xent               TSX1    FRZ$GETRES
         1 001364   001320 702000 1                  TSX2    RETALT

      289     2542    3           MODE,RAT$)ALTRET(RETALT);
      290     2543    3         FR$RAT.RES.RFLG.OLT='1'B;

   2543  1 001365   200012 470500                    LDP0    RAT$,,AUTO
         1 001366   020000 236003                    LDQ     8192,DU
         1 001367   000003 256100                    ORSQ    3,,PR0

      291     2544    3         FR$RAT.RES.NUMB=' ';

   2544  1 001370   040040 220003                    LDX0    16416,DU
         1 001371   200012 470500                    LDP0    RAT$,,AUTO
         1 001372   000001 440100                    SXL0    1,,PR0

      292     2545    3         FR$RAT.RES.ACTX=0;

   2545  1 001373   000000 221003                    LDX1    0,DU
         1 001374   200012 470500                    LDP0    RAT$,,AUTO
         1 001375   000002 441100                    SXL1    2,,PR0

      293     2546    3         GOTO COMMON;

   2546  1 001376   000756 710000 1                  TRA     COMMON

      294     2547    3         END;
      295     2548    2      ALTRETURN;

   2548  1 001377   200016 221300                    LDX1  ! MODE+2,,AUTO
         1 001400   000000 702211                    TSX2  ! 0,X1

FMN$E$XCLSET
 Sect OctLoc
   0     000   061516 002172                                                    1..z

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:51   
FMN$E$SETDOWN
 Sect OctLoc
   0     001   061516 002202                                                    1...

FMN$E$BADVOL
 Sect OctLoc
   0     002   061516 001532                                                    1...

FMN$E$NOTAUTH
 Sect OctLoc
   0     003   061516 006252                                                    1...

FMN$E$SPLITRES
 Sect OctLoc
   0     004   061516 002222                                                    1...

(unnamed)
 Sect OctLoc
   0     005   104120 040040                                                    DP

(unnamed)
 Sect OctLoc
   2     000   000007 777770   000000 006000   000005 006000   000003 006000    ................
   2     004   000006 006000   000003 006000   000000 000016   000006 006000    ................
   2     010   767777 777777   777777 777757   777777 777077   000000 006000    ...........?....
   2     014   000040 400000                                                    . ..
      296     2549    2   END READVID0;
      297     2550    1   END FMN$SETX;
      298     2551        %EOD;

PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:52   
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMN$SETX.
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:53   

 **** Variables and constants ****

  ****  Section 000 RoData FMN$SETX

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/b STRC        r     1 FMN$E$BADVOL               3-0-0/b STRC        r     1 FMN$E$NOTAUTH
     1-0-0/b STRC        r     1 FMN$E$SETDOWN              4-0-0/b STRC        r     1 FMN$E$SPLITRES
     0-0-0/b STRC        r     1 FMN$E$XCLSET

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @PSN                       4-0-0/w UBIN        r     1 I
     4-0-0/w STRC        r     1 IC                         6-0-0/w UBIN        r     1 J
     5-0-0/w PTR         r     1 JDCB$                     14-0-0/w UBIN        r     1 MODE
    *0-0-0/c CHAR(6)     r     1 PSN                       12-0-0/w PTR         r     1 RAT$
    13-0-0/w UBIN        r     1 SYSID                      7-0-0/w PTR         r     1 VID$
    10-0-0/w PTR         r     1 VID0$                     11-0-0/w UBIN        r     1 VOL

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FM$SET$                    0-0-0/w UBIN        r     1 FM_GPSDA
     0-0-0/w UBIN        r     1 FM_PADSDA                  0-0-0/w UBIN        r     1 FM_SRZERO
     0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:54   

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/c CHAR(4)     r     1 CHAR4
     0-0-0/w STRC(396)   r     1 CODE04                     0-0-0/w STRC(288)   r     1 CODE14
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(288)   r     1 FM$CFUX
     0-0-0/w STRC(288)   r     1 FM$DEV(0:0)                0-0-0/w STRC(180)   r     1 FM$GRAN
     0-0-0/w STRC(288)   r     1 FM$SET(0:0)                0-0-0/w STRC(288)   r     1 FM$VOL(0:0)
     0-0-0/w STRC(324)   r     1 FR$RAT                     0-0-0/w PTR         r     1 N$DCT$(0:0)
     0-0-0/w STRC(1332)  r     1 NI$DCT                     0-0-0/w STRC(36864) r     1 VID
     0-0-0/w STRC(36864) r     1 VID0


   Procedure FMN$SETX requires 769 words for executable code.
   Procedure FMN$SETX requires 22 words of local(AUTO) storage.
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:55   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:56   
          MINI XREF LISTING

B$JIT.DCB$
       432**DCL      2352>>ASSIGN
B$JIT.ERR
       342**DCL      2394<<ASSIGN   2431<<ASSIGN   2432<<ASSIGN   2434<<ASSIGN   2455>>IF       2455<<ASSIGN
      2518>>IF       2524<<ASSIGN   2531>>IF       2533<<ASSIGN   2535<<ASSIGN   2540<<ASSIGN
B$JIT.ERR.CODE
       343**DCL      2538>>IF       2538>>IF
B$JIT.ERR.MID
       343**DCL       343--REDEF
B$JIT.MODE
       337**DCL      2459>>ASSIGN
B$JIT.SYSID
       342**DCL      2359>>IF       2359>>IF       2371>>ASSIGN   2399>>IF       2413>>IF       2415>>IF
      2460>>ASSIGN   2496>>IF
B$JIT$
      2318**DCL       337--IMP-PTR  2352>>ASSIGN   2359>>IF       2359>>IF       2371>>ASSIGN   2394>>ASSIGN
      2399>>IF       2413>>IF       2415>>IF       2431>>ASSIGN   2432>>ASSIGN   2434>>ASSIGN   2455>>IF
      2455>>ASSIGN   2459>>ASSIGN   2460>>ASSIGN   2496>>IF       2518>>IF       2524>>ASSIGN   2531>>IF
      2533>>ASSIGN   2535>>ASSIGN   2538>>IF       2538>>IF       2540>>ASSIGN
CHAR4
      2347**DCL      2417>>IF
CODE04.GAC.TIME
       961**DCL      2386>>ASSIGN
CODE14.ACCESS.GACSHELF
       969**DCL      2389>>ASSIGN
CODE14.ACCESS.WCDATA
       968**DCL      2390>>ASSIGN
CODE14.ACCESS.WRCMP
       968**DCL      2390>>ASSIGN
COMMON IN PROCEDURE READVID0
      2469**LABEL    2465--GOTO     2546--GOTO
F$CFU$
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:57   
      2320**DCL       939--IMP-PTR  2355>>ASSIGN   2411>>ASSIGN
F$DCB.ACTPOS
       522**DCL       522--REDEF
F$DCB.ARS
       497**DCL       497--REDEF
F$DCB.ATTR
       515**DCL       516--REDEF    2482<<ASSIGN   2541<>CALL
F$DCB.BORROW
       530**DCL       530--REDEF     530--REDEF     530--REDEF
F$DCB.CSEED
       534**DCL      2471<<ASSIGN
F$DCB.DCBNAME.L
       544**DCL       544--IMP-SIZ
F$DCB.EOMCHAR
       501**DCL       501--REDEF
F$DCB.FLDID
       525**DCL       525--REDEF
F$DCB.FORM$
       519**DCL       519--REDEF
F$DCB.FSECT
       535**DCL       535--REDEF
F$DCB.FSN
       512**DCL       512--REDEF     512--REDEF     513--REDEF
F$DCB.FUN
       511**DCL      2415>>IF
F$DCB.HEADER$
       518**DCL       518--REDEF
F$DCB.IASN
       538**DCL      2359>>IF       2393>>IF       2432>>IF       2481>>IF       2538>>IF
F$DCB.IXTNSIZE
       516**DCL       516--REDEF
F$DCB.LASTSTA$
       506**DCL       506--REDEF
F$DCB.LVL
       531**DCL       531--REDEF
F$DCB.NAME.C
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:58   
       506**DCL       506--REDEF
F$DCB.NOEOF
       527**DCL       527--REDEF
F$DCB.NRECS
       517**DCL       517--REDEF
F$DCB.NRECX
       536**DCL       536--REDEF
F$DCB.OHDR
       528**DCL       528--REDEF
F$DCB.ORG
       511**DCL       511--REDEF
F$DCB.PRECNO
       534**DCL       534--REDEF
F$DCB.PSN
       507**DCL      2451<<CALLBLT
F$DCB.RCSZ
       539**DCL       539--REDEF
F$DCB.RES
       507**DCL       507--REDEF    2480<<ASSIGN   2541<>CALL
F$DCB.RESNT.TYP
       507**DCL      2480>>IF
F$DCB.SETX
       519**DCL       519--REDEF    2353<<ASSIGN   2381<<ASSIGN   2405<<ASSIGN   2436<<ASSIGN   2472<<ASSIGN
      2474>>DOWHILE  2475<<ASSIGN   2477<<ASSIGN   2482>>ASSIGN   2487>>DOWHILE  2493>>ASSIGN   2514<<ASSIGN
      2519>>IF
F$DCB.TAB$
       518**DCL       519--REDEF
F$DCB.TDA
       533**DCL       533--REDEF
F$DCB.WSN
       508**DCL       508--REDEF
FAG$CGRANS
      2330**DCL-ENT  2393--CALL
FM$CFUX.DSETH
       940**DCL      2411>>ASSIGN
FM$CFUX.SETH
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:59   
       940**DCL      2355>>ASSIGN
FM$DEV.AVR
       928**DCL      2404<<ASSIGN   2413>>IF
FM$DEV.DCTX
       927**DCL      2421>>IF
FM$DEV.DEVL
       929**DCL      2424>>ASSIGN
FM$DEV.MIRROR
       928**DCL      2415>>IF
FM$DEV.SECTL
       929**DCL      2415>>IF
FM$DEV.USERLIST
       928**DCL       929--REDEF
FM$DEV.VSN
       927**DCL      2417>>IF       2417--IF       2476>>IF
FM$GRAN
       974**DCL      2384--ASSIGN   2387--ASSIGN
FM$SET
       922**DCL      2401<>CALL     2403<>CALL     2454<>CALL
FM$SET.DCTX
       922**DCL      2367>>IF       2367>>IF       2367>>IF       2398>>ASSIGN   2440>>ASSIGN   2461>>ASSIGN
      2473>>ASSIGN   2486>>ASSIGN
FM$SET.DIAGOPN
       923**DCL      2370<<ASSIGN   2454>>IF
FM$SET.GACSHELF
       923**DCL      2389<<ASSIGN
FM$SET.GACTIME
       924**DCL      2386<<ASSIGN
FM$SET.NXTSDA
       924**DCL      2379<<ASSIGN   2379>>ASSIGN   2464<<ASSIGN   2519>>IF
FM$SET.ONEU
       923**DCL      2369<<ASSIGN
FM$SET.PSN
       922**DCL      2357>>IF
FM$SET.SET
       922**DCL      2367>>IF       2382<<ASSIGN   2397>>IF
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:60   
FM$SET.SETL
       924**DCL      2409>>ASSIGN
FM$SET.SYSID
       923**DCL      2359>>IF       2359>>IF       2362>>IF       2370>>IF       2371<<ASSIGN   2399>>IF
      2399>>IF
FM$SET.USERLIST
       923**DCL       923--REDEF
FM$SET.WRCMP
       922**DCL      2390<<ASSIGN
FM$SET.XCL
       922**DCL      2359>>IF
FM$SET$
      2319**DCL       922--IMP-PTR   927--IMP-PTR   933--IMP-PTR  2357>>IF       2359>>IF       2359>>IF
      2359>>IF       2362>>IF       2367>>IF       2367>>IF       2367>>IF       2367>>IF       2369>>ASSIGN
      2370>>IF       2370>>ASSIGN   2371>>ASSIGN   2379>>ASSIGN   2379>>ASSIGN   2382>>ASSIGN   2386>>ASSIGN
      2389>>ASSIGN   2390>>ASSIGN   2397>>IF       2398>>ASSIGN   2399>>IF       2399>>IF       2401>>CALL
      2403>>CALL     2404>>ASSIGN   2409>>ASSIGN   2413>>IF       2415>>IF       2415>>IF       2417>>IF
      2417>>IF       2421>>IF       2423>>IF       2423>>ASSIGN   2424>>ASSIGN   2424>>ASSIGN   2440>>ASSIGN
      2442>>ASSIGN   2449>>ASSIGN   2454>>IF       2454>>CALL     2461>>ASSIGN   2463>>ASSIGN   2464>>ASSIGN
      2473>>ASSIGN   2475>>ASSIGN   2476>>IF       2477>>ASSIGN   2478>>ASSIGN   2486>>ASSIGN   2487>>DOWHILE
      2488>>ASSIGN   2494>>IF       2506>>IF       2519>>IF       2529>>ASSIGN   2530>>ASSIGN
FM$VOL.DCTX
       933**DCL      2424>>ASSIGN   2442>>ASSIGN   2475>>ASSIGN   2477>>ASSIGN   2487>>DOWHILE
FM$VOL.GPSDA
       936**DCL      2530<<ASSIGN
FM$VOL.RGRANS
       936**DCL      2529<<ASSIGN
FM$VOL.SECT#
       933**DCL      2494>>IF       2506>>IF
FM$VOL.SECTL
       935**DCL      2423>>IF       2423>>ASSIGN
FM$VOL.USERLIST
       934**DCL       935--REDEF
FM$VOL.VOLL
       935**DCL      2449>>ASSIGN   2478>>ASSIGN   2488>>ASSIGN
FM$VOL.VSN
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:61   
       933**DCL      2463>>ASSIGN
FMD$GETBUF
      2331**DCL-ENT  2373--CALL     2374--CALL
FMD$RELBUF
      2332**DCL-ENT  2391--CALL     2392--CALL     2452--CALL     2453--CALL
FMN$E$BADVOL
      2288**DCL      2524>>ASSIGN   2533>>ASSIGN
FMN$E$NOTAUTH
      2292**DCL      2432>>ASSIGN
FMN$E$SETDOWN
      2284**DCL      2431>>ASSIGN   2455>>ASSIGN
FMN$E$SPLITRES
      2296**DCL      2535>>ASSIGN
FMN$E$XCLSET
      2280**DCL      2434>>ASSIGN
FMN$RDGRAN
      2333**DCL-ENT  2383--CALL     2515--CALL
FMNE$BADVOL IN PROCEDURE READVID0
      2533**LABEL    2468--GOTO     2490--GOTO
FMNE$SETDOWN
      2431**LABEL    2362--GOTO
FMNE$SPLITRES IN PROCEDURE READVID0
      2535**LABEL    2500--GOTO
FMNE$XCLSET
      2434**LABEL    2363--GOTO     2400--GOTO
FMO$LOCCODP
      2334**DCL-ENT  2385--CALL     2388--CALL
FMP$UDLIST
      2338**DCL-ENT  2454--CALL
FMP$ULIST
      2337**DCL-ENT  2401--CALL     2403--CALL
FMR$L8
      2335**DCL-ENT  2354--CALL     2395--CALL
FMR$U8
      2336**DCL-ENT  2372--CALL     2406--CALL     2437--CALL
FM_GPSDA
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:62   
      2325**DCL      2530>>ASSIGN
FM_PADSDA
      2324**DCL      2383<>CALL
FM_SRZERO
      2323**DCL      2464>>ASSIGN   2515<>CALL     2519>>IF
FR$RAT
      1032**DCL      2447<>CALL
FR$RAT.FLG.MBIT
      1059**DCL      2445<<ASSIGN
FR$RAT.FLG.MBIT.MTD
      1060**DCL      2497<<ASSIGN
FR$RAT.FLG.OPN
      1064**DCL      2444<<ASSIGN   2494>>IF       2498<<ASSIGN
FR$RAT.M1
      1054**DCL      2482>>ASSIGN
FR$RAT.REEL.ASID
      1052**DCL      2446<<ASSIGN
FR$RAT.RES.ACTX
      1038**DCL      2545<<ASSIGN
FR$RAT.RES.NUMB
      1036**DCL      2544<<ASSIGN
FR$RAT.RES.RFLG.OLT
      1041**DCL      2447>>IF       2543<<ASSIGN
FR$RAT.RES.SISID
      1035**DCL      2443>>IF       2496>>IF       2506>>IF
FRA$OPR
      2339**DCL-ENT  2484--CALL     2495--CALL
FRZ$GETRES
      2340**DCL-ENT  2541--CALL
FRZ$RRESNA
      2342**DCL-ENT  2447--CALL
GOTONE
      2358**LABEL    2414--GOTO     2420--GOTO     2422--GOTO
I
      2303**DCL      2304--REDEF    2355<<ASSIGN   2356>>DOWHILE  2357>>IF       2359>>IF       2359>>IF
      2359>>IF       2362>>IF       2367>>IF       2367>>IF       2367>>IF       2369>>ASSIGN   2370>>IF
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:63   
      2370>>ASSIGN   2371>>ASSIGN   2379>>ASSIGN   2379>>ASSIGN   2381>>ASSIGN   2382>>ASSIGN   2386>>ASSIGN
      2389>>ASSIGN   2390>>ASSIGN   2397>>IF       2398>>ASSIGN   2403>>CALL     2404>>ASSIGN   2405>>ASSIGN
      2409<<ASSIGN   2409>>ASSIGN   2411<<ASSIGN   2412>>DOWHILE  2413>>IF       2415>>IF       2415>>IF
      2417>>IF       2417>>IF       2421>>IF       2421>>IF       2421>>IF       2423>>IF       2423<<ASSIGN
      2423>>ASSIGN   2424<<ASSIGN   2424>>ASSIGN   2436>>ASSIGN   2440>>ASSIGN   2454>>IF       2454>>CALL
      2461>>ASSIGN   2464>>ASSIGN   2473>>ASSIGN   2486>>ASSIGN
IC.DCTX
      2306**DCL      2417>>IF
J
      2308**DCL      2375<<ASSIGN   2377<<DOINDEX  2379>>ASSIGN   2398<<ASSIGN   2399>>IF       2399>>IF
      2401>>CALL     2451>>IF       2467>>ASSIGN   2475>>IF       2476>>IF       2516>>IF       2519>>IF
      2519>>IF       2519>>IF
JDCB$
      2307**DCL       497--IMP-PTR  2352<<ASSIGN   2353>>ASSIGN   2359>>IF       2381>>ASSIGN   2393>>IF
      2405>>ASSIGN   2415>>IF       2432>>IF       2436>>ASSIGN   2451>>CALLBLT  2471>>ASSIGN   2472>>ASSIGN
      2474>>DOWHILE  2475>>ASSIGN   2477>>ASSIGN   2480>>IF       2480>>ASSIGN   2481>>IF       2482>>ASSIGN
      2482>>ASSIGN   2487>>DOWHILE  2493>>ASSIGN   2514>>ASSIGN   2519>>IF       2538>>IF       2541>>CALL
      2541>>CALL
MODE
      2314**DCL      2447<>CALL     2459<<ASSIGN   2541<>CALL
N$DCT$
      2322**DCL      2421>>IF       2442>>ASSIGN   2482>>ASSIGN   2493>>ASSIGN
N$DCT$$
      2321**DCL      2322--IMP-PTR  2421>>IF       2442>>ASSIGN   2482>>ASSIGN   2493>>ASSIGN
NI$DCT.DEVNM
      1295**DCL      2421>>IF
NI$DCT.DP
      1315**DCL      1322--REDEF    1325--REDEF    1326--REDEF    1328--REDEF    1328--REDEF    1329--REDEF
      1330--REDEF    1330--REDEF
NI$DCT.MPC.IOCHANX
      1323**DCL      1323--REDEF
NI$DCT.RAT$
      1296**DCL      2442>>ASSIGN   2482>>ASSIGN   2493>>ASSIGN
PSN
      2302**DCL        14--PROC     2356>>IF       2357>>IF       2412>>IF       2413>>IF       2417>>IF
      2417>>IF       2421>>IF       2432>>IF
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:64   
RAT$
      2312**DCL      1032--IMP-PTR  2442<<ASSIGN   2443>>IF       2444>>ASSIGN   2445>>ASSIGN   2446>>ASSIGN
      2447>>IF       2447>>CALL     2493<<ASSIGN   2494>>IF       2496>>IF       2497>>ASSIGN   2498>>ASSIGN
      2506>>IF       2541<>CALL     2543>>ASSIGN   2544>>ASSIGN   2545>>ASSIGN
READVID IN PROCEDURE READVID0
      2466**ENTRY    2378--CALL
READVID0
      2458**PROC     2376--CALL
RETALT
      2432**LABEL    2401--CALLALT  2403--CALLALT  2433--GOTO
RETALT IN PROCEDURE READVID0
      2531**LABEL    2484--CALLALT  2495--CALLALT  2541--CALLALT
RETALTREL
      2436**LABEL    2376--CALLALT  2378--CALLALT
SC_SETRES
      2343**DCL-ENT  2507--CALL
SYSID
      2313**DCL      2443>>IF       2460<<ASSIGN   2481>>IF       2506>>IF       2538>>IF       2538>>IF
      2541<>CALL
VID
       944**DCL      2516>>ASSIGN
VID.DTT
       946**DCL       946--REDEF
VID.PSN
       944**DCL      2519>>IF
VID.SNLIST
       947**DCL      2519>>IF       2519>>IF
VID.SNLIST.SIZE
       947**DCL      2379>>ASSIGN   2519>>IF
VID.VOLCNT
       944**DCL      2469<<ASSIGN   2519>>IF
VID.VSN
       944**DCL      2451>>CALLBLT  2462<<ASSIGN   2463<<ASSIGN   2467<<ASSIGN   2468>>IF       2471>>ASSIGN
VID$
      2309**DCL       944--IMP-PTR  2374<>CALL     2379>>ASSIGN   2383<>CALL     2384>>ASSIGN   2387>>ASSIGN
      2451>>CALLBLT  2462>>ASSIGN   2463>>ASSIGN   2467>>ASSIGN   2468>>IF       2469>>ASSIGN   2471>>ASSIGN
PL6.E3A0      #001=FMN$SETX File=FMN$OPNDP.:E05TSI                               TUE 07/29/97 16:52 Page:65   
      2515<>CALL     2516>>ASSIGN   2519>>IF       2519>>IF       2519>>IF       2519>>IF       2519>>IF
VID0
       950**DCL      2516<<ASSIGN
VID0.DTT
       952**DCL       952--REDEF
VID0.PSN
       950**DCL      2519>>IF
VID0.SNLIST
       953**DCL      2519>>IF       2519>>IF
VID0.SNLIST.VSN
       953**DCL      2476>>IF
VID0.SNLIST.VSN.N
       953**DCL      2467>>ASSIGN
VID0.VOLCNT
       950**DCL      2377>>DOINDEX  2519>>IF
VID0$
      2310**DCL       950--IMP-PTR   958--IMP-PTR   966--IMP-PTR  2373<>CALL     2377>>DOINDEX  2384<<ASSIGN
      2385<>CALL     2386>>ASSIGN   2387<<ASSIGN   2388<>CALL     2389>>ASSIGN   2390>>ASSIGN   2390>>ASSIGN
      2467>>ASSIGN   2476>>IF       2516>>ASSIGN   2519>>IF       2519>>IF       2519>>IF       2519>>IF
VOL
      2311**DCL      2440<<ASSIGN   2441>>DOWHILE  2442>>ASSIGN   2449<<ASSIGN   2449>>ASSIGN   2461<<ASSIGN
      2462>>IF       2463>>ASSIGN   2473<<ASSIGN   2474>>DOWHILE  2475>>ASSIGN   2476>>IF       2477>>ASSIGN
      2478<<ASSIGN   2478>>ASSIGN   2481>>IF       2483>>IF       2486<<ASSIGN   2487>>DOWHILE  2487>>DOWHILE
      2488<<ASSIGN   2488>>ASSIGN   2490>>IF       2494>>IF       2506>>IF       2514>>ASSIGN   2529>>ASSIGN
      2530>>ASSIGN

PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:66   
      299        1        /*T***********************************************************/
      300        2        /*T*                                                         */
      301        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      302        4        /*T*                                                         */
      303        5        /*T***********************************************************/
      304        6                    /*F*     NAME: FMN$AVR
      305        7                    *        PURPOSE: To respond to the special interrupt for disks.
      306        8                    *        DESCRIPTION: When a diskpack is loaded or unloaded, it
      307        9                    *        generates an interrupt, which IOQ sends to FMN$AVR to
      308       10                    *        inform the world. It sets FM$DEV.AVR(DCTX) if the 'upness'
      309       11                    *        of the device has changed, inverting FM$DEV.SPIN(DCTX),
      310       12                    *        and writing an AVR message to PIG through the CSCG if PIG
      311       13                    *        is running.
      312       14                    *        (see FMN$OPNDP).
      313       15                    *        CALL: CALL FMN$AVR(DCTX,STATUS);
      314       16                    */
      315       17        FMN$AVR: PROC(DCTX_PRM,STATUS);
      316       18        %INCLUDE FM$MACROS;
      317      393        %FM$DEV(BASED="BASED(DEV$)", ARY=);
      318      399        %FM$DEV(FM$DEV=FM$DEVARRAY,BASED="BASED(FM$SET$)");
      319      405        %INCLUDE JG_GHOSTS_C;
      320      495        %INCLUDE B$USER;
      321      711        %B$USERREFS;
      322      715        %INCLUDE SS_SCHED_C;
      323      948        %INCLUDE OCI_SUBS_C;
      324     1046        %INCLUDE NI$TABLES;
      325     1262        %NI$DCT;
      326     1310    1   DCL N$DCT$$ PTR SYMREF;
      327     1311    1   DCL N$DCT$(0:0) PTR BASED(N$DCT$$);
      328     1312        %INCLUDE FR$RAT;
      329     1365        %FR$RAT(NAME=BRAT);
      330     1405        %INCLUDE NI_DATA_C;
      331     1518    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      332     1519    1   DCL 1 STATUS ALIGNED,
      333     1520    1         2 * BIT(18),
      334     1521    1         2 CODE UBIN(18)UNAL;
      335     1522    1   DCL DCTX_PRM UBIN(15) UNAL;
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:67   
      336     1523    1   DCL DEV$ PTR;
      337     1524    1   DCL RAT$ PTR;
      338     1525        %FR$RAT(NAME=ARAT,STCLASS=AUTO);
      339     1565    1   DCL DCTX SBIN;
      340     1566    1   DCL N_DCTXMAX SBIN SYMREF ALIGNED; /* Max DCTX index */
      341     1567    1   DCL FM$SET$ PTR SYMREF READONLY;
      342     1568    1   DCL FM_GCT UBIN SYMREF;
      343     1569        %JG_GHOSTS(STCLASS=SYMREF);
      344     1607    1   DCL 1 AVRM CONSTANT,
      345     1608    1         2 * BIT(18)INIT('0'B),
      346     1609    1         2 * BIT(18)INIT(K_DISK),
      347     1610    1         2 * CHAR(6)INIT(' ');
      348     1611
      349     1612                    /* Procedure */
      350     1613
      351     1614    2   INHIB: DO INHIBIT;
      352     1615    2         IF FM_GCT=0 THEN EXIT; /* Ignore it if not initialized yet */
      353     1616    2         DCTX=DCTX_PRM ;
      354     1617    2         IF DCTX=0 OR DCTX>N_DCTXMAX THEN EXIT; /* Bad DCTX */
      355     1618    2         DEV$=ADDR(FM$DEVARRAY(DCTX)) ;
      356     1619    2         IF DCTX~=FM$DEV.DCTX THEN EXIT; /* Bad DCTX */
      357     1620    2         IF STATUS.CODE=0 THEN EXIT;
      358     1621    3         IF FM$DEV.SPIN THEN DO;
      359     1622    3            IF STATUS.CODE=%NI_AVR_READY THEN EXIT INHIB;
      360     1623    3            IF STATUS.CODE=%NI_AVR_MIRROR THEN FM$DEV.MRRCHK='1'B;
      361     1624    3            ELSE FM$DEV.SPIN='0'B;
      362     1625    3            END;
      363     1626    3         ELSE DO;
      364     1627    3            IF STATUS.CODE=%NI_AVR_MIRROR THEN FM$DEV.MRRCHK='1'B;
      365     1628    3            ELSE IF STATUS.CODE~=%NI_AVR_READY THEN EXIT INHIB;
      366     1629    3            FM$DEV.SPIN='1'B;
      367     1630    3            END;
      368     1631    2         FM$DEV.AVR='1'B;
      369     1632    2         IF B$USRT$->B$USER.US(JG_PIG#)~=%SS_SNULL
      370     1633    2         THEN CALL KUW$WRITE(AVRM,10,J_PIG);
      371     1634    2         END;
      372     1635    1      RETURN;
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:68   
      373     1636        %EJECT;
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:69   
      374     1637    1   FMN$MRRSWITCH: ENTRY(DCTX_PRM);
      375     1638                    /*F*     NAME: FMN$MRRSWITCH
      376     1639                    *        PURPOSE: To switch the primary and secondary of a mirror pair.
      377     1640                    *        DESCRIPTION: If the primary device of a mirror pair fails, it
      378     1641                    *        becomes necessary to make file management think the files are
      379     1642                    *        really on the secondary device, so that it will use that DCTX
      380     1643                    *        when talking about the device to NI routines.  All that's
      381     1644                    *        required is to hook the FM$VOL chain to the secondary's FM$DEV
      382     1645                    *        instead of the primary's, and change all the FM$VOL.DCTX's in
      383     1646                    *        the chain to point to the secondary device.
      384     1647                    *        CALL: CALL FMN$MRRSWITCH (DCTX-UNAL-UBIN15);
      385     1648                    */
      386     1649    2      DO INHIBIT;
      387     1650    2         DEV$=ADDR(FM$DEVARRAY(DCTX_PRM));
      388     1651    2         DCTX=FM$DEV.MRRDCTX;
      389     1652    2         IF DCTX=0 THEN
      390     1653    2            DCTX=N$DCT$(DCTX_PRM)->NI$DCT.DP.MIRROR.DCTX;
      391     1654    2         RAT$=N$DCT$(DCTX)->NI$DCT.RAT$;
      392     1655    2         ARAT=RAT$->BRAT;
      393     1656    2         ARAT.LNK$=N$DCT$(FM$DEV.DCTX)->NI$DCT.RAT$;
      394     1657    2         RAT$->BRAT.RES=ARAT.LNK$->BRAT.RES;
      395     1658    2         RAT$->BRAT.REEL=ARAT.LNK$->BRAT.REEL;
      396     1659    2         ARAT.LNK$->BRAT.FLG.OPN=ARAT.FLG.OPN;
      397     1660    2         ARAT.LNK$->BRAT.FLG.MBIT=ARAT.FLG.MBIT;
      398     1661    2         ARAT.LNK$->BRAT.RES=ARAT.RES;
      399     1662    2         ARAT.LNK$->BRAT.REEL=ARAT.REEL;
      400     1663    2         FM$DEVARRAY.SECTL(DCTX)=FM$DEV.SECTL;
      401     1664    2         FM$DEV.SECTL=0;
      402     1665    2         DEV$=ADDR(FM$DEVARRAY(DCTX));
      403     1666    3         DO WHILE '1'B;
      404     1667    3            IF FM$DEV.SECTL=0 THEN EXIT;
      405     1668    3            DEV$=ADDR(FM$DEVARRAY(FM$DEV.SECTL));
      406     1669    3            FM$DEV.DCTX=DCTX;
      407     1670    3            END;
      408     1671    2         END;
      409     1672    1      RETURN;
      410     1673    1   END FMN$AVR;
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:70   
      411     1674        %EOD;

PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:71   
--  Include file information  --

   NI_DATA_C.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$AVR.

   Procedure FMN$AVR requires 140 words for executable code.
   Procedure FMN$AVR requires 20 words of local(AUTO) storage.

PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:72   

 Object Unit name= FMN$AVR                                    File name= FMN$OPNDP.:E05TOU
 UTS= JUL 29 '97 16:52:39.08 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      3      3  FMN$AVR
    1   Proc  even  none   140    214  FMN$AVR
    2  RoData even  none     5      5  FMN$AVR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        2  FMN$AVR
     1     71                  yes      Std        1  FMN$MRRSWITCH

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KUW$WRITE
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:73   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$USRT$                               N$DCT$$                               N_DCTXMAX
r    FM$SET$                               FM_GCT                                J_PIG
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:74   


      299        1        /*T***********************************************************/
      300        2        /*T*                                                         */
      301        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      302        4        /*T*                                                         */
      303        5        /*T***********************************************************/
      304        6                    /*F*     NAME: FMN$AVR
      305        7                    *        PURPOSE: To respond to the special interrupt for disks.
      306        8                    *        DESCRIPTION: When a diskpack is loaded or unloaded, it
      307        9                    *        generates an interrupt, which IOQ sends to FMN$AVR to
      308       10                    *        inform the world. It sets FM$DEV.AVR(DCTX) if the 'upness'
      309       11                    *        of the device has changed, inverting FM$DEV.SPIN(DCTX),
      310       12                    *        and writing an AVR message to PIG through the CSCG if PIG
      311       13                    *        is running.
      312       14                    *        (see FMN$OPNDP).
      313       15                    *        CALL: CALL FMN$AVR(DCTX,STATUS);
      314       16                    */
      315       17        FMN$AVR: PROC(DCTX_PRM,STATUS);

     17  1 000000   000000 700200 xent  FMN$AVR      TSX0  ! X66_AUTO_2
         1 000001   000024 000002                    ZERO    20,2

      316       18        %INCLUDE FM$MACROS;
      317      393        %FM$DEV(BASED="BASED(DEV$)", ARY=);
      318      399        %FM$DEV(FM$DEV=FM$DEVARRAY,BASED="BASED(FM$SET$)");
      319      405        %INCLUDE JG_GHOSTS_C;
      320      495        %INCLUDE B$USER;
      321      711        %B$USERREFS;
      322      715        %INCLUDE SS_SCHED_C;
      323      948        %INCLUDE OCI_SUBS_C;
      324     1046        %INCLUDE NI$TABLES;
      325     1262        %NI$DCT;
      326     1310    1   DCL N$DCT$$ PTR SYMREF;
      327     1311    1   DCL N$DCT$(0:0) PTR BASED(N$DCT$$);
      328     1312        %INCLUDE FR$RAT;
      329     1365        %FR$RAT(NAME=BRAT);
      330     1405        %INCLUDE NI_DATA_C;
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:75   
      331     1518    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      332     1519    1   DCL 1 STATUS ALIGNED,
      333     1520    1         2 * BIT(18),
      334     1521    1         2 CODE UBIN(18)UNAL;
      335     1522    1   DCL DCTX_PRM UBIN(15) UNAL;
      336     1523    1   DCL DEV$ PTR;
      337     1524    1   DCL RAT$ PTR;
      338     1525        %FR$RAT(NAME=ARAT,STCLASS=AUTO);
      339     1565    1   DCL DCTX SBIN;
      340     1566    1   DCL N_DCTXMAX SBIN SYMREF ALIGNED; /* Max DCTX index */
      341     1567    1   DCL FM$SET$ PTR SYMREF READONLY;
      342     1568    1   DCL FM_GCT UBIN SYMREF;
      343     1569        %JG_GHOSTS(STCLASS=SYMREF);
      344     1607    1   DCL 1 AVRM CONSTANT,
      345     1608    1         2 * BIT(18)INIT('0'B),
      346     1609    1         2 * BIT(18)INIT(K_DISK),
      347     1610    1         2 * CHAR(6)INIT(' ');
      348     1611
      349     1612                    /* Procedure */
      350     1613
      351     1614    2   INHIB: DO INHIBIT;

   1614  1 000002                       INHIB        null
      352     1615    2         IF FM_GCT=0 THEN EXIT; /* Ignore it if not initialized yet */

   1615  1 000002   000000 235200 xsym               LDA   ! FM_GCT
         1 000003   000070 600200 1                  TZE   ! s:1635

      353     1616    2         DCTX=DCTX_PRM ;

   1616  1 000004   200003 470700                    LDP0  ! @DCTX_PRM,,AUTO
         1 000005   003100 061700                    CSR   ! bolr='003'O
         1 000006   000000 000017                    BDSC    0,,PR0                   by=0,bit=0,n=15
         1 000007   200020 000044                    BDSC    DCTX,,AUTO               by=0,bit=0,n=36

      354     1617    2         IF DCTX=0 OR DCTX>N_DCTXMAX THEN EXIT; /* Bad DCTX */

PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:76   
   1617  1 000010   200020 236300                    LDQ   ! DCTX,,AUTO
         1 000011   000070 600200 1                  TZE   ! s:1635
         1 000012   000000 116200 xsym               CMPQ  ! N_DCTXMAX
         1 000013   000070 605600 1                  TPNZ  ! s:1635

      355     1618    2         DEV$=ADDR(FM$DEVARRAY(DCTX)) ;

   1618  1 000014   000025 736200                    QLS   ! 21
         1 000015   000000 036200 xsym               ADLQ  ! FM$SET$
         1 000016   200005 756300                    STQ   ! DEV$,,AUTO

      356     1619    2         IF DCTX~=FM$DEV.DCTX THEN EXIT; /* Bad DCTX */

   1619  1 000017   200005 471700                    LDP1  ! DEV$,,AUTO
         1 000020   100000 236300                    LDQ   ! 0,,PR1
         1 000021   000022 772200                    QRL   ! 18
         1 000022   200020 116300                    CMPQ  ! DCTX,,AUTO
         1 000023   000070 601200 1                  TNZ   ! s:1635

      357     1620    2         IF STATUS.CODE=0 THEN EXIT;

   1620  1 000024   200004 473700                    LDP3  ! @STATUS,,AUTO
         1 000025   300000 720300                    LXL0  ! 0,,PR3
         1 000026   000070 600200 1                  TZE   ! s:1635

      358     1621    3         IF FM$DEV.SPIN THEN DO;

   1621  1 000027   100002 236300                    LDQ   ! 2,,PR1
         1 000030   004000 316203                    CANQ  ! 2048,DU
         1 000031   000044 600200 1                  TZE   ! s:1627

      359     1622    3            IF STATUS.CODE=%NI_AVR_READY THEN EXIT INHIB;

   1622  1 000032   000001 100203                    CMPX0 ! 1,DU
         1 000033   000070 600200 1                  TZE   ! s:1635

      360     1623    3            IF STATUS.CODE=%NI_AVR_MIRROR THEN FM$DEV.MRRCHK='1'B;
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:77   

   1623  1 000034   000005 100203                    CMPX0 ! 5,DU
         1 000035   000041 601200 1                  TNZ   ! s:1624

   1623  1 000036   001000 236203                    LDQ   ! 512,DU
         1 000037   100002 256300                    ORSQ  ! 2,,PR1
         1 000040   000055 710200 1                  TRA   ! s:1631

      361     1624    3            ELSE FM$DEV.SPIN='0'B;

   1624  1 000041   000000 236200 2                  LDQ   ! 0
         1 000042   100002 356300                    ANSQ  ! 2,,PR1

      362     1625    3            END;

   1625  1 000043   000055 710200 1                  TRA   ! s:1631

      363     1626    3         ELSE DO;

      364     1627    3            IF STATUS.CODE=%NI_AVR_MIRROR THEN FM$DEV.MRRCHK='1'B;

   1627  1 000044   000005 100203                    CMPX0 ! 5,DU
         1 000045   000051 601200 1                  TNZ   ! s:1628

   1627  1 000046   001000 236203                    LDQ   ! 512,DU
         1 000047   100002 256300                    ORSQ  ! 2,,PR1
         1 000050   000053 710200 1                  TRA   ! s:1629

      365     1628    3            ELSE IF STATUS.CODE~=%NI_AVR_READY THEN EXIT INHIB;

   1628  1 000051   000001 100203                    CMPX0 ! 1,DU
         1 000052   000070 601200 1                  TNZ   ! s:1635

      366     1629    3            FM$DEV.SPIN='1'B;

   1629  1 000053   004000 236203                    LDQ   ! 2048,DU
         1 000054   100002 256300                    ORSQ  ! 2,,PR1
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:78   

      367     1630    3            END;

      368     1631    2         FM$DEV.AVR='1'B;

   1631  1 000055   010000 236203                    LDQ   ! 4096,DU
         1 000056   100002 256300                    ORSQ  ! 2,,PR1

      369     1632    2         IF B$USRT$->B$USER.US(JG_PIG#)~=%SS_SNULL

   1632  1 000057   000000 474600 xsym               LDP4  ! B$USRT$
         1 000060   400171 236300                    LDQ   ! 121,,PR4
         1 000061   770000 376203                    ANQ   ! -4096,DU
         1 000062   300000 116203                    CMPQ  ! 98304,DU
         1 000063   000070 600200 1                  TZE   ! s:1635

      370     1633    2         THEN CALL KUW$WRITE(AVRM,10,J_PIG);

   1633  1 000064   000001 630600 2                  EPPR0 ! 1
         1 000065   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         1 000066   000000 701200 xent               TSX1  ! KUW$WRITE
         1 000067   000000 011200                    NOP   ! 0

      371     1634    2         END;

      372     1635    1      RETURN;

   1635  1 000070   000000 702200 xent               TSX2  ! X66_ARET

      373     1636        %EJECT;
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:79   
      374     1637    1   FMN$MRRSWITCH: ENTRY(DCTX_PRM);

   1637  1 000071   000000 700200 xent  FMN$MRRSWIT* TSX0  ! X66_AUTO_2
         1 000072   000024 000002                    ZERO    20,2

      375     1638                    /*F*     NAME: FMN$MRRSWITCH
      376     1639                    *        PURPOSE: To switch the primary and secondary of a mirror pair.
      377     1640                    *        DESCRIPTION: If the primary device of a mirror pair fails, it
      378     1641                    *        becomes necessary to make file management think the files are
      379     1642                    *        really on the secondary device, so that it will use that DCTX
      380     1643                    *        when talking about the device to NI routines.  All that's
      381     1644                    *        required is to hook the FM$VOL chain to the secondary's FM$DEV
      382     1645                    *        instead of the primary's, and change all the FM$VOL.DCTX's in
      383     1646                    *        the chain to point to the secondary device.
      384     1647                    *        CALL: CALL FMN$MRRSWITCH (DCTX-UNAL-UBIN15);
      385     1648                    */
      386     1649    2      DO INHIBIT;

      387     1650    2         DEV$=ADDR(FM$DEVARRAY(DCTX_PRM));

   1650  1 000073   200003 470700                    LDP0  ! @DCTX_PRM,,AUTO
         1 000074   003100 061700                    CSR   ! bolr='003'O
         1 000075   000000 000017                    BDSC    0,,PR0                   by=0,bit=0,n=15
         1 000076   200022 000044                    BDSC    DCTX+2,,AUTO             by=0,bit=0,n=36
         1 000077   200022 236300                    LDQ   ! DCTX+2,,AUTO
         1 000100   000003 736200                    QLS   ! 3
         1 000101   000022 736200                    QLS   ! 18
         1 000102   000000 036200 xsym               ADLQ  ! FM$SET$
         1 000103   200005 756300                    STQ   ! DEV$,,AUTO

      388     1651    2         DCTX=FM$DEV.MRRDCTX;

   1651  1 000104   200005 471700                    LDP1  ! DEV$,,AUTO
         1 000105   100006 235300                    LDA   ! 6,,PR1
         1 000106   200020 755300                    STA   ! DCTX,,AUTO

      389     1652    2         IF DCTX=0 THEN
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:80   

   1652  1 000107   000121 601200 1                  TNZ   ! s:1654

      390     1653    2            DCTX=N$DCT$(DCTX_PRM)->NI$DCT.DP.MIRROR.DCTX;

   1653  1 000110   003100 061700                    CSR   ! bolr='003'O
         1 000111   000000 000017                    BDSC    0,,PR0                   by=0,bit=0,n=15
         1 000112   200022 000022                    BDSC    DCTX+2,,AUTO             by=0,bit=0,n=18
         1 000113   200022 220300                    LDX0  ! DCTX+2,,AUTO
         1 000114   000000 473600 xsym               LDP3  ! N$DCT$$
         1 000115   300000 474710                    LDP4  ! 0,X0,PR3
         1 000116   400037 236300                    LDQ   ! 31,,PR4
         1 000117   000022 772200                    QRL   ! 18
         1 000120   200020 756300                    STQ   ! DCTX,,AUTO

      391     1654    2         RAT$=N$DCT$(DCTX)->NI$DCT.RAT$;

   1654  1 000121   000000 473600 xsym               LDP3  ! N$DCT$$
         1 000122   200020 720300                    LXL0  ! DCTX,,AUTO
         1 000123   300000 474710                    LDP4  ! 0,X0,PR3
         1 000124   400005 236300                    LDQ   ! 5,,PR4
         1 000125   200006 756300                    STQ   ! RAT$,,AUTO

      392     1655    2         ARAT=RAT$->BRAT;

   1655  1 000126   200006 475700                    LDP5  ! RAT$,,AUTO
         1 000127   000100 100700                    MLR   ! fill='000'O
         1 000130   500000 000044                    ADSC9   0,,PR5                   cn=0,n=36
         1 000131   200007 000044                    ADSC9   ARAT,,AUTO               cn=0,n=36

      393     1656    2         ARAT.LNK$=N$DCT$(FM$DEV.DCTX)->NI$DCT.RAT$;

   1656  1 000132   100000 221300                    LDX1  ! 0,,PR1
         1 000133   300000 476711                    LDP6  ! 0,X1,PR3
         1 000134   600005 236300                    LDQ   ! 5,,PR6
         1 000135   200007 756300                    STQ   ! ARAT,,AUTO

PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:81   
      394     1657    2         RAT$->BRAT.RES=ARAT.LNK$->BRAT.RES;

   1657  1 000136   200007 477700                    LDP7  ! ARAT,,AUTO
         1 000137   000100 100700                    MLR   ! fill='000'O
         1 000140   700001 000011                    ADSC9   1,,PR7                   cn=0,n=9
         1 000141   500001 000011                    ADSC9   1,,PR5                   cn=0,n=9

      395     1658    2         RAT$->BRAT.REEL=ARAT.LNK$->BRAT.REEL;

   1658  1 000142   000100 100700                    MLR   ! fill='000'O
         1 000143   700004 000010                    ADSC9   4,,PR7                   cn=0,n=8
         1 000144   500004 000010                    ADSC9   4,,PR5                   cn=0,n=8

      396     1659    2         ARAT.LNK$->BRAT.FLG.OPN=ARAT.FLG.OPN;

   1659  1 000145   200017 236300                    LDQ   ! ARAT+8,,AUTO
         1 000146   700010 676300                    ERQ   ! 8,,PR7
         1 000147   000020 376207                    ANQ   ! 16,DL
         1 000150   700010 656300                    ERSQ  ! 8,,PR7

      397     1660    2         ARAT.LNK$->BRAT.FLG.MBIT=ARAT.FLG.MBIT;

   1660  1 000151   200017 236300                    LDQ   ! ARAT+8,,AUTO
         1 000152   700010 676300                    ERQ   ! 8,,PR7
         1 000153   000700 376207                    ANQ   ! 448,DL
         1 000154   700010 656300                    ERSQ  ! 8,,PR7

      398     1661    2         ARAT.LNK$->BRAT.RES=ARAT.RES;

   1661  1 000155   000100 100700                    MLR   ! fill='000'O
         1 000156   200010 000011                    ADSC9   ARAT+1,,AUTO             cn=0,n=9
         1 000157   700001 000011                    ADSC9   1,,PR7                   cn=0,n=9

      399     1662    2         ARAT.LNK$->BRAT.REEL=ARAT.REEL;

   1662  1 000160   000100 100700                    MLR   ! fill='000'O
         1 000161   200013 000010                    ADSC9   ARAT+4,,AUTO             cn=0,n=8
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:82   
         1 000162   700004 000010                    ADSC9   4,,PR7                   cn=0,n=8

      400     1663    2         FM$DEVARRAY.SECTL(DCTX)=FM$DEV.SECTL;

   1663  1 000163   200020 235300                    LDA   ! DCTX,,AUTO
         1 000164   000003 735200                    ALS   ! 3
         1 000165   100005 721300                    LXL1  ! 5,,PR1
         1 000166   000000 474600 xsym               LDP4  ! FM$SET$
         1 000167   400005 441305                    SXL1  ! 5,AL,PR4

      401     1664    2         FM$DEV.SECTL=0;

   1664  1 000170   000000 222203                    LDX2  ! 0,DU
         1 000171   100005 442300                    SXL2  ! 5,,PR1

      402     1665    2         DEV$=ADDR(FM$DEVARRAY(DCTX));

   1665  1 000172   200020 236300                    LDQ   ! DCTX,,AUTO
         1 000173   000025 736200                    QLS   ! 21
         1 000174   000000 036200 xsym               ADLQ  ! FM$SET$
         1 000175   200005 756300                    STQ   ! DEV$,,AUTO

      403     1666    3         DO WHILE '1'B;

      404     1667    3            IF FM$DEV.SECTL=0 THEN EXIT;

   1667  1 000176   200005 470700                    LDP0  ! DEV$,,AUTO
         1 000177   000005 720300                    LXL0  ! 5,,PR0
         1 000200   000213 600200 1                  TZE   ! s:1672

      405     1668    3            DEV$=ADDR(FM$DEVARRAY(FM$DEV.SECTL));

   1668  1 000201   000005 236300                    LDQ   ! 5,,PR0
         1 000202   000003 736200                    QLS   ! 3
         1 000203   000004 376200 2                  ANQ   ! 4
         1 000204   000022 736200                    QLS   ! 18
         1 000205   000000 036200 xsym               ADLQ  ! FM$SET$
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:83   
         1 000206   200005 756300                    STQ   ! DEV$,,AUTO

      406     1669    3            FM$DEV.DCTX=DCTX;

   1669  1 000207   200020 720300                    LXL0  ! DCTX,,AUTO
         1 000210   200005 470700                    LDP0  ! DEV$,,AUTO
         1 000211   000000 740300                    STX0  ! 0,,PR0

      407     1670    3            END;

   1670  1 000212   000176 710200 1                  TRA   ! s:1667

      408     1671    2         END;

      409     1672    1      RETURN;

   1672  1 000213   000000 702200 xent               TSX2  ! X66_ARET

AVRM
 Sect OctLoc
   0     000   000000 100000   040040 040040   040040 ******                    ..@.      ..

(unnamed)
 Sect OctLoc
   2     000   773777 777777   000000 006000   000014 006000   000000 006000    ................
   2     004   000007 777770                                                    ....
      410     1673    1   END FMN$AVR;
      411     1674        %EOD;

PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:84   
--  Include file information  --

   NI_DATA_C.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$AVR.
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:85   

 **** Variables and constants ****

  ****  Section 000 RoData FMN$AVR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(90)    r     1 AVRM

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DCTX_PRM                  4-0-0/w PTR         r     1 @STATUS
     7-0-0/w STRC(324)   r     1 ARAT                      20-0-0/w SBIN        r     1 DCTX
    *0-0-0/b UBIN(15)    r     1 DCTX_PRM                   5-0-0/w PTR         r     1 DEV$
     6-0-0/w PTR         r     1 RAT$                      *0-0-0/w STRC        r     1 STATUS

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/w PTR         r     1 FM$SET$
     0-0-0/w UBIN        r     1 FM_GCT                     0-0-0/d CHAR(8)     r     1 J_PIG
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w SBIN        r     1 N_DCTXMAX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/w STRC(324)   r     1 BRAT
     0-0-0/w STRC(288)   r     1 FM$DEV
     0-0-0/w STRC(288)   r     1 FM$DEVARRAY(0:0)
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/w STRC(1332)  r     1 NI$DCT
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:86   


   Procedure FMN$AVR requires 140 words for executable code.
   Procedure FMN$AVR requires 20 words of local(AUTO) storage.
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:87   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:88   
          MINI XREF LISTING

ARAT
      1527**DCL      1655<<ASSIGN
ARAT.FLG.MBIT
      1554**DCL      1660>>ASSIGN
ARAT.FLG.OPN
      1559**DCL      1659>>ASSIGN
ARAT.LNK$
      1528**DCL      1656<<ASSIGN   1657>>ASSIGN   1658>>ASSIGN   1659>>ASSIGN   1660>>ASSIGN   1661>>ASSIGN
      1662>>ASSIGN
ARAT.REEL
      1546**DCL      1662>>ASSIGN
ARAT.RES
      1529**DCL      1661>>ASSIGN
AVRM
      1607**DCL      1633<>CALL
B$DO.ECCINFO
       646**DCL       647--REDEF
B$U.MISC
       625**DCL       626--REDEF
B$USER.MISC
       701**DCL       702--REDEF
B$USER.US
       688**DCL      1632>>IF
B$USRT$
       713**DCL      1632>>IF
BRAT
      1367**DCL      1655>>ASSIGN
BRAT.FLG.MBIT
      1394**DCL      1660<<ASSIGN
BRAT.FLG.OPN
      1399**DCL      1659<<ASSIGN
BRAT.REEL
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:89   
      1386**DCL      1658<<ASSIGN   1658>>ASSIGN   1662<<ASSIGN
BRAT.RES
      1369**DCL      1657<<ASSIGN   1657>>ASSIGN   1661<<ASSIGN
DCTX
      1565**DCL      1616<<ASSIGN   1617>>IF       1617>>IF       1618>>ASSIGN   1619>>IF       1651<<ASSIGN
      1652>>IF       1653<<ASSIGN   1654>>ASSIGN   1663>>ASSIGN   1665>>ASSIGN   1669>>ASSIGN
DCTX_PRM
      1522**DCL        17--PROC     1616>>ASSIGN   1637--ENTRY    1650>>ASSIGN   1653>>ASSIGN
DEV$
      1523**DCL       394--IMP-PTR  1618<<ASSIGN   1619>>IF       1621>>IF       1623>>ASSIGN   1624>>ASSIGN
      1627>>ASSIGN   1629>>ASSIGN   1631>>ASSIGN   1650<<ASSIGN   1651>>ASSIGN   1656>>ASSIGN   1663>>ASSIGN
      1664>>ASSIGN   1665<<ASSIGN   1667>>IF       1668<<ASSIGN   1668>>ASSIGN   1669>>ASSIGN
FM$DEV.AVR
       395**DCL      1631<<ASSIGN
FM$DEV.DCTX
       394**DCL      1619>>IF       1656>>ASSIGN   1669<<ASSIGN
FM$DEV.MRRCHK
       395**DCL      1623<<ASSIGN   1627<<ASSIGN
FM$DEV.MRRDCTX
       397**DCL      1651>>ASSIGN
FM$DEV.SECTL
       396**DCL      1663>>ASSIGN   1664<<ASSIGN   1667>>IF       1668>>ASSIGN
FM$DEV.SPIN
       395**DCL      1621>>IF       1624<<ASSIGN   1629<<ASSIGN
FM$DEV.USERLIST
       395**DCL       396--REDEF
FM$DEVARRAY
       400**DCL      1618--ASSIGN   1650--ASSIGN   1665--ASSIGN   1668--ASSIGN
FM$DEVARRAY.SECTL
       402**DCL      1663<<ASSIGN
FM$DEVARRAY.USERLIST
       401**DCL       402--REDEF
FM$SET$
      1567**DCL       400--IMP-PTR  1618>>ASSIGN   1650>>ASSIGN   1663>>ASSIGN   1665>>ASSIGN   1668>>ASSIGN
FM_GCT
      1568**DCL      1615>>IF
PL6.E3A0      #002=FMN$AVR File=FMN$OPNDP.:E05TSI                                TUE 07/29/97 16:52 Page:90   
INHIB
      1614**LABEL    1622--EXIT     1628--EXIT
J_PIG
      1596**DCL      1633<>CALL
KUW$WRITE
      1518**DCL-ENT  1633--CALL
N$DCT$
      1311**DCL      1653>>ASSIGN   1654>>ASSIGN   1656>>ASSIGN
N$DCT$$
      1310**DCL      1311--IMP-PTR  1653>>ASSIGN   1654>>ASSIGN   1656>>ASSIGN
NI$DCT.DP
      1291**DCL      1298--REDEF    1301--REDEF    1302--REDEF    1304--REDEF    1304--REDEF    1305--REDEF
      1306--REDEF    1306--REDEF
NI$DCT.DP.MIRROR.DCTX
      1296**DCL      1653>>ASSIGN
NI$DCT.MPC.IOCHANX
      1299**DCL      1299--REDEF
NI$DCT.RAT$
      1272**DCL      1654>>ASSIGN   1656>>ASSIGN
N_DCTXMAX
      1566**DCL      1617>>IF
RAT$
      1524**DCL      1654<<ASSIGN   1655>>ASSIGN   1657>>ASSIGN   1658>>ASSIGN
STATUS
      1519**DCL        17--PROC
STATUS.CODE
      1521**DCL      1620>>IF       1622>>IF       1623>>IF       1627>>IF       1628>>IF

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:91   
      412        1        /*T***********************************************************/
      413        2        /*T*                                                         */
      414        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      415        4        /*T*                                                         */
      416        5        /*T***********************************************************/
      417        6                    /*F*     NAME: FMN$OPNDP
      418        7                  *        PURPOSE: To open a DCB to diskpack or set thereof in device mode.
      419        8                   *        DESCRIPTION: The diskpack(s) to be accessed are specified by the
      420        9                    *        sn vlp of the open FPT. If the SN is blank and the user is PIG,
      421       10                    *        a disk with FM$DEV.AVR set is opened and AVR reset. If the SN
      422       11                    *        bytes are snnnxx, nnn is a UBIN VSN and s is a UBIN
      423       12                    *        section number (less than 32). If they are 0xxxnn,
      424       13                    *        nn is a UBIN DCTX. 0DPnnx is device DPnn if not a set name.
      425       14                    *        Otherwise, the SN is a PSN and the set will be mounted if not
      426       15                  *        already, all its volumes are up, and the resources are available.
      427       16              *        IFPARAM and FPARAM are used in the latter case to set and retrieve
      428       17              *        the FD FIT (CODE14 and CODE09) for F$DCB.ACCT, or the PAD FIT
      429       18              *        if F$DCB.ACCT is BINASC(0). In this case, the DCB is not opened.
      430       19              *        If DELETE is also set, the account is removed from the PAD.
      431       20              *        The user must have FMDIAG privilege or be a set owner to open
      432       21              *        the DCB or delete an account. FPARAM only needs no privilege
      433       22              *        but if none, does not return CODE14.OWNER or CODE04.CREATOR.
      434       23              *        IFPARAM requires FMDIAG, set owner, or account owner. If only
      435       24              *         account owner, only CODE09 and CODE14.BUPM and OWNERF can change.
      436       25              *        This is the only mechanism to create new accounts on a set
      437       26              *        where PAD FIT's CODE14.NEWFD is not set.
      438       27              *        If the DCB is opened (FPARAM and IFPARAM must be NIL),
      439       28              *        DCB.IASN is set to %FMDIAG# and FFLG.READ and FFLG.WNEW are
      440       29              *        set according to FUN, permitting full page IO to granules of
      441       30              *        the set or device, specifying a UBIN device- or set-relative
      442       31              *        disk address. If open to a device, its MODEL name is returned
      443       32              *        in DCB.ACCT. The size (in granules) of the device or the first
      444       33              *        volume of a set is returned to DCB.IXTNSIZE, its DCTX to
      445       34              *        DCB.XTNSIZE, and its device name to DCB.PASS.
      446       35              *        In any case (open or not, but no altret) DCB.OWNER is set if
      447       36              *        exclusive access to the set was obtained.
      448       37              *        CALL: CALL FMN$OPNDP(OPENFPT_POINTERS) ALTRET;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:92   
      449       38              */
      450       39        FMN$OPNDP:PROC(PN$)ALTRET;
      451       40                    /* INCLUDES */
      452       41        %INCLUDE F$JIT_C;
      453      471        %MACRO F$DCB#(BASED=BASED);
      454      472        %INCLUDE F$DCB;
      455      521        %MEND;
      456      522        %F$DCB#(BASED="BASED(JDCB$)");
      457      572        %INCLUDE F_CP6;
      458     1597        %INCLUDE F$CP6P_C;
      459     1608        %FPT$OPEN_P(FPTN=PN$,STCLASS=,PFMT=PTR);
      460     1614        %VLP_SN(STCLASS="BASED(PN$.SN_)");
      461     1627        %INCLUDE F$CP6V_C;
      462     1853        %FPT$CLOSE_V(BASED="BASED(PN$.V_)");
      463     1862        %FPT$OPEN_V(BASED="BASED(PN$.V_)");
      464     1877        %INCLUDE FM$MACROS;
      465     2252        %FM$SET(BASED="BASED(SET$)",ARY=);
      466     2257        %FM$DEV(BASED="BASED(FM$SET$)");
      467     2263        %FM$VOL(BASED="BASED(FM$SET$)");
      468     2269        %FM$VOL(FM$VOL=VOL,BASED="BASED(SET$)",ARY=);
      469     2275        %FM$DEV(FM$DEV=DEV,BASED="BASED(SET$)",ARY=);
      470     2281        %FM$SET(FM$SET=FMX$SET,BASED="BASED(FM$SET$)");
      471     2286        %FM$VID(FM$VID=VID,BASED="BASED(BUF$)");
      472     2292        %FM$SETU(BASED="BASED(CFU$)");
      473     2295        %FM$CFU(BASED="BASED(CFU$)");
      474     2301        %FM$CFUA(BASED="BASED(ACCT$)");
      475     2307        %FM$CFUX;
      476     2312        %FM$KEYTBL;
      477     2315        %FM$GRAN(BASED="BASED(BUF$)");
      478     2319        %FM$FIT(FM$FIT=IFPFIT,BASED="BASED(PN$.IFPARAM_)");
      479     2322        %FM$ADKEY(BASED="BASED(BUF$)");
      480     2325        %CODE04(BASED="BASED(DCT$)");
      481     2333        %CODE14(BASED="BASED(DCT$)");
      482     2343        %INCLUDE F_ERRORS_C;
      483     2583        %INCLUDE UD_ERRORS_C;
      484     2625        %INCLUDE CP_6_SUBS;
      485     3165        %INCLUDE JG_EVID_C;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:93   
      486     3390        %INCLUDE JG_GHOSTS_C;
      487     3480        %INCLUDE NI$TABLES;
      488     3696        %NI$DCT(STCLASS="BASED(DCT$)");
      489     3744        %NI$DVT;
      490     3751        %INCLUDE NI_DATA_C;
      491     3864        %INCLUDE N_FC_C;
      492     3901        %INCLUDE OCI_SUBS_C;
      493     3999        %INCLUDE FR$RAT;
      494     4052        %FR$RAT(STCLASS="BASED(CFU$)");
      495     4092        %INCLUDE B$USER;
      496     4308        %B$USERREFS;
      497     4312        %INCLUDE SS_SCHED_C;
      498     4545    1   DCL RECI BASED(BUF$) CHAR(I);
      499     4546                    /* ENTREFS */
      500     4547    1   DCL FAG$CGRANS ENTRY ALTRET;
      501     4548    1   DCL FMB$QUEUE ENTRY(9) ALTRET;
      502     4549    1   DCL FMC$RELSET ENTRY(1)ALTRET;
      503     4550    1   DCL FMD$GETBUF ENTRY(3);
      504     4551    1   DCL FMD$RELBUF ENTRY(1);
      505     4552    1   DCL FMD$FLSHBUF ENTRY(1);
      506     4553    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
      507     4554    1   DCL FMD$WRTBUF ENTRY(1);
      508     4555    1   DCL FMG$REMKEY ENTRY ALTRET;
      509     4556    1   DCL FMI$INIT ENTRY ALTRET; /* Set up for random-type I/O */
      510     4557    1   DCL FMM$DFLOPNP ENTRY;
      511     4558    1   DCL FMM$SCRUB ENTRY(1);
      512     4559    1   DCL FMN$CHKACCN ENTRY(1)ALTRET;
      513     4560    1   DCL FMN$RDGRAN ENTRY(2)ALTRET;
      514     4561    1   DCL FMN$READFDFIT ENTRY ALTRET;
      515     4562    1   DCL FMN$SETX ENTRY(1) ALTRET;
      516     4563    1   DCL FMO$FITSPDIR ENTRY(1)ALTRET;
      517     4564    1   DCL FMO$LOCCODE ENTRY(2)ALTRET;
      518     4565    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
      519     4566    1   DCL FMO$TRNINFO ENTRY(2)ALTRET;
      520     4567    1   DCL FMP$UDLIST ENTRY(2)ALTRET;
      521     4568    1   DCL FMP$CLSERR ENTRY(1);
      522     4569    1   DCL FMP$CLSTAR ENTRY;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:94   
      523     4570    1   DCL FMQ$BLDFD ENTRY(1) ALTRET;
      524     4571    1   DCL FMQ$BLDMAD ENTRY ALTRET;
      525     4572    1   DCL FMQ$SRCHAD ENTRY(2) ALTRET;
      526     4573    1   DCL FMR$G8 ENTRY(2) ALTRET;
      527     4574    1   DCL FMR$GA ENTRY(2)ALTRET;
      528     4575    1   DCL FMR$L8 ENTRY;
      529     4576    1   DCL FMR$U8 ENTRY;
      530     4577    1   DCL FMR$SLIDE ENTRY(3);
      531     4578    1   DCL FMR$Z8 ENTRY(1);
      532     4579    1   DCL FMS$SCANACCT ENTRY ALTRET;
      533     4580    1   DCL FMS$GARBCOL ENTRY ALTRET;
      534     4581    1   DCL FMS$RELACCT ENTRY(1)ALTRET;
      535     4582    1   DCL FRC$AVR ENTRY(3)ALTRET;
      536     4583    1   DCL FRA$OPR ENTRY ALTRET;
      537     4584    1   DCL FRZ$GETRES ENTRY(5)ALTRET;
      538     4585    1   DCL FRZ$RRES ENTRY(2);
      539     4586    1   DCL FRZ$RRESNA ENTRY(2);
      540     4587    1   DCL KQM$UPDA ENTRY(2)ALTRET;
      541     4588    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      542     4589    1   DCL OCZ$SID_UN ENTRY(4)ALTRET;
      543     4590    1   DCL SC_SETRES ENTRY CONV(2,0);
      544     4591    1   DCL SSR$RUE ENTRY(4);
      545     4592    1   DCL SSS$SYSTIME ENTRY(1);
      546     4593    1   DCL SSV$EVENT ENTRY(7);
      547     4594    1   DCL UQB$MENQS ENTRY(1)ALTRET;
      548     4595    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      549     4596    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      550     4597                    /* SYMREFS */
      551     4598    1   DCL B$JIT$ PTR SYMREF;
      552     4599    1   DCL N$DCT$$ PTR SYMREF;
      553     4600    1   DCL N$DCT$(0:0) PTR BASED(N$DCT$$);
      554     4601    1   DCL NI$DVT$(0:0) PTR SYMREF;
      555     4602    1   DCL FM$BUF$(0:0) PTR SYMREF;
      556     4603    1   DCL FM$SET$ PTR SYMREF;
      557     4604    1   DCL F$CFU$ PTR SYMREF;
      558     4605    1   DCL FM_SRZERO SBIN SYMREF;
      559     4606    1   DCL FM_PADSDA UBIN SYMREF;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:95   
      560     4607    1   DCL FM_SYSSETX UBIN SYMREF;
      561     4608    1   DCL S_CUN UBIN SYMREF;
      562     4609        %JG_GHOSTS(STCLASS=SYMREF);
      563     4647                    /* AUTO */
      564     4648    1   DCL ACCT$ PTR;
      565     4649    1   DCL ACCTX REDEF ACCT$ SBIN;
      566     4650    1   DCL 1 ACCT REDEF ACCT$,
      567     4651    1         2 * BIT(9),
      568     4652    1         2 DA UBIN(27) UNAL;
      569     4653    1   DCL DCT$ PTR;
      570     4654    1   DCL CFU$ PTR;
      571     4655    1   DCL BUF$ PTR;
      572     4656    1   DCL 1 FLAG REDEF BUF$,
      573     4657    1         2 SHARE BIT(1),
      574     4658    1         2 MAD BIT(1),
      575     4659    1         2 REL BIT(1),
      576     4660    1         2 DSMT BIT(1),
      577     4661    1         2 DSMTF BIT(1),
      578     4662    1         2 DSMTX BIT(1),
      579     4663    1         2 * BIT(30);
      580     4664    1   DCL JDCB$ PTR;
      581     4665    1   DCL DCTX UBIN;
      582     4666    1   DCL 1 DCTX1 REDEF DCTX,
      583     4667    1         2 * BIT(18),
      584     4668    1         2 SYSID BIT(18);
      585     4669    1   DCL SET$ PTR;
      586     4670    1   DCL I UBIN;
      587     4671    1   DCL IS REDEF I SBIN;
      588     4672    1   DCL 1 AVRM,
      589     4673    1         2 WORDS UBIN,
      590     4674    1         2 PSN CHAR(6),
      591     4675    1         2 SETX UBIN(18)UNAL;
      592     4676                    /* CONSTANTS */
      593     4677    1   DCL 1 DUALNAME CONSTANT,
      594     4678    1         2 * UBIN(9)UNAL INIT(5),
      595     4679    1         2 * CHAR(0)INIT(':DUAL');
      596     4680    1   DCL T$ PTR; /* TEMP. FOr use in CALLs */
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:96   
      597     4681    1   DCL T$$ PTR; /* Likewise */
      598     4682    1   DCL XT$ PTR ALIGNED BASED(T$$); /* Yet again */
      599     4683        %SUB OWNER_MODS='024400'O;
      600     4684        %SUB FCG#='0615'O;
      601     4685        %SUB MID#='16'O;
      602     4686        %ERRCODE(NAME=FMN$E$XCLSET,COD#=%E$XCLSET);
      603     4690        %ERRCODE(NAME=FMN$E$NOTAUTH,COD#=%E$NOTAUTH);
      604     4694        %ERRCODE(NAME=FMN$E$DUPSN,COD#=%E$DUPSN);
      605     4698        %ERRCODE(NAME=FMN$E$FPARAM,COD#=%E$FPARAM);
      606     4702        %ERRCODE(NAME=FMN$E$NOACCESS,COD#=%E$NOACCESS);
      607     4706        %ERRCODE(NAME=FMN$E$NOKEY,COD#=%E$NOKEY);
      608     4710        %ERRCODE(NAME=FMN$E$ACGRANS,COD#=%E$ACGRANS,SEV#=0);
      609     4714        %ERRCODE(NAME=FMN$E$BADVOL,COD#=%E$BADVOL);
      610     4718        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:97   
      611     4719                    /* PROCEDURE */
      612     4720    1      JDCB$=B$JIT.DCB$;
      613     4721    1      T$$=ADDR(T$);
      614     4722    1      IF B$JIT.PRIV.ACTIVE&%PR_FMDIAG# THEN F$DCB.IASN=%FMDIAG#;
      615     4723    1      F$DCB.SETX=0;
      616     4724    1      B$JIT.ERR='0'B;
      617     4725    1      CALL FMN$SETX(F$DCB.PSN);
      618     4726    1      IF F$DCB.SETX=0 THEN ALTRETURN;
      619     4727    1      SET$=ADDR(FMX$SET(F$DCB.SETX));
      620     4728    1      DCTX=FM$SET.DCTX;
      621     4729    1      IF DCTX=0 THEN ALTRETURN;
      622     4730    1      DCTX=FM$VOL.DCTX(DCTX);
      623     4731    1      DCT$=N$DCT$(DCTX);
      624     4732    1      IF DCT$=ADDR(NIL) THEN ALTRETURN;
      625     4733    1      F$DCB.IXTNSIZE=FM$SET.NXTSDA-FM_SRZERO;
      626     4734    1      F$DCB.PASS=NI$DCT.DEVNM;
      627     4735    1      F$DCB.XTNSIZE=DCTX;
      628     4736    1      IF B$JIT.ERR THEN ALTRETURN;
      629     4737    2      IF NOT FM$SET.SET THEN DO;
      630     4738    2         F$DCB.ACCT=NI$DCT.DVT$->NI$DVT.MODEL(NI$DCT.MODX);
      631     4739    2         IF F$DCB.SETX~=DCTX THEN DCTX=F$DCB.SETX;
      632     4740    2         ELSE DCTX=FM$DEV.SECTL(DCTX);
      633     4741    3         IF F$DCB.FUN~=%IN# THEN DO WHILE(DCTX~=0);
      634     4742    3            IF FM$VOL.SETX(DCTX)~=0 AND FMX$SET.SET(FM$VOL.SETX(DCTX))
      635     4743    3            THEN GOTO FMNE$XCLSET;
      636     4744    3            IF F$DCB.SETX~=FM$SET.DCTX THEN EXIT;
      637     4745    3            DCTX=FM$VOL.SECTL(DCTX);
      638     4746    3            END;
      639     4747    2   OPNDPX: ;
      640     4748    2         F$DCB.FFLG.READ='1'B;
      641     4749    2         IF F$DCB.FUN~=%IN# THEN F$DCB.FFLG.WNEW='1'B;
      642     4750    2         F$DCB.WCDATA='1'B;
      643     4751    2         CALL FMI$INIT;
      644     4752    2         IF NOT FM$SET.SET AND NOT DEV.SPIN THEN F$DCB.FFLG='0'B;
      645     4753    2         F$DCB.OWNER=FM$SET.XCL;
      646     4754    2         F$DCB.FCD='1'B;
      647     4755    2         RETURN;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:98   
      648     4756    2         END;
      649     4757    2      IF F$DCB.IASN~=%FMDIAG# THEN DO;
      650     4758    2         F$DCB.GTYP=FMGTPAD;
      651     4759                    /* IF NOT PRIVILEGED, USER MUST BE SET OR ACCOUNT OWNER */
      652     4760    2         T$=SET$;
      653     4761    2         CALL UQB$MENQS (XT$) ALTRET(RETALT);
      654     4762    2         CALL FMD$REDBUF (XT$,1,FM_PADSDA,,0)
      655     4763    3         WHENALTRETURN DO;
      656     4764    3            T$=SET$;
      657     4765    3            CALL UQB$MDEQ (XT$);
      658     4766    3            ALTRETURN;
      659     4767    3            END;
      660     4768    2         BUF$=PINCRW(T$,SIZEW(FM$GRAN));
      661     4769    2         CALL CHKOWNER;
      662     4770    2         CALL FMD$FLSHBUF(1);
      663     4771    2         T$=SET$;
      664     4772    2         CALL UQB$MDEQ (XT$);
      665     4773    2         IF F$DCB.OWNER THEN F$DCB.IASN=%FMDIAG#; /* SET OWNER */
      666     4774    2         ELSE IF FPT$OPEN_V.DELETE THEN GOTO FMNE$NOTAUTH;
      667     4775                    /*E*     ERROR: FMN-E$NOTAUTH-E
      668     4776                    *        MESSAGE:File management privilege inadequate.
      669     4777                    *        MESSAGE1:MAD modification requires FMDIAG privilege,
      670     4778                    *        M$OPEN NXTA requires FMSEC privilege,
      671     4779                    *        Many PIG functions require FMDIAG or PIGC privilege.
      672     4780                    */
      673     4781    2         END;
      674     4782    2      IF PN$.FPARAM_~=ADDR(NIL) OR PN$.IFPARAM_~=ADDR(NIL) THEN DO;
      675     4783        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:99   
      676     4784    3         IF PN$.IFPARAM_~=ADDR(NIL) THEN DO;
      677     4785    3            IF FPT$OPEN_V.DELETE THEN GOTO FMNE$FPARAM;
      678     4786    3            IF FM$VOL.RGRANS(FM$SET.DCTX)=0
      679     4787    3            THEN CALL FAG$CGRANS ALTRET(RETALT);
      680     4788    3            END;
      681     4789    2         CALL FMR$G8 (F$DCB.CFU$,I);
      682     4790    2         CFU$=F$DCB.CFU$;
      683     4791    2         FM$CFU.FUN=%UPDATE#;/* MAKE THE ACCOUNT BLOCK LOOK BUSY TO GARBCOL*/
      684     4792    2         CALL FMS$SCANACCT; /* GET AN ACCOUNT BLOCK */
      685     4793    2         ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);
      686     4794    2         T$=ACCT$;
      687     4795    2         CALL UQB$MENQX (XT$) ALTRET(RETALTCFU);
      688     4796    3         IF NOT FPT$OPEN_V.DELETE THEN DO;
      689     4797    3            IF FM$CFUA.FLAGS.EXIST THEN GOTO NOTNEW;
      690     4798    3            END;
      691     4799    2         T$=SET$;
      692     4800    2         CALL UQB$MENQX (XT$) ALTRET(RETALTCFU);
      693     4801    3         IF FM$CFUA.ACCT=BINASC(0) THEN DO;
      694     4802    3            F$DCB.FUN=%CREATE#; /* DONT LET READFDFIT ALTRET */
      695     4803    3            GOTO NOTNEW; /* READ THE PAD FIT */
      696     4804    3            END;
      697     4805    2         CALL FMQ$SRCHAD (XT$,ADDR(NIL)) ALTRET(BLDFD);
      698     4806    2         BUF$=T$;
      699     4807    3         IF FPT$OPEN_V.DELETE THEN DO;
      700     4808    3            IF B$JIT.PRIV.ACTIVE&%PR_FMEFT#
      701     4809    3              AND FPT$OPEN_V.EXPIRE=0 THEN CALL FMG$REMKEY;
      702     4810    4            ELSE DO;
      703     4811    4               FM$ADKEY.D='1'B;
      704     4812    4               IF B$JIT.PRIV.ACTIVE&%PR_FMEFT# THEN FM$ADKEY.FDSDA=FPT$OPEN_V.EXPIRE;
      705     4813    4               ELSE CALL SSS$SYSTIME(FM$ADKEY.FDSDA);
      706     4814    4               F$DCB.BFR.BUFUP(1)='1'B;
      707     4815    4               END;
      708     4816    3            FM$CFUA.GRANS=BITBIN('600000000000'O);
      709     4817    3            FM$CFUA.ACCT=' ';
      710     4818    3            FM$CFUA.GMOD=0;
      711     4819    3            END;
      712     4820    3         ELSE IF FM$ADKEY.D THEN DO;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:100  
      713     4821    3               B$JIT.ERR=FMN$E$NOKEY;
      714     4822    3               F$DCB.EXPIRE=FM$ADKEY.FDSDA;
      715     4823    3               END;
      716     4824    3            ELSE DO;
      717     4825    3               FM$CFUA.FDFITSDA=FM$ADKEY.FDSDA;
      718     4826    3               FM$CFUA.FDCSDA=FM$ADKEY.FDSDA;
      719     4827    3               END;
      720     4828    2   BLDFD: ;
      721     4829    2         CALL FMD$FLSHBUF(1);
      722     4830    2         T$=SET$;
      723     4831    2         CALL UQB$MDEQ (XT$);
      724     4832    2         IF B$JIT.ERR.CODE=0 THEN GOTO NOTNEW;
      725     4833    2         IF B$JIT.ERR.CODE~=%E$NOKEY THEN GOTO RETALTCFU;
      726     4834    2   TISNEW: ;
      727     4835    2         B$JIT.ERR=FMN$E$NOKEY;
      728     4836    2         IF FPT$OPEN_V.DELETE
      729     4837    2           OR PN$.IFPARAM_=ADDR(NIL)
      730     4838    2         THEN GOTO RETALTCFU;
      731     4839    3         IF F$DCB.IASN~=%FMDIAG# THEN DO;
      732     4840    3   FMNE$NOTAUTHR:B$JIT.ERR=FMN$E$NOTAUTH;
      733     4841    3            GOTO RETALTCFU;
      734     4842    3            END;
      735     4843                    /*E*     ERROR: FMN-E$NOKEY-E
      736     4844                    *        MESSAGE:Account% DP#%SN%%.%AC% does not exist.
      737     4845                    */
      738     4846    2         CALL FMN$CHKACCN (B$JIT.DCB$) ALTRET(RETALTCFU);
      739     4847    2         CALL FMQ$BLDFD (FM$CFUA) ALTRET(RETALTCFU);
      740     4848    2         FM$CFUA.FLAGS='0'B;/* FORCE READFDFIT TO SET CGRANS, ETC. */
      741     4849    2   NOTNEW: ;
      742     4850    2         IF FPT$OPEN_V.DELETE THEN GOTO RETALTCFU;
      743     4851    2         B$JIT.ERR='0'B;
      744     4852    2         CALL FMN$READFDFIT;
      745     4853    2         BUF$=FM$BUF$(F$DCB.BFR.BUFX(1));
      746     4854    2         IF BUF$=ADDR(NIL) THEN GOTO RETALTCFU;
      747     4855    2         I=4*(FM$GRAN.FCEX-SIZEW(FM$GRAN));
      748     4856    2         BUF$=PINCRW(BUF$,SIZEW(FM$GRAN)); /* START OF FIT */
      749     4857    2         IF F$DCB.IASN~=%FMDIAG# THEN CALL CHKOWNER;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:101  
      750     4858    2         ELSE F$DCB.OWNER='1'B;
      751     4859    2         IF NOT F$DCB.OWNER AND NOT F$DCB.FFLG&%(FFLG_CREATE#|FFLG_DELF#)
      752     4860    2         THEN B$JIT.ERR=FMN$E$NOACCESS;
      753     4861    2         IF B$JIT.ERR THEN GOTO RETALTCFU;
      754     4862    3         IF PN$.FPARAM_~=ADDR(NIL) THEN DO;
      755     4863    3            IF F$DCB.IASN=%FMDIAG# THEN PN$.FPARAM_->RECI=BUF$->RECI;
      756     4864    4            ELSE DO;
      757     4865    4               T$=BUF$;
      758     4866    4               CALL FMO$TRNINFO (PN$.FPARAM_,XT$) ALTRET(RETALTCFU);
      759     4867    4               END;
      760     4868    3            END;
      761     4869    3         IF PN$.IFPARAM_~=ADDR(NIL) THEN DO;
      762     4870    3            IF NOT F$DCB.OWNER THEN GOTO FMNE$NOTAUTHR;
      763     4871    3            F$DCB.OWNER=FM$SET.XCL;
      764     4872    4            DO DCTX=1 TO IFPFIT.CODES.CODE(0);
      765     4873    4               CFU$=PINCRW(PN$.IFPARAM_,IFPFIT.CODES.ITEMX(DCTX));
      766     4874    4               I=IFPFIT.CODES.CODE(DCTX);
      767     4875    5               DO CASE(I);
      768     4876    5               CASE(4);
      769     4877    6                  IF F$DCB.IASN=%FMDIAG# THEN DO;
      770     4878    6                     CALL FITSPDIR ALTRET(NOMOD);
      771     4879    6                     CODE04=CFU$->CODE04;
      772     4880    6                     IF F$DCB.ACCT=BINASC(0) THEN FM$SET.GACTIME=CODE04.GAC.TIME;
      773     4881    6                     F$DCB.BFR.BUFUP(1)='1'B;
      774     4882    6                     GOTO NOMOD;
      775     4883    6                     END;
      776     4884    5               CASE(14);
      777     4885    5                  CALL FITSPDIR ALTRET(NOMOD);
      778     4886    5                  CODE14.DFLTALL=CFU$->CODE14.DFLTALL;
      779     4887    6                  IF F$DCB.IASN=%FMDIAG# THEN DO;
      780     4888    6                     CODE14.ACCESS=CFU$->CODE14.ACCESS;
      781     4889    6                     CODE14.MGRANS=CFU$->CODE14.MGRANS;
      782     4890    6                     IF CODE14.CGMEM~=CFU$->CODE14.CGMEM
      783     4891    6                     THEN CALL KQM$UPDA(,CFU$->CODE14.CGMEM*%CGMEMSIZ);
      784     4892    6                     CODE14.CGMEM=CFU$->CODE14.CGMEM;
      785     4893    6                     I=4*IFPFIT.CODES.NDW(DCTX)+SIZEC(CODE14.OWNER)-SIZEC(CODE14);
      786     4894    6                     ADDR(CODE14.OWNER)->RECI=ADDR(CFU$->CODE14.OWNER)->RECI;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:102  
      787     4895    6                     END;
      788     4896    6                  ELSE DO;
      789     4897    6                     CODE14.ACCESS=CODE14.ACCESS&~OWNER_MODS |
      790     4898    6                       CFU$->CODE14.ACCESS&OWNER_MODS;
      791     4899    6                     END;
      792     4900    5                  CODE14.ACCESS.LIST=FM$CFUA.ACCESS.LIST;
      793     4901    5                  FM$CFUA.ACCESS=CODE14.ACCESS;
      794     4902    5                  FM$CFUA.DFLTALL=CODE14.DFLTALL;
      795     4903    5                  FM$CFUA.GRANS=CODE14.MGRANS-CODE14.CGRANS;
      796     4904    6                  IF F$DCB.ACCT=BINASC(0) THEN DO;
      797     4905    6                     FM$SET.GACSHELF=CODE14.ACCESS.GACSHELF;
      798     4906    6                     FM$SET.WRCMP=CODE14.ACCESS.WRCMP|
      799     4907    6                       CODE14.ACCESS.WCDATA;
      800     4908    6                     END;
      801     4909    5               CASE(9);
      802     4910    5                  CALL FITSPDIR ALTRET(NOMOD);
      803     4911    5                  I=4*IFPFIT.CODES.NDW(DCTX);
      804     4912    5                  DCT$->RECI=CFU$->RECI;
      805     4913    5                  T$=BUF$;
      806     4914    5                  CALL FMO$LOCCODP (XT$,14);
      807     4915    5                  DCT$=T$;
      808     4916    5                  CODE14.ACCESS.LIST=(I~=0);
      809     4917    5                  FM$CFUA.ACCESS.LIST=CODE14.ACCESS.LIST;
      810     4918    5               CASE(ELSE);
      811     4919    5                  GOTO NOMOD;
      812     4920    5               END;
      813     4921    4               F$DCB.BFR.BUFUP(1)='1'B;
      814     4922    5               IF NOT B$JIT.PRIV.ACTIVE&%PR_FMEFT# THEN DO;
      815     4923    5                  T$=BUF$;
      816     4924    5                  CALL FMO$LOCCODP (XT$,4) ALTRET(NOMOD);
      817     4925    5                  CALL SSS$SYSTIME (T$->CODE04.MODIFY);
      818     4926    5                  END;
      819     4927    4   NOMOD:      ;
      820     4928    4               END;
      821     4929    3            IF FM$CFUA.GRANS<0 THEN B$JIT.ERR=FMN$E$ACGRANS;
      822     4930    3            END;
      823     4931    2   RETALTCFU:;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:103  
      824     4932    2         CALL FMD$FLSHBUF(1);
      825     4933    2         T$=ACCT$;
      826     4934    2         CALL UQB$MDEQ (XT$);
      827     4935    2         T$=SET$;
      828     4936    2         IF FM$CFUA.ACCT=BINASC(0) THEN CALL UQB$MDEQ (XT$);
      829     4937    2         F$DCB.CFU$->FM$CFU.ACCTX=0; /* CLERR NAME AND ACCOUNT */
      830     4938    2         F$DCB.FCD='1'B; /* Make CLSTAR do something (release the CFU) */
      831     4939    2         CALL FMP$CLSTAR;
      832     4940    2         RETURN; /* DONT OPEN THE DCB */
      833     4941    2   FMNE$FPARAM: B$JIT.ERR=FMN$E$FPARAM;
      834     4942    2         ALTRETURN;
      835     4943    2         END;
      836     4944    1      IF F$DCB.IASN=%FMDIAG# THEN GOTO OPNDPX;
      837     4945                    /**/
      838     4946    1   FMNE$NOTAUTH: B$JIT.ERR=FMN$E$NOTAUTH;
      839     4947    1      ALTRETURN;
      840     4948                    /**/
      841     4949    1   FMNE$XCLSET:B$JIT.ERR=FMN$E$XCLSET;
      842     4950    1      F$DCB.PSN=FMX$SET.PSN(FM$VOL.SETX(DCTX));
      843     4951    1      FM$DEV.SYSID(FM$SET.DCTX)=0;
      844     4952    1      FM$DEV.ONEU(FM$SET.DCTX)='0'B;
      845     4953    1      FM$SET.SYSID=0;
      846     4954    1      FM$SET.ONEU='0'B;
      847     4955    1   RETALT:ALTRETURN;
      848     4956    1   SCREECH: CALL SC_SETRES;
      849     4957        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:104  
      850     4958                    /*F*     NAME: FMN$CLSDP
      851     4959                    *        PURPOSE: To close a DCB that was opened by FMN$OPNDP.
      852     4960                    *        DESCRIPTION: The close function depends on what the DCB was
      853     4961                    *        open to and the value in FPT.DISP.
      854     4962              *        If the DCB was open to a device (FM$SET.DCTX=DCB.SETX), the purpose
      855     4963              *        of this code is to keep track of what its VSN is and what set it
      856     4964              *        is part of. In this case, DISP is unused.
      857     4965              *        If the DCB was open to a set, DISP is used as follows.
      858     4966              *        SCRATCH, SETDSMT, SETDSMTF, or SETDSMTX with exclusive access to
      859     4967            *        the set causes it to be dismounted and the resources and setname freed.
      860     4968              *        SETPRIV causes the set to become available to users in general
      861     4969              *        provided it is not a dual set (there is no :DUAL.$$EFT).
      862     4970              *        SETPUB is the same as SETPRIV except the PAD is merged into the MAD.
      863     4971              *        SETDSMT,SETDSMTF, and SETDSMTX for non-exclusive use start a
      864     4972              *        dismount process by preventing any new users of the set.
      865     4973              *        SETDSMTF also disconnects non-batch users of the set when they next
      866     4974              *        reach jobstep. SETDSMTX aborts all current users of the set.
      867     4975              *        Any other DISP causes no change in the set's status.
      868     4976              *        Only PIG is permitted to use SETPUB or SETPRIV for any set,
      869     4977              *        or any SETDSMT for a non-exclusive set.
      870     4978              *        CALL: CALL FMN$CLSDP(CLOSEFPTPOINTERS)ALTRET;
      871     4979              */
      872     4980    1   FMN$CLSDP:ENTRY(PN$)ALTRET;
      873     4981    1      JDCB$=B$JIT.DCB$;
      874     4982    1      T$$=ADDR(T$);
      875     4983    1      I=F$DCB.SETX;
      876     4984    1      SET$=ADDR(FMX$SET(I));
      877     4985    1      IF F$DCB.FFLG.WNEW AND FM$SET.SET AND SUBSTR(FM$SET.PSN,4,1)~=''''
      878     4986    2        AND SUBSTR(FM$SET.REALPSN,4,1)~='''' THEN DO;
      879     4987    2         CALL FMR$L8;
      880     4988    2         FM$CFUX.GCT=FM$CFUX.GCT+1; /* MAKE THE ACCOUNT BLOCKS GO AWAY */
      881     4989    2         CALL FMS$GARBCOL;
      882     4990    2         CALL FMR$U8;
      883     4991    2         CALL FAG$CGRANS ALTRET(RETALT);
      884     4992    2         END;
      885     4993    1      DCTX=FM$SET.DCTX;
      886     4994    1      IF FM$SET.SET THEN DCTX=FM$VOL.DCTX(DCTX);
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:105  
      887     4995    1      DCT$=N$DCT$(DCTX);
      888     4996    1      IF PN$.V_=ADDR(NIL) THEN GOTO DFLCLS;
      889     4997    2      DO CASE(FPT$CLOSE_V.DISP);
      890     4998    2      CASE(ELSE);
      891     4999    2   DFLCLS:;
      892     5000    2         FLAG='0'B;
      893     5001    2      CASE(%SCRATCH#);
      894     5002    2         FLAG='1'O;/* RELEASE SET */
      895     5003    2      CASE(%SETPUB#);
      896     5004    2         FLAG='6'O;/* SHARED, MERGE PAD INTO MAD*/
      897     5005    2      CASE(%SETPRIV#);
      898     5006    2         FLAG='4'O;/*SHARED*/
      899     5007    2      CASE(%SETDSMT#);
      900     5008    2         FLAG='04'O;/*DISMOUNT*/
      901     5009    2      CASE(%SETDSMTF#);
      902     5010    2         FLAG='06'O;/*DISMOUNT, FAST*/
      903     5011    2      CASE(%SETDSMTX#);
      904     5012    2         FLAG='05'O;/*DISMOUNT, NOW*/
      905     5013    2      END;
      906     5014    2      IF NOT FM$SET.XCL THEN DO;
      907     5015    2         IF I=FM_SYSSETX THEN FLAG=FLAG&'2'O; /*MADMRG ONLY*/
      908     5016    3         ELSE DO;
      909     5017    4            IF B$JIT.SYSID~=JG_PIG# THEN DO;
      910     5018    5               IF FLAG&'17'O THEN DO;
      911     5019    5                  CALL FMS$RELACCT(I)ALTRET(RETALT);
      912     5020    5                  CALL FMP$UDLIST(FM$SET);
      913     5021    5                  RETURN;
      914     5022    5                  END;
      915     5023    4               ELSE FLAG=FLAG&'2'O;
      916     5024    4               END;
      917     5025    3            END;
      918     5026    2         END;
      919     5027    1      ELSE IF B$JIT.SYSID>JG_PIG# THEN FLAG=FLAG&'14'O;/* NO FAST,NOW */
      920     5028        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:106  
      921     5029                    /* CHECK FOR VID CHANGE IF DEVICE */
      922     5030    2      IF NOT FM$SET.SET AND I~=DCTX THEN DO;
      923     5031    2         CALL FMD$GETBUF (0,1,XT$);
      924     5032    2         BUF$=T$;
      925     5033    2         VID.ID=' ';
      926     5034    2         IF VOL.SPIN THEN CALL FMN$RDGRAN (XT$,FM_SRZERO);
      927     5035                    /* IS IT PROPERLY INITIALIZED? */
      928     5036    2         IF VID.ID~='CP6' OR VID.VSN~=VOL.VSN THEN VID.VSN=0; /* NO */
      929     5037                    /* IS IT PART OF A SET? */
      930     5038    2         IF VID.VSN=0 OR VID.PSN<=' ' OR VID.VOLCNT>175 THEN VID.VOLCNT=0;
      931     5039    3         IF VOL.SPIN THEN DO;
      932     5040    3            CALL READVID0;
      933     5041    3            IF DCT$->VID.SECTSTRT~=VID.SECTSTRT
      934     5042    3              OR VOL.NXTSDA>262143+FM_SRZERO
      935     5043    3              OR DCT$->VID.DGT~=VID.DGT THEN VID.VOLCNT=0;
      936     5044                    /* WONT FUNCTION IN A SET */
      937     5045    3            END;
      938     5046    2         ACCTX=0;I=0;
      939     5047                    /* IS IT IN ITS SNLIST? */
      940     5048    3         DO WHILE(ACCTX=0 AND I<VID.VOLCNT);
      941     5049    3            IF DEV.VSN=BITBIN(VID.SNLIST.VSN(I)) THEN ACCTX=I+1;
      942     5050    3            I=I+1;
      943     5051    3            END;
      944     5052    2         IF ACCTX=0 THEN VID.VOLCNT=0; /* NO, MUST BE A MISTAKE */
      945     5053    2         I=VOL.SETX;
      946     5054    2         IF I=0 OR NOT FMX$SET.SET(I) THEN VOL.VOL#=ACCTX;
      947     5055    2         CALL SAMESET ALTRET(NOMSG);
      948     5056                    /* SOMETHING HAS CHANGED */
      949     5057    2         DCTX=F$DCB.SETX;
      950     5058    2         IF VOL.SYSID~=JG_PIG# THEN CALL PIGMSG;
      951     5059    3         IF I~=0 AND NOT FMX$SET.SET(I) THEN DO;
      952     5060                    /* DE-LINK FROM THE SET'S VOL CHAIN */
      953     5061    3            VOL.SETX=0;
      954     5062    3            DCTX=FMX$SET.DCTX(I);
      955     5063    3            IF DCTX=F$DCB.SETX THEN FMX$SET.DCTX(I)=VOL.VOLL;
      956     5064    4            ELSE DO WHILE(DCTX~=0);
      957     5065    4               IF FM$VOL.VOLL(DCTX)=F$DCB.SETX
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:107  
      958     5066    4               THEN FM$VOL.VOLL(DCTX)=VOL.VOLL;
      959     5067    4               DCTX=FM$VOL.VOLL(DCTX);
      960     5068    4               END;
      961     5069    4            IF FMX$SET.DCTX(I)=0 THEN DO; /* TOOK OUT THE LAST ONE */
      962     5070    4   FINDOTHER:  ;
      963     5071    4               ACCTX=FM$CFUX.SETH;
      964     5072    5               DO WHILE(ACCTX~=0);
      965     5073                    /* NOE LOOK FOR A DUAL THAT IS NOW PRIMARY */
      966     5074    5                  IF FMX$SET.REALPSN(ACCTX)=FMX$SET.PSN(I)
      967     5075    5                    AND FMX$SET.DCTX(ACCTX)~=0
      968     5076    5                    AND NOT FMX$SET.DUAL(ACCTX)
      969     5077    6                    AND NOT FMX$SET.SET(ACCTX) THEN DO;/* GOT ONE */
      970     5078    6                     DCTX=FMX$SET.DCTX(ACCTX); /* MESSAGE THE PRIMARY */
      971     5079    6                     CALL PIGMSG;
      972     5080    6                     FMX$SET.PSN(ACCTX)=FMX$SET.REALPSN(ACCTX);
      973     5081    6                     FMX$SET.REALPSN(ACCTX)=' ';
      974     5082    6                     FMX$SET.REALPSN(I)=FMX$SET.PSN(I);
      975     5083    7                     IF FM$SET.SET THEN DO;
      976     5084    7                        DCTX=FM$SET.DCTX;
      977     5085    7                        CALL BINCHAR(FM$SET.PSN,MOD(FM$VOL.VSN(DCTX),100000));
      978     5086    7                        IF FM$VOL.SECT#(DCTX)=0 THEN ACCTX=ASCBIN('D');
      979     5087    7                        ELSE ACCTX=FM$VOL.SECT#(DCTX)+ASCBIN('@');
      980     5088    7                        CALL INSERT(FM$SET.PSN,0,1,BINASC(ACCTX));
      981     5089    7                        IF B$JIT.SYSID~=JG_SLUG# THEN CALL PIGMSG;
      982     5090    7                        END;
      983     5091    6                     ELSE FMX$SET.PSN(I)=BINASC(0);
      984     5092    6                     ACCTX=0;
      985     5093    6                     END;
      986     5094    5                  ELSE ACCTX=FMX$SET.SETL(ACCTX);
      987     5095    5                  END;
      988     5096    4               IF FM$SET.SET THEN GOTO RELSET;
      989     5097    4               END;
      990     5098    3            END;
      991     5099    2   NOMSG:;
      992     5100    3         IF VOL.SETX=0 AND VID.VOLCNT~=0 THEN DO;
      993     5101                    /* PART OF A SET, FIND OR MAKE A SET ENTRY */
      994     5102    3            VOL.RGRANS=0;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:108  
      995     5103    3            VOL.VOLL=0;
      996     5104    3   CHKDUAL: ;
      997     5105    3            CALL FMR$L8;
      998     5106    3            I=FM$CFUX.SETH;
      999     5107    4            DO WHILE (I~=0 AND VOL.SETX=0);
     1000     5108    5               IF FMX$SET.PSN(I)=VID.PSN THEN DO;
     1001     5109    6                  IF FMX$SET.DCTX(I)=0 THEN DO;
     1002     5110                    /* FOUND AN UNINITIALIZED ENTRY */
     1003     5111    6                     CALL CHKSUM;
     1004     5112    6                     FMX$SET.CHKSM(I)=ACCTX;
     1005     5113    6                     IF VOL.RGRANS=0 THEN FMX$SET.REALPSN(I)=' ';
     1006     5114    6                     ELSE FMX$SET.REALPSN(I)=FMX$SET.PSN(VOL.RGRANS);
     1007     5115    6                     GOTO NOTDUAL;
     1008     5116    6                     END;
     1009     5117    6                  ELSE DO;
     1010     5118    6                     CALL FMR$U8;
     1011     5119    6                     CALL SAMESET ALTRET(NOTDUAL);
     1012     5120    6                     IF VOL.RGRANS~=0 THEN GOTO DUALDUAL; /* >1 DUAL */
     1013     5121    6   TRYDUAL:          CALL BINCHAR(VID.PSN,MOD(VID.SNLIST.VSN.N(0),100000));
     1014     5122    6                     IF VID.SNLIST.VSN.S(0)=0 THEN ACCTX=ASCBIN('D');
     1015     5123    6                     ELSE ACCTX=VID.SNLIST.VSN.S(0)+ASCBIN('@');
     1016     5124    6                     CALL INSERT(VID.PSN,0,1,BINASC(ACCTX));
     1017     5125    6                     VOL.RGRANS=I;
     1018     5126    6                     GOTO CHKDUAL;
     1019     5127    6   NOTDUAL:          VOL.SETX=I;
     1020     5128                    /* LINK US INTO THE VOLUME CHAIN */
     1021     5129    6                     ACCTX=FMX$SET.DCTX(I);
     1022     5130    7                     DO WHILE(ACCTX~=0 AND VOL.VOL#>FM$VOL.VOL#(ACCTX));
     1023     5131    7                        I=ACCTX;
     1024     5132    7                        ACCTX=FM$VOL.VOLL(ACCTX);
     1025     5133    7                        END;
     1026     5134    6                     VOL.VOLL=ACCTX;
     1027     5135    6                     IF I=VOL.SETX THEN FMX$SET.DCTX(I)=F$DCB.SETX;
     1028     5136    6                     ELSE FM$VOL.VOLL(I)=F$DCB.SETX;
     1029     5137    7                     IF VOL.SECT#~=0 AND FMX$SET.SYSID(VOL.SETX)~=0 THEN DO;
     1030     5138    7                        CFU$=N$DCT$(VOL.DCTX)->NI$DCT.RAT$;
     1031     5139    8                        IF FR$RAT.RES.SISID=JG_PIG# THEN DO;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:109  
     1032     5140    8                           FR$RAT.FLG.OPN='1'B;
     1033     5141    8                           FR$RAT.FLG.MBIT.MTD='1'B;
     1034     5142    8                           END;
     1035     5143    7                        END;
     1036     5144    6   DUALDUAL:         ;
     1037     5145    6                     CALL FMR$L8;
     1038     5146    6                     END;
     1039     5147    5                  END;
     1040     5148    4               I=FMX$SET.SETL(I);
     1041     5149    4               END;
     1042     5150    4            IF VOL.SETX=0 THEN DO;
     1043     5151                    /* NEEDS A NEW SET ENTRY */
     1044     5152    4               CALL FMR$GA (XT$,I) ALTRET(RETALT);
     1045     5153    4               SET$=T$;
     1046     5154    4               FM$SET.SETL=FM$CFUX.SETH;
     1047     5155    4               FM$CFUX.SETH=I/SIZEW(FM$SET);
     1048     5156    4               FM$SET.DCTX=F$DCB.SETX;
     1049     5157    4               CALL CHKSUM;
     1050     5158    4               FM$SET.PSN=VID.PSN;
     1051     5159    4               FM$SET.XCL='1'B;
     1052     5160    4               I=FM$CFUX.SETH;
     1053     5161    4               SET$=ADDR(FMX$SET(F$DCB.SETX));
     1054     5162    4               VOL.SETX=I;
     1055     5163    4               IF VOL.RGRANS=0 THEN FMX$SET.REALPSN(I)=' ';
     1056     5164    4               ELSE FMX$SET.REALPSN(I)=FMX$SET.PSN(VOL.RGRANS);
     1057     5165    4               FMX$SET.CHKSM(I)=ACCTX;
     1058     5166    4               END;
     1059     5167    3            CALL FMR$U8;
     1060     5168    3            END;
     1061     5169    3         IF FM$SET.SYSID~=0 THEN DO;
     1062     5170    3            FM$SET.SYSID=0;
     1063     5171    3            FM$SET.ONEU='0'B;
     1064     5172    3            FM$DEV.SYSID(VOL.DCTX)=0;
     1065     5173    3            FM$DEV.ONEU(VOL.DCTX)='0'B;
     1066     5174    3            END;
     1067     5175    2         END;
     1068     5176        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:110  
     1069     5177    2      ELSE IF NOT FM$SET.SET THEN DO;
     1070     5178                    /* WE HAVE A WHOLE DEVICE, CHECK OUT ALL ITS PARTS */
     1071     5179    2            ACCTX=F$DCB.SETX;
     1072     5180    2            DCTX=ACCTX;
     1073     5181    2            CALL FMD$GETBUF (2,1,XT$);
     1074     5182    2            BUF$=T$;
     1075     5183    2   AVRAGAIN:;
     1076     5184    2            VID='0'B;
     1077     5185    2            IF DEV.SPIN THEN CALL FMN$RDGRAN (XT$,FM_SRZERO);
     1078     5186    2            IF VID.ID~='CP6' OR VID.VSN>BITBIN('777777777'O) THEN VID.VSN=0;
     1079     5187    3            IF DEV.MRRCHK AND B$JIT.SYSID=%JG_PIG# THEN DO;
     1080     5188    3               DEV.MRRCHK='0'B;
     1081     5189    4               IF NI$DCT.DP.MIRROR.FLAG THEN DO; /* new one */
     1082     5190    4                  IF DEV.MIRROR THEN EXIT; /* eh?, mabbe oughta screeech */
     1083     5191    4                  DEV.MIRROR='1'B; /* make our tables match NI */
     1084     5192    4                  DEV.MRRDCTX=NI$DCT.DP.MIRROR.DCTX; /* but VID is already OK */
     1085     5193    4                  DEV.MRRUTS=NI$DCT.DP.MIRROR.UTS;
     1086     5194    4                  IF N$DCT$(NI$DCT.DP.MIRROR.DCTX)->NI$DCT.DP.MIRROR.STATE ~=
     1087     5195    4                    %NI_MIRROR_WAIT THEN
     1088     5196    4                     DEV.VSN=VID.VSN; /* the secondary has been 0 until now, tho' */
     1089     5197    4                  END;
     1090     5198    4               ELSE IF DEV.MIRROR AND DEV.SPIN THEN DO; /* tearing down a pair */
     1091     5199    4                     VID.MIRROR.STATE(0)=NI$DCT.DP.MIRROR.STATE; /* update the VID */
     1092     5200    4                     IF NI$DCT.DP.MIRROR.DCTX~=0 THEN VID.MIRROR.STATE(1)=
     1093     5201    4                          N$DCT$(NI$DCT.DP.MIRROR.DCTX)->NI$DCT.DP.MIRROR.STATE;
     1094     5202    4                     CALL FMB$QUEUE(XT$,1,4096,FM_SRZERO,%N_WRBIN,-1,0,0);
     1095     5203    4                     VID.MIRROR.STATE(1)=%NI_MIRROR_NONE; /* but undo mirroring */
     1096     5204    4                     END;
     1097     5205    3               END;
     1098     5206    2            IF VID.MIRROR.C='MIRROR' AND VID.VSN~=0
     1099     5207    3              AND VID.MIRROR.STATE(1)=%NI_MIRROR_OPER THEN DO;
     1100     5208    3               IF DEV.MIRROR THEN EXIT;
     1101     5209    4               IF VID.MIRROR.STATE(0)=%NI_MIRROR_OPER THEN DO;
     1102     5210    4                  DEV.MRRDCTX=0;
     1103     5211    4                  DEV.MRRUTS=VID.MIRROR.UTS;
     1104     5212    4                  DEV.MIRROR='1'B;
     1105     5213    4                  NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_WAIT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:111  
     1106     5214    4                  END;
     1107     5215    3               ELSE VID.VSN=0; /* dont reflect broken mirrors */
     1108     5216    3               END;
     1109     5217    3            ELSE IF DEV.MIRROR THEN DO;
     1110     5218    3                  IF NI$DCT.DP.MIRROR.FLAG AND DEV.SPIN THEN EXIT; /* pretty screwy */
     1111     5219    3                  DEV.MIRROR='0'B;
     1112     5220    3                  IF B$JIT.SYSID~=JG_PIG# THEN CALL PIGMSG; /* give PIG a poke */
     1113     5221    3                  IF DEV.SECTL~=0 THEN EXIT; /* the primary, nothing to do. */
     1114     5222    3                  IF DEV.VSN=VID.VSN THEN DEV.VSN=0; /* 2ndary, make it go away */
     1115     5223    3                  NI$DCT.RAT$->FR$RAT.FLG.MBIT='0'B;
     1116     5224    3                  NI$DCT.RAT$->FR$RAT.FLG.OPN='0'B;
     1117     5225    3                  END;
     1118     5226    2            I=FM$CFUX.DSETH;
     1119     5227    3   MRRCHK:  DO WHILE(I~=0);
     1120     5228    4               IF VID.VSN~=DEV.VSN AND VID.VSN=FM$DEV.VSN(I) THEN DO;
     1121     5229                    /* Identical VSNs - could be a mirror. */
     1122     5230    5                  IF NOT FM$DEV.MIRROR(I) OR FM$DEV.MRRDCTX(I)~=0 THEN DO;
     1123     5231                    /* The first one isn't waiting; ignore this one. */
     1124     5232    5                     IF NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_WAIT
     1125     5233    5                     THEN NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_OPER;
     1126     5234    5                     VID.VSN=0;
     1127     5235    5                     EXIT MRRCHK;
     1128     5236    5                     END;
     1129     5237    5                  IF NOT DEV.MIRROR THEN DO;
     1130     5238                    /* This one isn't waiting; ignore the first one. */
     1131     5239    5                     FM$DEV.VSN(I)=0;
     1132     5240    5                     DCTX=I;
     1133     5241    5                     CALL PIGMSG;
     1134     5242    5                     DCTX=ACCTX;
     1135     5243    5                     EXIT MRRCHK;
     1136     5244    5                     END;
     1137     5245            /* Got the second half of a mirror pair; make first primary and link them up. */
     1138     5246    4                  FM$DEV.MRRDCTX(I)=DCTX;
     1139     5247    4                  DEV.MRRDCTX=I;
     1140     5248    4                  DCTX=I;
     1141     5249    5                  DO WHILE '1'B; /* Actually, only twice, but who's counting? */
     1142     5250    5                     DCT$=N$DCT$(DCTX);
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:112  
     1143     5251    5                     NI$DCT.DP.MIRROR='0'B;
     1144     5252    5                     NI$DCT.DP.MIRROR.FLAG='1'B;
     1145     5253    5                     NI$DCT.DP.MIRROR.DCTX=FM$DEV.MRRDCTX(DCTX);
     1146     5254    5                     NI$DCT.DP.MIRROR.UTS=FM$DEV.MRRUTS(DCTX);
     1147     5255    5                     IF I=FM$CFUX.DSETH THEN NI$DCT.DP.MIRROR.DRZERO=VID.SYSSIZE;
     1148     5256    5                     NI$DCT.DP.MIRROR.LQ$=ADDR(NIL);
     1149     5257    5                     NI$DCT.DP.MIRROR.WRITE='1'B;
     1150     5258    5                     NI$DCT.DP.MIRROR.READ='1'B;
     1151     5259                    /*                NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_OPER; */
     1152     5260    5                     IF ACCTX=DCTX THEN EXIT;
     1153     5261    5                     NI$DCT.DP.MIRROR.PRI='1'B;
     1154     5262    5                     CALL PIGMSG; /* Run through again to set up the VOL/SETs   */
     1155     5263    5                     DCTX=ACCTX;
     1156     5264    5                     END;
     1157     5265    4                  END;
     1158     5266    3               I=FM$DEV.DEVL(I);
     1159     5267    3               END;
     1160     5268    2            DEV.VSN=VID.VSN;
     1161     5269    2            IF DEV.MIRROR
     1162     5270    2            THEN IF DEV.MRRDCTX<=0 THEN GOTO NORES; /* All done if waiting */
     1163     5271    3               ELSE IF NOT NI$DCT.DP.MIRROR.PRI THEN DO;
     1164     5272    3                     CFU$=NI$DCT.RAT$;
     1165     5273    3                     SUBSTR(F$DCB.PSN,0,4)='*MDP';
     1166     5274    3                     CALL BINCHAR(SUBSTR(F$DCB.PSN,4,2),FM$DEV.NN(DEV.MRRDCTX));
     1167     5275    3                     GOTO GETRES;
     1168     5276    3                     END;
     1169     5277    2            AVRM.WORDS=0;
     1170     5278    2            IF VID.SECTSTRT(0)>DEV.NXTSDA-FM_SRZERO THEN VID.SECTSTRT='0'B;
     1171     5279    3            DO WHILE(I=0 OR FM$VOL.SECTL(DCTX)~=0 OR VID.SECTSTRT(I)>VID.SECTSTRT(I-1)
     1172     5280    3              AND VID.SECTSTRT(I)<DEV.NXTSDA-FM_SRZERO);
     1173     5281    3               IF VID.SECTSTRT(I)>=VID.SECTSTRT(I+1) OR VID.SECTSTRT(I+1)>
     1174     5282    3                 DEV.NXTSDA-FM_SRZERO THEN VID.SECTSTRT(I+1)=DEV.NXTSDA-FM_SRZERO;
     1175     5283    3               DCT$=ADDR(NIL);
     1176     5284    3               IF VID.VSN~=0 AND(FM$VOL.SECTL(DCTX)=0 OR VID.SECTSTRT(I)<
     1177     5285    4                 FM$VOL.DRZERO(FM$VOL.SECTL(DCTX))) THEN DO;
     1178     5286    4                  CALL FMR$L8;
     1179     5287    4                  CALL FMR$GA (XT$,AVRM.WORDS) ALTRET(SCREECH);
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:113  
     1180     5288    4                  DCT$=T$;
     1181     5289    4                  DCT$->VOL.DCTX=DEV.DCTX;
     1182     5290    4                  DCT$->VOL.SECTL=FM$VOL.SECTL(DCTX);
     1183     5291    4                  DCT$->VOL.VSN=VID.VSN;
     1184     5292    4                  DCT$->VOL.XCL='1'B;
     1185     5293    4                  DCT$->VOL.DRZERO=VID.SECTSTRT(I);
     1186     5294    4                  DCT$->VOL.NXTSDA=VID.SECTSTRT(I+1)-VID.SECTSTRT(I)+FM_SRZERO;
     1187     5295    4                  IF DCT$->VOL.NXTSDA<DEV.NXTSDA OR I~=0 THEN DCT$->VOL.SECT#=I+1;
     1188     5296    4                  FM$VOL.SECTL(DCTX)=AVRM.WORDS/SIZEW(VOL);
     1189     5297    4                  CALL FMR$U8;
     1190     5298    4                  END;
     1191     5299    3               F$DCB.SETX=FM$VOL.SECTL(DCTX);
     1192     5300    4               IF F$DCB.SETX~=0 THEN DO;
     1193     5301    4                  IF VID.SECTSTRT(I)~=FM$VOL.DRZERO(F$DCB.SETX)
     1194     5302    4                    OR VID.VSN~=FM$VOL.VSN(F$DCB.SETX)
     1195     5303    4                    OR FM$VOL.NXTSDA(F$DCB.SETX)~=FM_SRZERO+
     1196     5304    4                    VID.SECTSTRT(I+1)-VID.SECTSTRT(I)
     1197     5305    4                  THEN FM$VOL.SPIN(F$DCB.SETX)='0'B;
     1198     5306    5                  ELSE DO;
     1199     5307    5                     FM$VOL.SPIN(F$DCB.SETX)='1'B;
     1200     5308    5                     I=I+1;
     1201     5309    5                     END;
     1202     5310    4                  CALL FMN$CLSDP(ADDR(NIL));
     1203     5311    4                  IF NOT FM$VOL.SPIN(F$DCB.SETX)
     1204     5312    5                  THEN IF FM$VOL.SETX(F$DCB.SETX)=0 THEN DO;
     1205     5313                    /* Gone section was not in use, delete it */
     1206     5314    5                        FM$VOL.SECTL(DCTX)=FM$VOL.SECTL(F$DCB.SETX);
     1207     5315    5                        CALL FMR$Z8(ADDR(FM$VOL(F$DCB.SETX)));
     1208     5316    5                        END;
     1209     5317    5                     ELSE DO;
     1210     5318                   /* Gone section was busy, resurrect it, and dont access any other vsn. */
     1211     5319    6                        IF DEV.SPIN THEN DO;
     1212     5320    6                           DEV.SPIN='0'B;
     1213     5321    6                           DCTX=ACCTX;
     1214     5322    6                           T$=BUF$;
     1215     5323    6                           GOTO AVRAGAIN;
     1216     5324    6                           END;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:114  
     1217     5325    5                        DCTX=F$DCB.SETX;
     1218     5326    5                        END;
     1219     5327    4                  ELSE DCTX=F$DCB.SETX;
     1220     5328    4                  END;
     1221     5329    3               ELSE I=I+1;
     1222     5330    3               IF DCT$=ADDR(FM$VOL(DCTX)) THEN CALL PIGMSG;
     1223     5331    3               END;
     1224     5332    2            DCTX=VID.VSN;
     1225     5333    2            IF DCTX=0 AND DEV.SECTL~=0 THEN DEV.VSN=FM$VOL.VSN(DEV.SECTL);
     1226     5334    3            ELSE DO;
     1227     5335    3               DCTX=ACCTX;
     1228     5336    3               IF AVRM.WORDS~=0 THEN CALL PIGMSG;
     1229     5337    3               F$DCB.SETX=ACCTX;
     1230     5338    3               CFU$=N$DCT$(ACCTX)->NI$DCT.RAT$;
     1231     5339    4               IF DEV.SECTL~=0 AND FM$VOL.SECT#(DEV.SECTL)~=0 THEN DO;
     1232     5340    4                  F$DCB.PSN='*LOTS*';
     1233     5341    4   GETRES:        ;
     1234     5342    5                  IF B$JIT.SYSID=JG_PIG# AND FR$RAT.RES.SISID~=JG_PIG# THEN DO;
     1235     5343                    /* Could have been partitioned during the VID read */
     1236     5344    5                     IF FR$RAT.FLG.DOWN THEN EXIT;
     1237     5345                    /* GHOST1 WILL HAVE SET MTD FOR #SYS */
     1238     5346    5                     IF FR$RAT.REEL.ASID=0 THEN FR$RAT.FLG.MBIT.MTD='0'B;
     1239     5347    5                     T$=CFU$;
     1240     5348    5                     CALL FRZ$GETRES ('DP  ',FR$RAT.M1,JG_PIG#,%MODE_GHOST#,XT$)
     1241     5349    5                       ALTRET(NORES);
     1242     5350    5                     FR$RAT.RES.NUMB=' ';
     1243     5351    5                     FR$RAT.RES.ACTX=0;
     1244     5352    5                     F$DCB.CSEED=DEV.VSN;
     1245     5353    5                     F$DCB.ATTR=FR$RAT.M1;
     1246     5354    5                     T$=ACCT$;
     1247     5355    5                     CALL FRC$AVR (XT$,1,F$DCB.PSN);
     1248     5356    5                     CALL FRA$OPR ALTRET(SCREECH);
     1249     5357    5                     CFU$=N$DCT$(ACCTX)->NI$DCT.RAT$;
     1250     5358    5                     FR$RAT.RES.RFLG.NOSLD='1'B;
     1251     5359    5                     I=DEV.SECTL;
     1252     5360    6                     DO WHILE(I~=0);
     1253     5361    6                        IF FM$VOL.SETX(I)~=0
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:115  
     1254     5362    6                          AND FMX$SET.SYSID(FM$VOL.SETX(I))~=0 THEN GOTO NORES;
     1255     5363    6                        I=FM$VOL.SECTL(I);
     1256     5364    6                        END;
     1257     5365    5                     FR$RAT.FLG.OPN='0'B;
     1258     5366    5                     IF SUBSTR(F$DCB.PSN,0,2)='*L' THEN FR$RAT.FLG.MBIT='0'B;
     1259     5367    5   NORES:            ;
     1260     5368    5                     END;
     1261     5369    4                  END;
     1262     5370    4               ELSE DO;
     1263     5371    4                  IF FR$RAT.RES.SISID=JG_PIG# AND B$JIT.SYSID=JG_PIG#
     1264     5372    4                    AND NOT FR$RAT.RES.RFLG.OLT THEN CALL FRZ$RRESNA(FR$RAT,%
              5372                             MODE_GHOST#);
     1265     5373    4                  I=FM$VOL.SETX(DEV.SECTL);
     1266     5374    4                  IF NOT DEV.SPIN OR DEV.SECTL=0 THEN IS=-1;
     1267     5375    4                  T$=ACCT$;
     1268     5376    4                  CALL FRC$AVR (XT$,IS,FMX$SET.PSN(I));
     1269     5377    4                  IF IS>=0 OR DEV.MRRDCTX<=0
     1270     5378    4                    OR FM$DEV.SECTL(DEV.MRRDCTX)>0
     1271     5379    4                    OR FM$DEV.MRRDCTX(DEV.MRRDCTX)~=DCTX
     1272     5380    4                  THEN EXIT; /* make the secondary REQUable when primary goes */
     1273     5381    4                  FM$DEV.MRRDCTX(DEV.MRRDCTX)=0;
     1274     5382    4                  N$DCT$(DEV.MRRDCTX)->NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_WAIT;
     1275     5383    4                  N$DCT$(DEV.MRRDCTX)->NI$DCT.RAT$->FR$RAT.FLG.MBIT.MTD='0'B;
     1276     5384    4                  DEV.MRRDCTX=0;
     1277     5385    4                  END;
     1278     5386    3               END;
     1279     5387    2            DEV.SYSID=0;
     1280     5388    2            DEV.ONEU='0'B;
     1281     5389    2            CALL FMD$RELBUF(2);
     1282     5390    2            END;
     1283     5391        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:116  
     1284     5392    2         ELSE DO; /* NOT A DEVIXEW, DSO SET STUFF */
     1285     5393    3            IF FLAG.SHARE AND FM$SET.XCL AND B$JIT.SYSID<=JG_PIG# THEN DO;
     1286     5394                    /*SHARE ONLY FROM PIG OR SLUG, AND ONLY ONCE IS SUFFICIENT*/
     1287     5395    3               CFU$=JDCB$; /* ALSO, A DUAL CANNOT BE MOUNTED SHARED */
     1288     5396    3               JDCB$=DCBADDR(1);
     1289     5397    3               B$JIT.DCB$=JDCB$;
     1290     5398    3               CALL FMM$SCRUB (B$JIT.DCB$);
     1291     5399    3               F$DCB.PSN=FM$SET.PSN;
     1292     5400    3               F$DCB.ACCT='$$EFT';
     1293     5401    3               F$DCB.NAME=DUALNAME;
     1294     5402    3               F$DCB.ASN=%FILE#;
     1295     5403    3               CALL FMM$DFLOPNP;
     1296     5404    3               CALL FMP$CLSTAR;
     1297     5405    3               B$JIT.DCB$=CFU$;
     1298     5406    3               JDCB$=CFU$;
     1299     5407    4               IF B$JIT.ERR='0'B THEN DO;
     1300     5408    4                  B$JIT.ERR=FMN$E$DUPSN;
     1301     5409                    /*E*     ERROR: FMN-E$DUPSN-c
     1302     5410                    *        MESSAGE: Exclusive mode only if :DUAL.$$EFT exists.
     1303     5411                    *        MESSAGE1:The :DUAL.$$EFT file must not exist if a packset is to
     1304     5412                    *        be used in a shared mode (SHARED or PUBLIC).
     1305     5413                    */
     1306     5414    4                  FM$SET.DUAL='1'B;
     1307     5415    4                  CALL FMR$L8;
     1308     5416    4                  GOTO FINDOTHER;
     1309     5417    4                  END;
     1310     5418    3               F$DCB.GTYP=FMGTPAD;
     1311     5419    3               CALL FMD$REDBUF (XT$,1,FM_PADSDA,,0) ALTRET(NOMNTIME);
     1312     5420    3               T$=PINCRW(T$,SIZEW(FM$GRAN));
     1313     5421    3               CALL FMO$LOCCODP (XT$,4) ALTRET(NOMNTIME);
     1314     5422    4               IF T$->CODE04.ACCESS<=T$->CODE04.SVMODIFY THEN DO;
     1315     5423    4                  CALL SSS$SYSTIME (T$->CODE04.ACCESS);
     1316     5424    4                  CALL FMD$WRTBUF(1);
     1317     5425    4                  END;
     1318     5426    3   NOMNTIME:   ;
     1319     5427    3               B$JIT.ERR='0'B;
     1320     5428    3               FM$SET.XCL='0'B;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:117  
     1321     5429    3               END;
     1322     5430    2            IF FM$SET.PSN='SYS' THEN FM_SYSSETX=F$DCB.SETX;
     1323     5431    2            IF FLAG.MAD THEN IF B$JIT.PRIV.AUTH&%PR_FMDIAG# THEN CALL FMQ$BLDMAD;
     1324     5432    2               ELSE GOTO FMNE$NOTAUTH;
     1325     5433    2            CALL FMR$L8;
     1326     5434    2            FM$SET.NONEWU=FLAG.DSMT;
     1327     5435    2            FM$SET.DSMTF=FLAG.DSMTF;
     1328     5436    2            IF (FLAG.DSMT OR FLAG.REL AND FM$SET.DIAGOPN)
     1329     5437    3              AND FM$SET.ONEU THEN DO;
     1330     5438    3               FM$SET.XCL='1'B;
     1331     5439    3               CALL FMR$U8;
     1332     5440    3   RELSET:     IF FM$SET.PSN~='CP-6''S' THEN CALL FMS$RELACCT(I)ALTRET(RETALT);
     1333     5441    3               CALL FMP$UDLIST(FM$SET);
     1334     5442    3               DCTX=FM$SET.DCTX;
     1335     5443    3               FM$SET.SET='0'B;
     1336     5444    4               DO WHILE (DCTX~=0);
     1337     5445    4                  I=B$JIT.MODE;
     1338     5446    4                  CFU$=N$DCT$(FM$VOL.DCTX(DCTX))->NI$DCT.RAT$;
     1339     5447    4                  IF FR$RAT.RES.RFLG.OLT THEN CALL FRZ$RRESNA(FR$RAT,I);
     1340     5448    4   NOREL:         DCTX=FM$VOL.VOLL(DCTX);
     1341     5449    4                  END;
     1342     5450    3               F$DCB.SETX=0;
     1343     5451    3               RETURN;
     1344     5452    3               END;
     1345     5453    3            IF FLAG.DSMTF OR FLAG.DSMTX THEN DO;
     1346     5454    3               I=FM$SET.USERLIST;
     1347     5455    4               IF NOT FM$SET.ONEU THEN DO WHILE (I~=0);
     1348     5456    4                  CFU$=PINCRW(F$CFU$,I);
     1349     5457    5                  DO I=0 TO FM$SETU.NUM-1;
     1350     5458    5                     DCTX=FM$SETU.SYSID(I);
     1351     5459    5                     CALL XUSER;
     1352     5460    5                     END;
     1353     5461    4                  I=FM$SETU.LINKX;
     1354     5462    4                  END;
     1355     5463    3               ELSE FM$SET.XCL='1'B;
     1356     5464    3               CALL FMR$U8;
     1357     5465    3               I=F$DCB.SETX;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:118  
     1358     5466    3               IF FM$SET.XCL THEN GOTO RELSET;
     1359     5467    3               END;
     1360     5468    2            ELSE CALL FMR$U8;
     1361     5469    2            END;
     1362     5470    1      CALL FMD$RELBUF(0);
     1363     5471    1      CALL FMD$RELBUF(1);
     1364     5472    1      RETURN;
     1365     5473        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:119  
     1366     5474    1   XUSER: PROC ALTRET;
     1367     5475                    /*D*    NAME: XUSER
     1368     5476                             FUNCTION: ABORT OR DE-SET THE USER WHOSE SYSID IS IN DCTX
     1369     5477                             IF DSMTX, ABORT IF STATE ISNT NULL.
     1370     5478                             IF DSMTF, DE-SET IF USER IS AT JOBSTEP.
     1371     5479                    */
     1372     5480    2   DCL 1 UN,
     1373     5481    2         2 * BIT(27),
     1374     5482    2         2 UN UBIN(9)UNAL;
     1375     5483    2      CALL OCZ$SID_UN(DCTX1.SYSID,UN)ALTRET(UNSET);
     1376     5484    2      IF UN.UN=S_CUN THEN RETURN;
     1377     5485    3      IF UN.UN <= JG_MING# THEN DO;
     1378     5486    3         AVRM.PSN=FM$SET.PSN;
     1379     5487    3         AVRM.SETX=F$DCB.SETX;
     1380     5488    3         AVRM.WORDS=2;
     1381     5489    3         CALL SSV$EVENT(UN.UN,7,JG_SETDSMT#,JG_SETDSMT#,0,
     1382     5490    3           ADDR(AVRM),ENTADDR(NIL));
     1383     5491    3         RETURN;
     1384     5492    3         END;
     1385     5493    2      IF FLAG.DSMTX THEN CALL SSR$RUE(%SS_ABRT,UN.UN);
     1386     5494    2      ELSE IF B$USRT$->B$USER.FLG(UN.UN)&%U_STEP
     1387     5495    3           AND B$USRT$->B$USER.MODE(UN.UN)=%M_INT# THEN DO;
     1388     5496    3   UNSET:   CALL FMP$UDLIST(FM$SET,DCTX);
     1389     5497    3            I=I-1;
     1390     5498    3            END;
     1391     5499    2      RETURN;
     1392     5500        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:120  
     1393     5501    2   CHKSUM: ENTRY ALTRET;
     1394     5502    2      CALL CHKSM;
     1395     5503    2      RETURN;
     1396     5504                    /**/
     1397     5505        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:121  
     1398     5506    2   SAMESET: ENTRY ALTRET;
     1399     5507                    /*D*     NAME: SAMESET
     1400     5508                        FUNCTION: DETERMINE IF VID AT BUF$ CORRESPONDS TO FM$SET(I)
     1401     5509                        IF YES, THEN ALTRETURNS.
     1402     5510                    */
     1403     5511    2      IF I=0 AND VID.VOLCNT=0
     1404     5512    2      THEN IF VID.VSN=VOL.VSN OR VOL.SYSID~=0 AND F$DCB.PSN=' ' THEN ALTRETURN;
     1405     5513    2         ELSE RETURN;
     1406     5514    2      IF VID.VOLCNT=0
     1407     5515    2        OR FMX$SET.REALPSN(I)~=VID.PSN
     1408     5516    2        AND FMX$SET.PSN(I)~=VID.PSN THEN RETURN;
     1409     5517    2      CALL CHKSM;
     1410     5518    2      IF ACCTX~=FMX$SET.CHKSM(I) THEN RETURN;
     1411     5519    2      DCTX=FMX$SET.DCTX(I);
     1412     5520    3      DO WHILE '1'B;
     1413     5521    3         IF DCTX=0 THEN ALTRETURN;
     1414     5522    3         IF FM$VOL.SPIN(DCTX) AND F$DCB.SETX~=DCTX THEN EXIT;
     1415     5523    3         DCTX=FM$VOL.VOLL(DCTX);
     1416     5524    3         END;
     1417     5525    2      CALL READVID;
     1418     5526    2      IF DCT$->VID.ID~='CP6' THEN ALTRETURN;
     1419     5527    2      IF VID.VOLCNT~=DCT$->VID.VOLCNT THEN RETURN;
     1420     5528    3      DO DCTX=0 TO VID.VOLCNT-1;
     1421     5529    3         IF VID.SNLIST(DCTX)~=DCT$->VID.SNLIST(DCTX) THEN RETURN;
     1422     5530    3         END;
     1423     5531    2   RETALT:;
     1424     5532    2      ALTRETURN;
     1425     5533    2   CHKSM: PROC;
     1426     5534    3      ACCTX=0;
     1427     5535    4      DO DCTX=0 TO VID.VOLCNT-1;
     1428     5536    4         ACCT.DA=ACCTX+VID.SNLIST.VSN.N(DCTX)*(DCTX+1);
     1429     5537    4         ACCT.DA=ACCTX*33+VID.SNLIST.VSN.S(DCTX)*(DCTX+1);
     1430     5538    4         END;
     1431     5539    3      ACCTX=MOD(ACCTX,FM_SRZERO);/*TERMINATES CHAIN OF RECOVERY REL FITS*/
     1432     5540    3      RETURN;
     1433     5541        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:122  
     1434     5542    3   READVID: ENTRY;
     1435     5543    3      ACCTX=F$DCB.SETX;
     1436     5544    3      CALL FMD$GETBUF (1,1,XT$);
     1437     5545    3      T$->VID='0'B;
     1438     5546    3      F$DCB.SETX=DCTX;
     1439     5547    3      CALL FMN$RDGRAN (XT$,FM_SRZERO);
     1440     5548    3      DCT$=T$;
     1441     5549    3      F$DCB.SETX=ACCTX;
     1442     5550    3      RETURN;
     1443     5551    3   END;
     1444     5552    2   READVID0: ENTRY ALTRET;
     1445     5553    2      CALL READVID;
     1446     5554    2      RETURN;
     1447     5555                    /**/
     1448     5556        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:123  
     1449     5557    2   PIGMSG: ENTRY ALTRET;
     1450     5558    2      IF DCTX=0 THEN CALL SC_SETRES;
     1451     5559    2      IF FM$DEV.AVR(DCTX) THEN RETURN;
     1452     5560    2      FM$DEV.AVR(DCTX)='1'B;
     1453     5561    3      IF B$USRT$->B$USER.US(JG_PIG#)~=%SS_SNULL THEN DO;
     1454     5562    3         AVRM.WORDS=BITBIN(K_DISK);
     1455     5563    3         AVRM.PSN=' ';
     1456     5564    3         CALL KUW$WRITE(AVRM,10,J_PIG);
     1457     5565    3         END;
     1458     5566    2      RETURN;
     1459     5567        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:124  
     1460     5568    2   CHKOWNER: ENTRY ALTRET;
     1461     5569    2      F$DCB.OWNER='0'B;
     1462     5570    2      T$=BUF$;
     1463     5571    2      I=14;
     1464     5572    2      CALL FMO$LOCCODE (XT$,I) ALTRET(RETRET);
     1465     5573    2      I=(BUF$->IFPFIT.CODES.NDW(I)-SIZEW(CODE14) +
     1466     5574    2        SIZEW(CODE14.OWNER))/SIZEW(CODE14.OWNER);
     1467     5575    3      DO WHILE(I>0);
     1468     5576    3         I=I-1;
     1469     5577    3         IF T$->CODE14.OWNER.ACCT(I)=B$JIT.ACCN
     1470     5578    3           AND (T$->CODE14.OWNER.NAME(I)=B$JIT.UNAME OR T$->CODE14.OWNER.NAME(I)='?')
     1471     5579    4         THEN DO;
     1472     5580    4            F$DCB.OWNER='1'B;
     1473     5581    4            B$JIT.ERR='0'B;
     1474     5582    4            END;
     1475     5583    3         END;
     1476     5584    2   RETRET: RETURN;
     1477     5585                    /**/
     1478     5586    2   FITSPDIR: ENTRY ALTRET;
     1479     5587    2      IF F$DCB.IASN=%FMDIAG# OR I=9
     1480     5588    2      THEN CALL FMO$FITSPDIR(IFPFIT.CODES(DCTX))ALTRET(RETALT);
     1481     5589    2      T$=BUF$;
     1482     5590    2      CALL FMO$LOCCODP (XT$,I) ALTRET(RETALT);
     1483     5591    2      DCT$=T$;
     1484     5592    2      RETURN;
     1485     5593    2   END;
     1486     5594    1   END FMN$OPNDP;
     1487     5595        %EOD;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:125  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMN$OPNDP.

   Procedure FMN$OPNDP requires 2924 words for executable code.
   Procedure FMN$OPNDP requires 32 words of local(AUTO) storage.

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:126  

 Object Unit name= FMN$OPNDP                                  File name= FMN$OPNDP.:E05TOU
 UTS= JUL 29 '97 16:52:54.08 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     26     32  FMN$OPNDP
    1   Proc  even  none  2924   5554  FMN$OPNDP
    2  RoData even  none    54     66  FMN$OPNDP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  FMN$OPNDP
     1   1436          yes     yes      Std        1  FMN$CLSDP
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:127  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 FMN$SETX
 yes     yes           Std       0 FMI$INIT
 yes     yes           Std       1 UQB$MENQS
 yes     yes           Std       0 FMN$READFDFIT
 yes     yes           Std       2 FMP$UDLIST
         yes           Std       1 FMR$Z8
 yes     yes           Std       2 FMR$GA
 yes     yes           Std       9 FMB$QUEUE
         yes           Std       1 FMD$RELBUF
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       1 UQB$MDEQ
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       0 FAG$CGRANS
 yes     yes           Std       2 FMO$LOCCODP
 yes     yes           Std       2 FMO$TRNINFO
 yes     yes           Std       0 FMS$GARBCOL
 yes     yes           Std       2 FMR$G8
 yes     yes           Std       0 FMS$SCANACCT
         yes           Std       0 FMM$DFLOPNP
         yes           Std       1 FMD$WRTBUF
 yes     yes           Std       2 FMQ$SRCHAD
 yes     yes           Std       1 FMS$RELACCT
         yes           Std       3 FMD$GETBUF
 yes     yes           Std       1 FMQ$BLDFD
         yes           Std       1 FMM$SCRUB
 yes     yes           Std       2 KQM$UPDA
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       2 FMN$RDGRAN
         yes           Std       0 FMR$L8
 yes     yes           Std       0 FMQ$BLDMAD
         yes           Std       0 FMP$CLSTAR
         yes           Std       2 FRZ$RRESNA
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:128  
 yes     yes           Std       6 FMD$REDBUF
 yes     yes           Std       0 FMG$REMKEY
 yes     yes           Std       1 FMN$CHKACCN
         yes           Std       0 FMR$U8
 yes     yes           Std       5 FRZ$GETRES
 yes     yes           Std       0 FRA$OPR
 yes     yes           Std       3 FRC$AVR
 yes     yes           Std       4 OCZ$SID_UN
         yes           Std       7 SSV$EVENT
         yes           Std       4 SSR$RUE
 yes     yes           Std       3 KUW$WRITE
 yes     yes           Std       2 FMO$LOCCODE
 yes     yes           Std       1 FMO$FITSPDIR
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_SETRES                             B$USRT$                               B$JIT$
     N$DCT$$                               FM$BUF$                               FM$SET$
     F$CFU$                                FM_SRZERO                             FM_PADSDA
     FM_SYSSETX                            S_CUN                                 J_PIG
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ROSID                                 ISSID
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:129  


      412        1        /*T***********************************************************/
      413        2        /*T*                                                         */
      414        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      415        4        /*T*                                                         */
      416        5        /*T***********************************************************/
      417        6                    /*F*     NAME: FMN$OPNDP
      418        7                  *       PURPOSE: To open a DCB to diskpack or set thereof in device mode.
      419        8                   *       DESCRIPTION: The diskpack(s) to be accessed are specified by the
      420        9                    *       sn vlp of the open FPT. If the SN is blank and the user is PIG,
      421       10                    *        a disk with FM$DEV.AVR set is opened and AVR reset. If the SN
      422       11                    *        bytes are snnnxx, nnn is a UBIN VSN and s is a UBIN
      423       12                    *        section number (less than 32). If they are 0xxxnn,
      424       13                    *        nn is a UBIN DCTX. 0DPnnx is device DPnn if not a set name.
      425       14                    *        Otherwise, the SN is a PSN and the set will be mounted if not
      426       15                  *       already, all its volumes are up, and the resources are available.
      427       16              *        IFPARAM and FPARAM are used in the latter case to set and retrieve
      428       17              *        the FD FIT (CODE14 and CODE09) for F$DCB.ACCT, or the PAD FIT
      429       18              *        if F$DCB.ACCT is BINASC(0). In this case, the DCB is not opened.
      430       19              *        If DELETE is also set, the account is removed from the PAD.
      431       20              *        The user must have FMDIAG privilege or be a set owner to open
      432       21              *        the DCB or delete an account. FPARAM only needs no privilege
      433       22              *        but if none, does not return CODE14.OWNER or CODE04.CREATOR.
      434       23              *        IFPARAM requires FMDIAG, set owner, or account owner. If only
      435       24              *         account owner, only CODE09 and CODE14.BUPM and OWNERF can change.
      436       25              *        This is the only mechanism to create new accounts on a set
      437       26              *        where PAD FIT's CODE14.NEWFD is not set.
      438       27              *        If the DCB is opened (FPARAM and IFPARAM must be NIL),
      439       28              *        DCB.IASN is set to %FMDIAG# and FFLG.READ and FFLG.WNEW are
      440       29              *        set according to FUN, permitting full page IO to granules of
      441       30              *        the set or device, specifying a UBIN device- or set-relative
      442       31              *        disk address. If open to a device, its MODEL name is returned
      443       32              *        in DCB.ACCT. The size (in granules) of the device or the first
      444       33              *        volume of a set is returned to DCB.IXTNSIZE, its DCTX to
      445       34              *        DCB.XTNSIZE, and its device name to DCB.PASS.
      446       35              *        In any case (open or not, but no altret) DCB.OWNER is set if
      447       36              *        exclusive access to the set was obtained.
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:130  
      448       37              *        CALL: CALL FMN$OPNDP(OPENFPT_POINTERS) ALTRET;
      449       38              */
      450       39        FMN$OPNDP:PROC(PN$)ALTRET;

     39  1 000000   000000 700200 xent  FMN$OPNDP    TSX0  ! X66_AUTO_1
         1 000001   000040 000001                    ZERO    32,1

      451       40                    /* INCLUDES */
      452       41        %INCLUDE F$JIT_C;
      453      471        %MACRO F$DCB#(BASED=BASED);
      454      472        %INCLUDE F$DCB;
      455      521        %MEND;
      456      522        %F$DCB#(BASED="BASED(JDCB$)");
      457      572        %INCLUDE F_CP6;
      458     1597        %INCLUDE F$CP6P_C;
      459     1608        %FPT$OPEN_P(FPTN=PN$,STCLASS=,PFMT=PTR);
      460     1614        %VLP_SN(STCLASS="BASED(PN$.SN_)");
      461     1627        %INCLUDE F$CP6V_C;
      462     1853        %FPT$CLOSE_V(BASED="BASED(PN$.V_)");
      463     1862        %FPT$OPEN_V(BASED="BASED(PN$.V_)");
      464     1877        %INCLUDE FM$MACROS;
      465     2252        %FM$SET(BASED="BASED(SET$)",ARY=);
      466     2257        %FM$DEV(BASED="BASED(FM$SET$)");
      467     2263        %FM$VOL(BASED="BASED(FM$SET$)");
      468     2269        %FM$VOL(FM$VOL=VOL,BASED="BASED(SET$)",ARY=);
      469     2275        %FM$DEV(FM$DEV=DEV,BASED="BASED(SET$)",ARY=);
      470     2281        %FM$SET(FM$SET=FMX$SET,BASED="BASED(FM$SET$)");
      471     2286        %FM$VID(FM$VID=VID,BASED="BASED(BUF$)");
      472     2292        %FM$SETU(BASED="BASED(CFU$)");
      473     2295        %FM$CFU(BASED="BASED(CFU$)");
      474     2301        %FM$CFUA(BASED="BASED(ACCT$)");
      475     2307        %FM$CFUX;
      476     2312        %FM$KEYTBL;
      477     2315        %FM$GRAN(BASED="BASED(BUF$)");
      478     2319        %FM$FIT(FM$FIT=IFPFIT,BASED="BASED(PN$.IFPARAM_)");
      479     2322        %FM$ADKEY(BASED="BASED(BUF$)");
      480     2325        %CODE04(BASED="BASED(DCT$)");
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:131  
      481     2333        %CODE14(BASED="BASED(DCT$)");
      482     2343        %INCLUDE F_ERRORS_C;
      483     2583        %INCLUDE UD_ERRORS_C;
      484     2625        %INCLUDE CP_6_SUBS;
      485     3165        %INCLUDE JG_EVID_C;
      486     3390        %INCLUDE JG_GHOSTS_C;
      487     3480        %INCLUDE NI$TABLES;
      488     3696        %NI$DCT(STCLASS="BASED(DCT$)");
      489     3744        %NI$DVT;
      490     3751        %INCLUDE NI_DATA_C;
      491     3864        %INCLUDE N_FC_C;
      492     3901        %INCLUDE OCI_SUBS_C;
      493     3999        %INCLUDE FR$RAT;
      494     4052        %FR$RAT(STCLASS="BASED(CFU$)");
      495     4092        %INCLUDE B$USER;
      496     4308        %B$USERREFS;
      497     4312        %INCLUDE SS_SCHED_C;
      498     4545    1   DCL RECI BASED(BUF$) CHAR(I);
      499     4546                    /* ENTREFS */
      500     4547    1   DCL FAG$CGRANS ENTRY ALTRET;
      501     4548    1   DCL FMB$QUEUE ENTRY(9) ALTRET;
      502     4549    1   DCL FMC$RELSET ENTRY(1)ALTRET;
      503     4550    1   DCL FMD$GETBUF ENTRY(3);
      504     4551    1   DCL FMD$RELBUF ENTRY(1);
      505     4552    1   DCL FMD$FLSHBUF ENTRY(1);
      506     4553    1   DCL FMD$REDBUF ENTRY(6) ALTRET;
      507     4554    1   DCL FMD$WRTBUF ENTRY(1);
      508     4555    1   DCL FMG$REMKEY ENTRY ALTRET;
      509     4556    1   DCL FMI$INIT ENTRY ALTRET; /* Set up for random-type I/O */
      510     4557    1   DCL FMM$DFLOPNP ENTRY;
      511     4558    1   DCL FMM$SCRUB ENTRY(1);
      512     4559    1   DCL FMN$CHKACCN ENTRY(1)ALTRET;
      513     4560    1   DCL FMN$RDGRAN ENTRY(2)ALTRET;
      514     4561    1   DCL FMN$READFDFIT ENTRY ALTRET;
      515     4562    1   DCL FMN$SETX ENTRY(1) ALTRET;
      516     4563    1   DCL FMO$FITSPDIR ENTRY(1)ALTRET;
      517     4564    1   DCL FMO$LOCCODE ENTRY(2)ALTRET;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:132  
      518     4565    1   DCL FMO$LOCCODP ENTRY(2)ALTRET;
      519     4566    1   DCL FMO$TRNINFO ENTRY(2)ALTRET;
      520     4567    1   DCL FMP$UDLIST ENTRY(2)ALTRET;
      521     4568    1   DCL FMP$CLSERR ENTRY(1);
      522     4569    1   DCL FMP$CLSTAR ENTRY;
      523     4570    1   DCL FMQ$BLDFD ENTRY(1) ALTRET;
      524     4571    1   DCL FMQ$BLDMAD ENTRY ALTRET;
      525     4572    1   DCL FMQ$SRCHAD ENTRY(2) ALTRET;
      526     4573    1   DCL FMR$G8 ENTRY(2) ALTRET;
      527     4574    1   DCL FMR$GA ENTRY(2)ALTRET;
      528     4575    1   DCL FMR$L8 ENTRY;
      529     4576    1   DCL FMR$U8 ENTRY;
      530     4577    1   DCL FMR$SLIDE ENTRY(3);
      531     4578    1   DCL FMR$Z8 ENTRY(1);
      532     4579    1   DCL FMS$SCANACCT ENTRY ALTRET;
      533     4580    1   DCL FMS$GARBCOL ENTRY ALTRET;
      534     4581    1   DCL FMS$RELACCT ENTRY(1)ALTRET;
      535     4582    1   DCL FRC$AVR ENTRY(3)ALTRET;
      536     4583    1   DCL FRA$OPR ENTRY ALTRET;
      537     4584    1   DCL FRZ$GETRES ENTRY(5)ALTRET;
      538     4585    1   DCL FRZ$RRES ENTRY(2);
      539     4586    1   DCL FRZ$RRESNA ENTRY(2);
      540     4587    1   DCL KQM$UPDA ENTRY(2)ALTRET;
      541     4588    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      542     4589    1   DCL OCZ$SID_UN ENTRY(4)ALTRET;
      543     4590    1   DCL SC_SETRES ENTRY CONV(2,0);
      544     4591    1   DCL SSR$RUE ENTRY(4);
      545     4592    1   DCL SSS$SYSTIME ENTRY(1);
      546     4593    1   DCL SSV$EVENT ENTRY(7);
      547     4594    1   DCL UQB$MENQS ENTRY(1)ALTRET;
      548     4595    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      549     4596    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      550     4597                    /* SYMREFS */
      551     4598    1   DCL B$JIT$ PTR SYMREF;
      552     4599    1   DCL N$DCT$$ PTR SYMREF;
      553     4600    1   DCL N$DCT$(0:0) PTR BASED(N$DCT$$);
      554     4601    1   DCL NI$DVT$(0:0) PTR SYMREF;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:133  
      555     4602    1   DCL FM$BUF$(0:0) PTR SYMREF;
      556     4603    1   DCL FM$SET$ PTR SYMREF;
      557     4604    1   DCL F$CFU$ PTR SYMREF;
      558     4605    1   DCL FM_SRZERO SBIN SYMREF;
      559     4606    1   DCL FM_PADSDA UBIN SYMREF;
      560     4607    1   DCL FM_SYSSETX UBIN SYMREF;
      561     4608    1   DCL S_CUN UBIN SYMREF;
      562     4609        %JG_GHOSTS(STCLASS=SYMREF);
      563     4647                    /* AUTO */
      564     4648    1   DCL ACCT$ PTR;
      565     4649    1   DCL ACCTX REDEF ACCT$ SBIN;
      566     4650    1   DCL 1 ACCT REDEF ACCT$,
      567     4651    1         2 * BIT(9),
      568     4652    1         2 DA UBIN(27) UNAL;
      569     4653    1   DCL DCT$ PTR;
      570     4654    1   DCL CFU$ PTR;
      571     4655    1   DCL BUF$ PTR;
      572     4656    1   DCL 1 FLAG REDEF BUF$,
      573     4657    1         2 SHARE BIT(1),
      574     4658    1         2 MAD BIT(1),
      575     4659    1         2 REL BIT(1),
      576     4660    1         2 DSMT BIT(1),
      577     4661    1         2 DSMTF BIT(1),
      578     4662    1         2 DSMTX BIT(1),
      579     4663    1         2 * BIT(30);
      580     4664    1   DCL JDCB$ PTR;
      581     4665    1   DCL DCTX UBIN;
      582     4666    1   DCL 1 DCTX1 REDEF DCTX,
      583     4667    1         2 * BIT(18),
      584     4668    1         2 SYSID BIT(18);
      585     4669    1   DCL SET$ PTR;
      586     4670    1   DCL I UBIN;
      587     4671    1   DCL IS REDEF I SBIN;
      588     4672    1   DCL 1 AVRM,
      589     4673    1         2 WORDS UBIN,
      590     4674    1         2 PSN CHAR(6),
      591     4675    1         2 SETX UBIN(18)UNAL;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:134  
      592     4676                    /* CONSTANTS */
      593     4677    1   DCL 1 DUALNAME CONSTANT,
      594     4678    1         2 * UBIN(9)UNAL INIT(5),
      595     4679    1         2 * CHAR(0)INIT(':DUAL');
      596     4680    1   DCL T$ PTR; /* TEMP. FOr use in CALLs */
      597     4681    1   DCL T$$ PTR; /* Likewise */
      598     4682    1   DCL XT$ PTR ALIGNED BASED(T$$); /* Yet again */
      599     4683        %SUB OWNER_MODS='024400'O;
      600     4684        %SUB FCG#='0615'O;
      601     4685        %SUB MID#='16'O;
      602     4686        %ERRCODE(NAME=FMN$E$XCLSET,COD#=%E$XCLSET);
      603     4690        %ERRCODE(NAME=FMN$E$NOTAUTH,COD#=%E$NOTAUTH);
      604     4694        %ERRCODE(NAME=FMN$E$DUPSN,COD#=%E$DUPSN);
      605     4698        %ERRCODE(NAME=FMN$E$FPARAM,COD#=%E$FPARAM);
      606     4702        %ERRCODE(NAME=FMN$E$NOACCESS,COD#=%E$NOACCESS);
      607     4706        %ERRCODE(NAME=FMN$E$NOKEY,COD#=%E$NOKEY);
      608     4710        %ERRCODE(NAME=FMN$E$ACGRANS,COD#=%E$ACGRANS,SEV#=0);
      609     4714        %ERRCODE(NAME=FMN$E$BADVOL,COD#=%E$BADVOL);
      610     4718        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:135  
      611     4719                    /* PROCEDURE */
      612     4720    1      JDCB$=B$JIT.DCB$;

   4720  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200010 756100                    STQ     JDCB$,,AUTO

      613     4721    1      T$$=ADDR(T$);

   4721  1 000005   200017 631500                    EPPR1   T$,,AUTO
         1 000006   200020 451500                    STP1    T$$,,AUTO

      614     4722    1      IF B$JIT.PRIV.ACTIVE&%PR_FMDIAG# THEN F$DCB.IASN=%FMDIAG#;

   4722  1 000007   000013 236100                    LDQ     11,,PR0
         1 000010   000012 376000 0                  ANQ     FMN$E$ACGRANS+2
         1 000011   000015 600000 1                  TZE     s:4723

   4722  1 000012   200010 473500                    LDP3    JDCB$,,AUTO
         1 000013   000007 236007                    LDQ     7,DL
         1 000014   300103 552104                    STBQ    67,'04'O,PR3

      615     4723    1      F$DCB.SETX=0;

   4723  1 000015   000000 220003                    LDX0    0,DU
         1 000016   200010 473500                    LDP3    JDCB$,,AUTO
         1 000017   300051 440100                    SXL0    41,,PR3

      616     4724    1      B$JIT.ERR='0'B;

   4724  1 000020   000012 450100                    STZ     10,,PR0

      617     4725    1      CALL FMN$SETX(F$DCB.PSN);

   4725  1 000021   200010 236100                    LDQ     JDCB$,,AUTO
         1 000022   000024 036003                    ADLQ    20,DU
         1 000023   200026 756100                    STQ     UN+3,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:136  
         1 000024   200026 630500                    EPPR0   UN+3,,AUTO
         1 000025   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000026   000000 701000 xent               TSX1    FMN$SETX
         1 000027   000000 011000                    NOP     0

      618     4726    1      IF F$DCB.SETX=0 THEN ALTRETURN;

   4726  1 000030   200010 470500                    LDP0    JDCB$,,AUTO
         1 000031   000051 720100                    LXL0    41,,PR0
         1 000032   000034 601000 1                  TNZ     s:4727

   4726  1 000033   000000 702200 xent               TSX2  ! X66_AALT

      619     4727    1      SET$=ADDR(FMX$SET(F$DCB.SETX));

   4727  1 000034   000051 236100                    LDQ     41,,PR0
         1 000035   000003 736000                    QLS     3
         1 000036   000000 376000 2                  ANQ     0
         1 000037   000022 736000                    QLS     18
         1 000040   000000 036000 xsym               ADLQ    FM$SET$
         1 000041   200012 756100                    STQ     SET$,,AUTO

      620     4728    1      DCTX=FM$SET.DCTX;

   4728  1 000042   200012 471500                    LDP1    SET$,,AUTO
         1 000043   100000 236100                    LDQ     0,,PR1
         1 000044   000022 772000                    QRL     18
         1 000045   200011 756100                    STQ     DCTX,,AUTO

      621     4729    1      IF DCTX=0 THEN ALTRETURN;

   4729  1 000046   000050 601000 1                  TNZ     s:4730

   4729  1 000047   000000 702200 xent               TSX2  ! X66_AALT

      622     4730    1      DCTX=FM$VOL.DCTX(DCTX);

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:137  
   4730  1 000050   200011 235100                    LDA     DCTX,,AUTO
         1 000051   000003 735000                    ALS     3
         1 000052   000000 473400 xsym               LDP3    FM$SET$
         1 000053   300000 236105                    LDQ     0,AL,PR3
         1 000054   000022 772000                    QRL     18
         1 000055   200011 756100                    STQ     DCTX,,AUTO

      623     4731    1      DCT$=N$DCT$(DCTX);

   4731  1 000056   000000 474400 xsym               LDP4    N$DCT$$
         1 000057   400000 236106                    LDQ     0,QL,PR4
         1 000060   200005 756100                    STQ     DCT$,,AUTO

      624     4732    1      IF DCT$=ADDR(NIL) THEN ALTRETURN;

   4732  1 000061   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000062   000064 601000 1                  TNZ     s:4733

   4732  1 000063   000000 702200 xent               TSX2  ! X66_AALT

      625     4733    1      F$DCB.IXTNSIZE=FM$SET.NXTSDA-FM_SRZERO;

   4733  1 000064   100003 236100                    LDQ     3,,PR1
         1 000065   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000066   000000 136000 xsym               SBLQ    FM_SRZERO
         1 000067   000041 756100                    STQ     33,,PR0

      626     4734    1      F$DCB.PASS=NI$DCT.DEVNM;

   4734  1 000070   200005 475500                    LDP5    DCT$,,AUTO
         1 000071   040100 100500                    MLR     fill='040'O
         1 000072   500002 000010                    ADSC9   2,,PR5                   cn=0,n=8
         1 000073   000022 000010                    ADSC9   18,,PR0                  cn=0,n=8

      627     4735    1      F$DCB.XTNSIZE=DCTX;

   4735  1 000074   200011 721100                    LXL1    DCTX,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:138  
         1 000075   000037 741100                    STX1    31,,PR0

      628     4736    1      IF B$JIT.ERR THEN ALTRETURN;

   4736  1 000076   000000 476400 xsym               LDP6    B$JIT$
         1 000077   600012 235100                    LDA     10,,PR6
         1 000100   000102 600000 1                  TZE     s:4737

   4736  1 000101   000000 702200 xent               TSX2  ! X66_AALT

      629     4737    2      IF NOT FM$SET.SET THEN DO;

   4737  1 000102   100002 236100                    LDQ     2,,PR1
         1 000103   200000 316003                    CANQ    65536,DU
         1 000104   000222 601000 1                  TNZ     s:4757

      630     4738    2         F$DCB.ACCT=NI$DCT.DVT$->NI$DVT.MODEL(NI$DCT.MODX);

   4738  1 000105   500024 477500                    LDP7    20,,PR5
         1 000106   500007 236100                    LDQ     7,,PR5
         1 000107   000021 772000                    QRL     17
         1 000110   000176 376007                    ANQ     126,DL
         1 000111   000002 736000                    QLS     2
         1 000112   040100 100506                    MLR     fill='040'O
         1 000113   700003 000010                    ADSC9   3,Q,PR7                  cn=0,n=8
         1 000114   000020 000010                    ADSC9   16,,PR0                  cn=0,n=8

      631     4739    2         IF F$DCB.SETX~=DCTX THEN DCTX=F$DCB.SETX;

   4739  1 000115   000051 236100                    LDQ     41,,PR0
         1 000116   777777 376007                    ANQ     -1,DL
         1 000117   200011 116100                    CMPQ    DCTX,,AUTO
         1 000120   000123 600000 1                  TZE     s:4740

   4739  1 000121   200011 756100                    STQ     DCTX,,AUTO
         1 000122   000130 710000 1                  TRA     s:4741

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:139  
      632     4740    2         ELSE DCTX=FM$DEV.SECTL(DCTX);

   4740  1 000123   200011 235100                    LDA     DCTX,,AUTO
         1 000124   000003 735000                    ALS     3
         1 000125   300005 236105                    LDQ     5,AL,PR3
         1 000126   777777 376007                    ANQ     -1,DL
         1 000127   200011 756100                    STQ     DCTX,,AUTO

      633     4741    3         IF F$DCB.FUN~=%IN# THEN DO WHILE(DCTX~=0);

   4741  1 000130   000032 236100                    LDQ     26,,PR0
         1 000131   000777 376003                    ANQ     511,DU
         1 000132   000002 116003                    CMPQ    2,DU
         1 000133   000162 600000 1                  TZE     OPNDPX

   4741  1 000134   200011 235100                    LDA     DCTX,,AUTO
         1 000135   000162 600000 1                  TZE     OPNDPX

      634     4742    3            IF FM$VOL.SETX(DCTX)~=0 AND FMX$SET.SET(FM$VOL.SETX(DCTX))

   4742  1 000136   200011 235100                    LDA     DCTX,,AUTO
         1 000137   000003 735000                    ALS     3
         1 000140   000000 470400 xsym               LDP0    FM$SET$
         1 000141   000000 720105                    LXL0    0,AL,PR0
         1 000142   000151 600000 1                  TZE     s:4744
         1 000143   000000 236105                    LDQ     0,AL,PR0
         1 000144   000003 736000                    QLS     3
         1 000145   000000 376000 2                  ANQ     0
         1 000146   000002 236106                    LDQ     2,QL,PR0
         1 000147   200000 316003                    CANQ    65536,DU
         1 000150   001400 601000 1                  TNZ     FMNE$XCLSET

      635     4743    3            THEN GOTO FMNE$XCLSET;
      636     4744    3            IF F$DCB.SETX~=FM$SET.DCTX THEN EXIT;

   4744  1 000151   200010 471500                    LDP1    JDCB$,,AUTO
         1 000152   100051 721100                    LXL1    41,,PR1
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:140  
         1 000153   200012 473500                    LDP3    SET$,,AUTO
         1 000154   300000 101100                    CMPX1   0,,PR3
         1 000155   000162 601000 1                  TNZ     OPNDPX

      637     4745    3            DCTX=FM$VOL.SECTL(DCTX);

   4745  1 000156   000005 236105                    LDQ     5,AL,PR0
         1 000157   777777 376007                    ANQ     -1,DL
         1 000160   200011 756100                    STQ     DCTX,,AUTO

      638     4746    3            END;

   4746  1 000161   000136 601000 1                  TNZ     s:4742

   4745  1 000162                       OPNDPX       null
      639     4747    2   OPNDPX: ;
      640     4748    2         F$DCB.FFLG.READ='1'B;

   4748  1 000162   200010 470500                    LDP0    JDCB$,,AUTO
         1 000163   400000 236003                    LDQ     -131072,DU
         1 000164   000004 256100                    ORSQ    4,,PR0

      641     4749    2         IF F$DCB.FUN~=%IN# THEN F$DCB.FFLG.WNEW='1'B;

   4749  1 000165   000032 236100                    LDQ     26,,PR0
         1 000166   000777 376003                    ANQ     511,DU
         1 000167   000002 116003                    CMPQ    2,DU
         1 000170   000173 600000 1                  TZE     s:4750

   4749  1 000171   100000 236003                    LDQ     32768,DU
         1 000172   000004 256100                    ORSQ    4,,PR0

      642     4750    2         F$DCB.WCDATA='1'B;

   4750  1 000173   002000 236003                    LDQ     1024,DU
         1 000174   000067 256100                    ORSQ    55,,PR0

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:141  
      643     4751    2         CALL FMI$INIT;

   4751  1 000175   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000176   000000 701000 xent               TSX1    FMI$INIT
         1 000177   000000 011000                    NOP     0

      644     4752    2         IF NOT FM$SET.SET AND NOT DEV.SPIN THEN F$DCB.FFLG='0'B;

   4752  1 000200   200012 470500                    LDP0    SET$,,AUTO
         1 000201   000002 236100                    LDQ     2,,PR0
         1 000202   200000 316003                    CANQ    65536,DU
         1 000203   000211 601000 1                  TNZ     s:4753
         1 000204   004000 316003                    CANQ    2048,DU
         1 000205   000211 601000 1                  TNZ     s:4753

   4752  1 000206   000000 220003                    LDX0    0,DU
         1 000207   200010 471500                    LDP1    JDCB$,,AUTO
         1 000210   100004 740100                    STX0    4,,PR1

      645     4753    2         F$DCB.OWNER=FM$SET.XCL;

   4753  1 000211   200010 471500                    LDP1    JDCB$,,AUTO
         1 000212   000002 236100                    LDQ     2,,PR0
         1 000213   000025 772000                    QRL     21
         1 000214   100064 676100                    ERQ     52,,PR1
         1 000215   040000 376007                    ANQ     16384,DL
         1 000216   100064 656100                    ERSQ    52,,PR1

      646     4754    2         F$DCB.FCD='1'B;

   4754  1 000217   020000 236007                    LDQ     8192,DL
         1 000220   100031 256100                    ORSQ    25,,PR1

      647     4755    2         RETURN;

   4755  1 000221   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:142  
      648     4756    2         END;
      649     4757    2      IF F$DCB.IASN~=%FMDIAG# THEN DO;

   4757  1 000222   000103 236100                    LDQ     67,,PR0
         1 000223   000777 376007                    ANQ     511,DL
         1 000224   000007 116007                    CMPQ    7,DL
         1 000225   000317 600000 1                  TZE     s:4782

      650     4758    2         F$DCB.GTYP=FMGTPAD;

   4758  1 000226   000064 236100                    LDQ     52,,PR0
         1 000227   000001 376000 2                  ANQ     1
         1 000230   014000 276003                    ORQ     6144,DU
         1 000231   000064 756100                    STQ     52,,PR0

      651     4759                    /* IF NOT PRIVILEGED, USER MUST BE SET OR ACCOUNT OWNER */
      652     4760    2         T$=SET$;

   4760  1 000232   200012 236100                    LDQ     SET$,,AUTO
         1 000233   200017 756100                    STQ     T$,,AUTO

      653     4761    2         CALL UQB$MENQS (XT$) ALTRET(RETALT);

   4761  1 000234   200020 630500                    EPPR0   T$$,,AUTO
         1 000235   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000236   000000 701000 xent               TSX1    UQB$MENQS
         1 000237   001432 702000 1                  TSX2    RETALT

      654     4762    2         CALL FMD$REDBUF (XT$,1,FM_PADSDA,,0)

   4762  1 000240   000002 236000 2                  LDQ     2
         1 000241   200032 756100                    STQ     UN+7,,AUTO
         1 000242   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000243   000003 235000 2                  LDA     3
         1 000244   200030 757100                    STAQ    UN+5,,AUTO
         1 000245   000004 236000 2                  LDQ     4
         1 000246   200020 235100                    LDA     T$$,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:143  
         1 000247   200026 757100                    STAQ    UN+3,,AUTO
         1 000250   200026 630500                    EPPR0   UN+3,,AUTO
         1 000251   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000252   000000 701000 xent               TSX1    FMD$REDBUF
         1 000253   000255 702000 1                  TSX2    s:4764
         1 000254   000264 710000 1                  TRA     s:4768

      655     4763    3         WHENALTRETURN DO;

      656     4764    3            T$=SET$;

   4764  1 000255   200012 236100                    LDQ     SET$,,AUTO
         1 000256   200017 756100                    STQ     T$,,AUTO

      657     4765    3            CALL UQB$MDEQ (XT$);

   4765  1 000257   200020 630500                    EPPR0   T$$,,AUTO
         1 000260   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000261   000000 701000 xent               TSX1    UQB$MDEQ
         1 000262   000000 011000                    NOP     0

      658     4766    3            ALTRETURN;

   4766  1 000263   000000 702200 xent               TSX2  ! X66_AALT

      659     4767    3            END;
      660     4768    2         BUF$=PINCRW(T$,SIZEW(FM$GRAN));

   4768  1 000264   200017 236100                    LDQ     T$,,AUTO
         1 000265   000005 036003                    ADLQ    5,DU
         1 000266   200007 756100                    STQ     BUF$,,AUTO

      661     4769    2         CALL CHKOWNER;

   4769  1 000267   005427 701000 1                  TSX1    CHKOWNER
         1 000270   000000 011000                    NOP     0

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:144  
      662     4770    2         CALL FMD$FLSHBUF(1);

   4770  1 000271   000004 630400 2                  EPPR0   4
         1 000272   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000273   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000274   000000 011000                    NOP     0

      663     4771    2         T$=SET$;

   4771  1 000275   200012 236100                    LDQ     SET$,,AUTO
         1 000276   200017 756100                    STQ     T$,,AUTO

      664     4772    2         CALL UQB$MDEQ (XT$);

   4772  1 000277   200020 630500                    EPPR0   T$$,,AUTO
         1 000300   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000301   000000 701000 xent               TSX1    UQB$MDEQ
         1 000302   000000 011000                    NOP     0

      665     4773    2         IF F$DCB.OWNER THEN F$DCB.IASN=%FMDIAG#; /* SET OWNER */

   4773  1 000303   200010 470500                    LDP0    JDCB$,,AUTO
         1 000304   000064 236100                    LDQ     52,,PR0
         1 000305   040000 316007                    CANQ    16384,DL
         1 000306   000312 600000 1                  TZE     s:4774

   4773  1 000307   000007 236007                    LDQ     7,DL
         1 000310   000103 552104                    STBQ    67,'04'O,PR0
         1 000311   000317 710000 1                  TRA     s:4782

      666     4774    2         ELSE IF FPT$OPEN_V.DELETE THEN GOTO FMNE$NOTAUTH;

   4774  1 000312   200003 471500                    LDP1    @PN$,,AUTO
         1 000313   100000 473500                    LDP3    0,,PR1
         1 000314   300000 236100                    LDQ     0,,PR3
         1 000315   040000 316007                    CANQ    16384,DL
         1 000316   001374 601000 1                  TNZ     FMNE$NOTAUTH
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:145  

      667     4775                    /*E*     ERROR: FMN-E$NOTAUTH-E
      668     4776                    *        MESSAGE:File management privilege inadequate.
      669     4777                    *        MESSAGE1:MAD modification requires FMDIAG privilege,
      670     4778                    *        M$OPEN NXTA requires FMSEC privilege,
      671     4779                    *        Many PIG functions require FMDIAG or PIGC privilege.
      672     4780                    */
      673     4781    2         END;

      674     4782    2      IF PN$.FPARAM_~=ADDR(NIL) OR PN$.IFPARAM_~=ADDR(NIL) THEN DO;

   4782  1 000317   200003 471500                    LDP1    @PN$,,AUTO
         1 000320   100014 236100                    LDQ     12,,PR1
         1 000321   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000322   000326 601000 1                  TNZ     s:4784
         1 000323   100013 236100                    LDQ     11,,PR1
         1 000324   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000325   001370 600000 1                  TZE     s:4944

      675     4783        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:146  
      676     4784    3         IF PN$.IFPARAM_~=ADDR(NIL) THEN DO;

   4784  1 000326   100013 236100                    LDQ     11,,PR1
         1 000327   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000330   000347 600000 1                  TZE     s:4789

      677     4785    3            IF FPT$OPEN_V.DELETE THEN GOTO FMNE$FPARAM;

   4785  1 000331   100000 473500                    LDP3    0,,PR1
         1 000332   300000 236100                    LDQ     0,,PR3
         1 000333   040000 316007                    CANQ    16384,DL
         1 000334   001364 601000 1                  TNZ     FMNE$FPARAM

      678     4786    3            IF FM$VOL.RGRANS(FM$SET.DCTX)=0

   4786  1 000335   200012 474500                    LDP4    SET$,,AUTO
         1 000336   400000 236100                    LDQ     0,,PR4
         1 000337   000017 772000                    QRL     15
         1 000340   000000 376000 2                  ANQ     0
         1 000341   000000 475400 xsym               LDP5    FM$SET$
         1 000342   500006 235106                    LDA     6,QL,PR5
         1 000343   000347 601000 1                  TNZ     s:4789

      679     4787    3            THEN CALL FAG$CGRANS ALTRET(RETALT);

   4787  1 000344   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000345   000000 701000 xent               TSX1    FAG$CGRANS
         1 000346   001432 702000 1                  TSX2    RETALT

      680     4788    3            END;

      681     4789    2         CALL FMR$G8 (F$DCB.CFU$,I);

   4789  1 000347   200013 630500                    EPPR0   I,,AUTO
         1 000350   200027 450500                    STP0    UN+4,,AUTO
         1 000351   200010 236100                    LDQ     JDCB$,,AUTO
         1 000352   000066 036003                    ADLQ    54,DU
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:147  
         1 000353   200026 756100                    STQ     UN+3,,AUTO
         1 000354   200026 630500                    EPPR0   UN+3,,AUTO
         1 000355   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000356   000000 701000 xent               TSX1    FMR$G8
         1 000357   000000 011000                    NOP     0

      682     4790    2         CFU$=F$DCB.CFU$;

   4790  1 000360   200010 470500                    LDP0    JDCB$,,AUTO
         1 000361   000066 236100                    LDQ     54,,PR0
         1 000362   200006 756100                    STQ     CFU$,,AUTO

      683     4791    2         FM$CFU.FUN=%UPDATE#;/* MAKE THE ACCOUNT BLOCK LOOK BUSY TO GARBCOL*/

   4791  1 000363   200006 471500                    LDP1    CFU$,,AUTO
         1 000364   100000 236100                    LDQ     0,,PR1
         1 000365   000005 376000 2                  ANQ     5
         1 000366   100000 276003                    ORQ     32768,DU
         1 000367   100000 756100                    STQ     0,,PR1

      684     4792    2         CALL FMS$SCANACCT; /* GET AN ACCOUNT BLOCK */

   4792  1 000370   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000371   000000 701000 xent               TSX1    FMS$SCANACCT
         1 000372   000000 011000                    NOP     0

      685     4793    2         ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);

   4793  1 000373   200006 470500                    LDP0    CFU$,,AUTO
         1 000374   000002 220100                    LDX0    2,,PR0
         1 000375   000000 636010                    EAQ     0,X0
         1 000376   000000 036000 xsym               ADLQ    F$CFU$
         1 000377   200004 756100                    STQ     ACCT$,,AUTO

      686     4794    2         T$=ACCT$;

   4794  1 000400   200017 756100                    STQ     T$,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:148  

      687     4795    2         CALL UQB$MENQX (XT$) ALTRET(RETALTCFU);

   4795  1 000401   200020 630500                    EPPR0   T$$,,AUTO
         1 000402   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000403   000000 701000 xent               TSX1    UQB$MENQX
         1 000404   001325 702000 1                  TSX2    RETALTCFU

      688     4796    3         IF NOT FPT$OPEN_V.DELETE THEN DO;

   4796  1 000405   200003 470500                    LDP0    @PN$,,AUTO
         1 000406   000000 471500                    LDP1    0,,PR0
         1 000407   100000 236100                    LDQ     0,,PR1
         1 000410   040000 316007                    CANQ    16384,DL
         1 000411   000415 601000 1                  TNZ     s:4799

      689     4797    3            IF FM$CFUA.FLAGS.EXIST THEN GOTO NOTNEW;

   4797  1 000412   200004 473500                    LDP3    ACCT$,,AUTO
         1 000413   300005 234100                    SZN     5,,PR3
         1 000414   000630 604000 1                  TMI     NOTNEW

      690     4798    3            END;

      691     4799    2         T$=SET$;

   4799  1 000415   200012 236100                    LDQ     SET$,,AUTO
         1 000416   200017 756100                    STQ     T$,,AUTO

      692     4800    2         CALL UQB$MENQX (XT$) ALTRET(RETALTCFU);

   4800  1 000417   200020 630500                    EPPR0   T$$,,AUTO
         1 000420   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000421   000000 701000 xent               TSX1    UQB$MENQX
         1 000422   001325 702000 1                  TSX2    RETALTCFU

      693     4801    3         IF FM$CFUA.ACCT=BINASC(0) THEN DO;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:149  

   4801  1 000423   200004 470500                    LDP0    ACCT$,,AUTO
         1 000424   040000 106500                    CMPC    fill='040'O
         1 000425   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 000426   000006 000001 2                  ADSC9   6                        cn=0,n=1
         1 000427   000434 601000 1                  TNZ     s:4805

      694     4802    3            F$DCB.FUN=%CREATE#; /* DONT LET READFDFIT ALTRET */

   4802  1 000430   200010 471500                    LDP1    JDCB$,,AUTO
         1 000431   000003 236003                    LDQ     3,DU
         1 000432   100032 552120                    STBQ    26,'20'O,PR1

      695     4803    3            GOTO NOTNEW; /* READ THE PAD FIT */

   4803  1 000433   000630 710000 1                  TRA     NOTNEW

      696     4804    3            END;
      697     4805    2         CALL FMQ$SRCHAD (XT$,ADDR(NIL)) ALTRET(BLDFD);

   4805  1 000434   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000435   200026 756100                    STQ     UN+3,,AUTO
         1 000436   200026 631500                    EPPR1   UN+3,,AUTO
         1 000437   200031 451500                    STP1    UN+6,,AUTO
         1 000440   200020 236100                    LDQ     T$$,,AUTO
         1 000441   200030 756100                    STQ     UN+5,,AUTO
         1 000442   200030 630500                    EPPR0   UN+5,,AUTO
         1 000443   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000444   000000 701000 xent               TSX1    FMQ$SRCHAD
         1 000445   000545 702000 1                  TSX2    BLDFD

      698     4806    2         BUF$=T$;

   4806  1 000446   200017 236100                    LDQ     T$,,AUTO
         1 000447   200007 756100                    STQ     BUF$,,AUTO

      699     4807    3         IF FPT$OPEN_V.DELETE THEN DO;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:150  

   4807  1 000450   200003 470500                    LDP0    @PN$,,AUTO
         1 000451   000000 471500                    LDP1    0,,PR0
         1 000452   100000 236100                    LDQ     0,,PR1
         1 000453   040000 316007                    CANQ    16384,DL
         1 000454   000526 600000 1                  TZE     s:4820

      700     4808    3            IF B$JIT.PRIV.ACTIVE&%PR_FMEFT#

   4808  1 000455   000000 473400 xsym               LDP3    B$JIT$
         1 000456   300013 236100                    LDQ     11,,PR3
         1 000457   000030 376000 xsym               ANQ     B_VECTNIL+24
         1 000460   000467 600000 1                  TZE     s:4811
         1 000461   100013 235100                    LDA     11,,PR1
         1 000462   000467 601000 1                  TNZ     s:4811

      701     4809    3              AND FPT$OPEN_V.EXPIRE=0 THEN CALL FMG$REMKEY;

   4809  1 000463   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000464   000000 701000 xent               TSX1    FMG$REMKEY
         1 000465   000000 011000                    NOP     0
         1 000466   000514 710000 1                  TRA     s:4816

      702     4810    4            ELSE DO;

      703     4811    4               FM$ADKEY.D='1'B;

   4811  1 000467   200007 474500                    LDP4    BUF$,,AUTO
         1 000470   400000 236003                    LDQ     -131072,DU
         1 000471   400000 256100                    ORSQ    0,,PR4

      704     4812    4               IF B$JIT.PRIV.ACTIVE&%PR_FMEFT# THEN FM$ADKEY.FDSDA=FPT$OPEN_V.EXPIRE;

   4812  1 000472   000000 471400 xsym               LDP1    B$JIT$
         1 000473   100013 236100                    LDQ     11,,PR1
         1 000474   000030 376000 xsym               ANQ     B_VECTNIL+24
         1 000475   000502 600000 1                  TZE     s:4813
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:151  

   4812  1 000476   000000 473500                    LDP3    0,,PR0
         1 000477   300013 235100                    LDA     11,,PR3
         1 000500   400002 755100                    STA     2,,PR4
         1 000501   000511 710000 1                  TRA     s:4814

      705     4813    4               ELSE CALL SSS$SYSTIME(FM$ADKEY.FDSDA);

   4813  1 000502   200007 236100                    LDQ     BUF$,,AUTO
         1 000503   000002 036003                    ADLQ    2,DU
         1 000504   200026 756100                    STQ     UN+3,,AUTO
         1 000505   200026 630500                    EPPR0   UN+3,,AUTO
         1 000506   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000507   000000 701000 xent               TSX1    SSS$SYSTIME
         1 000510   000000 011000                    NOP     0

      706     4814    4               F$DCB.BFR.BUFUP(1)='1'B;

   4814  1 000511   200010 470500                    LDP0    JDCB$,,AUTO
         1 000512   400000 236003                    LDQ     -131072,DU
         1 000513   000116 256100                    ORSQ    78,,PR0

      707     4815    4               END;

      708     4816    3            FM$CFUA.GRANS=BITBIN('600000000000'O);

   4816  1 000514   000013 235000 0                  LDA     FMN$E$ACGRANS+3
         1 000515   200004 470500                    LDP0    ACCT$,,AUTO
         1 000516   000007 755100                    STA     7,,PR0

      709     4817    3            FM$CFUA.ACCT=' ';

   4817  1 000517   000035 235000 xsym               LDA     B_VECTNIL+29
         1 000520   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000521   000001 755100                    STA     1,,PR0
         1 000522   000002 756100                    STQ     2,,PR0

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:152  
      710     4818    3            FM$CFUA.GMOD=0;

   4818  1 000523   000007 236000 2                  LDQ     7
         1 000524   000005 356100                    ANSQ    5,,PR0

      711     4819    3            END;

   4819  1 000525   000545 710000 1                  TRA     BLDFD

      712     4820    3         ELSE IF FM$ADKEY.D THEN DO;

   4820  1 000526   200007 473500                    LDP3    BUF$,,AUTO
         1 000527   300000 234100                    SZN     0,,PR3
         1 000530   000540 605000 1                  TPL     s:4825

      713     4821    3               B$JIT.ERR=FMN$E$NOKEY;

   4821  1 000531   000007 236000 0                  LDQ     FMN$E$NOKEY
         1 000532   000000 474400 xsym               LDP4    B$JIT$
         1 000533   400012 756100                    STQ     10,,PR4

      714     4822    3               F$DCB.EXPIRE=FM$ADKEY.FDSDA;

   4822  1 000534   300002 235100                    LDA     2,,PR3
         1 000535   200010 471500                    LDP1    JDCB$,,AUTO
         1 000536   100035 755100                    STA     29,,PR1

      715     4823    3               END;

   4823  1 000537   000545 710000 1                  TRA     BLDFD

      716     4824    3            ELSE DO;

      717     4825    3               FM$CFUA.FDFITSDA=FM$ADKEY.FDSDA;

   4825  1 000540   200004 474500                    LDP4    ACCT$,,AUTO
         1 000541   300002 235100                    LDA     2,,PR3
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:153  
         1 000542   400004 755100                    STA     4,,PR4

      718     4826    3               FM$CFUA.FDCSDA=FM$ADKEY.FDSDA;

   4826  1 000543   300002 235100                    LDA     2,,PR3
         1 000544   400003 755100                    STA     3,,PR4

      719     4827    3               END;

   4820  1 000545                       BLDFD        null
      720     4828    2   BLDFD: ;
      721     4829    2         CALL FMD$FLSHBUF(1);

   4829  1 000545   000004 630400 2                  EPPR0   4
         1 000546   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000547   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000550   000000 011000                    NOP     0

      722     4830    2         T$=SET$;

   4830  1 000551   200012 236100                    LDQ     SET$,,AUTO
         1 000552   200017 756100                    STQ     T$,,AUTO

      723     4831    2         CALL UQB$MDEQ (XT$);

   4831  1 000553   200020 630500                    EPPR0   T$$,,AUTO
         1 000554   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000555   000000 701000 xent               TSX1    UQB$MDEQ
         1 000556   000000 011000                    NOP     0

      724     4832    2         IF B$JIT.ERR.CODE=0 THEN GOTO NOTNEW;

   4832  1 000557   000000 470400 xsym               LDP0    B$JIT$
         1 000560   000012 236100                    LDQ     10,,PR0
         1 000561   377770 316007                    CANQ    131064,DL
         1 000562   000630 600000 1                  TZE     NOTNEW

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:154  
      725     4833    2         IF B$JIT.ERR.CODE~=%E$NOKEY THEN GOTO RETALTCFU;

   4833  1 000563   000012 236100                    LDQ     10,,PR0
         1 000564   377770 376007                    ANQ     131064,DL
         1 000565   001020 116007                    CMPQ    528,DL
         1 000566   001325 601000 1                  TNZ     RETALTCFU

   4833  1 000567                       TISNEW       null
      726     4834    2   TISNEW: ;
      727     4835    2         B$JIT.ERR=FMN$E$NOKEY;

   4835  1 000567   000007 236000 0                  LDQ     FMN$E$NOKEY
         1 000570   000012 756100                    STQ     10,,PR0

      728     4836    2         IF FPT$OPEN_V.DELETE

   4836  1 000571   200003 471500                    LDP1    @PN$,,AUTO
         1 000572   100000 473500                    LDP3    0,,PR1
         1 000573   300000 236100                    LDQ     0,,PR3
         1 000574   040000 316007                    CANQ    16384,DL
         1 000575   001325 601000 1                  TNZ     RETALTCFU
         1 000576   100013 236100                    LDQ     11,,PR1
         1 000577   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000600   001325 600000 1                  TZE     RETALTCFU

      729     4837    2           OR PN$.IFPARAM_=ADDR(NIL)
      730     4838    2         THEN GOTO RETALTCFU;
      731     4839    3         IF F$DCB.IASN~=%FMDIAG# THEN DO;

   4839  1 000601   200010 474500                    LDP4    JDCB$,,AUTO
         1 000602   400103 236100                    LDQ     67,,PR4
         1 000603   000777 376007                    ANQ     511,DL
         1 000604   000007 116007                    CMPQ    7,DL
         1 000605   000612 600000 1                  TZE     s:4846

      732     4840    3   FMNE$NOTAUTHR:B$JIT.ERR=FMN$E$NOTAUTH;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:155  
   4840  1 000606   000003 236000 0     FMNE$NOTAUT* LDQ     FMN$E$NOTAUTH
         1 000607   000000 470400 xsym               LDP0    B$JIT$
         1 000610   000012 756100                    STQ     10,,PR0

      733     4841    3            GOTO RETALTCFU;

   4841  1 000611   001325 710000 1                  TRA     RETALTCFU

      734     4842    3            END;
      735     4843                    /*E*     ERROR: FMN-E$NOKEY-E
      736     4844                    *        MESSAGE:Account% DP#%SN%%.%AC% does not exist.
      737     4845                    */
      738     4846    2         CALL FMN$CHKACCN (B$JIT.DCB$) ALTRET(RETALTCFU);

   4846  1 000612   000000 236000 xsym               LDQ     B$JIT$
         1 000613   000232 036003                    ADLQ    154,DU
         1 000614   200026 756100                    STQ     UN+3,,AUTO
         1 000615   200026 630500                    EPPR0   UN+3,,AUTO
         1 000616   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000617   000000 701000 xent               TSX1    FMN$CHKACCN
         1 000620   001325 702000 1                  TSX2    RETALTCFU

      739     4847    2         CALL FMQ$BLDFD (FM$CFUA) ALTRET(RETALTCFU);

   4847  1 000621   200004 630500                    EPPR0   ACCT$,,AUTO
         1 000622   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000623   000000 701000 xent               TSX1    FMQ$BLDFD
         1 000624   001325 702000 1                  TSX2    RETALTCFU

      740     4848    2         FM$CFUA.FLAGS='0'B;/* FORCE READFDFIT TO SET CGRANS, ETC. */

   4848  1 000625   200004 470500                    LDP0    ACCT$,,AUTO
         1 000626   000010 236000 2                  LDQ     8
         1 000627   000005 356100                    ANSQ    5,,PR0

   4848  1 000630                       NOTNEW       null
      741     4849    2   NOTNEW: ;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:156  
      742     4850    2         IF FPT$OPEN_V.DELETE THEN GOTO RETALTCFU;

   4850  1 000630   200003 470500                    LDP0    @PN$,,AUTO
         1 000631   000000 471500                    LDP1    0,,PR0
         1 000632   100000 236100                    LDQ     0,,PR1
         1 000633   040000 316007                    CANQ    16384,DL
         1 000634   001325 601000 1                  TNZ     RETALTCFU

      743     4851    2         B$JIT.ERR='0'B;

   4851  1 000635   000000 473400 xsym               LDP3    B$JIT$
         1 000636   300012 450100                    STZ     10,,PR3

      744     4852    2         CALL FMN$READFDFIT;

   4852  1 000637   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000640   000000 701000 xent               TSX1    FMN$READFDFIT
         1 000641   000000 011000                    NOP     0

      745     4853    2         BUF$=FM$BUF$(F$DCB.BFR.BUFX(1));

   4853  1 000642   200010 470500                    LDP0    JDCB$,,AUTO
         1 000643   000116 236100                    LDQ     78,,PR0
         1 000644   000033 772000                    QRL     27
         1 000645   000037 376007                    ANQ     31,DL
         1 000646   000000 236006 xsym               LDQ     FM$BUF$,QL
         1 000647   200007 756100                    STQ     BUF$,,AUTO

      746     4854    2         IF BUF$=ADDR(NIL) THEN GOTO RETALTCFU;

   4854  1 000650   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000651   001325 600000 1                  TZE     RETALTCFU

      747     4855    2         I=4*(FM$GRAN.FCEX-SIZEW(FM$GRAN));

   4855  1 000652   200007 471500                    LDP1    BUF$,,AUTO
         1 000653   100002 236100                    LDQ     2,,PR1
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:157  
         1 000654   000020 772000                    QRL     16
         1 000655   000011 376000 2                  ANQ     9
         1 000656   000024 136007                    SBLQ    20,DL
         1 000657   200013 756100                    STQ     I,,AUTO

      748     4856    2         BUF$=PINCRW(BUF$,SIZEW(FM$GRAN)); /* START OF FIT */

   4856  1 000660   200007 236100                    LDQ     BUF$,,AUTO
         1 000661   000005 036003                    ADLQ    5,DU
         1 000662   200007 756100                    STQ     BUF$,,AUTO

      749     4857    2         IF F$DCB.IASN~=%FMDIAG# THEN CALL CHKOWNER;

   4857  1 000663   000103 236100                    LDQ     67,,PR0
         1 000664   000777 376007                    ANQ     511,DL
         1 000665   000007 116007                    CMPQ    7,DL
         1 000666   000672 600000 1                  TZE     s:4858

   4857  1 000667   005427 701000 1                  TSX1    CHKOWNER
         1 000670   000000 011000                    NOP     0
         1 000671   000674 710000 1                  TRA     s:4859

      750     4858    2         ELSE F$DCB.OWNER='1'B;

   4858  1 000672   040000 236007                    LDQ     16384,DL
         1 000673   000064 256100                    ORSQ    52,,PR0

      751     4859    2         IF NOT F$DCB.OWNER AND NOT F$DCB.FFLG&%(FFLG_CREATE#|FFLG_DELF#)

   4859  1 000674   200010 470500                    LDP0    JDCB$,,AUTO
         1 000675   000064 236100                    LDQ     52,,PR0
         1 000676   040000 316007                    CANQ    16384,DL
         1 000677   000706 601000 1                  TNZ     s:4861
         1 000700   000004 220100                    LDX0    4,,PR0
         1 000701   021000 360003                    ANX0    8704,DU
         1 000702   000706 601000 1                  TNZ     s:4861

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:158  
      752     4860    2         THEN B$JIT.ERR=FMN$E$NOACCESS;

   4860  1 000703   000006 236000 0                  LDQ     FMN$E$NOACCESS
         1 000704   000000 471400 xsym               LDP1    B$JIT$
         1 000705   100012 756100                    STQ     10,,PR1

      753     4861    2         IF B$JIT.ERR THEN GOTO RETALTCFU;

   4861  1 000706   000000 471400 xsym               LDP1    B$JIT$
         1 000707   100012 235100                    LDA     10,,PR1
         1 000710   001325 601000 1                  TNZ     RETALTCFU

      754     4862    3         IF PN$.FPARAM_~=ADDR(NIL) THEN DO;

   4862  1 000711   200003 473500                    LDP3    @PN$,,AUTO
         1 000712   300014 236100                    LDQ     12,,PR3
         1 000713   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000714   000743 600000 1                  TZE     s:4869

      755     4863    3            IF F$DCB.IASN=%FMDIAG# THEN PN$.FPARAM_->RECI=BUF$->RECI;

   4863  1 000715   000103 236100                    LDQ     67,,PR0
         1 000716   000777 376007                    ANQ     511,DL
         1 000717   000007 116007                    CMPQ    7,DL
         1 000720   000730 601000 1                  TNZ     s:4865

   4863  1 000721   300014 474500                    LDP4    12,,PR3
         1 000722   200007 475500                    LDP5    BUF$,,AUTO
         1 000723   200013 720100                    LXL0    I,,AUTO
         1 000724   040140 100540                    MLR     fill='040'O
         1 000725   500000 000010                    ADSC9   0,,PR5                   cn=0,n=*X0
         1 000726   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0
         1 000727   000743 710000 1                  TRA     s:4869

      756     4864    4            ELSE DO;

      757     4865    4               T$=BUF$;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:159  

   4865  1 000730   200007 236100                    LDQ     BUF$,,AUTO
         1 000731   200017 756100                    STQ     T$,,AUTO

      758     4866    4               CALL FMO$TRNINFO (PN$.FPARAM_,XT$) ALTRET(RETALTCFU);

   4866  1 000732   200020 236100                    LDQ     T$$,,AUTO
         1 000733   200027 756100                    STQ     UN+4,,AUTO
         1 000734   200003 236100                    LDQ     @PN$,,AUTO
         1 000735   000014 036003                    ADLQ    12,DU
         1 000736   200026 756100                    STQ     UN+3,,AUTO
         1 000737   200026 630500                    EPPR0   UN+3,,AUTO
         1 000740   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000741   000000 701000 xent               TSX1    FMO$TRNINFO
         1 000742   001325 702000 1                  TSX2    RETALTCFU

      759     4867    4               END;

      760     4868    3            END;

      761     4869    3         IF PN$.IFPARAM_~=ADDR(NIL) THEN DO;

   4869  1 000743   200003 470500                    LDP0    @PN$,,AUTO
         1 000744   000013 236100                    LDQ     11,,PR0
         1 000745   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000746   001325 600000 1                  TZE     RETALTCFU

      762     4870    3            IF NOT F$DCB.OWNER THEN GOTO FMNE$NOTAUTHR;

   4870  1 000747   200010 471500                    LDP1    JDCB$,,AUTO
         1 000750   100064 236100                    LDQ     52,,PR1
         1 000751   040000 316007                    CANQ    16384,DL
         1 000752   000606 600000 1                  TZE     FMNE$NOTAUTHR

      763     4871    3            F$DCB.OWNER=FM$SET.XCL;

   4871  1 000753   200012 473500                    LDP3    SET$,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:160  
         1 000754   300002 236100                    LDQ     2,,PR3
         1 000755   000025 772000                    QRL     21
         1 000756   100064 676100                    ERQ     52,,PR1
         1 000757   040000 376007                    ANQ     16384,DL
         1 000760   100064 656100                    ERSQ    52,,PR1

      764     4872    4            DO DCTX=1 TO IFPFIT.CODES.CODE(0);

   4872  1 000761   000001 235007                    LDA     1,DL
         1 000762   200011 755100                    STA     DCTX,,AUTO
         1 000763   001311 710000 1                  TRA     NOMOD+3

      765     4873    4               CFU$=PINCRW(PN$.IFPARAM_,IFPFIT.CODES.ITEMX(DCTX));

   4873  1 000764   200003 470500                    LDP0    @PN$,,AUTO
         1 000765   000013 471500                    LDP1    11,,PR0
         1 000766   200011 720100                    LXL0    DCTX,,AUTO
         1 000767   100000 721110                    LXL1    0,X0,PR1
         1 000770   001777 361003                    ANX1    1023,DU
         1 000771   100000 633511                    EPPR3   0,X1,PR1
         1 000772   200006 453500                    STP3    CFU$,,AUTO

      766     4874    4               I=IFPFIT.CODES.CODE(DCTX);

   4874  1 000773   100000 236110                    LDQ     0,X0,PR1
         1 000774   000037 772000                    QRL     31
         1 000775   200013 756100                    STQ     I,,AUTO

      767     4875    5               DO CASE(I);

   4875  1 000776   000004 136007                    SBLQ    4,DL
         1 000777   000013 116007                    CMPQ    11,DL
         1 001000   001002 602006 1                  TNC     s:4875+4,QL
         1 001001   001256 710000 1                  TRA     s:4919
         1 001002   001015 710000 1                  TRA     s:4877
         1 001003   001256 710000 1                  TRA     s:4919
         1 001004   001256 710000 1                  TRA     s:4919
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:161  
         1 001005   001256 710000 1                  TRA     s:4919
         1 001006   001256 710000 1                  TRA     s:4919
         1 001007   001202 710000 1                  TRA     s:4910
         1 001010   001256 710000 1                  TRA     s:4919
         1 001011   001256 710000 1                  TRA     s:4919
         1 001012   001256 710000 1                  TRA     s:4919
         1 001013   001256 710000 1                  TRA     s:4919
         1 001014   001043 710000 1                  TRA     s:4885

      768     4876    5               CASE(4);

      769     4877    6                  IF F$DCB.IASN=%FMDIAG# THEN DO;

   4877  1 001015   200010 471500                    LDP1    JDCB$,,AUTO
         1 001016   100103 236100                    LDQ     67,,PR1
         1 001017   000777 376007                    ANQ     511,DL
         1 001020   000007 116007                    CMPQ    7,DL
         1 001021   001257 601000 1                  TNZ     s:4921

      770     4878    6                     CALL FITSPDIR ALTRET(NOMOD);

   4878  1 001022   005514 701000 1                  TSX1    FITSPDIR
         1 001023   001306 702000 1                  TSX2    NOMOD

      771     4879    6                     CODE04=CFU$->CODE04;

   4879  1 001024   200006 470500                    LDP0    CFU$,,AUTO
         1 001025   200005 471500                    LDP1    DCT$,,AUTO
         1 001026   000100 100500                    MLR     fill='000'O
         1 001027   000000 000054                    ADSC9   0,,PR0                   cn=0,n=44
         1 001030   100000 000054                    ADSC9   0,,PR1                   cn=0,n=44

      772     4880    6                     IF F$DCB.ACCT=BINASC(0) THEN FM$SET.GACTIME=CODE04.GAC.TIME;

   4880  1 001031   200010 473500                    LDP3    JDCB$,,AUTO
         1 001032   300020 237100                    LDAQ    16,,PR3
         1 001033   000012 117000 2                  CMPAQ   10
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:162  
         1 001034   001040 601000 1                  TNZ     s:4881

   4880  1 001035   200012 474500                    LDP4    SET$,,AUTO
         1 001036   100012 235100                    LDA     10,,PR1
         1 001037   400004 755100                    STA     4,,PR4

      773     4881    6                     F$DCB.BFR.BUFUP(1)='1'B;

   4881  1 001040   400000 236003                    LDQ     -131072,DU
         1 001041   300116 256100                    ORSQ    78,,PR3

      774     4882    6                     GOTO NOMOD;

   4882  1 001042   001306 710000 1                  TRA     NOMOD

      775     4883    6                     END;
      776     4884    5               CASE(14);

      777     4885    5                  CALL FITSPDIR ALTRET(NOMOD);

   4885  1 001043   005514 701000 1                  TSX1    FITSPDIR
         1 001044   001306 702000 1                  TSX2    NOMOD

      778     4886    5                  CODE14.DFLTALL=CFU$->CODE14.DFLTALL;

   4886  1 001045   200006 470500                    LDP0    CFU$,,AUTO
         1 001046   000000 720100                    LXL0    0,,PR0
         1 001047   200005 471500                    LDP1    DCT$,,AUTO
         1 001050   100000 440100                    SXL0    0,,PR1

      779     4887    6                  IF F$DCB.IASN=%FMDIAG# THEN DO;

   4887  1 001051   200010 473500                    LDP3    JDCB$,,AUTO
         1 001052   300103 236100                    LDQ     67,,PR3
         1 001053   000777 376007                    ANQ     511,DL
         1 001054   000007 116007                    CMPQ    7,DL
         1 001055   001124 601000 1                  TNZ     s:4897
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:163  

      780     4888    6                     CODE14.ACCESS=CFU$->CODE14.ACCESS;

   4888  1 001056   000000 221100                    LDX1    0,,PR0
         1 001057   100000 741100                    STX1    0,,PR1

      781     4889    6                     CODE14.MGRANS=CFU$->CODE14.MGRANS;

   4889  1 001060   000001 236100                    LDQ     1,,PR0
         1 001061   100001 552134                    STBQ    1,'34'O,PR1

      782     4890    6                     IF CODE14.CGMEM~=CFU$->CODE14.CGMEM

   4890  1 001062   100001 236100                    LDQ     1,,PR1
         1 001063   000001 676100                    ERQ     1,,PR0
         1 001064   777000 376003                    ANQ     -512,DU
         1 001065   001102 600000 1                  TZE     s:4892

      783     4891    6                     THEN CALL KQM$UPDA(,CFU$->CODE14.CGMEM*%CGMEMSIZ);

   4891  1 001066   000001 236100                    LDQ     1,,PR0
         1 001067   000030 772000                    QRL     24
         1 001070   007770 376007                    ANQ     4088,DL
         1 001071   200026 756100                    STQ     UN+3,,AUTO
         1 001072   200026 634500                    EPPR4   UN+3,,AUTO
         1 001073   200031 454500                    STP4    UN+6,,AUTO
         1 001074   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001075   200030 756100                    STQ     UN+5,,AUTO
         1 001076   200030 630500                    EPPR0   UN+5,,AUTO
         1 001077   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001100   000000 701000 xent               TSX1    KQM$UPDA
         1 001101   000000 011000                    NOP     0

      784     4892    6                     CODE14.CGMEM=CFU$->CODE14.CGMEM;

   4892  1 001102   200006 470500                    LDP0    CFU$,,AUTO
         1 001103   200005 471500                    LDP1    DCT$,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:164  
         1 001104   000001 236100                    LDQ     1,,PR0
         1 001105   100001 552140                    STBQ    1,'40'O,PR1

      785     4893    6                     I=4*IFPFIT.CODES.NDW(DCTX)+SIZEC(CODE14.OWNER)-SIZEC(CODE14);

   4893  1 001106   200003 473500                    LDP3    @PN$,,AUTO
         1 001107   300013 474500                    LDP4    11,,PR3
         1 001110   200011 720100                    LXL0    DCTX,,AUTO
         1 001111   400000 236110                    LDQ     0,X0,PR4
         1 001112   000010 772000                    QRL     8
         1 001113   007774 376007                    ANQ     4092,DL
         1 001114   000014 136007                    SBLQ    12,DL
         1 001115   200013 756100                    STQ     I,,AUTO

      786     4894    6                     ADDR(CODE14.OWNER)->RECI=ADDR(CFU$->CODE14.OWNER)->RECI;

   4894  1 001116   000000 621006                    EAX1    0,QL
         1 001117   200013 722100                    LXL2    I,,AUTO
         1 001120   040140 100540                    MLR     fill='040'O
         1 001121   000003 000011                    ADSC9   3,,PR0                   cn=0,n=*X1
         1 001122   100003 000012                    ADSC9   3,,PR1                   cn=0,n=*X2

      787     4895    6                     END;

   4895  1 001123   001137 710000 1                  TRA     s:4900

      788     4896    6                  ELSE DO;

      789     4897    6                     CODE14.ACCESS=CODE14.ACCESS&~OWNER_MODS |

   4897  1 001124   100000 221100                    LDX1    0,,PR1
         1 001125   753377 361003                    ANX1    -10497,DU
         1 001126   000000 222100                    LDX2    0,,PR0
         1 001127   024400 362003                    ANX2    10496,DU
         1 001130   000000 636012                    EAQ     0,X2
         1 001131   200026 756100                    STQ     UN+3,,AUTO
         1 001132   000000 636011                    EAQ     0,X1
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:165  
         1 001133   200026 276100                    ORQ     UN+3,,AUTO
         1 001134   000022 772000                    QRL     18
         1 001135   000000 620006                    EAX0    0,QL
         1 001136   100000 740100                    STX0    0,,PR1

      790     4898    6                       CFU$->CODE14.ACCESS&OWNER_MODS;
      791     4899    6                     END;

      792     4900    5                  CODE14.ACCESS.LIST=FM$CFUA.ACCESS.LIST;

   4900  1 001137   200004 473500                    LDP3    ACCT$,,AUTO
         1 001140   300005 236100                    LDQ     5,,PR3
         1 001141   000022 736000                    QLS     18
         1 001142   100000 676100                    ERQ     0,,PR1
         1 001143   200000 376003                    ANQ     65536,DU
         1 001144   100000 656100                    ERSQ    0,,PR1

      793     4901    5                  FM$CFUA.ACCESS=CODE14.ACCESS;

   4901  1 001145   100000 220100                    LDX0    0,,PR1
         1 001146   300005 440100                    SXL0    5,,PR3

      794     4902    5                  FM$CFUA.DFLTALL=CODE14.DFLTALL;

   4902  1 001147   100000 721100                    LXL1    0,,PR1
         1 001150   300006 441100                    SXL1    6,,PR3

      795     4903    5                  FM$CFUA.GRANS=CODE14.MGRANS-CODE14.CGRANS;

   4903  1 001151   100001 236100                    LDQ     1,,PR1
         1 001152   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001153   100002 136100                    SBLQ    2,,PR1
         1 001154   300007 756100                    STQ     7,,PR3

      796     4904    6                  IF F$DCB.ACCT=BINASC(0) THEN DO;

   4904  1 001155   200010 474500                    LDP4    JDCB$,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:166  
         1 001156   400020 237100                    LDAQ    16,,PR4
         1 001157   000012 117000 2                  CMPAQ   10
         1 001160   001257 601000 1                  TNZ     s:4921

      797     4905    6                     FM$SET.GACSHELF=CODE14.ACCESS.GACSHELF;

   4905  1 001161   200012 475500                    LDP5    SET$,,AUTO
         1 001162   100000 236100                    LDQ     0,,PR1
         1 001163   500002 676100                    ERQ     2,,PR5
         1 001164   000002 376003                    ANQ     2,DU
         1 001165   500002 656100                    ERSQ    2,,PR5

      798     4906    6                     FM$SET.WRCMP=CODE14.ACCESS.WRCMP|

   4906  1 001166   100000 236100                    LDQ     0,,PR1
         1 001167   400000 376003                    ANQ     -131072,DU
         1 001170   200026 756100                    STQ     UN+3,,AUTO
         1 001171   100000 236100                    LDQ     0,,PR1
         1 001172   000002 736000                    QLS     2
         1 001173   400000 376003                    ANQ     -131072,DU
         1 001174   200026 276100                    ORQ     UN+3,,AUTO
         1 001175   000002 772000                    QRL     2
         1 001176   500002 676100                    ERQ     2,,PR5
         1 001177   100000 376003                    ANQ     32768,DU
         1 001200   500002 656100                    ERSQ    2,,PR5

      799     4907    6                       CODE14.ACCESS.WCDATA;
      800     4908    6                     END;

   4908  1 001201   001257 710000 1                  TRA     s:4921

      801     4909    5               CASE(9);

      802     4910    5                  CALL FITSPDIR ALTRET(NOMOD);

   4910  1 001202   005514 701000 1                  TSX1    FITSPDIR
         1 001203   001306 702000 1                  TSX2    NOMOD
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:167  

      803     4911    5                  I=4*IFPFIT.CODES.NDW(DCTX);

   4911  1 001204   200003 470500                    LDP0    @PN$,,AUTO
         1 001205   000013 471500                    LDP1    11,,PR0
         1 001206   200011 720100                    LXL0    DCTX,,AUTO
         1 001207   100000 236110                    LDQ     0,X0,PR1
         1 001210   000010 772000                    QRL     8
         1 001211   007774 376007                    ANQ     4092,DL
         1 001212   200013 756100                    STQ     I,,AUTO

      804     4912    5                  DCT$->RECI=CFU$->RECI;

   4912  1 001213   200006 471500                    LDP1    CFU$,,AUTO
         1 001214   000000 621006                    EAX1    0,QL
         1 001215   200005 473500                    LDP3    DCT$,,AUTO
         1 001216   200013 722100                    LXL2    I,,AUTO
         1 001217   040140 100540                    MLR     fill='040'O
         1 001220   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1
         1 001221   300000 000012                    ADSC9   0,,PR3                   cn=0,n=*X2

      805     4913    5                  T$=BUF$;

   4913  1 001222   200007 236100                    LDQ     BUF$,,AUTO
         1 001223   200017 756100                    STQ     T$,,AUTO

      806     4914    5                  CALL FMO$LOCCODP (XT$,14);

   4914  1 001224   000015 236000 2                  LDQ     13
         1 001225   200020 235100                    LDA     T$$,,AUTO
         1 001226   200026 757100                    STAQ    UN+3,,AUTO
         1 001227   200026 630500                    EPPR0   UN+3,,AUTO
         1 001230   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001231   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001232   000000 011000                    NOP     0

      807     4915    5                  DCT$=T$;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:168  

   4915  1 001233   200017 236100                    LDQ     T$,,AUTO
         1 001234   200005 756100                    STQ     DCT$,,AUTO

      808     4916    5                  CODE14.ACCESS.LIST=(I~=0);

   4916  1 001235   400000 220003                    LDX0    -131072,DU
         1 001236   200013 235100                    LDA     I,,AUTO
         1 001237   001241 601000 1                  TNZ     s:4916+4
         1 001240   000000 220003                    LDX0    0,DU
         1 001241   200005 470500                    LDP0    DCT$,,AUTO
         1 001242   000000 636010                    EAQ     0,X0
         1 001243   000001 772000                    QRL     1
         1 001244   000000 676100                    ERQ     0,,PR0
         1 001245   200000 376003                    ANQ     65536,DU
         1 001246   000000 656100                    ERSQ    0,,PR0

      809     4917    5                  FM$CFUA.ACCESS.LIST=CODE14.ACCESS.LIST;

   4917  1 001247   200004 471500                    LDP1    ACCT$,,AUTO
         1 001250   000000 236100                    LDQ     0,,PR0
         1 001251   000022 772000                    QRL     18
         1 001252   100005 676100                    ERQ     5,,PR1
         1 001253   200000 376007                    ANQ     65536,DL
         1 001254   100005 656100                    ERSQ    5,,PR1
         1 001255   001257 710000 1                  TRA     s:4921

      810     4918    5               CASE(ELSE);

      811     4919    5                  GOTO NOMOD;

   4919  1 001256   001306 710000 1                  TRA     NOMOD

      812     4920    5               END;

      813     4921    4               F$DCB.BFR.BUFUP(1)='1'B;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:169  
   4921  1 001257   200010 470500                    LDP0    JDCB$,,AUTO
         1 001260   400000 236003                    LDQ     -131072,DU
         1 001261   000116 256100                    ORSQ    78,,PR0

      814     4922    5               IF NOT B$JIT.PRIV.ACTIVE&%PR_FMEFT# THEN DO;

   4922  1 001262   000000 471400 xsym               LDP1    B$JIT$
         1 001263   100013 236100                    LDQ     11,,PR1
         1 001264   000030 376000 xsym               ANQ     B_VECTNIL+24
         1 001265   001306 601000 1                  TNZ     NOMOD

      815     4923    5                  T$=BUF$;

   4923  1 001266   200007 236100                    LDQ     BUF$,,AUTO
         1 001267   200017 756100                    STQ     T$,,AUTO

      816     4924    5                  CALL FMO$LOCCODP (XT$,4) ALTRET(NOMOD);

   4924  1 001270   000016 236000 2                  LDQ     14
         1 001271   200020 235100                    LDA     T$$,,AUTO
         1 001272   200026 757100                    STAQ    UN+3,,AUTO
         1 001273   200026 630500                    EPPR0   UN+3,,AUTO
         1 001274   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001275   000000 701000 xent               TSX1    FMO$LOCCODP
         1 001276   001306 702000 1                  TSX2    NOMOD

      817     4925    5                  CALL SSS$SYSTIME (T$->CODE04.MODIFY);

   4925  1 001277   200017 236100                    LDQ     T$,,AUTO
         1 001300   000001 036003                    ADLQ    1,DU
         1 001301   200026 756100                    STQ     UN+3,,AUTO
         1 001302   200026 630500                    EPPR0   UN+3,,AUTO
         1 001303   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001304   000000 701000 xent               TSX1    SSS$SYSTIME
         1 001305   000000 011000                    NOP     0

      818     4926    5                  END;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:170  

   4922  1 001306                       NOMOD        null
      819     4927    4   NOMOD:      ;
      820     4928    4               END;

   4928  1 001306   200011 235100                    LDA     DCTX,,AUTO
         1 001307   000001 035007                    ADLA    1,DL
         1 001310   200011 755100                    STA     DCTX,,AUTO
         1 001311   200003 470500                    LDP0    @PN$,,AUTO
         1 001312   000013 471500                    LDP1    11,,PR0
         1 001313   100000 236100                    LDQ     0,,PR1
         1 001314   000037 772000                    QRL     31
         1 001315   200011 116100                    CMPQ    DCTX,,AUTO
         1 001316   000764 603000 1                  TRC     s:4873

      821     4929    3            IF FM$CFUA.GRANS<0 THEN B$JIT.ERR=FMN$E$ACGRANS;

   4929  1 001317   200004 473500                    LDP3    ACCT$,,AUTO
         1 001320   300007 235100                    LDA     7,,PR3
         1 001321   001325 605000 1                  TPL     RETALTCFU

   4929  1 001322   000010 236000 0                  LDQ     FMN$E$ACGRANS
         1 001323   000000 474400 xsym               LDP4    B$JIT$
         1 001324   400012 756100                    STQ     10,,PR4

      822     4930    3            END;

   4927  1 001325                       RETALTCFU    null
      823     4931    2   RETALTCFU:;
      824     4932    2         CALL FMD$FLSHBUF(1);

   4932  1 001325   000004 630400 2                  EPPR0   4
         1 001326   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001327   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 001330   000000 011000                    NOP     0

      825     4933    2         T$=ACCT$;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:171  

   4933  1 001331   200004 236100                    LDQ     ACCT$,,AUTO
         1 001332   200017 756100                    STQ     T$,,AUTO

      826     4934    2         CALL UQB$MDEQ (XT$);

   4934  1 001333   200020 630500                    EPPR0   T$$,,AUTO
         1 001334   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001335   000000 701000 xent               TSX1    UQB$MDEQ
         1 001336   000000 011000                    NOP     0

      827     4935    2         T$=SET$;

   4935  1 001337   200012 236100                    LDQ     SET$,,AUTO
         1 001340   200017 756100                    STQ     T$,,AUTO

      828     4936    2         IF FM$CFUA.ACCT=BINASC(0) THEN CALL UQB$MDEQ (XT$);

   4936  1 001341   200004 470500                    LDP0    ACCT$,,AUTO
         1 001342   040000 106500                    CMPC    fill='040'O
         1 001343   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 001344   000006 000001 2                  ADSC9   6                        cn=0,n=1
         1 001345   001352 601000 1                  TNZ     s:4937

   4936  1 001346   200020 630500                    EPPR0   T$$,,AUTO
         1 001347   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001350   000000 701000 xent               TSX1    UQB$MDEQ
         1 001351   000000 011000                    NOP     0

      829     4937    2         F$DCB.CFU$->FM$CFU.ACCTX=0; /* CLERR NAME AND ACCOUNT */

   4937  1 001352   200010 470500                    LDP0    JDCB$,,AUTO
         1 001353   000066 471500                    LDP1    54,,PR0
         1 001354   000000 220003                    LDX0    0,DU
         1 001355   100002 740100                    STX0    2,,PR1

      830     4938    2         F$DCB.FCD='1'B; /* Make CLSTAR do something (release the CFU) */
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:172  

   4938  1 001356   020000 236007                    LDQ     8192,DL
         1 001357   000031 256100                    ORSQ    25,,PR0

      831     4939    2         CALL FMP$CLSTAR;

   4939  1 001360   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001361   000000 701000 xent               TSX1    FMP$CLSTAR
         1 001362   000000 011000                    NOP     0

      832     4940    2         RETURN; /* DONT OPEN THE DCB */

   4940  1 001363   000000 702200 xent               TSX2  ! X66_ARET

      833     4941    2   FMNE$FPARAM: B$JIT.ERR=FMN$E$FPARAM;

   4941  1 001364   000005 236000 0     FMNE$FPARAM  LDQ     FMN$E$FPARAM
         1 001365   000000 474400 xsym               LDP4    B$JIT$
         1 001366   400012 756100                    STQ     10,,PR4

      834     4942    2         ALTRETURN;

   4942  1 001367   000000 702200 xent               TSX2  ! X66_AALT

      835     4943    2         END;
      836     4944    1      IF F$DCB.IASN=%FMDIAG# THEN GOTO OPNDPX;

   4944  1 001370   000103 236100                    LDQ     67,,PR0
         1 001371   000777 376007                    ANQ     511,DL
         1 001372   000007 116007                    CMPQ    7,DL
         1 001373   000162 600000 1                  TZE     OPNDPX

      837     4945                    /**/
      838     4946    1   FMNE$NOTAUTH: B$JIT.ERR=FMN$E$NOTAUTH;

   4946  1 001374   000003 236000 0     FMNE$NOTAUTH LDQ     FMN$E$NOTAUTH
         1 001375   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:173  
         1 001376   000012 756100                    STQ     10,,PR0

      839     4947    1      ALTRETURN;

   4947  1 001377   000000 702200 xent               TSX2  ! X66_AALT

      840     4948                    /**/
      841     4949    1   FMNE$XCLSET:B$JIT.ERR=FMN$E$XCLSET;

   4949  1 001400   000002 236000 0     FMNE$XCLSET  LDQ     FMN$E$XCLSET
         1 001401   000000 471400 xsym               LDP1    B$JIT$
         1 001402   100012 756100                    STQ     10,,PR1

      842     4950    1      F$DCB.PSN=FMX$SET.PSN(FM$VOL.SETX(DCTX));

   4950  1 001403   000000 236105                    LDQ     0,AL,PR0
         1 001404   000003 736000                    QLS     3
         1 001405   000000 376000 2                  ANQ     0
         1 001406   000002 736000                    QLS     2
         1 001407   200010 473500                    LDP3    JDCB$,,AUTO
         1 001410   040100 100506                    MLR     fill='040'O
         1 001411   000000 400006                    ADSC9   0,Q,PR0                  cn=2,n=6
         1 001412   300024 000006                    ADSC9   20,,PR3                  cn=0,n=6

      843     4951    1      FM$DEV.SYSID(FM$SET.DCTX)=0;

   4951  1 001413   200012 474500                    LDP4    SET$,,AUTO
         1 001414   400000 236100                    LDQ     0,,PR4
         1 001415   000017 772000                    QRL     15
         1 001416   000000 376000 2                  ANQ     0
         1 001417   000000 220003                    LDX0    0,DU
         1 001420   000002 440106                    SXL0    2,QL,PR0

      844     4952    1      FM$DEV.ONEU(FM$SET.DCTX)='0'B;

   4952  1 001421   400000 236100                    LDQ     0,,PR4
         1 001422   000017 772000                    QRL     15
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:174  
         1 001423   000000 376000 2                  ANQ     0
         1 001424   000000 470400 xsym               LDP0    FM$SET$
         1 001425   000000 621006                    EAX1    0,QL
         1 001426   000017 236000 2                  LDQ     15
         1 001427   000002 356111                    ANSQ    2,X1,PR0

      845     4953    1      FM$SET.SYSID=0;

   4953  1 001430   400002 440100                    SXL0    2,,PR4

      846     4954    1      FM$SET.ONEU='0'B;

   4954  1 001431   400002 356100                    ANSQ    2,,PR4

      847     4955    1   RETALT:ALTRETURN;

   4955  1 001432   000000 702200 xent  RETALT       TSX2  ! X66_AALT

      848     4956    1   SCREECH: CALL SC_SETRES;

   4956  1 001433   000000 713400 xsym  SCREECH      CLIMB   SC_SETRES
         1 001434   000000 600000 xsid               climb   nvectors=         0
         1 001435   001440 710000 1                  TRA     s:4981

      849     4957        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:175  
      850     4958                    /*F*     NAME: FMN$CLSDP
      851     4959                    *        PURPOSE: To close a DCB that was opened by FMN$OPNDP.
      852     4960                    *        DESCRIPTION: The close function depends on what the DCB was
      853     4961                    *        open to and the value in FPT.DISP.
      854     4962              *        If the DCB was open to a device (FM$SET.DCTX=DCB.SETX), the purpose
      855     4963              *        of this code is to keep track of what its VSN is and what set it
      856     4964              *        is part of. In this case, DISP is unused.
      857     4965              *        If the DCB was open to a set, DISP is used as follows.
      858     4966              *        SCRATCH, SETDSMT, SETDSMTF, or SETDSMTX with exclusive access to
      859     4967            *       the set causes it to be dismounted and the resources and setname freed.
      860     4968              *        SETPRIV causes the set to become available to users in general
      861     4969              *        provided it is not a dual set (there is no :DUAL.$$EFT).
      862     4970              *        SETPUB is the same as SETPRIV except the PAD is merged into the MAD.
      863     4971              *        SETDSMT,SETDSMTF, and SETDSMTX for non-exclusive use start a
      864     4972              *        dismount process by preventing any new users of the set.
      865     4973              *        SETDSMTF also disconnects non-batch users of the set when they next
      866     4974              *        reach jobstep. SETDSMTX aborts all current users of the set.
      867     4975              *        Any other DISP causes no change in the set's status.
      868     4976              *        Only PIG is permitted to use SETPUB or SETPRIV for any set,
      869     4977              *        or any SETDSMT for a non-exclusive set.
      870     4978              *        CALL: CALL FMN$CLSDP(CLOSEFPTPOINTERS)ALTRET;
      871     4979              */
      872     4980    1   FMN$CLSDP:ENTRY(PN$)ALTRET;

   4980  1 001436   000000 700200 xent  FMN$CLSDP    TSX0  ! X66_AUTO_1
         1 001437   000040 000001                    ZERO    32,1

      873     4981    1      JDCB$=B$JIT.DCB$;

   4981  1 001440   000000 470400 xsym               LDP0    B$JIT$
         1 001441   000232 236100                    LDQ     154,,PR0
         1 001442   200010 756100                    STQ     JDCB$,,AUTO

      874     4982    1      T$$=ADDR(T$);

   4982  1 001443   200017 631500                    EPPR1   T$,,AUTO
         1 001444   200020 451500                    STP1    T$$,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:176  

      875     4983    1      I=F$DCB.SETX;

   4983  1 001445   200010 473500                    LDP3    JDCB$,,AUTO
         1 001446   300051 236100                    LDQ     41,,PR3
         1 001447   777777 376007                    ANQ     -1,DL
         1 001450   200013 756100                    STQ     I,,AUTO

      876     4984    1      SET$=ADDR(FMX$SET(I));

   4984  1 001451   000025 736000                    QLS     21
         1 001452   000000 036000 xsym               ADLQ    FM$SET$
         1 001453   200012 756100                    STQ     SET$,,AUTO

      877     4985    1      IF F$DCB.FFLG.WNEW AND FM$SET.SET AND SUBSTR(FM$SET.PSN,4,1)~=''''

   4985  1 001454   300004 236100                    LDQ     4,,PR3
         1 001455   100000 316003                    CANQ    32768,DU
         1 001456   001513 600000 1                  TZE     s:4993
         1 001457   200012 474500                    LDP4    SET$,,AUTO
         1 001460   400002 236100                    LDQ     2,,PR4
         1 001461   200000 316003                    CANQ    65536,DU
         1 001462   001513 600000 1                  TZE     s:4993
         1 001463   400001 236100                    LDQ     1,,PR4
         1 001464   777000 376007                    ANQ     -512,DL
         1 001465   047000 116007                    CMPQ    19968,DL
         1 001466   001513 600000 1                  TZE     s:4993
         1 001467   400006 236100                    LDQ     6,,PR4
         1 001470   777000 376007                    ANQ     -512,DL
         1 001471   047000 116007                    CMPQ    19968,DL
         1 001472   001513 600000 1                  TZE     s:4993

      878     4986    2        AND SUBSTR(FM$SET.REALPSN,4,1)~='''' THEN DO;

      879     4987    2         CALL FMR$L8;

   4987  1 001473   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:177  
         1 001474   000000 701000 xent               TSX1    FMR$L8
         1 001475   000000 011000                    NOP     0

      880     4988    2         FM$CFUX.GCT=FM$CFUX.GCT+1; /* MAKE THE ACCOUNT BLOCKS GO AWAY */

   4988  1 001476   000000 470400 xsym               LDP0    F$CFU$
         1 001477   000000 220100                    LDX0    0,,PR0
         1 001500   000001 621010                    EAX1    1,X0
         1 001501   000000 741100                    STX1    0,,PR0

      881     4989    2         CALL FMS$GARBCOL;

   4989  1 001502   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001503   000000 701000 xent               TSX1    FMS$GARBCOL
         1 001504   000000 011000                    NOP     0

      882     4990    2         CALL FMR$U8;

   4990  1 001505   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001506   000000 701000 xent               TSX1    FMR$U8
         1 001507   000000 011000                    NOP     0

      883     4991    2         CALL FAG$CGRANS ALTRET(RETALT);

   4991  1 001510   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001511   000000 701000 xent               TSX1    FAG$CGRANS
         1 001512   001432 702000 1                  TSX2    RETALT

      884     4992    2         END;

      885     4993    1      DCTX=FM$SET.DCTX;

   4993  1 001513   200012 470500                    LDP0    SET$,,AUTO
         1 001514   000000 236100                    LDQ     0,,PR0
         1 001515   000022 772000                    QRL     18
         1 001516   200011 756100                    STQ     DCTX,,AUTO

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:178  
      886     4994    1      IF FM$SET.SET THEN DCTX=FM$VOL.DCTX(DCTX);

   4994  1 001517   000002 236100                    LDQ     2,,PR0
         1 001520   200000 316003                    CANQ    65536,DU
         1 001521   001530 600000 1                  TZE     s:4995

   4994  1 001522   200011 235100                    LDA     DCTX,,AUTO
         1 001523   000003 735000                    ALS     3
         1 001524   000000 471400 xsym               LDP1    FM$SET$
         1 001525   100000 236105                    LDQ     0,AL,PR1
         1 001526   000022 772000                    QRL     18
         1 001527   200011 756100                    STQ     DCTX,,AUTO

      887     4995    1      DCT$=N$DCT$(DCTX);

   4995  1 001530   000000 471400 xsym               LDP1    N$DCT$$
         1 001531   200011 720100                    LXL0    DCTX,,AUTO
         1 001532   100000 236110                    LDQ     0,X0,PR1
         1 001533   200005 756100                    STQ     DCT$,,AUTO

      888     4996    1      IF PN$.V_=ADDR(NIL) THEN GOTO DFLCLS;

   4996  1 001534   200003 473500                    LDP3    @PN$,,AUTO
         1 001535   300000 236100                    LDQ     0,,PR3
         1 001536   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001537   001564 600000 1                  TZE     DFLCLS

      889     4997    2      DO CASE(FPT$CLOSE_V.DISP);

   4997  1 001540   300000 474500                    LDP4    0,,PR3
         1 001541   400000 721100                    LXL1    0,,PR4
         1 001542   000777 361003                    ANX1    511,DU
         1 001543   000016 101003                    CMPX1   14,DU
         1 001544   001546 602011 1                  TNC     s:4997+6,X1
         1 001545   001564 710000 1                  TRA     DFLCLS
         1 001546   001564 710000 1                  TRA     DFLCLS
         1 001547   001566 710000 1                  TRA     s:5002
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:179  
         1 001550   001564 710000 1                  TRA     DFLCLS
         1 001551   001564 710000 1                  TRA     DFLCLS
         1 001552   001564 710000 1                  TRA     DFLCLS
         1 001553   001564 710000 1                  TRA     DFLCLS
         1 001554   001564 710000 1                  TRA     DFLCLS
         1 001555   001564 710000 1                  TRA     DFLCLS
         1 001556   001571 710000 1                  TRA     s:5004
         1 001557   001574 710000 1                  TRA     s:5006
         1 001560   001564 710000 1                  TRA     DFLCLS
         1 001561   001577 710000 1                  TRA     s:5008
         1 001562   001602 710000 1                  TRA     s:5010
         1 001563   001605 710000 1                  TRA     s:5012

      890     4998    2      CASE(ELSE);

   4994  1 001564                       DFLCLS       null
      891     4999    2   DFLCLS:;
      892     5000    2         FLAG='0'B;

   5000  1 001564   200007 450100                    STZ     BUF$,,AUTO
         1 001565   001607 710000 1                  TRA     s:5014

      893     5001    2      CASE(%SCRATCH#);

      894     5002    2         FLAG='1'O;/* RELEASE SET */

   5002  1 001566   100000 236003                    LDQ     32768,DU
         1 001567   200007 756100                    STQ     BUF$,,AUTO
         1 001570   001607 710000 1                  TRA     s:5014

      895     5003    2      CASE(%SETPUB#);

      896     5004    2         FLAG='6'O;/* SHARED, MERGE PAD INTO MAD*/

   5004  1 001571   600000 236003                    LDQ     -65536,DU
         1 001572   200007 756100                    STQ     BUF$,,AUTO
         1 001573   001607 710000 1                  TRA     s:5014
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:180  

      897     5005    2      CASE(%SETPRIV#);

      898     5006    2         FLAG='4'O;/*SHARED*/

   5006  1 001574   400000 236003                    LDQ     -131072,DU
         1 001575   200007 756100                    STQ     BUF$,,AUTO
         1 001576   001607 710000 1                  TRA     s:5014

      899     5007    2      CASE(%SETDSMT#);

      900     5008    2         FLAG='04'O;/*DISMOUNT*/

   5008  1 001577   040000 236003                    LDQ     16384,DU
         1 001600   200007 756100                    STQ     BUF$,,AUTO
         1 001601   001607 710000 1                  TRA     s:5014

      901     5009    2      CASE(%SETDSMTF#);

      902     5010    2         FLAG='06'O;/*DISMOUNT, FAST*/

   5010  1 001602   060000 236003                    LDQ     24576,DU
         1 001603   200007 756100                    STQ     BUF$,,AUTO
         1 001604   001607 710000 1                  TRA     s:5014

      903     5011    2      CASE(%SETDSMTX#);

      904     5012    2         FLAG='05'O;/*DISMOUNT, NOW*/

   5012  1 001605   050000 236003                    LDQ     20480,DU
         1 001606   200007 756100                    STQ     BUF$,,AUTO

      905     5013    2      END;

      906     5014    2      IF NOT FM$SET.XCL THEN DO;

   5014  1 001607   000002 234100                    SZN     2,,PR0
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:181  
         1 001610   001646 604000 1                  TMI     s:5027

      907     5015    2         IF I=FM_SYSSETX THEN FLAG=FLAG&'2'O; /*MADMRG ONLY*/

   5015  1 001611   200013 236100                    LDQ     I,,AUTO
         1 001612   000000 116000 xsym               CMPQ    FM_SYSSETX
         1 001613   001620 601000 1                  TNZ     s:5017

   5015  1 001614   200007 236100                    LDQ     BUF$,,AUTO
         1 001615   200000 376003                    ANQ     65536,DU
         1 001616   200007 756100                    STQ     BUF$,,AUTO
         1 001617   001655 710000 1                  TRA     s:5030

      908     5016    3         ELSE DO;

      909     5017    4            IF B$JIT.SYSID~=JG_PIG# THEN DO;

   5017  1 001620   000000 474400 xsym               LDP4    B$JIT$
         1 001621   400000 721100                    LXL1    0,,PR4
         1 001622   000007 101003                    CMPX1   7,DU
         1 001623   001655 600000 1                  TZE     s:5030

      910     5018    5               IF FLAG&'17'O THEN DO;

   5018  1 001624   200007 236100                    LDQ     BUF$,,AUTO
         1 001625   170000 376003                    ANQ     61440,DU
         1 001626   001642 600000 1                  TZE     s:5023

      911     5019    5                  CALL FMS$RELACCT(I)ALTRET(RETALT);

   5019  1 001627   200013 635500                    EPPR5   I,,AUTO
         1 001630   200026 455500                    STP5    UN+3,,AUTO
         1 001631   200026 630500                    EPPR0   UN+3,,AUTO
         1 001632   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001633   000000 701000 xent               TSX1    FMS$RELACCT
         1 001634   001432 702000 1                  TSX2    RETALT

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:182  
      912     5020    5                  CALL FMP$UDLIST(FM$SET);

   5020  1 001635   200012 630500                    EPPR0   SET$,,AUTO
         1 001636   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001637   000000 701000 xent               TSX1    FMP$UDLIST
         1 001640   000000 011000                    NOP     0

      913     5021    5                  RETURN;

   5021  1 001641   000000 702200 xent               TSX2  ! X66_ARET

      914     5022    5                  END;
      915     5023    4               ELSE FLAG=FLAG&'2'O;

   5023  1 001642   200007 236100                    LDQ     BUF$,,AUTO
         1 001643   200000 376003                    ANQ     65536,DU
         1 001644   200007 756100                    STQ     BUF$,,AUTO

      916     5024    4               END;

      917     5025    3            END;

      918     5026    2         END;

   5026  1 001645   001655 710000 1                  TRA     s:5030

      919     5027    1      ELSE IF B$JIT.SYSID>JG_PIG# THEN FLAG=FLAG&'14'O;/* NO FAST,NOW */

   5027  1 001646   000000 474400 xsym               LDP4    B$JIT$
         1 001647   400000 721100                    LXL1    0,,PR4
         1 001650   000010 101003                    CMPX1   8,DU
         1 001651   001655 602000 1                  TNC     s:5030

   5027  1 001652   200007 236100                    LDQ     BUF$,,AUTO
         1 001653   140000 376003                    ANQ     49152,DU
         1 001654   200007 756100                    STQ     BUF$,,AUTO

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:183  
      920     5028        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:184  
      921     5029                    /* CHECK FOR VID CHANGE IF DEVICE */
      922     5030    2      IF NOT FM$SET.SET AND I~=DCTX THEN DO;

   5030  1 001655   000002 236100                    LDQ     2,,PR0
         1 001656   200000 316003                    CANQ    65536,DU
         1 001657   002751 601000 1                  TNZ     s:5177
         1 001660   200013 236100                    LDQ     I,,AUTO
         1 001661   200011 116100                    CMPQ    DCTX,,AUTO
         1 001662   002751 600000 1                  TZE     s:5177

      923     5031    2         CALL FMD$GETBUF (0,1,XT$);

   5031  1 001663   200020 236100                    LDQ     T$$,,AUTO
         1 001664   200030 756100                    STQ     UN+5,,AUTO
         1 001665   000020 237000 2                  LDAQ    16
         1 001666   200026 757100                    STAQ    UN+3,,AUTO
         1 001667   200026 630500                    EPPR0   UN+3,,AUTO
         1 001670   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001671   000000 701000 xent               TSX1    FMD$GETBUF
         1 001672   000000 011000                    NOP     0

      924     5032    2         BUF$=T$;

   5032  1 001673   200017 236100                    LDQ     T$,,AUTO
         1 001674   200007 756100                    STQ     BUF$,,AUTO

      925     5033    2         VID.ID=' ';

   5033  1 001675   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 001676   200007 470500                    LDP0    BUF$,,AUTO
         1 001677   000000 756100                    STQ     0,,PR0

      926     5034    2         IF VOL.SPIN THEN CALL FMN$RDGRAN (XT$,FM_SRZERO);

   5034  1 001700   200012 471500                    LDP1    SET$,,AUTO
         1 001701   100002 236100                    LDQ     2,,PR1
         1 001702   004000 316003                    CANQ    2048,DU
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:185  
         1 001703   001713 600000 1                  TZE     s:5036

   5034  1 001704   000022 236000 2                  LDQ     18
         1 001705   200020 235100                    LDA     T$$,,AUTO
         1 001706   200026 757100                    STAQ    UN+3,,AUTO
         1 001707   200026 630500                    EPPR0   UN+3,,AUTO
         1 001710   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001711   000000 701000 xent               TSX1    FMN$RDGRAN
         1 001712   000000 011000                    NOP     0

      927     5035                    /* IS IT PROPERLY INITIALIZED? */
      928     5036    2         IF VID.ID~='CP6' OR VID.VSN~=VOL.VSN THEN VID.VSN=0; /* NO */

   5036  1 001713   200007 470500                    LDP0    BUF$,,AUTO
         1 001714   040000 106500                    CMPC    fill='040'O
         1 001715   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 001716   000014 000003 0                  ADSC9   FMN$E$ACGRANS+4          cn=0,n=3
         1 001717   001725 601000 1                  TNZ     s:5036+10
         1 001720   200012 471500                    LDP1    SET$,,AUTO
         1 001721   100001 236100                    LDQ     1,,PR1
         1 001722   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001723   000002 116100                    CMPQ    2,,PR0
         1 001724   001726 600000 1                  TZE     s:5038

   5036  1 001725   000002 450100                    STZ     2,,PR0

      929     5037                    /* IS IT PART OF A SET? */
      930     5038    2         IF VID.VSN=0 OR VID.PSN<=' ' OR VID.VOLCNT>175 THEN VID.VOLCNT=0;

   5038  1 001726   000002 235100                    LDA     2,,PR0
         1 001727   001737 600000 1                  TZE     s:5038+9
         1 001730   040100 106400                    CMPC    fill='040'O
         1 001731   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 001732   000003 000006                    ADSC9   3,,PR0                   cn=0,n=6
         1 001733   001737 603000 1                  TRC     s:5038+9
         1 001734   000004 720100                    LXL0    4,,PR0
         1 001735   000260 100003                    CMPX0   176,DU
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:186  
         1 001736   001741 602000 1                  TNC     s:5039

   5038  1 001737   000000 220003                    LDX0    0,DU
         1 001740   000004 440100                    SXL0    4,,PR0

      931     5039    3         IF VOL.SPIN THEN DO;

   5039  1 001741   200012 471500                    LDP1    SET$,,AUTO
         1 001742   100002 236100                    LDQ     2,,PR1
         1 001743   004000 316003                    CANQ    2048,DU
         1 001744   001773 600000 1                  TZE     s:5046

      932     5040    3            CALL READVID0;

   5040  1 001745   005355 701000 1                  TSX1    READVID0
         1 001746   000000 011000                    NOP     0

      933     5041    3            IF DCT$->VID.SECTSTRT~=VID.SECTSTRT

   5041  1 001747   200005 470500                    LDP0    DCT$,,AUTO
         1 001750   200007 471500                    LDP1    BUF$,,AUTO
         1 001751   000100 106500                    CMPC    fill='000'O
         1 001752   000010 000150                    ADSC9   8,,PR0                   cn=0,n=104
         1 001753   100010 000150                    ADSC9   8,,PR1                   cn=0,n=104
         1 001754   001771 601000 1                  TNZ     s:5043
         1 001755   000000 235000 xsym               LDA     FM_SRZERO
         1 001756   777777 035007                    ADLA    -1,DL
         1 001757   200026 755100                    STA     UN+3,,AUTO
         1 001760   200012 473500                    LDP3    SET$,,AUTO
         1 001761   300003 236100                    LDQ     3,,PR3
         1 001762   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 001763   200026 116100                    CMPQ    UN+3,,AUTO
         1 001764   001771 605400 1                  TPNZ    s:5043
         1 001765   000100 106500                    CMPC    fill='000'O
         1 001766   000300 000400                    ADSC9   192,,PR0                 cn=0,n=256
         1 001767   100300 000400                    ADSC9   192,,PR1                 cn=0,n=256
         1 001770   001773 600000 1                  TZE     s:5046
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:187  

      934     5042    3              OR VOL.NXTSDA>262143+FM_SRZERO
      935     5043    3              OR DCT$->VID.DGT~=VID.DGT THEN VID.VOLCNT=0;

   5043  1 001771   000000 220003                    LDX0    0,DU
         1 001772   100004 440100                    SXL0    4,,PR1

      936     5044                    /* WONT FUNCTION IN A SET */
      937     5045    3            END;

      938     5046    2         ACCTX=0;I=0;

   5046  1 001773   200004 450100                    STZ     ACCT$,,AUTO

   5046  1 001774   200013 450100                    STZ     I,,AUTO

      939     5047                    /* IS IT IN ITS SNLIST? */
      940     5048    3         DO WHILE(ACCTX=0 AND I<VID.VOLCNT);

   5048  1 001775   002013 710000 1                  TRA     s:5051

      941     5049    3            IF DEV.VSN=BITBIN(VID.SNLIST.VSN(I)) THEN ACCTX=I+1;

   5049  1 001776   200012 470500                    LDP0    SET$,,AUTO
         1 001777   200013 235100                    LDA     I,,AUTO
         1 002000   000002 735000                    ALS     2
         1 002001   200007 471500                    LDP1    BUF$,,AUTO
         1 002002   000001 236100                    LDQ     1,,PR0
         1 002003   100500 116105                    CMPQ    320,AL,PR1
         1 002004   002010 601000 1                  TNZ     s:5050

   5049  1 002005   200013 235100                    LDA     I,,AUTO
         1 002006   000001 035007                    ADLA    1,DL
         1 002007   200004 755100                    STA     ACCT$,,AUTO

      942     5050    3            I=I+1;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:188  
   5050  1 002010   200013 235100                    LDA     I,,AUTO
         1 002011   000001 035007                    ADLA    1,DL
         1 002012   200013 755100                    STA     I,,AUTO

      943     5051    3            END;

   5051  1 002013   200004 235100                    LDA     ACCT$,,AUTO
         1 002014   002023 601000 1                  TNZ     s:5052
         1 002015   200007 470500                    LDP0    BUF$,,AUTO
         1 002016   000004 236100                    LDQ     4,,PR0
         1 002017   777777 376007                    ANQ     -1,DL
         1 002020   200013 116100                    CMPQ    I,,AUTO
         1 002021   002023 600000 1                  TZE     s:5052
         1 002022   001776 603000 1                  TRC     s:5049

      944     5052    2         IF ACCTX=0 THEN VID.VOLCNT=0; /* NO, MUST BE A MISTAKE */

   5052  1 002023   000000 115003                    CMPA    0,DU
         1 002024   002030 601000 1                  TNZ     s:5053

   5052  1 002025   000000 220003                    LDX0    0,DU
         1 002026   200007 470500                    LDP0    BUF$,,AUTO
         1 002027   000004 440100                    SXL0    4,,PR0

      945     5053    2         I=VOL.SETX;

   5053  1 002030   200012 470500                    LDP0    SET$,,AUTO
         1 002031   000000 236100                    LDQ     0,,PR0
         1 002032   777777 376007                    ANQ     -1,DL
         1 002033   200013 756100                    STQ     I,,AUTO

      946     5054    2         IF I=0 OR NOT FMX$SET.SET(I) THEN VOL.VOL#=ACCTX;

   5054  1 002034   002043 600000 1                  TZE     s:5054+7
         1 002035   200013 235100                    LDA     I,,AUTO
         1 002036   000003 735000                    ALS     3
         1 002037   000000 471400 xsym               LDP1    FM$SET$
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:189  
         1 002040   100002 236105                    LDQ     2,AL,PR1
         1 002041   200000 316003                    CANQ    65536,DU
         1 002042   002046 601000 1                  TNZ     s:5055

   5054  1 002043   200004 236100                    LDQ     ACCT$,,AUTO
         1 002044   000033 736000                    QLS     27
         1 002045   000003 552140                    STBQ    3,'40'O,PR0

      947     5055    2         CALL SAMESET ALTRET(NOMSG);

   5055  1 002046   005067 701000 1                  TSX1    SAMESET
         1 002047   002326 702000 1                  TSX2    NOMSG

      948     5056                    /* SOMETHING HAS CHANGED */
      949     5057    2         DCTX=F$DCB.SETX;

   5057  1 002050   200010 470500                    LDP0    JDCB$,,AUTO
         1 002051   000051 236100                    LDQ     41,,PR0
         1 002052   777777 376007                    ANQ     -1,DL
         1 002053   200011 756100                    STQ     DCTX,,AUTO

      950     5058    2         IF VOL.SYSID~=JG_PIG# THEN CALL PIGMSG;

   5058  1 002054   200012 471500                    LDP1    SET$,,AUTO
         1 002055   100002 720100                    LXL0    2,,PR1
         1 002056   000007 100003                    CMPX0   7,DU
         1 002057   002062 600000 1                  TZE     s:5059

   5058  1 002060   005362 701000 1                  TSX1    PIGMSG
         1 002061   000000 011000                    NOP     0

      951     5059    3         IF I~=0 AND NOT FMX$SET.SET(I) THEN DO;

   5059  1 002062   200013 235100                    LDA     I,,AUTO
         1 002063   002326 600000 1                  TZE     NOMSG
         1 002064   000003 735000                    ALS     3
         1 002065   000000 470400 xsym               LDP0    FM$SET$
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:190  
         1 002066   000002 236105                    LDQ     2,AL,PR0
         1 002067   200000 316003                    CANQ    65536,DU
         1 002070   002326 601000 1                  TNZ     NOMSG

      952     5060                    /* DE-LINK FROM THE SET'S VOL CHAIN */
      953     5061    3            VOL.SETX=0;

   5061  1 002071   000000 220003                    LDX0    0,DU
         1 002072   200012 471500                    LDP1    SET$,,AUTO
         1 002073   100000 440100                    SXL0    0,,PR1

      954     5062    3            DCTX=FMX$SET.DCTX(I);

   5062  1 002074   200013 235100                    LDA     I,,AUTO
         1 002075   000003 735000                    ALS     3
         1 002076   000000 470400 xsym               LDP0    FM$SET$
         1 002077   000000 236105                    LDQ     0,AL,PR0
         1 002100   000022 772000                    QRL     18
         1 002101   200011 756100                    STQ     DCTX,,AUTO

      955     5063    3            IF DCTX=F$DCB.SETX THEN FMX$SET.DCTX(I)=VOL.VOLL;

   5063  1 002102   200010 473500                    LDP3    JDCB$,,AUTO
         1 002103   300051 236100                    LDQ     41,,PR3
         1 002104   777777 376007                    ANQ     -1,DL
         1 002105   200011 116100                    CMPQ    DCTX,,AUTO
         1 002106   002112 601000 1                  TNZ     s:5064

   5063  1 002107   100005 221100                    LDX1    5,,PR1
         1 002110   000000 741105                    STX1    0,AL,PR0
         1 002111   002135 710000 1                  TRA     s:5069

      956     5064    4            ELSE DO WHILE(DCTX~=0);

   5064  1 002112   200011 235100                    LDA     DCTX,,AUTO
         1 002113   002135 600000 1                  TZE     s:5069

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:191  
      957     5065    4               IF FM$VOL.VOLL(DCTX)=F$DCB.SETX

   5065  1 002114   200010 470500                    LDP0    JDCB$,,AUTO
         1 002115   000051 720100                    LXL0    41,,PR0
         1 002116   200011 235100                    LDA     DCTX,,AUTO
         1 002117   000003 735000                    ALS     3
         1 002120   000000 471400 xsym               LDP1    FM$SET$
         1 002121   100005 100105                    CMPX0   5,AL,PR1
         1 002122   002126 601000 1                  TNZ     s:5067

      958     5066    4               THEN FM$VOL.VOLL(DCTX)=VOL.VOLL;

   5066  1 002123   200012 473500                    LDP3    SET$,,AUTO
         1 002124   300005 221100                    LDX1    5,,PR3
         1 002125   100005 741105                    STX1    5,AL,PR1

      959     5067    4               DCTX=FM$VOL.VOLL(DCTX);

   5067  1 002126   200011 235100                    LDA     DCTX,,AUTO
         1 002127   000003 735000                    ALS     3
         1 002130   000000 471400 xsym               LDP1    FM$SET$
         1 002131   100005 236105                    LDQ     5,AL,PR1
         1 002132   000022 772000                    QRL     18
         1 002133   200011 756100                    STQ     DCTX,,AUTO

      960     5068    4               END;

   5068  1 002134   002114 601000 1                  TNZ     s:5065

      961     5069    4            IF FMX$SET.DCTX(I)=0 THEN DO; /* TOOK OUT THE LAST ONE */

   5069  1 002135   200013 235100                    LDA     I,,AUTO
         1 002136   000003 735000                    ALS     3
         1 002137   000000 470400 xsym               LDP0    FM$SET$
         1 002140   000000 220105                    LDX0    0,AL,PR0
         1 002141   002326 601000 1                  TNZ     NOMSG

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:192  
      962     5070    4   FINDOTHER:  ;

   5070  1 002142                       FINDOTHER    null
      963     5071    4               ACCTX=FM$CFUX.SETH;

   5071  1 002142   000000 470400 xsym               LDP0    F$CFU$
         1 002143   000005 236100                    LDQ     5,,PR0
         1 002144   000022 772000                    QRL     18
         1 002145   200004 756100                    STQ     ACCT$,,AUTO

      964     5072    5               DO WHILE(ACCTX~=0);

   5072  1 002146   002322 600000 1                  TZE     s:5096

      965     5073                    /* NOE LOOK FOR A DUAL THAT IS NOW PRIMARY */
      966     5074    5                  IF FMX$SET.REALPSN(ACCTX)=FMX$SET.PSN(I)

   5074  1 002147   200004 235100                    LDA     ACCT$,,AUTO
         1 002150   000005 735000                    ALS     5
         1 002151   200013 236100                    LDQ     I,,AUTO
         1 002152   000005 736000                    QLS     5
         1 002153   000000 470400 xsym               LDP0    FM$SET$
         1 002154   040106 106505                    CMPC    fill='040'O
         1 002155   000005 400006                    ADSC9   5,A,PR0                  cn=2,n=6
         1 002156   000000 400006                    ADSC9   0,Q,PR0                  cn=2,n=6
         1 002157   002313 601000 1                  TNZ     s:5094
         1 002160   200004 235100                    LDA     ACCT$,,AUTO
         1 002161   000003 735000                    ALS     3
         1 002162   000000 220105                    LDX0    0,AL,PR0
         1 002163   002313 600000 1                  TZE     s:5094
         1 002164   000002 236105                    LDQ     2,AL,PR0
         1 002165   010000 316003                    CANQ    4096,DU
         1 002166   002313 601000 1                  TNZ     s:5094
         1 002167   200000 316003                    CANQ    65536,DU
         1 002170   002313 601000 1                  TNZ     s:5094

      967     5075    5                    AND FMX$SET.DCTX(ACCTX)~=0
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:193  
      968     5076    5                    AND NOT FMX$SET.DUAL(ACCTX)
      969     5077    6                    AND NOT FMX$SET.SET(ACCTX) THEN DO;/* GOT ONE */

      970     5078    6                     DCTX=FMX$SET.DCTX(ACCTX); /* MESSAGE THE PRIMARY */

   5078  1 002171   000000 236105                    LDQ     0,AL,PR0
         1 002172   000022 772000                    QRL     18
         1 002173   200011 756100                    STQ     DCTX,,AUTO

      971     5079    6                     CALL PIGMSG;

   5079  1 002174   005362 701000 1                  TSX1    PIGMSG
         1 002175   000000 011000                    NOP     0

      972     5080    6                     FMX$SET.PSN(ACCTX)=FMX$SET.REALPSN(ACCTX);

   5080  1 002176   200004 235100                    LDA     ACCT$,,AUTO
         1 002177   000003 735000                    ALS     3
         1 002200   200004 236100                    LDQ     ACCT$,,AUTO
         1 002201   000005 736000                    QLS     5
         1 002202   000002 735000                    ALS     2
         1 002203   000000 470400 xsym               LDP0    FM$SET$
         1 002204   040105 100506                    MLR     fill='040'O
         1 002205   000005 400006                    ADSC9   5,Q,PR0                  cn=2,n=6
         1 002206   000000 400006                    ADSC9   0,A,PR0                  cn=2,n=6

      973     5081    6                     FMX$SET.REALPSN(ACCTX)=' ';

   5081  1 002207   200004 235100                    LDA     ACCT$,,AUTO
         1 002210   000003 735000                    ALS     3
         1 002211   000002 735000                    ALS     2
         1 002212   000000 470400 xsym               LDP0    FM$SET$
         1 002213   040105 100400                    MLR     fill='040'O
         1 002214   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 002215   000005 400006                    ADSC9   5,A,PR0                  cn=2,n=6

      974     5082    6                     FMX$SET.REALPSN(I)=FMX$SET.PSN(I);
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:194  

   5082  1 002216   200013 235100                    LDA     I,,AUTO
         1 002217   000003 735000                    ALS     3
         1 002220   200013 236100                    LDQ     I,,AUTO
         1 002221   000005 736000                    QLS     5
         1 002222   000002 735000                    ALS     2
         1 002223   000000 470400 xsym               LDP0    FM$SET$
         1 002224   040105 100506                    MLR     fill='040'O
         1 002225   000000 400006                    ADSC9   0,Q,PR0                  cn=2,n=6
         1 002226   000005 400006                    ADSC9   5,A,PR0                  cn=2,n=6

      975     5083    7                     IF FM$SET.SET THEN DO;

   5083  1 002227   200012 470500                    LDP0    SET$,,AUTO
         1 002230   000002 236100                    LDQ     2,,PR0
         1 002231   200000 316003                    CANQ    65536,DU
         1 002232   002302 600000 1                  TZE     s:5091

      976     5084    7                        DCTX=FM$SET.DCTX;

   5084  1 002233   000000 236100                    LDQ     0,,PR0
         1 002234   000022 772000                    QRL     18
         1 002235   200011 756100                    STQ     DCTX,,AUTO

      977     5085    7                        CALL BINCHAR(FM$SET.PSN,MOD(FM$VOL.VSN(DCTX),100000));

   5085  1 002236   200011 235100                    LDA     DCTX,,AUTO
         1 002237   000003 735000                    ALS     3
         1 002240   000000 471400 xsym               LDP1    FM$SET$
         1 002241   100001 236105                    LDQ     1,AL,PR1
         1 002242   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 002243   303240 506007                    DIV     100000,DL
         1 002244   000044 773000                    LRL     36
         1 002245   200026 757100                    STAQ    UN+3,,AUTO
         1 002246   000100 301500                    BTD
         1 002247   200026 000010                    NDSC9   UN+3,,AUTO               cn=0,s=lsgnf,sf=0,n=8
         1 002250   000000 430006                    NDSC9   0,,PR0                   cn=2,s=nosgn,sf=0,n=6
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:195  

      978     5086    7                        IF FM$VOL.SECT#(DCTX)=0 THEN ACCTX=ASCBIN('D');

   5086  1 002251   200011 235100                    LDA     DCTX,,AUTO
         1 002252   000003 735000                    ALS     3
         1 002253   000000 471400 xsym               LDP1    FM$SET$
         1 002254   100001 236105                    LDQ     1,AL,PR1
         1 002255   777000 316003                    CANQ    -512,DU
         1 002256   002262 601000 1                  TNZ     s:5087

   5086  1 002257   000104 235007                    LDA     68,DL
         1 002260   200004 755100                    STA     ACCT$,,AUTO
         1 002261   002266 710000 1                  TRA     s:5088

      979     5087    7                        ELSE ACCTX=FM$VOL.SECT#(DCTX)+ASCBIN('@');

   5087  1 002262   100001 236105                    LDQ     1,AL,PR1
         1 002263   000033 772000                    QRL     27
         1 002264   000100 036007                    ADLQ    64,DL
         1 002265   200004 756100                    STQ     ACCT$,,AUTO

      980     5088    7                        CALL INSERT(FM$SET.PSN,0,1,BINASC(ACCTX));

   5088  1 002266   200004 236100                    LDQ     ACCT$,,AUTO
         1 002267   000033 736000                    QLS     27
         1 002270   000006 276000 2                  ORQ     6
         1 002271   000022 772000                    QRL     18
         1 002272   000000 552110                    STBQ    0,'10'O,PR0

      981     5089    7                        IF B$JIT.SYSID~=JG_SLUG# THEN CALL PIGMSG;

   5089  1 002273   000000 471400 xsym               LDP1    B$JIT$
         1 002274   100000 720100                    LXL0    0,,PR1
         1 002275   000001 100003                    CMPX0   1,DU
         1 002276   002311 600000 1                  TZE     s:5092

   5089  1 002277   005362 701000 1                  TSX1    PIGMSG
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:196  
         1 002300   000000 011000                    NOP     0

      982     5090    7                        END;

   5090  1 002301   002311 710000 1                  TRA     s:5092

      983     5091    6                     ELSE FMX$SET.PSN(I)=BINASC(0);

   5091  1 002302   200013 235100                    LDA     I,,AUTO
         1 002303   000003 735000                    ALS     3
         1 002304   000002 735000                    ALS     2
         1 002305   000000 471400 xsym               LDP1    FM$SET$
         1 002306   040105 100400                    MLR     fill='040'O
         1 002307   000006 000001 2                  ADSC9   6                        cn=0,n=1
         1 002310   100000 400006                    ADSC9   0,A,PR1                  cn=2,n=6

      984     5092    6                     ACCTX=0;

   5092  1 002311   200004 450100                    STZ     ACCT$,,AUTO

      985     5093    6                     END;

   5093  1 002312   002320 710000 1                  TRA     s:5095

      986     5094    5                  ELSE ACCTX=FMX$SET.SETL(ACCTX);

   5094  1 002313   200004 235100                    LDA     ACCT$,,AUTO
         1 002314   000003 735000                    ALS     3
         1 002315   000005 236105                    LDQ     5,AL,PR0
         1 002316   000022 772000                    QRL     18
         1 002317   200004 756100                    STQ     ACCT$,,AUTO

      987     5095    5                  END;

   5095  1 002320   200004 235100                    LDA     ACCT$,,AUTO
         1 002321   002147 601000 1                  TNZ     s:5074

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:197  
      988     5096    4               IF FM$SET.SET THEN GOTO RELSET;

   5096  1 002322   200012 470500                    LDP0    SET$,,AUTO
         1 002323   000002 236100                    LDQ     2,,PR0
         1 002324   200000 316003                    CANQ    65536,DU
         1 002325   004536 601000 1                  TNZ     RELSET

      989     5097    4               END;

      990     5098    3            END;

   5091  1 002326                       NOMSG        null
      991     5099    2   NOMSG:;
      992     5100    3         IF VOL.SETX=0 AND VID.VOLCNT~=0 THEN DO;

   5100  1 002326   200012 470500                    LDP0    SET$,,AUTO
         1 002327   000000 720100                    LXL0    0,,PR0
         1 002330   002725 601000 1                  TNZ     s:5169
         1 002331   200007 471500                    LDP1    BUF$,,AUTO
         1 002332   100004 721100                    LXL1    4,,PR1
         1 002333   002725 600000 1                  TZE     s:5169

      993     5101                    /* PART OF A SET, FIND OR MAKE A SET ENTRY */
      994     5102    3            VOL.RGRANS=0;

   5102  1 002334   000006 450100                    STZ     6,,PR0

      995     5103    3            VOL.VOLL=0;

   5103  1 002335   000000 221003                    LDX1    0,DU
         1 002336   000005 741100                    STX1    5,,PR0

   5103  1 002337                       CHKDUAL      null
      996     5104    3   CHKDUAL: ;
      997     5105    3            CALL FMR$L8;

   5105  1 002337   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:198  
         1 002340   000000 701000 xent               TSX1    FMR$L8
         1 002341   000000 011000                    NOP     0

      998     5106    3            I=FM$CFUX.SETH;

   5106  1 002342   000000 470400 xsym               LDP0    F$CFU$
         1 002343   000005 236100                    LDQ     5,,PR0
         1 002344   000022 772000                    QRL     18
         1 002345   200013 756100                    STQ     I,,AUTO

      999     5107    4            DO WHILE (I~=0 AND VOL.SETX=0);

   5107  1 002346   002604 710000 1                  TRA     s:5149

     1000     5108    5               IF FMX$SET.PSN(I)=VID.PSN THEN DO;

   5108  1 002347   200013 235100                    LDA     I,,AUTO
         1 002350   000005 735000                    ALS     5
         1 002351   000000 470400 xsym               LDP0    FM$SET$
         1 002352   200007 471500                    LDP1    BUF$,,AUTO
         1 002353   040100 106505                    CMPC    fill='040'O
         1 002354   000000 400006                    ADSC9   0,A,PR0                  cn=2,n=6
         1 002355   100003 000006                    ADSC9   3,,PR1                   cn=0,n=6
         1 002356   002576 601000 1                  TNZ     s:5148

     1001     5109    6                  IF FMX$SET.DCTX(I)=0 THEN DO;

   5109  1 002357   200013 236100                    LDQ     I,,AUTO
         1 002360   000003 736000                    QLS     3
         1 002361   000000 220106                    LDX0    0,QL,PR0
         1 002362   002422 601000 1                  TNZ     s:5118

     1002     5110                    /* FOUND AN UNINITIALIZED ENTRY */
     1003     5111    6                     CALL CHKSUM;

   5111  1 002363   005062 701000 1                  TSX1    CHKSUM
         1 002364   000000 011000                    NOP     0
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:199  

     1004     5112    6                     FMX$SET.CHKSM(I)=ACCTX;

   5112  1 002365   200013 235100                    LDA     I,,AUTO
         1 002366   000003 735000                    ALS     3
         1 002367   200004 236100                    LDQ     ACCT$,,AUTO
         1 002370   000000 470400 xsym               LDP0    FM$SET$
         1 002371   000007 756105                    STQ     7,AL,PR0

     1005     5113    6                     IF VOL.RGRANS=0 THEN FMX$SET.REALPSN(I)=' ';

   5113  1 002372   200012 470500                    LDP0    SET$,,AUTO
         1 002373   000006 235100                    LDA     6,,PR0
         1 002374   002405 601000 1                  TNZ     s:5114

   5113  1 002375   200013 235100                    LDA     I,,AUTO
         1 002376   000003 735000                    ALS     3
         1 002377   000002 735000                    ALS     2
         1 002400   000000 471400 xsym               LDP1    FM$SET$
         1 002401   040105 100400                    MLR     fill='040'O
         1 002402   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 002403   100005 400006                    ADSC9   5,A,PR1                  cn=2,n=6
         1 002404   002421 710000 1                  TRA     s:5115

     1006     5114    6                     ELSE FMX$SET.REALPSN(I)=FMX$SET.PSN(VOL.RGRANS);

   5114  1 002405   200013 235100                    LDA     I,,AUTO
         1 002406   000003 735000                    ALS     3
         1 002407   000000 620005                    EAX0    0,AL
         1 002410   000006 235100                    LDA     6,,PR0
         1 002411   000003 735000                    ALS     3
         1 002412   000002 735000                    ALS     2
         1 002413   000000 636010                    EAQ     0,X0
         1 002414   000020 772000                    QRL     16
         1 002415   000000 471400 xsym               LDP1    FM$SET$
         1 002416   040106 100505                    MLR     fill='040'O
         1 002417   100000 400006                    ADSC9   0,A,PR1                  cn=2,n=6
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:200  
         1 002420   100005 400006                    ADSC9   5,Q,PR1                  cn=2,n=6

     1007     5115    6                     GOTO NOTDUAL;

   5115  1 002421   002464 710000 1                  TRA     NOTDUAL

     1008     5116    6                     END;
     1009     5117    6                  ELSE DO;

     1010     5118    6                     CALL FMR$U8;

   5118  1 002422   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002423   000000 701000 xent               TSX1    FMR$U8
         1 002424   000000 011000                    NOP     0

     1011     5119    6                     CALL SAMESET ALTRET(NOTDUAL);

   5119  1 002425   005067 701000 1                  TSX1    SAMESET
         1 002426   002464 702000 1                  TSX2    NOTDUAL

     1012     5120    6                     IF VOL.RGRANS~=0 THEN GOTO DUALDUAL; /* >1 DUAL */

   5120  1 002427   200012 470500                    LDP0    SET$,,AUTO
         1 002430   000006 235100                    LDA     6,,PR0
         1 002431   002573 601000 1                  TNZ     DUALDUAL

     1013     5121    6   TRYDUAL:          CALL BINCHAR(VID.PSN,MOD(VID.SNLIST.VSN.N(0),100000));

   5121  1 002432   200007 471500       TRYDUAL      LDP1    BUF$,,AUTO
         1 002433   100500 236100                    LDQ     320,,PR1
         1 002434   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 002435   303240 506007                    DIV     100000,DL
         1 002436   000044 773000                    LRL     36
         1 002437   200026 757100                    STAQ    UN+3,,AUTO
         1 002440   000100 301500                    BTD
         1 002441   200026 000010                    NDSC9   UN+3,,AUTO               cn=0,s=lsgnf,sf=0,n=8
         1 002442   100003 030006                    NDSC9   3,,PR1                   cn=0,s=nosgn,sf=0,n=6
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:201  

     1014     5122    6                     IF VID.SNLIST.VSN.S(0)=0 THEN ACCTX=ASCBIN('D');

   5122  1 002443   100500 236100                    LDQ     320,,PR1
         1 002444   777000 316003                    CANQ    -512,DU
         1 002445   002451 601000 1                  TNZ     s:5123

   5122  1 002446   000104 235007                    LDA     68,DL
         1 002447   200004 755100                    STA     ACCT$,,AUTO
         1 002450   002455 710000 1                  TRA     s:5124

     1015     5123    6                     ELSE ACCTX=VID.SNLIST.VSN.S(0)+ASCBIN('@');

   5123  1 002451   100500 236100                    LDQ     320,,PR1
         1 002452   000033 772000                    QRL     27
         1 002453   000100 036007                    ADLQ    64,DL
         1 002454   200004 756100                    STQ     ACCT$,,AUTO

     1016     5124    6                     CALL INSERT(VID.PSN,0,1,BINASC(ACCTX));

   5124  1 002455   200004 236100                    LDQ     ACCT$,,AUTO
         1 002456   000033 736000                    QLS     27
         1 002457   000006 276000 2                  ORQ     6
         1 002460   100003 552140                    STBQ    3,'40'O,PR1

     1017     5125    6                     VOL.RGRANS=I;

   5125  1 002461   200013 235100                    LDA     I,,AUTO
         1 002462   000006 755100                    STA     6,,PR0

     1018     5126    6                     GOTO CHKDUAL;

   5126  1 002463   002337 710000 1                  TRA     CHKDUAL

     1019     5127    6   NOTDUAL:          VOL.SETX=I;

   5127  1 002464   200013 720100       NOTDUAL      LXL0    I,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:202  
         1 002465   200012 470500                    LDP0    SET$,,AUTO
         1 002466   000000 440100                    SXL0    0,,PR0

     1020     5128                    /* LINK US INTO THE VOLUME CHAIN */
     1021     5129    6                     ACCTX=FMX$SET.DCTX(I);

   5129  1 002467   200013 235100                    LDA     I,,AUTO
         1 002470   000003 735000                    ALS     3
         1 002471   000000 471400 xsym               LDP1    FM$SET$
         1 002472   100000 236105                    LDQ     0,AL,PR1
         1 002473   000022 772000                    QRL     18
         1 002474   200004 756100                    STQ     ACCT$,,AUTO

     1022     5130    7                     DO WHILE(ACCTX~=0 AND VOL.VOL#>FM$VOL.VOL#(ACCTX));

   5130  1 002475   002505 710000 1                  TRA     s:5133

     1023     5131    7                        I=ACCTX;

   5131  1 002476   200004 235100                    LDA     ACCT$,,AUTO
         1 002477   200013 755100                    STA     I,,AUTO

     1024     5132    7                        ACCTX=FM$VOL.VOLL(ACCTX);

   5132  1 002500   000003 735000                    ALS     3
         1 002501   000000 470400 xsym               LDP0    FM$SET$
         1 002502   000005 236105                    LDQ     5,AL,PR0
         1 002503   000022 772000                    QRL     18
         1 002504   200004 756100                    STQ     ACCT$,,AUTO

     1025     5133    7                        END;

   5133  1 002505   002521 600000 1                  TZE     s:5134
         1 002506   200012 470500                    LDP0    SET$,,AUTO
         1 002507   000003 236100                    LDQ     3,,PR0
         1 002510   000033 772000                    QRL     27
         1 002511   200026 756100                    STQ     UN+3,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:203  
         1 002512   200004 235100                    LDA     ACCT$,,AUTO
         1 002513   000003 735000                    ALS     3
         1 002514   000000 471400 xsym               LDP1    FM$SET$
         1 002515   100003 236105                    LDQ     3,AL,PR1
         1 002516   000033 772000                    QRL     27
         1 002517   200026 116100                    CMPQ    UN+3,,AUTO
         1 002520   002476 604000 1                  TMI     s:5131

     1026     5134    6                     VOL.VOLL=ACCTX;

   5134  1 002521   200004 720100                    LXL0    ACCT$,,AUTO
         1 002522   200012 470500                    LDP0    SET$,,AUTO
         1 002523   000005 740100                    STX0    5,,PR0

     1027     5135    6                     IF I=VOL.SETX THEN FMX$SET.DCTX(I)=F$DCB.SETX;

   5135  1 002524   000000 236100                    LDQ     0,,PR0
         1 002525   777777 376007                    ANQ     -1,DL
         1 002526   200013 116100                    CMPQ    I,,AUTO
         1 002527   002537 601000 1                  TNZ     s:5136

   5135  1 002530   200013 235100                    LDA     I,,AUTO
         1 002531   000003 735000                    ALS     3
         1 002532   200010 471500                    LDP1    JDCB$,,AUTO
         1 002533   100051 721100                    LXL1    41,,PR1
         1 002534   000000 473400 xsym               LDP3    FM$SET$
         1 002535   300000 741105                    STX1    0,AL,PR3
         1 002536   002545 710000 1                  TRA     s:5137

     1028     5136    6                     ELSE FM$VOL.VOLL(I)=F$DCB.SETX;

   5136  1 002537   200013 235100                    LDA     I,,AUTO
         1 002540   000003 735000                    ALS     3
         1 002541   200010 471500                    LDP1    JDCB$,,AUTO
         1 002542   100051 721100                    LXL1    41,,PR1
         1 002543   000000 473400 xsym               LDP3    FM$SET$
         1 002544   300005 741105                    STX1    5,AL,PR3
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:204  

     1029     5137    7                     IF VOL.SECT#~=0 AND FMX$SET.SYSID(VOL.SETX)~=0 THEN DO;

   5137  1 002545   000001 236100                    LDQ     1,,PR0
         1 002546   777000 316003                    CANQ    -512,DU
         1 002547   002573 600000 1                  TZE     DUALDUAL
         1 002550   000000 236100                    LDQ     0,,PR0
         1 002551   000003 736000                    QLS     3
         1 002552   000000 376000 2                  ANQ     0
         1 002553   000000 473400 xsym               LDP3    FM$SET$
         1 002554   300002 721106                    LXL1    2,QL,PR3
         1 002555   002573 600000 1                  TZE     DUALDUAL

     1030     5138    7                        CFU$=N$DCT$(VOL.DCTX)->NI$DCT.RAT$;

   5138  1 002556   000000 222100                    LDX2    0,,PR0
         1 002557   000000 474400 xsym               LDP4    N$DCT$$
         1 002560   400000 475512                    LDP5    0,X2,PR4
         1 002561   500005 236100                    LDQ     5,,PR5
         1 002562   200006 756100                    STQ     CFU$,,AUTO

     1031     5139    8                        IF FR$RAT.RES.SISID=JG_PIG# THEN DO;

   5139  1 002563   200006 476500                    LDP6    CFU$,,AUTO
         1 002564   600001 221100                    LDX1    1,,PR6
         1 002565   000007 101003                    CMPX1   7,DU
         1 002566   002573 601000 1                  TNZ     DUALDUAL

     1032     5140    8                           FR$RAT.FLG.OPN='1'B;

   5140  1 002567   000020 236007                    LDQ     16,DL
         1 002570   600010 256100                    ORSQ    8,,PR6

     1033     5141    8                           FR$RAT.FLG.MBIT.MTD='1'B;

   5141  1 002571   000400 236007                    LDQ     256,DL
         1 002572   600010 256100                    ORSQ    8,,PR6
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:205  

     1034     5142    8                           END;

     1035     5143    7                        END;

   5141  1 002573                       DUALDUAL     null
     1036     5144    6   DUALDUAL:         ;
     1037     5145    6                     CALL FMR$L8;

   5145  1 002573   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002574   000000 701000 xent               TSX1    FMR$L8
         1 002575   000000 011000                    NOP     0

     1038     5146    6                     END;

     1039     5147    5                  END;

     1040     5148    4               I=FMX$SET.SETL(I);

   5148  1 002576   200013 235100                    LDA     I,,AUTO
         1 002577   000003 735000                    ALS     3
         1 002600   000000 470400 xsym               LDP0    FM$SET$
         1 002601   000005 236105                    LDQ     5,AL,PR0
         1 002602   000022 772000                    QRL     18
         1 002603   200013 756100                    STQ     I,,AUTO

     1041     5149    4               END;

   5149  1 002604   002610 600000 1                  TZE     s:5150
         1 002605   200012 470500                    LDP0    SET$,,AUTO
         1 002606   000000 720100                    LXL0    0,,PR0
         1 002607   002347 600000 1                  TZE     s:5108

     1042     5150    4            IF VOL.SETX=0 THEN DO;

   5150  1 002610   200012 470500                    LDP0    SET$,,AUTO
         1 002611   000000 720100                    LXL0    0,,PR0
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:206  
         1 002612   002722 601000 1                  TNZ     s:5167

     1043     5151                    /* NEEDS A NEW SET ENTRY */
     1044     5152    4               CALL FMR$GA (XT$,I) ALTRET(RETALT);

   5152  1 002613   200013 631500                    EPPR1   I,,AUTO
         1 002614   200027 451500                    STP1    UN+4,,AUTO
         1 002615   200020 236100                    LDQ     T$$,,AUTO
         1 002616   200026 756100                    STQ     UN+3,,AUTO
         1 002617   200026 630500                    EPPR0   UN+3,,AUTO
         1 002620   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002621   000000 701000 xent               TSX1    FMR$GA
         1 002622   001432 702000 1                  TSX2    RETALT

     1045     5153    4               SET$=T$;

   5153  1 002623   200017 236100                    LDQ     T$,,AUTO
         1 002624   200012 756100                    STQ     SET$,,AUTO

     1046     5154    4               FM$SET.SETL=FM$CFUX.SETH;

   5154  1 002625   000000 470400 xsym               LDP0    F$CFU$
         1 002626   000005 220100                    LDX0    5,,PR0
         1 002627   200012 471500                    LDP1    SET$,,AUTO
         1 002630   100005 740100                    STX0    5,,PR1

     1047     5155    4               FM$CFUX.SETH=I/SIZEW(FM$SET);

   5155  1 002631   200013 236100                    LDQ     I,,AUTO
         1 002632   000003 772000                    QRL     3
         1 002633   000000 621006                    EAX1    0,QL
         1 002634   000005 741100                    STX1    5,,PR0

     1048     5156    4               FM$SET.DCTX=F$DCB.SETX;

   5156  1 002635   200010 473500                    LDP3    JDCB$,,AUTO
         1 002636   300051 720100                    LXL0    41,,PR3
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:207  
         1 002637   100000 740100                    STX0    0,,PR1

     1049     5157    4               CALL CHKSUM;

   5157  1 002640   005062 701000 1                  TSX1    CHKSUM
         1 002641   000000 011000                    NOP     0

     1050     5158    4               FM$SET.PSN=VID.PSN;

   5158  1 002642   200007 470500                    LDP0    BUF$,,AUTO
         1 002643   200012 471500                    LDP1    SET$,,AUTO
         1 002644   040100 100500                    MLR     fill='040'O
         1 002645   000003 000006                    ADSC9   3,,PR0                   cn=0,n=6
         1 002646   100000 400006                    ADSC9   0,,PR1                   cn=2,n=6

     1051     5159    4               FM$SET.XCL='1'B;

   5159  1 002647   400000 236003                    LDQ     -131072,DU
         1 002650   100002 256100                    ORSQ    2,,PR1

     1052     5160    4               I=FM$CFUX.SETH;

   5160  1 002651   000000 473400 xsym               LDP3    F$CFU$
         1 002652   300005 236100                    LDQ     5,,PR3
         1 002653   000022 772000                    QRL     18
         1 002654   200013 756100                    STQ     I,,AUTO

     1053     5161    4               SET$=ADDR(FMX$SET(F$DCB.SETX));

   5161  1 002655   200010 474500                    LDP4    JDCB$,,AUTO
         1 002656   400051 236100                    LDQ     41,,PR4
         1 002657   000003 736000                    QLS     3
         1 002660   000000 376000 2                  ANQ     0
         1 002661   000022 736000                    QLS     18
         1 002662   000000 036000 xsym               ADLQ    FM$SET$
         1 002663   200012 756100                    STQ     SET$,,AUTO

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:208  
     1054     5162    4               VOL.SETX=I;

   5162  1 002664   200013 720100                    LXL0    I,,AUTO
         1 002665   200012 471500                    LDP1    SET$,,AUTO
         1 002666   100000 440100                    SXL0    0,,PR1

     1055     5163    4               IF VOL.RGRANS=0 THEN FMX$SET.REALPSN(I)=' ';

   5163  1 002667   100006 235100                    LDA     6,,PR1
         1 002670   002701 601000 1                  TNZ     s:5164

   5163  1 002671   200013 235100                    LDA     I,,AUTO
         1 002672   000003 735000                    ALS     3
         1 002673   000002 735000                    ALS     2
         1 002674   000000 473400 xsym               LDP3    FM$SET$
         1 002675   040105 100400                    MLR     fill='040'O
         1 002676   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 002677   300005 400006                    ADSC9   5,A,PR3                  cn=2,n=6
         1 002700   002715 710000 1                  TRA     s:5165

     1056     5164    4               ELSE FMX$SET.REALPSN(I)=FMX$SET.PSN(VOL.RGRANS);

   5164  1 002701   200013 235100                    LDA     I,,AUTO
         1 002702   000003 735000                    ALS     3
         1 002703   000000 621005                    EAX1    0,AL
         1 002704   100006 235100                    LDA     6,,PR1
         1 002705   000003 735000                    ALS     3
         1 002706   000002 735000                    ALS     2
         1 002707   000000 636011                    EAQ     0,X1
         1 002710   000020 772000                    QRL     16
         1 002711   000000 473400 xsym               LDP3    FM$SET$
         1 002712   040106 100505                    MLR     fill='040'O
         1 002713   300000 400006                    ADSC9   0,A,PR3                  cn=2,n=6
         1 002714   300005 400006                    ADSC9   5,Q,PR3                  cn=2,n=6

     1057     5165    4               FMX$SET.CHKSM(I)=ACCTX;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:209  
   5165  1 002715   200013 235100                    LDA     I,,AUTO
         1 002716   000003 735000                    ALS     3
         1 002717   200004 236100                    LDQ     ACCT$,,AUTO
         1 002720   000000 473400 xsym               LDP3    FM$SET$
         1 002721   300007 756105                    STQ     7,AL,PR3

     1058     5166    4               END;

     1059     5167    3            CALL FMR$U8;

   5167  1 002722   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002723   000000 701000 xent               TSX1    FMR$U8
         1 002724   000000 011000                    NOP     0

     1060     5168    3            END;

     1061     5169    3         IF FM$SET.SYSID~=0 THEN DO;

   5169  1 002725   200012 470500                    LDP0    SET$,,AUTO
         1 002726   000002 720100                    LXL0    2,,PR0
         1 002727   004721 600000 1                  TZE     s:5470

     1062     5170    3            FM$SET.SYSID=0;

   5170  1 002730   000000 221003                    LDX1    0,DU
         1 002731   000002 441100                    SXL1    2,,PR0

     1063     5171    3            FM$SET.ONEU='0'B;

   5171  1 002732   000017 236000 2                  LDQ     15
         1 002733   000002 356100                    ANSQ    2,,PR0

     1064     5172    3            FM$DEV.SYSID(VOL.DCTX)=0;

   5172  1 002734   000000 236100                    LDQ     0,,PR0
         1 002735   000017 772000                    QRL     15
         1 002736   000000 376000 2                  ANQ     0
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:210  
         1 002737   000000 471400 xsym               LDP1    FM$SET$
         1 002740   100002 441106                    SXL1    2,QL,PR1

     1065     5173    3            FM$DEV.ONEU(VOL.DCTX)='0'B;

   5173  1 002741   000000 236100                    LDQ     0,,PR0
         1 002742   000017 772000                    QRL     15
         1 002743   000000 376000 2                  ANQ     0
         1 002744   000000 471400 xsym               LDP1    FM$SET$
         1 002745   000000 620006                    EAX0    0,QL
         1 002746   000017 236000 2                  LDQ     15
         1 002747   100002 356110                    ANSQ    2,X0,PR1

     1066     5174    3            END;

     1067     5175    2         END;

   5175  1 002750   004721 710000 1                  TRA     s:5470

     1068     5176        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:211  
     1069     5177    2      ELSE IF NOT FM$SET.SET THEN DO;

   5177  1 002751   000002 236100                    LDQ     2,,PR0
         1 002752   200000 316003                    CANQ    65536,DU
         1 002753   004312 601000 1                  TNZ     s:5393

     1070     5178                    /* WE HAVE A WHOLE DEVICE, CHECK OUT ALL ITS PARTS */
     1071     5179    2            ACCTX=F$DCB.SETX;

   5179  1 002754   200010 474500                    LDP4    JDCB$,,AUTO
         1 002755   400051 236100                    LDQ     41,,PR4
         1 002756   777777 376007                    ANQ     -1,DL
         1 002757   200004 756100                    STQ     ACCT$,,AUTO

     1072     5180    2            DCTX=ACCTX;

   5180  1 002760   200011 756100                    STQ     DCTX,,AUTO

     1073     5181    2            CALL FMD$GETBUF (2,1,XT$);

   5181  1 002761   200020 236100                    LDQ     T$$,,AUTO
         1 002762   200030 756100                    STQ     UN+5,,AUTO
         1 002763   000024 237000 2                  LDAQ    20
         1 002764   200026 757100                    STAQ    UN+3,,AUTO
         1 002765   200026 630500                    EPPR0   UN+3,,AUTO
         1 002766   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002767   000000 701000 xent               TSX1    FMD$GETBUF
         1 002770   000000 011000                    NOP     0

     1074     5182    2            BUF$=T$;

   5182  1 002771   200017 236100                    LDQ     T$,,AUTO
         1 002772   200007 756100                    STQ     BUF$,,AUTO

   5182  1 002773                       AVRAGAIN     null
     1075     5183    2   AVRAGAIN:;
     1076     5184    2            VID='0'B;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:212  

   5184  1 002773   200007 470500                    LDP0    BUF$,,AUTO
         1 002774   010000 220003                    LDX0    4096,DU
         1 002775   000140 100400                    MLR     fill='000'O
         1 002776   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 002777   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0

     1077     5185    2            IF DEV.SPIN THEN CALL FMN$RDGRAN (XT$,FM_SRZERO);

   5185  1 003000   200012 471500                    LDP1    SET$,,AUTO
         1 003001   100002 236100                    LDQ     2,,PR1
         1 003002   004000 316003                    CANQ    2048,DU
         1 003003   003013 600000 1                  TZE     s:5186

   5185  1 003004   000022 236000 2                  LDQ     18
         1 003005   200020 235100                    LDA     T$$,,AUTO
         1 003006   200026 757100                    STAQ    UN+3,,AUTO
         1 003007   200026 630500                    EPPR0   UN+3,,AUTO
         1 003010   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003011   000000 701000 xent               TSX1    FMN$RDGRAN
         1 003012   000000 011000                    NOP     0

     1078     5186    2            IF VID.ID~='CP6' OR VID.VSN>BITBIN('777777777'O) THEN VID.VSN=0;

   5186  1 003013   200007 470500                    LDP0    BUF$,,AUTO
         1 003014   040000 106500                    CMPC    fill='040'O
         1 003015   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 003016   000014 000003 0                  ADSC9   FMN$E$ACGRANS+4          cn=0,n=3
         1 003017   003024 601000 1                  TNZ     s:5186+9
         1 003020   000015 236000 0                  LDQ     FMN$E$ACGRANS+5
         1 003021   000011 772000                    QRL     9
         1 003022   000002 116100                    CMPQ    2,,PR0
         1 003023   003025 603000 1                  TRC     s:5187

   5186  1 003024   000002 450100                    STZ     2,,PR0

     1079     5187    3            IF DEV.MRRCHK AND B$JIT.SYSID=%JG_PIG# THEN DO;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:213  

   5187  1 003025   200012 471500                    LDP1    SET$,,AUTO
         1 003026   100002 430100                    FSZN    2,,PR1
         1 003027   003123 605000 1                  TPL     s:5206
         1 003030   000000 473400 xsym               LDP3    B$JIT$
         1 003031   300000 720100                    LXL0    0,,PR3
         1 003032   000007 100003                    CMPX0   7,DU
         1 003033   003123 601000 1                  TNZ     s:5206

     1080     5188    3               DEV.MRRCHK='0'B;

   5188  1 003034   000026 236000 2                  LDQ     22
         1 003035   100002 356100                    ANSQ    2,,PR1

     1081     5189    4               IF NI$DCT.DP.MIRROR.FLAG THEN DO; /* new one */

   5189  1 003036   200005 474500                    LDP4    DCT$,,AUTO
         1 003037   400036 234100                    SZN     30,,PR4
         1 003040   003065 605000 1                  TPL     s:5198

     1082     5190    4                  IF DEV.MIRROR THEN EXIT; /* eh?, mabbe oughta screeech */

   5190  1 003041   100002 236100                    LDQ     2,,PR1
         1 003042   002000 316003                    CANQ    1024,DU
         1 003043   003064 601000 1                  TNZ     s:5197

     1083     5191    4                  DEV.MIRROR='1'B; /* make our tables match NI */

   5191  1 003044   002000 236003                    LDQ     1024,DU
         1 003045   100002 256100                    ORSQ    2,,PR1

     1084     5192    4                  DEV.MRRDCTX=NI$DCT.DP.MIRROR.DCTX; /* but VID is already OK */

   5192  1 003046   400037 236100                    LDQ     31,,PR4
         1 003047   000022 772000                    QRL     18
         1 003050   100006 756100                    STQ     6,,PR1

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:214  
     1085     5193    4                  DEV.MRRUTS=NI$DCT.DP.MIRROR.UTS;

   5193  1 003051   400040 235100                    LDA     32,,PR4
         1 003052   100007 755100                    STA     7,,PR1

     1086     5194    4                  IF N$DCT$(NI$DCT.DP.MIRROR.DCTX)->NI$DCT.DP.MIRROR.STATE ~=

   5194  1 003053   400037 220100                    LDX0    31,,PR4
         1 003054   000000 475400 xsym               LDP5    N$DCT$$
         1 003055   500000 476510                    LDP6    0,X0,PR5
         1 003056   600036 236100                    LDQ     30,,PR6
         1 003057   007700 376003                    ANQ     4032,DU
         1 003060   000300 116003                    CMPQ    192,DU
         1 003061   003123 600000 1                  TZE     s:5206

     1087     5195    4                    %NI_MIRROR_WAIT THEN
     1088     5196    4                     DEV.VSN=VID.VSN; /* the secondary has been 0 until now, tho' */

   5196  1 003062   000002 235100                    LDA     2,,PR0
         1 003063   100001 755100                    STA     1,,PR1

     1089     5197    4                  END;

   5197  1 003064   003123 710000 1                  TRA     s:5206

     1090     5198    4               ELSE IF DEV.MIRROR AND DEV.SPIN THEN DO; /* tearing down a pair */

   5198  1 003065   100002 236100                    LDQ     2,,PR1
         1 003066   002000 316003                    CANQ    1024,DU
         1 003067   003123 600000 1                  TZE     s:5206
         1 003070   004000 316003                    CANQ    2048,DU
         1 003071   003123 600000 1                  TZE     s:5206

     1091     5199    4                     VID.MIRROR.STATE(0)=NI$DCT.DP.MIRROR.STATE; /* update the VID */

   5199  1 003072   400036 236100                    LDQ     30,,PR4
         1 003073   000006 736000                    QLS     6
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:215  
         1 003074   000045 752140                    STCQ    37,'40'O,PR0

     1092     5200    4                     IF NI$DCT.DP.MIRROR.DCTX~=0 THEN VID.MIRROR.STATE(1)=

   5200  1 003075   400037 220100                    LDX0    31,,PR4
         1 003076   003103 600000 1                  TZE     s:5202

   5200  1 003077   000000 475400 xsym               LDP5    N$DCT$$
         1 003100   500000 476510                    LDP6    0,X0,PR5
         1 003101   600036 236100                    LDQ     30,,PR6
         1 003102   000045 752120                    STCQ    37,'20'O,PR0

     1093     5201    4                          N$DCT$(NI$DCT.DP.MIRROR.DCTX)->NI$DCT.DP.MIRROR.STATE;
     1094     5202    4                     CALL FMB$QUEUE(XT$,1,4096,FM_SRZERO,%N_WRBIN,-1,0,0);

   5202  1 003103   000030 237000 2                  LDAQ    24
         1 003104   200034 757100                    STAQ    UN+9,,AUTO
         1 003105   000032 237000 2                  LDAQ    26
         1 003106   200032 757100                    STAQ    UN+7,,AUTO
         1 003107   000034 237000 2                  LDAQ    28
         1 003110   200030 757100                    STAQ    UN+5,,AUTO
         1 003111   000004 236000 2                  LDQ     4
         1 003112   200020 235100                    LDA     T$$,,AUTO
         1 003113   200026 757100                    STAQ    UN+3,,AUTO
         1 003114   200026 630500                    EPPR0   UN+3,,AUTO
         1 003115   000026 631400 xsym               EPPR1   B_VECTNIL+22
         1 003116   000000 701000 xent               TSX1    FMB$QUEUE
         1 003117   000000 011000                    NOP     0

     1095     5203    4                     VID.MIRROR.STATE(1)=%NI_MIRROR_NONE; /* but undo mirroring */

   5203  1 003120   200007 470500                    LDP0    BUF$,,AUTO
         1 003121   000400 236003                    LDQ     256,DU
         1 003122   000045 752120                    STCQ    37,'20'O,PR0

     1096     5204    4                     END;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:216  
     1097     5205    3               END;

     1098     5206    2            IF VID.MIRROR.C='MIRROR' AND VID.VSN~=0

   5206  1 003123   040000 106500                    CMPC    fill='040'O
         1 003124   000042 000010                    ADSC9   34,,PR0                  cn=0,n=8
         1 003125   000016 000006 0                  ADSC9   FMN$E$ACGRANS+6          cn=0,n=6
         1 003126   003156 601000 1                  TNZ     s:5217
         1 003127   000002 235100                    LDA     2,,PR0
         1 003130   003156 600000 1                  TZE     s:5217
         1 003131   000045 236100                    LDQ     37,,PR0
         1 003132   007700 316003                    CANQ    4032,DU
         1 003133   003156 601000 1                  TNZ     s:5217

     1099     5207    3              AND VID.MIRROR.STATE(1)=%NI_MIRROR_OPER THEN DO;

     1100     5208    3               IF DEV.MIRROR THEN EXIT;

   5208  1 003134   200012 471500                    LDP1    SET$,,AUTO
         1 003135   100002 236100                    LDQ     2,,PR1
         1 003136   002000 316003                    CANQ    1024,DU
         1 003137   003155 601000 1                  TNZ     s:5216

     1101     5209    4               IF VID.MIRROR.STATE(0)=%NI_MIRROR_OPER THEN DO;

   5209  1 003140   000045 236100                    LDQ     37,,PR0
         1 003141   770000 316003                    CANQ    -4096,DU
         1 003142   003154 601000 1                  TNZ     s:5215

     1102     5210    4                  DEV.MRRDCTX=0;

   5210  1 003143   100006 450100                    STZ     6,,PR1

     1103     5211    4                  DEV.MRRUTS=VID.MIRROR.UTS;

   5211  1 003144   000044 235100                    LDA     36,,PR0
         1 003145   100007 755100                    STA     7,,PR1
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:217  

     1104     5212    4                  DEV.MIRROR='1'B;

   5212  1 003146   002000 236003                    LDQ     1024,DU
         1 003147   100002 256100                    ORSQ    2,,PR1

     1105     5213    4                  NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_WAIT;

   5213  1 003150   200005 473500                    LDP3    DCT$,,AUTO
         1 003151   000300 236003                    LDQ     192,DU
         1 003152   300036 752120                    STCQ    30,'20'O,PR3

     1106     5214    4                  END;

   5214  1 003153   003216 710000 1                  TRA     s:5226

     1107     5215    3               ELSE VID.VSN=0; /* dont reflect broken mirrors */

   5215  1 003154   000002 450100                    STZ     2,,PR0

     1108     5216    3               END;

   5216  1 003155   003216 710000 1                  TRA     s:5226

     1109     5217    3            ELSE IF DEV.MIRROR THEN DO;

   5217  1 003156   200012 471500                    LDP1    SET$,,AUTO
         1 003157   100002 236100                    LDQ     2,,PR1
         1 003160   002000 316003                    CANQ    1024,DU
         1 003161   003216 600000 1                  TZE     s:5226

     1110     5218    3                  IF NI$DCT.DP.MIRROR.FLAG AND DEV.SPIN THEN EXIT; /* pretty screwy */

   5218  1 003162   200005 473500                    LDP3    DCT$,,AUTO
         1 003163   300036 234100                    SZN     30,,PR3
         1 003164   003167 605000 1                  TPL     s:5219
         1 003165   004000 316003                    CANQ    2048,DU
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:218  
         1 003166   003216 601000 1                  TNZ     s:5226

     1111     5219    3                  DEV.MIRROR='0'B;

   5219  1 003167   000036 236000 2                  LDQ     30
         1 003170   100002 356100                    ANSQ    2,,PR1

     1112     5220    3                  IF B$JIT.SYSID~=JG_PIG# THEN CALL PIGMSG; /* give PIG a poke */

   5220  1 003171   000000 474400 xsym               LDP4    B$JIT$
         1 003172   400000 720100                    LXL0    0,,PR4
         1 003173   000007 100003                    CMPX0   7,DU
         1 003174   003177 600000 1                  TZE     s:5221

   5220  1 003175   005362 701000 1                  TSX1    PIGMSG
         1 003176   000000 011000                    NOP     0

     1113     5221    3                  IF DEV.SECTL~=0 THEN EXIT; /* the primary, nothing to do. */

   5221  1 003177   200012 470500                    LDP0    SET$,,AUTO
         1 003200   000005 720100                    LXL0    5,,PR0
         1 003201   003216 601000 1                  TNZ     s:5226

     1114     5222    3                  IF DEV.VSN=VID.VSN THEN DEV.VSN=0; /* 2ndary, make it go away */

   5222  1 003202   200007 471500                    LDP1    BUF$,,AUTO
         1 003203   000001 236100                    LDQ     1,,PR0
         1 003204   100002 116100                    CMPQ    2,,PR1
         1 003205   003207 601000 1                  TNZ     s:5223

   5222  1 003206   000001 450100                    STZ     1,,PR0

     1115     5223    3                  NI$DCT.RAT$->FR$RAT.FLG.MBIT='0'B;

   5223  1 003207   200005 473500                    LDP3    DCT$,,AUTO
         1 003210   300005 474500                    LDP4    5,,PR3
         1 003211   000037 236000 2                  LDQ     31
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:219  
         1 003212   400010 356100                    ANSQ    8,,PR4

     1116     5224    3                  NI$DCT.RAT$->FR$RAT.FLG.OPN='0'B;

   5224  1 003213   300005 474500                    LDP4    5,,PR3
         1 003214   000040 236000 2                  LDQ     32
         1 003215   400010 356100                    ANSQ    8,,PR4

     1117     5225    3                  END;

     1118     5226    2            I=FM$CFUX.DSETH;

   5226  1 003216   000000 470400 xsym               LDP0    F$CFU$
         1 003217   000005 236100                    LDQ     5,,PR0
         1 003220   777777 376007                    ANQ     -1,DL
         1 003221   200013 756100                    STQ     I,,AUTO

     1119     5227    3   MRRCHK:  DO WHILE(I~=0);

   5227  1 003222   003361 600000 1     MRRCHK       TZE     s:5268

     1120     5228    4               IF VID.VSN~=DEV.VSN AND VID.VSN=FM$DEV.VSN(I) THEN DO;

   5228  1 003223   200007 470500                    LDP0    BUF$,,AUTO
         1 003224   200012 471500                    LDP1    SET$,,AUTO
         1 003225   000002 236100                    LDQ     2,,PR0
         1 003226   100001 116100                    CMPQ    1,,PR1
         1 003227   003352 600000 1                  TZE     s:5266
         1 003230   200013 235100                    LDA     I,,AUTO
         1 003231   000003 735000                    ALS     3
         1 003232   000000 473400 xsym               LDP3    FM$SET$
         1 003233   300001 116105                    CMPQ    1,AL,PR3
         1 003234   003352 601000 1                  TNZ     s:5266

     1121     5229                    /* Identical VSNs - could be a mirror. */
     1122     5230    5                  IF NOT FM$DEV.MIRROR(I) OR FM$DEV.MRRDCTX(I)~=0 THEN DO;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:220  
   5230  1 003235   300002 236105                    LDQ     2,AL,PR3
         1 003236   002000 316003                    CANQ    1024,DU
         1 003237   003242 600000 1                  TZE     s:5232
         1 003240   300006 235105                    LDA     6,AL,PR3
         1 003241   003253 600000 1                  TZE     s:5237

     1123     5231                    /* The first one isn't waiting; ignore this one. */
     1124     5232    5                     IF NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_WAIT

   5232  1 003242   200005 474500                    LDP4    DCT$,,AUTO
         1 003243   400036 236100                    LDQ     30,,PR4
         1 003244   007700 376003                    ANQ     4032,DU
         1 003245   000300 116003                    CMPQ    192,DU
         1 003246   003251 601000 1                  TNZ     s:5234

     1125     5233    5                     THEN NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_OPER;

   5233  1 003247   000000 236003                    LDQ     0,DU
         1 003250   400036 752120                    STCQ    30,'20'O,PR4

     1126     5234    5                     VID.VSN=0;

   5234  1 003251   000002 450100                    STZ     2,,PR0

     1127     5235    5                     EXIT MRRCHK;

   5235  1 003252   003361 710000 1                  TRA     s:5268

     1128     5236    5                     END;
     1129     5237    5                  IF NOT DEV.MIRROR THEN DO;

   5237  1 003253   100002 236100                    LDQ     2,,PR1
         1 003254   002000 316003                    CANQ    1024,DU
         1 003255   003270 601000 1                  TNZ     s:5246

     1130     5238                    /* This one isn't waiting; ignore the first one. */
     1131     5239    5                     FM$DEV.VSN(I)=0;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:221  

   5239  1 003256   200013 235100                    LDA     I,,AUTO
         1 003257   000003 735000                    ALS     3
         1 003260   300001 450105                    STZ     1,AL,PR3

     1132     5240    5                     DCTX=I;

   5240  1 003261   200013 235100                    LDA     I,,AUTO
         1 003262   200011 755100                    STA     DCTX,,AUTO

     1133     5241    5                     CALL PIGMSG;

   5241  1 003263   005362 701000 1                  TSX1    PIGMSG
         1 003264   000000 011000                    NOP     0

     1134     5242    5                     DCTX=ACCTX;

   5242  1 003265   200004 235100                    LDA     ACCT$,,AUTO
         1 003266   200011 755100                    STA     DCTX,,AUTO

     1135     5243    5                     EXIT MRRCHK;

   5243  1 003267   003361 710000 1                  TRA     s:5268

     1136     5244    5                     END;
     1137     5245           /* Got the second half of a mirror pair; make first primary and link them up. */
     1138     5246    4                  FM$DEV.MRRDCTX(I)=DCTX;

   5246  1 003270   200013 235100                    LDA     I,,AUTO
         1 003271   000003 735000                    ALS     3
         1 003272   200011 236100                    LDQ     DCTX,,AUTO
         1 003273   300006 756105                    STQ     6,AL,PR3

     1139     5247    4                  DEV.MRRDCTX=I;

   5247  1 003274   200013 235100                    LDA     I,,AUTO
         1 003275   100006 755100                    STA     6,,PR1
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:222  

     1140     5248    4                  DCTX=I;

   5248  1 003276   200013 236100                    LDQ     I,,AUTO
         1 003277   200011 756100                    STQ     DCTX,,AUTO

     1141     5249    5                  DO WHILE '1'B; /* Actually, only twice, but who's counting? */

     1142     5250    5                     DCT$=N$DCT$(DCTX);

   5250  1 003300   000000 470400 xsym               LDP0    N$DCT$$
         1 003301   200011 720100                    LXL0    DCTX,,AUTO
         1 003302   000000 236110                    LDQ     0,X0,PR0
         1 003303   200005 756100                    STQ     DCT$,,AUTO

     1143     5251    5                     NI$DCT.DP.MIRROR='0'B;

   5251  1 003304   200005 471500                    LDP1    DCT$,,AUTO
         1 003305   000100 100400                    MLR     fill='000'O
         1 003306   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 003307   100036 000024                    ADSC9   30,,PR1                  cn=0,n=20

     1144     5252    5                     NI$DCT.DP.MIRROR.FLAG='1'B;

   5252  1 003310   400000 236003                    LDQ     -131072,DU
         1 003311   100036 256100                    ORSQ    30,,PR1

     1145     5253    5                     NI$DCT.DP.MIRROR.DCTX=FM$DEV.MRRDCTX(DCTX);

   5253  1 003312   200011 235100                    LDA     DCTX,,AUTO
         1 003313   000003 735000                    ALS     3
         1 003314   000000 473400 xsym               LDP3    FM$SET$
         1 003315   300006 721105                    LXL1    6,AL,PR3
         1 003316   100037 741100                    STX1    31,,PR1

     1146     5254    5                     NI$DCT.DP.MIRROR.UTS=FM$DEV.MRRUTS(DCTX);

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:223  
   5254  1 003317   300007 235105                    LDA     7,AL,PR3
         1 003320   100040 755100                    STA     32,,PR1

     1147     5255    5                     IF I=FM$CFUX.DSETH THEN NI$DCT.DP.MIRROR.DRZERO=VID.SYSSIZE;

   5255  1 003321   000000 474400 xsym               LDP4    F$CFU$
         1 003322   400005 236100                    LDQ     5,,PR4
         1 003323   777777 376007                    ANQ     -1,DL
         1 003324   200013 116100                    CMPQ    I,,AUTO
         1 003325   003331 601000 1                  TNZ     s:5256

   5255  1 003326   200007 475500                    LDP5    BUF$,,AUTO
         1 003327   500005 235100                    LDA     5,,PR5
         1 003330   100041 755100                    STA     33,,PR1

     1148     5256    5                     NI$DCT.DP.MIRROR.LQ$=ADDR(NIL);

   5256  1 003331   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003332   100042 756100                    STQ     34,,PR1

     1149     5257    5                     NI$DCT.DP.MIRROR.WRITE='1'B;

   5257  1 003333   200000 236003                    LDQ     65536,DU
         1 003334   100036 256100                    ORSQ    30,,PR1

     1150     5258    5                     NI$DCT.DP.MIRROR.READ='1'B;

   5258  1 003335   100000 236003                    LDQ     32768,DU
         1 003336   100036 256100                    ORSQ    30,,PR1

     1151     5259                    /*                NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_OPER; */
     1152     5260    5                     IF ACCTX=DCTX THEN EXIT;

   5260  1 003337   200004 236100                    LDQ     ACCT$,,AUTO
         1 003340   003343 604000 1                  TMI     s:5261
         1 003341   200011 116100                    CMPQ    DCTX,,AUTO
         1 003342   003352 600000 1                  TZE     s:5266
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:224  

     1153     5261    5                     NI$DCT.DP.MIRROR.PRI='1'B;

   5261  1 003343   020000 236003                    LDQ     8192,DU
         1 003344   100036 256100                    ORSQ    30,,PR1

     1154     5262    5                     CALL PIGMSG; /* Run through again to set up the VOL/SETs   */

   5262  1 003345   005362 701000 1                  TSX1    PIGMSG
         1 003346   000000 011000                    NOP     0

     1155     5263    5                     DCTX=ACCTX;

   5263  1 003347   200004 235100                    LDA     ACCT$,,AUTO
         1 003350   200011 755100                    STA     DCTX,,AUTO

     1156     5264    5                     END;

   5264  1 003351   003300 710000 1                  TRA     s:5250

     1157     5265    4                  END;

     1158     5266    3               I=FM$DEV.DEVL(I);

   5266  1 003352   200013 235100                    LDA     I,,AUTO
         1 003353   000003 735000                    ALS     3
         1 003354   000000 470400 xsym               LDP0    FM$SET$
         1 003355   000005 236105                    LDQ     5,AL,PR0
         1 003356   000022 772000                    QRL     18
         1 003357   200013 756100                    STQ     I,,AUTO

     1159     5267    3               END;

   5267  1 003360   003223 601000 1                  TNZ     s:5228

     1160     5268    2            DEV.VSN=VID.VSN;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:225  
   5268  1 003361   200007 470500                    LDP0    BUF$,,AUTO
         1 003362   200012 471500                    LDP1    SET$,,AUTO
         1 003363   000002 235100                    LDA     2,,PR0
         1 003364   100001 755100                    STA     1,,PR1

     1161     5269    2            IF DEV.MIRROR

   5269  1 003365   100002 236100                    LDQ     2,,PR1
         1 003366   002000 316003                    CANQ    1024,DU
         1 003367   003416 600000 1                  TZE     s:5277

     1162     5270    2            THEN IF DEV.MRRDCTX<=0 THEN GOTO NORES; /* All done if waiting */

   5270  1 003370   100006 235100                    LDA     6,,PR1
         1 003371   004161 604400 1                  TMOZ    NORES

     1163     5271    3               ELSE IF NOT NI$DCT.DP.MIRROR.PRI THEN DO;

   5271  1 003372   200005 473500                    LDP3    DCT$,,AUTO
         1 003373   300036 236100                    LDQ     30,,PR3
         1 003374   020000 316003                    CANQ    8192,DU
         1 003375   003416 601000 1                  TNZ     s:5277

     1164     5272    3                     CFU$=NI$DCT.RAT$;

   5272  1 003376   300005 236100                    LDQ     5,,PR3
         1 003377   200006 756100                    STQ     CFU$,,AUTO

     1165     5273    3                     SUBSTR(F$DCB.PSN,0,4)='*MDP';

   5273  1 003400   000020 236000 0                  LDQ     FMN$E$ACGRANS+8
         1 003401   200010 474500                    LDP4    JDCB$,,AUTO
         1 003402   400024 756100                    STQ     20,,PR4

     1166     5274    3                     CALL BINCHAR(SUBSTR(F$DCB.PSN,4,2),FM$DEV.NN(DEV.MRRDCTX));

   5274  1 003403   100006 235100                    LDA     6,,PR1
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:226  
         1 003404   000003 735000                    ALS     3
         1 003405   000000 475400 xsym               LDP5    FM$SET$
         1 003406   500000 236105                    LDQ     0,AL,PR5
         1 003407   777777 376007                    ANQ     -1,DL
         1 003410   000000 235003                    LDA     0,DU
         1 003411   200026 757100                    STAQ    UN+3,,AUTO
         1 003412   000100 301500                    BTD
         1 003413   200026 000010                    NDSC9   UN+3,,AUTO               cn=0,s=lsgnf,sf=0,n=8
         1 003414   400025 030002                    NDSC9   21,,PR4                  cn=0,s=nosgn,sf=0,n=2

     1167     5275    3                     GOTO GETRES;

   5275  1 003415   004026 710000 1                  TRA     GETRES

     1168     5276    3                     END;
     1169     5277    2            AVRM.WORDS=0;

   5277  1 003416   200014 450100                    STZ     AVRM,,AUTO

     1170     5278    2            IF VID.SECTSTRT(0)>DEV.NXTSDA-FM_SRZERO THEN VID.SECTSTRT='0'B;

   5278  1 003417   100003 236100                    LDQ     3,,PR1
         1 003420   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 003421   000000 136000 xsym               SBLQ    FM_SRZERO
         1 003422   003425 604000 1                  TMI     s:5278+6
         1 003423   000010 116100                    CMPQ    8,,PR0
         1 003424   003430 603000 1                  TRC     s:5279

   5278  1 003425   000100 100400                    MLR     fill='000'O
         1 003426   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 003427   000010 000150                    ADSC9   8,,PR0                   cn=0,n=104

     1171     5279    3            DO WHILE(I=0 OR FM$VOL.SECTL(DCTX)~=0 OR VID.SECTSTRT(I)>VID.SECTSTRT(I-1)

   5279  1 003430   003733 710000 1                  TRA     s:5331

     1172     5280    3              AND VID.SECTSTRT(I)<DEV.NXTSDA-FM_SRZERO);
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:227  
     1173     5281    3               IF VID.SECTSTRT(I)>=VID.SECTSTRT(I+1) OR VID.SECTSTRT(I+1)>

   5281  1 003431   200007 470500                    LDP0    BUF$,,AUTO
         1 003432   200013 720100                    LXL0    I,,AUTO
         1 003433   000010 236110                    LDQ     8,X0,PR0
         1 003434   000011 116110                    CMPQ    9,X0,PR0
         1 003435   003445 603000 1                  TRC     s:5282
         1 003436   200012 471500                    LDP1    SET$,,AUTO
         1 003437   100003 236100                    LDQ     3,,PR1
         1 003440   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 003441   000000 136000 xsym               SBLQ    FM_SRZERO
         1 003442   003445 604000 1                  TMI     s:5282
         1 003443   000011 116110                    CMPQ    9,X0,PR0
         1 003444   003452 603000 1                  TRC     s:5283

     1174     5282    3                 DEV.NXTSDA-FM_SRZERO THEN VID.SECTSTRT(I+1)=DEV.NXTSDA-FM_SRZERO;

   5282  1 003445   200012 471500                    LDP1    SET$,,AUTO
         1 003446   100003 236100                    LDQ     3,,PR1
         1 003447   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 003450   000000 136000 xsym               SBLQ    FM_SRZERO
         1 003451   000011 756110                    STQ     9,X0,PR0

     1175     5283    3               DCT$=ADDR(NIL);

   5283  1 003452   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003453   200005 756100                    STQ     DCT$,,AUTO

     1176     5284    3               IF VID.VSN~=0 AND(FM$VOL.SECTL(DCTX)=0 OR VID.SECTSTRT(I)<

   5284  1 003454   000002 235100                    LDA     2,,PR0
         1 003455   003564 600000 1                  TZE     s:5299
         1 003456   200011 235100                    LDA     DCTX,,AUTO
         1 003457   000003 735000                    ALS     3
         1 003460   000000 473400 xsym               LDP3    FM$SET$
         1 003461   300005 720105                    LXL0    5,AL,PR3
         1 003462   003473 600000 1                  TZE     s:5286
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:228  
         1 003463   300005 236105                    LDQ     5,AL,PR3
         1 003464   000003 736000                    QLS     3
         1 003465   000000 376000 2                  ANQ     0
         1 003466   000000 621006                    EAX1    0,QL
         1 003467   200013 722100                    LXL2    I,,AUTO
         1 003470   000010 236112                    LDQ     8,X2,PR0
         1 003471   300004 116111                    CMPQ    4,X1,PR3
         1 003472   003564 603000 1                  TRC     s:5299

     1177     5285    4                 FM$VOL.DRZERO(FM$VOL.SECTL(DCTX))) THEN DO;

     1178     5286    4                  CALL FMR$L8;

   5286  1 003473   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003474   000000 701000 xent               TSX1    FMR$L8
         1 003475   000000 011000                    NOP     0

     1179     5287    4                  CALL FMR$GA (XT$,AVRM.WORDS) ALTRET(SCREECH);

   5287  1 003476   200014 630500                    EPPR0   AVRM,,AUTO
         1 003477   200027 450500                    STP0    UN+4,,AUTO
         1 003500   200020 236100                    LDQ     T$$,,AUTO
         1 003501   200026 756100                    STQ     UN+3,,AUTO
         1 003502   200026 630500                    EPPR0   UN+3,,AUTO
         1 003503   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003504   000000 701000 xent               TSX1    FMR$GA
         1 003505   001433 702000 1                  TSX2    SCREECH

     1180     5288    4                  DCT$=T$;

   5288  1 003506   200017 236100                    LDQ     T$,,AUTO
         1 003507   200005 756100                    STQ     DCT$,,AUTO

     1181     5289    4                  DCT$->VOL.DCTX=DEV.DCTX;

   5289  1 003510   200012 470500                    LDP0    SET$,,AUTO
         1 003511   000000 220100                    LDX0    0,,PR0
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:229  
         1 003512   200005 471500                    LDP1    DCT$,,AUTO
         1 003513   100000 740100                    STX0    0,,PR1

     1182     5290    4                  DCT$->VOL.SECTL=FM$VOL.SECTL(DCTX);

   5290  1 003514   200011 235100                    LDA     DCTX,,AUTO
         1 003515   000003 735000                    ALS     3
         1 003516   000000 473400 xsym               LDP3    FM$SET$
         1 003517   300005 721105                    LXL1    5,AL,PR3
         1 003520   100005 441100                    SXL1    5,,PR1

     1183     5291    4                  DCT$->VOL.VSN=VID.VSN;

   5291  1 003521   200007 474500                    LDP4    BUF$,,AUTO
         1 003522   400002 236100                    LDQ     2,,PR4
         1 003523   100001 552134                    STBQ    1,'34'O,PR1

     1184     5292    4                  DCT$->VOL.XCL='1'B;

   5292  1 003524   400000 236003                    LDQ     -131072,DU
         1 003525   100002 256100                    ORSQ    2,,PR1

     1185     5293    4                  DCT$->VOL.DRZERO=VID.SECTSTRT(I);

   5293  1 003526   200013 722100                    LXL2    I,,AUTO
         1 003527   400010 235112                    LDA     8,X2,PR4
         1 003530   100004 755100                    STA     4,,PR1

     1186     5294    4                  DCT$->VOL.NXTSDA=VID.SECTSTRT(I+1)-VID.SECTSTRT(I)+FM_SRZERO;

   5294  1 003531   200013 722100                    LXL2    I,,AUTO
         1 003532   400011 236112                    LDQ     9,X2,PR4
         1 003533   400010 136112                    SBLQ    8,X2,PR4
         1 003534   000000 036000 xsym               ADLQ    FM_SRZERO
         1 003535   100003 552134                    STBQ    3,'34'O,PR1

     1187     5295    4                  IF DCT$->VOL.NXTSDA<DEV.NXTSDA OR I~=0 THEN DCT$->VOL.SECT#=I+1;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:230  

   5295  1 003536   000003 236100                    LDQ     3,,PR0
         1 003537   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 003540   200026 756100                    STQ     UN+3,,AUTO
         1 003541   100003 236100                    LDQ     3,,PR1
         1 003542   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 003543   200026 116100                    CMPQ    UN+3,,AUTO
         1 003544   003547 604000 1                  TMI     s:5295+9
         1 003545   200013 235100                    LDA     I,,AUTO
         1 003546   003553 600000 1                  TZE     s:5296

   5295  1 003547   200013 236100                    LDQ     I,,AUTO
         1 003550   000001 036007                    ADLQ    1,DL
         1 003551   000033 736000                    QLS     27
         1 003552   100001 552140                    STBQ    1,'40'O,PR1

     1188     5296    4                  FM$VOL.SECTL(DCTX)=AVRM.WORDS/SIZEW(VOL);

   5296  1 003553   200011 235100                    LDA     DCTX,,AUTO
         1 003554   000003 735000                    ALS     3
         1 003555   200014 236100                    LDQ     AVRM,,AUTO
         1 003556   000003 772000                    QRL     3
         1 003557   000000 620006                    EAX0    0,QL
         1 003560   300005 440105                    SXL0    5,AL,PR3

     1189     5297    4                  CALL FMR$U8;

   5297  1 003561   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003562   000000 701000 xent               TSX1    FMR$U8
         1 003563   000000 011000                    NOP     0

     1190     5298    4                  END;

     1191     5299    3               F$DCB.SETX=FM$VOL.SECTL(DCTX);

   5299  1 003564   200011 235100                    LDA     DCTX,,AUTO
         1 003565   000003 735000                    ALS     3
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:231  
         1 003566   000000 470400 xsym               LDP0    FM$SET$
         1 003567   000005 720105                    LXL0    5,AL,PR0
         1 003570   200010 471500                    LDP1    JDCB$,,AUTO
         1 003571   100051 440100                    SXL0    41,,PR1

     1192     5300    4               IF F$DCB.SETX~=0 THEN DO;

   5300  1 003572   003721 600000 1                  TZE     s:5329

     1193     5301    4                  IF VID.SECTSTRT(I)~=FM$VOL.DRZERO(F$DCB.SETX)

   5301  1 003573   100051 236100                    LDQ     41,,PR1
         1 003574   000003 736000                    QLS     3
         1 003575   000000 376000 2                  ANQ     0
         1 003576   000000 621006                    EAX1    0,QL
         1 003577   200007 473500                    LDP3    BUF$,,AUTO
         1 003600   200013 722100                    LXL2    I,,AUTO
         1 003601   300010 236112                    LDQ     8,X2,PR3
         1 003602   000004 116111                    CMPQ    4,X1,PR0
         1 003603   003620 601000 1                  TNZ     s:5305
         1 003604   000001 236111                    LDQ     1,X1,PR0
         1 003605   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 003606   300002 116100                    CMPQ    2,,PR3
         1 003607   003620 601000 1                  TNZ     s:5305
         1 003610   000000 236000 xsym               LDQ     FM_SRZERO
         1 003611   300011 036112                    ADLQ    9,X2,PR3
         1 003612   300010 136112                    SBLQ    8,X2,PR3
         1 003613   200026 756100                    STQ     UN+3,,AUTO
         1 003614   000003 236111                    LDQ     3,X1,PR0
         1 003615   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 003616   200026 116100                    CMPQ    UN+3,,AUTO
         1 003617   003623 600000 1                  TZE     s:5307

     1194     5302    4                    OR VID.VSN~=FM$VOL.VSN(F$DCB.SETX)
     1195     5303    4                    OR FM$VOL.NXTSDA(F$DCB.SETX)~=FM_SRZERO+
     1196     5304    4                    VID.SECTSTRT(I+1)-VID.SECTSTRT(I)
     1197     5305    4                  THEN FM$VOL.SPIN(F$DCB.SETX)='0'B;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:232  

   5305  1 003620   000041 236000 2                  LDQ     33
         1 003621   000002 356111                    ANSQ    2,X1,PR0
         1 003622   003630 710000 1                  TRA     s:5310

     1198     5306    5                  ELSE DO;

     1199     5307    5                     FM$VOL.SPIN(F$DCB.SETX)='1'B;

   5307  1 003623   004000 236003                    LDQ     2048,DU
         1 003624   000002 256111                    ORSQ    2,X1,PR0

     1200     5308    5                     I=I+1;

   5308  1 003625   200013 235100                    LDA     I,,AUTO
         1 003626   000001 035007                    ADLA    1,DL
         1 003627   200013 755100                    STA     I,,AUTO

     1201     5309    5                     END;

     1202     5310    4                  CALL FMN$CLSDP(ADDR(NIL));

   5310  1 003630   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003631   200026 756100                    STQ     UN+3,,AUTO
         1 003632   200026 630500                    EPPR0   UN+3,,AUTO
         1 003633   200027 450500                    STP0    UN+4,,AUTO
         1 003634   200027 630500                    EPPR0   UN+4,,AUTO
         1 003635   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003636   001436 701000 1                  TSX1    s:4980
         1 003637   000000 011000                    NOP     0

     1203     5311    4                  IF NOT FM$VOL.SPIN(F$DCB.SETX)

   5311  1 003640   200010 470500                    LDP0    JDCB$,,AUTO
         1 003641   000051 236100                    LDQ     41,,PR0
         1 003642   000003 736000                    QLS     3
         1 003643   000000 376000 2                  ANQ     0
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:233  
         1 003644   000000 471400 xsym               LDP1    FM$SET$
         1 003645   100002 236106                    LDQ     2,QL,PR1
         1 003646   004000 316003                    CANQ    2048,DU
         1 003647   003715 601000 1                  TNZ     s:5327

     1204     5312    5                  THEN IF FM$VOL.SETX(F$DCB.SETX)=0 THEN DO;

   5312  1 003650   000051 236100                    LDQ     41,,PR0
         1 003651   000003 736000                    QLS     3
         1 003652   000000 376000 2                  ANQ     0
         1 003653   100000 720106                    LXL0    0,QL,PR1
         1 003654   003676 601000 1                  TNZ     s:5319

     1205     5313                    /* Gone section was not in use, delete it */
     1206     5314    5                        FM$VOL.SECTL(DCTX)=FM$VOL.SECTL(F$DCB.SETX);

   5314  1 003655   200011 235100                    LDA     DCTX,,AUTO
         1 003656   000003 735000                    ALS     3
         1 003657   100005 721106                    LXL1    5,QL,PR1
         1 003660   100005 441105                    SXL1    5,AL,PR1

     1207     5315    5                        CALL FMR$Z8(ADDR(FM$VOL(F$DCB.SETX)));

   5315  1 003661   000051 236100                    LDQ     41,,PR0
         1 003662   000003 736000                    QLS     3
         1 003663   000000 376000 2                  ANQ     0
         1 003664   000022 736000                    QLS     18
         1 003665   000000 036000 xsym               ADLQ    FM$SET$
         1 003666   200026 756100                    STQ     UN+3,,AUTO
         1 003667   200026 631500                    EPPR1   UN+3,,AUTO
         1 003670   200027 451500                    STP1    UN+4,,AUTO
         1 003671   200027 630500                    EPPR0   UN+4,,AUTO
         1 003672   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003673   000000 701000 xent               TSX1    FMR$Z8
         1 003674   000000 011000                    NOP     0

     1208     5316    5                        END;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:234  

   5316  1 003675   003724 710000 1                  TRA     s:5330

     1209     5317    5                     ELSE DO;

     1210     5318                  /* Gone section was busy, resurrect it, and dont access any other vsn. */
     1211     5319    6                        IF DEV.SPIN THEN DO;

   5319  1 003676   200012 473500                    LDP3    SET$,,AUTO
         1 003677   300002 236100                    LDQ     2,,PR3
         1 003700   004000 316003                    CANQ    2048,DU
         1 003701   003711 600000 1                  TZE     s:5325

     1212     5320    6                           DEV.SPIN='0'B;

   5320  1 003702   000041 236000 2                  LDQ     33
         1 003703   300002 356100                    ANSQ    2,,PR3

     1213     5321    6                           DCTX=ACCTX;

   5321  1 003704   200004 235100                    LDA     ACCT$,,AUTO
         1 003705   200011 755100                    STA     DCTX,,AUTO

     1214     5322    6                           T$=BUF$;

   5322  1 003706   200007 236100                    LDQ     BUF$,,AUTO
         1 003707   200017 756100                    STQ     T$,,AUTO

     1215     5323    6                           GOTO AVRAGAIN;

   5323  1 003710   002773 710000 1                  TRA     AVRAGAIN

     1216     5324    6                           END;
     1217     5325    5                        DCTX=F$DCB.SETX;

   5325  1 003711   000051 236100                    LDQ     41,,PR0
         1 003712   777777 376007                    ANQ     -1,DL
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:235  
         1 003713   200011 756100                    STQ     DCTX,,AUTO

     1218     5326    5                        END;

   5326  1 003714   003724 710000 1                  TRA     s:5330

     1219     5327    4                  ELSE DCTX=F$DCB.SETX;

   5327  1 003715   000051 236100                    LDQ     41,,PR0
         1 003716   777777 376007                    ANQ     -1,DL
         1 003717   200011 756100                    STQ     DCTX,,AUTO

     1220     5328    4                  END;

   5328  1 003720   003724 710000 1                  TRA     s:5330

     1221     5329    3               ELSE I=I+1;

   5329  1 003721   200013 236100                    LDQ     I,,AUTO
         1 003722   000001 036007                    ADLQ    1,DL
         1 003723   200013 756100                    STQ     I,,AUTO

     1222     5330    3               IF DCT$=ADDR(FM$VOL(DCTX)) THEN CALL PIGMSG;

   5330  1 003724   200011 236100                    LDQ     DCTX,,AUTO
         1 003725   000025 736000                    QLS     21
         1 003726   000000 036000 xsym               ADLQ    FM$SET$
         1 003727   200005 116100                    CMPQ    DCT$,,AUTO
         1 003730   003733 601000 1                  TNZ     s:5331

   5330  1 003731   005362 701000 1                  TSX1    PIGMSG
         1 003732   000000 011000                    NOP     0

     1223     5331    3               END;

   5331  1 003733   200013 235100                    LDA     I,,AUTO
         1 003734   003431 600000 1                  TZE     s:5281
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:236  
         1 003735   200011 236100                    LDQ     DCTX,,AUTO
         1 003736   000003 736000                    QLS     3
         1 003737   000000 470400 xsym               LDP0    FM$SET$
         1 003740   000005 720106                    LXL0    5,QL,PR0
         1 003741   003431 601000 1                  TNZ     s:5281
         1 003742   200007 471500                    LDP1    BUF$,,AUTO
         1 003743   200013 721100                    LXL1    I,,AUTO
         1 003744   100007 236111                    LDQ     7,X1,PR1
         1 003745   100010 116105                    CMPQ    8,AL,PR1
         1 003746   003757 603000 1                  TRC     s:5332
         1 003747   200012 473500                    LDP3    SET$,,AUTO
         1 003750   300003 236100                    LDQ     3,,PR3
         1 003751   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 003752   000000 136000 xsym               SBLQ    FM_SRZERO
         1 003753   003757 604000 1                  TMI     s:5332
         1 003754   100010 116111                    CMPQ    8,X1,PR1
         1 003755   003757 600000 1                  TZE     s:5332
         1 003756   003431 603000 1                  TRC     s:5281

     1224     5332    2            DCTX=VID.VSN;

   5332  1 003757   100002 235100                    LDA     2,,PR1
         1 003760   200011 755100                    STA     DCTX,,AUTO

     1225     5333    2            IF DCTX=0 AND DEV.SECTL~=0 THEN DEV.VSN=FM$VOL.VSN(DEV.SECTL);

   5333  1 003761   003774 601000 1                  TNZ     s:5335
         1 003762   200012 473500                    LDP3    SET$,,AUTO
         1 003763   300005 720100                    LXL0    5,,PR3
         1 003764   003774 600000 1                  TZE     s:5335

   5333  1 003765   300005 236100                    LDQ     5,,PR3
         1 003766   000003 736000                    QLS     3
         1 003767   000000 376000 2                  ANQ     0
         1 003770   000001 236106                    LDQ     1,QL,PR0
         1 003771   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 003772   300001 756100                    STQ     1,,PR3
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:237  
         1 003773   004300 710000 1                  TRA     s:5387

     1226     5334    3            ELSE DO;

     1227     5335    3               DCTX=ACCTX;

   5335  1 003774   200004 236100                    LDQ     ACCT$,,AUTO
         1 003775   200011 756100                    STQ     DCTX,,AUTO

     1228     5336    3               IF AVRM.WORDS~=0 THEN CALL PIGMSG;

   5336  1 003776   200014 235100                    LDA     AVRM,,AUTO
         1 003777   004002 600000 1                  TZE     s:5337

   5336  1 004000   005362 701000 1                  TSX1    PIGMSG
         1 004001   000000 011000                    NOP     0

     1229     5337    3               F$DCB.SETX=ACCTX;

   5337  1 004002   200004 720100                    LXL0    ACCT$,,AUTO
         1 004003   200010 470500                    LDP0    JDCB$,,AUTO
         1 004004   000051 440100                    SXL0    41,,PR0

     1230     5338    3               CFU$=N$DCT$(ACCTX)->NI$DCT.RAT$;

   5338  1 004005   000000 471400 xsym               LDP1    N$DCT$$
         1 004006   100000 473510                    LDP3    0,X0,PR1
         1 004007   300005 236100                    LDQ     5,,PR3
         1 004010   200006 756100                    STQ     CFU$,,AUTO

     1231     5339    4               IF DEV.SECTL~=0 AND FM$VOL.SECT#(DEV.SECTL)~=0 THEN DO;

   5339  1 004011   200012 474500                    LDP4    SET$,,AUTO
         1 004012   400005 721100                    LXL1    5,,PR4
         1 004013   004162 600000 1                  TZE     s:5371
         1 004014   400005 236100                    LDQ     5,,PR4
         1 004015   000003 736000                    QLS     3
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:238  
         1 004016   000000 376000 2                  ANQ     0
         1 004017   000000 475400 xsym               LDP5    FM$SET$
         1 004020   500001 236106                    LDQ     1,QL,PR5
         1 004021   777000 316003                    CANQ    -512,DU
         1 004022   004162 600000 1                  TZE     s:5371

     1232     5340    4                  F$DCB.PSN='*LOTS*';

   5340  1 004023   040100 100400                    MLR     fill='040'O
         1 004024   000021 000006 0                  ADSC9   FMN$E$ACGRANS+9          cn=0,n=6
         1 004025   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6

   5340  1 004026                       GETRES       null
     1233     5341    4   GETRES:        ;
     1234     5342    5                  IF B$JIT.SYSID=JG_PIG# AND FR$RAT.RES.SISID~=JG_PIG# THEN DO;

   5342  1 004026   000000 470400 xsym               LDP0    B$JIT$
         1 004027   000000 720100                    LXL0    0,,PR0
         1 004030   000007 100003                    CMPX0   7,DU
         1 004031   004300 601000 1                  TNZ     s:5387
         1 004032   200006 471500                    LDP1    CFU$,,AUTO
         1 004033   100001 221100                    LDX1    1,,PR1
         1 004034   000007 101003                    CMPX1   7,DU
         1 004035   004300 600000 1                  TZE     s:5387

     1235     5343                    /* Could have been partitioned during the VID read */
     1236     5344    5                     IF FR$RAT.FLG.DOWN THEN EXIT;

   5344  1 004036   100010 236100                    LDQ     8,,PR1
         1 004037   000002 316007                    CANQ    2,DL
         1 004040   004161 601000 1                  TNZ     NORES

     1237     5345                    /* GHOST1 WILL HAVE SET MTD FOR #SYS */
     1238     5346    5                     IF FR$RAT.REEL.ASID=0 THEN FR$RAT.FLG.MBIT.MTD='0'B;

   5346  1 004041   100004 222100                    LDX2    4,,PR1
         1 004042   004045 601000 1                  TNZ     s:5347
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:239  

   5346  1 004043   000042 236000 2                  LDQ     34
         1 004044   100010 356100                    ANSQ    8,,PR1

     1239     5347    5                     T$=CFU$;

   5347  1 004045   200006 236100                    LDQ     CFU$,,AUTO
         1 004046   200017 756100                    STQ     T$,,AUTO

     1240     5348    5                     CALL FRZ$GETRES ('DP  ',FR$RAT.M1,JG_PIG#,%MODE_GHOST#,XT$)

   5348  1 004047   200020 236100                    LDQ     T$$,,AUTO
         1 004050   200032 756100                    STQ     UN+7,,AUTO
         1 004051   000044 237000 2                  LDAQ    36
         1 004052   200030 757100                    STAQ    UN+5,,AUTO
         1 004053   200006 236100                    LDQ     CFU$,,AUTO
         1 004054   000006 036003                    ADLQ    6,DU
         1 004055   000043 235000 2                  LDA     35
         1 004056   200026 757100                    STAQ    UN+3,,AUTO
         1 004057   200026 630500                    EPPR0   UN+3,,AUTO
         1 004060   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 004061   000000 701000 xent               TSX1    FRZ$GETRES
         1 004062   004161 702000 1                  TSX2    NORES

     1241     5349    5                       ALTRET(NORES);
     1242     5350    5                     FR$RAT.RES.NUMB=' ';

   5350  1 004063   040040 220003                    LDX0    16416,DU
         1 004064   200006 470500                    LDP0    CFU$,,AUTO
         1 004065   000001 440100                    SXL0    1,,PR0

     1243     5351    5                     FR$RAT.RES.ACTX=0;

   5351  1 004066   000000 221003                    LDX1    0,DU
         1 004067   000002 441100                    SXL1    2,,PR0

     1244     5352    5                     F$DCB.CSEED=DEV.VSN;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:240  

   5352  1 004070   200012 471500                    LDP1    SET$,,AUTO
         1 004071   100001 235100                    LDA     1,,PR1
         1 004072   200010 473500                    LDP3    JDCB$,,AUTO
         1 004073   300072 755100                    STA     58,,PR3

     1245     5353    5                     F$DCB.ATTR=FR$RAT.M1;

   5353  1 004074   000006 222100                    LDX2    6,,PR0
         1 004075   300040 442100                    SXL2    32,,PR3

     1246     5354    5                     T$=ACCT$;

   5354  1 004076   200004 236100                    LDQ     ACCT$,,AUTO
         1 004077   200017 756100                    STQ     T$,,AUTO

     1247     5355    5                     CALL FRC$AVR (XT$,1,F$DCB.PSN);

   5355  1 004100   200010 236100                    LDQ     JDCB$,,AUTO
         1 004101   000024 036003                    ADLQ    20,DU
         1 004102   200030 756100                    STQ     UN+5,,AUTO
         1 004103   000004 236000 2                  LDQ     4
         1 004104   200020 235100                    LDA     T$$,,AUTO
         1 004105   200026 757100                    STAQ    UN+3,,AUTO
         1 004106   200026 630500                    EPPR0   UN+3,,AUTO
         1 004107   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004110   000000 701000 xent               TSX1    FRC$AVR
         1 004111   000000 011000                    NOP     0

     1248     5356    5                     CALL FRA$OPR ALTRET(SCREECH);

   5356  1 004112   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004113   000000 701000 xent               TSX1    FRA$OPR
         1 004114   001433 702000 1                  TSX2    SCREECH

     1249     5357    5                     CFU$=N$DCT$(ACCTX)->NI$DCT.RAT$;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:241  
   5357  1 004115   000000 470400 xsym               LDP0    N$DCT$$
         1 004116   200004 720100                    LXL0    ACCT$,,AUTO
         1 004117   000000 471510                    LDP1    0,X0,PR0
         1 004120   100005 236100                    LDQ     5,,PR1
         1 004121   200006 756100                    STQ     CFU$,,AUTO

     1250     5358    5                     FR$RAT.RES.RFLG.NOSLD='1'B;

   5358  1 004122   200006 473500                    LDP3    CFU$,,AUTO
         1 004123   010000 236003                    LDQ     4096,DU
         1 004124   300003 256100                    ORSQ    3,,PR3

     1251     5359    5                     I=DEV.SECTL;

   5359  1 004125   200012 471500                    LDP1    SET$,,AUTO
         1 004126   100005 236100                    LDQ     5,,PR1
         1 004127   777777 376007                    ANQ     -1,DL
         1 004130   200013 756100                    STQ     I,,AUTO

     1252     5360    6                     DO WHILE(I~=0);

   5360  1 004131   004150 600000 1                  TZE     s:5365

     1253     5361    6                        IF FM$VOL.SETX(I)~=0

   5361  1 004132   200013 235100                    LDA     I,,AUTO
         1 004133   000003 735000                    ALS     3
         1 004134   000000 470400 xsym               LDP0    FM$SET$
         1 004135   000000 720105                    LXL0    0,AL,PR0
         1 004136   004144 600000 1                  TZE     s:5363
         1 004137   000000 236105                    LDQ     0,AL,PR0
         1 004140   000003 736000                    QLS     3
         1 004141   000000 376000 2                  ANQ     0
         1 004142   000002 721106                    LXL1    2,QL,PR0
         1 004143   004161 601000 1                  TNZ     NORES

     1254     5362    6                          AND FMX$SET.SYSID(FM$VOL.SETX(I))~=0 THEN GOTO NORES;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:242  
     1255     5363    6                        I=FM$VOL.SECTL(I);

   5363  1 004144   000005 236105                    LDQ     5,AL,PR0
         1 004145   777777 376007                    ANQ     -1,DL
         1 004146   200013 756100                    STQ     I,,AUTO

     1256     5364    6                        END;

   5364  1 004147   004132 601000 1                  TNZ     s:5361

     1257     5365    5                     FR$RAT.FLG.OPN='0'B;

   5365  1 004150   200006 470500                    LDP0    CFU$,,AUTO
         1 004151   000040 236000 2                  LDQ     32
         1 004152   000010 356100                    ANSQ    8,,PR0

     1258     5366    5                     IF SUBSTR(F$DCB.PSN,0,2)='*L' THEN FR$RAT.FLG.MBIT='0'B;

   5366  1 004153   200010 471500                    LDP1    JDCB$,,AUTO
         1 004154   100024 220100                    LDX0    20,,PR1
         1 004155   000021 100000 0                  CMPX0   FMN$E$ACGRANS+9
         1 004156   004161 601000 1                  TNZ     NORES

   5366  1 004157   000037 236000 2                  LDQ     31
         1 004160   000010 356100                    ANSQ    8,,PR0

   5366  1 004161                       NORES        null
     1259     5367    5   NORES:            ;
     1260     5368    5                     END;

     1261     5369    4                  END;

   5369  1 004161   004300 710000 1                  TRA     s:5387

     1262     5370    4               ELSE DO;

     1263     5371    4                  IF FR$RAT.RES.SISID=JG_PIG# AND B$JIT.SYSID=JG_PIG#
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:243  

   5371  1 004162   200006 475500                    LDP5    CFU$,,AUTO
         1 004163   500001 222100                    LDX2    1,,PR5
         1 004164   000007 102003                    CMPX2   7,DU
         1 004165   004204 601000 1                  TNZ     s:5373
         1 004166   000000 476400 xsym               LDP6    B$JIT$
         1 004167   600000 723100                    LXL3    0,,PR6
         1 004170   000007 103003                    CMPX3   7,DU
         1 004171   004204 601000 1                  TNZ     s:5373
         1 004172   500003 236100                    LDQ     3,,PR5
         1 004173   020000 316003                    CANQ    8192,DU
         1 004174   004204 601000 1                  TNZ     s:5373

     1264     5372    4                    AND NOT FR$RAT.RES.RFLG.OLT THEN CALL FRZ$RRESNA(FR$RAT,%
              5372                             MODE_GHOST#);

   5372  1 004175   000024 236000 2                  LDQ     20
         1 004176   200006 235100                    LDA     CFU$,,AUTO
         1 004177   200026 757100                    STAQ    UN+3,,AUTO
         1 004200   200026 630500                    EPPR0   UN+3,,AUTO
         1 004201   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004202   000000 701000 xent               TSX1    FRZ$RRESNA
         1 004203   000000 011000                    NOP     0

     1265     5373    4                  I=FM$VOL.SETX(DEV.SECTL);

   5373  1 004204   200012 470500                    LDP0    SET$,,AUTO
         1 004205   000005 236100                    LDQ     5,,PR0
         1 004206   000003 736000                    QLS     3
         1 004207   000000 376000 2                  ANQ     0
         1 004210   000000 471400 xsym               LDP1    FM$SET$
         1 004211   100000 236106                    LDQ     0,QL,PR1
         1 004212   777777 376007                    ANQ     -1,DL
         1 004213   200013 756100                    STQ     I,,AUTO

     1266     5374    4                  IF NOT DEV.SPIN OR DEV.SECTL=0 THEN IS=-1;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:244  
   5374  1 004214   000002 236100                    LDQ     2,,PR0
         1 004215   004000 316003                    CANQ    2048,DU
         1 004216   004221 600000 1                  TZE     s:5374+5
         1 004217   000005 720100                    LXL0    5,,PR0
         1 004220   004223 601000 1                  TNZ     s:5375

   5374  1 004221   000001 335007                    LCA     1,DL
         1 004222   200013 755100                    STA     I,,AUTO

     1267     5375    4                  T$=ACCT$;

   5375  1 004223   200004 236100                    LDQ     ACCT$,,AUTO
         1 004224   200017 756100                    STQ     T$,,AUTO

     1268     5376    4                  CALL FRC$AVR (XT$,IS,FMX$SET.PSN(I));

   5376  1 004225   200013 236100                    LDQ     I,,AUTO
         1 004226   000025 736000                    QLS     21
         1 004227   400000 036007                    ADLQ    -131072,DL
         1 004230   000000 036000 xsym               ADLQ    FM$SET$
         1 004231   200030 756100                    STQ     UN+5,,AUTO
         1 004232   200013 633500                    EPPR3   I,,AUTO
         1 004233   200027 453500                    STP3    UN+4,,AUTO
         1 004234   200020 236100                    LDQ     T$$,,AUTO
         1 004235   200026 756100                    STQ     UN+3,,AUTO
         1 004236   200026 630500                    EPPR0   UN+3,,AUTO
         1 004237   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004240   000000 701000 xent               TSX1    FRC$AVR
         1 004241   000000 011000                    NOP     0

     1269     5377    4                  IF IS>=0 OR DEV.MRRDCTX<=0

   5377  1 004242   200013 235100                    LDA     I,,AUTO
         1 004243   004300 605000 1                  TPL     s:5387
         1 004244   200012 470500                    LDP0    SET$,,AUTO
         1 004245   000006 235100                    LDA     6,,PR0
         1 004246   004300 604400 1                  TMOZ    s:5387
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:245  
         1 004247   000006 235100                    LDA     6,,PR0
         1 004250   000003 735000                    ALS     3
         1 004251   000000 471400 xsym               LDP1    FM$SET$
         1 004252   100005 720105                    LXL0    5,AL,PR1
         1 004253   004300 601000 1                  TNZ     s:5387
         1 004254   000006 235100                    LDA     6,,PR0
         1 004255   000003 735000                    ALS     3
         1 004256   100006 236105                    LDQ     6,AL,PR1
         1 004257   004300 604000 1                  TMI     s:5387
         1 004260   200011 116100                    CMPQ    DCTX,,AUTO
         1 004261   004300 601000 1                  TNZ     s:5387

     1270     5378    4                    OR FM$DEV.SECTL(DEV.MRRDCTX)>0
     1271     5379    4                    OR FM$DEV.MRRDCTX(DEV.MRRDCTX)~=DCTX
     1272     5380    4                  THEN EXIT; /* make the secondary REQUable when primary goes */
     1273     5381    4                  FM$DEV.MRRDCTX(DEV.MRRDCTX)=0;

   5381  1 004262   000006 235100                    LDA     6,,PR0
         1 004263   000003 735000                    ALS     3
         1 004264   100006 450105                    STZ     6,AL,PR1

     1274     5382    4                  N$DCT$(DEV.MRRDCTX)->NI$DCT.DP.MIRROR.STATE=%NI_MIRROR_WAIT;

   5382  1 004265   000006 720100                    LXL0    6,,PR0
         1 004266   000000 471400 xsym               LDP1    N$DCT$$
         1 004267   100000 473510                    LDP3    0,X0,PR1
         1 004270   000300 236003                    LDQ     192,DU
         1 004271   300036 752120                    STCQ    30,'20'O,PR3

     1275     5383    4                  N$DCT$(DEV.MRRDCTX)->NI$DCT.RAT$->FR$RAT.FLG.MBIT.MTD='0'B;

   5383  1 004272   000006 720100                    LXL0    6,,PR0
         1 004273   100000 473510                    LDP3    0,X0,PR1
         1 004274   300005 474500                    LDP4    5,,PR3
         1 004275   000042 236000 2                  LDQ     34
         1 004276   400010 356100                    ANSQ    8,,PR4

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:246  
     1276     5384    4                  DEV.MRRDCTX=0;

   5384  1 004277   000006 450100                    STZ     6,,PR0

     1277     5385    4                  END;

     1278     5386    3               END;

     1279     5387    2            DEV.SYSID=0;

   5387  1 004300   000000 220003                    LDX0    0,DU
         1 004301   200012 470500                    LDP0    SET$,,AUTO
         1 004302   000002 440100                    SXL0    2,,PR0

     1280     5388    2            DEV.ONEU='0'B;

   5388  1 004303   000017 236000 2                  LDQ     15
         1 004304   000002 356100                    ANSQ    2,,PR0

     1281     5389    2            CALL FMD$RELBUF(2);

   5389  1 004305   000024 630400 2                  EPPR0   20
         1 004306   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004307   000000 701000 xent               TSX1    FMD$RELBUF
         1 004310   000000 011000                    NOP     0

     1282     5390    2            END;

   5390  1 004311   004721 710000 1                  TRA     s:5470

     1283     5391        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:247  
     1284     5392    2         ELSE DO; /* NOT A DEVIXEW, DSO SET STUFF */

     1285     5393    3            IF FLAG.SHARE AND FM$SET.XCL AND B$JIT.SYSID<=JG_PIG# THEN DO;

   5393  1 004312   200007 234100                    SZN     BUF$,,AUTO
         1 004313   004456 605000 1                  TPL     s:5430
         1 004314   000002 234100                    SZN     2,,PR0
         1 004315   004456 605000 1                  TPL     s:5430
         1 004316   000000 474400 xsym               LDP4    B$JIT$
         1 004317   400000 721100                    LXL1    0,,PR4
         1 004320   000010 101003                    CMPX1   8,DU
         1 004321   004456 603000 1                  TRC     s:5430

     1286     5394                    /*SHARE ONLY FROM PIG OR SLUG, AND ONLY ONCE IS SUFFICIENT*/
     1287     5395    3               CFU$=JDCB$; /* ALSO, A DUAL CANNOT BE MOUNTED SHARED */

   5395  1 004322   200010 236100                    LDQ     JDCB$,,AUTO
         1 004323   200006 756100                    STQ     CFU$,,AUTO

     1288     5396    3               JDCB$=DCBADDR(1);

   5396  1 004324   000046 475400 2                  LDP5    38
         1 004325   500000 476500                    LDP6    0,,PR5
         1 004326   600001 236100                    LDQ     1,,PR6
         1 004327   200010 756100                    STQ     JDCB$,,AUTO

     1289     5397    3               B$JIT.DCB$=JDCB$;

   5397  1 004330   400232 756100                    STQ     154,,PR4

     1290     5398    3               CALL FMM$SCRUB (B$JIT.DCB$);

   5398  1 004331   000000 236000 xsym               LDQ     B$JIT$
         1 004332   000232 036003                    ADLQ    154,DU
         1 004333   200026 756100                    STQ     UN+3,,AUTO
         1 004334   200026 630500                    EPPR0   UN+3,,AUTO
         1 004335   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:248  
         1 004336   000000 701000 xent               TSX1    FMM$SCRUB
         1 004337   000000 011000                    NOP     0

     1291     5399    3               F$DCB.PSN=FM$SET.PSN;

   5399  1 004340   200012 470500                    LDP0    SET$,,AUTO
         1 004341   200010 471500                    LDP1    JDCB$,,AUTO
         1 004342   040100 100500                    MLR     fill='040'O
         1 004343   000000 400006                    ADSC9   0,,PR0                   cn=2,n=6
         1 004344   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6

     1292     5400    3               F$DCB.ACCT='$$EFT';

   5400  1 004345   040100 100400                    MLR     fill='040'O
         1 004346   000024 000005 0                  ADSC9   FMN$E$ACGRANS+12         cn=0,n=5
         1 004347   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8

     1293     5401    3               F$DCB.NAME=DUALNAME;

   5401  1 004350   000100 100400                    MLR     fill='000'O
         1 004351   000000 000006 0                  ADSC9   DUALNAME                 cn=0,n=6
         1 004352   100010 000040                    ADSC9   8,,PR1                   cn=0,n=32

     1294     5402    3               F$DCB.ASN=%FILE#;

   5402  1 004353   001000 236007                    LDQ     512,DL
         1 004354   100032 552110                    STBQ    26,'10'O,PR1

     1295     5403    3               CALL FMM$DFLOPNP;

   5403  1 004355   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004356   000000 701000 xent               TSX1    FMM$DFLOPNP
         1 004357   000000 011000                    NOP     0

     1296     5404    3               CALL FMP$CLSTAR;

   5404  1 004360   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:249  
         1 004361   000000 701000 xent               TSX1    FMP$CLSTAR
         1 004362   000000 011000                    NOP     0

     1297     5405    3               B$JIT.DCB$=CFU$;

   5405  1 004363   200006 236100                    LDQ     CFU$,,AUTO
         1 004364   000000 470400 xsym               LDP0    B$JIT$
         1 004365   000232 756100                    STQ     154,,PR0

     1298     5406    3               JDCB$=CFU$;

   5406  1 004366   200010 756100                    STQ     JDCB$,,AUTO

     1299     5407    4               IF B$JIT.ERR='0'B THEN DO;

   5407  1 004367   000012 235100                    LDA     10,,PR0
         1 004370   004402 601000 1                  TNZ     s:5418

     1300     5408    4                  B$JIT.ERR=FMN$E$DUPSN;

   5408  1 004371   000004 236000 0                  LDQ     FMN$E$DUPSN
         1 004372   000012 756100                    STQ     10,,PR0

     1301     5409                    /*E*     ERROR: FMN-E$DUPSN-c
     1302     5410                    *        MESSAGE: Exclusive mode only if :DUAL.$$EFT exists.
     1303     5411                    *       MESSAGE1:The :DUAL.$$EFT file must not exist if a packset is to
     1304     5412                    *        be used in a shared mode (SHARED or PUBLIC).
     1305     5413                    */
     1306     5414    4                  FM$SET.DUAL='1'B;

   5414  1 004373   200012 471500                    LDP1    SET$,,AUTO
         1 004374   010000 236003                    LDQ     4096,DU
         1 004375   100002 256100                    ORSQ    2,,PR1

     1307     5415    4                  CALL FMR$L8;

   5415  1 004376   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:250  
         1 004377   000000 701000 xent               TSX1    FMR$L8
         1 004400   000000 011000                    NOP     0

     1308     5416    4                  GOTO FINDOTHER;

   5416  1 004401   002142 710000 1                  TRA     FINDOTHER

     1309     5417    4                  END;
     1310     5418    3               F$DCB.GTYP=FMGTPAD;

   5418  1 004402   200010 471500                    LDP1    JDCB$,,AUTO
         1 004403   100064 236100                    LDQ     52,,PR1
         1 004404   000001 376000 2                  ANQ     1
         1 004405   014000 276003                    ORQ     6144,DU
         1 004406   100064 756100                    STQ     52,,PR1

     1311     5419    3               CALL FMD$REDBUF (XT$,1,FM_PADSDA,,0) ALTRET(NOMNTIME);

   5419  1 004407   000002 236000 2                  LDQ     2
         1 004410   200032 756100                    STQ     UN+7,,AUTO
         1 004411   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004412   000003 235000 2                  LDA     3
         1 004413   200030 757100                    STAQ    UN+5,,AUTO
         1 004414   000004 236000 2                  LDQ     4
         1 004415   200020 235100                    LDA     T$$,,AUTO
         1 004416   200026 757100                    STAQ    UN+3,,AUTO
         1 004417   200026 630500                    EPPR0   UN+3,,AUTO
         1 004420   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 004421   000000 701000 xent               TSX1    FMD$REDBUF
         1 004422   004451 702000 1                  TSX2    NOMNTIME

     1312     5420    3               T$=PINCRW(T$,SIZEW(FM$GRAN));

   5420  1 004423   200017 236100                    LDQ     T$,,AUTO
         1 004424   000005 036003                    ADLQ    5,DU
         1 004425   200017 756100                    STQ     T$,,AUTO

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:251  
     1313     5421    3               CALL FMO$LOCCODP (XT$,4) ALTRET(NOMNTIME);

   5421  1 004426   000016 236000 2                  LDQ     14
         1 004427   200020 235100                    LDA     T$$,,AUTO
         1 004430   200026 757100                    STAQ    UN+3,,AUTO
         1 004431   200026 630500                    EPPR0   UN+3,,AUTO
         1 004432   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004433   000000 701000 xent               TSX1    FMO$LOCCODP
         1 004434   004451 702000 1                  TSX2    NOMNTIME

     1314     5422    4               IF T$->CODE04.ACCESS<=T$->CODE04.SVMODIFY THEN DO;

   5422  1 004435   200017 470500                    LDP0    T$,,AUTO
         1 004436   000010 236100                    LDQ     8,,PR0
         1 004437   000000 116100                    CMPQ    0,,PR0
         1 004440   004451 602000 1                  TNC     NOMNTIME

     1315     5423    4                  CALL SSS$SYSTIME (T$->CODE04.ACCESS);

   5423  1 004441   200017 630500                    EPPR0   T$,,AUTO
         1 004442   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004443   000000 701000 xent               TSX1    SSS$SYSTIME
         1 004444   000000 011000                    NOP     0

     1316     5424    4                  CALL FMD$WRTBUF(1);

   5424  1 004445   000004 630400 2                  EPPR0   4
         1 004446   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004447   000000 701000 xent               TSX1    FMD$WRTBUF
         1 004450   000000 011000                    NOP     0

     1317     5425    4                  END;

   5422  1 004451                       NOMNTIME     null
     1318     5426    3   NOMNTIME:   ;
     1319     5427    3               B$JIT.ERR='0'B;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:252  
   5427  1 004451   000000 470400 xsym               LDP0    B$JIT$
         1 004452   000012 450100                    STZ     10,,PR0

     1320     5428    3               FM$SET.XCL='0'B;

   5428  1 004453   200012 471500                    LDP1    SET$,,AUTO
         1 004454   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 004455   100002 356100                    ANSQ    2,,PR1

     1321     5429    3               END;

     1322     5430    2            IF FM$SET.PSN='SYS' THEN FM_SYSSETX=F$DCB.SETX;

   5430  1 004456   200012 470500                    LDP0    SET$,,AUTO
         1 004457   040000 106500                    CMPC    fill='040'O
         1 004460   000000 400006                    ADSC9   0,,PR0                   cn=2,n=6
         1 004461   000026 000003 0                  ADSC9   FMN$E$ACGRANS+14         cn=0,n=3
         1 004462   004467 601000 1                  TNZ     s:5431

   5430  1 004463   200010 471500                    LDP1    JDCB$,,AUTO
         1 004464   100051 236100                    LDQ     41,,PR1
         1 004465   777777 376007                    ANQ     -1,DL
         1 004466   000000 756000 xsym               STQ     FM_SYSSETX

     1323     5431    2            IF FLAG.MAD THEN IF B$JIT.PRIV.AUTH&%PR_FMDIAG# THEN CALL FMQ$BLDMAD;

   5431  1 004467   200007 236100                    LDQ     BUF$,,AUTO
         1 004470   200000 316003                    CANQ    65536,DU
         1 004471   004502 600000 1                  TZE     s:5433

   5431  1 004472   000000 471400 xsym               LDP1    B$JIT$
         1 004473   100014 236100                    LDQ     12,,PR1
         1 004474   000012 376000 0                  ANQ     FMN$E$ACGRANS+2
         1 004475   001374 600000 1                  TZE     FMNE$NOTAUTH

   5431  1 004476   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004477   000000 701000 xent               TSX1    FMQ$BLDMAD
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:253  
         1 004500   000000 011000                    NOP     0
         1 004501   004502 710000 1                  TRA     s:5433

     1324     5432    2               ELSE GOTO FMNE$NOTAUTH;
     1325     5433    2            CALL FMR$L8;

   5433  1 004502   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004503   000000 701000 xent               TSX1    FMR$L8
         1 004504   000000 011000                    NOP     0

     1326     5434    2            FM$SET.NONEWU=FLAG.DSMT;

   5434  1 004505   200012 470500                    LDP0    SET$,,AUTO
         1 004506   200007 236100                    LDQ     BUF$,,AUTO
         1 004507   000002 676100                    ERQ     2,,PR0
         1 004510   040000 376003                    ANQ     16384,DU
         1 004511   000002 656100                    ERSQ    2,,PR0

     1327     5435    2            FM$SET.DSMTF=FLAG.DSMTF;

   5435  1 004512   200007 236100                    LDQ     BUF$,,AUTO
         1 004513   000002 676100                    ERQ     2,,PR0
         1 004514   020000 376003                    ANQ     8192,DU
         1 004515   000002 656100                    ERSQ    2,,PR0

     1328     5436    2            IF (FLAG.DSMT OR FLAG.REL AND FM$SET.DIAGOPN)

   5436  1 004516   200007 236100                    LDQ     BUF$,,AUTO
         1 004517   040000 316003                    CANQ    16384,DU
         1 004520   004526 601000 1                  TNZ     s:5436+8
         1 004521   100000 316003                    CANQ    32768,DU
         1 004522   004630 600000 1                  TZE     s:5453
         1 004523   000002 236100                    LDQ     2,,PR0
         1 004524   004000 316003                    CANQ    2048,DU
         1 004525   004630 600000 1                  TZE     s:5453
         1 004526   000002 236100                    LDQ     2,,PR0
         1 004527   000001 316003                    CANQ    1,DU
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:254  
         1 004530   004630 600000 1                  TZE     s:5453

     1329     5437    3              AND FM$SET.ONEU THEN DO;

     1330     5438    3               FM$SET.XCL='1'B;

   5438  1 004531   400000 236003                    LDQ     -131072,DU
         1 004532   000002 256100                    ORSQ    2,,PR0

     1331     5439    3               CALL FMR$U8;

   5439  1 004533   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004534   000000 701000 xent               TSX1    FMR$U8
         1 004535   000000 011000                    NOP     0

     1332     5440    3   RELSET:     IF FM$SET.PSN~='CP-6''S' THEN CALL FMS$RELACCT(I)ALTRET(RETALT);

   5440  1 004536   200012 470500       RELSET       LDP0    SET$,,AUTO
         1 004537   040000 106500                    CMPC    fill='040'O
         1 004540   000000 400006                    ADSC9   0,,PR0                   cn=2,n=6
         1 004541   000027 000006 0                  ADSC9   FMN$E$ACGRANS+15         cn=0,n=6
         1 004542   004551 600000 1                  TZE     s:5441

   5440  1 004543   200013 631500                    EPPR1   I,,AUTO
         1 004544   200026 451500                    STP1    UN+3,,AUTO
         1 004545   200026 630500                    EPPR0   UN+3,,AUTO
         1 004546   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004547   000000 701000 xent               TSX1    FMS$RELACCT
         1 004550   001432 702000 1                  TSX2    RETALT

     1333     5441    3               CALL FMP$UDLIST(FM$SET);

   5441  1 004551   200012 630500                    EPPR0   SET$,,AUTO
         1 004552   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004553   000000 701000 xent               TSX1    FMP$UDLIST
         1 004554   000000 011000                    NOP     0

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:255  
     1334     5442    3               DCTX=FM$SET.DCTX;

   5442  1 004555   200012 470500                    LDP0    SET$,,AUTO
         1 004556   000000 236100                    LDQ     0,,PR0
         1 004557   000022 772000                    QRL     18
         1 004560   200011 756100                    STQ     DCTX,,AUTO

     1335     5443    3               FM$SET.SET='0'B;

   5443  1 004561   000047 236000 2                  LDQ     39
         1 004562   000002 356100                    ANSQ    2,,PR0

     1336     5444    4               DO WHILE (DCTX~=0);

   5444  1 004563   200011 235100                    LDA     DCTX,,AUTO
         1 004564   004624 600000 1                  TZE     s:5450

     1337     5445    4                  I=B$JIT.MODE;

   5445  1 004565   000000 470400 xsym               LDP0    B$JIT$
         1 004566   000000 236100                    LDQ     0,,PR0
         1 004567   000040 772000                    QRL     32
         1 004570   200013 756100                    STQ     I,,AUTO

     1338     5446    4                  CFU$=N$DCT$(FM$VOL.DCTX(DCTX))->NI$DCT.RAT$;

   5446  1 004571   200011 235100                    LDA     DCTX,,AUTO
         1 004572   000003 735000                    ALS     3
         1 004573   000000 471400 xsym               LDP1    FM$SET$
         1 004574   100000 220105                    LDX0    0,AL,PR1
         1 004575   000000 473400 xsym               LDP3    N$DCT$$
         1 004576   300000 474510                    LDP4    0,X0,PR3
         1 004577   400005 236100                    LDQ     5,,PR4
         1 004600   200006 756100                    STQ     CFU$,,AUTO

     1339     5447    4                  IF FR$RAT.RES.RFLG.OLT THEN CALL FRZ$RRESNA(FR$RAT,I);

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:256  
   5447  1 004601   200006 475500                    LDP5    CFU$,,AUTO
         1 004602   500003 236100                    LDQ     3,,PR5
         1 004603   020000 316003                    CANQ    8192,DU
         1 004604   004615 600000 1                  TZE     NOREL

   5447  1 004605   200013 636500                    EPPR6   I,,AUTO
         1 004606   200027 456500                    STP6    UN+4,,AUTO
         1 004607   200006 236100                    LDQ     CFU$,,AUTO
         1 004610   200026 756100                    STQ     UN+3,,AUTO
         1 004611   200026 630500                    EPPR0   UN+3,,AUTO
         1 004612   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004613   000000 701000 xent               TSX1    FRZ$RRESNA
         1 004614   000000 011000                    NOP     0

     1340     5448    4   NOREL:         DCTX=FM$VOL.VOLL(DCTX);

   5448  1 004615   200011 235100       NOREL        LDA     DCTX,,AUTO
         1 004616   000003 735000                    ALS     3
         1 004617   000000 470400 xsym               LDP0    FM$SET$
         1 004620   000005 236105                    LDQ     5,AL,PR0
         1 004621   000022 772000                    QRL     18
         1 004622   200011 756100                    STQ     DCTX,,AUTO

     1341     5449    4                  END;

   5449  1 004623   004565 601000 1                  TNZ     s:5445

     1342     5450    3               F$DCB.SETX=0;

   5450  1 004624   000000 220003                    LDX0    0,DU
         1 004625   200010 470500                    LDP0    JDCB$,,AUTO
         1 004626   000051 440100                    SXL0    41,,PR0

     1343     5451    3               RETURN;

   5451  1 004627   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:257  
     1344     5452    3               END;
     1345     5453    3            IF FLAG.DSMTF OR FLAG.DSMTX THEN DO;

   5453  1 004630   200007 236100                    LDQ     BUF$,,AUTO
         1 004631   020000 316003                    CANQ    8192,DU
         1 004632   004635 601000 1                  TNZ     s:5454
         1 004633   010000 316003                    CANQ    4096,DU
         1 004634   004716 600000 1                  TZE     s:5468

     1346     5454    3               I=FM$SET.USERLIST;

   5454  1 004635   000002 236100                    LDQ     2,,PR0
         1 004636   777777 376007                    ANQ     -1,DL
         1 004637   200013 756100                    STQ     I,,AUTO

     1347     5455    4               IF NOT FM$SET.ONEU THEN DO WHILE (I~=0);

   5455  1 004640   000002 236100                    LDQ     2,,PR0
         1 004641   000001 316003                    CANQ    1,DU
         1 004642   004701 601000 1                  TNZ     s:5463

   5455  1 004643   200013 235100                    LDA     I,,AUTO
         1 004644   004703 600000 1                  TZE     s:5464

     1348     5456    4                  CFU$=PINCRW(F$CFU$,I);

   5456  1 004645   200013 236100                    LDQ     I,,AUTO
         1 004646   000022 736000                    QLS     18
         1 004647   000000 036000 xsym               ADLQ    F$CFU$
         1 004650   200006 756100                    STQ     CFU$,,AUTO

     1349     5457    5                  DO I=0 TO FM$SETU.NUM-1;

   5457  1 004651   200013 450100                    STZ     I,,AUTO
         1 004652   004666 710000 1                  TRA     s:5460+3

     1350     5458    5                     DCTX=FM$SETU.SYSID(I);
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:258  

   5458  1 004653   200013 235100                    LDA     I,,AUTO
         1 004654   000001 735000                    ALS     1
         1 004655   200006 470500                    LDP0    CFU$,,AUTO
         1 004656   000100 101505                    MRL     fill='000'O
         1 004657   000001 000002                    ADSC9   1,A,PR0                  cn=0,n=2
         1 004660   200011 000004                    ADSC9   DCTX,,AUTO               cn=0,n=4

     1351     5459    5                     CALL XUSER;

   5459  1 004661   004732 701000 1                  TSX1    XUSER
         1 004662   000000 011000                    NOP     0

     1352     5460    5                     END;

   5460  1 004663   200013 235100                    LDA     I,,AUTO
         1 004664   000001 035007                    ADLA    1,DL
         1 004665   200013 755100                    STA     I,,AUTO
         1 004666   200006 470500                    LDP0    CFU$,,AUTO
         1 004667   000000 236100                    LDQ     0,,PR0
         1 004670   000022 772000                    QRL     18
         1 004671   200013 116100                    CMPQ    I,,AUTO
         1 004672   004674 600000 1                  TZE     s:5461
         1 004673   004653 603000 1                  TRC     s:5458

     1353     5461    4                  I=FM$SETU.LINKX;

   5461  1 004674   000000 236100                    LDQ     0,,PR0
         1 004675   777777 376007                    ANQ     -1,DL
         1 004676   200013 756100                    STQ     I,,AUTO

     1354     5462    4                  END;

   5462  1 004677   004645 601000 1                  TNZ     s:5456
         1 004700   004703 710000 1                  TRA     s:5464

     1355     5463    3               ELSE FM$SET.XCL='1'B;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:259  

   5463  1 004701   400000 236003                    LDQ     -131072,DU
         1 004702   000002 256100                    ORSQ    2,,PR0

     1356     5464    3               CALL FMR$U8;

   5464  1 004703   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004704   000000 701000 xent               TSX1    FMR$U8
         1 004705   000000 011000                    NOP     0

     1357     5465    3               I=F$DCB.SETX;

   5465  1 004706   200010 470500                    LDP0    JDCB$,,AUTO
         1 004707   000051 236100                    LDQ     41,,PR0
         1 004710   777777 376007                    ANQ     -1,DL
         1 004711   200013 756100                    STQ     I,,AUTO

     1358     5466    3               IF FM$SET.XCL THEN GOTO RELSET;

   5466  1 004712   200012 471500                    LDP1    SET$,,AUTO
         1 004713   100002 234100                    SZN     2,,PR1
         1 004714   004536 604000 1                  TMI     RELSET

     1359     5467    3               END;

   5467  1 004715   004721 710000 1                  TRA     s:5470

     1360     5468    2            ELSE CALL FMR$U8;

   5468  1 004716   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 004717   000000 701000 xent               TSX1    FMR$U8
         1 004720   000000 011000                    NOP     0

     1361     5469    2            END;

     1362     5470    1      CALL FMD$RELBUF(0);

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:260  
   5470  1 004721   000002 630400 2                  EPPR0   2
         1 004722   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004723   000000 701000 xent               TSX1    FMD$RELBUF
         1 004724   000000 011000                    NOP     0

     1363     5471    1      CALL FMD$RELBUF(1);

   5471  1 004725   000004 630400 2                  EPPR0   4
         1 004726   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 004727   000000 701000 xent               TSX1    FMD$RELBUF
         1 004730   000000 011000                    NOP     0

     1364     5472    1      RETURN;

   5472  1 004731   000000 702200 xent               TSX2  ! X66_ARET

     1365     5473        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:261  
     1366     5474    1   XUSER: PROC ALTRET;

   5474  1 004732   200022 741300       XUSER        STX1  ! T$$+2,,AUTO

     1367     5475                    /*D*    NAME: XUSER
     1368     5476                             FUNCTION: ABORT OR DE-SET THE USER WHOSE SYSID IS IN DCTX
     1369     5477                             IF DSMTX, ABORT IF STATE ISNT NULL.
     1370     5478                             IF DSMTF, DE-SET IF USER IS AT JOBSTEP.
     1371     5479                    */
     1372     5480    2   DCL 1 UN,
     1373     5481    2         2 * BIT(27),
     1374     5482    2         2 UN UBIN(9)UNAL;
     1375     5483    2      CALL OCZ$SID_UN(DCTX1.SYSID,UN)ALTRET(UNSET);

   5483  1 004733   200023 630500                    EPPR0   UN,,AUTO
         1 004734   200027 450500                    STP0    UN+4,,AUTO
         1 004735   200030 452500                    STP2    UN+5,,AUTO
         1 004736   200030 236100                    LDQ     UN+5,,AUTO
         1 004737   000050 036000 2                  ADLQ    40
         1 004740   200026 756100                    STQ     UN+3,,AUTO
         1 004741   200026 630500                    EPPR0   UN+3,,AUTO
         1 004742   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004743   000000 701000 xent               TSX1    OCZ$SID_UN
         1 004744   005045 702000 1                  TSX2    UNSET

     1376     5484    2      IF UN.UN=S_CUN THEN RETURN;

   5484  1 004745   200023 236100                    LDQ     UN,,AUTO
         1 004746   000777 376007                    ANQ     511,DL
         1 004747   000000 116000 xsym               CMPQ    S_CUN
         1 004750   004753 601000 1                  TNZ     s:5485

   5484  1 004751   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 004752   000001 702211                    TSX2  ! 1,X1

     1377     5485    3      IF UN.UN <= JG_MING# THEN DO;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:262  
   5485  1 004753   000020 116007                    CMPQ    16,DL
         1 004754   005012 603000 1                  TRC     s:5493

     1378     5486    3         AVRM.PSN=FM$SET.PSN;

   5486  1 004755   200012 470500                    LDP0    SET$,,AUTO
         1 004756   040100 100500                    MLR     fill='040'O
         1 004757   000000 400006                    ADSC9   0,,PR0                   cn=2,n=6
         1 004760   200015 000006                    ADSC9   AVRM+1,,AUTO             cn=0,n=6

     1379     5487    3         AVRM.SETX=F$DCB.SETX;

   5487  1 004761   200010 471500                    LDP1    JDCB$,,AUTO
         1 004762   100051 720100                    LXL0    41,,PR1
         1 004763   200016 440100                    SXL0    AVRM+2,,AUTO

     1380     5488    3         AVRM.WORDS=2;

   5488  1 004764   000002 235007                    LDA     2,DL
         1 004765   200014 755100                    STA     AVRM,,AUTO

     1381     5489    3         CALL SSV$EVENT(UN.UN,7,JG_SETDSMT#,JG_SETDSMT#,0,

   5489  1 004766   200014 633500                    EPPR3   AVRM,,AUTO
         1 004767   200026 453500                    STP3    UN+3,,AUTO
         1 004770   000002 236000 2                  LDQ     2
         1 004771   200035 756100                    STQ     UN+10,,AUTO
         1 004772   200026 634500                    EPPR4   UN+3,,AUTO
         1 004773   200034 454500                    STP4    UN+9,,AUTO
         1 004774   000052 237000 2                  LDAQ    42
         1 004775   200032 757100                    STAQ    UN+7,,AUTO
         1 004776   000054 237000 2                  LDAQ    44
         1 004777   200030 757100                    STAQ    UN+5,,AUTO
         1 005000   200036 452500                    STP2    UN+11,,AUTO
         1 005001   200036 236100                    LDQ     UN+11,,AUTO
         1 005002   000051 036000 2                  ADLQ    41
         1 005003   200027 756100                    STQ     UN+4,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:263  
         1 005004   200027 630500                    EPPR0   UN+4,,AUTO
         1 005005   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 005006   000000 701000 xent               TSX1    SSV$EVENT
         1 005007   000000 011000                    NOP     0

     1382     5490    3           ADDR(AVRM),ENTADDR(NIL));
     1383     5491    3         RETURN;

   5491  1 005010   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005011   000001 702211                    TSX2  ! 1,X1

     1384     5492    3         END;
     1385     5493    2      IF FLAG.DSMTX THEN CALL SSR$RUE(%SS_ABRT,UN.UN);

   5493  1 005012   200007 236100                    LDQ     BUF$,,AUTO
         1 005013   010000 316003                    CANQ    4096,DU
         1 005014   005027 600000 1                  TZE     s:5494

   5493  1 005015   200030 452500                    STP2    UN+5,,AUTO
         1 005016   200030 236100                    LDQ     UN+5,,AUTO
         1 005017   000051 036000 2                  ADLQ    41
         1 005020   000057 235000 2                  LDA     47
         1 005021   200026 757100                    STAQ    UN+3,,AUTO
         1 005022   200026 630500                    EPPR0   UN+3,,AUTO
         1 005023   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005024   000000 701000 xent               TSX1    SSR$RUE
         1 005025   000000 011000                    NOP     0
         1 005026   005060 710000 1                  TRA     s:5499

     1386     5494    2      ELSE IF B$USRT$->B$USER.FLG(UN.UN)&%U_STEP

   5494  1 005027   200023 236100                    LDQ     UN,,AUTO
         1 005030   000004 736000                    QLS     4
         1 005031   017760 376007                    ANQ     8176,DL
         1 005032   000000 470400 xsym               LDP0    B$USRT$
         1 005033   000000 236106                    LDQ     0,QL,PR0
         1 005034   000031 376000 0                  ANQ     FMN$E$ACGRANS+17
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:264  
         1 005035   005060 600000 1                  TZE     s:5499
         1 005036   200023 236100                    LDQ     UN,,AUTO
         1 005037   000004 736000                    QLS     4
         1 005040   017760 376007                    ANQ     8176,DL
         1 005041   000011 236106                    LDQ     9,QL,PR0
         1 005042   007700 376007                    ANQ     4032,DL
         1 005043   000300 116007                    CMPQ    192,DL
         1 005044   005060 601000 1                  TNZ     s:5499

     1387     5495    3           AND B$USRT$->B$USER.MODE(UN.UN)=%M_INT# THEN DO;

     1388     5496    3   UNSET:   CALL FMP$UDLIST(FM$SET,DCTX);

   5496  1 005045   200011 630500       UNSET        EPPR0   DCTX,,AUTO
         1 005046   200027 450500                    STP0    UN+4,,AUTO
         1 005047   200012 236100                    LDQ     SET$,,AUTO
         1 005050   200026 756100                    STQ     UN+3,,AUTO
         1 005051   200026 630500                    EPPR0   UN+3,,AUTO
         1 005052   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005053   000000 701000 xent               TSX1    FMP$UDLIST
         1 005054   000000 011000                    NOP     0

     1389     5497    3            I=I-1;

   5497  1 005055   200013 235100                    LDA     I,,AUTO
         1 005056   000001 135007                    SBLA    1,DL
         1 005057   200013 755100                    STA     I,,AUTO

     1390     5498    3            END;

     1391     5499    2      RETURN;

   5499  1 005060   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005061   000001 702211                    TSX2  ! 1,X1

     1392     5500        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:265  
     1393     5501    2   CHKSUM: ENTRY ALTRET;

   5501  1 005062   200022 741300       CHKSUM       STX1  ! T$$+2,,AUTO

     1394     5502    2      CALL CHKSM;

   5502  1 005063   005240 701000 1                  TSX1    CHKSM
         1 005064   000000 011000                    NOP     0

     1395     5503    2      RETURN;

   5503  1 005065   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005066   000001 702211                    TSX2  ! 1,X1

     1396     5504                    /**/
     1397     5505        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:266  
     1398     5506    2   SAMESET: ENTRY ALTRET;

   5506  1 005067   200022 741300       SAMESET      STX1  ! T$$+2,,AUTO

     1399     5507                    /*D*     NAME: SAMESET
     1400     5508                        FUNCTION: DETERMINE IF VID AT BUF$ CORRESPONDS TO FM$SET(I)
     1401     5509                        IF YES, THEN ALTRETURNS.
     1402     5510                    */
     1403     5511    2      IF I=0 AND VID.VOLCNT=0

   5511  1 005070   200013 235100                    LDA     I,,AUTO
         1 005071   005113 601000 1                  TNZ     s:5514
         1 005072   200007 470500                    LDP0    BUF$,,AUTO
         1 005073   000004 720100                    LXL0    4,,PR0
         1 005074   005113 601000 1                  TNZ     s:5514

     1404     5512    2      THEN IF VID.VSN=VOL.VSN OR VOL.SYSID~=0 AND F$DCB.PSN=' ' THEN ALTRETURN;

   5512  1 005075   200012 471500                    LDP1    SET$,,AUTO
         1 005076   100001 236100                    LDQ     1,,PR1
         1 005077   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 005100   000002 116100                    CMPQ    2,,PR0
         1 005101   005111 600000 1                  TZE     s:5512+12
         1 005102   100002 722100                    LXL2    2,,PR1
         1 005103   005112 600000 1                  TZE     s:5513
         1 005104   200010 473500                    LDP3    JDCB$,,AUTO
         1 005105   040000 106500                    CMPC    fill='040'O
         1 005106   300024 000006                    ADSC9   20,,PR3                  cn=0,n=6
         1 005107   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 005110   005112 601000 1                  TNZ     s:5513

   5512  1 005111   000000 702211                    TSX2  ! 0,X1

     1405     5513    2         ELSE RETURN;

   5513  1 005112   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:267  
     1406     5514    2      IF VID.VOLCNT=0

   5514  1 005113   200007 470500                    LDP0    BUF$,,AUTO
         1 005114   000004 720100                    LXL0    4,,PR0
         1 005115   005130 600000 1                  TZE     s:5516
         1 005116   000005 735000                    ALS     5
         1 005117   000000 471400 xsym               LDP1    FM$SET$
         1 005120   040100 106505                    CMPC    fill='040'O
         1 005121   100005 400006                    ADSC9   5,A,PR1                  cn=2,n=6
         1 005122   000003 000006                    ADSC9   3,,PR0                   cn=0,n=6
         1 005123   005131 600000 1                  TZE     s:5517
         1 005124   040100 106505                    CMPC    fill='040'O
         1 005125   100000 400006                    ADSC9   0,A,PR1                  cn=2,n=6
         1 005126   000003 000006                    ADSC9   3,,PR0                   cn=0,n=6
         1 005127   005131 600000 1                  TZE     s:5517

     1407     5515    2        OR FMX$SET.REALPSN(I)~=VID.PSN
     1408     5516    2        AND FMX$SET.PSN(I)~=VID.PSN THEN RETURN;

   5516  1 005130   000001 702211                    TSX2  ! 1,X1

     1409     5517    2      CALL CHKSM;

   5517  1 005131   005240 701000 1                  TSX1    CHKSM
         1 005132   000000 011000                    NOP     0

     1410     5518    2      IF ACCTX~=FMX$SET.CHKSM(I) THEN RETURN;

   5518  1 005133   200013 235100                    LDA     I,,AUTO
         1 005134   000003 735000                    ALS     3
         1 005135   000000 470400 xsym               LDP0    FM$SET$
         1 005136   200004 236100                    LDQ     ACCT$,,AUTO
         1 005137   005142 604000 1                  TMI     s:5518+7
         1 005140   000007 116105                    CMPQ    7,AL,PR0
         1 005141   005144 600000 1                  TZE     s:5519

   5518  1 005142   200022 221300                    LDX1  ! T$$+2,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:268  
         1 005143   000001 702211                    TSX2  ! 1,X1

     1411     5519    2      DCTX=FMX$SET.DCTX(I);

   5519  1 005144   000000 236105                    LDQ     0,AL,PR0
         1 005145   000022 772000                    QRL     18
         1 005146   200011 756100                    STQ     DCTX,,AUTO

     1412     5520    3      DO WHILE '1'B;

     1413     5521    3         IF DCTX=0 THEN ALTRETURN;

   5521  1 005147   200011 235100                    LDA     DCTX,,AUTO
         1 005150   005153 601000 1                  TNZ     s:5522

   5521  1 005151   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005152   000000 702211                    TSX2  ! 0,X1

     1414     5522    3         IF FM$VOL.SPIN(DCTX) AND F$DCB.SETX~=DCTX THEN EXIT;

   5522  1 005153   000003 735000                    ALS     3
         1 005154   000000 470400 xsym               LDP0    FM$SET$
         1 005155   000002 236105                    LDQ     2,AL,PR0
         1 005156   004000 316003                    CANQ    2048,DU
         1 005157   005165 600000 1                  TZE     s:5523
         1 005160   200010 471500                    LDP1    JDCB$,,AUTO
         1 005161   100051 236100                    LDQ     41,,PR1
         1 005162   777777 376007                    ANQ     -1,DL
         1 005163   200011 116100                    CMPQ    DCTX,,AUTO
         1 005164   005171 601000 1                  TNZ     s:5525

     1415     5523    3         DCTX=FM$VOL.VOLL(DCTX);

   5523  1 005165   000005 236105                    LDQ     5,AL,PR0
         1 005166   000022 772000                    QRL     18
         1 005167   200011 756100                    STQ     DCTX,,AUTO

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:269  
     1416     5524    3         END;

   5524  1 005170   005147 710000 1                  TRA     s:5521

     1417     5525    2      CALL READVID;

   5525  1 005171   005312 701000 1                  TSX1    READVID
         1 005172   000000 011000                    NOP     0

     1418     5526    2      IF DCT$->VID.ID~='CP6' THEN ALTRETURN;

   5526  1 005173   200005 470500                    LDP0    DCT$,,AUTO
         1 005174   040000 106500                    CMPC    fill='040'O
         1 005175   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 005176   000014 000003 0                  ADSC9   FMN$E$ACGRANS+4          cn=0,n=3
         1 005177   005202 600000 1                  TZE     s:5527

   5526  1 005200   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005201   000000 702211                    TSX2  ! 0,X1

     1419     5527    2      IF VID.VOLCNT~=DCT$->VID.VOLCNT THEN RETURN;

   5527  1 005202   200007 471500                    LDP1    BUF$,,AUTO
         1 005203   100004 236100                    LDQ     4,,PR1
         1 005204   000004 676100                    ERQ     4,,PR0
         1 005205   777777 376007                    ANQ     -1,DL
         1 005206   005211 600000 1                  TZE     s:5528

   5527  1 005207   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005210   000001 702211                    TSX2  ! 1,X1

     1420     5528    3      DO DCTX=0 TO VID.VOLCNT-1;

   5528  1 005211   200011 450100                    STZ     DCTX,,AUTO
         1 005212   005230 710000 1                  TRA     s:5530+3

     1421     5529    3         IF VID.SNLIST(DCTX)~=DCT$->VID.SNLIST(DCTX) THEN RETURN;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:270  

   5529  1 005213   200011 235100                    LDA     DCTX,,AUTO
         1 005214   000004 735000                    ALS     4
         1 005215   200007 470500                    LDP0    BUF$,,AUTO
         1 005216   200005 471500                    LDP1    DCT$,,AUTO
         1 005217   000105 106505                    CMPC    fill='000'O
         1 005220   000500 000020                    ADSC9   320,A,PR0                cn=0,n=16
         1 005221   100500 000020                    ADSC9   320,A,PR1                cn=0,n=16
         1 005222   005225 600000 1                  TZE     s:5530

   5529  1 005223   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005224   000001 702211                    TSX2  ! 1,X1

     1422     5530    3         END;

   5530  1 005225   200011 236100                    LDQ     DCTX,,AUTO
         1 005226   000001 036007                    ADLQ    1,DL
         1 005227   200011 756100                    STQ     DCTX,,AUTO
         1 005230   200007 470500                    LDP0    BUF$,,AUTO
         1 005231   000004 236100                    LDQ     4,,PR0
         1 005232   777777 376007                    ANQ     -1,DL
         1 005233   200011 116100                    CMPQ    DCTX,,AUTO
         1 005234   005236 600000 1                  TZE     RETALT
         1 005235   005213 603000 1                  TRC     s:5529

   5528  1 005236                       RETALT       null
     1423     5531    2   RETALT:;
     1424     5532    2      ALTRETURN;

   5532  1 005236   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005237   000000 702211                    TSX2  ! 0,X1

     1425     5533    2   CHKSM: PROC;

   5533  1 005240   200024 741300       CHKSM        STX1  ! UN+1,,AUTO

     1426     5534    3      ACCTX=0;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:271  

   5534  1 005241   200004 450100                    STZ     ACCT$,,AUTO

     1427     5535    4      DO DCTX=0 TO VID.VOLCNT-1;

   5535  1 005242   200011 450100                    STZ     DCTX,,AUTO
         1 005243   005277 710000 1                  TRA     s:5538+3

     1428     5536    4         ACCT.DA=ACCTX+VID.SNLIST.VSN.N(DCTX)*(DCTX+1);

   5536  1 005244   200011 235100                    LDA     DCTX,,AUTO
         1 005245   000001 035007                    ADLA    1,DL
         1 005246   200026 755100                    STA     UN+3,,AUTO
         1 005247   200011 236100                    LDQ     DCTX,,AUTO
         1 005250   000002 736000                    QLS     2
         1 005251   200007 470500                    LDP0    BUF$,,AUTO
         1 005252   000500 236106                    LDQ     320,QL,PR0
         1 005253   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 005254   200026 402100                    MPY     UN+3,,AUTO
         1 005255   200004 036100                    ADLQ    ACCT$,,AUTO
         1 005256   200004 552134                    STBQ    ACCT$,'34'O,AUTO

     1429     5537    4         ACCT.DA=ACCTX*33+VID.SNLIST.VSN.S(DCTX)*(DCTX+1);

   5537  1 005257   200011 235100                    LDA     DCTX,,AUTO
         1 005260   000001 035007                    ADLA    1,DL
         1 005261   200026 755100                    STA     UN+3,,AUTO
         1 005262   200011 236100                    LDQ     DCTX,,AUTO
         1 005263   000002 736000                    QLS     2
         1 005264   000500 236106                    LDQ     320,QL,PR0
         1 005265   000033 772000                    QRL     27
         1 005266   200026 402100                    MPY     UN+3,,AUTO
         1 005267   200027 756100                    STQ     UN+4,,AUTO
         1 005270   200004 236100                    LDQ     ACCT$,,AUTO
         1 005271   000041 402007                    MPY     33,DL
         1 005272   200027 036100                    ADLQ    UN+4,,AUTO
         1 005273   200004 552134                    STBQ    ACCT$,'34'O,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:272  

     1430     5538    4         END;

   5538  1 005274   200011 235100                    LDA     DCTX,,AUTO
         1 005275   000001 035007                    ADLA    1,DL
         1 005276   200011 755100                    STA     DCTX,,AUTO
         1 005277   200007 470500                    LDP0    BUF$,,AUTO
         1 005300   000004 236100                    LDQ     4,,PR0
         1 005301   777777 376007                    ANQ     -1,DL
         1 005302   200011 116100                    CMPQ    DCTX,,AUTO
         1 005303   005305 600000 1                  TZE     s:5539
         1 005304   005244 603000 1                  TRC     s:5536

     1431     5539    3      ACCTX=MOD(ACCTX,FM_SRZERO);/*TERMINATES CHAIN OF RECOVERY REL FITS*/

   5539  1 005305   200004 236100                    LDQ     ACCT$,,AUTO
         1 005306   000000 506000 xsym               DIV     FM_SRZERO
         1 005307   200004 755100                    STA     ACCT$,,AUTO

     1432     5540    3      RETURN;

   5540  1 005310   200024 221300                    LDX1  ! UN+1,,AUTO
         1 005311   000001 702211                    TSX2  ! 1,X1

     1433     5541        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:273  
     1434     5542    3   READVID: ENTRY;

   5542  1 005312   200024 741300       READVID      STX1  ! UN+1,,AUTO

     1435     5543    3      ACCTX=F$DCB.SETX;

   5543  1 005313   200010 470500                    LDP0    JDCB$,,AUTO
         1 005314   000051 236100                    LDQ     41,,PR0
         1 005315   777777 376007                    ANQ     -1,DL
         1 005316   200004 756100                    STQ     ACCT$,,AUTO

     1436     5544    3      CALL FMD$GETBUF (1,1,XT$);

   5544  1 005317   200020 236100                    LDQ     T$$,,AUTO
         1 005320   200030 756100                    STQ     UN+5,,AUTO
         1 005321   000060 237000 2                  LDAQ    48
         1 005322   200026 757100                    STAQ    UN+3,,AUTO
         1 005323   200026 630500                    EPPR0   UN+3,,AUTO
         1 005324   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 005325   000000 701000 xent               TSX1    FMD$GETBUF
         1 005326   000000 011000                    NOP     0

     1437     5545    3      T$->VID='0'B;

   5545  1 005327   200017 470500                    LDP0    T$,,AUTO
         1 005330   010000 220003                    LDX0    4096,DU
         1 005331   000140 100400                    MLR     fill='000'O
         1 005332   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 005333   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0

     1438     5546    3      F$DCB.SETX=DCTX;

   5546  1 005334   200011 721100                    LXL1    DCTX,,AUTO
         1 005335   200010 470500                    LDP0    JDCB$,,AUTO
         1 005336   000051 441100                    SXL1    41,,PR0

     1439     5547    3      CALL FMN$RDGRAN (XT$,FM_SRZERO);
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:274  

   5547  1 005337   000022 236000 2                  LDQ     18
         1 005340   200020 235100                    LDA     T$$,,AUTO
         1 005341   200026 757100                    STAQ    UN+3,,AUTO
         1 005342   200026 630500                    EPPR0   UN+3,,AUTO
         1 005343   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005344   000000 701000 xent               TSX1    FMN$RDGRAN
         1 005345   000000 011000                    NOP     0

     1440     5548    3      DCT$=T$;

   5548  1 005346   200017 236100                    LDQ     T$,,AUTO
         1 005347   200005 756100                    STQ     DCT$,,AUTO

     1441     5549    3      F$DCB.SETX=ACCTX;

   5549  1 005350   200004 720100                    LXL0    ACCT$,,AUTO
         1 005351   200010 470500                    LDP0    JDCB$,,AUTO
         1 005352   000051 440100                    SXL0    41,,PR0

     1442     5550    3      RETURN;

   5550  1 005353   200024 221300                    LDX1  ! UN+1,,AUTO
         1 005354   000001 702211                    TSX2  ! 1,X1

     1443     5551    3   END;
     1444     5552    2   READVID0: ENTRY ALTRET;

   5552  1 005355   200022 741300       READVID0     STX1  ! T$$+2,,AUTO

     1445     5553    2      CALL READVID;

   5553  1 005356   005312 701000 1                  TSX1    READVID
         1 005357   000000 011000                    NOP     0

     1446     5554    2      RETURN;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:275  
   5554  1 005360   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005361   000001 702211                    TSX2  ! 1,X1

     1447     5555                    /**/
     1448     5556        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:276  
     1449     5557    2   PIGMSG: ENTRY ALTRET;

   5557  1 005362   200022 741300       PIGMSG       STX1  ! T$$+2,,AUTO

     1450     5558    2      IF DCTX=0 THEN CALL SC_SETRES;

   5558  1 005363   200011 235100                    LDA     DCTX,,AUTO
         1 005364   005367 601000 1                  TNZ     s:5559

   5558  1 005365   000000 713400 xsym               CLIMB   SC_SETRES
         1 005366   000000 600000 xsid               climb   nvectors=         0

     1451     5559    2      IF FM$DEV.AVR(DCTX) THEN RETURN;

   5559  1 005367   200011 235100                    LDA     DCTX,,AUTO
         1 005370   000003 735000                    ALS     3
         1 005371   000000 470400 xsym               LDP0    FM$SET$
         1 005372   000002 236105                    LDQ     2,AL,PR0
         1 005373   010000 316003                    CANQ    4096,DU
         1 005374   005377 600000 1                  TZE     s:5560

   5559  1 005375   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005376   000001 702211                    TSX2  ! 1,X1

     1452     5560    2      FM$DEV.AVR(DCTX)='1'B;

   5560  1 005377   010000 236003                    LDQ     4096,DU
         1 005400   000002 256105                    ORSQ    2,AL,PR0

     1453     5561    3      IF B$USRT$->B$USER.US(JG_PIG#)~=%SS_SNULL THEN DO;

   5561  1 005401   000000 470400 xsym               LDP0    B$USRT$
         1 005402   000171 236100                    LDQ     121,,PR0
         1 005403   770000 376003                    ANQ     -4096,DU
         1 005404   300000 116003                    CMPQ    98304,DU
         1 005405   005425 600000 1                  TZE     s:5566

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:277  
     1454     5562    3         AVRM.WORDS=BITBIN(K_DISK);

   5562  1 005406   100000 235007                    LDA     32768,DL
         1 005407   200014 755100                    STA     AVRM,,AUTO

     1455     5563    3         AVRM.PSN=' ';

   5563  1 005410   040100 100400                    MLR     fill='040'O
         1 005411   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 005412   200015 000006                    ADSC9   AVRM+1,,AUTO             cn=0,n=6

     1456     5564    3         CALL KUW$WRITE(AVRM,10,J_PIG);

   5564  1 005413   000062 236000 2                  LDQ     50
         1 005414   200030 756100                    STQ     UN+5,,AUTO
         1 005415   000063 236000 2                  LDQ     51
         1 005416   200027 756100                    STQ     UN+4,,AUTO
         1 005417   200014 631500                    EPPR1   AVRM,,AUTO
         1 005420   200026 451500                    STP1    UN+3,,AUTO
         1 005421   200026 630500                    EPPR0   UN+3,,AUTO
         1 005422   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 005423   000000 701000 xent               TSX1    KUW$WRITE
         1 005424   000000 011000                    NOP     0

     1457     5565    3         END;

     1458     5566    2      RETURN;

   5566  1 005425   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005426   000001 702211                    TSX2  ! 1,X1

     1459     5567        %EJECT;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:278  
     1460     5568    2   CHKOWNER: ENTRY ALTRET;

   5568  1 005427   200022 741300       CHKOWNER     STX1  ! T$$+2,,AUTO

     1461     5569    2      F$DCB.OWNER='0'B;

   5569  1 005430   200010 470500                    LDP0    JDCB$,,AUTO
         1 005431   000064 236000 2                  LDQ     52
         1 005432   000064 356100                    ANSQ    52,,PR0

     1462     5570    2      T$=BUF$;

   5570  1 005433   200007 236100                    LDQ     BUF$,,AUTO
         1 005434   200017 756100                    STQ     T$,,AUTO

     1463     5571    2      I=14;

   5571  1 005435   000016 235007                    LDA     14,DL
         1 005436   200013 755100                    STA     I,,AUTO

     1464     5572    2      CALL FMO$LOCCODE (XT$,I) ALTRET(RETRET);

   5572  1 005437   200013 631500                    EPPR1   I,,AUTO
         1 005440   200027 451500                    STP1    UN+4,,AUTO
         1 005441   200020 236100                    LDQ     T$$,,AUTO
         1 005442   200026 756100                    STQ     UN+3,,AUTO
         1 005443   200026 630500                    EPPR0   UN+3,,AUTO
         1 005444   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005445   000000 701000 xent               TSX1    FMO$LOCCODE
         1 005446   005512 702000 1                  TSX2    RETRET

     1465     5573    2      I=(BUF$->IFPFIT.CODES.NDW(I)-SIZEW(CODE14) +

   5573  1 005447   200007 470500                    LDP0    BUF$,,AUTO
         1 005450   200013 720100                    LXL0    I,,AUTO
         1 005451   000000 236110                    LDQ     0,X0,PR0
         1 005452   000012 772000                    QRL     10
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:279  
         1 005453   001777 376007                    ANQ     1023,DL
         1 005454   000003 136007                    SBLQ    3,DL
         1 005455   000005 506007                    DIV     5,DL
         1 005456   200013 756100                    STQ     I,,AUTO

     1466     5574    2        SIZEW(CODE14.OWNER))/SIZEW(CODE14.OWNER);
     1467     5575    3      DO WHILE(I>0);

   5575  1 005457   000000 116003                    CMPQ    0,DU
         1 005460   005512 600000 1                  TZE     RETRET

     1468     5576    3         I=I-1;

   5576  1 005461   200013 235100                    LDA     I,,AUTO
         1 005462   000001 135007                    SBLA    1,DL
         1 005463   200013 755100                    STA     I,,AUTO

     1469     5577    3         IF T$->CODE14.OWNER.ACCT(I)=B$JIT.ACCN

   5577  1 005464   200013 236100                    LDQ     I,,AUTO
         1 005465   000024 402007                    MPY     20,DL
         1 005466   200017 470500                    LDP0    T$,,AUTO
         1 005467   000000 471400 xsym               LDP1    B$JIT$
         1 005470   040100 106506                    CMPC    fill='040'O
         1 005471   000003 000010                    ADSC9   3,Q,PR0                  cn=0,n=8
         1 005472   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         1 005473   005510 601000 1                  TNZ     s:5583
         1 005474   040100 106506                    CMPC    fill='040'O
         1 005475   000005 000014                    ADSC9   5,Q,PR0                  cn=0,n=12
         1 005476   100003 000014                    ADSC9   3,,PR1                   cn=0,n=12
         1 005477   005504 600000 1                  TZE     s:5580
         1 005500   040000 106506                    CMPC    fill='040'O
         1 005501   000005 000014                    ADSC9   5,Q,PR0                  cn=0,n=12
         1 005502   000065 000001 2                  ADSC9   53                       cn=0,n=1
         1 005503   005510 601000 1                  TNZ     s:5583

     1470     5578    3           AND (T$->CODE14.OWNER.NAME(I)=B$JIT.UNAME OR T$->CODE14.OWNER.NAME(I)='?')
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:280  
     1471     5579    4         THEN DO;

     1472     5580    4            F$DCB.OWNER='1'B;

   5580  1 005504   200010 473500                    LDP3    JDCB$,,AUTO
         1 005505   040000 236007                    LDQ     16384,DL
         1 005506   300064 256100                    ORSQ    52,,PR3

     1473     5581    4            B$JIT.ERR='0'B;

   5581  1 005507   100012 450100                    STZ     10,,PR1

     1474     5582    4            END;

     1475     5583    3         END;

   5583  1 005510   200013 235100                    LDA     I,,AUTO
         1 005511   005461 601000 1                  TNZ     s:5576

     1476     5584    2   RETRET: RETURN;

   5584  1 005512   200022 221300       RETRET       LDX1  ! T$$+2,,AUTO
         1 005513   000001 702211                    TSX2  ! 1,X1

     1477     5585                    /**/
     1478     5586    2   FITSPDIR: ENTRY ALTRET;

   5586  1 005514   200022 741300       FITSPDIR     STX1  ! T$$+2,,AUTO

     1479     5587    2      IF F$DCB.IASN=%FMDIAG# OR I=9

   5587  1 005515   200010 470500                    LDP0    JDCB$,,AUTO
         1 005516   000103 236100                    LDQ     67,,PR0
         1 005517   000777 376007                    ANQ     511,DL
         1 005520   000007 116007                    CMPQ    7,DL
         1 005521   005525 600000 1                  TZE     s:5588
         1 005522   200013 235100                    LDA     I,,AUTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:281  
         1 005523   000011 115007                    CMPA    9,DL
         1 005524   005536 601000 1                  TNZ     s:5589

     1480     5588    2      THEN CALL FMO$FITSPDIR(IFPFIT.CODES(DCTX))ALTRET(RETALT);

   5588  1 005525   200003 471500                    LDP1    @PN$,,AUTO
         1 005526   100013 473500                    LDP3    11,,PR1
         1 005527   200011 720100                    LXL0    DCTX,,AUTO
         1 005530   300000 634510                    EPPR4   0,X0,PR3
         1 005531   200026 454500                    STP4    UN+3,,AUTO
         1 005532   200026 630500                    EPPR0   UN+3,,AUTO
         1 005533   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 005534   000000 701000 xent               TSX1    FMO$FITSPDIR
         1 005535   005236 702000 1                  TSX2    RETALT

     1481     5589    2      T$=BUF$;

   5589  1 005536   200007 236100                    LDQ     BUF$,,AUTO
         1 005537   200017 756100                    STQ     T$,,AUTO

     1482     5590    2      CALL FMO$LOCCODP (XT$,I) ALTRET(RETALT);

   5590  1 005540   200013 630500                    EPPR0   I,,AUTO
         1 005541   200027 450500                    STP0    UN+4,,AUTO
         1 005542   200020 236100                    LDQ     T$$,,AUTO
         1 005543   200026 756100                    STQ     UN+3,,AUTO
         1 005544   200026 630500                    EPPR0   UN+3,,AUTO
         1 005545   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 005546   000000 701000 xent               TSX1    FMO$LOCCODP
         1 005547   005236 702000 1                  TSX2    RETALT

     1483     5591    2      DCT$=T$;

   5591  1 005550   200017 236100                    LDQ     T$,,AUTO
         1 005551   200005 756100                    STQ     DCT$,,AUTO

     1484     5592    2      RETURN;
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:282  

   5592  1 005552   200022 221300                    LDX1  ! T$$+2,,AUTO
         1 005553   000001 702211                    TSX2  ! 1,X1

DUALNAME
 Sect OctLoc
   0     000   005072 104125   101114 ******                                    .:DUAL..

FMN$E$XCLSET
 Sect OctLoc
   0     002   061516 002172                                                    1..z

FMN$E$NOTAUTH
 Sect OctLoc
   0     003   061516 006252                                                    1...

FMN$E$DUPSN
 Sect OctLoc
   0     004   061516 002212                                                    1...

FMN$E$FPARAM
 Sect OctLoc
   0     005   061516 001652                                                    1...

FMN$E$NOACCESS
 Sect OctLoc
   0     006   061516 001642                                                    1...

FMN$E$NOKEY
 Sect OctLoc
   0     007   061516 001022                                                    1...

FMN$E$ACGRANS
 Sect OctLoc
   0     010   061516 002160                                                    1..p

(unnamed)
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:283  
 Sect OctLoc
   0     011   061516 001532   040000 000000   600000 000000   103120 066040    1... .......CP6
   0     015   777777 777000   115111 122122   117122 040040   052115 104120    ....MIRROR  *MDP
   0     021   052114 117124   123052 040040   104120 040040   044044 105106    *LOTS*  DP  $$EF
   0     025   124040 040040   123131 123040   103120 055066   047123 040040    T   SYS CP-6'S
   0     031   000000 100000                                                    ..@.

(unnamed)
 Sect OctLoc
   2     000   000007 777770   743777 777777   000002 006000   000000 006000    ................
   2     004   000003 006000   077777 777777   000040 040040   677777 777777    ....?....   ....
   2     010   177777 777777   000003 777774   000040 040040   040040 040040    .........
   2     014   000000 000016   000014 006000   000006 006000   777776 777777    ................
   2     020   000002 006000   000003 006000   000000 006000   000000 000000    ................
   2     024   000004 006000   000003 006000   776777 777777   000000 010000    ................
   2     030   000002 006000   000002 006000   000005 006000   000027 006000    ................
   2     034   000027 006000   000000 006000   775777 777777   777777 777077    ...............?
   2     040   777777 777757   773777 777777   777777 777377   000023 006000    ................
   2     044   000011 006000   000004 006000   000000 006003   577777 777777    ................
   2     050   000011 400000   000023 600000   000012 006000   000002 006000    ................
   2     054   000011 006000   000012 006000   000000 000020   000056 006000    ................
   2     060   000003 006000   000003 006000   000000 006000   000014 006000    ................
   2     064   777777 737777   077040 040040                                    ....?
     1485     5593    2   END;
     1486     5594    1   END FMN$OPNDP;
     1487     5595        %EOD;

PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:284  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMN$OPNDP.
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:285  

 **** Variables and constants ****

  ****  Section 000 RoData FMN$OPNDP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(54)    r     1 DUALNAME                  10-0-0/b STRC        r     1 FMN$E$ACGRANS
     4-0-0/b STRC        r     1 FMN$E$DUPSN                5-0-0/b STRC        r     1 FMN$E$FPARAM
     6-0-0/b STRC        r     1 FMN$E$NOACCESS             7-0-0/b STRC        r     1 FMN$E$NOKEY
     3-0-0/b STRC        r     1 FMN$E$NOTAUTH              2-0-0/b STRC        r     1 FMN$E$XCLSET

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @PN$                       4-0-0/w STRC        r     1 ACCT
     4-0-0/w PTR         r     1 ACCT$                      4-0-0/w SBIN        r     1 ACCTX
    14-0-0/w STRC(108)   r     1 AVRM                       7-0-0/w PTR         r     1 BUF$
     6-0-0/w PTR         r     1 CFU$                       5-0-0/w PTR         r     1 DCT$
    11-0-0/w UBIN        r     1 DCTX                      11-0-0/w STRC        r     1 DCTX1
     7-0-0/w STRC        r     1 FLAG                      13-0-0/w UBIN        r     1 I
    13-0-0/w SBIN        r     1 IS                        10-0-0/w PTR         r     1 JDCB$
    *0-0-0/w STRC(684)   r     1 PN$                       12-0-0/w PTR         r     1 SET$
    17-0-0/w PTR         r     1 T$                        20-0-0/w PTR         r     1 T$$
    23-0-0/b STRC        r     1 UN

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$USRT$
     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FM$BUF$(0:0)
     0-0-0/w PTR         r     1 FM$SET$                    0-0-0/w UBIN        r     1 FM_PADSDA
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:286  
     0-0-0/w SBIN        r     1 FM_SRZERO                  0-0-0/w UBIN        r     1 FM_SYSSETX
     0-0-0/d CHAR(8)     r     1 J_PIG                      0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(576)   r     1 B$USER(0:0)
     0-0-0/w STRC(396)   r     1 CODE04                     0-0-0/w STRC(288)   r     1 CODE14
     0-0-0/w STRC(288)   r     1 DEV                        0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(108)   r     1 FM$ADKEY                   0-0-0/w STRC(288)   r     1 FM$CFU
     0-0-0/w STRC(288)   r     1 FM$CFUA                    0-0-0/w STRC(288)   r     1 FM$CFUX
     0-0-0/w STRC(288)   r     1 FM$DEV(0:0)                0-0-0/w STRC(180)   r     1 FM$GRAN
     0-0-0/w STRC(288)   r     1 FM$SET                     0-0-0/w STRC(288)   r     1 FM$SETU
     0-0-0/w STRC(288)   r     1 FM$VOL(0:0)
     0-0-0/w STRC(288)   r     1 FMX$SET(0:0)
     0-0-0/d STRC(144)   r     1 FPT$CLOSE_V                0-0-0/d STRC(756)   r     1 FPT$OPEN_V
     0-0-0/w STRC(324)   r     1 FR$RAT                     0-0-0/w STRC(1116)  r     1 IFPFIT
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/w STRC(1332)  r     1 NI$DCT
     0-0-0/w STRC(2844)  r     1 NI$DVT                     0-0-0/c ACHR        r     1 RECI
     0-0-0/w STRC(36864) r     1 VID                        0-0-0/w STRC(288)   r     1 VOL
     0-0-0/w PTR         r     1 XT$


   Procedure FMN$OPNDP requires 2924 words for executable code.
   Procedure FMN$OPNDP requires 32 words of local(AUTO) storage.
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:287  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:288  
          MINI XREF LISTING

ACCT.DA
      4652**DCL      5536<<ASSIGN   5537<<ASSIGN
ACCT$
      4648**DCL      2302--IMP-PTR  4649--REDEF    4650--REDEF    4793<<ASSIGN   4794>>ASSIGN   4797>>IF
      4801>>IF       4816>>ASSIGN   4817>>ASSIGN   4818>>ASSIGN   4825>>ASSIGN   4826>>ASSIGN   4847>>CALL
      4848>>ASSIGN   4900>>ASSIGN   4901>>ASSIGN   4902>>ASSIGN   4903>>ASSIGN   4917>>ASSIGN   4929>>IF
      4933>>ASSIGN   4936>>IF       5354>>ASSIGN   5375>>ASSIGN
ACCTX
      4649**DCL      5046<<ASSIGN   5048>>DOWHILE  5049<<ASSIGN   5052>>IF       5054>>ASSIGN   5071<<ASSIGN
      5072>>DOWHILE  5074>>IF       5074>>IF       5074>>IF       5074>>IF       5078>>ASSIGN   5080>>ASSIGN
      5080>>ASSIGN   5081>>ASSIGN   5086<<ASSIGN   5087<<ASSIGN   5088>>CALLBLT  5092<<ASSIGN   5094<<ASSIGN
      5094>>ASSIGN   5112>>ASSIGN   5122<<ASSIGN   5123<<ASSIGN   5124>>CALLBLT  5129<<ASSIGN   5130>>DOWHILE
      5130>>DOWHILE  5131>>ASSIGN   5132<<ASSIGN   5132>>ASSIGN   5134>>ASSIGN   5165>>ASSIGN   5179<<ASSIGN
      5180>>ASSIGN   5242>>ASSIGN   5260>>IF       5263>>ASSIGN   5321>>ASSIGN   5335>>ASSIGN   5337>>ASSIGN
      5338>>ASSIGN   5357>>ASSIGN   5518>>IF       5534<<ASSIGN   5536>>ASSIGN   5537>>ASSIGN   5539<<ASSIGN
      5539>>ASSIGN   5543<<ASSIGN   5549>>ASSIGN
AVRAGAIN
      5182**LABEL    5323--GOTO
AVRM
      4672**DCL      5489--CALL     5564<>CALL
AVRM.PSN
      4674**DCL      5486<<ASSIGN   5563<<ASSIGN
AVRM.SETX
      4675**DCL      5487<<ASSIGN
AVRM.WORDS
      4673**DCL      5277<<ASSIGN   5287<>CALL     5296>>ASSIGN   5336>>IF       5488<<ASSIGN   5562<<ASSIGN
B$DO.ECCINFO
      4243**DCL      4244--REDEF
B$JIT.ACCN
       368**DCL      5577>>IF
B$JIT.DCB$
       458**DCL      4720>>ASSIGN   4846<>CALL     4981>>ASSIGN   5397<<ASSIGN   5398<>CALL     5405<<ASSIGN
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:289  
B$JIT.ERR
       368**DCL      4724<<ASSIGN   4736>>IF       4821<<ASSIGN   4835<<ASSIGN   4840<<ASSIGN   4851<<ASSIGN
      4860<<ASSIGN   4861>>IF       4929<<ASSIGN   4941<<ASSIGN   4946<<ASSIGN   4949<<ASSIGN   5407>>IF
      5408<<ASSIGN   5427<<ASSIGN   5581<<ASSIGN
B$JIT.ERR.CODE
       369**DCL      4832>>IF       4833>>IF
B$JIT.ERR.MID
       369**DCL       369--REDEF
B$JIT.MODE
       363**DCL      5445>>ASSIGN
B$JIT.PRIV.ACTIVE
       369**DCL      4722>>IF       4808>>IF       4812>>IF       4922>>IF
B$JIT.PRIV.AUTH
       409**DCL      5431>>IF
B$JIT.SYSID
       368**DCL      5017>>IF       5027>>IF       5089>>IF       5187>>IF       5220>>IF       5342>>IF
      5371>>IF       5393>>IF
B$JIT.UNAME
       368**DCL      5577>>IF
B$JIT$
      4598**DCL       363--IMP-PTR  4720>>ASSIGN   4722>>IF       4724>>ASSIGN   4736>>IF       4808>>IF
      4812>>IF       4821>>ASSIGN   4832>>IF       4833>>IF       4835>>ASSIGN   4840>>ASSIGN   4846>>CALL
      4851>>ASSIGN   4860>>ASSIGN   4861>>IF       4922>>IF       4929>>ASSIGN   4941>>ASSIGN   4946>>ASSIGN
      4949>>ASSIGN   4981>>ASSIGN   5017>>IF       5027>>IF       5089>>IF       5187>>IF       5220>>IF
      5342>>IF       5371>>IF       5393>>IF       5397>>ASSIGN   5398>>CALL     5405>>ASSIGN   5407>>IF
      5408>>ASSIGN   5427>>ASSIGN   5431>>IF       5445>>ASSIGN   5577>>IF       5577>>IF       5581>>ASSIGN
B$U.MISC
      4222**DCL      4223--REDEF
B$USER.FLG
      4268**DCL      5494>>IF
B$USER.MISC
      4298**DCL      4299--REDEF
B$USER.MODE
      4289**DCL      5494>>IF
B$USER.US
      4285**DCL      5561>>IF
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:290  
B$USRT$
      4310**DCL      5494>>IF       5494>>IF       5561>>IF
BLDFD
      4820**LABEL    4805--CALLALT
BUF$
      4655**DCL      2287--IMP-PTR  2316--IMP-PTR  2323--IMP-PTR  4545--IMP-PTR  4656--REDEF    4768<<ASSIGN
      4806<<ASSIGN   4811>>ASSIGN   4812>>ASSIGN   4813>>CALL     4820>>IF       4822>>ASSIGN   4825>>ASSIGN
      4826>>ASSIGN   4853<<ASSIGN   4854>>IF       4855>>ASSIGN   4856<<ASSIGN   4856>>ASSIGN   4863>>ASSIGN
      4865>>ASSIGN   4913>>ASSIGN   4923>>ASSIGN   5032<<ASSIGN   5033>>ASSIGN   5036>>IF       5036>>IF
      5036>>ASSIGN   5038>>IF       5038>>IF       5038>>IF       5038>>ASSIGN   5041>>IF       5041>>IF
      5043>>ASSIGN   5048>>DOWHILE  5049>>IF       5052>>ASSIGN   5100>>IF       5108>>IF       5121>>CALLBLT
      5121>>CALLBLT  5122>>IF       5123>>ASSIGN   5124>>CALLBLT  5158>>ASSIGN   5182<<ASSIGN   5184>>ASSIGN
      5186>>IF       5186>>IF       5186>>ASSIGN   5196>>ASSIGN   5199>>ASSIGN   5200>>ASSIGN   5203>>ASSIGN
      5206>>IF       5206>>IF       5206>>IF       5209>>IF       5211>>ASSIGN   5215>>ASSIGN   5222>>IF
      5228>>IF       5228>>IF       5234>>ASSIGN   5255>>ASSIGN   5268>>ASSIGN   5278>>IF       5278>>ASSIGN
      5279>>DOWHILE  5279>>DOWHILE  5279>>DOWHILE  5281>>IF       5281>>IF       5281>>IF       5282>>ASSIGN
      5284>>IF       5284>>IF       5291>>ASSIGN   5293>>ASSIGN   5294>>ASSIGN   5294>>ASSIGN   5301>>IF
      5301>>IF       5301>>IF       5301>>IF       5322>>ASSIGN   5332>>ASSIGN   5511>>IF       5512>>IF
      5514>>IF       5514>>IF       5514>>IF       5527>>IF       5528>>DOINDEX  5529>>IF       5535>>DOINDEX
      5536>>ASSIGN   5537>>ASSIGN   5570>>ASSIGN   5573>>ASSIGN   5589>>ASSIGN
CFU$
      4654**DCL      2293--IMP-PTR  2296--IMP-PTR  4054--IMP-PTR  4790<<ASSIGN   4791>>ASSIGN   4793>>ASSIGN
      4873<<ASSIGN   4879>>ASSIGN   4886>>ASSIGN   4888>>ASSIGN   4889>>ASSIGN   4890>>IF       4891>>CALL
      4892>>ASSIGN   4894>>ASSIGN   4897>>ASSIGN   4912>>ASSIGN   5138<<ASSIGN   5139>>IF       5140>>ASSIGN
      5141>>ASSIGN   5272<<ASSIGN   5338<<ASSIGN   5342>>IF       5344>>IF       5346>>IF       5346>>ASSIGN
      5347>>ASSIGN   5348>>CALL     5350>>ASSIGN   5351>>ASSIGN   5353>>ASSIGN   5357<<ASSIGN   5358>>ASSIGN
      5365>>ASSIGN   5366>>ASSIGN   5371>>IF       5371>>IF       5372>>CALL     5395<<ASSIGN   5405>>ASSIGN
      5406>>ASSIGN   5446<<ASSIGN   5447>>IF       5447>>CALL     5456<<ASSIGN   5457>>DOINDEX  5458>>ASSIGN
      5461>>ASSIGN
CHKDUAL
      5103**LABEL    5126--GOTO
CHKOWNER IN PROCEDURE XUSER
      5568**ENTRY    4769--CALL     4857--CALL
CHKSM IN PROCEDURE XUSER
      5533**PROC     5502--CALL     5517--CALL
CHKSUM IN PROCEDURE XUSER
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:291  
      5501**ENTRY    5111--CALL     5157--CALL
CODE04
      2328**DCL      4879<<ASSIGN   4879>>ASSIGN
CODE04.ACCESS
      2330**DCL      5422>>IF       5423<>CALL
CODE04.GAC.TIME
      2331**DCL      4880>>ASSIGN
CODE04.MODIFY
      2330**DCL      4925<>CALL
CODE04.SVMODIFY
      2331**DCL      5422>>IF
CODE14
      2336**DCL      4893--ASSIGN   5573--ASSIGN
CODE14.ACCESS
      2338**DCL      4888<<ASSIGN   4888>>ASSIGN   4897<<ASSIGN   4897>>ASSIGN   4897>>ASSIGN   4901>>ASSIGN
CODE14.ACCESS.GACSHELF
      2339**DCL      4905>>ASSIGN
CODE14.ACCESS.LIST
      2338**DCL      4900<<ASSIGN   4916<<ASSIGN   4917>>ASSIGN
CODE14.ACCESS.WCDATA
      2338**DCL      4906>>ASSIGN
CODE14.ACCESS.WRCMP
      2338**DCL      4906>>ASSIGN
CODE14.CGMEM
      2339**DCL      4890>>IF       4890>>IF       4891>>CALL     4892<<ASSIGN   4892>>ASSIGN
CODE14.CGRANS
      2341**DCL      4903>>ASSIGN
CODE14.DFLTALL
      2339**DCL      4886<<ASSIGN   4886>>ASSIGN   4902>>ASSIGN
CODE14.MGRANS
      2341**DCL      4889<<ASSIGN   4889>>ASSIGN   4903>>ASSIGN
CODE14.OWNER
      2341**DCL      4893--ASSIGN   4894--ASSIGN   4894--ASSIGN   5573--ASSIGN   5573--ASSIGN
CODE14.OWNER.ACCT
      2341**DCL      5577>>IF
CODE14.OWNER.NAME
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:292  
      2341**DCL      5577>>IF       5577>>IF
DCT$
      4653**DCL      2328--IMP-PTR  2336--IMP-PTR  3705--IMP-PTR  4731<<ASSIGN   4732>>IF       4734>>ASSIGN
      4738>>ASSIGN   4738>>ASSIGN   4879>>ASSIGN   4880>>ASSIGN   4886>>ASSIGN   4888>>ASSIGN   4889>>ASSIGN
      4890>>IF       4892>>ASSIGN   4894>>ASSIGN   4897>>ASSIGN   4897>>ASSIGN   4900>>ASSIGN   4901>>ASSIGN
      4902>>ASSIGN   4903>>ASSIGN   4903>>ASSIGN   4905>>ASSIGN   4906>>ASSIGN   4906>>ASSIGN   4912>>ASSIGN
      4915<<ASSIGN   4916>>ASSIGN   4917>>ASSIGN   4995<<ASSIGN   5041>>IF       5041>>IF       5189>>IF
      5192>>ASSIGN   5193>>ASSIGN   5194>>IF       5199>>ASSIGN   5200>>IF       5200>>ASSIGN   5213>>ASSIGN
      5218>>IF       5223>>ASSIGN   5224>>ASSIGN   5232>>IF       5233>>ASSIGN   5250<<ASSIGN   5251>>ASSIGN
      5252>>ASSIGN   5253>>ASSIGN   5254>>ASSIGN   5255>>ASSIGN   5256>>ASSIGN   5257>>ASSIGN   5258>>ASSIGN
      5261>>ASSIGN   5271>>IF       5272>>ASSIGN   5283<<ASSIGN   5288<<ASSIGN   5289>>ASSIGN   5290>>ASSIGN
      5291>>ASSIGN   5292>>ASSIGN   5293>>ASSIGN   5294>>ASSIGN   5295>>IF       5295>>ASSIGN   5330>>IF
      5526>>IF       5527>>IF       5529>>IF       5548<<ASSIGN   5591<<ASSIGN
DCTX
      4665**DCL      4666--REDEF    4728<<ASSIGN   4729>>IF       4730<<ASSIGN   4730>>ASSIGN   4731>>ASSIGN
      4735>>ASSIGN   4739>>IF       4739<<ASSIGN   4740<<ASSIGN   4740>>ASSIGN   4741>>DOWHILE  4742>>IF
      4742>>IF       4745<<ASSIGN   4745>>ASSIGN   4872<<DOINDEX  4873>>ASSIGN   4874>>ASSIGN   4893>>ASSIGN
      4911>>ASSIGN   4950>>ASSIGN   4993<<ASSIGN   4994<<ASSIGN   4994>>ASSIGN   4995>>ASSIGN   5030>>IF
      5057<<ASSIGN   5062<<ASSIGN   5063>>IF       5064>>DOWHILE  5065>>IF       5066>>ASSIGN   5067<<ASSIGN
      5067>>ASSIGN   5078<<ASSIGN   5084<<ASSIGN   5085>>CALLBLT  5086>>IF       5087>>ASSIGN   5180<<ASSIGN
      5240<<ASSIGN   5242<<ASSIGN   5246>>ASSIGN   5248<<ASSIGN   5250>>ASSIGN   5253>>ASSIGN   5254>>ASSIGN
      5260>>IF       5263<<ASSIGN   5279>>DOWHILE  5284>>IF       5284>>IF       5290>>ASSIGN   5296>>ASSIGN
      5299>>ASSIGN   5314>>ASSIGN   5321<<ASSIGN   5325<<ASSIGN   5327<<ASSIGN   5330>>IF       5332<<ASSIGN
      5333>>IF       5335<<ASSIGN   5377>>IF       5442<<ASSIGN   5444>>DOWHILE  5446>>ASSIGN   5448<<ASSIGN
      5448>>ASSIGN   5458<<ASSIGN   5496<>CALL     5519<<ASSIGN   5521>>IF       5522>>IF       5522>>IF
      5523<<ASSIGN   5523>>ASSIGN   5528<<DOINDEX  5529>>IF       5529>>IF       5535<<DOINDEX  5536>>ASSIGN
      5536>>ASSIGN   5537>>ASSIGN   5537>>ASSIGN   5546>>ASSIGN   5558>>IF       5559>>IF       5560>>ASSIGN
      5588>>CALL
DCTX1.SYSID
      4668**DCL      5483<>CALL
DEV.DCTX
      2276**DCL      5289>>ASSIGN
DEV.MIRROR
      2277**DCL      5190>>IF       5191<<ASSIGN   5198>>IF       5208>>IF       5212<<ASSIGN   5217>>IF
      5219<<ASSIGN   5237>>IF       5269>>IF
DEV.MRRCHK
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:293  
      2277**DCL      5187>>IF       5188<<ASSIGN
DEV.MRRDCTX
      2279**DCL      5192<<ASSIGN   5210<<ASSIGN   5247<<ASSIGN   5270>>IF       5274>>CALLBLT  5377>>IF
      5377>>IF       5377>>IF       5381>>ASSIGN   5382>>ASSIGN   5383>>ASSIGN   5384<<ASSIGN
DEV.MRRUTS
      2279**DCL      5193<<ASSIGN   5211<<ASSIGN
DEV.NXTSDA
      2278**DCL      5278>>IF       5279>>DOWHILE  5281>>IF       5282>>ASSIGN   5295>>IF
DEV.ONEU
      2277**DCL      5388<<ASSIGN
DEV.SECTL
      2278**DCL      5221>>IF       5333>>IF       5333>>ASSIGN   5339>>IF       5339>>IF       5359>>ASSIGN
      5373>>ASSIGN   5374>>IF
DEV.SPIN
      2277**DCL      4752>>IF       5185>>IF       5198>>IF       5218>>IF       5319>>IF       5320<<ASSIGN
      5374>>IF
DEV.SYSID
      2278**DCL      5387<<ASSIGN
DEV.USERLIST
      2277**DCL      2278--REDEF
DEV.VSN
      2276**DCL      5049>>IF       5196<<ASSIGN   5222>>IF       5222<<ASSIGN   5228>>IF       5268<<ASSIGN
      5333<<ASSIGN   5352>>ASSIGN
DFLCLS
      4994**LABEL    4996--GOTO
DUALDUAL
      5141**LABEL    5120--GOTO
DUALNAME
      4677**DCL      5401>>ASSIGN
F$CFU$
      4604**DCL      2308--IMP-PTR  4793>>ASSIGN   4988>>ASSIGN   4988>>ASSIGN   5071>>ASSIGN   5106>>ASSIGN
      5154>>ASSIGN   5155>>ASSIGN   5160>>ASSIGN   5226>>ASSIGN   5255>>IF       5456>>ASSIGN
F$DCB.ACCT
       533**DCL      4738<<ASSIGN   4880>>IF       4904>>IF       5400<<ASSIGN
F$DCB.ACTPOS
       548**DCL       548--REDEF
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:294  
F$DCB.ARS
       523**DCL       523--REDEF
F$DCB.ASN
       538**DCL      5402<<ASSIGN
F$DCB.ATTR
       541**DCL       542--REDEF    5353<<ASSIGN
F$DCB.BFR.BUFUP
       567**DCL      4814<<ASSIGN   4881<<ASSIGN   4921<<ASSIGN
F$DCB.BFR.BUFX
       568**DCL      4853>>ASSIGN
F$DCB.BORROW
       556**DCL       556--REDEF     556--REDEF     556--REDEF
F$DCB.CFU$
       557**DCL      4789<>CALL     4790>>ASSIGN   4937>>ASSIGN
F$DCB.CSEED
       560**DCL      5352<<ASSIGN
F$DCB.DCBNAME.L
       570**DCL       570--IMP-SIZ
F$DCB.EOMCHAR
       527**DCL       527--REDEF
F$DCB.EXPIRE
       539**DCL      4822<<ASSIGN
F$DCB.FCD
       536**DCL      4754<<ASSIGN   4938<<ASSIGN
F$DCB.FFLG
       527**DCL      4752<<ASSIGN   4859>>IF
F$DCB.FFLG.READ
       528**DCL      4748<<ASSIGN
F$DCB.FFLG.WNEW
       528**DCL      4749<<ASSIGN   4985>>IF
F$DCB.FLDID
       551**DCL       551--REDEF
F$DCB.FORM$
       545**DCL       545--REDEF
F$DCB.FSECT
       561**DCL       561--REDEF
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:295  
F$DCB.FSN
       538**DCL       538--REDEF     538--REDEF     539--REDEF
F$DCB.FUN
       537**DCL      4741>>IF       4749>>IF       4802<<ASSIGN
F$DCB.GTYP
       552**DCL      4758<<ASSIGN   5418<<ASSIGN
F$DCB.HEADER$
       544**DCL       544--REDEF
F$DCB.IASN
       564**DCL      4722<<ASSIGN   4757>>IF       4773<<ASSIGN   4839>>IF       4857>>IF       4863>>IF
      4877>>IF       4887>>IF       4944>>IF       5587>>IF
F$DCB.IXTNSIZE
       542**DCL       542--REDEF    4733<<ASSIGN
F$DCB.LASTSTA$
       532**DCL       532--REDEF
F$DCB.LVL
       557**DCL       557--REDEF
F$DCB.NAME
       532**DCL      5401<<ASSIGN
F$DCB.NAME.C
       532**DCL       532--REDEF
F$DCB.NOEOF
       553**DCL       553--REDEF
F$DCB.NRECS
       543**DCL       543--REDEF
F$DCB.NRECX
       562**DCL       562--REDEF
F$DCB.OHDR
       554**DCL       554--REDEF
F$DCB.ORG
       537**DCL       537--REDEF
F$DCB.OWNER
       554**DCL      4753<<ASSIGN   4773>>IF       4858<<ASSIGN   4859>>IF       4870>>IF       4871<<ASSIGN
      5569<<ASSIGN   5580<<ASSIGN
F$DCB.PASS
       533**DCL      4734<<ASSIGN
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:296  
F$DCB.PRECNO
       560**DCL       560--REDEF
F$DCB.PSN
       533**DCL      4725<>CALL     4950<<ASSIGN   5273<<ASSIGN   5274<<CALLBLT  5340<<ASSIGN   5355<>CALL
      5366>>IF       5399<<ASSIGN   5512>>IF
F$DCB.RCSZ
       565**DCL       565--REDEF
F$DCB.RES
       533**DCL       533--REDEF
F$DCB.SETX
       545**DCL       545--REDEF    4723<<ASSIGN   4726>>IF       4727>>ASSIGN   4739>>IF       4739>>ASSIGN
      4744>>IF       4983>>ASSIGN   5057>>ASSIGN   5063>>IF       5065>>IF       5135>>ASSIGN   5136>>ASSIGN
      5156>>ASSIGN   5161>>ASSIGN   5179>>ASSIGN   5299<<ASSIGN   5300>>IF       5301>>IF       5301>>IF
      5301>>IF       5305>>ASSIGN   5307>>ASSIGN   5311>>IF       5312>>IF       5314>>ASSIGN   5315>>CALL
      5325>>ASSIGN   5327>>ASSIGN   5337<<ASSIGN   5430>>ASSIGN   5450<<ASSIGN   5465>>ASSIGN   5487>>ASSIGN
      5522>>IF       5543>>ASSIGN   5546<<ASSIGN   5549<<ASSIGN
F$DCB.TAB$
       544**DCL       545--REDEF
F$DCB.TDA
       559**DCL       559--REDEF
F$DCB.WCDATA
       557**DCL      4750<<ASSIGN
F$DCB.WSN
       534**DCL       534--REDEF
F$DCB.XTNSIZE
       540**DCL      4735<<ASSIGN
FAG$CGRANS
      4547**DCL-ENT  4787--CALL     4991--CALL
FINDOTHER
      5070**LABEL    5416--GOTO
FITSPDIR IN PROCEDURE XUSER
      5586**ENTRY    4878--CALL     4885--CALL     4910--CALL
FLAG
      4656**DCL      5000<<ASSIGN   5002<<ASSIGN   5004<<ASSIGN   5006<<ASSIGN   5008<<ASSIGN   5010<<ASSIGN
      5012<<ASSIGN   5015<<ASSIGN   5015>>ASSIGN   5018>>IF       5023<<ASSIGN   5023>>ASSIGN   5027<<ASSIGN
      5027>>ASSIGN
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:297  
FLAG.DSMT
      4660**DCL      5434>>ASSIGN   5436>>IF
FLAG.DSMTF
      4661**DCL      5435>>ASSIGN   5453>>IF
FLAG.DSMTX
      4662**DCL      5453>>IF       5493>>IF
FLAG.MAD
      4658**DCL      5431>>IF
FLAG.REL
      4659**DCL      5436>>IF
FLAG.SHARE
      4657**DCL      5393>>IF
FM$ADKEY.D
      2323**DCL      4811<<ASSIGN   4820>>IF
FM$ADKEY.FDSDA
      2323**DCL      4812<<ASSIGN   4813<>CALL     4822>>ASSIGN   4825>>ASSIGN   4826>>ASSIGN
FM$BUF$
      4602**DCL      4853>>ASSIGN
FM$CFU.ACCTX
      2297**DCL      2297--REDEF    4793>>ASSIGN   4937<<ASSIGN
FM$CFU.FUN
      2296**DCL      4791<<ASSIGN
FM$CFUA
      2302**DCL      4847<>CALL
FM$CFUA.ACCESS
      2303**DCL      4901<<ASSIGN
FM$CFUA.ACCESS.LIST
      2303**DCL      4900>>ASSIGN   4917<<ASSIGN
FM$CFUA.ACCT
      2302**DCL      4801>>IF       4817<<ASSIGN   4936>>IF
FM$CFUA.DFLTALL
      2305**DCL      4902<<ASSIGN
FM$CFUA.FDCSDA
      2302**DCL      4826<<ASSIGN
FM$CFUA.FDFITSDA
      2302**DCL      4825<<ASSIGN
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:298  
FM$CFUA.FLAGS
      2302**DCL      4848<<ASSIGN
FM$CFUA.FLAGS.EXIST
      2302**DCL      4797>>IF
FM$CFUA.GMOD
      2303**DCL      4818<<ASSIGN
FM$CFUA.GRANS
      2305**DCL      4816<<ASSIGN   4903<<ASSIGN   4929>>IF
FM$CFUX.DSETH
      2309**DCL      5226>>ASSIGN   5255>>IF
FM$CFUX.GCT
      2308**DCL      4988<<ASSIGN   4988>>ASSIGN
FM$CFUX.SETH
      2309**DCL      5071>>ASSIGN   5106>>ASSIGN   5154>>ASSIGN   5155<<ASSIGN   5160>>ASSIGN
FM$DEV.AVR
      2259**DCL      5559>>IF       5560<<ASSIGN
FM$DEV.DEVL
      2260**DCL      5266>>ASSIGN
FM$DEV.MIRROR
      2259**DCL      5230>>IF
FM$DEV.MRRDCTX
      2261**DCL      5230>>IF       5246<<ASSIGN   5253>>ASSIGN   5377>>IF       5381<<ASSIGN
FM$DEV.MRRUTS
      2261**DCL      5254>>ASSIGN
FM$DEV.NN
      2258**DCL      5274>>CALLBLT
FM$DEV.ONEU
      2259**DCL      4952<<ASSIGN   5173<<ASSIGN
FM$DEV.SECTL
      2260**DCL      4740>>ASSIGN   5377>>IF
FM$DEV.SYSID
      2260**DCL      4951<<ASSIGN   5172<<ASSIGN
FM$DEV.USERLIST
      2259**DCL      2260--REDEF
FM$DEV.VSN
      2258**DCL      5228>>IF       5239<<ASSIGN
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:299  
FM$GRAN
      2316**DCL      4768--ASSIGN   4855--ASSIGN   4856--ASSIGN   5420--ASSIGN
FM$GRAN.FCEX
      2317**DCL      4855>>ASSIGN
FM$KT
      2313**DCL      2313--REDEF
FM$SET
      2253**DCL      5020<>CALL     5155--ASSIGN   5441<>CALL     5496<>CALL
FM$SET.DCTX
      2253**DCL      4728>>ASSIGN   4744>>IF       4786>>IF       4951>>ASSIGN   4952>>ASSIGN   4993>>ASSIGN
      5084>>ASSIGN   5156<<ASSIGN   5442>>ASSIGN
FM$SET.DIAGOPN
      2254**DCL      5436>>IF
FM$SET.DSMTF
      2253**DCL      5435<<ASSIGN
FM$SET.DUAL
      2254**DCL      5414<<ASSIGN
FM$SET.GACSHELF
      2254**DCL      4905<<ASSIGN
FM$SET.GACTIME
      2255**DCL      4880<<ASSIGN
FM$SET.NONEWU
      2253**DCL      5434<<ASSIGN
FM$SET.NXTSDA
      2255**DCL      4733>>ASSIGN
FM$SET.ONEU
      2254**DCL      4954<<ASSIGN   5171<<ASSIGN   5436>>IF       5455>>IF
FM$SET.PSN
      2253**DCL      4985>>IF       5085<<CALLBLT  5088<<CALLBLT  5158<<ASSIGN   5399>>ASSIGN   5430>>IF
      5440>>IF       5486>>ASSIGN
FM$SET.REALPSN
      2255**DCL      4985>>IF
FM$SET.SET
      2253**DCL      4737>>IF       4752>>IF       4985>>IF       4994>>IF       5030>>IF       5083>>IF
      5096>>IF       5177>>IF       5443<<ASSIGN
FM$SET.SETL
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:300  
      2255**DCL      5154<<ASSIGN
FM$SET.SYSID
      2254**DCL      4953<<ASSIGN   5169>>IF       5170<<ASSIGN
FM$SET.USERLIST
      2254**DCL      2254--REDEF    5454>>ASSIGN
FM$SET.WRCMP
      2253**DCL      4906<<ASSIGN
FM$SET.XCL
      2253**DCL      4753>>ASSIGN   4871>>ASSIGN   5014>>IF       5159<<ASSIGN   5393>>IF       5428<<ASSIGN
      5438<<ASSIGN   5463<<ASSIGN   5466>>IF
FM$SET$
      4603**DCL      2258--IMP-PTR  2264--IMP-PTR  2282--IMP-PTR  4727>>ASSIGN   4730>>ASSIGN   4740>>ASSIGN
      4742>>IF       4742>>IF       4742>>IF       4745>>ASSIGN   4786>>IF       4950>>ASSIGN   4950>>ASSIGN
      4951>>ASSIGN   4952>>ASSIGN   4984>>ASSIGN   4994>>ASSIGN   5054>>IF       5059>>IF       5062>>ASSIGN
      5063>>ASSIGN   5065>>IF       5066>>ASSIGN   5067>>ASSIGN   5069>>IF       5074>>IF       5074>>IF
      5074>>IF       5074>>IF       5074>>IF       5078>>ASSIGN   5080>>ASSIGN   5080>>ASSIGN   5081>>ASSIGN
      5082>>ASSIGN   5082>>ASSIGN   5085>>CALLBLT  5086>>IF       5087>>ASSIGN   5091>>ASSIGN   5094>>ASSIGN
      5108>>IF       5109>>IF       5112>>ASSIGN   5113>>ASSIGN   5114>>ASSIGN   5114>>ASSIGN   5129>>ASSIGN
      5130>>DOWHILE  5132>>ASSIGN   5135>>ASSIGN   5136>>ASSIGN   5137>>IF       5148>>ASSIGN   5161>>ASSIGN
      5163>>ASSIGN   5164>>ASSIGN   5164>>ASSIGN   5165>>ASSIGN   5172>>ASSIGN   5173>>ASSIGN   5228>>IF
      5230>>IF       5230>>IF       5239>>ASSIGN   5246>>ASSIGN   5253>>ASSIGN   5254>>ASSIGN   5266>>ASSIGN
      5274>>CALLBLT  5279>>DOWHILE  5284>>IF       5284>>IF       5284>>IF       5290>>ASSIGN   5296>>ASSIGN
      5299>>ASSIGN   5301>>IF       5301>>IF       5301>>IF       5305>>ASSIGN   5307>>ASSIGN   5311>>IF
      5312>>IF       5314>>ASSIGN   5314>>ASSIGN   5315>>CALL     5330>>IF       5333>>ASSIGN   5339>>IF
      5361>>IF       5361>>IF       5361>>IF       5363>>ASSIGN   5373>>ASSIGN   5376>>CALL     5377>>IF
      5377>>IF       5381>>ASSIGN   5446>>ASSIGN   5448>>ASSIGN   5514>>IF       5514>>IF       5518>>IF
      5519>>ASSIGN   5522>>IF       5523>>ASSIGN   5559>>IF       5560>>ASSIGN
FM$SETU.LINKX
      2293**DCL      5461>>ASSIGN
FM$SETU.NUM
      2293**DCL      5457>>DOINDEX
FM$SETU.SYSID
      2293**DCL      5458>>ASSIGN
FM$VOL
      2264**DCL      5315--CALL     5330--IF
FM$VOL.DCTX
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:301  
      2264**DCL      4730>>ASSIGN   4994>>ASSIGN   5446>>ASSIGN
FM$VOL.DRZERO
      2266**DCL      5284>>IF       5301>>IF
FM$VOL.NXTSDA
      2266**DCL      5301>>IF
FM$VOL.RGRANS
      2267**DCL      4786>>IF
FM$VOL.SECT#
      2264**DCL      5086>>IF       5087>>ASSIGN   5339>>IF
FM$VOL.SECTL
      2266**DCL      4745>>ASSIGN   5279>>DOWHILE  5284>>IF       5284>>IF       5290>>ASSIGN   5296<<ASSIGN
      5299>>ASSIGN   5314<<ASSIGN   5314>>ASSIGN   5363>>ASSIGN
FM$VOL.SETX
      2264**DCL      4742>>IF       4742>>IF       4950>>ASSIGN   5312>>IF       5361>>IF       5361>>IF
      5373>>ASSIGN
FM$VOL.SPIN
      2265**DCL      5305<<ASSIGN   5307<<ASSIGN   5311>>IF       5522>>IF
FM$VOL.USERLIST
      2265**DCL      2266--REDEF
FM$VOL.VOL#
      2266**DCL      5130>>DOWHILE
FM$VOL.VOLL
      2266**DCL      5065>>IF       5066<<ASSIGN   5067>>ASSIGN   5132>>ASSIGN   5136<<ASSIGN   5448>>ASSIGN
      5523>>ASSIGN
FM$VOL.VSN
      2264**DCL      5085>>CALLBLT  5301>>IF       5333>>ASSIGN
FMB$QUEUE
      4548**DCL-ENT  5202--CALL
FMD$FLSHBUF
      4552**DCL-ENT  4770--CALL     4829--CALL     4932--CALL
FMD$GETBUF
      4550**DCL-ENT  5031--CALL     5181--CALL     5544--CALL
FMD$REDBUF
      4553**DCL-ENT  4762--CALL     5419--CALL
FMD$RELBUF
      4551**DCL-ENT  5389--CALL     5470--CALL     5471--CALL
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:302  
FMD$WRTBUF
      4554**DCL-ENT  5424--CALL
FMG$REMKEY
      4555**DCL-ENT  4809--CALL
FMI$INIT
      4556**DCL-ENT  4751--CALL
FMM$DFLOPNP
      4557**DCL-ENT  5403--CALL
FMM$SCRUB
      4558**DCL-ENT  5398--CALL
FMN$CHKACCN
      4559**DCL-ENT  4846--CALL
FMN$CLSDP
      4980**ENTRY    5310--CALL
FMN$E$ACGRANS
      4711**DCL      4929>>ASSIGN
FMN$E$DUPSN
      4695**DCL      5408>>ASSIGN
FMN$E$FPARAM
      4699**DCL      4941>>ASSIGN
FMN$E$NOACCESS
      4703**DCL      4860>>ASSIGN
FMN$E$NOKEY
      4707**DCL      4821>>ASSIGN   4835>>ASSIGN
FMN$E$NOTAUTH
      4691**DCL      4840>>ASSIGN   4946>>ASSIGN
FMN$E$XCLSET
      4687**DCL      4949>>ASSIGN
FMN$RDGRAN
      4560**DCL-ENT  5034--CALL     5185--CALL     5547--CALL
FMN$READFDFIT
      4561**DCL-ENT  4852--CALL
FMN$SETX
      4562**DCL-ENT  4725--CALL
FMNE$FPARAM
      4941**LABEL    4785--GOTO
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:303  
FMNE$NOTAUTH
      4946**LABEL    4774--GOTO     5432--GOTO
FMNE$NOTAUTHR
      4840**LABEL    4870--GOTO
FMNE$XCLSET
      4949**LABEL    4743--GOTO
FMO$FITSPDIR
      4563**DCL-ENT  5588--CALL
FMO$LOCCODE
      4564**DCL-ENT  5572--CALL
FMO$LOCCODP
      4565**DCL-ENT  4914--CALL     4924--CALL     5421--CALL     5590--CALL
FMO$TRNINFO
      4566**DCL-ENT  4866--CALL
FMP$CLSTAR
      4569**DCL-ENT  4939--CALL     5404--CALL
FMP$UDLIST
      4567**DCL-ENT  5020--CALL     5441--CALL     5496--CALL
FMQ$BLDFD
      4570**DCL-ENT  4847--CALL
FMQ$BLDMAD
      4571**DCL-ENT  5431--CALL
FMQ$SRCHAD
      4572**DCL-ENT  4805--CALL
FMR$G8
      4573**DCL-ENT  4789--CALL
FMR$GA
      4574**DCL-ENT  5152--CALL     5287--CALL
FMR$L8
      4575**DCL-ENT  4987--CALL     5105--CALL     5145--CALL     5286--CALL     5415--CALL     5433--CALL
FMR$U8
      4576**DCL-ENT  4990--CALL     5118--CALL     5167--CALL     5297--CALL     5439--CALL     5464--CALL
      5468--CALL
FMR$Z8
      4578**DCL-ENT  5315--CALL
FMS$GARBCOL
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:304  
      4580**DCL-ENT  4989--CALL
FMS$RELACCT
      4581**DCL-ENT  5019--CALL     5440--CALL
FMS$SCANACCT
      4579**DCL-ENT  4792--CALL
FMX$SET
      2282**DCL      4727--ASSIGN   4984--ASSIGN   5161--ASSIGN
FMX$SET.CHKSM
      2284**DCL      5112<<ASSIGN   5165<<ASSIGN   5518>>IF
FMX$SET.DCTX
      2282**DCL      5062>>ASSIGN   5063<<ASSIGN   5069>>IF       5074>>IF       5078>>ASSIGN   5109>>IF
      5129>>ASSIGN   5135<<ASSIGN   5519>>ASSIGN
FMX$SET.DUAL
      2283**DCL      5074>>IF
FMX$SET.PSN
      2282**DCL      4950>>ASSIGN   5074>>IF       5080<<ASSIGN   5082>>ASSIGN   5091<<ASSIGN   5108>>IF
      5114>>ASSIGN   5164>>ASSIGN   5376<>CALL     5514>>IF
FMX$SET.REALPSN
      2284**DCL      5074>>IF       5080>>ASSIGN   5081<<ASSIGN   5082<<ASSIGN   5113<<ASSIGN   5114<<ASSIGN
      5163<<ASSIGN   5164<<ASSIGN   5514>>IF
FMX$SET.SET
      2282**DCL      4742>>IF       5054>>IF       5059>>IF       5074>>IF
FMX$SET.SETL
      2284**DCL      5094>>ASSIGN   5148>>ASSIGN
FMX$SET.SYSID
      2283**DCL      5137>>IF       5361>>IF
FMX$SET.USERLIST
      2283**DCL      2283--REDEF
FM_PADSDA
      4606**DCL      4762<>CALL     5419<>CALL
FM_SRZERO
      4605**DCL      4733>>ASSIGN   5034<>CALL     5041>>IF       5185<>CALL     5202<>CALL     5278>>IF
      5279>>DOWHILE  5281>>IF       5282>>ASSIGN   5294>>ASSIGN   5301>>IF       5539>>ASSIGN   5547<>CALL
FM_SYSSETX
      4607**DCL      5015>>IF       5430<<ASSIGN
FPT$CLOSE_V.DISP
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:305  
      1855**DCL      4997>>DOCASE
FPT$CLOSE_V.EXPIRE
      1859**DCL      1859--REDEF
FPT$CLOSE_V.TYPE
      1858**DCL      1858--REDEF
FPT$CLOSE_V.XTNSIZE
      1855**DCL      1855--REDEF    1857--REDEF
FPT$OPEN_V.DELETE
      1863**DCL      4774>>IF       4785>>IF       4796>>IF       4807>>IF       4836>>IF       4850>>IF
FPT$OPEN_V.EXPIRE
      1869**DCL      4808>>IF       4812>>ASSIGN
FPT$OPEN_V.FSN
      1873**DCL      1873--REDEF    1874--REDEF
FR$RAT
      4054**DCL      5372<>CALL     5447<>CALL
FR$RAT.FLG.DOWN
      4089**DCL      5344>>IF
FR$RAT.FLG.MBIT
      4081**DCL      5223<<ASSIGN   5366<<ASSIGN
FR$RAT.FLG.MBIT.MTD
      4082**DCL      5141<<ASSIGN   5346<<ASSIGN   5383<<ASSIGN
FR$RAT.FLG.OPN
      4086**DCL      5140<<ASSIGN   5224<<ASSIGN   5365<<ASSIGN
FR$RAT.M1
      4076**DCL      5348<>CALL     5353>>ASSIGN
FR$RAT.REEL.ASID
      4074**DCL      5346>>IF
FR$RAT.RES.ACTX
      4060**DCL      5351<<ASSIGN
FR$RAT.RES.NUMB
      4058**DCL      5350<<ASSIGN
FR$RAT.RES.RFLG.NOSLD
      4064**DCL      5358<<ASSIGN
FR$RAT.RES.RFLG.OLT
      4063**DCL      5371>>IF       5447>>IF
FR$RAT.RES.SISID
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:306  
      4057**DCL      5139>>IF       5342>>IF       5371>>IF
FRA$OPR
      4583**DCL-ENT  5356--CALL
FRC$AVR
      4582**DCL-ENT  5355--CALL     5376--CALL
FRZ$GETRES
      4584**DCL-ENT  5348--CALL
FRZ$RRESNA
      4586**DCL-ENT  5372--CALL     5447--CALL
GETRES
      5340**LABEL    5275--GOTO
I
      4670**DCL      4545--IMP-SIZ  4671--REDEF    4789<>CALL     4855<<ASSIGN   4863>>ASSIGN   4863>>ASSIGN
      4874<<ASSIGN   4875>>DOCASE   4893<<ASSIGN   4894>>ASSIGN   4894>>ASSIGN   4911<<ASSIGN   4912>>ASSIGN
      4912>>ASSIGN   4916>>ASSIGN   4983<<ASSIGN   4984>>ASSIGN   5015>>IF       5019<>CALL     5030>>IF
      5046<<ASSIGN   5048>>DOWHILE  5049>>IF       5049>>ASSIGN   5050<<ASSIGN   5050>>ASSIGN   5053<<ASSIGN
      5054>>IF       5054>>IF       5059>>IF       5059>>IF       5062>>ASSIGN   5063>>ASSIGN   5069>>IF
      5074>>IF       5082>>ASSIGN   5082>>ASSIGN   5091>>ASSIGN   5106<<ASSIGN   5107>>DOWHILE  5108>>IF
      5109>>IF       5112>>ASSIGN   5113>>ASSIGN   5114>>ASSIGN   5125>>ASSIGN   5127>>ASSIGN   5129>>ASSIGN
      5131<<ASSIGN   5135>>IF       5135>>ASSIGN   5136>>ASSIGN   5148<<ASSIGN   5148>>ASSIGN   5152<>CALL
      5155>>ASSIGN   5160<<ASSIGN   5162>>ASSIGN   5163>>ASSIGN   5164>>ASSIGN   5165>>ASSIGN   5226<<ASSIGN
      5227>>DOWHILE  5228>>IF       5230>>IF       5230>>IF       5239>>ASSIGN   5240>>ASSIGN   5246>>ASSIGN
      5247>>ASSIGN   5248>>ASSIGN   5255>>IF       5266<<ASSIGN   5266>>ASSIGN   5279>>DOWHILE  5279>>DOWHILE
      5279>>DOWHILE  5279>>DOWHILE  5281>>IF       5281>>IF       5281>>IF       5282>>ASSIGN   5284>>IF
      5293>>ASSIGN   5294>>ASSIGN   5294>>ASSIGN   5295>>IF       5295>>ASSIGN   5301>>IF       5301>>IF
      5301>>IF       5308<<ASSIGN   5308>>ASSIGN   5329<<ASSIGN   5329>>ASSIGN   5359<<ASSIGN   5360>>DOWHILE
      5361>>IF       5361>>IF       5363<<ASSIGN   5363>>ASSIGN   5373<<ASSIGN   5376>>CALL     5440<>CALL
      5445<<ASSIGN   5447<>CALL     5454<<ASSIGN   5455>>DOWHILE  5456>>ASSIGN   5457<<DOINDEX  5458>>ASSIGN
      5461<<ASSIGN   5465<<ASSIGN   5497<<ASSIGN   5497>>ASSIGN   5511>>IF       5514>>IF       5514>>IF
      5518>>IF       5519>>ASSIGN   5571<<ASSIGN   5572<>CALL     5573<<ASSIGN   5573>>ASSIGN   5575>>DOWHILE
      5576<<ASSIGN   5576>>ASSIGN   5577>>IF       5577>>IF       5577>>IF       5587>>IF       5590<>CALL
IFPFIT.CODES
      2320**DCL      5588<>CALL
IFPFIT.CODES.CODE
      2320**DCL      4872>>DOINDEX  4874>>ASSIGN
IFPFIT.CODES.ITEMX
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:307  
      2320**DCL      4873>>ASSIGN
IFPFIT.CODES.NDW
      2320**DCL      4893>>ASSIGN   4911>>ASSIGN   5573>>ASSIGN
IS
      4671**DCL      5374<<ASSIGN   5376<>CALL     5377>>IF
JDCB$
      4664**DCL       523--IMP-PTR  4720<<ASSIGN   4722>>ASSIGN   4723>>ASSIGN   4725>>CALL     4726>>IF
      4727>>ASSIGN   4733>>ASSIGN   4734>>ASSIGN   4735>>ASSIGN   4738>>ASSIGN   4739>>IF       4739>>ASSIGN
      4741>>IF       4744>>IF       4748>>ASSIGN   4749>>IF       4749>>ASSIGN   4750>>ASSIGN   4752>>ASSIGN
      4753>>ASSIGN   4754>>ASSIGN   4757>>IF       4758>>ASSIGN   4773>>IF       4773>>ASSIGN   4789>>CALL
      4790>>ASSIGN   4802>>ASSIGN   4814>>ASSIGN   4822>>ASSIGN   4839>>IF       4853>>ASSIGN   4857>>IF
      4858>>ASSIGN   4859>>IF       4859>>IF       4863>>IF       4870>>IF       4871>>ASSIGN   4877>>IF
      4880>>IF       4881>>ASSIGN   4887>>IF       4904>>IF       4921>>ASSIGN   4937>>ASSIGN   4938>>ASSIGN
      4944>>IF       4950>>ASSIGN   4981<<ASSIGN   4983>>ASSIGN   4985>>IF       5057>>ASSIGN   5063>>IF
      5065>>IF       5135>>ASSIGN   5136>>ASSIGN   5156>>ASSIGN   5161>>ASSIGN   5179>>ASSIGN   5273>>ASSIGN
      5274>>CALLBLT  5299>>ASSIGN   5300>>IF       5301>>IF       5301>>IF       5301>>IF       5305>>ASSIGN
      5307>>ASSIGN   5311>>IF       5312>>IF       5314>>ASSIGN   5315>>CALL     5325>>ASSIGN   5327>>ASSIGN
      5337>>ASSIGN   5340>>ASSIGN   5352>>ASSIGN   5353>>ASSIGN   5355>>CALL     5366>>IF       5395>>ASSIGN
      5396<<ASSIGN   5397>>ASSIGN   5399>>ASSIGN   5400>>ASSIGN   5401>>ASSIGN   5402>>ASSIGN   5406<<ASSIGN
      5418>>ASSIGN   5430>>ASSIGN   5450>>ASSIGN   5465>>ASSIGN   5487>>ASSIGN   5512>>IF       5522>>IF
      5543>>ASSIGN   5546>>ASSIGN   5549>>ASSIGN   5569>>ASSIGN   5580>>ASSIGN   5587>>IF
J_PIG
      4636**DCL      5564<>CALL
KQM$UPDA
      4587**DCL-ENT  4891--CALL
KUW$WRITE
      4588**DCL-ENT  5564--CALL
MRRCHK
      5227**LABEL    5235--EXIT     5243--EXIT
N$DCT$
      4600**DCL      4731>>ASSIGN   4995>>ASSIGN   5138>>ASSIGN   5194>>IF       5200>>ASSIGN   5250>>ASSIGN
      5338>>ASSIGN   5357>>ASSIGN   5382>>ASSIGN   5383>>ASSIGN   5446>>ASSIGN
N$DCT$$
      4599**DCL      4600--IMP-PTR  4731>>ASSIGN   4995>>ASSIGN   5138>>ASSIGN   5194>>IF       5200>>ASSIGN
      5250>>ASSIGN   5338>>ASSIGN   5357>>ASSIGN   5382>>ASSIGN   5383>>ASSIGN   5446>>ASSIGN
NI$DCT.DEVNM
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:308  
      3705**DCL      4734>>ASSIGN
NI$DCT.DP
      3725**DCL      3732--REDEF    3735--REDEF    3736--REDEF    3738--REDEF    3738--REDEF    3739--REDEF
      3740--REDEF    3740--REDEF
NI$DCT.DP.MIRROR
      3727**DCL      5251<<ASSIGN
NI$DCT.DP.MIRROR.DCTX
      3730**DCL      5192>>ASSIGN   5194>>IF       5200>>IF       5200>>ASSIGN   5253<<ASSIGN
NI$DCT.DP.MIRROR.DRZERO
      3731**DCL      5255<<ASSIGN
NI$DCT.DP.MIRROR.FLAG
      3727**DCL      5189>>IF       5218>>IF       5252<<ASSIGN
NI$DCT.DP.MIRROR.LQ$
      3732**DCL      5256<<ASSIGN
NI$DCT.DP.MIRROR.PRI
      3729**DCL      5261<<ASSIGN   5271>>IF
NI$DCT.DP.MIRROR.READ
      3728**DCL      5258<<ASSIGN
NI$DCT.DP.MIRROR.STATE
      3729**DCL      5194>>IF       5199>>ASSIGN   5200>>ASSIGN   5213<<ASSIGN   5232>>IF       5233<<ASSIGN
      5382<<ASSIGN
NI$DCT.DP.MIRROR.UTS
      3731**DCL      5193>>ASSIGN   5254<<ASSIGN
NI$DCT.DP.MIRROR.WRITE
      3728**DCL      5257<<ASSIGN
NI$DCT.DVT$
      3721**DCL      4738>>ASSIGN
NI$DCT.MODX
      3714**DCL      4738>>ASSIGN
NI$DCT.MPC.IOCHANX
      3733**DCL      3733--REDEF
NI$DCT.RAT$
      3706**DCL      5138>>ASSIGN   5223>>ASSIGN   5224>>ASSIGN   5272>>ASSIGN   5338>>ASSIGN   5357>>ASSIGN
      5383>>ASSIGN   5446>>ASSIGN
NI$DVT.MODEL
      3745**DCL      4738>>ASSIGN
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:309  
NI$DVT.MPC
      3747**DCL      3748--REDEF
NOMNTIME
      5422**LABEL    5419--CALLALT  5421--CALLALT
NOMOD
      4922**LABEL    4878--CALLALT  4882--GOTO     4885--CALLALT  4910--CALLALT  4919--GOTO     4924--CALLALT
NOMSG
      5091**LABEL    5055--CALLALT
NORES
      5366**LABEL    5270--GOTO     5348--CALLALT  5362--GOTO
NOTDUAL
      5127**LABEL    5115--GOTO     5119--CALLALT
NOTNEW
      4848**LABEL    4797--GOTO     4803--GOTO     4832--GOTO
OCZ$SID_UN
      4589**DCL-ENT  5483--CALL
OPNDPX
      4745**LABEL    4944--GOTO
PIGMSG IN PROCEDURE XUSER
      5557**ENTRY    5058--CALL     5079--CALL     5089--CALL     5220--CALL     5241--CALL     5262--CALL
      5330--CALL     5336--CALL
PN$
      1609**DCL        39--PROC     4980--ENTRY
PN$.ACSVEH_
      1610**DCL      1610--REDEF
PN$.ALTKEYS_
      1612**DCL      1612--REDEF    1612--REDEF
PN$.FPARAM_
      1611**DCL      4782>>IF       4862>>IF       4863>>ASSIGN   4866<>CALL
PN$.HDR_
      1611**DCL      1611--REDEF
PN$.IFPARAM_
      1610**DCL      2320--IMP-PTR  4782>>IF       4784>>IF       4836>>IF       4869>>IF       4872>>DOINDEX
      4873>>ASSIGN   4873>>ASSIGN   4874>>ASSIGN   4893>>ASSIGN   4911>>ASSIGN   5588>>CALL
PN$.SN_
      1609**DCL      1625--IMP-PTR
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:310  
PN$.TAB_
      1611**DCL      1611--REDEF
PN$.UHL_
      1609**DCL      1609--REDEF    1609--REDEF
PN$.V_
      1609**DCL      1854--IMP-PTR  1863--IMP-PTR  4774>>IF       4785>>IF       4796>>IF       4807>>IF
      4808>>IF       4812>>ASSIGN   4836>>IF       4850>>IF       4996>>IF       4997>>DOCASE
PN$.WSN_
      1611**DCL      1611--REDEF
READVID IN PROCEDURE CHKSM
      5542**ENTRY    5525--CALL     5553--CALL
READVID0 IN PROCEDURE XUSER
      5552**ENTRY    5040--CALL
RECI
      4545**DCL      4863<<ASSIGN   4863>>ASSIGN   4894<<ASSIGN   4894>>ASSIGN   4912<<ASSIGN   4912>>ASSIGN
RELSET
      5440**LABEL    5096--GOTO     5466--GOTO
RETALT
      4955**LABEL    4761--CALLALT  4787--CALLALT  4991--CALLALT  5019--CALLALT  5152--CALLALT  5440--CALLALT
RETALT IN PROCEDURE XUSER
      5528**LABEL    5588--CALLALT  5590--CALLALT
RETALTCFU
      4927**LABEL    4795--CALLALT  4800--CALLALT  4833--GOTO     4838--GOTO     4841--GOTO     4846--CALLALT
      4847--CALLALT  4850--GOTO     4854--GOTO     4861--GOTO     4866--CALLALT
RETRET IN PROCEDURE XUSER
      5584**LABEL    5572--CALLALT
SAMESET IN PROCEDURE XUSER
      5506**ENTRY    5055--CALL     5119--CALL
SCREECH
      4956**LABEL    5287--CALLALT  5356--CALLALT
SC_SETRES
      4590**DCL-ENT  4956--CALL     5558--CALL
SET$
      4669**DCL      2253--IMP-PTR  2270--IMP-PTR  2276--IMP-PTR  4727<<ASSIGN   4728>>ASSIGN   4733>>ASSIGN
      4737>>IF       4744>>IF       4752>>IF       4752>>IF       4753>>ASSIGN   4760>>ASSIGN   4764>>ASSIGN
      4771>>ASSIGN   4786>>IF       4799>>ASSIGN   4830>>ASSIGN   4871>>ASSIGN   4880>>ASSIGN   4905>>ASSIGN
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:311  
      4906>>ASSIGN   4935>>ASSIGN   4951>>ASSIGN   4952>>ASSIGN   4953>>ASSIGN   4954>>ASSIGN   4984<<ASSIGN
      4985>>IF       4985>>IF       4985>>IF       4993>>ASSIGN   4994>>IF       5014>>IF       5020>>CALL
      5030>>IF       5034>>IF       5036>>IF       5039>>IF       5041>>IF       5049>>IF       5053>>ASSIGN
      5054>>ASSIGN   5058>>IF       5061>>ASSIGN   5063>>ASSIGN   5066>>ASSIGN   5083>>IF       5084>>ASSIGN
      5085>>CALLBLT  5088>>CALLBLT  5096>>IF       5100>>IF       5102>>ASSIGN   5103>>ASSIGN   5107>>DOWHILE
      5113>>IF       5114>>ASSIGN   5120>>IF       5125>>ASSIGN   5127>>ASSIGN   5130>>DOWHILE  5134>>ASSIGN
      5135>>IF       5137>>IF       5137>>IF       5138>>ASSIGN   5150>>IF       5153<<ASSIGN   5154>>ASSIGN
      5156>>ASSIGN   5158>>ASSIGN   5159>>ASSIGN   5161<<ASSIGN   5162>>ASSIGN   5163>>IF       5164>>ASSIGN
      5169>>IF       5170>>ASSIGN   5171>>ASSIGN   5172>>ASSIGN   5173>>ASSIGN   5177>>IF       5185>>IF
      5187>>IF       5188>>ASSIGN   5190>>IF       5191>>ASSIGN   5192>>ASSIGN   5193>>ASSIGN   5196>>ASSIGN
      5198>>IF       5198>>IF       5208>>IF       5210>>ASSIGN   5211>>ASSIGN   5212>>ASSIGN   5217>>IF
      5218>>IF       5219>>ASSIGN   5221>>IF       5222>>IF       5222>>ASSIGN   5228>>IF       5237>>IF
      5247>>ASSIGN   5268>>ASSIGN   5269>>IF       5270>>IF       5274>>CALLBLT  5278>>IF       5279>>DOWHILE
      5281>>IF       5282>>ASSIGN   5289>>ASSIGN   5295>>IF       5319>>IF       5320>>ASSIGN   5333>>IF
      5333>>ASSIGN   5333>>ASSIGN   5339>>IF       5339>>IF       5352>>ASSIGN   5359>>ASSIGN   5373>>ASSIGN
      5374>>IF       5374>>IF       5377>>IF       5377>>IF       5377>>IF       5381>>ASSIGN   5382>>ASSIGN
      5383>>ASSIGN   5384>>ASSIGN   5387>>ASSIGN   5388>>ASSIGN   5393>>IF       5399>>ASSIGN   5414>>ASSIGN
      5428>>ASSIGN   5430>>IF       5434>>ASSIGN   5435>>ASSIGN   5436>>IF       5436>>IF       5438>>ASSIGN
      5440>>IF       5441>>CALL     5442>>ASSIGN   5443>>ASSIGN   5454>>ASSIGN   5455>>IF       5463>>ASSIGN
      5466>>IF       5486>>ASSIGN   5496>>CALL     5512>>IF       5512>>IF
SSR$RUE
      4591**DCL-ENT  5493--CALL
SSS$SYSTIME
      4592**DCL-ENT  4813--CALL     4925--CALL     5423--CALL
SSV$EVENT
      4593**DCL-ENT  5489--CALL
S_CUN
      4608**DCL      5484>>IF
T$
      4680**DCL      4721--ASSIGN   4760<<ASSIGN   4764<<ASSIGN   4768>>ASSIGN   4771<<ASSIGN   4794<<ASSIGN
      4799<<ASSIGN   4806>>ASSIGN   4830<<ASSIGN   4865<<ASSIGN   4913<<ASSIGN   4915>>ASSIGN   4923<<ASSIGN
      4925>>CALL     4933<<ASSIGN   4935<<ASSIGN   4982--ASSIGN   5032>>ASSIGN   5153>>ASSIGN   5182>>ASSIGN
      5288>>ASSIGN   5322<<ASSIGN   5347<<ASSIGN   5354<<ASSIGN   5375<<ASSIGN   5420<<ASSIGN   5420>>ASSIGN
      5422>>IF       5422>>IF       5423>>CALL     5545>>ASSIGN   5548>>ASSIGN   5570<<ASSIGN   5577>>IF
      5577>>IF       5577>>IF       5589<<ASSIGN   5591>>ASSIGN
T$$
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:312  
      4681**DCL      4682--IMP-PTR  4721<<ASSIGN   4761>>CALL     4762>>CALL     4765>>CALL     4772>>CALL
      4795>>CALL     4800>>CALL     4805>>CALL     4831>>CALL     4866>>CALL     4914>>CALL     4924>>CALL
      4934>>CALL     4936>>CALL     4982<<ASSIGN   5031>>CALL     5034>>CALL     5152>>CALL     5181>>CALL
      5185>>CALL     5202>>CALL     5287>>CALL     5348>>CALL     5355>>CALL     5376>>CALL     5419>>CALL
      5421>>CALL     5544>>CALL     5547>>CALL     5572>>CALL     5590>>CALL
UN IN PROCEDURE XUSER
      5480**DCL      5483<>CALL
UN.UN IN PROCEDURE XUSER
      5482**DCL      5484>>IF       5485>>IF       5489<>CALL     5493<>CALL     5494>>IF       5494>>IF
UNSET IN PROCEDURE XUSER
      5496**LABEL    5483--CALLALT
UQB$MDEQ
      4596**DCL-ENT  4765--CALL     4772--CALL     4831--CALL     4934--CALL     4936--CALL
UQB$MENQS
      4594**DCL-ENT  4761--CALL
UQB$MENQX
      4595**DCL-ENT  4795--CALL     4800--CALL
VID
      2287**DCL      5184<<ASSIGN   5545<<ASSIGN
VID.DGT
      2289**DCL      5041>>IF       5041>>IF
VID.DTT
      2289**DCL      2289--REDEF
VID.ID
      2287**DCL      5033<<ASSIGN   5036>>IF       5186>>IF       5526>>IF
VID.MIRROR.C
      2288**DCL      5206>>IF
VID.MIRROR.STATE
      2288**DCL      5199<<ASSIGN   5200<<ASSIGN   5203<<ASSIGN   5206>>IF       5209>>IF
VID.MIRROR.UTS
      2288**DCL      5211>>ASSIGN
VID.PSN
      2287**DCL      5038>>IF       5108>>IF       5121<<CALLBLT  5124<<CALLBLT  5158>>ASSIGN   5514>>IF
      5514>>IF
VID.SECTSTRT
      2288**DCL      5041>>IF       5041>>IF       5278>>IF       5278<<ASSIGN   5279>>DOWHILE  5279>>DOWHILE
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:313  
      5279>>DOWHILE  5281>>IF       5281>>IF       5281>>IF       5282<<ASSIGN   5284>>IF       5293>>ASSIGN
      5294>>ASSIGN   5294>>ASSIGN   5301>>IF       5301>>IF       5301>>IF
VID.SNLIST
      2290**DCL      5529>>IF       5529>>IF
VID.SNLIST.VSN
      2290**DCL      5049>>IF
VID.SNLIST.VSN.N
      2290**DCL      5121>>CALLBLT  5536>>ASSIGN
VID.SNLIST.VSN.S
      2290**DCL      5122>>IF       5123>>ASSIGN   5537>>ASSIGN
VID.SYSSIZE
      2287**DCL      5255>>ASSIGN
VID.VOLCNT
      2287**DCL      5038>>IF       5038<<ASSIGN   5043<<ASSIGN   5048>>DOWHILE  5052<<ASSIGN   5100>>IF
      5511>>IF       5514>>IF       5527>>IF       5527>>IF       5528>>DOINDEX  5535>>DOINDEX
VID.VSN
      2287**DCL      5036>>IF       5036<<ASSIGN   5038>>IF       5186>>IF       5186<<ASSIGN   5196>>ASSIGN
      5206>>IF       5215<<ASSIGN   5222>>IF       5228>>IF       5228>>IF       5234<<ASSIGN   5268>>ASSIGN
      5284>>IF       5291>>ASSIGN   5301>>IF       5332>>ASSIGN   5512>>IF
VOL
      2270**DCL      5296--ASSIGN
VOL.DCTX
      2270**DCL      5138>>ASSIGN   5172>>ASSIGN   5173>>ASSIGN   5289<<ASSIGN
VOL.DRZERO
      2272**DCL      5293<<ASSIGN
VOL.NXTSDA
      2272**DCL      5041>>IF       5294<<ASSIGN   5295>>IF
VOL.RGRANS
      2273**DCL      5102<<ASSIGN   5113>>IF       5114>>ASSIGN   5120>>IF       5125<<ASSIGN   5163>>IF
      5164>>ASSIGN
VOL.SECT#
      2270**DCL      5137>>IF       5295<<ASSIGN
VOL.SECTL
      2272**DCL      5290<<ASSIGN
VOL.SETX
      2270**DCL      5053>>ASSIGN   5061<<ASSIGN   5100>>IF       5107>>DOWHILE  5127<<ASSIGN   5135>>IF
PL6.E3A0      #003=FMN$OPNDP File=FMN$OPNDP.:E05TSI                              TUE 07/29/97 16:52 Page:314  
      5137>>IF       5150>>IF       5162<<ASSIGN
VOL.SPIN
      2271**DCL      5034>>IF       5039>>IF
VOL.SYSID
      2272**DCL      5058>>IF       5512>>IF
VOL.USERLIST
      2271**DCL      2272--REDEF
VOL.VOL#
      2272**DCL      5054<<ASSIGN   5130>>DOWHILE
VOL.VOLL
      2272**DCL      5063>>ASSIGN   5066>>ASSIGN   5103<<ASSIGN   5134<<ASSIGN
VOL.VSN
      2270**DCL      5036>>IF       5291<<ASSIGN   5512>>IF
VOL.XCL
      2270**DCL      5292<<ASSIGN
XT$
      4682**DCL      4761<>CALL     4762<>CALL     4765<>CALL     4772<>CALL     4795<>CALL     4800<>CALL
      4805<>CALL     4831<>CALL     4866<>CALL     4914<>CALL     4924<>CALL     4934<>CALL     4936<>CALL
      5031<>CALL     5034<>CALL     5152<>CALL     5181<>CALL     5185<>CALL     5202<>CALL     5287<>CALL
      5348<>CALL     5355<>CALL     5376<>CALL     5419<>CALL     5421<>CALL     5544<>CALL     5547<>CALL
      5572<>CALL     5590<>CALL
XUSER
      5474**PROC     5459--CALL

PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:315  
     1488        1        /*T***********************************************************/
     1489        2        /*T*                                                         */
     1490        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1491        4        /*T*                                                         */
     1492        5        /*T***********************************************************/
     1493        6                    /*F*     NAME: FMN$MADMUCK
     1494        7                   *        PURPOSE: To perform read, write, and delete functions on keys of
     1495        8                    *        the MAD.
     1496        9                    *        DESCRIPTION: The M$MADMUCK FPT dictates what function(s)
     1497       10                    *        to perform with the ACCT and SN parameters.
     1498       11                    */
     1499       12        FMN$MADMUCK: PROC;
     1500       13        %INCLUDE F$CP6V_C;
     1501      239        %INCLUDE F_CP6;
     1502     1264        %FPT$MADMUCK_V(FPTN=FPTV,BASED="BASED(B$PS0$)");
     1503     1267        %INCLUDE F$JIT_C;
     1504     1697        %INCLUDE FM$MACROS;
     1505     2072        %INCLUDE F_ERRORS_C;
     1506     2312        %INCLUDE UD_ERRORS_C;
     1507     2354        %INCLUDE CP_6_SUBS;
     1508     2894        %MACRO F$DCB(BASED=BASED);
     1509     2895        %INCLUDE F$DCB;
     1510     2944        %MEND;
     1511     2945        %F$DCB(BASED="BASED(JDCB$)");
     1512     2995        %FM$CFUA(BASED="BASED(ACCT$)");
     1513     3001        %VLP_ACCT(FPTN=ACCT,STCLASS="BASED(B$PS1$)");
     1514     3014        %VLP_SN(FPTN=PSN,STCLASS="BASED(B$PS2$)");
     1515     3027        %FM$MADKEY(BASED="BASED(KEY$)");
     1516     3030    1   DCL JDCB$ PTR;
     1517     3031    1   DCL KEY$ PTR;
     1518     3032    1   DCL SEG$ PTR;
     1519     3033    1   DCL ACCT$ PTR;
     1520     3034        %SUB FCG#='0615'O;
     1521     3035        %SUB MID#='16'O;
     1522     3036        %ERRCODE(NAME=FMN$E$OLDREC,COD#=%E$OLDREC);
     1523     3040        %ERRCODE(NAME=FMN$E$NOTAUTH,COD#=%E$NOTAUTH);
     1524     3044        %ERRCODE(NAME=FMN$E$NOKEY,COD#=%E$NOKEY);
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:316  
     1525     3048                    /* ENTREFS */
     1526     3049    1   DCL FMD$REDBUF ENTRY(6)ALTRET;
     1527     3050    1   DCL FMD$FLSHBUF ENTRY(1);
     1528     3051    1   DCL FMG$ADDKEY ENTRY(4) ALTRET;
     1529     3052    1   DCL FMG$FINDKEY ENTRY(4) ALTRET;
     1530     3053    1   DCL FMG$REMKEY ENTRY ALTRET;
     1531     3054    1   DCL FMM$SCRUB ENTRY(1);
     1532     3055    1   DCL FMO$PACKACCT ENTRY(2);
     1533     3056    1   DCL FMP$CLSJ ENTRY;
     1534     3057    1   DCL FMR$SLIDE ENTRY(3);
     1535     3058    1   DCL FMR$L8 ENTRY;
     1536     3059    1   DCL FMR$U8 ENTRY;
     1537     3060    1   DCL HFF$TRAPALT ENTRY ALTRET;
     1538     3061    1   DCL HFF$WRITE1 ENTRY(1)ALTRET;
     1539     3062    1   DCL UQB$MENQS ENTRY(1)ALTRET;
     1540     3063    1   DCL UQB$MENQX ENTRY(1)ALTRET;
     1541     3064    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
     1542     3065                    /* SYMREFS */
     1543     3066    1   DCL B$PS0$ PTR SYMREF;
     1544     3067    1   DCL B$PS1$ PTR SYMREF;
     1545     3068    1   DCL B$PS2$ PTR SYMREF;
     1546     3069    1   DCL B$JIT$ PTR SYMREF;
     1547     3070    1   DCL FM$SET$ PTR SYMREF;
     1548     3071    1   DCL FM_MADSDA UBIN SYMREF;
     1549     3072    1   DCL FM_SYSSETX UBIN SYMREF;
     1550     3073                    /**/
     1551     3074    1      JDCB$=DCBADDR(1); /* USE M$* FOR PLACE TO HOOK BUFFERS */
     1552     3075    1      B$JIT.DCB$=JDCB$;
     1553     3076    1      IF F$DCB.FCD THEN CALL FMP$CLSJ;
     1554     3077    1      CALL FMM$SCRUB(JDCB$);
     1555     3078    1      ACCT$=ADDR(F$DCB.ACCT);
     1556     3079    1      F$DCB.ACCT=ACCT.ACCT#;
     1557     3080    1      CALL FMO$PACKACCT(JDCB$,ACCT$);
     1558     3081    1      IF FPTV.WRITE THEN F$DCB.PSN=PSN.SN#(0);
     1559     3082    1      F$DCB.SETX=FM_SYSSETX;
     1560     3083    1      F$DCB.GTYP=FMGTMAD;
     1561     3084    1      IF FPTV.WRITE OR FPTV.DELETE
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:317  
     1562     3085    1      THEN CALL UQB$MENQX(FM$SET$)ALTRET(RETALT);
     1563     3086    1      ELSE CALL UQB$MENQS(FM$SET$)ALTRET(RETALT);
     1564     3087    1      CALL HFF$TRAPALT ALTRET(RETALTU);
     1565     3088    1      CALL FMD$REDBUF(KEY$,1,FM_MADSDA,,0) ALTRET(RETALTU);
     1566     3089    1      CALL FMG$FINDKEY(SEG$,SEG$,KEY$,ACCT$) ALTRET(NOKEY);
     1567     3090    1      IF FPTV.WRITE
     1568     3091    1      THEN IF F$DCB.PSN=FM$MADKEY.PSN THEN GOTO RETALTU; /*OK IF NO CHANGE*/
     1569     3092    1         ELSE B$JIT.ERR=FMN$E$OLDREC;
     1570     3093    2      IF FPTV.READ THEN DO;
     1571     3094    2         F$DCB.PSN=FM$MADKEY.PSN;
     1572     3095    2         CALL HFF$WRITE1(2)ALTRET(NOWRITE);
     1573     3096    2         PSN.SN#(0)=FM$MADKEY.PSN;
     1574     3097    2   NOWRITE:;
     1575     3098    2         END;
     1576     3099    2      IF FPTV.DELETE THEN DO;
     1577     3100    2         IF NOT B$JIT.PRIV.ACTIVE&%PR_FMDIAG# THEN GOTO NOPRIV;
     1578     3101    2         CALL FMG$REMKEY;
     1579     3102    2         CALL FMR$L8;
     1580     3103                    /* NOW MARK NON-PUBLIC ANY ACCT BLOCKS */
     1581     3104    2         ACCT$=PINCRW(FM$SET$,FM$SET$->FM$CFUA.LINKX);
     1582     3105    3         DO WHILE(ACCT$~=FM$SET$);
     1583     3106    3            IF FM$CFUA.ACCT=ACCT.ACCT# THEN FM$CFUA.PRIV='1'B;
     1584     3107    3            ACCT$=PINCRW(FM$SET$,FM$CFUA.LINKX);
     1585     3108    3            END;
     1586     3109    2         CALL FMR$U8;
     1587     3110    2         END;
     1588     3111    1   RETALTU:;
     1589     3112    1      CALL FMD$FLSHBUF(1);
     1590     3113    1      CALL UQB$MDEQ(FM$SET$);
     1591     3114    1   RETALT:;
     1592     3115    1      RETURN;
     1593     3116                    /**/
     1594     3117    1   NOKEY:;
     1595     3118    1      IF B$JIT.ERR.CODE=%E$NOKEY THEN B$JIT.ERR=FMN$E$NOKEY;
     1596     3119    1      IF NOT FPTV.WRITE
     1597     3120    1        OR FPTV.READ OR FPTV.DELETE
     1598     3121    1        OR B$JIT.ERR.CODE~=%E$NOKEY THEN GOTO RETALTU;
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:318  
     1599     3122    1      B$JIT.ERR='0'B;
     1600     3123    1      IF NOT B$JIT.PRIV.ACTIVE&%PR_FMDIAG# THEN GOTO NOPRIV;
     1601     3124    1      CALL FMG$ADDKEY(SEG$,2,KEY$,ACCT$) ALTRET(RETALTU);
     1602     3125    1      FM$MADKEY.PSN=F$DCB.PSN;
     1603     3126    1      GOTO RETALTU;
     1604     3127                    /**/
     1605     3128    1   NOPRIV:;
     1606     3129    1      B$JIT.ERR=FMN$E$NOTAUTH;
     1607     3130    1      GOTO RETALTU;
     1608     3131    1   END FMN$MADMUCK;
     1609     3132        %EOD;

PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:319  
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F_CP6.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$MADMUCK.

   Procedure FMN$MADMUCK requires 218 words for executable code.
   Procedure FMN$MADMUCK requires 14 words of local(AUTO) storage.

PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:320  

 Object Unit name= FMN$MADMUCK                                File name= FMN$OPNDP.:E05TOU
 UTS= JUL 29 '97 16:54:26.96 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      4      4  FMN$MADMUCK
    1   Proc  even  none   218    332  FMN$MADMUCK
    2  RoData even  none     7      7  FMN$MADMUCK

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  FMN$MADMUCK
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:321  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FMP$CLSJ
         yes           Std       1 FMM$SCRUB
 yes     yes           Std       1 UQB$MENQS
 yes     yes           Std       1 HFF$WRITE1
 yes     yes           Std       0 HFF$TRAPALT
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       4 FMG$ADDKEY
 yes     yes           Std       1 UQB$MDEQ
         yes           Std       2 FMO$PACKACCT
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       4 FMG$FINDKEY
         yes           Std       0 FMR$L8
 yes     yes           Std       6 FMD$REDBUF
 yes     yes           Std       0 FMG$REMKEY
         yes           Std       0 FMR$U8
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$PS0$                                B$PS1$                                B$PS2$
     B$JIT$                                FM$SET$                               FM_MADSDA
     FM_SYSSETX                            B_VECTNIL
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:322  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 ISSID
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:323  


     1488        1        /*T***********************************************************/
     1489        2        /*T*                                                         */
     1490        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1491        4        /*T*                                                         */
     1492        5        /*T***********************************************************/
     1493        6                    /*F*     NAME: FMN$MADMUCK
     1494        7                   *       PURPOSE: To perform read, write, and delete functions on keys of
     1495        8                    *        the MAD.
     1496        9                    *        DESCRIPTION: The M$MADMUCK FPT dictates what function(s)
     1497       10                    *        to perform with the ACCT and SN parameters.
     1498       11                    */
     1499       12        FMN$MADMUCK: PROC;

     12  1 000000   000000 700200 xent  FMN$MADMUCK  TSX0  ! X66_AUTO_0
         1 000001   000016 000000                    ZERO    14,0

     1500       13        %INCLUDE F$CP6V_C;
     1501      239        %INCLUDE F_CP6;
     1502     1264        %FPT$MADMUCK_V(FPTN=FPTV,BASED="BASED(B$PS0$)");
     1503     1267        %INCLUDE F$JIT_C;
     1504     1697        %INCLUDE FM$MACROS;
     1505     2072        %INCLUDE F_ERRORS_C;
     1506     2312        %INCLUDE UD_ERRORS_C;
     1507     2354        %INCLUDE CP_6_SUBS;
     1508     2894        %MACRO F$DCB(BASED=BASED);
     1509     2895        %INCLUDE F$DCB;
     1510     2944        %MEND;
     1511     2945        %F$DCB(BASED="BASED(JDCB$)");
     1512     2995        %FM$CFUA(BASED="BASED(ACCT$)");
     1513     3001        %VLP_ACCT(FPTN=ACCT,STCLASS="BASED(B$PS1$)");
     1514     3014        %VLP_SN(FPTN=PSN,STCLASS="BASED(B$PS2$)");
     1515     3027        %FM$MADKEY(BASED="BASED(KEY$)");
     1516     3030    1   DCL JDCB$ PTR;
     1517     3031    1   DCL KEY$ PTR;
     1518     3032    1   DCL SEG$ PTR;
     1519     3033    1   DCL ACCT$ PTR;
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:324  
     1520     3034        %SUB FCG#='0615'O;
     1521     3035        %SUB MID#='16'O;
     1522     3036        %ERRCODE(NAME=FMN$E$OLDREC,COD#=%E$OLDREC);
     1523     3040        %ERRCODE(NAME=FMN$E$NOTAUTH,COD#=%E$NOTAUTH);
     1524     3044        %ERRCODE(NAME=FMN$E$NOKEY,COD#=%E$NOKEY);
     1525     3048                    /* ENTREFS */
     1526     3049    1   DCL FMD$REDBUF ENTRY(6)ALTRET;
     1527     3050    1   DCL FMD$FLSHBUF ENTRY(1);
     1528     3051    1   DCL FMG$ADDKEY ENTRY(4) ALTRET;
     1529     3052    1   DCL FMG$FINDKEY ENTRY(4) ALTRET;
     1530     3053    1   DCL FMG$REMKEY ENTRY ALTRET;
     1531     3054    1   DCL FMM$SCRUB ENTRY(1);
     1532     3055    1   DCL FMO$PACKACCT ENTRY(2);
     1533     3056    1   DCL FMP$CLSJ ENTRY;
     1534     3057    1   DCL FMR$SLIDE ENTRY(3);
     1535     3058    1   DCL FMR$L8 ENTRY;
     1536     3059    1   DCL FMR$U8 ENTRY;
     1537     3060    1   DCL HFF$TRAPALT ENTRY ALTRET;
     1538     3061    1   DCL HFF$WRITE1 ENTRY(1)ALTRET;
     1539     3062    1   DCL UQB$MENQS ENTRY(1)ALTRET;
     1540     3063    1   DCL UQB$MENQX ENTRY(1)ALTRET;
     1541     3064    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
     1542     3065                    /* SYMREFS */
     1543     3066    1   DCL B$PS0$ PTR SYMREF;
     1544     3067    1   DCL B$PS1$ PTR SYMREF;
     1545     3068    1   DCL B$PS2$ PTR SYMREF;
     1546     3069    1   DCL B$JIT$ PTR SYMREF;
     1547     3070    1   DCL FM$SET$ PTR SYMREF;
     1548     3071    1   DCL FM_MADSDA UBIN SYMREF;
     1549     3072    1   DCL FM_SYSSETX UBIN SYMREF;
     1550     3073                    /**/
     1551     3074    1      JDCB$=DCBADDR(1); /* USE M$* FOR PLACE TO HOOK BUFFERS */

   3074  1 000002   000000 470400 2                  LDP0    0
         1 000003   000000 471500                    LDP1    0,,PR0
         1 000004   100001 236100                    LDQ     1,,PR1
         1 000005   200003 756100                    STQ     JDCB$,,AUTO
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:325  

     1552     3075    1      B$JIT.DCB$=JDCB$;

   3075  1 000006   000000 473400 xsym               LDP3    B$JIT$
         1 000007   300232 756100                    STQ     154,,PR3

     1553     3076    1      IF F$DCB.FCD THEN CALL FMP$CLSJ;

   3076  1 000010   200003 474500                    LDP4    JDCB$,,AUTO
         1 000011   400031 236100                    LDQ     25,,PR4
         1 000012   020000 316007                    CANQ    8192,DL
         1 000013   000017 600000 1                  TZE     s:3077

   3076  1 000014   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000015   000000 701000 xent               TSX1    FMP$CLSJ
         1 000016   000000 011000                    NOP     0

     1554     3077    1      CALL FMM$SCRUB(JDCB$);

   3077  1 000017   200003 630500                    EPPR0   JDCB$,,AUTO
         1 000020   200010 450500                    STP0    ACCT$+2,,AUTO
         1 000021   200010 630500                    EPPR0   ACCT$+2,,AUTO
         1 000022   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000023   000000 701000 xent               TSX1    FMM$SCRUB
         1 000024   000000 011000                    NOP     0

     1555     3078    1      ACCT$=ADDR(F$DCB.ACCT);

   3078  1 000025   200003 236100                    LDQ     JDCB$,,AUTO
         1 000026   000020 036003                    ADLQ    16,DU
         1 000027   200006 756100                    STQ     ACCT$,,AUTO

     1556     3079    1      F$DCB.ACCT=ACCT.ACCT#;

   3079  1 000030   000000 470400 xsym               LDP0    B$PS1$
         1 000031   200003 471500                    LDP1    JDCB$,,AUTO
         1 000032   040100 100500                    MLR     fill='040'O
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:326  
         1 000033   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 000034   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8

     1557     3080    1      CALL FMO$PACKACCT(JDCB$,ACCT$);

   3080  1 000035   200006 633500                    EPPR3   ACCT$,,AUTO
         1 000036   200011 453500                    STP3    ACCT$+3,,AUTO
         1 000037   200003 634500                    EPPR4   JDCB$,,AUTO
         1 000040   200010 454500                    STP4    ACCT$+2,,AUTO
         1 000041   200010 630500                    EPPR0   ACCT$+2,,AUTO
         1 000042   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000043   000000 701000 xent               TSX1    FMO$PACKACCT
         1 000044   000000 011000                    NOP     0

     1558     3081    1      IF FPTV.WRITE THEN F$DCB.PSN=PSN.SN#(0);

   3081  1 000045   000000 470400 xsym               LDP0    B$PS0$
         1 000046   000000 236100                    LDQ     0,,PR0
         1 000047   200000 316007                    CANQ    65536,DL
         1 000050   000056 600000 1                  TZE     s:3082

   3081  1 000051   000000 471400 xsym               LDP1    B$PS2$
         1 000052   200003 473500                    LDP3    JDCB$,,AUTO
         1 000053   040100 100500                    MLR     fill='040'O
         1 000054   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6
         1 000055   300024 000006                    ADSC9   20,,PR3                  cn=0,n=6

     1559     3082    1      F$DCB.SETX=FM_SYSSETX;

   3082  1 000056   000000 720000 xsym               LXL0    FM_SYSSETX
         1 000057   200003 471500                    LDP1    JDCB$,,AUTO
         1 000060   100051 440100                    SXL0    41,,PR1

     1560     3083    1      F$DCB.GTYP=FMGTMAD;

   3083  1 000061   100064 236100                    LDQ     52,,PR1
         1 000062   000001 376000 2                  ANQ     1
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:327  
         1 000063   010000 276003                    ORQ     4096,DU
         1 000064   100064 756100                    STQ     52,,PR1

     1561     3084    1      IF FPTV.WRITE OR FPTV.DELETE

   3084  1 000065   000000 236100                    LDQ     0,,PR0
         1 000066   200000 316007                    CANQ    65536,DL
         1 000067   000072 601000 1                  TNZ     s:3085
         1 000070   100000 316007                    CANQ    32768,DL
         1 000071   000077 600000 1                  TZE     s:3086

     1562     3085    1      THEN CALL UQB$MENQX(FM$SET$)ALTRET(RETALT);

   3085  1 000072   000002 630400 2                  EPPR0   2
         1 000073   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000074   000000 701000 xent               TSX1    UQB$MENQX
         1 000075   000254 702000 1                  TSX2    RETALT
         1 000076   000103 710000 1                  TRA     s:3087

     1563     3086    1      ELSE CALL UQB$MENQS(FM$SET$)ALTRET(RETALT);

   3086  1 000077   000002 630400 2                  EPPR0   2
         1 000100   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000101   000000 701000 xent               TSX1    UQB$MENQS
         1 000102   000254 702000 1                  TSX2    RETALT

     1564     3087    1      CALL HFF$TRAPALT ALTRET(RETALTU);

   3087  1 000103   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000104   000000 701000 xent               TSX1    HFF$TRAPALT
         1 000105   000244 702000 1                  TSX2    RETALTU

     1565     3088    1      CALL FMD$REDBUF(KEY$,1,FM_MADSDA,,0) ALTRET(RETALTU);

   3088  1 000106   000003 236000 2                  LDQ     3
         1 000107   200014 756100                    STQ     ACCT$+6,,AUTO
         1 000110   000001 236000 xsym               LDQ     B_VECTNIL+1
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:328  
         1 000111   000004 235000 2                  LDA     4
         1 000112   200012 757100                    STAQ    ACCT$+4,,AUTO
         1 000113   000005 236000 2                  LDQ     5
         1 000114   200011 756100                    STQ     ACCT$+3,,AUTO
         1 000115   200004 630500                    EPPR0   KEY$,,AUTO
         1 000116   200010 450500                    STP0    ACCT$+2,,AUTO
         1 000117   200010 630500                    EPPR0   ACCT$+2,,AUTO
         1 000120   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000121   000000 701000 xent               TSX1    FMD$REDBUF
         1 000122   000244 702000 1                  TSX2    RETALTU

     1566     3089    1      CALL FMG$FINDKEY(SEG$,SEG$,KEY$,ACCT$) ALTRET(NOKEY);

   3089  1 000123   200006 630500                    EPPR0   ACCT$,,AUTO
         1 000124   200013 450500                    STP0    ACCT$+5,,AUTO
         1 000125   200004 631500                    EPPR1   KEY$,,AUTO
         1 000126   200012 451500                    STP1    ACCT$+4,,AUTO
         1 000127   200005 633500                    EPPR3   SEG$,,AUTO
         1 000130   200011 453500                    STP3    ACCT$+3,,AUTO
         1 000131   200005 634500                    EPPR4   SEG$,,AUTO
         1 000132   200010 454500                    STP4    ACCT$+2,,AUTO
         1 000133   200010 630500                    EPPR0   ACCT$+2,,AUTO
         1 000134   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000135   000000 701000 xent               TSX1    FMG$FINDKEY
         1 000136   000255 702000 1                  TSX2    NOKEY

     1567     3090    1      IF FPTV.WRITE

   3090  1 000137   000000 470400 xsym               LDP0    B$PS0$
         1 000140   000000 236100                    LDQ     0,,PR0
         1 000141   200000 316007                    CANQ    65536,DL
         1 000142   000154 600000 1                  TZE     s:3093

     1568     3091    1      THEN IF F$DCB.PSN=FM$MADKEY.PSN THEN GOTO RETALTU; /*OK IF NO CHANGE*/

   3091  1 000143   200003 471500                    LDP1    JDCB$,,AUTO
         1 000144   200004 473500                    LDP3    KEY$,,AUTO
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:329  
         1 000145   040100 106500                    CMPC    fill='040'O
         1 000146   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
         1 000147   300002 400006                    ADSC9   2,,PR3                   cn=2,n=6
         1 000150   000244 600000 1                  TZE     RETALTU

     1569     3092    1         ELSE B$JIT.ERR=FMN$E$OLDREC;

   3092  1 000151   000000 236000 0                  LDQ     FMN$E$OLDREC
         1 000152   000000 474400 xsym               LDP4    B$JIT$
         1 000153   400012 756100                    STQ     10,,PR4

     1570     3093    2      IF FPTV.READ THEN DO;

   3093  1 000154   000000 236100                    LDQ     0,,PR0
         1 000155   400000 316007                    CANQ    -131072,DL
         1 000156   000175 600000 1                  TZE     NOWRITE

     1571     3094    2         F$DCB.PSN=FM$MADKEY.PSN;

   3094  1 000157   200004 471500                    LDP1    KEY$,,AUTO
         1 000160   200003 473500                    LDP3    JDCB$,,AUTO
         1 000161   040100 100500                    MLR     fill='040'O
         1 000162   100002 400006                    ADSC9   2,,PR1                   cn=2,n=6
         1 000163   300024 000006                    ADSC9   20,,PR3                  cn=0,n=6

     1572     3095    2         CALL HFF$WRITE1(2)ALTRET(NOWRITE);

   3095  1 000164   000006 630400 2                  EPPR0   6
         1 000165   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000166   000000 701000 xent               TSX1    HFF$WRITE1
         1 000167   000175 702000 1                  TSX2    NOWRITE

     1573     3096    2         PSN.SN#(0)=FM$MADKEY.PSN;

   3096  1 000170   200004 470500                    LDP0    KEY$,,AUTO
         1 000171   000000 471400 xsym               LDP1    B$PS2$
         1 000172   040100 100500                    MLR     fill='040'O
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:330  
         1 000173   000002 400006                    ADSC9   2,,PR0                   cn=2,n=6
         1 000174   100001 000006                    ADSC9   1,,PR1                   cn=0,n=6

   3096  1 000175                       NOWRITE      null
     1574     3097    2   NOWRITE:;
     1575     3098    2         END;

     1576     3099    2      IF FPTV.DELETE THEN DO;

   3099  1 000175   000000 470400 xsym               LDP0    B$PS0$
         1 000176   000000 236100                    LDQ     0,,PR0
         1 000177   100000 316007                    CANQ    32768,DL
         1 000200   000244 600000 1                  TZE     RETALTU

     1577     3100    2         IF NOT B$JIT.PRIV.ACTIVE&%PR_FMDIAG# THEN GOTO NOPRIV;

   3100  1 000201   000000 471400 xsym               LDP1    B$JIT$
         1 000202   100013 236100                    LDQ     11,,PR1
         1 000203   000003 376000 0                  ANQ     FMN$E$NOKEY+1
         1 000204   000326 600000 1                  TZE     NOPRIV

     1578     3101    2         CALL FMG$REMKEY;

   3101  1 000205   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000206   000000 701000 xent               TSX1    FMG$REMKEY
         1 000207   000000 011000                    NOP     0

     1579     3102    2         CALL FMR$L8;

   3102  1 000210   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000211   000000 701000 xent               TSX1    FMR$L8
         1 000212   000000 011000                    NOP     0

     1580     3103                    /* NOW MARK NON-PUBLIC ANY ACCT BLOCKS */
     1581     3104    2         ACCT$=PINCRW(FM$SET$,FM$SET$->FM$CFUA.LINKX);

   3104  1 000213   000000 470400 xsym               LDP0    FM$SET$
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:331  
         1 000214   000000 720100                    LXL0    0,,PR0
         1 000215   000000 636010                    EAQ     0,X0
         1 000216   000000 036000 xsym               ADLQ    FM$SET$
         1 000217   200006 756100                    STQ     ACCT$,,AUTO

     1582     3105    3         DO WHILE(ACCT$~=FM$SET$);

   3105  1 000220   000000 116000 xsym               CMPQ    FM$SET$
         1 000221   000241 600000 1                  TZE     s:3109

     1583     3106    3            IF FM$CFUA.ACCT=ACCT.ACCT# THEN FM$CFUA.PRIV='1'B;

   3106  1 000222   200006 470500                    LDP0    ACCT$,,AUTO
         1 000223   000000 471400 xsym               LDP1    B$PS1$
         1 000224   040100 106500                    CMPC    fill='040'O
         1 000225   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 000226   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 000227   000232 601000 1                  TNZ     s:3107

   3106  1 000230   040000 236003                    LDQ     16384,DU
         1 000231   000005 256100                    ORSQ    5,,PR0

     1584     3107    3            ACCT$=PINCRW(FM$SET$,FM$CFUA.LINKX);

   3107  1 000232   200006 470500                    LDP0    ACCT$,,AUTO
         1 000233   000000 720100                    LXL0    0,,PR0
         1 000234   000000 636010                    EAQ     0,X0
         1 000235   000000 036000 xsym               ADLQ    FM$SET$
         1 000236   200006 756100                    STQ     ACCT$,,AUTO

     1585     3108    3            END;

   3108  1 000237   000000 116000 xsym               CMPQ    FM$SET$
         1 000240   000222 601000 1                  TNZ     s:3106

     1586     3109    2         CALL FMR$U8;

PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:332  
   3109  1 000241   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000242   000000 701000 xent               TSX1    FMR$U8
         1 000243   000000 011000                    NOP     0

     1587     3110    2         END;

   3106  1 000244                       RETALTU      null
     1588     3111    1   RETALTU:;
     1589     3112    1      CALL FMD$FLSHBUF(1);

   3112  1 000244   000005 630400 2                  EPPR0   5
         1 000245   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000246   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000247   000000 011000                    NOP     0

     1590     3113    1      CALL UQB$MDEQ(FM$SET$);

   3113  1 000250   000002 630400 2                  EPPR0   2
         1 000251   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000252   000000 701000 xent               TSX1    UQB$MDEQ
         1 000253   000000 011000                    NOP     0

   3106  1 000254                       RETALT       null
     1591     3114    1   RETALT:;
     1592     3115    1      RETURN;

   3115  1 000254   000000 702200 xent               TSX2  ! X66_ARET

   3106  1 000255                       NOKEY        null
     1593     3116                    /**/
     1594     3117    1   NOKEY:;
     1595     3118    1      IF B$JIT.ERR.CODE=%E$NOKEY THEN B$JIT.ERR=FMN$E$NOKEY;

   3118  1 000255   000000 470400 xsym               LDP0    B$JIT$
         1 000256   000012 236100                    LDQ     10,,PR0
         1 000257   377770 376007                    ANQ     131064,DL
         1 000260   001020 116007                    CMPQ    528,DL
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:333  
         1 000261   000264 601000 1                  TNZ     s:3119

   3118  1 000262   000002 236000 0                  LDQ     FMN$E$NOKEY
         1 000263   000012 756100                    STQ     10,,PR0

     1596     3119    1      IF NOT FPTV.WRITE

   3119  1 000264   000000 471400 xsym               LDP1    B$PS0$
         1 000265   100000 236100                    LDQ     0,,PR1
         1 000266   200000 316007                    CANQ    65536,DL
         1 000267   000244 600000 1                  TZE     RETALTU
         1 000270   400000 316007                    CANQ    -131072,DL
         1 000271   000244 601000 1                  TNZ     RETALTU
         1 000272   100000 316007                    CANQ    32768,DL
         1 000273   000244 601000 1                  TNZ     RETALTU
         1 000274   000012 236100                    LDQ     10,,PR0
         1 000275   377770 376007                    ANQ     131064,DL
         1 000276   001020 116007                    CMPQ    528,DL
         1 000277   000244 601000 1                  TNZ     RETALTU

     1597     3120    1        OR FPTV.READ OR FPTV.DELETE
     1598     3121    1        OR B$JIT.ERR.CODE~=%E$NOKEY THEN GOTO RETALTU;
     1599     3122    1      B$JIT.ERR='0'B;

   3122  1 000300   000012 450100                    STZ     10,,PR0

     1600     3123    1      IF NOT B$JIT.PRIV.ACTIVE&%PR_FMDIAG# THEN GOTO NOPRIV;

   3123  1 000301   000013 236100                    LDQ     11,,PR0
         1 000302   000003 376000 0                  ANQ     FMN$E$NOKEY+1
         1 000303   000326 600000 1                  TZE     NOPRIV

     1601     3124    1      CALL FMG$ADDKEY(SEG$,2,KEY$,ACCT$) ALTRET(RETALTU);

   3124  1 000304   200006 633500                    EPPR3   ACCT$,,AUTO
         1 000305   200013 453500                    STP3    ACCT$+5,,AUTO
         1 000306   200004 634500                    EPPR4   KEY$,,AUTO
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:334  
         1 000307   200012 454500                    STP4    ACCT$+4,,AUTO
         1 000310   000006 236000 2                  LDQ     6
         1 000311   200011 756100                    STQ     ACCT$+3,,AUTO
         1 000312   200005 635500                    EPPR5   SEG$,,AUTO
         1 000313   200010 455500                    STP5    ACCT$+2,,AUTO
         1 000314   200010 630500                    EPPR0   ACCT$+2,,AUTO
         1 000315   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000316   000000 701000 xent               TSX1    FMG$ADDKEY
         1 000317   000244 702000 1                  TSX2    RETALTU

     1602     3125    1      FM$MADKEY.PSN=F$DCB.PSN;

   3125  1 000320   200003 470500                    LDP0    JDCB$,,AUTO
         1 000321   200004 471500                    LDP1    KEY$,,AUTO
         1 000322   040100 100500                    MLR     fill='040'O
         1 000323   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         1 000324   100002 400006                    ADSC9   2,,PR1                   cn=2,n=6

     1603     3126    1      GOTO RETALTU;

   3126  1 000325   000244 710000 1                  TRA     RETALTU

   3125  1 000326                       NOPRIV       null
     1604     3127                    /**/
     1605     3128    1   NOPRIV:;
     1606     3129    1      B$JIT.ERR=FMN$E$NOTAUTH;

   3129  1 000326   000001 236000 0                  LDQ     FMN$E$NOTAUTH
         1 000327   000000 470400 xsym               LDP0    B$JIT$
         1 000330   000012 756100                    STQ     10,,PR0

     1607     3130    1      GOTO RETALTU;

   3130  1 000331   000244 710000 1                  TRA     RETALTU

FMN$E$OLDREC
 Sect OctLoc
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:335  
   0     000   061516 000752                                                    1...

FMN$E$NOTAUTH
 Sect OctLoc
   0     001   061516 006252                                                    1...

FMN$E$NOKEY
 Sect OctLoc
   0     002   061516 001022                                                    1...

(unnamed)
 Sect OctLoc
   0     003   040000 000000                                                     ...

(unnamed)
 Sect OctLoc
   2     000   000000 006003   743777 777777   000000 006000   000002 006000    ................
   2     004   000000 006000   000003 006000   000004 006000                    ............
     1608     3131    1   END FMN$MADMUCK;
     1609     3132        %EOD;

PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:336  
--  Include file information  --

   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F_CP6.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$MADMUCK.
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:337  

 **** Variables and constants ****

  ****  Section 000 RoData FMN$MADMUCK

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/b STRC        r     1 FMN$E$NOKEY                1-0-0/b STRC        r     1 FMN$E$NOTAUTH
     0-0-0/b STRC        r     1 FMN$E$OLDREC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w PTR         r     1 ACCT$                      3-0-0/w PTR         r     1 JDCB$
     4-0-0/w PTR         r     1 KEY$                       5-0-0/w PTR         r     1 SEG$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$PS1$                     0-0-0/w PTR         r     1 B$PS2$
     0-0-0/w PTR         r     1 FM$SET$                    0-0-0/w UBIN        r     1 FM_MADSDA
     0-0-0/w UBIN        r     1 FM_SYSSETX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(72)    r     1 ACCT                       0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(288)   r     1 FM$CFUA
     0-0-0/w STRC(144)   r     1 FM$MADKEY                  0-0-0/d STRC(72)    r     1 FPTV
     0-0-0/d STRC(90)    r     1 PSN
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:338  


   Procedure FMN$MADMUCK requires 218 words for executable code.
   Procedure FMN$MADMUCK requires 14 words of local(AUTO) storage.
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:339  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:340  
          MINI XREF LISTING

ACCT.ACCT#
      3012**DCL      3079>>ASSIGN   3106>>IF
ACCT$
      3033**DCL      2996--IMP-PTR  3078<<ASSIGN   3080<>CALL     3089<>CALL     3104<<ASSIGN   3105>>DOWHILE
      3106>>IF       3106>>ASSIGN   3107<<ASSIGN   3107>>ASSIGN   3124<>CALL
B$JIT.DCB$
      1684**DCL      3075<<ASSIGN
B$JIT.ERR
      1594**DCL      3092<<ASSIGN   3118<<ASSIGN   3122<<ASSIGN   3129<<ASSIGN
B$JIT.ERR.CODE
      1595**DCL      3118>>IF       3119>>IF
B$JIT.ERR.MID
      1595**DCL      1595--REDEF
B$JIT.PRIV.ACTIVE
      1595**DCL      3100>>IF       3123>>IF
B$JIT$
      3069**DCL      1589--IMP-PTR  3075>>ASSIGN   3092>>ASSIGN   3100>>IF       3118>>IF       3118>>ASSIGN
      3119>>IF       3122>>ASSIGN   3123>>IF       3129>>ASSIGN
B$PS0$
      3066**DCL      1265--IMP-PTR  3081>>IF       3084>>IF       3084>>IF       3090>>IF       3093>>IF
      3099>>IF       3119>>IF       3119>>IF       3119>>IF
B$PS1$
      3067**DCL      3012--IMP-PTR  3079>>ASSIGN   3106>>IF
B$PS2$
      3068**DCL      3025--IMP-PTR  3081>>ASSIGN   3096>>ASSIGN
F$DCB.ACCT
      2956**DCL      3078--ASSIGN   3079<<ASSIGN
F$DCB.ACTPOS
      2971**DCL      2971--REDEF
F$DCB.ARS
      2946**DCL      2946--REDEF
F$DCB.ATTR
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:341  
      2964**DCL      2965--REDEF
F$DCB.BORROW
      2979**DCL      2979--REDEF    2979--REDEF    2979--REDEF
F$DCB.DCBNAME.L
      2993**DCL      2993--IMP-SIZ
F$DCB.EOMCHAR
      2950**DCL      2950--REDEF
F$DCB.FCD
      2959**DCL      3076>>IF
F$DCB.FLDID
      2974**DCL      2974--REDEF
F$DCB.FORM$
      2968**DCL      2968--REDEF
F$DCB.FSECT
      2984**DCL      2984--REDEF
F$DCB.FSN
      2961**DCL      2961--REDEF    2961--REDEF    2962--REDEF
F$DCB.GTYP
      2975**DCL      3083<<ASSIGN
F$DCB.HEADER$
      2967**DCL      2967--REDEF
F$DCB.IXTNSIZE
      2965**DCL      2965--REDEF
F$DCB.LASTSTA$
      2955**DCL      2955--REDEF
F$DCB.LVL
      2980**DCL      2980--REDEF
F$DCB.NAME.C
      2955**DCL      2955--REDEF
F$DCB.NOEOF
      2976**DCL      2976--REDEF
F$DCB.NRECS
      2966**DCL      2966--REDEF
F$DCB.NRECX
      2985**DCL      2985--REDEF
F$DCB.OHDR
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:342  
      2977**DCL      2977--REDEF
F$DCB.ORG
      2960**DCL      2960--REDEF
F$DCB.PRECNO
      2983**DCL      2983--REDEF
F$DCB.PSN
      2956**DCL      3081<<ASSIGN   3091>>IF       3094<<ASSIGN   3125>>ASSIGN
F$DCB.RCSZ
      2988**DCL      2988--REDEF
F$DCB.RES
      2956**DCL      2956--REDEF
F$DCB.SETX
      2968**DCL      2968--REDEF    3082<<ASSIGN
F$DCB.TAB$
      2967**DCL      2968--REDEF
F$DCB.TDA
      2982**DCL      2982--REDEF
F$DCB.WSN
      2957**DCL      2957--REDEF
FM$CFUA.ACCT
      2996**DCL      3106>>IF
FM$CFUA.LINKX
      2996**DCL      3104>>ASSIGN   3107>>ASSIGN
FM$CFUA.PRIV
      2997**DCL      3106<<ASSIGN
FM$MADKEY.PSN
      3028**DCL      3091>>IF       3094>>ASSIGN   3096>>ASSIGN   3125<<ASSIGN
FM$SET$
      3070**DCL      3085<>CALL     3086<>CALL     3104>>ASSIGN   3104>>ASSIGN   3105>>DOWHILE  3107>>ASSIGN
      3113<>CALL
FMD$FLSHBUF
      3050**DCL-ENT  3112--CALL
FMD$REDBUF
      3049**DCL-ENT  3088--CALL
FMG$ADDKEY
      3051**DCL-ENT  3124--CALL
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:343  
FMG$FINDKEY
      3052**DCL-ENT  3089--CALL
FMG$REMKEY
      3053**DCL-ENT  3101--CALL
FMM$SCRUB
      3054**DCL-ENT  3077--CALL
FMN$E$NOKEY
      3045**DCL      3118>>ASSIGN
FMN$E$NOTAUTH
      3041**DCL      3129>>ASSIGN
FMN$E$OLDREC
      3037**DCL      3092>>ASSIGN
FMO$PACKACCT
      3055**DCL-ENT  3080--CALL
FMP$CLSJ
      3056**DCL-ENT  3076--CALL
FMR$L8
      3058**DCL-ENT  3102--CALL
FMR$U8
      3059**DCL-ENT  3109--CALL
FM_MADSDA
      3071**DCL      3088<>CALL
FM_SYSSETX
      3072**DCL      3082>>ASSIGN
FPTV.DELETE
      1265**DCL      3084>>IF       3099>>IF       3119>>IF
FPTV.READ
      1265**DCL      3093>>IF       3119>>IF
FPTV.WRITE
      1265**DCL      3081>>IF       3084>>IF       3090>>IF       3119>>IF
HFF$TRAPALT
      3060**DCL-ENT  3087--CALL
HFF$WRITE1
      3061**DCL-ENT  3095--CALL
JDCB$
      3030**DCL      2946--IMP-PTR  3074<<ASSIGN   3075>>ASSIGN   3076>>IF       3077<>CALL     3078>>ASSIGN
PL6.E3A0      #004=FMN$MADMUCK File=FMN$OPNDP.:E05TSI                            TUE 07/29/97 16:54 Page:344  
      3079>>ASSIGN   3080<>CALL     3081>>ASSIGN   3082>>ASSIGN   3083>>ASSIGN   3091>>IF       3094>>ASSIGN
      3125>>ASSIGN
KEY$
      3031**DCL      3028--IMP-PTR  3088<>CALL     3089<>CALL     3091>>IF       3094>>ASSIGN   3096>>ASSIGN
      3124<>CALL     3125>>ASSIGN
NOKEY
      3106**LABEL    3089--CALLALT
NOPRIV
      3125**LABEL    3100--GOTO     3123--GOTO
NOWRITE
      3096**LABEL    3095--CALLALT
PSN.SN#
      3025**DCL      3081>>ASSIGN   3096<<ASSIGN
RETALT
      3106**LABEL    3085--CALLALT  3086--CALLALT
RETALTU
      3106**LABEL    3087--CALLALT  3088--CALLALT  3091--GOTO     3121--GOTO     3124--CALLALT  3126--GOTO
      3130--GOTO
SEG$
      3032**DCL      3089<>CALL     3089<>CALL     3124<>CALL
UQB$MDEQ
      3064**DCL-ENT  3113--CALL
UQB$MENQS
      3062**DCL-ENT  3086--CALL
UQB$MENQX
      3063**DCL-ENT  3085--CALL

PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:345  
     1610        1        /*T***********************************************************/
     1611        2        /*T*                                                         */
     1612        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1613        4        /*T*                                                         */
     1614        5        /*T***********************************************************/
     1615        6                    /*F*     NAME: FMN$RDGRAN
     1616        7                    *        PURPOSE: To read a granule for set AVR and suchlike.
     1617        8                    *        DESCRIPTION: The two parameters are BUF$ and SRGRANULE#.
     1618        9                    *        Read is performed with wait and no content validation */
     1619       10        FMN$RDGRAN:PROC(BUF$,GRAN)ALTRET;
     1620       11        %INCLUDE N_FC_C;
     1621       48    1   DCL FMB$QUEUE ENTRY(9)ALTRET;
     1622       49    1   DCL GRAN UBIN;
     1623       50    1   DCL BUF$ PTR;
     1624       51    1   DCL AGRAN UBIN;
     1625       52        %EJECT;
PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:346  
     1626       53                    /* PASS LOCAL COPY OF GRAN IN CASE FMB$QUEUE NEEDS TO MODIFY IT */
     1627       54    1      AGRAN = GRAN;
     1628       55    1      CALL FMB$QUEUE(BUF$,1,4096,AGRAN,%N_RDBIN,-1,
     1629       56    1        ENTADDR(NIL),0)ALTRET(RETALT);
     1630       57    1      RETURN;
     1631       58    1   RETALT:ALTRETURN;
     1632       59    1   END FMN$RDGRAN;

PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:347  
--  Include file information  --

   N_FC_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$RDGRAN.

   Procedure FMN$RDGRAN requires 22 words for executable code.
   Procedure FMN$RDGRAN requires 14 words of local(AUTO) storage.

    No errors detected in file FMN$OPNDP.:E05TSI    .

PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:348  

 Object Unit name= FMN$RDGRAN                                 File name= FMN$OPNDP.:E05TOU
 UTS= JUL 29 '97 16:54:43.52 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    22     26  FMN$RDGRAN
    1  RoData even  none     7      7  FMN$RDGRAN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        2  FMN$RDGRAN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       9 FMB$QUEUE
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B_VECTNIL
PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:349  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:350  


     1610        1        /*T***********************************************************/
     1611        2        /*T*                                                         */
     1612        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1613        4        /*T*                                                         */
     1614        5        /*T***********************************************************/
     1615        6                    /*F*     NAME: FMN$RDGRAN
     1616        7                    *        PURPOSE: To read a granule for set AVR and suchlike.
     1617        8                    *        DESCRIPTION: The two parameters are BUF$ and SRGRANULE#.
     1618        9                    *        Read is performed with wait and no content validation */
     1619       10        FMN$RDGRAN:PROC(BUF$,GRAN)ALTRET;

     10  0 000000   000000 700200 xent  FMN$RDGRAN   TSX0  ! X66_AUTO_2
         0 000001   000016 000002                    ZERO    14,2

     1620       11        %INCLUDE N_FC_C;
     1621       48    1   DCL FMB$QUEUE ENTRY(9)ALTRET;
     1622       49    1   DCL GRAN UBIN;
     1623       50    1   DCL BUF$ PTR;
     1624       51    1   DCL AGRAN UBIN;
     1625       52        %EJECT;
PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:351  
     1626       53                    /* PASS LOCAL COPY OF GRAN IN CASE FMB$QUEUE NEEDS TO MODIFY IT */
     1627       54    1      AGRAN = GRAN;

     54  0 000002   200004 470500                    LDP0    @GRAN,,AUTO
         0 000003   000000 235100                    LDA     0,,PR0
         0 000004   200005 755100                    STA     AGRAN,,AUTO

     1628       55    1      CALL FMB$QUEUE(BUF$,1,4096,AGRAN,%N_RDBIN,-1,

     55  0 000005   000002 237000 1                  LDAQ    2
         0 000006   200014 757100                    STAQ    AGRAN+7,,AUTO
         0 000007   000004 237000 1                  LDAQ    4
         0 000010   200012 757100                    STAQ    AGRAN+5,,AUTO
         0 000011   200005 631500                    EPPR1   AGRAN,,AUTO
         0 000012   200011 451500                    STP1    AGRAN+4,,AUTO
         0 000013   000001 236000 1                  LDQ     1
         0 000014   200010 756100                    STQ     AGRAN+3,,AUTO
         0 000015   000006 236000 1                  LDQ     6
         0 000016   200003 235100                    LDA     @BUF$,,AUTO
         0 000017   200006 757100                    STAQ    AGRAN+1,,AUTO
         0 000020   200006 630500                    EPPR0   AGRAN+1,,AUTO
         0 000021   000026 631400 xsym               EPPR1   B_VECTNIL+22
         0 000022   000000 701000 xent               TSX1    FMB$QUEUE
         0 000023   000025 702000 0                  TSX2    RETALT

     1629       56    1        ENTADDR(NIL),0)ALTRET(RETALT);
     1630       57    1      RETURN;

     57  0 000024   000000 702200 xent               TSX2  ! X66_ARET

     1631       58    1   RETALT:ALTRETURN;

     58  0 000025   000000 702200 xent  RETALT       TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
   1     000   000000 010000   000000 006000   000002 006000   000002 006000    ................
PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:352  
   1     004   000004 006000   000027 006000   000003 006000                    ............
     1632       59    1   END FMN$RDGRAN;

PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:353  
--  Include file information  --

   N_FC_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$RDGRAN.
PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:354  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @BUF$                      4-0-0/w PTR         r     1 @GRAN
     5-0-0/w UBIN        r     1 AGRAN                     *0-0-0/w PTR         r     1 BUF$
    *0-0-0/w UBIN        r     1 GRAN


   Procedure FMN$RDGRAN requires 22 words for executable code.
   Procedure FMN$RDGRAN requires 14 words of local(AUTO) storage.

    No errors detected in file FMN$OPNDP.:E05TSI    .
PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:355  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=FMN$RDGRAN File=FMN$OPNDP.:E05TSI                             TUE 07/29/97 16:54 Page:356  
          MINI XREF LISTING

AGRAN
        51**DCL        54<<ASSIGN     55<>CALL
BUF$
        50**DCL        10--PROC       55<>CALL
FMB$QUEUE
        48**DCL-ENT    55--CALL
GRAN
        49**DCL        10--PROC       54>>ASSIGN
RETALT
        58**LABEL      55--CALLALT
