VERSION E05

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:1    
        1        1        /*M* GJA$LOGON.  Node Admin routines related to user and resource logon       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0,CRM=70   */
        8        8
        9        9        /*P* NAME:   GJA$LOGON
       10       10             PURPOSE: This module contains various Node Administrator routines
       11       11                      related to user and resource logon.
       12       12        */
       13       13
       14       14        /*F* NAME:   GJA$LOGON_REQUEST
       15       15
       16       16             PURPOSE: This routine is called from GJA$ADMIN when a connect is
       17       17                      received with resource 'LOGON'. It starts the ball
       18       18                      rolling for the logon process.
       19       19
       20       20             DESCRIPTION: This routine follows the following general steps:
       21       21                          1).  Get memory for a GJA$LGNCTX context block
       22       22                          2).  Set up the GJA$LGNCTX context block
       23       23                          3).  Send an INIT_ACK to VDH
       24       24                          4).  Derive a pointer to the channel table entry
       25       25                               for the device attempting logon and stash it
       26       26                               in context.
       27       27                          5).  Salute the device (if necessary)
       28       28                          6).  If this device is not autologged:
       29       29                                 - Set the prompt
       30       30                                 - Call GJA$SOLICIT_LOGON
       31       31                          7).  If this device is autologged:
       32       32                                 - Call GJA$SOLICIT_NM to see if this guy
       33       33                                   can log on.
       34       34                          8).  Return
       35       35
       36       36             CALL:  CALL GJA$LOGON_REQUEST(KNH$MESS,FPT_CONNECT);
       37       37
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:2    
       38       38             INPUTS:  FPT_CONNECT - Passed by VDH and contains everything we
       39       39                                    need to know about who is attempting logon.
       40       40                      KNH$MESS - Contains the message header so we can
       41       41                                 tell who made the request.
       42       42        */
       43       43        %EJECT;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:3    
       44       44        GJA$LOGON_REQUEST: PROC(CTX$,KNH$MESS,FPT_CONNECT) ALTRET;
       45       45
       46       46        %INCLUDE CP_6_SUBS;
       47      586        %INCLUDE GJA_MSG_M;
       48      825        %INCLUDE KH$CLK;
       49     1195        %INCLUDE KH_CLKFNC_E;
       50     1240        %INCLUDE KH$CHN;
       51     1362        %INCLUDE KHA_FNC_E;
       52     1462        %INCLUDE KNH_MACRO_C;
       53     1745        %INCLUDE KL_MACRO_C;
       54     5097        %INCLUDE KL_AFCN_C;
       55     5198        %INCLUDE K_REASON_C;
       56     5224        %INCLUDE KV$VDO;
       57     6239        %INCLUDE NK_VFC_C;
       58     6313        %INCLUDE KL_SUPER_C;
       59     9215        %INCLUDE LCP_6;
       60    13494        %INCLUDE KI_SUBS_C;
       61    13630        %INCLUDE KV$BPC;
       62    13659                                                /* Args                     */
       63    13660    1   DCL CTX$ PTR;
       64    13661    1   DCL CTX REDEF CTX$ UBIN(32);
       65    13662    1   DCL CTXLGN$ PTR;
       66    13663        %KNH$MESS(STCLASS="");
       67    13712        %FPT_CONNECT(STCLASS="");
       68    13781                                                /* Necessary VDH macros     */
       69    13782        %KV_VDO_ALL_E;
       70    13861        %GJA_UID_EQUS;
       71    13869        %KH$CHN (STCLASS="BASED(CHN$)");
       72    13993        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
       73    14078        %GJA$HAND_CTX (STCLASS=BASED);
       74    14127        %GJA$ERRMSG_CTX (STCLASS=BASED);
       75    14155
       76    14156    1   DCL 1 TEXTC BASED,
       77    14157    1         2 SIZE UBIN BYTE UNAL,
       78    14158    1         2 STRING CHAR(TEXTC.SIZE) UNAL;
       79    14159    1   DCL STRING CHAR(255) BASED;
       80    14160    1   DCL 1 SV$MSG BASED,
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:4    
       81    14161    1         2 BFRSIZ UBIN,     /* actual size of buffer allocated by kvb  */
       82    14162    1         2 LNK$ PTR,
       83    14163    1         2 SZ UBIN,
       84    14164    1         2 VFC CHAR(1) UNAL,
       85    14165    1         2 * CHAR(1) UNAL;
       86    14166                                                /* AUTO Storage             */
       87    14167        %KL_ADMIN (FPTN=ADMIN,STCLASS=AUTO);
       88    14328    1   DCL AGAIN BIT(1);
       89    14329    1   DCL CHN$ PTR;
       90    14330    1   DCL NMAVAIL BIT(1);
       91    14331    1   DCL NMCTX$ PTR;
       92    14332    1   DCL SVMSG$ PTR;
       93    14333    1   DCL INDX UBIN;
       94    14334    1   DCL J UBIN;
       95    14335    1   DCL LINE# CHAR(4);
       96    14336    1   DCL NODE UBIN;
       97    14337        %B$TERMINAL_ID(FPTN=TERMINAL$ID,STCLASS="");
       98    14366    1   DCL MSGSIZ UBIN;
       99    14367                                                /* Symrefs                  */
      100    14368        %KL_ADMIN (FPTN=GJA_ADMIN,STCLASS=SYMREF);
      101    14529        %FPT_CONNECT_ACK(FPTN=GJA_CONNECT_ACK,STCLASS=SYMREF);
      102    14578        %KV$VDO_PRM(NAME=GJA_PROMPT_VDO,STCLASS=SYMREF,LAST=",");
      103    14619             %KV$VDOVLP_DAT2(STCLASS="SYMREF",LVL=2,LAST=",");
      104    14669    1         2 TL,
      105    14670    1           3 TYPE UBIN BYTE UNAL,
      106    14671    1           3 LEN UBIN BYTE UNAL;
      107    14672        %KV$VDO_DAT (NAME=GJA_VDO_DAT_DAT2,STCLASS=SYMREF,LAST=",");
      108    14717             %KV$VDOVLP_DAT2(NAME=DAT2,STCLASS=SYMREF,LVL=2);
      109    14767        %KV$VDO_DAT(NAME=KV$VDO_DAT_IMD,STCLASS=STATIC,LAST=",",VLP=YES,FNC=
             14767            KV_VDO_FNC_DAT_IMD,
      110    14768                 STR=KIDM_CP,DATCTRCHRTYP=%KV_DATCTRCHRTYP_VFC,DATCTRCHR='a');
      111    14813             %KV$VDOVLP_DAT1(STCLASS=STATIC,LVL=2,LST=YES,LAST=";",BYTSIZ=0);
      112    14863
      113    14864    1   DCL GJA_DEFNODE UBIN SYMREF;
      114    14865    1   DCL GJA_MSG_DOWN$ PTR SYMREF;
      115    14866    1   DCL GJA_HOSTRESUMED$ PTR SYMREF;
      116    14867    1   DCL GJA_MSG_HDR$ PTR SYMREF;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:5    
      117    14868    1   DCL GJA_MSG_SALUTE$ PTR SYMREF;
      118    14869    1   DCL GJA_USRLGN_HEAD$ PTR SYMREF;
      119    14870    1   DCL GJA_HAND_HEAD$ PTR SYMREF;
      120    14871    1   DCL GJA_ERRMSG_HEAD$ PTR SYMREF;
      121    14872    1   DCL GJA_CHNLOW UBIN SYMREF;
      122    14873    1   DCL GJA_CHNHI UBIN SYMREF;
      123    14874        %KL_ERRMSG_RSP (FPTN=KL_ERRMSG_RSP,STCLASS=STATIC,LONG=NO);
      124    14950        %KL_RQSPROFILE (FPTN=GJA_RQSPROFILE,STCLASS="STATIC SYMDEF");
      125    15008        %KL_SGNRSP (FPTN=SGNRSP,STCLASS=STATIC);
      126    15144    1   DCL GJA_LDCT_NM UBIN SYMREF;
      127    15145    1   DCL GJA_LDCT_BABOON UBIN SYMREF;
      128    15146    1   DCL GJA_UID_BABOON UBIN SYMREF;
      129    15147    1   DCL E$NONETMAN BIT(32) SYMREF;
      130    15148    1   DCL GJA_NODE# UBIN SYMREF;
      131    15149    1   DCL GJA_NODENAME CHAR(8) SYMREF;
      132    15150    1   DCL GJA_HSTRSMED BIT(1) SYMREF;
      133    15151    1   DCL GJA$SYSLOG$ PTR SYMREF;
      134    15152    1   DCL GJA_NM_HEAD$ PTR SYMREF;
      135    15153    1   DCL GJA_UID_NM PTR SYMREF;
      136    15154    1   DCL KV_B_POOL$ PTR SYMREF;
      137    15155    1   DCL GJA_FIRST_TIME BIT(1) SYMREF;
      138    15156        %FPT_TERM (FPTN=GJA_TERM,STCLASS=SYMREF);
      139    15178        %FPT_TERM_ACK (FPTN=GJA_TERM_ACK,STCLASS=SYMREF);
      140    15200        %FPT_TIME (SOURCE=CLOCK,
      141    15201                   DEST=EXT,
      142    15202                   DATE=LINE_MSG.DATE,
      143    15203                   TIME=LINE_MSG.TIME,
      144    15204                   DAY=LINE_MSG.DAY);
      145    15228        %KV$BPC(STCLASS="BASED(KV_B_POOL$)");
      146    15250
      147    15251                                                /* Static                   */
      148    15252        %KH$CLK (FPTN=SET_CLK,
      149    15253                  STCLASS=STATIC,
      150    15254                  FNC=%KH#CLK_SETCLK,
      151    15255                  VDH_CLK=YES,
      152    15256                  NO_CTB=YES,
      153    15257                  PERM=NO,
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:6    
      154    15258                  PRDUNT=KH#C_MIN,
      155    15259                  PRD=0);
      156    15408    1   DCL 1 LINE_MSG STATIC,
      157    15409    1         2 TIME CHAR(0) CALIGNED INIT('hh:mm'),
      158    15410    1         2 * CHAR(0) CALIGNED INIT(' '),
      159    15411    1         2 DAY CHAR(0) CALIGNED INIT('day '),
      160    15412    1         2 DATE CHAR(0) CALIGNED INIT('Mon dd  yy'),
      161    15413    1         2 * CHAR(0) CALIGNED INIT(' Line '),
      162    15414    1         2 LINE# CHAR(40)CALIGNED INIT(' ');
      163    15415                                                /* Constant                 */
      164    15416    1   DCL HEX(0:15) CHAR(1) CONSTANT INIT('0','1','2','3','4','5','6','7','8','9','A','B',
             15416            'C','D','E','F');
      165    15417                                                /* Entrys                   */
      166    15418    1   DCL GJA$BLD_CTX ENTRY(3) ALTRET;
      167    15419    1   DCL GJA$SEND_MSG ENTRY(4) ALTRET;
      168    15420    1   DCL GJA$SOLICIT_LOGON ENTRY(1);
      169    15421    1   DCL GJA$SOLICIT_NM ENTRY(2);
      170    15422    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      171    15423    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      172    15424    1   DCL GJA$Q_MSG ENTRY(6);
      173    15425    1   DCL GJA$NETWORK_MANAGER ENTRY(2) ALTRET;
      174    15426    1   DCL GJA$GET_CHNTBL_PTR ENTRY(2) ALTRET;
      175    15427    1   DCL GJA$DISOLVE_LGNUSR_CTX ENTRY(1);
      176    15428    1   DCL GJA$DISOLVE_ERRMSG_CTX ENTRY(1);
      177    15429    1   DCL KHC$CLOCK ENTRY (1) ALTRET;
      178    15430        %EJECT;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:7    
      179    15431        /*
      180    15432           Find out if there will be enough memory for this logon.  Will attempt
      181    15433           to prevent NodeAdmin running out of memory when it is too late.
      182    15434        */
      183    15435
      184    15436    2      IF ((KV$BPC.TOT*3/4)< KV$BPC.USE OR GJA_FIRST_TIME = '1'B) THEN DO;
      185    15437    2           GJA_CONNECT_ACK.REASON = %K_REASON_USRREJ;
      186    15438    2           CALL GJA$Q_MSG(ADDR(KNH$MESS.LDCTX),,,SIZEC(GJA_CONNECT_ACK),
      187    15439    2             GJA_CONNECT_ACK,%KN_FCN_INIT_ACK);
      188    15440    2           RETURN;
      189    15441    2           END;
      190    15442        /*
      191    15443          Get memory for a logon context block and set it up as best we
      192    15444          can at this point.
      193    15445        */
      194    15446    1      CALL KVB$GETSYS(SIZEW(GJA$LGNCTX),CTX$)
      195    15447    2      WHENALTRETURN DO;
      196    15448    2           GJA_CONNECT_ACK.REASON = %K_REASON_USRREJ;
      197    15449    2           CALL GJA$Q_MSG(ADDR(KNH$MESS.LDCTX),,,SIZEC(GJA_CONNECT_ACK),GJA_CONNECT_ACK
             15449                    ,%KN_FCN_INIT_ACK);
      198    15450    2           RETURN;
      199    15451    2           END;
      200    15452    1      GJA$LGNCTX='0'B;
      201    15453    1      GJA$LGNCTX.LDCTX=KNH$MESS.LDCTX;
      202    15454    1      GJA$LGNCTX.USER=FPT_CONNECT.USER;
      203    15455    1      GJA$LGNCTX.TERMINAL_ID=FPT_CONNECT.TERMINAL_ID;
      204    15456    1      GJA$LGNCTX.SPEED=FPT_CONNECT.SPEED;
      205    15457    1      GJA$LGNCTX.NODE=FPT_CONNECT.RLCID.NODE;
      206    15458    1      GJA$LGNCTX.WHO = %GJA_UID_LOGON;
      207    15459    1      GJA$LGNCTX.NM_NODE = GJA_DEFNODE;
      208    15460         /* unless stated otherwise
      209    15461           in the logon everybody gets
      210    15462           the default host.*/
      211    15463    1      IF GJA$LGNCTX.TERMINAL_ID.TTYP = %KLTY_TTY#
      212    15464    1        OR GJA$LGNCTX.TERMINAL_ID.TTYP = %KLTY_LINEDEV#
      213    15465    1      THEN
      214    15466    1           GJA$LGNCTX.STATUS.INT = '1'B;   /* Interactive              */
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:8    
      215    15467    1      IF GJA_USRLGN_HEAD$ = ADDR(NIL)
      216    15468    1      THEN GJA_USRLGN_HEAD$ = CTX$;
      217    15469    2      ELSE DO;
      218    15470    2           GJA$LGNCTX.LNK$=GJA_USRLGN_HEAD$;
      219    15471    2           GJA_USRLGN_HEAD$=CTX$;
      220    15472    2           END;
      221    15473
      222    15474    1      TERMINAL$ID=GJA$LGNCTX.TERMINAL_ID;
      223    15475    1      CALL GJA$GET_CHNTBL_PTR(TERMINAL$ID,GJA$LGNCTX.CHN$)
      224    15476    2      WHENALTRETURN DO;
      225    15477    2           CALL GJA$BLD_CTX(TERMINAL$ID,GJA$LGNCTX.CHN$,'0'B)
      226    15478    3           WHENALTRETURN DO;
      227    15479    3                GJA_CONNECT_ACK.REASON = %K_REASON_USRREJ;
      228    15480    3                CALL GJA$Q_MSG(CTX$,,,SIZEC(GJA_CONNECT_ACK),GJA_CONNECT_ACK,%
             15480                         KN_FCN_INIT_ACK);
      229    15481    3                CALL GJA$DISOLVE_LGNUSR_CTX(CTX$);
      230    15482    3                RETURN;
      231    15483    3                END;
      232    15484    2           END;
      233    15485        /*
      234    15486          Send the INIT_ACK message to VDH indicating the connection can
      235    15487          be established.
      236    15488        */
      237    15489    1      GJA_CONNECT_ACK.REASON = %K_REASON_NORMAL;
      238    15490    1      CALL GJA$Q_MSG(CTX$,,,SIZEC(GJA_CONNECT_ACK),
      239    15491    1        GJA_CONNECT_ACK,%KN_FCN_INIT_ACK);
      240    15492
      241    15493    1      CHN$ = GJA$LGNCTX.CHN$;
      242    15494        /*
      243    15495           If a logon string is there, send to SLUG and return.
      244    15496        */
      245    15497    1      IF KNH$MESS.MSGSZ ~= 0
      246    15498    2      THEN DO;
      247    15499    2           GJA$LGNCTX.MSG$ = PINCRW(ADDR(FPT_CONNECT),SIZEW(FPT_CONNECT));
      248    15500    2           CALL GJA$SOLICIT_NM ( CTX$, KNH$MESS.MSGSZ );
      249    15501    2           RETURN;
      250    15502    2           END;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:9    
      251    15503        /* If there is a clock set it  */
      252    15504    1      IF KH$CHN.LGNTIMOUTPRD ~= 0
      253    15505    2      THEN DO;
      254    15506    2           SET_CLK.CTBCTX$ = ADDR(NIL);
      255    15507    2           SET_CLK.UID$ = CTX$;
      256    15508    2           SET_CLK.PRD = KH$CHN.LGNTIMOUTPRD;
      257    15509    2           CALL KHC$CLOCK(SET_CLK);
      258    15510    2           END;
      259    15511
      260    15512    1      AGAIN = '0'B;
      261    15513    1      GOTO COMMON;
      262    15514        /*
      263    15515          If we enter here, its because when we were called the first time
      264    15516          the network manager had not as yet connected to us.  CTX$ is all
      265    15517          setup to point to the context we are interested in.
      266    15518        */
      267    15519    1   GJA$LOGON_REQUEST_AGAIN: ENTRY(CTX$) ALTRET;
      268    15520
      269    15521
      270    15522    1      AGAIN = '1'B;
      271    15523    1      GJA$LGNCTX.STATUS.WAITING_HOST = '0'B;
      272    15524    1      IF GJA$LGNCTX.STATUS.WTPRO
      273    15525    1      THEN
      274    15526    1           AGAIN = '0'B;
      275    15527
      276    15528        /* If we are terminate just return */
      277    15529    1      IF GJA$LGNCTX.STATUS.TERM
      278    15530    1        OR GJA$LGNCTX.STATUS.TERMACK
      279    15531    1        OR GJA$LGNCTX.STATUS.DSCRCV
      280    15532    1        OR GJA$LGNCTX.STATUS.NMRSP
      281    15533    1      THEN
      282    15534    1           RETURN;
      283    15535
      284    15536
      285    15537    1   COMMON: ;
      286    15538        /*
      287    15539          Get a pointer to the channel table entry for the channel attempting
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:10   
      288    15540          logon
      289    15541        */
      290    15542    1      TERMINAL$ID=GJA$LGNCTX.TERMINAL_ID;
      291    15543        /*
      292    15544          If we need to salute the line, do it.
      293    15545        */
      294    15546    1      CHN$=GJA$LGNCTX.CHN$;
      295    15547
      296    15548    1      IF KH$CHN.PROFILE AND NOT GJA$LGNCTX.STATUS.WTPRO AND GJA_LDCT_NM ~= 0
      297    15549    2      THEN DO;
      298    15550    2           GJA_RQSPROFILE.NMID = CTX;
      299    15551    2           GJA_RQSPROFILE.HANDLER = ' ';
      300    15552    2           GJA_RQSPROFILE.TERMID = GJA$LGNCTX.TERMINAL_ID;
      301    15553    2           CALL GJA$NETWORK_MANAGER(GJA_RQSPROFILE,SIZEC(GJA_RQSPROFILE));
      302    15554    2           GJA$LGNCTX.STATUS.WTPRO = '1'B;
      303    15555    2           RETURN;
      304    15556    2           END;
      305    15557    1      ELSE
      306    15558    1           GJA$LGNCTX.STATUS.WTPRO = '0'B;
      307    15559
      308    15560    1      NMAVAIL = '0'B;
      309    15561    1      NMCTX$ = GJA_NM_HEAD$;
      310    15562    2   FNDNM: DO WHILE NMCTX$ ~= ADDR(NIL);
      311    15563    2           IF NMCTX$->GJA$HAND_CTX.HOST_NODE AND
      312    15564    3             NMCTX$->GJA$HAND_CTX.LDCTX ~= 0 THEN DO;
      313    15565    3                NMAVAIL = '1'B;
      314    15566    3                EXIT FNDNM;
      315    15567    3                END;
      316    15568    2           NMCTX$ = NMCTX$->GJA$HAND_CTX.LNK$;
      317    15569    2           END;
      318    15570    1      IF KH$CHN.SNDSLT AND GJA$LGNCTX.STATUS.INT
      319    15571    2      THEN DO;                             /* SALUTE                   */
      320    15572
      321    15573        /* Send host down message if it is */
      322    15574    2           IF GJA_LDCT_NM =0
      323    15575    3           THEN DO;
      324    15576    3                MSGSIZ = GJA_MSG_DOWN$->TEXTC.SIZE;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:11   
      325    15577    3                CALL GJA$SEND_MSG(CTX$,GJA_MSG_DOWN$->TEXTC.STRING,MSGSIZ,%
             15577                         VFC_TRANSITION0);
      326    15578    3                END;
      327    15579
      328    15580        /* If we were call at AGAIN then send the Host resumed message */
      329    15581    2           IF AGAIN
      330    15582    3           THEN DO;
      331    15583    3                MSGSIZ = GJA_HOSTRESUMED$->TEXTC.SIZE;
      332    15584    3                CALL GJA$SEND_MSG(CTX$,GJA_HOSTRESUMED$->TEXTC.STRING,MSGSIZ,%
             15584                         VFC_TRANSITION0);
      333    15585    3                END;
      334    15586
      335    15587    2           MSGSIZ = GJA_MSG_HDR$->TEXTC.SIZE;
      336    15588    2           IF MSGSIZ > 0 THEN
      337    15589    2                CALL GJA$SEND_MSG(CTX$,GJA_MSG_HDR$->TEXTC.STRING,MSGSIZ,%
             15589                         VFC_TRANSITION0);
      338    15590    2           IF GJA_LDCT_NM ~= 0
      339    15591    3           THEN DO;
      340    15592    3                MSGSIZ = GJA_MSG_SALUTE$->TEXTC.SIZE;
      341    15593    3                CALL GJA$SEND_MSG(CTX$,GJA_MSG_SALUTE$->TEXTC.STRING,MSGSIZ,%
             15593                         VFC_TRANSITION0);
      342    15594    3                END;
      343    15595
      344    15596    2           INDX = 0;
      345    15597    2           CALL BINCHAR(LINE#,GJA_NODE#);
      346    15598    3           J=0;DO WHILE(SUBSTR(LINE#,J,1)='0'); J = J +1; END;
      347    15599    2           CALL INSERT (LINE_MSG.LINE#,0,14-J,SUBSTR(LINE#,J,4-J),'(',GJA_NODENAME);
      348    15600    2           CALL INDEX(INDX,' ',LINE_MSG.LINE#);
      349    15601    2           CALL CONCAT(LINE#,
      350    15602    2             HEX(TERMINAL$ID.TERM.CHANNEL/4096),
      351    15603    2             HEX(MOD(TERMINAL$ID.TERM.CHANNEL/256,16)),
      352    15604    2             HEX(MOD(TERMINAL$ID.TERM.CHANNEL/16,16)),
      353    15605    2             HEX(MOD(TERMINAL$ID.TERM.CHANNEL,16)));
      354    15606    2           CALL INSERT (LINE_MSG.LINE#,INDX,6,')-',LINE#);
      355    15607    2           INDX = INDX + 6;
      356    15608    2           IF TERMINAL$ID.LEV >= %TERMINAL_ID_LEV_SUBCHAN#
      357    15609    3           THEN DO;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:12   
      358    15610    3                CALL BINCHAR(LINE#,TERMINAL$ID.TERM.SUBDEVICE);
      359    15611    4                J=0;DO WHILE(SUBSTR(LINE#,J,1)='0' AND J<3); J = J +1; END;
      360    15612    3                CALL INSERT(LINE_MSG.LINE#,INDX,5-J,'-',SUBSTR(LINE#,J,4-J));
      361    15613    3                INDX = INDX + 5 - J;
      362    15614    3                IF TERMINAL$ID.LEV = %TERMINAL_ID_LEV_SUBSUBCHAN#
      363    15615    4                THEN DO;
      364    15616    4                     CALL BINCHAR(LINE#,TERMINAL$ID.TERM.SUBSUBDEVICE);
      365    15617    5                     J=0;DO WHILE(SUBSTR(LINE#,J,1)='0' AND J<3); J = J +1; END;
      366    15618    4                     CALL INSERT(LINE_MSG.LINE#,INDX,5-J,'-',SUBSTR(LINE#,J,4-J));
      367    15619    4                     INDX = INDX + 5 - J;
      368    15620    4                     END;
      369    15621    3                END;
      370    15622
      371    15623    2           CALL M$TIME (FPT_TIME);
      372    15624    2           MSGSIZ = POFFC(ADDR(LINE_MSG.LINE#),ADDR(LINE_MSG)) + INDX;
      373    15625    2           CALL GJA$SEND_MSG(CTX$,LINE_MSG,MSGSIZ,%VFC_TRANSITION0);
      374    15626    2           END;
      375    15627
      376    15628        /* If the NM is connect solict the LOGON */
      377    15629    2      IF NMAVAIL ~= '0'B THEN DO;
      378    15630        /*
      379    15631          If we are to solicit this line, do it
      380    15632        */
      381    15633    2           IF NOT(KH$CHN.AUTLGN)
      382    15634    2           THEN
      383    15635    2                IF GJA$LGNCTX.STATUS.INT
      384    15636    3                THEN DO;
             15636                  /* read is already there send dat_imd with just vfc to have vdh reprompt*/
      385    15637    4                     IF GJA$LGNCTX.STATUS.RDPND THEN DO;
      386    15638    4                          CALL GJA$Q_MSG(CTX$,SIZEC(KV$VDO_DAT_IMD),KV$VDO_DAT_IMD);
      387    15639    4                          GJA$LGNCTX.STATUS.RDPND= '0'B;
      388    15640    4                          CALL GJA$SOLICIT_LOGON(CTX$);
      389    15641    4                          END;
      390    15642    4                     ELSE DO;
      391    15643    4                          MSGSIZ=SIZEC(GJA_PROMPT_VDO)+GJA_PROMPT_VDO.TL.LEN;
      392    15644    4                          CALL GJA$Q_MSG(CTX$,MSGSIZ,GJA_PROMPT_VDO);
      393    15645    4                          CALL GJA$SOLICIT_LOGON(CTX$);
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:13   
      394    15646    4                          END;
      395    15647    3                     END;
      396    15648    3                ELSE DO;
      397    15649    3                     ADMIN = GJA_ADMIN;
      398    15650    3                     ADMIN.TERMID_LO = GJA$LGNCTX.TERMINAL_ID;
      399    15651    3                     ADMIN.TERMID_HI = GJA$LGNCTX.TERMINAL_ID;
      400    15652    3                     ADMIN.FNC = %KHA_FNC_KILL;
      401    15653    3                     CALL GJA$SEND_MSG(GJA$LGNCTX.CHN$->KH$CHN.HAND$,ADMIN,SIZEC(ADMIN)
             15653                              )
      402    15654    4                     WHENALTRETURN DO;
      403    15655    4                          ALTRETURN;
      404    15656    4                          END;
      405    15657    3                     RETURN;
      406    15658    3                     END;
      407    15659    3           ELSE DO;
      408    15660        /* autologon lines shouldn't bother if the nm is available.*/
      409    15661    3                IF GJA_LDCT_NM ~= 0 THEN
      410    15662    3                     GJA$LGNCTX.MSG$=ADDR(NIL);
      411    15663    3                CALL GJA$SOLICIT_NM(CTX$,0);
      412    15664    3                END;
      413    15665    2           END;
      414    15666
      415    15667    1      RETURN;
      416    15668        %EJECT;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:14   
      417    15669        /*F*
      418    15670             NAME:     GJA$HOST_RECOVERY
      419    15671
      420    15672             PURPOSE:  This routine cleans up the device in logon on HOST recovery
      421    15673
      422    15674             DESCRIPTION: This routine disconnects all users that are trying
      423    15675                          to logon when the host disappears.
      424    15676                       and send an admin HOSTDOWN to all handlers.
      425    15677
      426    15678              */
      427    15679
      428    15680    1   GJA$HOST_RECOVERY: ENTRY(CTX$) ALTRET;
      429    15681
      430    15682    1      NODE = CTX;
      431    15683    1      CTXLGN$ = GJA_USRLGN_HEAD$;
      432    15684
      433    15685    2      DO WHILE (CTXLGN$ ~= ADDR(NIL));
      434    15686
      435    15687    2           CHN$ = CTXLGN$->GJA$LGNCTX.LNK$;
      436    15688    2           IF (GJA_DEFNODE = NODE AND NOT CTXLGN$->GJA$LGNCTX.STATUS.NMRSP) OR
      437    15689    2             (CTXLGN$->GJA$LGNCTX.NM_NODE = NODE AND CTXLGN$->GJA$LGNCTX.STATUS.NMRSP)
      438    15690    3           THEN DO;
      439    15691    3                CTXLGN$->GJA$LGNCTX.STATUS.NMRSP = '0'B;
      440    15692    3                IF CTXLGN$->GJA$LGNCTX.STATUS.TERM
      441    15693    4                THEN DO;
      442    15694    4                     CALL GJA$Q_MSG(CTXLGN$,,,
      443    15695    4                       SIZEC(GJA_TERM_ACK),GJA_TERM_ACK,%KN_FCN_TERM_ACK);
      444    15696    4                     CALL GJA$DISOLVE_LGNUSR_CTX(CTXLGN$);
      445    15697    4                     END;
      446    15698    3                ELSE
      447    15699    3                     IF ~CTXLGN$->GJA$LGNCTX.STATUS.TERMACK
      448    15700    3                     THEN
      449    15701    3                          IF CTXLGN$->GJA$LGNCTX.LDCTX = GJA_LDCT_BABOON
      450    15702    4                          THEN DO;
      451    15703    4                               SGNRSP.NMID = CTXLGN$->GJA$LGNCTX.USER.SYSID;
      452    15704    4                               SGNRSP.ERRCODE = E$NONETMAN;
      453    15705    4                               CALL GJA$Q_MSG(GJA_UID_BABOON,SIZEC(SGNRSP),SGNRSP);
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:15   
      454    15706    4                               END;
      455    15707    4                          ELSE DO;
      456    15708    4                               CALL GJA$Q_MSG(CTXLGN$,,,
      457    15709    4                                 SIZEC(GJA_TERM),GJA_TERM,%KN_FCN_TERM);
      458    15710    4                               CTXLGN$->GJA$LGNCTX.STATUS.TERMACK = '1'B;
      459    15711    4                               END;
      460    15712    3                END;
      461    15713    2           CTXLGN$ = CHN$;
      462    15714    2           END;
      463    15715
      464    15716
      465    15717        /* Send a host down to every handler */
      466    15718    1      ADMIN = GJA_ADMIN;
      467    15719    1      ADMIN.FNC = %KHA_FNC_HOSTDOWN;
      468    15720
      469    15721    1      CTXLGN$ = GJA_HAND_HEAD$;
      470    15722
      471    15723    1      IF NODE = GJA_DEFNODE
      472    15724    1      THEN
      473    15725    2      DO;
      474    15726    2           GJA_HSTRSMED = '0'B;
      475    15727    3           DO WHILE (CTXLGN$ ~= ADDR(NIL));
      476    15728    3                ADMIN.TERMID_LO.TERM.CHANNEL = GJA_CHNLOW;
      477    15729    3                ADMIN.TERMID_HI.TERM.CHANNEL = GJA_CHNHI;
      478    15730    3                ADMIN.TERMID_LO.LEV = %TERMINAL_ID_LEV_CHAN#;
      479    15731    3                ADMIN.TERMID_HI.LEV = %TERMINAL_ID_LEV_CHAN#;
      480    15732    3                IF CTXLGN$->GJA$HAND_CTX.WHO = %GJA_UID_HANDLER
      481    15733    3                THEN
      482    15734    3                     CALL GJA$SEND_MSG(CTXLGN$,ADMIN,SIZEC(ADMIN));
      483    15735    3                CTXLGN$ = CTXLGN$->GJA$HAND_CTX.LNK$;
      484    15736    3                END;
      485    15737    2           END;
      486    15738
      487    15739        /* Send a response to every user waiting on M$ERRMSG.
      488    15740        */
      489    15741    1      CTXLGN$ = GJA_ERRMSG_HEAD$;
      490    15742
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:16   
      491    15743    2      DO WHILE (CTXLGN$ ~= ADDR(NIL));
      492    15744    2           IF ADDR(CTX) = ADDR(NIL) OR
      493    15745    2             CTXLGN$->GJA$ERRMSG_CTX.NODE = NODE
      494    15746    3           THEN DO;
      495    15747    3                KL_ERRMSG_RSP.USR# = CTXLGN$->GJA$ERRMSG_CTX.USR#;
      496    15748    3                KL_ERRMSG_RSP.CTX$ = CTXLGN$;
      497    15749    3                KL_ERRMSG_RSP.MESSAGE_SZ = 0;
      498    15750    3                KL_ERRMSG_RSP.NO_NM = '1'B;
      499    15751
      500    15752    3                CALL GJA$SEND_MSG(CTXLGN$, KL_ERRMSG_RSP, SIZEC(KL_ERRMSG_RSP));
      501    15753    3                CALL GJA$DISOLVE_ERRMSG_CTX(CTXLGN$);
      502    15754    3                END;
      503    15755    2           END;
      504    15756
      505    15757    1      RETURN;
      506    15758
      507    15759        %EJECT;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:17   
      508    15760        /*F*
      509    15761             NAME:     GJA$HOST_RESUMED
      510    15762             PURPOSE:  This routine send the Host up to all the handlers
      511    15763
      512    15764         */
      513    15765
      514    15766    1   GJA$HOST_RESUMED: ENTRY ALTRET;
      515    15767
      516    15768    1      ADMIN = GJA_ADMIN;
      517    15769    1      ADMIN.FNC = %KHA_FNC_HOSTUP;
      518    15770    1      ADMIN.TERMID_LO.LEV = %TERMINAL_ID_LEV_CHAN#;
      519    15771    1      ADMIN.TERMID_HI.LEV = %TERMINAL_ID_LEV_CHAN#;
      520    15772    1      ADMIN.TERMID_LO.TERM.CHANNEL = GJA_CHNLOW;
      521    15773    1      ADMIN.TERMID_HI.TERM.CHANNEL = GJA_CHNHI;
      522    15774    1      CTXLGN$ = GJA_HAND_HEAD$;
      523    15775
      524    15776    2      DO WHILE (CTXLGN$ ~= ADDR(NIL));
      525    15777    2           IF CTXLGN$->GJA$HAND_CTX.WHO = %GJA_UID_HANDLER
      526    15778    2           THEN
      527    15779    2                CALL GJA$SEND_MSG(CTXLGN$,ADMIN,SIZEC(ADMIN));
      528    15780    2           CTXLGN$ = CTXLGN$->GJA$HAND_CTX.LNK$;
      529    15781    2           END;
      530    15782
      531    15783        /*
      532    15784             Send any buffered sys/err/accting logs
      533    15785        */
      534    15786    2      DO WHILE (GJA$SYSLOG$ ~= ADDR(NIL));
      535    15787    2           SVMSG$=GJA$SYSLOG$;
      536    15788    2           MSGSIZ = SVMSG$->SV$MSG.SZ;
      537    15789    2           SVMSG$=PINCRW(SVMSG$,SIZEW(SV$MSG));
      538    15790    2           CALL GJA$SEND_MSG(GJA_UID_NM,SVMSG$->STRING,MSGSIZ);
      539    15791    2           SVMSG$ = GJA$SYSLOG$;
      540    15792    2           GJA$SYSLOG$ = GJA$SYSLOG$->SV$MSG.LNK$;
      541    15793    2           CALL KVB$RLSSYS(SVMSG$->SV$MSG);
      542    15794    2           END;
      543    15795
      544    15796    1      GJA_HSTRSMED = '1'B;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:18   
      545    15797    1      RETURN;
      546    15798    1   END;
      547    15799        %EOD;

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:19   
--  Include file information  --

   KV$BPC.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K_REASON_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$LOGON_REQUEST.

   Procedure GJA$LOGON_REQUEST requires 1976 words for executable code.
   Procedure GJA$LOGON_REQUEST requires 88 words of local(AUTO) storage.

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:20   

 Object Unit name= GJA$LOGON_REQUEST                          File name= GJA$LOGON.:E05TOU
 UTS= JUL 29 '97 21:50:28.92 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none   100     64  GJA$LOGON_REQUEST
    1  RoData even  UTS      9      9  GJA$LOGON_REQUEST
    2   Proc  even  none  1976    7B8  GJA$LOGON_REQUEST
    3  RoData even  none     7      7  GJA$LOGON_REQUEST

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        3  GJA$LOGON_REQUEST
     2    225          yes     yes      Std        1  GJA$LOGON_REQUEST_AGAIN
     2    5C2          yes     yes      Std        1  GJA$HOST_RECOVERY
     2    72D          yes     yes      Std        0  GJA$HOST_RESUMED

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0      7  GJA_RQSPROFILE
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:21   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       6 GJA$Q_MSG
 yes     yes           Std       2 KVB$GETSYS
         yes           Std       1 GJA$DISOLVE_LGNUSR_CTX
 yes     yes           Std       2 GJA$GET_CHNTBL_PTR
 yes     yes           Std       3 GJA$BLD_CTX
 yes     yes           Std       1 KHC$CLOCK
 yes     yes           Std       4 GJA$SEND_MSG
 yes     yes           Std       2 GJA$NETWORK_MANAGER
         yes           Std       1 GJA$SOLICIT_LOGON
 yes     yes           Std       2 KVB$RLSSYS
         yes           Std       2 GJA$SOLICIT_NM
         yes           Std       1 GJA$DISOLVE_ERRMSG_CTX
                       nStd      0 X6A_AUTO_3
                       nStd      0 X6D_MID
                       nStd      0 X6A_ARET
                       nStd      0 X6B_BLR
                       nStd      0 X6C_ALR
                       nStd      0 X6A_AALT
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:22   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     GJA_ADMIN                             GJA_CONNECT_ACK                       GJA_PROMPT_VDO
     GJA_DEFNODE                           GJA_MSG_DOWN$                         GJA_HOSTRESUMED$
     GJA_MSG_HDR$                          GJA_MSG_SALUTE$                       GJA_USRLGN_HEAD$
     GJA_HAND_HEAD$                        GJA_ERRMSG_HEAD$                      GJA_CHNLOW
     GJA_CHNHI                             GJA_LDCT_NM                           GJA_LDCT_BABOON
     GJA_UID_BABOON                        E$NONETMAN                            GJA_NODE#
     GJA_NODENAME                          GJA_HSTRSMED                          GJA$SYSLOG$
     GJA_NM_HEAD$                          GJA_UID_NM                            KV_B_POOL$
     GJA_FIRST_TIME                        GJA_TERM                              GJA_TERM_ACK
r    G$ROS$
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:23   


        1        1        /*M* GJA$LOGON.  Node Admin routines related to user and resource logon       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0,CRM=70   */
        8        8
        9        9        /*P* NAME:   GJA$LOGON
       10       10             PURPOSE: This module contains various Node Administrator routines
       11       11                      related to user and resource logon.
       12       12        */
       13       13
       14       14        /*F* NAME:   GJA$LOGON_REQUEST
       15       15
       16       16             PURPOSE: This routine is called from GJA$ADMIN when a connect is
       17       17                      received with resource 'LOGON'. It starts the ball
       18       18                      rolling for the logon process.
       19       19
       20       20             DESCRIPTION: This routine follows the following general steps:
       21       21                          1).  Get memory for a GJA$LGNCTX context block
       22       22                          2).  Set up the GJA$LGNCTX context block
       23       23                          3).  Send an INIT_ACK to VDH
       24       24                          4).  Derive a pointer to the channel table entry
       25       25                               for the device attempting logon and stash it
       26       26                               in context.
       27       27                          5).  Salute the device (if necessary)
       28       28                          6).  If this device is not autologged:
       29       29                                 - Set the prompt
       30       30                                 - Call GJA$SOLICIT_LOGON
       31       31                          7).  If this device is autologged:
       32       32                                 - Call GJA$SOLICIT_NM to see if this guy
       33       33                                   can log on.
       34       34                          8).  Return
       35       35
       36       36             CALL:  CALL GJA$LOGON_REQUEST(KNH$MESS,FPT_CONNECT);
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:24   
       37       37
       38       38             INPUTS:  FPT_CONNECT - Passed by VDH and contains everything we
       39       39                                    need to know about who is attempting logon.
       40       40                      KNH$MESS - Contains the message header so we can
       41       41                                 tell who made the request.
       42       42        */
       43       43        %EJECT;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:25   
       44       44        GJA$LOGON_REQUEST: PROC(CTX$,KNH$MESS,FPT_CONNECT) ALTRET;

     44   2 000000  D380 0000 0000  xent GJA$LOGON_REQUE*LNJ,B5   X6A_AUTO_3
          2 000003       0058 0003                       DC       88,3

       45       45
       46       46        %INCLUDE CP_6_SUBS;
       47      586        %INCLUDE GJA_MSG_M;
       48      825        %INCLUDE KH$CLK;
       49     1195        %INCLUDE KH_CLKFNC_E;
       50     1240        %INCLUDE KH$CHN;
       51     1362        %INCLUDE KHA_FNC_E;
       52     1462        %INCLUDE KNH_MACRO_C;
       53     1745        %INCLUDE KL_MACRO_C;
       54     5097        %INCLUDE KL_AFCN_C;
       55     5198        %INCLUDE K_REASON_C;
       56     5224        %INCLUDE KV$VDO;
       57     6239        %INCLUDE NK_VFC_C;
       58     6313        %INCLUDE KL_SUPER_C;
       59     9215        %INCLUDE LCP_6;
       60    13494        %INCLUDE KI_SUBS_C;
       61    13630        %INCLUDE KV$BPC;
       62    13659                                                /* Args                     */
       63    13660    1   DCL CTX$ PTR;
       64    13661    1   DCL CTX REDEF CTX$ UBIN(32);
       65    13662    1   DCL CTXLGN$ PTR;
       66    13663        %KNH$MESS(STCLASS="");
       67    13712        %FPT_CONNECT(STCLASS="");
       68    13781                                                /* Necessary VDH macros     */
       69    13782        %KV_VDO_ALL_E;
       70    13861        %GJA_UID_EQUS;
       71    13869        %KH$CHN (STCLASS="BASED(CHN$)");
       72    13993        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
       73    14078        %GJA$HAND_CTX (STCLASS=BASED);
       74    14127        %GJA$ERRMSG_CTX (STCLASS=BASED);
       75    14155
       76    14156    1   DCL 1 TEXTC BASED,
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:26   
       77    14157    1         2 SIZE UBIN BYTE UNAL,
       78    14158    1         2 STRING CHAR(TEXTC.SIZE) UNAL;
       79    14159    1   DCL STRING CHAR(255) BASED;
       80    14160    1   DCL 1 SV$MSG BASED,
       81    14161    1         2 BFRSIZ UBIN,     /* actual size of buffer allocated by kvb  */
       82    14162    1         2 LNK$ PTR,
       83    14163    1         2 SZ UBIN,
       84    14164    1         2 VFC CHAR(1) UNAL,
       85    14165    1         2 * CHAR(1) UNAL;
       86    14166                                                /* AUTO Storage             */
       87    14167        %KL_ADMIN (FPTN=ADMIN,STCLASS=AUTO);
       88    14328    1   DCL AGAIN BIT(1);
       89    14329    1   DCL CHN$ PTR;
       90    14330    1   DCL NMAVAIL BIT(1);
       91    14331    1   DCL NMCTX$ PTR;
       92    14332    1   DCL SVMSG$ PTR;
       93    14333    1   DCL INDX UBIN;
       94    14334    1   DCL J UBIN;
       95    14335    1   DCL LINE# CHAR(4);
       96    14336    1   DCL NODE UBIN;
       97    14337        %B$TERMINAL_ID(FPTN=TERMINAL$ID,STCLASS="");
       98    14366    1   DCL MSGSIZ UBIN;
       99    14367                                                /* Symrefs                  */
      100    14368        %KL_ADMIN (FPTN=GJA_ADMIN,STCLASS=SYMREF);
      101    14529        %FPT_CONNECT_ACK(FPTN=GJA_CONNECT_ACK,STCLASS=SYMREF);
      102    14578        %KV$VDO_PRM(NAME=GJA_PROMPT_VDO,STCLASS=SYMREF,LAST=",");
      103    14619             %KV$VDOVLP_DAT2(STCLASS="SYMREF",LVL=2,LAST=",");
      104    14669    1         2 TL,
      105    14670    1           3 TYPE UBIN BYTE UNAL,
      106    14671    1           3 LEN UBIN BYTE UNAL;
      107    14672        %KV$VDO_DAT (NAME=GJA_VDO_DAT_DAT2,STCLASS=SYMREF,LAST=",");
      108    14717             %KV$VDOVLP_DAT2(NAME=DAT2,STCLASS=SYMREF,LVL=2);
      109    14767        %KV$VDO_DAT(NAME=KV$VDO_DAT_IMD,STCLASS=STATIC,LAST=",",VLP=YES,FNC=
             14767            KV_VDO_FNC_DAT_IMD,
      110    14768                 STR=KIDM_CP,DATCTRCHRTYP=%KV_DATCTRCHRTYP_VFC,DATCTRCHR='a');
      111    14813             %KV$VDOVLP_DAT1(STCLASS=STATIC,LVL=2,LST=YES,LAST=";",BYTSIZ=0);
      112    14863
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:27   
      113    14864    1   DCL GJA_DEFNODE UBIN SYMREF;
      114    14865    1   DCL GJA_MSG_DOWN$ PTR SYMREF;
      115    14866    1   DCL GJA_HOSTRESUMED$ PTR SYMREF;
      116    14867    1   DCL GJA_MSG_HDR$ PTR SYMREF;
      117    14868    1   DCL GJA_MSG_SALUTE$ PTR SYMREF;
      118    14869    1   DCL GJA_USRLGN_HEAD$ PTR SYMREF;
      119    14870    1   DCL GJA_HAND_HEAD$ PTR SYMREF;
      120    14871    1   DCL GJA_ERRMSG_HEAD$ PTR SYMREF;
      121    14872    1   DCL GJA_CHNLOW UBIN SYMREF;
      122    14873    1   DCL GJA_CHNHI UBIN SYMREF;
      123    14874        %KL_ERRMSG_RSP (FPTN=KL_ERRMSG_RSP,STCLASS=STATIC,LONG=NO);
      124    14950        %KL_RQSPROFILE (FPTN=GJA_RQSPROFILE,STCLASS="STATIC SYMDEF");
      125    15008        %KL_SGNRSP (FPTN=SGNRSP,STCLASS=STATIC);
      126    15144    1   DCL GJA_LDCT_NM UBIN SYMREF;
      127    15145    1   DCL GJA_LDCT_BABOON UBIN SYMREF;
      128    15146    1   DCL GJA_UID_BABOON UBIN SYMREF;
      129    15147    1   DCL E$NONETMAN BIT(32) SYMREF;
      130    15148    1   DCL GJA_NODE# UBIN SYMREF;
      131    15149    1   DCL GJA_NODENAME CHAR(8) SYMREF;
      132    15150    1   DCL GJA_HSTRSMED BIT(1) SYMREF;
      133    15151    1   DCL GJA$SYSLOG$ PTR SYMREF;
      134    15152    1   DCL GJA_NM_HEAD$ PTR SYMREF;
      135    15153    1   DCL GJA_UID_NM PTR SYMREF;
      136    15154    1   DCL KV_B_POOL$ PTR SYMREF;
      137    15155    1   DCL GJA_FIRST_TIME BIT(1) SYMREF;
      138    15156        %FPT_TERM (FPTN=GJA_TERM,STCLASS=SYMREF);
      139    15178        %FPT_TERM_ACK (FPTN=GJA_TERM_ACK,STCLASS=SYMREF);
      140    15200        %FPT_TIME (SOURCE=CLOCK,
      141    15201                   DEST=EXT,
      142    15202                   DATE=LINE_MSG.DATE,
      143    15203                   TIME=LINE_MSG.TIME,
      144    15204                   DAY=LINE_MSG.DAY);
      145    15228        %KV$BPC(STCLASS="BASED(KV_B_POOL$)");
      146    15250
      147    15251                                                /* Static                   */
      148    15252        %KH$CLK (FPTN=SET_CLK,
      149    15253                  STCLASS=STATIC,
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:28   
      150    15254                  FNC=%KH#CLK_SETCLK,
      151    15255                  VDH_CLK=YES,
      152    15256                  NO_CTB=YES,
      153    15257                  PERM=NO,
      154    15258                  PRDUNT=KH#C_MIN,
      155    15259                  PRD=0);
      156    15408    1   DCL 1 LINE_MSG STATIC,
      157    15409    1         2 TIME CHAR(0) CALIGNED INIT('hh:mm'),
      158    15410    1         2 * CHAR(0) CALIGNED INIT(' '),
      159    15411    1         2 DAY CHAR(0) CALIGNED INIT('day '),
      160    15412    1         2 DATE CHAR(0) CALIGNED INIT('Mon dd  yy'),
      161    15413    1         2 * CHAR(0) CALIGNED INIT(' Line '),
      162    15414    1         2 LINE# CHAR(40)CALIGNED INIT(' ');
      163    15415                                                /* Constant                 */
      164    15416    1  DCL HEX(0:15) CHAR(1) CONSTANT INIT('0','1','2','3','4','5','6','7','8','9','A','B',
             15416            'C','D','E','F');
      165    15417                                                /* Entrys                   */
      166    15418    1   DCL GJA$BLD_CTX ENTRY(3) ALTRET;
      167    15419    1   DCL GJA$SEND_MSG ENTRY(4) ALTRET;
      168    15420    1   DCL GJA$SOLICIT_LOGON ENTRY(1);
      169    15421    1   DCL GJA$SOLICIT_NM ENTRY(2);
      170    15422    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      171    15423    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      172    15424    1   DCL GJA$Q_MSG ENTRY(6);
      173    15425    1   DCL GJA$NETWORK_MANAGER ENTRY(2) ALTRET;
      174    15426    1   DCL GJA$GET_CHNTBL_PTR ENTRY(2) ALTRET;
      175    15427    1   DCL GJA$DISOLVE_LGNUSR_CTX ENTRY(1);
      176    15428    1   DCL GJA$DISOLVE_ERRMSG_CTX ENTRY(1);
      177    15429    1   DCL KHC$CLOCK ENTRY (1) ALTRET;
      178    15430        %EJECT;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:29   
      179    15431        /*
      180    15432           Find out if there will be enough memory for this logon.  Will attempt
      181    15433           to prevent NodeAdmin running out of memory when it is too late.
      182    15434        */
      183    15435
      184    15436    2      IF ((KV$BPC.TOT*3/4)< KV$BPC.USE OR GJA_FIRST_TIME = '1'B) THEN DO;

  15436   2 000005  EC80 0000 0000  xsym                 LDB,B6   KV_B_POOL$
          2 000008  8C86                                 LDI      ,B6
          2 000009  9B80 0000 0000  03                   LAB,B1   0
          2 00000C  D380 0000 0000  xent                 LNJ,B5   X6D_MID
          2 00000F  70C2                                 DOR,R7   2
          2 000010  EC80 0000 0000  xsym                 LDB,B6   KV_B_POOL$
          2 000013  84C6 0002                            SID      2,B6
          2 000015  0681 0006                            BCF      s:15437,PREL
          2 000017  8980 0000 0000  xsym                 CMZ      GJA_FIRST_TIME
          2 00001A  0881 0046                            BAGE     s:15446,PREL

      185    15437    2           GJA_CONNECT_ACK.REASON = %K_REASON_USRREJ;

  15437   2 00001C  6C05                                 LDV,R6   5
          2 00001D  EF00 0000 0000  xsym                 STR,R6   GJA_CONNECT_ACK

      186    15438    2           CALL GJA$Q_MSG(ADDR(KNH$MESS.LDCTX),,,SIZEC(GJA_CONNECT_ACK),

  15438   2 000020  8CC7 0006                            LDI      @KNH$MESS,AUTO
          2 000022  B856                                 LDR,R3   R6
          2 000023  E570 7FFF                            AND,R6   32767,IMO
          2 000025  8D47 0044                            SDI      MSGSIZ+1,AUTO
          2 000027  DCC7 0044                            LDB,B5   MSGSIZ+1,AUTO
          2 000029  304F                                 SOR,R3   15
          2 00002A  DFC7 0048                            STB,B5   MSGSIZ+5,AUTO
          2 00002C  8CC7 0048                            LDI      MSGSIZ+5,AUTO
          2 00002E  7031                                 DCL,R7   1
          2 00002F  8D47 004A                            SDI      MSGSIZ+7,AUTO
          2 000031  F853                                 LDR,R7   R3
          2 000032  6C00                                 LDV,R6   0
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:30   
          2 000033  8447 004A                            AID      MSGSIZ+7,AUTO
          2 000035  7071                                 DCR,R7   1
          2 000036  8470 0000 0001                       AID      1,IMO
          2 000039  8D47 0046                            SDI      MSGSIZ+3,AUTO
          2 00003B  CBF0 000C                            LAB,B4   12,IMO
          2 00003D  BBF0 0002                            LAB,B3   2,IMO
          2 00003F  BFC7 0056                            STB,B3   MSGSIZ+19,AUTO
          2 000041  AB80 0000 0000  xsym                 LAB,B2   GJA_CONNECT_ACK
          2 000044  AFC7 0054                            STB,B2   MSGSIZ+17,AUTO
          2 000046  CFC7 0052                            STB,B4   MSGSIZ+15,AUTO
          2 000048  9B80 0000 0000                       LAB,B1   0
          2 00004B  9FC7 0050                            STB,B1   MSGSIZ+13,AUTO
          2 00004D  EB80 0000 0000                       LAB,B6   0
          2 000050  EFC7 004E                            STB,B6   MSGSIZ+11,AUTO
          2 000052  EBC7 0046                            LAB,B6   MSGSIZ+3,AUTO
          2 000054  EFC7 004C                            STB,B6   MSGSIZ+9,AUTO
          2 000056  BBC7 004C                            LAB,B3   MSGSIZ+9,AUTO
          2 000058  CBF0 0600                            LAB,B4   1536,IMO
          2 00005A  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 00005D       0001                            DC       s:15440,PREL

      187    15439    2             GJA_CONNECT_ACK,%KN_FCN_INIT_ACK);
      188    15440    2           RETURN;

  15440   2 00005E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      189    15441    2           END;
      190    15442        /*
      191    15443          Get memory for a logon context block and set it up as best we
      192    15444          can at this point.
      193    15445        */
      194    15446    1      CALL KVB$GETSYS(SIZEW(GJA$LGNCTX),CTX$)

  15446   2 000061  DBF0 0021                            LAB,B5   33,IMO
          2 000063  CCC7 0004                            LDB,B4   @CTX$,AUTO
          2 000065  CFC7 0046                            STB,B4   MSGSIZ+3,AUTO
          2 000067  DFC7 0044                            STB,B5   MSGSIZ+1,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:31   
          2 000069  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 00006B  CBF0 0200                            LAB,B4   512,IMO
          2 00006D  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000070       0003                            DC       s:15448,PREL
          2 000071  0F81 0046                            B        s:15452,PREL

      195    15447    2      WHENALTRETURN DO;

      196    15448    2           GJA_CONNECT_ACK.REASON = %K_REASON_USRREJ;

  15448   2 000073  6C05                                 LDV,R6   5
          2 000074  EF00 0000 0000  xsym                 STR,R6   GJA_CONNECT_ACK

      197    15449    2          CALL GJA$Q_MSG(ADDR(KNH$MESS.LDCTX),,,SIZEC(GJA_CONNECT_ACK),GJA_CONNECT_ACK
             15449                    ,%KN_FCN_INIT_ACK);

  15449   2 000077  8CC7 0006                            LDI      @KNH$MESS,AUTO
          2 000079  B856                                 LDR,R3   R6
          2 00007A  E570 7FFF                            AND,R6   32767,IMO
          2 00007C  8D47 0044                            SDI      MSGSIZ+1,AUTO
          2 00007E  ECC7 0044                            LDB,B6   MSGSIZ+1,AUTO
          2 000080  304F                                 SOR,R3   15
          2 000081  EFC7 0048                            STB,B6   MSGSIZ+5,AUTO
          2 000083  8CC7 0048                            LDI      MSGSIZ+5,AUTO
          2 000085  7031                                 DCL,R7   1
          2 000086  8D47 004A                            SDI      MSGSIZ+7,AUTO
          2 000088  F853                                 LDR,R7   R3
          2 000089  6C00                                 LDV,R6   0
          2 00008A  8447 004A                            AID      MSGSIZ+7,AUTO
          2 00008C  7071                                 DCR,R7   1
          2 00008D  8470 0000 0001                       AID      1,IMO
          2 000090  8D47 0046                            SDI      MSGSIZ+3,AUTO
          2 000092  DBF0 000C                            LAB,B5   12,IMO
          2 000094  CBF0 0002                            LAB,B4   2,IMO
          2 000096  CFC7 0056                            STB,B4   MSGSIZ+19,AUTO
          2 000098  BB80 0000 0000  xsym                 LAB,B3   GJA_CONNECT_ACK
          2 00009B  BFC7 0054                            STB,B3   MSGSIZ+17,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:32   
          2 00009D  DFC7 0052                            STB,B5   MSGSIZ+15,AUTO
          2 00009F  AB80 0000 0000                       LAB,B2   0
          2 0000A2  AFC7 0050                            STB,B2   MSGSIZ+13,AUTO
          2 0000A4  9B80 0000 0000                       LAB,B1   0
          2 0000A7  9FC7 004E                            STB,B1   MSGSIZ+11,AUTO
          2 0000A9  EBC7 0046                            LAB,B6   MSGSIZ+3,AUTO
          2 0000AB  EFC7 004C                            STB,B6   MSGSIZ+9,AUTO
          2 0000AD  BBC7 004C                            LAB,B3   MSGSIZ+9,AUTO
          2 0000AF  CBF0 0600                            LAB,B4   1536,IMO
          2 0000B1  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 0000B4       0001                            DC       s:15450,PREL

      198    15450    2           RETURN;

  15450   2 0000B5  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      199    15451    2           END;
      200    15452    1      GJA$LGNCTX='0'B;

  15452   2 0000B8  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 0000BA  DC86                                 LDB,B5   ,B6
          2 0000BB  5C42                                 LDV,R5   66
          2 0000BC  0021                                 ALR      ;
          2 0000BD       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 0000BF       4005 0000                                ALPHANUM(0,B5,,R5,FILL)

      201    15453    1      GJA$LGNCTX.LDCTX=KNH$MESS.LDCTX;

  15453   2 0000C1  437F                                 CSYNC    s:15452+8,SPREL
          2 0000C2  DC86                                 LDB,B5   ,B6
          2 0000C3  8CC7 0006                            LDI      @KNH$MESS,AUTO
          2 0000C5  B856                                 LDR,R3   R6
          2 0000C6  E570 7FFF                            AND,R6   32767,IMO
          2 0000C8  8D47 0044                            SDI      MSGSIZ+1,AUTO
          2 0000CA  CCC7 0044                            LDB,B4   MSGSIZ+1,AUTO
          2 0000CC  304F                                 SOR,R3   15
          2 0000CD  5C02                                 LDV,R5   2
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:33   
          2 0000CE  0021                                 ALR      ;
          2 0000CF       4234 0001                                ALPHANUM(1,B4,R3,,2),;
          2 0000D1       4007 0048                                ALPHANUM(MSGSIZ+5,AUTO,,R5,FILL)
          2 0000D3  437F                                 CSYNC    s:15453+17,SPREL
          2 0000D4  F847 0048                            LDR,R7   MSGSIZ+5,AUTO
          2 0000D6  6C00                                 LDV,R6   0
          2 0000D7  7093                                 DOL,R7   19
          2 0000D8  8D47 0046                            SDI      MSGSIZ+3,AUTO
          2 0000DA  DFC7 0049                            STB,B5   MSGSIZ+6,AUTO
          2 0000DC  ABC7 0044                            LAB,B2   MSGSIZ+1,AUTO
          2 0000DE  2C20                                 LDV,R2   32
          2 0000DF  6C20                                 LDV,R6   32
          2 0000E0  BB85                                 LAB,B3   ,B5
          2 0000E1  3C03                                 LDV,R3   3
          2 0000E2  7C0D                                 LDV,R7   13
          2 0000E3  D380 0000 0000  xent                 LNJ,B5   X6B_BLR

      202    15454    1      GJA$LGNCTX.USER=FPT_CONNECT.USER;

  15454   2 0000E6  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 0000E8  DC86                                 LDB,B5   ,B6
          2 0000E9  CCC7 0008                            LDB,B4   @FPT_CONNECT,AUTO
          2 0000EB  E844 000F                            LDR,R6   15,B4
          2 0000ED  EF45 000E                            STR,R6   14,B5

      203    15455    1      GJA$LGNCTX.TERMINAL_ID=FPT_CONNECT.TERMINAL_ID;

  15455   2 0000EF  DC86                                 LDB,B5   ,B6
          2 0000F0  AB84                                 LAB,B2   ,B4
          2 0000F1  2C0A                                 LDV,R2   10
          2 0000F2  6C10                                 LDV,R6   16
          2 0000F3  BB85                                 LAB,B3   ,B5
          2 0000F4  3C1E                                 LDV,R3   30
          2 0000F5  0008                                 MMM

      204    15456    1      GJA$LGNCTX.SPEED=FPT_CONNECT.SPEED;

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:34   
  15456   2 0000F6  9C86                                 LDB,B1   ,B6
          2 0000F7  E2C2 0010                            LLH,R6   16,B2
          2 0000F9  EAC1 0017                            SRM,R6,'00FF'X    23,B1
          2 0000FB       00FF

      205    15457    1      GJA$LGNCTX.NODE=FPT_CONNECT.RLCID.NODE;

  15457   2 0000FC  9C86                                 LDB,B1   ,B6
          2 0000FD  E2C2 000D                            LLH,R6   13,B2
          2 0000FF  E7C1 0017                            STH,R6   23,B1

      206    15458    1      GJA$LGNCTX.WHO = %GJA_UID_LOGON;

  15458   2 000101  9C86                                 LDB,B1   ,B6
          2 000102  E870 8000                            LDR,R6   -32768,IMO
          2 000104  EA81                                 SRM,R6,'E000'X    ,B1
          2 000105       E000

      207    15459    1      GJA$LGNCTX.NM_NODE = GJA_DEFNODE;

  15459   2 000106  9C86                                 LDB,B1   ,B6
          2 000107  D800 0000 0000  xsym                 LDR,R5   GJA_DEFNODE
          2 00010A  D7C1 0009                            STH,R5   9,B1

      208    15460         /* unless stated otherwise
      209    15461           in the logon everybody gets
      210    15462           the default host.*/
      211    15463    1      IF GJA$LGNCTX.TERMINAL_ID.TTYP = %KLTY_TTY#

  15463   2 00010C  9C86                                 LDB,B1   ,B6
          2 00010D  C2C1 000F                            LLH,R4   15,B1
          2 00010F  4D02                                 CMV,R4   2
          2 000110  0901 0004                            BE       s:15466,PREL
          2 000112  4D0A                                 CMV,R4   10
          2 000113  0981 0004                            BNE      s:15467,PREL

      212    15464    1        OR GJA$LGNCTX.TERMINAL_ID.TTYP = %KLTY_LINEDEV#
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:35   
      213    15465    1      THEN
      214    15466    1           GJA$LGNCTX.STATUS.INT = '1'B;   /* Interactive              */

  15466   2 000115  8941 0018                            LBT,'0400'X       24,B1
  15466   2 000117       0400

      215    15467    1      IF GJA_USRLGN_HEAD$ = ADDR(NIL)

  15467   2 000118  8D80 0000 0000  xsym                 CMN      GJA_USRLGN_HEAD$
          2 00011B  0981 0007                            BNE      s:15470,PREL

      216    15468    1      THEN GJA_USRLGN_HEAD$ = CTX$;

  15468   2 00011D  9C86                                 LDB,B1   ,B6
          2 00011E  9F80 0000 0000  xsym                 STB,B1   GJA_USRLGN_HEAD$
          2 000121  0F81 000D                            B        s:15474,PREL

      217    15469    2      ELSE DO;

      218    15470    2           GJA$LGNCTX.LNK$=GJA_USRLGN_HEAD$;

  15470   2 000123  9C86                                 LDB,B1   ,B6
          2 000124  EC80 0000 0000  xsym                 LDB,B6   GJA_USRLGN_HEAD$
          2 000127  EFC1 0001                            STB,B6   1,B1

      219    15471    2           GJA_USRLGN_HEAD$=CTX$;

  15471   2 000129  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 00012B  9C86                                 LDB,B1   ,B6
          2 00012C  9F80 0000 0000  xsym                 STB,B1   GJA_USRLGN_HEAD$

      220    15472    2           END;

      221    15473
      222    15474    1      TERMINAL$ID=GJA$LGNCTX.TERMINAL_ID;

  15474   2 00012F  DC86                                 LDB,B5   ,B6
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:36   
          2 000130  AB85                                 LAB,B2   ,B5
          2 000131  2C1E                                 LDV,R2   30
          2 000132  6C10                                 LDV,R6   16
          2 000133  BB87                                 LAB,B3   ,AUTO
          2 000134  3C76                                 LDV,R3   118
          2 000135  0008                                 MMM

      223    15475    1      CALL GJA$GET_CHNTBL_PTR(TERMINAL$ID,GJA$LGNCTX.CHN$)

  15475   2 000136  9C86                                 LDB,B1   ,B6
          2 000137  EBC1 000A                            LAB,B6   10,B1
          2 000139  EFC7 0046                            STB,B6   MSGSIZ+3,AUTO
          2 00013B  9BC7 003B                            LAB,B1   TERMINAL$ID,AUTO
          2 00013D  9FC7 0044                            STB,B1   MSGSIZ+1,AUTO
          2 00013F  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000141  CBF0 0200                            LAB,B4   512,IMO
          2 000143  E380 0000 0000  xent                 LNJ,B6   GJA$GET_CHNTBL_PTR
          2 000146       0003                            DC       s:15477,PREL
          2 000147  0F81 004C                            B        s:15489,PREL

      224    15476    2      WHENALTRETURN DO;

      225    15477    2           CALL GJA$BLD_CTX(TERMINAL$ID,GJA$LGNCTX.CHN$,'0'B)

  15477   2 000149  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 00014B  DC86                                 LDB,B5   ,B6
          2 00014C  CBF0 0000                            LAB,B4   0,IMO
          2 00014E  CFC7 0048                            STB,B4   MSGSIZ+5,AUTO
          2 000150  BBC5 000A                            LAB,B3   10,B5
          2 000152  BFC7 0046                            STB,B3   MSGSIZ+3,AUTO
          2 000154  DBC7 003B                            LAB,B5   TERMINAL$ID,AUTO
          2 000156  DFC7 0044                            STB,B5   MSGSIZ+1,AUTO
          2 000158  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 00015A  CBF0 0300                            LAB,B4   768,IMO
          2 00015C  E380 0000 0000  xent                 LNJ,B6   GJA$BLD_CTX
          2 00015F       0003                            DC       s:15479,PREL
          2 000160  0F81 0033                            B        s:15489,PREL
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:37   

      226    15478    3           WHENALTRETURN DO;

      227    15479    3                GJA_CONNECT_ACK.REASON = %K_REASON_USRREJ;

  15479   2 000162  6C05                                 LDV,R6   5
          2 000163  EF00 0000 0000  xsym                 STR,R6   GJA_CONNECT_ACK

      228    15480    3                CALL GJA$Q_MSG(CTX$,,,SIZEC(GJA_CONNECT_ACK),GJA_CONNECT_ACK,%
             15480                         KN_FCN_INIT_ACK);

  15480   2 000166  EBF0 000C                            LAB,B6   12,IMO
          2 000168  DBF0 0002                            LAB,B5   2,IMO
          2 00016A  DFC7 004E                            STB,B5   MSGSIZ+11,AUTO
          2 00016C  CB80 0000 0000  xsym                 LAB,B4   GJA_CONNECT_ACK
          2 00016F  CFC7 004C                            STB,B4   MSGSIZ+9,AUTO
          2 000171  EFC7 004A                            STB,B6   MSGSIZ+7,AUTO
          2 000173  BB80 0000 0000                       LAB,B3   0
          2 000176  BFC7 0048                            STB,B3   MSGSIZ+5,AUTO
          2 000178  AB80 0000 0000                       LAB,B2   0
          2 00017B  AFC7 0046                            STB,B2   MSGSIZ+3,AUTO
          2 00017D  9CC7 0004                            LDB,B1   @CTX$,AUTO
          2 00017F  9FC7 0044                            STB,B1   MSGSIZ+1,AUTO
          2 000181  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000183  CBF0 0600                            LAB,B4   1536,IMO
          2 000185  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 000188       0001                            DC       s:15481,PREL

      229    15481    3                CALL GJA$DISOLVE_LGNUSR_CTX(CTX$);

  15481   2 000189  BBC7 0004                            LAB,B3   @CTX$,AUTO
          2 00018B  CBF0 0100                            LAB,B4   256,IMO
          2 00018D  E380 0000 0000  xent                 LNJ,B6   GJA$DISOLVE_LGNUSR_CTX
          2 000190       0001                            DC       s:15482,PREL

      230    15482    3                RETURN;

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:38   
  15482   2 000191  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      231    15483    3                END;
      232    15484    2           END;

      233    15485        /*
      234    15486          Send the INIT_ACK message to VDH indicating the connection can
      235    15487          be established.
      236    15488        */
      237    15489    1      GJA_CONNECT_ACK.REASON = %K_REASON_NORMAL;

  15489   2 000194  8700 0000 0000  xsym                 CL       GJA_CONNECT_ACK

      238    15490    1      CALL GJA$Q_MSG(CTX$,,,SIZEC(GJA_CONNECT_ACK),

  15490   2 000197  EBF0 000C                            LAB,B6   12,IMO
          2 000199  DBF0 0002                            LAB,B5   2,IMO
          2 00019B  DFC7 004E                            STB,B5   MSGSIZ+11,AUTO
          2 00019D  CB80 0000 0000  xsym                 LAB,B4   GJA_CONNECT_ACK
          2 0001A0  CFC7 004C                            STB,B4   MSGSIZ+9,AUTO
          2 0001A2  EFC7 004A                            STB,B6   MSGSIZ+7,AUTO
          2 0001A4  BB80 0000 0000                       LAB,B3   0
          2 0001A7  BFC7 0048                            STB,B3   MSGSIZ+5,AUTO
          2 0001A9  AB80 0000 0000                       LAB,B2   0
          2 0001AC  AFC7 0046                            STB,B2   MSGSIZ+3,AUTO
          2 0001AE  9CC7 0004                            LDB,B1   @CTX$,AUTO
          2 0001B0  9FC7 0044                            STB,B1   MSGSIZ+1,AUTO
          2 0001B2  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 0001B4  CBF0 0600                            LAB,B4   1536,IMO
          2 0001B6  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 0001B9       0001                            DC       s:15493,PREL

      239    15491    1        GJA_CONNECT_ACK,%KN_FCN_INIT_ACK);
      240    15492
      241    15493    1      CHN$ = GJA$LGNCTX.CHN$;

  15493   2 0001BA  ECC7 0004                            LDB,B6   @CTX$,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:39   
          2 0001BC  DC86                                 LDB,B5   ,B6
          2 0001BD  CCC5 000A                            LDB,B4   10,B5
          2 0001BF  CFC7 002F                            STB,B4   CHN$,AUTO

      242    15494        /*
      243    15495           If a logon string is there, send to SLUG and return.
      244    15496        */
      245    15497    1      IF KNH$MESS.MSGSZ ~= 0

  15497   2 0001C1  8CC7 0006                            LDI      @KNH$MESS,AUTO
          2 0001C3  B856                                 LDR,R3   R6
          2 0001C4  E570 7FFF                            AND,R6   32767,IMO
          2 0001C6  8D47 0044                            SDI      MSGSIZ+1,AUTO
          2 0001C8  DCC7 0044                            LDB,B5   MSGSIZ+1,AUTO
          2 0001CA  304F                                 SOR,R3   15
          2 0001CB  5C02                                 LDV,R5   2
          2 0001CC  0021                                 ALR      ;
          2 0001CD       4235 0007                                ALPHANUM(7,B5,R3,,2),;
          2 0001CF       4007 0046                                ALPHANUM(MSGSIZ+3,AUTO,,R5,FILL)
          2 0001D1  437F                                 CSYNC    s:15497+15,SPREL
          2 0001D2  C847 0046                            LDR,R4   MSGSIZ+3,AUTO
          2 0001D4  4901 0030                            BEZ,R4   s:15504,PREL

      246    15498    2      THEN DO;

      247    15499    2           GJA$LGNCTX.MSG$ = PINCRW(ADDR(FPT_CONNECT),SIZEW(FPT_CONNECT));

  15499   2 0001D6  BC86                                 LDB,B3   ,B6
          2 0001D7  ACC7 0008                            LDB,B2   @FPT_CONNECT,AUTO
          2 0001D9  9BC2 0013                            LAB,B1   19,B2
          2 0001DB  9FC3 000C                            STB,B1   12,B3

      248    15500    2           CALL GJA$SOLICIT_NM ( CTX$, KNH$MESS.MSGSZ );

  15500   2 0001DD  8CC7 0006                            LDI      @KNH$MESS,AUTO
          2 0001DF  B856                                 LDR,R3   R6
          2 0001E0  E570 7FFF                            AND,R6   32767,IMO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:40   
          2 0001E2  8D47 0044                            SDI      MSGSIZ+1,AUTO
          2 0001E4  DCC7 0044                            LDB,B5   MSGSIZ+1,AUTO
          2 0001E6  304F                                 SOR,R3   15
          2 0001E7  DFC7 004A                            STB,B5   MSGSIZ+7,AUTO
          2 0001E9  8CC7 004A                            LDI      MSGSIZ+7,AUTO
          2 0001EB  7031                                 DCL,R7   1
          2 0001EC  8D47 004C                            SDI      MSGSIZ+9,AUTO
          2 0001EE  F853                                 LDR,R7   R3
          2 0001EF  6C00                                 LDV,R6   0
          2 0001F0  8447 004C                            AID      MSGSIZ+9,AUTO
          2 0001F2  7071                                 DCR,R7   1
          2 0001F3  8470 0000 0007                       AID      7,IMO
          2 0001F6  8D47 0048                            SDI      MSGSIZ+5,AUTO
          2 0001F8  EFC7 0046                            STB,B6   MSGSIZ+3,AUTO
          2 0001FA  BBC7 0046                            LAB,B3   MSGSIZ+3,AUTO
          2 0001FC  CBF0 0200                            LAB,B4   512,IMO
          2 0001FE  E380 0000 0000  xent                 LNJ,B6   GJA$SOLICIT_NM
          2 000201       0001                            DC       s:15501,PREL

      249    15501    2           RETURN;

  15501   2 000202  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      250    15502    2           END;
      251    15503        /* If there is a clock set it  */
      252    15504    1      IF KH$CHN.LGNTIMOUTPRD ~= 0

  15504   2 000205  B2C4 000A                            LLH,R3   10,B4
          2 000207  3901 0019                            BEZ,R3   s:15512,PREL

      253    15505    2      THEN DO;

      254    15506    2           SET_CLK.CTBCTX$ = ADDR(NIL);

  15506   2 000209  BB80 0000 0000                       LAB,B3   0
          2 00020C  BF80 0000 0038  00                   STB,B3   SET_CLK

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:41   
      255    15507    2           SET_CLK.UID$ = CTX$;

  15507   2 00020F  AC86                                 LDB,B2   ,B6
          2 000210  AF80 0000 003A  00                   STB,B2   SET_CLK+2

      256    15508    2           SET_CLK.PRD = KH$CHN.LGNTIMOUTPRD;

  15508   2 000213  B2C4 000A                            LLH,R3   10,B4
          2 000215  BF00 0000 0042  00                   STR,R3   SET_CLK+10

      257    15509    2           CALL KHC$CLOCK(SET_CLK);

  15509   2 000218  BB80 0000 0002  03                   LAB,B3   +2
          2 00021B  CBF0 0100                            LAB,B4   256,IMO
          2 00021D  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          2 000220       0001                            DC       s:15512,PREL

      258    15510    2           END;

      259    15511
      260    15512    1      AGAIN = '0'B;

  15512   2 000221  8747 002E                            CL       AGAIN,AUTO

      261    15513    1      GOTO COMMON;

  15513   2 000223  0F81 002D                            B        s:15529,PREL

      262    15514        /*
      263    15515          If we enter here, its because when we were called the first time
      264    15516          the network manager had not as yet connected to us.  CTX$ is all
      265    15517          setup to point to the context we are interested in.
      266    15518        */
      267    15519    1   GJA$LOGON_REQUEST_AGAIN: ENTRY(CTX$) ALTRET;

  15519   2 000225  D380 0000 0000  xent GJA$LOGON_REQUE*LNJ,B5   X6A_AUTO_3
          2 000228       0058 0003                       DC       88,3
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:42   

      268    15520
      269    15521
      270    15522    1      AGAIN = '1'B;

  15522   2 00022A  8947 002E                            LBT,'8000'X       AGAIN,AUTO
  15522   2 00022C       8000

      271    15523    1      GJA$LGNCTX.STATUS.WAITING_HOST = '0'B;

  15523   2 00022D  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 00022F  DC86                                 LDB,B5   ,B6
          2 000230  8845 0018                            LBF,'0040'X       24,B5
          2 000232       0040

      272    15524    1      IF GJA$LGNCTX.STATUS.WTPRO

  15524   2 000233  DC86                                 LDB,B5   ,B6
          2 000234  82C5 0018                            LB,'0200'X        24,B5
          2 000236       0200
          2 000237  0581 0003                            BBF      s:15529,PREL

      273    15525    1      THEN
      274    15526    1           AGAIN = '0'B;

  15526   2 000239  8747 002E                            CL       AGAIN,AUTO

      275    15527
      276    15528        /* If we are terminate just return */
      277    15529    1      IF GJA$LGNCTX.STATUS.TERM

  15529   2 00023B  89C5 0018                            CMZ      24,B5
          2 00023D  0801 0010                            BAL      s:15534,PREL
          2 00023F  82C5 0018                            LB,'1000'X        24,B5
          2 000241       1000
          2 000242  0501 000B                            BBT      s:15534,PREL
          2 000244  82C5 0018                            LB,'0100'X        24,B5
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:43   
          2 000246       0100
          2 000247  0501 0006                            BBT      s:15534,PREL
          2 000249  82C5 0018                            LB,'2000'X        24,B5
          2 00024B       2000
          2 00024C  0581 0004                            BBF      s:15529,PREL

      278    15530    1        OR GJA$LGNCTX.STATUS.TERMACK
      279    15531    1        OR GJA$LGNCTX.STATUS.DSCRCV
      280    15532    1        OR GJA$LGNCTX.STATUS.NMRSP
      281    15533    1      THEN
      282    15534    1           RETURN;

  15534   2 00024E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

  15529   2                              COMMON          null
      283    15535
      284    15536
      285    15537    1   COMMON: ;
      286    15538        /*
      287    15539          Get a pointer to the channel table entry for the channel attempting
      288    15540          logon
      289    15541        */
      290    15542    1      TERMINAL$ID=GJA$LGNCTX.TERMINAL_ID;

  15542   2 000251  ECC7 0004            COMMON          LDB,B6   @CTX$,AUTO
          2 000253  DC86                                 LDB,B5   ,B6
          2 000254  AB85                                 LAB,B2   ,B5
          2 000255  2C1E                                 LDV,R2   30
          2 000256  6C10                                 LDV,R6   16
          2 000257  BB87                                 LAB,B3   ,AUTO
          2 000258  3C76                                 LDV,R3   118
          2 000259  0008                                 MMM

      291    15543        /*
      292    15544          If we need to salute the line, do it.
      293    15545        */
      294    15546    1      CHN$=GJA$LGNCTX.CHN$;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:44   

  15546   2 00025A  CC86                                 LDB,B4   ,B6
          2 00025B  9CC4 000A                            LDB,B1   10,B4
          2 00025D  9FC7 002F                            STB,B1   CHN$,AUTO

      295    15547
      296    15548    1      IF KH$CHN.PROFILE AND NOT GJA$LGNCTX.STATUS.WTPRO AND GJA_LDCT_NM ~= 0

  15548   2 00025F  8281                                 LB,'0001'X        ,B1
  15548   2 000260       0001
          2 000261  0581 003B                            BBF      s:15558,PREL
          2 000263  82C4 0018                            LB,'0200'X        24,B4
          2 000265       0200
          2 000266  0501 0036                            BBT      s:15558,PREL
          2 000268  E800 0000 0000  xsym                 LDR,R6   GJA_LDCT_NM
          2 00026B  6901 0031                            BEZ,R6   s:15558,PREL

      297    15549    2      THEN DO;

      298    15550    2           GJA_RQSPROFILE.NMID = CTX;

  15550   2 00026D  8C86                                 LDI      ,B6
          2 00026E  8D00 0000 0011  00                   SDI      GJA_RQSPROFILE+10

      299    15551    2           GJA_RQSPROFILE.HANDLER = ' ';

  15551   2 000271  CB80 0000 0000  00                   LAB,B4   KV$VDO_DAT_IMD
          2 000274  0021                                 ALR      ;
          2 000275       4178 2000                                ALPHANUM('2000'X,IMO,,1),;
          2 000277       4804 0013                                ALPHANUM(19,B4,,8,FILL)

      300    15552    2           GJA_RQSPROFILE.TERMID = GJA$LGNCTX.TERMINAL_ID;

  15552   2 000279  437F                                 CSYNC    s:15551+7,SPREL
          2 00027A  CC86                                 LDB,B4   ,B6
          2 00027B  AB84                                 LAB,B2   ,B4
          2 00027C  2C1E                                 LDV,R2   30
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:45   
          2 00027D  6C10                                 LDV,R6   16
          2 00027E  BB80 0000 0000  00                   LAB,B3   KV$VDO_DAT_IMD
          2 000281  3C12                                 LDV,R3   18
          2 000282  0008                                 MMM

      301    15553    2           CALL GJA$NETWORK_MANAGER(GJA_RQSPROFILE,SIZEC(GJA_RQSPROFILE));

  15553   2 000283  BBF0 0020                            LAB,B3   32,IMO
          2 000285  BFC7 0046                            STB,B3   MSGSIZ+3,AUTO
          2 000287  9B80 0000 0007  00                   LAB,B1   GJA_RQSPROFILE
          2 00028A  9FC7 0044                            STB,B1   MSGSIZ+1,AUTO
          2 00028C  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 00028E  CBF0 0200                            LAB,B4   512,IMO
          2 000290  E380 0000 0000  xent                 LNJ,B6   GJA$NETWORK_MANAGER
          2 000293       0001                            DC       s:15554,PREL

      302    15554    2           GJA$LGNCTX.STATUS.WTPRO = '1'B;

  15554   2 000294  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 000296  DC86                                 LDB,B5   ,B6
          2 000297  8945 0018                            LBT,'0200'X       24,B5
          2 000299       0200

      303    15555    2           RETURN;

  15555   2 00029A  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      304    15556    2           END;
      305    15557    1      ELSE
      306    15558    1           GJA$LGNCTX.STATUS.WTPRO = '0'B;

  15558   2 00029D  8844 0018                            LBF,'0200'X       24,B4
  15558   2 00029F       0200

      307    15559
      308    15560    1      NMAVAIL = '0'B;

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:46   
  15560   2 0002A0  8747 0031                            CL       NMAVAIL,AUTO

      309    15561    1      NMCTX$ = GJA_NM_HEAD$;

  15561   2 0002A2  CC80 0000 0000  xsym                 LDB,B4   GJA_NM_HEAD$
          2 0002A5  CFC7 0032                            STB,B4   NMCTX$,AUTO

      310    15562    2   FNDNM: DO WHILE NMCTX$ ~= ADDR(NIL);

  15562   2 0002A7  0F81 0015            FNDNM           B        s:15569,PREL

      311    15563    2           IF NMCTX$->GJA$HAND_CTX.HOST_NODE AND

  15563   2 0002A9  ECC7 0032                            LDB,B6   NMCTX$,AUTO
          2 0002AB  82C6 000D                            LB,'2000'X        13,B6
          2 0002AD       2000
          2 0002AE  0581 000A                            BBF      s:15568,PREL
          2 0002B0  8286                                 LB,'1FFF'X        ,B6
          2 0002B1       1FFF
          2 0002B2  0581 0006                            BBF      s:15568,PREL

      312    15564    3             NMCTX$->GJA$HAND_CTX.LDCTX ~= 0 THEN DO;

      313    15565    3                NMAVAIL = '1'B;

  15565   2 0002B4  8947 0031                            LBT,'8000'X       NMAVAIL,AUTO
  15565   2 0002B6       8000

      314    15566    3                EXIT FNDNM;

  15566   2 0002B7  0F81 0008                            B        s:15570,PREL

      315    15567    3                END;
      316    15568    2           NMCTX$ = NMCTX$->GJA$HAND_CTX.LNK$;

  15568   2 0002B9  DCC6 0001                            LDB,B5   1,B6
          2 0002BB  DFC7 0032                            STB,B5   NMCTX$,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:47   

      317    15569    2           END;

  15569   2 0002BD  8DC7 0032                            CMN      NMCTX$,AUTO
          2 0002BF  09EA                                 BNE      s:15563,SPREL

      318    15570    1      IF KH$CHN.SNDSLT AND GJA$LGNCTX.STATUS.INT

  15570   2 0002C0  ECC7 002F                            LDB,B6   CHN$,AUTO
          2 0002C2  82C6 0009                            LB,'0400'X        9,B6
          2 0002C4       0400
          2 0002C5  0581 0245                            BBF      s:15629,PREL
          2 0002C7  DCC7 0004                            LDB,B5   @CTX$,AUTO
          2 0002C9  CC85                                 LDB,B4   ,B5
          2 0002CA  82C4 0018                            LB,'0400'X        24,B4
          2 0002CC       0400
          2 0002CD  0581 023D                            BBF      s:15629,PREL

      319    15571    2      THEN DO;                             /* SALUTE                   */

      320    15572
      321    15573        /* Send host down message if it is */
      322    15574    2           IF GJA_LDCT_NM =0

  15574   2 0002CF  E800 0000 0000  xsym                 LDR,R6   GJA_LDCT_NM
          2 0002D2  6981 0024                            BNEZ,R6  s:15581,PREL

      323    15575    3           THEN DO;

      324    15576    3                MSGSIZ = GJA_MSG_DOWN$->TEXTC.SIZE;

  15576   2 0002D4  BC80 0000 0000  xsym                 LDB,B3   GJA_MSG_DOWN$
          2 0002D7  D283                                 LLH,R5   ,B3
          2 0002D8  DF47 0043                            STR,R5   MSGSIZ,AUTO

      325    15577    3                CALL GJA$SEND_MSG(CTX$,GJA_MSG_DOWN$->TEXTC.STRING,MSGSIZ,%
             15577                         VFC_TRANSITION0);
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:48   

  15577   2 0002DA  CB80 0000 0004  03                   LAB,B4   +4
          2 0002DD  CFC7 004A                            STB,B4   MSGSIZ+7,AUTO
          2 0002DF  ABC7 0043                            LAB,B2   MSGSIZ,AUTO
          2 0002E1  AFC7 0048                            STB,B2   MSGSIZ+5,AUTO
          2 0002E3  8C80 0000 0000  xsym                 LDI      GJA_MSG_DOWN$
          2 0002E6  7031                                 DCL,R7   1
          2 0002E7  8470 0000 0001                       AID      1,IMO
          2 0002EA  7071                                 DCR,R7   1
          2 0002EB  8D47 0046                            SDI      MSGSIZ+3,AUTO
          2 0002ED  DFC7 0044                            STB,B5   MSGSIZ+1,AUTO
          2 0002EF  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 0002F1  CBF0 0400                            LAB,B4   1024,IMO
          2 0002F3  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 0002F6       0001                            DC       s:15581,PREL

      326    15578    3                END;

      327    15579
      328    15580        /* If we were call at AGAIN then send the Host resumed message */
      329    15581    2           IF AGAIN

  15581   2 0002F7  89C7 002E                            CMZ      AGAIN,AUTO
          2 0002F9  0881 0026                            BAGE     s:15587,PREL

      330    15582    3           THEN DO;

      331    15583    3                MSGSIZ = GJA_HOSTRESUMED$->TEXTC.SIZE;

  15583   2 0002FB  EC80 0000 0000  xsym                 LDB,B6   GJA_HOSTRESUMED$
          2 0002FE  E286                                 LLH,R6   ,B6
          2 0002FF  EF47 0043                            STR,R6   MSGSIZ,AUTO

      332    15584    3                CALL GJA$SEND_MSG(CTX$,GJA_HOSTRESUMED$->TEXTC.STRING,MSGSIZ,%
             15584                         VFC_TRANSITION0);

  15584   2 000301  DB80 0000 0004  03                   LAB,B5   +4
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:49   
          2 000304  DFC7 004A                            STB,B5   MSGSIZ+7,AUTO
          2 000306  CBC7 0043                            LAB,B4   MSGSIZ,AUTO
          2 000308  CFC7 0048                            STB,B4   MSGSIZ+5,AUTO
          2 00030A  8C80 0000 0000  xsym                 LDI      GJA_HOSTRESUMED$
          2 00030D  7031                                 DCL,R7   1
          2 00030E  8470 0000 0001                       AID      1,IMO
          2 000311  7071                                 DCR,R7   1
          2 000312  8D47 0046                            SDI      MSGSIZ+3,AUTO
          2 000314  BCC7 0004                            LDB,B3   @CTX$,AUTO
          2 000316  BFC7 0044                            STB,B3   MSGSIZ+1,AUTO
          2 000318  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 00031A  CBF0 0400                            LAB,B4   1024,IMO
          2 00031C  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 00031F       0001                            DC       s:15587,PREL

      333    15585    3                END;

      334    15586
      335    15587    2           MSGSIZ = GJA_MSG_HDR$->TEXTC.SIZE;

  15587   2 000320  EC80 0000 0000  xsym                 LDB,B6   GJA_MSG_HDR$
          2 000323  E286                                 LLH,R6   ,B6
          2 000324  EF47 0043                            STR,R6   MSGSIZ,AUTO

      336    15588    2           IF MSGSIZ > 0 THEN

  15588   2 000326  6901 0020                            BEZ,R6   s:15590,PREL

      337    15589    2                CALL GJA$SEND_MSG(CTX$,GJA_MSG_HDR$->TEXTC.STRING,MSGSIZ,%
             15589                         VFC_TRANSITION0);

  15589   2 000328  DB80 0000 0004  03                   LAB,B5   +4
          2 00032B  DFC7 004A                            STB,B5   MSGSIZ+7,AUTO
          2 00032D  CBC7 0043                            LAB,B4   MSGSIZ,AUTO
          2 00032F  CFC7 0048                            STB,B4   MSGSIZ+5,AUTO
          2 000331  8C80 0000 0000  xsym                 LDI      GJA_MSG_HDR$
          2 000334  7031                                 DCL,R7   1
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:50   
          2 000335  8470 0000 0001                       AID      1,IMO
          2 000338  7071                                 DCR,R7   1
          2 000339  8D47 0046                            SDI      MSGSIZ+3,AUTO
          2 00033B  BCC7 0004                            LDB,B3   @CTX$,AUTO
          2 00033D  BFC7 0044                            STB,B3   MSGSIZ+1,AUTO
          2 00033F  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000341  CBF0 0400                            LAB,B4   1024,IMO
          2 000343  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 000346       0001                            DC       s:15590,PREL

      338    15590    2           IF GJA_LDCT_NM ~= 0

  15590   2 000347  E800 0000 0000  xsym                 LDR,R6   GJA_LDCT_NM
          2 00034A  6901 0026                            BEZ,R6   s:15596,PREL

      339    15591    3           THEN DO;

      340    15592    3                MSGSIZ = GJA_MSG_SALUTE$->TEXTC.SIZE;

  15592   2 00034C  EC80 0000 0000  xsym                 LDB,B6   GJA_MSG_SALUTE$
          2 00034F  D286                                 LLH,R5   ,B6
          2 000350  DF47 0043                            STR,R5   MSGSIZ,AUTO

      341    15593    3                CALL GJA$SEND_MSG(CTX$,GJA_MSG_SALUTE$->TEXTC.STRING,MSGSIZ,%
             15593                         VFC_TRANSITION0);

  15593   2 000352  DB80 0000 0004  03                   LAB,B5   +4
          2 000355  DFC7 004A                            STB,B5   MSGSIZ+7,AUTO
          2 000357  CBC7 0043                            LAB,B4   MSGSIZ,AUTO
          2 000359  CFC7 0048                            STB,B4   MSGSIZ+5,AUTO
          2 00035B  8C80 0000 0000  xsym                 LDI      GJA_MSG_SALUTE$
          2 00035E  7031                                 DCL,R7   1
          2 00035F  8470 0000 0001                       AID      1,IMO
          2 000362  7071                                 DCR,R7   1
          2 000363  8D47 0046                            SDI      MSGSIZ+3,AUTO
          2 000365  BCC7 0004                            LDB,B3   @CTX$,AUTO
          2 000367  BFC7 0044                            STB,B3   MSGSIZ+1,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:51   
          2 000369  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 00036B  CBF0 0400                            LAB,B4   1024,IMO
          2 00036D  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 000370       0001                            DC       s:15596,PREL

      342    15594    3                END;

      343    15595
      344    15596    2           INDX = 0;

  15596   2 000371  8747 0036                            CL       INDX,AUTO

      345    15597    2           CALL BINCHAR(LINE#,GJA_NODE#);

  15597   2 000373  F800 0000 0000  xsym                 LDR,R7   GJA_NODE#
          2 000376  6C00                                 LDV,R6   0
          2 000377  8D47 0044                            SDI      MSGSIZ+1,AUTO
          2 000379  0027                                 CBD      ;
          2 00037A       0407 0044                                BINARY(MSGSIZ+1,AUTO,,4),;
          2 00037C       0407 0038                                UNPACKED(LINE#,AUTO,,4,UNSIGNED)

      346    15598    3           J=0;DO WHILE(SUBSTR(LINE#,J,1)='0'); J = J +1; END;

  15598   2 00037E  8747 0037                            CL       J,AUTO

  15598   2 000380  437F                                 CSYNC    s:15598+1,SPREL
          2 000381  0F81 0003                            B        s:15598+7,PREL

  15598   2 000383  8AC7 0037                            INC      J,AUTO

  15598   2 000385  B847 0037                            LDR,R3   J,AUTO
          2 000387  3E70                                 ADV,R3   112
          2 000388  E0B7                                 LDH,R6   ,AUTO,R3
          2 000389  6D30                                 CMV,R6   48
          2 00038A  0979                                 BE       s:15598+5,SPREL

      347    15599    2           CALL INSERT (LINE_MSG.LINE#,0,14-J,SUBSTR(LINE#,J,4-J),'(',GJA_NODENAME);
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:52   

  15599   2 00038B  AB87                                 LAB,B2   ,AUTO
          2 00038C  A853                                 LDR,R2   R3
          2 00038D  E847 0037                            LDR,R6   J,AUTO
          2 00038F  8256                                 NEG      R6
          2 000390  6E04                                 ADV,R6   4
          2 000391  BB80 0000 0050  00                   LAB,B3   LINE_MSG+13
          2 000394  3C00                                 LDV,R3   0
          2 000395  0008                                 MMM
          2 000396  E847 0037                            LDR,R6   J,AUTO
          2 000398  E256                                 SUB,R6   R6
          2 000399  EF47 0044                            STR,R6   MSGSIZ+1,AUTO
          2 00039B  6003                                 SOL,R6   3
          2 00039C  6E50                                 ADV,R6   80
          2 00039D  6A81 002A                            BLEZ,R6  s:15600,PREL
          2 00039F  AB80 0000 0000  03                   LAB,B2   0
          2 0003A2  2C0A                                 LDV,R2   10
          2 0003A3  6C01                                 LDV,R6   1
          2 0003A4  BB80 0000 0052  00                   LAB,B3   LINE_MSG+15
          2 0003A7  B847 0037                            LDR,R3   J,AUTO
          2 0003A9  8253                                 NEG      R3
          2 0003AA  F847 0044                            LDR,R7   MSGSIZ+1,AUTO
          2 0003AC  7E0A                                 ADV,R7   10
          2 0003AD  D380 0000 0000  xent                 LNJ,B5   X6C_ALR
          2 0003B0  E847 0044                            LDR,R6   MSGSIZ+1,AUTO
          2 0003B2  6003                                 SOL,R6   3
          2 0003B3  6E48                                 ADV,R6   72
          2 0003B4  6A81 0013                            BLEZ,R6  s:15600,PREL
          2 0003B6  AB80 0000 0000  xsym                 LAB,B2   GJA_NODENAME
          2 0003B9  2C00                                 LDV,R2   0
          2 0003BA  6C08                                 LDV,R6   8
          2 0003BB  BB80 0000 0052  00                   LAB,B3   LINE_MSG+15
          2 0003BE  B847 0037                            LDR,R3   J,AUTO
          2 0003C0  8253                                 NEG      R3
          2 0003C1  3E01                                 ADV,R3   1
          2 0003C2  F847 0044                            LDR,R7   MSGSIZ+1,AUTO
          2 0003C4  7E09                                 ADV,R7   9
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:53   
          2 0003C5  D380 0000 0000  xent                 LNJ,B5   X6C_ALR

      348    15600    2           CALL INDEX(INDX,' ',LINE_MSG.LINE#);

  15600   2 0003C8  EB80 0000 0000  00                   LAB,B6   KV$VDO_DAT_IMD
          2 0003CB  E870 0128                            LDR,R6   296,IMO
          2 0003CD  0028                                 SRH      ;
          2 0003CE       4178 2000                                ALPHANUM('2000'X,IMO,,1),;
          2 0003D0       4407 0044                                BINARY(MSGSIZ+1,AUTO,,4),;
          2 0003D2       4006 0050                                ALPHANUM(80,B6,,R6)
          2 0003D4  5381 0006                            CBE      s:15600+19,PREL
          2 0003D6  5C28                                 LDV,R5   40
          2 0003D7  DF47 0036                            STR,R5   INDX,AUTO
          2 0003D9  0F81 0005                            B        s:15601,PREL
          2 0003DB  D847 0045                            LDR,R5   MSGSIZ+2,AUTO
          2 0003DD  DF47 0036                            STR,R5   INDX,AUTO

      349    15601    2           CALL CONCAT(LINE#,

  15601   2 0003DF  C847 003C                            LDR,R4   TERMINAL$ID+1,AUTO
          2 0003E1  404C                                 SOR,R4   12
          2 0003E2  B847 003C                            LDR,R3   TERMINAL$ID+1,AUTO
          2 0003E4  3048                                 SOR,R3   8
          2 0003E5  B570 000F                            AND,R3   15,IMO
          2 0003E7  A847 003C                            LDR,R2   TERMINAL$ID+1,AUTO
          2 0003E9  2044                                 SOR,R2   4
          2 0003EA  A570 000F                            AND,R2   15,IMO
          2 0003EC  9847 003C                            LDR,R1   TERMINAL$ID+1,AUTO
          2 0003EE  9570 000F                            AND,R1   15,IMO
          2 0003F0  BF47 0044                            STR,R3   MSGSIZ+1,AUTO
          2 0003F2  B854                                 LDR,R3   R4
          2 0003F3  C0B0 0000 0000  01                   LDH,R4   HEX,R3
          2 0003F6  C7C7 0038                            STH,R4   LINE#,AUTO
          2 0003F8  B847 0044                            LDR,R3   MSGSIZ+1,AUTO
          2 0003FA  E0B0 0000 0000  01                   LDH,R6   HEX,R3
          2 0003FD  EAC7 0038                            SRM,R6,'00FF'X    LINE#,AUTO
          2 0003FF       00FF
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:54   
          2 000400  E0A0 0000 0000  01                   LDH,R6   HEX,R2
          2 000403  E7C7 0039                            STH,R6   LINE#+1,AUTO
          2 000405  A090 0000 0000  01                   LDH,R2   HEX,R1
          2 000408  AAC7 0039                            SRM,R2,'00FF'X    LINE#+1,AUTO
          2 00040A       00FF

      350    15602    2             HEX(TERMINAL$ID.TERM.CHANNEL/4096),
      351    15603    2             HEX(MOD(TERMINAL$ID.TERM.CHANNEL/256,16)),
      352    15604    2             HEX(MOD(TERMINAL$ID.TERM.CHANNEL/16,16)),
      353    15605    2             HEX(MOD(TERMINAL$ID.TERM.CHANNEL,16)));
      354    15606    2           CALL INSERT (LINE_MSG.LINE#,INDX,6,')-',LINE#);

  15606   2 00040B  AB80 0000 0000  01                   LAB,B2   HEX
          2 00040E  2C10                                 LDV,R2   16
          2 00040F  6C02                                 LDV,R6   2
          2 000410  BB80 0000 0050  00                   LAB,B3   LINE_MSG+13
          2 000413  B847 0036                            LDR,R3   INDX,AUTO
          2 000415  0008                                 MMM
          2 000416  AB87                                 LAB,B2   ,AUTO
          2 000417  2C70                                 LDV,R2   112
          2 000418  6C04                                 LDV,R6   4
          2 000419  BB80 0000 0051  00                   LAB,B3   LINE_MSG+14
          2 00041C  B847 0036                            LDR,R3   INDX,AUTO
          2 00041E  0008                                 MMM

      355    15607    2           INDX = INDX + 6;

  15607   2 00041F  E847 0036                            LDR,R6   INDX,AUTO
          2 000421  6E06                                 ADV,R6   6
          2 000422  EF47 0036                            STR,R6   INDX,AUTO

      356    15608    2           IF TERMINAL$ID.LEV >= %TERMINAL_ID_LEV_SUBCHAN#

  15608   2 000424  D847 003B                            LDR,R5   TERMINAL$ID,AUTO
          2 000426  D570 00FF                            AND,R5   255,IMO
          2 000428  5D02                                 CMV,R5   2
          2 000429  0201 009C                            BL       s:15623,PREL
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:55   

      357    15609    3           THEN DO;

      358    15610    3                CALL BINCHAR(LINE#,TERMINAL$ID.TERM.SUBDEVICE);

  15610   2 00042B  F847 003D                            LDR,R7   TERMINAL$ID+2,AUTO
          2 00042D  6C00                                 LDV,R6   0
          2 00042E  8D47 0044                            SDI      MSGSIZ+1,AUTO
          2 000430  0027                                 CBD      ;
          2 000431       0407 0044                                BINARY(MSGSIZ+1,AUTO,,4),;
          2 000433       0407 0038                                UNPACKED(LINE#,AUTO,,4,UNSIGNED)

      359    15611    4                J=0;DO WHILE(SUBSTR(LINE#,J,1)='0' AND J<3); J = J +1; END;

  15611   2 000435  8747 0037                            CL       J,AUTO

  15611   2 000437  437F                                 CSYNC    s:15611+1,SPREL
          2 000438  0F81 0003                            B        s:15611+7,PREL

  15611   2 00043A  8AC7 0037                            INC      J,AUTO

  15611   2 00043C  B847 0037                            LDR,R3   J,AUTO
          2 00043E  3E70                                 ADV,R3   112
          2 00043F  E0B7                                 LDH,R6   ,AUTO,R3
          2 000440  6D30                                 CMV,R6   48
          2 000441  0981 0005                            BNE      s:15612,PREL
          2 000443  D847 0037                            LDR,R5   J,AUTO
          2 000445  5D03                                 CMV,R5   3
          2 000446  0274                                 BL       s:15611+5,SPREL

      360    15612    3                CALL INSERT(LINE_MSG.LINE#,INDX,5-J,'-',SUBSTR(LINE#,J,4-J));

  15612   2 000447  AB80 0000 0000  03                   LAB,B2   0
          2 00044A  2C0C                                 LDV,R2   12
          2 00044B  6C01                                 LDV,R6   1
          2 00044C  BB80 0000 0050  00                   LAB,B3   LINE_MSG+13
          2 00044F  B847 0036                            LDR,R3   INDX,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:56   
          2 000451  F847 0037                            LDR,R7   J,AUTO
          2 000453  8257                                 NEG      R7
          2 000454  7E05                                 ADV,R7   5
          2 000455  D380 0000 0000  xent                 LNJ,B5   X6C_ALR
          2 000458  E847 0037                            LDR,R6   J,AUTO
          2 00045A  6003                                 SOL,R6   3
          2 00045B  8256                                 NEG      R6
          2 00045C  6E20                                 ADV,R6   32
          2 00045D  6901 0010                            BEZ,R6   s:15613,PREL
          2 00045F  AB87                                 LAB,B2   ,AUTO
          2 000460  A847 0037                            LDR,R2   J,AUTO
          2 000462  2E70                                 ADV,R2   112
          2 000463  E847 0037                            LDR,R6   J,AUTO
          2 000465  8256                                 NEG      R6
          2 000466  6E04                                 ADV,R6   4
          2 000467  BB80 0000 0050  00                   LAB,B3   LINE_MSG+13
          2 00046A  B847 0036                            LDR,R3   INDX,AUTO
          2 00046C  3E01                                 ADV,R3   1
          2 00046D  0008                                 MMM

      361    15613    3                INDX = INDX + 5 - J;

  15613   2 00046E  E847 0036                            LDR,R6   INDX,AUTO
          2 000470  E247 0037                            SUB,R6   J,AUTO
          2 000472  6E05                                 ADV,R6   5
          2 000473  EF47 0036                            STR,R6   INDX,AUTO

      362    15614    3                IF TERMINAL$ID.LEV = %TERMINAL_ID_LEV_SUBSUBCHAN#

  15614   2 000475  D847 003B                            LDR,R5   TERMINAL$ID,AUTO
          2 000477  D570 00FF                            AND,R5   255,IMO
          2 000479  5D03                                 CMV,R5   3
          2 00047A  0981 004B                            BNE      s:15623,PREL

      363    15615    4                THEN DO;

      364    15616    4                     CALL BINCHAR(LINE#,TERMINAL$ID.TERM.SUBSUBDEVICE);
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:57   

  15616   2 00047C  F847 003E                            LDR,R7   TERMINAL$ID+3,AUTO
          2 00047E  6C00                                 LDV,R6   0
          2 00047F  8D47 0044                            SDI      MSGSIZ+1,AUTO
          2 000481  0027                                 CBD      ;
          2 000482       0407 0044                                BINARY(MSGSIZ+1,AUTO,,4),;
          2 000484       0407 0038                                UNPACKED(LINE#,AUTO,,4,UNSIGNED)

      365    15617    5                     J=0;DO WHILE(SUBSTR(LINE#,J,1)='0' AND J<3); J = J +1; END;

  15617   2 000486  8747 0037                            CL       J,AUTO

  15617   2 000488  437F                                 CSYNC    s:15617+1,SPREL
          2 000489  0F81 0003                            B        s:15617+7,PREL

  15617   2 00048B  8AC7 0037                            INC      J,AUTO

  15617   2 00048D  B847 0037                            LDR,R3   J,AUTO
          2 00048F  3E70                                 ADV,R3   112
          2 000490  E0B7                                 LDH,R6   ,AUTO,R3
          2 000491  6D30                                 CMV,R6   48
          2 000492  0981 0005                            BNE      s:15618,PREL
          2 000494  D847 0037                            LDR,R5   J,AUTO
          2 000496  5D03                                 CMV,R5   3
          2 000497  0274                                 BL       s:15617+5,SPREL

      366    15618    4                     CALL INSERT(LINE_MSG.LINE#,INDX,5-J,'-',SUBSTR(LINE#,J,4-J));

  15618   2 000498  AB80 0000 0000  03                   LAB,B2   0
          2 00049B  2C0C                                 LDV,R2   12
          2 00049C  6C01                                 LDV,R6   1
          2 00049D  BB80 0000 0050  00                   LAB,B3   LINE_MSG+13
          2 0004A0  B847 0036                            LDR,R3   INDX,AUTO
          2 0004A2  F847 0037                            LDR,R7   J,AUTO
          2 0004A4  8257                                 NEG      R7
          2 0004A5  7E05                                 ADV,R7   5
          2 0004A6  D380 0000 0000  xent                 LNJ,B5   X6C_ALR
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:58   
          2 0004A9  E847 0037                            LDR,R6   J,AUTO
          2 0004AB  6003                                 SOL,R6   3
          2 0004AC  8256                                 NEG      R6
          2 0004AD  6E20                                 ADV,R6   32
          2 0004AE  6901 0010                            BEZ,R6   s:15619,PREL
          2 0004B0  AB87                                 LAB,B2   ,AUTO
          2 0004B1  A847 0037                            LDR,R2   J,AUTO
          2 0004B3  2E70                                 ADV,R2   112
          2 0004B4  E847 0037                            LDR,R6   J,AUTO
          2 0004B6  8256                                 NEG      R6
          2 0004B7  6E04                                 ADV,R6   4
          2 0004B8  BB80 0000 0050  00                   LAB,B3   LINE_MSG+13
          2 0004BB  B847 0036                            LDR,R3   INDX,AUTO
          2 0004BD  3E01                                 ADV,R3   1
          2 0004BE  0008                                 MMM

      367    15619    4                     INDX = INDX + 5 - J;

  15619   2 0004BF  E847 0036                            LDR,R6   INDX,AUTO
          2 0004C1  E247 0037                            SUB,R6   J,AUTO
          2 0004C3  6E05                                 ADV,R6   5
          2 0004C4  EF47 0036                            STR,R6   INDX,AUTO

      368    15620    4                     END;

      369    15621    3                END;

      370    15622
      371    15623    2           CALL M$TIME (FPT_TIME);

  15623   2 0004C6  BB80 0000 0028  00                   LAB,B3   FPT_TIME
          2 0004C9  B870 14D4                            LDR,R3   5332,IMO
          2 0004CB  0001                                 MCL
          2 0004CC       0000                            DC       s:15623+6,PREL

      372    15624    2           MSGSIZ = POFFC(ADDR(LINE_MSG.LINE#),ADDR(LINE_MSG)) + INDX;

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:59   
  15624   2 0004CD  EB80 0000 0000  00                   LAB,B6   KV$VDO_DAT_IMD
          2 0004D0  EFC7 0044                            STB,B6   MSGSIZ+1,AUTO
          2 0004D2  8CC7 0044                            LDI      MSGSIZ+1,AUTO
          2 0004D4  8470 0000 0043                       AID      67,IMO
          2 0004D7  7031                                 DCL,R7   1
          2 0004D8  DB80 0000 0000  00                   LAB,B5   KV$VDO_DAT_IMD
          2 0004DB  DFC7 0046                            STB,B5   MSGSIZ+3,AUTO
          2 0004DD  8D47 0048                            SDI      MSGSIZ+5,AUTO
          2 0004DF  8CC7 0046                            LDI      MSGSIZ+3,AUTO
          2 0004E1  8470 0000 0050                       AID      80,IMO
          2 0004E4  7031                                 DCL,R7   1
          2 0004E5  84C7 0048                            SID      MSGSIZ+5,AUTO
          2 0004E7  8D47 004A                            SDI      MSGSIZ+7,AUTO
          2 0004E9  F847 0036                            LDR,R7   INDX,AUTO
          2 0004EB  6C00                                 LDV,R6   0
          2 0004EC  8447 004A                            AID      MSGSIZ+7,AUTO
          2 0004EE  E857                                 LDR,R6   R7
          2 0004EF  EF47 0043                            STR,R6   MSGSIZ,AUTO

      373    15625    2           CALL GJA$SEND_MSG(CTX$,LINE_MSG,MSGSIZ,%VFC_TRANSITION0);

  15625   2 0004F1  CB80 0000 0004  03                   LAB,B4   +4
          2 0004F4  CFC7 004A                            STB,B4   MSGSIZ+7,AUTO
          2 0004F6  BBC7 0043                            LAB,B3   MSGSIZ,AUTO
          2 0004F8  BFC7 0048                            STB,B3   MSGSIZ+5,AUTO
          2 0004FA  AB80 0000 0043  00                   LAB,B2   LINE_MSG
          2 0004FD  AFC7 0046                            STB,B2   MSGSIZ+3,AUTO
          2 0004FF  DCC7 0004                            LDB,B5   @CTX$,AUTO
          2 000501  DFC7 0044                            STB,B5   MSGSIZ+1,AUTO
          2 000503  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000505  CBF0 0400                            LAB,B4   1024,IMO
          2 000507  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 00050A       0001                            DC       s:15629,PREL

      374    15626    2           END;

      375    15627
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:60   
      376    15628        /* If the NM is connect solict the LOGON */
      377    15629    2      IF NMAVAIL ~= '0'B THEN DO;

  15629   2 00050B  89C7 0031                            CMZ      NMAVAIL,AUTO
          2 00050D  0881 00B1                            BAGE     s:15667,PREL

      378    15630        /*
      379    15631          If we are to solicit this line, do it
      380    15632        */
      381    15633    2           IF NOT(KH$CHN.AUTLGN)

  15633   2 00050F  ECC7 002F                            LDB,B6   CHN$,AUTO
          2 000511  8286                                 LB,'0004'X        ,B6
          2 000512       0004
          2 000513  0501 008E                            BBT      s:15661,PREL

      382    15634    2           THEN
      383    15635    2                IF GJA$LGNCTX.STATUS.INT

  15635   2 000515  DCC7 0004                            LDB,B5   @CTX$,AUTO
          2 000517  CC85                                 LDB,B4   ,B5
          2 000518  82C4 0018                            LB,'0400'X        24,B4
          2 00051A       0400
          2 00051B  0581 004E                            BBF      s:15649,PREL

      384    15636    3                THEN DO;
             15636                 /* read is already there send dat_imd with just vfc to have vdh reprompt*/

      385    15637    4                     IF GJA$LGNCTX.STATUS.RDPND THEN DO;

  15637   2 00051D  82C4 0018                            LB,'0080'X        24,B4
  15637   2 00051F       0080
          2 000520  0581 0024                            BBF      s:15643,PREL

      386    15638    4                          CALL GJA$Q_MSG(CTX$,SIZEC(KV$VDO_DAT_IMD),KV$VDO_DAT_IMD);

  15638   2 000522  BBF0 0006                            LAB,B3   6,IMO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:61   
          2 000524  AB80 0000 0000  00                   LAB,B2   KV$VDO_DAT_IMD
          2 000527  AFC7 0048                            STB,B2   MSGSIZ+5,AUTO
          2 000529  BFC7 0046                            STB,B3   MSGSIZ+3,AUTO
          2 00052B  DFC7 0044                            STB,B5   MSGSIZ+1,AUTO
          2 00052D  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 00052F  CBF0 0300                            LAB,B4   768,IMO
          2 000531  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 000534       0001                            DC       s:15639,PREL

      387    15639    4                          GJA$LGNCTX.STATUS.RDPND= '0'B;

  15639   2 000535  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 000537  DC86                                 LDB,B5   ,B6
          2 000538  8845 0018                            LBF,'0080'X       24,B5
          2 00053A       0080

      388    15640    4                          CALL GJA$SOLICIT_LOGON(CTX$);

  15640   2 00053B  BBC7 0004                            LAB,B3   @CTX$,AUTO
          2 00053D  CBF0 0100                            LAB,B4   256,IMO
          2 00053F  E380 0000 0000  xent                 LNJ,B6   GJA$SOLICIT_LOGON
          2 000542       0001                            DC       s:15641,PREL

      389    15641    4                          END;

  15641   2 000543  0F81 007B                            B        s:15667,PREL

      390    15642    4                     ELSE DO;

      391    15643    4                          MSGSIZ=SIZEC(GJA_PROMPT_VDO)+GJA_PROMPT_VDO.TL.LEN;

  15643   2 000545  E800 0000 0003  xsym                 LDR,R6   GJA_PROMPT_VDO+3
          2 000548  E570 00FF                            AND,R6   255,IMO
          2 00054A  6E08                                 ADV,R6   8
          2 00054B  EF47 0043                            STR,R6   MSGSIZ,AUTO

      392    15644    4                          CALL GJA$Q_MSG(CTX$,MSGSIZ,GJA_PROMPT_VDO);
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:62   

  15644   2 00054D  CB80 0000 0000  xsym                 LAB,B4   GJA_PROMPT_VDO
          2 000550  CFC7 0048                            STB,B4   MSGSIZ+5,AUTO
          2 000552  BBC7 0043                            LAB,B3   MSGSIZ,AUTO
          2 000554  BFC7 0046                            STB,B3   MSGSIZ+3,AUTO
          2 000556  DFC7 0044                            STB,B5   MSGSIZ+1,AUTO
          2 000558  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 00055A  CBF0 0300                            LAB,B4   768,IMO
          2 00055C  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 00055F       0001                            DC       s:15645,PREL

      393    15645    4                          CALL GJA$SOLICIT_LOGON(CTX$);

  15645   2 000560  BBC7 0004                            LAB,B3   @CTX$,AUTO
          2 000562  CBF0 0100                            LAB,B4   256,IMO
          2 000564  E380 0000 0000  xent                 LNJ,B6   GJA$SOLICIT_LOGON
          2 000567       0001                            DC       s:15647,PREL

      394    15646    4                          END;

      395    15647    3                     END;

  15647   2 000568  0F81 0056                            B        s:15667,PREL

      396    15648    3                ELSE DO;

      397    15649    3                     ADMIN = GJA_ADMIN;

  15649   2 00056A  AB80 0000 0000  xsym                 LAB,B2   GJA_ADMIN
          2 00056D  2C00                                 LDV,R2   0
          2 00056E  6C44                                 LDV,R6   68
          2 00056F  BB87                                 LAB,B3   ,AUTO
          2 000570  3C18                                 LDV,R3   24
          2 000571  0008                                 MMM

      398    15650    3                     ADMIN.TERMID_LO = GJA$LGNCTX.TERMINAL_ID;

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:63   
  15650   2 000572  EC85                                 LDB,B6   ,B5
          2 000573  AB86                                 LAB,B2   ,B6
          2 000574  2C1E                                 LDV,R2   30
          2 000575  6C10                                 LDV,R6   16
          2 000576  BB87                                 LAB,B3   ,AUTO
          2 000577  3C3C                                 LDV,R3   60
          2 000578  0008                                 MMM

      399    15651    3                     ADMIN.TERMID_HI = GJA$LGNCTX.TERMINAL_ID;

  15651   2 000579  CC85                                 LDB,B4   ,B5
          2 00057A  AB84                                 LAB,B2   ,B4
          2 00057B  2C1E                                 LDV,R2   30
          2 00057C  6C10                                 LDV,R6   16
          2 00057D  BB87                                 LAB,B3   ,AUTO
          2 00057E  3C4C                                 LDV,R3   76
          2 00057F  0008                                 MMM

      400    15652    3                     ADMIN.FNC = %KHA_FNC_KILL;

  15652   2 000580  6C03                                 LDV,R6   3
          2 000581  EF47 001D                            STR,R6   ADMIN+17,AUTO

      401    15653    3                    CALL GJA$SEND_MSG(GJA$LGNCTX.CHN$->KH$CHN.HAND$,ADMIN,SIZEC(ADMIN)
             15653                              )

  15653   2 000583  9C85                                 LDB,B1   ,B5
          2 000584  ECC1 000A                            LDB,B6   10,B1
          2 000586  DBF0 0044                            LAB,B5   68,IMO
          2 000588  DFC7 0048                            STB,B5   MSGSIZ+5,AUTO
          2 00058A  9BC7 000C                            LAB,B1   ADMIN,AUTO
          2 00058C  9FC7 0046                            STB,B1   MSGSIZ+3,AUTO
          2 00058E  DBC6 001E                            LAB,B5   30,B6
          2 000590  DFC7 0044                            STB,B5   MSGSIZ+1,AUTO
          2 000592  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000594  CBF0 0300                            LAB,B4   768,IMO
          2 000596  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:64   
          2 000599       0003                            DC       s:15655,PREL
          2 00059A  0F81 0004                            B        s:15657,PREL

      402    15654    4                     WHENALTRETURN DO;

      403    15655    4                          ALTRETURN;

  15655   2 00059C  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      404    15656    4                          END;
      405    15657    3                     RETURN;

  15657   2 00059F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      406    15658    3                     END;
      407    15659    3           ELSE DO;

      408    15660        /* autologon lines shouldn't bother if the nm is available.*/
      409    15661    3                IF GJA_LDCT_NM ~= 0 THEN

  15661   2 0005A2  E800 0000 0000  xsym                 LDR,R6   GJA_LDCT_NM
          2 0005A5  6901 0009                            BEZ,R6   s:15663,PREL

      410    15662    3                     GJA$LGNCTX.MSG$=ADDR(NIL);

  15662   2 0005A7  DCC7 0004                            LDB,B5   @CTX$,AUTO
          2 0005A9  CC85                                 LDB,B4   ,B5
          2 0005AA  BB80 0000 0000                       LAB,B3   0
          2 0005AD  BFC4 000C                            STB,B3   12,B4

      411    15663    3                CALL GJA$SOLICIT_NM(CTX$,0);

  15663   2 0005AF  DBF0 0000                            LAB,B5   0,IMO
          2 0005B1  DFC7 0046                            STB,B5   MSGSIZ+3,AUTO
          2 0005B3  CCC7 0004                            LDB,B4   @CTX$,AUTO
          2 0005B5  CFC7 0044                            STB,B4   MSGSIZ+1,AUTO
          2 0005B7  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:65   
          2 0005B9  CBF0 0200                            LAB,B4   512,IMO
          2 0005BB  E380 0000 0000  xent                 LNJ,B6   GJA$SOLICIT_NM
          2 0005BE       0001                            DC       s:15667,PREL

      412    15664    3                END;

      413    15665    2           END;

      414    15666
      415    15667    1      RETURN;

  15667   2 0005BF  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      416    15668        %EJECT;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:66   
      417    15669        /*F*
      418    15670             NAME:     GJA$HOST_RECOVERY
      419    15671
      420    15672             PURPOSE:  This routine cleans up the device in logon on HOST recovery
      421    15673
      422    15674             DESCRIPTION: This routine disconnects all users that are trying
      423    15675                          to logon when the host disappears.
      424    15676                       and send an admin HOSTDOWN to all handlers.
      425    15677
      426    15678              */
      427    15679
      428    15680    1   GJA$HOST_RECOVERY: ENTRY(CTX$) ALTRET;

  15680   2 0005C2  D380 0000 0000  xent GJA$HOST_RECOVE*LNJ,B5   X6A_AUTO_3
          2 0005C5       0058 0003                       DC       88,3

      429    15681
      430    15682    1      NODE = CTX;

  15682   2 0005C7  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 0005C9  E846 0001                            LDR,R6   1,B6
          2 0005CB  EF47 003A                            STR,R6   NODE,AUTO

      431    15683    1      CTXLGN$ = GJA_USRLGN_HEAD$;

  15683   2 0005CD  DC80 0000 0000  xsym                 LDB,B5   GJA_USRLGN_HEAD$
          2 0005D0  DFC7 000A                            STB,B5   CTXLGN$,AUTO

      432    15684
      433    15685    2      DO WHILE (CTXLGN$ ~= ADDR(NIL));

  15685   2 0005D2  0F81 00B7                            B        s:15714,PREL

      434    15686
      435    15687    2           CHN$ = CTXLGN$->GJA$LGNCTX.LNK$;

  15687   2 0005D4  ECC7 000A                            LDB,B6   CTXLGN$,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:67   
          2 0005D6  DCC6 0001                            LDB,B5   1,B6
          2 0005D8  DFC7 002F                            STB,B5   CHN$,AUTO

      436    15688    2           IF (GJA_DEFNODE = NODE AND NOT CTXLGN$->GJA$LGNCTX.STATUS.NMRSP) OR

  15688   2 0005DA  E800 0000 0000  xsym                 LDR,R6   GJA_DEFNODE
          2 0005DD  E947 003A                            CMR,R6   NODE,AUTO
          2 0005DF  0981 0006                            BNE      s:15688+12,PREL
          2 0005E1  82C6 0018                            LB,'2000'X        24,B6
          2 0005E3       2000
          2 0005E4  0581 000C                            BBF      s:15691,PREL
          2 0005E6  D2C6 0009                            LLH,R5   9,B6
          2 0005E8  D947 003A                            CMR,R5   NODE,AUTO
          2 0005EA  0981 009B                            BNE      s:15713,PREL
          2 0005EC  82C6 0018                            LB,'2000'X        24,B6
          2 0005EE       2000
          2 0005EF  0581 0096                            BBF      s:15713,PREL

      437    15689    2             (CTXLGN$->GJA$LGNCTX.NM_NODE = NODE AND CTXLGN$->GJA$LGNCTX.STATUS.NMRSP)
      438    15690    3           THEN DO;

      439    15691    3                CTXLGN$->GJA$LGNCTX.STATUS.NMRSP = '0'B;

  15691   2 0005F1  8846 0018                            LBF,'2000'X       24,B6
  15691   2 0005F3       2000

      440    15692    3                IF CTXLGN$->GJA$LGNCTX.STATUS.TERM

  15692   2 0005F4  89C6 0018                            CMZ      24,B6
          2 0005F6  0881 0032                            BAGE     s:15699,PREL

      441    15693    4                THEN DO;

      442    15694    4                     CALL GJA$Q_MSG(CTXLGN$,,,

  15694   2 0005F8  CBF0 0004                            LAB,B4   4,IMO
          2 0005FA  BBF0 0004                            LAB,B3   4,IMO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:68   
          2 0005FC  BFC7 004E                            STB,B3   MSGSIZ+11,AUTO
          2 0005FE  AB80 0000 0000  xsym                 LAB,B2   GJA_TERM_ACK
          2 000601  AFC7 004C                            STB,B2   MSGSIZ+9,AUTO
          2 000603  CFC7 004A                            STB,B4   MSGSIZ+7,AUTO
          2 000605  9B80 0000 0000                       LAB,B1   0
          2 000608  9FC7 0048                            STB,B1   MSGSIZ+5,AUTO
          2 00060A  EB80 0000 0000                       LAB,B6   0
          2 00060D  EFC7 0046                            STB,B6   MSGSIZ+3,AUTO
          2 00060F  EBC7 000A                            LAB,B6   CTXLGN$,AUTO
          2 000611  EFC7 0044                            STB,B6   MSGSIZ+1,AUTO
          2 000613  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000615  CBF0 0600                            LAB,B4   1536,IMO
          2 000617  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 00061A       0001                            DC       s:15696,PREL

      443    15695    4                       SIZEC(GJA_TERM_ACK),GJA_TERM_ACK,%KN_FCN_TERM_ACK);
      444    15696    4                     CALL GJA$DISOLVE_LGNUSR_CTX(CTXLGN$);

  15696   2 00061B  EBC7 000A                            LAB,B6   CTXLGN$,AUTO
          2 00061D  EFC7 0044                            STB,B6   MSGSIZ+1,AUTO
          2 00061F  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000621  CBF0 0100                            LAB,B4   256,IMO
          2 000623  E380 0000 0000  xent                 LNJ,B6   GJA$DISOLVE_LGNUSR_CTX
          2 000626       0001                            DC       s:15697,PREL

      445    15697    4                     END;

  15697   2 000627  0F81 005E                            B        s:15713,PREL

      446    15698    3                ELSE
      447    15699    3                     IF ~CTXLGN$->GJA$LGNCTX.STATUS.TERMACK

  15699   2 000629  D846 0018                            LDR,R5   24,B6
          2 00062B  5003                                 SOL,R5   3
          2 00062C  D570 8000                            AND,R5   -32768,IMO
          2 00062E  D670 8000                            XOR,R5   -32768,IMO
          2 000630  5901 0055                            BEZ,R5   s:15713,PREL
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:69   

      448    15700    3                     THEN
      449    15701    3                          IF CTXLGN$->GJA$LGNCTX.LDCTX = GJA_LDCT_BABOON

  15701   2 000632  D806                                 LDR,R5   ,B6
          2 000633  D570 1FFF                            AND,R5   8191,IMO
          2 000635  D900 0000 0000  xsym                 CMR,R5   GJA_LDCT_BABOON
          2 000638  0981 0025                            BNE      s:15708,PREL

      450    15702    4                          THEN DO;

      451    15703    4                               SGNRSP.NMID = CTXLGN$->GJA$LGNCTX.USER.SYSID;

  15703   2 00063A  F846 000E                            LDR,R7   14,B6
          2 00063C  6C00                                 LDV,R6   0
          2 00063D  8D00 0000 0018  00                   SDI      SGNRSP+1

      452    15704    4                               SGNRSP.ERRCODE = E$NONETMAN;

  15704   2 000640  8C80 0000 0000  xsym                 LDI      E$NONETMAN
          2 000643  8D00 0000 001C  00                   SDI      SGNRSP+5

      453    15705    4                               CALL GJA$Q_MSG(GJA_UID_BABOON,SIZEC(SGNRSP),SGNRSP);

  15705   2 000646  CBF0 0022                            LAB,B4   34,IMO
          2 000648  BB80 0000 0017  00                   LAB,B3   SGNRSP
          2 00064B  BFC7 0048                            STB,B3   MSGSIZ+5,AUTO
          2 00064D  CFC7 0046                            STB,B4   MSGSIZ+3,AUTO
          2 00064F  AB80 0000 0000  xsym                 LAB,B2   GJA_UID_BABOON
          2 000652  AFC7 0044                            STB,B2   MSGSIZ+1,AUTO
          2 000654  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000656  CBF0 0300                            LAB,B4   768,IMO
          2 000658  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 00065B       0001                            DC       s:15706,PREL

      454    15706    4                               END;

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:70   
  15706   2 00065C  0F81 0029                            B        s:15713,PREL

      455    15707    4                          ELSE DO;

      456    15708    4                               CALL GJA$Q_MSG(CTXLGN$,,,

  15708   2 00065E  CBF0 0008                            LAB,B4   8,IMO
          2 000660  BBF0 0003                            LAB,B3   3,IMO
          2 000662  BFC7 004E                            STB,B3   MSGSIZ+11,AUTO
          2 000664  AB80 0000 0000  xsym                 LAB,B2   GJA_TERM
          2 000667  AFC7 004C                            STB,B2   MSGSIZ+9,AUTO
          2 000669  CFC7 004A                            STB,B4   MSGSIZ+7,AUTO
          2 00066B  9B80 0000 0000                       LAB,B1   0
          2 00066E  9FC7 0048                            STB,B1   MSGSIZ+5,AUTO
          2 000670  EB80 0000 0000                       LAB,B6   0
          2 000673  EFC7 0046                            STB,B6   MSGSIZ+3,AUTO
          2 000675  EBC7 000A                            LAB,B6   CTXLGN$,AUTO
          2 000677  EFC7 0044                            STB,B6   MSGSIZ+1,AUTO
          2 000679  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 00067B  CBF0 0600                            LAB,B4   1536,IMO
          2 00067D  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 000680       0001                            DC       s:15710,PREL

      457    15709    4                                 SIZEC(GJA_TERM),GJA_TERM,%KN_FCN_TERM);
      458    15710    4                               CTXLGN$->GJA$LGNCTX.STATUS.TERMACK = '1'B;

  15710   2 000681  ECC7 000A                            LDB,B6   CTXLGN$,AUTO
          2 000683  8946 0018                            LBT,'1000'X       24,B6
          2 000685       1000

      459    15711    4                               END;

      460    15712    3                END;

      461    15713    2           CTXLGN$ = CHN$;

  15713   2 000686  ECC7 002F                            LDB,B6   CHN$,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:71   
          2 000688  EFC7 000A                            STB,B6   CTXLGN$,AUTO

      462    15714    2           END;

  15714   2 00068A  8DC7 000A                            CMN      CTXLGN$,AUTO
          2 00068C  0981 FF47                            BNE      s:15687,PREL

      463    15715
      464    15716
      465    15717        /* Send a host down to every handler */
      466    15718    1      ADMIN = GJA_ADMIN;

  15718   2 00068E  AB80 0000 0000  xsym                 LAB,B2   GJA_ADMIN
          2 000691  2C00                                 LDV,R2   0
          2 000692  6C44                                 LDV,R6   68
          2 000693  BB87                                 LAB,B3   ,AUTO
          2 000694  3C18                                 LDV,R3   24
          2 000695  0008                                 MMM

      467    15719    1      ADMIN.FNC = %KHA_FNC_HOSTDOWN;

  15719   2 000696  6C19                                 LDV,R6   25
          2 000697  EF47 001D                            STR,R6   ADMIN+17,AUTO

      468    15720
      469    15721    1      CTXLGN$ = GJA_HAND_HEAD$;

  15721   2 000699  EC80 0000 0000  xsym                 LDB,B6   GJA_HAND_HEAD$
          2 00069C  EFC7 000A                            STB,B6   CTXLGN$,AUTO

      470    15722
      471    15723    1      IF NODE = GJA_DEFNODE

  15723   2 00069E  D847 003A                            LDR,R5   NODE,AUTO
          2 0006A0  D900 0000 0000  xsym                 CMR,R5   GJA_DEFNODE
          2 0006A3  0981 003B                            BNE      s:15741,PREL

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:72   
      472    15724    1      THEN
      473    15725    2      DO;

      474    15726    2           GJA_HSTRSMED = '0'B;

  15726   2 0006A5  8700 0000 0000  xsym                 CL       GJA_HSTRSMED

      475    15727    3           DO WHILE (CTXLGN$ ~= ADDR(NIL));

  15727   2 0006A8  0F81 0033                            B        s:15736,PREL

      476    15728    3                ADMIN.TERMID_LO.TERM.CHANNEL = GJA_CHNLOW;

  15728   2 0006AA  E800 0000 0000  xsym                 LDR,R6   GJA_CHNLOW
          2 0006AD  EF47 001F                            STR,R6   ADMIN+19,AUTO

      477    15729    3                ADMIN.TERMID_HI.TERM.CHANNEL = GJA_CHNHI;

  15729   2 0006AF  D800 0000 0000  xsym                 LDR,R5   GJA_CHNHI
          2 0006B2  DF47 0027                            STR,R5   ADMIN+27,AUTO

      478    15730    3                ADMIN.TERMID_LO.LEV = %TERMINAL_ID_LEV_CHAN#;

  15730   2 0006B4  4C01                                 LDV,R4   1
          2 0006B5  CAC7 001E                            SRM,R4,'00FF'X    ADMIN+18,AUTO
          2 0006B7       00FF

      479    15731    3                ADMIN.TERMID_HI.LEV = %TERMINAL_ID_LEV_CHAN#;

  15731   2 0006B8  CAC7 0026                            SRM,R4,'00FF'X    ADMIN+26,AUTO
  15731   2 0006BA       00FF

      480    15732    3                IF CTXLGN$->GJA$HAND_CTX.WHO = %GJA_UID_HANDLER

  15732   2 0006BB  ECC7 000A                            LDB,B6   CTXLGN$,AUTO
          2 0006BD  B806                                 LDR,R3   ,B6
          2 0006BE  304D                                 SOR,R3   13
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:73   
          2 0006BF  3D03                                 CMV,R3   3
          2 0006C0  0981 0015                            BNE      s:15735,PREL

      481    15733    3                THEN
      482    15734    3                     CALL GJA$SEND_MSG(CTXLGN$,ADMIN,SIZEC(ADMIN));

  15734   2 0006C2  DBF0 0044                            LAB,B5   68,IMO
          2 0006C4  DFC7 0048                            STB,B5   MSGSIZ+5,AUTO
          2 0006C6  CBC7 000C                            LAB,B4   ADMIN,AUTO
          2 0006C8  CFC7 0046                            STB,B4   MSGSIZ+3,AUTO
          2 0006CA  BBC7 000A                            LAB,B3   CTXLGN$,AUTO
          2 0006CC  BFC7 0044                            STB,B3   MSGSIZ+1,AUTO
          2 0006CE  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 0006D0  CBF0 0300                            LAB,B4   768,IMO
          2 0006D2  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 0006D5       0001                            DC       s:15735,PREL

      483    15735    3                CTXLGN$ = CTXLGN$->GJA$HAND_CTX.LNK$;

  15735   2 0006D6  ECC7 000A                            LDB,B6   CTXLGN$,AUTO
          2 0006D8  DCC6 0001                            LDB,B5   1,B6
          2 0006DA  DFC7 000A                            STB,B5   CTXLGN$,AUTO

      484    15736    3                END;

  15736   2 0006DC  8DC7 000A                            CMN      CTXLGN$,AUTO
          2 0006DE  09CC                                 BNE      s:15728,SPREL

      485    15737    2           END;

      486    15738
      487    15739        /* Send a response to every user waiting on M$ERRMSG.
      488    15740        */
      489    15741    1      CTXLGN$ = GJA_ERRMSG_HEAD$;

  15741   2 0006DF  EC80 0000 0000  xsym                 LDB,B6   GJA_ERRMSG_HEAD$
          2 0006E2  EFC7 000A                            STB,B6   CTXLGN$,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:74   

      490    15742
      491    15743    2      DO WHILE (CTXLGN$ ~= ADDR(NIL));

  15743   2 0006E4  0F81 0041                            B        s:15755,PREL

      492    15744    2           IF ADDR(CTX) = ADDR(NIL) OR

  15744   2 0006E6  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 0006E8  8DD6                                 CMN      B6
          2 0006E9  0901 0009                            BE       s:15747,PREL
          2 0006EB  DCC7 000A                            LDB,B5   CTXLGN$,AUTO
          2 0006ED  E2C5 0009                            LLH,R6   9,B5
          2 0006EF  E947 003A                            CMR,R6   NODE,AUTO
          2 0006F1  0981 0034                            BNE      s:15755,PREL

      493    15745    2             CTXLGN$->GJA$ERRMSG_CTX.NODE = NODE
      494    15746    3           THEN DO;

      495    15747    3                KL_ERRMSG_RSP.USR# = CTXLGN$->GJA$ERRMSG_CTX.USR#;

  15747   2 0006F3  DCC7 000A                            LDB,B5   CTXLGN$,AUTO
          2 0006F5  E845 0009                            LDR,R6   9,B5
          2 0006F7  EA80 0000 0003  00                   SRM,R6,'00FF'X    KL_ERRMSG_RSP
          2 0006FA       00FF

      496    15748    3                KL_ERRMSG_RSP.CTX$ = CTXLGN$;

  15748   2 0006FB  DF80 0000 0005  00                   STB,B5   KL_ERRMSG_RSP+2

      497    15749    3                KL_ERRMSG_RSP.MESSAGE_SZ = 0;

  15749   2 0006FE  8780 0000 0004  00                   CLH      KL_ERRMSG_RSP+1

      498    15750    3                KL_ERRMSG_RSP.NO_NM = '1'B;

  15750   2 000701  8900 0000 0004  00                   LBT,'0002'X       KL_ERRMSG_RSP+1
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:75   
  15750   2 000704       0002

      499    15751
      500    15752    3                CALL GJA$SEND_MSG(CTXLGN$, KL_ERRMSG_RSP, SIZEC(KL_ERRMSG_RSP));

  15752   2 000705  CBF0 0008                            LAB,B4   8,IMO
          2 000707  CFC7 0048                            STB,B4   MSGSIZ+5,AUTO
          2 000709  BB80 0000 0003  00                   LAB,B3   KL_ERRMSG_RSP
          2 00070C  BFC7 0046                            STB,B3   MSGSIZ+3,AUTO
          2 00070E  ABC7 000A                            LAB,B2   CTXLGN$,AUTO
          2 000710  AFC7 0044                            STB,B2   MSGSIZ+1,AUTO
          2 000712  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000714  CBF0 0300                            LAB,B4   768,IMO
          2 000716  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 000719       0001                            DC       s:15753,PREL

      501    15753    3                CALL GJA$DISOLVE_ERRMSG_CTX(CTXLGN$);

  15753   2 00071A  EBC7 000A                            LAB,B6   CTXLGN$,AUTO
          2 00071C  EFC7 0044                            STB,B6   MSGSIZ+1,AUTO
          2 00071E  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000720  CBF0 0100                            LAB,B4   256,IMO
          2 000722  E380 0000 0000  xent                 LNJ,B6   GJA$DISOLVE_ERRMSG_CTX
          2 000725       0001                            DC       s:15755,PREL

      502    15754    3                END;

      503    15755    2           END;

  15755   2 000726  8DC7 000A                            CMN      CTXLGN$,AUTO
          2 000728  0981 FFBD                            BNE      s:15744,PREL

      504    15756
      505    15757    1      RETURN;

  15757   2 00072A  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:76   
      506    15758
      507    15759        %EJECT;
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:77   
      508    15760        /*F*
      509    15761             NAME:     GJA$HOST_RESUMED
      510    15762             PURPOSE:  This routine send the Host up to all the handlers
      511    15763
      512    15764         */
      513    15765
      514    15766    1   GJA$HOST_RESUMED: ENTRY ALTRET;

  15766   2 00072D  D380 0000 0000  xent GJA$HOST_RESUMEDLNJ,B5   X6A_AUTO_3
          2 000730       0058 0003                       DC       88,3

      515    15767
      516    15768    1      ADMIN = GJA_ADMIN;

  15768   2 000732  AB80 0000 0000  xsym                 LAB,B2   GJA_ADMIN
          2 000735  2C00                                 LDV,R2   0
          2 000736  6C44                                 LDV,R6   68
          2 000737  BB87                                 LAB,B3   ,AUTO
          2 000738  3C18                                 LDV,R3   24
          2 000739  0008                                 MMM

      517    15769    1      ADMIN.FNC = %KHA_FNC_HOSTUP;

  15769   2 00073A  6C1A                                 LDV,R6   26
          2 00073B  EF47 001D                            STR,R6   ADMIN+17,AUTO

      518    15770    1      ADMIN.TERMID_LO.LEV = %TERMINAL_ID_LEV_CHAN#;

  15770   2 00073D  5C01                                 LDV,R5   1
          2 00073E  DAC7 001E                            SRM,R5,'00FF'X    ADMIN+18,AUTO
          2 000740       00FF

      519    15771    1      ADMIN.TERMID_HI.LEV = %TERMINAL_ID_LEV_CHAN#;

  15771   2 000741  DAC7 0026                            SRM,R5,'00FF'X    ADMIN+26,AUTO
  15771   2 000743       00FF

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:78   
      520    15772    1      ADMIN.TERMID_LO.TERM.CHANNEL = GJA_CHNLOW;

  15772   2 000744  C800 0000 0000  xsym                 LDR,R4   GJA_CHNLOW
          2 000747  CF47 001F                            STR,R4   ADMIN+19,AUTO

      521    15773    1      ADMIN.TERMID_HI.TERM.CHANNEL = GJA_CHNHI;

  15773   2 000749  B800 0000 0000  xsym                 LDR,R3   GJA_CHNHI
          2 00074C  BF47 0027                            STR,R3   ADMIN+27,AUTO

      522    15774    1      CTXLGN$ = GJA_HAND_HEAD$;

  15774   2 00074E  EC80 0000 0000  xsym                 LDB,B6   GJA_HAND_HEAD$
          2 000751  EFC7 000A                            STB,B6   CTXLGN$,AUTO

      523    15775
      524    15776    2      DO WHILE (CTXLGN$ ~= ADDR(NIL));

  15776   2 000753  0F81 0022                            B        s:15781,PREL

      525    15777    2           IF CTXLGN$->GJA$HAND_CTX.WHO = %GJA_UID_HANDLER

  15777   2 000755  ECC7 000A                            LDB,B6   CTXLGN$,AUTO
          2 000757  E806                                 LDR,R6   ,B6
          2 000758  604D                                 SOR,R6   13
          2 000759  6D03                                 CMV,R6   3
          2 00075A  0981 0015                            BNE      s:15780,PREL

      526    15778    2           THEN
      527    15779    2                CALL GJA$SEND_MSG(CTXLGN$,ADMIN,SIZEC(ADMIN));

  15779   2 00075C  DBF0 0044                            LAB,B5   68,IMO
          2 00075E  DFC7 0048                            STB,B5   MSGSIZ+5,AUTO
          2 000760  CBC7 000C                            LAB,B4   ADMIN,AUTO
          2 000762  CFC7 0046                            STB,B4   MSGSIZ+3,AUTO
          2 000764  BBC7 000A                            LAB,B3   CTXLGN$,AUTO
          2 000766  BFC7 0044                            STB,B3   MSGSIZ+1,AUTO
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:79   
          2 000768  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 00076A  CBF0 0300                            LAB,B4   768,IMO
          2 00076C  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 00076F       0001                            DC       s:15780,PREL

      528    15780    2           CTXLGN$ = CTXLGN$->GJA$HAND_CTX.LNK$;

  15780   2 000770  ECC7 000A                            LDB,B6   CTXLGN$,AUTO
          2 000772  DCC6 0001                            LDB,B5   1,B6
          2 000774  DFC7 000A                            STB,B5   CTXLGN$,AUTO

      529    15781    2           END;

  15781   2 000776  8DC7 000A                            CMN      CTXLGN$,AUTO
          2 000778  09DD                                 BNE      s:15777,SPREL

      530    15782
      531    15783        /*
      532    15784             Send any buffered sys/err/accting logs
      533    15785        */
      534    15786    2      DO WHILE (GJA$SYSLOG$ ~= ADDR(NIL));

  15786   2 000779  0F81 0033                            B        s:15794,PREL

      535    15787    2           SVMSG$=GJA$SYSLOG$;

  15787   2 00077B  EC80 0000 0000  xsym                 LDB,B6   GJA$SYSLOG$
          2 00077E  EFC7 0034                            STB,B6   SVMSG$,AUTO

      536    15788    2           MSGSIZ = SVMSG$->SV$MSG.SZ;

  15788   2 000780  E846 0003                            LDR,R6   3,B6
          2 000782  EF47 0043                            STR,R6   MSGSIZ,AUTO

      537    15789    2           SVMSG$=PINCRW(SVMSG$,SIZEW(SV$MSG));

  15789   2 000784  DBC6 0005                            LAB,B5   5,B6
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:80   
          2 000786  DFC7 0034                            STB,B5   SVMSG$,AUTO

      538    15790    2           CALL GJA$SEND_MSG(GJA_UID_NM,SVMSG$->STRING,MSGSIZ);

  15790   2 000788  CBC7 0043                            LAB,B4   MSGSIZ,AUTO
          2 00078A  CFC7 0048                            STB,B4   MSGSIZ+5,AUTO
          2 00078C  DFC7 0046                            STB,B5   MSGSIZ+3,AUTO
          2 00078E  BB80 0000 0000  xsym                 LAB,B3   GJA_UID_NM
          2 000791  BFC7 0044                            STB,B3   MSGSIZ+1,AUTO
          2 000793  BBC7 0044                            LAB,B3   MSGSIZ+1,AUTO
          2 000795  CBF0 0300                            LAB,B4   768,IMO
          2 000797  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 00079A       0001                            DC       s:15791,PREL

      539    15791    2           SVMSG$ = GJA$SYSLOG$;

  15791   2 00079B  EC80 0000 0000  xsym                 LDB,B6   GJA$SYSLOG$
          2 00079E  EFC7 0034                            STB,B6   SVMSG$,AUTO

      540    15792    2           GJA$SYSLOG$ = GJA$SYSLOG$->SV$MSG.LNK$;

  15792   2 0007A0  DCC6 0001                            LDB,B5   1,B6
          2 0007A2  DF80 0000 0000  xsym                 STB,B5   GJA$SYSLOG$

      541    15793    2           CALL KVB$RLSSYS(SVMSG$->SV$MSG);

  15793   2 0007A5  BBC7 0034                            LAB,B3   SVMSG$,AUTO
          2 0007A7  CBF0 0100                            LAB,B4   256,IMO
          2 0007A9  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 0007AC       0001                            DC       s:15794,PREL

      542    15794    2           END;

  15794   2 0007AD  8D80 0000 0000  xsym                 CMN      GJA$SYSLOG$
          2 0007B0  09CB                                 BNE      s:15787,SPREL

      543    15795
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:81   
      544    15796    1      GJA_HSTRSMED = '1'B;

  15796   2 0007B1  8900 0000 0000  xsym                 LBT,'8000'X       GJA_HSTRSMED
  15796   2 0007B4       8000

      545    15797    1      RETURN;

  15797   2 0007B5  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      546    15798    1   END;
      547    15799        %EOD;

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:82   
--  Include file information  --

   KV$BPC.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K_REASON_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$LOGON_REQUEST.
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:83   

 **** Variables and constants ****

  ****  Section 000  Data  GJA$LOGON_REQUEST

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    28-0-0/w STRC(256)   r     1 FPT_TIME                   7-0-0/w STRC(256)   r     1 GJA_RQSPROFILE
     3-0-0/w STRC(64)    r     1 KL_ERRMSG_RSP              0-0-0/w STRC(48)    r     1 KV$VDO_DAT_IMD
    43-0-0/c STRC(528)   r     1 LINE_MSG                  38-0-0/w STRC(176)   r     1 SET_CLK
    17-0-0/w STRC(264)   r     1 SGNRSP

  ****  Section 001 RoData GJA$LOGON_REQUEST

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR        r     1 HEX(0:15)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @CTX$                      8-0-0/w PTR         r     1 @FPT_CONNECT
     6-0-0/w PTR         r     1 @KNH$MESS                  C-0-0/w STRC(544)   r     1 ADMIN
    2E-0-0/b BIT         r     1 AGAIN                     2F-0-0/w PTR         r     1 CHN$
    *0-0-0/w UBIN(32)    r     1 CTX                       *0-0-0/w PTR         r     1 CTX$
     A-0-0/w PTR         r     1 CTXLGN$                   *0-0-0/w STRC(304)   r     1 FPT_CONNECT
    36-0-0/w UBIN(16)    r     1 INDX                      37-0-0/w UBIN(16)    r     1 J
    *0-0-0/c STRC(128)   r     1 KNH$MESS                  38-0-0/c CHAR(4)     r     1 LINE#
    43-0-0/w UBIN(16)    r     1 MSGSIZ                    31-0-0/b BIT         r     1 NMAVAIL
    32-0-0/w PTR         r     1 NMCTX$                    3A-0-0/w UBIN(16)    r     1 NODE
    34-0-0/w PTR         r     1 SVMSG$                    3B-0-0/c STRC(128)   r     1 TERMINAL$ID

  ****  SYMREF variables  ****

PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:84   
  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT (32)    r     1 E$NONETMAN                 0-0-0/w PTR         r     1 GJA$SYSLOG$
     0-0-0/w STRC(544)   r     1 GJA_ADMIN                  0-0-0/w UBIN(16)    r     1 GJA_CHNHI
     0-0-0/w UBIN(16)    r     1 GJA_CHNLOW                 0-0-0/w STRC(96)    r     1 GJA_CONNECT_ACK
     0-0-0/w UBIN(16)    r     1 GJA_DEFNODE                0-0-0/w PTR         r     1 GJA_ERRMSG_HEAD$
     0-0-0/b BIT         r     1 GJA_FIRST_TIME             0-0-0/w PTR         r     1 GJA_HAND_HEAD$
     0-0-0/w PTR         r     1 GJA_HOSTRESUMED$           0-0-0/b BIT         r     1 GJA_HSTRSMED
     0-0-0/w UBIN(16)    r     1 GJA_LDCT_BABOON            0-0-0/w UBIN(16)    r     1 GJA_LDCT_NM
     0-0-0/w PTR         r     1 GJA_MSG_DOWN$              0-0-0/w PTR         r     1 GJA_MSG_HDR$
     0-0-0/w PTR         r     1 GJA_MSG_SALUTE$            0-0-0/w PTR         r     1 GJA_NM_HEAD$
     0-0-0/w UBIN(16)    r     1 GJA_NODE#                  0-0-0/c CHAR(8)     r     1 GJA_NODENAME
     0-0-0/w STRC(64)    r     1 GJA_PROMPT_VDO             0-0-0/w STRC(64)    r     1 GJA_TERM
     0-0-0/w STRC(32)    r     1 GJA_TERM_ACK               0-0-0/w UBIN(16)    r     1 GJA_UID_BABOON
     0-0-0/w PTR         r     1 GJA_UID_NM                 0-0-0/w PTR         r     1 GJA_USRLGN_HEAD$
     0-0-0/w PTR         r     1 KV_B_POOL$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(160)   r     1 GJA$ERRMSG_CTX             0-0-0/c STRC(272)   r     1 GJA$HAND_CTX
     0-0-0/w STRC(528)   r     1 GJA$LGNCTX                 0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w ASTR(1824)  r     1 KV$BPC                     0-0-0/c CHAR(255)   r     1 STRING
     0-0-0/w STRC(80)    r     1 SV$MSG                     0-0-0/c ASTR(8)     r     1 TEXTC


   Procedure GJA$LOGON_REQUEST requires 1976 words for executable code.
   Procedure GJA$LOGON_REQUEST requires 88 words of local(AUTO) storage.
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:85   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:86   
          MINI XREF LISTING

ADMIN
     14199**DCL     15649<<ASSIGN  15653<>CALL    15653--CALL    15718<<ASSIGN  15734<>CALL    15734--CALL
     15768<<ASSIGN  15779<>CALL    15779--CALL
ADMIN.FNC
     14265**DCL     15652<<ASSIGN  15719<<ASSIGN  15769<<ASSIGN
ADMIN.TERMID_HI
     14314**DCL     15651<<ASSIGN
ADMIN.TERMID_HI.LEV
     14316**DCL     15731<<ASSIGN  15771<<ASSIGN
ADMIN.TERMID_HI.TERM
     14316**DCL     14325--REDEF
ADMIN.TERMID_HI.TERM.CHANNEL
     14322**DCL     15729<<ASSIGN  15773<<ASSIGN
ADMIN.TERMID_LO
     14285**DCL     15650<<ASSIGN
ADMIN.TERMID_LO.LEV
     14287**DCL     15730<<ASSIGN  15770<<ASSIGN
ADMIN.TERMID_LO.TERM
     14287**DCL     14296--REDEF
ADMIN.TERMID_LO.TERM.CHANNEL
     14293**DCL     15728<<ASSIGN  15772<<ASSIGN
AGAIN
     14328**DCL     15512<<ASSIGN  15522<<ASSIGN  15526<<ASSIGN  15581>>IF
CHN$
     14329**DCL     13884--IMP-PTR 15493<<ASSIGN  15504>>IF      15508>>ASSIGN  15546<<ASSIGN  15548>>IF
     15570>>IF      15633>>IF      15687<<ASSIGN  15713>>ASSIGN
COMMON
     15529**LABEL   15513--GOTO
CTX
     13661**DCL     15550>>ASSIGN  15682>>ASSIGN  15744--IF
CTX$
     13660**DCL        44--PROC    13661--REDEF   13994--IMP-PTR 15446<>CALL    15452>>ASSIGN  15453>>ASSIGN
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:87   
     15454>>ASSIGN  15455>>ASSIGN  15456>>ASSIGN  15457>>ASSIGN  15458>>ASSIGN  15459>>ASSIGN  15463>>IF
     15463>>IF      15466>>ASSIGN  15468>>ASSIGN  15470>>ASSIGN  15471>>ASSIGN  15474>>ASSIGN  15475>>CALL
     15477>>CALL    15480<>CALL    15481<>CALL    15490<>CALL    15493>>ASSIGN  15499>>ASSIGN  15500<>CALL
     15507>>ASSIGN  15519--ENTRY   15523>>ASSIGN  15524>>IF      15529>>IF      15529>>IF      15529>>IF
     15529>>IF      15542>>ASSIGN  15546>>ASSIGN  15548>>IF      15552>>ASSIGN  15554>>ASSIGN  15558>>ASSIGN
     15570>>IF      15577<>CALL    15584<>CALL    15589<>CALL    15593<>CALL    15625<>CALL    15635>>IF
     15637>>IF      15638<>CALL    15639>>ASSIGN  15640<>CALL    15644<>CALL    15645<>CALL    15650>>ASSIGN
     15651>>ASSIGN  15653>>CALL    15662>>ASSIGN  15663<>CALL    15680--ENTRY
CTXLGN$
     13662**DCL     15683<<ASSIGN  15685>>DOWHILE 15687>>ASSIGN  15688>>IF      15688>>IF      15688>>IF
     15691>>ASSIGN  15692>>IF      15694<>CALL    15696<>CALL    15699>>IF      15701>>IF      15703>>ASSIGN
     15708<>CALL    15710>>ASSIGN  15713<<ASSIGN  15721<<ASSIGN  15727>>DOWHILE 15732>>IF      15734<>CALL
     15735<<ASSIGN  15735>>ASSIGN  15741<<ASSIGN  15743>>DOWHILE 15744>>IF      15747>>ASSIGN  15748>>ASSIGN
     15752<>CALL    15753<>CALL    15774<<ASSIGN  15776>>DOWHILE 15777>>IF      15779<>CALL    15780<<ASSIGN
     15780>>ASSIGN
E$NONETMAN
     15147**DCL     15704>>ASSIGN
FNDNM
     15562**LABEL   15566--EXIT
FPT_CONNECT
     13726**DCL        44--PROC    15499--ASSIGN  15499--ASSIGN
FPT_CONNECT.RLCID.GENERATION
     13762**DCL     13763--REDEF
FPT_CONNECT.RLCID.LDCTX
     13763**DCL     13763--REDEF
FPT_CONNECT.RLCID.NODE
     13762**DCL     15457>>ASSIGN
FPT_CONNECT.SPEED
     13765**DCL     15456>>ASSIGN
FPT_CONNECT.TERMINAL_ID
     13749**DCL     15455>>ASSIGN
FPT_CONNECT.TERMINAL_ID.TERM
     13751**DCL     13760--REDEF
FPT_CONNECT.USER
     13764**DCL     15454>>ASSIGN
FPT_TIME
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:88   
     15217**DCL     15623<>CALL
FPT_TIME.V
     15221**DCL     15220--DCLINIT
GJA$BLD_CTX
     15418**DCL-ENT 15477--CALL
GJA$DISOLVE_ERRMSG_CTX
     15428**DCL-ENT 15753--CALL
GJA$DISOLVE_LGNUSR_CTX
     15427**DCL-ENT 15481--CALL    15696--CALL
GJA$ERRMSG_CTX.NODE
     14152**DCL     15744>>IF
GJA$ERRMSG_CTX.USR#
     14153**DCL     15747>>ASSIGN
GJA$GET_CHNTBL_PTR
     15426**DCL-ENT 15475--CALL
GJA$HAND_CTX.HOST_NODE
     14109**DCL     15563>>IF
GJA$HAND_CTX.LDCTX
     14085**DCL     15563>>IF
GJA$HAND_CTX.LNK$
     14089**DCL     15568>>ASSIGN  15735>>ASSIGN  15780>>ASSIGN
GJA$HAND_CTX.WHO
     14084**DCL     15732>>IF      15777>>IF
GJA$LGNCTX
     13994**DCL     15446--CALL    15452<<ASSIGN
GJA$LGNCTX.CHN$
     14020**DCL     15475<>CALL    15477<>CALL    15493>>ASSIGN  15546>>ASSIGN  15653>>CALL
GJA$LGNCTX.LDCTX
     14000**DCL     15453<<ASSIGN  15701>>IF
GJA$LGNCTX.LNK$
     14004**DCL     15470<<ASSIGN  15687>>ASSIGN
GJA$LGNCTX.MSG$
     14021**DCL     15499<<ASSIGN  15662<<ASSIGN
GJA$LGNCTX.NM_NODE
     14018**DCL     15459<<ASSIGN  15688>>IF
GJA$LGNCTX.NODE
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:89   
     14056**DCL     15457<<ASSIGN
GJA$LGNCTX.SPEED
     14057**DCL     15456<<ASSIGN
GJA$LGNCTX.STATUS.DSCRCV
     14069**DCL     15529>>IF
GJA$LGNCTX.STATUS.INT
     14067**DCL     15466<<ASSIGN  15570>>IF      15635>>IF
GJA$LGNCTX.STATUS.NMRSP
     14064**DCL     15529>>IF      15688>>IF      15688>>IF      15691<<ASSIGN
GJA$LGNCTX.STATUS.RDPND
     14073**DCL     15637>>IF      15639<<ASSIGN
GJA$LGNCTX.STATUS.TERM
     14062**DCL     15529>>IF      15692>>IF
GJA$LGNCTX.STATUS.TERMACK
     14065**DCL     15529>>IF      15699>>IF      15710<<ASSIGN
GJA$LGNCTX.STATUS.WAITING_HOST
     14074**DCL     15523<<ASSIGN
GJA$LGNCTX.STATUS.WTPRO
     14068**DCL     15524>>IF      15548>>IF      15554<<ASSIGN  15558<<ASSIGN
GJA$LGNCTX.TERMINAL_ID
     14043**DCL     15455<<ASSIGN  15474>>ASSIGN  15542>>ASSIGN  15552>>ASSIGN  15650>>ASSIGN  15651>>ASSIGN
GJA$LGNCTX.TERMINAL_ID.TERM
     14045**DCL     14054--REDEF
GJA$LGNCTX.TERMINAL_ID.TTYP
     14045**DCL     15463>>IF      15463>>IF
GJA$LGNCTX.USER
     14022**DCL     15454<<ASSIGN
GJA$LGNCTX.USER.SYSID
     14023**DCL     15703>>ASSIGN
GJA$LGNCTX.WHO
     13999**DCL     15458<<ASSIGN
GJA$NETWORK_MANAGER
     15425**DCL-ENT 15553--CALL
GJA$Q_MSG
     15424**DCL-ENT 15438--CALL    15449--CALL    15480--CALL    15490--CALL    15638--CALL    15644--CALL
     15694--CALL    15705--CALL    15708--CALL
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:90   
GJA$SEND_MSG
     15419**DCL-ENT 15577--CALL    15584--CALL    15589--CALL    15593--CALL    15625--CALL    15653--CALL
     15734--CALL    15752--CALL    15779--CALL    15790--CALL
GJA$SOLICIT_LOGON
     15420**DCL-ENT 15640--CALL    15645--CALL
GJA$SOLICIT_NM
     15421**DCL-ENT 15500--CALL    15663--CALL
GJA$SYSLOG$
     15151**DCL     15786>>DOWHILE 15787>>ASSIGN  15791>>ASSIGN  15792<<ASSIGN  15792>>ASSIGN
GJA_ADMIN
     14400**DCL     15649>>ASSIGN  15718>>ASSIGN  15768>>ASSIGN
GJA_ADMIN.TERMID_HI.TERM
     14517**DCL     14526--REDEF
GJA_ADMIN.TERMID_LO.TERM
     14488**DCL     14497--REDEF
GJA_CHNHI
     14873**DCL     15729>>ASSIGN  15773>>ASSIGN
GJA_CHNLOW
     14872**DCL     15728>>ASSIGN  15772>>ASSIGN
GJA_CONNECT_ACK
     14543**DCL     15438--CALL    15438<>CALL    15449--CALL    15449<>CALL    15480--CALL    15480<>CALL
     15490--CALL    15490<>CALL
GJA_CONNECT_ACK.REASON
     14547**DCL     15437<<ASSIGN  15448<<ASSIGN  15479<<ASSIGN  15489<<ASSIGN
GJA_CONNECT_ACK.UID.UID
     14573**DCL     14573--REDEF   14573--REDEF
GJA_DEFNODE
     14864**DCL     15459>>ASSIGN  15688>>IF      15723>>IF
GJA_ERRMSG_HEAD$
     14871**DCL     15741>>ASSIGN
GJA_FIRST_TIME
     15155**DCL     15436>>IF
GJA_HAND_HEAD$
     14870**DCL     15721>>ASSIGN  15774>>ASSIGN
GJA_HOSTRESUMED$
     14866**DCL     15583>>ASSIGN  15584>>CALL    15584>>CALL
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:91   
GJA_HSTRSMED
     15150**DCL     15726<<ASSIGN  15796<<ASSIGN
GJA_LDCT_BABOON
     15145**DCL     15701>>IF
GJA_LDCT_NM
     15144**DCL     15548>>IF      15574>>IF      15590>>IF      15661>>IF
GJA_MSG_DOWN$
     14865**DCL     15576>>ASSIGN  15577>>CALL    15577>>CALL
GJA_MSG_HDR$
     14867**DCL     15587>>ASSIGN  15589>>CALL    15589>>CALL
GJA_MSG_SALUTE$
     14868**DCL     15592>>ASSIGN  15593>>CALL    15593>>CALL
GJA_NM_HEAD$
     15152**DCL     15561>>ASSIGN
GJA_NODE#
     15148**DCL     15597>>CALLBLT
GJA_NODENAME
     15149**DCL     15599>>CALLBLT
GJA_PROMPT_VDO
     14611**DCL     15643--ASSIGN  15644<>CALL
GJA_PROMPT_VDO.TL.LEN
     14671**DCL     15643>>ASSIGN
GJA_RQSPROFILE
     14965**DCL     15553<>CALL    15553--CALL
GJA_RQSPROFILE.HANDLER
     15006**DCL     15551<<ASSIGN
GJA_RQSPROFILE.NMID
     15004**DCL     15550<<ASSIGN
GJA_RQSPROFILE.TERMID
     14986**DCL     15552<<ASSIGN
GJA_RQSPROFILE.TERMID.TERM
     14988**DCL     14997--REDEF
GJA_TERM
     15170**DCL     15708--CALL    15708<>CALL
GJA_TERM_ACK
     15194**DCL     15694--CALL    15694<>CALL
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:92   
GJA_UID_BABOON
     15146**DCL     15705<>CALL
GJA_UID_NM
     15153**DCL     15790<>CALL
GJA_USRLGN_HEAD$
     14869**DCL     15467>>IF      15468<<ASSIGN  15470>>ASSIGN  15471<<ASSIGN  15683>>ASSIGN
HEX
     15416**DCL     15601>>CALLBLT 15601>>CALLBLT 15601>>CALLBLT 15601>>CALLBLT
INDX
     14333**DCL     15596<<ASSIGN  15600<<CALLBLT 15606>>CALLBLT 15607<<ASSIGN  15607>>ASSIGN  15612>>CALLBLT
     15613<<ASSIGN  15613>>ASSIGN  15618>>CALLBLT 15619<<ASSIGN  15619>>ASSIGN  15624>>ASSIGN
J
     14334**DCL     15598<<ASSIGN  15598>>DOWHILE 15598<<ASSIGN  15598>>ASSIGN  15599>>CALLBLT 15599>>CALLBLT
     15599>>CALLBLT 15611<<ASSIGN  15611>>DOWHILE 15611>>DOWHILE 15611<<ASSIGN  15611>>ASSIGN  15612>>CALLBLT
     15612>>CALLBLT 15612>>CALLBLT 15613>>ASSIGN  15617<<ASSIGN  15617>>DOWHILE 15617>>DOWHILE 15617<<ASSIGN
     15617>>ASSIGN  15618>>CALLBLT 15618>>CALLBLT 15618>>CALLBLT 15619>>ASSIGN
KH$CHN.AUTLGN
     13895**DCL     15633>>IF
KH$CHN.HAND$
     13991**DCL     15653<>CALL
KH$CHN.LGNTIMOUTPRD
     13951**DCL     15504>>IF      15508>>ASSIGN
KH$CHN.PROFILE
     13896**DCL     15548>>IF
KH$CHN.SNDSLT
     13943**DCL     15570>>IF
KH$CHN.TERMID.TERM
     13980**DCL     13989--REDEF
KHC$CLOCK
     15429**DCL-ENT 15509--CALL
KL_ERRMSG_RSP
     14889**DCL     15752<>CALL    15752--CALL
KL_ERRMSG_RSP.CTX$
     14940**DCL     15748<<ASSIGN
KL_ERRMSG_RSP.MESSAGE_SZ
     14901**DCL     15749<<ASSIGN
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:93   
KL_ERRMSG_RSP.NO_NM
     14931**DCL     15750<<ASSIGN
KL_ERRMSG_RSP.USR#
     14896**DCL     15747<<ASSIGN
KNH$MESS
     13676**DCL        44--PROC
KNH$MESS.FUNCTION
     13676**DCL     13676--REDEF
KNH$MESS.LDCTX
     13681**DCL     15438--CALL    15449--CALL    15453>>ASSIGN
KNH$MESS.MSGSZ
     13710**DCL     15497>>IF      15500<>CALL
KNH$MESS.UID
     13706**DCL     13706--REDEF   13706--REDEF
KV$BPC.BITMAPSIZ
     15244**DCL     15247--IMP-SIZ
KV$BPC.TOT
     15237**DCL     15436>>IF
KV$BPC.USE
     15237**DCL     15436>>IF
KV$VDO_DAT_IMD
     14801**DCL     15638--CALL    15638<>CALL
KVB$GETSYS
     15422**DCL-ENT 15446--CALL
KVB$RLSSYS
     15423**DCL-ENT 15793--CALL
KV_B_POOL$
     15154**DCL     15233--IMP-PTR 15436>>IF      15436>>IF
LINE#
     14335**DCL     15597<<CALLBLT 15598>>DOWHILE 15599>>CALLBLT 15601<<CALLBLT 15606>>CALLBLT 15610<<CALLBLT
     15611>>DOWHILE 15612>>CALLBLT 15616<<CALLBLT 15617>>DOWHILE 15618>>CALLBLT
LINE_MSG
     15408**DCL     15624--ASSIGN  15625<>CALL
LINE_MSG.DATE
     15412**DCL     15220--DCLINIT
LINE_MSG.DAY
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:94   
     15411**DCL     15221--DCLINIT
LINE_MSG.LINE#
     15414**DCL     15599<<CALLBLT 15600>>CALLBLT 15606<<CALLBLT 15612<<CALLBLT 15618<<CALLBLT 15624--ASSIGN
LINE_MSG.TIME
     15409**DCL     15221--DCLINIT
M$TIME
     13465**DCL-ENT 15623--CALL
MSGSIZ
     14366**DCL     15576<<ASSIGN  15577<>CALL    15583<<ASSIGN  15584<>CALL    15587<<ASSIGN  15588>>IF
     15589<>CALL    15592<<ASSIGN  15593<>CALL    15624<<ASSIGN  15625<>CALL    15643<<ASSIGN  15644<>CALL
     15788<<ASSIGN  15790<>CALL
NMAVAIL
     14330**DCL     15560<<ASSIGN  15565<<ASSIGN  15629>>IF
NMCTX$
     14331**DCL     15561<<ASSIGN  15562>>DOWHILE 15563>>IF      15563>>IF      15568<<ASSIGN  15568>>ASSIGN
NODE
     14336**DCL     15682<<ASSIGN  15688>>IF      15688>>IF      15723>>IF      15744>>IF
SET_CLK
     15273**DCL     15509<>CALL
SET_CLK.CTBCTX$
     15279**DCL     15506<<ASSIGN
SET_CLK.PRD
     15394**DCL     15508<<ASSIGN
SET_CLK.UID
     15289**DCL     15290--REDEF   15291--REDEF
SET_CLK.UID$
     15290**DCL     15507<<ASSIGN
SGNRSP
     15023**DCL     15705--CALL    15705<>CALL
SGNRSP.ERRCODE
     15079**DCL     15704<<ASSIGN
SGNRSP.NMID
     15041**DCL     15703<<ASSIGN
SGNRSP.TERMID.TERM
     15127**DCL     15136--REDEF
STRING
PL6.E3A0      #001=GJA$LOGON_REQUEST File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:50 Page:95   
     14159**DCL     15790<>CALL
SV$MSG
     14160**DCL     15789--ASSIGN  15793<>CALL
SV$MSG.LNK$
     14162**DCL     15792>>ASSIGN
SV$MSG.SZ
     14163**DCL     15788>>ASSIGN
SVMSG$
     14332**DCL     15787<<ASSIGN  15788>>ASSIGN  15789<<ASSIGN  15789>>ASSIGN  15790>>CALL    15791<<ASSIGN
     15793>>CALL
TERMINAL$ID
     14351**DCL     15474<<ASSIGN  15475<>CALL    15477<>CALL    15542<<ASSIGN
TERMINAL$ID.LEV
     14355**DCL     15608>>IF      15614>>IF
TERMINAL$ID.TERM
     14355**DCL     14364--REDEF
TERMINAL$ID.TERM.CHANNEL
     14361**DCL     15601>>CALLBLT 15601>>CALLBLT 15601>>CALLBLT 15601>>CALLBLT
TERMINAL$ID.TERM.SUBDEVICE
     14361**DCL     15610>>CALLBLT
TERMINAL$ID.TERM.SUBSUBDEVICE
     14361**DCL     15616>>CALLBLT
TEXTC.SIZE
     14157**DCL     14158--IMP-SIZ 15576>>ASSIGN  15577>>CALL    15583>>ASSIGN  15584>>CALL    15587>>ASSIGN
     15589>>CALL    15592>>ASSIGN  15593>>CALL
TEXTC.STRING
     14158**DCL     15577<>CALL    15584<>CALL    15589<>CALL    15593<>CALL

PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:96   
      548        1        /*T***********************************************************/
      549        2        /*T*                                                         */
      550        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      551        4        /*T*                                                         */
      552        5        /*T***********************************************************/
      553        6        /*F* NAME:    GJA$SOLICIT_LOGON
      554        7
      555        8             PURPOSE: This routine communicates with VDH and the handler to
      556        9                      solicit a logon from the target device.
      557       10
      558       11             DESCRIPTION:  This routine proceeds generally as follows:
      559       12                           1).  Check the retry count in GJA$LGNCTX.  If it is
      560       13                                exhausted do the following:
      561       14                                - Send TERM to VDH with reason specified.
      562       15                                - Post status TERMACK
      563       16                                - Return
      564       17                           2).  Turn echoplex off if we aren't supposed to
      565       18                                echo the logon.
      566       19                           3).  Send a request data message to VDH
      567       20                           4).  Post status LGNRSP
      568       21                           5).  Return
      569       22
      570       23             CALL:   CALL GJA$SOLICIT_LOGON(CTX$)
      571       24
      572       25             INPUT:  CTX$ - Points to the relevant GJA$LGNCTX context block
      573       26        */
      574       27        %EJECT;
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:97   
      575       28        GJA$SOLICIT_LOGON: PROC(CTX$);
      576       29
      577       30        %INCLUDE GJA_MSG_M;
      578      269        %INCLUDE KH$CHN;
      579      391        %INCLUDE KL_MACRO_C;
      580     3743        %INCLUDE KNH_MACRO_C;
      581     4026        %INCLUDE KV$VDO;
      582     5041        %INCLUDE KV$GLB;
      583     5460        %INCLUDE LCP_6;
      584     9739        %INCLUDE KV_PRMID_E;
      585     9913        %INCLUDE NK_VFC_C;
      586     9987                                                /* Args                     */
      587     9988    1   DCL CTX$ PTR;
      588     9989                                                /* Necessary VDH macros     */
      589     9990        %KV_VDO_ALL_E;
      590    10069        %KV_PRMID_E;
      591    10225                                                /* Based structures         */
      592    10226    1   DCL 1 TEXTC BASED,
      593    10227    1         2 SIZE UBIN BYTE UNAL,
      594    10228    1         2 STRING CHAR(TEXTC.SIZE) UNAL;
      595    10229        %KH$CHN (STCLASS=BASED);
      596    10353        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
      597    10438        %VLP_TRMCTL(FPTN=VLP$TRMCTL,STCLASS=BASED);
      598    10478        %KV$VDO_PRM(NAME=GJA$TRMCTL_VDO,STCLASS=BASED,LAST=",");
      599    10519             %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      600    10569    1         2 TL,
      601    10570    1           3 TYPE UBIN BYTE UNAL,
      602    10571    1           3 LEN UBIN BYTE UNAL;
      603    10572                                                /* Symrefs                  */
      604    10573    1   DCL GJA_RETRYMAX UBIN SYMREF;
      605    10574    1   DCL GJA_LGNTIMEDOUT$ PTR SYMREF;
      606    10575    1   DCL GJA_NOLOGONMSG$ PTR SYMREF;
      607    10576        %VLP_TRMCTL(STCLASS=SYMREF,FPTN=GJA_VLP_TRMCTL);
      608    10616        %KV$VDO_RQSDAT(NAME=GJA_SOLICIT_VDO_RQSDAT,STCLASS=SYMREF);
      609    10664        %KV$VDO_PRM(NAME=GJA_PARAM_VDO,STCLASS=SYMREF,LAST=",");
      610    10705             %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      611    10755    1         2 TL,
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:98   
      612    10756    1           3 TYPE UBIN BYTE UNAL,
      613    10757    1           3 LEN UBIN BYTE UNAL;
      614    10758
      615    10759                                                /* AUTO Storage             */
      616    10760    1   DCL MSGSIZ UBIN;
      617    10761    1   DCL VDO_BUFFER(0:300) CHAR(1) UNAL;
      618    10762
      619    10763                                                /* Entrys                   */
      620    10764    1   DCL GJA$Q_MSG ENTRY(6);
      621    10765    1   DCL GJA$SEND_MSG ENTRY(4) ALTRET;
      622    10766                                                /* STATIC                   */
      623    10767        %FPT_TERM(REASON=%KN_TERM_REASON_RETRY_EXHAUSTED);
      624    10789        %KV$VDO_DSC(NAME=VDO_DSC,STCLASS=CONSTANT,INTPHSDSC=YES,FNC=KV_VDO_FNC_DSC_RQS);
      625    10831        %EJECT;
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:99   
      626    10832                       /* If there is already a readpending just return     */
      627    10833    1      IF GJA$LGNCTX.STATUS.RDPND
      628    10834    1        OR GJA$LGNCTX.STATUS.WTPRO OR GJA$LGNCTX.STATUS.NMRSP
      629    10835    1        OR GJA$LGNCTX.STATUS.TERM OR GJA$LGNCTX.STATUS.DSCRCV
      630    10836    1        OR GJA$LGNCTX.STATUS.TERMACK
      631    10837    1      THEN
      632    10838    1           RETURN;
      633    10839
      634    10840        /*
      635    10841          If the retry count is exhausted, tell VDH about it
      636    10842        */
      637    10843    1      IF GJA$LGNCTX.RETRYCNT > GJA_RETRYMAX
      638    10844    2      THEN DO;
      639    10845    2           IF GJA$LGNCTX.STATUS.INT AND ~GJA$LGNCTX.STATUS.TERM AND ~GJA$LGNCTX.STATUS.
             10845                    TERMACK
      640    10846    2           THEN
      641    10847    2                MSGSIZ = GJA_NOLOGONMSG$->TEXTC.SIZE;
      642    10848    2           CALL GJA$SEND_MSG(CTX$,GJA_NOLOGONMSG$->TEXTC.STRING,MSGSIZ,%VFC_TRANSITION0
             10848                    );
      643    10849    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO=GJA_PARAM_VDO;
      644    10850    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.KV$VDOVLP_DAT2.BYTSIZ=
      645    10851    2             SIZEC(GJA_VLP_TRMCTL)+2;
      646    10852    2           PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL=
      647    10853    2             GJA_VLP_TRMCTL;
      648    10854    2           PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL.DISPINPUT = '1'B;
      649    10855    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.TYPE=%KV_PRMID_TRMCTL;
      650    10856    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.LEN=SIZEC(GJA_VLP_TRMCTL);
      651    10857    2           MSGSIZ=SIZEC(GJA$TRMCTL_VDO)+SIZEC(GJA_VLP_TRMCTL);
      652    10858    2           CALL GJA$Q_MSG(CTX$,MSGSIZ,ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO);
      653    10859    2           CALL GJA$Q_MSG(CTX$,SIZEC(VDO_DSC),VDO_DSC,SIZEC(FPT_TERM),FPT_TERM,%
             10859                    KN_FCN_TERM);
      654    10860    2           GJA$LGNCTX.STATUS.TERMACK='1'B;
      655    10861    2           RETURN;
      656    10862    2           END;
      657    10863        /*
      658    10864          If we arent to echo the logon string, turn echoplex off here
      659    10865        */
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:100  
      660    10866    1      IF NOT(GJA$LGNCTX.CHN$->KH$CHN.ECHLGN)
      661    10867    1        AND GJA$LGNCTX.RETRYCNT = 0
      662    10868    2      THEN DO;
      663    10869    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO=GJA_PARAM_VDO;
      664    10870    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.KV$VDOVLP_DAT2.BYTSIZ=
      665    10871    2             SIZEC(GJA_VLP_TRMCTL)+2;
      666    10872    2           PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL=
      667    10873    2             GJA_VLP_TRMCTL;
      668    10874    2           PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL.DISPINPUT = '0'B;
      669    10875    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.TYPE=%KV_PRMID_TRMCTL;
      670    10876    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.LEN=SIZEC(GJA_VLP_TRMCTL);
      671    10877    2           MSGSIZ=SIZEC(GJA$TRMCTL_VDO)+SIZEC(GJA_VLP_TRMCTL);
      672    10878    2           CALL GJA$Q_MSG(CTX$,MSGSIZ,ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO);
      673    10879    2           END;
      674    10880        /*
      675    10881          Send a message to VDH to solicit the logon
      676    10882        */
      677    10883    1      CALL GJA$Q_MSG(CTX$,SIZEC(GJA_SOLICIT_VDO_RQSDAT),
      678    10884    1        GJA_SOLICIT_VDO_RQSDAT);
      679    10885        /*
      680    10886          Bump retry count
      681    10887        */
      682    10888    1      GJA$LGNCTX.RETRYCNT=GJA$LGNCTX.RETRYCNT+1;
      683    10889        /*
      684    10890          Post status and return
      685    10891        */
      686    10892    1      GJA$LGNCTX.STATUS.LGNRSP='1'B;
      687    10893    1      GJA$LGNCTX.STATUS.RDPND = '1'B;
      688    10894    1      RETURN;
      689    10895        %EJECT;
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:101  
      690    10896    1   GJA$LOGON_TIMEOUT: ENTRY(CTX$);
      691    10897
      692    10898    1      IF GJA$LGNCTX.STATUS.INT AND NOT(GJA$LGNCTX.STATUS.TERM OR GJA$LGNCTX.STATUS.
             10898               TERMACK)
      693    10899    2      THEN DO;
      694    10900    2           MSGSIZ = GJA_LGNTIMEDOUT$->TEXTC.SIZE;
      695    10901    2           CALL GJA$SEND_MSG(CTX$,GJA_LGNTIMEDOUT$->TEXTC.STRING,MSGSIZ,%
             10901                    VFC_TRANSITION0);
      696    10902    2           END;
      697    10903    1      IF GJA$LGNCTX.STATUS.NMRSP OR GJA$LGNCTX.STATUS.WTPRO
      698    10904    1        OR GJA$LGNCTX.STATUS.TERMACK OR GJA$LGNCTX.STATUS.TERM
      699    10905    1      THEN
      700    10906    1           GJA$LGNCTX.STATUS.DSCRCV = '1'B;
      701    10907    2      ELSE DO;
      702    10908    2           CALL GJA$Q_MSG(CTX$,SIZEC(VDO_DSC),VDO_DSC,SIZEC(FPT_TERM),FPT_TERM,%
             10908                    KN_FCN_TERM);
      703    10909    2           GJA$LGNCTX.STATUS.TERMACK = '1'B;
      704    10910    2           END;
      705    10911
      706    10912    1      RETURN;
      707    10913    1   END GJA$SOLICIT_LOGON;
      708    10914        %EOD;

PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:102  
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$SOLICIT_LOGON.

   Procedure GJA$SOLICIT_LOGON requires 432 words for executable code.
   Procedure GJA$SOLICIT_LOGON requires 170 words of local(AUTO) storage.

PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:103  

 Object Unit name= GJA$SOLICIT_LOGON                          File name= GJA$LOGON.:E05TOU
 UTS= JUL 29 '97 21:51:32.92 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none     4      4  GJA$SOLICIT_LOGON
    1  RoData even  UTS      2      2  GJA$SOLICIT_LOGON
    2   Proc  even  none   432    1B0  GJA$SOLICIT_LOGON
    3  RoData even  none     1      1  GJA$SOLICIT_LOGON

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        1  GJA$SOLICIT_LOGON
     2    133                  yes      Std        1  GJA$LOGON_TIMEOUT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       4 GJA$SEND_MSG
         yes           Std       6 GJA$Q_MSG
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:104  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     GJA_RETRYMAX                          GJA_LGNTIMEDOUT$                      GJA_NOLOGONMSG$
     GJA_VLP_TRMCTL                        GJA_SOLICIT_VDO_RQSDAT                GJA_PARAM_VDO
r    G$ROS$
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:105  


      548        1        /*T***********************************************************/
      549        2        /*T*                                                         */
      550        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      551        4        /*T*                                                         */
      552        5        /*T***********************************************************/
      553        6        /*F* NAME:    GJA$SOLICIT_LOGON
      554        7
      555        8             PURPOSE: This routine communicates with VDH and the handler to
      556        9                      solicit a logon from the target device.
      557       10
      558       11             DESCRIPTION:  This routine proceeds generally as follows:
      559       12                           1).  Check the retry count in GJA$LGNCTX.  If it is
      560       13                                exhausted do the following:
      561       14                                - Send TERM to VDH with reason specified.
      562       15                                - Post status TERMACK
      563       16                                - Return
      564       17                           2).  Turn echoplex off if we aren't supposed to
      565       18                                echo the logon.
      566       19                           3).  Send a request data message to VDH
      567       20                           4).  Post status LGNRSP
      568       21                           5).  Return
      569       22
      570       23             CALL:   CALL GJA$SOLICIT_LOGON(CTX$)
      571       24
      572       25             INPUT:  CTX$ - Points to the relevant GJA$LGNCTX context block
      573       26        */
      574       27        %EJECT;
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:106  
      575       28        GJA$SOLICIT_LOGON: PROC(CTX$);

     28   2 000000  D380 0000 0000  xent GJA$SOLICIT_LOG*LNJ,B5   X6A_AUTO_1
          2 000003       00AA 0001                       DC       170,1

      576       29
      577       30        %INCLUDE GJA_MSG_M;
      578      269        %INCLUDE KH$CHN;
      579      391        %INCLUDE KL_MACRO_C;
      580     3743        %INCLUDE KNH_MACRO_C;
      581     4026        %INCLUDE KV$VDO;
      582     5041        %INCLUDE KV$GLB;
      583     5460        %INCLUDE LCP_6;
      584     9739        %INCLUDE KV_PRMID_E;
      585     9913        %INCLUDE NK_VFC_C;
      586     9987                                                /* Args                     */
      587     9988    1   DCL CTX$ PTR;
      588     9989                                                /* Necessary VDH macros     */
      589     9990        %KV_VDO_ALL_E;
      590    10069        %KV_PRMID_E;
      591    10225                                                /* Based structures         */
      592    10226    1   DCL 1 TEXTC BASED,
      593    10227    1         2 SIZE UBIN BYTE UNAL,
      594    10228    1         2 STRING CHAR(TEXTC.SIZE) UNAL;
      595    10229        %KH$CHN (STCLASS=BASED);
      596    10353        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
      597    10438        %VLP_TRMCTL(FPTN=VLP$TRMCTL,STCLASS=BASED);
      598    10478        %KV$VDO_PRM(NAME=GJA$TRMCTL_VDO,STCLASS=BASED,LAST=",");
      599    10519             %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      600    10569    1         2 TL,
      601    10570    1           3 TYPE UBIN BYTE UNAL,
      602    10571    1           3 LEN UBIN BYTE UNAL;
      603    10572                                                /* Symrefs                  */
      604    10573    1   DCL GJA_RETRYMAX UBIN SYMREF;
      605    10574    1   DCL GJA_LGNTIMEDOUT$ PTR SYMREF;
      606    10575    1   DCL GJA_NOLOGONMSG$ PTR SYMREF;
      607    10576        %VLP_TRMCTL(STCLASS=SYMREF,FPTN=GJA_VLP_TRMCTL);
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:107  
      608    10616        %KV$VDO_RQSDAT(NAME=GJA_SOLICIT_VDO_RQSDAT,STCLASS=SYMREF);
      609    10664        %KV$VDO_PRM(NAME=GJA_PARAM_VDO,STCLASS=SYMREF,LAST=",");
      610    10705             %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      611    10755    1         2 TL,
      612    10756    1           3 TYPE UBIN BYTE UNAL,
      613    10757    1           3 LEN UBIN BYTE UNAL;
      614    10758
      615    10759                                                /* AUTO Storage             */
      616    10760    1   DCL MSGSIZ UBIN;
      617    10761    1   DCL VDO_BUFFER(0:300) CHAR(1) UNAL;
      618    10762
      619    10763                                                /* Entrys                   */
      620    10764    1   DCL GJA$Q_MSG ENTRY(6);
      621    10765    1   DCL GJA$SEND_MSG ENTRY(4) ALTRET;
      622    10766                                                /* STATIC                   */
      623    10767        %FPT_TERM(REASON=%KN_TERM_REASON_RETRY_EXHAUSTED);
      624    10789        %KV$VDO_DSC(NAME=VDO_DSC,STCLASS=CONSTANT,INTPHSDSC=YES,FNC=KV_VDO_FNC_DSC_RQS);
      625    10831        %EJECT;
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:108  
      626    10832                       /* If there is already a readpending just return     */
      627    10833    1      IF GJA$LGNCTX.STATUS.RDPND

  10833   2 000005  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 000007  DC86                                 LDB,B5   ,B6
          2 000008  82C5 0018                            LB,'0080'X        24,B5
          2 00000A       0080
          2 00000B  0501 0019                            BBT      s:10838,PREL
          2 00000D  82C5 0018                            LB,'0200'X        24,B5
          2 00000F       0200
          2 000010  0501 0014                            BBT      s:10838,PREL
          2 000012  82C5 0018                            LB,'2000'X        24,B5
          2 000014       2000
          2 000015  0501 000F                            BBT      s:10838,PREL
          2 000017  89C5 0018                            CMZ      24,B5
          2 000019  0801 000B                            BAL      s:10838,PREL
          2 00001B  82C5 0018                            LB,'0100'X        24,B5
          2 00001D       0100
          2 00001E  0501 0006                            BBT      s:10838,PREL
          2 000020  82C5 0018                            LB,'1000'X        24,B5
          2 000022       1000
          2 000023  0581 0004                            BBF      s:10843,PREL

      628    10834    1        OR GJA$LGNCTX.STATUS.WTPRO OR GJA$LGNCTX.STATUS.NMRSP
      629    10835    1        OR GJA$LGNCTX.STATUS.TERM OR GJA$LGNCTX.STATUS.DSCRCV
      630    10836    1        OR GJA$LGNCTX.STATUS.TERMACK
      631    10837    1      THEN
      632    10838    1           RETURN;

  10838   2 000025  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      633    10839
      634    10840        /*
      635    10841          If the retry count is exhausted, tell VDH about it
      636    10842        */
      637    10843    1      IF GJA$LGNCTX.RETRYCNT > GJA_RETRYMAX

PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:109  
  10843   2 000028  E845 0009                            LDR,R6   9,B5
          2 00002A  E570 00FF                            AND,R6   255,IMO
          2 00002C  E900 0000 0000  xsym                 CMR,R6   GJA_RETRYMAX
          2 00002F  0381 009B                            BLE      s:10866,PREL

      638    10844    2      THEN DO;

      639    10845    2          IF GJA$LGNCTX.STATUS.INT AND ~GJA$LGNCTX.STATUS.TERM AND ~GJA$LGNCTX.STATUS.
             10845                    TERMACK

  10845   2 000031  82C5 0018                            LB,'0400'X        24,B5
  10845   2 000033       0400
          2 000034  0581 0018                            BBF      s:10848,PREL
          2 000036  D845 0018                            LDR,R5   24,B5
          2 000038  D570 8000                            AND,R5   -32768,IMO
          2 00003A  D670 8000                            XOR,R5   -32768,IMO
          2 00003C  5901 0010                            BEZ,R5   s:10848,PREL
          2 00003E  D845 0018                            LDR,R5   24,B5
          2 000040  5003                                 SOL,R5   3
          2 000041  D570 8000                            AND,R5   -32768,IMO
          2 000043  D670 8000                            XOR,R5   -32768,IMO
          2 000045  5901 0007                            BEZ,R5   s:10848,PREL

      640    10846    2           THEN
      641    10847    2                MSGSIZ = GJA_NOLOGONMSG$->TEXTC.SIZE;

  10847   2 000047  CC80 0000 0000  xsym                 LDB,B4   GJA_NOLOGONMSG$
          2 00004A  D284                                 LLH,R5   ,B4
          2 00004B  DF47 0006                            STR,R5   MSGSIZ,AUTO

      642    10848    2          CALL GJA$SEND_MSG(CTX$,GJA_NOLOGONMSG$->TEXTC.STRING,MSGSIZ,%VFC_TRANSITION0
             10848                    );

  10848   2 00004D  DB80 0000 0000  03                   LAB,B5   0
          2 000050  DFC7 00A4                            STB,B5   VDO_BUFFER+157,AUTO
          2 000052  CBC7 0006                            LAB,B4   MSGSIZ,AUTO
          2 000054  CFC7 00A2                            STB,B4   VDO_BUFFER+155,AUTO
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:110  
          2 000056  8C80 0000 0000  xsym                 LDI      GJA_NOLOGONMSG$
          2 000059  7031                                 DCL,R7   1
          2 00005A  8470 0000 0001                       AID      1,IMO
          2 00005D  7071                                 DCR,R7   1
          2 00005E  8D47 00A0                            SDI      VDO_BUFFER+153,AUTO
          2 000060  EFC7 009E                            STB,B6   VDO_BUFFER+151,AUTO
          2 000062  BBC7 009E                            LAB,B3   VDO_BUFFER+151,AUTO
          2 000064  CBF0 0400                            LAB,B4   1024,IMO
          2 000066  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 000069       0001                            DC       s:10849,PREL

      643    10849    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO=GJA_PARAM_VDO;

  10849   2 00006A  AB80 0000 0000  xsym                 LAB,B2   GJA_PARAM_VDO
          2 00006D  2C00                                 LDV,R2   0
          2 00006E  6C08                                 LDV,R6   8
          2 00006F  BB87                                 LAB,B3   ,AUTO
          2 000070  3C0E                                 LDV,R3   14
          2 000071  0008                                 MMM

      644    10850    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.KV$VDOVLP_DAT2.BYTSIZ=

  10850   2 000072  6C12                                 LDV,R6   18
          2 000073  EF47 0009                            STR,R6   VDO_BUFFER+2,AUTO

      645    10851    2             SIZEC(GJA_VLP_TRMCTL)+2;
      646    10852    2           PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL=

  10852   2 000075  AB80 0000 0000  xsym                 LAB,B2   GJA_VLP_TRMCTL
          2 000078  2C00                                 LDV,R2   0
          2 000079  6C10                                 LDV,R6   16
          2 00007A  BB87                                 LAB,B3   ,AUTO
          2 00007B  3C16                                 LDV,R3   22
          2 00007C  0008                                 MMM

      647    10853    2             GJA_VLP_TRMCTL;
      648    10854    2          PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL.DISPINPUT = '1'B;
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:111  

  10854   2 00007D  E870 0080                            LDR,R6   128,IMO
          2 00007F  EAC7 000B                            SRM,R6,'00C0'X    VDO_BUFFER+4,AUTO
          2 000081       00C0

      649    10855    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.TYPE=%KV_PRMID_TRMCTL;

  10855   2 000082  5C04                                 LDV,R5   4
          2 000083  D7C7 000A                            STH,R5   VDO_BUFFER+3,AUTO

      650    10856    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.LEN=SIZEC(GJA_VLP_TRMCTL);

  10856   2 000085  4C10                                 LDV,R4   16
          2 000086  CAC7 000A                            SRM,R4,'00FF'X    VDO_BUFFER+3,AUTO
          2 000088       00FF

      651    10857    2           MSGSIZ=SIZEC(GJA$TRMCTL_VDO)+SIZEC(GJA_VLP_TRMCTL);

  10857   2 000089  3C18                                 LDV,R3   24
          2 00008A  BF47 0006                            STR,R3   MSGSIZ,AUTO

      652    10858    2           CALL GJA$Q_MSG(CTX$,MSGSIZ,ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO);

  10858   2 00008C  EBC7 0007                            LAB,B6   VDO_BUFFER,AUTO
          2 00008E  EFC7 00A2                            STB,B6   VDO_BUFFER+155,AUTO
          2 000090  DBC7 0006                            LAB,B5   MSGSIZ,AUTO
          2 000092  DFC7 00A0                            STB,B5   VDO_BUFFER+153,AUTO
          2 000094  CCC7 0004                            LDB,B4   @CTX$,AUTO
          2 000096  CFC7 009E                            STB,B4   VDO_BUFFER+151,AUTO
          2 000098  BBC7 009E                            LAB,B3   VDO_BUFFER+151,AUTO
          2 00009A  CBF0 0300                            LAB,B4   768,IMO
          2 00009C  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 00009F       0001                            DC       s:10859,PREL

      653    10859    2           CALL GJA$Q_MSG(CTX$,SIZEC(VDO_DSC),VDO_DSC,SIZEC(FPT_TERM),FPT_TERM,%
             10859                    KN_FCN_TERM);

PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:112  
  10859   2 0000A0  EBF0 0004                            LAB,B6   4,IMO
          2 0000A2  DBF0 0008                            LAB,B5   8,IMO
          2 0000A4  CBF0 0003                            LAB,B4   3,IMO
          2 0000A6  CFC7 00A8                            STB,B4   VDO_BUFFER+161,AUTO
          2 0000A8  BB80 0000 0000  00                   LAB,B3   FPT_TERM
          2 0000AB  BFC7 00A6                            STB,B3   VDO_BUFFER+159,AUTO
          2 0000AD  DFC7 00A4                            STB,B5   VDO_BUFFER+157,AUTO
          2 0000AF  AB80 0000 0000  01                   LAB,B2   VDO_DSC
          2 0000B2  AFC7 00A2                            STB,B2   VDO_BUFFER+155,AUTO
          2 0000B4  EFC7 00A0                            STB,B6   VDO_BUFFER+153,AUTO
          2 0000B6  9CC7 0004                            LDB,B1   @CTX$,AUTO
          2 0000B8  9FC7 009E                            STB,B1   VDO_BUFFER+151,AUTO
          2 0000BA  BBC7 009E                            LAB,B3   VDO_BUFFER+151,AUTO
          2 0000BC  CBF0 0600                            LAB,B4   1536,IMO
          2 0000BE  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 0000C1       0001                            DC       s:10860,PREL

      654    10860    2           GJA$LGNCTX.STATUS.TERMACK='1'B;

  10860   2 0000C2  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 0000C4  DC86                                 LDB,B5   ,B6
          2 0000C5  8945 0018                            LBT,'1000'X       24,B5
          2 0000C7       1000

      655    10861    2           RETURN;

  10861   2 0000C8  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      656    10862    2           END;
      657    10863        /*
      658    10864          If we arent to echo the logon string, turn echoplex off here
      659    10865        */
      660    10866    1      IF NOT(GJA$LGNCTX.CHN$->KH$CHN.ECHLGN)

  10866   2 0000CB  CCC5 000A                            LDB,B4   10,B5
          2 0000CD  82C4 0009                            LB,'0200'X        9,B4
          2 0000CF       0200
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:113  
          2 0000D0  0501 0038                            BBT      s:10883,PREL
          2 0000D2  82C5 0009                            LB,'00FF'X        9,B5
          2 0000D4       00FF
          2 0000D5  0501 0033                            BBT      s:10883,PREL

      661    10867    1        AND GJA$LGNCTX.RETRYCNT = 0
      662    10868    2      THEN DO;

      663    10869    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO=GJA_PARAM_VDO;

  10869   2 0000D7  AB80 0000 0000  xsym                 LAB,B2   GJA_PARAM_VDO
          2 0000DA  2C00                                 LDV,R2   0
          2 0000DB  6C08                                 LDV,R6   8
          2 0000DC  BB87                                 LAB,B3   ,AUTO
          2 0000DD  3C0E                                 LDV,R3   14
          2 0000DE  0008                                 MMM

      664    10870    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.KV$VDOVLP_DAT2.BYTSIZ=

  10870   2 0000DF  6C12                                 LDV,R6   18
          2 0000E0  EF47 0009                            STR,R6   VDO_BUFFER+2,AUTO

      665    10871    2             SIZEC(GJA_VLP_TRMCTL)+2;
      666    10872    2           PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL=

  10872   2 0000E2  AB80 0000 0000  xsym                 LAB,B2   GJA_VLP_TRMCTL
          2 0000E5  2C00                                 LDV,R2   0
          2 0000E6  6C10                                 LDV,R6   16
          2 0000E7  BB87                                 LAB,B3   ,AUTO
          2 0000E8  3C16                                 LDV,R3   22
          2 0000E9  0008                                 MMM

      667    10873    2             GJA_VLP_TRMCTL;
      668    10874    2          PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL.DISPINPUT = '0'B;

  10874   2 0000EA  8847 000B                            LBF,'00C0'X       VDO_BUFFER+4,AUTO
  10874   2 0000EC       00C0
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:114  

      669    10875    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.TYPE=%KV_PRMID_TRMCTL;

  10875   2 0000ED  6C04                                 LDV,R6   4
          2 0000EE  E7C7 000A                            STH,R6   VDO_BUFFER+3,AUTO

      670    10876    2           ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.LEN=SIZEC(GJA_VLP_TRMCTL);

  10876   2 0000F0  5C10                                 LDV,R5   16
          2 0000F1  DAC7 000A                            SRM,R5,'00FF'X    VDO_BUFFER+3,AUTO
          2 0000F3       00FF

      671    10877    2           MSGSIZ=SIZEC(GJA$TRMCTL_VDO)+SIZEC(GJA_VLP_TRMCTL);

  10877   2 0000F4  4C18                                 LDV,R4   24
          2 0000F5  CF47 0006                            STR,R4   MSGSIZ,AUTO

      672    10878    2           CALL GJA$Q_MSG(CTX$,MSGSIZ,ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO);

  10878   2 0000F7  DBC7 0007                            LAB,B5   VDO_BUFFER,AUTO
          2 0000F9  DFC7 00A2                            STB,B5   VDO_BUFFER+155,AUTO
          2 0000FB  CBC7 0006                            LAB,B4   MSGSIZ,AUTO
          2 0000FD  CFC7 00A0                            STB,B4   VDO_BUFFER+153,AUTO
          2 0000FF  EFC7 009E                            STB,B6   VDO_BUFFER+151,AUTO
          2 000101  BBC7 009E                            LAB,B3   VDO_BUFFER+151,AUTO
          2 000103  CBF0 0300                            LAB,B4   768,IMO
          2 000105  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 000108       0001                            DC       s:10883,PREL

      673    10879    2           END;

      674    10880        /*
      675    10881          Send a message to VDH to solicit the logon
      676    10882        */
      677    10883    1      CALL GJA$Q_MSG(CTX$,SIZEC(GJA_SOLICIT_VDO_RQSDAT),

  10883   2 000109  EBF0 000A                            LAB,B6   10,IMO
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:115  
          2 00010B  DB80 0000 0000  xsym                 LAB,B5   GJA_SOLICIT_VDO_RQSDAT
          2 00010E  DFC7 00A2                            STB,B5   VDO_BUFFER+155,AUTO
          2 000110  EFC7 00A0                            STB,B6   VDO_BUFFER+153,AUTO
          2 000112  CCC7 0004                            LDB,B4   @CTX$,AUTO
          2 000114  CFC7 009E                            STB,B4   VDO_BUFFER+151,AUTO
          2 000116  BBC7 009E                            LAB,B3   VDO_BUFFER+151,AUTO
          2 000118  CBF0 0300                            LAB,B4   768,IMO
          2 00011A  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 00011D       0001                            DC       s:10888,PREL

      678    10884    1        GJA_SOLICIT_VDO_RQSDAT);
      679    10885        /*
      680    10886          Bump retry count
      681    10887        */
      682    10888    1      GJA$LGNCTX.RETRYCNT=GJA$LGNCTX.RETRYCNT+1;

  10888   2 00011E  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 000120  DC86                                 LDB,B5   ,B6
          2 000121  E845 0009                            LDR,R6   9,B5
          2 000123  EA70 0001                            ADD,R6   1,IMO
          2 000125  EAC5 0009                            SRM,R6,'00FF'X    9,B5
          2 000127       00FF

      683    10889        /*
      684    10890          Post status and return
      685    10891        */
      686    10892    1      GJA$LGNCTX.STATUS.LGNRSP='1'B;

  10892   2 000128  DC86                                 LDB,B5   ,B6
          2 000129  8945 0018                            LBT,'4000'X       24,B5
          2 00012B       4000

      687    10893    1      GJA$LGNCTX.STATUS.RDPND = '1'B;

  10893   2 00012C  DC86                                 LDB,B5   ,B6
          2 00012D  8945 0018                            LBT,'0080'X       24,B5
          2 00012F       0080
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:116  

      688    10894    1      RETURN;

  10894   2 000130  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      689    10895        %EJECT;
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:117  
      690    10896    1   GJA$LOGON_TIMEOUT: ENTRY(CTX$);

  10896   2 000133  D380 0000 0000  xent GJA$LOGON_TIMEO*LNJ,B5   X6A_AUTO_1
          2 000136       00AA 0001                       DC       170,1

      691    10897
      692    10898    1      IF GJA$LGNCTX.STATUS.INT AND NOT(GJA$LGNCTX.STATUS.TERM OR GJA$LGNCTX.STATUS.
             10898               TERMACK)

  10898   2 000138  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 00013A  DC86                                 LDB,B5   ,B6
          2 00013B  82C5 0018                            LB,'0400'X        24,B5
          2 00013D       0400
          2 00013E  0581 002D                            BBF      s:10903,PREL
          2 000140  89C5 0018                            CMZ      24,B5
          2 000142  0801 0029                            BAL      s:10903,PREL
          2 000144  82C5 0018                            LB,'1000'X        24,B5
          2 000146       1000
          2 000147  0501 0024                            BBT      s:10903,PREL

      693    10899    2      THEN DO;

      694    10900    2           MSGSIZ = GJA_LGNTIMEDOUT$->TEXTC.SIZE;

  10900   2 000149  CC80 0000 0000  xsym                 LDB,B4   GJA_LGNTIMEDOUT$
          2 00014C  E284                                 LLH,R6   ,B4
          2 00014D  EF47 0006                            STR,R6   MSGSIZ,AUTO

      695    10901    2           CALL GJA$SEND_MSG(CTX$,GJA_LGNTIMEDOUT$->TEXTC.STRING,MSGSIZ,%
             10901                    VFC_TRANSITION0);

  10901   2 00014F  DB80 0000 0000  03                   LAB,B5   0
          2 000152  DFC7 00A4                            STB,B5   VDO_BUFFER+157,AUTO
          2 000154  BBC7 0006                            LAB,B3   MSGSIZ,AUTO
          2 000156  BFC7 00A2                            STB,B3   VDO_BUFFER+155,AUTO
          2 000158  8C80 0000 0000  xsym                 LDI      GJA_LGNTIMEDOUT$
          2 00015B  7031                                 DCL,R7   1
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:118  
          2 00015C  8470 0000 0001                       AID      1,IMO
          2 00015F  7071                                 DCR,R7   1
          2 000160  8D47 00A0                            SDI      VDO_BUFFER+153,AUTO
          2 000162  EFC7 009E                            STB,B6   VDO_BUFFER+151,AUTO
          2 000164  BBC7 009E                            LAB,B3   VDO_BUFFER+151,AUTO
          2 000166  CBF0 0400                            LAB,B4   1024,IMO
          2 000168  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          2 00016B       0001                            DC       s:10903,PREL

      696    10902    2           END;

      697    10903    1      IF GJA$LGNCTX.STATUS.NMRSP OR GJA$LGNCTX.STATUS.WTPRO

  10903   2 00016C  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 00016E  DC86                                 LDB,B5   ,B6
          2 00016F  82C5 0018                            LB,'2000'X        24,B5
          2 000171       2000
          2 000172  0501 000F                            BBT      s:10906,PREL
          2 000174  82C5 0018                            LB,'0200'X        24,B5
          2 000176       0200
          2 000177  0501 000A                            BBT      s:10906,PREL
          2 000179  82C5 0018                            LB,'1000'X        24,B5
          2 00017B       1000
          2 00017C  0501 0005                            BBT      s:10906,PREL
          2 00017E  89C5 0018                            CMZ      24,B5
          2 000180  0881 0006                            BAGE     s:10908,PREL

      698    10904    1        OR GJA$LGNCTX.STATUS.TERMACK OR GJA$LGNCTX.STATUS.TERM
      699    10905    1      THEN
      700    10906    1           GJA$LGNCTX.STATUS.DSCRCV = '1'B;

  10906   2 000182  8945 0018                            LBT,'0100'X       24,B5
  10906   2 000184       0100
          2 000185  0F81 0027                            B        s:10912,PREL

      701    10907    2      ELSE DO;

PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:119  
      702    10908    2           CALL GJA$Q_MSG(CTX$,SIZEC(VDO_DSC),VDO_DSC,SIZEC(FPT_TERM),FPT_TERM,%
             10908                    KN_FCN_TERM);

  10908   2 000187  CBF0 0004                            LAB,B4   4,IMO
          2 000189  BBF0 0008                            LAB,B3   8,IMO
          2 00018B  ABF0 0003                            LAB,B2   3,IMO
          2 00018D  AFC7 00A8                            STB,B2   VDO_BUFFER+161,AUTO
          2 00018F  DB80 0000 0000  00                   LAB,B5   FPT_TERM
          2 000192  DFC7 00A6                            STB,B5   VDO_BUFFER+159,AUTO
          2 000194  BFC7 00A4                            STB,B3   VDO_BUFFER+157,AUTO
          2 000196  9B80 0000 0000  01                   LAB,B1   VDO_DSC
          2 000199  9FC7 00A2                            STB,B1   VDO_BUFFER+155,AUTO
          2 00019B  CFC7 00A0                            STB,B4   VDO_BUFFER+153,AUTO
          2 00019D  EFC7 009E                            STB,B6   VDO_BUFFER+151,AUTO
          2 00019F  BBC7 009E                            LAB,B3   VDO_BUFFER+151,AUTO
          2 0001A1  CBF0 0600                            LAB,B4   1536,IMO
          2 0001A3  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          2 0001A6       0001                            DC       s:10909,PREL

      703    10909    2           GJA$LGNCTX.STATUS.TERMACK = '1'B;

  10909   2 0001A7  ECC7 0004                            LDB,B6   @CTX$,AUTO
          2 0001A9  DC86                                 LDB,B5   ,B6
          2 0001AA  8945 0018                            LBT,'1000'X       24,B5
          2 0001AC       1000

      704    10910    2           END;

      705    10911
      706    10912    1      RETURN;

  10912   2 0001AD  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      707    10913    1   END GJA$SOLICIT_LOGON;
      708    10914        %EOD;

PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:120  
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$SOLICIT_LOGON.
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:121  

 **** Variables and constants ****

  ****  Section 000  Data  GJA$SOLICIT_LOGON

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(64)    r     1 FPT_TERM

  ****  Section 001 RoData GJA$SOLICIT_LOGON

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(32)    r     1 VDO_DSC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @CTX$                     *0-0-0/w PTR         r     1 CTX$
     6-0-0/w UBIN(16)    r     1 MSGSIZ
     7-0-0/c CHAR        r     1 VDO_BUFFER(0:300)

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 GJA_LGNTIMEDOUT$           0-0-0/w PTR         r     1 GJA_NOLOGONMSG$
     0-0-0/w STRC(64)    r     1 GJA_PARAM_VDO              0-0-0/w UBIN(16)    r     1 GJA_RETRYMAX
     0-0-0/w STRC(80)    r     1 GJA_SOLICIT_VDO_RQSDAT
     0-0-0/w STRC(128)   r     1 GJA_VLP_TRMCTL

  ****  BASED and DCB variables  ****

PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:122  
  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(528)   r     1 GJA$LGNCTX                 0-0-0/w STRC(64)    r     1 GJA$TRMCTL_VDO
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/c ASTR(8)     r     1 TEXTC
     0-0-0/w STRC(128)   r     1 VLP$TRMCTL


   Procedure GJA$SOLICIT_LOGON requires 432 words for executable code.
   Procedure GJA$SOLICIT_LOGON requires 170 words of local(AUTO) storage.
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:123  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:124  
          MINI XREF LISTING

CTX$
      9988**DCL        28--PROC    10354--IMP-PTR 10833>>IF      10833>>IF      10833>>IF      10833>>IF
     10833>>IF      10833>>IF      10843>>IF      10845>>IF      10845>>IF      10845>>IF      10848<>CALL
     10858<>CALL    10859<>CALL    10860>>ASSIGN  10866>>IF      10866>>IF      10878<>CALL    10883<>CALL
     10888>>ASSIGN  10888>>ASSIGN  10892>>ASSIGN  10893>>ASSIGN  10896--ENTRY   10898>>IF      10898>>IF
     10898>>IF      10901<>CALL    10903>>IF      10903>>IF      10903>>IF      10903>>IF      10906>>ASSIGN
     10908<>CALL    10909>>ASSIGN
FPT_TERM
     10781**DCL     10859--CALL    10859<>CALL    10908--CALL    10908<>CALL
GJA$LGNCTX.CHN$
     10380**DCL     10866>>IF
GJA$LGNCTX.RETRYCNT
     10379**DCL     10843>>IF      10866>>IF      10888<<ASSIGN  10888>>ASSIGN
GJA$LGNCTX.STATUS.DSCRCV
     10429**DCL     10833>>IF      10906<<ASSIGN
GJA$LGNCTX.STATUS.INT
     10427**DCL     10845>>IF      10898>>IF
GJA$LGNCTX.STATUS.LGNRSP
     10423**DCL     10892<<ASSIGN
GJA$LGNCTX.STATUS.NMRSP
     10424**DCL     10833>>IF      10903>>IF
GJA$LGNCTX.STATUS.RDPND
     10433**DCL     10833>>IF      10893<<ASSIGN
GJA$LGNCTX.STATUS.TERM
     10422**DCL     10833>>IF      10845>>IF      10898>>IF      10903>>IF
GJA$LGNCTX.STATUS.TERMACK
     10425**DCL     10833>>IF      10845>>IF      10860<<ASSIGN  10898>>IF      10903>>IF      10909<<ASSIGN
GJA$LGNCTX.STATUS.WTPRO
     10428**DCL     10833>>IF      10903>>IF
GJA$LGNCTX.TERMINAL_ID.TERM
     10405**DCL     10414--REDEF
GJA$Q_MSG
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:125  
     10764**DCL-ENT 10858--CALL    10859--CALL    10878--CALL    10883--CALL    10908--CALL
GJA$SEND_MSG
     10765**DCL-ENT 10848--CALL    10901--CALL
GJA$TRMCTL_VDO
     10511**DCL     10849<<ASSIGN  10852--ASSIGN  10854--ASSIGN  10857--ASSIGN  10858<>CALL    10869<<ASSIGN
     10872--ASSIGN  10874--ASSIGN  10877--ASSIGN  10878<>CALL
GJA$TRMCTL_VDO.KV$VDOVLP_DAT2.BYTSIZ
     10562**DCL     10850<<ASSIGN  10870<<ASSIGN
GJA$TRMCTL_VDO.TL.LEN
     10571**DCL     10856<<ASSIGN  10876<<ASSIGN
GJA$TRMCTL_VDO.TL.TYPE
     10570**DCL     10855<<ASSIGN  10875<<ASSIGN
GJA_LGNTIMEDOUT$
     10574**DCL     10900>>ASSIGN  10901>>CALL    10901>>CALL
GJA_NOLOGONMSG$
     10575**DCL     10847>>ASSIGN  10848>>CALL    10848>>CALL
GJA_PARAM_VDO
     10697**DCL     10849>>ASSIGN  10869>>ASSIGN
GJA_RETRYMAX
     10573**DCL     10843>>IF
GJA_SOLICIT_VDO_RQSDAT
     10649**DCL     10883--CALL    10883<>CALL
GJA_VLP_TRMCTL
     10593**DCL     10850--ASSIGN  10852>>ASSIGN  10856--ASSIGN  10857--ASSIGN  10870--ASSIGN  10872>>ASSIGN
     10876--ASSIGN  10877--ASSIGN
GJA_VLP_TRMCTL.BREAKCOUNT
     10604**DCL     10605--REDEF
KH$CHN.ECHLGN
     10303**DCL     10866>>IF
KH$CHN.TERMID.TERM
     10340**DCL     10349--REDEF
MSGSIZ
     10760**DCL     10847<<ASSIGN  10848<>CALL    10857<<ASSIGN  10858<>CALL    10877<<ASSIGN  10878<>CALL
     10900<<ASSIGN  10901<>CALL
TEXTC.SIZE
     10227**DCL     10228--IMP-SIZ 10847>>ASSIGN  10848>>CALL    10900>>ASSIGN  10901>>CALL
PL6.E3A0      #002=GJA$SOLICIT_LOGON File=GJA$LOGON.:E05TSI                      TUE 07/29/97 21:51 Page:126  
TEXTC.STRING
     10228**DCL     10848<>CALL    10901<>CALL
VDO_BUFFER
     10761**DCL     10849--ASSIGN  10850--ASSIGN  10852--ASSIGN  10854--ASSIGN  10855--ASSIGN  10856--ASSIGN
     10858--CALL    10869--ASSIGN  10870--ASSIGN  10872--ASSIGN  10874--ASSIGN  10875--ASSIGN  10876--ASSIGN
     10878--CALL
VDO_DSC
     10822**DCL     10859--CALL    10859<>CALL    10908--CALL    10908<>CALL
VLP$TRMCTL
     10455**DCL     10852<<ASSIGN  10872<<ASSIGN
VLP$TRMCTL.BREAKCOUNT
     10466**DCL     10467--REDEF
VLP$TRMCTL.DISPINPUT
     10457**DCL     10854<<ASSIGN  10874<<ASSIGN

PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:127  
      709        1        /*T***********************************************************/
      710        2        /*T*                                                         */
      711        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      712        4        /*T*                                                         */
      713        5        /*T***********************************************************/
      714        6
      715        7        /*F*     NAME:    GJA$LOGON_RESPONCE
      716        8
      717        9                 PURPOSE: This routine is called when the network manager
      718       10                          responds to a LGNRQS message sent by the node
      719       11                          administrator.
      720       12
      721       13                 DESCRIPTION:  This routine follows these general steps:
      722       14                               1).  Clear status NMRSP
      723       15                               2).  If the logon will be successfull:
      724       16                                    - Do a null SINPUT to the device (if we
      725       17                                      solicited it).
      726       18                                    - Build an FPT_TERM and send it
      727       19                                    - Post status TERMACK
      728       20                                    - Return
      729       21                               3).  If the logon failed:
      730       22                                    - If this is an autologon reject:
      731       23                                      - Post this in channel table
      732       24                                      - Kill the device
      733       25                                    - Print message sent on responce (if any)
      734       26                                    - Attempt to solicit another logon if the
      735       27                                      device is not autologged
      736       28                               4).  Return
      737       29
      738       30                 CALL:   CALL GJA$LOGON_RESPONCE(CTX$);
      739       31
      740       32                 INPUT:  CTX$ - Points to the GJA$LGNCTX block for the device
      741       33                                attempting logon.
      742       34        */
      743       35        %EJECT;
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:128  
      744       36        GJA$LOGON_RESPONCE: PROC(CTX$) ALTRET;
      745       37
      746       38        %INCLUDE GJA_MSG_M;
      747      277        %INCLUDE KH$CHN;
      748      399        %INCLUDE KHA_FNC_E;
      749      499        %INCLUDE KNH_MACRO_C;
      750      782        %INCLUDE KL_AFCN_C;                     /* 'IGA' Function Codes     */
      751      883        %INCLUDE KL_ERRORS_C;
      752      925        %INCLUDE KL_MACRO_C;
      753     4277        %INCLUDE KV$VDO;
      754     5292        %INCLUDE KV$GLB;
      755     5711        %INCLUDE KV_PRMID_E;
      756     5885        %INCLUDE LCP_6;
      757    10164        %INCLUDE NK_VFC_C;
      758    10238                                                /* Args                     */
      759    10239    1   DCL CTX$ PTR;
      760    10240                                                /* Necessary VDH macros     */
      761    10241        %KV_VDO_ALL_E;
      762    10320        %KV_PRMID_E;
      763    10476                                                /* Based structures         */
      764    10477        %VLP_TRMCTL(FPTN=VLP$TRMCTL,STCLASS=BASED);
      765    10517        %KV$VDO_PRM(NAME=GJA$TRMCTL_VDO,STCLASS=BASED,LAST=",");
      766    10558             %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      767    10608    1         2 TL,
      768    10609    1           3 TYPE UBIN BYTE UNAL,
      769    10610    1           3 LEN UBIN BYTE UNAL;
      770    10611        %KH$CHN (STCLASS=BASED);
      771    10735        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
      772    10820        %KV$VDO_DAT(NAME=GJA$VDO_DAT,STCLASS=BASED,LAST=",");
      773    10865        %KV$VDOVLP_DAT1(STCLASS="",LVL=2);
      774    10915        %KV$VDO_PRM(NAME=GJA$SINPUT_VDO,STCLASS=BASED,LAST=",");
      775    10956        %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      776    11006    1         2 TL,
      777    11007    1           3 TYPE UBIN BYTE UNAL,
      778    11008    1           3 LEN UBIN BYTE UNAL;
      779    11009    1   DCL STRING CHAR(255) BASED;
      780    11010        %KL_SGNRSP(FPTN=KL$SGNRSP,STCLASS=BASED);
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:129  
      781    11146    1   DCL 1 MESSAGE BASED,
      782    11147    1         2 SIZE UBIN BYTE UNAL,
      783    11148    1         2 TEXT CHAR(MESSAGE.SIZE) UNAL;
      784    11149    1   DCL TEMP UBIN BASED;
      785    11150                                                /* Static                   */
      786    11151        %FPT_TERM(STCLASS=STATIC);
      787    11173                                                /* AUTO Storage             */
      788    11174        %KL_ADMIN (FPTN=ADMIN,STCLASS=AUTO);
      789    11335    1   DCL VDO_BUFFER(0:254) CHAR(1) UNAL;
      790    11336    1   DCL MSGSIZ UBIN;
      791    11337
      792    11338                                                /* Symrefs                  */
      793    11339        %KV$VDO_PRM(NAME=GJA_RPROMPT_VDO,STCLASS=SYMREF,LAST=",");
      794    11380             %KV$VDOVLP_DAT2(STCLASS="SYMREF",LVL=2,LAST=",");
      795    11430    1         2 TL,
      796    11431    1           3 TYPE UBIN BYTE UNAL,
      797    11432    1           3 LEN UBIN BYTE UNAL,
      798    11433    1         2 PROMPT CHAR(2) UNAL;
      799    11434        %VLP_TRMCTL(STCLASS=SYMREF,FPTN=GJA_VLP_TRMCTL);
      800    11474        %KL_ADMIN (FPTN=GJA_ADMIN,STCLASS=SYMREF);
      801    11635    1   DCL GJA_UID_NM UBIN(32) SYMREF;
      802    11636        %KV$VDO_PRM(NAME=GJA_PARAM_VDO,STCLASS=SYMREF,LAST=",");
      803    11677        %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      804    11727    1         2 TL,
      805    11728    1           3 TYPE UBIN BYTE UNAL,
      806    11729    1           3 LEN UBIN BYTE UNAL;
      807    11730
      808    11731        %KV$VDO_CLSSSN(NAME=KV$VDO_CLSSSN_RQS,FNC=KV_VDO_FNC_CLSSSN_RQS,STCLASS=STATIC);
      809    11773                                                /* Entrys                   */
      810    11774    1   DCL GJA$SEND_MSG ENTRY(4) ALTRET;
      811    11775    1   DCL GJA$Q_MSG ENTRY(6);
      812    11776    1   DCL GJA$SOLICIT_LOGON ENTRY(1);
      813    11777
      814    11778                                                /* EQUs and SUBs            */
      815    11779        %GJA_UID_EQUS;
      816    11787
      817    11788        %EJECT;
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:130  
      818    11789        /*
      819    11790          Clear status waiting for NM responce
      820    11791        */
      821    11792    1      GJA$LGNCTX.STATUS.NMRSP='0'B;
      822    11793        /*
      823    11794          Check to see if this was a successfull completion
      824    11795        */
      825    11796
      826    11797        /* If this is an auto logon and the host is not attached just wait */
      827    11798    1      IF GJA$LGNCTX.CHN$->KH$CHN.AUTLGN AND NOT GJA$LGNCTX.STATUS.DSCRCV
      828    11799    1        AND GJA$LGNCTX.MSG$->KL$SGNRSP.ERRCODE.ERR# = %E$NOHOST
      829    11800    2      THEN DO;
      830    11801    2           GJA$LGNCTX.STATUS.WAITING_HOST = '1'B;
      831    11802    2           GJA$LGNCTX.NM_NODE = GJA$LGNCTX.MSG$->KL$SGNRSP.RLCID.NODE;
      832    11803    2           GJA$LGNCTX.MSG$ = ADDR(NIL);
      833    11804    2           RETURN;
      834    11805    2           END;
      835    11806
      836    11807    1      IF GJA$LGNCTX.MSG$->KL$SGNRSP.ERRCODE.SEV =0 OR GJA$LGNCTX.STATUS.DSCRCV
      837    11808    2      THEN DO;
      838    11809        /*
      839    11810          If this device was not autologged, we want to do a SINPUT to clear
      840    11811          the logon string.
      841    11812        */
      842    11813    2           IF NOT(GJA$LGNCTX.CHN$->KH$CHN.AUTLGN)
      843    11814    2             AND GJA$LGNCTX.STATUS.INT
      844    11815    3           THEN DO;
      845    11816    3                ADDR(VDO_BUFFER)->GJA$SINPUT_VDO=GJA_PARAM_VDO;
      846    11817    3                ADDR(VDO_BUFFER)->GJA$SINPUT_VDO.KV$VDOVLP_DAT2.BYTSIZ=2;
      847    11818    3                PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA_PARAM_VDO))->TEMP=0;
      848    11819    3                ADDR(VDO_BUFFER)->GJA$SINPUT_VDO.TL.TYPE=%KV_PRMID_EDTBFR;
      849    11820    3                ADDR(VDO_BUFFER)->GJA$SINPUT_VDO.TL.LEN=0;
      850    11821    3                MSGSIZ=SIZEC(GJA_PARAM_VDO);
      851    11822    3                CALL GJA$Q_MSG(CTX$,MSGSIZ,ADDR(VDO_BUFFER)->GJA$SINPUT_VDO);
      852    11823    3                CALL GJA$Q_MSG(CTX$,SIZEC(GJA_RPROMPT_VDO),GJA_RPROMPT_VDO);
      853    11824    3                END;
      854    11825        /*
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:131  
      855    11826          If we didn't echo the logon string,
      856    11827          and the line is not an autologon line, turn echoplex on here.
      857    11828        */
      858    11829    2           IF (NOT(GJA$LGNCTX.CHN$->KH$CHN.ECHLGN) AND
      859    11830    2             NOT(GJA$LGNCTX.CHN$->KH$CHN.AUTLGN))
      860    11831    3           THEN DO;
      861    11832    3                ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO=GJA_PARAM_VDO;
      862    11833    3                ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.KV$VDOVLP_DAT2.BYTSIZ=
      863    11834    3                  SIZEC(GJA_VLP_TRMCTL)+2;
      864    11835    3                PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL=
      865    11836    3                  GJA_VLP_TRMCTL;
      866    11837    3                PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL.DISPINPUT =
             11837                         '1'B;
      867    11838    3                ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.TYPE=%KV_PRMID_TRMCTL;
      868    11839    3                ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.LEN=SIZEC(GJA_VLP_TRMCTL);
      869    11840    3                MSGSIZ=SIZEC(GJA$TRMCTL_VDO)+SIZEC(GJA_VLP_TRMCTL);
      870    11841    3                CALL GJA$Q_MSG(CTX$,MSGSIZ,ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO);
      871    11842    3                END;
      872    11843        /*
      873    11844          If there was a message sent back on the logon responce to indicate
      874    11845          why there was a failure, output it on the device.
      875    11846        */
      876    11847    2           IF GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE.RSPSIZ ~= 0
      877    11848    2             AND GJA$LGNCTX.STATUS.INT
      878    11849    3           THEN DO;
      879    11850    3                MSGSIZ=GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE.RSPSIZ;
      880    11851    3                CALL GJA$SEND_MSG(CTX$,ADDR(GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE)->
             11851                         MESSAGE.TEXT,MSGSIZ,%VFC_TRANSITION0);
      881    11852    3                END;
      882    11853        /*
      883    11854          Setup and send the TERM to VDH so it can connect out to the
      884    11855          appropriate host.
      885    11856        */
      886    11857    2           FPT_TERM.RLCID=GJA$LGNCTX.MSG$->KL$SGNRSP.RLCID;
      887    11858    2           FPT_TERM.COS=GJA$LGNCTX.MSG$->KL$SGNRSP.COS;
      888    11859    2           CALL GJA$Q_MSG(CTX$,,,SIZEC(FPT_TERM),FPT_TERM,%KN_FCN_TERM);
      889    11860    2           GJA$LGNCTX.STATUS.TERMACK='1'B;
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:132  
      890    11861    2           GJA$LGNCTX.STATUS.LOGGEDON='1'B;
      891    11862    2           RETURN;
      892    11863    2           END;
      893    11864        /*
      894    11865          Otherwise the logon request failed.  First check to see if this was
      895    11866          an autologon failure
      896    11867        */
      897    11868    2      ELSE DO;
      898    11869    2           IF GJA$LGNCTX.CHN$->KH$CHN.AUTLGN
      899    11870    3           THEN DO;
      900    11871    3                GJA$LGNCTX.CHN$->KH$CHN.AUTLGNFAILED='1'B;
      901    11872        /*
      902    11873             Send a DISCONNECT_RQS to handler unless the line would come right back
      903    11874         */
      904    11875        /*
      905    11876             send vdo_clsssn_rqs if auto logon was rejected for any reason
      906    11877             but nohost.
      907    11878        */
      908    11879    3                KV$VDO_CLSSSN_RQS.RSN = GJA$LGNCTX.MSG$->KL$SGNRSP.ERRCODE.ERR#;
      909    11880    3                CALL GJA$Q_MSG(CTX$,SIZEC(KV$VDO_CLSSSN_RQS),KV$VDO_CLSSSN_RQS);
      910    11881    3                ADMIN = GJA_ADMIN;
      911    11882    3                IF NOT GJA$LGNCTX.CHN$->KH$CHN.AUTBAD
      912    11883    3                  AND NOT GJA$LGNCTX.CHN$->KH$CHN.BRKRQ
      913    11884    3                  AND GJA$LGNCTX.CHN$->KH$CHN.DRCCNC THEN EXIT;
      914    11885        /*
      915    11886            If it would come right back, just wait for it to disconnect on its own.
      916    11887        */
      917    11888    3                ADMIN.TERMID_LO = GJA$LGNCTX.TERMINAL_ID;
      918    11889    3                ADMIN.TERMID_HI = GJA$LGNCTX.TERMINAL_ID;
      919    11890    3                ADMIN.FNC = %KHA_FNC_DISCONNECT_RQS;
      920    11891    3                CALL GJA$SEND_MSG(GJA$LGNCTX.CHN$->KH$CHN.HAND$,ADMIN,SIZEC(ADMIN));
      921    11892    3                END;
      922    11893        /*
      923    11894          If there was a message sent back on the logon responce to indicate
      924    11895          why there was a failure, output it on the device.
      925    11896        */
      926    11897    2           IF GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE.RSPSIZ ~= 0
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:133  
      927    11898    2             AND GJA$LGNCTX.STATUS.INT
      928    11899    3           THEN DO;
      929    11900    3                MSGSIZ=GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE.RSPSIZ;
      930    11901    3                CALL GJA$SEND_MSG(CTX$,ADDR(GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE)->
             11901                         MESSAGE.TEXT,MSGSIZ,%VFC_TRANSITION0);
      931    11902    3                END;
      932    11903        /*
      933    11904          If this device was not autologged, call a routine to attempt to
      934    11905          solicit another logon string and try again.
      935    11906        */
      936    11907    2           IF NOT(GJA$LGNCTX.CHN$->KH$CHN.AUTLGN)
      937    11908    2           THEN CALL GJA$SOLICIT_LOGON(CTX$);
      938    11909    2           END;
      939    11910
      940    11911    1      RETURN;
      941    11912    1   END;
      942    11913        %EOD;

PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:134  
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_ERRORS_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$LOGON_RESPONCE.

   Procedure GJA$LOGON_RESPONCE requires 478 words for executable code.
   Procedure GJA$LOGON_RESPONCE requires 182 words of local(AUTO) storage.

PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:135  

 Object Unit name= GJA$LOGON_RESPONCE                         File name= GJA$LOGON.:E05TOU
 UTS= JUL 29 '97 21:52:06.76 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none     6      6  GJA$LOGON_RESPONCE
    1   Proc  even  none   478    1DE  GJA$LOGON_RESPONCE
    2  RoData even  none     1      1  GJA$LOGON_RESPONCE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  GJA$LOGON_RESPONCE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       6 GJA$Q_MSG
 yes     yes           Std       4 GJA$SEND_MSG
         yes           Std       1 GJA$SOLICIT_LOGON
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     GJA_RPROMPT_VDO                       GJA_VLP_TRMCTL                        GJA_ADMIN
     GJA_PARAM_VDO                    r    G$ROS$
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:136  


      709        1        /*T***********************************************************/
      710        2        /*T*                                                         */
      711        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      712        4        /*T*                                                         */
      713        5        /*T***********************************************************/
      714        6
      715        7        /*F*     NAME:    GJA$LOGON_RESPONCE
      716        8
      717        9                 PURPOSE: This routine is called when the network manager
      718       10                          responds to a LGNRQS message sent by the node
      719       11                          administrator.
      720       12
      721       13                 DESCRIPTION:  This routine follows these general steps:
      722       14                               1).  Clear status NMRSP
      723       15                               2).  If the logon will be successfull:
      724       16                                    - Do a null SINPUT to the device (if we
      725       17                                      solicited it).
      726       18                                    - Build an FPT_TERM and send it
      727       19                                    - Post status TERMACK
      728       20                                    - Return
      729       21                               3).  If the logon failed:
      730       22                                    - If this is an autologon reject:
      731       23                                      - Post this in channel table
      732       24                                      - Kill the device
      733       25                                    - Print message sent on responce (if any)
      734       26                                    - Attempt to solicit another logon if the
      735       27                                      device is not autologged
      736       28                               4).  Return
      737       29
      738       30                 CALL:   CALL GJA$LOGON_RESPONCE(CTX$);
      739       31
      740       32                 INPUT:  CTX$ - Points to the GJA$LGNCTX block for the device
      741       33                                attempting logon.
      742       34        */
      743       35        %EJECT;
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:137  
      744       36        GJA$LOGON_RESPONCE: PROC(CTX$) ALTRET;

     36   1 000000  D380 0000 0000  xent GJA$LOGON_RESPO*LNJ,B5   X6A_AUTO_1
          1 000003       00B6 0001                       DC       182,1

      745       37
      746       38        %INCLUDE GJA_MSG_M;
      747      277        %INCLUDE KH$CHN;
      748      399        %INCLUDE KHA_FNC_E;
      749      499        %INCLUDE KNH_MACRO_C;
      750      782        %INCLUDE KL_AFCN_C;                     /* 'IGA' Function Codes     */
      751      883        %INCLUDE KL_ERRORS_C;
      752      925        %INCLUDE KL_MACRO_C;
      753     4277        %INCLUDE KV$VDO;
      754     5292        %INCLUDE KV$GLB;
      755     5711        %INCLUDE KV_PRMID_E;
      756     5885        %INCLUDE LCP_6;
      757    10164        %INCLUDE NK_VFC_C;
      758    10238                                                /* Args                     */
      759    10239    1   DCL CTX$ PTR;
      760    10240                                                /* Necessary VDH macros     */
      761    10241        %KV_VDO_ALL_E;
      762    10320        %KV_PRMID_E;
      763    10476                                                /* Based structures         */
      764    10477        %VLP_TRMCTL(FPTN=VLP$TRMCTL,STCLASS=BASED);
      765    10517        %KV$VDO_PRM(NAME=GJA$TRMCTL_VDO,STCLASS=BASED,LAST=",");
      766    10558             %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      767    10608    1         2 TL,
      768    10609    1           3 TYPE UBIN BYTE UNAL,
      769    10610    1           3 LEN UBIN BYTE UNAL;
      770    10611        %KH$CHN (STCLASS=BASED);
      771    10735        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
      772    10820        %KV$VDO_DAT(NAME=GJA$VDO_DAT,STCLASS=BASED,LAST=",");
      773    10865        %KV$VDOVLP_DAT1(STCLASS="",LVL=2);
      774    10915        %KV$VDO_PRM(NAME=GJA$SINPUT_VDO,STCLASS=BASED,LAST=",");
      775    10956        %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      776    11006    1         2 TL,
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:138  
      777    11007    1           3 TYPE UBIN BYTE UNAL,
      778    11008    1           3 LEN UBIN BYTE UNAL;
      779    11009    1   DCL STRING CHAR(255) BASED;
      780    11010        %KL_SGNRSP(FPTN=KL$SGNRSP,STCLASS=BASED);
      781    11146    1   DCL 1 MESSAGE BASED,
      782    11147    1         2 SIZE UBIN BYTE UNAL,
      783    11148    1         2 TEXT CHAR(MESSAGE.SIZE) UNAL;
      784    11149    1   DCL TEMP UBIN BASED;
      785    11150                                                /* Static                   */
      786    11151        %FPT_TERM(STCLASS=STATIC);
      787    11173                                                /* AUTO Storage             */
      788    11174        %KL_ADMIN (FPTN=ADMIN,STCLASS=AUTO);
      789    11335    1   DCL VDO_BUFFER(0:254) CHAR(1) UNAL;
      790    11336    1   DCL MSGSIZ UBIN;
      791    11337
      792    11338                                                /* Symrefs                  */
      793    11339        %KV$VDO_PRM(NAME=GJA_RPROMPT_VDO,STCLASS=SYMREF,LAST=",");
      794    11380             %KV$VDOVLP_DAT2(STCLASS="SYMREF",LVL=2,LAST=",");
      795    11430    1         2 TL,
      796    11431    1           3 TYPE UBIN BYTE UNAL,
      797    11432    1           3 LEN UBIN BYTE UNAL,
      798    11433    1         2 PROMPT CHAR(2) UNAL;
      799    11434        %VLP_TRMCTL(STCLASS=SYMREF,FPTN=GJA_VLP_TRMCTL);
      800    11474        %KL_ADMIN (FPTN=GJA_ADMIN,STCLASS=SYMREF);
      801    11635    1   DCL GJA_UID_NM UBIN(32) SYMREF;
      802    11636        %KV$VDO_PRM(NAME=GJA_PARAM_VDO,STCLASS=SYMREF,LAST=",");
      803    11677        %KV$VDOVLP_DAT2(STCLASS="",LVL=2,LAST=",");
      804    11727    1         2 TL,
      805    11728    1           3 TYPE UBIN BYTE UNAL,
      806    11729    1           3 LEN UBIN BYTE UNAL;
      807    11730
      808    11731        %KV$VDO_CLSSSN(NAME=KV$VDO_CLSSSN_RQS,FNC=KV_VDO_FNC_CLSSSN_RQS,STCLASS=STATIC);
      809    11773                                                /* Entrys                   */
      810    11774    1   DCL GJA$SEND_MSG ENTRY(4) ALTRET;
      811    11775    1   DCL GJA$Q_MSG ENTRY(6);
      812    11776    1   DCL GJA$SOLICIT_LOGON ENTRY(1);
      813    11777
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:139  
      814    11778                                                /* EQUs and SUBs            */
      815    11779        %GJA_UID_EQUS;
      816    11787
      817    11788        %EJECT;
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:140  
      818    11789        /*
      819    11790          Clear status waiting for NM responce
      820    11791        */
      821    11792    1      GJA$LGNCTX.STATUS.NMRSP='0'B;

  11792   1 000005  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000007  DC86                                 LDB,B5   ,B6
          1 000008  8845 0018                            LBF,'2000'X       24,B5
          1 00000A       2000

      822    11793        /*
      823    11794          Check to see if this was a successfull completion
      824    11795        */
      825    11796
      826    11797        /* If this is an auto logon and the host is not attached just wait */
      827    11798    1      IF GJA$LGNCTX.CHN$->KH$CHN.AUTLGN AND NOT GJA$LGNCTX.STATUS.DSCRCV

  11798   1 00000B  DC86                                 LDB,B5   ,B6
          1 00000C  CCC5 000A                            LDB,B4   10,B5
          1 00000E  8284                                 LB,'0004'X        ,B4
          1 00000F       0004
          1 000010  0581 0022                            BBF      s:11807,PREL
          1 000012  82C5 0018                            LB,'0100'X        24,B5
          1 000014       0100
          1 000015  0501 001D                            BBT      s:11807,PREL
          1 000017  BCC5 000C                            LDB,B3   12,B5
          1 000019  E843 0006                            LDR,R6   6,B3
          1 00001B  6043                                 SOR,R6   3
          1 00001C  E970 04C3                            CMR,R6   1219,IMO
          1 00001E  0981 0014                            BNE      s:11807,PREL

      828    11799    1        AND GJA$LGNCTX.MSG$->KL$SGNRSP.ERRCODE.ERR# = %E$NOHOST
      829    11800    2      THEN DO;

      830    11801    2           GJA$LGNCTX.STATUS.WAITING_HOST = '1'B;

  11801   1 000020  8945 0018                            LBT,'0040'X       24,B5
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:141  
  11801   1 000022       0040

      831    11802    2           GJA$LGNCTX.NM_NODE = GJA$LGNCTX.MSG$->KL$SGNRSP.RLCID.NODE;

  11802   1 000023  DC86                                 LDB,B5   ,B6
          1 000024  CCC5 000C                            LDB,B4   12,B5
          1 000026  E2C4 0003                            LLH,R6   3,B4
          1 000028  E7C5 0009                            STH,R6   9,B5

      832    11803    2           GJA$LGNCTX.MSG$ = ADDR(NIL);

  11803   1 00002A  DC86                                 LDB,B5   ,B6
          1 00002B  CB80 0000 0000                       LAB,B4   0
          1 00002E  CFC5 000C                            STB,B4   12,B5

      833    11804    2           RETURN;

  11804   1 000030  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      834    11805    2           END;
      835    11806
      836    11807    1      IF GJA$LGNCTX.MSG$->KL$SGNRSP.ERRCODE.SEV =0 OR GJA$LGNCTX.STATUS.DSCRCV

  11807   1 000033  BCC5 000C                            LDB,B3   12,B5
          1 000035  82C3 0006                            LB,'0007'X        6,B3
          1 000037       0007
          1 000038  0581 0006                            BBF      s:11813,PREL
          1 00003A  82C5 0018                            LB,'0100'X        24,B5
          1 00003C       0100
          1 00003D  0581 00F9                            BBF      s:11869,PREL

      837    11808    2      THEN DO;

      838    11809        /*
      839    11810          If this device was not autologged, we want to do a SINPUT to clear
      840    11811          the logon string.
      841    11812        */
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:142  
      842    11813    2           IF NOT(GJA$LGNCTX.CHN$->KH$CHN.AUTLGN)

  11813   1 00003F  8284                                 LB,'0004'X        ,B4
  11813   1 000040       0004
          1 000041  0501 0044                            BBT      s:11829,PREL
          1 000043  82C5 0018                            LB,'0400'X        24,B5
          1 000045       0400
          1 000046  0581 003F                            BBF      s:11829,PREL

      843    11814    2             AND GJA$LGNCTX.STATUS.INT
      844    11815    3           THEN DO;

      845    11816    3                ADDR(VDO_BUFFER)->GJA$SINPUT_VDO=GJA_PARAM_VDO;

  11816   1 000048  AB80 0000 0000  xsym                 LAB,B2   GJA_PARAM_VDO
          1 00004B  2C00                                 LDV,R2   0
          1 00004C  6C08                                 LDV,R6   8
          1 00004D  BB87                                 LAB,B3   ,AUTO
          1 00004E  3C50                                 LDV,R3   80
          1 00004F  0008                                 MMM

      846    11817    3                ADDR(VDO_BUFFER)->GJA$SINPUT_VDO.KV$VDOVLP_DAT2.BYTSIZ=2;

  11817   1 000050  6C02                                 LDV,R6   2
          1 000051  EF47 002A                            STR,R6   VDO_BUFFER+2,AUTO

      847    11818    3                PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA_PARAM_VDO))->TEMP=0;

  11818   1 000053  8747 002C                            CL       VDO_BUFFER+4,AUTO

      848    11819    3                ADDR(VDO_BUFFER)->GJA$SINPUT_VDO.TL.TYPE=%KV_PRMID_EDTBFR;

  11819   1 000055  D870 0083                            LDR,R5   131,IMO
          1 000057  D7C7 002B                            STH,R5   VDO_BUFFER+3,AUTO

      849    11820    3                ADDR(VDO_BUFFER)->GJA$SINPUT_VDO.TL.LEN=0;

PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:143  
  11820   1 000059  8847 002B                            LBF,'00FF'X       VDO_BUFFER+3,AUTO
  11820   1 00005B       00FF

      850    11821    3                MSGSIZ=SIZEC(GJA_PARAM_VDO);

  11821   1 00005C  4C08                                 LDV,R4   8
          1 00005D  CF47 00A8                            STR,R4   MSGSIZ,AUTO

      851    11822    3                CALL GJA$Q_MSG(CTX$,MSGSIZ,ADDR(VDO_BUFFER)->GJA$SINPUT_VDO);

  11822   1 00005F  DBC7 0028                            LAB,B5   VDO_BUFFER,AUTO
          1 000061  DFC7 00AE                            STB,B5   MSGSIZ+6,AUTO
          1 000063  CBC7 00A8                            LAB,B4   MSGSIZ,AUTO
          1 000065  CFC7 00AC                            STB,B4   MSGSIZ+4,AUTO
          1 000067  EFC7 00AA                            STB,B6   MSGSIZ+2,AUTO
          1 000069  BBC7 00AA                            LAB,B3   MSGSIZ+2,AUTO
          1 00006B  CBF0 0300                            LAB,B4   768,IMO
          1 00006D  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          1 000070       0001                            DC       s:11823,PREL

      852    11823    3                CALL GJA$Q_MSG(CTX$,SIZEC(GJA_RPROMPT_VDO),GJA_RPROMPT_VDO);

  11823   1 000071  EBF0 000A                            LAB,B6   10,IMO
          1 000073  DB80 0000 0000  xsym                 LAB,B5   GJA_RPROMPT_VDO
          1 000076  DFC7 00AE                            STB,B5   MSGSIZ+6,AUTO
          1 000078  EFC7 00AC                            STB,B6   MSGSIZ+4,AUTO
          1 00007A  CCC7 0004                            LDB,B4   @CTX$,AUTO
          1 00007C  CFC7 00AA                            STB,B4   MSGSIZ+2,AUTO
          1 00007E  BBC7 00AA                            LAB,B3   MSGSIZ+2,AUTO
          1 000080  CBF0 0300                            LAB,B4   768,IMO
          1 000082  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          1 000085       0001                            DC       s:11829,PREL

      853    11824    3                END;

      854    11825        /*
      855    11826          If we didn't echo the logon string,
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:144  
      856    11827          and the line is not an autologon line, turn echoplex on here.
      857    11828        */
      858    11829    2           IF (NOT(GJA$LGNCTX.CHN$->KH$CHN.ECHLGN) AND

  11829   1 000086  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000088  DC86                                 LDB,B5   ,B6
          1 000089  CCC5 000A                            LDB,B4   10,B5
          1 00008B  82C4 0009                            LB,'0200'X        9,B4
          1 00008D       0200
          1 00008E  0501 0039                            BBT      s:11847,PREL
          1 000090  8284                                 LB,'0004'X        ,B4
          1 000091       0004
          1 000092  0501 0035                            BBT      s:11847,PREL

      859    11830    2             NOT(GJA$LGNCTX.CHN$->KH$CHN.AUTLGN))
      860    11831    3           THEN DO;

      861    11832    3                ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO=GJA_PARAM_VDO;

  11832   1 000094  AB80 0000 0000  xsym                 LAB,B2   GJA_PARAM_VDO
          1 000097  2C00                                 LDV,R2   0
          1 000098  6C08                                 LDV,R6   8
          1 000099  BB87                                 LAB,B3   ,AUTO
          1 00009A  3C50                                 LDV,R3   80
          1 00009B  0008                                 MMM

      862    11833    3                ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.KV$VDOVLP_DAT2.BYTSIZ=

  11833   1 00009C  6C12                                 LDV,R6   18
          1 00009D  EF47 002A                            STR,R6   VDO_BUFFER+2,AUTO

      863    11834    3                  SIZEC(GJA_VLP_TRMCTL)+2;
      864    11835    3                PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL=

  11835   1 00009F  AB80 0000 0000  xsym                 LAB,B2   GJA_VLP_TRMCTL
          1 0000A2  2C00                                 LDV,R2   0
          1 0000A3  6C10                                 LDV,R6   16
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:145  
          1 0000A4  BB87                                 LAB,B3   ,AUTO
          1 0000A5  3C58                                 LDV,R3   88
          1 0000A6  0008                                 MMM

      865    11836    3                  GJA_VLP_TRMCTL;
      866    11837    3                PINCRW(ADDR(VDO_BUFFER),SIZEW(GJA$TRMCTL_VDO))->VLP$TRMCTL.DISPINPUT =
             11837                         '1'B;

  11837   1 0000A7  E870 0080                            LDR,R6   128,IMO
          1 0000A9  EAC7 002C                            SRM,R6,'00C0'X    VDO_BUFFER+4,AUTO
          1 0000AB       00C0

      867    11838    3                ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.TYPE=%KV_PRMID_TRMCTL;

  11838   1 0000AC  5C04                                 LDV,R5   4
          1 0000AD  D7C7 002B                            STH,R5   VDO_BUFFER+3,AUTO

      868    11839    3                ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO.TL.LEN=SIZEC(GJA_VLP_TRMCTL);

  11839   1 0000AF  4C10                                 LDV,R4   16
          1 0000B0  CAC7 002B                            SRM,R4,'00FF'X    VDO_BUFFER+3,AUTO
          1 0000B2       00FF

      869    11840    3                MSGSIZ=SIZEC(GJA$TRMCTL_VDO)+SIZEC(GJA_VLP_TRMCTL);

  11840   1 0000B3  3C18                                 LDV,R3   24
          1 0000B4  BF47 00A8                            STR,R3   MSGSIZ,AUTO

      870    11841    3                CALL GJA$Q_MSG(CTX$,MSGSIZ,ADDR(VDO_BUFFER)->GJA$TRMCTL_VDO);

  11841   1 0000B6  DBC7 0028                            LAB,B5   VDO_BUFFER,AUTO
          1 0000B8  DFC7 00AE                            STB,B5   MSGSIZ+6,AUTO
          1 0000BA  CBC7 00A8                            LAB,B4   MSGSIZ,AUTO
          1 0000BC  CFC7 00AC                            STB,B4   MSGSIZ+4,AUTO
          1 0000BE  EFC7 00AA                            STB,B6   MSGSIZ+2,AUTO
          1 0000C0  BBC7 00AA                            LAB,B3   MSGSIZ+2,AUTO
          1 0000C2  CBF0 0300                            LAB,B4   768,IMO
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:146  
          1 0000C4  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          1 0000C7       0001                            DC       s:11847,PREL

      871    11842    3                END;

      872    11843        /*
      873    11844          If there was a message sent back on the logon responce to indicate
      874    11845          why there was a failure, output it on the device.
      875    11846        */
      876    11847    2           IF GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE.RSPSIZ ~= 0

  11847   1 0000C8  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 0000CA  DC86                                 LDB,B5   ,B6
          1 0000CB  CCC5 000C                            LDB,B4   12,B5
          1 0000CD  82C4 000F                            LB,'00FF'X        15,B4
          1 0000CF       00FF
          1 0000D0  0581 0026                            BBF      s:11857,PREL
          1 0000D2  82C5 0018                            LB,'0400'X        24,B5
          1 0000D4       0400
          1 0000D5  0581 0021                            BBF      s:11857,PREL

      877    11848    2             AND GJA$LGNCTX.STATUS.INT
      878    11849    3           THEN DO;

      879    11850    3                MSGSIZ=GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE.RSPSIZ;

  11850   1 0000D7  E844 000F                            LDR,R6   15,B4
          1 0000D9  E570 00FF                            AND,R6   255,IMO
          1 0000DB  EF47 00A8                            STR,R6   MSGSIZ,AUTO

      880    11851    3                CALL GJA$SEND_MSG(CTX$,ADDR(GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE)->
             11851                         MESSAGE.TEXT,MSGSIZ,%VFC_TRANSITION0);

  11851   1 0000DD  DC86                                 LDB,B5   ,B6
          1 0000DE  CCC5 000C                            LDB,B4   12,B5
          1 0000E0  BB80 0000 0000  02                   LAB,B3   0
          1 0000E3  BFC7 00B0                            STB,B3   MSGSIZ+8,AUTO
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:147  
          1 0000E5  DBC7 00A8                            LAB,B5   MSGSIZ,AUTO
          1 0000E7  DFC7 00AE                            STB,B5   MSGSIZ+6,AUTO
          1 0000E9  ABC4 0010                            LAB,B2   16,B4
          1 0000EB  AFC7 00AC                            STB,B2   MSGSIZ+4,AUTO
          1 0000ED  EFC7 00AA                            STB,B6   MSGSIZ+2,AUTO
          1 0000EF  BBC7 00AA                            LAB,B3   MSGSIZ+2,AUTO
          1 0000F1  CBF0 0400                            LAB,B4   1024,IMO
          1 0000F3  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          1 0000F6       0001                            DC       s:11857,PREL

      881    11852    3                END;

      882    11853        /*
      883    11854          Setup and send the TERM to VDH so it can connect out to the
      884    11855          appropriate host.
      885    11856        */
      886    11857    2           FPT_TERM.RLCID=GJA$LGNCTX.MSG$->KL$SGNRSP.RLCID;

  11857   1 0000F7  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 0000F9  DC86                                 LDB,B5   ,B6
          1 0000FA  CCC5 000C                            LDB,B4   12,B5
          1 0000FC  8CC4 0003                            LDI      3,B4
          1 0000FE  8D00 0000 0000  00                   SDI      FPT_TERM

      887    11858    2           FPT_TERM.COS=GJA$LGNCTX.MSG$->KL$SGNRSP.COS;

  11858   1 000101  DC86                                 LDB,B5   ,B6
          1 000102  CCC5 000C                            LDB,B4   12,B5
          1 000104  D2C4 000F                            LLH,R5   15,B4
          1 000106  D780 0000 0003  00                   STH,R5   FPT_TERM+3

      888    11859    2           CALL GJA$Q_MSG(CTX$,,,SIZEC(FPT_TERM),FPT_TERM,%KN_FCN_TERM);

  11859   1 000109  DBF0 0008                            LAB,B5   8,IMO
          1 00010B  CBF0 0003                            LAB,B4   3,IMO
          1 00010D  CFC7 00B4                            STB,B4   MSGSIZ+12,AUTO
          1 00010F  BB80 0000 0000  00                   LAB,B3   FPT_TERM
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:148  
          1 000112  BFC7 00B2                            STB,B3   MSGSIZ+10,AUTO
          1 000114  DFC7 00B0                            STB,B5   MSGSIZ+8,AUTO
          1 000116  AB80 0000 0000                       LAB,B2   0
          1 000119  AFC7 00AE                            STB,B2   MSGSIZ+6,AUTO
          1 00011B  9B80 0000 0000                       LAB,B1   0
          1 00011E  9FC7 00AC                            STB,B1   MSGSIZ+4,AUTO
          1 000120  EFC7 00AA                            STB,B6   MSGSIZ+2,AUTO
          1 000122  BBC7 00AA                            LAB,B3   MSGSIZ+2,AUTO
          1 000124  CBF0 0600                            LAB,B4   1536,IMO
          1 000126  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          1 000129       0001                            DC       s:11860,PREL

      889    11860    2           GJA$LGNCTX.STATUS.TERMACK='1'B;

  11860   1 00012A  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 00012C  DC86                                 LDB,B5   ,B6
          1 00012D  8945 0018                            LBT,'1000'X       24,B5
          1 00012F       1000

      890    11861    2           GJA$LGNCTX.STATUS.LOGGEDON='1'B;

  11861   1 000130  DC86                                 LDB,B5   ,B6
          1 000131  8945 0018                            LBT,'0800'X       24,B5
          1 000133       0800

      891    11862    2           RETURN;

  11862   1 000134  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      892    11863    2           END;
      893    11864        /*
      894    11865          Otherwise the logon request failed.  First check to see if this was
      895    11866          an autologon failure
      896    11867        */
      897    11868    2      ELSE DO;

      898    11869    2           IF GJA$LGNCTX.CHN$->KH$CHN.AUTLGN
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:149  

  11869   1 000137  8284                                 LB,'0004'X        ,B4
  11869   1 000138       0004
          1 000139  0581 0061                            BBF      s:11897,PREL

      899    11870    3           THEN DO;

      900    11871    3                GJA$LGNCTX.CHN$->KH$CHN.AUTLGNFAILED='1'B;

  11871   1 00013B  8904                                 LBT,'0002'X       ,B4
  11871   1 00013C       0002

      901    11872        /*
      902    11873             Send a DISCONNECT_RQS to handler unless the line would come right back
      903    11874         */
      904    11875        /*
      905    11876             send vdo_clsssn_rqs if auto logon was rejected for any reason
      906    11877             but nohost.
      907    11878        */
      908    11879    3                KV$VDO_CLSSSN_RQS.RSN = GJA$LGNCTX.MSG$->KL$SGNRSP.ERRCODE.ERR#;

  11879   1 00013D  DC86                                 LDB,B5   ,B6
          1 00013E  CCC5 000C                            LDB,B4   12,B5
          1 000140  E844 0006                            LDR,R6   6,B4
          1 000142  6043                                 SOR,R6   3
          1 000143  EF00 0000 0005  00                   STR,R6   KV$VDO_CLSSSN_RQS+1

      909    11880    3                CALL GJA$Q_MSG(CTX$,SIZEC(KV$VDO_CLSSSN_RQS),KV$VDO_CLSSSN_RQS);

  11880   1 000146  DBF0 0004                            LAB,B5   4,IMO
          1 000148  CB80 0000 0004  00                   LAB,B4   KV$VDO_CLSSSN_RQS
          1 00014B  CFC7 00AE                            STB,B4   MSGSIZ+6,AUTO
          1 00014D  DFC7 00AC                            STB,B5   MSGSIZ+4,AUTO
          1 00014F  EFC7 00AA                            STB,B6   MSGSIZ+2,AUTO
          1 000151  BBC7 00AA                            LAB,B3   MSGSIZ+2,AUTO
          1 000153  CBF0 0300                            LAB,B4   768,IMO
          1 000155  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:150  
          1 000158       0001                            DC       s:11881,PREL

      910    11881    3                ADMIN = GJA_ADMIN;

  11881   1 000159  AB80 0000 0000  xsym                 LAB,B2   GJA_ADMIN
          1 00015C  2C00                                 LDV,R2   0
          1 00015D  6C44                                 LDV,R6   68
          1 00015E  BB87                                 LAB,B3   ,AUTO
          1 00015F  3C0C                                 LDV,R3   12
          1 000160  0008                                 MMM

      911    11882    3                IF NOT GJA$LGNCTX.CHN$->KH$CHN.AUTBAD

  11882   1 000161  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000163  DC86                                 LDB,B5   ,B6
          1 000164  CCC5 000A                            LDB,B4   10,B5
          1 000166  82C4 0008                            LB,'0010'X        8,B4
          1 000168       0010
          1 000169  0501 000A                            BBT      s:11888,PREL
          1 00016B  82C4 0001                            LB,'0080'X        1,B4
          1 00016D       0080
          1 00016E  0501 0005                            BBT      s:11888,PREL
          1 000170  89C4 0007                            CMZ      7,B4
          1 000172  0801 0028                            BAL      s:11897,PREL

      912    11883    3                  AND NOT GJA$LGNCTX.CHN$->KH$CHN.BRKRQ
      913    11884    3                  AND GJA$LGNCTX.CHN$->KH$CHN.DRCCNC THEN EXIT;
      914    11885        /*
      915    11886            If it would come right back, just wait for it to disconnect on its own.
      916    11887        */
      917    11888    3                ADMIN.TERMID_LO = GJA$LGNCTX.TERMINAL_ID;

  11888   1 000174  AB85                                 LAB,B2   ,B5
          1 000175  2C1E                                 LDV,R2   30
          1 000176  6C10                                 LDV,R6   16
          1 000177  BB87                                 LAB,B3   ,AUTO
          1 000178  3C30                                 LDV,R3   48
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:151  
          1 000179  0008                                 MMM

      918    11889    3                ADMIN.TERMID_HI = GJA$LGNCTX.TERMINAL_ID;

  11889   1 00017A  CC86                                 LDB,B4   ,B6
          1 00017B  AB84                                 LAB,B2   ,B4
          1 00017C  2C1E                                 LDV,R2   30
          1 00017D  6C10                                 LDV,R6   16
          1 00017E  BB87                                 LAB,B3   ,AUTO
          1 00017F  3C40                                 LDV,R3   64
          1 000180  0008                                 MMM

      919    11890    3                ADMIN.FNC = %KHA_FNC_DISCONNECT_RQS;

  11890   1 000181  6C0D                                 LDV,R6   13
          1 000182  EF47 0017                            STR,R6   ADMIN+17,AUTO

      920    11891    3                CALL GJA$SEND_MSG(GJA$LGNCTX.CHN$->KH$CHN.HAND$,ADMIN,SIZEC(ADMIN));

  11891   1 000184  9C86                                 LDB,B1   ,B6
          1 000185  ECC1 000A                            LDB,B6   10,B1
          1 000187  9BF0 0044                            LAB,B1   68,IMO
          1 000189  9FC7 00AE                            STB,B1   MSGSIZ+6,AUTO
          1 00018B  DBC7 0006                            LAB,B5   ADMIN,AUTO
          1 00018D  DFC7 00AC                            STB,B5   MSGSIZ+4,AUTO
          1 00018F  DBC6 001E                            LAB,B5   30,B6
          1 000191  DFC7 00AA                            STB,B5   MSGSIZ+2,AUTO
          1 000193  BBC7 00AA                            LAB,B3   MSGSIZ+2,AUTO
          1 000195  CBF0 0300                            LAB,B4   768,IMO
          1 000197  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
          1 00019A       0001                            DC       s:11897,PREL

      921    11892    3                END;

      922    11893        /*
      923    11894          If there was a message sent back on the logon responce to indicate
      924    11895          why there was a failure, output it on the device.
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:152  
      925    11896        */
      926    11897    2           IF GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE.RSPSIZ ~= 0

  11897   1 00019B  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 00019D  DC86                                 LDB,B5   ,B6
          1 00019E  CCC5 000C                            LDB,B4   12,B5
          1 0001A0  82C4 000F                            LB,'00FF'X        15,B4
          1 0001A2       00FF
          1 0001A3  0581 0026                            BBF      s:11907,PREL
          1 0001A5  82C5 0018                            LB,'0400'X        24,B5
          1 0001A7       0400
          1 0001A8  0581 0021                            BBF      s:11907,PREL

      927    11898    2             AND GJA$LGNCTX.STATUS.INT
      928    11899    3           THEN DO;

      929    11900    3                MSGSIZ=GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE.RSPSIZ;

  11900   1 0001AA  E844 000F                            LDR,R6   15,B4
          1 0001AC  E570 00FF                            AND,R6   255,IMO
          1 0001AE  EF47 00A8                            STR,R6   MSGSIZ,AUTO

      930    11901    3                CALL GJA$SEND_MSG(CTX$,ADDR(GJA$LGNCTX.MSG$->KL$SGNRSP.MESSAGE)->
             11901                         MESSAGE.TEXT,MSGSIZ,%VFC_TRANSITION0);

  11901   1 0001B0  DC86                                 LDB,B5   ,B6
          1 0001B1  CCC5 000C                            LDB,B4   12,B5
          1 0001B3  BB80 0000 0000  02                   LAB,B3   0
          1 0001B6  BFC7 00B0                            STB,B3   MSGSIZ+8,AUTO
          1 0001B8  DBC7 00A8                            LAB,B5   MSGSIZ,AUTO
          1 0001BA  DFC7 00AE                            STB,B5   MSGSIZ+6,AUTO
          1 0001BC  ABC4 0010                            LAB,B2   16,B4
          1 0001BE  AFC7 00AC                            STB,B2   MSGSIZ+4,AUTO
          1 0001C0  EFC7 00AA                            STB,B6   MSGSIZ+2,AUTO
          1 0001C2  BBC7 00AA                            LAB,B3   MSGSIZ+2,AUTO
          1 0001C4  CBF0 0400                            LAB,B4   1024,IMO
          1 0001C6  E380 0000 0000  xent                 LNJ,B6   GJA$SEND_MSG
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:153  
          1 0001C9       0001                            DC       s:11907,PREL

      931    11902    3                END;

      932    11903        /*
      933    11904          If this device was not autologged, call a routine to attempt to
      934    11905          solicit another logon string and try again.
      935    11906        */
      936    11907    2           IF NOT(GJA$LGNCTX.CHN$->KH$CHN.AUTLGN)

  11907   1 0001CA  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 0001CC  DC86                                 LDB,B5   ,B6
          1 0001CD  CCC5 000A                            LDB,B4   10,B5
          1 0001CF  8284                                 LB,'0004'X        ,B4
          1 0001D0       0004
          1 0001D1  0501 0009                            BBT      s:11911,PREL

      937    11908    2           THEN CALL GJA$SOLICIT_LOGON(CTX$);

  11908   1 0001D3  BBC7 0004                            LAB,B3   @CTX$,AUTO
          1 0001D5  CBF0 0100                            LAB,B4   256,IMO
          1 0001D7  E380 0000 0000  xent                 LNJ,B6   GJA$SOLICIT_LOGON
          1 0001DA       0001                            DC       s:11911,PREL

      938    11909    2           END;

      939    11910
      940    11911    1      RETURN;

  11911   1 0001DB  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      941    11912    1   END;
      942    11913        %EOD;

PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:154  
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_ERRORS_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KHA_FNC_E.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$LOGON_RESPONCE.
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:155  

 **** Variables and constants ****

  ****  Section 000  Data  GJA$LOGON_RESPONCE

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(64)    r     1 FPT_TERM                   4-0-0/w STRC(32)    r     1 KV$VDO_CLSSSN_RQS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @CTX$                      6-0-0/w STRC(544)   r     1 ADMIN
    *0-0-0/w PTR         r     1 CTX$                      A8-0-0/w UBIN(16)    r     1 MSGSIZ
    28-0-0/c CHAR        r     1 VDO_BUFFER(0:254)

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(544)   r     1 GJA_ADMIN                  0-0-0/w STRC(64)    r     1 GJA_PARAM_VDO
     0-0-0/w STRC(80)    r     1 GJA_RPROMPT_VDO            0-0-0/w STRC(128)   r     1 GJA_VLP_TRMCTL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(528)   r     1 GJA$LGNCTX                 0-0-0/w STRC(64)    r     1 GJA$SINPUT_VDO
     0-0-0/w STRC(64)    r     1 GJA$TRMCTL_VDO             0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w STRC(264)   r     1 KL$SGNRSP                  0-0-0/c ASTR(8)     r     1 MESSAGE
     0-0-0/w UBIN(16)    r     1 TEMP                       0-0-0/w STRC(128)   r     1 VLP$TRMCTL

PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:156  

   Procedure GJA$LOGON_RESPONCE requires 478 words for executable code.
   Procedure GJA$LOGON_RESPONCE requires 182 words of local(AUTO) storage.
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:157  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:158  
          MINI XREF LISTING

ADMIN
     11206**DCL     11881<<ASSIGN  11891<>CALL    11891--CALL
ADMIN.FNC
     11272**DCL     11890<<ASSIGN
ADMIN.TERMID_HI
     11321**DCL     11889<<ASSIGN
ADMIN.TERMID_HI.TERM
     11323**DCL     11332--REDEF
ADMIN.TERMID_LO
     11292**DCL     11888<<ASSIGN
ADMIN.TERMID_LO.TERM
     11294**DCL     11303--REDEF
CTX$
     10239**DCL        36--PROC    10736--IMP-PTR 11792>>ASSIGN  11798>>IF      11798>>IF      11798>>IF
     11801>>ASSIGN  11802>>ASSIGN  11802>>ASSIGN  11803>>ASSIGN  11807>>IF      11807>>IF      11813>>IF
     11813>>IF      11822<>CALL    11823<>CALL    11829>>IF      11829>>IF      11841<>CALL    11847>>IF
     11847>>IF      11850>>ASSIGN  11851<>CALL    11851>>CALL    11851>>CALL    11857>>ASSIGN  11858>>ASSIGN
     11859<>CALL    11860>>ASSIGN  11861>>ASSIGN  11869>>IF      11871>>ASSIGN  11879>>ASSIGN  11880<>CALL
     11882>>IF      11882>>IF      11882>>IF      11888>>ASSIGN  11889>>ASSIGN  11891>>CALL    11897>>IF
     11897>>IF      11900>>ASSIGN  11901<>CALL    11901>>CALL    11901>>CALL    11907>>IF      11908<>CALL
FPT_TERM
     11165**DCL     11859--CALL    11859<>CALL
FPT_TERM.COS
     11170**DCL     11858<<ASSIGN
FPT_TERM.RLCID
     11169**DCL     11857<<ASSIGN
GJA$LGNCTX.CHN$
     10762**DCL     11798>>IF      11813>>IF      11829>>IF      11829>>IF      11869>>IF      11871>>ASSIGN
     11882>>IF      11882>>IF      11882>>IF      11891>>CALL    11907>>IF
GJA$LGNCTX.MSG$
     10763**DCL     11798>>IF      11802>>ASSIGN  11803<<ASSIGN  11807>>IF      11847>>IF      11850>>ASSIGN
     11851>>CALL    11851>>CALL    11857>>ASSIGN  11858>>ASSIGN  11879>>ASSIGN  11897>>IF      11900>>ASSIGN
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:159  
     11901>>CALL    11901>>CALL
GJA$LGNCTX.NM_NODE
     10760**DCL     11802<<ASSIGN
GJA$LGNCTX.STATUS.DSCRCV
     10811**DCL     11798>>IF      11807>>IF
GJA$LGNCTX.STATUS.INT
     10809**DCL     11813>>IF      11847>>IF      11897>>IF
GJA$LGNCTX.STATUS.LOGGEDON
     10808**DCL     11861<<ASSIGN
GJA$LGNCTX.STATUS.NMRSP
     10806**DCL     11792<<ASSIGN
GJA$LGNCTX.STATUS.TERMACK
     10807**DCL     11860<<ASSIGN
GJA$LGNCTX.STATUS.WAITING_HOST
     10816**DCL     11801<<ASSIGN
GJA$LGNCTX.TERMINAL_ID
     10785**DCL     11888>>ASSIGN  11889>>ASSIGN
GJA$LGNCTX.TERMINAL_ID.TERM
     10787**DCL     10796--REDEF
GJA$Q_MSG
     11775**DCL-ENT 11822--CALL    11823--CALL    11841--CALL    11859--CALL    11880--CALL
GJA$SEND_MSG
     11774**DCL-ENT 11851--CALL    11891--CALL    11901--CALL
GJA$SINPUT_VDO
     10948**DCL     11816<<ASSIGN  11822<>CALL
GJA$SINPUT_VDO.KV$VDOVLP_DAT2.BYTSIZ
     10999**DCL     11817<<ASSIGN
GJA$SINPUT_VDO.TL.LEN
     11008**DCL     11820<<ASSIGN
GJA$SINPUT_VDO.TL.TYPE
     11007**DCL     11819<<ASSIGN
GJA$SOLICIT_LOGON
     11776**DCL-ENT 11908--CALL
GJA$TRMCTL_VDO
     10550**DCL     11832<<ASSIGN  11835--ASSIGN  11837--ASSIGN  11840--ASSIGN  11841<>CALL
GJA$TRMCTL_VDO.KV$VDOVLP_DAT2.BYTSIZ
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:160  
     10601**DCL     11833<<ASSIGN
GJA$TRMCTL_VDO.TL.LEN
     10610**DCL     11839<<ASSIGN
GJA$TRMCTL_VDO.TL.TYPE
     10609**DCL     11838<<ASSIGN
GJA_ADMIN
     11506**DCL     11881>>ASSIGN
GJA_ADMIN.TERMID_HI.TERM
     11623**DCL     11632--REDEF
GJA_ADMIN.TERMID_LO.TERM
     11594**DCL     11603--REDEF
GJA_PARAM_VDO
     11669**DCL     11816>>ASSIGN  11818--ASSIGN  11821--ASSIGN  11832>>ASSIGN
GJA_RPROMPT_VDO
     11372**DCL     11823--CALL    11823<>CALL
GJA_VLP_TRMCTL
     11451**DCL     11833--ASSIGN  11835>>ASSIGN  11839--ASSIGN  11840--ASSIGN
GJA_VLP_TRMCTL.BREAKCOUNT
     11462**DCL     11463--REDEF
KH$CHN.AUTBAD
     10680**DCL     11882>>IF
KH$CHN.AUTLGN
     10637**DCL     11798>>IF      11813>>IF      11829>>IF      11869>>IF      11907>>IF
KH$CHN.AUTLGNFAILED
     10638**DCL     11871<<ASSIGN
KH$CHN.BRKRQ
     10647**DCL     11882>>IF
KH$CHN.DRCCNC
     10664**DCL     11882>>IF
KH$CHN.ECHLGN
     10685**DCL     11829>>IF
KH$CHN.HAND$
     10733**DCL     11891<>CALL
KH$CHN.TERMID.TERM
     10722**DCL     10731--REDEF
KL$SGNRSP.COS
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:161  
     11140**DCL     11858>>ASSIGN
KL$SGNRSP.ERRCODE.ERR#
     11108**DCL     11798>>IF      11879>>ASSIGN
KL$SGNRSP.ERRCODE.SEV
     11109**DCL     11807>>IF
KL$SGNRSP.MESSAGE
     11142**DCL     11851--CALL    11851--CALL    11901--CALL    11901--CALL
KL$SGNRSP.MESSAGE.RSPSIZ
     11143**DCL     11847>>IF      11850>>ASSIGN  11897>>IF      11900>>ASSIGN
KL$SGNRSP.RLCID
     11049**DCL     11857>>ASSIGN
KL$SGNRSP.RLCID.NODE
     11050**DCL     11802>>ASSIGN
KL$SGNRSP.TERMID.TERM
     11129**DCL     11138--REDEF
KV$VDO_CLSSSN_RQS
     11764**DCL     11880--CALL    11880<>CALL
KV$VDO_CLSSSN_RQS.RSN
     11771**DCL     11879<<ASSIGN
MESSAGE.SIZE
     11147**DCL     11148--IMP-SIZ 11851>>CALL    11901>>CALL
MESSAGE.TEXT
     11148**DCL     11851<>CALL    11901<>CALL
MSGSIZ
     11336**DCL     11821<<ASSIGN  11822<>CALL    11840<<ASSIGN  11841<>CALL    11850<<ASSIGN  11851<>CALL
     11900<<ASSIGN  11901<>CALL
TEMP
     11149**DCL     11818<<ASSIGN
VDO_BUFFER
     11335**DCL     11816--ASSIGN  11817--ASSIGN  11818--ASSIGN  11819--ASSIGN  11820--ASSIGN  11822--CALL
     11832--ASSIGN  11833--ASSIGN  11835--ASSIGN  11837--ASSIGN  11838--ASSIGN  11839--ASSIGN  11841--CALL
VLP$TRMCTL
     10494**DCL     11835<<ASSIGN
VLP$TRMCTL.BREAKCOUNT
     10505**DCL     10506--REDEF
VLP$TRMCTL.DISPINPUT
PL6.E3A0      #003=GJA$LOGON_RESPONCE File=GJA$LOGON.:E05TSI                     TUE 07/29/97 21:52 Page:162  
     10496**DCL     11837<<ASSIGN

PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:163  
      943        1        /*T***********************************************************/
      944        2        /*T*                                                         */
      945        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      946        4        /*T*                                                         */
      947        5        /*T***********************************************************/
      948        6
      949        7        /*F*    NAME:    GJA$DISOLVE_LGNUSR_CTX
      950        8
      951        9                PURPOSE: This routine gets rid of a GJA$LGNCTX block that is
      952       10                         no longer needed.
      953       11
      954       12                DESCRIPTION:  This routine is very simple.  It just delinks the
      955       13                              context block and calls the buddy space manager
      956       14                              to give the space back.
      957       15
      958       16                CALL:  CALL GJA$DISOLVE_LGNUSR_CTX(CTX$)
      959       17
      960       18                INPUT: CTX$ - A pointer to the context block to be disolved.
      961       19        */
      962       20        %EJECT;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:164  
      963       21        GJA$DISOLVE_LGNUSR_CTX: PROC(CTX$);
      964       22
      965       23        %INCLUDE KH$CLK;
      966      393        %INCLUDE KH_CLKFNC_E;
      967      438        %INCLUDE KL_MACRO_C;
      968     3790        %INCLUDE GJA_MSG_M;
      969     4029        %INCLUDE LCP_6;
      970     8308        %INCLUDE KV$VDO;
      971     9323        %INCLUDE KNN_NETWORK_M;
      972     9686                                                /* Args                     */
      973     9687    1   DCL CTX$ PTR;
      974     9688    1   DCL TCTX$ PTR;
      975     9689    1   DCL ROUTE$ PTR;
      976     9690                                                /* Symrefs                  */
      977     9691    1   DCL GJA_USRLGN_HEAD$ PTR SYMREF;
      978     9692    1   DCL GJA_NM_HEAD$ PTR SYMREF;
      979     9693    1   DCL GJA_ERRMSG_HEAD$ PTR SYMREF;
      980     9694    1   DCL GJA_UID_NM UBIN(32) SYMREF;
      981     9695    1   DCL GJA_UID_NM$ REDEF GJA_UID_NM PTR;
      982     9696    1   DCL GJA_LDCT_NM UBIN SYMREF;
      983     9697    1   DCL GJA_HAND_HEAD$ PTR SYMREF;
      984     9698    1   DCL GJA_ROUTE$ PTR SYMREF;
      985     9699    1   DCL GJA_MSG_DOWN$ PTR SYMREF;
      986     9700    1   DCL GJA_MSG_HOSTDOWN$ PTR SYMREF;
      987     9701    1   DCL GJA_MSG_LINKDOWN$ PTR SYMREF;
      988     9702                                                /* Static                   */
      989     9703        %KH$CLK (FPTN=CANCEL_CLK,
      990     9704                  STCLASS=STATIC,
      991     9705                  FNC=%KH#CLK_CANCEL,
      992     9706                  VDH_CLK=NO,
      993     9707                  NO_CTB=YES,
      994     9708                  PERM=NO,
      995     9709                  PRDUNT=KH#C_MIN,
      996     9710                  PRD=0);
      997     9859                                                /* Based                    */
      998     9860        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
      999     9945        %GJA$HAND_CTX(STCLASS="BASED(CTX$)");
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:165  
     1000     9994        %GJA$ERRMSG_CTX(STCLASS="BASED(CTX$)");
     1001    10022    1   DCL KNN$ROUTE$(0:0) PTR BASED(GJA_ROUTE$);
     1002    10023        %KNN$ROUTE(STCLASS="BASED(ROUTE$)");
     1003    10095    1   DCL 1 SV$MSG BASED,
     1004    10096    1         2 BFRSIZ UBIN,
     1005    10097    1         2 NXT$ PTR;
     1006    10098        %KV_VDO_E;
     1007    10134        %KV_DATMOD_E;
     1008    10140        %GJA_UID_EQUS;
     1009    10148        %KV$VDO_RQSDAT(NAME=KV_VDO_RQSDAT,MAXRCRBYTSIZ=2048,
     1010    10149                       MAXNMBRCR=999,MAXNMBBYT=2048,STCLASS=STATIC);
     1011    10197                                                /* AUTO Storage             */
     1012    10198    1   DCL NXT$ PTR;
     1013    10199                                                /* Entrys                   */
     1014    10200    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
     1015    10201    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
     1016    10202    1   DCL GJA$Q_MSG ENTRY(6);
     1017    10203        %EJECT;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:166  
     1018    10204
     1019    10205        /* Cancel any clock */
     1020    10206    1      CANCEL_CLK.UID$ = CTX$;
     1021    10207    1      CALL KHC$CLOCK(CANCEL_CLK);
     1022    10208
     1023    10209    1      IF CTX$ = GJA_USRLGN_HEAD$
     1024    10210    1      THEN GJA_USRLGN_HEAD$ = GJA$LGNCTX.LNK$;
     1025    10211    1      ELSE
     1026    10212    2   DELINK: DO;
     1027    10213    2           NXT$=GJA_USRLGN_HEAD$;
     1028    10214    3           DO WHILE (NXT$ ~= ADDR(NIL));
     1029    10215    3                IF NXT$->GJA$LGNCTX.LNK$ = CTX$
     1030    10216    4                THEN DO;
     1031    10217    4                     NXT$->GJA$LGNCTX.LNK$=CTX$->GJA$LGNCTX.LNK$;
     1032    10218    4                     EXIT DELINK;
     1033    10219    4                     END;
     1034    10220    3                NXT$=NXT$->GJA$LGNCTX.LNK$;
     1035    10221    3                END;
     1036    10222    2           CALL M$XXX;
     1037    10223    2           END;
     1038    10224
     1039    10225    1      CALL KVB$RLSSYS(SIZEW(GJA$LGNCTX),CTX$);
     1040    10226    1      CTX$=ADDR(NIL);
     1041    10227    1      RETURN;
     1042    10228        %EJECT;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:167  
     1043    10229    1   GJA$DISOLVE_NA: ENTRY(CTX$);
     1044    10230
     1045    10231    1      IF CTX$ = GJA_NM_HEAD$
     1046    10232    1      THEN
     1047    10233    1           GJA_NM_HEAD$ = GJA$HAND_CTX.LNK$;
     1048    10234    2      ELSE DO;
     1049    10235    2           NXT$ = GJA_NM_HEAD$;
     1050    10236    3           DO WHILE (NXT$ ~= ADDR(NIL));
     1051    10237    3                IF NXT$->GJA$HAND_CTX.LNK$ = CTX$
     1052    10238    4                THEN DO;
     1053    10239    4                     NXT$->GJA$HAND_CTX.LNK$ = CTX$->GJA$HAND_CTX.LNK$;
     1054    10240    4                     GOTO DELINKED;
     1055    10241    4                     END;
     1056    10242    3                NXT$ = NXT$->GJA$HAND_CTX.LNK$;
     1057    10243    3                END;
     1058    10244    2           CALL M$XXX;
     1059    10245    2           END;
     1060    10246
     1061    10247    1   DELINKED: ;
     1062    10248    1      TCTX$ = CTX$->GJA$HAND_CTX.WAITING_MSG$;
     1063    10249    2      DO WHILE (TCTX$ ~= ADDR(NIL));
     1064    10250    2           NXT$ = TCTX$->SV$MSG.NXT$;
     1065    10251    2           CALL KVB$RLSSYS(TCTX$->SV$MSG);
     1066    10252    2           TCTX$=NXT$;
     1067    10253    2           END;
     1068    10254    1      ROUTE$ = KNN$ROUTE$(CTX$->GJA$HAND_CTX.NODE);
     1069    10255    1      KNN$ROUTE.CTX$ = ADDR(NIL);
     1070    10256    1      IF GJA$HAND_CTX.LDCTX = GJA_LDCT_NM THEN
     1071    10257    2      DO;
     1072    10258        /*
     1073    10259                if the link is still active then this is a transport
     1074    10260                disconnect.   The node should be considered active
     1075    10261                until a linkdown is reported
     1076    10262        */
     1077    10263    2           IF KNN$ROUTE.CURRENT_QOS ~= 255 THEN
     1078    10264    2                GJA_MSG_DOWN$ = GJA_MSG_LINKDOWN$;
     1079    10265    2           TCTX$ = GJA_HAND_HEAD$;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:168  
     1080    10266    3           DO WHILE (TCTX$ ~= ADDR(NIL));
     1081    10267    3                IF TCTX$->GJA$HAND_CTX.WHO = %GJA_UID_HANDLER AND
     1082    10268    3                  TCTX$->GJA$HAND_CTX.BLK
     1083    10269    4                THEN DO;
     1084    10270    4                     CALL GJA$Q_MSG ( TCTX$,LENGTHC(KV_VDO_RQSDAT),KV_VDO_RQSDAT);
     1085    10271    4                     TCTX$->GJA$HAND_CTX.BLK = '0'B;
     1086    10272    4                     END;
     1087    10273    3                TCTX$ = TCTX$->GJA$HAND_CTX.LNK$;
     1088    10274    3                END;
     1089    10275    2           END;
     1090    10276    1      CALL KVB$RLSSYS(SIZEW(GJA$HAND_CTX),CTX$);
     1091    10277    1      CTX$ = ADDR(NIL);
     1092    10278    1      RETURN;
     1093    10279
     1094    10280        %EJECT;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:169  
     1095    10281    1   GJA$DISOLVE_ERRMSG_CTX: ENTRY(CTX$);
     1096    10282
     1097    10283    1      IF CTX$ = GJA_ERRMSG_HEAD$
     1098    10284    2      THEN DO;
     1099    10285    2           GJA_ERRMSG_HEAD$ = GJA$ERRMSG_CTX.LNK$;
     1100    10286    2           NXT$ = GJA_ERRMSG_HEAD$;
     1101    10287    2           END;
     1102    10288    2      ELSE DO;
     1103    10289    2           NXT$ = GJA_ERRMSG_HEAD$;
     1104    10290    3           DO WHILE (NXT$ ~= ADDR(NIL));
     1105    10291    3                IF NXT$->GJA$ERRMSG_CTX.LNK$ = CTX$
     1106    10292    4                THEN DO;
     1107    10293    4                     NXT$->GJA$ERRMSG_CTX.LNK$ = CTX$->GJA$HAND_CTX.LNK$;
     1108    10294    4                     GOTO ERRMSG_DELINKED;
     1109    10295    4                     END;
     1110    10296    3                NXT$ = NXT$->GJA$ERRMSG_CTX.LNK$;
     1111    10297    3                END;
     1112    10298    2           CALL M$XXX;
     1113    10299    2           END;
     1114    10300
     1115    10301    1   ERRMSG_DELINKED: ;
     1116    10302    1      CALL KVB$RLSSYS(SIZEW(GJA$ERRMSG_CTX),CTX$);
     1117    10303    1      CTX$ = NXT$;                    /*return the next in the chain*/
     1118    10304    1      RETURN;
     1119    10305
     1120    10306    1   END;
     1121    10307        %EOD;

PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:170  
--  Include file information  --

   KNN_NETWORK_M.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$DISOLVE_LGNUSR_CTX.

   Procedure GJA$DISOLVE_LGNUSR_CTX requires 368 words for executable code.
   Procedure GJA$DISOLVE_LGNUSR_CTX requires 18 words of local(AUTO) storage.

PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:171  

 Object Unit name= GJA$DISOLVE_LGNUSR_CTX                     File name= GJA$LOGON.:E05TOU
 UTS= JUL 29 '97 21:52:47.72 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none    13      D  GJA$DISOLVE_LGNUSR_CTX
    1   Proc  even  none   368    170  GJA$DISOLVE_LGNUSR_CTX
    2  RoData even  none     2      2  GJA$DISOLVE_LGNUSR_CTX

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  GJA$DISOLVE_LGNUSR_CTX
     1     5C                  yes      Std        1  GJA$DISOLVE_NA
     1    122                  yes      Std        1  GJA$DISOLVE_ERRMSG_CTX

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KHC$CLOCK
 yes     yes           Std       2 KVB$RLSSYS
         yes           Std       6 GJA$Q_MSG
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:172  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     GJA_USRLGN_HEAD$                      GJA_NM_HEAD$                          GJA_ERRMSG_HEAD$
     GJA_UID_NM                            GJA_LDCT_NM                           GJA_HAND_HEAD$
     GJA_ROUTE$                            GJA_MSG_DOWN$                         GJA_MSG_LINKDOWN$
r    G$ROS$
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:173  


      943        1        /*T***********************************************************/
      944        2        /*T*                                                         */
      945        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      946        4        /*T*                                                         */
      947        5        /*T***********************************************************/
      948        6
      949        7        /*F*    NAME:    GJA$DISOLVE_LGNUSR_CTX
      950        8
      951        9                PURPOSE: This routine gets rid of a GJA$LGNCTX block that is
      952       10                         no longer needed.
      953       11
      954       12                DESCRIPTION:  This routine is very simple.  It just delinks the
      955       13                              context block and calls the buddy space manager
      956       14                              to give the space back.
      957       15
      958       16                CALL:  CALL GJA$DISOLVE_LGNUSR_CTX(CTX$)
      959       17
      960       18                INPUT: CTX$ - A pointer to the context block to be disolved.
      961       19        */
      962       20        %EJECT;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:174  
      963       21        GJA$DISOLVE_LGNUSR_CTX: PROC(CTX$);

     21   1 000000  D380 0000 0000  xent GJA$DISOLVE_LGN*LNJ,B5   X6A_AUTO_1
          1 000003       0012 0001                       DC       18,1

      964       22
      965       23        %INCLUDE KH$CLK;
      966      393        %INCLUDE KH_CLKFNC_E;
      967      438        %INCLUDE KL_MACRO_C;
      968     3790        %INCLUDE GJA_MSG_M;
      969     4029        %INCLUDE LCP_6;
      970     8308        %INCLUDE KV$VDO;
      971     9323        %INCLUDE KNN_NETWORK_M;
      972     9686                                                /* Args                     */
      973     9687    1   DCL CTX$ PTR;
      974     9688    1   DCL TCTX$ PTR;
      975     9689    1   DCL ROUTE$ PTR;
      976     9690                                                /* Symrefs                  */
      977     9691    1   DCL GJA_USRLGN_HEAD$ PTR SYMREF;
      978     9692    1   DCL GJA_NM_HEAD$ PTR SYMREF;
      979     9693    1   DCL GJA_ERRMSG_HEAD$ PTR SYMREF;
      980     9694    1   DCL GJA_UID_NM UBIN(32) SYMREF;
      981     9695    1   DCL GJA_UID_NM$ REDEF GJA_UID_NM PTR;
      982     9696    1   DCL GJA_LDCT_NM UBIN SYMREF;
      983     9697    1   DCL GJA_HAND_HEAD$ PTR SYMREF;
      984     9698    1   DCL GJA_ROUTE$ PTR SYMREF;
      985     9699    1   DCL GJA_MSG_DOWN$ PTR SYMREF;
      986     9700    1   DCL GJA_MSG_HOSTDOWN$ PTR SYMREF;
      987     9701    1   DCL GJA_MSG_LINKDOWN$ PTR SYMREF;
      988     9702                                                /* Static                   */
      989     9703        %KH$CLK (FPTN=CANCEL_CLK,
      990     9704                  STCLASS=STATIC,
      991     9705                  FNC=%KH#CLK_CANCEL,
      992     9706                  VDH_CLK=NO,
      993     9707                  NO_CTB=YES,
      994     9708                  PERM=NO,
      995     9709                  PRDUNT=KH#C_MIN,
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:175  
      996     9710                  PRD=0);
      997     9859                                                /* Based                    */
      998     9860        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
      999     9945        %GJA$HAND_CTX(STCLASS="BASED(CTX$)");
     1000     9994        %GJA$ERRMSG_CTX(STCLASS="BASED(CTX$)");
     1001    10022    1   DCL KNN$ROUTE$(0:0) PTR BASED(GJA_ROUTE$);
     1002    10023        %KNN$ROUTE(STCLASS="BASED(ROUTE$)");
     1003    10095    1   DCL 1 SV$MSG BASED,
     1004    10096    1         2 BFRSIZ UBIN,
     1005    10097    1         2 NXT$ PTR;
     1006    10098        %KV_VDO_E;
     1007    10134        %KV_DATMOD_E;
     1008    10140        %GJA_UID_EQUS;
     1009    10148        %KV$VDO_RQSDAT(NAME=KV_VDO_RQSDAT,MAXRCRBYTSIZ=2048,
     1010    10149                       MAXNMBRCR=999,MAXNMBBYT=2048,STCLASS=STATIC);
     1011    10197                                                /* AUTO Storage             */
     1012    10198    1   DCL NXT$ PTR;
     1013    10199                                                /* Entrys                   */
     1014    10200    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
     1015    10201    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
     1016    10202    1   DCL GJA$Q_MSG ENTRY(6);
     1017    10203        %EJECT;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:176  
     1018    10204
     1019    10205        /* Cancel any clock */
     1020    10206    1      CANCEL_CLK.UID$ = CTX$;

  10206   1 000005  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000007  DC86                                 LDB,B5   ,B6
          1 000008  DF80 0000 0002  00                   STB,B5   CANCEL_CLK+2

     1021    10207    1      CALL KHC$CLOCK(CANCEL_CLK);

  10207   1 00000B  BB80 0000 0000  02                   LAB,B3   0
          1 00000E  CBF0 0100                            LAB,B4   256,IMO
          1 000010  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          1 000013       0001                            DC       s:10209,PREL

     1022    10208
     1023    10209    1      IF CTX$ = GJA_USRLGN_HEAD$

  10209   1 000014  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000016  DC86                                 LDB,B5   ,B6
          1 000017  DD80 0000 0000  xsym                 CMB,B5   GJA_USRLGN_HEAD$
          1 00001A  0981 0008                            BNE      s:10212,PREL

     1024    10210    1      THEN GJA_USRLGN_HEAD$ = GJA$LGNCTX.LNK$;

  10210   1 00001C  CCC5 0001                            LDB,B4   1,B5
          1 00001E  CF80 0000 0000  xsym                 STB,B4   GJA_USRLGN_HEAD$
          1 000021  0F81 0021                            B        s:10225,PREL

     1025    10211    1      ELSE
     1026    10212    2   DELINK: DO;

  10212   1                              DELINK          null
     1027    10213    2           NXT$=GJA_USRLGN_HEAD$;

  10213   1 000023  CC80 0000 0000  xsym DELINK          LDB,B4   GJA_USRLGN_HEAD$
          1 000026  CFC7 000A                            STB,B4   NXT$,AUTO
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:177  

     1028    10214    3           DO WHILE (NXT$ ~= ADDR(NIL));

  10214   1 000028  0F81 0013                            B        s:10221,PREL

     1029    10215    3                IF NXT$->GJA$LGNCTX.LNK$ = CTX$

  10215   1 00002A  ECC7 000A                            LDB,B6   NXT$,AUTO
          1 00002C  DCC6 0001                            LDB,B5   1,B6
          1 00002E  CCC7 0004                            LDB,B4   @CTX$,AUTO
          1 000030  DD84                                 CMB,B5   ,B4
          1 000031  0981 0008                            BNE      s:10220,PREL

     1030    10216    4                THEN DO;

     1031    10217    4                     NXT$->GJA$LGNCTX.LNK$=CTX$->GJA$LGNCTX.LNK$;

  10217   1 000033  BC84                                 LDB,B3   ,B4
          1 000034  ACC3 0001                            LDB,B2   1,B3
          1 000036  AFC6 0001                            STB,B2   1,B6

     1032    10218    4                     EXIT DELINK;

  10218   1 000038  0F81 000A                            B        s:10225,PREL

     1033    10219    4                     END;
     1034    10220    3                NXT$=NXT$->GJA$LGNCTX.LNK$;

  10220   1 00003A  DFC7 000A                            STB,B5   NXT$,AUTO

     1035    10221    3                END;

  10221   1 00003C  8DC7 000A                            CMN      NXT$,AUTO
          1 00003E  09EC                                 BNE      s:10215,SPREL

     1036    10222    2           CALL M$XXX;

PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:178  
  10222   1 00003F  B870 0082                            LDR,R3   130,IMO
          1 000041  0001                                 MCL
          1 000042       0000                            DC       s:10222+3,PREL

     1037    10223    2           END;

     1038    10224
     1039    10225    1      CALL KVB$RLSSYS(SIZEW(GJA$LGNCTX),CTX$);

  10225   1 000043  EBF0 0021                            LAB,B6   33,IMO
          1 000045  DCC7 0004                            LDB,B5   @CTX$,AUTO
          1 000047  DFC7 000E                            STB,B5   NXT$+4,AUTO
          1 000049  EFC7 000C                            STB,B6   NXT$+2,AUTO
          1 00004B  BBC7 000C                            LAB,B3   NXT$+2,AUTO
          1 00004D  CBF0 0200                            LAB,B4   512,IMO
          1 00004F  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000052       0001                            DC       s:10226,PREL

     1040    10226    1      CTX$=ADDR(NIL);

  10226   1 000053  EB80 0000 0000                       LAB,B6   0
          1 000056  DCC7 0004                            LDB,B5   @CTX$,AUTO
          1 000058  EF85                                 STB,B6   ,B5

     1041    10227    1      RETURN;

  10227   1 000059  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1042    10228        %EJECT;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:179  
     1043    10229    1   GJA$DISOLVE_NA: ENTRY(CTX$);

  10229   1 00005C  D380 0000 0000  xent GJA$DISOLVE_NA  LNJ,B5   X6A_AUTO_1
          1 00005F       0012 0001                       DC       18,1

     1044    10230
     1045    10231    1      IF CTX$ = GJA_NM_HEAD$

  10231   1 000061  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000063  DC86                                 LDB,B5   ,B6
          1 000064  DD80 0000 0000  xsym                 CMB,B5   GJA_NM_HEAD$
          1 000067  0981 0008                            BNE      s:10235,PREL

     1046    10232    1      THEN
     1047    10233    1           GJA_NM_HEAD$ = GJA$HAND_CTX.LNK$;

  10233   1 000069  CCC5 0001                            LDB,B4   1,B5
          1 00006B  CF80 0000 0000  xsym                 STB,B4   GJA_NM_HEAD$
          1 00006E  0F81 0021                            B        s:10245,PREL

     1048    10234    2      ELSE DO;

     1049    10235    2           NXT$ = GJA_NM_HEAD$;

  10235   1 000070  CC80 0000 0000  xsym                 LDB,B4   GJA_NM_HEAD$
          1 000073  CFC7 000A                            STB,B4   NXT$,AUTO

     1050    10236    3           DO WHILE (NXT$ ~= ADDR(NIL));

  10236   1 000075  0F81 0013                            B        s:10243,PREL

     1051    10237    3                IF NXT$->GJA$HAND_CTX.LNK$ = CTX$

  10237   1 000077  ECC7 000A                            LDB,B6   NXT$,AUTO
          1 000079  DCC6 0001                            LDB,B5   1,B6
          1 00007B  CCC7 0004                            LDB,B4   @CTX$,AUTO
          1 00007D  DD84                                 CMB,B5   ,B4
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:180  
          1 00007E  0981 0008                            BNE      s:10242,PREL

     1052    10238    4                THEN DO;

     1053    10239    4                     NXT$->GJA$HAND_CTX.LNK$ = CTX$->GJA$HAND_CTX.LNK$;

  10239   1 000080  BC84                                 LDB,B3   ,B4
          1 000081  ACC3 0001                            LDB,B2   1,B3
          1 000083  AFC6 0001                            STB,B2   1,B6

     1054    10240    4                     GOTO DELINKED;

  10240   1 000085  0F81 000A                            B        s:10245,PREL

     1055    10241    4                     END;
     1056    10242    3                NXT$ = NXT$->GJA$HAND_CTX.LNK$;

  10242   1 000087  DFC7 000A                            STB,B5   NXT$,AUTO

     1057    10243    3                END;

  10243   1 000089  8DC7 000A                            CMN      NXT$,AUTO
          1 00008B  09EC                                 BNE      s:10237,SPREL

     1058    10244    2           CALL M$XXX;

  10244   1 00008C  B870 0082                            LDR,R3   130,IMO
          1 00008E  0001                                 MCL
          1 00008F       0000                            DC       s:10244+3,PREL

     1059    10245    2           END;

  10240   1                              DELINKED        null
     1060    10246
     1061    10247    1   DELINKED: ;
     1062    10248    1      TCTX$ = CTX$->GJA$HAND_CTX.WAITING_MSG$;

PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:181  
  10248   1 000090  ECC7 0004            DELINKED        LDB,B6   @CTX$,AUTO
          1 000092  DC86                                 LDB,B5   ,B6
          1 000093  CCC5 0007                            LDB,B4   7,B5
          1 000095  CFC7 0006                            STB,B4   TCTX$,AUTO

     1063    10249    2      DO WHILE (TCTX$ ~= ADDR(NIL));

  10249   1 000097  0F81 0013                            B        s:10253,PREL

     1064    10250    2           NXT$ = TCTX$->SV$MSG.NXT$;

  10250   1 000099  ECC7 0006                            LDB,B6   TCTX$,AUTO
          1 00009B  DCC6 0001                            LDB,B5   1,B6
          1 00009D  DFC7 000A                            STB,B5   NXT$,AUTO

     1065    10251    2           CALL KVB$RLSSYS(TCTX$->SV$MSG);

  10251   1 00009F  BBC7 0006                            LAB,B3   TCTX$,AUTO
          1 0000A1  CBF0 0100                            LAB,B4   256,IMO
          1 0000A3  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 0000A6       0001                            DC       s:10252,PREL

     1066    10252    2           TCTX$=NXT$;

  10252   1 0000A7  ECC7 000A                            LDB,B6   NXT$,AUTO
          1 0000A9  EFC7 0006                            STB,B6   TCTX$,AUTO

     1067    10253    2           END;

  10253   1 0000AB  8DC7 0006                            CMN      TCTX$,AUTO
          1 0000AD  09EC                                 BNE      s:10250,SPREL

     1068    10254    1      ROUTE$ = KNN$ROUTE$(CTX$->GJA$HAND_CTX.NODE);

  10254   1 0000AE  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 0000B0  DC86                                 LDB,B5   ,B6
          1 0000B1  B845 000D                            LDR,R3   13,B5
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:182  
          1 0000B3  B570 00FF                            AND,R3   255,IMO
          1 0000B5  CC80 0000 0000  xsym                 LDB,B4   GJA_ROUTE$
          1 0000B8  BCB4                                 LDB,B3   ,B4,R3
          1 0000B9  BFC7 0008                            STB,B3   ROUTE$,AUTO

     1069    10255    1      KNN$ROUTE.CTX$ = ADDR(NIL);

  10255   1 0000BB  AB80 0000 0000                       LAB,B2   0
          1 0000BE  AFC3 0002                            STB,B2   2,B3

     1070    10256    1      IF GJA$HAND_CTX.LDCTX = GJA_LDCT_NM THEN

  10256   1 0000C0  DC86                                 LDB,B5   ,B6
          1 0000C1  E805                                 LDR,R6   ,B5
          1 0000C2  E570 1FFF                            AND,R6   8191,IMO
          1 0000C4  E900 0000 0000  xsym                 CMR,R6   GJA_LDCT_NM
          1 0000C7  0981 0041                            BNE      s:10276,PREL

     1071    10257    2      DO;

     1072    10258        /*
     1073    10259                if the link is still active then this is a transport
     1074    10260                disconnect.   The node should be considered active
     1075    10261                until a linkdown is reported
     1076    10262        */
     1077    10263    2           IF KNN$ROUTE.CURRENT_QOS ~= 255 THEN

  10263   1 0000C9  D843 0005                            LDR,R5   5,B3
          1 0000CB  D970 00FF                            CMR,R5   255,IMO
          1 0000CD  0901 0007                            BE       s:10265,PREL

     1078    10264    2                GJA_MSG_DOWN$ = GJA_MSG_LINKDOWN$;

  10264   1 0000CF  9C80 0000 0000  xsym                 LDB,B1   GJA_MSG_LINKDOWN$
          1 0000D2  9F80 0000 0000  xsym                 STB,B1   GJA_MSG_DOWN$

     1079    10265    2           TCTX$ = GJA_HAND_HEAD$;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:183  

  10265   1 0000D5  DC80 0000 0000  xsym                 LDB,B5   GJA_HAND_HEAD$
          1 0000D8  DFC7 0006                            STB,B5   TCTX$,AUTO

     1080    10266    3           DO WHILE (TCTX$ ~= ADDR(NIL));

  10266   1 0000DA  0F81 002B                            B        s:10274,PREL

     1081    10267    3                IF TCTX$->GJA$HAND_CTX.WHO = %GJA_UID_HANDLER AND

  10267   1 0000DC  ECC7 0006                            LDB,B6   TCTX$,AUTO
          1 0000DE  E806                                 LDR,R6   ,B6
          1 0000DF  604D                                 SOR,R6   13
          1 0000E0  6D03                                 CMV,R6   3
          1 0000E1  0981 0020                            BNE      s:10273,PREL
          1 0000E3  82C6 000D                            LB,'1000'X        13,B6
          1 0000E5       1000
          1 0000E6  0581 001B                            BBF      s:10273,PREL

     1082    10268    3                  TCTX$->GJA$HAND_CTX.BLK
     1083    10269    4                THEN DO;

     1084    10270    4                     CALL GJA$Q_MSG ( TCTX$,LENGTHC(KV_VDO_RQSDAT),KV_VDO_RQSDAT);

  10270   1 0000E8  DBF0 000A                            LAB,B5   10,IMO
          1 0000EA  CB80 0000 0008  00                   LAB,B4   KV_VDO_RQSDAT
          1 0000ED  CFC7 0010                            STB,B4   NXT$+6,AUTO
          1 0000EF  DFC7 000E                            STB,B5   NXT$+4,AUTO
          1 0000F1  BBC7 0006                            LAB,B3   TCTX$,AUTO
          1 0000F3  BFC7 000C                            STB,B3   NXT$+2,AUTO
          1 0000F5  BBC7 000C                            LAB,B3   NXT$+2,AUTO
          1 0000F7  CBF0 0300                            LAB,B4   768,IMO
          1 0000F9  E380 0000 0000  xent                 LNJ,B6   GJA$Q_MSG
          1 0000FC       0001                            DC       s:10271,PREL

     1085    10271    4                     TCTX$->GJA$HAND_CTX.BLK = '0'B;

PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:184  
  10271   1 0000FD  ECC7 0006                            LDB,B6   TCTX$,AUTO
          1 0000FF  8846 000D                            LBF,'1000'X       13,B6
          1 000101       1000

     1086    10272    4                     END;

     1087    10273    3                TCTX$ = TCTX$->GJA$HAND_CTX.LNK$;

  10273   1 000102  DCC6 0001                            LDB,B5   1,B6
          1 000104  DFC7 0006                            STB,B5   TCTX$,AUTO

     1088    10274    3                END;

  10274   1 000106  8DC7 0006                            CMN      TCTX$,AUTO
          1 000108  09D4                                 BNE      s:10267,SPREL

     1089    10275    2           END;

     1090    10276    1      CALL KVB$RLSSYS(SIZEW(GJA$HAND_CTX),CTX$);

  10276   1 000109  EBF0 0011                            LAB,B6   17,IMO
          1 00010B  DCC7 0004                            LDB,B5   @CTX$,AUTO
          1 00010D  DFC7 000E                            STB,B5   NXT$+4,AUTO
          1 00010F  EFC7 000C                            STB,B6   NXT$+2,AUTO
          1 000111  BBC7 000C                            LAB,B3   NXT$+2,AUTO
          1 000113  CBF0 0200                            LAB,B4   512,IMO
          1 000115  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000118       0001                            DC       s:10277,PREL

     1091    10277    1      CTX$ = ADDR(NIL);

  10277   1 000119  EB80 0000 0000                       LAB,B6   0
          1 00011C  DCC7 0004                            LDB,B5   @CTX$,AUTO
          1 00011E  EF85                                 STB,B6   ,B5

     1092    10278    1      RETURN;

PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:185  
  10278   1 00011F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1093    10279
     1094    10280        %EJECT;
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:186  
     1095    10281    1   GJA$DISOLVE_ERRMSG_CTX: ENTRY(CTX$);

  10281   1 000122  D380 0000 0000  xent GJA$DISOLVE_ERR*LNJ,B5   X6A_AUTO_1
          1 000125       0012 0001                       DC       18,1

     1096    10282
     1097    10283    1      IF CTX$ = GJA_ERRMSG_HEAD$

  10283   1 000127  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000129  DC86                                 LDB,B5   ,B6
          1 00012A  DD80 0000 0000  xsym                 CMB,B5   GJA_ERRMSG_HEAD$
          1 00012D  0981 000A                            BNE      s:10289,PREL

     1098    10284    2      THEN DO;

     1099    10285    2           GJA_ERRMSG_HEAD$ = GJA$ERRMSG_CTX.LNK$;

  10285   1 00012F  CCC5 0001                            LDB,B4   1,B5
          1 000131  CF80 0000 0000  xsym                 STB,B4   GJA_ERRMSG_HEAD$

     1100    10286    2           NXT$ = GJA_ERRMSG_HEAD$;

  10286   1 000134  CFC7 000A                            STB,B4   NXT$,AUTO

     1101    10287    2           END;

  10287   1 000136  0F81 0021                            B        s:10299,PREL

     1102    10288    2      ELSE DO;

     1103    10289    2           NXT$ = GJA_ERRMSG_HEAD$;

  10289   1 000138  CC80 0000 0000  xsym                 LDB,B4   GJA_ERRMSG_HEAD$
          1 00013B  CFC7 000A                            STB,B4   NXT$,AUTO

     1104    10290    3           DO WHILE (NXT$ ~= ADDR(NIL));

PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:187  
  10290   1 00013D  0F81 0013                            B        s:10297,PREL

     1105    10291    3                IF NXT$->GJA$ERRMSG_CTX.LNK$ = CTX$

  10291   1 00013F  ECC7 000A                            LDB,B6   NXT$,AUTO
          1 000141  DCC6 0001                            LDB,B5   1,B6
          1 000143  CCC7 0004                            LDB,B4   @CTX$,AUTO
          1 000145  DD84                                 CMB,B5   ,B4
          1 000146  0981 0008                            BNE      s:10296,PREL

     1106    10292    4                THEN DO;

     1107    10293    4                     NXT$->GJA$ERRMSG_CTX.LNK$ = CTX$->GJA$HAND_CTX.LNK$;

  10293   1 000148  BC84                                 LDB,B3   ,B4
          1 000149  ACC3 0001                            LDB,B2   1,B3
          1 00014B  AFC6 0001                            STB,B2   1,B6

     1108    10294    4                     GOTO ERRMSG_DELINKED;

  10294   1 00014D  0F81 000A                            B        s:10299,PREL

     1109    10295    4                     END;
     1110    10296    3                NXT$ = NXT$->GJA$ERRMSG_CTX.LNK$;

  10296   1 00014F  DFC7 000A                            STB,B5   NXT$,AUTO

     1111    10297    3                END;

  10297   1 000151  8DC7 000A                            CMN      NXT$,AUTO
          1 000153  09EC                                 BNE      s:10291,SPREL

     1112    10298    2           CALL M$XXX;

  10298   1 000154  B870 0082                            LDR,R3   130,IMO
          1 000156  0001                                 MCL
          1 000157       0000                            DC       s:10298+3,PREL
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:188  

     1113    10299    2           END;

  10293   1                              ERRMSG_DELINKED null
     1114    10300
     1115    10301    1   ERRMSG_DELINKED: ;
     1116    10302    1      CALL KVB$RLSSYS(SIZEW(GJA$ERRMSG_CTX),CTX$);

  10302   1 000158  EBF0 000A            ERRMSG_DELINKED LAB,B6   10,IMO
          1 00015A  DCC7 0004                            LDB,B5   @CTX$,AUTO
          1 00015C  DFC7 000E                            STB,B5   NXT$+4,AUTO
          1 00015E  EFC7 000C                            STB,B6   NXT$+2,AUTO
          1 000160  BBC7 000C                            LAB,B3   NXT$+2,AUTO
          1 000162  CBF0 0200                            LAB,B4   512,IMO
          1 000164  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000167       0001                            DC       s:10303,PREL

     1117    10303    1      CTX$ = NXT$;                    /*return the next in the chain*/

  10303   1 000168  ECC7 000A                            LDB,B6   NXT$,AUTO
          1 00016A  DCC7 0004                            LDB,B5   @CTX$,AUTO
          1 00016C  EF85                                 STB,B6   ,B5

     1118    10304    1      RETURN;

  10304   1 00016D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1119    10305
     1120    10306    1   END;
     1121    10307        %EOD;

PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:189  
--  Include file information  --

   KNN_NETWORK_M.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$DISOLVE_LGNUSR_CTX.
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:190  

 **** Variables and constants ****

  ****  Section 000  Data  GJA$DISOLVE_LGNUSR_CTX

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(128)   r     1 CANCEL_CLK                 8-0-0/w STRC(80)    r     1 KV_VDO_RQSDAT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @CTX$                     *0-0-0/w PTR         r     1 CTX$
     A-0-0/w PTR         r     1 NXT$                       8-0-0/w PTR         r     1 ROUTE$
     6-0-0/w PTR         r     1 TCTX$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 GJA_ERRMSG_HEAD$           0-0-0/w PTR         r     1 GJA_HAND_HEAD$
     0-0-0/w UBIN(16)    r     1 GJA_LDCT_NM                0-0-0/w PTR         r     1 GJA_MSG_DOWN$
     0-0-0/w PTR         r     1 GJA_MSG_LINKDOWN$          0-0-0/w PTR         r     1 GJA_NM_HEAD$
     0-0-0/w PTR         r     1 GJA_ROUTE$                 0-0-0/w PTR         r     1 GJA_USRLGN_HEAD$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(160)   r     1 GJA$ERRMSG_CTX             0-0-0/c STRC(272)   r     1 GJA$HAND_CTX
     0-0-0/w STRC(528)   r     1 GJA$LGNCTX                 0-0-0/w STRC(208)   r     1 KNN$ROUTE
     0-0-0/w PTR         r     1 KNN$ROUTE$(0:0)
     0-0-0/w STRC(48)    r     1 SV$MSG
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:191  


   Procedure GJA$DISOLVE_LGNUSR_CTX requires 368 words for executable code.
   Procedure GJA$DISOLVE_LGNUSR_CTX requires 18 words of local(AUTO) storage.
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:192  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:193  
          MINI XREF LISTING

CANCEL_CLK
      9724**DCL     10207<>CALL
CANCEL_CLK.UID
      9740**DCL      9741--REDEF    9742--REDEF
CANCEL_CLK.UID$
      9741**DCL     10206<<ASSIGN
CTX$
      9687**DCL        21--PROC     9861--IMP-PTR  9946--IMP-PTR  9995--IMP-PTR 10206>>ASSIGN  10209>>IF
     10210>>ASSIGN  10215>>IF      10217>>ASSIGN  10225<>CALL    10226<<ASSIGN  10229--ENTRY   10231>>IF
     10233>>ASSIGN  10237>>IF      10239>>ASSIGN  10248>>ASSIGN  10254>>ASSIGN  10256>>IF      10276<>CALL
     10277<<ASSIGN  10281--ENTRY   10283>>IF      10285>>ASSIGN  10291>>IF      10293>>ASSIGN  10302<>CALL
     10303<<ASSIGN
DELINK
     10212**LABEL   10218--EXIT
DELINKED
     10240**LABEL   10240--GOTO
ERRMSG_DELINKED
     10293**LABEL   10294--GOTO
GJA$ERRMSG_CTX
      9995**DCL     10302--CALL
GJA$ERRMSG_CTX.LNK$
     10005**DCL     10285>>ASSIGN  10291>>IF      10293<<ASSIGN  10296>>ASSIGN
GJA$HAND_CTX
      9946**DCL     10276--CALL
GJA$HAND_CTX.BLK
      9977**DCL     10267>>IF      10271<<ASSIGN
GJA$HAND_CTX.LDCTX
      9952**DCL     10256>>IF
GJA$HAND_CTX.LNK$
      9956**DCL     10233>>ASSIGN  10237>>IF      10239<<ASSIGN  10239>>ASSIGN  10242>>ASSIGN  10273>>ASSIGN
     10293>>ASSIGN
GJA$HAND_CTX.NODE
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:194  
      9981**DCL     10254>>ASSIGN
GJA$HAND_CTX.WAITING_MSG$
      9968**DCL     10248>>ASSIGN
GJA$HAND_CTX.WHO
      9951**DCL     10267>>IF
GJA$LGNCTX
      9861**DCL     10225--CALL
GJA$LGNCTX.LNK$
      9871**DCL     10210>>ASSIGN  10215>>IF      10217<<ASSIGN  10217>>ASSIGN  10220>>ASSIGN
GJA$LGNCTX.TERMINAL_ID.TERM
      9912**DCL      9921--REDEF
GJA$Q_MSG
     10202**DCL-ENT 10270--CALL
GJA_ERRMSG_HEAD$
      9693**DCL     10283>>IF      10285<<ASSIGN  10286>>ASSIGN  10289>>ASSIGN
GJA_HAND_HEAD$
      9697**DCL     10265>>ASSIGN
GJA_LDCT_NM
      9696**DCL     10256>>IF
GJA_MSG_DOWN$
      9699**DCL     10264<<ASSIGN
GJA_MSG_LINKDOWN$
      9701**DCL     10264>>ASSIGN
GJA_NM_HEAD$
      9692**DCL     10231>>IF      10233<<ASSIGN  10235>>ASSIGN
GJA_ROUTE$
      9698**DCL     10022--IMP-PTR 10254>>ASSIGN
GJA_UID_NM
      9694**DCL      9695--REDEF
GJA_USRLGN_HEAD$
      9691**DCL     10209>>IF      10210<<ASSIGN  10213>>ASSIGN
KHC$CLOCK
     10200**DCL-ENT 10207--CALL
KNN$ROUTE.CTX$
     10031**DCL     10255<<ASSIGN
KNN$ROUTE.CURRENT_QOS
PL6.E3A0      #004=GJA$DISOLVE_LGNUSR_CTX File=GJA$LOGON.:E05TSI                 TUE 07/29/97 21:52 Page:195  
     10042**DCL     10263>>IF
KNN$ROUTE$
     10022**DCL     10254>>ASSIGN
KVB$RLSSYS
     10201**DCL-ENT 10225--CALL    10251--CALL    10276--CALL    10302--CALL
KV_VDO_RQSDAT
     10182**DCL     10270--CALL    10270<>CALL
M$XXX
      8267**DCL-ENT 10222--CALL    10244--CALL    10298--CALL
NXT$
     10198**DCL     10213<<ASSIGN  10214>>DOWHILE 10215>>IF      10217>>ASSIGN  10220<<ASSIGN  10220>>ASSIGN
     10235<<ASSIGN  10236>>DOWHILE 10237>>IF      10239>>ASSIGN  10242<<ASSIGN  10242>>ASSIGN  10250<<ASSIGN
     10252>>ASSIGN  10286<<ASSIGN  10289<<ASSIGN  10290>>DOWHILE 10291>>IF      10293>>ASSIGN  10296<<ASSIGN
     10296>>ASSIGN  10303>>ASSIGN
ROUTE$
      9689**DCL     10024--IMP-PTR 10254<<ASSIGN  10255>>ASSIGN  10263>>IF
SV$MSG
     10095**DCL     10251<>CALL
SV$MSG.NXT$
     10097**DCL     10250>>ASSIGN
TCTX$
      9688**DCL     10248<<ASSIGN  10249>>DOWHILE 10250>>ASSIGN  10251>>CALL    10252<<ASSIGN  10265<<ASSIGN
     10266>>DOWHILE 10267>>IF      10267>>IF      10270<>CALL    10271>>ASSIGN  10273<<ASSIGN  10273>>ASSIGN

PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:196  
     1122        1        /*T***********************************************************/
     1123        2        /*T*                                                         */
     1124        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1125        4        /*T*                                                         */
     1126        5        /*T***********************************************************/
     1127        6
     1128        7        /*F*   NAME:    GJA$SOLICIT_NM
     1129        8
     1130        9               PURPOSE: This routine is called either when we receive a
     1131       10                        logon string from VDH (really the handler) or when
     1132       11                        an autologged device attempts logon.  It sets up
     1133       12                        an KL_SGN message and sends it to the NM.
     1134       13
     1135       14               DESCRIPTION: This routine follows the following general steps:
     1136       15                            1).  If the device is not autologged, the logon
     1137       16                                 string pointed to by GJA$LGNCTX.MSG$ is
     1138       17                                 merged into the KL_SGN message.  If the
     1139       18                                 device is autologged, the AUTOLGN bit is
     1140       19                                 set in the message.
     1141       20                            2).  The rest of the message is built.
     1142       21                            3).  The message is sent up to the network
     1143       22                                 manager.
     1144       23                            4).  The NMRSP bit is set in context to indicate
     1145       24                                 we are awaiting a responce from the Network
     1146       25                                 manager.
     1147       26                            5).  We return
     1148       27
     1149       28               CALL:   CALL GJA$SOLICIT_NM(CTX$,SIZE)
     1150       29
     1151       30               INPUT:  CTX$ - Points to a GJA$LGNCTX block which tells us
     1152       31                              everything we need to know about the device
     1153       32                              attempting logon.
     1154       33        */
     1155       34        %EJECT;
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:197  
     1156       35        GJA$SOLICIT_NM: PROC(CTX$,SIZE);
     1157       36
     1158       37        %INCLUDE GJA_MSG_M;
     1159      276        %INCLUDE KH$CHN;
     1160      398        %INCLUDE KNH_MACRO_C;
     1161      681        %INCLUDE KL_AFCN_C;                     /* 'IGA' Function Codes     */
     1162      782        %INCLUDE KL_MACRO_C;
     1163     4134        %INCLUDE KV$VDO;
     1164     5149        %INCLUDE KV$GLB;
     1165     5568        %INCLUDE LCP_6;
     1166     9847                                                /* Args                     */
     1167     9848    1   DCL CTX$ PTR;
     1168     9849    1   DCL CTX REDEF CTX$ UBIN(32);
     1169     9850    1   DCL SIZE UBIN;
     1170     9851
     1171     9852                                                /* Necessary VDH macros     */
     1172     9853        %KV_VDO_ALL_E;
     1173     9932
     1174     9933                                                /* BASED Structures         */
     1175     9934    1   DCL 1 LOGON_STRING BASED,
     1176     9935    1         2 STRING CHAR(SIZE) UNAL;
     1177     9936        %KH$CHN (STCLASS=BASED);
     1178    10060        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
     1179    10145        %KV$VDO_DAT(NAME=GJA$VDO_DAT,STCLASS=BASED,LAST=",");
     1180    10190             %KV$VDOVLP_DAT1(STCLASS="",LVL=2);
     1181    10240
     1182    10241        %KL_SGN(FPTN=KL$SGN,STCLASS="BASED(KL$)");
     1183    10334
     1184    10335                                                /* Static                   */
     1185    10336        %KL_SGN(STCLASS=STATIC);
     1186    10429                                                /* AUTO Storage             */
     1187    10430    1   DCL KL$ PTR;
     1188    10431    1   DCL VDO_BUFFER(0:254) CHAR(1) UNAL;
     1189    10432    1   DCL MSGSIZ UBIN;
     1190    10433                                                /* Symrefs                  */
     1191    10434    1   DCL GJA_DEFNODE UBIN SYMREF;
     1192    10435    1   DCL GJA_UID_NM UBIN(32) SYMREF;
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:198  
     1193    10436                                                /* Entrys                   */
     1194    10437    1   DCL GJA$NETWORK_MANAGER ENTRY(2) ALTRET;
     1195    10438
     1196    10439                                                /* EQUs and SUBs            */
     1197    10440        %GJA_UID_EQUS;
     1198    10448
     1199    10449        %EJECT;
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:199  
     1200    10450        /*
     1201    10451          This code just builds the KL_SGN message.  If this is not an
     1202    10452          autologon case, the logon string pointed to by MSG$ is merged into
     1203    10453          KL_SGN, otherwise the AUTOLGN bit is set.  The rest of the message is
     1204    10454          built from fields in GJA$LGNCTX.
     1205    10455        */
     1206    10456    1      GJA$LGNCTX.STATUS.RDPND = '0'B;
     1207    10457    1      KL$=ADDR(VDO_BUFFER);
     1208    10458    1      KL$SGN= KL_SGN;
     1209    10459    1      KL$SGN.TERMINAL_ID=GJA$LGNCTX.TERMINAL_ID;
     1210    10460    1      KL$SGN.USER=GJA$LGNCTX.USER;
     1211    10461    1      KL$SGN.NMID=CTX;
     1212    10462    1      KL$SGN.SPEED=GJA$LGNCTX.SPEED;
     1213    10463    1      KL$SGN.NODE=GJA$LGNCTX.NODE;
     1214    10464    1      KL$SGN.PROFILE = GJA$LGNCTX.CHN$->KH$CHN.PROFILE;
     1215    10465    1      KL$SGN.DEF_NODE = GJA_DEFNODE;
     1216    10466    1      IF GJA$LGNCTX.CHN$->KH$CHN.AUTLGN
     1217    10467    1      THEN KL$SGN.AUTOLGN='1'B;
     1218    10468    2      ELSE DO;
     1219    10469    2           KL$SGN.LOGON.LGNSIZ=SIZE;
     1220    10470    2           ADDR(KL$SGN.LOGON.LGNTXT)->LOGON_STRING.STRING=GJA$LGNCTX.MSG$->LOGON_STRING
             10470                    .STRING;
     1221    10471    2           END;
     1222    10472    1      MSGSIZ=SIZE+SIZEC(KL_SGN);
     1223    10473    2      CALL GJA$NETWORK_MANAGER(KL$SGN,MSGSIZ) WHENRETURN DO;
     1224    10474    2           GJA$LGNCTX.STATUS.NMRSP='1'B;
     1225    10475    2           END;
     1226    10476    2      WHENALTRETURN DO;
     1227    10477    2           GJA$LGNCTX.STATUS.NMRSP='0'B;
     1228    10478    2           END;
     1229    10479    1      GJA$LGNCTX.NM_NODE = GJA_DEFNODE;
     1230    10480    1      RETURN;
     1231    10481    1   END;

PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:200  
--  Include file information  --

   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$SOLICIT_NM.

   Procedure GJA$SOLICIT_NM requires 149 words for executable code.
   Procedure GJA$SOLICIT_NM requires 144 words of local(AUTO) storage.

    No errors detected in file GJA$LOGON.:E05TSI    .

PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:201  

 Object Unit name= GJA$SOLICIT_NM                             File name= GJA$LOGON.:E05TOU
 UTS= JUL 29 '97 21:53:18.68 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none    16     10  GJA$SOLICIT_NM
    1   Proc  even  none   149     95  GJA$SOLICIT_NM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        2  GJA$SOLICIT_NM

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 GJA$NETWORK_MANAGER
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     GJA_DEFNODE                      r    G$ROS$
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:202  


     1122        1        /*T***********************************************************/
     1123        2        /*T*                                                         */
     1124        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1125        4        /*T*                                                         */
     1126        5        /*T***********************************************************/
     1127        6
     1128        7        /*F*   NAME:    GJA$SOLICIT_NM
     1129        8
     1130        9               PURPOSE: This routine is called either when we receive a
     1131       10                        logon string from VDH (really the handler) or when
     1132       11                        an autologged device attempts logon.  It sets up
     1133       12                        an KL_SGN message and sends it to the NM.
     1134       13
     1135       14               DESCRIPTION: This routine follows the following general steps:
     1136       15                            1).  If the device is not autologged, the logon
     1137       16                                 string pointed to by GJA$LGNCTX.MSG$ is
     1138       17                                 merged into the KL_SGN message.  If the
     1139       18                                 device is autologged, the AUTOLGN bit is
     1140       19                                 set in the message.
     1141       20                            2).  The rest of the message is built.
     1142       21                            3).  The message is sent up to the network
     1143       22                                 manager.
     1144       23                            4).  The NMRSP bit is set in context to indicate
     1145       24                                 we are awaiting a responce from the Network
     1146       25                                 manager.
     1147       26                            5).  We return
     1148       27
     1149       28               CALL:   CALL GJA$SOLICIT_NM(CTX$,SIZE)
     1150       29
     1151       30               INPUT:  CTX$ - Points to a GJA$LGNCTX block which tells us
     1152       31                              everything we need to know about the device
     1153       32                              attempting logon.
     1154       33        */
     1155       34        %EJECT;
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:203  
     1156       35        GJA$SOLICIT_NM: PROC(CTX$,SIZE);

     35   1 000000  D380 0000 0000  xent GJA$SOLICIT_NM  LNJ,B5   X6A_AUTO_2
          1 000003       0090 0002                       DC       144,2

     1157       36
     1158       37        %INCLUDE GJA_MSG_M;
     1159      276        %INCLUDE KH$CHN;
     1160      398        %INCLUDE KNH_MACRO_C;
     1161      681        %INCLUDE KL_AFCN_C;                     /* 'IGA' Function Codes     */
     1162      782        %INCLUDE KL_MACRO_C;
     1163     4134        %INCLUDE KV$VDO;
     1164     5149        %INCLUDE KV$GLB;
     1165     5568        %INCLUDE LCP_6;
     1166     9847                                                /* Args                     */
     1167     9848    1   DCL CTX$ PTR;
     1168     9849    1   DCL CTX REDEF CTX$ UBIN(32);
     1169     9850    1   DCL SIZE UBIN;
     1170     9851
     1171     9852                                                /* Necessary VDH macros     */
     1172     9853        %KV_VDO_ALL_E;
     1173     9932
     1174     9933                                                /* BASED Structures         */
     1175     9934    1   DCL 1 LOGON_STRING BASED,
     1176     9935    1         2 STRING CHAR(SIZE) UNAL;
     1177     9936        %KH$CHN (STCLASS=BASED);
     1178    10060        %GJA$LGNCTX(STCLASS="BASED(CTX$)");
     1179    10145        %KV$VDO_DAT(NAME=GJA$VDO_DAT,STCLASS=BASED,LAST=",");
     1180    10190             %KV$VDOVLP_DAT1(STCLASS="",LVL=2);
     1181    10240
     1182    10241        %KL_SGN(FPTN=KL$SGN,STCLASS="BASED(KL$)");
     1183    10334
     1184    10335                                                /* Static                   */
     1185    10336        %KL_SGN(STCLASS=STATIC);
     1186    10429                                                /* AUTO Storage             */
     1187    10430    1   DCL KL$ PTR;
     1188    10431    1   DCL VDO_BUFFER(0:254) CHAR(1) UNAL;
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:204  
     1189    10432    1   DCL MSGSIZ UBIN;
     1190    10433                                                /* Symrefs                  */
     1191    10434    1   DCL GJA_DEFNODE UBIN SYMREF;
     1192    10435    1   DCL GJA_UID_NM UBIN(32) SYMREF;
     1193    10436                                                /* Entrys                   */
     1194    10437    1   DCL GJA$NETWORK_MANAGER ENTRY(2) ALTRET;
     1195    10438
     1196    10439                                                /* EQUs and SUBs            */
     1197    10440        %GJA_UID_EQUS;
     1198    10448
     1199    10449        %EJECT;
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:205  
     1200    10450        /*
     1201    10451          This code just builds the KL_SGN message.  If this is not an
     1202    10452          autologon case, the logon string pointed to by MSG$ is merged into
     1203    10453          KL_SGN, otherwise the AUTOLGN bit is set.  The rest of the message is
     1204    10454          built from fields in GJA$LGNCTX.
     1205    10455        */
     1206    10456    1      GJA$LGNCTX.STATUS.RDPND = '0'B;

  10456   1 000005  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000007  DC86                                 LDB,B5   ,B6
          1 000008  8845 0018                            LBF,'0080'X       24,B5
          1 00000A       0080

     1207    10457    1      KL$=ADDR(VDO_BUFFER);

  10457   1 00000B  DBC7 000A                            LAB,B5   VDO_BUFFER,AUTO
          1 00000D  DFC7 0008                            STB,B5   KL$,AUTO

     1208    10458    1      KL$SGN= KL_SGN;

  10458   1 00000F  AB80 0000 0000  00                   LAB,B2   KL_SGN
          1 000012  2C00                                 LDV,R2   0
          1 000013  6C1F                                 LDV,R6   31
          1 000014  BB85                                 LAB,B3   ,B5
          1 000015  3C00                                 LDV,R3   0
          1 000016  0008                                 MMM

     1209    10459    1      KL$SGN.TERMINAL_ID=GJA$LGNCTX.TERMINAL_ID;

  10459   1 000017  CC86                                 LDB,B4   ,B6
          1 000018  AB84                                 LAB,B2   ,B4
          1 000019  2C1E                                 LDV,R2   30
          1 00001A  6C10                                 LDV,R6   16
          1 00001B  BCC7 0008                            LDB,B3   KL$,AUTO
          1 00001D  3C04                                 LDV,R3   4
          1 00001E  0008                                 MMM

PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:206  
     1210    10460    1      KL$SGN.USER=GJA$LGNCTX.USER;

  10460   1 00001F  BC86                                 LDB,B3   ,B6
          1 000020  AB83                                 LAB,B2   ,B3
          1 000021  2C1C                                 LDV,R2   28
          1 000022  6C02                                 LDV,R6   2
          1 000023  BCC7 0008                            LDB,B3   KL$,AUTO
          1 000025  3C15                                 LDV,R3   21
          1 000026  0008                                 MMM

     1211    10461    1      KL$SGN.NMID=CTX;

  10461   1 000027  AB86                                 LAB,B2   ,B6
          1 000028  2C00                                 LDV,R2   0
          1 000029  6C04                                 LDV,R6   4
          1 00002A  BCC7 0008                            LDB,B3   KL$,AUTO
          1 00002C  3C17                                 LDV,R3   23
          1 00002D  0008                                 MMM

     1212    10462    1      KL$SGN.SPEED=GJA$LGNCTX.SPEED;

  10462   1 00002E  BC82                                 LDB,B3   ,B2
          1 00002F  9CC7 0008                            LDB,B1   KL$,AUTO
          1 000031  E843 0017                            LDR,R6   23,B3
          1 000033  EAC1 000D                            SRM,R6,'00FF'X    13,B1
          1 000035       00FF

     1213    10463    1      KL$SGN.NODE=GJA$LGNCTX.NODE;

  10463   1 000036  BC82                                 LDB,B3   ,B2
          1 000037  E2C3 0017                            LLH,R6   23,B3
          1 000039  EA81                                 SRM,R6,'00FF'X    ,B1
          1 00003A       00FF

     1214    10464    1      KL$SGN.PROFILE = GJA$LGNCTX.CHN$->KH$CHN.PROFILE;

  10464   1 00003B  BC82                                 LDB,B3   ,B2
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:207  
          1 00003C  ECC3 000A                            LDB,B6   10,B3
          1 00003E  E806                                 LDR,R6   ,B6
          1 00003F  600E                                 SOL,R6   14
          1 000040  EAC1 000A                            SRM,R6,'4000'X    10,B1
          1 000042       4000

     1215    10465    1      KL$SGN.DEF_NODE = GJA_DEFNODE;

  10465   1 000043  E800 0000 0000  xsym                 LDR,R6   GJA_DEFNODE
          1 000046  EAC1 0001                            SRM,R6,'00FF'X    1,B1
          1 000048       00FF

     1216    10466    1      IF GJA$LGNCTX.CHN$->KH$CHN.AUTLGN

  10466   1 000049  EC82                                 LDB,B6   ,B2
          1 00004A  BCC6 000A                            LDB,B3   10,B6
          1 00004C  8283                                 LB,'0004'X        ,B3
          1 00004D       0004
          1 00004E  0581 0006                            BBF      s:10469,PREL

     1217    10467    1      THEN KL$SGN.AUTOLGN='1'B;

  10467   1 000050  8941 000A                            LBT,'8000'X       10,B1
  10467   1 000052       8000
          1 000053  0F81 0014                            B        s:10472,PREL

     1218    10468    2      ELSE DO;

     1219    10469    2           KL$SGN.LOGON.LGNSIZ=SIZE;

  10469   1 000055  ECC7 0006                            LDB,B6   @SIZE,AUTO
          1 000057  D806                                 LDR,R5   ,B6
          1 000058  DAC1 000E                            SRM,R5,'00FF'X    14,B1
          1 00005A       00FF

     1220    10470    2          ADDR(KL$SGN.LOGON.LGNTXT)->LOGON_STRING.STRING=GJA$LGNCTX.MSG$->LOGON_STRING
             10470                    .STRING;
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:208  

  10470   1 00005B  D806                                 LDR,R5   ,B6
          1 00005C  BC82                                 LDB,B3   ,B2
          1 00005D  ECC3 000C                            LDB,B6   12,B3
          1 00005F  DCC7 0006                            LDB,B5   @SIZE,AUTO
          1 000061  C805                                 LDR,R4   ,B5
          1 000062  AB86                                 LAB,B2   ,B6
          1 000063  2C00                                 LDV,R2   0
          1 000064  E854                                 LDR,R6   R4
          1 000065  BB81                                 LAB,B3   ,B1
          1 000066  3C1E                                 LDV,R3   30
          1 000067  0008                                 MMM

     1221    10471    2           END;

     1222    10472    1      MSGSIZ=SIZE+SIZEC(KL_SGN);

  10472   1 000068  ECC7 0006                            LDB,B6   @SIZE,AUTO
          1 00006A  E806                                 LDR,R6   ,B6
          1 00006B  6E20                                 ADV,R6   32
          1 00006C  EF47 008A                            STR,R6   MSGSIZ,AUTO

     1223    10473    2      CALL GJA$NETWORK_MANAGER(KL$SGN,MSGSIZ) WHENRETURN DO;

  10473   1 00006E  DBC7 008A                            LAB,B5   MSGSIZ,AUTO
          1 000070  DFC7 008E                            STB,B5   MSGSIZ+4,AUTO
          1 000072  BCC7 0008                            LDB,B3   KL$,AUTO
          1 000074  BFC7 008C                            STB,B3   MSGSIZ+2,AUTO
          1 000076  BBC7 008C                            LAB,B3   MSGSIZ+2,AUTO
          1 000078  CBF0 0200                            LAB,B4   512,IMO
          1 00007A  E380 0000 0000  xent                 LNJ,B6   GJA$NETWORK_MANAGER
          1 00007D       0009                            DC       s:10477,PREL

     1224    10474    2           GJA$LGNCTX.STATUS.NMRSP='1'B;

  10474   1 00007E  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000080  DC86                                 LDB,B5   ,B6
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:209  
          1 000081  8945 0018                            LBT,'2000'X       24,B5
          1 000083       2000

     1225    10475    2           END;

  10475   1 000084  0F81 0007                            B        s:10479,PREL

     1226    10476    2      WHENALTRETURN DO;

     1227    10477    2           GJA$LGNCTX.STATUS.NMRSP='0'B;

  10477   1 000086  ECC7 0004                            LDB,B6   @CTX$,AUTO
          1 000088  DC86                                 LDB,B5   ,B6
          1 000089  8845 0018                            LBF,'2000'X       24,B5
          1 00008B       2000

     1228    10478    2           END;

     1229    10479    1      GJA$LGNCTX.NM_NODE = GJA_DEFNODE;

  10479   1 00008C  DC86                                 LDB,B5   ,B6
          1 00008D  E800 0000 0000  xsym                 LDR,R6   GJA_DEFNODE
          1 000090  E7C5 0009                            STH,R6   9,B5

     1230    10480    1      RETURN;

  10480   1 000092  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1231    10481    1   END;

PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:210  
--  Include file information  --

   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GJA_MSG_M.:E05TOU  is referenced.
      No diagnostics issued in procedure GJA$SOLICIT_NM.
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:211  

 **** Variables and constants ****

  ****  Section 000  Data  GJA$SOLICIT_NM

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(248)   r     1 KL_SGN

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @CTX$                      6-0-0/w PTR         r     1 @SIZE
    *0-0-0/w UBIN(32)    r     1 CTX                       *0-0-0/w PTR         r     1 CTX$
     8-0-0/w PTR         r     1 KL$                       8A-0-0/w UBIN(16)    r     1 MSGSIZ
    *0-0-0/w UBIN(16)    r     1 SIZE
     A-0-0/c CHAR        r     1 VDO_BUFFER(0:254)

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 GJA_DEFNODE

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(528)   r     1 GJA$LGNCTX                 0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w STRC(248)   r     1 KL$SGN                     0-0-0/c ASTR(0)     r     1 LOGON_STRING

PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:212  

   Procedure GJA$SOLICIT_NM requires 149 words for executable code.
   Procedure GJA$SOLICIT_NM requires 144 words of local(AUTO) storage.

    No errors detected in file GJA$LOGON.:E05TSI    .
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:213  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:214  
          MINI XREF LISTING

CTX
      9849**DCL     10461>>ASSIGN
CTX$
      9848**DCL        35--PROC     9849--REDEF   10061--IMP-PTR 10456>>ASSIGN  10459>>ASSIGN  10460>>ASSIGN
     10462>>ASSIGN  10463>>ASSIGN  10464>>ASSIGN  10466>>IF      10470>>ASSIGN  10474>>ASSIGN  10477>>ASSIGN
     10479>>ASSIGN
GJA$LGNCTX.CHN$
     10087**DCL     10464>>ASSIGN  10466>>IF
GJA$LGNCTX.MSG$
     10088**DCL     10470>>ASSIGN
GJA$LGNCTX.NM_NODE
     10085**DCL     10479<<ASSIGN
GJA$LGNCTX.NODE
     10123**DCL     10463>>ASSIGN
GJA$LGNCTX.SPEED
     10124**DCL     10462>>ASSIGN
GJA$LGNCTX.STATUS.NMRSP
     10131**DCL     10474<<ASSIGN  10477<<ASSIGN
GJA$LGNCTX.STATUS.RDPND
     10140**DCL     10456<<ASSIGN
GJA$LGNCTX.TERMINAL_ID
     10110**DCL     10459>>ASSIGN
GJA$LGNCTX.TERMINAL_ID.TERM
     10112**DCL     10121--REDEF
GJA$LGNCTX.USER
     10089**DCL     10460>>ASSIGN
GJA$NETWORK_MANAGER
     10437**DCL-ENT 10473--CALL
GJA_DEFNODE
     10434**DCL     10465>>ASSIGN  10479>>ASSIGN
KH$CHN.AUTLGN
      9962**DCL     10466>>IF
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:215  
KH$CHN.PROFILE
      9963**DCL     10464>>ASSIGN
KH$CHN.TERMID.TERM
     10047**DCL     10056--REDEF
KL$
     10430**DCL     10256--IMP-PTR 10457<<ASSIGN  10458>>ASSIGN  10459>>ASSIGN  10460>>ASSIGN  10461>>ASSIGN
     10462>>ASSIGN  10463>>ASSIGN  10464>>ASSIGN  10465>>ASSIGN  10467>>ASSIGN  10469>>ASSIGN  10470>>ASSIGN
     10473>>CALL
KL$SGN
     10256**DCL     10458<<ASSIGN  10473<>CALL
KL$SGN.AUTOLGN
     10297**DCL     10467<<ASSIGN
KL$SGN.DEF_NODE
     10264**DCL     10465<<ASSIGN
KL$SGN.LOGON.LGNSIZ
     10331**DCL     10469<<ASSIGN
KL$SGN.LOGON.LGNTXT
     10332**DCL     10470--ASSIGN
KL$SGN.NMID
     10320**DCL     10461<<ASSIGN
KL$SGN.NODE
     10260**DCL     10463<<ASSIGN
KL$SGN.PROFILE
     10301**DCL     10464<<ASSIGN
KL$SGN.SPEED
     10326**DCL     10462<<ASSIGN
KL$SGN.TERMINAL_ID
     10281**DCL     10459<<ASSIGN
KL$SGN.TERMINAL_ID.TERM
     10283**DCL     10292--REDEF
KL$SGN.USER
     10306**DCL     10460<<ASSIGN
KL_SGN
     10351**DCL     10458>>ASSIGN  10472--ASSIGN
KL_SGN.TERMINAL_ID.TERM
     10378**DCL     10387--REDEF
PL6.E3A0      #005=GJA$SOLICIT_NM File=GJA$LOGON.:E05TSI                         TUE 07/29/97 21:53 Page:216  
LOGON_STRING.STRING
      9935**DCL     10470<<ASSIGN  10470>>ASSIGN
MSGSIZ
     10432**DCL     10472<<ASSIGN  10473<>CALL
SIZE
      9850**DCL        35--PROC     9935--IMP-SIZ 10469>>ASSIGN  10470>>ASSIGN  10470>>ASSIGN  10472>>ASSIGN
VDO_BUFFER
     10431**DCL     10457--ASSIGN
