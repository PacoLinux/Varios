VERSION E05

PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:1    
        1        1        /*M*           KFF$FECGMSG - process msgs from people writing
        2        2                       to the fecg         */
        3        3        /*T***********************************************************/
        4        4        /*T*                                                         */
        5        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        6        6        /*T*                                                         */
        7        7        /*T***********************************************************/
        8        8        /*X* CCE CRM 70 IND 5 ECU 10 THI 0 DCI 10 CSU 5 ENU 5 */
        9        9        /**/
       10       10        KFF$FECGMSG: PROC;
       11       11        /*F* NAME:     KFF$FECGMSG
       12       12             PURPOSE:  Porcess msgs that come thru the fecg
       13       13             DESCRIPTION: The fecg buffer contains a message for someone connected
       14       14                       to the fecg (including frog).  Decide where this message
       15       15                       goes if possible.                       */
       16       16        /*D*     NAME:     KFF$FECGMSG
       17       17             INPUT:         None-expect a msg in KF_FECGBUF.
       18       18             OUTPUT:        None
       19       19             INTERFACE:     KFG$FRG_MSG - if msg is for frog
       20       20                            KFB$FIFS - to find utble id
       21       21                            KFH$CHKSGBUF - check for msg buffer
       22       22                            KFH$MSGBUFCONT - continue msg buffer
       23       23                            KFW$WRT_MSG - write a msg to fecg
       24       24                 DESCRIPTION:  This routine gets all msgs sent to
       25       25                           frog.  The station and msgtyp are pulled
       26       26                           from the dcb.  If necessary, the msg is
       27       27                           logged to a file, and then KFG$FRG_MSG
       28       28                           is called.
       29       29        */
       30       30        /**/
       31       31        %INCLUDE CP_6;
       32      112        %INCLUDE F$DCB;
       33      161        %INCLUDE NK_SUBS;             /*  SUBS FOR ITEMS IN COMGRP STUFF    */
       34      186        %INCLUDE KF$SUBS;
       35      253        %INCLUDE KF$MSG_SUBS;
       36      299        %INCLUDE KF$MSG_C;
       37      366        %KF$MSG;
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:2    
       38      371        %INCLUDE KF_DAT_R;
       39      390        %PLIST;
       40      391        /**/
       41      392    1   DCL KFG$FRG_MSG ENTRY;
       42      393        /**/
       43      394    1   DCL Y$ARS UBIN WORD;
       44      395    1   DCL Y$ARS_S REDEF Y$ARS SBIN WORD;
       45      396    1   DCL Y$BUF$ PTR;
       46      397    1   DCL Y$FLG UBIN WORD;
       47      398    1   DCL Y$STA CHAR(8);
       48      399    1   DCL Y$ID UBIN WORD;
       49      400        /**/
       50      401        /**/
       51      402    1   DCL M$LOG DCB;
       52      403        %FPT_WRITE (FPTN=WRTLOGFPT,DCB=M$LOG,BUF=KF_LOGBUF);
       53      434        %VLP_STATION (FPTN=Y$VLP_STA,STCLASS=BASED);
       54      461        %EJECT;
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:3    
       55      462    1           Y$BUF$ = ADDR(KF_FECGBUF);      /* GET ADDR OF INPUT BUFFER */
       56      463    1           KF_FECG_STA = DCBADDR(DCBNUM(M$FE))->
       57      464    1             F$DCB.LASTSTA$->Y$VLP_STA.STATION#;
       58      465    1           Y$STA = KF_FECG_STA;
       59      466    1           KF_FECG_MSGTYP = DCBADDR(DCBNUM(M$FE))->
       60      467    1             F$DCB.LASTSTA$->Y$VLP_STA.MSGTYP#;
       61      468    1           Y$ARS = DCBADDR(DCBNUM(M$FE))->F$DCB.ARS; /*  GET ARS       */
       62      469    1           CALL KFG$FRG_MSG;
       63      470    1   END KFF$FECGMSG;
       64      471        %EOD;

PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:4    
--  Include file information  --

   KF_DAT_R.:E05TOU  cannot be made into a system file and is referenced.
   KF$MSG_C.:E05TOU  is referenced.
   KF$MSG_SUBS.:E05TOU  is referenced.
   KF$SUBS.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KFF$FECGMSG.

   Procedure KFF$FECGMSG requires 29 words for executable code.
   Procedure KFF$FECGMSG requires 10 words of local(AUTO) storage.

PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:5    

 Object Unit name= KFF$FECGMSG                                File name= KFF$FECGMSG.:E05TOU
 UTS= JUL 30 '97 00:22:08.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$FE
    2   DCB   even  none     0      0  M$CS
    3   DCB   even  none     0      0  M$HLPF
    4   DCB   even  none     0      0  M$PROF
    5   DCB   even  none     0      0  M$NETCON
    6   DCB   even  none     0      0  M$LOG
    7   Data  even  none    12     14  KFF$FECGMSG
    8   Proc  even  none    29     35  KFF$FECGMSG
    9  RoData even  none     2      2  KFF$FECGMSG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     8      0   yes            yes      Std        0  KFF$FECGMSG

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 KFG$FRG_MSG
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:6    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  KF_FECGBUF                            KF_FECG_STA
     KF_FECG_MSGTYP                        M$FE                                  M$CS
     M$HLPF                                M$PROF                                M$NETCON
     KF_LOGBUF                             M$LOG                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:7    


        1        1        /*M*           KFF$FECGMSG - process msgs from people writing
        2        2                       to the fecg         */
        3        3        /*T***********************************************************/
        4        4        /*T*                                                         */
        5        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        6        6        /*T*                                                         */
        7        7        /*T***********************************************************/
        8        8        /*X* CCE CRM 70 IND 5 ECU 10 THI 0 DCI 10 CSU 5 ENU 5 */
        9        9        /**/
       10       10        KFF$FECGMSG: PROC;

     10  8 000000   000000 700200 xent  KFF$FECGMSG  TSX0  ! X66_AUTO_0
         8 000001   000012 000000                    ZERO    10,0

       11       11        /*F* NAME:     KFF$FECGMSG
       12       12             PURPOSE:  Porcess msgs that come thru the fecg
       13       13             DESCRIPTION: The fecg buffer contains a message for someone connected
       14       14                       to the fecg (including frog).  Decide where this message
       15       15                       goes if possible.                       */
       16       16        /*D*     NAME:     KFF$FECGMSG
       17       17             INPUT:         None-expect a msg in KF_FECGBUF.
       18       18             OUTPUT:        None
       19       19             INTERFACE:     KFG$FRG_MSG - if msg is for frog
       20       20                            KFB$FIFS - to find utble id
       21       21                            KFH$CHKSGBUF - check for msg buffer
       22       22                            KFH$MSGBUFCONT - continue msg buffer
       23       23                            KFW$WRT_MSG - write a msg to fecg
       24       24                 DESCRIPTION:  This routine gets all msgs sent to
       25       25                           frog.  The station and msgtyp are pulled
       26       26                           from the dcb.  If necessary, the msg is
       27       27                           logged to a file, and then KFG$FRG_MSG
       28       28                           is called.
       29       29        */
       30       30        /**/
       31       31        %INCLUDE CP_6;
       32      112        %INCLUDE F$DCB;
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:8    
       33      161        %INCLUDE NK_SUBS;             /*  SUBS FOR ITEMS IN COMGRP STUFF    */
       34      186        %INCLUDE KF$SUBS;
       35      253        %INCLUDE KF$MSG_SUBS;
       36      299        %INCLUDE KF$MSG_C;
       37      366        %KF$MSG;
       38      371        %INCLUDE KF_DAT_R;
       39      390        %PLIST;
       40      391        /**/
       41      392    1   DCL KFG$FRG_MSG ENTRY;
       42      393        /**/
       43      394    1   DCL Y$ARS UBIN WORD;
       44      395    1   DCL Y$ARS_S REDEF Y$ARS SBIN WORD;
       45      396    1   DCL Y$BUF$ PTR;
       46      397    1   DCL Y$FLG UBIN WORD;
       47      398    1   DCL Y$STA CHAR(8);
       48      399    1   DCL Y$ID UBIN WORD;
       49      400        /**/
       50      401        /**/
       51      402    1   DCL M$LOG DCB;
       52      403        %FPT_WRITE (FPTN=WRTLOGFPT,DCB=M$LOG,BUF=KF_LOGBUF);
       53      434        %VLP_STATION (FPTN=Y$VLP_STA,STCLASS=BASED);
       54      461        %EJECT;
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:9    
       55      462    1           Y$BUF$ = ADDR(KF_FECGBUF);      /* GET ADDR OF INPUT BUFFER */

    462  8 000002   000000 236000 9                  LDQ     0
         8 000003   200004 756100                    STQ     Y$BUF$,,AUTO

       56      463    1           KF_FECG_STA = DCBADDR(DCBNUM(M$FE))->

    463  8 000004   000000 236007 xsym               LDQ     M$FE,DL
         8 000005   000001 470400 9                  LDP0    1
         8 000006   000000 471500                    LDP1    0,,PR0
         8 000007   100000 473506                    LDP3    0,QL,PR1
         8 000010   300007 474500                    LDP4    7,,PR3
         8 000011   040000 100500                    MLR     fill='040'O
         8 000012   400000 000010                    ADSC9   0,,PR4                   cn=0,n=8
         8 000013   000000 000010 xsym               ADSC9   KF_FECG_STA              cn=0,n=8

       57      464    1             F$DCB.LASTSTA$->Y$VLP_STA.STATION#;
       58      465    1           Y$STA = KF_FECG_STA;

    465  8 000014   040100 100400                    MLR     fill='040'O
         8 000015   000000 000010 xsym               ADSC9   KF_FECG_STA              cn=0,n=8
         8 000016   200006 000010                    ADSC9   Y$STA,,AUTO              cn=0,n=8

       59      466    1           KF_FECG_MSGTYP = DCBADDR(DCBNUM(M$FE))->

    466  8 000017   000000 236007 xsym               LDQ     M$FE,DL
         8 000020   100000 473506                    LDP3    0,QL,PR1
         8 000021   300007 474500                    LDP4    7,,PR3
         8 000022   040000 100500                    MLR     fill='040'O
         8 000023   400002 000010                    ADSC9   2,,PR4                   cn=0,n=8
         8 000024   000000 000010 xsym               ADSC9   KF_FECG_MSGTYP           cn=0,n=8

       60      467    1             F$DCB.LASTSTA$->Y$VLP_STA.MSGTYP#;
       61      468    1           Y$ARS = DCBADDR(DCBNUM(M$FE))->F$DCB.ARS; /*  GET ARS       */

    468  8 000025   000000 236007 xsym               LDQ     M$FE,DL
         8 000026   100000 473506                    LDP3    0,QL,PR1
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:10   
         8 000027   300000 235100                    LDA     0,,PR3
         8 000030   200003 755100                    STA     Y$ARS,,AUTO

       62      469    1           CALL KFG$FRG_MSG;

    469  8 000031   000002 631400 xsym               EPPR1   B_VECTNIL+2
         8 000032   000000 701000 xent               TSX1    KFG$FRG_MSG
         8 000033   000000 011000                    NOP     0

       63      470    1   END KFF$FECGMSG;

    470  8 000034   000000 702200 xent               TSX2  ! X66_ARET
       64      471        %EOD;

PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:11   
--  Include file information  --

   KF_DAT_R.:E05TOU  cannot be made into a system file and is referenced.
   KF$MSG_C.:E05TOU  is referenced.
   KF$MSG_SUBS.:E05TOU  is referenced.
   KF$SUBS.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KFF$FECGMSG.
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:12   

 **** Variables and constants ****

  ****  Section 007  Data  KFF$FECGMSG

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(432)   r     1 WRTLOGFPT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w UBIN        r     1 Y$ARS                      4-0-0/w PTR         r     1 Y$BUF$
     6-0-0/c CHAR(8)     r     1 Y$STA

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(600)   r     1 KF_FECGBUF                 0-0-0/c CHAR(8)     r     1 KF_FECG_MSGTYP
     0-0-0/c CHAR(8)     r     1 KF_FECG_STA                0-0-0/c STRC(1422)  r     1 KF_LOGBUF

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0N  NULL        r     1 M$FE
     0-0-0N  NULL        r     1 M$LOG                      0-0-0/w STRC(288)   r     1 Y$VLP_STA


   Procedure KFF$FECGMSG requires 29 words for executable code.
   Procedure KFF$FECGMSG requires 10 words of local(AUTO) storage.
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:13   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:14   
          MINI XREF LISTING

F$DCB.ACTPOS
       138**DCL       138--REDEF
F$DCB.ARS
       113**DCL       113--REDEF     468>>ASSIGN
F$DCB.ATTR
       131**DCL       132--REDEF
F$DCB.BORROW
       146**DCL       146--REDEF     146--REDEF     146--REDEF
F$DCB.DCBNAME.L
       160**DCL       160--IMP-SIZ
F$DCB.EOMCHAR
       117**DCL       117--REDEF
F$DCB.FLDID
       141**DCL       141--REDEF
F$DCB.FORM$
       135**DCL       135--REDEF
F$DCB.FSECT
       151**DCL       151--REDEF
F$DCB.FSN
       128**DCL       128--REDEF     128--REDEF     129--REDEF
F$DCB.HEADER$
       134**DCL       134--REDEF
F$DCB.IXTNSIZE
       132**DCL       132--REDEF
F$DCB.LASTSTA$
       122**DCL       122--REDEF     463>>ASSIGN    466>>ASSIGN
F$DCB.LVL
       147**DCL       147--REDEF
F$DCB.NAME.C
       122**DCL       122--REDEF
F$DCB.NOEOF
       143**DCL       143--REDEF
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:15   
F$DCB.NRECS
       133**DCL       133--REDEF
F$DCB.NRECX
       152**DCL       152--REDEF
F$DCB.OHDR
       144**DCL       144--REDEF
F$DCB.ORG
       127**DCL       127--REDEF
F$DCB.PRECNO
       150**DCL       150--REDEF
F$DCB.RCSZ
       155**DCL       155--REDEF
F$DCB.RES
       123**DCL       123--REDEF
F$DCB.SETX
       135**DCL       135--REDEF
F$DCB.TAB$
       134**DCL       135--REDEF
F$DCB.TDA
       149**DCL       149--REDEF
F$DCB.WSN
       124**DCL       124--REDEF
KFG$FRG_MSG
       392**DCL-ENT   469--CALL
KF_FECGBUF
       381**DCL       462--ASSIGN
KF_FECG_MSGTYP
       382**DCL       466<<ASSIGN
KF_FECG_STA
       381**DCL       463<<ASSIGN    465>>ASSIGN
KF_LOGBUF
       387**DCL       421--DCLINIT   422--DCLINIT
KF_UTBL.STATION
       384**DCL       384--REDEF
M$FE
       383**DCL       463--ASSIGN    466--ASSIGN    468--ASSIGN
PL6.E3A0      #001=KFF$FECGMSG File=KFF$FECGMSG.:E05TSI                          WED 07/30/97 00:22 Page:16   
WRTLOGFPT.STATION_
       422**DCL       422--REDEF
WRTLOGFPT.V
       423**DCL       420--DCLINIT
WRTLOGFPT.V.DVBYTE.VFC#
       429**DCL       429--REDEF
Y$ARS
       394**DCL       395--REDEF     468<<ASSIGN
Y$BUF$
       396**DCL       462<<ASSIGN
Y$STA
       398**DCL       465<<ASSIGN
Y$VLP_STA.MSGIDXT
       456**DCL       459--REDEF
Y$VLP_STA.MSGTYP#
       450**DCL       466>>ASSIGN
Y$VLP_STA.STATION#
       450**DCL       463>>ASSIGN

PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:17   
       65        1        /*M*           KFF$USRTRM - process a dcb close to frog     */
       66        2        /*T***********************************************************/
       67        3        /*T*                                                         */
       68        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       69        5        /*T*                                                         */
       70        6        /*T***********************************************************/
       71        7        /*X* CCE CRM 70 IND 5 ECU 10 THI 0 DCI 10 CSU 5 ENU 5 */
       72        8        KFF$USRTRM: PROC(P$STA);
       73        9        /*F*      NAME:     KFF$USRTRM
       74       10                 PURPOSE:   To process closes from terminals or dcbs
       75       11                 DESCRIPTION:  We use the sub code of the event to determine
       76       12                 if this is a dcb or trminal cls (host prog or fep).  If it is
       77       13                 a dcb, we send a msg to all terminals saying this user just
       78       14                 closed.  If it is a terminal close, we send a msg to all dcbs
       79       15                            that are connected to frog.
       80       16                         The msg to the fep contains 2 frog ids.   the msg to the host
       81       17                         program contains the type and node of a n fep.
       82       18        */
       83       19        %INCLUDE CP_6;
       84      100        %INCLUDE F$DCB;
       85      149        %INCLUDE NK_SUBS;             /*  SUBS FOR ITEMS IN COMGRP STUFF    */
       86      174        %INCLUDE KF$SUBS;
       87      241        %INCLUDE KF$MSG_SUBS;
       88      287        %EQU_CG;
       89      335        %INCLUDE KF$MSG_C;
       90      402        %KF$CLS_MSG;
       91      408        %INCLUDE KF_DAT_R;
       92      427        %PLIST;
       93      428        /**/
       94      429        /*             Insert all local dcls here         */
       95      430        /**/
       96      431        /**/
       97      432    1   DCL P$STA CHAR(8);
       98      433    1   DCL Y$STA CHAR(8);
       99      434    1   DCL Y$CLS_CODE UBIN WORD;
      100      435    1   DCL Y$BUF$ PTR;
      101      436    1   DCL Y$ID UBIN WORD;
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:18   
      102      437    1   DCL Y$TRMID UBIN WORD;
      103      438    1   DCL Y$ARS UBIN(36);
      104      439    1   DCL Y$TMPBUF$ PTR;
      105      440    1   DCL Y$NODE UBIN WORD;
      106      441    1   DCL Y$SRCHFLG UBIN WORD;
      107      442        /**/
      108      443        /**/
      109      444        /*             Insert all entry dcls here         */
      110      445        /**/
      111      446    1   DCL KFB$FIFS ENTRY(3);
      112      447    1   DCL KFB$DEL_TBL ENTRY(1);
      113      448        /**/
      114      449        %EJECT;
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:19   
      115      450        /**/
      116      451        /*             find the frog id of the user who just closed */
      117      452        /**/
      118      453        /**/
      119      454    1           Y$STA = P$STA;
      120      455                                                /**/
      121      456    1           CALL KFB$FIFS(Y$STA,%KF_UTBLST_ACTIVE#,Y$ID);
      122      457        /**/
      123      458        /**/
      124      459    1           Y$CLS_CODE = KF_UTBL.TDTYP(Y$ID);
      125      460    1           IF Y$CLS_CODE = %CG_DOPN# THEN
      126      461    2           DO;
      127      462        /*
      128      463                         A host program (DCB) just closed.  Send a msg to all terminals
      129      464                         saying that this user just closed.
      130      465        */
      131      466    3                DO Y$TRMID = 1 TO %KF_UTBL_MAX##;
      132      467    3                     IF KF_UTBL.STATE(Y$TRMID) = %KF_UTBLST_ACTIVE# AND
      133      468    4                       KF_UTBL.TDTYP(Y$TRMID) = %CG_TCON# THEN DO;
      134      469    4                          IF KF_UTBL.FLAGS.EXCLDCB(Y$TRMID) AND
      135      470    5                            KF_UTBL.DCBSTATION(Y$TRMID) = KF_UTBL.STATION(Y$ID) THEN DO
               470                                     ;
      136      471    5                               KF_UTBL.FLAGS.EXCLDCB(Y$TRMID) = '0'B;
      137      472    5                               KF_UTBL.DCBSTATION(Y$TRMID) = ' ';
      138      473    5                          END;             /* IF                       */
      139      474    4                     END;
      140      475    3                END;                       /*  END OF DO WHILE         */
      141      476    2           END;
      142      477    1           ELSE IF Y$CLS_CODE = %CG_TCON# THEN
      143      478    2                DO;
      144      479        /*
      145      480                         An FEP program (TRM) just closed, sned a msg to all host
      146      481                         programs identifing the type and node of the program that just
      147      482                         closed.
      148      483        */
      149      484    2                     KF_UTBL.FLAGS.EXCLDCB(Y$ID) = '0'B;
      150      485    2                     KF_UTBL.DCBSTATION(Y$ID) = ' ';
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:20   
      151      486    2                     Y$SRCHFLG=1;
      152      487    2                     Y$NODE = KF_UTBL.FEX(Y$ID);
      153      488    3                     DO Y$TRMID = 1 TO %KF_UTBL_MAX##;
      154      489    3                     END;                  /*  END OF DO WHILE         */
      155      490    2                END;
      156      491    1           RETURN;
      157      492    1   END KFF$USRTRM;

PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:21   
--  Include file information  --

   KF_DAT_R.:E05TOU  cannot be made into a system file and is referenced.
   KF$MSG_C.:E05TOU  is referenced.
   KF$MSG_SUBS.:E05TOU  is referenced.
   KF$SUBS.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KFF$USRTRM.

   Procedure KFF$USRTRM requires 85 words for executable code.
   Procedure KFF$USRTRM requires 18 words of local(AUTO) storage.

    No errors detected in file KFF$FECGMSG.:E05TSI    .

PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:22   

 Object Unit name= KFF$USRTRM                                 File name= KFF$FECGMSG.:E05TOU
 UTS= JUL 30 '97 00:22:19.00 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$FE
    2   DCB   even  none     0      0  M$CS
    3   DCB   even  none     0      0  M$HLPF
    4   DCB   even  none     0      0  M$PROF
    5   DCB   even  none     0      0  M$NETCON
    6   Proc  even  none    85    125  KFF$USRTRM
    7  RoData even  none     2      2  KFF$USRTRM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     6      0   yes            yes      Std        1  KFF$USRTRM

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       3 KFB$FIFS
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:23   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  M$FE                                  M$CS
     M$HLPF                                M$PROF                                M$NETCON
     KF_UTBL                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:24   


       65        1        /*M*           KFF$USRTRM - process a dcb close to frog     */
       66        2        /*T***********************************************************/
       67        3        /*T*                                                         */
       68        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       69        5        /*T*                                                         */
       70        6        /*T***********************************************************/
       71        7        /*X* CCE CRM 70 IND 5 ECU 10 THI 0 DCI 10 CSU 5 ENU 5 */
       72        8        KFF$USRTRM: PROC(P$STA);

      8  6 000000   000000 700200 xent  KFF$USRTRM   TSX0  ! X66_AUTO_1
         6 000001   000022 000001                    ZERO    18,1

       73        9        /*F*      NAME:     KFF$USRTRM
       74       10                 PURPOSE:   To process closes from terminals or dcbs
       75       11                 DESCRIPTION:  We use the sub code of the event to determine
       76       12                 if this is a dcb or trminal cls (host prog or fep).  If it is
       77       13                 a dcb, we send a msg to all terminals saying this user just
       78       14                 closed.  If it is a terminal close, we send a msg to all dcbs
       79       15                            that are connected to frog.
       80       16                         The msg to the fep contains 2 frog ids.   the msg to the host
       81       17                         program contains the type and node of a n fep.
       82       18        */
       83       19        %INCLUDE CP_6;
       84      100        %INCLUDE F$DCB;
       85      149        %INCLUDE NK_SUBS;             /*  SUBS FOR ITEMS IN COMGRP STUFF    */
       86      174        %INCLUDE KF$SUBS;
       87      241        %INCLUDE KF$MSG_SUBS;
       88      287        %EQU_CG;
       89      335        %INCLUDE KF$MSG_C;
       90      402        %KF$CLS_MSG;
       91      408        %INCLUDE KF_DAT_R;
       92      427        %PLIST;
       93      428        /**/
       94      429        /*             Insert all local dcls here         */
       95      430        /**/
       96      431        /**/
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:25   
       97      432    1   DCL P$STA CHAR(8);
       98      433    1   DCL Y$STA CHAR(8);
       99      434    1   DCL Y$CLS_CODE UBIN WORD;
      100      435    1   DCL Y$BUF$ PTR;
      101      436    1   DCL Y$ID UBIN WORD;
      102      437    1   DCL Y$TRMID UBIN WORD;
      103      438    1   DCL Y$ARS UBIN(36);
      104      439    1   DCL Y$TMPBUF$ PTR;
      105      440    1   DCL Y$NODE UBIN WORD;
      106      441    1   DCL Y$SRCHFLG UBIN WORD;
      107      442        /**/
      108      443        /**/
      109      444        /*             Insert all entry dcls here         */
      110      445        /**/
      111      446    1   DCL KFB$FIFS ENTRY(3);
      112      447    1   DCL KFB$DEL_TBL ENTRY(1);
      113      448        /**/
      114      449        %EJECT;
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:26   
      115      450        /**/
      116      451        /*             find the frog id of the user who just closed */
      117      452        /**/
      118      453        /**/
      119      454    1           Y$STA = P$STA;

    454  6 000002   200003 470500                    LDP0    @P$STA,,AUTO
         6 000003   040100 100500                    MLR     fill='040'O
         6 000004   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         6 000005   200004 000010                    ADSC9   Y$STA,,AUTO              cn=0,n=8

      120      455                                                /**/
      121      456    1           CALL KFB$FIFS(Y$STA,%KF_UTBLST_ACTIVE#,Y$ID);

    456  6 000006   200010 631500                    EPPR1   Y$ID,,AUTO
         6 000007   200020 451500                    STP1    Y$SRCHFLG+3,,AUTO
         6 000010   000000 236000 7                  LDQ     0
         6 000011   200017 756100                    STQ     Y$SRCHFLG+2,,AUTO
         6 000012   200004 633500                    EPPR3   Y$STA,,AUTO
         6 000013   200016 453500                    STP3    Y$SRCHFLG+1,,AUTO
         6 000014   200016 630500                    EPPR0   Y$SRCHFLG+1,,AUTO
         6 000015   000021 631400 xsym               EPPR1   B_VECTNIL+17
         6 000016   000000 701000 xent               TSX1    KFB$FIFS
         6 000017   000000 011000                    NOP     0

      122      457        /**/
      123      458        /**/
      124      459    1           Y$CLS_CODE = KF_UTBL.TDTYP(Y$ID);

    459  6 000020   200010 236100                    LDQ     Y$ID,,AUTO
         6 000021   000011 402007                    MPY     9,DL
         6 000022   000004 236006 xsym               LDQ     KF_UTBL+4,QL
         6 000023   000022 772000                    QRL     18
         6 000024   200006 756100                    STQ     Y$CLS_CODE,,AUTO

      125      460    1           IF Y$CLS_CODE = %CG_DOPN# THEN

PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:27   
    460  6 000025   000075 601000 6                  TNZ     s:477

      126      461    2           DO;

      127      462        /*
      128      463                         A host program (DCB) just closed.  Send a msg to all terminals
      129      464                         saying that this user just closed.
      130      465        */
      131      466    3                DO Y$TRMID = 1 TO %KF_UTBL_MAX##;

    466  6 000026   000001 235007                    LDA     1,DL
         6 000027   200011 755100                    STA     Y$TRMID,,AUTO

      132      467    3                     IF KF_UTBL.STATE(Y$TRMID) = %KF_UTBLST_ACTIVE# AND

    467  6 000030   200011 236100                    LDQ     Y$TRMID,,AUTO
         6 000031   000011 402007                    MPY     9,DL
         6 000032   000002 220006 xsym               LDX0    KF_UTBL+2,QL
         6 000033   000001 100003                    CMPX0   1,DU
         6 000034   000067 601000 6                  TNZ     s:475
         6 000035   000004 221006 xsym               LDX1    KF_UTBL+4,QL
         6 000036   000002 101003                    CMPX1   2,DU
         6 000037   000067 601000 6                  TNZ     s:475

      133      468    4                       KF_UTBL.TDTYP(Y$TRMID) = %CG_TCON# THEN DO;

      134      469    4                          IF KF_UTBL.FLAGS.EXCLDCB(Y$TRMID) AND

    469  6 000040   000002 236006 xsym               LDQ     KF_UTBL+2,QL
         6 000041   100000 316007                    CANQ    32768,DL
         6 000042   000067 600000 6                  TZE     s:475
         6 000043   200011 236100                    LDQ     Y$TRMID,,AUTO
         6 000044   000044 402007                    MPY     36,DL
         6 000045   200016 756100                    STQ     Y$SRCHFLG+1,,AUTO
         6 000046   200010 236100                    LDQ     Y$ID,,AUTO
         6 000047   000044 402007                    MPY     36,DL
         6 000050   200016 235100                    LDA     Y$SRCHFLG+1,,AUTO
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:28   
         6 000051   040006 106405                    CMPC    fill='040'O
         6 000052   000006 400010 xsym               ADSC9   KF_UTBL+6,A              cn=2,n=8
         6 000053   000000 000010 xsym               ADSC9   KF_UTBL,Q                cn=0,n=8
         6 000054   000067 601000 6                  TNZ     s:475

      135      470    5                           KF_UTBL.DCBSTATION(Y$TRMID) = KF_UTBL.STATION(Y$ID) THEN DO
               470                                     ;

      136      471    5                               KF_UTBL.FLAGS.EXCLDCB(Y$TRMID) = '0'B;

    471  6 000055   200011 236100                    LDQ     Y$TRMID,,AUTO
         6 000056   000011 402007                    MPY     9,DL
         6 000057   000000 620006                    EAX0    0,QL
         6 000060   000001 236000 7                  LDQ     1
         6 000061   000002 356010 xsym               ANSQ    KF_UTBL+2,X0

      137      472    5                               KF_UTBL.DCBSTATION(Y$TRMID) = ' ';

    472  6 000062   000000 635010                    EAA     0,X0
         6 000063   000020 771000                    ARL     16
         6 000064   040005 100400                    MLR     fill='040'O
         6 000065   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         6 000066   000006 400010 xsym               ADSC9   KF_UTBL+6,A              cn=2,n=8

      138      473    5                          END;             /* IF                       */

      139      474    4                     END;

      140      475    3                END;                       /*  END OF DO WHILE         */

    475  6 000067   200011 235100                    LDA     Y$TRMID,,AUTO
         6 000070   000001 035007                    ADLA    1,DL
         6 000071   200011 755100                    STA     Y$TRMID,,AUTO
         6 000072   000025 115007                    CMPA    21,DL
         6 000073   000030 602000 6                  TNC     s:467

      141      476    2           END;
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:29   

    476  6 000074   000124 710000 6                  TRA     s:491

      142      477    1           ELSE IF Y$CLS_CODE = %CG_TCON# THEN

    477  6 000075   000002 116007                    CMPQ    2,DL
         6 000076   000124 601000 6                  TNZ     s:491

      143      478    2                DO;

      144      479        /*
      145      480                         An FEP program (TRM) just closed, sned a msg to all host
      146      481                         programs identifing the type and node of the program that just
      147      482                         closed.
      148      483        */
      149      484    2                     KF_UTBL.FLAGS.EXCLDCB(Y$ID) = '0'B;

    484  6 000077   200010 236100                    LDQ     Y$ID,,AUTO
         6 000100   000011 402007                    MPY     9,DL
         6 000101   000000 620006                    EAX0    0,QL
         6 000102   000001 236000 7                  LDQ     1
         6 000103   000002 356010 xsym               ANSQ    KF_UTBL+2,X0

      150      485    2                     KF_UTBL.DCBSTATION(Y$ID) = ' ';

    485  6 000104   000000 635010                    EAA     0,X0
         6 000105   000020 771000                    ARL     16
         6 000106   040005 100400                    MLR     fill='040'O
         6 000107   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         6 000110   000006 400010 xsym               ADSC9   KF_UTBL+6,A              cn=2,n=8

      151      486    2                     Y$SRCHFLG=1;

    486  6 000111   000001 235007                    LDA     1,DL
         6 000112   200015 755100                    STA     Y$SRCHFLG,,AUTO

      152      487    2                     Y$NODE = KF_UTBL.FEX(Y$ID);
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:30   

    487  6 000113   000004 236010 xsym               LDQ     KF_UTBL+4,X0
         6 000114   777777 376007                    ANQ     -1,DL
         6 000115   200014 756100                    STQ     Y$NODE,,AUTO

      153      488    3                     DO Y$TRMID = 1 TO %KF_UTBL_MAX##;

    488  6 000116   200011 755100                    STA     Y$TRMID,,AUTO

      154      489    3                     END;                  /*  END OF DO WHILE         */

    489  6 000117   200011 235100                    LDA     Y$TRMID,,AUTO
         6 000120   000001 035007                    ADLA    1,DL
         6 000121   200011 755100                    STA     Y$TRMID,,AUTO
         6 000122   000025 115007                    CMPA    21,DL
         6 000123   000117 602000 6                  TNC     s:489

      155      490    2                END;

      156      491    1           RETURN;

    491  6 000124   000000 702200 xent               TSX2  ! X66_ARET
      157      492    1   END KFF$USRTRM;

PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:31   
--  Include file information  --

   KF_DAT_R.:E05TOU  cannot be made into a system file and is referenced.
   KF$MSG_C.:E05TOU  is referenced.
   KF$MSG_SUBS.:E05TOU  is referenced.
   KF$SUBS.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KFF$USRTRM.
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:32   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @P$STA                    *0-0-0/c CHAR(8)     r     1 P$STA
     6-0-0/w UBIN        r     1 Y$CLS_CODE                10-0-0/w UBIN        r     1 Y$ID
    14-0-0/w UBIN        r     1 Y$NODE                    15-0-0/w UBIN        r     1 Y$SRCHFLG
     4-0-0/c CHAR(8)     r     1 Y$STA                     11-0-0/w UBIN        r     1 Y$TRMID

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(306)   r     1 KF_UTBL(0:20)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d ASTR(3528)  r     1 F$DCB


   Procedure KFF$USRTRM requires 85 words for executable code.
   Procedure KFF$USRTRM requires 18 words of local(AUTO) storage.

    No errors detected in file KFF$FECGMSG.:E05TSI    .
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:33   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:34   
          MINI XREF LISTING

F$DCB.ACTPOS
       126**DCL       126--REDEF
F$DCB.ARS
       101**DCL       101--REDEF
F$DCB.ATTR
       119**DCL       120--REDEF
F$DCB.BORROW
       134**DCL       134--REDEF     134--REDEF     134--REDEF
F$DCB.DCBNAME.L
       148**DCL       148--IMP-SIZ
F$DCB.EOMCHAR
       105**DCL       105--REDEF
F$DCB.FLDID
       129**DCL       129--REDEF
F$DCB.FORM$
       123**DCL       123--REDEF
F$DCB.FSECT
       139**DCL       139--REDEF
F$DCB.FSN
       116**DCL       116--REDEF     116--REDEF     117--REDEF
F$DCB.HEADER$
       122**DCL       122--REDEF
F$DCB.IXTNSIZE
       120**DCL       120--REDEF
F$DCB.LASTSTA$
       110**DCL       110--REDEF
F$DCB.LVL
       135**DCL       135--REDEF
F$DCB.NAME.C
       110**DCL       110--REDEF
F$DCB.NOEOF
       131**DCL       131--REDEF
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:35   
F$DCB.NRECS
       121**DCL       121--REDEF
F$DCB.NRECX
       140**DCL       140--REDEF
F$DCB.OHDR
       132**DCL       132--REDEF
F$DCB.ORG
       115**DCL       115--REDEF
F$DCB.PRECNO
       138**DCL       138--REDEF
F$DCB.RCSZ
       143**DCL       143--REDEF
F$DCB.RES
       111**DCL       111--REDEF
F$DCB.SETX
       123**DCL       123--REDEF
F$DCB.TAB$
       122**DCL       123--REDEF
F$DCB.TDA
       137**DCL       137--REDEF
F$DCB.WSN
       112**DCL       112--REDEF
KFB$FIFS
       446**DCL-ENT   456--CALL
KF_UTBL.DCBSTATION
       423**DCL       469>>IF        472<<ASSIGN    485<<ASSIGN
KF_UTBL.FEX
       422**DCL       487>>ASSIGN
KF_UTBL.FLAGS.EXCLDCB
       422**DCL       469>>IF        471<<ASSIGN    484<<ASSIGN
KF_UTBL.STATE
       421**DCL       467>>IF
KF_UTBL.STATION
       421**DCL       421--REDEF     469>>IF
KF_UTBL.TDTYP
       422**DCL       459>>ASSIGN    467>>IF
PL6.E3A0      #002=KFF$USRTRM File=KFF$FECGMSG.:E05TSI                           WED 07/30/97 00:22 Page:36   
P$STA
       432**DCL         8--PROC      454>>ASSIGN
Y$CLS_CODE
       434**DCL       459<<ASSIGN    460>>IF        477>>IF
Y$ID
       436**DCL       456<>CALL      459>>ASSIGN    469>>IF        484>>ASSIGN    485>>ASSIGN    487>>ASSIGN
Y$NODE
       440**DCL       487<<ASSIGN
Y$SRCHFLG
       441**DCL       486<<ASSIGN
Y$STA
       433**DCL       454<<ASSIGN    456<>CALL
Y$TRMID
       437**DCL       466<<DOINDEX   467>>IF        467>>IF        469>>IF        469>>IF        471>>ASSIGN
       472>>ASSIGN    488<<DOINDEX
