VERSION E05

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:1    
        1        1        /*M*  Ghost to serve as Journal owner and do CG journaling            */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
        8        8        FJJ$JAY: PROC MAIN;
        9        9        /**/
       10       10        %INCLUDE CP_6;
       11       91 S      %INCLUDE B$JIT_C;
       12       92        %INCLUDE FJ_DATA_R;
       13      104        %INCLUDE FM$CFU;
       14      149        %INCLUDE FM$SET;
       15      176        %INCLUDE CP_6_SUBS;
       16      716        %INCLUDE JG_GHOSTS_C;
       17      806        %INCLUDE JG_EVID_C;
       18     1031        %INCLUDE B_ERRORS_C;
       19     2158        %INCLUDE FJ_PERR_C;
       20     2171        %INCLUDE FJM_MACROS_C;
       21     2310        %INCLUDE ZI$JRNL;
       22     2418        %INCLUDE KC$CGBLK;
       23     2466        %JRNL_REC (STCLASS=STATIC);
       24     2541        %ZI$CGMSG (FPTN=CGJREC,STCLASS="BASED(C$)");
       25     2578        %ZI$CGDEL  (FPTN=CGDEL);
       26     2589        %FJ$OPNANSWR (FPTN=OPN_ANSWER);
       27     2599        %FJ$SUBS;
       28     2606        %FJ$CITE (NAME=JRNOPN,TYP=JRNL,STCLASS=BASED);
       29     2679        %FJ$CITE (NAME=JRNRENAME,TYP=RENAME,STCLASS=BASED);
       30     2752        %FJ$CITE (NAME=JRNCANCEL,TYP=CANCEL,STCLASS=BASED);
       31     2825        %FJ$CITE (NAME=JRNLIST,TYP=LIST,STCLASS=BASED);
       32     2898        %FJ$LISTANS;
       33     2904        %B$TCB;
       34     2907        %B$ALT;
       35     2915        %B$CGAURD;
       36     2934        %EQU_CG;
       37     2982        %F$DCB;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:2    
       38     3039        %B$JIT0;
       39     3128        %A$JIT6X;
       40     3131        %FM$SET;
       41     3136        %FM$CFU;
       42     3142        %FM$CFUN;
       43     3145        %FM$CFUA;
       44     3151        %FM$CFUX (BASED="BASED");
       45     3156
       46     3157        %EQU #JRNL=100;                         /* Number of journal DCBs*/
       47     3158        %EQU #CG=100;                           /* Number of comgroup DCBs*/
       48     3159        %FPT_EVENT (FPTN=JRNL_EVENTS,UENTRY=FJJ$EVENT);
       49     3173        %FPT_XCON (FPTN=JRNL_XCON,UENTRY=FJJ$XCON);
       50     3187
       51     3188        %FPT_WAIT (FPTN=WAIT_CSCG,UNITS=60);
       52     3202
       53     3203        %FPT_OPEN (FPTN=OPN_CSCG,DCB=M$CSCG,ASN=COMGROUP,NAME=CSCG_NAME,
       54     3204             SETSTA=JRNL_GHST,STCLASS=STATIC);
       55     3313        %FPT_READ (FPTN=RD_CSCG,DCB=M$CSCG,STCLASS=STATIC,WAIT=NO,
       56     3314             EVENT=%CSCG_RD_EV#,BUF=CSCG_BUF);
       57     3353        %VLP_NAME (FPTN=CSCG_NAME,NAME='CSCG',STCLASS=STATIC);
       58     3380        %VLP_SETSTA (FPTN=JRNL_GHST,STCLASS=STATIC,MYSTATION='JAYS',
       59     3381             DIRONLY=YES);
       60     3409        %FPT_WRITE (FPTN=WR_JRNL_RESULTS,DCB=M$CSCG,BUF=OPN_ANSWER,STATION=WR_CSCG_STA);
       61     3440        %VLP_STATION (FPTN=WR_CSCG_STA);
       62     3467
       63     3468        %FPT_GETDCB (FPTN=GET_JRNL_DCB,DCBNUM=XDCB);
       64     3483        %FPT_RELDCB (FPTN=REL_DCB,STCLASS=STATIC);
       65     3497
       66     3498        %FPT_OPEN (FPTN=CG_OPN,ASN=COMGROUP,FUN=IN,SN=CG_SN,SETSTA=CG_SETSTA);
       67     3607        %FPT_CGINFO (FPTN=CG_INFO,STCLASS=STATIC,JRNLSTA=CG_JSTA);
       68     3627        %VLP_STATION (FPTN=CG_JSTA,STCLASS=STATIC);
       69     3654        %VLP_JRNLFIDV (FPTN=JFID);
       70     3661        %FPT_READ (FPTN=CG_RD,STATION=CG_RDSTA,WAIT=NO,STCLASS=STATIC);
       71     3700        %VLP_STATION (FPTN=CG_RDSTA,DIRONLY=YES,MSGTYP=' ',LATCH=YES);
       72     3727        %VLP_SETSTA (FPTN=CG_SETSTA,MYSTATION='JRNLSTA');
       73     3755        %VLP_STATION (FPTN=RDSTA,STCLASS=BASED);
       74     3782        %VLP_SN (FPTN=CG_SN,N=1);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:3    
       75     3795        %FPT_UNLATCH (FPTN=FIN_CG_JRNL,INPUT=RERUN,STCLASS=STATIC,JOURNALED=YES);
       76     3812        %FPT_CLOSE (FPTN=CG_CLS);
       77     3854
       78     3855        %FPT_OPEN (FPTN=OPN_JRNL,ACS=JRNL,EXIST=OLDFILE,DISP=NAMED,FUN=CREATE,SN=CG_SN,
       79     3856                    CTG=YES,ASN=FILE,ORG=CONSEC);
       80     3965        %FPT_OPEN (FPTN=TOPN_JRNL,FUN=UPDATE,ASN=FILE,TEST=YES,FPARAM=JRNL_FIT,SN=CG_SN);
       81     4074        %FPT_WRITE (FPTN=WR_CG_JRNL);
       82     4105        %FPT_CLOSE (FPTN=CLS_JRNL,CHGATT=YES);
       83     4147        %FPT_CLOSE (FPTN=CLS_RNAME,CHGATT=YES);
       84     4189        %FPT_CVOL (FPTN=CVOL_JRNL);
       85     4204
       86     4205        %FPT_FWCG (FPTN=GET_MESS_ATTR);
       87     4224
       88     4225        %FPT_GDS (FPTN=GDS_CG,RESULTS=CG_V);
       89     4241        %FPT_GDS (FPTN=GDS_JRNL,RESULTS=JRNL_V);
       90     4257        %FPT_GDS (FPTN=GDS_JFID,RESULTS=JFID_V);
       91     4273        %FPT_GDS (FPTN=GDS_SN,RESULTS=SN_V);
       92     4289
       93     4290        %FPT_FID (FPTN=FID_JFID,ACCT=JACCT,NAME=JNAME,PASS=JPASS,ASN=JASN,
       94     4291                RES=OPN_JRNL.V.RES#);
       95     4314        %FPT_UNFID (FPTN=UNF_LIST,TEXTFID=FJ$LISTANS.TXT);
       96     4332
       97     4333        %FPT_RESCTL (FPTN=RELRES,RPSN=VLP_RPSN);
       98     4350        %FPT_RESCTL (FPTN=RELTAP,PRES=RESTAP);
       99     4367
      100     4368        %VLP_RPSN (DISP=REL);
      101     4383        %VLP_PRES (FPTN=RESTAP);
      102     4399
      103     4400        %FPT_KEYIN (FPTN=OCMSG,OCTYPE=SYSTEM);
      104     4419        %FPT_ERRMSG (FPTN=ERRMSG,BUF=OCERRBUF,INCLCODE=NO,RESULTS=ERRSLT,CODE=ERRCODE);
      105     4446        %VLR_ERRMSG (FPTN=ERRSLT);
      106     4468        %VLP_ACCT (FPTN=JACCT);
      107     4481        %VLP_NAME (FPTN=JNAME);
      108     4508        %VLP_PASS (FPTN=JPASS);
      109     4521        %VLP_SN (FPTN=SN,STCLASS=BASED);
      110     4534        %FJ$UATTR (FPTN=JATTR,STCLASS=BASED);
      111     4566        %FJ$UATTR (FPTN=ATTR_);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:4    
      112     4598
      113     4599        %FPT_TIME (FPTN=CG_TIME,SOURCE=CLOCK,DEST=UTS);
      114     4618        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:5    
      115     4619    1   DCL DAM$INIT ENTRY ALTRET;
      116     4620    1   DCL DAM$MAP ENTRY(5) ALTRET;
      117     4621    1   DCL XSF$LOCCODP ENTRY(2) ALTRET;
      118     4622    1   DCL FJJ$CJAY ENTRY ALTRET;
      119     4623    1   DCL FJJ$EVENT ENTRY ASYNC;              /* Event handler                      */
      120     4624    1   DCL FJJ$XCON ENTRY ASYNC;               /* Exit control procedure             */
      121     4625
      122     4626    1   DCL B$TCB$ PTR SYMREF;
      123     4627    1   DCL B$JIT$ PTR SYMREF;
      124     4628    1   DCL B$DS1$ PTR SYMREF;
      125     4629
      126     4630    1   DCL M$CSCG DCB;
      127     4631
      128     4632    1   DCL CFU$ PTR STATIC;
      129     4633    1   DCL CURSN$ PTR STATIC;
      130     4634    1   DCL JSN$ PTR;
      131     4635    1   DCL C$ PTR;
      132     4636    1   DCL CG$ PTR;
      133     4637    1   DCL 1 CGP REDEF CG$,
      134     4638    1         2 OFFSET UBIN(18) UNAL,
      135     4639    1         2 * UBIN(18) UNAL;
      136     4640    1   DCL CGFREE$ PTR;
      137     4641    1   DCL CGACTIVE$ PTR;
      138     4642    1   DCL J$ PTR;
      139     4643    1   DCL JRNLFREE$ PTR;
      140     4644    1   DCL JRNLACTIVE$ PTR;
      141     4645    1   DCL 1 CG_V STATIC DALIGNED,
      142     4646    1         2 BND UBIN(20) UNAL,
      143     4647    1         2 *  BIT(16) UNAL INIT('1111111110100000'B),
      144     4648    1         2 P$ PTR UNAL INIT(ADDR(NIL));
      145     4649    1   DCL 1 JRNL_V STATIC DALIGNED,
      146     4650    1         2 BND UBIN(20) UNAL,
      147     4651    1         2 *  BIT(16) UNAL INIT('1111111110100000'B),
      148     4652    1         2 P$ PTR UNAL INIT(ADDR(NIL));
      149     4653    1   DCL 1 JFID_V STATIC DALIGNED,
      150     4654    1         2 BND UBIN(20) UNAL INIT(0),
      151     4655    1         2 * BIT(16) UNAL INIT('1111111110100000'B),
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:6    
      152     4656    1         2 P$ PTR UNAL INIT(ADDR(NIL));
      153     4657    1   DCL 1 SN_V STATIC DALIGNED,
      154     4658    1         2 BND UBIN(20) UNAL INIT(0),
      155     4659    1         2 * BIT(16) UNAL INIT('1111111110100000'B),
      156     4660    1         2 P$ PTR UNAL INIT(ADDR(NIL));
      157     4661    1   DCL JASN UBIN(9) STATIC;
      158     4662    1   DCL 1 BVCTR BASED ALIGNED,
      159     4663    1         2 BND UBIN(20) UNAL,
      160     4664    1         2 * BIT(16) UNAL,
      161     4665    1         2 PTR$ PTR;
      162     4666    1   DCL 1 BPTR BASED ALIGNED,
      163     4667    1         2 OFFSET UBIN(18) UNAL,
      164     4668    1         2 * UBIN(18) UNAL;
      165     4669    1   DCL JRECORD(0:1023) UBIN STATIC;        /* Space for journal record           */
      166     4670    1   DCL I UBIN;
      167     4671    1   DCL K UBIN;
      168     4672    1   DCL  JN CHAR(JNAME.L#) BASED;
      169     4673    1   DCL DUMMY_SN CHAR(SNSZ)  BASED;
      170     4674    1   DCL SNSZ UBIN STATIC;
      171     4675    1   DCL DELFFLG BIT(1);
      172     4676    1   DCL FREE BIT(1);
      173     4677    1   DCL P$$ PTR BASED;
      174     4678        %VLP_ERRCODE (FPTN=ASNERR,ERR#=%E$ASNERR,FCG='0612'O,MID='12'O,SEV=4);
      175     4723        %VLP_ERRCODE (FPTN=NOSNERR,ERR#=%E$FJ_NOSN,FCG='0612'O,MID='12'O,SEV=4);
      176     4768        %VLP_ERRCODE (FPTN=NOAUTH,ERR#=%E$NOAUTH,FCG='0612'O,MID='12'O,SEV=0);
      177     4813        %VLP_ERRCODE (FPTN=NOJRNL,ERR#=%E$NOJRNL,FCG='0612'O,MID='12'O,SEV=0);
      178     4858        %VLP_ERRCODE (FPTN=JRNLCLSD,ERR#=%E$JRNLCLSD,FCG='0612'O,MID='12'O,SEV=4);
      179     4903        %VLP_ERRCODE (FPTN=JRNLSTAR,ERR#=%E$JRNLSTAR,FCG='0612'O,MID='12'O,SEV=4);
      180     4948        %VLP_ERRCODE(FPTN=NORENAME,ERR#=%E$NORENAME,FCG=FJ,MID=J,SEV=4,STCLASS=CONSTANT);
      181     4993        %VLP_ERRCODE(FPTN=NOTOWNER,ERR#=%E$NOTOWNER,FCG=FJ,MID=J,SEV=4,STCLASS=CONSTANT);
      182     5038    1   DCL CGEXISTS BIT(1) STATIC;
      183     5039
      184     5040    1   DCL OCBUF CHAR(100) STATIC;
      185     5041    1   DCL ERRBUF CHAR(240) STATIC;
      186     5042    1   DCL OCERRBUF(0:3) CHAR(120) STATIC;
      187     5043    1   DCL ERRCODE BIT(36) STATIC;
      188     5044    1   DCL ACCN CHAR(8);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:7    
      189     5045    1   DCL NAME CHAR(12);
      190     5046    1   DCL FACCN CHAR(8);
      191     5047    1   DCL PRIV BIT(36);
      192     5048    1   DCL EVENT UBIN;
      193     5049    1   DCL XDCB UBIN STATIC;
      194     5050
      195     5051        /* Structure for comgroup description     */
      196     5052
      197     5053    1   DCL 1 CG BASED ALIGNED,
      198     5054    1         2 LNK$ PTR,
      199     5055    1         2 ERR# UBIN,
      200     5056    1         2 DCB# UBIN,
      201     5057    1         2 JRNL$ PTR,
      202     5058    1         2 CFU UBIN,
      203     5059    1         2 HISDCB UBIN,               /* POFFW(USERS CG DCB)  */
      204     5060    1         2 HISUSER# UBIN,             /* CG openers user number  */
      205     5061              %KC$CGID (FPTN=ID,STCLASS=BASED,LVL=2,LAST=",");
      206     5087    1         2 BUF CHAR(1024);
      207     5088    1   DCL CG# UBIN STATIC INIT(0);
      208     5089    1   DCL CSCG_BUF(0:100) UBIN STATIC;        /* Buffer for CSCG input              */
      209     5090    1   DCL BUF$ PTR STATIC INIT(ADDR(CSCG_BUF));
      210     5091    1   DCL JRNL_FIT(0:1023) UBIN STATIC;
      211     5092    1   DCL F$ PTR STATIC;
      212     5093
      213     5094
      214     5095        /* Structure for journal file descriptions  */
      215     5096
      216     5097    1   DCL 1 JRNL BASED,
      217     5098    1         2 LNK$ PTR,
      218     5099    1         2 DCB# UBIN,
      219     5100    1         2 CFU UBIN,                  /* CFU OFFSET    */
      220     5101    1         2 ASN UBIN,                  /* TAPE OR FILE  */
      221     5102    1         2 CGCNT UBIN,                /* # CG USING THIS JOURNAL */
      222     5103    1         2 UTS UBIN,                  /* TIME WHEN USER=1 DETECTED */
      223     5104    1         2 PSN  CHAR(6),              /* FILE PACKSET NAME */
      224     5105    1         2 * UBIN(18) UNAL,
      225     5106    1         2 NAME,
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:8    
      226     5107    1           3 L UBIN(9) UNAL,
      227     5108    1           3 TXT CHAR(31),
      228     5109    1         2 ACCT CHAR(8),
      229     5110    1         2 RENAME,
      230     5111    1           3 L UBIN(9) UNAL,
      231     5112    1           3 TXT CHAR(31),
      232     5113    1         2 ATTR$ PTR;
      233     5114
      234     5115    1   DCL B_VERSION CHAR (1) SYMREF;
      235     5116    1   DCL 1 B$VERSIONB BASED,
      236     5117    1         2 C_ UBIN BYTE CALIGNED,
      237     5118    1         2 T_ CHAR (B$VERSIONB.C_) CALIGNED;
      238     5119
      239     5120        %FPT_WRITE(FPTN=GREETING,
      240     5121                   DCB =M$GREETING,
      241     5122                   BUF =OUTLINE,
      242     5123                   WAIT=YES);
      243     5154    1   DCL OUTLINE CHAR (80) STATIC CALIGNED INIT(' ');
      244     5155    1   DCL M$GREETING DCB;
      245     5156
      246     5157        %EJECT
      247     5158
      248     5159    1         CALL CONCAT(OUTLINE,'JAYS ',ADDR(B_VERSION)->
      249     5160    1            B$VERSIONB.T_,' here');
      250     5161    1         CALL M$WRITE(GREETING);
      251     5162        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:9    
      252     5163        /* If not the system ghost, do user requests.                      */
      253     5164
      254     5165    2         IF B$JIT$->B$JIT.SYSID ~= %JG_JAYS# THEN DO;
      255     5166    2            CALL FJJ$CJAY ALTRET(STARSTAR);
      256     5167    2            CALL M$EXIT;
      257     5168    2            END;
      258     5169    1   STARSTAR:;
      259     5170        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:10   
      260     5171        /* Initialization.  Get space in data segments for CG journal station
      261     5172           tables and Journal File stations.  If MM ALTRETs to us let it
      262     5173           go to abort since theres nothing else that can be done.
      263     5174           Set up the event handler entry.  Open to CSCG and do the first
      264     5175           no-wait read to get started.  Again, if any of these fail, theres
      265     5176           nothing else to do but abort.                                      */
      266     5177
      267     5178    1         GDS_JFID.V.SEGSIZE#=1024;
      268     5179    1         GDS_SN.V.SEGSIZE#=1024;
      269     5180    1         GDS_JRNL.V.SEGSIZE#=1024;
      270     5181    1         GDS_CG.V.SEGSIZE#=1024;
      271     5182    1         CALL M$GDS (GDS_JRNL);
      272     5183    1         JRNLFREE$=JRNL_V.P$;
      273     5184    1         J$=JRNLFREE$;
      274     5185    2         DO WHILE (PINCRW(J$,SIZEW(JRNL)) < PINCRC(JRNL_V.P$,JRNL_V.BND+1));
      275     5186    2            C$=J$;
      276     5187    2            J$->JRNL.LNK$=PINCRW(J$,SIZEW(JRNL));
      277     5188    2            J$=J$->JRNL.LNK$;
      278     5189    2            END;
      279     5190    1         C$->JRNL.LNK$=ADDR(NIL);
      280     5191    1         CGACTIVE$=ADDR(NIL);
      281     5192    1         JRNLACTIVE$=ADDR(NIL);
      282     5193    1         CALL M$GDS (GDS_CG) ;
      283     5194    1         CGFREE$=CG_V.P$;
      284     5195    1         CG$=CGFREE$;
      285     5196    2         DO WHILE ( PINCRW(CG$,SIZEW(CG)) < PINCRC(CG_V.P$,CG_V.BND+1));
      286     5197    2            C$=CG$;
      287     5198    2            CG$->CG.LNK$=PINCRW(CG$,SIZEW(CG));
      288     5199    2            CG$=CG$->CG.LNK$;
      289     5200    2            END;
      290     5201    1         C$->CG.LNK$=ADDR(NIL);
      291     5202    1         CALL M$GDS (GDS_JFID);
      292     5203    1         CALL M$GDS (GDS_SN);
      293     5204    1         JSN$=SN_V.P$;
      294     5205    2         DO I = 0 TO %EV#;
      295     5206    2            FJ_EV.LNK(I)=I+1;
      296     5207    2            END;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:11   
      297     5208    1         FJ_EVFREE = 0;
      298     5209    1         FJ_EVHD=-1;
      299     5210    1         FJ_EVTL=-1;
      300     5211    1         FJ_EV.LNK(%EV#)=-1;
      301     5212        /* Initialize pointer to journal record area and point M$TIME at record */
      302     5213
      303     5214    1         JRNL$=ADDR(JRECORD);
      304     5215    1         CG_TIME.TSTAMP_=VECTOR(FILE.TIME);
      305     5216
      306     5217    1         CALL M$XCON (JRNL_XCON);
      307     5218    1         CALL M$EVENT(JRNL_EVENTS);
      308     5219    1         CALL DAM$INIT ALTRET(INITXXX);
      309     5220    2         DO WHILE ('0'B);
      310     5221    2   INITXXX: CALL M$XXX;              /* Abort if mapping dosn't work */
      311     5222    2            END;
      312     5223
      313     5224    1         CALL M$OPEN (OPN_CSCG);
      314     5225    1         CALL M$READ (RD_CSCG);
      315     5226        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:12   
      316     5227        /* Wait for results from no-wait reads of CSCG or comgroup journal
      317     5228           stations or events.  Keep inhibited until the event is pulled
      318     5229           from the event list.  When processing is completed, someone will
      319     5230           put the used entry back on a free event list.                      */
      320     5231
      321     5232    2         DO WHILE('1'B);
      322     5233    3            DO INHIBIT;
      323     5234    4               DO WHILE (FJ_EVHD < 0);
      324     5235    4                  CALL M$WAIT (WAIT_CSCG);
      325     5236    4                  CALL CHKJRNLS;
      326     5237    4                  END;
      327     5238    3               EVENT=FJ_EVHD;
      328     5239    3               FJ_EVHD=FJ_EV.LNK(FJ_EVHD);
      329     5240    3               IF FJ_EVHD < 0 THEN
      330     5241    3                  FJ_EVTL = FJ_EVHD;
      331     5242    3               END;                      /* end inhibit                        */
      332     5243        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:13   
      333     5244
      334     5245
      335     5246    3            DO CASE (FJ_EV.EVID(EVENT));
      336     5247    3             CASE(%CSCG_RD_EV#);         /* CSCG read completed                */
      337     5248    3               CALL DAM$MAP (B$DS1$,CFU$) ALTRET(INITXXX);
      338     5249    4               DO CASE(BUF$->JRNOPN.CODE);
      339     5250
      340     5251
      341     5252
      342     5253
      343     5254        /* Comgroup open.  Open to the comgroup as station JRNLSTA. Do a CGINFO to
      344     5255           find out the journal FID and open the journal file.  Make an entry
      345     5256           in the journal and read the CG journal station.  If the journal FID
      346     5257           has length zero, then we are to quit journaling.  If the FID changed
      347     5258           then we are to switch journal files.                               */
      348     5259
      349     5260    4                CASE(FJ_JRNOPN#,FJ_CGOPN#);
      350     5261    4                  WR_JRNL_RESULTS.BUF_=VECTOR(OPN_ANSWER);
      351     5262    4                  OPN_ANSWER.ERR='0'B;
      352     5263    4                  K=POFFW(BUF$->JRNOPN.P$,B$DS1$);
      353     5264    5                  IF PINCRW(CFU$,K)->FM$CFU.FUN ~= %JRNL# THEN DO;
      354     5265    5                     CGEXISTS='1'B;
      355     5266    5                     CG$=CGACTIVE$;
      356     5267    6                     DO WHILE (CG$~=ADDR(NIL));
      357     5268    6                        IF CG$->CG.CFU=K THEN
      358     5269    6                           GOTO HAVECG;
      359     5270    6                        CG$=CG$->CG.LNK$;
      360     5271    6                        END;
      361     5272
      362     5273    5                     CGEXISTS='0'B;
      363     5274    5                     CALL M$GETDCB (GET_JRNL_DCB) ALTRET(NODCB);
      364     5275    6                     DO INHIBIT;
      365     5276    7                        IF CGFREE$ = ADDR(NIL) THEN DO;
      366     5277    7                           CG$=PINCRW(CG_V.P$,((CG_V.BND+1)/SIZEC(CG))*SIZEW(CG));
      367     5278    7                           CGFREE$=CG$;
      368     5279    7                           CALL M$GDS (GDS_CG) ALTRET(OP_CG_ERR);
      369     5280    8                           DO WHILE (PINCRW(CG$,SIZEW(CG)) < PINCRC(CG_V.P$,CG_V.BND+1)
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:14   
              5280                                    );
      370     5281    8                              C$=CG$;
      371     5282    8                              CG$->CG.LNK$=PINCRW(CG$,SIZEW(CG));
      372     5283    8                              CG$=CG$->CG.LNK$;
      373     5284    8                              END;
      374     5285    7                           C$->CG.LNK$=ADDR(NIL);
      375     5286    7                           END;
      376     5287    6                        CG$=CGFREE$;       /* Get a free CG list entry           */
      377     5288    6                        CGFREE$=CG$->CG.LNK$;
      378     5289    6                        CG$->CG.LNK$=CGACTIVE$;
      379     5290    6                        CGACTIVE$=CG$;     /* Link active CG entries             */
      380     5291    6                        END;
      381     5292    5                     CG$->CG.CFU=K;
      382     5293    5                     CG$->CG.HISDCB=ADDR(BUF$->JRNOPN.DCB$)->BPTR.OFFSET;
      383     5294    5                     CG$->CG.HISUSER#=BUF$->JRNOPN.USER#;
      384     5295    5                     I=PINCRW(CFU$,K)->FM$CFU.NAMEX;
      385     5296    6                     DO WHILE ( I<=CFU$->FM$CFUX.CFUT );
      386     5297    6                        I=PINCRW(CFU$,I)->FM$CFU.NAMEX;
      387     5298    6                        END;
      388     5299    5                     CG$->CG.ID.NAME#.CNT=
      389     5300    5                        PINCRC(CFU$,I)->FM$CFUN.L;
      390     5301    5                     CG$->CG.ID.NAME#.TXT=
      391     5302    5                        PINCRC(CFU$,I)->FM$CFUN.C;
      392     5303    5                     CG$->CG.ID.ACCT#=
      393     5304    5                        PINCRW(CFU$,PINCRW(CFU$,K)->FM$CFU.ACCTX)->FM$CFUA.ACCT;
      394     5305    5                     CG$->CG.ID.PSN#=
      395     5306    5                        CFU$->FM$SET.PSN(PINCRW(CFU$,PINCRW(CFU$,K)->FM$CFU.ACCTX)->
              5306                                 FM$CFUA.SETX);
      396     5307    5                     CG$->CG.DCB#=XDCB;
      397     5308    5                     CG$->CG.JRNL$=ADDR(NIL);
      398     5309    5                     CG_OPN.ACCT_=VECTOR(CG$->CG.ID.ACCT#);
      399     5310    5                     CG_OPN.NAME_=VECTOR(CG$->CG.ID.NAME#);
      400     5311    5                     CG_SN.SN#(0)= CG$->CG.ID.PSN#;
      401     5312    5                     CG_OPN.V.DCB#=CG$->CG.DCB#;
      402     5313    5                     CALL M$OPEN (CG_OPN) ALTRET(OP_CG_ERR);
      403     5314
      404     5315        /* Get FID for journal file from CGINFO.                              */
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:15   
      405     5316
      406     5317    5   HAVECG:           CG_INFO.V.DCB#=CG$->CG.DCB#;
      407     5318    5                     CG_INFO.JRNLFID_=JFID_V;
      408     5319    5   GETCGINFO:        CALL M$CGINFO (CG_INFO) ALTRET(JRNLERR);
      409     5320    5                     IF JFID_V.P$->JFID.L# = 0 THEN
      410     5321    5                        GOTO QUITCGJRNL;
      411     5322    5                     IF JFID_V.P$->JFID.L#+SIZEC(JFID_V.P$->JFID.L#)-1 >
      412     5323    6                        JFID_V.BND THEN DO;
      413     5324    6                        GDS_JFID.V.SEGSIZE#=(JFID_V.P$->JFID.L#+SIZEC(JFID_V.P$->JFID.
              5324                                 L#)
      414     5325    6                           -JFID_V.BND+2)/4;
      415     5326    6                        CALL M$GDS (GDS_JFID) ALTRET(JRNLERR);
      416     5327    6                        GOTO GETCGINFO;
      417     5328    6                        END;
      418     5329
      419     5330        /* Try to make sure there will be enough space for serial number.     */
      420     5331
      421     5332    5                     CURSN$=PINCRW(JSN$,1);
      422     5333    5   GSNS1:            SNSZ=POFFC(PINCRC(SN_V.P$,SN_V.BND+1),CURSN$)-SIZEC(JATTR)+4;
      423     5334    6                     IF SNSZ < 16 THEN DO;
      424     5335    6   GSNS2:               CALL M$GDS (GDS_SN) ALTRET(JRNLERR);
      425     5336    6                        GOTO GSNS1;
      426     5337    6                        END;
      427     5338
      428     5339    5                     FID_JFID.TEXTFID_=JFID_V;
      429     5340    5                     ADDR(FID_JFID.TEXTFID_)->BVCTR.PTR$=PINCRC(JFID_V.P$,2);
      430     5341    5                     ADDR(FID_JFID.TEXTFID_)->BVCTR.BND=JFID_V.P$->JFID.L#-1;
      431     5342    5                     FID_JFID.SN_=VECTOR(ADDR(CURSN$->JATTR.Q.NUM#)->DUMMY_SN);
      432     5343    5                     CALL M$FID (FID_JFID) ALTRET(FIDERR);
      433     5344
      434     5345    6                     DO WHILE ('0'B);
      435     5346    6   FIDERR:              IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$FIDOFLOW
      436     5347    6                           AND (CURSN$->JATTR.Q.NUM#*6+3)/4 + SIZEC(JATTR)
      437     5348    6                           +POFFC(CURSN$,SN_V.P$)-1 > SN_V.BND THEN
      438     5349    6                           GOTO GSNS2;
      439     5350    6                        GOTO JRNLERR;
      440     5351    6                        END;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:16   
      441     5352
      442     5353        /* Check if the journal FID changed.  If it didn't, just return.
      443     5354           If it did, write a comgroup close record on the old journal and
      444     5355           open the new one.  If there wasn't a journal for the comgroup,
      445     5356           go ahead and open the new one.
      446     5357                                                                              */
      447     5358    6                     IF CG$->CG.JRNL$ ~= ADDR(NIL) THEN DO;
      448     5359    6                        IF CG$->CG.JRNL$->JRNL.NAME.L = JNAME.L# AND
      449     5360    6                           ADDR(CG$->CG.JRNL$->JRNL.NAME.TXT)->JN = ADDR(JNAME.NAME#)->
              5360                                    JN AND
      450     5361    6                           CG$->CG.JRNL$->JRNL.ACCT = JACCT.ACCT# THEN
      451     5362    6                           GOTO XIT_CSCG_RD;
      452     5363    6                        CALL WRBERC ALTRET(JRNLERR);
      453     5364    6                        CG$->CG.JRNL$->JRNL.CGCNT=CG$->CG.JRNL$->JRNL.CGCNT-1;
      454     5365    6                        END;
      455     5366
      456     5367        /* Check to see if we're already the owner of the journal file,
      457     5368           or if we already have it opened.
      458     5369                                                        */
      459     5370    5                     J$=JRNLACTIVE$;
      460     5371    6                     DO WHILE (J$ ~= ADDR(NIL));
      461     5372    6                        IF J$->JRNL.ACCT = JACCT.ACCT# AND
      462     5373    6                           J$->JRNL.NAME.L = JNAME.L# AND
      463     5374    6                           ADDR(J$->JRNL.NAME.TXT)->JN = ADDR(JNAME.NAME#)->JN THEN
      464     5375    6                           GOTO JRNL_EXISTS;
      465     5376    6                        J$=J$->JRNL.LNK$;
      466     5377    6                        END;
      467     5378
      468     5379        /* We don't know about it.  Get a DCB and open the journal file.
      469     5380                                                     */
      470     5381    5                     CALL GETJDCB ALTRET(JRNLERR);
      471     5382    5                     J$->JRNL.ASN=JASN;
      472     5383    5                     J$->JRNL.PSN=ADDR(CURSN$->JATTR.Q.NUM#)->SN.SN#(0);
      473     5384    5                     J$->JRNL.NAME=JNAME;
      474     5385    5                     J$->JRNL.ACCT=JACCT.ACCT#;
      475     5386    5                     J$->JRNL.ATTR$=CURSN$;
      476     5387    5                     JSN$->P$$=J$;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:17   
      477     5388    5                     JSN$=PINCRW(CURSN$,(CURSN$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR));
      478     5389
      479     5390    5                     J$->JRNL.CFU=0;
      480     5391    5                     CALL OPN_CG_JRNL ALTRET(OPNJERR);
      481     5392
      482     5393    5   JRNL_EXISTS:      CG$->CG.JRNL$=J$;
      483     5394    5                     J$->JRNL.CGCNT=J$->JRNL.CGCNT+1;
      484     5395    6                     IF JFID_V.BND > 4095 THEN DO;
      485     5396    6                        GDS_JFID.V.SEGSIZE#=(JFID_V.BND-4095)/4;
      486     5397    6                        CALL M$GDS (GDS_JFID);
      487     5398    6                        END;
      488     5399
      489     5400
      490     5401        /* Build a File Open record for the journal file describing CG open  */
      491     5402    5                     FILE='0'B;
      492     5403    5                     FILE.TYPE=T#FID;
      493     5404    5                     FILE.DCB#=CG$->CG.HISDCB;
      494     5405    5                     FILE.USER#=CG$->CG.HISUSER#;
      495     5406    5                     FILE.ID.ACCT#=CG$->CG.ID.ACCT#;
      496     5407    5                     FILE.ID.NAME#=CG$->CG.ID.NAME#;
      497     5408    5                     FILE.ID.PSN#=CG$->CG.ID.PSN#;
      498     5409    5                     FILE.ID.PASS#=' ';
      499     5410    5                     FILE.COMGROUP='1'B;
      500     5411    5                     CG_TIME.TSTAMP_=VECTOR(FILE.TIME);
      501     5412    5                     CALL M$TIME (CG_TIME);
      502     5413    5                     WR_CG_JRNL.V.DCB#=J$->JRNL.DCB#;
      503     5414    5                     WR_CG_JRNL.BUF_=VECTOR(FILE);
      504     5415    5                     CALL M$WRITE (WR_CG_JRNL) ALTRET(JRNLERR);
      505     5416    5                     CG_RD.V.EVENT#=1000+CGP.OFFSET;
      506     5417    5                     CG_RD.V.DCB#=CG_OPN.V.DCB#;
      507     5418    5                     CG_RD.BUF_.BOUND=SIZEC(CG.BUF)-POFFC(ADDR(CGJREC.MESS),
      508     5419    5                        ADDR(CGJREC))-1;
      509     5420    5                     CG_RD.BUF_.BUF$=ADDR(ADDR(CG$->CG.BUF)->CGJREC.MESS);
      510     5421
      511     5422        /* Read the comgroup for messages to journal.                         */
      512     5423
      513     5424    5                     CALL M$READ (CG_RD) ALTRET(JRNLERR);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:18   
      514     5425
      515     5426
      516     5427    6                     DO WHILE ('0'B);
      517     5428    6   NODCB:               OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      518     5429    6                        END;
      519     5430
      520     5431    6                     DO WHILE ('0'B);
      521     5432    6   OP_CG_ERR:           OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      522     5433    6                        GOTO CLSCGERR1;
      523     5434    6   OPNJERR0:            OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      524     5435    6   OPNJERR:             REL_DCB.V.DCB#=J$->JRNL.DCB#;
      525     5436    6                        CALL M$RELDCB (REL_DCB) ALTRET(OPNJER1);
      526     5437    6   OPNJER1:             CALL FREEJRNL;
      527     5438    6                        GOTO OPNJER2;
      528     5439        /*  Release CG DCB, free CG table entry and report error to OPEN. */
      529     5440
      530     5441    6   JRNLERR:             OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      531     5442    7   OPNJER2:             DO WHILE (CG$ ~= ADDR(NIL));
      532     5443    7                           CG_CLS.V.DCB#=CG$->CG.DCB#;
      533     5444    7                           I=DCBADDR(CG$->CG.DCB#)->F$DCB.FCN.CNT(0);
      534     5445    7                           CALL M$CLOSE (CG_CLS) ALTRET(CLSCGERR1);
      535     5446    7                           IF I ~= 0 THEN
      536     5447    7                              GOTO XIT_CSCG_RD;
      537     5448    7   CLSCGERR1:              ;
      538     5449    7                           REL_DCB.V.DCB#=CG$->CG.DCB#;
      539     5450    7                           CALL M$RELDCB (REL_DCB);
      540     5451    7                           CALL FREECG;
      541     5452    7                           END;
      542     5453    6                        END;
      543     5454        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:19   
      544     5455    6                     DO WHILE ('0'B);
      545     5456    6   QUITCGJRNL:          CG_CLS.V.DCB#=CG$->CG.DCB#;
      546     5457    6                        IF CG$->CG.JRNL$ = ADDR(NIL) THEN
      547     5458    6                           CALL CLSCG; /* No outstanding reads to cleanup  */
      548     5459    6                        ELSE
      549     5460    6                           CALL M$CLOSE (CG_CLS) ALTRET(QCGJ1);
              5460                                    /* Deactivate will cleanup  */
      550     5461    6   QCGJ1:               ;
      551     5462    6                        END;
      552     5463
      553     5464    5                     END;
      554     5465    5                  ELSE DO;
      555     5466
      556     5467        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:20   
      557     5468        /* Journal file open.  Open the journal file as the owner.            */
      558     5469    5                     J$=JRNLACTIVE$;
      559     5470    5                     CG$=ADDR(NIL);
      560     5471    6                     DO WHILE (J$ ~= ADDR(NIL));
      561     5472    6                        IF J$->JRNL.CFU = K THEN
      562     5473    6                           GOTO XIT_CSCG_RD;
      563     5474    6                        J$=J$->JRNL.LNK$;
      564     5475    6                        END;
      565     5476
      566     5477
      567     5478    5                     CALL GETJDCB ALTRET(XIT_CSCG_RD);
      568     5479
      569     5480    5                     I=PINCRW(CFU$,K)->FM$CFU.NAMEX;
      570     5481    6                     DO WHILE ( I<=CFU$->FM$CFUX.CFUT );
      571     5482    6                        I=PINCRW(CFU$,I)->FM$CFU.NAMEX;
      572     5483    6                        END;
      573     5484    5                     J$->JRNL.NAME.L=
      574     5485    5                        PINCRC(CFU$,I)->FM$CFUN.L;
      575     5486    5                     J$->JRNL.NAME.TXT=
      576     5487    5                        PINCRC(CFU$,I)->FM$CFUN.C;
      577     5488    5                     J$->JRNL.CFU=K;
      578     5489    5                     J$->JRNL.CGCNT=0;
      579     5490    5                     J$->JRNL.ATTR$=ADDR(NIL);
      580     5491    5                     OPN_ANSWER.ERR = JRNLCLSD;
      581     5492    5                     IF PINCRW(CFU$,K)->FM$CFU.ACCTX =1 THEN
      582     5493    5                        GOTO OPNJERR;
      583     5494    5                     OPN_ANSWER.ERR = JRNLSTAR;
      584     5495    5                     IF PINCRW(CFU$,K)->FM$CFU.STARX.F ~= 0 THEN
      585     5496    5                        GOTO OPNJERR;
      586     5497    5                     OPN_ANSWER.ERR = '0'B;
      587     5498    5                     J$->JRNL.ACCT=
      588     5499    5                        PINCRW(CFU$,PINCRW(CFU$,K)->FM$CFU.ACCTX)->FM$CFUA.ACCT;
      589     5500    5                     J$->JRNL.PSN=
      590     5501    5                        CFU$->FM$SET.PSN(PINCRW(CFU$,PINCRW(CFU$,K)->FM$CFU.ACCTX)->
              5501                                 FM$CFUA.SETX);
      591     5502
      592     5503    5                     OPN_JRNL.V.RES# = 'DP  ';
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:21   
      593     5504    5                     CG_SN.SN#(0)=J$->JRNL.PSN;
      594     5505    5                     CALL TESTOPEN ALTRET(OPNJERR0);
      595     5506    5                     J$->JRNL.ASN = %FILE#;
      596     5507    5                     F$=ADDR(JRNL_FIT);
      597     5508    5                     CALL XSF$LOCCODP (F$,11) ALTRET(OPNJRNL);
      598     5509    5                     F$=PINCRW(F$,-1);
      599     5510    5                     IF F$->JATTR.Q.ID ~= ATTR_.Q.ID THEN
      600     5511    5                        GOTO OPNJERR0;
      601     5512    5                     J$->JRNL.ASN=F$->JATTR.Q.ASN;
      602     5513    5                     IF F$->JATTR.Q.ASN = %FILE# THEN
      603     5514    5                        GOTO OPNJRNL;
      604     5515
      605     5516        /* Tape Journal   */
      606     5517        /* Use SN from file    */
      607     5518
      608     5519    5   USE_FILE_SN:
      609     5520    5                     CURSN$=PINCRW(JSN$,1);
      610     5521    5   GSNSP:            SNSZ=POFFC(PINCRC(SN_V.P$,SN_V.BND+1),CURSN$)-SIZEC(JATTR)+4;
      611     5522    6                     IF SNSZ < (F$->JATTR.Q.NUM#*6+3)/4+4 THEN DO;
      612     5523    6                        CALL M$GDS (GDS_SN) ALTRET(OPNJERR0);
      613     5524    6                        GOTO GSNSP;
      614     5525    6                        END;
      615     5526    5                     J$->JRNL.ATTR$=CURSN$;
      616     5527    5                     JSN$->P$$=J$;
      617     5528    5                     JSN$=PINCRW(CURSN$,(F$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR));
      618     5529    5                     J$->JRNL.ATTR$->JATTR = F$->JATTR;
      619     5530    5                     SNSZ=F$->JATTR.Q.NUM#*6+4;
      620     5531    5                     CURSN$=ADDR(J$->JRNL.ATTR$->JATTR.Q.NUM#);
      621     5532    5                     CURSN$->DUMMY_SN=ADDR(F$->JATTR.Q.NUM#)->DUMMY_SN;
      622     5533    5   SETSN_:
      623     5534    5                     OPN_JRNL.SN_=VECTOR(ADDR(J$->JRNL.ATTR$->JATTR.Q.NUM#)->DUMMY_SN);
      624     5535    5                     OPN_JRNL.V.RES# = 'MT  ';
      625     5536    5                     OPN_JRNL.V.VOL#=J$->JRNL.ATTR$->JATTR.Q.VOL#;
      626     5537    5                     IF J$->JRNL.ATTR$->JATTR.Q.VOL# = 0 THEN
      627     5538    5                        J$->JRNL.ATTR$->JATTR.Q.VOL# = 1;
      628     5539
      629     5540    5   OPNJRNL:          ;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:22   
      630     5541
      631     5542    5                     OPN_JRNL.V.DCB# = J$->JRNL.DCB#;
      632     5543    5                     OPN_JRNL.NAME_=VECTOR(J$->JRNL.NAME);
      633     5544    5                     OPN_JRNL.ACCT_=VECTOR(J$->JRNL.ACCT);
      634     5545    5                     OPN_JRNL.V.ASN#=J$->JRNL.ASN;
      635     5546    5                     CALL M$OPEN (OPN_JRNL) ALTRET(OPNJERR0);
      636     5547        /*E*
      637     5548        ERROR:  FJ-E$NOTOWNER
      638     5549        MESSAGE: JAYS cannot be the owner of this journal file.
      639     5550        MESSAGE1: Some other user has the journal file opened and
      640     5551                  is the journal owner.
      641     5552        */
      642     5553    6                     IF NOT DCBADDR(OPN_JRNL.V.DCB#)->F$DCB.OWNER THEN DO;
      643     5554    6                        OPN_ANSWER.ERR=NOTOWNER;
      644     5555    6                        GOTO OPNJERR;
      645     5556    6                        END;
      646     5557    5                     END;
      647     5558        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:23   
      648     5559    4                CASE(FJ_LIST_CMD);
      649     5560    4                  WR_CSCG_STA.STATION#=FJ_EV.STA(EVENT);
      650     5561    4                  WR_CSCG_STA.MSGTYP#=FJ_EV.MSG(EVENT);
      651     5562    4                  WR_JRNL_RESULTS.BUF_=VECTOR(FJ$LISTANS);
      652     5563    4                  FJ$LISTANS.LAST=0;
      653     5564    4                  FJ$LISTANS.ERR='0'B;
      654     5565    4                  J$=JRNLACTIVE$;
      655     5566    4                  FJ$LISTANS.TXT=' No active journals.';
      656     5567    5                  IF J$ ~= ADDR(NIL) THEN DO;
      657     5568    5   LST1:             CALL HISACCN (BUF$->JRNLIST.ACCN,BUF$->JRNLIST.UNAME,
      658     5569    5                        BUF$->JRNLIST.FACCN,BUF$->JRNLIST.PRIV);
      659     5570    5                     CALL TESTOPEN ALTRET(LST6);
      660     5571    5                     CALL MYACCN;
      661     5572    5                     UNF_LIST.V.DCB#=J$->JRNL.DCB#;
      662     5573    5                     CALL M$UNFID (UNF_LIST) ALTRET(LST2);
      663     5574    6                     IF J$->JRNL.RENAME.L ~= 0 THEN DO;
      664     5575    6                        CALL M$WRITE (WR_JRNL_RESULTS);
      665     5576    6                        CALL CONCAT (FJ$LISTANS.TXT,'   RENAMED TO: ',
      666     5577    6                           SUBSTR(J$->JRNL.RENAME.TXT,0,J$->JRNL.RENAME.L));
      667     5578    6                        END;
      668     5579    5   LST2:             J$=J$->JRNL.LNK$;
      669     5580    5                     END;
      670     5581    4                  CALL M$WRITE (WR_JRNL_RESULTS);
      671     5582    4   LST22:
      672     5583    4                  IF J$ ~= ADDR(NIL) THEN
      673     5584    4                     GOTO LST1;
      674     5585    4   LST3:          J$=CGACTIVE$;
      675     5586    4                  FJ$LISTANS.TXT=' No active comgroup journal stations.';
      676     5587    4   LST33:
      677     5588    5                  IF J$ ~= ADDR(NIL) THEN DO;
      678     5589    5   LST4:             CALL HISACCN (BUF$->JRNLIST.ACCN,BUF$->JRNLIST.UNAME,
      679     5590    5                        BUF$->JRNLIST.FACCN,BUF$->JRNLIST.PRIV);
      680     5591    5                     CALL TESTOPENCG ALTRET(LST7);
      681     5592    5                     CALL MYACCN;
      682     5593    5                     UNF_LIST.V.DCB#=J$->CG.DCB#;
      683     5594    5                     CALL M$UNFID (UNF_LIST) ALTRET(LST5);
      684     5595    5   LST5:             J$=J$->CG.LNK$;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:24   
      685     5596    5                     END;
      686     5597    5                  IF J$=ADDR(NIL) THEN DO;
      687     5598    5                     FJ$LISTANS.LAST=1;
      688     5599    5                     GOTO XIT_CSCG_RD;
      689     5600    5                     END;
      690     5601    4                  CALL M$WRITE(WR_JRNL_RESULTS);
      691     5602    4                  GOTO LST4;
      692     5603
      693     5604    4   LST6:          CALL MYACCN;
      694     5605    4                  J$ = J$->JRNL.LNK$;
      695     5606    4                  GOTO LST22;
      696     5607
      697     5608    4   LST7:          CALL MYACCN;
      698     5609    4                  J$=J$->CG.LNK$;
      699     5610    4                  FJ$LISTANS.TXT='  ';
      700     5611    4                  GOTO LST33;
      701     5612        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:25   
      702     5613    4                CASE(FJ_RENAME_CMD);
      703     5614    4                  CG$=ADDR(NIL);
      704     5615    4                  WR_JRNL_RESULTS.BUF_=VECTOR(OPN_ANSWER);
      705     5616    4                  OPN_ANSWER.ERR='0'B;
      706     5617    4                  CALL HISACCN (BUF$->JRNRENAME.ACCN,BUF$->JRNRENAME.UNAME,
      707     5618    4                     BUF$->JRNRENAME.FACCN,BUF$->JRNRENAME.PRIV);
      708     5619    4                  CALL LOCJRNL (BUF$->JRNRENAME.FID1.FNAME,
      709     5620    4                     BUF$->JRNRENAME.FID1.ACCT)
      710     5621    5                  WHENRETURN DO;
      711     5622    5                     FREE=%NO#;
      712     5623    5                     END;
      713     5624    5                  WHENALTRETURN DO;
      714     5625    5                     FREE=%YES#;
      715     5626    5                     CALL GETJDCB ALTRET(XIT_CSCG_RD);
      716     5627    5                     J$->JRNL.ASN=%FILE#;
      717     5628    5                     J$->JRNL.PSN=BUF$->JRNRENAME.FID1.SN.SN#;
      718     5629    5                     J$->JRNL.NAME=BUF$->JRNRENAME.FID1.FNAME;
      719     5630    5                     J$->JRNL.ACCT=BUF$->JRNRENAME.FID1.ACCT;
      720     5631    5                     J$->JRNL.ATTR$=ADDR(NIL);
      721     5632    5                     OPN_JRNL.V.ASN#=J$->JRNL.ASN;
      722     5633    5                     OPN_JRNL.V.RES#='DP  ';
      723     5634    5                     OPN_JRNL.V.DCB#=J$->JRNL.DCB#;
      724     5635    5                     OPN_JRNL.NAME_=VECTOR(J$->JRNL.NAME);
      725     5636    5                     OPN_JRNL.ACCT_=VECTOR(J$->JRNL.ACCT);
      726     5637    5                     CG_SN.SN#(0)=J$->JRNL.PSN;
      727     5638    5                     CALL M$OPEN(OPN_JRNL) ALTRET(TSTOPNERR);
      728     5639    5                     J$->JRNL.CFU=POFFW(DCBADDR(J$->JRNL.DCB#)->F$DCB.CFU$,
      729     5640    5                        B$DS1$);
      730     5641    6                     IF NOT DCBADDR(OPN_JRNL.V.DCB#)->F$DCB.OWNER THEN DO;
      731     5642        /*                      Not the journal owner.  Cant rename. */
      732     5643    6                        OPN_ANSWER.ERR=NORENAME;
      733     5644        /*E*
      734     5645        ERROR:  FJ-E$NORENAME
      735     5646        MESSAGE: The journal could not be renamed by JAYS.
      736     5647        MESSAGE1: Someone other than JAYS is currently the journal owner.
      737     5648        */
      738     5649    6                        GOTO TSTOPNERR1;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:26   
      739     5650    6                        END;
      740     5651    5                     END;
      741     5652
      742     5653    4                  CALL TESTOPEN ALTRET(TSTOPNERR);
      743     5654    4                  CALL MYACCN;
      744     5655    5                  IF DELFFLG THEN DO;
      745     5656    5                     CLS_RNAME.V.DCB#=J$->JRNL.DCB#;
      746     5657    5                     CLS_RNAME.NAME_=VECTOR(BUF$->JRNRENAME.FID2.FNAME);
      747     5658    5                     CALL M$CLOSE(CLS_RNAME) ALTRET(JRNLERR);
      748     5659    5                     END;
      749     5660    4                  ELSE
      750     5661    4                     OPN_ANSWER.ERR=NOAUTH;      /* If not, error him  */
      751     5662
      752     5663    4                  IF FREE THEN
      753     5664    4                     CALL CLSJRNL;
      754     5665
      755     5666
      756     5667    5                  DO WHILE ('0'B);
      757     5668    5   TSTOPNERR:        OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      758     5669    5   TSTOPNERR1:       IF FREE THEN
      759     5670    5                        CALL CLSJRNL;
      760     5671    5                     CALL MYACCN;
      761     5672    5                     END;
      762     5673
      763     5674        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:27   
      764     5675    4                CASE(FJ_CANCEL_CMD);
      765     5676    4                  CG$=ADDR(NIL);
      766     5677    4                  WR_JRNL_RESULTS.BUF_=VECTOR(OPN_ANSWER);
      767     5678    4                  OPN_ANSWER.ERR='0'B;
      768     5679    4                  CALL LOCJRNL (BUF$->JRNCANCEL.FID1.FNAME,BUF$->JRNCANCEL.FID1.ACCT)
      769     5680    4                     ALTRET(RNM2);
      770     5681    4                  CALL HISACCN (BUF$->JRNCANCEL.ACCN,BUF$->JRNCANCEL.UNAME,
      771     5682    4                     BUF$->JRNCANCEL.FACCN,BUF$->JRNCANCEL.PRIV);
      772     5683    4                  CALL TESTOPEN
      773     5684    5                  WHENALTRETURN DO;
      774     5685    5                     FREE=%NO#;
      775     5686    5                     GOTO TSTOPNERR;
      776     5687    5                     END;
      777     5688    4                  CALL MYACCN;
      778     5689    5                  IF DELFFLG THEN DO;
      779     5690                      /* If he has DELF access then go ahead*/
      780     5691    5                     CG$=CGACTIVE$;
      781     5692    6                     DO WHILE (CG$ ~= ADDR(NIL));
      782     5693    7                        IF CG$->CG.JRNL$ = J$ THEN DO;
      783     5694    7                           J$->JRNL.CGCNT=J$->JRNL.CGCNT-1;
      784     5695    7                           CG$->CG.JRNL$=ADDR(NIL);
      785     5696    7                           CG_CLS.V.DCB#=CG$->CG.DCB#;
      786     5697    7                           CALL CLSCGMSG;
      787     5698    7                           CALL M$CLOSE (CG_CLS) ALTRET(CNCL1);
      788     5699    7   CNCL1:                  ;
      789     5700    7                           END;
      790     5701    6                        CG$=CG$->CG.LNK$;
      791     5702    6                        END;
      792     5703    5                     CALL CLSJRNL;
      793     5704    5                     END;
      794     5705    4                  ELSE
      795     5706    4                     OPN_ANSWER.ERR=NOAUTH;
      796     5707    5                  DO WHILE ('0'B);
      797     5708    5   RNM2:             OPN_ANSWER.ERR=NOJRNL;
      798     5709    5                     END;
      799     5710        /*E*    ERROR: FJJ-E$NOAUTH
      800     5711                MESSAGE: You are not authorized to rename or cancel journal.
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:28   
      801     5712                MESSAGE1: You must have DELF authorization to do that.
      802     5713        */
      803     5714        /*E*    ERROR: FJJ-E$NOJRNL
      804     5715                MESSAGE: That journal is unknown to JAYS
      805     5716                MESSAGE1: JAYS does not currently have the journal open.
      806     5717        */
      807     5718    4                END;                     /* end of CSCG events                 */
      808     5719
      809     5720
      810     5721        /* If any errors occur on read or write of CSCG, let the ghost abort.
      811     5722           The XCON routine will try to snap and explain things.  There isn't
      812     5723           anything to be done if we can't get at CSCG.                       */
      813     5724
      814     5725    3   XIT_CSCG_RD: WR_CSCG_STA.STATION#=FJ_EV.STA(EVENT);
      815     5726    3               WR_CSCG_STA.MSGTYP#=FJ_EV.MSG(EVENT);
      816     5727    3               CALL M$WRITE (WR_JRNL_RESULTS);
      817     5728    3               CALL FREEEV;
      818     5729    3               CALL M$READ (RD_CSCG);
      819     5730        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:29   
      820     5731
      821     5732        /* Comgroup read completed event          */
      822     5733    3             CASE(%CG_RD_EV#);
      823     5734    3               CG$=PINCRW(CG_V.P$,FJ_EV.CG#(EVENT));
      824     5735    3               C$=CGACTIVE$;
      825     5736    4               DO WHILE C$ ~= CG$;
      826     5737    4                  IF C$ = ADDR(NIL) THEN
      827     5738    4                     GOTO FREE_RD_EV;
      828     5739    4                  C$=C$->CG.LNK$;
      829     5740    4                  END;
      830     5741    3               C$=ADDR(CG$->CG.BUF);
      831     5742
      832     5743    3               IF DCBADDR(CG$->CG.DCB#)->F$DCB.LASTSTA$->RDSTA.MSGTYP#
      833     5744    3                  = '*AUEV' AND FJ_EV.ERR.ERR#(EVENT) = 0 THEN
      834     5745    4               DO CASE (ADDR(CGJREC.MESS)->B$CGAURD.EVENT);
      835     5746
      836     5747        /* Comgroup message deleted                                           */
      837     5748
      838     5749    4                CASE(%CG_JNLD#);
      839     5750    4                  CGDEL.TYPE=T#CGDEL;
      840     5751    4                  CGDEL.MSGID.PRIMARY=ADDR(CGJREC.MESS)->B$CGAURD.MID.MSGID;
      841     5752    4                  CGDEL.MSGID.XT=ADDR(CGJREC.MESS)->B$CGAURD.MID.MSGIDXT;
      842     5753    4                  CGDEL.DCB#=CG$->CG.HISDCB;
      843     5754    4                  CGDEL.USER#=CG$->CG.HISUSER#;
      844     5755    4                  CG_TIME.TSTAMP_=VECTOR(CGDEL.TIME);
      845     5756    4                  CALL M$TIME (CG_TIME);
      846     5757    4                  WR_CG_JRNL.BUF_=VECTOR(CGDEL);
      847     5758    4                  WR_CG_JRNL.V.DCB#=CG$->CG.JRNL$->JRNL.DCB#;
      848     5759    4                  CALL M$WRITE (WR_CG_JRNL) ALTRET(WRJERR);
      849     5760    4                  CG_RD.V.DCB#=CG$->CG.DCB#;
      850     5761    4                  CG_RD.V.EVENT#=1000+CGP.OFFSET;
      851     5762    4                  CG_RD.BUF_.BOUND=SIZEC(CG.BUF)-POFFC(ADDR(CGJREC.MESS),
      852     5763    4                     ADDR(CGJREC))-1;
      853     5764    4                  CG_RD.BUF_.BUF$=ADDR(ADDR(CG$->CG.BUF)->CGJREC.MESS);
      854     5765    4                  CALL FREEEV;
      855     5766    4                  CALL M$READ (CG_RD) ALTRET(RDCGERR);
      856     5767    4                CASE(ELSE);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:30   
      857     5768    4                END;
      858     5769    3               ELSE
      859     5770    4               DO CASE (FJ_EV.ERR.ERR#(EVENT));
      860     5771    4                CASE(%E$DACTR);          /* This station was deactivated       */
      861     5772    4                  IF CG$->CG.JRNL$ ~= ADDR(NIL) THEN
      862     5773    4                     CALL WRBERC ALTRET(WRJERR);
      863     5774    4                  CALL CLSCG;
      864     5775    4                  CALL FREEEV;
      865     5776    4                CASE(%E$LD,0);           /* No error, or Lost Data             */
      866     5777    4                  CG_TIME.TSTAMP_=VECTOR(CGJREC.TIME);
      867     5778    4                  CALL M$TIME (CG_TIME);
      868     5779    4                  CGJREC.DCB#=CG$->CG.HISDCB;
      869     5780    4                  CGJREC.TYPE=T#CGMSG;
      870     5781    4                  CGJREC.USER#=CG$->CG.HISUSER#;
      871     5782    4                  IF FJ_EV.ERR.ERR#(EVENT)=%E$LD THEN
      872     5783    4                     CGJREC.CONT = '1'B;
      873     5784    5                  ELSE DO;
      874     5785        /* Get message parameters to go into journal record with message  */
      875     5786
      876     5787    5                     CGJREC.CONT = '0'B;
      877     5788    5                     GET_MESS_ATTR.ONEATTR_=VECTOR(CGJREC.MSGATTR);
      878     5789    5                     GET_MESS_ATTR.V.DCB#=CG$->CG.DCB#;
      879     5790    5                     CALL M$FWCG (GET_MESS_ATTR) ALTRET(RDCGERR);
      880     5791    5                     END;
      881     5792    4                  WR_CG_JRNL.V.DCB#=CG$->CG.JRNL$->JRNL.DCB#;
      882     5793    4                  WR_CG_JRNL.BUF_=VECTOR(CGJREC);
      883     5794    4                  WR_CG_JRNL.BUF_.BOUND=SIZEC(CGJREC)-SIZEC(CGJREC.MESS)+
      884     5795    4                     FJ_EV.ARS(EVENT) - 1;
      885     5796
      886     5797    4                  CALL M$WRITE (WR_CG_JRNL) ALTRET(WRJERR);
      887     5798
      888     5799    4                  IF CGJREC.CONT = '1'B THEN
      889     5800    4                     CG_RD.V.DVBYTE.CONT# = '1'B;
      890     5801    5                  ELSE DO;
      891     5802    5   CGUNLTCH:         FIN_CG_JRNL.V.DCB#=CG$->CG.DCB#;
      892     5803    5                     CALL M$UNLATCH (FIN_CG_JRNL) ALTRET(RDCGERR);
      893     5804    5                     CG_RD.V.DVBYTE.CONT# = '0'B;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:31   
      894     5805    5                     END;
      895     5806    4                  CG_RD.V.DCB#=CG$->CG.DCB#;
      896     5807    4                  CG_RD.V.EVENT#=1000+CGP.OFFSET;
      897     5808    4                  CG_RD.BUF_.BOUND=SIZEC(CG.BUF)-POFFC(ADDR(CGJREC.MESS),
      898     5809    4                     ADDR(CGJREC))-1;
      899     5810    4                  CG_RD.BUF_.BUF$=ADDR(ADDR(CG$->CG.BUF)->CGJREC.MESS);
      900     5811
      901     5812    4                  CALL FREEEV;
      902     5813    4                  CALL M$READ (CG_RD) ALTRET(RDCGERR);
      903     5814    4                CASE(ELSE);
      904     5815        /* Handle other comgroup read errors  */
      905     5816    4   RDCGERR:       CALL ERRMSG (FJ_EV.ERR(EVENT),CG$->CG.DCB#);
      906     5817    4                  CALL CLSCGMSG;
      907     5818    4                  CALL CLSCG;
      908     5819    4                  CALL FREEEV;
      909     5820    5                  DO WHILE ('0'B);
      910     5821        /*  Shut off all comgroups journaling to this file. Put out a message
      911     5822            on the OC about each comgroup and about the journal error.         */
      912     5823    5   WRJERR:           J$=CG$->CG.JRNL$;
      913     5824    5                     CALL ERRMSG (B$TCB$->B$TCB.ALT$->B$ALT.ERR,J$->JRNL.DCB#);
      914     5825    5                     CALL CHKCG;
      915     5826    5                     CALL CLSJRNL;
      916     5827    5   FREE_RD_EV:       CALL FREEEV;
      917     5828    5                     END;
      918     5829    4                END;
      919     5830        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:32   
      920     5831    3             CASE(%SET_DSMNT_EV#);
      921     5832        /*   Release packset requested by PIG    */
      922     5833
      923     5834    3   DSM1:       CG$=CGACTIVE$;
      924     5835    4               DO WHILE (CG$ ~= ADDR(NIL));
      925     5836    5                  IF CG$->CG.ID.PSN# = SUBSTR(FJ_EV.STA(EVENT),0,6) THEN DO;
      926     5837    5                     CALL WRBERC ALTRET(DSM2);
      927     5838    5   DSM2:             CALL CLSCG;
      928     5839    5                     GOTO DSM1;
      929     5840    5                     END;
      930     5841    4                  CG$=CG$->CG.LNK$;
      931     5842    4                  END;
      932     5843    3   DSM3:       J$=JRNLACTIVE$;
      933     5844    4               DO WHILE (J$ ~= ADDR(NIL));
      934     5845    5                  IF J$->JRNL.PSN = SUBSTR(FJ_EV.STA(EVENT),0,6) THEN DO;
      935     5846    5                     CALL CHKCG;
      936     5847    5                     CALL CLSJRNL;
      937     5848    5                     GOTO DSM3;
      938     5849    5                     END;
      939     5850    4                  J$=J$->JRNL.LNK$;
      940     5851    4                  END;
      941     5852    3               VLP_RPSN.NN# = 1; /* Release again just in case */
      942     5853    3               VLP_RPSN.RPLIST.PSN#(0)=SUBSTR(FJ_EV.STA(EVENT),0,6);
      943     5854    3               CALL M$RELRES (RELRES) ALTRET(DSM4);
      944     5855    3   DSM4:       ;
      945     5856    3               CALL FREEEV;
      946     5857        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:33   
      947     5858    3             CASE(%JRNL_ERR_EV#);
      948     5859                                                /*Process errors for journal files*/
      949     5860        /*  Locate journal data entry      */
      950     5861
      951     5862    3               K = POFFW(FJ_EV.CFU$(EVENT),B$DS1$);
      952     5863    3               J$=JRNLACTIVE$;
      953     5864    4               DO WHILE J$ ~= ADDR(NIL);
      954     5865    4                  IF J$->JRNL.CFU = K THEN
      955     5866    4                     GOTO JERR;
      956     5867    4                  J$=J$->JRNL.LNK$;
      957     5868    4                  END;
      958     5869    3               CALL M$XXX;            /* SOMETHING REALLY WRONG HERE  */
      959     5870
      960     5871        /* If end of tape do CVOL, otherwise, quit journaling                 */
      961     5872
      962     5873    3   JERR:       IF FJ_EV.ERR.ERR#(EVENT) = %E$EOVOL AND
      963     5874    4                  J$->JRNL.ATTR$->JATTR.Q.VOL# < J$->JRNL.ATTR$->JATTR.Q.NUM# THEN DO;
      964     5875    4                  J$->JRNL.ATTR$->JATTR.Q.VOL#=J$->JRNL.ATTR$->JATTR.Q.VOL#+1;
      965     5876    4                  CVOL_JRNL.V.DCB#=J$->JRNL.DCB#;
      966     5877    4                  CALL M$CVOL (CVOL_JRNL) ALTRET(WRJERR);
      967     5878    4                  END;
      968     5879    4               ELSE DO;
      969     5880    4                  CALL ERRMSG (FJ_EV.ERR(EVENT),J$->JRNL.DCB#);
      970     5881    4                  CALL CHKCG;
      971     5882    4                  CALL CLSJRNL;
      972     5883    4                  CALL FREEEV;
      973     5884    4                  END;
      974     5885    3             END;
      975     5886    2            END;
      976     5887        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:34   
      977     5888    1   GETJDCB: PROC ALTRET;
      978     5889    2         CALL M$GETDCB (GET_JRNL_DCB) ALTRET(NODCB);
      979     5890
      980     5891        /* Get a table entry for the journal file description and init it
      981     5892                                                     */
      982     5893    3         DO INHIBIT;
      983     5894    4            IF JRNLFREE$ = ADDR(NIL) THEN DO;
      984     5895    4               J$=PINCRW(JRNL_V.P$,((JRNL_V.BND+1)/SIZEC(JRNL))*SIZEW(JRNL));
      985     5896    4               JRNLFREE$=J$;
      986     5897    4               CALL M$GDS (GDS_JRNL) ALTRET(NODCB);
      987     5898    5               DO WHILE (PINCRW(J$,SIZEW(JRNL)) < PINCRC(JRNL_V.P$,JRNL_V.BND+1));
      988     5899    5                  C$=J$;
      989     5900    5                  J$->JRNL.LNK$=PINCRW(J$,SIZEW(JRNL));
      990     5901    5                  J$=J$->JRNL.LNK$;
      991     5902    5                  END;
      992     5903    4               C$->JRNL.LNK$=ADDR(NIL);
      993     5904    4               END;
      994     5905    3            J$=JRNLFREE$;
      995     5906    3            JRNLFREE$=J$->JRNL.LNK$;
      996     5907    3            J$->JRNL.LNK$=JRNLACTIVE$;
      997     5908    3            JRNLACTIVE$=J$;
      998     5909    3            END;
      999     5910    2         J$->JRNL.DCB#=XDCB;
     1000     5911    2         J$->JRNL.CGCNT=0;
     1001     5912    2         J$->JRNL.UTS=0;
     1002     5913    2         J$->JRNL.RENAME.L=0;
     1003     5914    2         RETURN;
     1004     5915    2   NODCB: ALTRETURN;
     1005     5916    2   END GETJDCB;
     1006     5917
     1007     5918
     1008     5919
     1009     5920
     1010     5921    1   CLSCG: PROC ALTRET;
     1011     5922
     1012     5923    2         IF CG$->CG.JRNL$ ~= ADDR(NIL) THEN
     1013     5924    2            CG$->CG.JRNL$->JRNL.CGCNT=CG$->CG.JRNL$->JRNL.CGCNT-1;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:35   
     1014     5925    2         CG_CLS.V.DCB#=CG$->CG.DCB#;
     1015     5926    2         CALL M$CLOSE (CG_CLS) ALTRET(DACT1);
     1016     5927    2   DACT1: REL_DCB.V.DCB#=CG$->CG.DCB#;
     1017     5928    2         CALL M$RELDCB (REL_DCB);
     1018     5929    2         CALL FREECG;
     1019     5930    2         RETURN;
     1020     5931    2   END CLSCG;
     1021     5932    1   CHKCG: PROC;
     1022     5933    2   CHKCG1: CG$=CGACTIVE$;
     1023     5934    3         DO WHILE (CG$ ~= ADDR(NIL));
     1024     5935    3            IF CG$->CG.JRNL$ = J$ THEN
     1025     5936    4            DO;
     1026     5937    4               CALL CLSCGMSG;
     1027     5938    4               CALL CLSCG;
     1028     5939    4               GOTO CHKCG1;
     1029     5940    4               END;
     1030     5941    3            CG$=CG$->CG.LNK$;
     1031     5942    3            END;
     1032     5943    2         RETURN;
     1033     5944    2   END CHKCG;
     1034     5945
     1035     5946    1   CHKJRNLS: PROC;
     1036     5947    2   CHK:  J$=JRNLACTIVE$;
     1037     5948    3         DO WHILE (J$ ~= ADDR(NIL));
     1038     5949    3            IF PINCRW(CFU$,J$->JRNL.CFU)->FM$CFU.USECNT = 1 AND
     1039     5950    3               J$->JRNL.CGCNT = 0 THEN
     1040     5951    4               IF J$->JRNL.UTS = 0 THEN DO;
     1041     5952    4                  CG_TIME.TSTAMP_=VECTOR(J$->JRNL.UTS);
     1042     5953    4                  CALL M$TIME (CG_TIME);
     1043     5954    4                  END;
     1044     5955    4               ELSE DO;
     1045     5956    4                  CALL CLSJRNL;
     1046     5957    4                  GOTO CHK;
     1047     5958    4                  END;
     1048     5959    3            J$=J$->JRNL.LNK$;
     1049     5960    3            END;
     1050     5961    2         RETURN;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:36   
     1051     5962    2   END CHKJRNLS;
     1052     5963
     1053     5964    1   CLSJRNL: PROC;
     1054     5965    2         CLS_JRNL.V.DCB#=J$->JRNL.DCB#;
     1055     5966    2         IF J$->JRNL.ATTR$ = ADDR(NIL) THEN
     1056     5967    2            CLS_JRNL.UATTR_=VECTOR(NIL);
     1057     5968    2         ELSE
     1058     5969    2            CLS_JRNL.UATTR_=VECTOR(J$->JRNL.ATTR$->JATTR);
     1059     5970    2         CALL M$CLOSE (CLS_JRNL) ALTRET(CLSJ1);
     1060     5971    2   CLSJ1:
     1061     5972    3         IF (J$->JRNL.ASN = %TAPE#) THEN DO;
     1062     5973    3            RESTAP.NN# = 1;
     1063     5974    3            RESTAP.PRLIST.RNAME#(0) = DCBADDR(J$->JRNL.DCB#)->F$DCB.RES#;
     1064     5975    3            CALL M$RELRES (RELTAP);
     1065     5976    3            END;
     1066     5977    2         REL_DCB.V.DCB#=J$->JRNL.DCB#;
     1067     5978    2         CALL M$RELDCB (REL_DCB) ALTRET(CLSJ2);
     1068     5979    2   CLSJ2: CALL FREEJRNL;
     1069     5980    2         RETURN;
     1070     5981    2   END;
     1071     5982
     1072     5983    1   WRBERC: PROC ALTRET;
     1073     5984    3         IF CG$ ~= ADDR(NIL) THEN DO;
     1074     5985    3            BERC.TYPE=T#CFID;
     1075     5986    3            BERC.DCB#=CG$->CG.HISDCB;
     1076     5987    3            BERC.USER#=CG$->CG.HISUSER#;
     1077     5988    3            CG_TIME.TSTAMP_=VECTOR(BERC.TIME);
     1078     5989    3            CALL M$TIME (CG_TIME);
     1079     5990    3            WR_CG_JRNL.BUF_=VECTOR(BERC);
     1080     5991    3            WR_CG_JRNL.V.DCB#=CG$->CG.JRNL$->JRNL.DCB#;
     1081     5992
     1082     5993    3            CALL M$WRITE (WR_CG_JRNL) ALTRET(WRBERC1);
     1083     5994    3            END;
     1084     5995    2         RETURN;
     1085     5996    2   WRBERC1: ALTRETURN;
     1086     5997    2   END;
     1087     5998
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:37   
     1088     5999        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:38   
     1089     6000        /* Open the journal file described by comgroup info                   */
     1090     6001    1   OPN_CG_JRNL: PROC ALTRET;
     1091     6002
     1092     6003    2         CALL HISACCN (BUF$->JRNOPN.ACCN,BUF$->JRNOPN.UNAME,BUF$->JRNOPN.FACCN,
     1093     6004    2            BUF$->JRNOPN.PRIV);
     1094     6005    2         OPN_JRNL.V.RES#='DP  ';
     1095     6006    2         CG_SN.SN#(0)=J$->JRNL.PSN;
     1096     6007    2         CALL TESTOPEN ALTRET(TESTERR);
     1097     6008    2         F$=ADDR(JRNL_FIT);
     1098     6009    2         CALL XSF$LOCCODP (F$,11) ALTRET(NOSN);
     1099     6010    2         F$=PINCRW(F$,-1);
     1100     6011    2         IF F$->JATTR.Q.ID ~= ATTR_.Q.ID THEN
     1101     6012    2            GOTO NOSN;
     1102     6013    2         IF F$->JATTR.Q.ASN ~= J$->JRNL.ASN THEN
     1103     6014    2            GOTO NOT_SAME_ASN;
     1104     6015    3         IF J$->JRNL.ASN = %TAPE# THEN DO;
     1105     6016    3   GSNSP:   SNSZ=POFFC(PINCRC(SN_V.P$,SN_V.BND+1),CURSN$)-SIZEC(JATTR)+4;
     1106     6017    4            IF SNSZ > (F$->JATTR.Q.NUM#*6+3)/4+4 THEN DO;
     1107     6018    4               CALL M$GDS (GDS_SN) ALTRET(OPNJERR);
     1108     6019    4               GOTO GSNSP;
     1109     6020    4               END;
     1110     6021    3            J$->JRNL.ATTR$=CURSN$;
     1111     6022    3            JSN$->P$$=J$;
     1112     6023    3            JSN$=PINCRW(CURSN$,(F$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR));
     1113     6024    3            J$->JRNL.ATTR$->JATTR = F$->JATTR;
     1114     6025    3            SNSZ=F$->JATTR.Q.NUM#*6+4;
     1115     6026    3            CURSN$=ADDR(J$->JRNL.ATTR$->JATTR.Q.NUM#);
     1116     6027    3            CURSN$->DUMMY_SN=ADDR(F$->JATTR.Q.NUM#)->DUMMY_SN;
     1117     6028    3   SETSN_:
     1118     6029    3            OPN_JRNL.SN_=VECTOR(ADDR(J$->JRNL.ATTR$->JATTR.Q.NUM#)->DUMMY_SN);
     1119     6030    3            OPN_JRNL.V.RES# = 'MT  ';
     1120     6031    3            OPN_JRNL.V.VOL#=J$->JRNL.ATTR$->JATTR.Q.VOL#;
     1121     6032    3            IF J$->JRNL.ATTR$->JATTR.Q.VOL# = 0 THEN
     1122     6033    3               J$->JRNL.ATTR$->JATTR.Q.VOL# = 1;
     1123     6034    3            END;
     1124     6035
     1125     6036    2   OPNJRNL:;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:39   
     1126     6037
     1127     6038    2         OPN_JRNL.V.DCB# = J$->JRNL.DCB#;
     1128     6039    2         OPN_JRNL.NAME_=VECTOR(J$->JRNL.NAME);
     1129     6040    2         OPN_JRNL.ACCT_=VECTOR(J$->JRNL.ACCT);
     1130     6041    2         OPN_JRNL.V.ASN#=J$->JRNL.ASN;
     1131     6042    2         CALL M$OPEN (OPN_JRNL) ALTRET(OPNJERR);
     1132     6043    2         J$->JRNL.CFU=ADDR(DCBADDR(J$->JRNL.DCB#)->F$DCB.CFU$)->BPTR.OFFSET;
     1133     6044    2         CALL MYACCN;
     1134     6045    2         RETURN;
     1135     6046
     1136     6047    2   OPNJERR: OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
     1137     6048    2         GOTO ALTX;
     1138     6049
     1139     6050    2   NOT_SAME_ASN: OPN_ANSWER.ERR=ASNERR;
     1140     6051    2         GOTO ALTX;
     1141     6052
     1142     6053    2   NOSN: IF J$->JRNL.ASN = %FILE# THEN
     1143     6054    2            GOTO OPNJRNL;
     1144     6055    2         OPN_ANSWER.ERR=NOSNERR;
     1145     6056    2         GOTO ALTX;
     1146     6057    2   TESTERR: IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$NOFILE THEN
     1147     6058    2            IF J$->JRNL.ASN = %TAPE# AND
     1148     6059    3               J$->JRNL.ATTR$->JATTR.Q.NUM# = 0 THEN DO;
     1149     6060    3               OPN_ANSWER.ERR=NOSNERR;
     1150     6061    3   ALTX:       B$JIT$->B$JIT.ACCN=ACCN;
     1151     6062    3               B$JIT$->B$JIT.UNAME=NAME;
     1152     6063    3               B$JIT$->B$JIT.FACCN=FACCN;
     1153     6064    3               B$JIT$->B$JIT.PRIV.ACTIVE=PRIV;
     1154     6065    3               ALTRETURN;
     1155     6066    3               END;
     1156     6067    2         GOTO OPNJRNL;
     1157     6068    2   END;
     1158     6069        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:40   
     1159     6070
     1160     6071    1   CLSCGMSG: PROC;
     1161     6072
     1162     6073    2   DCL I UBIN;
     1163     6074
     1164     6075    2         CALL INDEX (I,' ',CG$->CG.ID.ACCT#);
     1165     6076    2         CALL CONCAT (OCBUF,' ERROR JOURNALING COMGROUP ',
     1166     6077    2            SUBSTR(CG$->CG.ID.NAME#.TXT,0,CG$->CG.ID.NAME#.CNT),
     1167     6078    2            '.',
     1168     6079    2            SUBSTR(CG$->CG.ID.ACCT#,0,I),
     1169     6080    2            '; DISCONTINUED JOURNALING.@');
     1170     6081    2         CALL INDEX (I,'@',OCBUF);
     1171     6082    2         OCMSG.MESS_.BOUND=I-1;
     1172     6083    2         OCMSG.MESS_.BUF$=ADDR(OCBUF);
     1173     6084    2         CALL M$KEYIN (OCMSG) ALTRET(OCERR1);
     1174     6085    2   OCERR1: RETURN;
     1175     6086    2   END;
     1176     6087
     1177     6088    1   CLSJMSG: PROC;
     1178     6089
     1179     6090    2   DCL I UBIN;
     1180     6091
     1181     6092    2         CALL INDEX (I,' ',J$->JRNL.ACCT);
     1182     6093    2         CALL CONCAT (OCBUF,' ERROR ON JOURNAL FILE ',
     1183     6094    2            SUBSTR(J$->JRNL.NAME.TXT,0,J$->JRNL.NAME.L),
     1184     6095    2            '.',
     1185     6096    2            SUBSTR(J$->JRNL.ACCT,0,I),
     1186     6097    2            '@');
     1187     6098    2         CALL INDEX (I,'@',OCBUF);
     1188     6099    2         OCMSG.MESS_.BUF$=ADDR(OCBUF);
     1189     6100    2         OCMSG.MESS_.BOUND=I-1;
     1190     6101    2         CALL M$KEYIN (OCMSG) ALTRET(JOC1);
     1191     6102    2   JOC1: RETURN;
     1192     6103    2   END;
     1193     6104
     1194     6105    1   ERRMSG: PROC (CODE,DCB#);
     1195     6106
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:41   
     1196     6107    2   DCL CODE UBIN;
     1197     6108    2   DCL DCB# UBIN;
     1198     6109    2         ERRMSG.CODE_=VECTOR(CODE);
     1199     6110    2         ERRMSG.V.DCB# = DCB#;
     1200     6111    2         CALL M$ERRMSG (ERRMSG) ALTRET(JOC2);
     1201     6112    2         IF ERRSLT.RECCNT = 0 THEN
     1202     6113    2            RETURN;
     1203     6114    3         DO I = 0 TO ERRSLT.RECCNT;
     1204     6115    3            OCMSG.MESS_=VECTOR(OCERRBUF(I));
     1205     6116    3            CALL M$KEYIN (OCMSG) ALTRET(JOC2);
     1206     6117    3            END;
     1207     6118    2   JOC2: RETURN;
     1208     6119    2   END;
     1209     6120
     1210     6121    1   LOCJRNL: PROC (NAME,ACCN) ALTRET;
     1211     6122
     1212     6123    2   DCL 1 NAME,
     1213     6124    2         2 L# UBIN(9) UNAL,
     1214     6125    2         2 TXT CHAR(31);
     1215     6126    2   DCL ACCN CHAR(8);
     1216     6127
     1217     6128    2         J$=JRNLACTIVE$;
     1218     6129    3         DO WHILE (J$ ~= ADDR(NIL));
     1219     6130    3            JNAME.L#=J$->JRNL.NAME.L;
     1220     6131    3            IF J$->JRNL.ACCT = ACCN AND J$->JRNL.NAME.L = NAME.L# AND
     1221     6132    3               ADDR(J$->JRNL.NAME.TXT)->JN = NAME.TXT THEN
     1222     6133    3               RETURN;
     1223     6134    3            J$=J$->JRNL.LNK$;
     1224     6135    3            END;
     1225     6136    2         ALTRETURN;
     1226     6137    2   END;
     1227     6138
     1228     6139
     1229     6140
     1230     6141    1   HISACCN: PROC (HISACCN,HISNAME,HISFACCN,HISPRIV);
     1231     6142    2   DCL HISACCN CHAR(8);
     1232     6143    2   DCL HISNAME CHAR(12);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:42   
     1233     6144    2   DCL HISFACCN CHAR(8);
     1234     6145    2   DCL HISPRIV BIT(36) ALIGNED;
     1235     6146
     1236     6147    2         ACCN=B$JIT.ACCN;
     1237     6148    2         NAME=B$JIT.UNAME;
     1238     6149    2         FACCN=B$JIT.FACCN;
     1239     6150    2         PRIV=B$JIT.PRIV.ACTIVE;
     1240     6151    2         B$JIT.ACCN=HISACCN;
     1241     6152    2         B$JIT.UNAME=HISNAME;
     1242     6153    2         B$JIT.FACCN=HISFACCN;
     1243     6154    2         B$JIT.PRIV.ACTIVE=HISPRIV;
     1244     6155    2         RETURN;
     1245     6156    2   END;
     1246     6157
     1247     6158
     1248     6159
     1249     6160    1   MYACCN: PROC;
     1250     6161    2         B$JIT.ACCN=ACCN;
     1251     6162    2         B$JIT.UNAME=NAME;
     1252     6163    2         B$JIT.FACCN=FACCN;
     1253     6164    2         B$JIT.PRIV.ACTIVE=PRIV;
     1254     6165    2         RETURN;
     1255     6166    2   END MYACCN;
     1256     6167
     1257     6168
     1258     6169    1   TESTOPEN: PROC ALTRET;
     1259     6170
     1260     6171    2         TOPN_JRNL.NAME_=VECTOR(J$->JRNL.NAME);
     1261     6172    2         TOPN_JRNL.ACCT_=VECTOR(J$->JRNL.ACCT);
     1262     6173    2         CG_SN.SN#(0)=J$->JRNL.PSN;
     1263     6174    2         GOTO COMMON;
     1264     6175
     1265     6176    2   TESTOPENCG: ENTRY ALTRET;
     1266     6177
     1267     6178    2         TOPN_JRNL.NAME_=VECTOR(J$->CG.ID.NAME#);
     1268     6179    2         TOPN_JRNL.ACCT_=VECTOR(J$->CG.ID.ACCT#);
     1269     6180    2         CG_SN.SN#(0)=J$->CG.ID.PSN#;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:43   
     1270     6181
     1271     6182    2   COMMON:
     1272     6183    2         CALL M$GETDCB (GET_JRNL_DCB) ALTRET(TSTERR1);
     1273     6184    2         REL_DCB.V.DCB#=XDCB;
     1274     6185    2         TOPN_JRNL.V.DCB#=XDCB;
     1275     6186    2         CALL M$OPEN (TOPN_JRNL) ALTRET(TSTERR);
     1276     6187    2         DELFFLG=DCBADDR(XDCB)->F$DCB.FFLG.DELF#;
     1277     6188    2         CALL M$RELDCB (REL_DCB);
     1278     6189    2         RETURN;
     1279     6190    2   TSTERR: CALL M$RELDCB (REL_DCB);
     1280     6191    2   TSTERR1: ALTRETURN;
     1281     6192    2   END TESTOPEN;
     1282     6193
     1283     6194
     1284     6195    1   FREEEV: PROC;
     1285     6196
     1286     6197    3         DO INHIBIT;
     1287     6198    3            FJ_EV.LNK(EVENT)=FJ_EVFREE;
     1288     6199    3            FJ_EVFREE=EVENT;
     1289     6200    3            RETURN;
     1290     6201    3            END;
     1291     6202    2   END FREEEV;
     1292     6203        /**/
     1293     6204    1   FREECG: PROC;
     1294     6205    2   DCL I$ PTR;
     1295     6206    2   DCL P$ PTR;
     1296     6207
     1297     6208    2         I$=CGACTIVE$;
     1298     6209    2         P$=ADDR(NIL);
     1299     6210    3         DO WHILE (I$ ~= CG$ AND I$ ~= I$->CG.LNK$);
     1300     6211    3            P$=I$;
     1301     6212    3            I$=I$->CG.LNK$;
     1302     6213    3            END;
     1303     6214    2         IF P$ ~= ADDR(NIL) THEN
     1304     6215    2            P$->CG.LNK$=I$->CG.LNK$;
     1305     6216    2         ELSE
     1306     6217    2            CGACTIVE$=I$->CG.LNK$;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:44   
     1307     6218    2         VLP_RPSN.NN#=1;
     1308     6219    2         VLP_RPSN.RPLIST.PSN#(0)=CG$->CG.ID.PSN#;
     1309     6220    2         CALL M$RELRES (RELRES) ALTRET(RELCG1);
     1310     6221    2   RELCG1: CG$->CG.LNK$=CGFREE$;
     1311     6222    2         CGFREE$=CG$;
     1312     6223    2         CG$=ADDR(NIL);
     1313     6224    3         IF CGACTIVE$ = ADDR(NIL) AND CG_V.BND > 4095 THEN DO;
     1314     6225    3            GDS_CG.V.SEGSIZE#=(CG_V.BND+1)/4;
     1315     6226    3            CALL M$FDS (GDS_CG);
     1316     6227    3            GDS_CG.V.SEGSIZE#=1024;
     1317     6228    3            CALL M$GDS (GDS_CG);
     1318     6229    3            CGFREE$=CG_V.P$;
     1319     6230    3            CG$=CGFREE$;
     1320     6231    4            DO WHILE ( PINCRW(CG$,SIZEW(CG)) < PINCRC(CG_V.P$,CG_V.BND+1));
     1321     6232    4               C$=CG$;
     1322     6233    4               CG$->CG.LNK$=PINCRW(CG$,SIZEW(CG));
     1323     6234    4               CG$=CG$->CG.LNK$;
     1324     6235    4               END;
     1325     6236    3            C$->CG.LNK$=ADDR(NIL);
     1326     6237    3            END;
     1327     6238    2         RETURN;
     1328     6239    2   END FREECG;
     1329     6240    1   FREEJRNL: PROC;
     1330     6241    2   DCL I$ PTR;
     1331     6242    2   DCL P$ PTR;
     1332     6243
     1333     6244    3         IF J$->JRNL.ATTR$ ~= ADDR(NIL) THEN DO;
     1334     6245    3            I$=J$->JRNL.ATTR$;
     1335     6246    3            P$=I$;
     1336     6247    3   FREEATTR: P$=PINCRW(P$,(I$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR)+1);
     1337     6248    4            IF POFFW(JSN$,P$) > 0 THEN DO;
     1338     6249    4               C$=PINCRW(P$,(P$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR)+1);
     1339     6250    4               SNSZ=SIZEC(JATTR)+P$->JATTR.Q.NUM#*6;
     1340     6251    4               I$->DUMMY_SN=P$->DUMMY_SN;
     1341     6252    4               PINCRW(I$,-1)->P$$=PINCRW(P$,-1)->P$$;
     1342     6253    4               PINCRW(I$,-1)->P$$->JRNL.ATTR$=I$;
     1343     6254    4               I$=PINCRW(I$,(I$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR)+1);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:45   
     1344     6255    4               P$=C$;
     1345     6256    4               GOTO FREEATTR;
     1346     6257    4               END;
     1347     6258    3            JSN$=PINCRW(I$,-1);
     1348     6259    3            END;
     1349     6260    2         I$=JRNLACTIVE$;
     1350     6261    2         P$=ADDR(NIL);
     1351     6262    3         DO WHILE (I$ ~= J$ AND I$ ~= I$->JRNL.LNK$);
     1352     6263    3            P$=I$;
     1353     6264    3            I$=I$->JRNL.LNK$;
     1354     6265    3            END;
     1355     6266    2         IF P$ ~= ADDR(NIL) THEN
     1356     6267    2            P$->JRNL.LNK$=I$->JRNL.LNK$;
     1357     6268    2         ELSE
     1358     6269    2            JRNLACTIVE$=I$->JRNL.LNK$;
     1359     6270    2         VLP_RPSN.NN#=1;
     1360     6271    2         VLP_RPSN.RPLIST.PSN#(0)=J$->JRNL.PSN;
     1361     6272    2         CALL M$RELRES (RELRES) ALTRET(RELJ1);
     1362     6273    2   RELJ1: J$->JRNL.LNK$=JRNLFREE$;
     1363     6274    2         JRNLFREE$=J$;
     1364     6275    3         IF JRNLACTIVE$ = ADDR(NIL) AND JRNL_V.BND > 4095 THEN DO;
     1365     6276    3            GDS_JRNL.V.SEGSIZE#=(JRNL_V.BND+1)/4;
     1366     6277    3            CALL M$FDS (GDS_JRNL);
     1367     6278    3            GDS_JRNL.V.SEGSIZE#=1024;
     1368     6279    3            CALL M$GDS (GDS_JRNL);
     1369     6280    3            JRNLFREE$=JRNL_V.P$;
     1370     6281    3            J$=JRNLFREE$;
     1371     6282    4            DO WHILE (PINCRW(J$,SIZEW(JRNL)) < PINCRC(JRNL_V.P$,JRNL_V.BND+1));
     1372     6283    4               C$=J$;
     1373     6284    4               J$->JRNL.LNK$=PINCRW(J$,SIZEW(JRNL));
     1374     6285    4               J$=J$->JRNL.LNK$;
     1375     6286    4               END;
     1376     6287    3            C$->JRNL.LNK$=ADDR(NIL);
     1377     6288    3            END;
     1378     6289    2         RETURN;
     1379     6290    2   END FREEJRNL;
     1380     6291    1   END FJJ$JAY;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:46   
     1381     6292        %EOD;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:47   
--  Include file information  --

   KC$CGBLK.:E05TOU  is referenced.
   ZI$JRNL.:LIBRARY  is referenced.
   FJM_MACROS_C.:E05TOU  is referenced.
   FJ_PERR_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$SET.:E05TOU  is referenced.
   FM$CFU.:E05TOU  is referenced.
   FJ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FJJ$JAY.

   Procedure FJJ$JAY requires 2585 words for executable code.
   Procedure FJJ$JAY requires 36 words of local(AUTO) storage.

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:48   

 Object Unit name= FJJ$JAY                                    File name= FJJ$JAY.:E05TOU
 UTS= JUL 29 '97 15:28:40.12 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none  3216   6220  FJJ$JAY
    2   DCB   even  none     0      0  M$CSCG
    3  RoData even  UTS     49     61  FJJ$JAY
    4   DCB   even  none     0      0  M$GREETING
    5   Proc  even  none  2585   5031  FJJ$JAY
    6  RoData even  none    32     40  FJJ$JAY

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     5      0   yes            yes      Main       0  FJJ$JAY

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          Async      0 FJJ$EVENT
 yes     yes           Std       2 XSF$LOCCODP
         yes          Async      0 FJJ$XCON
 yes     yes           Std       0 FJJ$CJAY
 yes     yes           Std       0 DAM$INIT
 yes     yes           Std       5 DAM$MAP
                       nStd      0 X66_MAUTO
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:49   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  FJ_EV                                 FJ_EVHD
     FJ_EVTL                               FJ_EVFREE                             B$TCB$
     B$JIT$                                B$DS1$                                M$CSCG
     B_VERSION                             M$GREETING                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:50   


        1        1        /*M*  Ghost to serve as Journal owner and do CG journaling            */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
        8        8        FJJ$JAY: PROC MAIN;

      8  5 000000   000000 700200 xent  FJJ$JAY      TSX0  ! X66_MAUTO
         5 000001   000044 000000                    ZERO    36,0

        9        9        /**/
       10       10        %INCLUDE CP_6;
       11       91 S      %INCLUDE B$JIT_C;
       12       92        %INCLUDE FJ_DATA_R;
       13      104        %INCLUDE FM$CFU;
       14      149        %INCLUDE FM$SET;
       15      176        %INCLUDE CP_6_SUBS;
       16      716        %INCLUDE JG_GHOSTS_C;
       17      806        %INCLUDE JG_EVID_C;
       18     1031        %INCLUDE B_ERRORS_C;
       19     2158        %INCLUDE FJ_PERR_C;
       20     2171        %INCLUDE FJM_MACROS_C;
       21     2310        %INCLUDE ZI$JRNL;
       22     2418        %INCLUDE KC$CGBLK;
       23     2466        %JRNL_REC (STCLASS=STATIC);
       24     2541        %ZI$CGMSG (FPTN=CGJREC,STCLASS="BASED(C$)");
       25     2578        %ZI$CGDEL  (FPTN=CGDEL);
       26     2589        %FJ$OPNANSWR (FPTN=OPN_ANSWER);
       27     2599        %FJ$SUBS;
       28     2606        %FJ$CITE (NAME=JRNOPN,TYP=JRNL,STCLASS=BASED);
       29     2679        %FJ$CITE (NAME=JRNRENAME,TYP=RENAME,STCLASS=BASED);
       30     2752        %FJ$CITE (NAME=JRNCANCEL,TYP=CANCEL,STCLASS=BASED);
       31     2825        %FJ$CITE (NAME=JRNLIST,TYP=LIST,STCLASS=BASED);
       32     2898        %FJ$LISTANS;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:51   
       33     2904        %B$TCB;
       34     2907        %B$ALT;
       35     2915        %B$CGAURD;
       36     2934        %EQU_CG;
       37     2982        %F$DCB;
       38     3039        %B$JIT0;
       39     3128        %A$JIT6X;
       40     3131        %FM$SET;
       41     3136        %FM$CFU;
       42     3142        %FM$CFUN;
       43     3145        %FM$CFUA;
       44     3151        %FM$CFUX (BASED="BASED");
       45     3156
       46     3157        %EQU #JRNL=100;                         /* Number of journal DCBs*/
       47     3158        %EQU #CG=100;                           /* Number of comgroup DCBs*/
       48     3159        %FPT_EVENT (FPTN=JRNL_EVENTS,UENTRY=FJJ$EVENT);
       49     3173        %FPT_XCON (FPTN=JRNL_XCON,UENTRY=FJJ$XCON);
       50     3187
       51     3188        %FPT_WAIT (FPTN=WAIT_CSCG,UNITS=60);
       52     3202
       53     3203        %FPT_OPEN (FPTN=OPN_CSCG,DCB=M$CSCG,ASN=COMGROUP,NAME=CSCG_NAME,
       54     3204             SETSTA=JRNL_GHST,STCLASS=STATIC);
       55     3313        %FPT_READ (FPTN=RD_CSCG,DCB=M$CSCG,STCLASS=STATIC,WAIT=NO,
       56     3314             EVENT=%CSCG_RD_EV#,BUF=CSCG_BUF);
       57     3353        %VLP_NAME (FPTN=CSCG_NAME,NAME='CSCG',STCLASS=STATIC);
       58     3380        %VLP_SETSTA (FPTN=JRNL_GHST,STCLASS=STATIC,MYSTATION='JAYS',
       59     3381             DIRONLY=YES);
       60     3409        %FPT_WRITE (FPTN=WR_JRNL_RESULTS,DCB=M$CSCG,BUF=OPN_ANSWER,STATION=WR_CSCG_STA);
       61     3440        %VLP_STATION (FPTN=WR_CSCG_STA);
       62     3467
       63     3468        %FPT_GETDCB (FPTN=GET_JRNL_DCB,DCBNUM=XDCB);
       64     3483        %FPT_RELDCB (FPTN=REL_DCB,STCLASS=STATIC);
       65     3497
       66     3498        %FPT_OPEN (FPTN=CG_OPN,ASN=COMGROUP,FUN=IN,SN=CG_SN,SETSTA=CG_SETSTA);
       67     3607        %FPT_CGINFO (FPTN=CG_INFO,STCLASS=STATIC,JRNLSTA=CG_JSTA);
       68     3627        %VLP_STATION (FPTN=CG_JSTA,STCLASS=STATIC);
       69     3654        %VLP_JRNLFIDV (FPTN=JFID);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:52   
       70     3661        %FPT_READ (FPTN=CG_RD,STATION=CG_RDSTA,WAIT=NO,STCLASS=STATIC);
       71     3700        %VLP_STATION (FPTN=CG_RDSTA,DIRONLY=YES,MSGTYP=' ',LATCH=YES);
       72     3727        %VLP_SETSTA (FPTN=CG_SETSTA,MYSTATION='JRNLSTA');
       73     3755        %VLP_STATION (FPTN=RDSTA,STCLASS=BASED);
       74     3782        %VLP_SN (FPTN=CG_SN,N=1);
       75     3795        %FPT_UNLATCH (FPTN=FIN_CG_JRNL,INPUT=RERUN,STCLASS=STATIC,JOURNALED=YES);
       76     3812        %FPT_CLOSE (FPTN=CG_CLS);
       77     3854
       78     3855        %FPT_OPEN (FPTN=OPN_JRNL,ACS=JRNL,EXIST=OLDFILE,DISP=NAMED,FUN=CREATE,SN=CG_SN,
       79     3856                    CTG=YES,ASN=FILE,ORG=CONSEC);
       80     3965        %FPT_OPEN (FPTN=TOPN_JRNL,FUN=UPDATE,ASN=FILE,TEST=YES,FPARAM=JRNL_FIT,SN=CG_SN);
       81     4074        %FPT_WRITE (FPTN=WR_CG_JRNL);
       82     4105        %FPT_CLOSE (FPTN=CLS_JRNL,CHGATT=YES);
       83     4147        %FPT_CLOSE (FPTN=CLS_RNAME,CHGATT=YES);
       84     4189        %FPT_CVOL (FPTN=CVOL_JRNL);
       85     4204
       86     4205        %FPT_FWCG (FPTN=GET_MESS_ATTR);
       87     4224
       88     4225        %FPT_GDS (FPTN=GDS_CG,RESULTS=CG_V);
       89     4241        %FPT_GDS (FPTN=GDS_JRNL,RESULTS=JRNL_V);
       90     4257        %FPT_GDS (FPTN=GDS_JFID,RESULTS=JFID_V);
       91     4273        %FPT_GDS (FPTN=GDS_SN,RESULTS=SN_V);
       92     4289
       93     4290        %FPT_FID (FPTN=FID_JFID,ACCT=JACCT,NAME=JNAME,PASS=JPASS,ASN=JASN,
       94     4291                RES=OPN_JRNL.V.RES#);
       95     4314        %FPT_UNFID (FPTN=UNF_LIST,TEXTFID=FJ$LISTANS.TXT);
       96     4332
       97     4333        %FPT_RESCTL (FPTN=RELRES,RPSN=VLP_RPSN);
       98     4350        %FPT_RESCTL (FPTN=RELTAP,PRES=RESTAP);
       99     4367
      100     4368        %VLP_RPSN (DISP=REL);
      101     4383        %VLP_PRES (FPTN=RESTAP);
      102     4399
      103     4400        %FPT_KEYIN (FPTN=OCMSG,OCTYPE=SYSTEM);
      104     4419        %FPT_ERRMSG (FPTN=ERRMSG,BUF=OCERRBUF,INCLCODE=NO,RESULTS=ERRSLT,CODE=ERRCODE);
      105     4446        %VLR_ERRMSG (FPTN=ERRSLT);
      106     4468        %VLP_ACCT (FPTN=JACCT);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:53   
      107     4481        %VLP_NAME (FPTN=JNAME);
      108     4508        %VLP_PASS (FPTN=JPASS);
      109     4521        %VLP_SN (FPTN=SN,STCLASS=BASED);
      110     4534        %FJ$UATTR (FPTN=JATTR,STCLASS=BASED);
      111     4566        %FJ$UATTR (FPTN=ATTR_);
      112     4598
      113     4599        %FPT_TIME (FPTN=CG_TIME,SOURCE=CLOCK,DEST=UTS);
      114     4618        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:54   
      115     4619    1   DCL DAM$INIT ENTRY ALTRET;
      116     4620    1   DCL DAM$MAP ENTRY(5) ALTRET;
      117     4621    1   DCL XSF$LOCCODP ENTRY(2) ALTRET;
      118     4622    1   DCL FJJ$CJAY ENTRY ALTRET;
      119     4623    1   DCL FJJ$EVENT ENTRY ASYNC;              /* Event handler                      */
      120     4624    1   DCL FJJ$XCON ENTRY ASYNC;               /* Exit control procedure             */
      121     4625
      122     4626    1   DCL B$TCB$ PTR SYMREF;
      123     4627    1   DCL B$JIT$ PTR SYMREF;
      124     4628    1   DCL B$DS1$ PTR SYMREF;
      125     4629
      126     4630    1   DCL M$CSCG DCB;
      127     4631
      128     4632    1   DCL CFU$ PTR STATIC;
      129     4633    1   DCL CURSN$ PTR STATIC;
      130     4634    1   DCL JSN$ PTR;
      131     4635    1   DCL C$ PTR;
      132     4636    1   DCL CG$ PTR;
      133     4637    1   DCL 1 CGP REDEF CG$,
      134     4638    1         2 OFFSET UBIN(18) UNAL,
      135     4639    1         2 * UBIN(18) UNAL;
      136     4640    1   DCL CGFREE$ PTR;
      137     4641    1   DCL CGACTIVE$ PTR;
      138     4642    1   DCL J$ PTR;
      139     4643    1   DCL JRNLFREE$ PTR;
      140     4644    1   DCL JRNLACTIVE$ PTR;
      141     4645    1   DCL 1 CG_V STATIC DALIGNED,
      142     4646    1         2 BND UBIN(20) UNAL,
      143     4647    1         2 *  BIT(16) UNAL INIT('1111111110100000'B),
      144     4648    1         2 P$ PTR UNAL INIT(ADDR(NIL));
      145     4649    1   DCL 1 JRNL_V STATIC DALIGNED,
      146     4650    1         2 BND UBIN(20) UNAL,
      147     4651    1         2 *  BIT(16) UNAL INIT('1111111110100000'B),
      148     4652    1         2 P$ PTR UNAL INIT(ADDR(NIL));
      149     4653    1   DCL 1 JFID_V STATIC DALIGNED,
      150     4654    1         2 BND UBIN(20) UNAL INIT(0),
      151     4655    1         2 * BIT(16) UNAL INIT('1111111110100000'B),
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:55   
      152     4656    1         2 P$ PTR UNAL INIT(ADDR(NIL));
      153     4657    1   DCL 1 SN_V STATIC DALIGNED,
      154     4658    1         2 BND UBIN(20) UNAL INIT(0),
      155     4659    1         2 * BIT(16) UNAL INIT('1111111110100000'B),
      156     4660    1         2 P$ PTR UNAL INIT(ADDR(NIL));
      157     4661    1   DCL JASN UBIN(9) STATIC;
      158     4662    1   DCL 1 BVCTR BASED ALIGNED,
      159     4663    1         2 BND UBIN(20) UNAL,
      160     4664    1         2 * BIT(16) UNAL,
      161     4665    1         2 PTR$ PTR;
      162     4666    1   DCL 1 BPTR BASED ALIGNED,
      163     4667    1         2 OFFSET UBIN(18) UNAL,
      164     4668    1         2 * UBIN(18) UNAL;
      165     4669    1   DCL JRECORD(0:1023) UBIN STATIC;        /* Space for journal record           */
      166     4670    1   DCL I UBIN;
      167     4671    1   DCL K UBIN;
      168     4672    1   DCL  JN CHAR(JNAME.L#) BASED;
      169     4673    1   DCL DUMMY_SN CHAR(SNSZ)  BASED;
      170     4674    1   DCL SNSZ UBIN STATIC;
      171     4675    1   DCL DELFFLG BIT(1);
      172     4676    1   DCL FREE BIT(1);
      173     4677    1   DCL P$$ PTR BASED;
      174     4678        %VLP_ERRCODE (FPTN=ASNERR,ERR#=%E$ASNERR,FCG='0612'O,MID='12'O,SEV=4);
      175     4723        %VLP_ERRCODE (FPTN=NOSNERR,ERR#=%E$FJ_NOSN,FCG='0612'O,MID='12'O,SEV=4);
      176     4768        %VLP_ERRCODE (FPTN=NOAUTH,ERR#=%E$NOAUTH,FCG='0612'O,MID='12'O,SEV=0);
      177     4813        %VLP_ERRCODE (FPTN=NOJRNL,ERR#=%E$NOJRNL,FCG='0612'O,MID='12'O,SEV=0);
      178     4858        %VLP_ERRCODE (FPTN=JRNLCLSD,ERR#=%E$JRNLCLSD,FCG='0612'O,MID='12'O,SEV=4);
      179     4903        %VLP_ERRCODE (FPTN=JRNLSTAR,ERR#=%E$JRNLSTAR,FCG='0612'O,MID='12'O,SEV=4);
      180     4948        %VLP_ERRCODE(FPTN=NORENAME,ERR#=%E$NORENAME,FCG=FJ,MID=J,SEV=4,STCLASS=CONSTANT);
      181     4993        %VLP_ERRCODE(FPTN=NOTOWNER,ERR#=%E$NOTOWNER,FCG=FJ,MID=J,SEV=4,STCLASS=CONSTANT);
      182     5038    1   DCL CGEXISTS BIT(1) STATIC;
      183     5039
      184     5040    1   DCL OCBUF CHAR(100) STATIC;
      185     5041    1   DCL ERRBUF CHAR(240) STATIC;
      186     5042    1   DCL OCERRBUF(0:3) CHAR(120) STATIC;
      187     5043    1   DCL ERRCODE BIT(36) STATIC;
      188     5044    1   DCL ACCN CHAR(8);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:56   
      189     5045    1   DCL NAME CHAR(12);
      190     5046    1   DCL FACCN CHAR(8);
      191     5047    1   DCL PRIV BIT(36);
      192     5048    1   DCL EVENT UBIN;
      193     5049    1   DCL XDCB UBIN STATIC;
      194     5050
      195     5051        /* Structure for comgroup description     */
      196     5052
      197     5053    1   DCL 1 CG BASED ALIGNED,
      198     5054    1         2 LNK$ PTR,
      199     5055    1         2 ERR# UBIN,
      200     5056    1         2 DCB# UBIN,
      201     5057    1         2 JRNL$ PTR,
      202     5058    1         2 CFU UBIN,
      203     5059    1         2 HISDCB UBIN,               /* POFFW(USERS CG DCB)  */
      204     5060    1         2 HISUSER# UBIN,             /* CG openers user number  */
      205     5061              %KC$CGID (FPTN=ID,STCLASS=BASED,LVL=2,LAST=",");
      206     5087    1         2 BUF CHAR(1024);
      207     5088    1   DCL CG# UBIN STATIC INIT(0);
      208     5089    1   DCL CSCG_BUF(0:100) UBIN STATIC;        /* Buffer for CSCG input              */
      209     5090    1   DCL BUF$ PTR STATIC INIT(ADDR(CSCG_BUF));
      210     5091    1   DCL JRNL_FIT(0:1023) UBIN STATIC;
      211     5092    1   DCL F$ PTR STATIC;
      212     5093
      213     5094
      214     5095        /* Structure for journal file descriptions  */
      215     5096
      216     5097    1   DCL 1 JRNL BASED,
      217     5098    1         2 LNK$ PTR,
      218     5099    1         2 DCB# UBIN,
      219     5100    1         2 CFU UBIN,                  /* CFU OFFSET    */
      220     5101    1         2 ASN UBIN,                  /* TAPE OR FILE  */
      221     5102    1         2 CGCNT UBIN,                /* # CG USING THIS JOURNAL */
      222     5103    1         2 UTS UBIN,                  /* TIME WHEN USER=1 DETECTED */
      223     5104    1         2 PSN  CHAR(6),              /* FILE PACKSET NAME */
      224     5105    1         2 * UBIN(18) UNAL,
      225     5106    1         2 NAME,
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:57   
      226     5107    1           3 L UBIN(9) UNAL,
      227     5108    1           3 TXT CHAR(31),
      228     5109    1         2 ACCT CHAR(8),
      229     5110    1         2 RENAME,
      230     5111    1           3 L UBIN(9) UNAL,
      231     5112    1           3 TXT CHAR(31),
      232     5113    1         2 ATTR$ PTR;
      233     5114
      234     5115    1   DCL B_VERSION CHAR (1) SYMREF;
      235     5116    1   DCL 1 B$VERSIONB BASED,
      236     5117    1         2 C_ UBIN BYTE CALIGNED,
      237     5118    1         2 T_ CHAR (B$VERSIONB.C_) CALIGNED;
      238     5119
      239     5120        %FPT_WRITE(FPTN=GREETING,
      240     5121                   DCB =M$GREETING,
      241     5122                   BUF =OUTLINE,
      242     5123                   WAIT=YES);
      243     5154    1   DCL OUTLINE CHAR (80) STATIC CALIGNED INIT(' ');
      244     5155    1   DCL M$GREETING DCB;
      245     5156
      246     5157        %EJECT
      247     5158
      248     5159    1         CALL CONCAT(OUTLINE,'JAYS ',ADDR(B_VERSION)->

   5159  5 000002   000000 236000 xsym               LDQ     B_VERSION
         5 000003   000033 772000                    QRL     27
         5 000004   040000 100400                    MLR     fill='040'O
         5 000005   000002 000005 3                  ADSC9   NOTOWNER+1               cn=0,n=5
         5 000006   006174 000005 1                  ADSC9   OUTLINE                  cn=0,n=5
         5 000007   000000 620006                    EAX0    0,QL
         5 000010   040000 100440                    MLR     fill='040'O
         5 000011   000000 200010 xsym               ADSC9   B_VERSION                cn=1,n=*X0
         5 000012   006175 200113 1                  ADSC9   OUTLINE+1                cn=1,n=75
         5 000013   000113 116007                    CMPQ    75,DL
         5 000014   000022 603000 5                  TRC     s:5161
         5 000015   777664 621006                    EAX1    -76,QL
         5 000016   777777 661003                    ERX1    -1,DU
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:58   
         5 000017   040046 100400                    MLR     fill='040'O
         5 000020   000004 000005 3                  ADSC9   NOTOWNER+3               cn=0,n=5
         5 000021   006175 200011 1                  ADSC9   OUTLINE+1,Q              cn=1,n=*X1

      249     5160    1            B$VERSIONB.T_,' here');
      250     5161    1         CALL M$WRITE(GREETING);

   5161  5 000022   006160 630400 1                  EPPR0   GREETING
         5 000023   040001 713400                    CLIMB   write
         5 000024   401400 401760                    pmme    nvectors=4

      251     5162        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:59   
      252     5163        /* If not the system ghost, do user requests.                      */
      253     5164
      254     5165    2         IF B$JIT$->B$JIT.SYSID ~= %JG_JAYS# THEN DO;

   5165  5 000025   000000 470400 xsym               LDP0    B$JIT$
         5 000026   000000 720100                    LXL0    0,,PR0
         5 000027   000015 100003                    CMPX0   13,DU
         5 000030   000036 600000 5                  TZE     STARSTAR

      255     5166    2            CALL FJJ$CJAY ALTRET(STARSTAR);

   5166  5 000031   000002 631400 xsym               EPPR1   B_VECTNIL+2
         5 000032   000000 701000 xent               TSX1    FJJ$CJAY
         5 000033   000036 702000 5                  TSX2    STARSTAR

      256     5167    2            CALL M$EXIT;

   5167  5 000034   000001 713400                    CLIMB   exit
         5 000035   000000 401760                    pmme    nvectors=0

      257     5168    2            END;

   5165  5 000036                       STARSTAR     null
      258     5169    1   STARSTAR:;
      259     5170        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:60   
      260     5171        /* Initialization.  Get space in data segments for CG journal station
      261     5172           tables and Journal File stations.  If MM ALTRETs to us let it
      262     5173           go to abort since theres nothing else that can be done.
      263     5174           Set up the event handler entry.  Open to CSCG and do the first
      264     5175           no-wait read to get started.  Again, if any of these fail, theres
      265     5176           nothing else to do but abort.                                      */
      266     5177
      267     5178    1         GDS_JFID.V.SEGSIZE#=1024;

   5178  5 000036   002000 220003                    LDX0    1024,DU
         5 000037   001160 440000 1                  SXL0    GDS_JFID+4

      268     5179    1         GDS_SN.V.SEGSIZE#=1024;

   5179  5 000040   001166 440000 1                  SXL0    GDS_SN+4

      269     5180    1         GDS_JRNL.V.SEGSIZE#=1024;

   5180  5 000041   001152 440000 1                  SXL0    GDS_JRNL+4

      270     5181    1         GDS_CG.V.SEGSIZE#=1024;

   5181  5 000042   001144 440000 1                  SXL0    GDS_CG+4

      271     5182    1         CALL M$GDS (GDS_JRNL);

   5182  5 000043   001146 630400 1                  EPPR0   GDS_JRNL
         5 000044   030001 713400                    CLIMB   gds
         5 000045   400400 401760                    pmme    nvectors=2

      272     5183    1         JRNLFREE$=JRNL_V.P$;

   5183  5 000046   001453 236000 1                  LDQ     JRNL_V+1
         5 000047   200011 756100                    STQ     JRNLFREE$,,AUTO

      273     5184    1         J$=JRNLFREE$;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:61   
   5184  5 000050   200010 756100                    STQ     J$,,AUTO

      274     5185    2         DO WHILE (PINCRW(J$,SIZEW(JRNL)) < PINCRC(JRNL_V.P$,JRNL_V.BND+1));

   5185  5 000051   000060 710000 5                  TRA     s:5189

      275     5186    2            C$=J$;

   5186  5 000052   200010 236100                    LDQ     J$,,AUTO
         5 000053   200004 756100                    STQ     C$,,AUTO

      276     5187    2            J$->JRNL.LNK$=PINCRW(J$,SIZEW(JRNL));

   5187  5 000054   000033 036003                    ADLQ    27,DU
         5 000055   200010 470500                    LDP0    J$,,AUTO
         5 000056   000000 756100                    STQ     0,,PR0

      277     5188    2            J$=J$->JRNL.LNK$;

   5188  5 000057   200010 756100                    STQ     J$,,AUTO

      278     5189    2            END;

   5189  5 000060   001452 236000 1                  LDQ     JRNL_V
         5 000061   000020 772000                    QRL     16
         5 000062   000020 736000                    QLS     16
         5 000063   200000 036007                    ADLQ    65536,DL
         5 000064   001453 036000 1                  ADLQ    JRNL_V+1
         5 000065   200040 756100                    STQ     P$+2,,AUTO
         5 000066   200010 236100                    LDQ     J$,,AUTO
         5 000067   000033 036003                    ADLQ    27,DU
         5 000070   200040 116100                    CMPQ    P$+2,,AUTO
         5 000071   000052 602000 5                  TNC     s:5186

      279     5190    1         C$->JRNL.LNK$=ADDR(NIL);

   5190  5 000072   000001 236000 xsym               LDQ     B_VECTNIL+1
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:62   
         5 000073   200004 470500                    LDP0    C$,,AUTO
         5 000074   000000 756100                    STQ     0,,PR0

      280     5191    1         CGACTIVE$=ADDR(NIL);

   5191  5 000075   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 000076   200007 756100                    STQ     CGACTIVE$,,AUTO

      281     5192    1         JRNLACTIVE$=ADDR(NIL);

   5192  5 000077   200012 756100                    STQ     JRNLACTIVE$,,AUTO

      282     5193    1         CALL M$GDS (GDS_CG) ;

   5193  5 000100   001140 630400 1                  EPPR0   GDS_CG
         5 000101   030001 713400                    CLIMB   gds
         5 000102   400400 401760                    pmme    nvectors=2

      283     5194    1         CGFREE$=CG_V.P$;

   5194  5 000103   001451 236000 1                  LDQ     CG_V+1
         5 000104   200006 756100                    STQ     CGFREE$,,AUTO

      284     5195    1         CG$=CGFREE$;

   5195  5 000105   200005 756100                    STQ     CG$,,AUTO

      285     5196    2         DO WHILE ( PINCRW(CG$,SIZEW(CG)) < PINCRC(CG_V.P$,CG_V.BND+1));

   5196  5 000106   000115 710000 5                  TRA     s:5200

      286     5197    2            C$=CG$;

   5197  5 000107   200005 236100                    LDQ     CG$,,AUTO
         5 000110   200004 756100                    STQ     C$,,AUTO

      287     5198    2            CG$->CG.LNK$=PINCRW(CG$,SIZEW(CG));
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:63   

   5198  5 000111   000423 036003                    ADLQ    275,DU
         5 000112   200005 470500                    LDP0    CG$,,AUTO
         5 000113   000000 756100                    STQ     0,,PR0

      288     5199    2            CG$=CG$->CG.LNK$;

   5199  5 000114   200005 756100                    STQ     CG$,,AUTO

      289     5200    2            END;

   5200  5 000115   001450 236000 1                  LDQ     CG_V
         5 000116   000020 772000                    QRL     16
         5 000117   000020 736000                    QLS     16
         5 000120   200000 036007                    ADLQ    65536,DL
         5 000121   001451 036000 1                  ADLQ    CG_V+1
         5 000122   200040 756100                    STQ     P$+2,,AUTO
         5 000123   200005 236100                    LDQ     CG$,,AUTO
         5 000124   000423 036003                    ADLQ    275,DU
         5 000125   200040 116100                    CMPQ    P$+2,,AUTO
         5 000126   000107 602000 5                  TNC     s:5197

      290     5201    1         C$->CG.LNK$=ADDR(NIL);

   5201  5 000127   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 000130   200004 470500                    LDP0    C$,,AUTO
         5 000131   000000 756100                    STQ     0,,PR0

      291     5202    1         CALL M$GDS (GDS_JFID);

   5202  5 000132   001154 630400 1                  EPPR0   GDS_JFID
         5 000133   030001 713400                    CLIMB   gds
         5 000134   400400 401760                    pmme    nvectors=2

      292     5203    1         CALL M$GDS (GDS_SN);

   5203  5 000135   001162 630400 1                  EPPR0   GDS_SN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:64   
         5 000136   030001 713400                    CLIMB   gds
         5 000137   400400 401760                    pmme    nvectors=2

      293     5204    1         JSN$=SN_V.P$;

   5204  5 000140   001457 236000 1                  LDQ     SN_V+1
         5 000141   200003 756100                    STQ     JSN$,,AUTO

      294     5205    2         DO I = 0 TO %EV#;

   5205  5 000142   200013 450100                    STZ     I,,AUTO

      295     5206    2            FJ_EV.LNK(I)=I+1;

   5206  5 000143   200013 236100                    LDQ     I,,AUTO
         5 000144   000011 402007                    MPY     9,DL
         5 000145   200013 235100                    LDA     I,,AUTO
         5 000146   000001 035007                    ADLA    1,DL
         5 000147   000000 755006 xsym               STA     FJ_EV,QL

      296     5207    2            END;

   5207  5 000150   200013 755100                    STA     I,,AUTO
         5 000151   000145 115007                    CMPA    101,DL
         5 000152   000143 602000 5                  TNC     s:5206

      297     5208    1         FJ_EVFREE = 0;

   5208  5 000153   000000 450000 xsym               STZ     FJ_EVFREE

      298     5209    1         FJ_EVHD=-1;

   5209  5 000154   000001 336007                    LCQ     1,DL
         5 000155   000000 756000 xsym               STQ     FJ_EVHD

      299     5210    1         FJ_EVTL=-1;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:65   
   5210  5 000156   000000 756000 xsym               STQ     FJ_EVTL

      300     5211    1         FJ_EV.LNK(%EV#)=-1;

   5211  5 000157   001604 756000 xsym               STQ     FJ_EV+900

      301     5212        /* Initialize pointer to journal record area and point M$TIME at record */
      302     5213
      303     5214    1         JRNL$=ADDR(JRECORD);

   5214  5 000160   000000 236000 6                  LDQ     0
         5 000161   000000 756000 1                  STQ     JRNL$

      304     5215    1         CG_TIME.TSTAMP_=VECTOR(FILE.TIME);

   5215  5 000162   777640 235007                    LDA     -96,DL
         5 000163   001442 757000 1                  STAQ    CG_TIME+8

      305     5216
      306     5217    1         CALL M$XCON (JRNL_XCON);

   5217  5 000164   000056 630400 1                  EPPR0   JRNL_XCON
         5 000165   010003 713400                    CLIMB   4099
         5 000166   400400 401760                    pmme    nvectors=2

      307     5218    1         CALL M$EVENT(JRNL_EVENTS);

   5218  5 000167   000052 630400 1                  EPPR0   JRNL_EVENTS
         5 000170   010001 713400                    CLIMB   4097
         5 000171   400000 401760                    pmme    nvectors=1

      308     5219    1         CALL DAM$INIT ALTRET(INITXXX);

   5219  5 000172   000002 631400 xsym               EPPR1   B_VECTNIL+2
         5 000173   000000 701000 xent               TSX1    DAM$INIT
         5 000174   000176 702000 5                  TSX2    INITXXX

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:66   
      309     5220    2         DO WHILE ('0'B);

   5220  5 000175   000200 710000 5                  TRA     s:5224

      310     5221    2   INITXXX: CALL M$XXX;              /* Abort if mapping dosn't work */

   5221  5 000176   000003 713400       INITXXX      CLIMB   3
         5 000177   000000 401760                    pmme    nvectors=0

      311     5222    2            END;

      312     5223
      313     5224    1         CALL M$OPEN (OPN_CSCG);

   5224  5 000200   000072 630400 1                  EPPR0   OPN_CSCG
         5 000201   050000 713400                    CLIMB   open
         5 000202   410400 401760                    pmme    nvectors=18

      314     5225    1         CALL M$READ (RD_CSCG);

   5225  5 000203   000164 630400 1                  EPPR0   RD_CSCG
         5 000204   040000 713400                    CLIMB   read
         5 000205   401400 401760                    pmme    nvectors=4

      315     5226        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:67   
      316     5227        /* Wait for results from no-wait reads of CSCG or comgroup journal
      317     5228           stations or events.  Keep inhibited until the event is pulled
      318     5229           from the event list.  When processing is completed, someone will
      319     5230           put the used entry back on a free event list.                      */
      320     5231
      321     5232    2         DO WHILE('1'B);

      322     5233    3            DO INHIBIT;

      323     5234    4               DO WHILE (FJ_EVHD < 0);

   5234  5 000206   000000 235200 xsym               LDA   ! FJ_EVHD
         5 000207   000217 605200 5                  TPL   ! s:5238

      324     5235    4                  CALL M$WAIT (WAIT_CSCG);

   5235  5 000210   000064 630600 1                  EPPR0 ! WAIT_CSCG
         5 000211   020006 713600                    CLIMB ! 8198
         5 000212   400400 401760                    pmme    nvectors=2

      325     5236    4                  CALL CHKJRNLS;

   5236  5 000213   003305 701200 5                  TSX1  ! CHKJRNLS
         5 000214   000000 011200                    NOP   ! 0

      326     5237    4                  END;

   5237  5 000215   000000 235200 xsym               LDA   ! FJ_EVHD
         5 000216   000210 604200 5                  TMI   ! s:5235

      327     5238    3               EVENT=FJ_EVHD;

   5238  5 000217   200027 755300                    STA   ! EVENT,,AUTO

      328     5239    3               FJ_EVHD=FJ_EV.LNK(FJ_EVHD);

   5239  5 000220   000000 236200 xsym               LDQ   ! FJ_EVHD
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:68   
         5 000221   000011 402207                    MPY   ! 9,DL
         5 000222   000000 235206 xsym               LDA   ! FJ_EV,QL
         5 000223   000000 755200 xsym               STA   ! FJ_EVHD

      329     5240    3               IF FJ_EVHD < 0 THEN

   5240  5 000224   000226 605200 5                  TPL   ! s:5246

      330     5241    3                  FJ_EVTL = FJ_EVHD;

   5241  5 000225   000000 755200 xsym               STA   ! FJ_EVTL

      331     5242    3               END;                      /* end inhibit                        */

      332     5243        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:69   
      333     5244
      334     5245
      335     5246    3            DO CASE (FJ_EV.EVID(EVENT));

   5246  5 000226   200027 236100                    LDQ     EVENT,,AUTO
         5 000227   000011 402007                    MPY     9,DL
         5 000230   000001 235006 xsym               LDA     FJ_EV+1,QL
         5 000231   000005 115007                    CMPA    5,DL
         5 000232   000234 602005 5                  TNC     s:5246+6,AL
         5 000233   000206 710000 5                  TRA     s:5234
         5 000234   003135 710000 5                  TRA     s:5886
         5 000235   000241 710000 5                  TRA     s:5248
         5 000236   003044 710000 5                  TRA     s:5862
         5 000237   002352 710000 5                  TRA     s:5734
         5 000240   002760 710000 5                  TRA     DSM1

      336     5247    3             CASE(%CSCG_RD_EV#);         /* CSCG read completed                */

      337     5248    3               CALL DAM$MAP (B$DS1$,CFU$) ALTRET(INITXXX);

   5248  5 000241   000001 630400 6                  EPPR0   1
         5 000242   000020 631400 xsym               EPPR1   B_VECTNIL+16
         5 000243   000000 701000 xent               TSX1    DAM$MAP
         5 000244   000176 702000 5                  TSX2    INITXXX

      338     5249    4               DO CASE(BUF$->JRNOPN.CODE);

   5249  5 000245   004156 470400 1                  LDP0    BUF$
         5 000246   000000 220100                    LDX0    0,,PR0
         5 000247   000005 100003                    CMPX0   5,DU
         5 000250   000252 602010 5                  TNC     s:5249+5,X0
         5 000251   002331 710000 5                  TRA     XIT_CSCG_RD
         5 000252   000257 710000 5                  TRA     s:5261
         5 000253   000257 710000 5                  TRA     s:5261
         5 000254   001624 710000 5                  TRA     s:5560
         5 000255   002026 710000 5                  TRA     s:5614
         5 000256   002223 710000 5                  TRA     s:5676
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:70   

      339     5250
      340     5251
      341     5252
      342     5253
      343     5254        /* Comgroup open.  Open to the comgroup as station JRNLSTA. Do a CGINFO to
      344     5255           find out the journal FID and open the journal file.  Make an entry
      345     5256           in the journal and read the CG journal station.  If the journal FID
      346     5257           has length zero, then we are to quit journaling.  If the FID changed
      347     5258           then we are to switch journal files.                               */
      348     5259
      349     5260    4                CASE(FJ_JRNOPN#,FJ_CGOPN#);

      350     5261    4                  WR_JRNL_RESULTS.BUF_=VECTOR(OPN_ANSWER);

   5261  5 000257   000004 237000 6                  LDAQ    4
         5 000260   000224 757000 1                  STAQ    WR_JRNL_RESULTS+4

      351     5262    4                  OPN_ANSWER.ERR='0'B;

   5262  5 000261   000017 450000 1                  STZ     OPN_ANSWER

      352     5263    4                  K=POFFW(BUF$->JRNOPN.P$,B$DS1$);

   5263  5 000262   000000 235000 xsym               LDA     B$DS1$
         5 000263   000022 771000                    ARL     18
         5 000264   200040 755100                    STA     P$+2,,AUTO
         5 000265   000001 236100                    LDQ     1,,PR0
         5 000266   000022 772000                    QRL     18
         5 000267   200040 136100                    SBLQ    P$+2,,AUTO
         5 000270   200014 756100                    STQ     K,,AUTO

      353     5264    5                  IF PINCRW(CFU$,K)->FM$CFU.FUN ~= %JRNL# THEN DO;

   5264  5 000271   001446 471400 1                  LDP1    CFU$
         5 000272   100000 236106                    LDQ     0,QL,PR1
         5 000273   700000 376003                    ANQ     -32768,DU
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:71   
         5 000274   400000 116003                    CMPQ    -131072,DU
         5 000275   001265 600000 5                  TZE     s:5469

      354     5265    5                     CGEXISTS='1'B;

   5265  5 000276   400000 236003                    LDQ     -131072,DU
         5 000277   003470 756000 1                  STQ     CGEXISTS

      355     5266    5                     CG$=CGACTIVE$;

   5266  5 000300   200007 236100                    LDQ     CGACTIVE$,,AUTO
         5 000301   200005 756100                    STQ     CG$,,AUTO

      356     5267    6                     DO WHILE (CG$~=ADDR(NIL));

   5267  5 000302   000311 710000 5                  TRA     s:5271

      357     5268    6                        IF CG$->CG.CFU=K THEN

   5268  5 000303   200005 470500                    LDP0    CG$,,AUTO
         5 000304   000004 236100                    LDQ     4,,PR0
         5 000305   200014 116100                    CMPQ    K,,AUTO
         5 000306   000512 600000 5                  TZE     HAVECG

      358     5269    6                           GOTO HAVECG;
      359     5270    6                        CG$=CG$->CG.LNK$;

   5270  5 000307   000000 236100                    LDQ     0,,PR0
         5 000310   200005 756100                    STQ     CG$,,AUTO

      360     5271    6                        END;

   5271  5 000311   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 000312   000303 601000 5                  TNZ     s:5268

      361     5272
      362     5273    5                     CGEXISTS='0'B;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:72   

   5273  5 000313   003470 450000 1                  STZ     CGEXISTS

      363     5274    5                     CALL M$GETDCB (GET_JRNL_DCB) ALTRET(NODCB);

   5274  5 000314   000244 630400 1                  EPPR0   GET_JRNL_DCB
         5 000315   460002 713400                    CLIMB   alt,+24578
         5 000316   401000 401760                    pmme    nvectors=3
         5 000317   001155 702000 5                  TSX2    NODCB

      364     5275    6                     DO INHIBIT;

      365     5276    7                        IF CGFREE$ = ADDR(NIL) THEN DO;

   5276  5 000320   200006 236300                    LDQ   ! CGFREE$,,AUTO
         5 000321   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         5 000322   000363 601200 5                  TNZ   ! s:5287

      366     5277    7                           CG$=PINCRW(CG_V.P$,((CG_V.BND+1)/SIZEC(CG))*SIZEW(CG));

   5277  5 000323   001450 236200 1                  LDQ   ! CG_V
         5 000324   000020 772200                    QRL   ! 16
         5 000325   000001 036207                    ADLQ  ! 1,DL
         5 000326   002114 506207                    DIV   ! 1100,DL
         5 000327   000423 402203                    MPY   ! 275,DU
         5 000330   001451 036200 1                  ADLQ  ! CG_V+1
         5 000331   200005 756300                    STQ   ! CG$,,AUTO

      367     5278    7                           CGFREE$=CG$;

   5278  5 000332   200006 756300                    STQ   ! CGFREE$,,AUTO

      368     5279    7                           CALL M$GDS (GDS_CG) ALTRET(OP_CG_ERR);

   5279  5 000333   001140 630600 1                  EPPR0 ! GDS_CG
         5 000334   430001 713600                    CLIMB ! alt,gds
         5 000335   400400 401760                    pmme    nvectors=2
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:73   
         5 000336   001162 702200 5                  TSX2  ! OP_CG_ERR

      369     5280    8                          DO WHILE (PINCRW(CG$,SIZEW(CG)) < PINCRC(CG_V.P$,CG_V.BND+1)
              5280                                    );

   5280  5 000337   000346 710200 5                  TRA   ! s:5284

      370     5281    8                              C$=CG$;

   5281  5 000340   200005 236300                    LDQ   ! CG$,,AUTO
         5 000341   200004 756300                    STQ   ! C$,,AUTO

      371     5282    8                              CG$->CG.LNK$=PINCRW(CG$,SIZEW(CG));

   5282  5 000342   000423 036203                    ADLQ  ! 275,DU
         5 000343   200005 470700                    LDP0  ! CG$,,AUTO
         5 000344   000000 756300                    STQ   ! 0,,PR0

      372     5283    8                              CG$=CG$->CG.LNK$;

   5283  5 000345   200005 756300                    STQ   ! CG$,,AUTO

      373     5284    8                              END;

   5284  5 000346   001450 236200 1                  LDQ   ! CG_V
         5 000347   000020 772200                    QRL   ! 16
         5 000350   000020 736200                    QLS   ! 16
         5 000351   200000 036207                    ADLQ  ! 65536,DL
         5 000352   001451 036200 1                  ADLQ  ! CG_V+1
         5 000353   200040 756300                    STQ   ! P$+2,,AUTO
         5 000354   200005 236300                    LDQ   ! CG$,,AUTO
         5 000355   000423 036203                    ADLQ  ! 275,DU
         5 000356   200040 116300                    CMPQ  ! P$+2,,AUTO
         5 000357   000340 602200 5                  TNC   ! s:5281

      374     5285    7                           C$->CG.LNK$=ADDR(NIL);

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:74   
   5285  5 000360   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         5 000361   200004 470700                    LDP0  ! C$,,AUTO
         5 000362   000000 756300                    STQ   ! 0,,PR0

      375     5286    7                           END;

      376     5287    6                        CG$=CGFREE$;       /* Get a free CG list entry           */

   5287  5 000363   200006 236300                    LDQ   ! CGFREE$,,AUTO
         5 000364   200005 756300                    STQ   ! CG$,,AUTO

      377     5288    6                        CGFREE$=CG$->CG.LNK$;

   5288  5 000365   200005 470700                    LDP0  ! CG$,,AUTO
         5 000366   000000 236300                    LDQ   ! 0,,PR0
         5 000367   200006 756300                    STQ   ! CGFREE$,,AUTO

      378     5289    6                        CG$->CG.LNK$=CGACTIVE$;

   5289  5 000370   200007 236300                    LDQ   ! CGACTIVE$,,AUTO
         5 000371   000000 756300                    STQ   ! 0,,PR0

      379     5290    6                        CGACTIVE$=CG$;     /* Link active CG entries             */

   5290  5 000372   200005 236300                    LDQ   ! CG$,,AUTO
         5 000373   200007 756300                    STQ   ! CGACTIVE$,,AUTO

      380     5291    6                        END;

      381     5292    5                     CG$->CG.CFU=K;

   5292  5 000374   200014 235100                    LDA     K,,AUTO
         5 000375   000004 755100                    STA     4,,PR0

      382     5293    5                     CG$->CG.HISDCB=ADDR(BUF$->JRNOPN.DCB$)->BPTR.OFFSET;

   5293  5 000376   004156 471400 1                  LDP1    BUF$
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:75   
         5 000377   100002 236100                    LDQ     2,,PR1
         5 000400   000022 772000                    QRL     18
         5 000401   000005 756100                    STQ     5,,PR0

      383     5294    5                     CG$->CG.HISUSER#=BUF$->JRNOPN.USER#;

   5294  5 000402   100000 236100                    LDQ     0,,PR1
         5 000403   777777 376007                    ANQ     -1,DL
         5 000404   000006 756100                    STQ     6,,PR0

      384     5295    5                     I=PINCRW(CFU$,K)->FM$CFU.NAMEX;

   5295  5 000405   001446 473400 1                  LDP3    CFU$
         5 000406   300002 236105                    LDQ     2,AL,PR3
         5 000407   777777 376007                    ANQ     -1,DL
         5 000410   200013 756100                    STQ     I,,AUTO

      385     5296    6                     DO WHILE ( I<=CFU$->FM$CFUX.CFUT );

   5296  5 000411   300002 236100                    LDQ     2,,PR3
         5 000412   000022 772000                    QRL     18
         5 000413   200013 116100                    CMPQ    I,,AUTO
         5 000414   000426 602000 5                  TNC     s:5299

      386     5297    6                        I=PINCRW(CFU$,I)->FM$CFU.NAMEX;

   5297  5 000415   001446 470400 1                  LDP0    CFU$
         5 000416   200013 720100                    LXL0    I,,AUTO
         5 000417   000002 236110                    LDQ     2,X0,PR0
         5 000420   777777 376007                    ANQ     -1,DL
         5 000421   200013 756100                    STQ     I,,AUTO

      387     5298    6                        END;

   5298  5 000422   000002 236100                    LDQ     2,,PR0
         5 000423   000022 772000                    QRL     18
         5 000424   200013 116100                    CMPQ    I,,AUTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:76   
         5 000425   000415 603000 5                  TRC     s:5297

      388     5299    5                     CG$->CG.ID.NAME#.CNT=

   5299  5 000426   001446 470400 1                  LDP0    CFU$
         5 000427   200013 235100                    LDA     I,,AUTO
         5 000430   200005 471500                    LDP1    CG$,,AUTO
         5 000431   000100 100505                    MLR     fill='000'O
         5 000432   000000 400001                    ADSC9   0,A,PR0                  cn=2,n=1
         5 000433   100013 000001                    ADSC9   11,,PR1                  cn=0,n=1

      389     5300    5                        PINCRC(CFU$,I)->FM$CFUN.L;
      390     5301    5                     CG$->CG.ID.NAME#.TXT=

   5301  5 000434   001446 470400 1                  LDP0    CFU$
         5 000435   000100 101505                    MRL     fill='000'O
         5 000436   000000 400001                    ADSC9   0,A,PR0                  cn=2,n=1
         5 000437   200040 000002                    ADSC9   P$+2,,AUTO               cn=0,n=2
         5 000440   200040 220100                    LDX0    P$+2,,AUTO
         5 000441   040100 100545                    MLR     fill='040'O
         5 000442   000000 600010                    ADSC9   0,A,PR0                  cn=3,n=*X0
         5 000443   100013 200037                    ADSC9   11,,PR1                  cn=1,n=31

      391     5302    5                        PINCRC(CFU$,I)->FM$CFUN.C;
      392     5303    5                     CG$->CG.ID.ACCT#=

   5303  5 000444   001446 470400 1                  LDP0    CFU$
         5 000445   200014 720100                    LXL0    K,,AUTO
         5 000446   000002 221110                    LDX1    2,X0,PR0
         5 000447   000000 636011                    EAQ     0,X1
         5 000450   000020 772000                    QRL     16
         5 000451   040100 100506                    MLR     fill='040'O
         5 000452   000001 000010                    ADSC9   1,Q,PR0                  cn=0,n=8
         5 000453   100007 000010                    ADSC9   7,,PR1                   cn=0,n=8

      393     5304    5                        PINCRW(CFU$,PINCRW(CFU$,K)->FM$CFU.ACCTX)->FM$CFUA.ACCT;
      394     5305    5                     CG$->CG.ID.PSN#=
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:77   

   5305  5 000454   001446 470400 1                  LDP0    CFU$
         5 000455   000002 221110                    LDX1    2,X0,PR0
         5 000456   000000 236111                    LDQ     0,X1,PR0
         5 000457   000017 772000                    QRL     15
         5 000460   000006 376000 6                  ANQ     6
         5 000461   000002 736000                    QLS     2
         5 000462   040100 100506                    MLR     fill='040'O
         5 000463   000000 400006                    ADSC9   0,Q,PR0                  cn=2,n=6
         5 000464   100011 000006                    ADSC9   9,,PR1                   cn=0,n=6

      395     5306    5                        CFU$->FM$SET.PSN(PINCRW(CFU$,PINCRW(CFU$,K)->FM$CFU.ACCTX)->
              5306                                 FM$CFUA.SETX);
      396     5307    5                     CG$->CG.DCB#=XDCB;

   5307  5 000465   004007 236000 1                  LDQ     XDCB
         5 000466   100002 756100                    STQ     2,,PR1

      397     5308    5                     CG$->CG.JRNL$=ADDR(NIL);

   5308  5 000467   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 000470   100003 756100                    STQ     3,,PR1

      398     5309    5                     CG_OPN.ACCT_=VECTOR(CG$->CG.ID.ACCT#);

   5309  5 000471   000007 235000 6                  LDA     7
         5 000472   200005 236100                    LDQ     CG$,,AUTO
         5 000473   000007 036003                    ADLQ    7,DU
         5 000474   000304 757000 1                  STAQ    CG_OPN+20

      399     5310    5                     CG_OPN.NAME_=VECTOR(CG$->CG.ID.NAME#);

   5310  5 000475   000010 235000 6                  LDA     8
         5 000476   200005 236100                    LDQ     CG$,,AUTO
         5 000477   000013 036003                    ADLQ    11,DU
         5 000500   000266 757000 1                  STAQ    CG_OPN+6

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:78   
      400     5311    5                     CG_SN.SN#(0)= CG$->CG.ID.PSN#;

   5311  5 000501   040000 100500                    MLR     fill='040'O
         5 000502   100011 000006                    ADSC9   9,,PR1                   cn=0,n=6
         5 000503   000507 000006 1                  ADSC9   CG_SN+1                  cn=0,n=6

      401     5312    5                     CG_OPN.V.DCB#=CG$->CG.DCB#;

   5312  5 000504   100002 721100                    LXL1    2,,PR1
         5 000505   000324 741000 1                  STX1    CG_OPN+36

      402     5313    5                     CALL M$OPEN (CG_OPN) ALTRET(OP_CG_ERR);

   5313  5 000506   000260 630400 1                  EPPR0   CG_OPN
         5 000507   450000 713400                    CLIMB   alt,open
         5 000510   410400 401760                    pmme    nvectors=18
         5 000511   001162 702000 5                  TSX2    OP_CG_ERR

      403     5314
      404     5315        /* Get FID for journal file from CGINFO.                              */
      405     5316
      406     5317    5   HAVECG:           CG_INFO.V.DCB#=CG$->CG.DCB#;

   5317  5 000512   200005 470500       HAVECG       LDP0    CG$,,AUTO
         5 000513   000002 720100                    LXL0    2,,PR0
         5 000514   000422 740000 1                  STX0    CG_INFO+40

      407     5318    5                     CG_INFO.JRNLFID_=JFID_V;

   5318  5 000515   001454 237000 1                  LDAQ    JFID_V
         5 000516   000400 757000 1                  STAQ    CG_INFO+22

      408     5319    5   GETCGINFO:        CALL M$CGINFO (CG_INFO) ALTRET(JRNLERR);

   5319  5 000517   000352 630400 1     GETCGINFO    EPPR0   CG_INFO
         5 000520   500004 713400                    CLIMB   alt,+32772
         5 000521   411400 401760                    pmme    nvectors=20
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:79   
         5 000522   001205 702000 5                  TSX2    JRNLERR

      409     5320    5                     IF JFID_V.P$->JFID.L# = 0 THEN

   5320  5 000523   001455 470400 1                  LDP0    JFID_V+1
         5 000524   000100 101500                    MRL     fill='000'O
         5 000525   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         5 000526   200040 000004                    ADSC9   P$+2,,AUTO               cn=0,n=4
         5 000527   200040 236100                    LDQ     P$+2,,AUTO
         5 000530   000000 116003                    CMPQ    0,DU
         5 000531   001247 600000 5                  TZE     QUITCGJRNL

      410     5321    5                        GOTO QUITCGJRNL;
      411     5322    5                     IF JFID_V.P$->JFID.L#+SIZEC(JFID_V.P$->JFID.L#)-1 >

   5322  5 000532   001454 236000 1                  LDQ     JFID_V
         5 000533   000020 772000                    QRL     16
         5 000534   200040 756100                    STQ     P$+2,,AUTO
         5 000535   000100 101500                    MRL     fill='000'O
         5 000536   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         5 000537   200041 000004                    ADSC9   P$+3,,AUTO               cn=0,n=4
         5 000540   200041 236100                    LDQ     P$+3,,AUTO
         5 000541   200040 116100                    CMPQ    P$+2,,AUTO
         5 000542   000564 604000 5                  TMI     s:5332

      412     5323    6                        JFID_V.BND THEN DO;

      413     5324    6                        GDS_JFID.V.SEGSIZE#=(JFID_V.P$->JFID.L#+SIZEC(JFID_V.P$->JFID.
              5324                                 L#)

   5324  5 000543   001454 236000 1                  LDQ     JFID_V
         5 000544   000020 772000                    QRL     16
         5 000545   200040 756100                    STQ     P$+2,,AUTO
         5 000546   000100 101500                    MRL     fill='000'O
         5 000547   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         5 000550   200041 000004                    ADSC9   P$+3,,AUTO               cn=0,n=4
         5 000551   200041 236100                    LDQ     P$+3,,AUTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:80   
         5 000552   200040 136100                    SBLQ    P$+2,,AUTO
         5 000553   000004 036007                    ADLQ    4,DL
         5 000554   000004 506007                    DIV     4,DL
         5 000555   000000 620006                    EAX0    0,QL
         5 000556   001160 440000 1                  SXL0    GDS_JFID+4

      414     5325    6                           -JFID_V.BND+2)/4;
      415     5326    6                        CALL M$GDS (GDS_JFID) ALTRET(JRNLERR);

   5326  5 000557   001154 630400 1                  EPPR0   GDS_JFID
         5 000560   430001 713400                    CLIMB   alt,gds
         5 000561   400400 401760                    pmme    nvectors=2
         5 000562   001205 702000 5                  TSX2    JRNLERR

      416     5327    6                        GOTO GETCGINFO;

   5327  5 000563   000517 710000 5                  TRA     GETCGINFO

      417     5328    6                        END;
      418     5329
      419     5330        /* Try to make sure there will be enough space for serial number.     */
      420     5331
      421     5332    5                     CURSN$=PINCRW(JSN$,1);

   5332  5 000564   200003 236100                    LDQ     JSN$,,AUTO
         5 000565   000001 036003                    ADLQ    1,DU
         5 000566   001447 756000 1                  STQ     CURSN$

      422     5333    5   GSNS1:            SNSZ=POFFC(PINCRC(SN_V.P$,SN_V.BND+1),CURSN$)-SIZEC(JATTR)+4;

   5333  5 000567   001456 236000 1     GSNS1        LDQ     SN_V
         5 000570   000020 772000                    QRL     16
         5 000571   000020 736000                    QLS     16
         5 000572   200000 036007                    ADLQ    65536,DL
         5 000573   001457 036000 1                  ADLQ    SN_V+1
         5 000574   000020 772000                    QRL     16
         5 000575   200040 756100                    STQ     P$+2,,AUTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:81   
         5 000576   001447 236000 1                  LDQ     CURSN$
         5 000577   000020 772000                    QRL     16
         5 000600   200041 756100                    STQ     P$+3,,AUTO
         5 000601   200040 236100                    LDQ     P$+2,,AUTO
         5 000602   200041 136100                    SBLQ    P$+3,,AUTO
         5 000603   000010 136007                    SBLQ    8,DL
         5 000604   003461 756000 1                  STQ     SNSZ

      423     5334    6                     IF SNSZ < 16 THEN DO;

   5334  5 000605   000020 116007                    CMPQ    16,DL
         5 000606   000614 603000 5                  TRC     s:5339

      424     5335    6   GSNS2:               CALL M$GDS (GDS_SN) ALTRET(JRNLERR);

   5335  5 000607   001162 630400 1     GSNS2        EPPR0   GDS_SN
         5 000610   430001 713400                    CLIMB   alt,gds
         5 000611   400400 401760                    pmme    nvectors=2
         5 000612   001205 702000 5                  TSX2    JRNLERR

      425     5336    6                        GOTO GSNS1;

   5336  5 000613   000567 710000 5                  TRA     GSNS1

      426     5337    6                        END;
      427     5338
      428     5339    5                     FID_JFID.TEXTFID_=JFID_V;

   5339  5 000614   001454 237000 1                  LDAQ    JFID_V
         5 000615   001172 757000 1                  STAQ    FID_JFID+2

      429     5340    5                     ADDR(FID_JFID.TEXTFID_)->BVCTR.PTR$=PINCRC(JFID_V.P$,2);

   5340  5 000616   001455 236000 1                  LDQ     JFID_V+1
         5 000617   400000 036007                    ADLQ    -131072,DL
         5 000620   001173 756000 1                  STQ     FID_JFID+3

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:82   
      430     5341    5                     ADDR(FID_JFID.TEXTFID_)->BVCTR.BND=JFID_V.P$->JFID.L#-1;

   5341  5 000621   001455 470400 1                  LDP0    JFID_V+1
         5 000622   000100 101500                    MRL     fill='000'O
         5 000623   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         5 000624   200040 000004                    ADSC9   P$+2,,AUTO               cn=0,n=4
         5 000625   200040 236100                    LDQ     P$+2,,AUTO
         5 000626   000001 136007                    SBLQ    1,DL
         5 000627   000020 736000                    QLS     16
         5 000630   001172 676000 1                  ERQ     FID_JFID+2
         5 000631   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 000632   001172 656000 1                  ERSQ    FID_JFID+2

      431     5342    5                     FID_JFID.SN_=VECTOR(ADDR(CURSN$->JATTR.Q.NUM#)->DUMMY_SN);

   5342  5 000633   003461 236000 1                  LDQ     SNSZ
         5 000634   000064 737000                    LLS     52
         5 000635   000140 135007                    SBLA    96,DL
         5 000636   001447 236000 1                  LDQ     CURSN$
         5 000637   000002 036003                    ADLQ    2,DU
         5 000640   001202 757000 1                  STAQ    FID_JFID+10

      432     5343    5                     CALL M$FID (FID_JFID) ALTRET(FIDERR);

   5343  5 000641   001170 630400 1                  EPPR0   FID_JFID
         5 000642   420001 713400                    CLIMB   alt,+8193
         5 000643   404400 401760                    pmme    nvectors=10
         5 000644   000646 702000 5                  TSX2    FIDERR

      433     5344
      434     5345    6                     DO WHILE ('0'B);

   5345  5 000645   000700 710000 5                  TRA     s:5358

      435     5346    6   FIDERR:              IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$FIDOFLOW

   5346  5 000646   000000 470400 xsym  FIDERR       LDP0    B$TCB$
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:83   
         5 000647   000000 471500                    LDP1    0,,PR0
         5 000650   100102 236100                    LDQ     66,,PR1
         5 000651   377770 376007                    ANQ     131064,DL
         5 000652   015300 116007                    CMPQ    6848,DL
         5 000653   000677 601000 5                  TNZ     s:5350
         5 000654   001447 473400 1                  LDP3    CURSN$
         5 000655   300002 236100                    LDQ     2,,PR3
         5 000656   000006 402007                    MPY     6,DL
         5 000657   000003 036007                    ADLQ    3,DL
         5 000660   000002 772000                    QRL     2
         5 000661   200040 756100                    STQ     P$+2,,AUTO
         5 000662   001457 236000 1                  LDQ     SN_V+1
         5 000663   000020 772000                    QRL     16
         5 000664   200041 756100                    STQ     P$+3,,AUTO
         5 000665   001447 236000 1                  LDQ     CURSN$
         5 000666   000020 772000                    QRL     16
         5 000667   200041 136100                    SBLQ    P$+3,,AUTO
         5 000670   200040 036100                    ADLQ    P$+2,,AUTO
         5 000671   000013 036007                    ADLQ    11,DL
         5 000672   200042 756100                    STQ     P$+4,,AUTO
         5 000673   001456 236000 1                  LDQ     SN_V
         5 000674   000020 772000                    QRL     16
         5 000675   200042 116100                    CMPQ    P$+4,,AUTO
         5 000676   000607 604000 5                  TMI     GSNS2

      436     5347    6                           AND (CURSN$->JATTR.Q.NUM#*6+3)/4 + SIZEC(JATTR)
      437     5348    6                           +POFFC(CURSN$,SN_V.P$)-1 > SN_V.BND THEN
      438     5349    6                           GOTO GSNS2;
      439     5350    6                        GOTO JRNLERR;

   5350  5 000677   001205 710000 5                  TRA     JRNLERR

      440     5351    6                        END;

      441     5352
      442     5353        /* Check if the journal FID changed.  If it didn't, just return.
      443     5354           If it did, write a comgroup close record on the old journal and
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:84   
      444     5355           open the new one.  If there wasn't a journal for the comgroup,
      445     5356           go ahead and open the new one.
      446     5357                                                                              */
      447     5358    6                     IF CG$->CG.JRNL$ ~= ADDR(NIL) THEN DO;

   5358  5 000700   200005 470500                    LDP0    CG$,,AUTO
         5 000701   000003 236100                    LDQ     3,,PR0
         5 000702   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 000703   000734 600000 5                  TZE     s:5370

      448     5359    6                        IF CG$->CG.JRNL$->JRNL.NAME.L = JNAME.L# AND

   5359  5 000704   000003 471500                    LDP1    3,,PR0
         5 000705   100010 236100                    LDQ     8,,PR1
         5 000706   001414 676000 1                  ERQ     JNAME
         5 000707   777000 376003                    ANQ     -512,DU
         5 000710   000725 601000 5                  TNZ     s:5363
         5 000711   001414 236000 1                  LDQ     JNAME
         5 000712   000033 772000                    QRL     27
         5 000713   000000 620006                    EAX0    0,QL
         5 000714   000000 621006                    EAX1    0,QL
         5 000715   040040 106540                    CMPC    fill='040'O
         5 000716   100010 200010                    ADSC9   8,,PR1                   cn=1,n=*X0
         5 000717   001414 200011 1                  ADSC9   JNAME                    cn=1,n=*X1
         5 000720   000725 601000 5                  TNZ     s:5363
         5 000721   040000 106500                    CMPC    fill='040'O
         5 000722   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         5 000723   001412 000010 1                  ADSC9   JACCT                    cn=0,n=8
         5 000724   002331 600000 5                  TZE     XIT_CSCG_RD

      449     5360    6                          ADDR(CG$->CG.JRNL$->JRNL.NAME.TXT)->JN = ADDR(JNAME.NAME#)->
              5360                                    JN AND
      450     5361    6                           CG$->CG.JRNL$->JRNL.ACCT = JACCT.ACCT# THEN
      451     5362    6                           GOTO XIT_CSCG_RD;
      452     5363    6                        CALL WRBERC ALTRET(JRNLERR);

   5363  5 000725   003422 701000 5                  TSX1    WRBERC
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:85   
         5 000726   001205 702000 5                  TSX2    JRNLERR

      453     5364    6                        CG$->CG.JRNL$->JRNL.CGCNT=CG$->CG.JRNL$->JRNL.CGCNT-1;

   5364  5 000727   200005 470500                    LDP0    CG$,,AUTO
         5 000730   000003 471500                    LDP1    3,,PR0
         5 000731   100004 235100                    LDA     4,,PR1
         5 000732   000001 135007                    SBLA    1,DL
         5 000733   100004 755100                    STA     4,,PR1

      454     5365    6                        END;

      455     5366
      456     5367        /* Check to see if we're already the owner of the journal file,
      457     5368           or if we already have it opened.
      458     5369                                                        */
      459     5370    5                     J$=JRNLACTIVE$;

   5370  5 000734   200012 236100                    LDQ     JRNLACTIVE$,,AUTO
         5 000735   200010 756100                    STQ     J$,,AUTO

      460     5371    6                     DO WHILE (J$ ~= ADDR(NIL));

   5371  5 000736   000762 710000 5                  TRA     s:5377

      461     5372    6                        IF J$->JRNL.ACCT = JACCT.ACCT# AND

   5372  5 000737   200010 470500                    LDP0    J$,,AUTO
         5 000740   040000 106500                    CMPC    fill='040'O
         5 000741   000020 000010                    ADSC9   16,,PR0                  cn=0,n=8
         5 000742   001412 000010 1                  ADSC9   JACCT                    cn=0,n=8
         5 000743   000760 601000 5                  TNZ     s:5376
         5 000744   000010 236100                    LDQ     8,,PR0
         5 000745   001414 676000 1                  ERQ     JNAME
         5 000746   777000 376003                    ANQ     -512,DU
         5 000747   000760 601000 5                  TNZ     s:5376
         5 000750   001414 236000 1                  LDQ     JNAME
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:86   
         5 000751   000033 772000                    QRL     27
         5 000752   000000 620006                    EAX0    0,QL
         5 000753   000000 621006                    EAX1    0,QL
         5 000754   040040 106540                    CMPC    fill='040'O
         5 000755   000010 200010                    ADSC9   8,,PR0                   cn=1,n=*X0
         5 000756   001414 200011 1                  ADSC9   JNAME                    cn=1,n=*X1
         5 000757   001024 600000 5                  TZE     JRNL_EXISTS

      462     5373    6                           J$->JRNL.NAME.L = JNAME.L# AND
      463     5374    6                           ADDR(J$->JRNL.NAME.TXT)->JN = ADDR(JNAME.NAME#)->JN THEN
      464     5375    6                           GOTO JRNL_EXISTS;
      465     5376    6                        J$=J$->JRNL.LNK$;

   5376  5 000760   000000 236100                    LDQ     0,,PR0
         5 000761   200010 756100                    STQ     J$,,AUTO

      466     5377    6                        END;

   5377  5 000762   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 000763   000737 601000 5                  TNZ     s:5372

      467     5378
      468     5379        /* We don't know about it.  Get a DCB and open the journal file.
      469     5380                                                     */
      470     5381    5                     CALL GETJDCB ALTRET(JRNLERR);

   5381  5 000764   003136 701000 5                  TSX1    GETJDCB
         5 000765   001205 702000 5                  TSX2    JRNLERR

      471     5382    5                     J$->JRNL.ASN=JASN;

   5382  5 000766   200010 470500                    LDP0    J$,,AUTO
         5 000767   001460 236000 1                  LDQ     JASN
         5 000770   000033 772000                    QRL     27
         5 000771   000003 756100                    STQ     3,,PR0

      472     5383    5                     J$->JRNL.PSN=ADDR(CURSN$->JATTR.Q.NUM#)->SN.SN#(0);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:87   

   5383  5 000772   001447 471400 1                  LDP1    CURSN$
         5 000773   040100 100500                    MLR     fill='040'O
         5 000774   100003 000006                    ADSC9   3,,PR1                   cn=0,n=6
         5 000775   000006 000006                    ADSC9   6,,PR0                   cn=0,n=6

      473     5384    5                     J$->JRNL.NAME=JNAME;

   5384  5 000776   000100 100400                    MLR     fill='000'O
         5 000777   001414 000040 1                  ADSC9   JNAME                    cn=0,n=32
         5 001000   000010 000040                    ADSC9   8,,PR0                   cn=0,n=32

      474     5385    5                     J$->JRNL.ACCT=JACCT.ACCT#;

   5385  5 001001   001412 237000 1                  LDAQ    JACCT
         5 001002   000020 755100                    STA     16,,PR0
         5 001003   000021 756100                    STQ     17,,PR0

      475     5386    5                     J$->JRNL.ATTR$=CURSN$;

   5386  5 001004   001447 236000 1                  LDQ     CURSN$
         5 001005   000032 756100                    STQ     26,,PR0

      476     5387    5                     JSN$->P$$=J$;

   5387  5 001006   200010 236100                    LDQ     J$,,AUTO
         5 001007   200003 473500                    LDP3    JSN$,,AUTO
         5 001010   300000 756100                    STQ     0,,PR3

      477     5388    5                     JSN$=PINCRW(CURSN$,(CURSN$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR));

   5388  5 001011   100002 236100                    LDQ     2,,PR1
         5 001012   000006 402007                    MPY     6,DL
         5 001013   000003 036007                    ADLQ    3,DL
         5 001014   000002 772000                    QRL     2
         5 001015   000022 736000                    QLS     18
         5 001016   000003 036003                    ADLQ    3,DU
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:88   
         5 001017   001447 036000 1                  ADLQ    CURSN$
         5 001020   200003 756100                    STQ     JSN$,,AUTO

      478     5389
      479     5390    5                     J$->JRNL.CFU=0;

   5390  5 001021   000002 450100                    STZ     2,,PR0

      480     5391    5                     CALL OPN_CG_JRNL ALTRET(OPNJERR);

   5391  5 001022   003464 701000 5                  TSX1    OPN_CG_JRNL
         5 001023   001173 702000 5                  TSX2    OPNJERR

      481     5392
      482     5393    5   JRNL_EXISTS:      CG$->CG.JRNL$=J$;

   5393  5 001024   200010 236100       JRNL_EXISTS  LDQ     J$,,AUTO
         5 001025   200005 470500                    LDP0    CG$,,AUTO
         5 001026   000003 756100                    STQ     3,,PR0

      483     5394    5                     J$->JRNL.CGCNT=J$->JRNL.CGCNT+1;

   5394  5 001027   200010 471500                    LDP1    J$,,AUTO
         5 001030   100004 235100                    LDA     4,,PR1
         5 001031   000001 035007                    ADLA    1,DL
         5 001032   100004 755100                    STA     4,,PR1

      484     5395    6                     IF JFID_V.BND > 4095 THEN DO;

   5395  5 001033   001454 236000 1                  LDQ     JFID_V
         5 001034   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 001035   002000 116003                    CMPQ    1024,DU
         5 001036   001050 602000 5                  TNC     s:5402

      485     5396    6                        GDS_JFID.V.SEGSIZE#=(JFID_V.BND-4095)/4;

   5396  5 001037   001454 236000 1                  LDQ     JFID_V
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:89   
         5 001040   000020 772000                    QRL     16
         5 001041   007777 136007                    SBLQ    4095,DL
         5 001042   000004 506007                    DIV     4,DL
         5 001043   000000 620006                    EAX0    0,QL
         5 001044   001160 440000 1                  SXL0    GDS_JFID+4

      486     5397    6                        CALL M$GDS (GDS_JFID);

   5397  5 001045   001154 630400 1                  EPPR0   GDS_JFID
         5 001046   030001 713400                    CLIMB   gds
         5 001047   400400 401760                    pmme    nvectors=2

      487     5398    6                        END;

      488     5399
      489     5400
      490     5401        /* Build a File Open record for the journal file describing CG open  */
      491     5402    5                     FILE='0'B;

   5402  5 001050   000000 470400 1                  LDP0    JRNL$
         5 001051   000100 100400                    MLR     fill='000'O
         5 001052   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         5 001053   000000 000103                    ADSC9   0,,PR0                   cn=0,n=67

      492     5403    5                     FILE.TYPE=T#FID;

   5403  5 001054   003000 236003                    LDQ     1536,DU
         5 001055   000001 552140                    STBQ    1,'40'O,PR0

      493     5404    5                     FILE.DCB#=CG$->CG.HISDCB;

   5404  5 001056   200005 471500                    LDP1    CG$,,AUTO
         5 001057   100005 720100                    LXL0    5,,PR1
         5 001060   000001 440100                    SXL0    1,,PR0

      494     5405    5                     FILE.USER#=CG$->CG.HISUSER#;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:90   
   5405  5 001061   100006 236100                    LDQ     6,,PR1
         5 001062   000022 736000                    QLS     18
         5 001063   000001 552120                    STBQ    1,'20'O,PR0

      495     5406    5                     FILE.ID.ACCT#=CG$->CG.ID.ACCT#;

   5406  5 001064   040100 100500                    MLR     fill='040'O
         5 001065   100007 000010                    ADSC9   7,,PR1                   cn=0,n=8
         5 001066   000003 200010                    ADSC9   3,,PR0                   cn=1,n=8

      496     5407    5                     FILE.ID.NAME#=CG$->CG.ID.NAME#;

   5407  5 001067   000100 100500                    MLR     fill='000'O
         5 001070   100013 000040                    ADSC9   11,,PR1                  cn=0,n=32
         5 001071   000010 600040                    ADSC9   8,,PR0                   cn=3,n=32

      497     5408    5                     FILE.ID.PSN#=CG$->CG.ID.PSN#;

   5408  5 001072   040100 100500                    MLR     fill='040'O
         5 001073   100011 000006                    ADSC9   9,,PR1                   cn=0,n=6
         5 001074   000007 200006                    ADSC9   7,,PR0                   cn=1,n=6

      498     5409    5                     FILE.ID.PASS#=' ';

   5409  5 001075   040100 100400                    MLR     fill='040'O
         5 001076   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         5 001077   000005 200010                    ADSC9   5,,PR0                   cn=1,n=8

      499     5410    5                     FILE.COMGROUP='1'B;

   5410  5 001100   020000 236003                    LDQ     8192,DU
         5 001101   000003 256100                    ORSQ    3,,PR0

      500     5411    5                     CG_TIME.TSTAMP_=VECTOR(FILE.TIME);

   5411  5 001102   777640 235007                    LDA     -96,DL
         5 001103   000000 236000 1                  LDQ     JRNL$
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:91   
         5 001104   001442 757000 1                  STAQ    CG_TIME+8

      501     5412    5                     CALL M$TIME (CG_TIME);

   5412  5 001105   001432 630400 1                  EPPR0   CG_TIME
         5 001106   020004 713400                    CLIMB   8196
         5 001107   402000 401760                    pmme    nvectors=5

      502     5413    5                     WR_CG_JRNL.V.DCB#=J$->JRNL.DCB#;

   5413  5 001110   200010 470500                    LDP0    J$,,AUTO
         5 001111   000001 720100                    LXL0    1,,PR0
         5 001112   000756 740000 1                  STX0    WR_CG_JRNL+8

      503     5414    5                     WR_CG_JRNL.BUF_=VECTOR(FILE);

   5414  5 001113   000011 235000 6                  LDA     9
         5 001114   000000 236000 1                  LDQ     JRNL$
         5 001115   000752 757000 1                  STAQ    WR_CG_JRNL+4

      504     5415    5                     CALL M$WRITE (WR_CG_JRNL) ALTRET(JRNLERR);

   5415  5 001116   000746 630400 1                  EPPR0   WR_CG_JRNL
         5 001117   440001 713400                    CLIMB   alt,write
         5 001120   401400 401760                    pmme    nvectors=4
         5 001121   001205 702000 5                  TSX2    JRNLERR

      505     5416    5                     CG_RD.V.EVENT#=1000+CGP.OFFSET;

   5416  5 001122   200005 235100                    LDA     CG$,,AUTO
         5 001123   000022 771000                    ARL     18
         5 001124   001750 035007                    ADLA    1000,DL
         5 001125   000455 755000 1                  STA     CG_RD+9

      506     5417    5                     CG_RD.V.DCB#=CG_OPN.V.DCB#;

   5417  5 001126   000324 220000 1                  LDX0    CG_OPN+36
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:92   
         5 001127   000454 740000 1                  STX0    CG_RD+8

      507     5418    5                     CG_RD.BUF_.BOUND=SIZEC(CG.BUF)-POFFC(ADDR(CGJREC.MESS),

   5418  5 001130   200004 236100                    LDQ     C$,,AUTO
         5 001131   000020 772000                    QRL     16
         5 001132   200040 756100                    STQ     P$+2,,AUTO
         5 001133   200004 236100                    LDQ     C$,,AUTO
         5 001134   000023 036003                    ADLQ    19,DU
         5 001135   000020 772000                    QRL     16
         5 001136   200040 136100                    SBLQ    P$+2,,AUTO
         5 001137   000027 676000 xsym               ERQ     B_VECTNIL+23
         5 001140   002000 036007                    ADLQ    1024,DL
         5 001141   000020 736000                    QLS     16
         5 001142   000450 676000 1                  ERQ     CG_RD+4
         5 001143   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 001144   000450 656000 1                  ERSQ    CG_RD+4

      508     5419    5                        ADDR(CGJREC))-1;
      509     5420    5                     CG_RD.BUF_.BUF$=ADDR(ADDR(CG$->CG.BUF)->CGJREC.MESS);

   5420  5 001145   200005 236100                    LDQ     CG$,,AUTO
         5 001146   000046 036003                    ADLQ    38,DU
         5 001147   000451 756000 1                  STQ     CG_RD+5

      510     5421
      511     5422        /* Read the comgroup for messages to journal.                         */
      512     5423
      513     5424    5                     CALL M$READ (CG_RD) ALTRET(JRNLERR);

   5424  5 001150   000444 630400 1                  EPPR0   CG_RD
         5 001151   440000 713400                    CLIMB   alt,read
         5 001152   401400 401760                    pmme    nvectors=4
         5 001153   001205 702000 5                  TSX2    JRNLERR

      514     5425
      515     5426
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:93   
      516     5427    6                     DO WHILE ('0'B);

   5427  5 001154   001161 710000 5                  TRA     s:5431

      517     5428    6   NODCB:               OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5428  5 001155   000000 470400 xsym  NODCB        LDP0    B$TCB$
         5 001156   000000 471500                    LDP1    0,,PR0
         5 001157   100102 236100                    LDQ     66,,PR1
         5 001160   000017 756000 1                  STQ     OPN_ANSWER

      518     5429    6                        END;

      519     5430
      520     5431    6                     DO WHILE ('0'B);

   5431  5 001161   001246 710000 5                  TRA     s:5455

      521     5432    6   OP_CG_ERR:           OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5432  5 001162   000000 470400 xsym  OP_CG_ERR    LDP0    B$TCB$
         5 001163   000000 471500                    LDP1    0,,PR0
         5 001164   100102 236100                    LDQ     66,,PR1
         5 001165   000017 756000 1                  STQ     OPN_ANSWER

      522     5433    6                        GOTO CLSCGERR1;

   5433  5 001166   001233 710000 5                  TRA     CLSCGERR1

      523     5434    6   OPNJERR0:            OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5434  5 001167   000000 470400 xsym  OPNJERR0     LDP0    B$TCB$
         5 001170   000000 471500                    LDP1    0,,PR0
         5 001171   100102 236100                    LDQ     66,,PR1
         5 001172   000017 756000 1                  STQ     OPN_ANSWER

      524     5435    6   OPNJERR:             REL_DCB.V.DCB#=J$->JRNL.DCB#;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:94   

   5435  5 001173   200010 470500       OPNJERR      LDP0    J$,,AUTO
         5 001174   000001 720100                    LXL0    1,,PR0
         5 001175   000256 740000 1                  STX0    REL_DCB+2

      525     5436    6                        CALL M$RELDCB (REL_DCB) ALTRET(OPNJER1);

   5436  5 001176   000254 630400 1                  EPPR0   REL_DCB
         5 001177   460003 713400                    CLIMB   alt,+24579
         5 001200   400000 401760                    pmme    nvectors=1
         5 001201   001202 702000 5                  TSX2    OPNJER1

      526     5437    6   OPNJER1:             CALL FREEJRNL;

   5437  5 001202   004605 701000 5     OPNJER1      TSX1    FREEJRNL
         5 001203   000000 011000                    NOP     0

      527     5438    6                        GOTO OPNJER2;

   5438  5 001204   001211 710000 5                  TRA     OPNJER2

      528     5439        /*  Release CG DCB, free CG table entry and report error to OPEN. */
      529     5440
      530     5441    6   JRNLERR:             OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5441  5 001205   000000 470400 xsym  JRNLERR      LDP0    B$TCB$
         5 001206   000000 471500                    LDP1    0,,PR0
         5 001207   100102 236100                    LDQ     66,,PR1
         5 001210   000017 756000 1                  STQ     OPN_ANSWER

      531     5442    7   OPNJER2:             DO WHILE (CG$ ~= ADDR(NIL));

   5442  5 001211   001243 710000 5     OPNJER2      TRA     s:5452

      532     5443    7                           CG_CLS.V.DCB#=CG$->CG.DCB#;

   5443  5 001212   200005 470500                    LDP0    CG$,,AUTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:95   
         5 001213   000002 720100                    LXL0    2,,PR0
         5 001214   000556 740000 1                  STX0    CG_CLS+26

      533     5444    7                           I=DCBADDR(CG$->CG.DCB#)->F$DCB.FCN.CNT(0);

   5444  5 001215   000012 471400 6                  LDP1    10
         5 001216   100000 473500                    LDP3    0,,PR1
         5 001217   000002 721100                    LXL1    2,,PR0
         5 001220   300000 474511                    LDP4    0,X1,PR3
         5 001221   400074 236100                    LDQ     60,,PR4
         5 001222   000033 772000                    QRL     27
         5 001223   000377 376007                    ANQ     255,DL
         5 001224   200013 756100                    STQ     I,,AUTO

      534     5445    7                           CALL M$CLOSE (CG_CLS) ALTRET(CLSCGERR1);

   5445  5 001225   000524 630400 1                  EPPR0   CG_CLS
         5 001226   450001 713400                    CLIMB   alt,close
         5 001227   406000 401760                    pmme    nvectors=13
         5 001230   001233 702000 5                  TSX2    CLSCGERR1

      535     5446    7                           IF I ~= 0 THEN

   5446  5 001231   200013 235100                    LDA     I,,AUTO
         5 001232   002331 601000 5                  TNZ     XIT_CSCG_RD

   5446  5 001233                       CLSCGERR1    null
      536     5447    7                              GOTO XIT_CSCG_RD;
      537     5448    7   CLSCGERR1:              ;
      538     5449    7                           REL_DCB.V.DCB#=CG$->CG.DCB#;

   5449  5 001233   200005 470500                    LDP0    CG$,,AUTO
         5 001234   000002 720100                    LXL0    2,,PR0
         5 001235   000256 740000 1                  STX0    REL_DCB+2

      539     5450    7                           CALL M$RELDCB (REL_DCB);

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:96   
   5450  5 001236   000254 630400 1                  EPPR0   REL_DCB
         5 001237   060003 713400                    CLIMB   24579
         5 001240   400000 401760                    pmme    nvectors=1

      540     5451    7                           CALL FREECG;

   5451  5 001241   004452 701000 5                  TSX1    FREECG
         5 001242   000000 011000                    NOP     0

      541     5452    7                           END;

   5452  5 001243   200005 236100                    LDQ     CG$,,AUTO
         5 001244   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001245   001212 601000 5                  TNZ     s:5443

      542     5453    6                        END;

      543     5454        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:97   
      544     5455    6                     DO WHILE ('0'B);

   5455  5 001246   002331 710000 5                  TRA     XIT_CSCG_RD

      545     5456    6   QUITCGJRNL:          CG_CLS.V.DCB#=CG$->CG.DCB#;

   5456  5 001247   200005 471500       QUITCGJRNL   LDP1    CG$,,AUTO
         5 001250   100002 720100                    LXL0    2,,PR1
         5 001251   000556 740000 1                  STX0    CG_CLS+26

      546     5457    6                        IF CG$->CG.JRNL$ = ADDR(NIL) THEN

   5457  5 001252   100003 236100                    LDQ     3,,PR1
         5 001253   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001254   001260 601000 5                  TNZ     s:5460

      547     5458    6                           CALL CLSCG; /* No outstanding reads to cleanup  */

   5458  5 001255   003231 701000 5                  TSX1    CLSCG
         5 001256   000000 011000                    NOP     0
         5 001257   001264 710000 5                  TRA     QCGJ1

      548     5459    6                        ELSE
      549     5460    6                           CALL M$CLOSE (CG_CLS) ALTRET(QCGJ1);
              5460                                    /* Deactivate will cleanup  */

   5460  5 001260   000524 630400 1                  EPPR0   CG_CLS
         5 001261   450001 713400                    CLIMB   alt,close
         5 001262   406000 401760                    pmme    nvectors=13
         5 001263   001264 702000 5                  TSX2    QCGJ1

   5457  5 001264                       QCGJ1        null
      550     5461    6   QCGJ1:               ;
      551     5462    6                        END;

      552     5463
      553     5464    5                     END;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:98   

   5464  5 001264   002331 710000 5                  TRA     XIT_CSCG_RD

      554     5465    5                  ELSE DO;

      555     5466
      556     5467        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:99   
      557     5468        /* Journal file open.  Open the journal file as the owner.            */
      558     5469    5                     J$=JRNLACTIVE$;

   5469  5 001265   200012 236100                    LDQ     JRNLACTIVE$,,AUTO
         5 001266   200010 756100                    STQ     J$,,AUTO

      559     5470    5                     CG$=ADDR(NIL);

   5470  5 001267   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 001270   200005 756100                    STQ     CG$,,AUTO

      560     5471    6                     DO WHILE (J$ ~= ADDR(NIL));

   5471  5 001271   001300 710000 5                  TRA     s:5475

      561     5472    6                        IF J$->JRNL.CFU = K THEN

   5472  5 001272   200010 470500                    LDP0    J$,,AUTO
         5 001273   000002 236100                    LDQ     2,,PR0
         5 001274   200014 116100                    CMPQ    K,,AUTO
         5 001275   002331 600000 5                  TZE     XIT_CSCG_RD

      562     5473    6                           GOTO XIT_CSCG_RD;
      563     5474    6                        J$=J$->JRNL.LNK$;

   5474  5 001276   000000 236100                    LDQ     0,,PR0
         5 001277   200010 756100                    STQ     J$,,AUTO

      564     5475    6                        END;

   5475  5 001300   200010 236100                    LDQ     J$,,AUTO
         5 001301   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001302   001272 601000 5                  TNZ     s:5472

      565     5476
      566     5477
      567     5478    5                     CALL GETJDCB ALTRET(XIT_CSCG_RD);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:100  

   5478  5 001303   003136 701000 5                  TSX1    GETJDCB
         5 001304   002331 702000 5                  TSX2    XIT_CSCG_RD

      568     5479
      569     5480    5                     I=PINCRW(CFU$,K)->FM$CFU.NAMEX;

   5480  5 001305   001446 470400 1                  LDP0    CFU$
         5 001306   200014 720100                    LXL0    K,,AUTO
         5 001307   000002 236110                    LDQ     2,X0,PR0
         5 001310   777777 376007                    ANQ     -1,DL
         5 001311   200013 756100                    STQ     I,,AUTO

      570     5481    6                     DO WHILE ( I<=CFU$->FM$CFUX.CFUT );

   5481  5 001312   000002 236100                    LDQ     2,,PR0
         5 001313   000022 772000                    QRL     18
         5 001314   200013 116100                    CMPQ    I,,AUTO
         5 001315   001327 602000 5                  TNC     s:5484

      571     5482    6                        I=PINCRW(CFU$,I)->FM$CFU.NAMEX;

   5482  5 001316   001446 470400 1                  LDP0    CFU$
         5 001317   200013 720100                    LXL0    I,,AUTO
         5 001320   000002 236110                    LDQ     2,X0,PR0
         5 001321   777777 376007                    ANQ     -1,DL
         5 001322   200013 756100                    STQ     I,,AUTO

      572     5483    6                        END;

   5483  5 001323   000002 236100                    LDQ     2,,PR0
         5 001324   000022 772000                    QRL     18
         5 001325   200013 116100                    CMPQ    I,,AUTO
         5 001326   001316 603000 5                  TRC     s:5482

      573     5484    5                     J$->JRNL.NAME.L=

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:101  
   5484  5 001327   200013 235100                    LDA     I,,AUTO
         5 001330   200010 471500                    LDP1    J$,,AUTO
         5 001331   000100 100505                    MLR     fill='000'O
         5 001332   000000 400001                    ADSC9   0,A,PR0                  cn=2,n=1
         5 001333   100010 000001                    ADSC9   8,,PR1                   cn=0,n=1

      574     5485    5                        PINCRC(CFU$,I)->FM$CFUN.L;
      575     5486    5                     J$->JRNL.NAME.TXT=

   5486  5 001334   001446 470400 1                  LDP0    CFU$
         5 001335   000100 101505                    MRL     fill='000'O
         5 001336   000000 400001                    ADSC9   0,A,PR0                  cn=2,n=1
         5 001337   200040 000002                    ADSC9   P$+2,,AUTO               cn=0,n=2
         5 001340   200040 220100                    LDX0    P$+2,,AUTO
         5 001341   040100 100545                    MLR     fill='040'O
         5 001342   000000 600010                    ADSC9   0,A,PR0                  cn=3,n=*X0
         5 001343   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31

      576     5487    5                        PINCRC(CFU$,I)->FM$CFUN.C;
      577     5488    5                     J$->JRNL.CFU=K;

   5488  5 001344   200014 236100                    LDQ     K,,AUTO
         5 001345   100002 756100                    STQ     2,,PR1

      578     5489    5                     J$->JRNL.CGCNT=0;

   5489  5 001346   100004 450100                    STZ     4,,PR1

      579     5490    5                     J$->JRNL.ATTR$=ADDR(NIL);

   5490  5 001347   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 001350   100032 756100                    STQ     26,,PR1

      580     5491    5                     OPN_ANSWER.ERR = JRNLCLSD;

   5491  5 001351   003466 236000 1                  LDQ     JRNLCLSD
         5 001352   000017 756000 1                  STQ     OPN_ANSWER
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:102  

      581     5492    5                     IF PINCRW(CFU$,K)->FM$CFU.ACCTX =1 THEN

   5492  5 001353   001446 470400 1                  LDP0    CFU$
         5 001354   200014 720100                    LXL0    K,,AUTO
         5 001355   000002 221110                    LDX1    2,X0,PR0
         5 001356   000001 101003                    CMPX1   1,DU
         5 001357   001173 600000 5                  TZE     OPNJERR

      582     5493    5                        GOTO OPNJERR;
      583     5494    5                     OPN_ANSWER.ERR = JRNLSTAR;

   5494  5 001360   003467 236000 1                  LDQ     JRNLSTAR
         5 001361   000017 756000 1                  STQ     OPN_ANSWER

      584     5495    5                     IF PINCRW(CFU$,K)->FM$CFU.STARX.F ~= 0 THEN

   5495  5 001362   000002 236110                    LDQ     2,X0,PR0
         5 001363   400000 316003                    CANQ    -131072,DU
         5 001364   001173 601000 5                  TNZ     OPNJERR

      585     5496    5                        GOTO OPNJERR;
      586     5497    5                     OPN_ANSWER.ERR = '0'B;

   5497  5 001365   000017 450000 1                  STZ     OPN_ANSWER

      587     5498    5                     J$->JRNL.ACCT=

   5498  5 001366   000002 221110                    LDX1    2,X0,PR0
         5 001367   000000 636011                    EAQ     0,X1
         5 001370   000020 772000                    QRL     16
         5 001371   040100 100506                    MLR     fill='040'O
         5 001372   000001 000010                    ADSC9   1,Q,PR0                  cn=0,n=8
         5 001373   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8

      588     5499    5                        PINCRW(CFU$,PINCRW(CFU$,K)->FM$CFU.ACCTX)->FM$CFUA.ACCT;
      589     5500    5                     J$->JRNL.PSN=
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:103  

   5500  5 001374   001446 470400 1                  LDP0    CFU$
         5 001375   000002 221110                    LDX1    2,X0,PR0
         5 001376   000000 236111                    LDQ     0,X1,PR0
         5 001377   000017 772000                    QRL     15
         5 001400   000006 376000 6                  ANQ     6
         5 001401   000002 736000                    QLS     2
         5 001402   040100 100506                    MLR     fill='040'O
         5 001403   000000 400006                    ADSC9   0,Q,PR0                  cn=2,n=6
         5 001404   100006 000006                    ADSC9   6,,PR1                   cn=0,n=6

      590     5501    5                        CFU$->FM$SET.PSN(PINCRW(CFU$,PINCRW(CFU$,K)->FM$CFU.ACCTX)->
              5501                                 FM$CFUA.SETX);
      591     5502
      592     5503    5                     OPN_JRNL.V.RES# = 'DP  ';

   5503  5 001405   000006 236000 3                  LDQ     NOTOWNER+5
         5 001406   000632 756000 1                  STQ     OPN_JRNL+40

      593     5504    5                     CG_SN.SN#(0)=J$->JRNL.PSN;

   5504  5 001407   040000 100500                    MLR     fill='040'O
         5 001410   100006 000006                    ADSC9   6,,PR1                   cn=0,n=6
         5 001411   000507 000006 1                  ADSC9   CG_SN+1                  cn=0,n=6

      594     5505    5                     CALL TESTOPEN ALTRET(OPNJERR0);

   5505  5 001412   004351 701000 5                  TSX1    TESTOPEN
         5 001413   001167 702000 5                  TSX2    OPNJERR0

      595     5506    5                     J$->JRNL.ASN = %FILE#;

   5506  5 001414   000001 235007                    LDA     1,DL
         5 001415   200010 470500                    LDP0    J$,,AUTO
         5 001416   000003 755100                    STA     3,,PR0

      596     5507    5                     F$=ADDR(JRNL_FIT);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:104  

   5507  5 001417   000013 236000 6                  LDQ     11
         5 001420   006157 756000 1                  STQ     F$

      597     5508    5                     CALL XSF$LOCCODP (F$,11) ALTRET(OPNJRNL);

   5508  5 001421   000014 630400 6                  EPPR0   12
         5 001422   000020 631400 xsym               EPPR1   B_VECTNIL+16
         5 001423   000000 701000 xent               TSX1    XSF$LOCCODP
         5 001424   001571 702000 5                  TSX2    OPNJRNL

      598     5509    5                     F$=PINCRW(F$,-1);

   5509  5 001425   006157 236000 1                  LDQ     F$
         5 001426   777777 036003                    ADLQ    -1,DU
         5 001427   006157 756000 1                  STQ     F$

      599     5510    5                     IF F$->JATTR.Q.ID ~= ATTR_.Q.ID THEN

   5510  5 001430   006157 470400 1                  LDP0    F$
         5 001431   000001 220100                    LDX0    1,,PR0
         5 001432   001427 100000 1                  CMPX0   ATTR_+1
         5 001433   001167 601000 5                  TNZ     OPNJERR0

      600     5511    5                        GOTO OPNJERR0;
      601     5512    5                     J$->JRNL.ASN=F$->JATTR.Q.ASN;

   5512  5 001434   200010 471500                    LDP1    J$,,AUTO
         5 001435   000001 236100                    LDQ     1,,PR0
         5 001436   000011 772000                    QRL     9
         5 001437   000777 376007                    ANQ     511,DL
         5 001440   100003 756100                    STQ     3,,PR1

      602     5513    5                     IF F$->JATTR.Q.ASN = %FILE# THEN

   5513  5 001441   006157 470400 1                  LDP0    F$
         5 001442   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:105  
         5 001443   777000 376007                    ANQ     -512,DL
         5 001444   001000 116007                    CMPQ    512,DL
         5 001445   001571 600000 5                  TZE     OPNJRNL

      603     5514    5                        GOTO OPNJRNL;
      604     5515
      605     5516        /* Tape Journal   */
      606     5517        /* Use SN from file    */
      607     5518
      608     5519    5   USE_FILE_SN:
      609     5520    5                     CURSN$=PINCRW(JSN$,1);

   5520  5 001446   200003 236100       USE_FILE_SN  LDQ     JSN$,,AUTO
         5 001447   000001 036003                    ADLQ    1,DU
         5 001450   001447 756000 1                  STQ     CURSN$

      610     5521    5   GSNSP:            SNSZ=POFFC(PINCRC(SN_V.P$,SN_V.BND+1),CURSN$)-SIZEC(JATTR)+4;

   5521  5 001451   001456 236000 1     GSNSP        LDQ     SN_V
         5 001452   000020 772000                    QRL     16
         5 001453   000020 736000                    QLS     16
         5 001454   200000 036007                    ADLQ    65536,DL
         5 001455   001457 036000 1                  ADLQ    SN_V+1
         5 001456   000020 772000                    QRL     16
         5 001457   200040 756100                    STQ     P$+2,,AUTO
         5 001460   001447 236000 1                  LDQ     CURSN$
         5 001461   000020 772000                    QRL     16
         5 001462   200041 756100                    STQ     P$+3,,AUTO
         5 001463   200040 236100                    LDQ     P$+2,,AUTO
         5 001464   200041 136100                    SBLQ    P$+3,,AUTO
         5 001465   000010 136007                    SBLQ    8,DL
         5 001466   003461 756000 1                  STQ     SNSZ

      611     5522    6                     IF SNSZ < (F$->JATTR.Q.NUM#*6+3)/4+4 THEN DO;

   5522  5 001467   006157 470400 1                  LDP0    F$
         5 001470   000002 236100                    LDQ     2,,PR0
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:106  
         5 001471   000006 402007                    MPY     6,DL
         5 001472   000003 036007                    ADLQ    3,DL
         5 001473   000002 772000                    QRL     2
         5 001474   000004 036007                    ADLQ    4,DL
         5 001475   003461 116000 1                  CMPQ    SNSZ
         5 001476   001505 602000 5                  TNC     s:5526
         5 001477   001505 600000 5                  TZE     s:5526

      612     5523    6                        CALL M$GDS (GDS_SN) ALTRET(OPNJERR0);

   5523  5 001500   001162 630400 1                  EPPR0   GDS_SN
         5 001501   430001 713400                    CLIMB   alt,gds
         5 001502   400400 401760                    pmme    nvectors=2
         5 001503   001167 702000 5                  TSX2    OPNJERR0

      613     5524    6                        GOTO GSNSP;

   5524  5 001504   001451 710000 5                  TRA     GSNSP

      614     5525    6                        END;
      615     5526    5                     J$->JRNL.ATTR$=CURSN$;

   5526  5 001505   001447 236000 1                  LDQ     CURSN$
         5 001506   200010 471500                    LDP1    J$,,AUTO
         5 001507   100032 756100                    STQ     26,,PR1

      616     5527    5                     JSN$->P$$=J$;

   5527  5 001510   200010 236100                    LDQ     J$,,AUTO
         5 001511   200003 470500                    LDP0    JSN$,,AUTO
         5 001512   000000 756100                    STQ     0,,PR0

      617     5528    5                     JSN$=PINCRW(CURSN$,(F$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR));

   5528  5 001513   006157 473400 1                  LDP3    F$
         5 001514   300002 236100                    LDQ     2,,PR3
         5 001515   000006 402007                    MPY     6,DL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:107  
         5 001516   000003 036007                    ADLQ    3,DL
         5 001517   000002 772000                    QRL     2
         5 001520   000022 736000                    QLS     18
         5 001521   000003 036003                    ADLQ    3,DU
         5 001522   001447 036000 1                  ADLQ    CURSN$
         5 001523   200003 756100                    STQ     JSN$,,AUTO

      618     5529    5                     J$->JRNL.ATTR$->JATTR = F$->JATTR;

   5529  5 001524   100032 470500                    LDP0    26,,PR1
         5 001525   000100 100500                    MLR     fill='000'O
         5 001526   300000 000014                    ADSC9   0,,PR3                   cn=0,n=12
         5 001527   000000 000014                    ADSC9   0,,PR0                   cn=0,n=12

      619     5530    5                     SNSZ=F$->JATTR.Q.NUM#*6+4;

   5530  5 001530   006157 470400 1                  LDP0    F$
         5 001531   000002 236100                    LDQ     2,,PR0
         5 001532   000006 402007                    MPY     6,DL
         5 001533   000004 036007                    ADLQ    4,DL
         5 001534   003461 756000 1                  STQ     SNSZ

      620     5531    5                     CURSN$=ADDR(J$->JRNL.ATTR$->JATTR.Q.NUM#);

   5531  5 001535   100032 473500                    LDP3    26,,PR1
         5 001536   300002 634500                    EPPR4   2,,PR3
         5 001537   001447 454400 1                  STP4    CURSN$

      621     5532    5                     CURSN$->DUMMY_SN=ADDR(F$->JATTR.Q.NUM#)->DUMMY_SN;

   5532  5 001540   000000 620006                    EAX0    0,QL
         5 001541   003461 721000 1                  LXL1    SNSZ
         5 001542   040140 100540                    MLR     fill='040'O
         5 001543   000002 000010                    ADSC9   2,,PR0                   cn=0,n=*X0
         5 001544   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1

      622     5533    5   SETSN_:
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:108  
      623     5534    5                    OPN_JRNL.SN_=VECTOR(ADDR(J$->JRNL.ATTR$->JATTR.Q.NUM#)->DUMMY_SN);

   5534  5 001545   100032 470500       SETSN_       LDP0    26,,PR1
         5 001546   003461 235000 1                  LDA     SNSZ
         5 001547   000020 735000                    ALS     16
         5 001550   000140 135007                    SBLA    96,DL
         5 001551   200040 450500                    STP0    P$+2,,AUTO
         5 001552   200040 236100                    LDQ     P$+2,,AUTO
         5 001553   000002 036003                    ADLQ    2,DU
         5 001554   000564 757000 1                  STAQ    OPN_JRNL+2

      624     5535    5                     OPN_JRNL.V.RES# = 'MT  ';

   5535  5 001555   000007 236000 3                  LDQ     NOTOWNER+6
         5 001556   000632 756000 1                  STQ     OPN_JRNL+40

      625     5536    5                     OPN_JRNL.V.VOL#=J$->JRNL.ATTR$->JATTR.Q.VOL#;

   5536  5 001557   100032 470500                    LDP0    26,,PR1
         5 001560   000001 236100                    LDQ     1,,PR0
         5 001561   000033 736000                    QLS     27
         5 001562   000643 552040 1                  STBQ    OPN_JRNL+49,'40'O

      626     5537    5                     IF J$->JRNL.ATTR$->JATTR.Q.VOL# = 0 THEN

   5537  5 001563   100032 470500                    LDP0    26,,PR1
         5 001564   000001 236100                    LDQ     1,,PR0
         5 001565   000777 316007                    CANQ    511,DL
         5 001566   001571 601000 5                  TNZ     OPNJRNL

      627     5538    5                        J$->JRNL.ATTR$->JATTR.Q.VOL# = 1;

   5538  5 001567   000001 236007                    LDQ     1,DL
         5 001570   000001 552104                    STBQ    1,'04'O,PR0

   5537  5 001571                       OPNJRNL      null
      628     5539
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:109  
      629     5540    5   OPNJRNL:          ;
      630     5541
      631     5542    5                     OPN_JRNL.V.DCB# = J$->JRNL.DCB#;

   5542  5 001571   200010 470500                    LDP0    J$,,AUTO
         5 001572   000001 720100                    LXL0    1,,PR0
         5 001573   000626 740000 1                  STX0    OPN_JRNL+36

      632     5543    5                     OPN_JRNL.NAME_=VECTOR(J$->JRNL.NAME);

   5543  5 001574   000010 235000 6                  LDA     8
         5 001575   200010 236100                    LDQ     J$,,AUTO
         5 001576   000010 036003                    ADLQ    8,DU
         5 001577   000570 757000 1                  STAQ    OPN_JRNL+6

      633     5544    5                     OPN_JRNL.ACCT_=VECTOR(J$->JRNL.ACCT);

   5544  5 001600   000007 235000 6                  LDA     7
         5 001601   200010 236100                    LDQ     J$,,AUTO
         5 001602   000020 036003                    ADLQ    16,DU
         5 001603   000606 757000 1                  STAQ    OPN_JRNL+20

      634     5545    5                     OPN_JRNL.V.ASN#=J$->JRNL.ASN;

   5545  5 001604   000003 236100                    LDQ     3,,PR0
         5 001605   000627 552004 1                  STBQ    OPN_JRNL+37,'04'O

      635     5546    5                     CALL M$OPEN (OPN_JRNL) ALTRET(OPNJERR0);

   5546  5 001606   000562 630400 1                  EPPR0   OPN_JRNL
         5 001607   450000 713400                    CLIMB   alt,open
         5 001610   410400 401760                    pmme    nvectors=18
         5 001611   001167 702000 5                  TSX2    OPNJERR0

      636     5547        /*E*
      637     5548        ERROR:  FJ-E$NOTOWNER
      638     5549        MESSAGE: JAYS cannot be the owner of this journal file.
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:110  
      639     5550        MESSAGE1: Some other user has the journal file opened and
      640     5551                  is the journal owner.
      641     5552        */
      642     5553    6                     IF NOT DCBADDR(OPN_JRNL.V.DCB#)->F$DCB.OWNER THEN DO;

   5553  5 001612   000012 470400 6                  LDP0    10
         5 001613   000000 471500                    LDP1    0,,PR0
         5 001614   000626 220000 1                  LDX0    OPN_JRNL+36
         5 001615   100000 473510                    LDP3    0,X0,PR1
         5 001616   300064 236100                    LDQ     52,,PR3
         5 001617   040000 316007                    CANQ    16384,DL
         5 001620   002331 601000 5                  TNZ     XIT_CSCG_RD

      643     5554    6                        OPN_ANSWER.ERR=NOTOWNER;

   5554  5 001621   000001 236000 3                  LDQ     NOTOWNER
         5 001622   000017 756000 1                  STQ     OPN_ANSWER

      644     5555    6                        GOTO OPNJERR;

   5555  5 001623   001173 710000 5                  TRA     OPNJERR

      645     5556    6                        END;
      646     5557    5                     END;
      647     5558        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:111  
      648     5559    4                CASE(FJ_LIST_CMD);

      649     5560    4                  WR_CSCG_STA.STATION#=FJ_EV.STA(EVENT);

   5560  5 001624   200027 236100                    LDQ     EVENT,,AUTO
         5 001625   000044 402007                    MPY     36,DL
         5 001626   040000 100406                    MLR     fill='040'O
         5 001627   000004 000010 xsym               ADSC9   FJ_EV+4,Q                cn=0,n=8
         5 001630   000234 000010 1                  ADSC9   WR_CSCG_STA              cn=0,n=8

      650     5561    4                  WR_CSCG_STA.MSGTYP#=FJ_EV.MSG(EVENT);

   5561  5 001631   040000 100406                    MLR     fill='040'O
         5 001632   000006 000010 xsym               ADSC9   FJ_EV+6,Q                cn=0,n=8
         5 001633   000236 000010 1                  ADSC9   WR_CSCG_STA+2            cn=0,n=8

      651     5562    4                  WR_JRNL_RESULTS.BUF_=VECTOR(FJ$LISTANS);

   5562  5 001634   000016 237000 6                  LDAQ    14
         5 001635   000224 757000 1                  STAQ    WR_JRNL_RESULTS+4

      652     5563    4                  FJ$LISTANS.LAST=0;

   5563  5 001636   000027 450000 1                  STZ     FJ$LISTANS+1

      653     5564    4                  FJ$LISTANS.ERR='0'B;

   5564  5 001637   000026 450000 1                  STZ     FJ$LISTANS

      654     5565    4                  J$=JRNLACTIVE$;

   5565  5 001640   200012 236100                    LDQ     JRNLACTIVE$,,AUTO
         5 001641   200010 756100                    STQ     J$,,AUTO

      655     5566    4                  FJ$LISTANS.TXT=' No active journals.';

   5566  5 001642   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:112  
         5 001643   000010 000024 3                  ADSC9   NOTOWNER+7               cn=0,n=20
         5 001644   000030 000106 1                  ADSC9   FJ$LISTANS+2             cn=0,n=70

      656     5567    5                  IF J$ ~= ADDR(NIL) THEN DO;

   5567  5 001645   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001646   001724 600000 5                  TZE     s:5581

      657     5568    5   LST1:             CALL HISACCN (BUF$->JRNLIST.ACCN,BUF$->JRNLIST.UNAME,

   5568  5 001647   004156 236000 1     LST1         LDQ     BUF$
         5 001650   000011 036003                    ADLQ    9,DU
         5 001651   200036 756100                    STQ     I$+1,,AUTO
         5 001652   004156 236000 1                  LDQ     BUF$
         5 001653   000007 036003                    ADLQ    7,DU
         5 001654   200035 756100                    STQ     @HISNAME+1,,AUTO
         5 001655   004156 236000 1                  LDQ     BUF$
         5 001656   000004 036003                    ADLQ    4,DU
         5 001657   200034 756100                    STQ     @HISACCN+1,,AUTO
         5 001660   004156 236000 1                  LDQ     BUF$
         5 001661   000002 036003                    ADLQ    2,DU
         5 001662   200033 756100                    STQ     @ACCN+1,,AUTO
         5 001663   004276 701000 5                  TSX1    HISACCN
         5 001664   000000 011000                    NOP     0

      658     5569    5                        BUF$->JRNLIST.FACCN,BUF$->JRNLIST.PRIV);
      659     5570    5                     CALL TESTOPEN ALTRET(LST6);

   5570  5 001665   004351 701000 5                  TSX1    TESTOPEN
         5 001666   002007 702000 5                  TSX2    LST6

      660     5571    5                     CALL MYACCN;

   5571  5 001667   004333 701000 5                  TSX1    MYACCN
         5 001670   000000 011000                    NOP     0

      661     5572    5                     UNF_LIST.V.DCB#=J$->JRNL.DCB#;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:113  

   5572  5 001671   200010 470500                    LDP0    J$,,AUTO
         5 001672   000001 720100                    LXL0    1,,PR0
         5 001673   001244 740000 1                  STX0    UNF_LIST+20

      662     5573    5                     CALL M$UNFID (UNF_LIST) ALTRET(LST2);

   5573  5 001674   001220 630400 1                  EPPR0   UNF_LIST
         5 001675   420021 713400                    CLIMB   alt,+8209
         5 001676   404400 401760                    pmme    nvectors=10
         5 001677   001721 702000 5                  TSX2    LST2

      663     5574    6                     IF J$->JRNL.RENAME.L ~= 0 THEN DO;

   5574  5 001700   200010 470500                    LDP0    J$,,AUTO
         5 001701   000022 236100                    LDQ     18,,PR0
         5 001702   777000 316003                    CANQ    -512,DU
         5 001703   001721 600000 5                  TZE     LST2

      664     5575    6                        CALL M$WRITE (WR_JRNL_RESULTS);

   5575  5 001704   000220 630400 1                  EPPR0   WR_JRNL_RESULTS
         5 001705   040001 713400                    CLIMB   write
         5 001706   401400 401760                    pmme    nvectors=4

      665     5576    6                        CALL CONCAT (FJ$LISTANS.TXT,'   RENAMED TO: ',

   5576  5 001707   200010 470500                    LDP0    J$,,AUTO
         5 001710   000022 236100                    LDQ     18,,PR0
         5 001711   000033 772000                    QRL     27
         5 001712   040000 100400                    MLR     fill='040'O
         5 001713   000015 000017 3                  ADSC9   NOTOWNER+12              cn=0,n=15
         5 001714   000030 000017 1                  ADSC9   FJ$LISTANS+2             cn=0,n=15
         5 001715   000000 620006                    EAX0    0,QL
         5 001716   040000 100540                    MLR     fill='040'O
         5 001717   000022 200010                    ADSC9   18,,PR0                  cn=1,n=*X0
         5 001720   000033 600067 1                  ADSC9   FJ$LISTANS+5             cn=3,n=55
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:114  

      666     5577    6                           SUBSTR(J$->JRNL.RENAME.TXT,0,J$->JRNL.RENAME.L));
      667     5578    6                        END;

      668     5579    5   LST2:             J$=J$->JRNL.LNK$;

   5579  5 001721   200010 470500       LST2         LDP0    J$,,AUTO
         5 001722   000000 236100                    LDQ     0,,PR0
         5 001723   200010 756100                    STQ     J$,,AUTO

      669     5580    5                     END;

      670     5581    4                  CALL M$WRITE (WR_JRNL_RESULTS);

   5581  5 001724   000220 630400 1                  EPPR0   WR_JRNL_RESULTS
         5 001725   040001 713400                    CLIMB   write
         5 001726   401400 401760                    pmme    nvectors=4

      671     5582    4   LST22:
      672     5583    4                  IF J$ ~= ADDR(NIL) THEN

   5583  5 001727   200010 236100       LST22        LDQ     J$,,AUTO
         5 001730   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001731   001647 601000 5                  TNZ     LST1

      673     5584    4                     GOTO LST1;
      674     5585    4   LST3:          J$=CGACTIVE$;

   5585  5 001732   200007 236100       LST3         LDQ     CGACTIVE$,,AUTO
         5 001733   200010 756100                    STQ     J$,,AUTO

      675     5586    4                  FJ$LISTANS.TXT=' No active comgroup journal stations.';

   5586  5 001734   040000 100400                    MLR     fill='040'O
         5 001735   000021 000045 3                  ADSC9   NOTOWNER+16              cn=0,n=37
         5 001736   000030 000106 1                  ADSC9   FJ$LISTANS+2             cn=0,n=70

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:115  
      676     5587    4   LST33:
      677     5588    5                  IF J$ ~= ADDR(NIL) THEN DO;

   5588  5 001737   200010 236100       LST33        LDQ     J$,,AUTO
         5 001740   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001741   001776 600000 5                  TZE     s:5597

      678     5589    5   LST4:             CALL HISACCN (BUF$->JRNLIST.ACCN,BUF$->JRNLIST.UNAME,

   5589  5 001742   004156 236000 1     LST4         LDQ     BUF$
         5 001743   000011 036003                    ADLQ    9,DU
         5 001744   200036 756100                    STQ     I$+1,,AUTO
         5 001745   004156 236000 1                  LDQ     BUF$
         5 001746   000007 036003                    ADLQ    7,DU
         5 001747   200035 756100                    STQ     @HISNAME+1,,AUTO
         5 001750   004156 236000 1                  LDQ     BUF$
         5 001751   000004 036003                    ADLQ    4,DU
         5 001752   200034 756100                    STQ     @HISACCN+1,,AUTO
         5 001753   004156 236000 1                  LDQ     BUF$
         5 001754   000002 036003                    ADLQ    2,DU
         5 001755   200033 756100                    STQ     @ACCN+1,,AUTO
         5 001756   004276 701000 5                  TSX1    HISACCN
         5 001757   000000 011000                    NOP     0

      679     5590    5                        BUF$->JRNLIST.FACCN,BUF$->JRNLIST.PRIV);
      680     5591    5                     CALL TESTOPENCG ALTRET(LST7);

   5591  5 001760   004367 701000 5                  TSX1    TESTOPENCG
         5 001761   002015 702000 5                  TSX2    LST7

      681     5592    5                     CALL MYACCN;

   5592  5 001762   004333 701000 5                  TSX1    MYACCN
         5 001763   000000 011000                    NOP     0

      682     5593    5                     UNF_LIST.V.DCB#=J$->CG.DCB#;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:116  
   5593  5 001764   200010 470500                    LDP0    J$,,AUTO
         5 001765   000002 720100                    LXL0    2,,PR0
         5 001766   001244 740000 1                  STX0    UNF_LIST+20

      683     5594    5                     CALL M$UNFID (UNF_LIST) ALTRET(LST5);

   5594  5 001767   001220 630400 1                  EPPR0   UNF_LIST
         5 001770   420021 713400                    CLIMB   alt,+8209
         5 001771   404400 401760                    pmme    nvectors=10
         5 001772   001773 702000 5                  TSX2    LST5

      684     5595    5   LST5:             J$=J$->CG.LNK$;

   5595  5 001773   200010 470500       LST5         LDP0    J$,,AUTO
         5 001774   000000 236100                    LDQ     0,,PR0
         5 001775   200010 756100                    STQ     J$,,AUTO

      685     5596    5                     END;

      686     5597    5                  IF J$=ADDR(NIL) THEN DO;

   5597  5 001776   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 001777   002003 601000 5                  TNZ     s:5601

      687     5598    5                     FJ$LISTANS.LAST=1;

   5598  5 002000   000001 235007                    LDA     1,DL
         5 002001   000027 755000 1                  STA     FJ$LISTANS+1

      688     5599    5                     GOTO XIT_CSCG_RD;

   5599  5 002002   002331 710000 5                  TRA     XIT_CSCG_RD

      689     5600    5                     END;
      690     5601    4                  CALL M$WRITE(WR_JRNL_RESULTS);

   5601  5 002003   000220 630400 1                  EPPR0   WR_JRNL_RESULTS
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:117  
         5 002004   040001 713400                    CLIMB   write
         5 002005   401400 401760                    pmme    nvectors=4

      691     5602    4                  GOTO LST4;

   5602  5 002006   001742 710000 5                  TRA     LST4

      692     5603
      693     5604    4   LST6:          CALL MYACCN;

   5604  5 002007   004333 701000 5     LST6         TSX1    MYACCN
         5 002010   000000 011000                    NOP     0

      694     5605    4                  J$ = J$->JRNL.LNK$;

   5605  5 002011   200010 470500                    LDP0    J$,,AUTO
         5 002012   000000 236100                    LDQ     0,,PR0
         5 002013   200010 756100                    STQ     J$,,AUTO

      695     5606    4                  GOTO LST22;

   5606  5 002014   001727 710000 5                  TRA     LST22

      696     5607
      697     5608    4   LST7:          CALL MYACCN;

   5608  5 002015   004333 701000 5     LST7         TSX1    MYACCN
         5 002016   000000 011000                    NOP     0

      698     5609    4                  J$=J$->CG.LNK$;

   5609  5 002017   200010 470500                    LDP0    J$,,AUTO
         5 002020   000000 236100                    LDQ     0,,PR0
         5 002021   200010 756100                    STQ     J$,,AUTO

      699     5610    4                  FJ$LISTANS.TXT='  ';

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:118  
   5610  5 002022   040000 100400                    MLR     fill='040'O
         5 002023   000003 000002 3                  ADSC9   NOTOWNER+2               cn=0,n=2
         5 002024   000030 000106 1                  ADSC9   FJ$LISTANS+2             cn=0,n=70

      700     5611    4                  GOTO LST33;

   5611  5 002025   001737 710000 5                  TRA     LST33

      701     5612        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:119  
      702     5613    4                CASE(FJ_RENAME_CMD);

      703     5614    4                  CG$=ADDR(NIL);

   5614  5 002026   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 002027   200005 756100                    STQ     CG$,,AUTO

      704     5615    4                  WR_JRNL_RESULTS.BUF_=VECTOR(OPN_ANSWER);

   5615  5 002030   000004 237000 6                  LDAQ    4
         5 002031   000224 757000 1                  STAQ    WR_JRNL_RESULTS+4

      705     5616    4                  OPN_ANSWER.ERR='0'B;

   5616  5 002032   000017 450000 1                  STZ     OPN_ANSWER

      706     5617    4                  CALL HISACCN (BUF$->JRNRENAME.ACCN,BUF$->JRNRENAME.UNAME,

   5617  5 002033   004156 236000 1                  LDQ     BUF$
         5 002034   000040 036003                    ADLQ    32,DU
         5 002035   200036 756100                    STQ     I$+1,,AUTO
         5 002036   004156 236000 1                  LDQ     BUF$
         5 002037   000036 036003                    ADLQ    30,DU
         5 002040   200035 756100                    STQ     @HISNAME+1,,AUTO
         5 002041   004156 236000 1                  LDQ     BUF$
         5 002042   000033 036003                    ADLQ    27,DU
         5 002043   200034 756100                    STQ     @HISACCN+1,,AUTO
         5 002044   004156 236000 1                  LDQ     BUF$
         5 002045   000031 036003                    ADLQ    25,DU
         5 002046   200033 756100                    STQ     @ACCN+1,,AUTO
         5 002047   004276 701000 5                  TSX1    HISACCN
         5 002050   000000 011000                    NOP     0

      707     5618    4                     BUF$->JRNRENAME.FACCN,BUF$->JRNRENAME.PRIV);
      708     5619    4                  CALL LOCJRNL (BUF$->JRNRENAME.FID1.FNAME,

   5619  5 002051   004156 236000 1                  LDQ     BUF$
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:120  
         5 002052   000012 036003                    ADLQ    10,DU
         5 002053   200032 756100                    STQ     @NAME+1,,AUTO
         5 002054   004156 236000 1                  LDQ     BUF$
         5 002055   000002 036003                    ADLQ    2,DU
         5 002056   200031 756100                    STQ     EVENT+2,,AUTO
         5 002057   004233 701000 5                  TSX1    LOCJRNL
         5 002060   002063 702000 5                  TSX2    s:5625

      709     5620    4                     BUF$->JRNRENAME.FID1.ACCT)
      710     5621    5                  WHENRETURN DO;

      711     5622    5                     FREE=%NO#;

   5622  5 002061   200016 450100                    STZ     FREE,,AUTO

      712     5623    5                     END;

   5623  5 002062   002157 710000 5                  TRA     s:5653

      713     5624    5                  WHENALTRETURN DO;

      714     5625    5                     FREE=%YES#;

   5625  5 002063   400000 236003                    LDQ     -131072,DU
         5 002064   200016 756100                    STQ     FREE,,AUTO

      715     5626    5                     CALL GETJDCB ALTRET(XIT_CSCG_RD);

   5626  5 002065   003136 701000 5                  TSX1    GETJDCB
         5 002066   002331 702000 5                  TSX2    XIT_CSCG_RD

      716     5627    5                     J$->JRNL.ASN=%FILE#;

   5627  5 002067   000001 235007                    LDA     1,DL
         5 002070   200010 470500                    LDP0    J$,,AUTO
         5 002071   000003 755100                    STA     3,,PR0

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:121  
      717     5628    5                     J$->JRNL.PSN=BUF$->JRNRENAME.FID1.SN.SN#;

   5628  5 002072   004156 471400 1                  LDP1    BUF$
         5 002073   040100 100500                    MLR     fill='040'O
         5 002074   100017 000006                    ADSC9   15,,PR1                  cn=0,n=6
         5 002075   000006 000006                    ADSC9   6,,PR0                   cn=0,n=6

      718     5629    5                     J$->JRNL.NAME=BUF$->JRNRENAME.FID1.FNAME;

   5629  5 002076   000100 100500                    MLR     fill='000'O
         5 002077   100002 000040                    ADSC9   2,,PR1                   cn=0,n=32
         5 002100   000010 000040                    ADSC9   8,,PR0                   cn=0,n=32

      719     5630    5                     J$->JRNL.ACCT=BUF$->JRNRENAME.FID1.ACCT;

   5630  5 002101   040100 100500                    MLR     fill='040'O
         5 002102   100012 000010                    ADSC9   10,,PR1                  cn=0,n=8
         5 002103   000020 000010                    ADSC9   16,,PR0                  cn=0,n=8

      720     5631    5                     J$->JRNL.ATTR$=ADDR(NIL);

   5631  5 002104   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 002105   000032 756100                    STQ     26,,PR0

      721     5632    5                     OPN_JRNL.V.ASN#=J$->JRNL.ASN;

   5632  5 002106   000003 236100                    LDQ     3,,PR0
         5 002107   000627 552004 1                  STBQ    OPN_JRNL+37,'04'O

      722     5633    5                     OPN_JRNL.V.RES#='DP  ';

   5633  5 002110   000006 236000 3                  LDQ     NOTOWNER+5
         5 002111   000632 756000 1                  STQ     OPN_JRNL+40

      723     5634    5                     OPN_JRNL.V.DCB#=J$->JRNL.DCB#;

   5634  5 002112   000001 720100                    LXL0    1,,PR0
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:122  
         5 002113   000626 740000 1                  STX0    OPN_JRNL+36

      724     5635    5                     OPN_JRNL.NAME_=VECTOR(J$->JRNL.NAME);

   5635  5 002114   000010 235000 6                  LDA     8
         5 002115   200010 236100                    LDQ     J$,,AUTO
         5 002116   000010 036003                    ADLQ    8,DU
         5 002117   000570 757000 1                  STAQ    OPN_JRNL+6

      725     5636    5                     OPN_JRNL.ACCT_=VECTOR(J$->JRNL.ACCT);

   5636  5 002120   000007 235000 6                  LDA     7
         5 002121   200010 236100                    LDQ     J$,,AUTO
         5 002122   000020 036003                    ADLQ    16,DU
         5 002123   000606 757000 1                  STAQ    OPN_JRNL+20

      726     5637    5                     CG_SN.SN#(0)=J$->JRNL.PSN;

   5637  5 002124   040000 100500                    MLR     fill='040'O
         5 002125   000006 000006                    ADSC9   6,,PR0                   cn=0,n=6
         5 002126   000507 000006 1                  ADSC9   CG_SN+1                  cn=0,n=6

      727     5638    5                     CALL M$OPEN(OPN_JRNL) ALTRET(TSTOPNERR);

   5638  5 002127   000562 630400 1                  EPPR0   OPN_JRNL
         5 002130   450000 713400                    CLIMB   alt,open
         5 002131   410400 401760                    pmme    nvectors=18
         5 002132   002210 702000 5                  TSX2    TSTOPNERR

      728     5639    5                     J$->JRNL.CFU=POFFW(DCBADDR(J$->JRNL.DCB#)->F$DCB.CFU$,

   5639  5 002133   000012 470400 6                  LDP0    10
         5 002134   000000 471500                    LDP1    0,,PR0
         5 002135   200010 473500                    LDP3    J$,,AUTO
         5 002136   300001 720100                    LXL0    1,,PR3
         5 002137   100000 474510                    LDP4    0,X0,PR1
         5 002140   000000 235000 xsym               LDA     B$DS1$
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:123  
         5 002141   000022 771000                    ARL     18
         5 002142   200040 755100                    STA     P$+2,,AUTO
         5 002143   400066 236100                    LDQ     54,,PR4
         5 002144   000022 772000                    QRL     18
         5 002145   200040 136100                    SBLQ    P$+2,,AUTO
         5 002146   300002 756100                    STQ     2,,PR3

      729     5640    5                        B$DS1$);
      730     5641    6                     IF NOT DCBADDR(OPN_JRNL.V.DCB#)->F$DCB.OWNER THEN DO;

   5641  5 002147   000626 220000 1                  LDX0    OPN_JRNL+36
         5 002150   100000 474510                    LDP4    0,X0,PR1
         5 002151   400064 236100                    LDQ     52,,PR4
         5 002152   040000 316007                    CANQ    16384,DL
         5 002153   002157 601000 5                  TNZ     s:5653

      731     5642        /*                      Not the journal owner.  Cant rename. */
      732     5643    6                        OPN_ANSWER.ERR=NORENAME;

   5643  5 002154   000000 236000 3                  LDQ     NORENAME
         5 002155   000017 756000 1                  STQ     OPN_ANSWER

      733     5644        /*E*
      734     5645        ERROR:  FJ-E$NORENAME
      735     5646        MESSAGE: The journal could not be renamed by JAYS.
      736     5647        MESSAGE1: Someone other than JAYS is currently the journal owner.
      737     5648        */
      738     5649    6                        GOTO TSTOPNERR1;

   5649  5 002156   002214 710000 5                  TRA     TSTOPNERR1

      739     5650    6                        END;
      740     5651    5                     END;
      741     5652
      742     5653    4                  CALL TESTOPEN ALTRET(TSTOPNERR);

   5653  5 002157   004351 701000 5                  TSX1    TESTOPEN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:124  
         5 002160   002210 702000 5                  TSX2    TSTOPNERR

      743     5654    4                  CALL MYACCN;

   5654  5 002161   004333 701000 5                  TSX1    MYACCN
         5 002162   000000 011000                    NOP     0

      744     5655    5                  IF DELFFLG THEN DO;

   5655  5 002163   200015 234100                    SZN     DELFFLG,,AUTO
         5 002164   002201 605000 5                  TPL     s:5661

      745     5656    5                     CLS_RNAME.V.DCB#=J$->JRNL.DCB#;

   5656  5 002165   200010 470500                    LDP0    J$,,AUTO
         5 002166   000001 720100                    LXL0    1,,PR0
         5 002167   001052 740000 1                  STX0    CLS_RNAME+26

      746     5657    5                     CLS_RNAME.NAME_=VECTOR(BUF$->JRNRENAME.FID2.FNAME);

   5657  5 002170   000010 235000 6                  LDA     8
         5 002171   004156 236000 1                  LDQ     BUF$
         5 002172   000021 036003                    ADLQ    17,DU
         5 002173   001026 757000 1                  STAQ    CLS_RNAME+6

      747     5658    5                     CALL M$CLOSE(CLS_RNAME) ALTRET(JRNLERR);

   5658  5 002174   001020 630400 1                  EPPR0   CLS_RNAME
         5 002175   450001 713400                    CLIMB   alt,close
         5 002176   406000 401760                    pmme    nvectors=13
         5 002177   001205 702000 5                  TSX2    JRNLERR

      748     5659    5                     END;

   5659  5 002200   002203 710000 5                  TRA     s:5663

      749     5660    4                  ELSE
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:125  
      750     5661    4                     OPN_ANSWER.ERR=NOAUTH;      /* If not, error him  */

   5661  5 002201   003464 236000 1                  LDQ     NOAUTH
         5 002202   000017 756000 1                  STQ     OPN_ANSWER

      751     5662
      752     5663    4                  IF FREE THEN

   5663  5 002203   200016 234100                    SZN     FREE,,AUTO
         5 002204   002207 605000 5                  TPL     s:5667

      753     5664    4                     CALL CLSJRNL;

   5664  5 002205   003345 701000 5                  TSX1    CLSJRNL
         5 002206   000000 011000                    NOP     0

      754     5665
      755     5666
      756     5667    5                  DO WHILE ('0'B);

   5667  5 002207   002331 710000 5                  TRA     XIT_CSCG_RD

      757     5668    5   TSTOPNERR:        OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5668  5 002210   000000 470400 xsym  TSTOPNERR    LDP0    B$TCB$
         5 002211   000000 471500                    LDP1    0,,PR0
         5 002212   100102 236100                    LDQ     66,,PR1
         5 002213   000017 756000 1                  STQ     OPN_ANSWER

      758     5669    5   TSTOPNERR1:       IF FREE THEN

   5669  5 002214   200016 234100       TSTOPNERR1   SZN     FREE,,AUTO
         5 002215   002220 605000 5                  TPL     s:5671

      759     5670    5                        CALL CLSJRNL;

   5670  5 002216   003345 701000 5                  TSX1    CLSJRNL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:126  
         5 002217   000000 011000                    NOP     0

      760     5671    5                     CALL MYACCN;

   5671  5 002220   004333 701000 5                  TSX1    MYACCN
         5 002221   000000 011000                    NOP     0

      761     5672    5                     END;

   5672  5 002222   002331 710000 5                  TRA     XIT_CSCG_RD

      762     5673
      763     5674        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:127  
      764     5675    4                CASE(FJ_CANCEL_CMD);

      765     5676    4                  CG$=ADDR(NIL);

   5676  5 002223   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 002224   200005 756100                    STQ     CG$,,AUTO

      766     5677    4                  WR_JRNL_RESULTS.BUF_=VECTOR(OPN_ANSWER);

   5677  5 002225   000004 237000 6                  LDAQ    4
         5 002226   000224 757000 1                  STAQ    WR_JRNL_RESULTS+4

      767     5678    4                  OPN_ANSWER.ERR='0'B;

   5678  5 002227   000017 450000 1                  STZ     OPN_ANSWER

      768     5679    4                  CALL LOCJRNL (BUF$->JRNCANCEL.FID1.FNAME,BUF$->JRNCANCEL.FID1.ACCT)

   5679  5 002230   004156 236000 1                  LDQ     BUF$
         5 002231   000012 036003                    ADLQ    10,DU
         5 002232   200032 756100                    STQ     @NAME+1,,AUTO
         5 002233   004156 236000 1                  LDQ     BUF$
         5 002234   000002 036003                    ADLQ    2,DU
         5 002235   200031 756100                    STQ     EVENT+2,,AUTO
         5 002236   004233 701000 5                  TSX1    LOCJRNL
         5 002237   002327 702000 5                  TSX2    RNM2

      769     5680    4                     ALTRET(RNM2);
      770     5681    4                  CALL HISACCN (BUF$->JRNCANCEL.ACCN,BUF$->JRNCANCEL.UNAME,

   5681  5 002240   004156 236000 1                  LDQ     BUF$
         5 002241   000030 036003                    ADLQ    24,DU
         5 002242   200036 756100                    STQ     I$+1,,AUTO
         5 002243   004156 236000 1                  LDQ     BUF$
         5 002244   000026 036003                    ADLQ    22,DU
         5 002245   200035 756100                    STQ     @HISNAME+1,,AUTO
         5 002246   004156 236000 1                  LDQ     BUF$
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:128  
         5 002247   000023 036003                    ADLQ    19,DU
         5 002250   200034 756100                    STQ     @HISACCN+1,,AUTO
         5 002251   004156 236000 1                  LDQ     BUF$
         5 002252   000021 036003                    ADLQ    17,DU
         5 002253   200033 756100                    STQ     @ACCN+1,,AUTO
         5 002254   004276 701000 5                  TSX1    HISACCN
         5 002255   000000 011000                    NOP     0

      771     5682    4                     BUF$->JRNCANCEL.FACCN,BUF$->JRNCANCEL.PRIV);
      772     5683    4                  CALL TESTOPEN

   5683  5 002256   004351 701000 5                  TSX1    TESTOPEN
         5 002257   002261 702000 5                  TSX2    s:5685
         5 002260   002263 710000 5                  TRA     s:5688

      773     5684    5                  WHENALTRETURN DO;

      774     5685    5                     FREE=%NO#;

   5685  5 002261   200016 450100                    STZ     FREE,,AUTO

      775     5686    5                     GOTO TSTOPNERR;

   5686  5 002262   002210 710000 5                  TRA     TSTOPNERR

      776     5687    5                     END;
      777     5688    4                  CALL MYACCN;

   5688  5 002263   004333 701000 5                  TSX1    MYACCN
         5 002264   000000 011000                    NOP     0

      778     5689    5                  IF DELFFLG THEN DO;

   5689  5 002265   200015 234100                    SZN     DELFFLG,,AUTO
         5 002266   002324 605000 5                  TPL     s:5706

      779     5690                      /* If he has DELF access then go ahead*/
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:129  
      780     5691    5                     CG$=CGACTIVE$;

   5691  5 002267   200007 236100                    LDQ     CGACTIVE$,,AUTO
         5 002270   200005 756100                    STQ     CG$,,AUTO

      781     5692    6                     DO WHILE (CG$ ~= ADDR(NIL));

   5692  5 002271   002317 710000 5                  TRA     s:5702

      782     5693    7                        IF CG$->CG.JRNL$ = J$ THEN DO;

   5693  5 002272   200005 470500                    LDP0    CG$,,AUTO
         5 002273   000003 236100                    LDQ     3,,PR0
         5 002274   200010 116100                    CMPQ    J$,,AUTO
         5 002275   002314 601000 5                  TNZ     CNCL1

      783     5694    7                           J$->JRNL.CGCNT=J$->JRNL.CGCNT-1;

   5694  5 002276   200010 471500                    LDP1    J$,,AUTO
         5 002277   100004 235100                    LDA     4,,PR1
         5 002300   000001 135007                    SBLA    1,DL
         5 002301   100004 755100                    STA     4,,PR1

      784     5695    7                           CG$->CG.JRNL$=ADDR(NIL);

   5695  5 002302   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 002303   000003 756100                    STQ     3,,PR0

      785     5696    7                           CG_CLS.V.DCB#=CG$->CG.DCB#;

   5696  5 002304   000002 720100                    LXL0    2,,PR0
         5 002305   000556 740000 1                  STX0    CG_CLS+26

      786     5697    7                           CALL CLSCGMSG;

   5697  5 002306   003771 701000 5                  TSX1    CLSCGMSG
         5 002307   000000 011000                    NOP     0
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:130  

      787     5698    7                           CALL M$CLOSE (CG_CLS) ALTRET(CNCL1);

   5698  5 002310   000524 630400 1                  EPPR0   CG_CLS
         5 002311   450001 713400                    CLIMB   alt,close
         5 002312   406000 401760                    pmme    nvectors=13
         5 002313   002314 702000 5                  TSX2    CNCL1

   5696  5 002314                       CNCL1        null
      788     5699    7   CNCL1:                  ;
      789     5700    7                           END;

      790     5701    6                        CG$=CG$->CG.LNK$;

   5701  5 002314   200005 470500                    LDP0    CG$,,AUTO
         5 002315   000000 236100                    LDQ     0,,PR0
         5 002316   200005 756100                    STQ     CG$,,AUTO

      791     5702    6                        END;

   5702  5 002317   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 002320   002272 601000 5                  TNZ     s:5693

      792     5703    5                     CALL CLSJRNL;

   5703  5 002321   003345 701000 5                  TSX1    CLSJRNL
         5 002322   000000 011000                    NOP     0

      793     5704    5                     END;

   5704  5 002323   002326 710000 5                  TRA     s:5707

      794     5705    4                  ELSE
      795     5706    4                     OPN_ANSWER.ERR=NOAUTH;

   5706  5 002324   003464 236000 1                  LDQ     NOAUTH
         5 002325   000017 756000 1                  STQ     OPN_ANSWER
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:131  

      796     5707    5                  DO WHILE ('0'B);

   5707  5 002326   002331 710000 5                  TRA     XIT_CSCG_RD

      797     5708    5   RNM2:             OPN_ANSWER.ERR=NOJRNL;

   5708  5 002327   003465 236000 1     RNM2         LDQ     NOJRNL
         5 002330   000017 756000 1                  STQ     OPN_ANSWER

      798     5709    5                     END;

      799     5710        /*E*    ERROR: FJJ-E$NOAUTH
      800     5711                MESSAGE: You are not authorized to rename or cancel journal.
      801     5712                MESSAGE1: You must have DELF authorization to do that.
      802     5713        */
      803     5714        /*E*    ERROR: FJJ-E$NOJRNL
      804     5715                MESSAGE: That journal is unknown to JAYS
      805     5716                MESSAGE1: JAYS does not currently have the journal open.
      806     5717        */
      807     5718    4                END;                     /* end of CSCG events                 */

      808     5719
      809     5720
      810     5721        /* If any errors occur on read or write of CSCG, let the ghost abort.
      811     5722           The XCON routine will try to snap and explain things.  There isn't
      812     5723           anything to be done if we can't get at CSCG.                       */
      813     5724
      814     5725    3   XIT_CSCG_RD: WR_CSCG_STA.STATION#=FJ_EV.STA(EVENT);

   5725  5 002331   200027 236100       XIT_CSCG_RD  LDQ     EVENT,,AUTO
         5 002332   000044 402007                    MPY     36,DL
         5 002333   040000 100406                    MLR     fill='040'O
         5 002334   000004 000010 xsym               ADSC9   FJ_EV+4,Q                cn=0,n=8
         5 002335   000234 000010 1                  ADSC9   WR_CSCG_STA              cn=0,n=8

      815     5726    3               WR_CSCG_STA.MSGTYP#=FJ_EV.MSG(EVENT);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:132  

   5726  5 002336   040000 100406                    MLR     fill='040'O
         5 002337   000006 000010 xsym               ADSC9   FJ_EV+6,Q                cn=0,n=8
         5 002340   000236 000010 1                  ADSC9   WR_CSCG_STA+2            cn=0,n=8

      816     5727    3               CALL M$WRITE (WR_JRNL_RESULTS);

   5727  5 002341   000220 630400 1                  EPPR0   WR_JRNL_RESULTS
         5 002342   040001 713400                    CLIMB   write
         5 002343   401400 401760                    pmme    nvectors=4

      817     5728    3               CALL FREEEV;

   5728  5 002344   004441 701000 5                  TSX1    FREEEV
         5 002345   000000 011000                    NOP     0

      818     5729    3               CALL M$READ (RD_CSCG);

   5729  5 002346   000164 630400 1                  EPPR0   RD_CSCG
         5 002347   040000 713400                    CLIMB   read
         5 002350   401400 401760                    pmme    nvectors=4
         5 002351   000206 710000 5                  TRA     s:5234

      819     5730        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:133  
      820     5731
      821     5732        /* Comgroup read completed event          */
      822     5733    3             CASE(%CG_RD_EV#);

      823     5734    3               CG$=PINCRW(CG_V.P$,FJ_EV.CG#(EVENT));

   5734  5 002352   000003 720006 xsym               LXL0    FJ_EV+3,QL
         5 002353   000000 636010                    EAQ     0,X0
         5 002354   001451 036000 1                  ADLQ    CG_V+1
         5 002355   200005 756100                    STQ     CG$,,AUTO

      824     5735    3               C$=CGACTIVE$;

   5735  5 002356   200007 236100                    LDQ     CGACTIVE$,,AUTO
         5 002357   200004 756100                    STQ     C$,,AUTO

      825     5736    4               DO WHILE C$ ~= CG$;

   5736  5 002360   200005 116100                    CMPQ    CG$,,AUTO
         5 002361   002372 600000 5                  TZE     s:5741

      826     5737    4                  IF C$ = ADDR(NIL) THEN

   5737  5 002362   200004 236100                    LDQ     C$,,AUTO
         5 002363   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 002364   002755 600000 5                  TZE     FREE_RD_EV

      827     5738    4                     GOTO FREE_RD_EV;
      828     5739    4                  C$=C$->CG.LNK$;

   5739  5 002365   200004 470500                    LDP0    C$,,AUTO
         5 002366   000000 236100                    LDQ     0,,PR0
         5 002367   200004 756100                    STQ     C$,,AUTO

      829     5740    4                  END;

   5740  5 002370   200005 116100                    CMPQ    CG$,,AUTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:134  
         5 002371   002362 601000 5                  TNZ     s:5737

      830     5741    3               C$=ADDR(CG$->CG.BUF);

   5741  5 002372   200005 236100                    LDQ     CG$,,AUTO
         5 002373   000023 036003                    ADLQ    19,DU
         5 002374   200004 756100                    STQ     C$,,AUTO

      831     5742
      832     5743    3               IF DCBADDR(CG$->CG.DCB#)->F$DCB.LASTSTA$->RDSTA.MSGTYP#

   5743  5 002375   000012 470400 6                  LDP0    10
         5 002376   000000 471500                    LDP1    0,,PR0
         5 002377   200005 473500                    LDP3    CG$,,AUTO
         5 002400   300002 720100                    LXL0    2,,PR3
         5 002401   100000 474510                    LDP4    0,X0,PR1
         5 002402   400007 475500                    LDP5    7,,PR4
         5 002403   040000 106500                    CMPC    fill='040'O
         5 002404   500002 000010                    ADSC9   2,,PR5                   cn=0,n=8
         5 002405   000033 000005 3                  ADSC9   NOTOWNER+26              cn=0,n=5
         5 002406   002513 601000 5                  TNZ     s:5770
         5 002407   200027 236100                    LDQ     EVENT,,AUTO
         5 002410   000011 402007                    MPY     9,DL
         5 002411   000010 236006 xsym               LDQ     FJ_EV+8,QL
         5 002412   377770 316007                    CANQ    131064,DL
         5 002413   002513 601000 5                  TNZ     s:5770

      833     5744    3                  = '*AUEV' AND FJ_EV.ERR.ERR#(EVENT) = 0 THEN
      834     5745    4               DO CASE (ADDR(CGJREC.MESS)->B$CGAURD.EVENT);

   5745  5 002414   200004 476500                    LDP6    C$,,AUTO
         5 002415   600023 235100                    LDA     19,,PR6
         5 002416   000025 135007                    SBLA    21,DL
         5 002417   000001 115007                    CMPA    1,DL
         5 002420   002422 602005 5                  TNC     s:5745+6,AL
         5 002421   000206 710000 5                  TRA     s:5234
         5 002422   002423 710000 5                  TRA     s:5750
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:135  

      835     5746
      836     5747        /* Comgroup message deleted                                           */
      837     5748
      838     5749    4                CASE(%CG_JNLD#);

      839     5750    4                  CGDEL.TYPE=T#CGDEL;

   5750  5 002423   024000 236003                    LDQ     10240,DU
         5 002424   000002 552040 1                  STBQ    CGDEL+1,'40'O

      840     5751    4                  CGDEL.MSGID.PRIMARY=ADDR(CGJREC.MESS)->B$CGAURD.MID.MSGID;

   5751  5 002425   600024 235100                    LDA     20,,PR6
         5 002426   000003 755000 1                  STA     CGDEL+2

      841     5752    4                  CGDEL.MSGID.XT=ADDR(CGJREC.MESS)->B$CGAURD.MID.MSGIDXT;

   5752  5 002427   600025 235100                    LDA     21,,PR6
         5 002430   000004 755000 1                  STA     CGDEL+3

      842     5753    4                  CGDEL.DCB#=CG$->CG.HISDCB;

   5753  5 002431   300005 720100                    LXL0    5,,PR3
         5 002432   000002 440000 1                  SXL0    CGDEL+1

      843     5754    4                  CGDEL.USER#=CG$->CG.HISUSER#;

   5754  5 002433   300006 236100                    LDQ     6,,PR3
         5 002434   000022 736000                    QLS     18
         5 002435   000002 552020 1                  STBQ    CGDEL+1,'20'O

      844     5755    4                  CG_TIME.TSTAMP_=VECTOR(CGDEL.TIME);

   5755  5 002436   000020 237000 6                  LDAQ    16
         5 002437   001442 757000 1                  STAQ    CG_TIME+8

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:136  
      845     5756    4                  CALL M$TIME (CG_TIME);

   5756  5 002440   001432 630400 1                  EPPR0   CG_TIME
         5 002441   020004 713400                    CLIMB   8196
         5 002442   402000 401760                    pmme    nvectors=5

      846     5757    4                  WR_CG_JRNL.BUF_=VECTOR(CGDEL);

   5757  5 002443   000022 237000 6                  LDAQ    18
         5 002444   000752 757000 1                  STAQ    WR_CG_JRNL+4

      847     5758    4                  WR_CG_JRNL.V.DCB#=CG$->CG.JRNL$->JRNL.DCB#;

   5758  5 002445   200005 470500                    LDP0    CG$,,AUTO
         5 002446   000003 471500                    LDP1    3,,PR0
         5 002447   100001 720100                    LXL0    1,,PR1
         5 002450   000756 740000 1                  STX0    WR_CG_JRNL+8

      848     5759    4                  CALL M$WRITE (WR_CG_JRNL) ALTRET(WRJERR);

   5759  5 002451   000746 630400 1                  EPPR0   WR_CG_JRNL
         5 002452   440001 713400                    CLIMB   alt,write
         5 002453   401400 401760                    pmme    nvectors=4
         5 002454   002736 702000 5                  TSX2    WRJERR

      849     5760    4                  CG_RD.V.DCB#=CG$->CG.DCB#;

   5760  5 002455   200005 470500                    LDP0    CG$,,AUTO
         5 002456   000002 720100                    LXL0    2,,PR0
         5 002457   000454 740000 1                  STX0    CG_RD+8

      850     5761    4                  CG_RD.V.EVENT#=1000+CGP.OFFSET;

   5761  5 002460   200005 235100                    LDA     CG$,,AUTO
         5 002461   000022 771000                    ARL     18
         5 002462   001750 035007                    ADLA    1000,DL
         5 002463   000455 755000 1                  STA     CG_RD+9
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:137  

      851     5762    4                  CG_RD.BUF_.BOUND=SIZEC(CG.BUF)-POFFC(ADDR(CGJREC.MESS),

   5762  5 002464   200004 236100                    LDQ     C$,,AUTO
         5 002465   000020 772000                    QRL     16
         5 002466   200040 756100                    STQ     P$+2,,AUTO
         5 002467   200004 236100                    LDQ     C$,,AUTO
         5 002470   000023 036003                    ADLQ    19,DU
         5 002471   000020 772000                    QRL     16
         5 002472   200040 136100                    SBLQ    P$+2,,AUTO
         5 002473   000027 676000 xsym               ERQ     B_VECTNIL+23
         5 002474   002000 036007                    ADLQ    1024,DL
         5 002475   000020 736000                    QLS     16
         5 002476   000450 676000 1                  ERQ     CG_RD+4
         5 002477   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 002500   000450 656000 1                  ERSQ    CG_RD+4

      852     5763    4                     ADDR(CGJREC))-1;
      853     5764    4                  CG_RD.BUF_.BUF$=ADDR(ADDR(CG$->CG.BUF)->CGJREC.MESS);

   5764  5 002501   200005 236100                    LDQ     CG$,,AUTO
         5 002502   000046 036003                    ADLQ    38,DU
         5 002503   000451 756000 1                  STQ     CG_RD+5

      854     5765    4                  CALL FREEEV;

   5765  5 002504   004441 701000 5                  TSX1    FREEEV
         5 002505   000000 011000                    NOP     0

      855     5766    4                  CALL M$READ (CG_RD) ALTRET(RDCGERR);

   5766  5 002506   000444 630400 1                  EPPR0   CG_RD
         5 002507   440000 713400                    CLIMB   alt,read
         5 002510   401400 401760                    pmme    nvectors=4
         5 002511   002716 702000 5                  TSX2    RDCGERR
         5 002512   000206 710000 5                  TRA     s:5234

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:138  
      856     5767    4                CASE(ELSE);

      857     5768    4                END;

      858     5769    3               ELSE
      859     5770    4               DO CASE (FJ_EV.ERR.ERR#(EVENT));

   5770  5 002513   200027 236100                    LDQ     EVENT,,AUTO
         5 002514   000011 402007                    MPY     9,DL
         5 002515   000010 236006 xsym               LDQ     FJ_EV+8,QL
         5 002516   000003 772000                    QRL     3
         5 002517   037777 376007                    ANQ     16383,DL
         5 002520   000016 116007                    CMPQ    14,DL
         5 002521   002523 602006 5                  TNC     s:5770+8,QL
         5 002522   002716 710000 5                  TRA     RDCGERR
         5 002523   002553 710000 5                  TRA     s:5777
         5 002524   002716 710000 5                  TRA     RDCGERR
         5 002525   002716 710000 5                  TRA     RDCGERR
         5 002526   002716 710000 5                  TRA     RDCGERR
         5 002527   002716 710000 5                  TRA     RDCGERR
         5 002530   002716 710000 5                  TRA     RDCGERR
         5 002531   002716 710000 5                  TRA     RDCGERR
         5 002532   002553 710000 5                  TRA     s:5777
         5 002533   002716 710000 5                  TRA     RDCGERR
         5 002534   002716 710000 5                  TRA     RDCGERR
         5 002535   002716 710000 5                  TRA     RDCGERR
         5 002536   002716 710000 5                  TRA     RDCGERR
         5 002537   002716 710000 5                  TRA     RDCGERR
         5 002540   002541 710000 5                  TRA     s:5772

      860     5771    4                CASE(%E$DACTR);          /* This station was deactivated       */

      861     5772    4                  IF CG$->CG.JRNL$ ~= ADDR(NIL) THEN

   5772  5 002541   300003 236100                    LDQ     3,,PR3
         5 002542   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 002543   002546 600000 5                  TZE     s:5774
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:139  

      862     5773    4                     CALL WRBERC ALTRET(WRJERR);

   5773  5 002544   003422 701000 5                  TSX1    WRBERC
         5 002545   002736 702000 5                  TSX2    WRJERR

      863     5774    4                  CALL CLSCG;

   5774  5 002546   003231 701000 5                  TSX1    CLSCG
         5 002547   000000 011000                    NOP     0

      864     5775    4                  CALL FREEEV;

   5775  5 002550   004441 701000 5                  TSX1    FREEEV
         5 002551   000000 011000                    NOP     0
         5 002552   000206 710000 5                  TRA     s:5234

      865     5776    4                CASE(%E$LD,0);           /* No error, or Lost Data             */

      866     5777    4                  CG_TIME.TSTAMP_=VECTOR(CGJREC.TIME);

   5777  5 002553   777640 235007                    LDA     -96,DL
         5 002554   200004 236100                    LDQ     C$,,AUTO
         5 002555   001442 757000 1                  STAQ    CG_TIME+8

      867     5778    4                  CALL M$TIME (CG_TIME);

   5778  5 002556   001432 630400 1                  EPPR0   CG_TIME
         5 002557   020004 713400                    CLIMB   8196
         5 002560   402000 401760                    pmme    nvectors=5

      868     5779    4                  CGJREC.DCB#=CG$->CG.HISDCB;

   5779  5 002561   200005 470500                    LDP0    CG$,,AUTO
         5 002562   000005 720100                    LXL0    5,,PR0
         5 002563   200004 471500                    LDP1    C$,,AUTO
         5 002564   100001 440100                    SXL0    1,,PR1
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:140  

      869     5780    4                  CGJREC.TYPE=T#CGMSG;

   5780  5 002565   023000 236003                    LDQ     9728,DU
         5 002566   100001 552140                    STBQ    1,'40'O,PR1

      870     5781    4                  CGJREC.USER#=CG$->CG.HISUSER#;

   5781  5 002567   000006 236100                    LDQ     6,,PR0
         5 002570   000022 736000                    QLS     18
         5 002571   100001 552120                    STBQ    1,'20'O,PR1

      871     5782    4                  IF FJ_EV.ERR.ERR#(EVENT)=%E$LD THEN

   5782  5 002572   200027 236100                    LDQ     EVENT,,AUTO
         5 002573   000011 402007                    MPY     9,DL
         5 002574   000010 236006 xsym               LDQ     FJ_EV+8,QL
         5 002575   377770 376007                    ANQ     131064,DL
         5 002576   000070 116007                    CMPQ    56,DL
         5 002577   002603 601000 5                  TNZ     s:5787

      872     5783    4                     CGJREC.CONT = '1'B;

   5783  5 002600   400000 236003                    LDQ     -131072,DU
         5 002601   100002 756100                    STQ     2,,PR1
         5 002602   002616 710000 5                  TRA     s:5792

      873     5784    5                  ELSE DO;

      874     5785        /* Get message parameters to go into journal record with message  */
      875     5786
      876     5787    5                     CGJREC.CONT = '0'B;

   5787  5 002603   100002 450100                    STZ     2,,PR1

      877     5788    5                     GET_MESS_ATTR.ONEATTR_=VECTOR(CGJREC.MSGATTR);

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:141  
   5788  5 002604   000024 235000 6                  LDA     20
         5 002605   200004 236100                    LDQ     C$,,AUTO
         5 002606   000003 036003                    ADLQ    3,DU
         5 002607   001102 757000 1                  STAQ    GET_MESS_ATTR+12

      878     5789    5                     GET_MESS_ATTR.V.DCB#=CG$->CG.DCB#;

   5789  5 002610   000002 720100                    LXL0    2,,PR0
         5 002611   001122 740000 1                  STX0    GET_MESS_ATTR+28

      879     5790    5                     CALL M$FWCG (GET_MESS_ATTR) ALTRET(RDCGERR);

   5790  5 002612   001066 630400 1                  EPPR0   GET_MESS_ATTR
         5 002613   500005 713400                    CLIMB   alt,+32773
         5 002614   406400 401760                    pmme    nvectors=14
         5 002615   002716 702000 5                  TSX2    RDCGERR

      880     5791    5                     END;

      881     5792    4                  WR_CG_JRNL.V.DCB#=CG$->CG.JRNL$->JRNL.DCB#;

   5792  5 002616   200005 470500                    LDP0    CG$,,AUTO
         5 002617   000003 471500                    LDP1    3,,PR0
         5 002620   100001 720100                    LXL0    1,,PR1
         5 002621   000756 740000 1                  STX0    WR_CG_JRNL+8

      882     5793    4                  WR_CG_JRNL.BUF_=VECTOR(CGJREC);

   5793  5 002622   000025 235000 6                  LDA     21
         5 002623   200004 236100                    LDQ     C$,,AUTO
         5 002624   000752 757000 1                  STAQ    WR_CG_JRNL+4

      883     5794    4                  WR_CG_JRNL.BUF_.BOUND=SIZEC(CGJREC)-SIZEC(CGJREC.MESS)+

   5794  5 002625   200027 236100                    LDQ     EVENT,,AUTO
         5 002626   000011 402007                    MPY     9,DL
         5 002627   000002 236006 xsym               LDQ     FJ_EV+2,QL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:142  
         5 002630   000113 036007                    ADLQ    75,DL
         5 002631   000020 736000                    QLS     16
         5 002632   000752 676000 1                  ERQ     WR_CG_JRNL+4
         5 002633   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 002634   000752 656000 1                  ERSQ    WR_CG_JRNL+4

      884     5795    4                     FJ_EV.ARS(EVENT) - 1;
      885     5796
      886     5797    4                  CALL M$WRITE (WR_CG_JRNL) ALTRET(WRJERR);

   5797  5 002635   000746 630400 1                  EPPR0   WR_CG_JRNL
         5 002636   440001 713400                    CLIMB   alt,write
         5 002637   401400 401760                    pmme    nvectors=4
         5 002640   002736 702000 5                  TSX2    WRJERR

      887     5798
      888     5799    4                  IF CGJREC.CONT = '1'B THEN

   5799  5 002641   200004 470500                    LDP0    C$,,AUTO
         5 002642   000002 234100                    SZN     2,,PR0
         5 002643   002647 605000 5                  TPL     CGUNLTCH

      889     5800    4                     CG_RD.V.DVBYTE.CONT# = '1'B;

   5800  5 002644   001000 236003                    LDQ     512,DU
         5 002645   000457 256000 1                  ORSQ    CG_RD+11
         5 002646   002660 710000 5                  TRA     s:5806

      890     5801    5                  ELSE DO;

      891     5802    5   CGUNLTCH:         FIN_CG_JRNL.V.DCB#=CG$->CG.DCB#;

   5802  5 002647   200005 471500       CGUNLTCH     LDP1    CG$,,AUTO
         5 002650   100002 720100                    LXL0    2,,PR1
         5 002651   000520 740000 1                  STX0    FIN_CG_JRNL+6

      892     5803    5                     CALL M$UNLATCH (FIN_CG_JRNL) ALTRET(RDCGERR);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:143  

   5803  5 002652   000512 630400 1                  EPPR0   FIN_CG_JRNL
         5 002653   500002 713400                    CLIMB   alt,+32770
         5 002654   401000 401760                    pmme    nvectors=3
         5 002655   002716 702000 5                  TSX2    RDCGERR

      893     5804    5                     CG_RD.V.DVBYTE.CONT# = '0'B;

   5804  5 002656   000026 236000 6                  LDQ     22
         5 002657   000457 356000 1                  ANSQ    CG_RD+11

      894     5805    5                     END;

      895     5806    4                  CG_RD.V.DCB#=CG$->CG.DCB#;

   5806  5 002660   200005 470500                    LDP0    CG$,,AUTO
         5 002661   000002 720100                    LXL0    2,,PR0
         5 002662   000454 740000 1                  STX0    CG_RD+8

      896     5807    4                  CG_RD.V.EVENT#=1000+CGP.OFFSET;

   5807  5 002663   200005 235100                    LDA     CG$,,AUTO
         5 002664   000022 771000                    ARL     18
         5 002665   001750 035007                    ADLA    1000,DL
         5 002666   000455 755000 1                  STA     CG_RD+9

      897     5808    4                  CG_RD.BUF_.BOUND=SIZEC(CG.BUF)-POFFC(ADDR(CGJREC.MESS),

   5808  5 002667   200004 236100                    LDQ     C$,,AUTO
         5 002670   000020 772000                    QRL     16
         5 002671   200040 756100                    STQ     P$+2,,AUTO
         5 002672   200004 236100                    LDQ     C$,,AUTO
         5 002673   000023 036003                    ADLQ    19,DU
         5 002674   000020 772000                    QRL     16
         5 002675   200040 136100                    SBLQ    P$+2,,AUTO
         5 002676   000027 676000 xsym               ERQ     B_VECTNIL+23
         5 002677   002000 036007                    ADLQ    1024,DL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:144  
         5 002700   000020 736000                    QLS     16
         5 002701   000450 676000 1                  ERQ     CG_RD+4
         5 002702   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 002703   000450 656000 1                  ERSQ    CG_RD+4

      898     5809    4                     ADDR(CGJREC))-1;
      899     5810    4                  CG_RD.BUF_.BUF$=ADDR(ADDR(CG$->CG.BUF)->CGJREC.MESS);

   5810  5 002704   200005 236100                    LDQ     CG$,,AUTO
         5 002705   000046 036003                    ADLQ    38,DU
         5 002706   000451 756000 1                  STQ     CG_RD+5

      900     5811
      901     5812    4                  CALL FREEEV;

   5812  5 002707   004441 701000 5                  TSX1    FREEEV
         5 002710   000000 011000                    NOP     0

      902     5813    4                  CALL M$READ (CG_RD) ALTRET(RDCGERR);

   5813  5 002711   000444 630400 1                  EPPR0   CG_RD
         5 002712   440000 713400                    CLIMB   alt,read
         5 002713   401400 401760                    pmme    nvectors=4
         5 002714   002716 702000 5                  TSX2    RDCGERR
         5 002715   000206 710000 5                  TRA     s:5234

      903     5814    4                CASE(ELSE);

      904     5815        /* Handle other comgroup read errors  */
      905     5816    4   RDCGERR:       CALL ERRMSG (FJ_EV.ERR(EVENT),CG$->CG.DCB#);

   5816  5 002716   200005 236100       RDCGERR      LDQ     CG$,,AUTO
         5 002717   000002 036003                    ADLQ    2,DU
         5 002720   200032 756100                    STQ     @NAME+1,,AUTO
         5 002721   200027 236100                    LDQ     EVENT,,AUTO
         5 002722   000011 402003                    MPY     9,DU
         5 002723   000027 036000 6                  ADLQ    23
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:145  
         5 002724   200031 756100                    STQ     EVENT+2,,AUTO
         5 002725   004165 701000 5                  TSX1    ERRMSG
         5 002726   000000 011000                    NOP     0

      906     5817    4                  CALL CLSCGMSG;

   5817  5 002727   003771 701000 5                  TSX1    CLSCGMSG
         5 002730   000000 011000                    NOP     0

      907     5818    4                  CALL CLSCG;

   5818  5 002731   003231 701000 5                  TSX1    CLSCG
         5 002732   000000 011000                    NOP     0

      908     5819    4                  CALL FREEEV;

   5819  5 002733   004441 701000 5                  TSX1    FREEEV
         5 002734   000000 011000                    NOP     0

      909     5820    5                  DO WHILE ('0'B);

   5820  5 002735   000206 710000 5                  TRA     s:5234

      910     5821        /*  Shut off all comgroups journaling to this file. Put out a message
      911     5822            on the OC about each comgroup and about the journal error.         */
      912     5823    5   WRJERR:           J$=CG$->CG.JRNL$;

   5823  5 002736   200005 470500       WRJERR       LDP0    CG$,,AUTO
         5 002737   000003 236100                    LDQ     3,,PR0
         5 002740   200010 756100                    STQ     J$,,AUTO

      913     5824    5                     CALL ERRMSG (B$TCB$->B$TCB.ALT$->B$ALT.ERR,J$->JRNL.DCB#);

   5824  5 002741   000000 471400 xsym               LDP1    B$TCB$
         5 002742   100000 473500                    LDP3    0,,PR1
         5 002743   000001 036003                    ADLQ    1,DU
         5 002744   200032 756100                    STQ     @NAME+1,,AUTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:146  
         5 002745   300102 634500                    EPPR4   66,,PR3
         5 002746   200031 454500                    STP4    EVENT+2,,AUTO
         5 002747   004165 701000 5                  TSX1    ERRMSG
         5 002750   000000 011000                    NOP     0

      914     5825    5                     CALL CHKCG;

   5825  5 002751   003262 701000 5                  TSX1    CHKCG
         5 002752   000000 011000                    NOP     0

      915     5826    5                     CALL CLSJRNL;

   5826  5 002753   003345 701000 5                  TSX1    CLSJRNL
         5 002754   000000 011000                    NOP     0

      916     5827    5   FREE_RD_EV:       CALL FREEEV;

   5827  5 002755   004441 701000 5     FREE_RD_EV   TSX1    FREEEV
         5 002756   000000 011000                    NOP     0

      917     5828    5                     END;

      918     5829    4                END;

   5829  5 002757   000206 710000 5                  TRA     s:5234

      919     5830        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:147  
      920     5831    3             CASE(%SET_DSMNT_EV#);

      921     5832        /*   Release packset requested by PIG    */
      922     5833
      923     5834    3   DSM1:       CG$=CGACTIVE$;

   5834  5 002760   200007 236100       DSM1         LDQ     CGACTIVE$,,AUTO
         5 002761   200005 756100                    STQ     CG$,,AUTO

      924     5835    4               DO WHILE (CG$ ~= ADDR(NIL));

   5835  5 002762   003001 710000 5                  TRA     s:5842

      925     5836    5                  IF CG$->CG.ID.PSN# = SUBSTR(FJ_EV.STA(EVENT),0,6) THEN DO;

   5836  5 002763   200027 236100                    LDQ     EVENT,,AUTO
         5 002764   000044 402007                    MPY     36,DL
         5 002765   200005 470500                    LDP0    CG$,,AUTO
         5 002766   040006 106500                    CMPC    fill='040'O
         5 002767   000011 000006                    ADSC9   9,,PR0                   cn=0,n=6
         5 002770   000004 000006 xsym               ADSC9   FJ_EV+4,Q                cn=0,n=6
         5 002771   002777 601000 5                  TNZ     s:5841

      926     5837    5                     CALL WRBERC ALTRET(DSM2);

   5837  5 002772   003422 701000 5                  TSX1    WRBERC
         5 002773   002774 702000 5                  TSX2    DSM2

      927     5838    5   DSM2:             CALL CLSCG;

   5838  5 002774   003231 701000 5     DSM2         TSX1    CLSCG
         5 002775   000000 011000                    NOP     0

      928     5839    5                     GOTO DSM1;

   5839  5 002776   002760 710000 5                  TRA     DSM1

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:148  
      929     5840    5                     END;
      930     5841    4                  CG$=CG$->CG.LNK$;

   5841  5 002777   000000 236100                    LDQ     0,,PR0
         5 003000   200005 756100                    STQ     CG$,,AUTO

      931     5842    4                  END;

   5842  5 003001   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 003002   002763 601000 5                  TNZ     s:5836

      932     5843    3   DSM3:       J$=JRNLACTIVE$;

   5843  5 003003   200012 236100       DSM3         LDQ     JRNLACTIVE$,,AUTO
         5 003004   200010 756100                    STQ     J$,,AUTO

      933     5844    4               DO WHILE (J$ ~= ADDR(NIL));

   5844  5 003005   003024 710000 5                  TRA     s:5851

      934     5845    5                  IF J$->JRNL.PSN = SUBSTR(FJ_EV.STA(EVENT),0,6) THEN DO;

   5845  5 003006   200027 236100                    LDQ     EVENT,,AUTO
         5 003007   000044 402007                    MPY     36,DL
         5 003010   200010 470500                    LDP0    J$,,AUTO
         5 003011   040006 106500                    CMPC    fill='040'O
         5 003012   000006 000006                    ADSC9   6,,PR0                   cn=0,n=6
         5 003013   000004 000006 xsym               ADSC9   FJ_EV+4,Q                cn=0,n=6
         5 003014   003022 601000 5                  TNZ     s:5850

      935     5846    5                     CALL CHKCG;

   5846  5 003015   003262 701000 5                  TSX1    CHKCG
         5 003016   000000 011000                    NOP     0

      936     5847    5                     CALL CLSJRNL;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:149  
   5847  5 003017   003345 701000 5                  TSX1    CLSJRNL
         5 003020   000000 011000                    NOP     0

      937     5848    5                     GOTO DSM3;

   5848  5 003021   003003 710000 5                  TRA     DSM3

      938     5849    5                     END;
      939     5850    4                  J$=J$->JRNL.LNK$;

   5850  5 003022   000000 236100                    LDQ     0,,PR0
         5 003023   200010 756100                    STQ     J$,,AUTO

      940     5851    4                  END;

   5851  5 003024   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 003025   003006 601000 5                  TNZ     s:5845

      941     5852    3               VLP_RPSN.NN# = 1; /* Release again just in case */

   5852  5 003026   000001 235007                    LDA     1,DL
         5 003027   001312 755000 1                  STA     VLP_RPSN

      942     5853    3               VLP_RPSN.RPLIST.PSN#(0)=SUBSTR(FJ_EV.STA(EVENT),0,6);

   5853  5 003030   200027 236100                    LDQ     EVENT,,AUTO
         5 003031   000044 402007                    MPY     36,DL
         5 003032   040000 100406                    MLR     fill='040'O
         5 003033   000004 000006 xsym               ADSC9   FJ_EV+4,Q                cn=0,n=6
         5 003034   001314 000006 1                  ADSC9   VLP_RPSN+2               cn=0,n=6

      943     5854    3               CALL M$RELRES (RELRES) ALTRET(DSM4);

   5854  5 003035   001246 630400 1                  EPPR0   RELRES
         5 003036   550003 713400                    CLIMB   alt,+53251
         5 003037   402400 401760                    pmme    nvectors=6
         5 003040   003041 702000 5                  TSX2    DSM4
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:150  

   5853  5 003041                       DSM4         null
      944     5855    3   DSM4:       ;
      945     5856    3               CALL FREEEV;

   5856  5 003041   004441 701000 5                  TSX1    FREEEV
         5 003042   000000 011000                    NOP     0
         5 003043   000206 710000 5                  TRA     s:5234

      946     5857        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:151  
      947     5858    3             CASE(%JRNL_ERR_EV#);

      948     5859                                                /*Process errors for journal files*/
      949     5860        /*  Locate journal data entry      */
      950     5861
      951     5862    3               K = POFFW(FJ_EV.CFU$(EVENT),B$DS1$);

   5862  5 003044   000000 235000 xsym               LDA     B$DS1$
         5 003045   000022 771000                    ARL     18
         5 003046   200040 755100                    STA     P$+2,,AUTO
         5 003047   000003 236006 xsym               LDQ     FJ_EV+3,QL
         5 003050   000022 772000                    QRL     18
         5 003051   200040 136100                    SBLQ    P$+2,,AUTO
         5 003052   200014 756100                    STQ     K,,AUTO

      952     5863    3               J$=JRNLACTIVE$;

   5863  5 003053   200012 236100                    LDQ     JRNLACTIVE$,,AUTO
         5 003054   200010 756100                    STQ     J$,,AUTO

      953     5864    4               DO WHILE J$ ~= ADDR(NIL);

   5864  5 003055   003064 710000 5                  TRA     s:5868

      954     5865    4                  IF J$->JRNL.CFU = K THEN

   5865  5 003056   200010 470500                    LDP0    J$,,AUTO
         5 003057   000002 236100                    LDQ     2,,PR0
         5 003060   200014 116100                    CMPQ    K,,AUTO
         5 003061   003070 600000 5                  TZE     JERR

      955     5866    4                     GOTO JERR;
      956     5867    4                  J$=J$->JRNL.LNK$;

   5867  5 003062   000000 236100                    LDQ     0,,PR0
         5 003063   200010 756100                    STQ     J$,,AUTO

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:152  
      957     5868    4                  END;

   5868  5 003064   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 003065   003056 601000 5                  TNZ     s:5865

      958     5869    3               CALL M$XXX;            /* SOMETHING REALLY WRONG HERE  */

   5869  5 003066   000003 713400                    CLIMB   3
         5 003067   000000 401760                    pmme    nvectors=0

      959     5870
      960     5871        /* If end of tape do CVOL, otherwise, quit journaling                 */
      961     5872
      962     5873    3   JERR:       IF FJ_EV.ERR.ERR#(EVENT) = %E$EOVOL AND

   5873  5 003070   200027 236100       JERR         LDQ     EVENT,,AUTO
         5 003071   000011 402007                    MPY     9,DL
         5 003072   000010 236006 xsym               LDQ     FJ_EV+8,QL
         5 003073   377770 376007                    ANQ     131064,DL
         5 003074   013130 116007                    CMPQ    5720,DL
         5 003075   003116 601000 5                  TNZ     s:5880
         5 003076   200010 470500                    LDP0    J$,,AUTO
         5 003077   000032 471500                    LDP1    26,,PR0
         5 003100   100001 236100                    LDQ     1,,PR1
         5 003101   000777 376007                    ANQ     511,DL
         5 003102   100002 116100                    CMPQ    2,,PR1
         5 003103   003116 603000 5                  TRC     s:5880

      963     5874    4                  J$->JRNL.ATTR$->JATTR.Q.VOL# < J$->JRNL.ATTR$->JATTR.Q.NUM# THEN DO;

      964     5875    4                  J$->JRNL.ATTR$->JATTR.Q.VOL#=J$->JRNL.ATTR$->JATTR.Q.VOL#+1;

   5875  5 003104   100001 236100                    LDQ     1,,PR1
         5 003105   000001 036007                    ADLQ    1,DL
         5 003106   100001 552104                    STBQ    1,'04'O,PR1

      965     5876    4                  CVOL_JRNL.V.DCB#=J$->JRNL.DCB#;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:153  

   5876  5 003107   000001 720100                    LXL0    1,,PR0
         5 003110   001064 740000 1                  STX0    CVOL_JRNL+6

      966     5877    4                  CALL M$CVOL (CVOL_JRNL) ALTRET(WRJERR);

   5877  5 003111   001056 630400 1                  EPPR0   CVOL_JRNL
         5 003112   450004 713400                    CLIMB   alt,+20484
         5 003113   401000 401760                    pmme    nvectors=3
         5 003114   002736 702000 5                  TSX2    WRJERR

      967     5878    4                  END;

   5878  5 003115   000206 710000 5                  TRA     s:5234

      968     5879    4               ELSE DO;

      969     5880    4                  CALL ERRMSG (FJ_EV.ERR(EVENT),J$->JRNL.DCB#);

   5880  5 003116   200010 236100                    LDQ     J$,,AUTO
         5 003117   000001 036003                    ADLQ    1,DU
         5 003120   200032 756100                    STQ     @NAME+1,,AUTO
         5 003121   200027 236100                    LDQ     EVENT,,AUTO
         5 003122   000011 402003                    MPY     9,DU
         5 003123   000027 036000 6                  ADLQ    23
         5 003124   200031 756100                    STQ     EVENT+2,,AUTO
         5 003125   004165 701000 5                  TSX1    ERRMSG
         5 003126   000000 011000                    NOP     0

      970     5881    4                  CALL CHKCG;

   5881  5 003127   003262 701000 5                  TSX1    CHKCG
         5 003130   000000 011000                    NOP     0

      971     5882    4                  CALL CLSJRNL;

   5882  5 003131   003345 701000 5                  TSX1    CLSJRNL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:154  
         5 003132   000000 011000                    NOP     0

      972     5883    4                  CALL FREEEV;

   5883  5 003133   004441 701000 5                  TSX1    FREEEV
         5 003134   000000 011000                    NOP     0

      973     5884    4                  END;

      974     5885    3             END;

      975     5886    2            END;

   5886  5 003135   000206 710000 5                  TRA     s:5234

      976     5887        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:155  
      977     5888    1   GETJDCB: PROC ALTRET;

   5888  5 003136   200030 741300       GETJDCB      STX1  ! EVENT+1,,AUTO

      978     5889    2         CALL M$GETDCB (GET_JRNL_DCB) ALTRET(NODCB);

   5889  5 003137   000244 630400 1                  EPPR0   GET_JRNL_DCB
         5 003140   460002 713400                    CLIMB   alt,+24578
         5 003141   401000 401760                    pmme    nvectors=3
         5 003142   003227 702000 5                  TSX2    NODCB

      979     5890
      980     5891        /* Get a table entry for the journal file description and init it
      981     5892                                                     */
      982     5893    3         DO INHIBIT;

      983     5894    4            IF JRNLFREE$ = ADDR(NIL) THEN DO;

   5894  5 003143   200011 236300                    LDQ   ! JRNLFREE$,,AUTO
         5 003144   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         5 003145   003206 601200 5                  TNZ   ! s:5905

      984     5895    4               J$=PINCRW(JRNL_V.P$,((JRNL_V.BND+1)/SIZEC(JRNL))*SIZEW(JRNL));

   5895  5 003146   001452 236200 1                  LDQ   ! JRNL_V
         5 003147   000020 772200                    QRL   ! 16
         5 003150   000001 036207                    ADLQ  ! 1,DL
         5 003151   000154 506207                    DIV   ! 108,DL
         5 003152   000033 402203                    MPY   ! 27,DU
         5 003153   001453 036200 1                  ADLQ  ! JRNL_V+1
         5 003154   200010 756300                    STQ   ! J$,,AUTO

      985     5896    4               JRNLFREE$=J$;

   5896  5 003155   200011 756300                    STQ   ! JRNLFREE$,,AUTO

      986     5897    4               CALL M$GDS (GDS_JRNL) ALTRET(NODCB);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:156  

   5897  5 003156   001146 630600 1                  EPPR0 ! GDS_JRNL
         5 003157   430001 713600                    CLIMB ! alt,gds
         5 003160   400400 401760                    pmme    nvectors=2
         5 003161   003227 702200 5                  TSX2  ! NODCB

      987     5898    5               DO WHILE (PINCRW(J$,SIZEW(JRNL)) < PINCRC(JRNL_V.P$,JRNL_V.BND+1));

   5898  5 003162   003171 710200 5                  TRA   ! s:5902

      988     5899    5                  C$=J$;

   5899  5 003163   200010 236300                    LDQ   ! J$,,AUTO
         5 003164   200004 756300                    STQ   ! C$,,AUTO

      989     5900    5                  J$->JRNL.LNK$=PINCRW(J$,SIZEW(JRNL));

   5900  5 003165   000033 036203                    ADLQ  ! 27,DU
         5 003166   200010 470700                    LDP0  ! J$,,AUTO
         5 003167   000000 756300                    STQ   ! 0,,PR0

      990     5901    5                  J$=J$->JRNL.LNK$;

   5901  5 003170   200010 756300                    STQ   ! J$,,AUTO

      991     5902    5                  END;

   5902  5 003171   001452 236200 1                  LDQ   ! JRNL_V
         5 003172   000020 772200                    QRL   ! 16
         5 003173   000020 736200                    QLS   ! 16
         5 003174   200000 036207                    ADLQ  ! 65536,DL
         5 003175   001453 036200 1                  ADLQ  ! JRNL_V+1
         5 003176   200040 756300                    STQ   ! P$+2,,AUTO
         5 003177   200010 236300                    LDQ   ! J$,,AUTO
         5 003200   000033 036203                    ADLQ  ! 27,DU
         5 003201   200040 116300                    CMPQ  ! P$+2,,AUTO
         5 003202   003163 602200 5                  TNC   ! s:5899
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:157  

      992     5903    4               C$->JRNL.LNK$=ADDR(NIL);

   5903  5 003203   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         5 003204   200004 470700                    LDP0  ! C$,,AUTO
         5 003205   000000 756300                    STQ   ! 0,,PR0

      993     5904    4               END;

      994     5905    3            J$=JRNLFREE$;

   5905  5 003206   200011 236300                    LDQ   ! JRNLFREE$,,AUTO
         5 003207   200010 756300                    STQ   ! J$,,AUTO

      995     5906    3            JRNLFREE$=J$->JRNL.LNK$;

   5906  5 003210   200010 470700                    LDP0  ! J$,,AUTO
         5 003211   000000 236300                    LDQ   ! 0,,PR0
         5 003212   200011 756300                    STQ   ! JRNLFREE$,,AUTO

      996     5907    3            J$->JRNL.LNK$=JRNLACTIVE$;

   5907  5 003213   200012 236300                    LDQ   ! JRNLACTIVE$,,AUTO
         5 003214   000000 756300                    STQ   ! 0,,PR0

      997     5908    3            JRNLACTIVE$=J$;

   5908  5 003215   200010 236300                    LDQ   ! J$,,AUTO
         5 003216   200012 756300                    STQ   ! JRNLACTIVE$,,AUTO

      998     5909    3            END;

      999     5910    2         J$->JRNL.DCB#=XDCB;

   5910  5 003217   004007 235000 1                  LDA     XDCB
         5 003220   000001 755100                    STA     1,,PR0

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:158  
     1000     5911    2         J$->JRNL.CGCNT=0;

   5911  5 003221   000004 450100                    STZ     4,,PR0

     1001     5912    2         J$->JRNL.UTS=0;

   5912  5 003222   000005 450100                    STZ     5,,PR0

     1002     5913    2         J$->JRNL.RENAME.L=0;

   5913  5 003223   000000 236003                    LDQ     0,DU
         5 003224   000022 552140                    STBQ    18,'40'O,PR0

     1003     5914    2         RETURN;

   5914  5 003225   200030 221300                    LDX1  ! EVENT+1,,AUTO
         5 003226   000001 702211                    TSX2  ! 1,X1

     1004     5915    2   NODCB: ALTRETURN;

   5915  5 003227   200030 221300       NODCB        LDX1  ! EVENT+1,,AUTO
         5 003230   000000 702211                    TSX2  ! 0,X1

     1005     5916    2   END GETJDCB;
     1006     5917
     1007     5918
     1008     5919
     1009     5920
     1010     5921    1   CLSCG: PROC ALTRET;

   5921  5 003231   200032 741300       CLSCG        STX1  ! @NAME+1,,AUTO

     1011     5922
     1012     5923    2         IF CG$->CG.JRNL$ ~= ADDR(NIL) THEN

   5923  5 003232   200005 470500                    LDP0    CG$,,AUTO
         5 003233   000003 236100                    LDQ     3,,PR0
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:159  
         5 003234   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 003235   003242 600000 5                  TZE     s:5925

     1013     5924    2            CG$->CG.JRNL$->JRNL.CGCNT=CG$->CG.JRNL$->JRNL.CGCNT-1;

   5924  5 003236   000003 471500                    LDP1    3,,PR0
         5 003237   100004 235100                    LDA     4,,PR1
         5 003240   000001 135007                    SBLA    1,DL
         5 003241   100004 755100                    STA     4,,PR1

     1014     5925    2         CG_CLS.V.DCB#=CG$->CG.DCB#;

   5925  5 003242   000002 720100                    LXL0    2,,PR0
         5 003243   000556 740000 1                  STX0    CG_CLS+26

     1015     5926    2         CALL M$CLOSE (CG_CLS) ALTRET(DACT1);

   5926  5 003244   000524 630400 1                  EPPR0   CG_CLS
         5 003245   450001 713400                    CLIMB   alt,close
         5 003246   406000 401760                    pmme    nvectors=13
         5 003247   003250 702000 5                  TSX2    DACT1

     1016     5927    2   DACT1: REL_DCB.V.DCB#=CG$->CG.DCB#;

   5927  5 003250   200005 470500       DACT1        LDP0    CG$,,AUTO
         5 003251   000002 720100                    LXL0    2,,PR0
         5 003252   000256 740000 1                  STX0    REL_DCB+2

     1017     5928    2         CALL M$RELDCB (REL_DCB);

   5928  5 003253   000254 630400 1                  EPPR0   REL_DCB
         5 003254   060003 713400                    CLIMB   24579
         5 003255   400000 401760                    pmme    nvectors=1

     1018     5929    2         CALL FREECG;

   5929  5 003256   004452 701000 5                  TSX1    FREECG
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:160  
         5 003257   000000 011000                    NOP     0

     1019     5930    2         RETURN;

   5930  5 003260   200032 221300                    LDX1  ! @NAME+1,,AUTO
         5 003261   000001 702211                    TSX2  ! 1,X1

     1020     5931    2   END CLSCG;
     1021     5932    1   CHKCG: PROC;

   5932  5 003262   200030 741300       CHKCG        STX1  ! EVENT+1,,AUTO

     1022     5933    2   CHKCG1: CG$=CGACTIVE$;

   5933  5 003263   200007 236100       CHKCG1       LDQ     CGACTIVE$,,AUTO
         5 003264   200005 756100                    STQ     CG$,,AUTO

     1023     5934    3         DO WHILE (CG$ ~= ADDR(NIL));

   5934  5 003265   003301 710000 5                  TRA     s:5942

     1024     5935    3            IF CG$->CG.JRNL$ = J$ THEN

   5935  5 003266   200005 470500                    LDP0    CG$,,AUTO
         5 003267   000003 236100                    LDQ     3,,PR0
         5 003270   200010 116100                    CMPQ    J$,,AUTO
         5 003271   003277 601000 5                  TNZ     s:5941

     1025     5936    4            DO;

     1026     5937    4               CALL CLSCGMSG;

   5937  5 003272   003771 701000 5                  TSX1    CLSCGMSG
         5 003273   000000 011000                    NOP     0

     1027     5938    4               CALL CLSCG;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:161  
   5938  5 003274   003231 701000 5                  TSX1    CLSCG
         5 003275   000000 011000                    NOP     0

     1028     5939    4               GOTO CHKCG1;

   5939  5 003276   003263 710000 5                  TRA     CHKCG1

     1029     5940    4               END;
     1030     5941    3            CG$=CG$->CG.LNK$;

   5941  5 003277   000000 236100                    LDQ     0,,PR0
         5 003300   200005 756100                    STQ     CG$,,AUTO

     1031     5942    3            END;

   5942  5 003301   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 003302   003266 601000 5                  TNZ     s:5935

     1032     5943    2         RETURN;

   5943  5 003303   200030 221300                    LDX1  ! EVENT+1,,AUTO
         5 003304   000001 702211                    TSX2  ! 1,X1

     1033     5944    2   END CHKCG;
     1034     5945
     1035     5946    1   CHKJRNLS: PROC;

   5946  5 003305   200030 741300       CHKJRNLS     STX1  ! EVENT+1,,AUTO

     1036     5947    2   CHK:  J$=JRNLACTIVE$;

   5947  5 003306   200012 236100       CHK          LDQ     JRNLACTIVE$,,AUTO
         5 003307   200010 756100                    STQ     J$,,AUTO

     1037     5948    3         DO WHILE (J$ ~= ADDR(NIL));

   5948  5 003310   003341 710000 5                  TRA     s:5960
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:162  

     1038     5949    3            IF PINCRW(CFU$,J$->JRNL.CFU)->FM$CFU.USECNT = 1 AND

   5949  5 003311   200010 470500                    LDP0    J$,,AUTO
         5 003312   000002 720100                    LXL0    2,,PR0
         5 003313   001446 471400 1                  LDP1    CFU$
         5 003314   100003 721110                    LXL1    3,X0,PR1
         5 003315   000001 101003                    CMPX1   1,DU
         5 003316   003336 601000 5                  TNZ     s:5959
         5 003317   000004 235100                    LDA     4,,PR0
         5 003320   003336 601000 5                  TNZ     s:5959

     1039     5950    3               J$->JRNL.CGCNT = 0 THEN
     1040     5951    4               IF J$->JRNL.UTS = 0 THEN DO;

   5951  5 003321   000005 235100                    LDA     5,,PR0
         5 003322   003333 601000 5                  TNZ     s:5956

     1041     5952    4                  CG_TIME.TSTAMP_=VECTOR(J$->JRNL.UTS);

   5952  5 003323   777640 235007                    LDA     -96,DL
         5 003324   200010 236100                    LDQ     J$,,AUTO
         5 003325   000005 036003                    ADLQ    5,DU
         5 003326   001442 757000 1                  STAQ    CG_TIME+8

     1042     5953    4                  CALL M$TIME (CG_TIME);

   5953  5 003327   001432 630400 1                  EPPR0   CG_TIME
         5 003330   020004 713400                    CLIMB   8196
         5 003331   402000 401760                    pmme    nvectors=5

     1043     5954    4                  END;

   5954  5 003332   003336 710000 5                  TRA     s:5959

     1044     5955    4               ELSE DO;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:163  
     1045     5956    4                  CALL CLSJRNL;

   5956  5 003333   003345 701000 5                  TSX1    CLSJRNL
         5 003334   000000 011000                    NOP     0

     1046     5957    4                  GOTO CHK;

   5957  5 003335   003306 710000 5                  TRA     CHK

     1047     5958    4                  END;
     1048     5959    3            J$=J$->JRNL.LNK$;

   5959  5 003336   200010 470500                    LDP0    J$,,AUTO
         5 003337   000000 236100                    LDQ     0,,PR0
         5 003340   200010 756100                    STQ     J$,,AUTO

     1049     5960    3            END;

   5960  5 003341   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 003342   003311 601000 5                  TNZ     s:5949

     1050     5961    2         RETURN;

   5961  5 003343   200030 221300                    LDX1  ! EVENT+1,,AUTO
         5 003344   000001 702211                    TSX2  ! 1,X1

     1051     5962    2   END CHKJRNLS;
     1052     5963
     1053     5964    1   CLSJRNL: PROC;

   5964  5 003345   200032 741300       CLSJRNL      STX1  ! @NAME+1,,AUTO

     1054     5965    2         CLS_JRNL.V.DCB#=J$->JRNL.DCB#;

   5965  5 003346   200010 470500                    LDP0    J$,,AUTO
         5 003347   000001 720100                    LXL0    1,,PR0
         5 003350   001014 740000 1                  STX0    CLS_JRNL+26
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:164  

     1055     5966    2         IF J$->JRNL.ATTR$ = ADDR(NIL) THEN

   5966  5 003351   000032 236100                    LDQ     26,,PR0
         5 003352   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 003353   003357 601000 5                  TNZ     s:5969

     1056     5967    2            CLS_JRNL.UATTR_=VECTOR(NIL);

   5967  5 003354   000030 237000 6                  LDAQ    24
         5 003355   001000 757000 1                  STAQ    CLS_JRNL+14
         5 003356   003364 710000 5                  TRA     s:5970

     1057     5968    2         ELSE
     1058     5969    2            CLS_JRNL.UATTR_=VECTOR(J$->JRNL.ATTR$->JATTR);

   5969  5 003357   000032 471500                    LDP1    26,,PR0
         5 003360   000032 235000 6                  LDA     26
         5 003361   200040 451500                    STP1    P$+2,,AUTO
         5 003362   200040 236100                    LDQ     P$+2,,AUTO
         5 003363   001000 757000 1                  STAQ    CLS_JRNL+14

     1059     5970    2         CALL M$CLOSE (CLS_JRNL) ALTRET(CLSJ1);

   5970  5 003364   000762 630400 1                  EPPR0   CLS_JRNL
         5 003365   450001 713400                    CLIMB   alt,close
         5 003366   406000 401760                    pmme    nvectors=13
         5 003367   003370 702000 5                  TSX2    CLSJ1

     1060     5971    2   CLSJ1:
     1061     5972    3         IF (J$->JRNL.ASN = %TAPE#) THEN DO;

   5972  5 003370   200010 470500       CLSJ1        LDP0    J$,,AUTO
         5 003371   000003 235100                    LDA     3,,PR0
         5 003372   000002 115007                    CMPA    2,DL
         5 003373   003407 601000 5                  TNZ     s:5977

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:165  
     1062     5973    3            RESTAP.NN# = 1;

   5973  5 003374   000001 236007                    LDQ     1,DL
         5 003375   001324 756000 1                  STQ     RESTAP

     1063     5974    3            RESTAP.PRLIST.RNAME#(0) = DCBADDR(J$->JRNL.DCB#)->F$DCB.RES#;

   5974  5 003376   000012 471400 6                  LDP1    10
         5 003377   100000 473500                    LDP3    0,,PR1
         5 003400   000001 720100                    LXL0    1,,PR0
         5 003401   300000 474510                    LDP4    0,X0,PR3
         5 003402   400026 236100                    LDQ     22,,PR4
         5 003403   001326 756000 1                  STQ     RESTAP+2

     1064     5975    3            CALL M$RELRES (RELTAP);

   5975  5 003404   001270 630400 1                  EPPR0   RELTAP
         5 003405   150003 713400                    CLIMB   53251
         5 003406   402400 401760                    pmme    nvectors=6

     1065     5976    3            END;

     1066     5977    2         REL_DCB.V.DCB#=J$->JRNL.DCB#;

   5977  5 003407   200010 470500                    LDP0    J$,,AUTO
         5 003410   000001 720100                    LXL0    1,,PR0
         5 003411   000256 740000 1                  STX0    REL_DCB+2

     1067     5978    2         CALL M$RELDCB (REL_DCB) ALTRET(CLSJ2);

   5978  5 003412   000254 630400 1                  EPPR0   REL_DCB
         5 003413   460003 713400                    CLIMB   alt,+24579
         5 003414   400000 401760                    pmme    nvectors=1
         5 003415   003416 702000 5                  TSX2    CLSJ2

     1068     5979    2   CLSJ2: CALL FREEJRNL;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:166  
   5979  5 003416   004605 701000 5     CLSJ2        TSX1    FREEJRNL
         5 003417   000000 011000                    NOP     0

     1069     5980    2         RETURN;

   5980  5 003420   200032 221300                    LDX1  ! @NAME+1,,AUTO
         5 003421   000001 702211                    TSX2  ! 1,X1

     1070     5981    2   END;
     1071     5982
     1072     5983    1   WRBERC: PROC ALTRET;

   5983  5 003422   200030 741300       WRBERC       STX1  ! EVENT+1,,AUTO

     1073     5984    3         IF CG$ ~= ADDR(NIL) THEN DO;

   5984  5 003423   200005 236100                    LDQ     CG$,,AUTO
         5 003424   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 003425   003460 600000 5                  TZE     s:5995

     1074     5985    3            BERC.TYPE=T#CFID;

   5985  5 003426   000000 470400 1                  LDP0    JRNL$
         5 003427   004000 236003                    LDQ     2048,DU
         5 003430   000001 552140                    STBQ    1,'40'O,PR0

     1075     5986    3            BERC.DCB#=CG$->CG.HISDCB;

   5986  5 003431   200005 471500                    LDP1    CG$,,AUTO
         5 003432   100005 720100                    LXL0    5,,PR1
         5 003433   000001 440100                    SXL0    1,,PR0

     1076     5987    3            BERC.USER#=CG$->CG.HISUSER#;

   5987  5 003434   100006 236100                    LDQ     6,,PR1
         5 003435   000022 736000                    QLS     18
         5 003436   000001 552120                    STBQ    1,'20'O,PR0
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:167  

     1077     5988    3            CG_TIME.TSTAMP_=VECTOR(BERC.TIME);

   5988  5 003437   777640 235007                    LDA     -96,DL
         5 003440   000000 236000 1                  LDQ     JRNL$
         5 003441   001442 757000 1                  STAQ    CG_TIME+8

     1078     5989    3            CALL M$TIME (CG_TIME);

   5989  5 003442   001432 630400 1                  EPPR0   CG_TIME
         5 003443   020004 713400                    CLIMB   8196
         5 003444   402000 401760                    pmme    nvectors=5

     1079     5990    3            WR_CG_JRNL.BUF_=VECTOR(BERC);

   5990  5 003445   000007 235000 6                  LDA     7
         5 003446   000000 236000 1                  LDQ     JRNL$
         5 003447   000752 757000 1                  STAQ    WR_CG_JRNL+4

     1080     5991    3            WR_CG_JRNL.V.DCB#=CG$->CG.JRNL$->JRNL.DCB#;

   5991  5 003450   200005 470500                    LDP0    CG$,,AUTO
         5 003451   000003 471500                    LDP1    3,,PR0
         5 003452   100001 720100                    LXL0    1,,PR1
         5 003453   000756 740000 1                  STX0    WR_CG_JRNL+8

     1081     5992
     1082     5993    3            CALL M$WRITE (WR_CG_JRNL) ALTRET(WRBERC1);

   5993  5 003454   000746 630400 1                  EPPR0   WR_CG_JRNL
         5 003455   440001 713400                    CLIMB   alt,write
         5 003456   401400 401760                    pmme    nvectors=4
         5 003457   003462 702000 5                  TSX2    WRBERC1

     1083     5994    3            END;

     1084     5995    2         RETURN;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:168  

   5995  5 003460   200030 221300                    LDX1  ! EVENT+1,,AUTO
         5 003461   000001 702211                    TSX2  ! 1,X1

     1085     5996    2   WRBERC1: ALTRETURN;

   5996  5 003462   200030 221300       WRBERC1      LDX1  ! EVENT+1,,AUTO
         5 003463   000000 702211                    TSX2  ! 0,X1

     1086     5997    2   END;
     1087     5998
     1088     5999        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:169  
     1089     6000        /* Open the journal file described by comgroup info                   */
     1090     6001    1   OPN_CG_JRNL: PROC ALTRET;

   6001  5 003464   200030 741300       OPN_CG_JRNL  STX1  ! EVENT+1,,AUTO

     1091     6002
     1092     6003    2         CALL HISACCN (BUF$->JRNOPN.ACCN,BUF$->JRNOPN.UNAME,BUF$->JRNOPN.FACCN,

   6003  5 003465   004156 236000 1                  LDQ     BUF$
         5 003466   000012 036003                    ADLQ    10,DU
         5 003467   200036 756100                    STQ     I$+1,,AUTO
         5 003470   004156 236000 1                  LDQ     BUF$
         5 003471   000010 036003                    ADLQ    8,DU
         5 003472   200035 756100                    STQ     @HISNAME+1,,AUTO
         5 003473   004156 236000 1                  LDQ     BUF$
         5 003474   000005 036003                    ADLQ    5,DU
         5 003475   200034 756100                    STQ     @HISACCN+1,,AUTO
         5 003476   004156 236000 1                  LDQ     BUF$
         5 003477   000003 036003                    ADLQ    3,DU
         5 003500   200033 756100                    STQ     @ACCN+1,,AUTO
         5 003501   004276 701000 5                  TSX1    HISACCN
         5 003502   000000 011000                    NOP     0

     1093     6004    2            BUF$->JRNOPN.PRIV);
     1094     6005    2         OPN_JRNL.V.RES#='DP  ';

   6005  5 003503   000006 236000 3                  LDQ     NOTOWNER+5
         5 003504   000632 756000 1                  STQ     OPN_JRNL+40

     1095     6006    2         CG_SN.SN#(0)=J$->JRNL.PSN;

   6006  5 003505   200010 470500                    LDP0    J$,,AUTO
         5 003506   040000 100500                    MLR     fill='040'O
         5 003507   000006 000006                    ADSC9   6,,PR0                   cn=0,n=6
         5 003510   000507 000006 1                  ADSC9   CG_SN+1                  cn=0,n=6

     1096     6007    2         CALL TESTOPEN ALTRET(TESTERR);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:170  

   6007  5 003511   004351 701000 5                  TSX1    TESTOPEN
         5 003512   003734 702000 5                  TSX2    TESTERR

     1097     6008    2         F$=ADDR(JRNL_FIT);

   6008  5 003513   000013 236000 6                  LDQ     11
         5 003514   006157 756000 1                  STQ     F$

     1098     6009    2         CALL XSF$LOCCODP (F$,11) ALTRET(NOSN);

   6009  5 003515   000014 630400 6                  EPPR0   12
         5 003516   000020 631400 xsym               EPPR1   B_VECTNIL+16
         5 003517   000000 701000 xent               TSX1    XSF$LOCCODP
         5 003520   003725 702000 5                  TSX2    NOSN

     1099     6010    2         F$=PINCRW(F$,-1);

   6010  5 003521   006157 236000 1                  LDQ     F$
         5 003522   777777 036003                    ADLQ    -1,DU
         5 003523   006157 756000 1                  STQ     F$

     1100     6011    2         IF F$->JATTR.Q.ID ~= ATTR_.Q.ID THEN

   6011  5 003524   006157 470400 1                  LDP0    F$
         5 003525   000001 220100                    LDX0    1,,PR0
         5 003526   001427 100000 1                  CMPX0   ATTR_+1
         5 003527   003725 601000 5                  TNZ     NOSN

     1101     6012    2            GOTO NOSN;
     1102     6013    2         IF F$->JATTR.Q.ASN ~= J$->JRNL.ASN THEN

   6013  5 003530   200010 471500                    LDP1    J$,,AUTO
         5 003531   000001 236100                    LDQ     1,,PR0
         5 003532   000011 772000                    QRL     9
         5 003533   000777 376007                    ANQ     511,DL
         5 003534   100003 116100                    CMPQ    3,,PR1
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:171  
         5 003535   003722 601000 5                  TNZ     NOT_SAME_ASN

     1103     6014    2            GOTO NOT_SAME_ASN;
     1104     6015    3         IF J$->JRNL.ASN = %TAPE# THEN DO;

   6015  5 003536   100003 235100                    LDA     3,,PR1
         5 003537   000002 115007                    CMPA    2,DL
         5 003540   003660 601000 5                  TNZ     OPNJRNL

     1105     6016    3   GSNSP:   SNSZ=POFFC(PINCRC(SN_V.P$,SN_V.BND+1),CURSN$)-SIZEC(JATTR)+4;

   6016  5 003541   001456 236000 1     GSNSP        LDQ     SN_V
         5 003542   000020 772000                    QRL     16
         5 003543   000020 736000                    QLS     16
         5 003544   200000 036007                    ADLQ    65536,DL
         5 003545   001457 036000 1                  ADLQ    SN_V+1
         5 003546   000020 772000                    QRL     16
         5 003547   200040 756100                    STQ     P$+2,,AUTO
         5 003550   001447 236000 1                  LDQ     CURSN$
         5 003551   000020 772000                    QRL     16
         5 003552   200041 756100                    STQ     P$+3,,AUTO
         5 003553   200040 236100                    LDQ     P$+2,,AUTO
         5 003554   200041 136100                    SBLQ    P$+3,,AUTO
         5 003555   000010 136007                    SBLQ    8,DL
         5 003556   003461 756000 1                  STQ     SNSZ

     1106     6017    4            IF SNSZ > (F$->JATTR.Q.NUM#*6+3)/4+4 THEN DO;

   6017  5 003557   006157 470400 1                  LDP0    F$
         5 003560   000002 236100                    LDQ     2,,PR0
         5 003561   000006 402007                    MPY     6,DL
         5 003562   000003 036007                    ADLQ    3,DL
         5 003563   000002 772000                    QRL     2
         5 003564   000004 036007                    ADLQ    4,DL
         5 003565   003461 116000 1                  CMPQ    SNSZ
         5 003566   003574 603000 5                  TRC     s:6021

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:172  
     1107     6018    4               CALL M$GDS (GDS_SN) ALTRET(OPNJERR);

   6018  5 003567   001162 630400 1                  EPPR0   GDS_SN
         5 003570   430001 713400                    CLIMB   alt,gds
         5 003571   400400 401760                    pmme    nvectors=2
         5 003572   003715 702000 5                  TSX2    OPNJERR

     1108     6019    4               GOTO GSNSP;

   6019  5 003573   003541 710000 5                  TRA     GSNSP

     1109     6020    4               END;
     1110     6021    3            J$->JRNL.ATTR$=CURSN$;

   6021  5 003574   001447 236000 1                  LDQ     CURSN$
         5 003575   200010 471500                    LDP1    J$,,AUTO
         5 003576   100032 756100                    STQ     26,,PR1

     1111     6022    3            JSN$->P$$=J$;

   6022  5 003577   200010 236100                    LDQ     J$,,AUTO
         5 003600   200003 470500                    LDP0    JSN$,,AUTO
         5 003601   000000 756100                    STQ     0,,PR0

     1112     6023    3            JSN$=PINCRW(CURSN$,(F$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR));

   6023  5 003602   006157 473400 1                  LDP3    F$
         5 003603   300002 236100                    LDQ     2,,PR3
         5 003604   000006 402007                    MPY     6,DL
         5 003605   000003 036007                    ADLQ    3,DL
         5 003606   000002 772000                    QRL     2
         5 003607   000022 736000                    QLS     18
         5 003610   000003 036003                    ADLQ    3,DU
         5 003611   001447 036000 1                  ADLQ    CURSN$
         5 003612   200003 756100                    STQ     JSN$,,AUTO

     1113     6024    3            J$->JRNL.ATTR$->JATTR = F$->JATTR;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:173  

   6024  5 003613   100032 470500                    LDP0    26,,PR1
         5 003614   000100 100500                    MLR     fill='000'O
         5 003615   300000 000014                    ADSC9   0,,PR3                   cn=0,n=12
         5 003616   000000 000014                    ADSC9   0,,PR0                   cn=0,n=12

     1114     6025    3            SNSZ=F$->JATTR.Q.NUM#*6+4;

   6025  5 003617   006157 470400 1                  LDP0    F$
         5 003620   000002 236100                    LDQ     2,,PR0
         5 003621   000006 402007                    MPY     6,DL
         5 003622   000004 036007                    ADLQ    4,DL
         5 003623   003461 756000 1                  STQ     SNSZ

     1115     6026    3            CURSN$=ADDR(J$->JRNL.ATTR$->JATTR.Q.NUM#);

   6026  5 003624   100032 473500                    LDP3    26,,PR1
         5 003625   300002 634500                    EPPR4   2,,PR3
         5 003626   001447 454400 1                  STP4    CURSN$

     1116     6027    3            CURSN$->DUMMY_SN=ADDR(F$->JATTR.Q.NUM#)->DUMMY_SN;

   6027  5 003627   000000 620006                    EAX0    0,QL
         5 003630   003461 721000 1                  LXL1    SNSZ
         5 003631   040140 100540                    MLR     fill='040'O
         5 003632   000002 000010                    ADSC9   2,,PR0                   cn=0,n=*X0
         5 003633   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1

     1117     6028    3   SETSN_:
     1118     6029    3            OPN_JRNL.SN_=VECTOR(ADDR(J$->JRNL.ATTR$->JATTR.Q.NUM#)->DUMMY_SN);

   6029  5 003634   100032 470500       SETSN_       LDP0    26,,PR1
         5 003635   003461 235000 1                  LDA     SNSZ
         5 003636   000020 735000                    ALS     16
         5 003637   000140 135007                    SBLA    96,DL
         5 003640   200040 450500                    STP0    P$+2,,AUTO
         5 003641   200040 236100                    LDQ     P$+2,,AUTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:174  
         5 003642   000002 036003                    ADLQ    2,DU
         5 003643   000564 757000 1                  STAQ    OPN_JRNL+2

     1119     6030    3            OPN_JRNL.V.RES# = 'MT  ';

   6030  5 003644   000007 236000 3                  LDQ     NOTOWNER+6
         5 003645   000632 756000 1                  STQ     OPN_JRNL+40

     1120     6031    3            OPN_JRNL.V.VOL#=J$->JRNL.ATTR$->JATTR.Q.VOL#;

   6031  5 003646   100032 470500                    LDP0    26,,PR1
         5 003647   000001 236100                    LDQ     1,,PR0
         5 003650   000033 736000                    QLS     27
         5 003651   000643 552040 1                  STBQ    OPN_JRNL+49,'40'O

     1121     6032    3            IF J$->JRNL.ATTR$->JATTR.Q.VOL# = 0 THEN

   6032  5 003652   100032 470500                    LDP0    26,,PR1
         5 003653   000001 236100                    LDQ     1,,PR0
         5 003654   000777 316007                    CANQ    511,DL
         5 003655   003660 601000 5                  TNZ     OPNJRNL

     1122     6033    3               J$->JRNL.ATTR$->JATTR.Q.VOL# = 1;

   6033  5 003656   000001 236007                    LDQ     1,DL
         5 003657   000001 552104                    STBQ    1,'04'O,PR0

     1123     6034    3            END;

   6033  5 003660                       OPNJRNL      null
     1124     6035
     1125     6036    2   OPNJRNL:;
     1126     6037
     1127     6038    2         OPN_JRNL.V.DCB# = J$->JRNL.DCB#;

   6038  5 003660   200010 470500                    LDP0    J$,,AUTO
         5 003661   000001 720100                    LXL0    1,,PR0
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:175  
         5 003662   000626 740000 1                  STX0    OPN_JRNL+36

     1128     6039    2         OPN_JRNL.NAME_=VECTOR(J$->JRNL.NAME);

   6039  5 003663   000010 235000 6                  LDA     8
         5 003664   200010 236100                    LDQ     J$,,AUTO
         5 003665   000010 036003                    ADLQ    8,DU
         5 003666   000570 757000 1                  STAQ    OPN_JRNL+6

     1129     6040    2         OPN_JRNL.ACCT_=VECTOR(J$->JRNL.ACCT);

   6040  5 003667   000007 235000 6                  LDA     7
         5 003670   200010 236100                    LDQ     J$,,AUTO
         5 003671   000020 036003                    ADLQ    16,DU
         5 003672   000606 757000 1                  STAQ    OPN_JRNL+20

     1130     6041    2         OPN_JRNL.V.ASN#=J$->JRNL.ASN;

   6041  5 003673   000003 236100                    LDQ     3,,PR0
         5 003674   000627 552004 1                  STBQ    OPN_JRNL+37,'04'O

     1131     6042    2         CALL M$OPEN (OPN_JRNL) ALTRET(OPNJERR);

   6042  5 003675   000562 630400 1                  EPPR0   OPN_JRNL
         5 003676   450000 713400                    CLIMB   alt,open
         5 003677   410400 401760                    pmme    nvectors=18
         5 003700   003715 702000 5                  TSX2    OPNJERR

     1132     6043    2         J$->JRNL.CFU=ADDR(DCBADDR(J$->JRNL.DCB#)->F$DCB.CFU$)->BPTR.OFFSET;

   6043  5 003701   000012 470400 6                  LDP0    10
         5 003702   000000 471500                    LDP1    0,,PR0
         5 003703   200010 473500                    LDP3    J$,,AUTO
         5 003704   300001 720100                    LXL0    1,,PR3
         5 003705   100000 474510                    LDP4    0,X0,PR1
         5 003706   400066 236100                    LDQ     54,,PR4
         5 003707   000022 772000                    QRL     18
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:176  
         5 003710   300002 756100                    STQ     2,,PR3

     1133     6044    2         CALL MYACCN;

   6044  5 003711   004333 701000 5                  TSX1    MYACCN
         5 003712   000000 011000                    NOP     0

     1134     6045    2         RETURN;

   6045  5 003713   200030 221300                    LDX1  ! EVENT+1,,AUTO
         5 003714   000001 702211                    TSX2  ! 1,X1

     1135     6046
     1136     6047    2   OPNJERR: OPN_ANSWER.ERR=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   6047  5 003715   000000 470400 xsym  OPNJERR      LDP0    B$TCB$
         5 003716   000000 471500                    LDP1    0,,PR0
         5 003717   100102 236100                    LDQ     66,,PR1
         5 003720   000017 756000 1                  STQ     OPN_ANSWER

     1137     6048    2         GOTO ALTX;

   6048  5 003721   003753 710000 5                  TRA     ALTX

     1138     6049
     1139     6050    2   NOT_SAME_ASN: OPN_ANSWER.ERR=ASNERR;

   6050  5 003722   003462 236000 1     NOT_SAME_ASN LDQ     ASNERR
         5 003723   000017 756000 1                  STQ     OPN_ANSWER

     1140     6051    2         GOTO ALTX;

   6051  5 003724   003753 710000 5                  TRA     ALTX

     1141     6052
     1142     6053    2   NOSN: IF J$->JRNL.ASN = %FILE# THEN

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:177  
   6053  5 003725   200010 470500       NOSN         LDP0    J$,,AUTO
         5 003726   000003 235100                    LDA     3,,PR0
         5 003727   000001 115007                    CMPA    1,DL
         5 003730   003660 600000 5                  TZE     OPNJRNL

     1143     6054    2            GOTO OPNJRNL;
     1144     6055    2         OPN_ANSWER.ERR=NOSNERR;

   6055  5 003731   003463 236000 1                  LDQ     NOSNERR
         5 003732   000017 756000 1                  STQ     OPN_ANSWER

     1145     6056    2         GOTO ALTX;

   6056  5 003733   003753 710000 5                  TRA     ALTX

     1146     6057    2   TESTERR: IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$NOFILE THEN

   6057  5 003734   000000 470400 xsym  TESTERR      LDP0    B$TCB$
         5 003735   000000 471500                    LDP1    0,,PR0
         5 003736   100102 236100                    LDQ     66,,PR1
         5 003737   377770 376007                    ANQ     131064,DL
         5 003740   001610 116007                    CMPQ    904,DL
         5 003741   003770 601000 5                  TNZ     s:6067

     1147     6058    2            IF J$->JRNL.ASN = %TAPE# AND

   6058  5 003742   200010 473500                    LDP3    J$,,AUTO
         5 003743   300003 235100                    LDA     3,,PR3
         5 003744   000002 115007                    CMPA    2,DL
         5 003745   003770 601000 5                  TNZ     s:6067
         5 003746   300032 474500                    LDP4    26,,PR3
         5 003747   400002 235100                    LDA     2,,PR4
         5 003750   003770 601000 5                  TNZ     s:6067

     1148     6059    3               J$->JRNL.ATTR$->JATTR.Q.NUM# = 0 THEN DO;

     1149     6060    3               OPN_ANSWER.ERR=NOSNERR;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:178  

   6060  5 003751   003463 236000 1                  LDQ     NOSNERR
         5 003752   000017 756000 1                  STQ     OPN_ANSWER

     1150     6061    3   ALTX:       B$JIT$->B$JIT.ACCN=ACCN;

   6061  5 003753   000000 470400 xsym  ALTX         LDP0    B$JIT$
         5 003754   040100 100500                    MLR     fill='040'O
         5 003755   200017 000010                    ADSC9   ACCN,,AUTO               cn=0,n=8
         5 003756   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8

     1151     6062    3               B$JIT$->B$JIT.UNAME=NAME;

   6062  5 003757   040100 100500                    MLR     fill='040'O
         5 003760   200021 000014                    ADSC9   NAME,,AUTO               cn=0,n=12
         5 003761   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12

     1152     6063    3               B$JIT$->B$JIT.FACCN=FACCN;

   6063  5 003762   200024 237100                    LDAQ    FACCN,,AUTO
         5 003763   000006 757100                    STAQ    6,,PR0

     1153     6064    3               B$JIT$->B$JIT.PRIV.ACTIVE=PRIV;

   6064  5 003764   200026 236100                    LDQ     PRIV,,AUTO
         5 003765   000013 756100                    STQ     11,,PR0

     1154     6065    3               ALTRETURN;

   6065  5 003766   200030 221300                    LDX1  ! EVENT+1,,AUTO
         5 003767   000000 702211                    TSX2  ! 0,X1

     1155     6066    3               END;
     1156     6067    2         GOTO OPNJRNL;

   6067  5 003770   003660 710000 5                  TRA     OPNJRNL

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:179  
     1157     6068    2   END;
     1158     6069        %EJECT;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:180  
     1159     6070
     1160     6071    1   CLSCGMSG: PROC;

   6071  5 003771   200032 741300       CLSCGMSG     STX1  ! @NAME+1,,AUTO

     1161     6072
     1162     6073    2   DCL I UBIN;
     1163     6074
     1164     6075    2         CALL INDEX (I,' ',CG$->CG.ID.ACCT#);

   6075  5 003772   200005 470500                    LDP0    CG$,,AUTO
         5 003773   000000 124500                    SCM     mask='000'O
         5 003774   000007 000010                    ADSC9   7,,PR0                   cn=0,n=8
         5 003775   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         5 003776   200033 000100                    ARG     I,,AUTO

     1165     6076    2         CALL CONCAT (OCBUF,' ERROR JOURNALING COMGROUP ',

   6076  5 003777   000013 236100                    LDQ     11,,PR0
         5 004000   000033 772000                    QRL     27
         5 004001   040000 100400                    MLR     fill='040'O
         5 004002   000035 000033 3                  ADSC9   NOTOWNER+28              cn=0,n=27
         5 004003   003471 000033 1                  ADSC9   OCBUF                    cn=0,n=27
         5 004004   000000 620006                    EAX0    0,QL
         5 004005   040000 100540                    MLR     fill='040'O
         5 004006   000013 200010                    ADSC9   11,,PR0                  cn=1,n=*X0
         5 004007   003477 600111 1                  ADSC9   OCBUF+6                  cn=3,n=73
         5 004010   000111 116007                    CMPQ    73,DL
         5 004011   004045 603000 5                  TRC     s:6081
         5 004012   777666 620006                    EAX0    -74,QL
         5 004013   777777 660003                    ERX0    -1,DU
         5 004014   040046 100400                    MLR     fill='040'O
         5 004015   000033 000001 6                  ADSC9   27                       cn=0,n=1
         5 004016   003477 600010 1                  ADSC9   OCBUF+6,Q                cn=3,n=*X0
         5 004017   000110 116007                    CMPQ    72,DL
         5 004020   004045 603000 5                  TRC     s:6081
         5 004021   777667 620006                    EAX0    -73,QL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:181  
         5 004022   777777 660003                    ERX0    -1,DU
         5 004023   200033 722100                    LXL2    I,,AUTO
         5 004024   040046 100540                    MLR     fill='040'O
         5 004025   000007 000012                    ADSC9   7,,PR0                   cn=0,n=*X2
         5 004026   003500 000010 1                  ADSC9   OCBUF+7,Q                cn=0,n=*X0
         5 004027   000000 620006                    EAX0    0,QL
         5 004030   200033 036100                    ADLQ    I,,AUTO
         5 004031   000110 116007                    CMPQ    72,DL
         5 004032   004045 603000 5                  TRC     s:6081
         5 004033   200040 756100                    STQ     P$+2,,AUTO
         5 004034   000000 636010                    EAQ     0,X0
         5 004035   000022 772000                    QRL     18
         5 004036   200033 036100                    ADLQ    I,,AUTO
         5 004037   200040 720100                    LXL0    P$+2,,AUTO
         5 004040   777667 620010                    EAX0    -73,X0
         5 004041   777777 660003                    ERX0    -1,DU
         5 004042   040046 100400                    MLR     fill='040'O
         5 004043   000044 000033 3                  ADSC9   NOTOWNER+35              cn=0,n=27
         5 004044   003500 000010 1                  ADSC9   OCBUF+7,Q                cn=0,n=*X0

     1166     6077    2            SUBSTR(CG$->CG.ID.NAME#.TXT,0,CG$->CG.ID.NAME#.CNT),
     1167     6078    2            '.',
     1168     6079    2            SUBSTR(CG$->CG.ID.ACCT#,0,I),
     1169     6080    2            '; DISCONTINUED JOURNALING.@');
     1170     6081    2         CALL INDEX (I,'@',OCBUF);

   6081  5 004045   000000 124400                    SCM     mask='000'O
         5 004046   003471 000144 1                  ADSC9   OCBUF                    cn=0,n=100
         5 004047   000034 000001 6                  ADSC9   28                       cn=0,n=1
         5 004050   200033 000100                    ARG     I,,AUTO

     1171     6082    2         OCMSG.MESS_.BOUND=I-1;

   6082  5 004051   200033 236100                    LDQ     I,,AUTO
         5 004052   000001 136007                    SBLQ    1,DL
         5 004053   000020 736000                    QLS     16
         5 004054   001340 676000 1                  ERQ     OCMSG+2
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:182  
         5 004055   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 004056   001340 656000 1                  ERSQ    OCMSG+2

     1172     6083    2         OCMSG.MESS_.BUF$=ADDR(OCBUF);

   6083  5 004057   000035 236000 6                  LDQ     29
         5 004060   001341 756000 1                  STQ     OCMSG+3

     1173     6084    2         CALL M$KEYIN (OCMSG) ALTRET(OCERR1);

   6084  5 004061   001336 630400 1                  EPPR0   OCMSG
         5 004062   520000 713400                    CLIMB   alt,+40960
         5 004063   401400 401760                    pmme    nvectors=4
         5 004064   004065 702000 5                  TSX2    OCERR1

     1174     6085    2   OCERR1: RETURN;

   6085  5 004065   200032 221300       OCERR1       LDX1  ! @NAME+1,,AUTO
         5 004066   000001 702211                    TSX2  ! 1,X1

     1175     6086    2   END;
     1176     6087
     1177     6088    1   CLSJMSG: PROC;

   6088  5 004067   200030 741300       CLSJMSG      STX1  ! EVENT+1,,AUTO

     1178     6089
     1179     6090    2   DCL I UBIN;
     1180     6091
     1181     6092    2         CALL INDEX (I,' ',J$->JRNL.ACCT);

   6092  5 004070   200010 470500                    LDP0    J$,,AUTO
         5 004071   000000 124500                    SCM     mask='000'O
         5 004072   000020 000010                    ADSC9   16,,PR0                  cn=0,n=8
         5 004073   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         5 004074   200031 000100                    ARG     I,,AUTO

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:183  
     1182     6093    2         CALL CONCAT (OCBUF,' ERROR ON JOURNAL FILE ',

   6093  5 004075   000010 236100                    LDQ     8,,PR0
         5 004076   000033 772000                    QRL     27
         5 004077   040000 100400                    MLR     fill='040'O
         5 004100   000053 000027 3                  ADSC9   NOTOWNER+42              cn=0,n=23
         5 004101   003471 000027 1                  ADSC9   OCBUF                    cn=0,n=23
         5 004102   000000 620006                    EAX0    0,QL
         5 004103   040000 100540                    MLR     fill='040'O
         5 004104   000010 200010                    ADSC9   8,,PR0                   cn=1,n=*X0
         5 004105   003476 600115 1                  ADSC9   OCBUF+5                  cn=3,n=77
         5 004106   000115 116007                    CMPQ    77,DL
         5 004107   004143 603000 5                  TRC     s:6098
         5 004110   777662 620006                    EAX0    -78,QL
         5 004111   777777 660003                    ERX0    -1,DU
         5 004112   040046 100400                    MLR     fill='040'O
         5 004113   000033 000001 6                  ADSC9   27                       cn=0,n=1
         5 004114   003476 600010 1                  ADSC9   OCBUF+5,Q                cn=3,n=*X0
         5 004115   000114 116007                    CMPQ    76,DL
         5 004116   004143 603000 5                  TRC     s:6098
         5 004117   777663 620006                    EAX0    -77,QL
         5 004120   777777 660003                    ERX0    -1,DU
         5 004121   200031 722100                    LXL2    I,,AUTO
         5 004122   040046 100540                    MLR     fill='040'O
         5 004123   000020 000012                    ADSC9   16,,PR0                  cn=0,n=*X2
         5 004124   003477 000010 1                  ADSC9   OCBUF+6,Q                cn=0,n=*X0
         5 004125   000000 620006                    EAX0    0,QL
         5 004126   200031 036100                    ADLQ    I,,AUTO
         5 004127   000114 116007                    CMPQ    76,DL
         5 004130   004143 603000 5                  TRC     s:6098
         5 004131   200040 756100                    STQ     P$+2,,AUTO
         5 004132   000000 636010                    EAQ     0,X0
         5 004133   000022 772000                    QRL     18
         5 004134   200031 036100                    ADLQ    I,,AUTO
         5 004135   200040 720100                    LXL0    P$+2,,AUTO
         5 004136   777663 620010                    EAX0    -77,X0
         5 004137   777777 660003                    ERX0    -1,DU
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:184  
         5 004140   040046 100400                    MLR     fill='040'O
         5 004141   000034 000001 6                  ADSC9   28                       cn=0,n=1
         5 004142   003477 000010 1                  ADSC9   OCBUF+6,Q                cn=0,n=*X0

     1183     6094    2            SUBSTR(J$->JRNL.NAME.TXT,0,J$->JRNL.NAME.L),
     1184     6095    2            '.',
     1185     6096    2            SUBSTR(J$->JRNL.ACCT,0,I),
     1186     6097    2            '@');
     1187     6098    2         CALL INDEX (I,'@',OCBUF);

   6098  5 004143   000000 124400                    SCM     mask='000'O
         5 004144   003471 000144 1                  ADSC9   OCBUF                    cn=0,n=100
         5 004145   000034 000001 6                  ADSC9   28                       cn=0,n=1
         5 004146   200031 000100                    ARG     I,,AUTO

     1188     6099    2         OCMSG.MESS_.BUF$=ADDR(OCBUF);

   6099  5 004147   000035 236000 6                  LDQ     29
         5 004150   001341 756000 1                  STQ     OCMSG+3

     1189     6100    2         OCMSG.MESS_.BOUND=I-1;

   6100  5 004151   200031 236100                    LDQ     I,,AUTO
         5 004152   000001 136007                    SBLQ    1,DL
         5 004153   000020 736000                    QLS     16
         5 004154   001340 676000 1                  ERQ     OCMSG+2
         5 004155   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 004156   001340 656000 1                  ERSQ    OCMSG+2

     1190     6101    2         CALL M$KEYIN (OCMSG) ALTRET(JOC1);

   6101  5 004157   001336 630400 1                  EPPR0   OCMSG
         5 004160   520000 713400                    CLIMB   alt,+40960
         5 004161   401400 401760                    pmme    nvectors=4
         5 004162   004163 702000 5                  TSX2    JOC1

     1191     6102    2   JOC1: RETURN;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:185  

   6102  5 004163   200030 221300       JOC1         LDX1  ! EVENT+1,,AUTO
         5 004164   000001 702211                    TSX2  ! 1,X1

     1192     6103    2   END;
     1193     6104
     1194     6105    1   ERRMSG: PROC (CODE,DCB#);

   6105  5 004165   200030 741300       ERRMSG       STX1  ! EVENT+1,,AUTO

     1195     6106
     1196     6107    2   DCL CODE UBIN;
     1197     6108    2   DCL DCB# UBIN;
     1198     6109    2         ERRMSG.CODE_=VECTOR(CODE);

   6109  5 004166   777640 235007                    LDA     -96,DL
         5 004167   200031 236100                    LDQ     @CODE,,AUTO
         5 004170   001356 757000 1                  STAQ    ERRMSG+2

     1199     6110    2         ERRMSG.V.DCB# = DCB#;

   6110  5 004171   200032 470500                    LDP0    @DCB#,,AUTO
         5 004172   000000 720100                    LXL0    0,,PR0
         5 004173   001402 740000 1                  STX0    ERRMSG+22

     1200     6111    2         CALL M$ERRMSG (ERRMSG) ALTRET(JOC2);

   6111  5 004174   001354 630400 1                  EPPR0   ERRMSG
         5 004175   420000 713400                    CLIMB   alt,+8192
         5 004176   405000 401760                    pmme    nvectors=11
         5 004177   004231 702000 5                  TSX2    JOC2

     1201     6112    2         IF ERRSLT.RECCNT = 0 THEN

   6112  5 004200   001406 236000 1                  LDQ     ERRSLT
         5 004201   000777 316007                    CANQ    511,DL
         5 004202   004205 601000 5                  TNZ     s:6114
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:186  

     1202     6113    2            RETURN;

   6113  5 004203   200030 221300                    LDX1  ! EVENT+1,,AUTO
         5 004204   000001 702211                    TSX2  ! 1,X1

     1203     6114    3         DO I = 0 TO ERRSLT.RECCNT;

   6114  5 004205   200013 450100                    STZ     I,,AUTO
         5 004206   004225 710000 5                  TRA     s:6117+3

     1204     6115    3            OCMSG.MESS_=VECTOR(OCERRBUF(I));

   6115  5 004207   000036 235000 6                  LDA     30
         5 004210   200013 236100                    LDQ     I,,AUTO
         5 004211   200040 755100                    STA     P$+2,,AUTO
         5 004212   000036 402003                    MPY     30,DU
         5 004213   000037 036000 6                  ADLQ    31
         5 004214   200040 235100                    LDA     P$+2,,AUTO
         5 004215   001340 757000 1                  STAQ    OCMSG+2

     1205     6116    3            CALL M$KEYIN (OCMSG) ALTRET(JOC2);

   6116  5 004216   001336 630400 1                  EPPR0   OCMSG
         5 004217   520000 713400                    CLIMB   alt,+40960
         5 004220   401400 401760                    pmme    nvectors=4
         5 004221   004231 702000 5                  TSX2    JOC2

     1206     6117    3            END;

   6117  5 004222   200013 235100                    LDA     I,,AUTO
         5 004223   000001 035007                    ADLA    1,DL
         5 004224   200013 755100                    STA     I,,AUTO
         5 004225   001406 236000 1                  LDQ     ERRSLT
         5 004226   000777 376007                    ANQ     511,DL
         5 004227   200013 116100                    CMPQ    I,,AUTO
         5 004230   004207 603000 5                  TRC     s:6115
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:187  

     1207     6118    2   JOC2: RETURN;

   6118  5 004231   200030 221300       JOC2         LDX1  ! EVENT+1,,AUTO
         5 004232   000001 702211                    TSX2  ! 1,X1

     1208     6119    2   END;
     1209     6120
     1210     6121    1   LOCJRNL: PROC (NAME,ACCN) ALTRET;

   6121  5 004233   200030 741300       LOCJRNL      STX1  ! EVENT+1,,AUTO

     1211     6122
     1212     6123    2   DCL 1 NAME,
     1213     6124    2         2 L# UBIN(9) UNAL,
     1214     6125    2         2 TXT CHAR(31);
     1215     6126    2   DCL ACCN CHAR(8);
     1216     6127
     1217     6128    2         J$=JRNLACTIVE$;

   6128  5 004234   200012 236100                    LDQ     JRNLACTIVE$,,AUTO
         5 004235   200010 756100                    STQ     J$,,AUTO

     1218     6129    3         DO WHILE (J$ ~= ADDR(NIL));

   6129  5 004236   004272 710000 5                  TRA     s:6135

     1219     6130    3            JNAME.L#=J$->JRNL.NAME.L;

   6130  5 004237   200010 470500                    LDP0    J$,,AUTO
         5 004240   000010 236100                    LDQ     8,,PR0
         5 004241   001414 552040 1                  STBQ    JNAME,'40'O

     1220     6131    3            IF J$->JRNL.ACCT = ACCN AND J$->JRNL.NAME.L = NAME.L# AND

   6131  5 004242   200032 471500                    LDP1    @ACCN,,AUTO
         5 004243   040100 106500                    CMPC    fill='040'O
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:188  
         5 004244   000020 000010                    ADSC9   16,,PR0                  cn=0,n=8
         5 004245   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         5 004246   004270 601000 5                  TNZ     s:6134
         5 004247   200031 473500                    LDP3    @NAME,,AUTO
         5 004250   000100 101500                    MRL     fill='000'O
         5 004251   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         5 004252   200040 000004                    ADSC9   P$+2,,AUTO               cn=0,n=4
         5 004253   000010 236100                    LDQ     8,,PR0
         5 004254   000033 772000                    QRL     27
         5 004255   200040 116100                    CMPQ    P$+2,,AUTO
         5 004256   004270 601000 5                  TNZ     s:6134
         5 004257   001414 236000 1                  LDQ     JNAME
         5 004260   000033 772000                    QRL     27
         5 004261   000000 620006                    EAX0    0,QL
         5 004262   040100 106540                    CMPC    fill='040'O
         5 004263   000010 200010                    ADSC9   8,,PR0                   cn=1,n=*X0
         5 004264   300000 200037                    ADSC9   0,,PR3                   cn=1,n=31
         5 004265   004270 601000 5                  TNZ     s:6134

     1221     6132    3               ADDR(J$->JRNL.NAME.TXT)->JN = NAME.TXT THEN
     1222     6133    3               RETURN;

   6133  5 004266   200030 221300                    LDX1  ! EVENT+1,,AUTO
         5 004267   000001 702211                    TSX2  ! 1,X1

     1223     6134    3            J$=J$->JRNL.LNK$;

   6134  5 004270   000000 236100                    LDQ     0,,PR0
         5 004271   200010 756100                    STQ     J$,,AUTO

     1224     6135    3            END;

   6135  5 004272   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 004273   004237 601000 5                  TNZ     s:6130

     1225     6136    2         ALTRETURN;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:189  
   6136  5 004274   200030 221300                    LDX1  ! EVENT+1,,AUTO
         5 004275   000000 702211                    TSX2  ! 0,X1

     1226     6137    2   END;
     1227     6138
     1228     6139
     1229     6140
     1230     6141    1   HISACCN: PROC (HISACCN,HISNAME,HISFACCN,HISPRIV);

   6141  5 004276   200032 741300       HISACCN      STX1  ! @ACCN,,AUTO

     1231     6142    2   DCL HISACCN CHAR(8);
     1232     6143    2   DCL HISNAME CHAR(12);
     1233     6144    2   DCL HISFACCN CHAR(8);
     1234     6145    2   DCL HISPRIV BIT(36) ALIGNED;
     1235     6146
     1236     6147    2         ACCN=B$JIT.ACCN;

   6147  5 004277   000000 470400 xsym               LDP0    B$JIT$
         5 004300   040100 100500                    MLR     fill='040'O
         5 004301   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         5 004302   200017 000010                    ADSC9   ACCN,,AUTO               cn=0,n=8

     1237     6148    2         NAME=B$JIT.UNAME;

   6148  5 004303   040100 100500                    MLR     fill='040'O
         5 004304   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12
         5 004305   200021 000014                    ADSC9   NAME,,AUTO               cn=0,n=12

     1238     6149    2         FACCN=B$JIT.FACCN;

   6149  5 004306   000006 237100                    LDAQ    6,,PR0
         5 004307   200024 757100                    STAQ    FACCN,,AUTO

     1239     6150    2         PRIV=B$JIT.PRIV.ACTIVE;

   6150  5 004310   000013 236100                    LDQ     11,,PR0
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:190  
         5 004311   200026 756100                    STQ     PRIV,,AUTO

     1240     6151    2         B$JIT.ACCN=HISACCN;

   6151  5 004312   200033 471500                    LDP1    @HISACCN,,AUTO
         5 004313   040100 100500                    MLR     fill='040'O
         5 004314   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         5 004315   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8

     1241     6152    2         B$JIT.UNAME=HISNAME;

   6152  5 004316   200034 473500                    LDP3    @HISNAME,,AUTO
         5 004317   040100 100500                    MLR     fill='040'O
         5 004320   300000 000014                    ADSC9   0,,PR3                   cn=0,n=12
         5 004321   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12

     1242     6153    2         B$JIT.FACCN=HISFACCN;

   6153  5 004322   200035 474500                    LDP4    @HISFACCN,,AUTO
         5 004323   040100 100500                    MLR     fill='040'O
         5 004324   400000 000010                    ADSC9   0,,PR4                   cn=0,n=8
         5 004325   000006 000010                    ADSC9   6,,PR0                   cn=0,n=8

     1243     6154    2         B$JIT.PRIV.ACTIVE=HISPRIV;

   6154  5 004326   200036 475500                    LDP5    @HISPRIV,,AUTO
         5 004327   500000 236100                    LDQ     0,,PR5
         5 004330   000013 756100                    STQ     11,,PR0

     1244     6155    2         RETURN;

   6155  5 004331   200032 221300                    LDX1  ! @ACCN,,AUTO
         5 004332   000001 702211                    TSX2  ! 1,X1

     1245     6156    2   END;
     1246     6157
     1247     6158
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:191  
     1248     6159
     1249     6160    1   MYACCN: PROC;

   6160  5 004333   200032 741300       MYACCN       STX1  ! @ACCN,,AUTO

     1250     6161    2         B$JIT.ACCN=ACCN;

   6161  5 004334   000000 470400 xsym               LDP0    B$JIT$
         5 004335   040100 100500                    MLR     fill='040'O
         5 004336   200017 000010                    ADSC9   ACCN,,AUTO               cn=0,n=8
         5 004337   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8

     1251     6162    2         B$JIT.UNAME=NAME;

   6162  5 004340   040100 100500                    MLR     fill='040'O
         5 004341   200021 000014                    ADSC9   NAME,,AUTO               cn=0,n=12
         5 004342   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12

     1252     6163    2         B$JIT.FACCN=FACCN;

   6163  5 004343   200024 237100                    LDAQ    FACCN,,AUTO
         5 004344   000006 757100                    STAQ    6,,PR0

     1253     6164    2         B$JIT.PRIV.ACTIVE=PRIV;

   6164  5 004345   200026 236100                    LDQ     PRIV,,AUTO
         5 004346   000013 756100                    STQ     11,,PR0

     1254     6165    2         RETURN;

   6165  5 004347   200032 221300                    LDX1  ! @ACCN,,AUTO
         5 004350   000001 702211                    TSX2  ! 1,X1

     1255     6166    2   END MYACCN;
     1256     6167
     1257     6168
     1258     6169    1   TESTOPEN: PROC ALTRET;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:192  

   6169  5 004351   200032 741300       TESTOPEN     STX1  ! @ACCN,,AUTO

     1259     6170
     1260     6171    2         TOPN_JRNL.NAME_=VECTOR(J$->JRNL.NAME);

   6171  5 004352   000010 235000 6                  LDA     8
         5 004353   200010 236100                    LDQ     J$,,AUTO
         5 004354   000010 036003                    ADLQ    8,DU
         5 004355   000662 757000 1                  STAQ    TOPN_JRNL+6

     1261     6172    2         TOPN_JRNL.ACCT_=VECTOR(J$->JRNL.ACCT);

   6172  5 004356   000007 235000 6                  LDA     7
         5 004357   200010 236100                    LDQ     J$,,AUTO
         5 004360   000020 036003                    ADLQ    16,DU
         5 004361   000700 757000 1                  STAQ    TOPN_JRNL+20

     1262     6173    2         CG_SN.SN#(0)=J$->JRNL.PSN;

   6173  5 004362   200010 470500                    LDP0    J$,,AUTO
         5 004363   040000 100500                    MLR     fill='040'O
         5 004364   000006 000006                    ADSC9   6,,PR0                   cn=0,n=6
         5 004365   000507 000006 1                  ADSC9   CG_SN+1                  cn=0,n=6

     1263     6174    2         GOTO COMMON;

   6174  5 004366   004404 710000 5                  TRA     COMMON

     1264     6175
     1265     6176    2   TESTOPENCG: ENTRY ALTRET;

   6176  5 004367   200032 741300       TESTOPENCG   STX1  ! @ACCN,,AUTO

     1266     6177
     1267     6178    2         TOPN_JRNL.NAME_=VECTOR(J$->CG.ID.NAME#);

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:193  
   6178  5 004370   000010 235000 6                  LDA     8
         5 004371   200010 236100                    LDQ     J$,,AUTO
         5 004372   000013 036003                    ADLQ    11,DU
         5 004373   000662 757000 1                  STAQ    TOPN_JRNL+6

     1268     6179    2         TOPN_JRNL.ACCT_=VECTOR(J$->CG.ID.ACCT#);

   6179  5 004374   000007 235000 6                  LDA     7
         5 004375   200010 236100                    LDQ     J$,,AUTO
         5 004376   000007 036003                    ADLQ    7,DU
         5 004377   000700 757000 1                  STAQ    TOPN_JRNL+20

     1269     6180    2         CG_SN.SN#(0)=J$->CG.ID.PSN#;

   6180  5 004400   200010 470500                    LDP0    J$,,AUTO
         5 004401   040000 100500                    MLR     fill='040'O
         5 004402   000011 000006                    ADSC9   9,,PR0                   cn=0,n=6
         5 004403   000507 000006 1                  ADSC9   CG_SN+1                  cn=0,n=6

     1270     6181
     1271     6182    2   COMMON:
     1272     6183    2         CALL M$GETDCB (GET_JRNL_DCB) ALTRET(TSTERR1);

   6183  5 004404   000244 630400 1     COMMON       EPPR0   GET_JRNL_DCB
         5 004405   460002 713400                    CLIMB   alt,+24578
         5 004406   401000 401760                    pmme    nvectors=3
         5 004407   004437 702000 5                  TSX2    TSTERR1

     1273     6184    2         REL_DCB.V.DCB#=XDCB;

   6184  5 004410   004007 720000 1                  LXL0    XDCB
         5 004411   000256 740000 1                  STX0    REL_DCB+2

     1274     6185    2         TOPN_JRNL.V.DCB#=XDCB;

   6185  5 004412   000720 740000 1                  STX0    TOPN_JRNL+36

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:194  
     1275     6186    2         CALL M$OPEN (TOPN_JRNL) ALTRET(TSTERR);

   6186  5 004413   000654 630400 1                  EPPR0   TOPN_JRNL
         5 004414   450000 713400                    CLIMB   alt,open
         5 004415   410400 401760                    pmme    nvectors=18
         5 004416   004434 702000 5                  TSX2    TSTERR

     1276     6187    2         DELFFLG=DCBADDR(XDCB)->F$DCB.FFLG.DELF#;

   6187  5 004417   000012 470400 6                  LDP0    10
         5 004420   000000 471500                    LDP1    0,,PR0
         5 004421   004007 720000 1                  LXL0    XDCB
         5 004422   100000 473510                    LDP3    0,X0,PR1
         5 004423   300004 236100                    LDQ     4,,PR3
         5 004424   000004 736000                    QLS     4
         5 004425   400000 376003                    ANQ     -131072,DU
         5 004426   200015 756100                    STQ     DELFFLG,,AUTO

     1277     6188    2         CALL M$RELDCB (REL_DCB);

   6188  5 004427   000254 630400 1                  EPPR0   REL_DCB
         5 004430   060003 713400                    CLIMB   24579
         5 004431   400000 401760                    pmme    nvectors=1

     1278     6189    2         RETURN;

   6189  5 004432   200032 221300                    LDX1  ! @ACCN,,AUTO
         5 004433   000001 702211                    TSX2  ! 1,X1

     1279     6190    2   TSTERR: CALL M$RELDCB (REL_DCB);

   6190  5 004434   000254 630400 1     TSTERR       EPPR0   REL_DCB
         5 004435   060003 713400                    CLIMB   24579
         5 004436   400000 401760                    pmme    nvectors=1

     1280     6191    2   TSTERR1: ALTRETURN;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:195  
   6191  5 004437   200032 221300       TSTERR1      LDX1  ! @ACCN,,AUTO
         5 004440   000000 702211                    TSX2  ! 0,X1

     1281     6192    2   END TESTOPEN;
     1282     6193
     1283     6194
     1284     6195    1   FREEEV: PROC;

   6195  5 004441   200030 741300       FREEEV       STX1  ! EVENT+1,,AUTO

     1285     6196
     1286     6197    3         DO INHIBIT;

     1287     6198    3            FJ_EV.LNK(EVENT)=FJ_EVFREE;

   6198  5 004442   200027 236300                    LDQ   ! EVENT,,AUTO
         5 004443   000011 402207                    MPY   ! 9,DL
         5 004444   000000 235200 xsym               LDA   ! FJ_EVFREE
         5 004445   000000 755206 xsym               STA   ! FJ_EV,QL

     1288     6199    3            FJ_EVFREE=EVENT;

   6199  5 004446   200027 235300                    LDA   ! EVENT,,AUTO
         5 004447   000000 755200 xsym               STA   ! FJ_EVFREE

     1289     6200    3            RETURN;

   6200  5 004450   000001 702211                    TSX2  ! 1,X1

     1290     6201    3            END;

     1291     6202    2   END FREEEV;

   6202  5 004451   000001 702211                    TSX2  ! 1,X1

     1292     6203        /**/
     1293     6204    1   FREECG: PROC;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:196  

   6204  5 004452   200034 741300       FREECG       STX1  ! @HISNAME,,AUTO

     1294     6205    2   DCL I$ PTR;
     1295     6206    2   DCL P$ PTR;
     1296     6207
     1297     6208    2         I$=CGACTIVE$;

   6208  5 004453   200007 236100                    LDQ     CGACTIVE$,,AUTO
         5 004454   200035 756100                    STQ     I$,,AUTO

     1298     6209    2         P$=ADDR(NIL);

   6209  5 004455   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 004456   200036 756100                    STQ     P$,,AUTO

     1299     6210    3         DO WHILE (I$ ~= CG$ AND I$ ~= I$->CG.LNK$);

   6210  5 004457   004465 710000 5                  TRA     s:6213

     1300     6211    3            P$=I$;

   6211  5 004460   200035 236100                    LDQ     I$,,AUTO
         5 004461   200036 756100                    STQ     P$,,AUTO

     1301     6212    3            I$=I$->CG.LNK$;

   6212  5 004462   200035 470500                    LDP0    I$,,AUTO
         5 004463   000000 236100                    LDQ     0,,PR0
         5 004464   200035 756100                    STQ     I$,,AUTO

     1302     6213    3            END;

   6213  5 004465   200035 236100                    LDQ     I$,,AUTO
         5 004466   200005 116100                    CMPQ    CG$,,AUTO
         5 004467   004473 600000 5                  TZE     s:6214
         5 004470   200035 470500                    LDP0    I$,,AUTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:197  
         5 004471   000000 116100                    CMPQ    0,,PR0
         5 004472   004460 601000 5                  TNZ     s:6211

     1303     6214    2         IF P$ ~= ADDR(NIL) THEN

   6214  5 004473   200036 236100                    LDQ     P$,,AUTO
         5 004474   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 004475   004503 600000 5                  TZE     s:6217

     1304     6215    2            P$->CG.LNK$=I$->CG.LNK$;

   6215  5 004476   200035 470500                    LDP0    I$,,AUTO
         5 004477   000000 236100                    LDQ     0,,PR0
         5 004500   200036 471500                    LDP1    P$,,AUTO
         5 004501   100000 756100                    STQ     0,,PR1
         5 004502   004506 710000 5                  TRA     s:6218

     1305     6216    2         ELSE
     1306     6217    2            CGACTIVE$=I$->CG.LNK$;

   6217  5 004503   200035 470500                    LDP0    I$,,AUTO
         5 004504   000000 236100                    LDQ     0,,PR0
         5 004505   200007 756100                    STQ     CGACTIVE$,,AUTO

     1307     6218    2         VLP_RPSN.NN#=1;

   6218  5 004506   000001 235007                    LDA     1,DL
         5 004507   001312 755000 1                  STA     VLP_RPSN

     1308     6219    2         VLP_RPSN.RPLIST.PSN#(0)=CG$->CG.ID.PSN#;

   6219  5 004510   200005 471500                    LDP1    CG$,,AUTO
         5 004511   040000 100500                    MLR     fill='040'O
         5 004512   100011 000006                    ADSC9   9,,PR1                   cn=0,n=6
         5 004513   001314 000006 1                  ADSC9   VLP_RPSN+2               cn=0,n=6

     1309     6220    2         CALL M$RELRES (RELRES) ALTRET(RELCG1);
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:198  

   6220  5 004514   001246 630400 1                  EPPR0   RELRES
         5 004515   550003 713400                    CLIMB   alt,+53251
         5 004516   402400 401760                    pmme    nvectors=6
         5 004517   004520 702000 5                  TSX2    RELCG1

     1310     6221    2   RELCG1: CG$->CG.LNK$=CGFREE$;

   6221  5 004520   200006 236100       RELCG1       LDQ     CGFREE$,,AUTO
         5 004521   200005 470500                    LDP0    CG$,,AUTO
         5 004522   000000 756100                    STQ     0,,PR0

     1311     6222    2         CGFREE$=CG$;

   6222  5 004523   200005 236100                    LDQ     CG$,,AUTO
         5 004524   200006 756100                    STQ     CGFREE$,,AUTO

     1312     6223    2         CG$=ADDR(NIL);

   6223  5 004525   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 004526   200005 756100                    STQ     CG$,,AUTO

     1313     6224    3         IF CGACTIVE$ = ADDR(NIL) AND CG_V.BND > 4095 THEN DO;

   6224  5 004527   200007 236100                    LDQ     CGACTIVE$,,AUTO
         5 004530   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 004531   004603 601000 5                  TNZ     s:6238
         5 004532   001450 236000 1                  LDQ     CG_V
         5 004533   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 004534   002000 116003                    CMPQ    1024,DU
         5 004535   004603 602000 5                  TNC     s:6238

     1314     6225    3            GDS_CG.V.SEGSIZE#=(CG_V.BND+1)/4;

   6225  5 004536   001450 236000 1                  LDQ     CG_V
         5 004537   000020 772000                    QRL     16
         5 004540   000001 036007                    ADLQ    1,DL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:199  
         5 004541   000002 772000                    QRL     2
         5 004542   000000 620006                    EAX0    0,QL
         5 004543   001144 440000 1                  SXL0    GDS_CG+4

     1315     6226    3            CALL M$FDS (GDS_CG);

   6226  5 004544   001140 630400 1                  EPPR0   GDS_CG
         5 004545   030002 713400                    CLIMB   fds
         5 004546   400400 401760                    pmme    nvectors=2

     1316     6227    3            GDS_CG.V.SEGSIZE#=1024;

   6227  5 004547   002000 220003                    LDX0    1024,DU
         5 004550   001144 440000 1                  SXL0    GDS_CG+4

     1317     6228    3            CALL M$GDS (GDS_CG);

   6228  5 004551   001140 630400 1                  EPPR0   GDS_CG
         5 004552   030001 713400                    CLIMB   gds
         5 004553   400400 401760                    pmme    nvectors=2

     1318     6229    3            CGFREE$=CG_V.P$;

   6229  5 004554   001451 236000 1                  LDQ     CG_V+1
         5 004555   200006 756100                    STQ     CGFREE$,,AUTO

     1319     6230    3            CG$=CGFREE$;

   6230  5 004556   200005 756100                    STQ     CG$,,AUTO

     1320     6231    4            DO WHILE ( PINCRW(CG$,SIZEW(CG)) < PINCRC(CG_V.P$,CG_V.BND+1));

   6231  5 004557   004566 710000 5                  TRA     s:6235

     1321     6232    4               C$=CG$;

   6232  5 004560   200005 236100                    LDQ     CG$,,AUTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:200  
         5 004561   200004 756100                    STQ     C$,,AUTO

     1322     6233    4               CG$->CG.LNK$=PINCRW(CG$,SIZEW(CG));

   6233  5 004562   000423 036003                    ADLQ    275,DU
         5 004563   200005 470500                    LDP0    CG$,,AUTO
         5 004564   000000 756100                    STQ     0,,PR0

     1323     6234    4               CG$=CG$->CG.LNK$;

   6234  5 004565   200005 756100                    STQ     CG$,,AUTO

     1324     6235    4               END;

   6235  5 004566   001450 236000 1                  LDQ     CG_V
         5 004567   000020 772000                    QRL     16
         5 004570   000020 736000                    QLS     16
         5 004571   200000 036007                    ADLQ    65536,DL
         5 004572   001451 036000 1                  ADLQ    CG_V+1
         5 004573   200040 756100                    STQ     P$+2,,AUTO
         5 004574   200005 236100                    LDQ     CG$,,AUTO
         5 004575   000423 036003                    ADLQ    275,DU
         5 004576   200040 116100                    CMPQ    P$+2,,AUTO
         5 004577   004560 602000 5                  TNC     s:6232

     1325     6236    3            C$->CG.LNK$=ADDR(NIL);

   6236  5 004600   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 004601   200004 470500                    LDP0    C$,,AUTO
         5 004602   000000 756100                    STQ     0,,PR0

     1326     6237    3            END;

     1327     6238    2         RETURN;

   6238  5 004603   200034 221300                    LDX1  ! @HISNAME,,AUTO
         5 004604   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:201  

     1328     6239    2   END FREECG;
     1329     6240    1   FREEJRNL: PROC;

   6240  5 004605   200034 741300       FREEJRNL     STX1  ! @HISNAME,,AUTO

     1330     6241    2   DCL I$ PTR;
     1331     6242    2   DCL P$ PTR;
     1332     6243
     1333     6244    3         IF J$->JRNL.ATTR$ ~= ADDR(NIL) THEN DO;

   6244  5 004606   200010 470500                    LDP0    J$,,AUTO
         5 004607   000032 236100                    LDQ     26,,PR0
         5 004610   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 004611   004701 600000 5                  TZE     s:6260

     1334     6245    3            I$=J$->JRNL.ATTR$;

   6245  5 004612   200035 756100                    STQ     I$,,AUTO

     1335     6246    3            P$=I$;

   6246  5 004613   200036 756100                    STQ     P$,,AUTO

     1336     6247    3   FREEATTR: P$=PINCRW(P$,(I$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR)+1);

   6247  5 004614   200035 470500       FREEATTR     LDP0    I$,,AUTO
         5 004615   000002 236100                    LDQ     2,,PR0
         5 004616   000006 402007                    MPY     6,DL
         5 004617   000003 036007                    ADLQ    3,DL
         5 004620   000002 772000                    QRL     2
         5 004621   000022 736000                    QLS     18
         5 004622   000004 036003                    ADLQ    4,DU
         5 004623   200036 036100                    ADLQ    P$,,AUTO
         5 004624   200036 756100                    STQ     P$,,AUTO

     1337     6248    4            IF POFFW(JSN$,P$) > 0 THEN DO;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:202  

   6248  5 004625   200036 235100                    LDA     P$,,AUTO
         5 004626   000022 771000                    ARL     18
         5 004627   200040 755100                    STA     P$+2,,AUTO
         5 004630   200003 236100                    LDQ     JSN$,,AUTO
         5 004631   000022 772000                    QRL     18
         5 004632   200040 136100                    SBLQ    P$+2,,AUTO
         5 004633   004676 604400 5                  TMOZ    s:6258

     1338     6249    4               C$=PINCRW(P$,(P$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR)+1);

   6249  5 004634   200036 471500                    LDP1    P$,,AUTO
         5 004635   100002 236100                    LDQ     2,,PR1
         5 004636   000006 402007                    MPY     6,DL
         5 004637   000003 036007                    ADLQ    3,DL
         5 004640   000002 772000                    QRL     2
         5 004641   000022 736000                    QLS     18
         5 004642   000004 036003                    ADLQ    4,DU
         5 004643   200036 036100                    ADLQ    P$,,AUTO
         5 004644   200004 756100                    STQ     C$,,AUTO

     1339     6250    4               SNSZ=SIZEC(JATTR)+P$->JATTR.Q.NUM#*6;

   6250  5 004645   100002 236100                    LDQ     2,,PR1
         5 004646   000006 402007                    MPY     6,DL
         5 004647   000014 036007                    ADLQ    12,DL
         5 004650   003461 756000 1                  STQ     SNSZ

     1340     6251    4               I$->DUMMY_SN=P$->DUMMY_SN;

   6251  5 004651   000000 620006                    EAX0    0,QL
         5 004652   003461 721000 1                  LXL1    SNSZ
         5 004653   040140 100540                    MLR     fill='040'O
         5 004654   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         5 004655   000000 000011                    ADSC9   0,,PR0                   cn=0,n=*X1

     1341     6252    4               PINCRW(I$,-1)->P$$=PINCRW(P$,-1)->P$$;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:203  

   6252  5 004656   177777 236100                    LDQ     -1,,PR1
         5 004657   077777 756100                    STQ     -1,,PR0

     1342     6253    4               PINCRW(I$,-1)->P$$->JRNL.ATTR$=I$;

   6253  5 004660   077777 473500                    LDP3    -1,,PR0
         5 004661   200035 236100                    LDQ     I$,,AUTO
         5 004662   300032 756100                    STQ     26,,PR3

     1343     6254    4               I$=PINCRW(I$,(I$->JATTR.Q.NUM#*6+3)/4+SIZEW(JATTR)+1);

   6254  5 004663   000002 236100                    LDQ     2,,PR0
         5 004664   000006 402007                    MPY     6,DL
         5 004665   000003 036007                    ADLQ    3,DL
         5 004666   000002 772000                    QRL     2
         5 004667   000022 736000                    QLS     18
         5 004670   000004 036003                    ADLQ    4,DU
         5 004671   200035 036100                    ADLQ    I$,,AUTO
         5 004672   200035 756100                    STQ     I$,,AUTO

     1344     6255    4               P$=C$;

   6255  5 004673   200004 236100                    LDQ     C$,,AUTO
         5 004674   200036 756100                    STQ     P$,,AUTO

     1345     6256    4               GOTO FREEATTR;

   6256  5 004675   004614 710000 5                  TRA     FREEATTR

     1346     6257    4               END;
     1347     6258    3            JSN$=PINCRW(I$,-1);

   6258  5 004676   200035 236100                    LDQ     I$,,AUTO
         5 004677   777777 036003                    ADLQ    -1,DU
         5 004700   200003 756100                    STQ     JSN$,,AUTO

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:204  
     1348     6259    3            END;

     1349     6260    2         I$=JRNLACTIVE$;

   6260  5 004701   200012 236100                    LDQ     JRNLACTIVE$,,AUTO
         5 004702   200035 756100                    STQ     I$,,AUTO

     1350     6261    2         P$=ADDR(NIL);

   6261  5 004703   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 004704   200036 756100                    STQ     P$,,AUTO

     1351     6262    3         DO WHILE (I$ ~= J$ AND I$ ~= I$->JRNL.LNK$);

   6262  5 004705   004713 710000 5                  TRA     s:6265

     1352     6263    3            P$=I$;

   6263  5 004706   200035 236100                    LDQ     I$,,AUTO
         5 004707   200036 756100                    STQ     P$,,AUTO

     1353     6264    3            I$=I$->JRNL.LNK$;

   6264  5 004710   200035 470500                    LDP0    I$,,AUTO
         5 004711   000000 236100                    LDQ     0,,PR0
         5 004712   200035 756100                    STQ     I$,,AUTO

     1354     6265    3            END;

   6265  5 004713   200035 236100                    LDQ     I$,,AUTO
         5 004714   200010 116100                    CMPQ    J$,,AUTO
         5 004715   004721 600000 5                  TZE     s:6266
         5 004716   200035 470500                    LDP0    I$,,AUTO
         5 004717   000000 116100                    CMPQ    0,,PR0
         5 004720   004706 601000 5                  TNZ     s:6263

     1355     6266    2         IF P$ ~= ADDR(NIL) THEN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:205  

   6266  5 004721   200036 236100                    LDQ     P$,,AUTO
         5 004722   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 004723   004731 600000 5                  TZE     s:6269

     1356     6267    2            P$->JRNL.LNK$=I$->JRNL.LNK$;

   6267  5 004724   200035 470500                    LDP0    I$,,AUTO
         5 004725   000000 236100                    LDQ     0,,PR0
         5 004726   200036 471500                    LDP1    P$,,AUTO
         5 004727   100000 756100                    STQ     0,,PR1
         5 004730   004734 710000 5                  TRA     s:6270

     1357     6268    2         ELSE
     1358     6269    2            JRNLACTIVE$=I$->JRNL.LNK$;

   6269  5 004731   200035 470500                    LDP0    I$,,AUTO
         5 004732   000000 236100                    LDQ     0,,PR0
         5 004733   200012 756100                    STQ     JRNLACTIVE$,,AUTO

     1359     6270    2         VLP_RPSN.NN#=1;

   6270  5 004734   000001 235007                    LDA     1,DL
         5 004735   001312 755000 1                  STA     VLP_RPSN

     1360     6271    2         VLP_RPSN.RPLIST.PSN#(0)=J$->JRNL.PSN;

   6271  5 004736   200010 471500                    LDP1    J$,,AUTO
         5 004737   040000 100500                    MLR     fill='040'O
         5 004740   100006 000006                    ADSC9   6,,PR1                   cn=0,n=6
         5 004741   001314 000006 1                  ADSC9   VLP_RPSN+2               cn=0,n=6

     1361     6272    2         CALL M$RELRES (RELRES) ALTRET(RELJ1);

   6272  5 004742   001246 630400 1                  EPPR0   RELRES
         5 004743   550003 713400                    CLIMB   alt,+53251
         5 004744   402400 401760                    pmme    nvectors=6
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:206  
         5 004745   004746 702000 5                  TSX2    RELJ1

     1362     6273    2   RELJ1: J$->JRNL.LNK$=JRNLFREE$;

   6273  5 004746   200011 236100       RELJ1        LDQ     JRNLFREE$,,AUTO
         5 004747   200010 470500                    LDP0    J$,,AUTO
         5 004750   000000 756100                    STQ     0,,PR0

     1363     6274    2         JRNLFREE$=J$;

   6274  5 004751   200010 236100                    LDQ     J$,,AUTO
         5 004752   200011 756100                    STQ     JRNLFREE$,,AUTO

     1364     6275    3         IF JRNLACTIVE$ = ADDR(NIL) AND JRNL_V.BND > 4095 THEN DO;

   6275  5 004753   200012 236100                    LDQ     JRNLACTIVE$,,AUTO
         5 004754   000001 116000 xsym               CMPQ    B_VECTNIL+1
         5 004755   005027 601000 5                  TNZ     s:6289
         5 004756   001452 236000 1                  LDQ     JRNL_V
         5 004757   000034 376000 xsym               ANQ     B_VECTNIL+28
         5 004760   002000 116003                    CMPQ    1024,DU
         5 004761   005027 602000 5                  TNC     s:6289

     1365     6276    3            GDS_JRNL.V.SEGSIZE#=(JRNL_V.BND+1)/4;

   6276  5 004762   001452 236000 1                  LDQ     JRNL_V
         5 004763   000020 772000                    QRL     16
         5 004764   000001 036007                    ADLQ    1,DL
         5 004765   000002 772000                    QRL     2
         5 004766   000000 620006                    EAX0    0,QL
         5 004767   001152 440000 1                  SXL0    GDS_JRNL+4

     1366     6277    3            CALL M$FDS (GDS_JRNL);

   6277  5 004770   001146 630400 1                  EPPR0   GDS_JRNL
         5 004771   030002 713400                    CLIMB   fds
         5 004772   400400 401760                    pmme    nvectors=2
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:207  

     1367     6278    3            GDS_JRNL.V.SEGSIZE#=1024;

   6278  5 004773   002000 220003                    LDX0    1024,DU
         5 004774   001152 440000 1                  SXL0    GDS_JRNL+4

     1368     6279    3            CALL M$GDS (GDS_JRNL);

   6279  5 004775   001146 630400 1                  EPPR0   GDS_JRNL
         5 004776   030001 713400                    CLIMB   gds
         5 004777   400400 401760                    pmme    nvectors=2

     1369     6280    3            JRNLFREE$=JRNL_V.P$;

   6280  5 005000   001453 236000 1                  LDQ     JRNL_V+1
         5 005001   200011 756100                    STQ     JRNLFREE$,,AUTO

     1370     6281    3            J$=JRNLFREE$;

   6281  5 005002   200010 756100                    STQ     J$,,AUTO

     1371     6282    4            DO WHILE (PINCRW(J$,SIZEW(JRNL)) < PINCRC(JRNL_V.P$,JRNL_V.BND+1));

   6282  5 005003   005012 710000 5                  TRA     s:6286

     1372     6283    4               C$=J$;

   6283  5 005004   200010 236100                    LDQ     J$,,AUTO
         5 005005   200004 756100                    STQ     C$,,AUTO

     1373     6284    4               J$->JRNL.LNK$=PINCRW(J$,SIZEW(JRNL));

   6284  5 005006   000033 036003                    ADLQ    27,DU
         5 005007   200010 470500                    LDP0    J$,,AUTO
         5 005010   000000 756100                    STQ     0,,PR0

     1374     6285    4               J$=J$->JRNL.LNK$;
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:208  

   6285  5 005011   200010 756100                    STQ     J$,,AUTO

     1375     6286    4               END;

   6286  5 005012   001452 236000 1                  LDQ     JRNL_V
         5 005013   000020 772000                    QRL     16
         5 005014   000020 736000                    QLS     16
         5 005015   200000 036007                    ADLQ    65536,DL
         5 005016   001453 036000 1                  ADLQ    JRNL_V+1
         5 005017   200040 756100                    STQ     P$+2,,AUTO
         5 005020   200010 236100                    LDQ     J$,,AUTO
         5 005021   000033 036003                    ADLQ    27,DU
         5 005022   200040 116100                    CMPQ    P$+2,,AUTO
         5 005023   005004 602000 5                  TNC     s:6283

     1376     6287    3            C$->JRNL.LNK$=ADDR(NIL);

   6287  5 005024   000001 236000 xsym               LDQ     B_VECTNIL+1
         5 005025   200004 470500                    LDP0    C$,,AUTO
         5 005026   000000 756100                    STQ     0,,PR0

     1377     6288    3            END;

     1378     6289    2         RETURN;

   6289  5 005027   200034 221300                    LDX1  ! @HISNAME,,AUTO
         5 005030   000001 702211                    TSX2  ! 1,X1
     1379     6290    2   END FREEJRNL;
     1380     6291    1   END FJJ$JAY;
     1381     6292        %EOD;

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:209  
--  Include file information  --

   KC$CGBLK.:E05TOU  is referenced.
   ZI$JRNL.:LIBRARY  is referenced.
   FJM_MACROS_C.:E05TOU  is referenced.
   FJ_PERR_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$SET.:E05TOU  is referenced.
   FM$CFU.:E05TOU  is referenced.
   FJ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FJJ$JAY.
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:210  

 **** Variables and constants ****

  ****  Section 001  Data  FJJ$JAY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  3462-0-0/w STRC        r     1 ASNERR                  1426-0-0/w STRC(108)   r     1 ATTR_
  4156-0-0/w PTR         r     1 BUF$                    1446-0-0/w PTR         r     1 CFU$
     1-0-0/w STRC(504)   r     1 CGDEL                   3470-0-0/b BIT         r     1 CGEXISTS
   524-0-0/d STRC(1080)  r     1 CG_CLS                   352-0-0/d STRC(1800)  r     1 CG_INFO
   434-0-0/w STRC(288)   r     1 CG_JSTA                  260-0-0/d STRC(2088)  r     1 CG_OPN
   444-0-0/d STRC(504)   r     1 CG_RD                    462-0-0/w STRC(288)   r     1 CG_RDSTA
   472-0-0/w STRC(432)   r     1 CG_SETSTA                506-0-0/d STRC(90)    r     1 CG_SN
  1432-0-0/d STRC(432)   r     1 CG_TIME                 1450-0-0/d STRC(72)    r     1 CG_V
   762-0-0/d STRC(1080)  r     1 CLS_JRNL                1020-0-0/d STRC(1080)  r     1 CLS_RNAME
  4011-0-0/w UBIN        r     1 CSCG_BUF(0:100)          202-0-0/c STRC(45)    r     1 CSCG_NAME
  1447-0-0/w PTR         r     1 CURSN$                  1056-0-0/d STRC(288)   r     1 CVOL_JRNL
  4006-0-0/b BIT         r     1 ERRCODE                 1354-0-0/d STRC(936)   r     1 ERRMSG
  1406-0-0/d STRC(144)   r     1 ERRSLT                  6157-0-0/w PTR         r     1 F$
  1170-0-0/d STRC(864)   r     1 FID_JFID                 512-0-0/d STRC(360)   r     1 FIN_CG_JRNL
    26-0-0/w STRC(702)   r     1 FJ$LISTANS              1140-0-0/d STRC(216)   r     1 GDS_CG
  1154-0-0/d STRC(216)   r     1 GDS_JFID                1146-0-0/d STRC(216)   r     1 GDS_JRNL
  1162-0-0/d STRC(216)   r     1 GDS_SN                   244-0-0/d STRC(288)   r     1 GET_JRNL_DCB
  1066-0-0/d STRC(1512)  r     1 GET_MESS_ATTR           6160-0-0/d STRC(432)   r     1 GREETING
  1412-0-0/c STRC(72)    r     1 JACCT                   1460-0-0/w UBIN(9)     r     1 JASN
  1454-0-0/d STRC(72)    r     1 JFID_V                  1414-0-0/c STRC(288)   r     1 JNAME
  1424-0-0/c STRC(72)    r     1 JPASS                   1461-0-0/w UBIN        r     1 JRECORD(0:1023)
     0-0-0/w PTR         r     1 JRNL$                   3466-0-0/w STRC        r     1 JRNLCLSD
  3467-0-0/w STRC        r     1 JRNLSTAR                  52-0-0/d STRC(144)   r     1 JRNL_EVENTS
  4157-0-0/w UBIN        r     1 JRNL_FIT(0:1023)         204-0-0/w STRC(432)   r     1 JRNL_GHST
  1452-0-0/d STRC(72)    r     1 JRNL_V                    56-0-0/d STRC(216)   r     1 JRNL_XCON
  3464-0-0/w STRC        r     1 NOAUTH                  3465-0-0/w STRC        r     1 NOJRNL
  3463-0-0/w STRC        r     1 NOSNERR                 3471-0-0/c CHAR(100)   r     1 OCBUF
  3616-0-0/c CHAR(120)   r     1 OCERRBUF(0:3)
  1336-0-0/d STRC(504)   r     1 OCMSG                     17-0-0/w STRC(252)   r     1 OPN_ANSWER
    72-0-0/d STRC(2088)  r     1 OPN_CSCG                 562-0-0/d STRC(2088)  r     1 OPN_JRNL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:211  
  6174-0-0/c CHAR(80)    r     1 OUTLINE                  164-0-0/d STRC(504)   r     1 RD_CSCG
  1246-0-0/d STRC(648)   r     1 RELRES                  1270-0-0/d STRC(648)   r     1 RELTAP
   254-0-0/d STRC(144)   r     1 REL_DCB                 1324-0-0/d STRC(360)   r     1 RESTAP
  3461-0-0/w UBIN        r     1 SNSZ                    1456-0-0/d STRC(72)    r     1 SN_V
   654-0-0/d STRC(2088)  r     1 TOPN_JRNL               1220-0-0/d STRC(792)   r     1 UNF_LIST
  1312-0-0/d STRC(360)   r     1 VLP_RPSN                  64-0-0/d STRC(216)   r     1 WAIT_CSCG
   746-0-0/d STRC(432)   r     1 WR_CG_JRNL               234-0-0/w STRC(288)   r     1 WR_CSCG_STA
   220-0-0/d STRC(432)   r     1 WR_JRNL_RESULTS         4007-0-0/w UBIN        r     1 XDCB

  ****  Section 003 RoData FJJ$JAY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 NORENAME                   1-0-0/w STRC        r     1 NOTOWNER

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    32-0-0/w PTR         r     1 @ACCN                     31-0-0/w PTR         r     1 @CODE
    32-0-0/w PTR         r     1 @DCB#                     33-0-0/w PTR         r     1 @HISACCN
    35-0-0/w PTR         r     1 @HISFACCN                 34-0-0/w PTR         r     1 @HISNAME
    36-0-0/w PTR         r     1 @HISPRIV                  31-0-0/w PTR         r     1 @NAME
    17-0-0/c CHAR(8)     r     1 ACCN                      *0-0-0/c CHAR(8)     r     1 ACCN
     4-0-0/w PTR         r     1 C$                         5-0-0/w PTR         r     1 CG$
     7-0-0/w PTR         r     1 CGACTIVE$                  6-0-0/w PTR         r     1 CGFREE$
     5-0-0/w STRC        r     1 CGP                       *0-0-0/w UBIN        r     1 CODE
    *0-0-0/w UBIN        r     1 DCB#                      15-0-0/b BIT         r     1 DELFFLG
    27-0-0/w UBIN        r     1 EVENT                     24-0-0/c CHAR(8)     r     1 FACCN
    16-0-0/b BIT         r     1 FREE                      *0-0-0/c CHAR(8)     r     1 HISACCN
    *0-0-0/c CHAR(8)     r     1 HISFACCN                  *0-0-0/c CHAR(12)    r     1 HISNAME
    *0-0-0/w BIT         r     1 HISPRIV                   13-0-0/w UBIN        r     1 I
    33-0-0/w UBIN        r     1 I                         31-0-0/w UBIN        r     1 I
    35-0-0/w PTR         r     1 I$                        35-0-0/w PTR         r     1 I$
    10-0-0/w PTR         r     1 J$                        12-0-0/w PTR         r     1 JRNLACTIVE$
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:212  
    11-0-0/w PTR         r     1 JRNLFREE$                  3-0-0/w PTR         r     1 JSN$
    14-0-0/w UBIN        r     1 K                         21-0-0/c CHAR(12)    r     1 NAME
    *0-0-0/c STRC(288)   r     1 NAME                      36-0-0/w PTR         r     1 P$
    36-0-0/w PTR         r     1 P$                        26-0-0/b BIT         r     1 PRIV

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$DS1$                     0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/c CHAR        r     1 B_VERSION
     0-0-0/w STRC(324)   r     1 FJ_EV(0:8191)              0-0-0/w SBIN        r     1 FJ_EVFREE
     0-0-0/w SBIN        r     1 FJ_EVHD                    0-0-0/w SBIN        r     1 FJ_EVTL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$CGAURD
     0-0-0/d STRC(2088)  r     1 B$JIT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/c ASTR(9)     r     1 B$VERSIONB                 0-0-0/w STRC(72)    r     1 BERC
     0-0-0/w STRC        r     1 BPTR                       0-0-0/w STRC(72)    r     1 BVCTR
     0-0-0/w STRC(9900)  r     1 CG                         0-0-0/w STRC(36684) r     1 CGJREC
     0-0-0/c ACHR        r     1 DUMMY_SN                   0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(603)   r     1 FILE                       0-0-0/w STRC(288)   r     1 FM$CFU
     0-0-0/w STRC(288)   r     1 FM$CFUA                    0-0-0/c ASTR(27)    r     1 FM$CFUN
     0-0-0/w STRC(288)   r     1 FM$CFUX                    0-0-0/w STRC(288)   r     1 FM$SET(0:0)
     0-0-0/w STRC(108)   r     1 JATTR                      0-0-0/c ASTR(18)    r     1 JFID
     0-0-0/c ACHR        r     1 JN                         0-0-0/w ASTR(162)   r     1 JREC
     0-0-0/w STRC(900)   r     1 JRNCANCEL                  0-0-0/w STRC(972)   r     1 JRNL
     0-0-0/w STRC(360)   r     1 JRNLIST                    0-0-0/w STRC(396)   r     1 JRNOPN
     0-0-0/w STRC(1188)  r     1 JRNRENAME                  0-0-0N  NULL        r     1 M$CSCG
     0-0-0N  NULL        r     1 M$GREETING                 0-0-0/w PTR         r     1 P$$
     0-0-0/w STRC(288)   r     1 RDSTA                      0-0-0/d STRC(90)    r     1 SN

PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:213  

   Procedure FJJ$JAY requires 2585 words for executable code.
   Procedure FJJ$JAY requires 36 words of local(AUTO) storage.
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:214  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:215  
          MINI XREF LISTING

ACCN
      5044**DCL      6061>>ASSIGN   6147<<ASSIGN   6161>>ASSIGN
ACCN IN PROCEDURE LOCJRNL
      6126**DCL      6121--PROC     6131>>IF
ALTX IN PROCEDURE OPN_CG_JRNL
      6061**LABEL    6048--GOTO     6051--GOTO     6056--GOTO
ASNERR
      4690**DCL      6050>>ASSIGN
ATTR_.Q
      4591**DCL      4590--DCLINIT
ATTR_.Q.ID
      4593**DCL      5510>>IF       6011>>IF
B$ALT.CODE
      2909**DCL      2909--REDEF    2910--REDEF    2910--REDEF
B$ALT.ERR
      2910**DCL      5428>>ASSIGN   5432>>ASSIGN   5434>>ASSIGN   5441>>ASSIGN   5668>>ASSIGN   5824<>CALL
      6047>>ASSIGN
B$ALT.ERR.ERR#
      2911**DCL      2911--REDEF    5346>>IF       6057>>IF
B$ALT.EVID
      2910**DCL      2910--REDEF    2910--REDEF
B$CGAURD.EVENT
      2931**DCL      5745>>DOCASE
B$CGAURD.MID.MSGID
      2932**DCL      5751>>ASSIGN
B$CGAURD.MID.MSGIDXT
      2932**DCL      5752>>ASSIGN
B$CGAURD.STATION
      2931**DCL      2931--REDEF
B$DS1$
      4628**DCL      5248<>CALL     5263>>ASSIGN   5639>>ASSIGN   5862>>ASSIGN
B$JIT.ACCN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:216  
      3045**DCL      6061<<ASSIGN   6147>>ASSIGN   6151<<ASSIGN   6161<<ASSIGN
B$JIT.ERR.MID
      3046**DCL      3046--REDEF
B$JIT.FACCN
      3045**DCL      6063<<ASSIGN   6149>>ASSIGN   6153<<ASSIGN   6163<<ASSIGN
B$JIT.PRIV.ACTIVE
      3046**DCL      6064<<ASSIGN   6150>>ASSIGN   6154<<ASSIGN   6164<<ASSIGN
B$JIT.SYSID
      3045**DCL      5165>>IF
B$JIT.UNAME
      3045**DCL      6062<<ASSIGN   6148>>ASSIGN   6152<<ASSIGN   6162<<ASSIGN
B$JIT$
      4627**DCL      3040--IMP-PTR  5165>>IF       6061>>ASSIGN   6062>>ASSIGN   6063>>ASSIGN   6064>>ASSIGN
      6147>>ASSIGN   6148>>ASSIGN   6149>>ASSIGN   6150>>ASSIGN   6151>>ASSIGN   6152>>ASSIGN   6153>>ASSIGN
      6154>>ASSIGN   6161>>ASSIGN   6162>>ASSIGN   6163>>ASSIGN   6164>>ASSIGN
B$TCB.ALT$
      2905**DCL      5346>>IF       5428>>ASSIGN   5432>>ASSIGN   5434>>ASSIGN   5441>>ASSIGN   5668>>ASSIGN
      5824>>CALL     6047>>ASSIGN   6057>>IF
B$TCB$
      4626**DCL      5346>>IF       5428>>ASSIGN   5432>>ASSIGN   5434>>ASSIGN   5441>>ASSIGN   5668>>ASSIGN
      5824>>CALL     6047>>ASSIGN   6057>>IF
B$VERSIONB.C_
      5117**DCL      5118--IMP-SIZ  5159>>CALLBLT
B$VERSIONB.T_
      5118**DCL      5159>>CALLBLT
BERC
      2505**DCL      5990--ASSIGN
BERC.DCB#
      2509**DCL      2510--REDEF    5986<<ASSIGN
BERC.TIME
      2506**DCL      5988--ASSIGN
BERC.TYPE
      2507**DCL      5985<<ASSIGN
BERC.USER#
      2508**DCL      5987<<ASSIGN
BPTR.OFFSET
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:217  
      4667**DCL      5293>>ASSIGN   6043>>ASSIGN
BUF$
      5090**DCL      5249>>DOCASE   5263>>ASSIGN   5293>>ASSIGN   5294>>ASSIGN   5568>>CALL     5568>>CALL
      5568>>CALL     5568>>CALL     5589>>CALL     5589>>CALL     5589>>CALL     5589>>CALL     5617>>CALL
      5617>>CALL     5617>>CALL     5617>>CALL     5619>>CALL     5619>>CALL     5628>>ASSIGN   5629>>ASSIGN
      5630>>ASSIGN   5657>>ASSIGN   5679>>CALL     5679>>CALL     5681>>CALL     5681>>CALL     5681>>CALL
      5681>>CALL     6003>>CALL     6003>>CALL     6003>>CALL     6003>>CALL
BVCTR.BND
      4663**DCL      5341<<ASSIGN
BVCTR.PTR$
      4665**DCL      5340<<ASSIGN
B_VERSION
      5115**DCL      5159--CALLBLT  5159--CALLBLT
C$
      4635**DCL      2543--IMP-PTR  5186<<ASSIGN   5190>>ASSIGN   5197<<ASSIGN   5201>>ASSIGN   5281<<ASSIGN
      5285>>ASSIGN   5418>>ASSIGN   5418>>ASSIGN   5735<<ASSIGN   5736>>DOWHILE  5737>>IF       5739<<ASSIGN
      5739>>ASSIGN   5741<<ASSIGN   5745>>DOCASE   5751>>ASSIGN   5752>>ASSIGN   5762>>ASSIGN   5762>>ASSIGN
      5777>>ASSIGN   5779>>ASSIGN   5780>>ASSIGN   5781>>ASSIGN   5783>>ASSIGN   5787>>ASSIGN   5788>>ASSIGN
      5793>>ASSIGN   5799>>IF       5808>>ASSIGN   5808>>ASSIGN   5899<<ASSIGN   5903>>ASSIGN   6232<<ASSIGN
      6236>>ASSIGN   6249<<ASSIGN   6255>>ASSIGN   6283<<ASSIGN   6287>>ASSIGN
CFU$
      4632**DCL      5248<>CALL     5264>>IF       5295>>ASSIGN   5296>>DOWHILE  5297>>ASSIGN   5299>>ASSIGN
      5301>>ASSIGN   5301>>ASSIGN   5303>>ASSIGN   5303>>ASSIGN   5305>>ASSIGN   5305>>ASSIGN   5305>>ASSIGN
      5480>>ASSIGN   5481>>DOWHILE  5482>>ASSIGN   5484>>ASSIGN   5486>>ASSIGN   5486>>ASSIGN   5492>>IF
      5495>>IF       5498>>ASSIGN   5498>>ASSIGN   5500>>ASSIGN   5500>>ASSIGN   5500>>ASSIGN   5949>>IF
CG
      5053**DCL      5196--DOWHILE  5198--ASSIGN   5277--ASSIGN   5277--ASSIGN   5280--DOWHILE  5282--ASSIGN
      6231--DOWHILE  6233--ASSIGN
CG.BUF
      5087**DCL      5418--ASSIGN   5420--ASSIGN   5741--ASSIGN   5762--ASSIGN   5764--ASSIGN   5808--ASSIGN
      5810--ASSIGN
CG.CFU
      5058**DCL      5268>>IF       5292<<ASSIGN
CG.DCB#
      5056**DCL      5307<<ASSIGN   5312>>ASSIGN   5317>>ASSIGN   5443>>ASSIGN   5444--ASSIGN   5449>>ASSIGN
      5456>>ASSIGN   5593>>ASSIGN   5696>>ASSIGN   5743--IF       5760>>ASSIGN   5789>>ASSIGN   5802>>ASSIGN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:218  
      5806>>ASSIGN   5816<>CALL     5925>>ASSIGN   5927>>ASSIGN
CG.HISDCB
      5059**DCL      5293<<ASSIGN   5404>>ASSIGN   5753>>ASSIGN   5779>>ASSIGN   5986>>ASSIGN
CG.HISUSER#
      5060**DCL      5294<<ASSIGN   5405>>ASSIGN   5754>>ASSIGN   5781>>ASSIGN   5987>>ASSIGN
CG.ID.ACCT#
      5080**DCL      5303<<ASSIGN   5309--ASSIGN   5406>>ASSIGN   6075>>CALLBLT  6076>>CALLBLT  6179--ASSIGN
CG.ID.NAME#
      5083**DCL      5310--ASSIGN   5407>>ASSIGN   6178--ASSIGN
CG.ID.NAME#.CNT
      5084**DCL      5299<<ASSIGN   6076>>CALLBLT
CG.ID.NAME#.TXT
      5085**DCL      5301<<ASSIGN   6076>>CALLBLT
CG.ID.PSN#
      5081**DCL      5305<<ASSIGN   5311>>ASSIGN   5408>>ASSIGN   5836>>IF       6180>>ASSIGN   6219>>ASSIGN
CG.JRNL$
      5057**DCL      5308<<ASSIGN   5358>>IF       5359>>IF       5359>>IF       5359>>IF       5364>>ASSIGN
      5364>>ASSIGN   5393<<ASSIGN   5457>>IF       5693>>IF       5695<<ASSIGN   5758>>ASSIGN   5772>>IF
      5792>>ASSIGN   5823>>ASSIGN   5923>>IF       5924>>ASSIGN   5924>>ASSIGN   5935>>IF       5991>>ASSIGN
CG.LNK$
      5054**DCL      5198<<ASSIGN   5199>>ASSIGN   5201<<ASSIGN   5270>>ASSIGN   5282<<ASSIGN   5283>>ASSIGN
      5285<<ASSIGN   5288>>ASSIGN   5289<<ASSIGN   5595>>ASSIGN   5609>>ASSIGN   5701>>ASSIGN   5739>>ASSIGN
      5841>>ASSIGN   5941>>ASSIGN   6210>>DOWHILE  6212>>ASSIGN   6215<<ASSIGN   6215>>ASSIGN   6217>>ASSIGN
      6221<<ASSIGN   6233<<ASSIGN   6234>>ASSIGN   6236<<ASSIGN
CG$
      4636**DCL      4637--REDEF    5195<<ASSIGN   5196>>DOWHILE  5197>>ASSIGN   5198>>ASSIGN   5198>>ASSIGN
      5199<<ASSIGN   5199>>ASSIGN   5266<<ASSIGN   5267>>DOWHILE  5268>>IF       5270<<ASSIGN   5270>>ASSIGN
      5277<<ASSIGN   5278>>ASSIGN   5280>>DOWHILE  5281>>ASSIGN   5282>>ASSIGN   5282>>ASSIGN   5283<<ASSIGN
      5283>>ASSIGN   5287<<ASSIGN   5288>>ASSIGN   5289>>ASSIGN   5290>>ASSIGN   5292>>ASSIGN   5293>>ASSIGN
      5294>>ASSIGN   5299>>ASSIGN   5301>>ASSIGN   5303>>ASSIGN   5305>>ASSIGN   5307>>ASSIGN   5308>>ASSIGN
      5309>>ASSIGN   5310>>ASSIGN   5311>>ASSIGN   5312>>ASSIGN   5317>>ASSIGN   5358>>IF       5359>>IF
      5359>>IF       5359>>IF       5364>>ASSIGN   5364>>ASSIGN   5393>>ASSIGN   5404>>ASSIGN   5405>>ASSIGN
      5406>>ASSIGN   5407>>ASSIGN   5408>>ASSIGN   5420>>ASSIGN   5442>>DOWHILE  5443>>ASSIGN   5444>>ASSIGN
      5449>>ASSIGN   5456>>ASSIGN   5457>>IF       5470<<ASSIGN   5614<<ASSIGN   5676<<ASSIGN   5691<<ASSIGN
      5692>>DOWHILE  5693>>IF       5695>>ASSIGN   5696>>ASSIGN   5701<<ASSIGN   5701>>ASSIGN   5734<<ASSIGN
      5736>>DOWHILE  5741>>ASSIGN   5743>>IF       5753>>ASSIGN   5754>>ASSIGN   5758>>ASSIGN   5760>>ASSIGN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:219  
      5764>>ASSIGN   5772>>IF       5779>>ASSIGN   5781>>ASSIGN   5789>>ASSIGN   5792>>ASSIGN   5802>>ASSIGN
      5806>>ASSIGN   5810>>ASSIGN   5816>>CALL     5823>>ASSIGN   5834<<ASSIGN   5835>>DOWHILE  5836>>IF
      5841<<ASSIGN   5841>>ASSIGN   5923>>IF       5924>>ASSIGN   5924>>ASSIGN   5925>>ASSIGN   5927>>ASSIGN
      5933<<ASSIGN   5934>>DOWHILE  5935>>IF       5941<<ASSIGN   5941>>ASSIGN   5984>>IF       5986>>ASSIGN
      5987>>ASSIGN   5991>>ASSIGN   6075>>CALLBLT  6076>>CALLBLT  6076>>CALLBLT  6076>>CALLBLT  6210>>DOWHILE
      6219>>ASSIGN   6221>>ASSIGN   6222>>ASSIGN   6223<<ASSIGN   6230<<ASSIGN   6231>>DOWHILE  6232>>ASSIGN
      6233>>ASSIGN   6233>>ASSIGN   6234<<ASSIGN   6234>>ASSIGN
CGACTIVE$
      4641**DCL      5191<<ASSIGN   5266>>ASSIGN   5289>>ASSIGN   5290<<ASSIGN   5585>>ASSIGN   5691>>ASSIGN
      5735>>ASSIGN   5834>>ASSIGN   5933>>ASSIGN   6208>>ASSIGN   6217<<ASSIGN   6224>>IF
CGDEL
      2579**DCL      5757--ASSIGN
CGDEL.DCB#
      2583**DCL      5753<<ASSIGN
CGDEL.MSGID.PRIMARY
      2585**DCL      5751<<ASSIGN
CGDEL.MSGID.XT
      2586**DCL      5752<<ASSIGN
CGDEL.TIME
      2580**DCL      5755--ASSIGN
CGDEL.TYPE
      2581**DCL      5750<<ASSIGN
CGDEL.USER#
      2582**DCL      5754<<ASSIGN
CGEXISTS
      5038**DCL      5265<<ASSIGN   5273<<ASSIGN
CGFREE$
      4640**DCL      5194<<ASSIGN   5195>>ASSIGN   5276>>IF       5278<<ASSIGN   5287>>ASSIGN   5288<<ASSIGN
      6221>>ASSIGN   6222<<ASSIGN   6229<<ASSIGN   6230>>ASSIGN
CGJREC
      2543**DCL      5418--ASSIGN   5762--ASSIGN   5793--ASSIGN   5794--ASSIGN   5808--ASSIGN
CGJREC.CONT
      2548**DCL      5783<<ASSIGN   5787<<ASSIGN   5799>>IF
CGJREC.DCB#
      2547**DCL      5779<<ASSIGN
CGJREC.MESS
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:220  
      2576**DCL      5418--ASSIGN   5420--ASSIGN   5745--DOCASE   5751--ASSIGN   5752--ASSIGN   5762--ASSIGN
      5764--ASSIGN   5794--ASSIGN   5808--ASSIGN   5810--ASSIGN
CGJREC.MSGATTR
      2563**DCL      5788--ASSIGN
CGJREC.MSGATTR.MSGIDXT
      2570**DCL      2573--REDEF
CGJREC.TIME
      2544**DCL      5777--ASSIGN
CGJREC.TYPE
      2545**DCL      5780<<ASSIGN
CGJREC.USER#
      2546**DCL      5781<<ASSIGN
CGP.OFFSET
      4638**DCL      5416>>ASSIGN   5761>>ASSIGN   5807>>ASSIGN
CG_CLS
      3835**DCL      5445<>CALL     5460<>CALL     5698<>CALL     5926<>CALL
CG_CLS.SN_
      3835**DCL      3835--REDEF
CG_CLS.UTL_
      3836**DCL      3836--REDEF
CG_CLS.V
      3840**DCL      3835--DCLINIT
CG_CLS.V.DCB#
      3841**DCL      5443<<ASSIGN   5456<<ASSIGN   5696<<ASSIGN   5925<<ASSIGN
CG_CLS.V.EXPIRE#
      3850**DCL      3850--REDEF
CG_CLS.V.TYPE#
      3848**DCL      3848--REDEF
CG_CLS.V.XTNSIZE#
      3845**DCL      3845--REDEF    3847--REDEF
CG_INFO
      3618**DCL      5319<>CALL
CG_INFO.JRNLFID_
      3622**DCL      5318<<ASSIGN
CG_INFO.V
      3623**DCL      3618--DCLINIT
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:221  
CG_INFO.V.DCB#
      3623**DCL      5317<<ASSIGN
CG_JSTA
      3639**DCL      3622--DCLINIT
CG_JSTA.MSGIDXT
      3649**DCL      3652--REDEF
CG_OPN
      3563**DCL      5313<>CALL
CG_OPN.ACCT_
      3567**DCL      5309<<ASSIGN
CG_OPN.ACSVEH_
      3565**DCL      3566--REDEF
CG_OPN.ALTKEYS_
      3571**DCL      3572--REDEF    3572--REDEF
CG_OPN.HDR_
      3570**DCL      3571--REDEF
CG_OPN.NAME_
      3564**DCL      5310<<ASSIGN
CG_OPN.TAB_
      3569**DCL      3570--REDEF
CG_OPN.UHL_
      3563**DCL      3564--REDEF    3564--REDEF
CG_OPN.V
      3572**DCL      3563--DCLINIT
CG_OPN.V.DCB#
      3572**DCL      5312<<ASSIGN   5417>>ASSIGN
CG_OPN.V.FSN#
      3603**DCL      3603--REDEF    3603--REDEF
CG_OPN.WSN_
      3569**DCL      3569--REDEF
CG_RD
      3678**DCL      5424<>CALL     5766<>CALL     5813<>CALL
CG_RD.BUF_.BOUND
      3680**DCL      5418<<ASSIGN   5762<<ASSIGN   5808<<ASSIGN
CG_RD.BUF_.BUF$
      3681**DCL      5420<<ASSIGN   5764<<ASSIGN   5810<<ASSIGN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:222  
CG_RD.STATION_
      3681**DCL      3682--REDEF
CG_RD.V
      3682**DCL      3678--DCLINIT
CG_RD.V.DCB#
      3682**DCL      5417<<ASSIGN   5760<<ASSIGN   5806<<ASSIGN
CG_RD.V.DVBYTE.CONT#
      3695**DCL      5800<<ASSIGN   5804<<ASSIGN
CG_RD.V.DVBYTE.REREAD#
      3693**DCL      3693--REDEF
CG_RD.V.EVENT#
      3691**DCL      5416<<ASSIGN   5761<<ASSIGN   5807<<ASSIGN
CG_RD.V.INDX#
      3691**DCL      3691--REDEF
CG_RDSTA
      3712**DCL      3681--DCLINIT
CG_RDSTA.MSGIDXT
      3722**DCL      3725--REDEF
CG_SETSTA
      3739**DCL      3564--DCLINIT
CG_SN
      3793**DCL      3563--DCLINIT  3921--DCLINIT  4030--DCLINIT
CG_SN.SN#
      3793**DCL      5311<<ASSIGN   5504<<ASSIGN   5637<<ASSIGN   6006<<ASSIGN   6173<<ASSIGN   6180<<ASSIGN
CG_TIME
      4610**DCL      5412<>CALL     5756<>CALL     5778<>CALL     5953<>CALL     5989<>CALL
CG_TIME.TSTAMP_
      4613**DCL      5215<<ASSIGN   5411<<ASSIGN   5755<<ASSIGN   5777<<ASSIGN   5952<<ASSIGN   5988<<ASSIGN
CG_TIME.V
      4614**DCL      4610--DCLINIT
CG_V
      4645**DCL      4236--DCLINIT
CG_V.BND
      4646**DCL      5196>>DOWHILE  5277>>ASSIGN   5280>>DOWHILE  6224>>IF       6225>>ASSIGN   6231>>DOWHILE
CG_V.P$
      4648**DCL      5194>>ASSIGN   5196>>DOWHILE  5277>>ASSIGN   5280>>DOWHILE  5734>>ASSIGN   6229>>ASSIGN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:223  
      6231>>DOWHILE
CHK IN PROCEDURE CHKJRNLS
      5947**LABEL    5957--GOTO
CHKCG
      5932**PROC     5825--CALL     5846--CALL     5881--CALL
CHKCG1 IN PROCEDURE CHKCG
      5933**LABEL    5939--GOTO
CHKJRNLS
      5946**PROC     5236--CALL
CLSCG
      5921**PROC     5458--CALL     5774--CALL     5818--CALL     5838--CALL     5938--CALL
CLSCGERR1
      5446**LABEL    5433--GOTO     5445--CALLALT
CLSCGMSG
      6071**PROC     5697--CALL     5817--CALL     5937--CALL
CLSJ1 IN PROCEDURE CLSJRNL
      5972**LABEL    5970--CALLALT
CLSJ2 IN PROCEDURE CLSJRNL
      5979**LABEL    5978--CALLALT
CLSJRNL
      5964**PROC     5664--CALL     5670--CALL     5703--CALL     5826--CALL     5847--CALL     5882--CALL
      5956--CALL
CLS_JRNL
      4128**DCL      5970<>CALL
CLS_JRNL.SN_
      4128**DCL      4128--REDEF
CLS_JRNL.UATTR_
      4131**DCL      5967<<ASSIGN   5969<<ASSIGN
CLS_JRNL.UTL_
      4129**DCL      4129--REDEF
CLS_JRNL.V
      4133**DCL      4128--DCLINIT
CLS_JRNL.V.DCB#
      4134**DCL      5965<<ASSIGN
CLS_JRNL.V.EXPIRE#
      4143**DCL      4143--REDEF
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:224  
CLS_JRNL.V.TYPE#
      4141**DCL      4141--REDEF
CLS_JRNL.V.XTNSIZE#
      4138**DCL      4138--REDEF    4140--REDEF
CLS_RNAME
      4170**DCL      5658<>CALL
CLS_RNAME.NAME_
      4171**DCL      5657<<ASSIGN
CLS_RNAME.SN_
      4170**DCL      4170--REDEF
CLS_RNAME.UTL_
      4171**DCL      4171--REDEF
CLS_RNAME.V
      4175**DCL      4170--DCLINIT
CLS_RNAME.V.DCB#
      4176**DCL      5656<<ASSIGN
CLS_RNAME.V.EXPIRE#
      4185**DCL      4185--REDEF
CLS_RNAME.V.TYPE#
      4183**DCL      4183--REDEF
CLS_RNAME.V.XTNSIZE#
      4180**DCL      4180--REDEF    4182--REDEF
CNCL1
      5696**LABEL    5698--CALLALT
CODE IN PROCEDURE ERRMSG
      6107**DCL      6105--PROC     6109--ASSIGN
COMMON IN PROCEDURE TESTOPEN
      6183**LABEL    6174--GOTO
CSCG_BUF
      5089**DCL      3333--DCLINIT  3334--DCLINIT  5090--DCLINIT
CSCG_NAME
      3378**DCL      3270--DCLINIT
CURSN$
      4633**DCL      5332<<ASSIGN   5333>>ASSIGN   5342>>ASSIGN   5346>>IF       5346>>IF       5383>>ASSIGN
      5386>>ASSIGN   5388>>ASSIGN   5388>>ASSIGN   5520<<ASSIGN   5521>>ASSIGN   5526>>ASSIGN   5528>>ASSIGN
      5531<<ASSIGN   5532>>ASSIGN   6016>>ASSIGN   6021>>ASSIGN   6023>>ASSIGN   6026<<ASSIGN   6027>>ASSIGN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:225  
CVOL_JRNL
      4200**DCL      5877<>CALL
CVOL_JRNL.V
      4201**DCL      4200--DCLINIT
CVOL_JRNL.V.DCB#
      4201**DCL      5876<<ASSIGN
DACT1 IN PROCEDURE CLSCG
      5927**LABEL    5926--CALLALT
DAM$INIT
      4619**DCL-ENT  5219--CALL
DAM$MAP
      4620**DCL-ENT  5248--CALL
DCB# IN PROCEDURE ERRMSG
      6108**DCL      6105--PROC     6110>>ASSIGN
DELFFLG
      4675**DCL      5655>>IF       5689>>IF       6187<<ASSIGN
DSM1
      5834**LABEL    5839--GOTO
DSM2
      5838**LABEL    5837--CALLALT
DSM3
      5843**LABEL    5848--GOTO
DSM4
      5853**LABEL    5854--CALLALT
DUMMY_SN
      4673**DCL      5342--ASSIGN   5532<<ASSIGN   5532>>ASSIGN   5534--ASSIGN   6027<<ASSIGN   6027>>ASSIGN
      6029--ASSIGN   6251<<ASSIGN   6251>>ASSIGN
ERRCODE
      5043**DCL      4430--DCLINIT
ERRMSG
      6105**PROC     5816--CALL     5824--CALL     5880--CALL     6111<>CALL
ERRMSG.CODE_
      4430**DCL      6109<<ASSIGN
ERRMSG.V
      4434**DCL      4430--DCLINIT
ERRMSG.V.DCB#
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:226  
      4434**DCL      6110<<ASSIGN
ERRSLT
      4457**DCL      4434--DCLINIT
ERRSLT.RECCNT
      4461**DCL      6112>>IF       6114>>DOINDEX
EVENT
      5048**DCL      5238<<ASSIGN   5246>>DOCASE   5560>>ASSIGN   5561>>ASSIGN   5725>>ASSIGN   5726>>ASSIGN
      5734>>ASSIGN   5743>>IF       5770>>DOCASE   5782>>IF       5794>>ASSIGN   5816>>CALL     5836>>IF
      5845>>IF       5853>>ASSIGN   5862>>ASSIGN   5873>>IF       5880>>CALL     6198>>ASSIGN   6199>>ASSIGN
F$
      5092**DCL      5507<<ASSIGN   5508<>CALL     5509<<ASSIGN   5509>>ASSIGN   5510>>IF       5512>>ASSIGN
      5513>>IF       5522>>IF       5528>>ASSIGN   5529>>ASSIGN   5530>>ASSIGN   5532>>ASSIGN   6008<<ASSIGN
      6009<>CALL     6010<<ASSIGN   6010>>ASSIGN   6011>>IF       6013>>IF       6017>>IF       6023>>ASSIGN
      6024>>ASSIGN   6025>>ASSIGN   6027>>ASSIGN
F$DCB.ACTPOS
      3015**DCL      3015--REDEF
F$DCB.ARS#
      2989**DCL      2989--REDEF
F$DCB.ATTR
      3008**DCL      3009--REDEF
F$DCB.BORROW
      3023**DCL      3023--REDEF    3023--REDEF    3023--REDEF
F$DCB.CFU$
      3024**DCL      5639>>ASSIGN   6043--ASSIGN
F$DCB.DCBNAME.L
      3037**DCL      3037--IMP-SIZ
F$DCB.EOMCHAR#
      2993**DCL      2993--REDEF
F$DCB.FCN.CNT
      3028**DCL      5444>>ASSIGN
F$DCB.FFLG.DELF#
      2994**DCL      6187>>ASSIGN
F$DCB.FLDID
      3018**DCL      3018--REDEF
F$DCB.FORM$
      3012**DCL      3012--REDEF
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:227  
F$DCB.FSECT
      3028**DCL      3028--REDEF
F$DCB.FSN#
      3005**DCL      3005--REDEF    3005--REDEF    3006--REDEF
F$DCB.HEADER$
      3011**DCL      3011--REDEF
F$DCB.IXTNSIZE#
      3009**DCL      3009--REDEF
F$DCB.LASTSTA$
      2998**DCL      2998--REDEF    5743>>IF
F$DCB.LVL
      3024**DCL      3024--REDEF
F$DCB.NAME#.C
      2999**DCL      2999--REDEF
F$DCB.NOEOF
      3021**DCL      3021--REDEF
F$DCB.NRECS#
      3010**DCL      3010--REDEF
F$DCB.NRECX
      3029**DCL      3029--REDEF
F$DCB.OHDR
      3021**DCL      3021--REDEF
F$DCB.ORG#
      3004**DCL      3004--REDEF
F$DCB.OWNER
      3021**DCL      5553>>IF       5641>>IF
F$DCB.PRECNO
      3027**DCL      3027--REDEF
F$DCB.RCSZ
      3033**DCL      3033--REDEF
F$DCB.RES#
      3000**DCL      3000--REDEF    5974>>ASSIGN
F$DCB.SETX
      3012**DCL      3012--REDEF
F$DCB.TAB$
      3012**DCL      3012--REDEF
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:228  
F$DCB.TDA
      3026**DCL      3027--REDEF
F$DCB.WSN#
      3000**DCL      3000--REDEF
FACCN
      5046**DCL      6063>>ASSIGN   6149<<ASSIGN   6163>>ASSIGN
FIDERR
      5346**LABEL    5343--CALLALT
FID_JFID
      4302**DCL      5343<>CALL
FID_JFID.SN_
      4304**DCL      5342<<ASSIGN
FID_JFID.TEXTFID_
      4302**DCL      5339<<ASSIGN   5340--ASSIGN   5341--ASSIGN
FID_JFID.V
      4306**DCL      4302--DCLINIT
FILE
      2468**DCL      5402<<ASSIGN   5414--ASSIGN
FILE.COMGROUP
      2478**DCL      5410<<ASSIGN
FILE.DCB#
      2472**DCL      5404<<ASSIGN
FILE.ID.ACCT#
      2482**DCL      5406<<ASSIGN
FILE.ID.NAME#
      2485**DCL      5407<<ASSIGN
FILE.ID.PASS#
      2483**DCL      5409<<ASSIGN
FILE.ID.PSN#
      2484**DCL      5408<<ASSIGN
FILE.TIME
      2469**DCL      5215--ASSIGN   5411--ASSIGN
FILE.TYPE
      2470**DCL      5403<<ASSIGN
FILE.USER#
      2471**DCL      5405<<ASSIGN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:229  
FIN_CG_JRNL
      3806**DCL      5803<>CALL
FIN_CG_JRNL.V
      3806**DCL      3806--DCLINIT
FIN_CG_JRNL.V.DCB#
      3807**DCL      5802<<ASSIGN
FJ$LISTANS
      2899**DCL      5562--ASSIGN
FJ$LISTANS.ERR
      2900**DCL      5564<<ASSIGN
FJ$LISTANS.LAST
      2901**DCL      5563<<ASSIGN   5598<<ASSIGN
FJ$LISTANS.TXT
      2902**DCL      4325--DCLINIT  5566<<ASSIGN   5576<<CALLBLT  5586<<ASSIGN   5610<<ASSIGN
FJJ$CJAY
      4622**DCL-ENT  5166--CALL
FJJ$EVENT
      4623**DCL-ENT  3170--DCLINIT
FJJ$XCON
      4624**DCL-ENT  3185--DCLINIT
FJ_EV.ARS
       101**DCL      5794>>ASSIGN
FJ_EV.CFU$
       101**DCL      5862>>ASSIGN
FJ_EV.CG#
       101**DCL      5734>>ASSIGN
FJ_EV.DCB#
       101**DCL       101--REDEF     101--REDEF
FJ_EV.ERR
       102**DCL      5816<>CALL     5880<>CALL
FJ_EV.ERR.ERR#
       102**DCL      5743>>IF       5770>>DOCASE   5782>>IF       5873>>IF
FJ_EV.EVID
       101**DCL      5246>>DOCASE
FJ_EV.LNK
       101**DCL      5206<<ASSIGN   5211<<ASSIGN   5239>>ASSIGN   6198<<ASSIGN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:230  
FJ_EV.MSG
       101**DCL      5561>>ASSIGN   5726>>ASSIGN
FJ_EV.STA
       101**DCL      5560>>ASSIGN   5725>>ASSIGN   5836>>IF       5845>>IF       5853>>ASSIGN
FJ_EVFREE
       102**DCL      5208<<ASSIGN   6198>>ASSIGN   6199<<ASSIGN
FJ_EVHD
       102**DCL      5209<<ASSIGN   5234>>DOWHILE  5238>>ASSIGN   5239<<ASSIGN   5239>>ASSIGN   5240>>IF
      5241>>ASSIGN
FJ_EVTL
       102**DCL      5210<<ASSIGN   5241<<ASSIGN
FM$CFU.ACCTX
      3138**DCL      3138--REDEF    5303>>ASSIGN   5305>>ASSIGN   5492>>IF       5498>>ASSIGN   5500>>ASSIGN
FM$CFU.FUN
      3137**DCL      5264>>IF
FM$CFU.NAMEX
      3138**DCL      5295>>ASSIGN   5297>>ASSIGN   5480>>ASSIGN   5482>>ASSIGN
FM$CFU.STARX.F
      3138**DCL      5495>>IF
FM$CFU.USECNT
      3139**DCL      5949>>IF
FM$CFUA.ACCT
      3146**DCL      5303>>ASSIGN   5498>>ASSIGN
FM$CFUA.SETX
      3146**DCL      5305>>ASSIGN   5500>>ASSIGN
FM$CFUN.C
      3143**DCL      5301>>ASSIGN   5486>>ASSIGN
FM$CFUN.L
      3143**DCL      3143--IMP-SIZ  5299>>ASSIGN   5301>>ASSIGN   5484>>ASSIGN   5486>>ASSIGN
FM$CFUX.CFUT
      3152**DCL      5296>>DOWHILE  5481>>DOWHILE
FM$SET.PSN
      3132**DCL      5305>>ASSIGN   5500>>ASSIGN
FM$SET.USERLIST
      3133**DCL      3133--REDEF
FREE
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:231  
      4676**DCL      5622<<ASSIGN   5625<<ASSIGN   5663>>IF       5669>>IF       5685<<ASSIGN
FREEATTR IN PROCEDURE FREEJRNL
      6247**LABEL    6256--GOTO
FREECG
      6204**PROC     5451--CALL     5929--CALL
FREEEV
      6195**PROC     5728--CALL     5765--CALL     5775--CALL     5812--CALL     5819--CALL     5827--CALL
      5856--CALL     5883--CALL
FREEJRNL
      6240**PROC     5437--CALL     5979--CALL
FREE_RD_EV
      5827**LABEL    5738--GOTO
GDS_CG
      4236**DCL      5193<>CALL     5279<>CALL     6226<>CALL     6228<>CALL
GDS_CG.V
      4236**DCL      4236--DCLINIT
GDS_CG.V.SEGSIZE#
      4239**DCL      5181<<ASSIGN   6225<<ASSIGN   6227<<ASSIGN
GDS_JFID
      4268**DCL      5202<>CALL     5326<>CALL     5397<>CALL
GDS_JFID.V
      4268**DCL      4268--DCLINIT
GDS_JFID.V.SEGSIZE#
      4271**DCL      5178<<ASSIGN   5324<<ASSIGN   5396<<ASSIGN
GDS_JRNL
      4252**DCL      5182<>CALL     5897<>CALL     6277<>CALL     6279<>CALL
GDS_JRNL.V
      4252**DCL      4252--DCLINIT
GDS_JRNL.V.SEGSIZE#
      4255**DCL      5180<<ASSIGN   6276<<ASSIGN   6278<<ASSIGN
GDS_SN
      4284**DCL      5203<>CALL     5335<>CALL     5523<>CALL     6018<>CALL
GDS_SN.V
      4284**DCL      4284--DCLINIT
GDS_SN.V.SEGSIZE#
      4287**DCL      5179<<ASSIGN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:232  
GETCGINFO
      5319**LABEL    5327--GOTO
GETJDCB
      5888**PROC     5381--CALL     5478--CALL     5626--CALL
GET_JRNL_DCB
      3479**DCL      5274<>CALL     5889<>CALL     6183<>CALL
GET_JRNL_DCB.V
      3480**DCL      3479--DCLINIT
GET_MESS_ATTR
      4216**DCL      5790<>CALL
GET_MESS_ATTR.ONEATTR_
      4218**DCL      5788<<ASSIGN
GET_MESS_ATTR.V
      4219**DCL      4216--DCLINIT
GET_MESS_ATTR.V.DCB#
      4219**DCL      5789<<ASSIGN
GREETING
      5140**DCL      5161<>CALL
GREETING.STATION_
      5142**DCL      5142--REDEF
GREETING.V
      5143**DCL      5140--DCLINIT
GREETING.V.DVBYTE.VFC#
      5149**DCL      5149--REDEF
GSNS1
      5333**LABEL    5336--GOTO
GSNS2
      5335**LABEL    5349--GOTO
GSNSP
      5521**LABEL    5524--GOTO
GSNSP IN PROCEDURE OPN_CG_JRNL
      6016**LABEL    6019--GOTO
HAVECG
      5317**LABEL    5269--GOTO
HISACCN
      6141**PROC     5568--CALL     5589--CALL     5617--CALL     5681--CALL     6003--CALL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:233  
HISACCN IN PROCEDURE HISACCN
      6142**DCL      6141--PROC     6151>>ASSIGN
HISFACCN IN PROCEDURE HISACCN
      6144**DCL      6141--PROC     6153>>ASSIGN
HISNAME IN PROCEDURE HISACCN
      6143**DCL      6141--PROC     6152>>ASSIGN
HISPRIV IN PROCEDURE HISACCN
      6145**DCL      6141--PROC     6154>>ASSIGN
I
      4670**DCL      5205<<DOINDEX  5206>>ASSIGN   5206>>ASSIGN   5295<<ASSIGN   5296>>DOWHILE  5297<<ASSIGN
      5297>>ASSIGN   5299>>ASSIGN   5301>>ASSIGN   5301>>ASSIGN   5444<<ASSIGN   5446>>IF       5480<<ASSIGN
      5481>>DOWHILE  5482<<ASSIGN   5482>>ASSIGN   5484>>ASSIGN   5486>>ASSIGN   5486>>ASSIGN   6114<<DOINDEX
      6115>>ASSIGN
I IN PROCEDURE CLSCGMSG
      6073**DCL      6075<<CALLBLT  6076>>CALLBLT  6081<<CALLBLT  6082>>ASSIGN
I IN PROCEDURE CLSJMSG
      6090**DCL      6092<<CALLBLT  6093>>CALLBLT  6098<<CALLBLT  6100>>ASSIGN
I$ IN PROCEDURE FREECG
      6205**DCL      6208<<ASSIGN   6210>>DOWHILE  6210>>DOWHILE  6210>>DOWHILE  6211>>ASSIGN   6212<<ASSIGN
      6212>>ASSIGN   6215>>ASSIGN   6217>>ASSIGN
I$ IN PROCEDURE FREEJRNL
      6241**DCL      6245<<ASSIGN   6246>>ASSIGN   6247>>ASSIGN   6251>>ASSIGN   6252>>ASSIGN   6253>>ASSIGN
      6253>>ASSIGN   6254<<ASSIGN   6254>>ASSIGN   6254>>ASSIGN   6258>>ASSIGN   6260<<ASSIGN   6262>>DOWHILE
      6262>>DOWHILE  6262>>DOWHILE  6263>>ASSIGN   6264<<ASSIGN   6264>>ASSIGN   6267>>ASSIGN   6269>>ASSIGN
INITXXX
      5221**LABEL    5219--CALLALT  5248--CALLALT
J$
      4642**DCL      5184<<ASSIGN   5185>>DOWHILE  5186>>ASSIGN   5187>>ASSIGN   5187>>ASSIGN   5188<<ASSIGN
      5188>>ASSIGN   5370<<ASSIGN   5371>>DOWHILE  5372>>IF       5372>>IF       5372>>IF       5376<<ASSIGN
      5376>>ASSIGN   5382>>ASSIGN   5383>>ASSIGN   5384>>ASSIGN   5385>>ASSIGN   5386>>ASSIGN   5387>>ASSIGN
      5390>>ASSIGN   5393>>ASSIGN   5394>>ASSIGN   5394>>ASSIGN   5413>>ASSIGN   5435>>ASSIGN   5469<<ASSIGN
      5471>>DOWHILE  5472>>IF       5474<<ASSIGN   5474>>ASSIGN   5484>>ASSIGN   5486>>ASSIGN   5488>>ASSIGN
      5489>>ASSIGN   5490>>ASSIGN   5498>>ASSIGN   5500>>ASSIGN   5504>>ASSIGN   5506>>ASSIGN   5512>>ASSIGN
      5526>>ASSIGN   5527>>ASSIGN   5529>>ASSIGN   5531>>ASSIGN   5534>>ASSIGN   5536>>ASSIGN   5537>>IF
      5538>>ASSIGN   5542>>ASSIGN   5543>>ASSIGN   5544>>ASSIGN   5545>>ASSIGN   5565<<ASSIGN   5567>>IF
      5572>>ASSIGN   5574>>IF       5576>>CALLBLT  5576>>CALLBLT  5579<<ASSIGN   5579>>ASSIGN   5583>>IF
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:234  
      5585<<ASSIGN   5588>>IF       5593>>ASSIGN   5595<<ASSIGN   5595>>ASSIGN   5597>>IF       5605<<ASSIGN
      5605>>ASSIGN   5609<<ASSIGN   5609>>ASSIGN   5627>>ASSIGN   5628>>ASSIGN   5629>>ASSIGN   5630>>ASSIGN
      5631>>ASSIGN   5632>>ASSIGN   5634>>ASSIGN   5635>>ASSIGN   5636>>ASSIGN   5637>>ASSIGN   5639>>ASSIGN
      5639>>ASSIGN   5656>>ASSIGN   5693>>IF       5694>>ASSIGN   5694>>ASSIGN   5823<<ASSIGN   5824>>CALL
      5843<<ASSIGN   5844>>DOWHILE  5845>>IF       5850<<ASSIGN   5850>>ASSIGN   5863<<ASSIGN   5864>>DOWHILE
      5865>>IF       5867<<ASSIGN   5867>>ASSIGN   5873>>IF       5873>>IF       5875>>ASSIGN   5875>>ASSIGN
      5876>>ASSIGN   5880>>CALL     5895<<ASSIGN   5896>>ASSIGN   5898>>DOWHILE  5899>>ASSIGN   5900>>ASSIGN
      5900>>ASSIGN   5901<<ASSIGN   5901>>ASSIGN   5905<<ASSIGN   5906>>ASSIGN   5907>>ASSIGN   5908>>ASSIGN
      5910>>ASSIGN   5911>>ASSIGN   5912>>ASSIGN   5913>>ASSIGN   5935>>IF       5947<<ASSIGN   5948>>DOWHILE
      5949>>IF       5949>>IF       5951>>IF       5952>>ASSIGN   5959<<ASSIGN   5959>>ASSIGN   5965>>ASSIGN
      5966>>IF       5969>>ASSIGN   5972>>IF       5974>>ASSIGN   5977>>ASSIGN   6006>>ASSIGN   6013>>IF
      6015>>IF       6021>>ASSIGN   6022>>ASSIGN   6024>>ASSIGN   6026>>ASSIGN   6029>>ASSIGN   6031>>ASSIGN
      6032>>IF       6033>>ASSIGN   6038>>ASSIGN   6039>>ASSIGN   6040>>ASSIGN   6041>>ASSIGN   6043>>ASSIGN
      6043>>ASSIGN   6053>>IF       6058>>IF       6058>>IF       6092>>CALLBLT  6093>>CALLBLT  6093>>CALLBLT
      6093>>CALLBLT  6128<<ASSIGN   6129>>DOWHILE  6130>>ASSIGN   6131>>IF       6131>>IF       6131>>IF
      6134<<ASSIGN   6134>>ASSIGN   6171>>ASSIGN   6172>>ASSIGN   6173>>ASSIGN   6178>>ASSIGN   6179>>ASSIGN
      6180>>ASSIGN   6244>>IF       6245>>ASSIGN   6262>>DOWHILE  6271>>ASSIGN   6273>>ASSIGN   6274>>ASSIGN
      6281<<ASSIGN   6282>>DOWHILE  6283>>ASSIGN   6284>>ASSIGN   6284>>ASSIGN   6285<<ASSIGN   6285>>ASSIGN
JACCT
      4479**DCL      4303--DCLINIT
JACCT.ACCT#
      4479**DCL      5359>>IF       5372>>IF       5385>>ASSIGN
JASN
      4661**DCL      4305--DCLINIT  5382>>ASSIGN
JATTR
      4558**DCL      5333--ASSIGN   5346--IF       5388--ASSIGN   5521--ASSIGN   5528--ASSIGN   5529<<ASSIGN
      5529>>ASSIGN   5969--ASSIGN   6016--ASSIGN   6023--ASSIGN   6024<<ASSIGN   6024>>ASSIGN   6247--ASSIGN
      6249--ASSIGN   6250--ASSIGN   6254--ASSIGN
JATTR.Q.ASN
      4562**DCL      5512>>ASSIGN   5513>>IF       6013>>IF
JATTR.Q.ID
      4561**DCL      5510>>IF       6011>>IF
JATTR.Q.NUM#
      4564**DCL      5342--ASSIGN   5346>>IF       5383--ASSIGN   5388>>ASSIGN   5522>>IF       5528>>ASSIGN
      5530>>ASSIGN   5531--ASSIGN   5532--ASSIGN   5534--ASSIGN   5873>>IF       6017>>IF       6023>>ASSIGN
      6025>>ASSIGN   6026--ASSIGN   6027--ASSIGN   6029--ASSIGN   6058>>IF       6247>>ASSIGN   6249>>ASSIGN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:235  
      6250>>ASSIGN   6254>>ASSIGN
JATTR.Q.VOL#
      4563**DCL      5536>>ASSIGN   5537>>IF       5538<<ASSIGN   5873>>IF       5875<<ASSIGN   5875>>ASSIGN
      6031>>ASSIGN   6032>>IF       6033<<ASSIGN
JERR
      5873**LABEL    5866--GOTO
JFID.L#
      3659**DCL      3659--IMP-SIZ  5320>>IF       5322>>IF       5322--IF       5324>>ASSIGN   5324--ASSIGN
      5341>>ASSIGN
JFID_V
      4653**DCL      4268--DCLINIT  5318>>ASSIGN   5339>>ASSIGN
JFID_V.BND
      4654**DCL      5322>>IF       5324>>ASSIGN   5395>>IF       5396>>ASSIGN
JFID_V.P$
      4656**DCL      5320>>IF       5322>>IF       5322>>IF       5324>>ASSIGN   5324>>ASSIGN   5340>>ASSIGN
      5341>>ASSIGN
JN
      4672**DCL      5359>>IF       5359>>IF       5372>>IF       5372>>IF       6131>>IF
JNAME
      4506**DCL      4303--DCLINIT  5384>>ASSIGN
JNAME.L#
      4506**DCL      4672--IMP-SIZ  5359>>IF       5359>>IF       5359>>IF       5372>>IF       5372>>IF
      5372>>IF       6130<<ASSIGN   6131>>IF
JNAME.NAME#
      4506**DCL      5359--IF       5372--IF
JOC1 IN PROCEDURE CLSJMSG
      6102**LABEL    6101--CALLALT
JOC2 IN PROCEDURE ERRMSG
      6118**LABEL    6111--CALLALT  6116--CALLALT
JPASS
      4519**DCL      4304--DCLINIT
JREC.LENGTH
      2494**DCL      2497--IMP-SIZ
JRECORD
      4669**DCL      5214--ASSIGN
JRNCANCEL.ACCN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:236  
      2812**DCL      5681<>CALL
JRNCANCEL.FACCN
      2814**DCL      5681<>CALL
JRNCANCEL.FID1.ACCT
      2806**DCL      5679<>CALL
JRNCANCEL.FID1.FNAME
      2803**DCL      5679<>CALL
JRNCANCEL.PRIV
      2815**DCL      5681<>CALL
JRNCANCEL.UNAME
      2813**DCL      5681<>CALL
JRNL
      5097**DCL      5185--DOWHILE  5187--ASSIGN   5895--ASSIGN   5895--ASSIGN   5898--DOWHILE  5900--ASSIGN
      6282--DOWHILE  6284--ASSIGN
JRNL.ACCT
      5109**DCL      5359>>IF       5372>>IF       5385<<ASSIGN   5498<<ASSIGN   5544--ASSIGN   5630<<ASSIGN
      5636--ASSIGN   6040--ASSIGN   6092>>CALLBLT  6093>>CALLBLT  6131>>IF       6172--ASSIGN
JRNL.ASN
      5101**DCL      5382<<ASSIGN   5506<<ASSIGN   5512<<ASSIGN   5545>>ASSIGN   5627<<ASSIGN   5632>>ASSIGN
      5972>>IF       6013>>IF       6015>>IF       6041>>ASSIGN   6053>>IF       6058>>IF
JRNL.ATTR$
      5113**DCL      5386<<ASSIGN   5490<<ASSIGN   5526<<ASSIGN   5529>>ASSIGN   5531>>ASSIGN   5534>>ASSIGN
      5536>>ASSIGN   5537>>IF       5538>>ASSIGN   5631<<ASSIGN   5873>>IF       5873>>IF       5875>>ASSIGN
      5875>>ASSIGN   5966>>IF       5969>>ASSIGN   6021<<ASSIGN   6024>>ASSIGN   6026>>ASSIGN   6029>>ASSIGN
      6031>>ASSIGN   6032>>IF       6033>>ASSIGN   6058>>IF       6244>>IF       6245>>ASSIGN   6253<<ASSIGN
JRNL.CFU
      5100**DCL      5390<<ASSIGN   5472>>IF       5488<<ASSIGN   5639<<ASSIGN   5865>>IF       5949>>IF
      6043<<ASSIGN
JRNL.CGCNT
      5102**DCL      5364<<ASSIGN   5364>>ASSIGN   5394<<ASSIGN   5394>>ASSIGN   5489<<ASSIGN   5694<<ASSIGN
      5694>>ASSIGN   5911<<ASSIGN   5924<<ASSIGN   5924>>ASSIGN   5949>>IF
JRNL.DCB#
      5099**DCL      5413>>ASSIGN   5435>>ASSIGN   5542>>ASSIGN   5572>>ASSIGN   5634>>ASSIGN   5639--ASSIGN
      5656>>ASSIGN   5758>>ASSIGN   5792>>ASSIGN   5824<>CALL     5876>>ASSIGN   5880<>CALL     5910<<ASSIGN
      5965>>ASSIGN   5974--ASSIGN   5977>>ASSIGN   5991>>ASSIGN   6038>>ASSIGN   6043--ASSIGN
JRNL.LNK$
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:237  
      5098**DCL      5187<<ASSIGN   5188>>ASSIGN   5190<<ASSIGN   5376>>ASSIGN   5474>>ASSIGN   5579>>ASSIGN
      5605>>ASSIGN   5850>>ASSIGN   5867>>ASSIGN   5900<<ASSIGN   5901>>ASSIGN   5903<<ASSIGN   5906>>ASSIGN
      5907<<ASSIGN   5959>>ASSIGN   6134>>ASSIGN   6262>>DOWHILE  6264>>ASSIGN   6267<<ASSIGN   6267>>ASSIGN
      6269>>ASSIGN   6273<<ASSIGN   6284<<ASSIGN   6285>>ASSIGN   6287<<ASSIGN
JRNL.NAME
      5106**DCL      5384<<ASSIGN   5543--ASSIGN   5629<<ASSIGN   5635--ASSIGN   6039--ASSIGN   6171--ASSIGN
JRNL.NAME.L
      5107**DCL      5359>>IF       5372>>IF       5484<<ASSIGN   6093>>CALLBLT  6130>>ASSIGN   6131>>IF
JRNL.NAME.TXT
      5108**DCL      5359--IF       5372--IF       5486<<ASSIGN   6093>>CALLBLT  6131--IF
JRNL.PSN
      5104**DCL      5383<<ASSIGN   5500<<ASSIGN   5504>>ASSIGN   5628<<ASSIGN   5637>>ASSIGN   5845>>IF
      6006>>ASSIGN   6173>>ASSIGN   6271>>ASSIGN
JRNL.RENAME.L
      5111**DCL      5574>>IF       5576>>CALLBLT  5913<<ASSIGN
JRNL.RENAME.TXT
      5112**DCL      5576>>CALLBLT
JRNL.UTS
      5103**DCL      5912<<ASSIGN   5951>>IF       5952--ASSIGN
JRNL$
      2467**DCL      2468--IMP-PTR  2488--IMP-PTR  2498--IMP-PTR  2505--IMP-PTR  2511--IMP-PTR  5214<<ASSIGN
      5215>>ASSIGN   5402>>ASSIGN   5403>>ASSIGN   5404>>ASSIGN   5405>>ASSIGN   5406>>ASSIGN   5407>>ASSIGN
      5408>>ASSIGN   5409>>ASSIGN   5410>>ASSIGN   5411>>ASSIGN   5414>>ASSIGN   5985>>ASSIGN   5986>>ASSIGN
      5987>>ASSIGN   5988>>ASSIGN   5990>>ASSIGN
JRNLACTIVE$
      4644**DCL      5192<<ASSIGN   5370>>ASSIGN   5469>>ASSIGN   5565>>ASSIGN   5843>>ASSIGN   5863>>ASSIGN
      5907>>ASSIGN   5908<<ASSIGN   5947>>ASSIGN   6128>>ASSIGN   6260>>ASSIGN   6269<<ASSIGN   6275>>IF
JRNLCLSD
      4870**DCL      5491>>ASSIGN
JRNLERR
      5441**LABEL    5319--CALLALT  5326--CALLALT  5335--CALLALT  5350--GOTO     5363--CALLALT  5381--CALLALT
      5415--CALLALT  5424--CALLALT  5658--CALLALT
JRNLFREE$
      4643**DCL      5183<<ASSIGN   5184>>ASSIGN   5894>>IF       5896<<ASSIGN   5905>>ASSIGN   5906<<ASSIGN
      6273>>ASSIGN   6274<<ASSIGN   6280<<ASSIGN   6281>>ASSIGN
JRNLIST.ACCN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:238  
      2892**DCL      5568<>CALL     5589<>CALL
JRNLIST.FACCN
      2894**DCL      5568<>CALL     5589<>CALL
JRNLIST.PRIV
      2895**DCL      5568<>CALL     5589<>CALL
JRNLIST.UNAME
      2893**DCL      5568<>CALL     5589<>CALL
JRNLSTAR
      4915**DCL      5494>>ASSIGN
JRNL_EVENTS
      3170**DCL      5218<>CALL
JRNL_EVENTS.V
      3170**DCL      3170--DCLINIT
JRNL_EXISTS
      5393**LABEL    5375--GOTO
JRNL_FIT
      5091**DCL      4035--DCLINIT  5507--ASSIGN   6008--ASSIGN
JRNL_GHST
      3393**DCL      3270--DCLINIT
JRNL_V
      4649**DCL      4252--DCLINIT
JRNL_V.BND
      4650**DCL      5185>>DOWHILE  5895>>ASSIGN   5898>>DOWHILE  6275>>IF       6276>>ASSIGN   6282>>DOWHILE
JRNL_V.P$
      4652**DCL      5183>>ASSIGN   5185>>DOWHILE  5895>>ASSIGN   5898>>DOWHILE  6280>>ASSIGN   6282>>DOWHILE
JRNL_XCON
      3184**DCL      5217<>CALL
JRNL_XCON.V
      3185**DCL      3184--DCLINIT
JRNOPN.ACCN
      2628**DCL      6003<>CALL
JRNOPN.CODE
      2620**DCL      5249>>DOCASE
JRNOPN.DCB$
      2627**DCL      5293--ASSIGN
JRNOPN.FACCN
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:239  
      2630**DCL      6003<>CALL
JRNOPN.P$
      2626**DCL      5263>>ASSIGN
JRNOPN.PRIV
      2631**DCL      6003<>CALL
JRNOPN.UNAME
      2629**DCL      6003<>CALL
JRNOPN.USER#
      2625**DCL      5294>>ASSIGN
JRNRENAME.ACCN
      2722**DCL      5617<>CALL
JRNRENAME.FACCN
      2724**DCL      5617<>CALL
JRNRENAME.FID1.ACCT
      2712**DCL      5619<>CALL     5630>>ASSIGN
JRNRENAME.FID1.FNAME
      2709**DCL      5619<>CALL     5629>>ASSIGN
JRNRENAME.FID1.SN.SN#
      2716**DCL      5628>>ASSIGN
JRNRENAME.FID2.FNAME
      2719**DCL      5657--ASSIGN
JRNRENAME.PRIV
      2725**DCL      5617<>CALL
JRNRENAME.UNAME
      2723**DCL      5617<>CALL
JSN$
      4634**DCL      5204<<ASSIGN   5332>>ASSIGN   5387>>ASSIGN   5388<<ASSIGN   5520>>ASSIGN   5527>>ASSIGN
      5528<<ASSIGN   6022>>ASSIGN   6023<<ASSIGN   6248>>IF       6258<<ASSIGN
K
      4671**DCL      5263<<ASSIGN   5264>>IF       5268>>IF       5292>>ASSIGN   5295>>ASSIGN   5303>>ASSIGN
      5305>>ASSIGN   5472>>IF       5480>>ASSIGN   5488>>ASSIGN   5492>>IF       5495>>IF       5498>>ASSIGN
      5500>>ASSIGN   5862<<ASSIGN   5865>>IF
LOCJRNL
      6121**PROC     5619--CALL     5679--CALL
LST1
      5568**LABEL    5584--GOTO
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:240  
LST2
      5579**LABEL    5573--CALLALT
LST22
      5583**LABEL    5606--GOTO
LST33
      5588**LABEL    5611--GOTO
LST4
      5589**LABEL    5602--GOTO
LST5
      5595**LABEL    5594--CALLALT
LST6
      5604**LABEL    5570--CALLALT
LST7
      5608**LABEL    5591--CALLALT
M$CGINFO
        40**DCL-ENT  5319--CALL
M$CLOSE
        19**DCL-ENT  5445--CALL     5460--CALL     5658--CALL     5698--CALL     5926--CALL     5970--CALL
M$CVOL
        22**DCL-ENT  5877--CALL
M$ERRMSG
        82**DCL-ENT  6111--CALL
M$EVENT
        74**DCL-ENT  5218--CALL
M$EXIT
        31**DCL-ENT  5167--CALL
M$FDS
        54**DCL-ENT  6226--CALL     6277--CALL
M$FID
        82**DCL-ENT  5343--CALL
M$FWCG
        40**DCL-ENT  5790--CALL
M$GDS
        54**DCL-ENT  5182--CALL     5193--CALL     5202--CALL     5203--CALL     5279--CALL     5326--CALL
      5335--CALL     5397--CALL     5523--CALL     5897--CALL     6018--CALL     6228--CALL     6279--CALL
M$GETDCB
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:241  
        25**DCL-ENT  5274--CALL     5889--CALL     6183--CALL
M$KEYIN
        24**DCL-ENT  6084--CALL     6101--CALL     6116--CALL
M$OPEN
        19**DCL-ENT  5224--CALL     5313--CALL     5546--CALL     5638--CALL     6042--CALL     6186--CALL
M$READ
        20**DCL-ENT  5225--CALL     5424--CALL     5729--CALL     5766--CALL     5813--CALL
M$RELDCB
        25**DCL-ENT  5436--CALL     5450--CALL     5928--CALL     5978--CALL     6188--CALL     6190--CALL
M$RELRES
        26**DCL-ENT  5854--CALL     5975--CALL     6220--CALL     6272--CALL
M$TIME
        86**DCL-ENT  5412--CALL     5756--CALL     5778--CALL     5953--CALL     5989--CALL
M$UNFID
        82**DCL-ENT  5573--CALL     5594--CALL
M$UNLATCH
        39**DCL-ENT  5803--CALL
M$WAIT
        77**DCL-ENT  5235--CALL
M$WRITE
        20**DCL-ENT  5161--CALL     5415--CALL     5575--CALL     5581--CALL     5601--CALL     5727--CALL
      5759--CALL     5797--CALL     5993--CALL
M$XCON
        74**DCL-ENT  5217--CALL
M$XXX
        31**DCL-ENT  5221--CALL     5869--CALL
MYACCN
      6160**PROC     5571--CALL     5592--CALL     5604--CALL     5608--CALL     5654--CALL     5671--CALL
      5688--CALL     6044--CALL
NAME
      5045**DCL      6062>>ASSIGN   6148<<ASSIGN   6162>>ASSIGN
NAME IN PROCEDURE LOCJRNL
      6123**DCL      6121--PROC
NAME.L# IN PROCEDURE LOCJRNL
      6124**DCL      6131>>IF
NAME.TXT IN PROCEDURE LOCJRNL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:242  
      6125**DCL      6131>>IF
NOAUTH
      4780**DCL      5661>>ASSIGN   5706>>ASSIGN
NODCB
      5428**LABEL    5274--CALLALT
NODCB IN PROCEDURE GETJDCB
      5915**LABEL    5889--CALLALT  5897--CALLALT
NOJRNL
      4825**DCL      5708>>ASSIGN
NORENAME
      4960**DCL      5643>>ASSIGN
NOSN IN PROCEDURE OPN_CG_JRNL
      6053**LABEL    6009--CALLALT  6012--GOTO
NOSNERR
      4735**DCL      6055>>ASSIGN   6060>>ASSIGN
NOTOWNER
      5005**DCL      5554>>ASSIGN
NOT_SAME_ASN IN PROCEDURE OPN_CG_JRNL
      6050**LABEL    6014--GOTO
OCBUF
      5040**DCL      6076<<CALLBLT  6081>>CALLBLT  6083--ASSIGN   6093<<CALLBLT  6098>>CALLBLT  6099--ASSIGN
OCERR1 IN PROCEDURE CLSCGMSG
      6085**LABEL    6084--CALLALT
OCERRBUF
      5042**DCL      4431--DCLINIT  6115--ASSIGN
OCMSG
      4411**DCL      6084<>CALL     6101<>CALL     6116<>CALL
OCMSG.MESS_
      4411**DCL      6115<<ASSIGN
OCMSG.MESS_.BOUND
      4411**DCL      6082<<ASSIGN   6100<<ASSIGN
OCMSG.MESS_.BUF$
      4412**DCL      6083<<ASSIGN   6099<<ASSIGN
OCMSG.V
      4414**DCL      4411--DCLINIT
OPNJER1
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:243  
      5437**LABEL    5436--CALLALT
OPNJER2
      5442**LABEL    5438--GOTO
OPNJERR
      5435**LABEL    5391--CALLALT  5493--GOTO     5496--GOTO     5555--GOTO
OPNJERR IN PROCEDURE OPN_CG_JRNL
      6047**LABEL    6018--CALLALT  6042--CALLALT
OPNJERR0
      5434**LABEL    5505--CALLALT  5511--GOTO     5523--CALLALT  5546--CALLALT
OPNJRNL
      5537**LABEL    5508--CALLALT  5514--GOTO
OPNJRNL IN PROCEDURE OPN_CG_JRNL
      6033**LABEL    6054--GOTO     6067--GOTO
OPN_ANSWER
      2590**DCL      3427--DCLINIT  3428--DCLINIT  5261--ASSIGN   5615--ASSIGN   5677--ASSIGN
OPN_ANSWER.ERR
      2591**DCL      5262<<ASSIGN   5428<<ASSIGN   5432<<ASSIGN   5434<<ASSIGN   5441<<ASSIGN   5491<<ASSIGN
      5494<<ASSIGN   5497<<ASSIGN   5554<<ASSIGN   5616<<ASSIGN   5643<<ASSIGN   5661<<ASSIGN   5668<<ASSIGN
      5678<<ASSIGN   5706<<ASSIGN   5708<<ASSIGN   6047<<ASSIGN   6050<<ASSIGN   6055<<ASSIGN   6060<<ASSIGN
OPN_CG_JRNL
      6001**PROC     5391--CALL
OPN_CSCG
      3269**DCL      5224<>CALL
OPN_CSCG.ACSVEH_
      3271**DCL      3272--REDEF
OPN_CSCG.ALTKEYS_
      3277**DCL      3278--REDEF    3278--REDEF
OPN_CSCG.HDR_
      3276**DCL      3277--REDEF
OPN_CSCG.TAB_
      3275**DCL      3276--REDEF
OPN_CSCG.UHL_
      3269**DCL      3270--REDEF    3270--REDEF
OPN_CSCG.V
      3278**DCL      3269--DCLINIT
OPN_CSCG.V.FSN#
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:244  
      3309**DCL      3309--REDEF    3309--REDEF
OPN_CSCG.WSN_
      3275**DCL      3275--REDEF
OPN_JRNL
      3921**DCL      5546<>CALL     5638<>CALL     6042<>CALL
OPN_JRNL.ACCT_
      3925**DCL      5544<<ASSIGN   5636<<ASSIGN   6040<<ASSIGN
OPN_JRNL.ACSVEH_
      3923**DCL      3924--REDEF
OPN_JRNL.ALTKEYS_
      3929**DCL      3930--REDEF    3930--REDEF
OPN_JRNL.HDR_
      3928**DCL      3929--REDEF
OPN_JRNL.NAME_
      3922**DCL      5543<<ASSIGN   5635<<ASSIGN   6039<<ASSIGN
OPN_JRNL.SN_
      3921**DCL      5534<<ASSIGN   6029<<ASSIGN
OPN_JRNL.TAB_
      3927**DCL      3928--REDEF
OPN_JRNL.UHL_
      3921**DCL      3922--REDEF    3922--REDEF
OPN_JRNL.V
      3930**DCL      3921--DCLINIT
OPN_JRNL.V.ASN#
      3940**DCL      5545<<ASSIGN   5632<<ASSIGN   6041<<ASSIGN
OPN_JRNL.V.DCB#
      3930**DCL      5542<<ASSIGN   5553--IF       5634<<ASSIGN   5641--IF       6038<<ASSIGN
OPN_JRNL.V.FSN#
      3961**DCL      3961--REDEF    3961--REDEF
OPN_JRNL.V.RES#
      3945**DCL      4305--DCLINIT  5503<<ASSIGN   5535<<ASSIGN   5633<<ASSIGN   6005<<ASSIGN   6030<<ASSIGN
OPN_JRNL.V.VOL#
      3955**DCL      5536<<ASSIGN   6031<<ASSIGN
OPN_JRNL.WSN_
      3927**DCL      3927--REDEF
OP_CG_ERR
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:245  
      5432**LABEL    5279--CALLALT  5313--CALLALT
OUTLINE
      5154**DCL      5141--DCLINIT  5142--DCLINIT  5159<<CALLBLT
P$ IN PROCEDURE FREECG
      6206**DCL      6209<<ASSIGN   6211<<ASSIGN   6214>>IF       6215>>ASSIGN
P$ IN PROCEDURE FREEJRNL
      6242**DCL      6246<<ASSIGN   6247<<ASSIGN   6247>>ASSIGN   6248>>IF       6249>>ASSIGN   6249>>ASSIGN
      6250>>ASSIGN   6251>>ASSIGN   6252>>ASSIGN   6255<<ASSIGN   6261<<ASSIGN   6263<<ASSIGN   6266>>IF
      6267>>ASSIGN
P$$
      4677**DCL      5387<<ASSIGN   5527<<ASSIGN   6022<<ASSIGN   6252<<ASSIGN   6252>>ASSIGN   6253>>ASSIGN
PRIV
      5047**DCL      6064>>ASSIGN   6150<<ASSIGN   6164>>ASSIGN
QCGJ1
      5457**LABEL    5460--CALLALT
QUITCGJRNL
      5456**LABEL    5321--GOTO
RDCGERR
      5816**LABEL    5766--CALLALT  5790--CALLALT  5803--CALLALT  5813--CALLALT
RDSTA.MSGIDXT
      3777**DCL      3780--REDEF
RDSTA.MSGTYP#
      3771**DCL      5743>>IF
RD_CSCG
      3331**DCL      5225<>CALL     5729<>CALL
RD_CSCG.STATION_
      3334**DCL      3335--REDEF
RD_CSCG.V
      3335**DCL      3331--DCLINIT
RD_CSCG.V.DVBYTE.REREAD#
      3346**DCL      3346--REDEF
RD_CSCG.V.INDX#
      3344**DCL      3344--REDEF
RELCG1 IN PROCEDURE FREECG
      6221**LABEL    6220--CALLALT
RELJ1 IN PROCEDURE FREEJRNL
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:246  
      6273**LABEL    6272--CALLALT
RELRES
      4344**DCL      5854<>CALL     6220<>CALL     6272<>CALL
RELRES.V
      4346**DCL      4344--DCLINIT
RELTAP
      4361**DCL      5975<>CALL
RELTAP.V
      4363**DCL      4361--DCLINIT
REL_DCB
      3494**DCL      5436<>CALL     5450<>CALL     5928<>CALL     5978<>CALL     6188<>CALL     6190<>CALL
REL_DCB.V
      3494**DCL      3494--DCLINIT
REL_DCB.V.DCB#
      3494**DCL      5435<<ASSIGN   5449<<ASSIGN   5927<<ASSIGN   5977<<ASSIGN   6184<<ASSIGN
RESTAP
      4394**DCL      4362--DCLINIT
RESTAP.NN#
      4394**DCL      5973<<ASSIGN
RESTAP.PRLIST.RNAME#
      4394**DCL      4395--REDEF    5974<<ASSIGN
RNM2
      5708**LABEL    5679--CALLALT
SN.SN#
      4532**DCL      5383>>ASSIGN
SNSZ
      4674**DCL      4673--IMP-SIZ  5333<<ASSIGN   5334>>IF       5342>>ASSIGN   5521<<ASSIGN   5522>>IF
      5530<<ASSIGN   5532>>ASSIGN   5532>>ASSIGN   5534>>ASSIGN   6016<<ASSIGN   6017>>IF       6025<<ASSIGN
      6027>>ASSIGN   6027>>ASSIGN   6029>>ASSIGN   6250<<ASSIGN   6251>>ASSIGN   6251>>ASSIGN
SN_V
      4657**DCL      4284--DCLINIT
SN_V.BND
      4658**DCL      5333>>ASSIGN   5346>>IF       5521>>ASSIGN   6016>>ASSIGN
SN_V.P$
      4660**DCL      5204>>ASSIGN   5333>>ASSIGN   5346>>IF       5521>>ASSIGN   6016>>ASSIGN
STARSTAR
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:247  
      5165**LABEL    5166--CALLALT
TESTERR IN PROCEDURE OPN_CG_JRNL
      6057**LABEL    6007--CALLALT
TESTOPEN
      6169**PROC     5505--CALL     5570--CALL     5653--CALL     5683--CALL     6007--CALL
TESTOPENCG IN PROCEDURE TESTOPEN
      6176**ENTRY    5591--CALL
TOPN_JRNL
      4030**DCL      6186<>CALL
TOPN_JRNL.ACCT_
      4034**DCL      6172<<ASSIGN   6179<<ASSIGN
TOPN_JRNL.ACSVEH_
      4032**DCL      4033--REDEF
TOPN_JRNL.ALTKEYS_
      4038**DCL      4039--REDEF    4039--REDEF
TOPN_JRNL.HDR_
      4037**DCL      4038--REDEF
TOPN_JRNL.NAME_
      4031**DCL      6171<<ASSIGN   6178<<ASSIGN
TOPN_JRNL.TAB_
      4036**DCL      4037--REDEF
TOPN_JRNL.UHL_
      4030**DCL      4031--REDEF    4031--REDEF
TOPN_JRNL.V
      4039**DCL      4030--DCLINIT
TOPN_JRNL.V.DCB#
      4039**DCL      6185<<ASSIGN
TOPN_JRNL.V.FSN#
      4070**DCL      4070--REDEF    4070--REDEF
TOPN_JRNL.WSN_
      4036**DCL      4036--REDEF
TSTERR IN PROCEDURE TESTOPEN
      6190**LABEL    6186--CALLALT
TSTERR1 IN PROCEDURE TESTOPEN
      6191**LABEL    6183--CALLALT
TSTOPNERR
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:248  
      5668**LABEL    5638--CALLALT  5653--CALLALT  5686--GOTO
TSTOPNERR1
      5669**LABEL    5649--GOTO
UNF_LIST
      4325**DCL      5573<>CALL     5594<>CALL
UNF_LIST.V
      4329**DCL      4325--DCLINIT
UNF_LIST.V.DCB#
      4329**DCL      5572<<ASSIGN   5593<<ASSIGN
VLP_RPSN
      4379**DCL      4345--DCLINIT
VLP_RPSN.NN#
      4379**DCL      5852<<ASSIGN   6218<<ASSIGN   6270<<ASSIGN
VLP_RPSN.RPLIST.PSN#
      4379**DCL      5853<<ASSIGN   6219<<ASSIGN   6271<<ASSIGN
WAIT_CSCG
      3199**DCL      5235<>CALL
WAIT_CSCG.V
      3200**DCL      3199--DCLINIT
WRBERC
      5983**PROC     5363--CALL     5773--CALL     5837--CALL
WRBERC1 IN PROCEDURE WRBERC
      5996**LABEL    5993--CALLALT
WRJERR
      5823**LABEL    5759--CALLALT  5773--CALLALT  5797--CALLALT  5877--CALLALT
WR_CG_JRNL
      4091**DCL      5415<>CALL     5759<>CALL     5797<>CALL     5993<>CALL
WR_CG_JRNL.BUF_
      4091**DCL      5414<<ASSIGN   5757<<ASSIGN   5793<<ASSIGN   5990<<ASSIGN
WR_CG_JRNL.BUF_.BOUND
      4091**DCL      5794<<ASSIGN
WR_CG_JRNL.STATION_
      4093**DCL      4093--REDEF
WR_CG_JRNL.V
      4094**DCL      4091--DCLINIT
WR_CG_JRNL.V.DCB#
PL6.E3A0      #001=FJJ$JAY File=FJJ$JAY.:E05TSI                                  TUE 07/29/97 15:28 Page:249  
      4094**DCL      5413<<ASSIGN   5758<<ASSIGN   5792<<ASSIGN   5991<<ASSIGN
WR_CG_JRNL.V.DVBYTE.VFC#
      4100**DCL      4100--REDEF
WR_CSCG_STA
      3452**DCL      3428--DCLINIT
WR_CSCG_STA.MSGIDXT
      3462**DCL      3465--REDEF
WR_CSCG_STA.MSGTYP#
      3456**DCL      5561<<ASSIGN   5726<<ASSIGN
WR_CSCG_STA.STATION#
      3456**DCL      5560<<ASSIGN   5725<<ASSIGN
WR_JRNL_RESULTS
      3426**DCL      5575<>CALL     5581<>CALL     5601<>CALL     5727<>CALL
WR_JRNL_RESULTS.BUF_
      3426**DCL      5261<<ASSIGN   5562<<ASSIGN   5615<<ASSIGN   5677<<ASSIGN
WR_JRNL_RESULTS.STATION_
      3428**DCL      3428--REDEF
WR_JRNL_RESULTS.V
      3429**DCL      3426--DCLINIT
WR_JRNL_RESULTS.V.DVBYTE.VFC#
      3435**DCL      3435--REDEF
XDCB
      5049**DCL      3480--DCLINIT  5307>>ASSIGN   5910>>ASSIGN   6184>>ASSIGN   6185>>ASSIGN   6187--ASSIGN
XIT_CSCG_RD
      5725**LABEL    5362--GOTO     5447--GOTO     5473--GOTO     5478--CALLALT  5599--GOTO     5626--CALLALT
XSF$LOCCODP
      4621**DCL-ENT  5508--CALL     6009--CALL

PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:250  
     1382        1        /*M*  Process events for Journal Ghost                                */
     1383        2        /*T***********************************************************/
     1384        3        /*T*                                                         */
     1385        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1386        5        /*T*                                                         */
     1387        6        /*T***********************************************************/
     1388        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
     1389        8        FJJ$EVENT: PROC ASYNC;
     1390        9        /**/
     1391       10    1   DCL B$TCB$ PTR SYMREF;
     1392       11
     1393       12    1   DCL FOI$LDTRC ENTRY(4) ALTRET;
     1394       13        /**/
     1395       14        %INCLUDE CP_6;
     1396       95        %INCLUDE FJM_MACROS_C;
     1397      234        %INCLUDE FJ_SCODE_C;
     1398      242        %INCLUDE JG_EVID_C;
     1399      467        %B$TCB;
     1400      470        %B$NWIO;
     1401      555        %B$EXCFR;
     1402      573        %B$JRNLERR;
     1403      585        %SUB_EXC;
     1404      632        %INCLUDE FJ_DATA_R;
     1405      644        %FJ$SUBS;
     1406      651    1   DCL I UBIN;
     1407      652    1   DCL CHAR8 CHAR(8) BASED;
     1408      653        /**/
     1409      654    2         DO INHIBIT;
     1410      655    3            DO WHILE (FJ_EVFREE<0);
     1411      656    3               END;                      /* LUF if no free entries             */
     1412      657    2            I=FJ_EVFREE;
     1413      658    2            FJ_EVFREE=FJ_EV.LNK(FJ_EVFREE);
     1414      659    2            IF FJ_EVTL < 0 THEN
     1415      660    2               FJ_EVHD = I;
     1416      661    2            ELSE
     1417      662    2               FJ_EV.LNK(FJ_EVTL)=I;
     1418      663    2            FJ_EVTL=I;
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:251  
     1419      664    2            FJ_EV.LNK(I)=-1;
     1420      665    2            IF B$TCB$->B$TCB.STK$->B$EXCFR.SUBC = %SUBC_JRNLERR# THEN
     1421      666    3            DO;
     1422      667    3               FJ_EV.EVID(FJ_EVTL)=%JRNL_ERR_EV#;
     1423      668    3               FJ_EV.DCB#(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$JRNLERR.DCB#;
     1424      669    3               END;
     1425      670    2            ELSE
     1426      671    2               IF B$TCB$->B$TCB.STK$->B$NWIO.SUBC = JG_SETDSMT# THEN
     1427      672    3               DO;
     1428      673    3                  FJ_EV.STA(FJ_EVTL)=ADDR(B$TCB$->B$TCB.STK$->B$NWIO.TYC)->CHAR8;
     1429      674    3                  FJ_EV.EVID(FJ_EVTL)=%SET_DSMNT_EV#;
     1430      675    3                  END;
     1431      676    2               ELSE
     1432      677    2                  IF B$TCB$->B$TCB.STK$->B$NWIO.EVID >= 1000 THEN
     1433      678    3                  DO;
     1434      679    3                     FJ_EV.CG#(FJ_EVTL) = B$TCB$->B$TCB.STK$->B$NWIO.EVID-1000;
     1435      680    3                     FJ_EV.EVID(FJ_EVTL) = %CG_RD_EV#;
     1436      681    3                     END;
     1437      682    2                  ELSE
     1438      683    3                  DO;
     1439      684    3                     FJ_EV.STA(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.CGPARM.STATION#;
     1440      685    3                     FJ_EV.MSG(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.CGPARM.MSGTYP#;
     1441      686    3                     FJ_EV.EVID(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.EVID;
     1442      687    3                     END;
     1443      688    2            FJ_EV.ERR(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.ERR;
     1444      689    2            FJ_EV.ARS(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.ARS;
     1445      690    2            RETURN;
     1446      691    2            END;
     1447      692        %EJECT;
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:252  
     1448      693    1   FJJ$XCON: ENTRY ASYNC;
     1449      694        /**/
     1450      695        /*            snap and LDTRC to get fresh copy     */
     1451      696    1         CALL FOI$LDTRC (%S$JXCON,'0612'O,'12'O,'JAYS    ');
     1452      697
     1453      698        /*S*  SCREECH_CODE: FJJ-S$JXCON
     1454      699              TYPE:         SNAP
     1455      700              MESSAGE:      JAYS has aborted
     1456      701              REMARKS:      Following the snap JAYS will LDTRC to itself.
     1457      702        */
     1458      703    1   END;
     1459      704        %EOD;

PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:253  
--  Include file information  --

   FJ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   FJ_SCODE_C.:E05TOU  is referenced.
   FJM_MACROS_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FJJ$EVENT.

   Procedure FJJ$EVENT requires 95 words for executable code.
   Procedure FJJ$EVENT requires 4 words of local(AUTO) storage.

PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:254  

 Object Unit name= FJJ$EVENT                                  File name= FJJ$JAY.:E05TOU
 UTS= JUL 29 '97 15:29:44.24 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS      2      2  FJJ$EVENT
    2   Proc  even  none    95    137  FJJ$EVENT
    3  RoData even  none     7      7  FJJ$EVENT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes     Async       0  FJJ$EVENT
     2    130                  yes     Async       0  FJJ$XCON

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       4 FOI$LDTRC
                       nStd      0 X66_AAUTO
                       nStd      0 X66_AARET
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:255  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$TCB$                                M$UC                                  FJ_EV
     FJ_EVHD                               FJ_EVTL                               FJ_EVFREE
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:256  


     1382        1        /*M*  Process events for Journal Ghost                                */
     1383        2        /*T***********************************************************/
     1384        3        /*T*                                                         */
     1385        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1386        5        /*T*                                                         */
     1387        6        /*T***********************************************************/
     1388        7        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
     1389        8        FJJ$EVENT: PROC ASYNC;

      8  2 000000   000000 700200 xent  FJJ$EVENT    TSX0  ! X66_AAUTO
         2 000001   000004 000000                    ZERO    4,0

     1390        9        /**/
     1391       10    1   DCL B$TCB$ PTR SYMREF;
     1392       11
     1393       12    1   DCL FOI$LDTRC ENTRY(4) ALTRET;
     1394       13        /**/
     1395       14        %INCLUDE CP_6;
     1396       95        %INCLUDE FJM_MACROS_C;
     1397      234        %INCLUDE FJ_SCODE_C;
     1398      242        %INCLUDE JG_EVID_C;
     1399      467        %B$TCB;
     1400      470        %B$NWIO;
     1401      555        %B$EXCFR;
     1402      573        %B$JRNLERR;
     1403      585        %SUB_EXC;
     1404      632        %INCLUDE FJ_DATA_R;
     1405      644        %FJ$SUBS;
     1406      651    1   DCL I UBIN;
     1407      652    1   DCL CHAR8 CHAR(8) BASED;
     1408      653        /**/
     1409      654    2         DO INHIBIT;

     1410      655    3            DO WHILE (FJ_EVFREE<0);

    655  2 000002   000000 235200 xsym               LDA   ! FJ_EVFREE
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:257  
         2 000003   000006 605200 2                  TPL   ! s:657

     1411      656    3               END;                      /* LUF if no free entries             */

    656  2 000004   000000 235200 xsym               LDA   ! FJ_EVFREE
         2 000005   000004 604200 2                  TMI   ! s:656

     1412      657    2            I=FJ_EVFREE;

    657  2 000006   200003 755300                    STA   ! I,,AUTO

     1413      658    2            FJ_EVFREE=FJ_EV.LNK(FJ_EVFREE);

    658  2 000007   000000 236200 xsym               LDQ   ! FJ_EVFREE
         2 000010   000011 402207                    MPY   ! 9,DL
         2 000011   000000 235206 xsym               LDA   ! FJ_EV,QL
         2 000012   000000 755200 xsym               STA   ! FJ_EVFREE

     1414      659    2            IF FJ_EVTL < 0 THEN

    659  2 000013   000000 236200 xsym               LDQ   ! FJ_EVTL
         2 000014   000020 605200 2                  TPL   ! s:662

     1415      660    2               FJ_EVHD = I;

    660  2 000015   200003 235300                    LDA   ! I,,AUTO
         2 000016   000000 755200 xsym               STA   ! FJ_EVHD
         2 000017   000023 710200 2                  TRA   ! s:663

     1416      661    2            ELSE
     1417      662    2               FJ_EV.LNK(FJ_EVTL)=I;

    662  2 000020   000011 402207                    MPY   ! 9,DL
         2 000021   200003 235300                    LDA   ! I,,AUTO
         2 000022   000000 755206 xsym               STA   ! FJ_EV,QL

     1418      663    2            FJ_EVTL=I;
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:258  

    663  2 000023   000000 755200 xsym               STA   ! FJ_EVTL

     1419      664    2            FJ_EV.LNK(I)=-1;

    664  2 000024   200003 236300                    LDQ   ! I,,AUTO
         2 000025   000011 402207                    MPY   ! 9,DL
         2 000026   000001 335207                    LCA   ! 1,DL
         2 000027   000000 755206 xsym               STA   ! FJ_EV,QL

     1420      665    2            IF B$TCB$->B$TCB.STK$->B$EXCFR.SUBC = %SUBC_JRNLERR# THEN

    665  2 000030   000000 470600 xsym               LDP0  ! B$TCB$
         2 000031   000001 471700                    LDP1  ! 1,,PR0
         2 000032   100100 720300                    LXL0  ! 64,,PR1
         2 000033   000003 100203                    CMPX0 ! 3,DU
         2 000034   000045 601200 2                  TNZ   ! s:671

     1421      666    3            DO;

     1422      667    3               FJ_EV.EVID(FJ_EVTL)=%JRNL_ERR_EV#;

    667  2 000035   000000 236200 xsym               LDQ   ! FJ_EVTL
         2 000036   000011 402207                    MPY   ! 9,DL
         2 000037   000002 235207                    LDA   ! 2,DL
         2 000040   000001 755206 xsym               STA   ! FJ_EV+1,QL

     1423      668    3               FJ_EV.DCB#(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$JRNLERR.DCB#;

    668  2 000041   000001 471700                    LDP1  ! 1,,PR0
         2 000042   100101 235300                    LDA   ! 65,,PR1
         2 000043   000003 755206 xsym               STA   ! FJ_EV+3,QL

     1424      669    3               END;

    669  2 000044   000117 710200 2                  TRA   ! s:688

PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:259  
     1425      670    2            ELSE
     1426      671    2               IF B$TCB$->B$TCB.STK$->B$NWIO.SUBC = JG_SETDSMT# THEN

    671  2 000045   000010 100203                    CMPX0 ! 8,DU
         2 000046   000062 601200 2                  TNZ   ! s:677

     1427      672    3               DO;

     1428      673    3                  FJ_EV.STA(FJ_EVTL)=ADDR(B$TCB$->B$TCB.STK$->B$NWIO.TYC)->CHAR8;

    673  2 000047   000000 236200 xsym               LDQ   ! FJ_EVTL
         2 000050   000011 402207                    MPY   ! 9,DL
         2 000051   000002 736200                    QLS   ! 2
         2 000052   040006 100700                    MLR   ! fill='040'O
         2 000053   100104 000010                    ADSC9   68,,PR1                  cn=0,n=8
         2 000054   000004 000010 xsym               ADSC9   FJ_EV+4,Q                cn=0,n=8

     1429      674    3                  FJ_EV.EVID(FJ_EVTL)=%SET_DSMNT_EV#;

    674  2 000055   000000 236200 xsym               LDQ   ! FJ_EVTL
         2 000056   000011 402207                    MPY   ! 9,DL
         2 000057   000004 235207                    LDA   ! 4,DL
         2 000060   000001 755206 xsym               STA   ! FJ_EV+1,QL

     1430      675    3                  END;

    675  2 000061   000117 710200 2                  TRA   ! s:688

     1431      676    2               ELSE
     1432      677    2                  IF B$TCB$->B$TCB.STK$->B$NWIO.EVID >= 1000 THEN

    677  2 000062   100101 235300                    LDA   ! 65,,PR1
         2 000063   001750 115207                    CMPA  ! 1000,DL
         2 000064   000075 602200 2                  TNC   ! s:684

     1433      678    3                  DO;

PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:260  
     1434      679    3                     FJ_EV.CG#(FJ_EVTL) = B$TCB$->B$TCB.STK$->B$NWIO.EVID-1000;

    679  2 000065   000000 236200 xsym               LDQ   ! FJ_EVTL
         2 000066   000011 402207                    MPY   ! 9,DL
         2 000067   100101 235300                    LDA   ! 65,,PR1
         2 000070   001750 135207                    SBLA  ! 1000,DL
         2 000071   000003 755206 xsym               STA   ! FJ_EV+3,QL

     1435      680    3                     FJ_EV.EVID(FJ_EVTL) = %CG_RD_EV#;

    680  2 000072   000003 235207                    LDA   ! 3,DL
         2 000073   000001 755206 xsym               STA   ! FJ_EV+1,QL

     1436      681    3                     END;

    681  2 000074   000117 710200 2                  TRA   ! s:688

     1437      682    2                  ELSE
     1438      683    3                  DO;

     1439      684    3                     FJ_EV.STA(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.CGPARM.STATION#;

    684  2 000075   000000 236200 xsym               LDQ   ! FJ_EVTL
         2 000076   000011 402207                    MPY   ! 9,DL
         2 000077   000002 736200                    QLS   ! 2
         2 000100   040006 100700                    MLR   ! fill='040'O
         2 000101   100107 000010                    ADSC9   71,,PR1                  cn=0,n=8
         2 000102   000004 000010 xsym               ADSC9   FJ_EV+4,Q                cn=0,n=8

     1440      685    3                     FJ_EV.MSG(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.CGPARM.MSGTYP#;

    685  2 000103   000000 236200 xsym               LDQ   ! FJ_EVTL
         2 000104   000011 402207                    MPY   ! 9,DL
         2 000105   000001 471700                    LDP1  ! 1,,PR0
         2 000106   000002 736200                    QLS   ! 2
         2 000107   040006 100700                    MLR   ! fill='040'O
         2 000110   100111 000010                    ADSC9   73,,PR1                  cn=0,n=8
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:261  
         2 000111   000006 000010 xsym               ADSC9   FJ_EV+6,Q                cn=0,n=8

     1441      686    3                     FJ_EV.EVID(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.EVID;

    686  2 000112   000000 236200 xsym               LDQ   ! FJ_EVTL
         2 000113   000011 402207                    MPY   ! 9,DL
         2 000114   000001 471700                    LDP1  ! 1,,PR0
         2 000115   100101 235300                    LDA   ! 65,,PR1
         2 000116   000001 755206 xsym               STA   ! FJ_EV+1,QL

     1442      687    3                     END;

     1443      688    2            FJ_EV.ERR(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.ERR;

    688  2 000117   000001 471700                    LDP1  ! 1,,PR0
         2 000120   000000 620206                    EAX0  ! 0,QL
         2 000121   100102 236300                    LDQ   ! 66,,PR1
         2 000122   000010 756210 xsym               STQ   ! FJ_EV+8,X0

     1444      689    2            FJ_EV.ARS(FJ_EVTL)=B$TCB$->B$TCB.STK$->B$NWIO.ARS;

    689  2 000123   000001 471700                    LDP1  ! 1,,PR0
         2 000124   100105 235300                    LDA   ! 69,,PR1
         2 000125   000002 755210 xsym               STA   ! FJ_EV+2,X0

     1445      690    2            RETURN;

    690  2 000126   000000 702200 xent               TSX2  ! X66_AARET

     1446      691    2            END;

    691  2 000127   000132 710000 2                  TRA     s:696

     1447      692        %EJECT;
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:262  
     1448      693    1   FJJ$XCON: ENTRY ASYNC;

    693  2 000130   000000 700200 xent  FJJ$XCON     TSX0  ! X66_AAUTO
         2 000131   000004 000000                    ZERO    4,0

     1449      694        /**/
     1450      695        /*            snap and LDTRC to get fresh copy     */
     1451      696    1         CALL FOI$LDTRC (%S$JXCON,'0612'O,'12'O,'JAYS    ');

    696  2 000132   000003 630400 3                  EPPR0   3
         2 000133   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000134   000000 701000 xent               TSX1    FOI$LDTRC
         2 000135   000000 011000                    NOP     0

     1452      697
     1453      698        /*S*  SCREECH_CODE: FJJ-S$JXCON
     1454      699              TYPE:         SNAP
     1455      700              MESSAGE:      JAYS has aborted
     1456      701              REMARKS:      Following the snap JAYS will LDTRC to itself.
     1457      702        */
     1458      703    1   END;

    703  2 000136   000000 702200 xent               TSX2  ! X66_AARET
     1459      704        %EOD;

PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:263  
--  Include file information  --

   FJ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   FJ_SCODE_C.:E05TOU  is referenced.
   FJM_MACROS_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FJJ$EVENT.
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:264  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w UBIN        r     1 I

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/w STRC(324)   r     1 FJ_EV(0:8191)
     0-0-0/w SBIN        r     1 FJ_EVFREE                  0-0-0/w SBIN        r     1 FJ_EVHD
     0-0-0/w SBIN        r     1 FJ_EVTL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$EXCFR                    0-0-0/w STRC(2484)  r     1 B$JRNLERR
     0-0-0/w STRC(2880)  r     1 B$NWIO                     0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/c CHAR(8)     r     1 CHAR8


   Procedure FJJ$EVENT requires 95 words for executable code.
   Procedure FJJ$EVENT requires 4 words of local(AUTO) storage.
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:265  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:266  
          MINI XREF LISTING

B$EXCFR.ASL
       556**DCL       556--REDEF
B$EXCFR.ERR.ERR#
       570**DCL       570--REDEF
B$EXCFR.EVID
       569**DCL       569--REDEF     570--REDEF
B$EXCFR.IR
       557**DCL       557--REDEF
B$EXCFR.PREVSZ
       556**DCL       556--REDEF
B$EXCFR.SUBC
       568**DCL       568--REDEF     569--REDEF     569--REDEF     665>>IF
B$JRNLERR.CODE
       576**DCL       576--REDEF     577--REDEF     577--REDEF
B$JRNLERR.DCB#
       577**DCL       668>>ASSIGN
B$JRNLERR.ERR.ERR#
       578**DCL       578--REDEF
B$JRNLERR.EVID
       577**DCL       577--REDEF     577--REDEF
B$NWIO.ARS
       480**DCL       689>>ASSIGN
B$NWIO.CGPARM.MSGIDXT
       504**DCL       507--REDEF
B$NWIO.CGPARM.MSGTYP#
       498**DCL       685>>ASSIGN
B$NWIO.CGPARM.STATION#
       498**DCL       684>>ASSIGN
B$NWIO.CODE
       473**DCL       473--REDEF     474--REDEF     474--REDEF
B$NWIO.ERR
       474**DCL       688>>ASSIGN
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:267  
B$NWIO.ERR.ERR#
       475**DCL       475--REDEF
B$NWIO.EVID
       474**DCL       474--REDEF     474--REDEF     677>>IF        679>>ASSIGN    686>>ASSIGN
B$NWIO.SUBC
       474**DCL       671>>IF
B$NWIO.TYC
       480**DCL       673--ASSIGN
B$TCB.STK$
       468**DCL       665>>IF        668>>ASSIGN    671>>IF        673>>ASSIGN    677>>IF        679>>ASSIGN
       684>>ASSIGN    685>>ASSIGN    686>>ASSIGN    688>>ASSIGN    689>>ASSIGN
B$TCB$
        10**DCL       665>>IF        668>>ASSIGN    671>>IF        673>>ASSIGN    677>>IF        679>>ASSIGN
       684>>ASSIGN    685>>ASSIGN    686>>ASSIGN    688>>ASSIGN    689>>ASSIGN
CHAR8
       652**DCL       673>>ASSIGN
FJ_EV.ARS
       641**DCL       689<<ASSIGN
FJ_EV.CG#
       641**DCL       679<<ASSIGN
FJ_EV.DCB#
       641**DCL       641--REDEF     641--REDEF     668<<ASSIGN
FJ_EV.ERR
       642**DCL       688<<ASSIGN
FJ_EV.EVID
       641**DCL       667<<ASSIGN    674<<ASSIGN    680<<ASSIGN    686<<ASSIGN
FJ_EV.LNK
       641**DCL       658>>ASSIGN    662<<ASSIGN    664<<ASSIGN
FJ_EV.MSG
       641**DCL       685<<ASSIGN
FJ_EV.STA
       641**DCL       673<<ASSIGN    684<<ASSIGN
FJ_EVFREE
       642**DCL       655>>DOWHILE   657>>ASSIGN    658<<ASSIGN    658>>ASSIGN
FJ_EVHD
       642**DCL       660<<ASSIGN
PL6.E3A0      #002=FJJ$EVENT File=FJJ$JAY.:E05TSI                                TUE 07/29/97 15:29 Page:268  
FJ_EVTL
       642**DCL       659>>IF        662>>ASSIGN    663<<ASSIGN    667>>ASSIGN    668>>ASSIGN    673>>ASSIGN
       674>>ASSIGN    679>>ASSIGN    680>>ASSIGN    684>>ASSIGN    685>>ASSIGN    686>>ASSIGN    688>>ASSIGN
       689>>ASSIGN
FOI$LDTRC
        12**DCL-ENT   696--CALL
I
       651**DCL       657<<ASSIGN    660>>ASSIGN    662>>ASSIGN    663>>ASSIGN    664>>ASSIGN

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:269  
     1460        1        /*T***********************************************************/
     1461        2        /*T*                                                         */
     1462        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1463        4        /*T*                                                         */
     1464        5        /*T***********************************************************/
     1465        6        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
     1466        7        /* Do user functions for batch and online users.                    */
     1467        8
     1468        9        FJJ$CJAY: PROC ALTRET;
     1469       10        %INCLUDE CP_6;
     1470       91        %INCLUDE CP_6_SUBS;
     1471      631        %INCLUDE B_ERRORS_C;
     1472     1758 S      %INCLUDE B$JIT_C;
     1473     1759        %INCLUDE FJM_MACROS_C;
     1474     1898        %INCLUDE XU_MACRO_C;
     1475     5004        %INCLUDE XU_SUBS_C;
     1476     5096        %INCLUDE XU_PERR_C;
     1477     5287        %INCLUDE XUH_MACRO_C;
     1478     5371        %INCLUDE FJ_SUBS_C;
     1479     5392        %INCLUDE FJ_PERR_C;
     1480     5405        %INCLUDE JG_EVID_C;
     1481     5630
     1482     5631        %PARSE$OUT;
     1483     5676        %PARSE$SYM;
     1484     5714
     1485     5715        %XUR_INIT;
     1486     5814        %XUH_PARAM (PROCNAME=JAYSNAME,OUTDCB1=M$DO,OUTDCB2=M$LO);
     1487     5875
     1488     5876        %B$JIT0;
     1489     5965        %A$JIT6X;
     1490     5968        %F$DCB;
     1491     6025        %B$TCB;
     1492     6028        %B$ALT;
     1493     6036        %EJECT;
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:270  
     1494     6037        %FPT_OPEN (FPTN=OPN_STARA,DCB=M$A,ASN=FILE,FUN=IN,ORG=KEYED,ACS=DIRECT,
     1495     6038             NAME=STARA);
     1496     6147        %FPT_READ (FPTN=RD_STARA,DCB=M$A,BUF=AMREC,KEYS=YES,KEY=SIKEY);
     1497     6186        %FPT_CLOSE (FPTN=CLS_STARA,DCB=M$A);
     1498     6228        %FPT_OPEN (FPTN=OPN_JRNL,DCB=M$J,FUN=CREATE,ASN=FILE,
     1499     6229                 NAME=OPNNAME,ACCT=OPNACCT,PASS=OPNPASS,
     1500     6230                 DISP=NAMED,CTG=YES,ORG=CONSEC);
     1501     6339        %FPT_OPEN (FPTN=AMR,PFMT="PTR",STCLASS="BASED(AMR$)");
     1502     6448        %FPT_CLOSE (FPTN=CLS_JRNL,DCB=M$J,CHGATT=YES);
     1503     6490        /**/
     1504     6491        %FPT_FID (FPTN=RE_FID1,NAME=RE_MSG.FID1.FNAME,
     1505     6492                  ACCT=RE_MSG.FID1.ACCT,ASN=JASN,PASS=RE_MSG.FID1.PASS,
     1506     6493                  SN=RE_MSG.FID1.SN,RES=K,RESULTS=FID1_RSLT);
     1507     6516        %FPT_FID (FPTN=RE_FID2,NAME=RE_MSG.FID2.FNAME,
     1508     6517                  ACCT=RE_MSG.FID1.ACCT,ASN=JASN,PASS=RE_MSG.FID1.PASS,
     1509     6518                  SN=RE_MSG.FID1.SN,RESULTS=FID2_RSLT);
     1510     6541        %FPT_FID (FPTN=CN_FID1,NAME=CNCL_MSG.FID1.FNAME,
     1511     6542                  ACCT=CNCL_MSG.FID1.ACCT,ASN=JASN,PASS=CNCL_MSG.FID1.PASS,
     1512     6543                  SN=CNCL_MSG.FID1.SN);
     1513     6566
     1514     6567        %FPT_YC (FPTN=YC_SET,CMD=AMREC);
     1515     6584        %FPT_OPEN (FPTN=OPN_CSCG,DCB=M$CSCG,ASN=COMGROUP,NAME=CSCG_NAME,
     1516     6585                ACCT=CSCG_ACCT,SETSTA=USR_JAY);
     1517     6694        %VLP_SETSTA (FPTN=USR_JAY);
     1518     6722        %VLP_NAME (FPTN=CSCG_NAME,NAME='CSCG');
     1519     6749        %VLP_ACCT (FPTN=CSCG_ACCT,ACCT=':SYS');
     1520     6762
     1521     6763        %FPT_WRITE (FPTN=WR_CSCG,DCB=M$CSCG,STATION=JAYS_STA);
     1522     6794        %VLP_STATION (FPTN=JAYS_STA,STATION='JAYS');
     1523     6821
     1524     6822        %FPT_READ (FPTN=RD_CSCG,DCB=M$CSCG,STATION=MY_STA);
     1525     6861        %VLP_STATION (FPTN=MY_STA,DIRONLY=YES);
     1526     6888
     1527     6889        %FPT_WRITE (FPTN=LIST_ME,DCB=M$ME,BUF=LST_RSPNCE.TXT);
     1528     6920        %VLP_NAME (FPTN=JAYSNAME,NAME='JAYS');
     1529     6947
     1530     6948        %VLP_NAME (FPTN=SIKEY,NAME='M$SI');
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:271  
     1531     6975        %VLP_NAME (FPTN=N1KEY,NAME='#1');
     1532     7002        %VLP_NAME (FPTN=STARA,NAME='*A');
     1533     7029        %VLP_NAME (FPTN=JNAME,STCLASS=BASED,LEN=31);
     1534     7056        %VLP_ACCT (FPTN=JACCT,STCLASS=BASED);
     1535     7069        %VLP_PASS (FPTN=JPASS,STCLASS=BASED);
     1536     7082        %VLP_NAME (FPTN=OPNNAME);
     1537     7109        %VLP_ACCT (FPTN=OPNACCT);
     1538     7122        %VLP_PASS (FPTN=OPNPASS);
     1539     7135        %VLP_SN (FPTN=S,STCLASS=BASED);
     1540     7148        %VLP_VECTOR (FPTN=BVECT,STCLASS=BASED);
     1541     7163        %FJ$UATTR (FPTN=JAZ,STCLASS=BASED);
     1542     7195        %FJ$UATTR (FPTN=NSN);
     1543     7227        %FJ$CITE (NAME=RE_MSG,COD=FJ_RENAME_CMD,TYP=RENAME);
     1544     7300        %FJ$CITE (NAME=CNCL_MSG,COD=FJ_CANCEL_CMD,TYP=CANCEL);
     1545     7373        %FJ$CITE (NAME=LST_MSG,COD=FJ_LIST_CMD,TYP=LIST);
     1546     7446        %FJ$CITE (NAME=SNP_MSG,COD=FJ_SNP_CMD,TYP=LIST);
     1547     7519        %FJ$OPNANSWR (FPTN=CSCG_ANS);
     1548     7529        %FJ$LISTANS (FPTN=LST_RSPNCE);
     1549     7535
     1550     7536    1   DCL XUR$INIT ENTRY(3) ALTRET;
     1551     7537    1   DCL XUR$GETCMD ENTRY(6) ALTRET;
     1552     7538    1   DCL XUR$ERRPTR ENTRY(2) ALTRET;
     1553     7539    1   DCL XUR$ERRMSG ENTRY(7) ALTRET;
     1554     7540    1   DCL XUR$HELP ENTRY(1) ALTRET;
     1555     7541    1   DCL XUR$MOREMSG ENTRY(1) ALTRET;
     1556     7542    1   DCL XUR$ALLMSG ENTRY(1) ALTRET;
     1557     7543
     1558     7544
     1559     7545    1   DCL M$A DCB;
     1560     7546    1   DCL M$J DCB;
     1561     7547    1   DCL M$ME DCB;
     1562     7548    1   DCL M$CSCG DCB;
     1563     7549    1   DCL M$DO DCB;
     1564     7550    1   DCL M$LO DCB;
     1565     7551    1   DCL M$SI DCB;
     1566     7552
     1567     7553    1   DCL 1 SN_V STATIC,
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:272  
     1568     7554    1         2 BND UBIN(20) UNAL,
     1569     7555    1         2 * BIT(16) UNAL INIT('1111111110100000'B),
     1570     7556    1         2 P$ PTR;
     1571     7557        %VLR_FID(FPTN=FID1_RSLT);
     1572     7576        %VLR_FID (FPTN=FID2_RSLT);
     1573     7595    1   DCL 1 FNM2  BASED(FNM2$),
     1574     7596    1         2 * UBIN(9) UNAL,
     1575     7597    1         2 C CHAR(FNM2SZ);
     1576     7598    1   DCL 1 FNM1  BASED(FNM1$),
     1577     7599    1         2 * UBIN(9) UNAL,
     1578     7600    1         2 C CHAR(FNM1SZ);
     1579     7601    1   DCL FNM1$ PTR;
     1580     7602    1   DCL FNM2$ PTR;
     1581     7603    1   DCL FNM1SZ UBIN;
     1582     7604    1   DCL FNM2SZ UBIN;
     1583     7605    1   DCL AMREC(0:1023) UBIN STATIC;
     1584     7606    1   DCL AMREC_CHR REDEF AMREC CHAR(4096);
     1585     7607    1   DCL CMD_SIZ UBIN;
     1586     7608    1   DCL CMD CHAR(CMD_SIZ) BASED;
     1587     7609    1   DCL SET_STR CHAR(0) CONSTANT INIT('SET #1 ');
     1588     7610    1   DCL AMR$ PTR STATIC INIT(ADDR(AMREC));
     1589     7611    1   DCL K UBIN STATIC;
     1590     7612    1   DCL B$DS3$ PTR SYMREF;
     1591     7613    1   DCL B$TCB$ PTR SYMREF;
     1592     7614    1   DCL B$JIT$ PTR SYMREF;
     1593     7615
     1594     7616        %VLP_ERRCODE (FPTN=NOFILENAME,ERR#=%E$NOFILENAME,FCG=FJ,MID=J,SEV=2,STCLASS=CONSTANT
              7616            );
     1595     7661        %VLP_ERRCODE (FPTN=ONLYFILE,ERR#=%E$ONLYFILE,FCG=FJ,MID=J,SEV=2,STCLASS=CONSTANT);
     1596     7706        %VLP_ERRCODE (FPTN=ERRCODE,STCLASS="");
     1597     7751
     1598     7752    1   DCL BLK$ REDEF ERRCODE PTR;
     1599     7753    1   DCL JASN UBIN(9) STATIC;
     1600     7754
     1601     7755    1   DCL FJ_JAYS_CMD UBIN SYMREF;
     1602     7756
     1603     7757        %EJECT;
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:273  
     1604     7758        /*  Find out what he wants to do.                                     */
     1605     7759
     1606     7760
     1607     7761    1         CALL XUR$INIT (XUR_INIT);
     1608     7762    2         DO WHILE ('1'B);                /* Keep reading commands              */
     1609     7763    2   RD1:     CALL XUR$GETCMD (FJ_JAYS_CMD,BLK$) ALTRET(CMD_ERR);
     1610     7764    3            DO WHILE ('0'B);
     1611     7765    3   CMD_ERR:    CALL XUR$ERRPTR (,DCBNUM(M$ME));
     1612     7766    3               CALL XUR$ERRMSG (ERRCODE,DCBNUM(M$ME));
     1613     7767    3               IF ERRCODE.ERR# = %E$EOF THEN
     1614     7768    3                  RETURN;
     1615     7769    3               ELSE
     1616     7770    3                  GOTO RD1;
     1617     7771    3               END;
     1618     7772
     1619     7773    2            IF OUT$BLK.NSUBLKS = 0 THEN
     1620     7774    2               GOTO RD1;
     1621     7775    3            DO CASE (OUT$BLK.SUBLK$(0)->OUT$BLK.CODE);
     1622     7776    3             CASE (%RUN_CMD);
     1623     7777    3               ALTRETURN;           /* allow online use to test journaling     */
     1624     7778    3             CASE (%LIST_CMD);
     1625     7779    3               WR_CSCG.BUF_=VECTOR(LST_MSG);
     1626     7780    3               LST_MSG.UNAME=B$JIT.UNAME;
     1627     7781    3               LST_MSG.ACCN=B$JIT.ACCN;
     1628     7782    3               LST_MSG.FACCN=B$JIT.FACCN;
     1629     7783    3               LST_MSG.PRIV=B$JIT.PRIV.JOB;
     1630     7784    3               IF NOT DCBADDR(DCBNUM(M$CSCG))->F$DCB.FCD# THEN
     1631     7785    3                  CALL M$OPEN (OPN_CSCG);
     1632     7786    3               CALL M$WRITE (WR_CSCG) ALTRET(RE_ALT);
     1633     7787    3               RD_CSCG.BUF_=VECTOR(LST_RSPNCE);
     1634     7788    3   LST1:       CALL M$READ (RD_CSCG) ALTRET(RE_ALT);
     1635     7789    3               IF LST_RSPNCE.ERR THEN
     1636     7790    3                  CALL XUR$ERRMSG (LST_RSPNCE.ERR);
     1637     7791    3               ELSE
     1638     7792    4               DO;
     1639     7793    4                  CALL M$WRITE (LIST_ME);
     1640     7794    4                  IF LST_RSPNCE.LAST = 0 THEN
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:274  
     1641     7795    4                     GOTO LST1;
     1642     7796    4                  END;
     1643     7797    3             CASE (%RENAME_CMD);
     1644     7798    3               FNM1$=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXTC$;
     1645     7799    3               FNM2$=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(1)->OUT$SYM.TEXTC$;
     1646     7800    3               FNM1SZ=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
     1647     7801    3               FNM2SZ=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(1)->OUT$SYM.COUNT;
     1648     7802    3               RE_FID2.TEXTFID_=VECTOR(FNM2.C);
     1649     7803    3               RE_FID1.TEXTFID_=VECTOR(FNM1.C);
     1650     7804    3               CALL M$FID (RE_FID2) ALTRET(RE_ALT);
     1651     7805    4               IF NOT FID2_RSLT.NAME THEN DO;
     1652     7806    4                  CALL XUR$ERRMSG(NOFILENAME);
     1653     7807        /*E*
     1654     7808        ERROR:  FJ-E$NOFILENAME
     1655     7809        MESSAGE: Both source and destination require a file name.
     1656     7810        */
     1657     7811    4                  GOTO RD1;
     1658     7812    4                  END;
     1659     7813    4               IF JASN~=%FILE# THEN DO;
     1660     7814    4                  CALL XUR$ERRMSG(ONLYFILE);
     1661     7815        /*E*
     1662     7816        ERROR:  FJ-E$ONLYFILE
     1663     7817        MESSAGE: Both source and destination files must be disk files.
     1664     7818        */
     1665     7819    4                  GOTO RD1;
     1666     7820    4                  END;
     1667     7821    3               CALL M$FID (RE_FID1) ALTRET(RE_ALT);
     1668     7822    4               IF NOT FID1_RSLT.NAME THEN DO;
     1669     7823    4                  CALL XUR$ERRMSG(NOFILENAME);
     1670     7824    4                  GOTO RD1;
     1671     7825    4                  END;
     1672     7826    4               IF JASN~=%FILE# THEN DO;
     1673     7827    4                  CALL XUR$ERRMSG(ONLYFILE);
     1674     7828    4                  GOTO RD1;
     1675     7829    4                  END;
     1676     7830    3               RE_MSG.UNAME=B$JIT.UNAME;
     1677     7831    3               RE_MSG.ACCN=B$JIT.ACCN;
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:275  
     1678     7832    3               RE_MSG.FACCN=B$JIT.FACCN;
     1679     7833    3               RE_MSG.PRIV=B$JIT.PRIV.JOB;
     1680     7834    3               IF RE_MSG.FID1.ACCT=' ' THEN
     1681     7835    3                  RE_MSG.FID1.ACCT=B$JIT.FACCN;
     1682     7836    3               WR_CSCG.BUF_=VECTOR(RE_MSG);
     1683     7837    3               IF NOT DCBADDR(DCBNUM(M$CSCG))->F$DCB.FCD# THEN
     1684     7838    3                  CALL M$OPEN (OPN_CSCG);
     1685     7839    3               CALL M$WRITE (WR_CSCG) ALTRET(RE_ALT);
     1686     7840    3               RD_CSCG.BUF_=VECTOR(CSCG_ANS);
     1687     7841    3               CALL M$READ (RD_CSCG) ALTRET(RE_ALT);
     1688     7842    3               IF CSCG_ANS.ERR THEN
     1689     7843    3                  CALL XUR$ERRMSG (CSCG_ANS.ERR);
     1690     7844    4               DO WHILE ('0'B);
     1691     7845    4   RE_ALT:        CALL XUR$ERRMSG (B$TCB$->B$TCB.ALT$->B$ALT.ERR);
     1692     7846    4                  END;
     1693     7847    3             CASE (%CANCL_CMD);
     1694     7848    3               FNM1$=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXTC$;
     1695     7849    3               FNM1SZ=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
     1696     7850    3               CN_FID1.TEXTFID_=VECTOR(FNM1.C);
     1697     7851    3               CALL M$FID (CN_FID1) ALTRET(RE_ALT);
     1698     7852    3               CNCL_MSG.UNAME=B$JIT.UNAME;
     1699     7853    3               CNCL_MSG.ACCN=B$JIT.ACCN;
     1700     7854    3               CNCL_MSG.FACCN=B$JIT.FACCN;
     1701     7855    3               CNCL_MSG.PRIV=B$JIT.PRIV.JOB;
     1702     7856    3               WR_CSCG.BUF_=VECTOR(CNCL_MSG);
     1703     7857    3               IF NOT DCBADDR(DCBNUM(M$CSCG))->F$DCB.FCD# THEN
     1704     7858    3                  CALL M$OPEN (OPN_CSCG);
     1705     7859    3               CALL M$WRITE (WR_CSCG) ALTRET(RE_ALT);
     1706     7860    3               RD_CSCG.BUF_=VECTOR(CSCG_ANS);
     1707     7861    3               CALL M$READ (RD_CSCG) ALTRET(RE_ALT);
     1708     7862    3               IF CSCG_ANS.ERR THEN
     1709     7863    3                  CALL XUR$ERRMSG (CSCG_ANS.ERR);
     1710     7864    3             CASE (%END_CMD);
     1711     7865    3               RETURN;
     1712     7866    3             CASE (%CMMNT_CMD);
     1713     7867    3               RETURN;                   /* Quit on blank or comment command   */
     1714     7868
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:276  
     1715     7869    3             CASE(%HELP_CMD);
     1716     7870    3               XUH_PARAM.HELP$=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXTC$;
     1717     7871    3               CALL XUR$HELP (XUH_PARAM);
     1718     7872    3             CASE(%Q1_CMD);
     1719     7873    3               CALL XUR$MOREMSG (XUH_PARAM) ALTRET(NOMORE);
     1720     7874    3             CASE(%Q2_CMD);
     1721     7875    3               CALL XUR$ALLMSG (XUH_PARAM) ALTRET(NOMORE);
     1722     7876    4               DO WHILE ('0'B);
     1723     7877    4   NOMORE:        ;
     1724     7878    4                  END;
     1725     7879    3             CASE(%SNAP_CMD);
     1726     7880    3               WR_CSCG.BUF_=VECTOR(SNP_MSG);
     1727     7881    3               IF NOT DCBADDR(DCBNUM(M$CSCG))->F$DCB.FCD# THEN
     1728     7882    3                  CALL M$OPEN (OPN_CSCG);
     1729     7883    3               CALL M$WRITE (WR_CSCG) ALTRET(RE_ALT);
     1730     7884    3             CASE (%CREATE_CMD);
     1731     7885    3               CMD_SIZ = OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;
     1732     7886    3               IF CMD_SIZ = 0 THEN
     1733     7887    3                  GOTO CMD_ERR;
     1734     7888    3               CALL CONCAT (AMREC_CHR,
     1735     7889    3                  SET_STR,
     1736     7890    3                  PINCRC(OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->
     1737     7891    3                  OUT$SYM.TEXTC$,1)->CMD);
     1738     7892    3               ADDR(YC_SET.CMD_)->BVECT.W1.VSIZE#=CMD_SIZ+SIZEC(SET_STR)-1;
     1739     7893    3               CALL M$YC (YC_SET);
     1740     7894    3               CALL M$OPEN (OPN_STARA);
     1741     7895    3               RD_STARA.KEY_=VECTOR(N1KEY);
     1742     7896    3               CALL M$READ (RD_STARA) ALTRET(CMD_ERR);
     1743     7897    3               CALL M$CLOSE (CLS_STARA);
     1744     7898    3               SN_V=VECTOR(NSN);
     1745     7899    3               IF AMR.SN_ ~= ADDR(NIL) THEN
     1746     7900    4               DO;
     1747     7901    4                  SN_V.P$=PINCRW(AMR$,POFFW(AMR.SN_,B$DS3$)-SIZEW(NSN)+1);
     1748     7902    4                  SN_V.BND=((SN_V.P$->JAZ.Q.NUM#*6+3)/4+SIZEW(JAZ))*4-1;
     1749     7903    4                  END;
     1750     7904    3               OPNNAME=PINCRW(AMR$,POFFW(AMR.NAME_,B$DS3$))->JNAME;
     1751     7905    3               IF AMR.ACCT_ ~= ADDR(NIL) THEN
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:277  
     1752     7906    3                  OPNACCT=PINCRW(AMR$,POFFW(AMR.ACCT_,B$DS3$))->JACCT;
     1753     7907    3               ELSE
     1754     7908    3                  OPNACCT.ACCT#=' ';
     1755     7909    3               IF AMR.PASS_ ~= ADDR(NIL) THEN
     1756     7910    3                  OPNPASS=PINCRW(AMR$,POFFW(AMR.PASS_,B$DS3$))->JPASS;
     1757     7911    3               ELSE
     1758     7912    3                  OPNPASS.PASS#=' ';
     1759     7913    3               SN_V.P$->JAZ.SIZ#=SN_V.BND/4;
     1760     7914    3               SN_V.P$->JAZ.NAW# = 100;
     1761     7915    3               SN_V.P$->JAZ.Q.ID=NSN.Q.ID;
     1762     7916    3               SN_V.P$->JAZ.Q.ASN=AMR.V.ASN#;
     1763     7917    3               SN_V.P$->JAZ.Q.VOL#=0;
     1764     7918    3               CALL M$OPEN (OPN_JRNL);
     1765     7919    3               CLS_JRNL.UATTR_=SN_V;
     1766     7920    3               CALL M$CLOSE (CLS_JRNL);
     1767     7921    3             END;                        /* End case                           */
     1768     7922    2            END;                         /* End command read DO                */
     1769     7923    1   END;

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:278  
--  Include file information  --

   JG_EVID_C.:E05TOU  is referenced.
   FJ_PERR_C.:E05TOU  is referenced.
   FJ_SUBS_C.:E05TOU  is referenced.
   XUH_MACRO_C.:E05TOU  is referenced.
   XU_PERR_C.:E05TOU  is referenced.
   XU_SUBS_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   FJM_MACROS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FJJ$CJAY.

   Procedure FJJ$CJAY requires 450 words for executable code.
   Procedure FJJ$CJAY requires 14 words of local(AUTO) storage.

    No errors detected in file FJJ$JAY.:E05TSI    .

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:279  

 Object Unit name= FJJ$CJAY                                   File name= FJJ$JAY.:E05TOU
 UTS= JUL 29 '97 15:29:49.64 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none  1671   3207  FJJ$CJAY
    2   DCB   even  none     0      0  M$A
    3   DCB   even  none     0      0  M$J
    4   DCB   even  none     0      0  M$ME
    5   DCB   even  none     0      0  M$CSCG
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$SI
    9  RoData even  UTS      4      4  FJJ$CJAY
   10   Proc  even  none   450    702  FJJ$CJAY
   11  RoData even  none    24     30  FJJ$CJAY

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    10      0   yes    yes     yes      Std        0  FJJ$CJAY
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:280  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 XTX$ADAPT
 yes     yes           Std       6 XUR$GETCMD
 yes     yes           Std       1 XUR$HELP
 yes     yes           Std       1 XUR$MOREMSG
 yes     yes           Std       1 XUR$ALLMSG
 yes     yes           Std       3 XUR$INIT
 yes     yes           Std       2 XUR$ERRPTR
 yes     yes           Std       7 XUR$ERRMSG
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  M$A                                   M$J
     M$ME                                  M$CSCG                                M$DO
     M$LO                                  M$SI                                  B$DS3$
     B$TCB$                                B$JIT$                                FJ_JAYS_CMD
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:281  


     1460        1        /*T***********************************************************/
     1461        2        /*T*                                                         */
     1462        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1463        4        /*T*                                                         */
     1464        5        /*T***********************************************************/
     1465        6        /*X* PLM=6,IND=3,CTI=3,DCI=3,DTI=0,MCI,MOC,DMC  */
     1466        7        /* Do user functions for batch and online users.                    */
     1467        8
     1468        9        FJJ$CJAY: PROC ALTRET;

      9 10 000000   000000 700200 xent  FJJ$CJAY     TSX0  ! X66_AUTO_0
        10 000001   000016 000000                    ZERO    14,0

     1469       10        %INCLUDE CP_6;
     1470       91        %INCLUDE CP_6_SUBS;
     1471      631        %INCLUDE B_ERRORS_C;
     1472     1758 S      %INCLUDE B$JIT_C;
     1473     1759        %INCLUDE FJM_MACROS_C;
     1474     1898        %INCLUDE XU_MACRO_C;
     1475     5004        %INCLUDE XU_SUBS_C;
     1476     5096        %INCLUDE XU_PERR_C;
     1477     5287        %INCLUDE XUH_MACRO_C;
     1478     5371        %INCLUDE FJ_SUBS_C;
     1479     5392        %INCLUDE FJ_PERR_C;
     1480     5405        %INCLUDE JG_EVID_C;
     1481     5630
     1482     5631        %PARSE$OUT;
     1483     5676        %PARSE$SYM;
     1484     5714
     1485     5715        %XUR_INIT;
     1486     5814        %XUH_PARAM (PROCNAME=JAYSNAME,OUTDCB1=M$DO,OUTDCB2=M$LO);
     1487     5875
     1488     5876        %B$JIT0;
     1489     5965        %A$JIT6X;
     1490     5968        %F$DCB;
     1491     6025        %B$TCB;
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:282  
     1492     6028        %B$ALT;
     1493     6036        %EJECT;
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:283  
     1494     6037        %FPT_OPEN (FPTN=OPN_STARA,DCB=M$A,ASN=FILE,FUN=IN,ORG=KEYED,ACS=DIRECT,
     1495     6038             NAME=STARA);
     1496     6147        %FPT_READ (FPTN=RD_STARA,DCB=M$A,BUF=AMREC,KEYS=YES,KEY=SIKEY);
     1497     6186        %FPT_CLOSE (FPTN=CLS_STARA,DCB=M$A);
     1498     6228        %FPT_OPEN (FPTN=OPN_JRNL,DCB=M$J,FUN=CREATE,ASN=FILE,
     1499     6229                 NAME=OPNNAME,ACCT=OPNACCT,PASS=OPNPASS,
     1500     6230                 DISP=NAMED,CTG=YES,ORG=CONSEC);
     1501     6339        %FPT_OPEN (FPTN=AMR,PFMT="PTR",STCLASS="BASED(AMR$)");
     1502     6448        %FPT_CLOSE (FPTN=CLS_JRNL,DCB=M$J,CHGATT=YES);
     1503     6490        /**/
     1504     6491        %FPT_FID (FPTN=RE_FID1,NAME=RE_MSG.FID1.FNAME,
     1505     6492                  ACCT=RE_MSG.FID1.ACCT,ASN=JASN,PASS=RE_MSG.FID1.PASS,
     1506     6493                  SN=RE_MSG.FID1.SN,RES=K,RESULTS=FID1_RSLT);
     1507     6516        %FPT_FID (FPTN=RE_FID2,NAME=RE_MSG.FID2.FNAME,
     1508     6517                  ACCT=RE_MSG.FID1.ACCT,ASN=JASN,PASS=RE_MSG.FID1.PASS,
     1509     6518                  SN=RE_MSG.FID1.SN,RESULTS=FID2_RSLT);
     1510     6541        %FPT_FID (FPTN=CN_FID1,NAME=CNCL_MSG.FID1.FNAME,
     1511     6542                  ACCT=CNCL_MSG.FID1.ACCT,ASN=JASN,PASS=CNCL_MSG.FID1.PASS,
     1512     6543                  SN=CNCL_MSG.FID1.SN);
     1513     6566
     1514     6567        %FPT_YC (FPTN=YC_SET,CMD=AMREC);
     1515     6584        %FPT_OPEN (FPTN=OPN_CSCG,DCB=M$CSCG,ASN=COMGROUP,NAME=CSCG_NAME,
     1516     6585                ACCT=CSCG_ACCT,SETSTA=USR_JAY);
     1517     6694        %VLP_SETSTA (FPTN=USR_JAY);
     1518     6722        %VLP_NAME (FPTN=CSCG_NAME,NAME='CSCG');
     1519     6749        %VLP_ACCT (FPTN=CSCG_ACCT,ACCT=':SYS');
     1520     6762
     1521     6763        %FPT_WRITE (FPTN=WR_CSCG,DCB=M$CSCG,STATION=JAYS_STA);
     1522     6794        %VLP_STATION (FPTN=JAYS_STA,STATION='JAYS');
     1523     6821
     1524     6822        %FPT_READ (FPTN=RD_CSCG,DCB=M$CSCG,STATION=MY_STA);
     1525     6861        %VLP_STATION (FPTN=MY_STA,DIRONLY=YES);
     1526     6888
     1527     6889        %FPT_WRITE (FPTN=LIST_ME,DCB=M$ME,BUF=LST_RSPNCE.TXT);
     1528     6920        %VLP_NAME (FPTN=JAYSNAME,NAME='JAYS');
     1529     6947
     1530     6948        %VLP_NAME (FPTN=SIKEY,NAME='M$SI');
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:284  
     1531     6975        %VLP_NAME (FPTN=N1KEY,NAME='#1');
     1532     7002        %VLP_NAME (FPTN=STARA,NAME='*A');
     1533     7029        %VLP_NAME (FPTN=JNAME,STCLASS=BASED,LEN=31);
     1534     7056        %VLP_ACCT (FPTN=JACCT,STCLASS=BASED);
     1535     7069        %VLP_PASS (FPTN=JPASS,STCLASS=BASED);
     1536     7082        %VLP_NAME (FPTN=OPNNAME);
     1537     7109        %VLP_ACCT (FPTN=OPNACCT);
     1538     7122        %VLP_PASS (FPTN=OPNPASS);
     1539     7135        %VLP_SN (FPTN=S,STCLASS=BASED);
     1540     7148        %VLP_VECTOR (FPTN=BVECT,STCLASS=BASED);
     1541     7163        %FJ$UATTR (FPTN=JAZ,STCLASS=BASED);
     1542     7195        %FJ$UATTR (FPTN=NSN);
     1543     7227        %FJ$CITE (NAME=RE_MSG,COD=FJ_RENAME_CMD,TYP=RENAME);
     1544     7300        %FJ$CITE (NAME=CNCL_MSG,COD=FJ_CANCEL_CMD,TYP=CANCEL);
     1545     7373        %FJ$CITE (NAME=LST_MSG,COD=FJ_LIST_CMD,TYP=LIST);
     1546     7446        %FJ$CITE (NAME=SNP_MSG,COD=FJ_SNP_CMD,TYP=LIST);
     1547     7519        %FJ$OPNANSWR (FPTN=CSCG_ANS);
     1548     7529        %FJ$LISTANS (FPTN=LST_RSPNCE);
     1549     7535
     1550     7536    1   DCL XUR$INIT ENTRY(3) ALTRET;
     1551     7537    1   DCL XUR$GETCMD ENTRY(6) ALTRET;
     1552     7538    1   DCL XUR$ERRPTR ENTRY(2) ALTRET;
     1553     7539    1   DCL XUR$ERRMSG ENTRY(7) ALTRET;
     1554     7540    1   DCL XUR$HELP ENTRY(1) ALTRET;
     1555     7541    1   DCL XUR$MOREMSG ENTRY(1) ALTRET;
     1556     7542    1   DCL XUR$ALLMSG ENTRY(1) ALTRET;
     1557     7543
     1558     7544
     1559     7545    1   DCL M$A DCB;
     1560     7546    1   DCL M$J DCB;
     1561     7547    1   DCL M$ME DCB;
     1562     7548    1   DCL M$CSCG DCB;
     1563     7549    1   DCL M$DO DCB;
     1564     7550    1   DCL M$LO DCB;
     1565     7551    1   DCL M$SI DCB;
     1566     7552
     1567     7553    1   DCL 1 SN_V STATIC,
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:285  
     1568     7554    1         2 BND UBIN(20) UNAL,
     1569     7555    1         2 * BIT(16) UNAL INIT('1111111110100000'B),
     1570     7556    1         2 P$ PTR;
     1571     7557        %VLR_FID(FPTN=FID1_RSLT);
     1572     7576        %VLR_FID (FPTN=FID2_RSLT);
     1573     7595    1   DCL 1 FNM2  BASED(FNM2$),
     1574     7596    1         2 * UBIN(9) UNAL,
     1575     7597    1         2 C CHAR(FNM2SZ);
     1576     7598    1   DCL 1 FNM1  BASED(FNM1$),
     1577     7599    1         2 * UBIN(9) UNAL,
     1578     7600    1         2 C CHAR(FNM1SZ);
     1579     7601    1   DCL FNM1$ PTR;
     1580     7602    1   DCL FNM2$ PTR;
     1581     7603    1   DCL FNM1SZ UBIN;
     1582     7604    1   DCL FNM2SZ UBIN;
     1583     7605    1   DCL AMREC(0:1023) UBIN STATIC;
     1584     7606    1   DCL AMREC_CHR REDEF AMREC CHAR(4096);
     1585     7607    1   DCL CMD_SIZ UBIN;
     1586     7608    1   DCL CMD CHAR(CMD_SIZ) BASED;
     1587     7609    1   DCL SET_STR CHAR(0) CONSTANT INIT('SET #1 ');
     1588     7610    1   DCL AMR$ PTR STATIC INIT(ADDR(AMREC));
     1589     7611    1   DCL K UBIN STATIC;
     1590     7612    1   DCL B$DS3$ PTR SYMREF;
     1591     7613    1   DCL B$TCB$ PTR SYMREF;
     1592     7614    1   DCL B$JIT$ PTR SYMREF;
     1593     7615
     1594     7616       %VLP_ERRCODE (FPTN=NOFILENAME,ERR#=%E$NOFILENAME,FCG=FJ,MID=J,SEV=2,STCLASS=CONSTANT
              7616            );
     1595     7661        %VLP_ERRCODE (FPTN=ONLYFILE,ERR#=%E$ONLYFILE,FCG=FJ,MID=J,SEV=2,STCLASS=CONSTANT);
     1596     7706        %VLP_ERRCODE (FPTN=ERRCODE,STCLASS="");
     1597     7751
     1598     7752    1   DCL BLK$ REDEF ERRCODE PTR;
     1599     7753    1   DCL JASN UBIN(9) STATIC;
     1600     7754
     1601     7755    1   DCL FJ_JAYS_CMD UBIN SYMREF;
     1602     7756
     1603     7757        %EJECT;
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:286  
     1604     7758        /*  Find out what he wants to do.                                     */
     1605     7759
     1606     7760
     1607     7761    1         CALL XUR$INIT (XUR_INIT);

   7761 10 000002   000000 630400 11                 EPPR0   0
        10 000003   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000004   000000 701000 xent               TSX1    XUR$INIT
        10 000005   000000 011000                    NOP     0

     1608     7762    2         DO WHILE ('1'B);                /* Keep reading commands              */

     1609     7763    2   RD1:     CALL XUR$GETCMD (FJ_JAYS_CMD,BLK$) ALTRET(CMD_ERR);

   7763 10 000006   200010 630500       RD1          EPPR0   ERRCODE,,AUTO
        10 000007   200013 450500                    STP0    ERRCODE+3,,AUTO
        10 000010   000001 236000 11                 LDQ     1
        10 000011   200012 756100                    STQ     ERRCODE+2,,AUTO
        10 000012   200012 630500                    EPPR0   ERRCODE+2,,AUTO
        10 000013   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 000014   000000 701000 xent               TSX1    XUR$GETCMD
        10 000015   000017 702000 10                 TSX2    CMD_ERR

     1610     7764    3            DO WHILE ('0'B);

   7764 10 000016   000050 710000 10                 TRA     s:7773

     1611     7765    3   CMD_ERR:    CALL XUR$ERRPTR (,DCBNUM(M$ME));

   7765 10 000017   000000 236007 xsym  CMD_ERR      LDQ     M$ME,DL
        10 000020   200012 756100                    STQ     ERRCODE+2,,AUTO
        10 000021   200012 630500                    EPPR0   ERRCODE+2,,AUTO
        10 000022   200015 450500                    STP0    ERRCODE+5,,AUTO
        10 000023   000001 236000 xsym               LDQ     B_VECTNIL+1
        10 000024   200014 756100                    STQ     ERRCODE+4,,AUTO
        10 000025   200014 630500                    EPPR0   ERRCODE+4,,AUTO
        10 000026   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:287  
        10 000027   000000 701000 xent               TSX1    XUR$ERRPTR
        10 000030   000000 011000                    NOP     0

     1612     7766    3               CALL XUR$ERRMSG (ERRCODE,DCBNUM(M$ME));

   7766 10 000031   000000 236007 xsym               LDQ     M$ME,DL
        10 000032   200012 756100                    STQ     ERRCODE+2,,AUTO
        10 000033   200012 630500                    EPPR0   ERRCODE+2,,AUTO
        10 000034   200015 450500                    STP0    ERRCODE+5,,AUTO
        10 000035   200010 631500                    EPPR1   ERRCODE,,AUTO
        10 000036   200014 451500                    STP1    ERRCODE+4,,AUTO
        10 000037   200014 630500                    EPPR0   ERRCODE+4,,AUTO
        10 000040   000020 631400 xsym               EPPR1   B_VECTNIL+16
        10 000041   000000 701000 xent               TSX1    XUR$ERRMSG
        10 000042   000000 011000                    NOP     0

     1613     7767    3               IF ERRCODE.ERR# = %E$EOF THEN

   7767 10 000043   200010 236100                    LDQ     ERRCODE,,AUTO
        10 000044   377770 376007                    ANQ     131064,DL
        10 000045   000060 116007                    CMPQ    48,DL
        10 000046   000006 601000 10                 TNZ     RD1

     1614     7768    3                  RETURN;

   7768 10 000047   000000 702200 xent               TSX2  ! X66_ARET

     1615     7769    3               ELSE
     1616     7770    3                  GOTO RD1;
     1617     7771    3               END;

     1618     7772
     1619     7773    2            IF OUT$BLK.NSUBLKS = 0 THEN

   7773 10 000050   200010 470500                    LDP0    ERRCODE,,AUTO
        10 000051   000001 220100                    LDX0    1,,PR0
        10 000052   000006 600000 10                 TZE     RD1
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:288  

     1620     7774    2               GOTO RD1;
     1621     7775    3            DO CASE (OUT$BLK.SUBLK$(0)->OUT$BLK.CODE);

   7775 10 000053   000003 471500                    LDP1    3,,PR0
        10 000054   100000 721100                    LXL1    0,,PR1
        10 000055   000015 101003                    CMPX1   13,DU
        10 000056   000060 602011 10                 TNC     s:7775+5,X1
        10 000057   000006 710000 10                 TRA     RD1
        10 000060   000701 710000 10                 TRA     s:7922
        10 000061   000701 710000 10                 TRA     s:7922
        10 000062   000503 710000 10                 TRA     s:7885
        10 000063   000076 710000 10                 TRA     s:7779
        10 000064   000345 710000 10                 TRA     s:7848
        10 000065   000154 710000 10                 TRA     s:7798
        10 000066   000435 710000 10                 TRA     s:7865
        10 000067   000436 710000 10                 TRA     s:7867
        10 000070   000075 710000 10                 TRA     s:7777
        10 000071   000437 710000 10                 TRA     s:7870
        10 000072   000447 710000 10                 TRA     s:7873
        10 000073   000454 710000 10                 TRA     s:7875
        10 000074   000462 710000 10                 TRA     s:7880

     1622     7776    3             CASE (%RUN_CMD);

     1623     7777    3               ALTRETURN;           /* allow online use to test journaling     */

   7777 10 000075   000000 702200 xent               TSX2  ! X66_AALT

     1624     7778    3             CASE (%LIST_CMD);

     1625     7779    3               WR_CSCG.BUF_=VECTOR(LST_MSG);

   7779 10 000076   000002 237000 11                 LDAQ    2
        10 000077   000676 757000 1                  STAQ    WR_CSCG+4

     1626     7780    3               LST_MSG.UNAME=B$JIT.UNAME;
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:289  

   7780 10 000100   000000 471400 xsym               LDP1    B$JIT$
        10 000101   040000 100500                    MLR     fill='040'O
        10 000102   100003 000014                    ADSC9   3,,PR1                   cn=0,n=12
        10 000103   001103 000014 1                  ADSC9   LST_MSG+4                cn=0,n=12

     1627     7781    3               LST_MSG.ACCN=B$JIT.ACCN;

   7781 10 000104   040000 100500                    MLR     fill='040'O
        10 000105   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
        10 000106   001101 000010 1                  ADSC9   LST_MSG+2                cn=0,n=8

     1628     7782    3               LST_MSG.FACCN=B$JIT.FACCN;

   7782 10 000107   100006 237100                    LDAQ    6,,PR1
        10 000110   001106 757000 1                  STAQ    LST_MSG+7

     1629     7783    3               LST_MSG.PRIV=B$JIT.PRIV.JOB;

   7783 10 000111   100015 236100                    LDQ     13,,PR1
        10 000112   001110 756000 1                  STQ     LST_MSG+9

     1630     7784    3               IF NOT DCBADDR(DCBNUM(M$CSCG))->F$DCB.FCD# THEN

   7784 10 000113   000000 236007 xsym               LDQ     M$CSCG,DL
        10 000114   000004 473400 11                 LDP3    4
        10 000115   300000 474500                    LDP4    0,,PR3
        10 000116   400000 475506                    LDP5    0,QL,PR4
        10 000117   500031 236100                    LDQ     25,,PR5
        10 000120   020000 316007                    CANQ    8192,DL
        10 000121   000125 601000 10                 TNZ     s:7786

     1631     7785    3                  CALL M$OPEN (OPN_CSCG);

   7785 10 000122   000560 630400 1                  EPPR0   OPN_CSCG
        10 000123   050000 713400                    CLIMB   open
        10 000124   410400 401760                    pmme    nvectors=18
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:290  

     1632     7786    3               CALL M$WRITE (WR_CSCG) ALTRET(RE_ALT);

   7786 10 000125   000672 630400 1                  EPPR0   WR_CSCG
        10 000126   440001 713400                    CLIMB   alt,write
        10 000127   401400 401760                    pmme    nvectors=4
        10 000130   000334 702000 10                 TSX2    RE_ALT

     1633     7787    3               RD_CSCG.BUF_=VECTOR(LST_RSPNCE);

   7787 10 000131   000006 237000 11                 LDAQ    6
        10 000132   000722 757000 1                  STAQ    RD_CSCG+4

     1634     7788    3   LST1:       CALL M$READ (RD_CSCG) ALTRET(RE_ALT);

   7788 10 000133   000716 630400 1     LST1         EPPR0   RD_CSCG
        10 000134   440000 713400                    CLIMB   alt,read
        10 000135   401400 401760                    pmme    nvectors=4
        10 000136   000334 702000 10                 TSX2    RE_ALT

     1635     7789    3               IF LST_RSPNCE.ERR THEN

   7789 10 000137   001132 235000 1                  LDA     LST_RSPNCE
        10 000140   000146 600000 10                 TZE     s:7793

     1636     7790    3                  CALL XUR$ERRMSG (LST_RSPNCE.ERR);

   7790 10 000141   000007 630400 11                 EPPR0   7
        10 000142   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000143   000000 701000 xent               TSX1    XUR$ERRMSG
        10 000144   000000 011000                    NOP     0
        10 000145   000006 710000 10                 TRA     RD1

     1637     7791    3               ELSE
     1638     7792    4               DO;

     1639     7793    4                  CALL M$WRITE (LIST_ME);
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:291  

   7793 10 000146   000744 630400 1                  EPPR0   LIST_ME
        10 000147   040001 713400                    CLIMB   write
        10 000150   401400 401760                    pmme    nvectors=4

     1640     7794    4                  IF LST_RSPNCE.LAST = 0 THEN

   7794 10 000151   001133 235000 1                  LDA     LST_RSPNCE+1
        10 000152   000133 600000 10                 TZE     LST1

     1641     7795    4                     GOTO LST1;
     1642     7796    4                  END;

   7796 10 000153   000006 710000 10                 TRA     RD1

     1643     7797    3             CASE (%RENAME_CMD);

     1644     7798    3               FNM1$=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXTC$;

   7798 10 000154   100003 473500                    LDP3    3,,PR1
        10 000155   300003 236100                    LDQ     3,,PR3
        10 000156   200003 756100                    STQ     FNM1$,,AUTO

     1645     7799    3               FNM2$=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(1)->OUT$SYM.TEXTC$;

   7799 10 000157   100004 474500                    LDP4    4,,PR1
        10 000160   400003 236100                    LDQ     3,,PR4
        10 000161   200004 756100                    STQ     FNM2$,,AUTO

     1646     7800    3               FNM1SZ=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;

   7800 10 000162   300004 236100                    LDQ     4,,PR3
        10 000163   000033 772000                    QRL     27
        10 000164   200005 756100                    STQ     FNM1SZ,,AUTO

     1647     7801    3               FNM2SZ=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(1)->OUT$SYM.COUNT;

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:292  
   7801 10 000165   400004 236100                    LDQ     4,,PR4
        10 000166   000033 772000                    QRL     27
        10 000167   200006 756100                    STQ     FNM2SZ,,AUTO

     1648     7802    3               RE_FID2.TEXTFID_=VECTOR(FNM2.C);

   7802 10 000170   200006 235100                    LDA     FNM2SZ,,AUTO
        10 000171   000020 735000                    ALS     16
        10 000172   000140 135007                    SBLA    96,DL
        10 000173   200004 236100                    LDQ     FNM2$,,AUTO
        10 000174   200000 036007                    ADLQ    65536,DL
        10 000175   000472 757000 1                  STAQ    RE_FID2+2

     1649     7803    3               RE_FID1.TEXTFID_=VECTOR(FNM1.C);

   7803 10 000176   200005 235100                    LDA     FNM1SZ,,AUTO
        10 000177   000020 735000                    ALS     16
        10 000200   000140 135007                    SBLA    96,DL
        10 000201   200003 236100                    LDQ     FNM1$,,AUTO
        10 000202   200000 036007                    ADLQ    65536,DL
        10 000203   000442 757000 1                  STAQ    RE_FID1+2

     1650     7804    3               CALL M$FID (RE_FID2) ALTRET(RE_ALT);

   7804 10 000204   000470 630400 1                  EPPR0   RE_FID2
        10 000205   420001 713400                    CLIMB   alt,+8193
        10 000206   404400 401760                    pmme    nvectors=10
        10 000207   000334 702000 10                 TSX2    RE_ALT

     1651     7805    4               IF NOT FID2_RSLT.NAME THEN DO;

   7805 10 000210   001172 234000 1                  SZN     FID2_RSLT
        10 000211   000217 604000 10                 TMI     s:7813

     1652     7806    4                  CALL XUR$ERRMSG(NOFILENAME);

   7806 10 000212   000010 630400 11                 EPPR0   8
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:293  
        10 000213   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000214   000000 701000 xent               TSX1    XUR$ERRMSG
        10 000215   000000 011000                    NOP     0

     1653     7807        /*E*
     1654     7808        ERROR:  FJ-E$NOFILENAME
     1655     7809        MESSAGE: Both source and destination require a file name.
     1656     7810        */
     1657     7811    4                  GOTO RD1;

   7811 10 000216   000006 710000 10                 TRA     RD1

     1658     7812    4                  END;
     1659     7813    4               IF JASN~=%FILE# THEN DO;

   7813 10 000217   003206 236000 1                  LDQ     JASN
        10 000220   777000 376003                    ANQ     -512,DU
        10 000221   001000 116003                    CMPQ    512,DU
        10 000222   000230 600000 10                 TZE     s:7821

     1660     7814    4                  CALL XUR$ERRMSG(ONLYFILE);

   7814 10 000223   000011 630400 11                 EPPR0   9
        10 000224   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000225   000000 701000 xent               TSX1    XUR$ERRMSG
        10 000226   000000 011000                    NOP     0

     1661     7815        /*E*
     1662     7816        ERROR:  FJ-E$ONLYFILE
     1663     7817        MESSAGE: Both source and destination files must be disk files.
     1664     7818        */
     1665     7819    4                  GOTO RD1;

   7819 10 000227   000006 710000 10                 TRA     RD1

     1666     7820    4                  END;
     1667     7821    3               CALL M$FID (RE_FID1) ALTRET(RE_ALT);
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:294  

   7821 10 000230   000440 630400 1                  EPPR0   RE_FID1
        10 000231   420001 713400                    CLIMB   alt,+8193
        10 000232   404400 401760                    pmme    nvectors=10
        10 000233   000334 702000 10                 TSX2    RE_ALT

     1668     7822    4               IF NOT FID1_RSLT.NAME THEN DO;

   7822 10 000234   001160 234000 1                  SZN     FID1_RSLT
        10 000235   000243 604000 10                 TMI     s:7826

     1669     7823    4                  CALL XUR$ERRMSG(NOFILENAME);

   7823 10 000236   000010 630400 11                 EPPR0   8
        10 000237   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000240   000000 701000 xent               TSX1    XUR$ERRMSG
        10 000241   000000 011000                    NOP     0

     1670     7824    4                  GOTO RD1;

   7824 10 000242   000006 710000 10                 TRA     RD1

     1671     7825    4                  END;
     1672     7826    4               IF JASN~=%FILE# THEN DO;

   7826 10 000243   003206 236000 1                  LDQ     JASN
        10 000244   777000 376003                    ANQ     -512,DU
        10 000245   001000 116003                    CMPQ    512,DU
        10 000246   000254 600000 10                 TZE     s:7830

     1673     7827    4                  CALL XUR$ERRMSG(ONLYFILE);

   7827 10 000247   000011 630400 11                 EPPR0   9
        10 000250   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000251   000000 701000 xent               TSX1    XUR$ERRMSG
        10 000252   000000 011000                    NOP     0

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:295  
     1674     7828    4                  GOTO RD1;

   7828 10 000253   000006 710000 10                 TRA     RD1

     1675     7829    4                  END;
     1676     7830    3               RE_MSG.UNAME=B$JIT.UNAME;

   7830 10 000254   000000 470400 xsym               LDP0    B$JIT$
        10 000255   040000 100500                    MLR     fill='040'O
        10 000256   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12
        10 000257   001040 000014 1                  ADSC9   RE_MSG+27                cn=0,n=12

     1677     7831    3               RE_MSG.ACCN=B$JIT.ACCN;

   7831 10 000260   040000 100500                    MLR     fill='040'O
        10 000261   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        10 000262   001036 000010 1                  ADSC9   RE_MSG+25                cn=0,n=8

     1678     7832    3               RE_MSG.FACCN=B$JIT.FACCN;

   7832 10 000263   000006 237100                    LDAQ    6,,PR0
        10 000264   001043 755000 1                  STA     RE_MSG+30
        10 000265   001044 756000 1                  STQ     RE_MSG+31

     1679     7833    3               RE_MSG.PRIV=B$JIT.PRIV.JOB;

   7833 10 000266   000015 236100                    LDQ     13,,PR0
        10 000267   001045 756000 1                  STQ     RE_MSG+32

     1680     7834    3               IF RE_MSG.FID1.ACCT=' ' THEN

   7834 10 000270   040000 106400                    CMPC    fill='040'O
        10 000271   001017 000010 1                  ADSC9   RE_MSG+10                cn=0,n=8
        10 000272   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
        10 000273   000277 601000 10                 TNZ     s:7836

     1681     7835    3                  RE_MSG.FID1.ACCT=B$JIT.FACCN;
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:296  

   7835 10 000274   000006 237100                    LDAQ    6,,PR0
        10 000275   001017 755000 1                  STA     RE_MSG+10
        10 000276   001020 756000 1                  STQ     RE_MSG+11

     1682     7836    3               WR_CSCG.BUF_=VECTOR(RE_MSG);

   7836 10 000277   000012 237000 11                 LDAQ    10
        10 000300   000676 757000 1                  STAQ    WR_CSCG+4

     1683     7837    3               IF NOT DCBADDR(DCBNUM(M$CSCG))->F$DCB.FCD# THEN

   7837 10 000301   000000 236007 xsym               LDQ     M$CSCG,DL
        10 000302   000004 471400 11                 LDP1    4
        10 000303   100000 473500                    LDP3    0,,PR1
        10 000304   300000 474506                    LDP4    0,QL,PR3
        10 000305   400031 236100                    LDQ     25,,PR4
        10 000306   020000 316007                    CANQ    8192,DL
        10 000307   000313 601000 10                 TNZ     s:7839

     1684     7838    3                  CALL M$OPEN (OPN_CSCG);

   7838 10 000310   000560 630400 1                  EPPR0   OPN_CSCG
        10 000311   050000 713400                    CLIMB   open
        10 000312   410400 401760                    pmme    nvectors=18

     1685     7839    3               CALL M$WRITE (WR_CSCG) ALTRET(RE_ALT);

   7839 10 000313   000672 630400 1                  EPPR0   WR_CSCG
        10 000314   440001 713400                    CLIMB   alt,write
        10 000315   401400 401760                    pmme    nvectors=4
        10 000316   000334 702000 10                 TSX2    RE_ALT

     1686     7840    3               RD_CSCG.BUF_=VECTOR(CSCG_ANS);

   7840 10 000317   000014 237000 11                 LDAQ    12
        10 000320   000722 757000 1                  STAQ    RD_CSCG+4
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:297  

     1687     7841    3               CALL M$READ (RD_CSCG) ALTRET(RE_ALT);

   7841 10 000321   000716 630400 1                  EPPR0   RD_CSCG
        10 000322   440000 713400                    CLIMB   alt,read
        10 000323   401400 401760                    pmme    nvectors=4
        10 000324   000334 702000 10                 TSX2    RE_ALT

     1688     7842    3               IF CSCG_ANS.ERR THEN

   7842 10 000325   001123 235000 1                  LDA     CSCG_ANS
        10 000326   000333 600000 10                 TZE     s:7844

     1689     7843    3                  CALL XUR$ERRMSG (CSCG_ANS.ERR);

   7843 10 000327   000015 630400 11                 EPPR0   13
        10 000330   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000331   000000 701000 xent               TSX1    XUR$ERRMSG
        10 000332   000000 011000                    NOP     0

     1690     7844    4               DO WHILE ('0'B);

   7844 10 000333   000006 710000 10                 TRA     RD1

     1691     7845    4   RE_ALT:        CALL XUR$ERRMSG (B$TCB$->B$TCB.ALT$->B$ALT.ERR);

   7845 10 000334   000000 470400 xsym  RE_ALT       LDP0    B$TCB$
        10 000335   000000 471500                    LDP1    0,,PR0
        10 000336   100102 633500                    EPPR3   66,,PR1
        10 000337   200012 453500                    STP3    ERRCODE+2,,AUTO
        10 000340   200012 630500                    EPPR0   ERRCODE+2,,AUTO
        10 000341   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000342   000000 701000 xent               TSX1    XUR$ERRMSG
        10 000343   000000 011000                    NOP     0

     1692     7846    4                  END;

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:298  
   7846 10 000344   000006 710000 10                 TRA     RD1

     1693     7847    3             CASE (%CANCL_CMD);

     1694     7848    3               FNM1$=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXTC$;

   7848 10 000345   100003 473500                    LDP3    3,,PR1
        10 000346   300003 236100                    LDQ     3,,PR3
        10 000347   200003 756100                    STQ     FNM1$,,AUTO

     1695     7849    3               FNM1SZ=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;

   7849 10 000350   300004 236100                    LDQ     4,,PR3
        10 000351   000033 772000                    QRL     27
        10 000352   200005 756100                    STQ     FNM1SZ,,AUTO

     1696     7850    3               CN_FID1.TEXTFID_=VECTOR(FNM1.C);

   7850 10 000353   200005 235100                    LDA     FNM1SZ,,AUTO
        10 000354   000020 735000                    ALS     16
        10 000355   000140 135007                    SBLA    96,DL
        10 000356   200003 236100                    LDQ     FNM1$,,AUTO
        10 000357   200000 036007                    ADLQ    65536,DL
        10 000360   000522 757000 1                  STAQ    CN_FID1+2

     1697     7851    3               CALL M$FID (CN_FID1) ALTRET(RE_ALT);

   7851 10 000361   000520 630400 1                  EPPR0   CN_FID1
        10 000362   420001 713400                    CLIMB   alt,+8193
        10 000363   404400 401760                    pmme    nvectors=10
        10 000364   000334 702000 10                 TSX2    RE_ALT

     1698     7852    3               CNCL_MSG.UNAME=B$JIT.UNAME;

   7852 10 000365   000000 470400 xsym               LDP0    B$JIT$
        10 000366   040000 100500                    MLR     fill='040'O
        10 000367   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:299  
        10 000370   001071 000014 1                  ADSC9   CNCL_MSG+19              cn=0,n=12

     1699     7853    3               CNCL_MSG.ACCN=B$JIT.ACCN;

   7853 10 000371   040000 100500                    MLR     fill='040'O
        10 000372   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        10 000373   001067 000010 1                  ADSC9   CNCL_MSG+17              cn=0,n=8

     1700     7854    3               CNCL_MSG.FACCN=B$JIT.FACCN;

   7854 10 000374   000006 237100                    LDAQ    6,,PR0
        10 000375   001074 757000 1                  STAQ    CNCL_MSG+22

     1701     7855    3               CNCL_MSG.PRIV=B$JIT.PRIV.JOB;

   7855 10 000376   000015 236100                    LDQ     13,,PR0
        10 000377   001076 756000 1                  STQ     CNCL_MSG+24

     1702     7856    3               WR_CSCG.BUF_=VECTOR(CNCL_MSG);

   7856 10 000400   000016 237000 11                 LDAQ    14
        10 000401   000676 757000 1                  STAQ    WR_CSCG+4

     1703     7857    3               IF NOT DCBADDR(DCBNUM(M$CSCG))->F$DCB.FCD# THEN

   7857 10 000402   000000 236007 xsym               LDQ     M$CSCG,DL
        10 000403   000004 471400 11                 LDP1    4
        10 000404   100000 473500                    LDP3    0,,PR1
        10 000405   300000 474506                    LDP4    0,QL,PR3
        10 000406   400031 236100                    LDQ     25,,PR4
        10 000407   020000 316007                    CANQ    8192,DL
        10 000410   000414 601000 10                 TNZ     s:7859

     1704     7858    3                  CALL M$OPEN (OPN_CSCG);

   7858 10 000411   000560 630400 1                  EPPR0   OPN_CSCG
        10 000412   050000 713400                    CLIMB   open
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:300  
        10 000413   410400 401760                    pmme    nvectors=18

     1705     7859    3               CALL M$WRITE (WR_CSCG) ALTRET(RE_ALT);

   7859 10 000414   000672 630400 1                  EPPR0   WR_CSCG
        10 000415   440001 713400                    CLIMB   alt,write
        10 000416   401400 401760                    pmme    nvectors=4
        10 000417   000334 702000 10                 TSX2    RE_ALT

     1706     7860    3               RD_CSCG.BUF_=VECTOR(CSCG_ANS);

   7860 10 000420   000014 237000 11                 LDAQ    12
        10 000421   000722 757000 1                  STAQ    RD_CSCG+4

     1707     7861    3               CALL M$READ (RD_CSCG) ALTRET(RE_ALT);

   7861 10 000422   000716 630400 1                  EPPR0   RD_CSCG
        10 000423   440000 713400                    CLIMB   alt,read
        10 000424   401400 401760                    pmme    nvectors=4
        10 000425   000334 702000 10                 TSX2    RE_ALT

     1708     7862    3               IF CSCG_ANS.ERR THEN

   7862 10 000426   001123 235000 1                  LDA     CSCG_ANS
        10 000427   000006 600000 10                 TZE     RD1

     1709     7863    3                  CALL XUR$ERRMSG (CSCG_ANS.ERR);

   7863 10 000430   000015 630400 11                 EPPR0   13
        10 000431   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000432   000000 701000 xent               TSX1    XUR$ERRMSG
        10 000433   000000 011000                    NOP     0
        10 000434   000006 710000 10                 TRA     RD1

     1710     7864    3             CASE (%END_CMD);

     1711     7865    3               RETURN;
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:301  

   7865 10 000435   000000 702200 xent               TSX2  ! X66_ARET

     1712     7866    3             CASE (%CMMNT_CMD);

     1713     7867    3               RETURN;                   /* Quit on blank or comment command   */

   7867 10 000436   000000 702200 xent               TSX2  ! X66_ARET

     1714     7868
     1715     7869    3             CASE(%HELP_CMD);

     1716     7870    3               XUH_PARAM.HELP$=OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.TEXTC$;

   7870 10 000437   100003 473500                    LDP3    3,,PR1
        10 000440   300003 236100                    LDQ     3,,PR3
        10 000441   000061 756000 1                  STQ     XUH_PARAM+9

     1717     7871    3               CALL XUR$HELP (XUH_PARAM);

   7871 10 000442   000020 630400 11                 EPPR0   16
        10 000443   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000444   000000 701000 xent               TSX1    XUR$HELP
        10 000445   000000 011000                    NOP     0
        10 000446   000006 710000 10                 TRA     RD1

     1718     7872    3             CASE(%Q1_CMD);

     1719     7873    3               CALL XUR$MOREMSG (XUH_PARAM) ALTRET(NOMORE);

   7873 10 000447   000020 630400 11                 EPPR0   16
        10 000450   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000451   000000 701000 xent               TSX1    XUR$MOREMSG
        10 000452   000461 702000 10                 TSX2    NOMORE
        10 000453   000006 710000 10                 TRA     RD1

     1720     7874    3             CASE(%Q2_CMD);
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:302  

     1721     7875    3               CALL XUR$ALLMSG (XUH_PARAM) ALTRET(NOMORE);

   7875 10 000454   000020 630400 11                 EPPR0   16
        10 000455   000017 631400 xsym               EPPR1   B_VECTNIL+15
        10 000456   000000 701000 xent               TSX1    XUR$ALLMSG
        10 000457   000461 702000 10                 TSX2    NOMORE

     1722     7876    4               DO WHILE ('0'B);

   7876 10 000460   000006 710000 10                 TRA     RD1

   7871 10 000461                       NOMORE       null
     1723     7877    4   NOMORE:        ;
     1724     7878    4                  END;

   7878 10 000461   000006 710000 10                 TRA     RD1

     1725     7879    3             CASE(%SNAP_CMD);

     1726     7880    3               WR_CSCG.BUF_=VECTOR(SNP_MSG);

   7880 10 000462   000022 237000 11                 LDAQ    18
        10 000463   000676 757000 1                  STAQ    WR_CSCG+4

     1727     7881    3               IF NOT DCBADDR(DCBNUM(M$CSCG))->F$DCB.FCD# THEN

   7881 10 000464   000000 236007 xsym               LDQ     M$CSCG,DL
        10 000465   000004 471400 11                 LDP1    4
        10 000466   100000 473500                    LDP3    0,,PR1
        10 000467   300000 474506                    LDP4    0,QL,PR3
        10 000470   400031 236100                    LDQ     25,,PR4
        10 000471   020000 316007                    CANQ    8192,DL
        10 000472   000476 601000 10                 TNZ     s:7883

     1728     7882    3                  CALL M$OPEN (OPN_CSCG);

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:303  
   7882 10 000473   000560 630400 1                  EPPR0   OPN_CSCG
        10 000474   050000 713400                    CLIMB   open
        10 000475   410400 401760                    pmme    nvectors=18

     1729     7883    3               CALL M$WRITE (WR_CSCG) ALTRET(RE_ALT);

   7883 10 000476   000672 630400 1                  EPPR0   WR_CSCG
        10 000477   440001 713400                    CLIMB   alt,write
        10 000500   401400 401760                    pmme    nvectors=4
        10 000501   000334 702000 10                 TSX2    RE_ALT
        10 000502   000006 710000 10                 TRA     RD1

     1730     7884    3             CASE (%CREATE_CMD);

     1731     7885    3               CMD_SIZ = OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT;

   7885 10 000503   100003 473500                    LDP3    3,,PR1
        10 000504   300004 236100                    LDQ     4,,PR3
        10 000505   000033 772000                    QRL     27
        10 000506   200007 756100                    STQ     CMD_SIZ,,AUTO

     1732     7886    3               IF CMD_SIZ = 0 THEN

   7886 10 000507   000017 600000 10                 TZE     CMD_ERR

     1733     7887    3                  GOTO CMD_ERR;
     1734     7888    3               CALL CONCAT (AMREC_CHR,

   7888 10 000510   300003 474500                    LDP4    3,,PR3
        10 000511   040000 100400                    MLR     fill='040'O
        10 000512   000000 000007 9                  ADSC9   SET_STR                  cn=0,n=7
        10 000513   001204 000007 1                  ADSC9   AMREC                    cn=0,n=7
        10 000514   000000 620006                    EAX0    0,QL
        10 000515   040000 100540                    MLR     fill='040'O
        10 000516   400000 200010                    ADSC9   0,,PR4                   cn=1,n=*X0
        10 000517   001205 607771 1                  ADSC9   AMREC+1                  cn=3,n=4089

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:304  
     1735     7889    3                  SET_STR,
     1736     7890    3                  PINCRC(OUT$BLK.SUBLK$(0)->OUT$BLK.SUBLK$(0)->
     1737     7891    3                  OUT$SYM.TEXTC$,1)->CMD);
     1738     7892    3               ADDR(YC_SET.CMD_)->BVECT.W1.VSIZE#=CMD_SIZ+SIZEC(SET_STR)-1;

   7892 10 000520   200007 236100                    LDQ     CMD_SIZ,,AUTO
        10 000521   000006 036007                    ADLQ    6,DL
        10 000522   000020 736000                    QLS     16
        10 000523   000550 676000 1                  ERQ     YC_SET
        10 000524   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 000525   000550 656000 1                  ERSQ    YC_SET

     1739     7893    3               CALL M$YC (YC_SET);

   7893 10 000526   000550 630400 1                  EPPR0   YC_SET
        10 000527   000011 713400                    CLIMB   9
        10 000530   401000 401760                    pmme    nvectors=3

     1740     7894    3               CALL M$OPEN (OPN_STARA);

   7894 10 000531   000142 630400 1                  EPPR0   OPN_STARA
        10 000532   050000 713400                    CLIMB   open
        10 000533   410400 401760                    pmme    nvectors=18

     1741     7895    3               RD_STARA.KEY_=VECTOR(N1KEY);

   7895 10 000534   000024 237000 11                 LDAQ    20
        10 000535   000236 757000 1                  STAQ    RD_STARA+2

     1742     7896    3               CALL M$READ (RD_STARA) ALTRET(CMD_ERR);

   7896 10 000536   000234 630400 1                  EPPR0   RD_STARA
        10 000537   440000 713400                    CLIMB   alt,read
        10 000540   401400 401760                    pmme    nvectors=4
        10 000541   000017 702000 10                 TSX2    CMD_ERR

     1743     7897    3               CALL M$CLOSE (CLS_STARA);
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:305  

   7897 10 000542   000252 630400 1                  EPPR0   CLS_STARA
        10 000543   050001 713400                    CLIMB   close
        10 000544   406000 401760                    pmme    nvectors=13

     1744     7898    3               SN_V=VECTOR(NSN);

   7898 10 000545   000026 237000 11                 LDAQ    22
        10 000546   001156 757000 1                  STAQ    SN_V

     1745     7899    3               IF AMR.SN_ ~= ADDR(NIL) THEN

   7899 10 000547   003204 470400 1                  LDP0    AMR$
        10 000550   000001 236100                    LDQ     1,,PR0
        10 000551   000001 116000 xsym               CMPQ    B_VECTNIL+1
        10 000552   000600 600000 10                 TZE     s:7904

     1746     7900    4               DO;

     1747     7901    4                  SN_V.P$=PINCRW(AMR$,POFFW(AMR.SN_,B$DS3$)-SIZEW(NSN)+1);

   7901 10 000553   000000 235000 xsym               LDA     B$DS3$
        10 000554   000022 771000                    ARL     18
        10 000555   200012 755100                    STA     ERRCODE+2,,AUTO
        10 000556   000001 236100                    LDQ     1,,PR0
        10 000557   000022 772000                    QRL     18
        10 000560   200012 136100                    SBLQ    ERRCODE+2,,AUTO
        10 000561   000022 736000                    QLS     18
        10 000562   000002 136003                    SBLQ    2,DU
        10 000563   003204 036000 1                  ADLQ    AMR$
        10 000564   001157 756000 1                  STQ     SN_V+1

     1748     7902    4                  SN_V.BND=((SN_V.P$->JAZ.Q.NUM#*6+3)/4+SIZEW(JAZ))*4-1;

   7902 10 000565   001157 471400 1                  LDP1    SN_V+1
        10 000566   100002 236100                    LDQ     2,,PR1
        10 000567   000006 402007                    MPY     6,DL
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:306  
        10 000570   000003 036007                    ADLQ    3,DL
        10 000571   000002 772000                    QRL     2
        10 000572   000002 736000                    QLS     2
        10 000573   000013 036007                    ADLQ    11,DL
        10 000574   000020 736000                    QLS     16
        10 000575   001156 676000 1                  ERQ     SN_V
        10 000576   000034 376000 xsym               ANQ     B_VECTNIL+28
        10 000577   001156 656000 1                  ERSQ    SN_V

     1749     7903    4                  END;

     1750     7904    3               OPNNAME=PINCRW(AMR$,POFFW(AMR.NAME_,B$DS3$))->JNAME;

   7904 10 000600   000000 235000 xsym               LDA     B$DS3$
        10 000601   000022 771000                    ARL     18
        10 000602   200012 755100                    STA     ERRCODE+2,,AUTO
        10 000603   000003 236100                    LDQ     3,,PR0
        10 000604   000022 772000                    QRL     18
        10 000605   200012 136100                    SBLQ    ERRCODE+2,,AUTO
        10 000606   000002 736000                    QLS     2
        10 000607   000000 100506                    MLR     fill='000'O
        10 000610   000000 000040                    ADSC9   0,Q,PR0                  cn=0,n=32
        10 000611   000766 000040 1                  ADSC9   OPNNAME                  cn=0,n=32

     1751     7905    3               IF AMR.ACCT_ ~= ADDR(NIL) THEN

   7905 10 000612   000012 236100                    LDQ     10,,PR0
        10 000613   000001 116000 xsym               CMPQ    B_VECTNIL+1
        10 000614   000626 600000 10                 TZE     s:7908

     1752     7906    3                  OPNACCT=PINCRW(AMR$,POFFW(AMR.ACCT_,B$DS3$))->JACCT;

   7906 10 000615   200012 755100                    STA     ERRCODE+2,,AUTO
        10 000616   000012 236100                    LDQ     10,,PR0
        10 000617   000022 772000                    QRL     18
        10 000620   200012 136100                    SBLQ    ERRCODE+2,,AUTO
        10 000621   000002 736000                    QLS     2
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:307  
        10 000622   000000 100506                    MLR     fill='000'O
        10 000623   000000 000010                    ADSC9   0,Q,PR0                  cn=0,n=8
        10 000624   000776 000010 1                  ADSC9   OPNACCT                  cn=0,n=8
        10 000625   000631 710000 10                 TRA     s:7909

     1753     7907    3               ELSE
     1754     7908    3                  OPNACCT.ACCT#=' ';

   7908 10 000626   000035 235000 xsym               LDA     B_VECTNIL+29
        10 000627   000035 236000 xsym               LDQ     B_VECTNIL+29
        10 000630   000776 757000 1                  STAQ    OPNACCT

     1755     7909    3               IF AMR.PASS_ ~= ADDR(NIL) THEN

   7909 10 000631   000004 236100                    LDQ     4,,PR0
        10 000632   000001 116000 xsym               CMPQ    B_VECTNIL+1
        10 000633   000647 600000 10                 TZE     s:7912

     1756     7910    3                  OPNPASS=PINCRW(AMR$,POFFW(AMR.PASS_,B$DS3$))->JPASS;

   7910 10 000634   000000 235000 xsym               LDA     B$DS3$
        10 000635   000022 771000                    ARL     18
        10 000636   200012 755100                    STA     ERRCODE+2,,AUTO
        10 000637   000004 236100                    LDQ     4,,PR0
        10 000640   000022 772000                    QRL     18
        10 000641   200012 136100                    SBLQ    ERRCODE+2,,AUTO
        10 000642   000002 736000                    QLS     2
        10 000643   000000 100506                    MLR     fill='000'O
        10 000644   000000 000010                    ADSC9   0,Q,PR0                  cn=0,n=8
        10 000645   001000 000010 1                  ADSC9   OPNPASS                  cn=0,n=8
        10 000646   000652 710000 10                 TRA     s:7913

     1757     7911    3               ELSE
     1758     7912    3                  OPNPASS.PASS#=' ';

   7912 10 000647   000035 235000 xsym               LDA     B_VECTNIL+29
        10 000650   000035 236000 xsym               LDQ     B_VECTNIL+29
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:308  
        10 000651   001000 757000 1                  STAQ    OPNPASS

     1759     7913    3               SN_V.P$->JAZ.SIZ#=SN_V.BND/4;

   7913 10 000652   001156 236000 1                  LDQ     SN_V
        10 000653   000020 772000                    QRL     16
        10 000654   000002 772000                    QRL     2
        10 000655   000000 620006                    EAX0    0,QL
        10 000656   001157 471400 1                  LDP1    SN_V+1
        10 000657   100000 440100                    SXL0    0,,PR1

     1760     7914    3               SN_V.P$->JAZ.NAW# = 100;

   7914 10 000660   000144 221003                    LDX1    100,DU
        10 000661   100000 741100                    STX1    0,,PR1

     1761     7915    3               SN_V.P$->JAZ.Q.ID=NSN.Q.ID;

   7915 10 000662   001003 222000 1                  LDX2    NSN+1
        10 000663   100001 742100                    STX2    1,,PR1

     1762     7916    3               SN_V.P$->JAZ.Q.ASN=AMR.V.ASN#;

   7916 10 000664   000023 236100                    LDQ     19,,PR0
        10 000665   000011 736000                    QLS     9
        10 000666   100001 552110                    STBQ    1,'10'O,PR1

     1763     7917    3               SN_V.P$->JAZ.Q.VOL#=0;

   7917 10 000667   000000 236003                    LDQ     0,DU
        10 000670   100001 552104                    STBQ    1,'04'O,PR1

     1764     7918    3               CALL M$OPEN (OPN_JRNL);

   7918 10 000671   000310 630400 1                  EPPR0   OPN_JRNL
        10 000672   050000 713400                    CLIMB   open
        10 000673   410400 401760                    pmme    nvectors=18
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:309  

     1765     7919    3               CLS_JRNL.UATTR_=SN_V;

   7919 10 000674   001156 237000 1                  LDAQ    SN_V
        10 000675   000420 757000 1                  STAQ    CLS_JRNL+14

     1766     7920    3               CALL M$CLOSE (CLS_JRNL);

   7920 10 000676   000402 630400 1                  EPPR0   CLS_JRNL
        10 000677   050001 713400                    CLIMB   close
        10 000700   406000 401760                    pmme    nvectors=13

     1767     7921    3             END;                        /* End case                           */

     1768     7922    2            END;                         /* End command read DO                */

   7922 10 000701   000006 710000 10                 TRA     RD1
     1769     7923    1   END;

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:310  
--  Include file information  --

   JG_EVID_C.:E05TOU  is referenced.
   FJ_PERR_C.:E05TOU  is referenced.
   FJ_SUBS_C.:E05TOU  is referenced.
   XUH_MACRO_C.:E05TOU  is referenced.
   XU_PERR_C.:E05TOU  is referenced.
   XU_SUBS_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   FJM_MACROS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FJJ$CJAY.
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:311  

 **** Variables and constants ****

  ****  Section 001  Data  FJJ$CJAY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  3204-0-0/w PTR         r     1 AMR$                    1204-0-0/w UBIN        r     1 AMREC(0:1023)
  1204-0-0/w CHAR(4096)  r     1 AMREC_CHR                402-0-0/d STRC(1080)  r     1 CLS_JRNL
   252-0-0/d STRC(1080)  r     1 CLS_STARA               1046-0-0/w STRC(900)   r     1 CNCL_MSG
   520-0-0/d STRC(864)   r     1 CN_FID1                  670-0-0/c STRC(72)    r     1 CSCG_ACCT
  1123-0-0/w STRC(252)   r     1 CSCG_ANS                 666-0-0/c STRC(45)    r     1 CSCG_NAME
  1160-0-0/d STRC(324)   r     1 FID1_RSLT               1172-0-0/d STRC(324)   r     1 FID2_RSLT
  3206-0-0/w UBIN(9)     r     1 JASN                     760-0-0/c STRC(45)    r     1 JAYSNAME
   706-0-0/w STRC(288)   r     1 JAYS_STA                3205-0-0/w UBIN        r     1 K
   744-0-0/d STRC(432)   r     1 LIST_ME                 1077-0-0/w STRC(360)   r     1 LST_MSG
  1132-0-0/w STRC(702)   r     1 LST_RSPNCE               734-0-0/w STRC(288)   r     1 MY_STA
   764-0-0/c STRC(27)    r     1 N1KEY                   1002-0-0/w STRC(108)   r     1 NSN
   776-0-0/c STRC(72)    r     1 OPNACCT                  766-0-0/c STRC(288)   r     1 OPNNAME
  1000-0-0/c STRC(72)    r     1 OPNPASS                  560-0-0/d STRC(2088)  r     1 OPN_CSCG
   310-0-0/d STRC(2088)  r     1 OPN_JRNL                 142-0-0/d STRC(2088)  r     1 OPN_STARA
   716-0-0/d STRC(504)   r     1 RD_CSCG                  234-0-0/d STRC(504)   r     1 RD_STARA
   440-0-0/d STRC(864)   r     1 RE_FID1                  470-0-0/d STRC(864)   r     1 RE_FID2
  1005-0-0/w STRC(1188)  r     1 RE_MSG                   762-0-0/c STRC(45)    r     1 SIKEY
  1111-0-0/w STRC(360)   r     1 SNP_MSG                 1156-0-0/w STRC(72)    r     1 SN_V
   765-0-0/c STRC(27)    r     1 STARA                    652-0-0/w STRC(432)   r     1 USR_JAY
   672-0-0/d STRC(432)   r     1 WR_CSCG                   50-0-0/d STRC(2052)  r     1 XUH_PARAM
     0-0-0/d STRC(1404)  r     1 XUR_INIT                 550-0-0/d STRC(288)   r     1 YC_SET

  ****  Section 009 RoData FJJ$CJAY

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/w STRC        r     1 NOFILENAME                 3-0-0/w STRC        r     1 ONLYFILE
     0-0-0/c CHAR(7)     r     1 SET_STR

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:312  
  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    10-0-0/w PTR         r     1 BLK$                       7-0-0/w UBIN        r     1 CMD_SIZ
    10-0-0/w STRC        r     1 ERRCODE                    3-0-0/w PTR         r     1 FNM1$
     5-0-0/w UBIN        r     1 FNM1SZ                     4-0-0/w PTR         r     1 FNM2$
     6-0-0/w UBIN        r     1 FNM2SZ

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$DS3$                     0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$TCB$                     0-0-0/w UBIN        r     1 FJ_JAYS_CMD

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1440)  r     1 AMR                        0-0-0/w STRC(2448)  r     1 B$ALT
     0-0-0/d STRC(2088)  r     1 B$JIT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/d STRC(72)    r     1 BVECT                      0-0-0/c ACHR        r     1 CMD
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/c ASTR(9)     r     1 FNM1
     0-0-0/c ASTR(9)     r     1 FNM2                       0-0-0/c STRC(72)    r     1 JACCT
     0-0-0/w STRC(108)   r     1 JAZ                        0-0-0/c STRC(288)   r     1 JNAME
     0-0-0/c STRC(72)    r     1 JPASS                      0-0-0N  NULL        r     1 M$A
     0-0-0N  NULL        r     1 M$CSCG                     0-0-0N  NULL        r     1 M$DO
     0-0-0N  NULL        r     1 M$J                        0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$ME                       0-0-0/w STRC(144)   r     1 OUT$BLK
     0-0-0/w ASTR(153)   r     1 OUT$SYM

PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:313  

   Procedure FJJ$CJAY requires 450 words for executable code.
   Procedure FJJ$CJAY requires 14 words of local(AUTO) storage.

    No errors detected in file FJJ$JAY.:E05TSI    .
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:314  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:315  
          MINI XREF LISTING

AMR.ACCT_
      6408**DCL      7905>>IF       7906>>ASSIGN
AMR.ACSVEH_
      6406**DCL      6407--REDEF
AMR.ALTKEYS_
      6412**DCL      6413--REDEF    6413--REDEF
AMR.HDR_
      6411**DCL      6412--REDEF
AMR.NAME_
      6405**DCL      7904>>ASSIGN
AMR.PASS_
      6406**DCL      7909>>IF       7910>>ASSIGN
AMR.SN_
      6404**DCL      7899>>IF       7901>>ASSIGN
AMR.TAB_
      6410**DCL      6411--REDEF
AMR.UHL_
      6404**DCL      6405--REDEF    6405--REDEF
AMR.V.ASN#
      6423**DCL      7916>>ASSIGN
AMR.V.FSN#
      6444**DCL      6444--REDEF    6444--REDEF
AMR.WSN_
      6410**DCL      6410--REDEF
AMR$
      7610**DCL      6404--IMP-PTR  7899>>IF       7901>>ASSIGN   7901>>ASSIGN   7904>>ASSIGN   7904>>ASSIGN
      7905>>IF       7906>>ASSIGN   7906>>ASSIGN   7909>>IF       7910>>ASSIGN   7910>>ASSIGN   7916>>ASSIGN
AMREC
      7605**DCL      6166--DCLINIT  6167--DCLINIT  6580--DCLINIT  7606--REDEF    7610--DCLINIT
AMREC_CHR
      7606**DCL      7888<<CALLBLT
B$ALT.CODE
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:316  
      6030**DCL      6030--REDEF    6031--REDEF    6031--REDEF
B$ALT.ERR
      6031**DCL      7845<>CALL
B$ALT.ERR.ERR#
      6032**DCL      6032--REDEF
B$ALT.EVID
      6031**DCL      6031--REDEF    6031--REDEF
B$DS3$
      7612**DCL      7901>>ASSIGN   7904>>ASSIGN   7906>>ASSIGN   7910>>ASSIGN
B$JIT.ACCN
      5882**DCL      7781>>ASSIGN   7831>>ASSIGN   7853>>ASSIGN
B$JIT.ERR.MID
      5883**DCL      5883--REDEF
B$JIT.FACCN
      5882**DCL      7782>>ASSIGN   7832>>ASSIGN   7835>>ASSIGN   7854>>ASSIGN
B$JIT.PRIV.JOB
      5926**DCL      7783>>ASSIGN   7833>>ASSIGN   7855>>ASSIGN
B$JIT.UNAME
      5882**DCL      7780>>ASSIGN   7830>>ASSIGN   7852>>ASSIGN
B$JIT$
      7614**DCL      5877--IMP-PTR  7780>>ASSIGN   7781>>ASSIGN   7782>>ASSIGN   7783>>ASSIGN   7830>>ASSIGN
      7831>>ASSIGN   7832>>ASSIGN   7833>>ASSIGN   7835>>ASSIGN   7852>>ASSIGN   7853>>ASSIGN   7854>>ASSIGN
      7855>>ASSIGN
B$TCB.ALT$
      6026**DCL      7845>>CALL
B$TCB$
      7613**DCL      7845>>CALL
BLK$
      7752**DCL      5637--IMP-PTR  5683--IMP-PTR  7763<>CALL     7773>>IF       7775>>DOCASE   7798>>ASSIGN
      7799>>ASSIGN   7800>>ASSIGN   7801>>ASSIGN   7848>>ASSIGN   7849>>ASSIGN   7870>>ASSIGN   7885>>ASSIGN
      7888>>CALLBLT
BVECT.W1.VSIZE#
      7159**DCL      7892<<ASSIGN
BVECT.W2
      7160**DCL      7161--REDEF
CLS_JRNL
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:317  
      6471**DCL      7920<>CALL
CLS_JRNL.SN_
      6471**DCL      6471--REDEF
CLS_JRNL.UATTR_
      6474**DCL      7919<<ASSIGN
CLS_JRNL.UTL_
      6472**DCL      6472--REDEF
CLS_JRNL.V
      6476**DCL      6471--DCLINIT
CLS_JRNL.V.EXPIRE#
      6486**DCL      6486--REDEF
CLS_JRNL.V.TYPE#
      6484**DCL      6484--REDEF
CLS_JRNL.V.XTNSIZE#
      6481**DCL      6481--REDEF    6483--REDEF
CLS_STARA
      6209**DCL      7897<>CALL
CLS_STARA.SN_
      6209**DCL      6209--REDEF
CLS_STARA.UTL_
      6210**DCL      6210--REDEF
CLS_STARA.V
      6214**DCL      6209--DCLINIT
CLS_STARA.V.EXPIRE#
      6224**DCL      6224--REDEF
CLS_STARA.V.TYPE#
      6222**DCL      6222--REDEF
CLS_STARA.V.XTNSIZE#
      6219**DCL      6219--REDEF    6221--REDEF
CMD
      7608**DCL      7888>>CALLBLT
CMD_ERR
      7765**LABEL    7763--CALLALT  7887--GOTO     7896--CALLALT
CMD_SIZ
      7607**DCL      7608--IMP-SIZ  7885<<ASSIGN   7886>>IF       7888>>CALLBLT  7892>>ASSIGN
CNCL_MSG
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:318  
      7313**DCL      7856--ASSIGN
CNCL_MSG.ACCN
      7360**DCL      7853<<ASSIGN
CNCL_MSG.FACCN
      7362**DCL      7854<<ASSIGN
CNCL_MSG.FID1.ACCT
      7354**DCL      6555--DCLINIT
CNCL_MSG.FID1.FNAME
      7351**DCL      6555--DCLINIT
CNCL_MSG.FID1.PASS
      7355**DCL      6556--DCLINIT
CNCL_MSG.FID1.SN
      7356**DCL      6556--DCLINIT
CNCL_MSG.PRIV
      7363**DCL      7855<<ASSIGN
CNCL_MSG.UNAME
      7361**DCL      7852<<ASSIGN
CN_FID1
      6554**DCL      7851<>CALL
CN_FID1.TEXTFID_
      6554**DCL      7850<<ASSIGN
CN_FID1.V
      6558**DCL      6554--DCLINIT
CSCG_ACCT
      6760**DCL      6655--DCLINIT
CSCG_ANS
      7520**DCL      7840--ASSIGN   7860--ASSIGN
CSCG_ANS.ERR
      7521**DCL      7842>>IF       7843<>CALL     7862>>IF       7863<>CALL
CSCG_NAME
      6747**DCL      6651--DCLINIT
ERRCODE
      7718**DCL      7752--REDEF    7766<>CALL
ERRCODE.ERR#
      7748**DCL      7767>>IF
F$DCB.ACTPOS
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:319  
      6001**DCL      6001--REDEF
F$DCB.ARS#
      5975**DCL      5975--REDEF
F$DCB.ATTR
      5994**DCL      5995--REDEF
F$DCB.BORROW
      6009**DCL      6009--REDEF    6009--REDEF    6009--REDEF
F$DCB.DCBNAME.L
      6023**DCL      6023--IMP-SIZ
F$DCB.EOMCHAR#
      5979**DCL      5979--REDEF
F$DCB.FCD#
      5988**DCL      7784>>IF       7837>>IF       7857>>IF       7881>>IF
F$DCB.FLDID
      6004**DCL      6004--REDEF
F$DCB.FORM$
      5998**DCL      5998--REDEF
F$DCB.FSECT
      6014**DCL      6014--REDEF
F$DCB.FSN#
      5991**DCL      5991--REDEF    5991--REDEF    5992--REDEF
F$DCB.HEADER$
      5997**DCL      5997--REDEF
F$DCB.IXTNSIZE#
      5995**DCL      5995--REDEF
F$DCB.LASTSTA$
      5984**DCL      5984--REDEF
F$DCB.LVL
      6010**DCL      6010--REDEF
F$DCB.NAME#.C
      5985**DCL      5985--REDEF
F$DCB.NOEOF
      6007**DCL      6007--REDEF
F$DCB.NRECS#
      5996**DCL      5996--REDEF
F$DCB.NRECX
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:320  
      6015**DCL      6015--REDEF
F$DCB.OHDR
      6007**DCL      6007--REDEF
F$DCB.ORG#
      5990**DCL      5990--REDEF
F$DCB.PRECNO
      6013**DCL      6013--REDEF
F$DCB.RCSZ
      6019**DCL      6019--REDEF
F$DCB.RES#
      5986**DCL      5986--REDEF
F$DCB.SETX
      5998**DCL      5998--REDEF
F$DCB.TAB$
      5998**DCL      5998--REDEF
F$DCB.TDA
      6012**DCL      6013--REDEF
F$DCB.WSN#
      5986**DCL      5986--REDEF
FID1_RSLT
      7568**DCL      6508--DCLINIT
FID1_RSLT.NAME
      7568**DCL      7822>>IF
FID2_RSLT
      7587**DCL      6533--DCLINIT
FID2_RSLT.NAME
      7587**DCL      7805>>IF
FJ_JAYS_CMD
      7755**DCL      7763<>CALL
FNM1.C
      7600**DCL      7803--ASSIGN   7850--ASSIGN
FNM1$
      7601**DCL      7598--IMP-PTR  7798<<ASSIGN   7803>>ASSIGN   7848<<ASSIGN   7850>>ASSIGN
FNM1SZ
      7603**DCL      7600--IMP-SIZ  7800<<ASSIGN   7803>>ASSIGN   7849<<ASSIGN   7850>>ASSIGN
FNM2.C
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:321  
      7597**DCL      7802--ASSIGN
FNM2$
      7602**DCL      7595--IMP-PTR  7799<<ASSIGN   7802>>ASSIGN
FNM2SZ
      7604**DCL      7597--IMP-SIZ  7801<<ASSIGN   7802>>ASSIGN
JACCT
      7067**DCL      7906>>ASSIGN
JASN
      7753**DCL      6507--DCLINIT  6532--DCLINIT  6557--DCLINIT  7813>>IF       7826>>IF
JAYSNAME
      6945**DCL      5838--DCLINIT
JAYS_STA
      6806**DCL      6782--DCLINIT
JAYS_STA.MSGIDXT
      6816**DCL      6819--REDEF
JAZ
      7187**DCL      7902--ASSIGN
JAZ.NAW#
      7187**DCL      7914<<ASSIGN
JAZ.Q.ASN
      7191**DCL      7916<<ASSIGN
JAZ.Q.ID
      7190**DCL      7915<<ASSIGN
JAZ.Q.NUM#
      7193**DCL      7902>>ASSIGN
JAZ.Q.VOL#
      7192**DCL      7917<<ASSIGN
JAZ.SIZ#
      7187**DCL      7913<<ASSIGN
JNAME
      7054**DCL      7904>>ASSIGN
JPASS
      7080**DCL      7910>>ASSIGN
K
      7611**DCL      6507--DCLINIT
LIST_ME
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:322  
      6906**DCL      7793<>CALL
LIST_ME.STATION_
      6908**DCL      6908--REDEF
LIST_ME.V
      6909**DCL      6906--DCLINIT
LIST_ME.V.DVBYTE.VFC#
      6915**DCL      6915--REDEF
LST1
      7788**LABEL    7795--GOTO
LST_MSG
      7386**DCL      7779--ASSIGN
LST_MSG.ACCN
      7440**DCL      7781<<ASSIGN
LST_MSG.FACCN
      7442**DCL      7782<<ASSIGN
LST_MSG.PRIV
      7443**DCL      7783<<ASSIGN
LST_MSG.UNAME
      7441**DCL      7780<<ASSIGN
LST_RSPNCE
      7530**DCL      7787--ASSIGN
LST_RSPNCE.ERR
      7531**DCL      7789>>IF       7790<>CALL
LST_RSPNCE.LAST
      7532**DCL      7794>>IF
LST_RSPNCE.TXT
      7533**DCL      6907--DCLINIT  6908--DCLINIT
M$CLOSE
        19**DCL-ENT  7897--CALL     7920--CALL
M$CSCG
      7548**DCL      7784--IF       7837--IF       7857--IF       7881--IF
M$FID
        82**DCL-ENT  7804--CALL     7821--CALL     7851--CALL
M$ME
      7547**DCL      7765<>CALL     7766<>CALL
M$OPEN
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:323  
        19**DCL-ENT  7785--CALL     7838--CALL     7858--CALL     7882--CALL     7894--CALL     7918--CALL
M$READ
        20**DCL-ENT  7788--CALL     7841--CALL     7861--CALL     7896--CALL
M$WRITE
        20**DCL-ENT  7786--CALL     7793--CALL     7839--CALL     7859--CALL     7883--CALL
M$YC
        33**DCL-ENT  7893--CALL
MY_STA
      6873**DCL      6842--DCLINIT
MY_STA.MSGIDXT
      6883**DCL      6886--REDEF
N1KEY
      7000**DCL      7895--ASSIGN
NOFILENAME
      7628**DCL      7806<>CALL     7823<>CALL
NOMORE
      7871**LABEL    7873--CALLALT  7875--CALLALT
NSN
      7219**DCL      7898--ASSIGN   7901--ASSIGN
NSN.Q
      7220**DCL      7219--DCLINIT
NSN.Q.ID
      7222**DCL      7915>>ASSIGN
ONLYFILE
      7673**DCL      7814<>CALL     7827<>CALL
OPNACCT
      7120**DCL      6300--DCLINIT  7906<<ASSIGN
OPNACCT.ACCT#
      7120**DCL      7908<<ASSIGN
OPNNAME
      7107**DCL      6296--DCLINIT  7904<<ASSIGN
OPNPASS
      7133**DCL      6297--DCLINIT  7910<<ASSIGN
OPNPASS.PASS#
      7133**DCL      7912<<ASSIGN
OPN_CSCG
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:324  
      6650**DCL      7785<>CALL     7838<>CALL     7858<>CALL     7882<>CALL
OPN_CSCG.ACSVEH_
      6652**DCL      6653--REDEF
OPN_CSCG.ALTKEYS_
      6658**DCL      6659--REDEF    6659--REDEF
OPN_CSCG.HDR_
      6657**DCL      6658--REDEF
OPN_CSCG.TAB_
      6656**DCL      6657--REDEF
OPN_CSCG.UHL_
      6650**DCL      6651--REDEF    6651--REDEF
OPN_CSCG.V
      6659**DCL      6650--DCLINIT
OPN_CSCG.V.FSN#
      6690**DCL      6690--REDEF    6690--REDEF
OPN_CSCG.WSN_
      6656**DCL      6656--REDEF
OPN_JRNL
      6295**DCL      7918<>CALL
OPN_JRNL.ACSVEH_
      6297**DCL      6298--REDEF
OPN_JRNL.ALTKEYS_
      6303**DCL      6304--REDEF    6304--REDEF
OPN_JRNL.HDR_
      6302**DCL      6303--REDEF
OPN_JRNL.TAB_
      6301**DCL      6302--REDEF
OPN_JRNL.UHL_
      6295**DCL      6296--REDEF    6296--REDEF
OPN_JRNL.V
      6304**DCL      6295--DCLINIT
OPN_JRNL.V.FSN#
      6335**DCL      6335--REDEF    6335--REDEF
OPN_JRNL.WSN_
      6301**DCL      6301--REDEF
OPN_STARA
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:325  
      6103**DCL      7894<>CALL
OPN_STARA.ACSVEH_
      6105**DCL      6106--REDEF
OPN_STARA.ALTKEYS_
      6111**DCL      6112--REDEF    6112--REDEF
OPN_STARA.HDR_
      6110**DCL      6111--REDEF
OPN_STARA.TAB_
      6109**DCL      6110--REDEF
OPN_STARA.UHL_
      6103**DCL      6104--REDEF    6104--REDEF
OPN_STARA.V
      6112**DCL      6103--DCLINIT
OPN_STARA.V.FSN#
      6143**DCL      6143--REDEF    6143--REDEF
OPN_STARA.WSN_
      6109**DCL      6109--REDEF
OUT$BLK.CODE
      5645**DCL      7775>>DOCASE
OUT$BLK.NSUBLKS
      5649**DCL      7773>>IF
OUT$BLK.SUBLK$
      5670**DCL      7775>>DOCASE   7798>>ASSIGN   7798>>ASSIGN   7799>>ASSIGN   7799>>ASSIGN   7800>>ASSIGN
      7800>>ASSIGN   7801>>ASSIGN   7801>>ASSIGN   7848>>ASSIGN   7848>>ASSIGN   7849>>ASSIGN   7849>>ASSIGN
      7870>>ASSIGN   7870>>ASSIGN   7885>>ASSIGN   7885>>ASSIGN   7888>>CALLBLT  7888>>CALLBLT
OUT$SYM.COUNT
      5706**DCL      5709--IMP-SIZ  7800>>ASSIGN   7801>>ASSIGN   7849>>ASSIGN   7885>>ASSIGN
OUT$SYM.TEXTC$
      5701**DCL      7798>>ASSIGN   7799>>ASSIGN   7848>>ASSIGN   7870>>ASSIGN   7888>>CALLBLT
RD1
      7763**LABEL    7770--GOTO     7774--GOTO     7811--GOTO     7819--GOTO     7824--GOTO     7828--GOTO
RD_CSCG
      6839**DCL      7788<>CALL     7841<>CALL     7861<>CALL
RD_CSCG.BUF_
      6841**DCL      7787<<ASSIGN   7840<<ASSIGN   7860<<ASSIGN
RD_CSCG.STATION_
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:326  
      6842**DCL      6843--REDEF
RD_CSCG.V
      6843**DCL      6839--DCLINIT
RD_CSCG.V.DVBYTE.REREAD#
      6854**DCL      6854--REDEF
RD_CSCG.V.INDX#
      6852**DCL      6852--REDEF
RD_STARA
      6164**DCL      7896<>CALL
RD_STARA.KEY_
      6164**DCL      7895<<ASSIGN
RD_STARA.STATION_
      6167**DCL      6168--REDEF
RD_STARA.V
      6168**DCL      6164--DCLINIT
RD_STARA.V.DVBYTE.REREAD#
      6179**DCL      6179--REDEF
RD_STARA.V.INDX#
      6177**DCL      6177--REDEF
RE_ALT
      7845**LABEL    7786--CALLALT  7788--CALLALT  7804--CALLALT  7821--CALLALT  7839--CALLALT  7841--CALLALT
      7851--CALLALT  7859--CALLALT  7861--CALLALT  7883--CALLALT
RE_FID1
      6504**DCL      7821<>CALL
RE_FID1.TEXTFID_
      6504**DCL      7803<<ASSIGN
RE_FID1.V
      6508**DCL      6504--DCLINIT
RE_FID2
      6529**DCL      7804<>CALL
RE_FID2.TEXTFID_
      6529**DCL      7802<<ASSIGN
RE_FID2.V
      6533**DCL      6529--DCLINIT
RE_MSG
      7240**DCL      7836--ASSIGN
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:327  
RE_MSG.ACCN
      7270**DCL      7831<<ASSIGN
RE_MSG.FACCN
      7272**DCL      7832<<ASSIGN
RE_MSG.FID1.ACCT
      7260**DCL      6505--DCLINIT  6530--DCLINIT  7834>>IF       7835<<ASSIGN
RE_MSG.FID1.FNAME
      7257**DCL      6505--DCLINIT
RE_MSG.FID1.PASS
      7261**DCL      6506--DCLINIT  6531--DCLINIT
RE_MSG.FID1.SN
      7262**DCL      6506--DCLINIT  6531--DCLINIT
RE_MSG.FID2.FNAME
      7267**DCL      6530--DCLINIT
RE_MSG.PRIV
      7273**DCL      7833<<ASSIGN
RE_MSG.UNAME
      7271**DCL      7830<<ASSIGN
SET_STR
      7609**DCL      7888>>CALLBLT  7892--ASSIGN
SIKEY
      6973**DCL      6164--DCLINIT  6165--DCLINIT
SNP_MSG
      7459**DCL      7880--ASSIGN
SN_V
      7553**DCL      7898<<ASSIGN   7919>>ASSIGN
SN_V.BND
      7554**DCL      7902<<ASSIGN   7913>>ASSIGN
SN_V.P$
      7556**DCL      7901<<ASSIGN   7902>>ASSIGN   7913>>ASSIGN   7914>>ASSIGN   7915>>ASSIGN   7916>>ASSIGN
      7917>>ASSIGN
STARA
      7027**DCL      6104--DCLINIT
USR_JAY
      6706**DCL      6651--DCLINIT
WR_CSCG
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:328  
      6780**DCL      7786<>CALL     7839<>CALL     7859<>CALL     7883<>CALL
WR_CSCG.BUF_
      6780**DCL      7779<<ASSIGN   7836<<ASSIGN   7856<<ASSIGN   7880<<ASSIGN
WR_CSCG.STATION_
      6782**DCL      6782--REDEF
WR_CSCG.V
      6783**DCL      6780--DCLINIT
WR_CSCG.V.DVBYTE.VFC#
      6789**DCL      6789--REDEF
XTX$ADAPT
      5732**DCL-ENT  5811--DCLINIT
XUH_PARAM
      5834**DCL      7871<>CALL     7873<>CALL     7875<>CALL
XUH_PARAM.HELP$
      5844**DCL      7870<<ASSIGN
XUR$ALLMSG
      7542**DCL-ENT  7875--CALL
XUR$ERRMSG
      7539**DCL-ENT  7766--CALL     7790--CALL     7806--CALL     7814--CALL     7823--CALL     7827--CALL
      7843--CALL     7845--CALL     7863--CALL
XUR$ERRPTR
      7538**DCL-ENT  7765--CALL
XUR$GETCMD
      7537**DCL-ENT  7763--CALL
XUR$HELP
      7540**DCL-ENT  7871--CALL
XUR$INIT
      7536**DCL-ENT  7761--CALL
XUR$MOREMSG
      7541**DCL-ENT  7873--CALL
XUR_INIT
      5737**DCL      7761<>CALL
XUR_INIT.WORKR_
      5751**DCL      5752--REDEF
YC_SET
      6580**DCL      7893<>CALL
PL6.E3A0      #003=FJJ$CJAY File=FJJ$JAY.:E05TSI                                 TUE 07/29/97 15:29 Page:329  
YC_SET.CMD_
      6580**DCL      7892--ASSIGN
YC_SET.V
      6581**DCL      6580--DCLINIT
