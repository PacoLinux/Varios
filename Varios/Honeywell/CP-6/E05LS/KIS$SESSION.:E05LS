VERSION E05

PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:1    
        1        1        /*M* KIS$SESSION - Session Services on the Host   */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0   */
        8        8
        9        9        /*P* NAME: KIS$SESSION
       10       10
       11       11        The KIS$SESSION file contains the following modules:
       12       12
       13       13        .fif
       14       14        }  KIS$SEND     - to forward outbound messages
       15       15        }  KIS$RECV     - to recieve inbound messages
       16       16        }  KIS$REP_DISC  - to handle a link going down
       17       17        }  KIS$REP_TERM  - to handle a transport connection going down
       18       18        }  KIS$UNQUEUE  - to run the chain of LDCTs that have been queued
       19       19        .fin
       20       20        */
       21       21
       22       22        /*X* PLM=3,IND=5,ENU=0,ECU=0   */
       23       23
       24       24        KIS$SEND: PROC (K$RWPARM) ALTRET;
       25       25
       26       26
       27       27                                                /* Include files                      */
       28       28        %INCLUDE K_SUBS_C;
       29       61        %INCLUDE NK$LDCT;
       30      163        %INCLUDE KI_CP6;
       31     1259        %INCLUDE K_QDPHDRS_M;
       32     2141        %INCLUDE K_RLCID_M;
       33     2245        %INCLUDE K$RWPARM;
       34     2631
       35     2632                                                /* Parameter definitions              */
       36     2633        %K$RWPARM (NAME=K$RWPARM);
       37     2949
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:2    
       38     2950                                                /* Entry point references             */
       39     2951    1   DCL KIN$SEND ENTRY(1) ALTRET;
       40     2952    1   DCL KIT$SEND ENTRY(1) ALTRET;
       41     2953    1   DCL SC_BADFNC ENTRY CONV(2,0);
       42     2954
       43     2955                                                /* Based items                        */
       44     2956        %NK$LDCT (STCLASS="BASED(K$RWPARM.LDCT$)");
       45     3002    1   DCL 1 RECTYP BASED ALIGNED,
       46     3003    1         2 * UBIN(20) UNAL,
       47     3004    1         2 TOP UBIN(8) UNAL,
       48     3005    1         2 BOT UBIN(8) UNAL;
       49     3006
       50     3007                                                /* Auto                               */
       51     3008    1   DCL FUNCTION UBIN;
       52     3009    1   DCL SEND_ENTRY$ EPTR;
       53     3010
       54     3011        %K$SQDP_DATA (NAME=DATA_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED, ALGN=CALIGNED);
       55     3138
       56     3139        %K$SQDP_TERM (NAME=TERM_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED, ALGN=CALIGNED);
       57     3417
       58     3418        %K$SQDP_INIT (NAME=HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED, ALGN=CALIGNED);
       59     3782
       60     3783        %K$SQDP_INIT_ACK (NAME=INIT_ACK_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED, ALGN=CALIGNED
              3783            );
       61     4076
       62     4077    1   DCL TEMP UBIN;
       63     4078    1   DCL 1 TEMPR REDEF TEMP,
       64     4079    1         2 TOP UBIN(28) UNAL,
       65     4080    1         2 BOT UBIN(8) UNAL;
       66     4081
       67     4082                                                /* SYMREFs                            */
       68     4083    1   DCL K_NODE# UBIN SYMREF;
       69     4084
       70     4085        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:3    
       71     4086        /*F* NAME: KIS$SEND - Send Host Outbound Messages
       72     4087
       73     4088        KIS$SEND is the interface for host application layer to
       74     4089        the network or transport layer.  It is used for fep to host
       75     4090        communications.
       76     4091
       77     4092        KIS$SEND is called with the following parameters:
       78     4093
       79     4094        .fif
       80     4095        }   K$RWPARM.PARMAER.FUNCTION
       81     4096        }                - The function to be performed.  This will be one of the
       82     4097        }                  folowing EQUed values from the file K_SUBS_C:
       83     4098        }
       84     4099        }                      K_WRITE
       85     4100        }                      K_READDONE
       86     4101        }                      K_CONNECT_ACK
       87     4102        }                      K_DISCONNECT
       88     4103        }
       89     4104        }    K$RWPARM.LDCT$
       90     4105        }                - The LDCT assigned to the host end point.
       91     4106        }
       92     4107        .fin
       93     4108
       94     4109        The action taken by KIS$SEND is dependent on the FUNCTION code.
       95     4110        */
       96     4111
       97     4112    1      FUNCTION = K$RWPARM.FUNCTION;
       98     4113
       99     4114    1      IF NK$LDCT.DFLG.FEDN
      100     4115    1      THEN IF FUNCTION = %K_REPDISC
      101     4116    1           THEN RETURN;
      102     4117    2           ELSE DO;
      103     4118    2                K$RWPARM.ERR = %K$FEP_DOWN;
      104     4119    2                ALTRETURN;
      105     4120    2                END;
      106     4121
      107     4122    1      K$RWPARM.FEX = NK$LDCT.RLCID.NODE;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:4    
      108     4123
      109     4124    1      IF NK$LDCT.LKFLG.QDPPATH
      110     4125    1      THEN SEND_ENTRY$ = ENTADDR(KIN$SEND);
      111     4126    2      ELSE DO;
      112     4127    2           SEND_ENTRY$ = ENTADDR(KIT$SEND);
      113     4128    2           K$RWPARM.TCTX# = NK$LDCT.TCTX#;
      114     4129    2           END;
      115     4130
      116     4131    1      IF FUNCTION = %K_WRITE
      117     4132    1      THEN GOTO SEND_DATA;
      118     4133
      119     4134        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:5    
      120     4135        /*F* NAME: KIS$SEND - Read Done
      121     4136
      122     4137        KIS$SEND is called with FUNCTION set to K_READDONE from
      123     4138        KIA$UCIO, KIA$UCIOND and KCD$CGDEV.
      124     4139
      125     4140        All the setup for calling network has been done
      126     4141        and KIS$SEND simply calls KIN$SEND passing the
      127     4142        K$RWPARM parameter.
      128     4143        */
      129     4144
      130     4145    2      DO CASE (FUNCTION);
      131     4146
      132     4147    2       CASE (%K_READDONE);
      133     4148    2         CALL KIN$SEND(K$RWPARM) ALTRET(ERROR);
      134     4149    2         RETURN;
      135     4150        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:6    
      136     4151        /*F* NAME: KIS$SEND - Connect Acknowledgement
      137     4152
      138     4153        KIS$SEND is called with FUNCTION set to K_CONNECT_ACK
      139     4154        from KIA$FPCNCT (FPRG connection complete).
      140     4155
      141     4156        An initiate acknowledgement message is built in auto with
      142     4157        information from the LDCT and K$RWPARM.SHDR$ is modified
      143     4158        to point to this message.
      144     4159
      145     4160        The code in K$RWPARM.FUNCTION is set to K_WRITE, and KIT$SEND
      146     4161        or KIN$SEND is called with the single parameter, K$RWPARM.
      147     4162        */
      148     4163    2       CASE (%K_CONNECT_ACK);
      149     4164    2         K$RWPARM.SHDR$ = ADDR(INIT_ACK_HDR);
      150     4165    2         K$RWPARM.SHDRSZ = SIZEC(INIT_ACK_HDR);
      151     4166
      152     4167    2         INIT_ACK_HDR.CNTRL = '01'B;
      153     4168    2         INIT_ACK_HDR.TYPE = %K_SQDP_INIT_ACK;
      154     4169
      155     4170    2         TEMP = K$RWPARM.UHDRSZ + K$RWPARM.MSGSZ;
      156     4171    2         INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.LOBYTE = TEMP;
      157     4172    2         INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.HIBYTE = TEMPR.TOP;
      158     4173
      159     4174    2         TEMP = K$RWPARM.ERR;
      160     4175    2         INIT_ACK_HDR.REASON_UNPK.LOBYTE = TEMP;
      161     4176    2         INIT_ACK_HDR.REASON_UNPK.HIBYTE = TEMPR.TOP;
      162     4177
      163     4178    2         TEMP = NK$LDCT.LDCTX;
      164     4179    2         INIT_ACK_HDR.RLCID.LDCTX_UNPK.LOBYTE = TEMP;
      165     4180    2         INIT_ACK_HDR.RLCID.LDCTX_UNPK.HIBYTE = TEMPR.TOP;
      166     4181
      167     4182    2         INIT_ACK_HDR.RLCID.NODE = K_NODE#;
      168     4183    2         INIT_ACK_HDR.RLCID.GENERATION = NK$LDCT.GENERATION;
      169     4184
      170     4185    2         INIT_ACK_HDR.RESCODE = NK$LDCT.RESCOD;
      171     4186
      172     4187    2         INIT_ACK_HDR.LDCT = NK$LDCT.RLCID.LDCTX; /*maintained unpacked*/
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:7    
      173     4188
      174     4189    2         K$RWPARM.FUNCTION = %K_WRITE;
      175     4190    2         CALL SEND_ENTRY$(K$RWPARM) ALTRET(ERROR);
      176     4191    2         RETURN;
      177     4192        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:8    
      178     4193        /*F* NAME: KIS$SEND - Disconnect
      179     4194
      180     4195        KIS$SEND is called with FUNCTION set to K_DISCONNECT
      181     4196        when FSP$CLSDEV calls KIA$DSCU
      182     4197        or KIA$ISCAN calls KIA$DSC.
      183     4198
      184     4199        A session terminate header is built in auto and the message
      185     4200        is passed to SEND_ENTRY$ with K$RWPARM.FUNCTION
      186     4201        set to K_WRITE.
      187     4202        */
      188     4203
      189     4204    2       CASE (%K_DISCONNECT);
      190     4205    2         K$RWPARM.SHDR$ = ADDR(TERM_HDR);
      191     4206    2         K$RWPARM.SHDRSZ = SIZEC(TERM_HDR);
      192     4207
      193     4208    2         TERM_HDR.CNTRL = '01'B;
      194     4209    2         TERM_HDR.TYPE = %K_SQDP_TERM;
      195     4210
      196     4211    2         TERM_HDR.LDCT = NK$LDCT.RLCID.LDCTX;
      197     4212    2         TERM_HDR.RLCID = '0'B;
      198     4213
      199     4214    2         TEMP = K$RWPARM.ERR;
      200     4215    2         TERM_HDR.REASON_UNPK.LOBYTE = TEMP;
      201     4216    2         TERM_HDR.REASON_UNPK.HIBYTE = TEMPR.TOP;
      202     4217
      203     4218    2         TEMP = K$RWPARM.UHDRSZ + K$RWPARM.MSGSZ;
      204     4219    2         TERM_HDR.DATA_HDR.LENGTH_UNPK.LOBYTE = TEMP;
      205     4220    2         TERM_HDR.DATA_HDR.LENGTH_UNPK.HIBYTE = TEMPR.TOP;
      206     4221
      207     4222    2         TEMP = K$RWPARM.RECTYPE;
      208     4223    2         TERM_HDR.DATA_HDR.TYPE_UNPK.LOBYTE = TEMP;
      209     4224    2         TERM_HDR.DATA_HDR.TYPE_UNPK.HIBYTE = TEMPR.TOP;
      210     4225
      211     4226    2         K$RWPARM.FUNCTION = %K_WRITE;
      212     4227    2         CALL SEND_ENTRY$(K$RWPARM) ALTRET(ERROR);
      213     4228
      214     4229    2         NK$LDCT.DFLG.FEDN = '1'B;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:9    
      215     4230    2         RETURN;
      216     4231
      217     4232
      218     4233        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:10   
      219     4234        /*F* NAME: KIS$SEND - Write
      220     4235
      221     4236        KIS$SEND is called with FUNCTION set to K_WRITE
      222     4237        from KIA$FCNO and KIA$FCNOU.
      223     4238
      224     4239        A data message header is built in auto with
      225     4240        information from the LDCT and K$RWPARM.SHDR$ is modified
      226     4241        to point to this message.
      227     4242
      228     4243        SEND_ENTRY$ is called with the single parameter,
      229     4244        K$RWPARM.
      230     4245        */
      231     4246    2       CASE (%K_WRITE);
      232     4247
      233     4248    2   SEND_DATA:
      234     4249    2         K$RWPARM.SHDR$ = ADDR(DATA_HDR);
      235     4250    2         K$RWPARM.SHDRSZ = SIZEC(DATA_HDR);
      236     4251
      237     4252    2         DATA_HDR = '0'B;
      238     4253
      239     4254    2         TEMP = K$RWPARM.UHDRSZ + K$RWPARM.MSGSZ;
      240     4255    2         DATA_HDR.LENGTH_UNPK.LOBYTE = TEMP;
      241     4256    2         DATA_HDR.LENGTH_UNPK.HIBYTE = TEMPR.TOP;
      242     4257
      243     4258    2         DATA_HDR.TYPE_UNPK.HIBYTE = ADDR(K$RWPARM.RECTYPE)->RECTYP.TOP;
      244     4259    2         DATA_HDR.TYPE_UNPK.LOBYTE = K$RWPARM.RECTYPE;
      245     4260
      246     4261    2         DATA_HDR.LDCT = NK$LDCT.RLCID.LDCTX;
      247     4262
      248     4263    2         CALL SEND_ENTRY$(K$RWPARM) ALTRET(ERROR);
      249     4264    2         RETURN;
      250     4265        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:11   
      251     4266    2       CASE (ELSE);
      252     4267    2         CALL SC_BADFNC;
      253     4268    2         END;
      254     4269
      255     4270    1      RETURN;
      256     4271
      257     4272        /*S* SCREECH_CODE: KIS-S$BADFNC
      258     4273             TYPE: SCREECH
      259     4274             MESSAGE: Bad function code passed to session.
      260     4275        */
      261     4276
      262     4277        /* Altrets from KIN$SEND come here.
      263     4278        */
      264     4279    1   ERROR:;
      265     4280    1      IF K$RWPARM.ERR ~= %K$QFULL
      266     4281    1        AND K$RWPARM.ERR ~= %K$BAD_BUFFER  /* #32327                             */
      267     4282    1        AND K$RWPARM.ERR ~= %K$Q2SMALL     /* #30431                             */
      268     4283    1      THEN NK$LDCT.DFLG.FEDN = '1'B;
      269     4284    1      ALTRETURN;
      270     4285
      271     4286    1   END KIS$SEND;
      272     4287        %EOD;

PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:12   
--  Include file information  --

   K$RWPARM.:E05TOU  is referenced.
   K_RLCID_M.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIS$SEND.

   Procedure KIS$SEND requires 231 words for executable code.
   Procedure KIS$SEND requires 30 words of local(AUTO) storage.

PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:13   

 Object Unit name= KIS$SEND                                   File name= KIS$SESSION.:E05TOU
 UTS= JUL 30 '97 00:41:37.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   231    347  KIS$SEND
    1  RoData even  none     2      2  KIS$SEND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  KIS$SEND

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KIN$SEND
 yes     yes           Std       1 KIT$SEND
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BADFNC                             K_NODE#                               B_VECTNIL
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:14   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:15   


        1        1        /*M* KIS$SESSION - Session Services on the Host   */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0   */
        8        8
        9        9        /*P* NAME: KIS$SESSION
       10       10
       11       11        The KIS$SESSION file contains the following modules:
       12       12
       13       13        .fif
       14       14        }  KIS$SEND     - to forward outbound messages
       15       15        }  KIS$RECV     - to recieve inbound messages
       16       16        }  KIS$REP_DISC  - to handle a link going down
       17       17        }  KIS$REP_TERM  - to handle a transport connection going down
       18       18        }  KIS$UNQUEUE  - to run the chain of LDCTs that have been queued
       19       19        .fin
       20       20        */
       21       21
       22       22        /*X* PLM=3,IND=5,ENU=0,ECU=0   */
       23       23
       24       24        KIS$SEND: PROC (K$RWPARM) ALTRET;

     24  0 000000   000000 700200 xent  KIS$SEND     TSX0  ! X66_AUTO_1
         0 000001   000036 000001                    ZERO    30,1

       25       25
       26       26
       27       27                                                /* Include files                      */
       28       28        %INCLUDE K_SUBS_C;
       29       61        %INCLUDE NK$LDCT;
       30      163        %INCLUDE KI_CP6;
       31     1259        %INCLUDE K_QDPHDRS_M;
       32     2141        %INCLUDE K_RLCID_M;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:16   
       33     2245        %INCLUDE K$RWPARM;
       34     2631
       35     2632                                                /* Parameter definitions              */
       36     2633        %K$RWPARM (NAME=K$RWPARM);
       37     2949
       38     2950                                                /* Entry point references             */
       39     2951    1   DCL KIN$SEND ENTRY(1) ALTRET;
       40     2952    1   DCL KIT$SEND ENTRY(1) ALTRET;
       41     2953    1   DCL SC_BADFNC ENTRY CONV(2,0);
       42     2954
       43     2955                                                /* Based items                        */
       44     2956        %NK$LDCT (STCLASS="BASED(K$RWPARM.LDCT$)");
       45     3002    1   DCL 1 RECTYP BASED ALIGNED,
       46     3003    1         2 * UBIN(20) UNAL,
       47     3004    1         2 TOP UBIN(8) UNAL,
       48     3005    1         2 BOT UBIN(8) UNAL;
       49     3006
       50     3007                                                /* Auto                               */
       51     3008    1   DCL FUNCTION UBIN;
       52     3009    1   DCL SEND_ENTRY$ EPTR;
       53     3010
       54     3011        %K$SQDP_DATA (NAME=DATA_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED, ALGN=CALIGNED);
       55     3138
       56     3139        %K$SQDP_TERM (NAME=TERM_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED, ALGN=CALIGNED);
       57     3417
       58     3418        %K$SQDP_INIT (NAME=HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED, ALGN=CALIGNED);
       59     3782
       60     3783       %K$SQDP_INIT_ACK (NAME=INIT_ACK_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED, ALGN=CALIGNED
              3783            );
       61     4076
       62     4077    1   DCL TEMP UBIN;
       63     4078    1   DCL 1 TEMPR REDEF TEMP,
       64     4079    1         2 TOP UBIN(28) UNAL,
       65     4080    1         2 BOT UBIN(8) UNAL;
       66     4081
       67     4082                                                /* SYMREFs                            */
       68     4083    1   DCL K_NODE# UBIN SYMREF;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:17   
       69     4084
       70     4085        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:18   
       71     4086        /*F* NAME: KIS$SEND - Send Host Outbound Messages
       72     4087
       73     4088        KIS$SEND is the interface for host application layer to
       74     4089        the network or transport layer.  It is used for fep to host
       75     4090        communications.
       76     4091
       77     4092        KIS$SEND is called with the following parameters:
       78     4093
       79     4094        .fif
       80     4095        }   K$RWPARM.PARMAER.FUNCTION
       81     4096        }                - The function to be performed.  This will be one of the
       82     4097        }                  folowing EQUed values from the file K_SUBS_C:
       83     4098        }
       84     4099        }                      K_WRITE
       85     4100        }                      K_READDONE
       86     4101        }                      K_CONNECT_ACK
       87     4102        }                      K_DISCONNECT
       88     4103        }
       89     4104        }    K$RWPARM.LDCT$
       90     4105        }                - The LDCT assigned to the host end point.
       91     4106        }
       92     4107        .fin
       93     4108
       94     4109        The action taken by KIS$SEND is dependent on the FUNCTION code.
       95     4110        */
       96     4111
       97     4112    1      FUNCTION = K$RWPARM.FUNCTION;

   4112  0 000002   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000003   000020 235100                    LDA     16,,PR0
         0 000004   200004 755100                    STA     FUNCTION,,AUTO

       98     4113
       99     4114    1      IF NK$LDCT.DFLG.FEDN

   4114  0 000005   000016 471500                    LDP1    14,,PR0
         0 000006   100006 236100                    LDQ     6,,PR1
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:19   
         0 000007   000020 316007                    CANQ    16,DL
         0 000010   000017 600000 0                  TZE     s:4122

      100     4115    1      THEN IF FUNCTION = %K_REPDISC

   4115  0 000011   000007 115007                    CMPA    7,DL
         0 000012   000014 601000 0                  TNZ     s:4118

      101     4116    1           THEN RETURN;

   4116  0 000013   000000 702200 xent               TSX2  ! X66_ARET

      102     4117    2           ELSE DO;

      103     4118    2                K$RWPARM.ERR = %K$FEP_DOWN;

   4118  0 000014   000005 235007                    LDA     5,DL
         0 000015   000013 755100                    STA     11,,PR0

      104     4119    2                ALTRETURN;

   4119  0 000016   000000 702200 xent               TSX2  ! X66_AALT

      105     4120    2                END;
      106     4121
      107     4122    1      K$RWPARM.FEX = NK$LDCT.RLCID.NODE;

   4122  0 000017   100015 236100                    LDQ     13,,PR1
         0 000020   000033 772000                    QRL     27
         0 000021   000021 756100                    STQ     17,,PR0

      108     4123
      109     4124    1      IF NK$LDCT.LKFLG.QDPPATH

   4124  0 000022   100011 236100                    LDQ     9,,PR1
         0 000023   002000 316003                    CANQ    1024,DU
         0 000024   000030 600000 0                  TZE     s:4127
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:20   

      110     4125    1      THEN SEND_ENTRY$ = ENTADDR(KIN$SEND);

   4125  0 000025   000000 636000 xent               EAQ     KIN$SEND
         0 000026   200005 756100                    STQ     SEND_ENTRY$,,AUTO
         0 000027   000034 710000 0                  TRA     s:4131

      111     4126    2      ELSE DO;

      112     4127    2           SEND_ENTRY$ = ENTADDR(KIT$SEND);

   4127  0 000030   000000 636000 xent               EAQ     KIT$SEND
         0 000031   200005 756100                    STQ     SEND_ENTRY$,,AUTO

      113     4128    2           K$RWPARM.TCTX# = NK$LDCT.TCTX#;

   4128  0 000032   100007 720100                    LXL0    7,,PR1
         0 000033   000033 740100                    STX0    27,,PR0

      114     4129    2           END;

      115     4130
      116     4131    1      IF FUNCTION = %K_WRITE

   4131  0 000034   000001 115007                    CMPA    1,DL
         0 000035   000265 600000 0                  TZE     SEND_DATA

      117     4132    1      THEN GOTO SEND_DATA;
      118     4133
      119     4134        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:21   
      120     4135        /*F* NAME: KIS$SEND - Read Done
      121     4136
      122     4137        KIS$SEND is called with FUNCTION set to K_READDONE from
      123     4138        KIA$UCIO, KIA$UCIOND and KCD$CGDEV.
      124     4139
      125     4140        All the setup for calling network has been done
      126     4141        and KIS$SEND simply calls KIN$SEND passing the
      127     4142        K$RWPARM parameter.
      128     4143        */
      129     4144
      130     4145    2      DO CASE (FUNCTION);

   4145  0 000036   000013 115007                    CMPA    11,DL
         0 000037   000041 602005 0                  TNC     s:4145+3,AL
         0 000040   000330 710000 0                  TRA     s:4267
         0 000041   000330 710000 0                  TRA     s:4267
         0 000042   000265 710000 0                  TRA     SEND_DATA
         0 000043   000330 710000 0                  TRA     s:4267
         0 000044   000330 710000 0                  TRA     s:4267
         0 000045   000167 710000 0                  TRA     s:4205
         0 000046   000330 710000 0                  TRA     s:4267
         0 000047   000330 710000 0                  TRA     s:4267
         0 000050   000330 710000 0                  TRA     s:4267
         0 000051   000330 710000 0                  TRA     s:4267
         0 000052   000054 710000 0                  TRA     s:4148
         0 000053   000061 710000 0                  TRA     s:4164

      131     4146
      132     4147    2       CASE (%K_READDONE);

      133     4148    2         CALL KIN$SEND(K$RWPARM) ALTRET(ERROR);

   4148  0 000054   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         0 000055   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000056   000000 701000 xent               TSX1    KIN$SEND
         0 000057   000333 702000 0                  TSX2    ERROR

PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:22   
      134     4149    2         RETURN;

   4149  0 000060   000000 702200 xent               TSX2  ! X66_ARET

      135     4150        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:23   
      136     4151        /*F* NAME: KIS$SEND - Connect Acknowledgement
      137     4152
      138     4153        KIS$SEND is called with FUNCTION set to K_CONNECT_ACK
      139     4154        from KIA$FPCNCT (FPRG connection complete).
      140     4155
      141     4156        An initiate acknowledgement message is built in auto with
      142     4157        information from the LDCT and K$RWPARM.SHDR$ is modified
      143     4158        to point to this message.
      144     4159
      145     4160        The code in K$RWPARM.FUNCTION is set to K_WRITE, and KIT$SEND
      146     4161        or KIN$SEND is called with the single parameter, K$RWPARM.
      147     4162        */
      148     4163    2       CASE (%K_CONNECT_ACK);

      149     4164    2         K$RWPARM.SHDR$ = ADDR(INIT_ACK_HDR);

   4164  0 000061   200030 633500                    EPPR3   INIT_ACK_HDR,,AUTO
         0 000062   000022 453500                    STP3    18,,PR0

      150     4165    2         K$RWPARM.SHDRSZ = SIZEC(INIT_ACK_HDR);

   4165  0 000063   000020 235007                    LDA     16,DL
         0 000064   000023 755100                    STA     19,,PR0

      151     4166
      152     4167    2         INIT_ACK_HDR.CNTRL = '01'B;

   4167  0 000065   200030 236100                    LDQ     INIT_ACK_HDR,,AUTO
         0 000066   000000 376000 1                  ANQ     0
         0 000067   200000 276007                    ORQ     65536,DL
         0 000070   200030 756100                    STQ     INIT_ACK_HDR,,AUTO

      153     4168    2         INIT_ACK_HDR.TYPE = %K_SQDP_INIT_ACK;

   4168  0 000071   200030 236100                    LDQ     INIT_ACK_HDR,,AUTO
         0 000072   000001 376000 1                  ANQ     1
         0 000073   000002 276007                    ORQ     2,DL
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:24   
         0 000074   200030 756100                    STQ     INIT_ACK_HDR,,AUTO

      154     4169
      155     4170    2         TEMP = K$RWPARM.UHDRSZ + K$RWPARM.MSGSZ;

   4170  0 000075   000015 236100                    LDQ     13,,PR0
         0 000076   000001 036100                    ADLQ    1,,PR0
         0 000077   200034 756100                    STQ     TEMP,,AUTO

      156     4171    2         INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.LOBYTE = TEMP;

   4171  0 000100   200033 676100                    ERQ     INIT_ACK_HDR+3,,AUTO
         0 000101   000377 376007                    ANQ     255,DL
         0 000102   200033 656100                    ERSQ    INIT_ACK_HDR+3,,AUTO

      157     4172    2         INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.HIBYTE = TEMPR.TOP;

   4172  0 000103   200034 236100                    LDQ     TEMP,,AUTO
         0 000104   000001 736000                    QLS     1
         0 000105   200033 676100                    ERQ     INIT_ACK_HDR+3,,AUTO
         0 000106   377000 376007                    ANQ     130560,DL
         0 000107   200033 656100                    ERSQ    INIT_ACK_HDR+3,,AUTO

      158     4173
      159     4174    2         TEMP = K$RWPARM.ERR;

   4174  0 000110   000013 235100                    LDA     11,,PR0
         0 000111   200034 755100                    STA     TEMP,,AUTO

      160     4175    2         INIT_ACK_HDR.REASON_UNPK.LOBYTE = TEMP;

   4175  0 000112   200034 236100                    LDQ     TEMP,,AUTO
         0 000113   000022 736000                    QLS     18
         0 000114   200032 676100                    ERQ     INIT_ACK_HDR+2,,AUTO
         0 000115   000377 376003                    ANQ     255,DU
         0 000116   200032 656100                    ERSQ    INIT_ACK_HDR+2,,AUTO

PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:25   
      161     4176    2         INIT_ACK_HDR.REASON_UNPK.HIBYTE = TEMPR.TOP;

   4176  0 000117   200034 236100                    LDQ     TEMP,,AUTO
         0 000120   000023 736000                    QLS     19
         0 000121   200032 676100                    ERQ     INIT_ACK_HDR+2,,AUTO
         0 000122   377000 376003                    ANQ     130560,DU
         0 000123   200032 656100                    ERSQ    INIT_ACK_HDR+2,,AUTO

      162     4177
      163     4178    2         TEMP = NK$LDCT.LDCTX;

   4178  0 000124   000016 471500                    LDP1    14,,PR0
         0 000125   100006 236100                    LDQ     6,,PR1
         0 000126   000022 772000                    QRL     18
         0 000127   200034 756100                    STQ     TEMP,,AUTO

      164     4179    2         INIT_ACK_HDR.RLCID.LDCTX_UNPK.LOBYTE = TEMP;

   4179  0 000130   200031 676100                    ERQ     INIT_ACK_HDR+1,,AUTO
         0 000131   000377 376007                    ANQ     255,DL
         0 000132   200031 656100                    ERSQ    INIT_ACK_HDR+1,,AUTO

      165     4180    2         INIT_ACK_HDR.RLCID.LDCTX_UNPK.HIBYTE = TEMPR.TOP;

   4180  0 000133   200034 236100                    LDQ     TEMP,,AUTO
         0 000134   000001 736000                    QLS     1
         0 000135   200031 676100                    ERQ     INIT_ACK_HDR+1,,AUTO
         0 000136   377000 376007                    ANQ     130560,DL
         0 000137   200031 656100                    ERSQ    INIT_ACK_HDR+1,,AUTO

      166     4181
      167     4182    2         INIT_ACK_HDR.RLCID.NODE = K_NODE#;

   4182  0 000140   000000 236000 xsym               LDQ     K_NODE#
         0 000141   000033 736000                    QLS     27
         0 000142   200031 552140                    STBQ    INIT_ACK_HDR+1,'40'O,AUTO

PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:26   
      168     4183    2         INIT_ACK_HDR.RLCID.GENERATION = NK$LDCT.GENERATION;

   4183  0 000143   000016 471500                    LDP1    14,,PR0
         0 000144   100014 236100                    LDQ     12,,PR1
         0 000145   000377 376003                    ANQ     255,DU
         0 000146   200031 552120                    STBQ    INIT_ACK_HDR+1,'20'O,AUTO

      169     4184
      170     4185    2         INIT_ACK_HDR.RESCODE = NK$LDCT.RESCOD;

   4185  0 000147   000016 471500                    LDP1    14,,PR0
         0 000150   100006 236100                    LDQ     6,,PR1
         0 000151   200032 676100                    ERQ     INIT_ACK_HDR+2,,AUTO
         0 000152   000017 376007                    ANQ     15,DL
         0 000153   200032 656100                    ERSQ    INIT_ACK_HDR+2,,AUTO

      171     4186
      172     4187    2         INIT_ACK_HDR.LDCT = NK$LDCT.RLCID.LDCTX; /*maintained unpacked*/

   4187  0 000154   000016 471500                    LDP1    14,,PR0
         0 000155   100015 720100                    LXL0    13,,PR1
         0 000156   200030 740100                    STX0    INIT_ACK_HDR,,AUTO

      173     4188
      174     4189    2         K$RWPARM.FUNCTION = %K_WRITE;

   4189  0 000157   000001 235007                    LDA     1,DL
         0 000160   000020 755100                    STA     16,,PR0

      175     4190    2         CALL SEND_ENTRY$(K$RWPARM) ALTRET(ERROR);

   4190  0 000161   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         0 000162   200005 220100                    LDX0    SEND_ENTRY$,,AUTO
         0 000163   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000164   000000 701010                    TSX1    0,X0
         0 000165   000333 702000 0                  TSX2    ERROR

PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:27   
      176     4191    2         RETURN;

   4191  0 000166   000000 702200 xent               TSX2  ! X66_ARET

      177     4192        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:28   
      178     4193        /*F* NAME: KIS$SEND - Disconnect
      179     4194
      180     4195        KIS$SEND is called with FUNCTION set to K_DISCONNECT
      181     4196        when FSP$CLSDEV calls KIA$DSCU
      182     4197        or KIA$ISCAN calls KIA$DSC.
      183     4198
      184     4199        A session terminate header is built in auto and the message
      185     4200        is passed to SEND_ENTRY$ with K$RWPARM.FUNCTION
      186     4201        set to K_WRITE.
      187     4202        */
      188     4203
      189     4204    2       CASE (%K_DISCONNECT);

      190     4205    2         K$RWPARM.SHDR$ = ADDR(TERM_HDR);

   4205  0 000167   200010 633500                    EPPR3   TERM_HDR,,AUTO
         0 000170   000022 453500                    STP3    18,,PR0

      191     4206    2         K$RWPARM.SHDRSZ = SIZEC(TERM_HDR);

   4206  0 000171   000016 235007                    LDA     14,DL
         0 000172   000023 755100                    STA     19,,PR0

      192     4207
      193     4208    2         TERM_HDR.CNTRL = '01'B;

   4208  0 000173   200010 236100                    LDQ     TERM_HDR,,AUTO
         0 000174   000000 376000 1                  ANQ     0
         0 000175   200000 276007                    ORQ     65536,DL
         0 000176   200010 756100                    STQ     TERM_HDR,,AUTO

      194     4209    2         TERM_HDR.TYPE = %K_SQDP_TERM;

   4209  0 000177   200010 236100                    LDQ     TERM_HDR,,AUTO
         0 000200   000001 376000 1                  ANQ     1
         0 000201   000003 276007                    ORQ     3,DL
         0 000202   200010 756100                    STQ     TERM_HDR,,AUTO
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:29   

      195     4210
      196     4211    2         TERM_HDR.LDCT = NK$LDCT.RLCID.LDCTX;

   4211  0 000203   100015 720100                    LXL0    13,,PR1
         0 000204   200010 740100                    STX0    TERM_HDR,,AUTO

      197     4212    2         TERM_HDR.RLCID = '0'B;

   4212  0 000205   200011 450100                    STZ     TERM_HDR+1,,AUTO

      198     4213
      199     4214    2         TEMP = K$RWPARM.ERR;

   4214  0 000206   000013 235100                    LDA     11,,PR0
         0 000207   200034 755100                    STA     TEMP,,AUTO

      200     4215    2         TERM_HDR.REASON_UNPK.LOBYTE = TEMP;

   4215  0 000210   200034 236100                    LDQ     TEMP,,AUTO
         0 000211   000022 736000                    QLS     18
         0 000212   200012 676100                    ERQ     TERM_HDR+2,,AUTO
         0 000213   000377 376003                    ANQ     255,DU
         0 000214   200012 656100                    ERSQ    TERM_HDR+2,,AUTO

      201     4216    2         TERM_HDR.REASON_UNPK.HIBYTE = TEMPR.TOP;

   4216  0 000215   200034 236100                    LDQ     TEMP,,AUTO
         0 000216   000023 736000                    QLS     19
         0 000217   200012 676100                    ERQ     TERM_HDR+2,,AUTO
         0 000220   377000 376003                    ANQ     130560,DU
         0 000221   200012 656100                    ERSQ    TERM_HDR+2,,AUTO

      202     4217
      203     4218    2         TEMP = K$RWPARM.UHDRSZ + K$RWPARM.MSGSZ;

   4218  0 000222   000015 236100                    LDQ     13,,PR0
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:30   
         0 000223   000001 036100                    ADLQ    1,,PR0
         0 000224   200034 756100                    STQ     TEMP,,AUTO

      204     4219    2         TERM_HDR.DATA_HDR.LENGTH_UNPK.LOBYTE = TEMP;

   4219  0 000225   000022 736000                    QLS     18
         0 000226   200013 676100                    ERQ     TERM_HDR+3,,AUTO
         0 000227   000377 376003                    ANQ     255,DU
         0 000230   200013 656100                    ERSQ    TERM_HDR+3,,AUTO

      205     4220    2         TERM_HDR.DATA_HDR.LENGTH_UNPK.HIBYTE = TEMPR.TOP;

   4220  0 000231   200034 236100                    LDQ     TEMP,,AUTO
         0 000232   000023 736000                    QLS     19
         0 000233   200013 676100                    ERQ     TERM_HDR+3,,AUTO
         0 000234   377000 376003                    ANQ     130560,DU
         0 000235   200013 656100                    ERSQ    TERM_HDR+3,,AUTO

      206     4221
      207     4222    2         TEMP = K$RWPARM.RECTYPE;

   4222  0 000236   000030 235100                    LDA     24,,PR0
         0 000237   200034 755100                    STA     TEMP,,AUTO

      208     4223    2         TERM_HDR.DATA_HDR.TYPE_UNPK.LOBYTE = TEMP;

   4223  0 000240   200034 236100                    LDQ     TEMP,,AUTO
         0 000241   200012 676100                    ERQ     TERM_HDR+2,,AUTO
         0 000242   000377 376007                    ANQ     255,DL
         0 000243   200012 656100                    ERSQ    TERM_HDR+2,,AUTO

      209     4224    2         TERM_HDR.DATA_HDR.TYPE_UNPK.HIBYTE = TEMPR.TOP;

   4224  0 000244   200034 236100                    LDQ     TEMP,,AUTO
         0 000245   000001 736000                    QLS     1
         0 000246   200012 676100                    ERQ     TERM_HDR+2,,AUTO
         0 000247   377000 376007                    ANQ     130560,DL
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:31   
         0 000250   200012 656100                    ERSQ    TERM_HDR+2,,AUTO

      210     4225
      211     4226    2         K$RWPARM.FUNCTION = %K_WRITE;

   4226  0 000251   000001 236007                    LDQ     1,DL
         0 000252   000020 756100                    STQ     16,,PR0

      212     4227    2         CALL SEND_ENTRY$(K$RWPARM) ALTRET(ERROR);

   4227  0 000253   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         0 000254   200005 221100                    LDX1    SEND_ENTRY$,,AUTO
         0 000255   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000256   000000 701011                    TSX1    0,X1
         0 000257   000333 702000 0                  TSX2    ERROR

      213     4228
      214     4229    2         NK$LDCT.DFLG.FEDN = '1'B;

   4229  0 000260   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000261   000016 471500                    LDP1    14,,PR0
         0 000262   000020 236007                    LDQ     16,DL
         0 000263   100006 256100                    ORSQ    6,,PR1

      215     4230    2         RETURN;

   4230  0 000264   000000 702200 xent               TSX2  ! X66_ARET

      216     4231
      217     4232
      218     4233        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:32   
      219     4234        /*F* NAME: KIS$SEND - Write
      220     4235
      221     4236        KIS$SEND is called with FUNCTION set to K_WRITE
      222     4237        from KIA$FCNO and KIA$FCNOU.
      223     4238
      224     4239        A data message header is built in auto with
      225     4240        information from the LDCT and K$RWPARM.SHDR$ is modified
      226     4241        to point to this message.
      227     4242
      228     4243        SEND_ENTRY$ is called with the single parameter,
      229     4244        K$RWPARM.
      230     4245        */
      231     4246    2       CASE (%K_WRITE);

      232     4247
      233     4248    2   SEND_DATA:
      234     4249    2         K$RWPARM.SHDR$ = ADDR(DATA_HDR);

   4249  0 000265   200006 633500       SEND_DATA    EPPR3   DATA_HDR,,AUTO
         0 000266   000022 453500                    STP3    18,,PR0

      235     4250    2         K$RWPARM.SHDRSZ = SIZEC(DATA_HDR);

   4250  0 000267   000006 235007                    LDA     6,DL
         0 000270   000023 755100                    STA     19,,PR0

      236     4251
      237     4252    2         DATA_HDR = '0'B;

   4252  0 000271   200006 450100                    STZ     DATA_HDR,,AUTO
         0 000272   200007 450100                    STZ     DATA_HDR+1,,AUTO

      238     4253
      239     4254    2         TEMP = K$RWPARM.UHDRSZ + K$RWPARM.MSGSZ;

   4254  0 000273   000015 236100                    LDQ     13,,PR0
         0 000274   000001 036100                    ADLQ    1,,PR0
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:33   
         0 000275   200034 756100                    STQ     TEMP,,AUTO

      240     4255    2         DATA_HDR.LENGTH_UNPK.LOBYTE = TEMP;

   4255  0 000276   000022 736000                    QLS     18
         0 000277   200007 676100                    ERQ     DATA_HDR+1,,AUTO
         0 000300   000377 376003                    ANQ     255,DU
         0 000301   200007 656100                    ERSQ    DATA_HDR+1,,AUTO

      241     4256    2         DATA_HDR.LENGTH_UNPK.HIBYTE = TEMPR.TOP;

   4256  0 000302   200034 236100                    LDQ     TEMP,,AUTO
         0 000303   000023 736000                    QLS     19
         0 000304   200007 676100                    ERQ     DATA_HDR+1,,AUTO
         0 000305   377000 376003                    ANQ     130560,DU
         0 000306   200007 656100                    ERSQ    DATA_HDR+1,,AUTO

      242     4257
      243     4258    2         DATA_HDR.TYPE_UNPK.HIBYTE = ADDR(K$RWPARM.RECTYPE)->RECTYP.TOP;

   4258  0 000307   000030 236100                    LDQ     24,,PR0
         0 000310   000001 736000                    QLS     1
         0 000311   200006 676100                    ERQ     DATA_HDR,,AUTO
         0 000312   077000 376007                    ANQ     32256,DL
         0 000313   200006 656100                    ERSQ    DATA_HDR,,AUTO

      244     4259    2         DATA_HDR.TYPE_UNPK.LOBYTE = K$RWPARM.RECTYPE;

   4259  0 000314   000030 236100                    LDQ     24,,PR0
         0 000315   200006 676100                    ERQ     DATA_HDR,,AUTO
         0 000316   000377 376007                    ANQ     255,DL
         0 000317   200006 656100                    ERSQ    DATA_HDR,,AUTO

      245     4260
      246     4261    2         DATA_HDR.LDCT = NK$LDCT.RLCID.LDCTX;

   4261  0 000320   100015 720100                    LXL0    13,,PR1
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:34   
         0 000321   200006 740100                    STX0    DATA_HDR,,AUTO

      247     4262
      248     4263    2         CALL SEND_ENTRY$(K$RWPARM) ALTRET(ERROR);

   4263  0 000322   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         0 000323   200005 221100                    LDX1    SEND_ENTRY$,,AUTO
         0 000324   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000325   000000 701011                    TSX1    0,X1
         0 000326   000333 702000 0                  TSX2    ERROR

      249     4264    2         RETURN;

   4264  0 000327   000000 702200 xent               TSX2  ! X66_ARET

      250     4265        %EJECT;
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:35   
      251     4266    2       CASE (ELSE);

      252     4267    2         CALL SC_BADFNC;

   4267  0 000330   000000 713400 xsym               CLIMB   SC_BADFNC
         0 000331   000000 600000 xsid               climb   nvectors=         0

      253     4268    2         END;

      254     4269
      255     4270    1      RETURN;

   4270  0 000332   000000 702200 xent               TSX2  ! X66_ARET

   4263  0 000333                       ERROR        null
      256     4271
      257     4272        /*S* SCREECH_CODE: KIS-S$BADFNC
      258     4273             TYPE: SCREECH
      259     4274             MESSAGE: Bad function code passed to session.
      260     4275        */
      261     4276
      262     4277        /* Altrets from KIN$SEND come here.
      263     4278        */
      264     4279    1   ERROR:;
      265     4280    1      IF K$RWPARM.ERR ~= %K$QFULL

   4280  0 000333   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000334   000013 235100                    LDA     11,,PR0
         0 000335   000001 115007                    CMPA    1,DL
         0 000336   000346 600000 0                  TZE     s:4284
         0 000337   000002 115007                    CMPA    2,DL
         0 000340   000346 600000 0                  TZE     s:4284
         0 000341   000007 115007                    CMPA    7,DL
         0 000342   000346 600000 0                  TZE     s:4284

      266     4281    1        AND K$RWPARM.ERR ~= %K$BAD_BUFFER  /* #32327                             */
      267     4282    1        AND K$RWPARM.ERR ~= %K$Q2SMALL     /* #30431                             */
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:36   
      268     4283    1      THEN NK$LDCT.DFLG.FEDN = '1'B;

   4283  0 000343   000016 471500                    LDP1    14,,PR0
         0 000344   000020 236007                    LDQ     16,DL
         0 000345   100006 256100                    ORSQ    6,,PR1

      269     4284    1      ALTRETURN;

   4284  0 000346   000000 702200 xent               TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
   1     000   777777 177777   777777 700000                                    ........
      270     4285
      271     4286    1   END KIS$SEND;
      272     4287        %EOD;

PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:37   
--  Include file information  --

   K$RWPARM.:E05TOU  is referenced.
   K_RLCID_M.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIS$SEND.
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:38   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @K$RWPARM                  6-0-0/c STRC(54)    r     1 DATA_HDR
     4-0-0/w UBIN        r     1 FUNCTION                  30-0-0/c STRC(144)   r     1 INIT_ACK_HDR
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                   5-0-0/w EPTR        r     1 SEND_ENTRY$
    34-0-0/w UBIN        r     1 TEMP                      34-0-0/w STRC        r     1 TEMPR
    10-0-0/c STRC(126)   r     1 TERM_HDR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 K_NODE#

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(864)   r     1 NK$LDCT                    0-0-0/w STRC        r     1 RECTYP


   Procedure KIS$SEND requires 231 words for executable code.
   Procedure KIS$SEND requires 30 words of local(AUTO) storage.
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:39   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:40   
          MINI XREF LISTING

DATA_HDR
      3055**DCL      4249--ASSIGN   4250--ASSIGN   4252<<ASSIGN
DATA_HDR.LDCT
      3062**DCL      3063--REDEF    3068--REDEF    4261<<ASSIGN
DATA_HDR.LENGTH
      3119**DCL      3120--REDEF    3125--REDEF
DATA_HDR.LENGTH_UNPK.HIBYTE
      3122**DCL      4256<<ASSIGN
DATA_HDR.LENGTH_UNPK.LOBYTE
      3124**DCL      4255<<ASSIGN
DATA_HDR.TYPE
      3089**DCL      3090--REDEF    3094--REDEF
DATA_HDR.TYPE_UNPK.HIBYTE
      3091**DCL      4258<<ASSIGN
DATA_HDR.TYPE_UNPK.LOBYTE
      3093**DCL      4259<<ASSIGN
ERROR
      4263**LABEL    4148--CALLALT  4190--CALLALT  4227--CALLALT  4263--CALLALT
FUNCTION
      3008**DCL      4112<<ASSIGN   4115>>IF       4131>>IF       4145>>DOCASE
HDR.DATA_HDR.LENGTH
      3749**DCL      3750--REDEF    3755--REDEF
HDR.DATA_HDR.TYPE
      3733**DCL      3734--REDEF    3739--REDEF
HDR.LDCT
      3469**DCL      3470--REDEF    3475--REDEF
HDR.RLCID.LDCTX
      3572**DCL      3573--REDEF    3578--REDEF
HDR.SYSID
      3617**DCL      3618--REDEF    3623--REDEF
HDR.TERMINAL_ID.TERM
      3686**DCL      3695--REDEF
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:41   
HDR.TYPE
      3496**DCL      3497--REDEF    3501--REDEF
INIT_ACK_HDR
      3827**DCL      4164--ASSIGN   4165--ASSIGN
INIT_ACK_HDR.CNTRL
      3848**DCL      4167<<ASSIGN
INIT_ACK_HDR.DATA_HDR.LENGTH
      4048**DCL      4049--REDEF    4054--REDEF
INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.HIBYTE
      4051**DCL      4172<<ASSIGN
INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.LOBYTE
      4053**DCL      4171<<ASSIGN
INIT_ACK_HDR.DATA_HDR.TYPE
      4032**DCL      4033--REDEF    4038--REDEF
INIT_ACK_HDR.LDCT
      3834**DCL      3835--REDEF    3840--REDEF    4187<<ASSIGN
INIT_ACK_HDR.REASON
      3971**DCL      3972--REDEF    3977--REDEF
INIT_ACK_HDR.REASON_UNPK.HIBYTE
      3974**DCL      4176<<ASSIGN
INIT_ACK_HDR.REASON_UNPK.LOBYTE
      3976**DCL      4175<<ASSIGN
INIT_ACK_HDR.RESCODE
      3994**DCL      4185<<ASSIGN
INIT_ACK_HDR.RLCID.GENERATION
      3920**DCL      4183<<ASSIGN
INIT_ACK_HDR.RLCID.LDCTX
      3937**DCL      3938--REDEF    3943--REDEF
INIT_ACK_HDR.RLCID.LDCTX_UNPK.HIBYTE
      3940**DCL      4180<<ASSIGN
INIT_ACK_HDR.RLCID.LDCTX_UNPK.LOBYTE
      3942**DCL      4179<<ASSIGN
INIT_ACK_HDR.RLCID.NODE
      3915**DCL      4182<<ASSIGN
INIT_ACK_HDR.TYPE
      3861**DCL      3862--REDEF    3866--REDEF    4168<<ASSIGN
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:42   
K$RWPARM
      2654**DCL        24--PROC     4148<>CALL     4190<>CALL     4227<>CALL     4263<>CALL
K$RWPARM.BLKREC
      2680**DCL      2705--REDEF
K$RWPARM.BLKREC.BLKU#
      2681**DCL      2683--REDEF
K$RWPARM.BLKREC.RECU#
      2693**DCL      2695--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      2720**DCL      2721--REDEF
K$RWPARM.DVE.EOMCHAR
      2728**DCL      2732--REDEF
K$RWPARM.ERR
      2792**DCL      2797--REDEF    4118<<ASSIGN   4174>>ASSIGN   4214>>ASSIGN   4280>>IF       4280>>IF
      4280>>IF
K$RWPARM.FC
      2756**DCL      2757--REDEF
K$RWPARM.FEX
      2838**DCL      4122<<ASSIGN
K$RWPARM.FLDID
      2938**DCL      2939--REDEF
K$RWPARM.FPT$
      2819**DCL      2826--REDEF
K$RWPARM.FUNCTION
      2833**DCL      4112>>ASSIGN   4189<<ASSIGN   4226<<ASSIGN
K$RWPARM.KEYTYPE
      2945**DCL      2946--REDEF
K$RWPARM.LDCT$
      2815**DCL      2969--IMP-PTR  4114>>IF       4122>>ASSIGN   4124>>IF       4128>>ASSIGN   4178>>ASSIGN
      4183>>ASSIGN   4185>>ASSIGN   4187>>ASSIGN   4211>>ASSIGN   4229>>ASSIGN   4261>>ASSIGN   4283>>ASSIGN
K$RWPARM.MSG$
      2655**DCL      2661--REDEF
K$RWPARM.MSGID
      2767**DCL      2772--REDEF
K$RWPARM.MSGIDXT
      2780**DCL      2784--REDEF
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:43   
K$RWPARM.MSGSZ
      2662**DCL      4170>>ASSIGN   4218>>ASSIGN   4254>>ASSIGN
K$RWPARM.ORG
      2916**DCL      2917--REDEF
K$RWPARM.RECTYPE
      2878**DCL      4222>>ASSIGN   4258--ASSIGN   4259>>ASSIGN
K$RWPARM.SHDR$
      2848**DCL      4164<<ASSIGN   4205<<ASSIGN   4249<<ASSIGN
K$RWPARM.SHDRSZ
      2852**DCL      4165<<ASSIGN   4206<<ASSIGN   4250<<ASSIGN
K$RWPARM.TCTX#
      2890**DCL      4128<<ASSIGN
K$RWPARM.THDRSZ
      2860**DCL      2864--REDEF
K$RWPARM.UHDRSZ
      2810**DCL      4170>>ASSIGN   4218>>ASSIGN   4254>>ASSIGN
K$RWPARM.VDOFLGS
      2918**DCL      2929--REDEF
KIN$SEND
      2951**DCL-ENT  4125--ASSIGN   4148--CALL
KIT$SEND
      2952**DCL-ENT  4127--ASSIGN
K_NODE#
      4083**DCL      4182>>ASSIGN
NK$LDCT.DDT$
      2971**DCL      2971--REDEF
NK$LDCT.DFLG.FEDN
      2977**DCL      4114>>IF       4229<<ASSIGN   4283<<ASSIGN
NK$LDCT.GENERATION
      2992**DCL      4183>>ASSIGN
NK$LDCT.IOQ$
      2970**DCL      2971--REDEF
NK$LDCT.LDCTX
      2972**DCL      2972--REDEF    4178>>ASSIGN
NK$LDCT.LKFLG.ABORTED
      2984**DCL      2985--REDEF
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:44   
NK$LDCT.LKFLG.QDPPATH
      2986**DCL      4124>>IF
NK$LDCT.RESCOD
      2977**DCL      4185>>ASSIGN
NK$LDCT.RLCID.LDCTX
      2994**DCL      2994--REDEF    4187>>ASSIGN   4211>>ASSIGN   4261>>ASSIGN
NK$LDCT.RLCID.NODE
      2993**DCL      4122>>ASSIGN
NK$LDCT.STA$
      2990**DCL      2991--REDEF
NK$LDCT.SYMB$
      2969**DCL      2969--REDEF    2969--REDEF    2970--REDEF
NK$LDCT.TCTX#
      2979**DCL      4128>>ASSIGN
RECTYP.TOP
      3004**DCL      4258>>ASSIGN
SC_BADFNC
      2953**DCL-ENT  4267--CALL
SEND_DATA
      4249**LABEL    4132--GOTO
SEND_ENTRY$
      3009**DCL      4125<<ASSIGN   4127<<ASSIGN   4190>>CALL     4227>>CALL     4263>>CALL
TEMP
      4077**DCL      4078--REDEF    4170<<ASSIGN   4171>>ASSIGN   4174<<ASSIGN   4175>>ASSIGN   4178<<ASSIGN
      4179>>ASSIGN   4214<<ASSIGN   4215>>ASSIGN   4218<<ASSIGN   4219>>ASSIGN   4222<<ASSIGN   4223>>ASSIGN
      4254<<ASSIGN   4255>>ASSIGN
TEMPR.TOP
      4079**DCL      4172>>ASSIGN   4176>>ASSIGN   4180>>ASSIGN   4216>>ASSIGN   4220>>ASSIGN   4224>>ASSIGN
      4256>>ASSIGN
TERM_HDR
      3183**DCL      4205--ASSIGN   4206--ASSIGN
TERM_HDR.CNTRL
      3204**DCL      4208<<ASSIGN
TERM_HDR.DATA_HDR.LENGTH
      3392**DCL      3393--REDEF    3398--REDEF
TERM_HDR.DATA_HDR.LENGTH_UNPK.HIBYTE
PL6.E3A0      #001=KIS$SEND File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:41 Page:45   
      3395**DCL      4220<<ASSIGN
TERM_HDR.DATA_HDR.LENGTH_UNPK.LOBYTE
      3397**DCL      4219<<ASSIGN
TERM_HDR.DATA_HDR.TYPE
      3376**DCL      3377--REDEF    3382--REDEF
TERM_HDR.DATA_HDR.TYPE_UNPK.HIBYTE
      3379**DCL      4224<<ASSIGN
TERM_HDR.DATA_HDR.TYPE_UNPK.LOBYTE
      3381**DCL      4223<<ASSIGN
TERM_HDR.LDCT
      3190**DCL      3191--REDEF    3196--REDEF    4211<<ASSIGN
TERM_HDR.REASON
      3331**DCL      3332--REDEF    3337--REDEF
TERM_HDR.REASON_UNPK.HIBYTE
      3334**DCL      4216<<ASSIGN
TERM_HDR.REASON_UNPK.LOBYTE
      3336**DCL      4215<<ASSIGN
TERM_HDR.RLCID
      3269**DCL      4212<<ASSIGN
TERM_HDR.RLCID.LDCTX
      3293**DCL      3294--REDEF    3299--REDEF
TERM_HDR.TYPE
      3217**DCL      3218--REDEF    3222--REDEF    4209<<ASSIGN

PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:46   
      273        1        /*T***********************************************************/
      274        2        /*T*                                                         */
      275        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      276        4        /*T*                                                         */
      277        5        /*T***********************************************************/
      278        6        KIS$RECV: PROC(K$RWPARM) ALTRET;
      279        7
      280        8
      281        9                                                /* Include files                      */
      282       10        %INCLUDE B$USER;
      283      226        %INCLUDE K_SUBS_C;
      284      259        %INCLUDE NK$LDCT;
      285      361        %INCLUDE NK_LDCT_R;
      286      370        %INCLUDE NK_SUBS;
      287      395        %INCLUDE KI_CP6;
      288     1491        %INCLUDE K_QDPHDRS_M;
      289     2373        %INCLUDE K_INTERFACE_M;
      290     2782        %INCLUDE K_RLCID_M;
      291     2886        %INCLUDE KL_SUPER_C;                    /*get equ for KLTY_FEP#               */
      292     5788        %INCLUDE KL_AFCN_C;
      293     5889        %INCLUDE FR$RAT;
      294     5942        %INCLUDE K$RWPARM;
      295     6328        %INCLUDE HF_LOCK_C;
      296     6342        %INCLUDE K_REASON_C;
      297     6368        %INCLUDE KL_MACRO_C;
      298     9720        %INCLUDE SS_SCHED_C;
      299     9953        %INCLUDE UM_CP6;
      300    10805        %INCLUDE K_ADDRESS_M;
      301    11308        %INCLUDE KI_MACROS_C;
      302    11916
      303    11917                                                /* Parameter definitions              */
      304    11918        %K$RWPARM (NAME=K$RWPARM);
      305    12234
      306    12235                                                /* Entry point references             */
      307    12236    1   DCL KCF$QNF ENTRY(1);
      308    12237    1   DCL KCO$TRMGO ENTRY(1) ALTRET;
      309    12238    1   DCL KIA$FPCNCT ENTRY(1) ALTRET;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:47   
      310    12239    1   DCL KIA$ISCAN ENTRY(2) ALTRET;
      311    12240    1   DCL KIA$TERM ENTRY(1) ALTRET;
      312    12241    1   DCL KIN$SEND ENTRY(1) ALTRET;
      313    12242    1   DCL KIT$SEND ENTRY(1) ALTRET;
      314    12243    1   DCL KIS$REP_TERM ENTRY(1);
      315    12244    1   DCL KIS$UNQUEUE ENTRY(1);
      316    12245    1   DCL KUB$WRITE ENTRY(3) ALTRET;
      317    12246    1   DCL NKL$GETDCT ENTRY(1) ALTRET;
      318    12247    1   DCL SSR$RUE ENTRY(4);
      319    12248    1   DCL SC_BADFNC ENTRY CONV(2,0);
      320    12249    1   DCL SC_BADLDCTX ENTRY CONV(2,0);
      321    12250
      322    12251                                                /* Based items                        */
      323    12252        %FR$RAT;
      324    12292        %NK$LDCT (NAME=NK$LDCT);
      325    12338
      326    12339        %K$SQDP_INIT (STCLASS="BASED(SHDR$)", HOST_TYPE=UNPACKED, ALGN=CALIGNED);
      327    12703        %K$SQDP_DATA (STCLASS="BASED(K$RWPARM.SHDR$)", HOST_TYPE=UNPACKED, ALGN=CALIGNED);
      328    12830
      329    12831    1   DCL DATAMSG CHAR(TEMP) BASED;
      330    12832    1   DCL KI$TCTX$(0:0) PTR BASED( KI_TCTX$$);
      331    12833        %KI$TCTX;
      332    13391
      333    13392                                                /* Auto                               */
      334    13393    1   DCL SHDR$ PTR;
      335    13394    1   DCL LDCTX UBIN;
      336    13395    1   DCL LDCT$ PTR;
      337    13396    1   DCL HDR_TYPE UBIN;
      338    13397
      339    13398    1   DCL TEMP UBIN;
      340    13399    1   DCL 1 TEMPR REDEF TEMP,
      341    13400    1         2 TOP UBIN(28) UNAL,
      342    13401    1         2 BOT UBIN(8) UNAL;
      343    13402
      344    13403    1   DCL HALFWORD UBIN(18) UNAL BASED;
      345    13404        %MACRO UNPACK_HW (SRC=);
      346    13405           TEMP = ADDR(SRC)->HALFWORD;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:48   
      347    13406           ADDR(SRC)->HALFWORD = (MOD(TEMP,512) + TEMP)/2;
      348    13407        %MEND;
      349    13408        %K$SQDP_DATA (NAME=DATA_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED);
      350    13535
      351    13536        %K$SQDP_INIT_ACK (NAME=INIT_ACK_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED);
      352    13829
      353    13830        %K$RLCID (NAME=RLCID, STCLASS=AUTO, HOST_TYPE=UNPACKED);
      354    13906
      355    13907        %KL_SGN (FPTN=KL_SGN,STCLASS=AUTO, LGNSIZ=20);
      356    14000
      357    14001        %KL_FEPST( FPTN=KL_FEPST, STCLASS=AUTO);
      358    14036
      359    14037                                                /* SYMREFs                            */
      360    14038    1   DCL K_NODE# UBIN SYMREF;
      361    14039    1   DCL B$USRT$ PTR SYMREF;
      362    14040    1   DCL KI_TCTX$$ PTR SYMREF;
      363    14041
      364    14042        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:49   
      365    14043        /*F* NAME: KIS$RECV - Receive Host Inbound Messages
      366    14044
      367    14045        This routine is called from KIN$RECV or KIT$RECV.  It is the interface
      368    14046        for passing incoming messages from a local fep up to the user.
      369    14047
      370    14048        KIS$RECV is called with the K$RWPARM parameter:
      371    14049
      372    14050        .fif
      373    14051        }    K$RWPARM.FUNCTION - Indicates the function to be performed.
      374    14052        }                       This will be one of the following values
      375    14053        }                       from the file K_SUBS_C:
      376    14054        }
      377    14055        }                          K_RECV
      378    14056        }                          K_TDISCONNECT_IND
      379    14057        .fin
      380    14058
      381    14059        The only function that is handled here is K_RECV.  The routines
      382    14060        KIS$REP_TERM and KIS$UNQUEUE are called for the other two functions.
      383    14061        */
      384    14062
      385    14063    1      IF K$RWPARM.FUNCTION = %K_RECV
      386    14064    1      THEN GOTO RECV_DATA;
      387    14065
      388    14066    1      IF K$RWPARM.FUNCTION = 11            /* %K_UNQUEUE                         */
      389    14067    2      THEN DO;
      390    14068    2           CALL KIS$UNQUEUE(K$RWPARM);
      391    14069    2           RETURN;
      392    14070    2           END;
      393    14071
      394    14072    1      IF K$RWPARM.FUNCTION = %K_TDISCONNECT_IND
      395    14073    2      THEN DO;
      396    14074    2           CALL KIS$REP_TERM(K$RWPARM);
      397    14075    2           RETURN;
      398    14076    2           END;
      399    14077
      400    14078    2      DO CASE (K$RWPARM.FUNCTION);
      401    14079
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:50   
      402    14080        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:51   
      403    14081        /*F* NAME: KIS$RECV - Data Received
      404    14082
      405    14083        The action to be taken when KIS$RECV has been called with
      406    14084        K_RECV function is determined by the type of message that
      407    14085        has been received.
      408    14086
      409    14087        This will be one of the following EQUated values from file
      410    14088        K_QDPHDRS_M:
      411    14089
      412    14090        .fif
      413    14091        }    K_SQDP_DATA        0   Data
      414    14092        }    K_SQDP_INIT        1   Initiate Logical Connection Request
      415    14093        }    K_SQDP_INIT_ACK    2   Initiate Logical Connection Ack
      416    14094        }    K_SQDP_TERM        3   Terminate Logical Connection
      417    14095        .fin
      418    14096        */
      419    14097
      420    14098    2       CASE (%K_RECV);
      421    14099
      422    14100    2   RECV_DATA:
      423    14101    2         SHDR$ = K$RWPARM.SHDR$;
      424    14102    2         DATA_HDR = SHDR$->K$SQDP_DATA;
      425    14103
      426    14104    2         LDCTX = DATA_HDR.LDCT_UNPK.HIBYTE * 256 + DATA_HDR.LDCT_UNPK.LOBYTE;
      427    14105
      428    14106        /* Validate the LDCTX.  If it appears to be bad, send a message asking
      429    14107           SLUG to crash the originating fep and ALTRET to leave the bad msg
      430    14108           in the ICQ for dump analysis.
      431    14109        */
      432    14110    2         IF LDCTX = 0
      433    14111    2         THEN LDCT$ = ADDR( NIL);
      434    14112
      435    14113    3         ELSE DO;
      436    14114    3              IF LDCTX <= NK_MXLOCAL OR LDCTX > NK_CUR
      437    14115    3              THEN GOTO BAD_LDCTX;
      438    14116
      439    14117    3              LDCT$ = NK$LDCT$( LDCTX);
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:52   
      440    14118    3              IF LDCT$ = ADDR( NIL)
      441    14119    4              THEN DO;
      442    14120    4   BAD_LDCTX:
      443    14121    4                   CALL SC_BADLDCTX;       /* snap the LDCTs now                 */
      444    14122    5                   IF K$RWPARM.THDR$ = ADDR( NIL) THEN DO;
      445    14123                                                /* this message is from a local FEP   */
      446    14124    5                        K$RWPARM.ERR = %K$BAD_LDCTX;
      447    14125    5                        ALTRETURN;         /* Make KIQ crash the FEP immediately */
      448    14126    5                        END;
      449    14127    4                   KL_FEPST = '0'B;
      450    14128    4                   KL_FEPST.FCN = IGA_CRASHFEP_BF;
      451    14129    4                   KL_FEPST.FEP = KI$TCTX$( K$RWPARM.TCTX#)->KI$TCTX.NODE;
      452    14130    4                   CALL KUB$WRITE( KL_FEPST, LENGTHC( KL_FEPST), 'HLPADMIN');
      453    14131    4                   RETURN;
      454    14132    4                   END;
      455    14133    3              END;
      456    14134
      457    14135    2         K$RWPARM.LDCT$ = LDCT$;
      458    14136
      459    14137    2         IF DATA_HDR.CNTRL                 /* Control record                     */
      460    14138    2         THEN GOTO RECV_CNTRL;
      461    14139
      462    14140        /*S* SCREECH_CODE: KIS-S$BADLDCTX
      463    14141             TYPE: SNAP
      464    14142             MESSAGE: LDCTX in the QDP Session header is bad.
      465    14143        */
      466    14144
      467    14145        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:53   
      468    14146        /*F* NAME: KIS$RECV - Data Received - Data Message
      469    14147
      470    14148        K$RWPARM.UHDR$ and UHDRSZ are updated to reflect the stripping off
      471    14149        of the session header.
      472    14150
      473    14151        KIA$ISCAN is called passing the LDCT that represents the end point
      474    14152        on this host and the updated K$RWPARM.
      475    14153        */
      476    14154    2         IF LDCT$ = ADDR(NIL)
      477    14155    3         THEN DO;
      478    14156                       /*N* Should make sure a terminate is sent*/
      479    14157    3              RETURN;
      480    14158    3              END;
      481    14159
      482    14160    2         K$RWPARM.UHDR$ = PINCRC(K$RWPARM.SHDR$,SIZEC(K$SQDP_DATA));
      483    14161
      484    14162    2         K$RWPARM.UHDRSZ = DATA_HDR.LENGTH_UNPK.HIBYTE * 256 +
      485    14163    2           DATA_HDR.LENGTH_UNPK.LOBYTE;
      486    14164
      487    14165    2         K$RWPARM.RECTYPE = DATA_HDR.TYPE_UNPK.HIBYTE * 256
      488    14166    2           + DATA_HDR.TYPE_UNPK.LOBYTE;
      489    14167
      490    14168    2         IF NOT LDCT$->NK$LDCT.DFLG.FEDN
      491    14169    2         THEN CALL KIA$ISCAN (LDCT$->NK$LDCT,K$RWPARM)
      492    14170    3              WHENALTRETURN DO;
      493    14171    3                   ALTRETURN;
      494    14172    3                   END;
      495    14173
      496    14174    2         RETURN;
      497    14175
      498    14176        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:54   
      499    14177    2   RECV_CNTRL: ;
      500    14178    2         HDR_TYPE = (DATA_HDR.TYPE_UNPK.HIBYTE * 256
      501    14179    2           + DATA_HDR.TYPE_UNPK.LOBYTE );
      502    14180
      503    14181    2         IF (HDR_TYPE > %K_SQDP_TERM)
      504    14182    2         THEN CALL SC_BADFNC;
      505    14183
      506    14184    2         IF LDCT$ ~= ADDR(NIL) AND LDCT$->NK$LDCT.IP$ ~= ADDR(NIL)
      507    14185    2         THEN GOTO DEFER_IO;
      508    14186
      509    14187    3         DO CASE (HDR_TYPE);
      510    14188
      511    14189        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:55   
      512    14190        /*F* NAME: KIS$RECV - Data Received - Initiate Request
      513    14191
      514    14192        If a LDCT is present in the initiate request header, this is
      515    14193        the response from the fep following an M$SETFP or ???
      516    14194
      517    14195        The routine to be called depends on the value of NK$LDCT.RESCOD:
      518    14196        .fif
      519    14197        }    NK_TSFPRG -> Call KIA$FPCNCT
      520    14198        }    NK_CGFPRG -> Call KIA$FPCNCT
      521    14199        }    NK_TSTRM  -> Send connect ack; Report SS_CIC event
      522    14200        }    NK_CGTRM  -> Send connect ack; Call KCO$TRMGO
      523    14201        }    NK_NOCG   -> Send connect ack
      524    14202        }    NK_RES    -> Send connect ack
      525    14203        .fin
      526    14204
      527    14205        If no LDCT is passed, it is a logon request.  KIS$RECV will
      528    14206        get a LDCT for the connect, build a KL_SGN message and send it
      529    14207        to SLUG via a call to KUB$WRITE.
      530    14208        */
      531    14209    3          CASE (%K_SQDP_INIT);             /* Initiate request                   */
      532    14210    3            IF LDCTX ~= 0                  /* Ldct was specified                 */
      533    14211    4            THEN DO;
      534    14212    4                 IF LDCT$ = ADDR(NIL)
      535    14213    5                 THEN DO;
      536    14214    5                      TEMP = %K_REASON_BADGEN;
      537    14215    5                      GOTO SEND_NAK;
      538    14216    5                      END;
      539    14217
      540    14218                      %LOCK (G=LDCT$->NK$LDCT.LOCK);
      541    14221    4                 IF K$SQDP_INIT.DEST_GENERATION ~= LDCT$->NK$LDCT.GENERATION
      542    14222    5                 THEN DO;
      543    14223                           %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      544    14226    5                      TEMP = %K_REASON_BADGEN;
      545    14227    5                      GOTO SEND_NAK;
      546    14228    5                      END;
      547    14229
      548    14230    4                 LDCT$->NK$LDCT.LKFLG.QDPPATH = K$SQDP_INIT.QDP;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:56   
      549    14231    4                 LDCT$->NK$LDCT.RLCID = K$SQDP_INIT.RLCID; /*dont pack           */
      550    14232    4                 LDCT$->NK$LDCT.TCTX# = K$RWPARM.TCTX#;
      551    14233    4                 LDCT$->NK$LDCT.SYSID = K$SQDP_INIT.SYSID;
      552    14234
      553    14235    5                 DO CASE(LDCT$->NK$LDCT.RESCOD);
      554    14236    5                  CASE(NK_CGFPRG,NK_TSFPRG);
      555    14237    5                    CALL KIA$FPCNCT(LDCT$->NK$LDCT)
      556    14238    6                    WHENALTRETURN DO;
      557    14239                              %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      558    14242    6                         GOTO DEFER_IO;
      559    14243    6                         END;
      560    14244    5                    RETURN;
      561    14245
      562    14246    5                  CASE(NK_TSTRM);
      563    14247    5                    CALL CONNECT_ACK ALTRET(DEFER_IO);
      564    14248    5                    IF B$USRT$->B$USER.FLG(LDCT$->NK$LDCT.USER) & %U_SCIO
      565    14249    5                      AND B$USRT$->B$USER.MISC$(LDCT$->NK$LDCT.USER) = LDCT$
      566    14250    6                    THEN DO;
      567    14251    6                         CALL SSR$RUE(%SS_CIC,LDCT$->NK$LDCT.USER);
      568    14252    6                         LDCT$->NK$LDCT.LKFLG.REGGED = '0'B;
      569    14253    6                         END;
      570    14254    5                    RETURN;
      571    14255
      572    14256    5                  CASE(NK_CGTRM);
      573    14257    5                    CALL CONNECT_ACK ALTRET(DEFER_IO);
      574    14258    5                    CALL KCO$TRMGO(LDCT$);
      575    14259    5                    RETURN;
      576    14260
      577    14261    5                  CASE(NK_NOCG,NK_RES);
      578    14262    5                    IF LDCT$->NK$LDCT.RESCOD = NK_RES
      579    14263    5                    THEN LDCT$->NK$LDCT.RAT$->FR$RAT.FLG.RUP = '1'B;
      580    14264    5                    CALL CONNECT_ACK ALTRET(DEFER_IO);
      581    14265    5                    LDCT$->NK$LDCT.TERMID = K$SQDP_INIT.TERMINAL_ID;
      582    14266                         %UNPACK_HW (SRC=LDCT$->NK$LDCT.TERMID.CHAN);
      583    14270                         %UNPACK_HW (SRC=LDCT$->NK$LDCT.TERMID.SUB);
      584    14274                         %UNPACK_HW (SRC=LDCT$->NK$LDCT.TERMID.SUBSUB);
      585    14278    5                    END/*do case(ldct.rescod)*/;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:57   
      586    14279    4                 RETURN;
      587    14280    4                 END/* do if ldct was specified*/;
      588    14281
      589    14282
      590    14283        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:58   
      591    14284
      592    14285        /* No LDCT, must be a logon request.
      593    14286        */
      594    14287    3            CALL NKL$GETDCT (LDCT$)
      595    14288    4            WHENALTRETURN DO;
      596    14289    4                 TEMP = %K_REASON_NOLDCT;
      597    14290    4   SEND_NAK:
      598    14291    4                 RLCID = K$SQDP_INIT.RLCID;
      599    14292    4                 INIT_ACK_HDR.RLCID.LDCTX = 0;
      600    14293    4                 INIT_ACK_HDR.RLCID.GENERATION = 0;
      601    14294    4                 CALL CONNECT_NAK ALTRET(DEFER_IO);
      602    14295    4                 RETURN;
      603    14296    4                 END;
      604    14297
      605    14298    3            LDCT$->NK$LDCT.RESCOD = NK_LOGON;
      606    14299    3            LDCT$->NK$LDCT.RLCID = K$SQDP_INIT.RLCID; /*dont pack*/
      607    14300    3            LDCT$->NK$LDCT.LKFLG.QDPPATH = K$SQDP_INIT.QDP;
      608    14301    3            LDCT$->NK$LDCT.TCTX# = K$RWPARM.TCTX#;
      609    14302
      610    14303    3            KL_SGN = '0'B;
      611    14304    3            KL_SGN.FCN = IGA_SGN;
      612    14305    3            KL_SGN.LOGON.LGNSIZ = K$RWPARM.UHDRSZ;
      613    14306    3            KL_SGN.LDCTX = LDCT$->NK$LDCT.LDCTX;
      614    14307    3            KL_SGN.NODE = LDCT$->NK$LDCT.RLCID.NODE;
      615    14308    3            KL_SGN.TERMINAL_ID = K$SQDP_INIT.TERMINAL_ID;
      616    14309
      617    14310    3            K$RWPARM.UHDR$ = PINCRC(K$RWPARM.SHDR$,SIZEC(K$SQDP_INIT));
      618    14311    3            K$RWPARM.UHDRSZ = K$SQDP_INIT.DATA_HDR.LENGTH_UNPK.HIBYTE * 256 +
      619    14312    3              K$SQDP_INIT.DATA_HDR.LENGTH_UNPK.LOBYTE;
      620    14313
      621    14314    3            TEMP = K$RWPARM.UHDRSZ;
      622    14315    3            KL_SGN.LOGON.LGNTXT = K$RWPARM.UHDR$->DATAMSG;
      623    14316
      624    14317
      625    14318    3            IF K$SQDP_INIT.RESOURCE = 'NETMAN'
      626    14319    4            THEN DO;
      627    14320    4                 KL_SGN.TERMINAL_ID.TTYP = %KLTY_FEP#;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:59   
      628    14321    4                 KL_SGN.LOGON.LGNSIZ = SIZEC(K$SQDP_INIT.NODE_NAME);
      629    14322    4                 KL_SGN.LOGON.LGNTXT = K$SQDP_INIT.NODE_NAME;
      630    14323    4                 END;
      631    14324
      632    14325    3            CALL KUB$WRITE (KL_SGN,SIZEC(KL_SGN),'HLPADMIN')
      633    14326    4            WHENALTRETURN DO;
      634    14327    4   DEFER_IO:
      635    14328    4                 K$RWPARM.ERR = %K$DEFER_IO;
      636    14329    4                 ALTRETURN;
      637    14330    4                 END;
      638    14331
      639    14332    3            RETURN;
      640    14333
      641    14334        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:60   
      642    14335        /*F* NAME: KIS$RECV - Data Received - Initiate Acknowledgement
      643    14336
      644    14337        The LDCT is updated with information from the initiate acknowledgement
      645    14338        message.
      646    14339        */
      647    14340    3          CASE (%K_SQDP_INIT_ACK);         /* Initiate ack                       */
      648    14341
      649    14342                 %LOCK (G=LDCT$->NK$LDCT.LOCK);
      650    14345    3            LDCT$->NK$LDCT.RLCID = K$SQDP_INIT.RLCID;
      651    14346    3            LDCT$->NK$LDCT.TCTX# = K$RWPARM.TCTX#;
      652    14347    3            LDCT$->NK$LDCT.SYSID = K$SQDP_INIT.SYSID;
      653    14348
      654    14349                 %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      655    14352
      656    14353    3            RETURN;
      657    14354
      658    14355        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:61   
      659    14356        /*F* NAME: KIS$RECV - Data Received - Terminate Request
      660    14357
      661    14358        KIA$TERM is called to terminate the connection for the endpoint
      662    14359        specified in the terminate message.
      663    14360        */
      664    14361    3          CASE (%K_SQDP_TERM);             /* Terminate                          */
      665    14362    3            CALL KIA$TERM(LDCT$->NK$LDCT) ALTRET(DEFER_IO);
      666    14363
      667    14364
      668    14365    3            END/*do case hdr_type*/;
      669    14366        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:62   
      670    14367
      671    14368    2       CASE (ELSE);
      672    14369    2         CALL SC_BADFNC;
      673    14370
      674    14371    2         END/*do case function*/;
      675    14372
      676    14373    1      RETURN;
      677    14374        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:63   
      678    14375    1   CONNECT_ACK: PROC ALTRET;
      679    14376           %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      680    14379    2      RLCID = LDCT$->NK$LDCT.RLCID;
      681    14380    2      LDCTX = LDCT$->NK$LDCT.LDCTX;
      682    14381    2      INIT_ACK_HDR.RLCID.LDCTX = -MOD (LDCTX,256) + LDCTX + LDCTX;
      683    14382    2      INIT_ACK_HDR.RLCID.GENERATION = LDCT$->NK$LDCT.GENERATION;
      684    14383    2      INIT_ACK_HDR.RESCODE =LDCT$->NK$LDCT.RESCOD;
      685    14384    2      TEMP = %K_REASON_NORMAL;
      686    14385
      687    14386    2   CONNECT_NAK: ENTRY ALTRET;
      688    14387    2      K$RWPARM.SHDR$ = ADDR(INIT_ACK_HDR);
      689    14388    2      K$RWPARM.SHDRSZ = SIZEC(INIT_ACK_HDR);
      690    14389
      691    14390    2      INIT_ACK_HDR.REASON_UNPK.LOBYTE = TEMP;
      692    14391    2      INIT_ACK_HDR.REASON_UNPK.HIBYTE = TEMPR.TOP;
      693    14392
      694    14393    2      INIT_ACK_HDR.CNTRL = '01'B;
      695    14394    2      INIT_ACK_HDR.TYPE = %K_SQDP_INIT_ACK;
      696    14395
      697    14396    2      TEMP = K$RWPARM.UHDRSZ + K$RWPARM.MSGSZ;
      698    14397    2      INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.LOBYTE = TEMP;
      699    14398    2      INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.HIBYTE = TEMPR.TOP;
      700    14399
      701    14400    2      INIT_ACK_HDR.RLCID.NODE = K_NODE#;
      702    14401    2      INIT_ACK_HDR.LDCT = RLCID.LDCTX;
      703    14402
      704    14403    2      K$RWPARM.FEX = RLCID.NODE;
      705    14404    2      K$RWPARM.FUNCTION = %K_WRITE;
      706    14405
      707    14406    2      IF DATA_HDR.QDP
      708    14407    2      THEN CALL KIN$SEND(K$RWPARM) ALTRET(L_ALTRTN);
      709    14408    2      ELSE CALL KIT$SEND(K$RWPARM) ALTRET(L_ALTRTN);
      710    14409
      711    14410    2      RETURN;
      712    14411
      713    14412    2   L_ALTRTN:
      714    14413    2      ALTRETURN;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:64   
      715    14414
      716    14415    2   END CONNECT_ACK;
      717    14416
      718    14417    1   END KIS$RECV;
      719    14418        %EOD;

PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:65   
--  Include file information  --

   KI_MACROS_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_REASON_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   K_RLCID_M.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIS$RECV.

   Procedure KIS$RECV requires 533 words for executable code.
   Procedure KIS$RECV requires 40 words of local(AUTO) storage.

PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:66   

 Object Unit name= KIS$RECV                                   File name= KIS$SESSION.:E05TOU
 UTS= JUL 30 '97 00:42:06.44 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      5      5  KIS$RECV
    1   Proc  even  none   533   1025  KIS$RECV
    2  RoData even  none    12     14  KIS$RECV

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KIS$RECV
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:67   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KIS$UNQUEUE
         yes           Std       1 KIS$REP_TERM
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 KCO$TRMGO
 yes     yes           Std       1 NKL$GETDCT
 yes     yes           Std       2 KIA$ISCAN
 yes     yes           Std       1 KIA$TERM
 yes     yes           Std       3 KUB$WRITE
         yes           Std       1 HFC$LOCK
 yes     yes           Std       1 KIA$FPCNCT
         yes           Std       4 SSR$RUE
 yes     yes           Std       1 KIN$SEND
 yes     yes           Std       1 KIT$SEND
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BADLDCTX                           SC_BADFNC                             N$DCT$$
     NK_MXLOCAL                            NK_CUR                                K_NODE#
     B$USRT$                               KI_TCTX$$                             B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:68   


      273        1        /*T***********************************************************/
      274        2        /*T*                                                         */
      275        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      276        4        /*T*                                                         */
      277        5        /*T***********************************************************/
      278        6        KIS$RECV: PROC(K$RWPARM) ALTRET;

      6  1 000000   000000 700200 xent  KIS$RECV     TSX0  ! X66_AUTO_1
         1 000001   000050 000001                    ZERO    40,1

      279        7
      280        8
      281        9                                                /* Include files                      */
      282       10        %INCLUDE B$USER;
      283      226        %INCLUDE K_SUBS_C;
      284      259        %INCLUDE NK$LDCT;
      285      361        %INCLUDE NK_LDCT_R;
      286      370        %INCLUDE NK_SUBS;
      287      395        %INCLUDE KI_CP6;
      288     1491        %INCLUDE K_QDPHDRS_M;
      289     2373        %INCLUDE K_INTERFACE_M;
      290     2782        %INCLUDE K_RLCID_M;
      291     2886        %INCLUDE KL_SUPER_C;                    /*get equ for KLTY_FEP#               */
      292     5788        %INCLUDE KL_AFCN_C;
      293     5889        %INCLUDE FR$RAT;
      294     5942        %INCLUDE K$RWPARM;
      295     6328        %INCLUDE HF_LOCK_C;
      296     6342        %INCLUDE K_REASON_C;
      297     6368        %INCLUDE KL_MACRO_C;
      298     9720        %INCLUDE SS_SCHED_C;
      299     9953        %INCLUDE UM_CP6;
      300    10805        %INCLUDE K_ADDRESS_M;
      301    11308        %INCLUDE KI_MACROS_C;
      302    11916
      303    11917                                                /* Parameter definitions              */
      304    11918        %K$RWPARM (NAME=K$RWPARM);
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:69   
      305    12234
      306    12235                                                /* Entry point references             */
      307    12236    1   DCL KCF$QNF ENTRY(1);
      308    12237    1   DCL KCO$TRMGO ENTRY(1) ALTRET;
      309    12238    1   DCL KIA$FPCNCT ENTRY(1) ALTRET;
      310    12239    1   DCL KIA$ISCAN ENTRY(2) ALTRET;
      311    12240    1   DCL KIA$TERM ENTRY(1) ALTRET;
      312    12241    1   DCL KIN$SEND ENTRY(1) ALTRET;
      313    12242    1   DCL KIT$SEND ENTRY(1) ALTRET;
      314    12243    1   DCL KIS$REP_TERM ENTRY(1);
      315    12244    1   DCL KIS$UNQUEUE ENTRY(1);
      316    12245    1   DCL KUB$WRITE ENTRY(3) ALTRET;
      317    12246    1   DCL NKL$GETDCT ENTRY(1) ALTRET;
      318    12247    1   DCL SSR$RUE ENTRY(4);
      319    12248    1   DCL SC_BADFNC ENTRY CONV(2,0);
      320    12249    1   DCL SC_BADLDCTX ENTRY CONV(2,0);
      321    12250
      322    12251                                                /* Based items                        */
      323    12252        %FR$RAT;
      324    12292        %NK$LDCT (NAME=NK$LDCT);
      325    12338
      326    12339        %K$SQDP_INIT (STCLASS="BASED(SHDR$)", HOST_TYPE=UNPACKED, ALGN=CALIGNED);
      327    12703        %K$SQDP_DATA (STCLASS="BASED(K$RWPARM.SHDR$)", HOST_TYPE=UNPACKED, ALGN=CALIGNED);
      328    12830
      329    12831    1   DCL DATAMSG CHAR(TEMP) BASED;
      330    12832    1   DCL KI$TCTX$(0:0) PTR BASED( KI_TCTX$$);
      331    12833        %KI$TCTX;
      332    13391
      333    13392                                                /* Auto                               */
      334    13393    1   DCL SHDR$ PTR;
      335    13394    1   DCL LDCTX UBIN;
      336    13395    1   DCL LDCT$ PTR;
      337    13396    1   DCL HDR_TYPE UBIN;
      338    13397
      339    13398    1   DCL TEMP UBIN;
      340    13399    1   DCL 1 TEMPR REDEF TEMP,
      341    13400    1         2 TOP UBIN(28) UNAL,
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:70   
      342    13401    1         2 BOT UBIN(8) UNAL;
      343    13402
      344    13403    1   DCL HALFWORD UBIN(18) UNAL BASED;
      345    13404        %MACRO UNPACK_HW (SRC=);
      346    13405           TEMP = ADDR(SRC)->HALFWORD;
      347    13406           ADDR(SRC)->HALFWORD = (MOD(TEMP,512) + TEMP)/2;
      348    13407        %MEND;
      349    13408        %K$SQDP_DATA (NAME=DATA_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED);
      350    13535
      351    13536        %K$SQDP_INIT_ACK (NAME=INIT_ACK_HDR, STCLASS=AUTO, HOST_TYPE=UNPACKED);
      352    13829
      353    13830        %K$RLCID (NAME=RLCID, STCLASS=AUTO, HOST_TYPE=UNPACKED);
      354    13906
      355    13907        %KL_SGN (FPTN=KL_SGN,STCLASS=AUTO, LGNSIZ=20);
      356    14000
      357    14001        %KL_FEPST( FPTN=KL_FEPST, STCLASS=AUTO);
      358    14036
      359    14037                                                /* SYMREFs                            */
      360    14038    1   DCL K_NODE# UBIN SYMREF;
      361    14039    1   DCL B$USRT$ PTR SYMREF;
      362    14040    1   DCL KI_TCTX$$ PTR SYMREF;
      363    14041
      364    14042        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:71   
      365    14043        /*F* NAME: KIS$RECV - Receive Host Inbound Messages
      366    14044
      367    14045        This routine is called from KIN$RECV or KIT$RECV.  It is the interface
      368    14046        for passing incoming messages from a local fep up to the user.
      369    14047
      370    14048        KIS$RECV is called with the K$RWPARM parameter:
      371    14049
      372    14050        .fif
      373    14051        }    K$RWPARM.FUNCTION - Indicates the function to be performed.
      374    14052        }                       This will be one of the following values
      375    14053        }                       from the file K_SUBS_C:
      376    14054        }
      377    14055        }                          K_RECV
      378    14056        }                          K_TDISCONNECT_IND
      379    14057        .fin
      380    14058
      381    14059        The only function that is handled here is K_RECV.  The routines
      382    14060        KIS$REP_TERM and KIS$UNQUEUE are called for the other two functions.
      383    14061        */
      384    14062
      385    14063    1      IF K$RWPARM.FUNCTION = %K_RECV

  14063  1 000002   200003 470500                    LDP0    @K$RWPARM,,AUTO
         1 000003   000020 235100                    LDA     16,,PR0
         1 000004   000005 115007                    CMPA    5,DL
         1 000005   000031 600000 1                  TZE     RECV_DATA

      386    14064    1      THEN GOTO RECV_DATA;
      387    14065
      388    14066    1      IF K$RWPARM.FUNCTION = 11            /* %K_UNQUEUE                         */

  14066  1 000006   000013 115007                    CMPA    11,DL
         1 000007   000015 601000 1                  TNZ     s:14072

      389    14067    2      THEN DO;

      390    14068    2           CALL KIS$UNQUEUE(K$RWPARM);
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:72   

  14068  1 000010   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         1 000011   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000012   000000 701000 xent               TSX1    KIS$UNQUEUE
         1 000013   000000 011000                    NOP     0

      391    14069    2           RETURN;

  14069  1 000014   000000 702200 xent               TSX2  ! X66_ARET

      392    14070    2           END;
      393    14071
      394    14072    1      IF K$RWPARM.FUNCTION = %K_TDISCONNECT_IND

  14072  1 000015   000031 115007                    CMPA    25,DL
         1 000016   000024 601000 1                  TNZ     s:14078

      395    14073    2      THEN DO;

      396    14074    2           CALL KIS$REP_TERM(K$RWPARM);

  14074  1 000017   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         1 000020   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000021   000000 701000 xent               TSX1    KIS$REP_TERM
         1 000022   000000 011000                    NOP     0

      397    14075    2           RETURN;

  14075  1 000023   000000 702200 xent               TSX2  ! X66_ARET

      398    14076    2           END;
      399    14077
      400    14078    2      DO CASE (K$RWPARM.FUNCTION);

  14078  1 000024   000005 135007                    SBLA    5,DL
         1 000025   000001 115007                    CMPA    1,DL
         1 000026   000030 602005 1                  TNC     s:14078+4,AL
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:73   
         1 000027   000667 710000 1                  TRA     s:14369
         1 000030   000031 710000 1                  TRA     RECV_DATA

      401    14079
      402    14080        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:74   
      403    14081        /*F* NAME: KIS$RECV - Data Received
      404    14082
      405    14083        The action to be taken when KIS$RECV has been called with
      406    14084        K_RECV function is determined by the type of message that
      407    14085        has been received.
      408    14086
      409    14087        This will be one of the following EQUated values from file
      410    14088        K_QDPHDRS_M:
      411    14089
      412    14090        .fif
      413    14091        }    K_SQDP_DATA        0   Data
      414    14092        }    K_SQDP_INIT        1   Initiate Logical Connection Request
      415    14093        }    K_SQDP_INIT_ACK    2   Initiate Logical Connection Ack
      416    14094        }    K_SQDP_TERM        3   Terminate Logical Connection
      417    14095        .fin
      418    14096        */
      419    14097
      420    14098    2       CASE (%K_RECV);

      421    14099
      422    14100    2   RECV_DATA:
      423    14101    2         SHDR$ = K$RWPARM.SHDR$;

  14101  1 000031   000022 236100       RECV_DATA    LDQ     18,,PR0
         1 000032   200004 756100                    STQ     SHDR$,,AUTO

      424    14102    2         DATA_HDR = SHDR$->K$SQDP_DATA;

  14102  1 000033   200004 471500                    LDP1    SHDR$,,AUTO
         1 000034   000100 100500                    MLR     fill='000'O
         1 000035   100000 000006                    ADSC9   0,,PR1                   cn=0,n=6
         1 000036   200011 000006                    ADSC9   DATA_HDR,,AUTO           cn=0,n=6

      425    14103
      426    14104    2         LDCTX = DATA_HDR.LDCT_UNPK.HIBYTE * 256 + DATA_HDR.LDCT_UNPK.LOBYTE;

  14104  1 000037   200011 236100                    LDQ     DATA_HDR,,AUTO
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:75   
         1 000040   000022 772000                    QRL     18
         1 000041   000377 376007                    ANQ     255,DL
         1 000042   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000043   200011 236100                    LDQ     DATA_HDR,,AUTO
         1 000044   000023 772000                    QRL     19
         1 000045   177400 376007                    ANQ     65280,DL
         1 000046   200044 036100                    ADLQ    KL_FEPST+7,,AUTO
         1 000047   200005 756100                    STQ     LDCTX,,AUTO

      427    14105
      428    14106        /* Validate the LDCTX.  If it appears to be bad, send a message asking
      429    14107           SLUG to crash the originating fep and ALTRET to leave the bad msg
      430    14108           in the ICQ for dump analysis.
      431    14109        */
      432    14110    2         IF LDCTX = 0

  14110  1 000050   000054 601000 1                  TNZ     s:14114

      433    14111    2         THEN LDCT$ = ADDR( NIL);

  14111  1 000051   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000052   200006 756100                    STQ     LDCT$,,AUTO
         1 000053   000125 710000 1                  TRA     s:14135

      434    14112
      435    14113    3         ELSE DO;

      436    14114    3              IF LDCTX <= NK_MXLOCAL OR LDCTX > NK_CUR

  14114  1 000054   000000 116000 xsym               CMPQ    NK_MXLOCAL
         1 000055   000067 602000 1                  TNC     BAD_LDCTX
         1 000056   000067 600000 1                  TZE     BAD_LDCTX
         1 000057   000000 116000 xsym               CMPQ    NK_CUR
         1 000060   000062 600000 1                  TZE     s:14117
         1 000061   000067 603000 1                  TRC     BAD_LDCTX

      437    14115    3              THEN GOTO BAD_LDCTX;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:76   
      438    14116
      439    14117    3              LDCT$ = NK$LDCT$( LDCTX);

  14117  1 000062   000000 473400 xsym               LDP3    N$DCT$$
         1 000063   300000 236106                    LDQ     0,QL,PR3
         1 000064   200006 756100                    STQ     LDCT$,,AUTO

      440    14118    3              IF LDCT$ = ADDR( NIL)

  14118  1 000065   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000066   000125 601000 1                  TNZ     s:14135

      441    14119    4              THEN DO;

      442    14120    4   BAD_LDCTX:
      443    14121    4                   CALL SC_BADLDCTX;       /* snap the LDCTs now                 */

  14121  1 000067   000000 713400 xsym  BAD_LDCTX    CLIMB   SC_BADLDCTX
         1 000070   000000 600000 xsid               climb   nvectors=         0

      444    14122    5                   IF K$RWPARM.THDR$ = ADDR( NIL) THEN DO;

  14122  1 000071   200003 470500                    LDP0    @K$RWPARM,,AUTO
         1 000072   000024 236100                    LDQ     20,,PR0
         1 000073   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000074   000100 601000 1                  TNZ     s:14127

      445    14123                                                /* this message is from a local FEP   */
      446    14124    5                        K$RWPARM.ERR = %K$BAD_LDCTX;

  14124  1 000075   000011 235007                    LDA     9,DL
         1 000076   000013 755100                    STA     11,,PR0

      447    14125    5                        ALTRETURN;         /* Make KIQ crash the FEP immediately */

  14125  1 000077   000000 702200 xent               TSX2  ! X66_AALT

PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:77   
      448    14126    5                        END;
      449    14127    4                   KL_FEPST = '0'B;

  14127  1 000100   000100 100400                    MLR     fill='000'O
         1 000101   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000102   200035 000016                    ADSC9   KL_FEPST,,AUTO           cn=0,n=14

      450    14128    4                   KL_FEPST.FCN = IGA_CRASHFEP_BF;

  14128  1 000103   120000 236003                    LDQ     40960,DU
         1 000104   200035 552140                    STBQ    KL_FEPST,'40'O,AUTO

      451    14129    4                   KL_FEPST.FEP = KI$TCTX$( K$RWPARM.TCTX#)->KI$TCTX.NODE;

  14129  1 000105   000033 220100                    LDX0    27,,PR0
         1 000106   000000 471400 xsym               LDP1    KI_TCTX$$
         1 000107   100000 473510                    LDP3    0,X0,PR1
         1 000110   300000 236100                    LDQ     0,,PR3
         1 000111   200035 552120                    STBQ    KL_FEPST,'20'O,AUTO

      452    14130    4                   CALL KUB$WRITE( KL_FEPST, LENGTHC( KL_FEPST), 'HLPADMIN');

  14130  1 000112   000001 236000 2                  LDQ     1
         1 000113   200046 756100                    STQ     KL_FEPST+9,,AUTO
         1 000114   000002 236000 2                  LDQ     2
         1 000115   200045 756100                    STQ     KL_FEPST+8,,AUTO
         1 000116   200035 633500                    EPPR3   KL_FEPST,,AUTO
         1 000117   200044 453500                    STP3    KL_FEPST+7,,AUTO
         1 000120   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000121   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000122   000000 701000 xent               TSX1    KUB$WRITE
         1 000123   000000 011000                    NOP     0

      453    14131    4                   RETURN;

  14131  1 000124   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:78   
      454    14132    4                   END;
      455    14133    3              END;
      456    14134
      457    14135    2         K$RWPARM.LDCT$ = LDCT$;

  14135  1 000125   000016 756100                    STQ     14,,PR0

      458    14136
      459    14137    2         IF DATA_HDR.CNTRL                 /* Control record                     */

  14137  1 000126   200011 236100                    LDQ     DATA_HDR,,AUTO
         1 000127   600000 316007                    CANQ    -65536,DL
         1 000130   000177 601000 1                  TNZ     RECV_CNTRL

      460    14138    2         THEN GOTO RECV_CNTRL;
      461    14139
      462    14140        /*S* SCREECH_CODE: KIS-S$BADLDCTX
      463    14141             TYPE: SNAP
      464    14142             MESSAGE: LDCTX in the QDP Session header is bad.
      465    14143        */
      466    14144
      467    14145        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:79   
      468    14146        /*F* NAME: KIS$RECV - Data Received - Data Message
      469    14147
      470    14148        K$RWPARM.UHDR$ and UHDRSZ are updated to reflect the stripping off
      471    14149        of the session header.
      472    14150
      473    14151        KIA$ISCAN is called passing the LDCT that represents the end point
      474    14152        on this host and the updated K$RWPARM.
      475    14153        */
      476    14154    2         IF LDCT$ = ADDR(NIL)

  14154  1 000131   200006 236100                    LDQ     LDCT$,,AUTO
         1 000132   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000133   000135 601000 1                  TNZ     s:14160

      477    14155    3         THEN DO;

      478    14156                       /*N* Should make sure a terminate is sent*/
      479    14157    3              RETURN;

  14157  1 000134   000000 702200 xent               TSX2  ! X66_ARET

      480    14158    3              END;
      481    14159
      482    14160    2         K$RWPARM.UHDR$ = PINCRC(K$RWPARM.SHDR$,SIZEC(K$SQDP_DATA));

  14160  1 000135   000022 236100                    LDQ     18,,PR0
         1 000136   000003 036000 2                  ADLQ    3
         1 000137   000014 756100                    STQ     12,,PR0

      483    14161
      484    14162    2         K$RWPARM.UHDRSZ = DATA_HDR.LENGTH_UNPK.HIBYTE * 256 +

  14162  1 000140   200012 236100                    LDQ     DATA_HDR+1,,AUTO
         1 000141   000022 772000                    QRL     18
         1 000142   000377 376007                    ANQ     255,DL
         1 000143   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000144   200012 236100                    LDQ     DATA_HDR+1,,AUTO
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:80   
         1 000145   000023 772000                    QRL     19
         1 000146   177400 376007                    ANQ     65280,DL
         1 000147   200044 036100                    ADLQ    KL_FEPST+7,,AUTO
         1 000150   000015 756100                    STQ     13,,PR0

      485    14163    2           DATA_HDR.LENGTH_UNPK.LOBYTE;
      486    14164
      487    14165    2         K$RWPARM.RECTYPE = DATA_HDR.TYPE_UNPK.HIBYTE * 256

  14165  1 000151   200011 236100                    LDQ     DATA_HDR,,AUTO
         1 000152   000377 376007                    ANQ     255,DL
         1 000153   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000154   200011 236100                    LDQ     DATA_HDR,,AUTO
         1 000155   000001 772000                    QRL     1
         1 000156   037400 376007                    ANQ     16128,DL
         1 000157   200044 036100                    ADLQ    KL_FEPST+7,,AUTO
         1 000160   000030 756100                    STQ     24,,PR0

      488    14166    2           + DATA_HDR.TYPE_UNPK.LOBYTE;
      489    14167
      490    14168    2         IF NOT LDCT$->NK$LDCT.DFLG.FEDN

  14168  1 000161   200006 473500                    LDP3    LDCT$,,AUTO
         1 000162   300006 236100                    LDQ     6,,PR3
         1 000163   000020 316007                    CANQ    16,DL
         1 000164   000176 601000 1                  TNZ     s:14174

      491    14169    2         THEN CALL KIA$ISCAN (LDCT$->NK$LDCT,K$RWPARM)

  14169  1 000165   200003 236100                    LDQ     @K$RWPARM,,AUTO
         1 000166   200006 235100                    LDA     LDCT$,,AUTO
         1 000167   200044 757100                    STAQ    KL_FEPST+7,,AUTO
         1 000170   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000171   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000172   000000 701000 xent               TSX1    KIA$ISCAN
         1 000173   000175 702000 1                  TSX2    s:14171
         1 000174   000176 710000 1                  TRA     s:14174
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:81   

      492    14170    3              WHENALTRETURN DO;

      493    14171    3                   ALTRETURN;

  14171  1 000175   000000 702200 xent               TSX2  ! X66_AALT

      494    14172    3                   END;
      495    14173
      496    14174    2         RETURN;

  14174  1 000176   000000 702200 xent               TSX2  ! X66_ARET

  14168  1 000177                       RECV_CNTRL   null
      497    14175
      498    14176        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:82   
      499    14177    2   RECV_CNTRL: ;
      500    14178    2         HDR_TYPE = (DATA_HDR.TYPE_UNPK.HIBYTE * 256

  14178  1 000177   200011 236100                    LDQ     DATA_HDR,,AUTO
         1 000200   000377 376007                    ANQ     255,DL
         1 000201   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000202   200011 236100                    LDQ     DATA_HDR,,AUTO
         1 000203   000001 772000                    QRL     1
         1 000204   037400 376007                    ANQ     16128,DL
         1 000205   200044 036100                    ADLQ    KL_FEPST+7,,AUTO
         1 000206   200007 756100                    STQ     HDR_TYPE,,AUTO

      501    14179    2           + DATA_HDR.TYPE_UNPK.LOBYTE );
      502    14180
      503    14181    2         IF (HDR_TYPE > %K_SQDP_TERM)

  14181  1 000207   000004 116007                    CMPQ    4,DL
         1 000210   000213 602000 1                  TNC     s:14184

      504    14182    2         THEN CALL SC_BADFNC;

  14182  1 000211   000000 713400 xsym               CLIMB   SC_BADFNC
         1 000212   000000 600000 xsid               climb   nvectors=         0

      505    14183
      506    14184    2         IF LDCT$ ~= ADDR(NIL) AND LDCT$->NK$LDCT.IP$ ~= ADDR(NIL)

  14184  1 000213   200006 236100                    LDQ     LDCT$,,AUTO
         1 000214   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000215   000222 600000 1                  TZE     s:14187
         1 000216   200006 470500                    LDP0    LDCT$,,AUTO
         1 000217   000013 236100                    LDQ     11,,PR0
         1 000220   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000221   000623 601000 1                  TNZ     DEFER_IO

      507    14185    2         THEN GOTO DEFER_IO;
      508    14186
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:83   
      509    14187    3         DO CASE (HDR_TYPE);

  14187  1 000222   200007 235100                    LDA     HDR_TYPE,,AUTO
         1 000223   000004 115007                    CMPA    4,DL
         1 000224   000226 602005 1                  TNC     s:14187+4,AL
         1 000225   000671 710000 1                  TRA     s:14373
         1 000226   000666 710000 1                  TRA     s:14365
         1 000227   000232 710000 1                  TRA     s:14210
         1 000230   000630 710000 1                  TRA     s:14343
         1 000231   000662 710000 1                  TRA     s:14362

      510    14188
      511    14189        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:84   
      512    14190        /*F* NAME: KIS$RECV - Data Received - Initiate Request
      513    14191
      514    14192        If a LDCT is present in the initiate request header, this is
      515    14193        the response from the fep following an M$SETFP or ???
      516    14194
      517    14195        The routine to be called depends on the value of NK$LDCT.RESCOD:
      518    14196        .fif
      519    14197        }    NK_TSFPRG -> Call KIA$FPCNCT
      520    14198        }    NK_CGFPRG -> Call KIA$FPCNCT
      521    14199        }    NK_TSTRM  -> Send connect ack; Report SS_CIC event
      522    14200        }    NK_CGTRM  -> Send connect ack; Call KCO$TRMGO
      523    14201        }    NK_NOCG   -> Send connect ack
      524    14202        }    NK_RES    -> Send connect ack
      525    14203        .fin
      526    14204
      527    14205        If no LDCT is passed, it is a logon request.  KIS$RECV will
      528    14206        get a LDCT for the connect, build a KL_SGN message and send it
      529    14207        to SLUG via a call to KUB$WRITE.
      530    14208        */
      531    14209    3          CASE (%K_SQDP_INIT);             /* Initiate request                   */

      532    14210    3            IF LDCTX ~= 0                  /* Ldct was specified                 */

  14210  1 000232   200005 236100                    LDQ     LDCTX,,AUTO
         1 000233   000465 600000 1                  TZE     s:14287

      533    14211    4            THEN DO;

      534    14212    4                 IF LDCT$ = ADDR(NIL)

  14212  1 000234   200006 236100                    LDQ     LDCT$,,AUTO
         1 000235   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000236   000242 601000 1                  TNZ     s:14219

      535    14213    5                 THEN DO;

      536    14214    5                      TEMP = %K_REASON_BADGEN;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:85   

  14214  1 000237   000004 235007                    LDA     4,DL
         1 000240   200010 755100                    STA     TEMP,,AUTO

      537    14215    5                      GOTO SEND_NAK;

  14215  1 000241   000476 710000 1                  TRA     SEND_NAK

      538    14216    5                      END;
      539    14217
      540    14218                      %LOCK (G=LDCT$->NK$LDCT.LOCK);

  14219  1 000242   000020 036003                    ADLQ    16,DU
         1 000243   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000244   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000245   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000246   000000 701000 xent               TSX1    HFC$LOCK
         1 000247   000000 011000                    NOP     0

      541    14221    4                 IF K$SQDP_INIT.DEST_GENERATION ~= LDCT$->NK$LDCT.GENERATION

  14221  1 000250   200006 470500                    LDP0    LDCT$,,AUTO
         1 000251   000014 236100                    LDQ     12,,PR0
         1 000252   000022 772000                    QRL     18
         1 000253   000377 376007                    ANQ     255,DL
         1 000254   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000255   200004 471500                    LDP1    SHDR$,,AUTO
         1 000256   000100 101500                    MRL     fill='000'O
         1 000257   100002 600001                    ADSC9   2,,PR1                   cn=3,n=1
         1 000260   200045 000004                    ADSC9   KL_FEPST+8,,AUTO         cn=0,n=4
         1 000261   200045 236100                    LDQ     KL_FEPST+8,,AUTO
         1 000262   200044 116100                    CMPQ    KL_FEPST+7,,AUTO
         1 000263   000276 600000 1                  TZE     s:14230

      542    14222    5                 THEN DO;

      543    14223                           %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:86   

  14224  1 000264   200006 236100                    LDQ     LDCT$,,AUTO
         1 000265   000020 036003                    ADLQ    16,DU
         1 000266   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000267   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000270   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000271   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000272   000000 011000                    NOP     0

      544    14226    5                      TEMP = %K_REASON_BADGEN;

  14226  1 000273   000004 235007                    LDA     4,DL
         1 000274   200010 755100                    STA     TEMP,,AUTO

      545    14227    5                      GOTO SEND_NAK;

  14227  1 000275   000476 710000 1                  TRA     SEND_NAK

      546    14228    5                      END;
      547    14229
      548    14230    4                 LDCT$->NK$LDCT.LKFLG.QDPPATH = K$SQDP_INIT.QDP;

  14230  1 000276   003100 060500                    CSL     bolr='003'O
         1 000277   100000 420001                    BDSC    0,,PR1                   by=2,bit=2,n=1
         1 000300   000011 070001                    BDSC    9,,PR0                   by=0,bit=7,n=1

      549    14231    4                 LDCT$->NK$LDCT.RLCID = K$SQDP_INIT.RLCID; /*dont pack           */

  14231  1 000301   000100 100500                    MLR     fill='000'O
         1 000302   100001 000004                    ADSC9   1,,PR1                   cn=0,n=4
         1 000303   000015 000004                    ADSC9   13,,PR0                  cn=0,n=4

      550    14232    4                 LDCT$->NK$LDCT.TCTX# = K$RWPARM.TCTX#;

  14232  1 000304   200003 473500                    LDP3    @K$RWPARM,,AUTO
         1 000305   300033 220100                    LDX0    27,,PR3
         1 000306   000007 440100                    SXL0    7,,PR0
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:87   

      551    14233    4                 LDCT$->NK$LDCT.SYSID = K$SQDP_INIT.SYSID;

  14233  1 000307   000100 100500                    MLR     fill='000'O
         1 000310   100002 000002                    ADSC9   2,,PR1                   cn=0,n=2
         1 000311   000011 400002                    ADSC9   9,,PR0                   cn=2,n=2

      552    14234
      553    14235    5                 DO CASE(LDCT$->NK$LDCT.RESCOD);

  14235  1 000312   000006 721100                    LXL1    6,,PR0
         1 000313   000017 361003                    ANX1    15,DU
         1 000314   000014 101003                    CMPX1   12,DU
         1 000315   000317 602011 1                  TNC     s:14235+5,X1
         1 000316   000464 710000 1                  TRA     s:14279
         1 000317   000464 710000 1                  TRA     s:14279
         1 000320   000351 710000 1                  TRA     s:14247
         1 000321   000405 710000 1                  TRA     s:14257
         1 000322   000464 710000 1                  TRA     s:14279
         1 000323   000464 710000 1                  TRA     s:14279
         1 000324   000464 710000 1                  TRA     s:14279
         1 000325   000416 710000 1                  TRA     s:14262
         1 000326   000464 710000 1                  TRA     s:14279
         1 000327   000333 710000 1                  TRA     s:14237
         1 000330   000333 710000 1                  TRA     s:14237
         1 000331   000464 710000 1                  TRA     s:14279
         1 000332   000416 710000 1                  TRA     s:14262

      554    14236    5                  CASE(NK_CGFPRG,NK_TSFPRG);

      555    14237    5                    CALL KIA$FPCNCT(LDCT$->NK$LDCT)

  14237  1 000333   200006 630500                    EPPR0   LDCT$,,AUTO
         1 000334   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000335   000000 701000 xent               TSX1    KIA$FPCNCT
         1 000336   000340 702000 1                  TSX2    s:14240
         1 000337   000350 710000 1                  TRA     s:14244
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:88   

      556    14238    6                    WHENALTRETURN DO;

      557    14239                              %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

  14240  1 000340   200006 236100                    LDQ     LDCT$,,AUTO
         1 000341   000020 036003                    ADLQ    16,DU
         1 000342   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000343   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000344   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000345   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000346   000000 011000                    NOP     0

      558    14242    6                         GOTO DEFER_IO;

  14242  1 000347   000623 710000 1                  TRA     DEFER_IO

      559    14243    6                         END;
      560    14244    5                    RETURN;

  14244  1 000350   000000 702200 xent               TSX2  ! X66_ARET

      561    14245
      562    14246    5                  CASE(NK_TSTRM);

      563    14247    5                    CALL CONNECT_ACK ALTRET(DEFER_IO);

  14247  1 000351   000672 701000 1                  TSX1    CONNECT_ACK
         1 000352   000623 702000 1                  TSX2    DEFER_IO

      564    14248    5                    IF B$USRT$->B$USER.FLG(LDCT$->NK$LDCT.USER) & %U_SCIO

  14248  1 000353   200006 470500                    LDP0    LDCT$,,AUTO
         1 000354   000007 236100                    LDQ     7,,PR0
         1 000355   000016 772000                    QRL     14
         1 000356   017760 376007                    ANQ     8176,DL
         1 000357   000000 471400 xsym               LDP1    B$USRT$
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:89   
         1 000360   100000 236106                    LDQ     0,QL,PR1
         1 000361   000002 376000 0                  ANQ     2
         1 000362   000404 600000 1                  TZE     s:14254
         1 000363   000007 236100                    LDQ     7,,PR0
         1 000364   000016 772000                    QRL     14
         1 000365   017760 376007                    ANQ     8176,DL
         1 000366   100017 236106                    LDQ     15,QL,PR1
         1 000367   200006 116100                    CMPQ    LDCT$,,AUTO
         1 000370   000404 601000 1                  TNZ     s:14254

      565    14249    5                      AND B$USRT$->B$USER.MISC$(LDCT$->NK$LDCT.USER) = LDCT$
      566    14250    6                    THEN DO;

      567    14251    6                         CALL SSR$RUE(%SS_CIC,LDCT$->NK$LDCT.USER);

  14251  1 000371   200006 236100                    LDQ     LDCT$,,AUTO
         1 000372   000004 036000 2                  ADLQ    4
         1 000373   000005 235000 2                  LDA     5
         1 000374   200044 757100                    STAQ    KL_FEPST+7,,AUTO
         1 000375   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000376   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000377   000000 701000 xent               TSX1    SSR$RUE
         1 000400   000000 011000                    NOP     0

      568    14252    6                         LDCT$->NK$LDCT.LKFLG.REGGED = '0'B;

  14252  1 000401   200006 470500                    LDP0    LDCT$,,AUTO
         1 000402   000006 236000 2                  LDQ     6
         1 000403   000011 356100                    ANSQ    9,,PR0

      569    14253    6                         END;

      570    14254    5                    RETURN;

  14254  1 000404   000000 702200 xent               TSX2  ! X66_ARET

      571    14255
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:90   
      572    14256    5                  CASE(NK_CGTRM);

      573    14257    5                    CALL CONNECT_ACK ALTRET(DEFER_IO);

  14257  1 000405   000672 701000 1                  TSX1    CONNECT_ACK
         1 000406   000623 702000 1                  TSX2    DEFER_IO

      574    14258    5                    CALL KCO$TRMGO(LDCT$);

  14258  1 000407   200006 630500                    EPPR0   LDCT$,,AUTO
         1 000410   200044 450500                    STP0    KL_FEPST+7,,AUTO
         1 000411   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000412   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000413   000000 701000 xent               TSX1    KCO$TRMGO
         1 000414   000000 011000                    NOP     0

      575    14259    5                    RETURN;

  14259  1 000415   000000 702200 xent               TSX2  ! X66_ARET

      576    14260
      577    14261    5                  CASE(NK_NOCG,NK_RES);

      578    14262    5                    IF LDCT$->NK$LDCT.RESCOD = NK_RES

  14262  1 000416   000006 236100                    LDQ     6,,PR0
         1 000417   000017 376007                    ANQ     15,DL
         1 000420   000013 116007                    CMPQ    11,DL
         1 000421   000425 601000 1                  TNZ     s:14264

      579    14263    5                    THEN LDCT$->NK$LDCT.RAT$->FR$RAT.FLG.RUP = '1'B;

  14263  1 000422   000005 474500                    LDP4    5,,PR0
         1 000423   000004 236007                    LDQ     4,DL
         1 000424   400010 256100                    ORSQ    8,,PR4

      580    14264    5                    CALL CONNECT_ACK ALTRET(DEFER_IO);
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:91   

  14264  1 000425   000672 701000 1                  TSX1    CONNECT_ACK
         1 000426   000623 702000 1                  TSX2    DEFER_IO

      581    14265    5                    LDCT$->NK$LDCT.TERMID = K$SQDP_INIT.TERMINAL_ID;

  14265  1 000427   200004 470500                    LDP0    SHDR$,,AUTO
         1 000430   200006 471500                    LDP1    LDCT$,,AUTO
         1 000431   000100 100500                    MLR     fill='000'O
         1 000432   000007 000010                    ADSC9   7,,PR0                   cn=0,n=8
         1 000433   100022 000010                    ADSC9   18,,PR1                  cn=0,n=8

      582    14266                         %UNPACK_HW (SRC=LDCT$->NK$LDCT.TERMID.CHAN);

  14267  1 000434   100022 236100                    LDQ     18,,PR1
         1 000435   777777 376007                    ANQ     -1,DL
         1 000436   200010 756100                    STQ     TEMP,,AUTO

  14268  1 000437   000777 376007                    ANQ     511,DL
         1 000440   200010 036100                    ADLQ    TEMP,,AUTO
         1 000441   000001 772000                    QRL     1
         1 000442   000000 620006                    EAX0    0,QL
         1 000443   100022 440100                    SXL0    18,,PR1

      583    14270                         %UNPACK_HW (SRC=LDCT$->NK$LDCT.TERMID.SUB);

  14271  1 000444   100023 236100                    LDQ     19,,PR1
         1 000445   000022 772000                    QRL     18
         1 000446   200010 756100                    STQ     TEMP,,AUTO

  14272  1 000447   000777 376007                    ANQ     511,DL
         1 000450   200010 036100                    ADLQ    TEMP,,AUTO
         1 000451   000001 772000                    QRL     1
         1 000452   000000 621006                    EAX1    0,QL
         1 000453   100023 741100                    STX1    19,,PR1

      584    14274                         %UNPACK_HW (SRC=LDCT$->NK$LDCT.TERMID.SUBSUB);
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:92   

  14275  1 000454   100023 236100                    LDQ     19,,PR1
         1 000455   777777 376007                    ANQ     -1,DL
         1 000456   200010 756100                    STQ     TEMP,,AUTO

  14276  1 000457   000777 376007                    ANQ     511,DL
         1 000460   200010 036100                    ADLQ    TEMP,,AUTO
         1 000461   000001 772000                    QRL     1
         1 000462   000000 622006                    EAX2    0,QL
         1 000463   100023 442100                    SXL2    19,,PR1

      585    14278    5                    END/*do case(ldct.rescod)*/;

      586    14279    4                 RETURN;

  14279  1 000464   000000 702200 xent               TSX2  ! X66_ARET

      587    14280    4                 END/* do if ldct was specified*/;
      588    14281
      589    14282
      590    14283        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:93   
      591    14284
      592    14285        /* No LDCT, must be a logon request.
      593    14286        */
      594    14287    3            CALL NKL$GETDCT (LDCT$)

  14287  1 000465   200006 630500                    EPPR0   LDCT$,,AUTO
         1 000466   200044 450500                    STP0    KL_FEPST+7,,AUTO
         1 000467   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000470   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000471   000000 701000 xent               TSX1    NKL$GETDCT
         1 000472   000474 702000 1                  TSX2    s:14289
         1 000473   000511 710000 1                  TRA     s:14298

      595    14288    4            WHENALTRETURN DO;

      596    14289    4                 TEMP = %K_REASON_NOLDCT;

  14289  1 000474   000001 235007                    LDA     1,DL
         1 000475   200010 755100                    STA     TEMP,,AUTO

      597    14290    4   SEND_NAK:
      598    14291    4                 RLCID = K$SQDP_INIT.RLCID;

  14291  1 000476   200004 470500       SEND_NAK     LDP0    SHDR$,,AUTO
         1 000477   000100 100500                    MLR     fill='000'O
         1 000500   000001 000004                    ADSC9   1,,PR0                   cn=0,n=4
         1 000501   200017 000004                    ADSC9   RLCID,,AUTO              cn=0,n=4

      599    14292    4                 INIT_ACK_HDR.RLCID.LDCTX = 0;

  14292  1 000502   000000 220003                    LDX0    0,DU
         1 000503   200014 440100                    SXL0    INIT_ACK_HDR+1,,AUTO

      600    14293    4                 INIT_ACK_HDR.RLCID.GENERATION = 0;

  14293  1 000504   000000 236003                    LDQ     0,DU
         1 000505   200014 552120                    STBQ    INIT_ACK_HDR+1,'20'O,AUTO
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:94   

      601    14294    4                 CALL CONNECT_NAK ALTRET(DEFER_IO);

  14294  1 000506   000730 701000 1                  TSX1    CONNECT_NAK
         1 000507   000623 702000 1                  TSX2    DEFER_IO

      602    14295    4                 RETURN;

  14295  1 000510   000000 702200 xent               TSX2  ! X66_ARET

      603    14296    4                 END;
      604    14297
      605    14298    3            LDCT$->NK$LDCT.RESCOD = NK_LOGON;

  14298  1 000511   200006 470500                    LDP0    LDCT$,,AUTO
         1 000512   000006 236100                    LDQ     6,,PR0
         1 000513   000007 376000 2                  ANQ     7
         1 000514   000012 276007                    ORQ     10,DL
         1 000515   000006 756100                    STQ     6,,PR0

      606    14299    3            LDCT$->NK$LDCT.RLCID = K$SQDP_INIT.RLCID; /*dont pack*/

  14299  1 000516   200004 470500                    LDP0    SHDR$,,AUTO
         1 000517   200006 471500                    LDP1    LDCT$,,AUTO
         1 000520   000100 100500                    MLR     fill='000'O
         1 000521   000001 000004                    ADSC9   1,,PR0                   cn=0,n=4
         1 000522   100015 000004                    ADSC9   13,,PR1                  cn=0,n=4

      607    14300    3            LDCT$->NK$LDCT.LKFLG.QDPPATH = K$SQDP_INIT.QDP;

  14300  1 000523   003100 060500                    CSL     bolr='003'O
         1 000524   000000 420001                    BDSC    0,,PR0                   by=2,bit=2,n=1
         1 000525   100011 070001                    BDSC    9,,PR1                   by=0,bit=7,n=1

      608    14301    3            LDCT$->NK$LDCT.TCTX# = K$RWPARM.TCTX#;

  14301  1 000526   200003 473500                    LDP3    @K$RWPARM,,AUTO
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:95   
         1 000527   300033 220100                    LDX0    27,,PR3
         1 000530   100007 440100                    SXL0    7,,PR1

      609    14302
      610    14303    3            KL_SGN = '0'B;

  14303  1 000531   000100 100400                    MLR     fill='000'O
         1 000532   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000533   200020 000062                    ADSC9   KL_SGN,,AUTO             cn=0,n=50

      611    14304    3            KL_SGN.FCN = IGA_SGN;

  14304  1 000534   002000 236003                    LDQ     1024,DU
         1 000535   200020 552140                    STBQ    KL_SGN,'40'O,AUTO

      612    14305    3            KL_SGN.LOGON.LGNSIZ = K$RWPARM.UHDRSZ;

  14305  1 000536   300015 236100                    LDQ     13,,PR3
         1 000537   000022 736000                    QLS     18
         1 000540   200027 552120                    STBQ    KL_SGN+7,'20'O,AUTO

      613    14306    3            KL_SGN.LDCTX = LDCT$->NK$LDCT.LDCTX;

  14306  1 000541   000100 101500                    MRL     fill='000'O
         1 000542   100006 000002                    ADSC9   6,,PR1                   cn=0,n=2
         1 000543   200025 600004                    ADSC9   KL_SGN+5,,AUTO           cn=3,n=4

      614    14307    3            KL_SGN.NODE = LDCT$->NK$LDCT.RLCID.NODE;

  14307  1 000544   100015 236100                    LDQ     13,,PR1
         1 000545   000011 772000                    QRL     9
         1 000546   200020 552120                    STBQ    KL_SGN,'20'O,AUTO

      615    14308    3            KL_SGN.TERMINAL_ID = K$SQDP_INIT.TERMINAL_ID;

  14308  1 000547   000100 100500                    MLR     fill='000'O
         1 000550   000007 000020                    ADSC9   7,,PR0                   cn=0,n=16
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:96   
         1 000551   200021 000020                    ADSC9   KL_SGN+1,,AUTO           cn=0,n=16

      616    14309
      617    14310    3            K$RWPARM.UHDR$ = PINCRC(K$RWPARM.SHDR$,SIZEC(K$SQDP_INIT));

  14310  1 000552   300022 236100                    LDQ     18,,PR3
         1 000553   000014 036003                    ADLQ    12,DU
         1 000554   300014 756100                    STQ     12,,PR3

      618    14311    3            K$RWPARM.UHDRSZ = K$SQDP_INIT.DATA_HDR.LENGTH_UNPK.HIBYTE * 256 +

  14311  1 000555   003100 061500                    CSR     bolr='003'O
         1 000556   000013 610010                    BDSC    11,,PR0                  by=3,bit=1,n=8
         1 000557   200044 000044                    BDSC    KL_FEPST+7,,AUTO         by=0,bit=0,n=36
         1 000560   003100 061500                    CSR     bolr='003'O
         1 000561   000013 410010                    BDSC    11,,PR0                  by=2,bit=1,n=8
         1 000562   200045 000044                    BDSC    KL_FEPST+8,,AUTO         by=0,bit=0,n=36
         1 000563   200045 236100                    LDQ     KL_FEPST+8,,AUTO
         1 000564   000010 736000                    QLS     8
         1 000565   200044 036100                    ADLQ    KL_FEPST+7,,AUTO
         1 000566   300015 756100                    STQ     13,,PR3

      619    14312    3              K$SQDP_INIT.DATA_HDR.LENGTH_UNPK.LOBYTE;
      620    14313
      621    14314    3            TEMP = K$RWPARM.UHDRSZ;

  14314  1 000567   200010 756100                    STQ     TEMP,,AUTO

      622    14315    3            KL_SGN.LOGON.LGNTXT = K$RWPARM.UHDR$->DATAMSG;

  14315  1 000570   300014 474500                    LDP4    12,,PR3
         1 000571   000000 620006                    EAX0    0,QL
         1 000572   040100 100540                    MLR     fill='040'O
         1 000573   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0
         1 000574   200027 400024                    ADSC9   KL_SGN+7,,AUTO           cn=2,n=20

      623    14316
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:97   
      624    14317
      625    14318    3            IF K$SQDP_INIT.RESOURCE = 'NETMAN'

  14318  1 000575   040000 106500                    CMPC    fill='040'O
         1 000576   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         1 000577   000003 000006 0                  ADSC9   3                        cn=0,n=6
         1 000600   000610 601000 1                  TNZ     s:14325

      626    14319    4            THEN DO;

      627    14320    4                 KL_SGN.TERMINAL_ID.TTYP = %KLTY_FEP#;

  14320  1 000601   005000 236003                    LDQ     2560,DU
         1 000602   200021 552140                    STBQ    KL_SGN+1,'40'O,AUTO

      628    14321    4                 KL_SGN.LOGON.LGNSIZ = SIZEC(K$SQDP_INIT.NODE_NAME);

  14321  1 000603   000010 236003                    LDQ     8,DU
         1 000604   200027 552120                    STBQ    KL_SGN+7,'20'O,AUTO

      629    14322    4                 KL_SGN.LOGON.LGNTXT = K$SQDP_INIT.NODE_NAME;

  14322  1 000605   040100 100500                    MLR     fill='040'O
         1 000606   000003 000010                    ADSC9   3,,PR0                   cn=0,n=8
         1 000607   200027 400024                    ADSC9   KL_SGN+7,,AUTO           cn=2,n=20

      630    14323    4                 END;

      631    14324
      632    14325    3            CALL KUB$WRITE (KL_SGN,SIZEC(KL_SGN),'HLPADMIN')

  14325  1 000610   000001 236000 2                  LDQ     1
         1 000611   200046 756100                    STQ     KL_FEPST+9,,AUTO
         1 000612   000011 236000 2                  LDQ     9
         1 000613   200045 756100                    STQ     KL_FEPST+8,,AUTO
         1 000614   200020 634500                    EPPR4   KL_SGN,,AUTO
         1 000615   200044 454500                    STP4    KL_FEPST+7,,AUTO
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:98   
         1 000616   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000617   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000620   000000 701000 xent               TSX1    KUB$WRITE
         1 000621   000623 702000 1                  TSX2    DEFER_IO
         1 000622   000627 710000 1                  TRA     s:14332

      633    14326    4            WHENALTRETURN DO;

      634    14327    4   DEFER_IO:
      635    14328    4                 K$RWPARM.ERR = %K$DEFER_IO;

  14328  1 000623   000003 235007       DEFER_IO     LDA     3,DL
         1 000624   200003 470500                    LDP0    @K$RWPARM,,AUTO
         1 000625   000013 755100                    STA     11,,PR0

      636    14329    4                 ALTRETURN;

  14329  1 000626   000000 702200 xent               TSX2  ! X66_AALT

      637    14330    4                 END;
      638    14331
      639    14332    3            RETURN;

  14332  1 000627   000000 702200 xent               TSX2  ! X66_ARET

      640    14333
      641    14334        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:99   
      642    14335        /*F* NAME: KIS$RECV - Data Received - Initiate Acknowledgement
      643    14336
      644    14337        The LDCT is updated with information from the initiate acknowledgement
      645    14338        message.
      646    14339        */
      647    14340    3          CASE (%K_SQDP_INIT_ACK);         /* Initiate ack                       */

      648    14341
      649    14342                 %LOCK (G=LDCT$->NK$LDCT.LOCK);

  14343  1 000630   200006 236100                    LDQ     LDCT$,,AUTO
         1 000631   000020 036003                    ADLQ    16,DU
         1 000632   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000633   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000634   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000635   000000 701000 xent               TSX1    HFC$LOCK
         1 000636   000000 011000                    NOP     0

      650    14345    3            LDCT$->NK$LDCT.RLCID = K$SQDP_INIT.RLCID;

  14345  1 000637   200004 470500                    LDP0    SHDR$,,AUTO
         1 000640   200006 471500                    LDP1    LDCT$,,AUTO
         1 000641   000100 100500                    MLR     fill='000'O
         1 000642   000001 000004                    ADSC9   1,,PR0                   cn=0,n=4
         1 000643   100015 000004                    ADSC9   13,,PR1                  cn=0,n=4

      651    14346    3            LDCT$->NK$LDCT.TCTX# = K$RWPARM.TCTX#;

  14346  1 000644   200003 473500                    LDP3    @K$RWPARM,,AUTO
         1 000645   300033 220100                    LDX0    27,,PR3
         1 000646   100007 440100                    SXL0    7,,PR1

      652    14347    3            LDCT$->NK$LDCT.SYSID = K$SQDP_INIT.SYSID;

  14347  1 000647   000100 100500                    MLR     fill='000'O
         1 000650   000002 000002                    ADSC9   2,,PR0                   cn=0,n=2
         1 000651   100011 400002                    ADSC9   9,,PR1                   cn=2,n=2
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:100  

      653    14348
      654    14349                 %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

  14350  1 000652   200006 236100                    LDQ     LDCT$,,AUTO
         1 000653   000020 036003                    ADLQ    16,DU
         1 000654   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000655   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000656   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000657   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000660   000000 011000                    NOP     0

      655    14352
      656    14353    3            RETURN;

  14353  1 000661   000000 702200 xent               TSX2  ! X66_ARET

      657    14354
      658    14355        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:101  
      659    14356        /*F* NAME: KIS$RECV - Data Received - Terminate Request
      660    14357
      661    14358        KIA$TERM is called to terminate the connection for the endpoint
      662    14359        specified in the terminate message.
      663    14360        */
      664    14361    3          CASE (%K_SQDP_TERM);             /* Terminate                          */

      665    14362    3            CALL KIA$TERM(LDCT$->NK$LDCT) ALTRET(DEFER_IO);

  14362  1 000662   200006 630500                    EPPR0   LDCT$,,AUTO
         1 000663   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000664   000000 701000 xent               TSX1    KIA$TERM
         1 000665   000623 702000 1                  TSX2    DEFER_IO

      666    14363
      667    14364
      668    14365    3            END/*do case hdr_type*/;

  14365  1 000666   000671 710000 1                  TRA     s:14373

      669    14366        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:102  
      670    14367
      671    14368    2       CASE (ELSE);

      672    14369    2         CALL SC_BADFNC;

  14369  1 000667   000000 713400 xsym               CLIMB   SC_BADFNC
         1 000670   000000 600000 xsid               climb   nvectors=         0

      673    14370
      674    14371    2         END/*do case function*/;

      675    14372
      676    14373    1      RETURN;

  14373  1 000671   000000 702200 xent               TSX2  ! X66_ARET

      677    14374        %EJECT;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:103  
      678    14375    1   CONNECT_ACK: PROC ALTRET;

  14375  1 000672   200042 741300       CONNECT_ACK  STX1  ! KL_FEPST+5,,AUTO

      679    14376           %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

  14377  1 000673   200006 236100                    LDQ     LDCT$,,AUTO
         1 000674   000020 036003                    ADLQ    16,DU
         1 000675   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000676   200044 630500                    EPPR0   KL_FEPST+7,,AUTO
         1 000677   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000700   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000701   000000 011000                    NOP     0

      680    14379    2      RLCID = LDCT$->NK$LDCT.RLCID;

  14379  1 000702   200006 470500                    LDP0    LDCT$,,AUTO
         1 000703   000015 236100                    LDQ     13,,PR0
         1 000704   200017 756100                    STQ     RLCID,,AUTO

      681    14380    2      LDCTX = LDCT$->NK$LDCT.LDCTX;

  14380  1 000705   000006 236100                    LDQ     6,,PR0
         1 000706   000022 772000                    QRL     18
         1 000707   200005 756100                    STQ     LDCTX,,AUTO

      682    14381    2      INIT_ACK_HDR.RLCID.LDCTX = -MOD (LDCTX,256) + LDCTX + LDCTX;

  14381  1 000710   000377 376007                    ANQ     255,DL
         1 000711   200044 756100                    STQ     KL_FEPST+7,,AUTO
         1 000712   200005 236100                    LDQ     LDCTX,,AUTO
         1 000713   200044 136100                    SBLQ    KL_FEPST+7,,AUTO
         1 000714   200005 036100                    ADLQ    LDCTX,,AUTO
         1 000715   000000 620006                    EAX0    0,QL
         1 000716   200014 440100                    SXL0    INIT_ACK_HDR+1,,AUTO

      683    14382    2      INIT_ACK_HDR.RLCID.GENERATION = LDCT$->NK$LDCT.GENERATION;
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:104  

  14382  1 000717   000014 236100                    LDQ     12,,PR0
         1 000720   000377 376003                    ANQ     255,DU
         1 000721   200014 552120                    STBQ    INIT_ACK_HDR+1,'20'O,AUTO

      684    14383    2      INIT_ACK_HDR.RESCODE =LDCT$->NK$LDCT.RESCOD;

  14383  1 000722   000006 236100                    LDQ     6,,PR0
         1 000723   200015 676100                    ERQ     INIT_ACK_HDR+2,,AUTO
         1 000724   000017 376007                    ANQ     15,DL
         1 000725   200015 656100                    ERSQ    INIT_ACK_HDR+2,,AUTO

      685    14384    2      TEMP = %K_REASON_NORMAL;

  14384  1 000726   200010 450100                    STZ     TEMP,,AUTO
         1 000727   000731 710000 1                  TRA     s:14387

      686    14385
      687    14386    2   CONNECT_NAK: ENTRY ALTRET;

  14386  1 000730   200042 741300       CONNECT_NAK  STX1  ! KL_FEPST+5,,AUTO

      688    14387    2      K$RWPARM.SHDR$ = ADDR(INIT_ACK_HDR);

  14387  1 000731   200013 630500                    EPPR0   INIT_ACK_HDR,,AUTO
         1 000732   200003 471500                    LDP1    @K$RWPARM,,AUTO
         1 000733   100022 450500                    STP0    18,,PR1

      689    14388    2      K$RWPARM.SHDRSZ = SIZEC(INIT_ACK_HDR);

  14388  1 000734   000020 235007                    LDA     16,DL
         1 000735   100023 755100                    STA     19,,PR1

      690    14389
      691    14390    2      INIT_ACK_HDR.REASON_UNPK.LOBYTE = TEMP;

  14390  1 000736   200010 236100                    LDQ     TEMP,,AUTO
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:105  
         1 000737   000022 736000                    QLS     18
         1 000740   200015 676100                    ERQ     INIT_ACK_HDR+2,,AUTO
         1 000741   000377 376003                    ANQ     255,DU
         1 000742   200015 656100                    ERSQ    INIT_ACK_HDR+2,,AUTO

      692    14391    2      INIT_ACK_HDR.REASON_UNPK.HIBYTE = TEMPR.TOP;

  14391  1 000743   200010 236100                    LDQ     TEMP,,AUTO
         1 000744   000023 736000                    QLS     19
         1 000745   200015 676100                    ERQ     INIT_ACK_HDR+2,,AUTO
         1 000746   377000 376003                    ANQ     130560,DU
         1 000747   200015 656100                    ERSQ    INIT_ACK_HDR+2,,AUTO

      693    14392
      694    14393    2      INIT_ACK_HDR.CNTRL = '01'B;

  14393  1 000750   200013 236100                    LDQ     INIT_ACK_HDR,,AUTO
         1 000751   000012 376000 2                  ANQ     10
         1 000752   200000 276007                    ORQ     65536,DL
         1 000753   200013 756100                    STQ     INIT_ACK_HDR,,AUTO

      695    14394    2      INIT_ACK_HDR.TYPE = %K_SQDP_INIT_ACK;

  14394  1 000754   200013 236100                    LDQ     INIT_ACK_HDR,,AUTO
         1 000755   000013 376000 2                  ANQ     11
         1 000756   000002 276007                    ORQ     2,DL
         1 000757   200013 756100                    STQ     INIT_ACK_HDR,,AUTO

      696    14395
      697    14396    2      TEMP = K$RWPARM.UHDRSZ + K$RWPARM.MSGSZ;

  14396  1 000760   100015 236100                    LDQ     13,,PR1
         1 000761   100001 036100                    ADLQ    1,,PR1
         1 000762   200010 756100                    STQ     TEMP,,AUTO

      698    14397    2      INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.LOBYTE = TEMP;

PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:106  
  14397  1 000763   200016 676100                    ERQ     INIT_ACK_HDR+3,,AUTO
         1 000764   000377 376007                    ANQ     255,DL
         1 000765   200016 656100                    ERSQ    INIT_ACK_HDR+3,,AUTO

      699    14398    2      INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.HIBYTE = TEMPR.TOP;

  14398  1 000766   200010 236100                    LDQ     TEMP,,AUTO
         1 000767   000001 736000                    QLS     1
         1 000770   200016 676100                    ERQ     INIT_ACK_HDR+3,,AUTO
         1 000771   377000 376007                    ANQ     130560,DL
         1 000772   200016 656100                    ERSQ    INIT_ACK_HDR+3,,AUTO

      700    14399
      701    14400    2      INIT_ACK_HDR.RLCID.NODE = K_NODE#;

  14400  1 000773   000000 236000 xsym               LDQ     K_NODE#
         1 000774   000033 736000                    QLS     27
         1 000775   200014 552140                    STBQ    INIT_ACK_HDR+1,'40'O,AUTO

      702    14401    2      INIT_ACK_HDR.LDCT = RLCID.LDCTX;

  14401  1 000776   200017 720100                    LXL0    RLCID,,AUTO
         1 000777   200013 740100                    STX0    INIT_ACK_HDR,,AUTO

      703    14402
      704    14403    2      K$RWPARM.FEX = RLCID.NODE;

  14403  1 001000   200017 236100                    LDQ     RLCID,,AUTO
         1 001001   000033 772000                    QRL     27
         1 001002   100021 756100                    STQ     17,,PR1

      705    14404    2      K$RWPARM.FUNCTION = %K_WRITE;

  14404  1 001003   000001 235007                    LDA     1,DL
         1 001004   100020 755100                    STA     16,,PR1

      706    14405
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:107  
      707    14406    2      IF DATA_HDR.QDP

  14406  1 001005   200011 236100                    LDQ     DATA_HDR,,AUTO
         1 001006   100000 316007                    CANQ    32768,DL
         1 001007   001015 600000 1                  TZE     s:14408

      708    14407    2      THEN CALL KIN$SEND(K$RWPARM) ALTRET(L_ALTRTN);

  14407  1 001010   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         1 001011   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001012   000000 701000 xent               TSX1    KIN$SEND
         1 001013   001023 702000 1                  TSX2    L_ALTRTN
         1 001014   001021 710000 1                  TRA     s:14410

      709    14408    2      ELSE CALL KIT$SEND(K$RWPARM) ALTRET(L_ALTRTN);

  14408  1 001015   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         1 001016   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001017   000000 701000 xent               TSX1    KIT$SEND
         1 001020   001023 702000 1                  TSX2    L_ALTRTN

      710    14409
      711    14410    2      RETURN;

  14410  1 001021   200042 221300                    LDX1  ! KL_FEPST+5,,AUTO
         1 001022   000001 702211                    TSX2  ! 1,X1

      712    14411
      713    14412    2   L_ALTRTN:
      714    14413    2      ALTRETURN;

  14413  1 001023   200042 221300       L_ALTRTN     LDX1  ! KL_FEPST+5,,AUTO
         1 001024   000000 702211                    TSX2  ! 0,X1

(unnamed)
 Sect OctLoc
   0     000   110114 120101   104115 111116   000000 002000   116105 124115    HLPADMIN....NETM
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:108  
   0     004   101116 040040                                                    AN

(unnamed)
 Sect OctLoc
   2     000   000000 000016   000000 006000   000000 006000   000001 400000    ................
   2     004   000007 200000   000007 006000   677777 777777   777777 777760    ................
   2     010   000000 000064   000010 006000   777777 177777   777777 700000    ...4............
      715    14414
      716    14415    2   END CONNECT_ACK;
      717    14416
      718    14417    1   END KIS$RECV;
      719    14418        %EOD;

PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:109  
--  Include file information  --

   KI_MACROS_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_REASON_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   K_RLCID_M.:E05TOU  is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIS$RECV.
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:110  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @K$RWPARM                 11-0-0/c STRC(54)    r     1 DATA_HDR
     7-0-0/w UBIN        r     1 HDR_TYPE                  13-0-0/c STRC(144)   r     1 INIT_ACK_HDR
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                  35-0-0/w STRC(126)   r     1 KL_FEPST
    20-0-0/w STRC(450)   r     1 KL_SGN                     6-0-0/w PTR         r     1 LDCT$
     5-0-0/w UBIN        r     1 LDCTX                     17-0-0/w STRC        r     1 RLCID
     4-0-0/w PTR         r     1 SHDR$                     10-0-0/w UBIN        r     1 TEMP
    10-0-0/w STRC        r     1 TEMPR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/w PTR         r     1 KI_TCTX$$
     0-0-0/w UBIN        r     1 K_NODE#                    0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w UBIN        r     1 NK_CUR                     0-0-0/w UBIN        r     1 NK_MXLOCAL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/c ACHR        r     1 DATAMSG
     0-0-0/w STRC(324)   r     1 FR$RAT                     0-0-0/b UBIN(18)    r     1 HALFWORD
     0-0-0/c STRC(54)    r     1 K$SQDP_DATA                0-0-0/c STRC(432)   r     1 K$SQDP_INIT
     0-0-0/w STRC(1620)  r     1 KI$TCTX
     0-0-0/w PTR         r     1 KI$TCTX$(0:0)
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)

PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:111  

   Procedure KIS$RECV requires 533 words for executable code.
   Procedure KIS$RECV requires 40 words of local(AUTO) storage.
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:112  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:113  
          MINI XREF LISTING

B$DO.ECCINFO
       161**DCL       162--REDEF
B$U.MISC
       140**DCL       141--REDEF
B$USER.FLG
       186**DCL     14248>>IF
B$USER.MISC
       216**DCL       217--REDEF
B$USER.MISC$
       217**DCL     14248>>IF
B$USRT$
     14039**DCL     14248>>IF      14248>>IF
BAD_LDCTX
     14121**LABEL   14115--GOTO
CONNECT_ACK
     14375**PROC    14247--CALL    14257--CALL    14264--CALL
CONNECT_NAK IN PROCEDURE CONNECT_ACK
     14386**ENTRY   14294--CALL
DATAMSG
     12831**DCL     14315>>ASSIGN
DATA_HDR
     13452**DCL     14102<<ASSIGN
DATA_HDR.CNTRL
     13473**DCL     14137>>IF
DATA_HDR.LDCT_UNPK.HIBYTE
     13462**DCL     14104>>ASSIGN
DATA_HDR.LDCT_UNPK.LOBYTE
     13464**DCL     14104>>ASSIGN
DATA_HDR.LENGTH
     13516**DCL     13517--REDEF   13522--REDEF
DATA_HDR.LENGTH_UNPK.HIBYTE
     13519**DCL     14162>>ASSIGN
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:114  
DATA_HDR.LENGTH_UNPK.LOBYTE
     13521**DCL     14162>>ASSIGN
DATA_HDR.NK$LDCT
     13459**DCL     13460--REDEF   13465--REDEF
DATA_HDR.QDP
     13478**DCL     14406>>IF
DATA_HDR.TYPE
     13486**DCL     13487--REDEF   13491--REDEF
DATA_HDR.TYPE_UNPK.HIBYTE
     13488**DCL     14165>>ASSIGN  14178>>ASSIGN
DATA_HDR.TYPE_UNPK.LOBYTE
     13490**DCL     14165>>ASSIGN  14178>>ASSIGN
DEFER_IO
     14328**LABEL   14185--GOTO    14242--GOTO    14247--CALLALT 14257--CALLALT 14264--CALLALT 14294--CALLALT
     14362--CALLALT
FR$RAT.FLG.RUP
     12288**DCL     14263<<ASSIGN
HALFWORD
     13403**DCL     14267>>ASSIGN  14268<<ASSIGN  14271>>ASSIGN  14272<<ASSIGN  14275>>ASSIGN  14276<<ASSIGN
HDR_TYPE
     13396**DCL     14178<<ASSIGN  14181>>IF      14187>>DOCASE
HFC$LOCK
      6341**DCL-ENT 14219--CALL    14343--CALL
HFC$UNLOCK
      6341**DCL-ENT 14224--CALL    14240--CALL    14350--CALL    14377--CALL
INIT_ACK_HDR
     13580**DCL     14387--ASSIGN  14388--ASSIGN
INIT_ACK_HDR.CNTRL
     13601**DCL     14393<<ASSIGN
INIT_ACK_HDR.DATA_HDR.LENGTH
     13801**DCL     13802--REDEF   13807--REDEF
INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.HIBYTE
     13804**DCL     14398<<ASSIGN
INIT_ACK_HDR.DATA_HDR.LENGTH_UNPK.LOBYTE
     13806**DCL     14397<<ASSIGN
INIT_ACK_HDR.DATA_HDR.TYPE
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:115  
     13785**DCL     13786--REDEF   13791--REDEF
INIT_ACK_HDR.NK$LDCT
     13587**DCL     13588--REDEF   13593--REDEF   14401<<ASSIGN
INIT_ACK_HDR.REASON
     13724**DCL     13725--REDEF   13730--REDEF
INIT_ACK_HDR.REASON_UNPK.HIBYTE
     13727**DCL     14391<<ASSIGN
INIT_ACK_HDR.REASON_UNPK.LOBYTE
     13729**DCL     14390<<ASSIGN
INIT_ACK_HDR.RESCODE
     13747**DCL     14383<<ASSIGN
INIT_ACK_HDR.RLCID.GENERATION
     13673**DCL     14293<<ASSIGN  14382<<ASSIGN
INIT_ACK_HDR.RLCID.LDCTX
     13690**DCL     13691--REDEF   13696--REDEF   14292<<ASSIGN  14381<<ASSIGN
INIT_ACK_HDR.RLCID.NODE
     13668**DCL     14400<<ASSIGN
INIT_ACK_HDR.TYPE
     13614**DCL     13615--REDEF   13619--REDEF   14394<<ASSIGN
K$RWPARM
     11939**DCL         6--PROC    14068<>CALL    14074<>CALL    14169<>CALL    14407<>CALL    14408<>CALL
K$RWPARM.BLKREC
     11965**DCL     11990--REDEF
K$RWPARM.BLKREC.BLKU#
     11966**DCL     11968--REDEF
K$RWPARM.BLKREC.RECU#
     11978**DCL     11980--REDEF
K$RWPARM.DVE.DVBYTE.VFC
     12005**DCL     12006--REDEF
K$RWPARM.DVE.EOMCHAR
     12013**DCL     12017--REDEF
K$RWPARM.ERR
     12077**DCL     12082--REDEF   14124<<ASSIGN  14328<<ASSIGN
K$RWPARM.FC
     12041**DCL     12042--REDEF
K$RWPARM.FEX
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:116  
     12123**DCL     14403<<ASSIGN
K$RWPARM.FLDID
     12223**DCL     12224--REDEF
K$RWPARM.FPT$
     12104**DCL     12111--REDEF
K$RWPARM.FUNCTION
     12118**DCL     14063>>IF      14066>>IF      14072>>IF      14078>>DOCASE  14404<<ASSIGN
K$RWPARM.KEYTYPE
     12230**DCL     12231--REDEF
K$RWPARM.LDCT$
     12100**DCL     14135<<ASSIGN
K$RWPARM.MSG$
     11940**DCL     11946--REDEF
K$RWPARM.MSGID
     12052**DCL     12057--REDEF
K$RWPARM.MSGIDXT
     12065**DCL     12069--REDEF
K$RWPARM.MSGSZ
     11947**DCL     14396>>ASSIGN
K$RWPARM.ORG
     12201**DCL     12202--REDEF
K$RWPARM.RECTYPE
     12163**DCL     14165<<ASSIGN
K$RWPARM.SHDR$
     12133**DCL     12747--IMP-PTR 14101>>ASSIGN  14160>>ASSIGN  14310>>ASSIGN  14387<<ASSIGN
K$RWPARM.SHDRSZ
     12137**DCL     14388<<ASSIGN
K$RWPARM.TCTX#
     12175**DCL     14129>>ASSIGN  14232>>ASSIGN  14301>>ASSIGN  14346>>ASSIGN
K$RWPARM.THDR$
     12141**DCL     14122>>IF
K$RWPARM.THDRSZ
     12145**DCL     12149--REDEF
K$RWPARM.UHDR$
     12090**DCL     14160<<ASSIGN  14310<<ASSIGN  14315>>ASSIGN
K$RWPARM.UHDRSZ
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:117  
     12095**DCL     14162<<ASSIGN  14305>>ASSIGN  14311<<ASSIGN  14314>>ASSIGN  14396>>ASSIGN
K$RWPARM.VDOFLGS
     12203**DCL     12214--REDEF
K$SQDP_DATA
     12747**DCL     14102>>ASSIGN  14160--ASSIGN
K$SQDP_DATA.LENGTH
     12811**DCL     12812--REDEF   12817--REDEF
K$SQDP_DATA.NK$LDCT
     12754**DCL     12755--REDEF   12760--REDEF
K$SQDP_DATA.TYPE
     12781**DCL     12782--REDEF   12786--REDEF
K$SQDP_INIT
     12383**DCL     14310--ASSIGN
K$SQDP_INIT.DATA_HDR.LENGTH
     12670**DCL     12671--REDEF   12676--REDEF
K$SQDP_INIT.DATA_HDR.LENGTH_UNPK.HIBYTE
     12673**DCL     14311>>ASSIGN
K$SQDP_INIT.DATA_HDR.LENGTH_UNPK.LOBYTE
     12675**DCL     14311>>ASSIGN
K$SQDP_INIT.DATA_HDR.TYPE
     12654**DCL     12655--REDEF   12660--REDEF
K$SQDP_INIT.DEST_GENERATION
     12564**DCL     14221>>IF
K$SQDP_INIT.NK$LDCT
     12390**DCL     12391--REDEF   12396--REDEF
K$SQDP_INIT.NODE_NAME
     12570**DCL     14321--ASSIGN  14322>>ASSIGN
K$SQDP_INIT.QDP
     12409**DCL     14230>>ASSIGN  14300>>ASSIGN
K$SQDP_INIT.RESOURCE
     12579**DCL     14318>>IF
K$SQDP_INIT.RLCID
     12469**DCL     14231>>ASSIGN  14291>>ASSIGN  14299>>ASSIGN  14345>>ASSIGN
K$SQDP_INIT.RLCID.LDCTX
     12493**DCL     12494--REDEF   12499--REDEF
K$SQDP_INIT.SYSID
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:118  
     12538**DCL     12539--REDEF   12544--REDEF   14233>>ASSIGN  14347>>ASSIGN
K$SQDP_INIT.TERMINAL_ID
     12605**DCL     14265>>ASSIGN  14308>>ASSIGN
K$SQDP_INIT.TERMINAL_ID.TERM
     12607**DCL     12616--REDEF
K$SQDP_INIT.TYPE
     12417**DCL     12418--REDEF   12422--REDEF
KCO$TRMGO
     12237**DCL-ENT 14258--CALL
KI$TCTX.NODE
     12841**DCL     14129>>ASSIGN
KI$TCTX.SSN.DST_NSAP.ADDRESS_N
     13290**DCL     13291--REDEF
KI$TCTX.SSN.SRC_NSAP.ADDRESS_N
     13230**DCL     13231--REDEF
KI$TCTX.SSN.TPDUSIZE
     12993**DCL     12994--REDEF
KI$TCTX$
     12832**DCL     14129>>ASSIGN
KIA$FPCNCT
     12238**DCL-ENT 14237--CALL
KIA$ISCAN
     12239**DCL-ENT 14169--CALL
KIA$TERM
     12240**DCL-ENT 14362--CALL
KIN$SEND
     12241**DCL-ENT 14407--CALL
KIS$REP_TERM
     12243**DCL-ENT 14074--CALL
KIS$UNQUEUE
     12244**DCL-ENT 14068--CALL
KIT$SEND
     12242**DCL-ENT 14408--CALL
KI_TCTX$$
     14040**DCL     12832--IMP-PTR 14129>>ASSIGN
KL_FEPST
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:119  
     14014**DCL     14127<<ASSIGN  14130<>CALL    14130--CALL
KL_FEPST.FCN
     14015**DCL     14128<<ASSIGN
KL_FEPST.FEP
     14017**DCL     14129<<ASSIGN
KL_SGN
     13922**DCL     14303<<ASSIGN  14325<>CALL    14325--CALL
KL_SGN.FCN
     13923**DCL     14304<<ASSIGN
KL_SGN.LDCTX
     13984**DCL     14306<<ASSIGN
KL_SGN.LOGON.LGNSIZ
     13997**DCL     14305<<ASSIGN  14321<<ASSIGN
KL_SGN.LOGON.LGNTXT
     13998**DCL     14315<<ASSIGN  14322<<ASSIGN
KL_SGN.NMID
     13981**DCL     13984--REDEF
KL_SGN.NODE
     13926**DCL     14307<<ASSIGN
KL_SGN.TERMINAL_ID
     13947**DCL     14308<<ASSIGN
KL_SGN.TERMINAL_ID.TERM
     13949**DCL     13958--REDEF
KL_SGN.TERMINAL_ID.TTYP
     13949**DCL     14320<<ASSIGN
KUB$WRITE
     12245**DCL-ENT 14130--CALL    14325--CALL
K_NODE#
     14038**DCL     14400>>ASSIGN
LDCT$
     13395**DCL     14111<<ASSIGN  14117<<ASSIGN  14118>>IF      14135>>ASSIGN  14154>>IF      14168>>IF
     14169>>CALL    14184>>IF      14184>>IF      14212>>IF      14219>>CALL    14221>>IF      14224>>CALL
     14230>>ASSIGN  14231>>ASSIGN  14232>>ASSIGN  14233>>ASSIGN  14235>>DOCASE  14237>>CALL    14240>>CALL
     14248>>IF      14248>>IF      14248>>IF      14251>>CALL    14252>>ASSIGN  14258<>CALL    14262>>IF
     14263>>ASSIGN  14265>>ASSIGN  14267>>ASSIGN  14268>>ASSIGN  14271>>ASSIGN  14272>>ASSIGN  14275>>ASSIGN
     14276>>ASSIGN  14287<>CALL    14298>>ASSIGN  14299>>ASSIGN  14300>>ASSIGN  14301>>ASSIGN  14306>>ASSIGN
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:120  
     14307>>ASSIGN  14343>>CALL    14345>>ASSIGN  14346>>ASSIGN  14347>>ASSIGN  14350>>CALL    14362>>CALL
     14377>>CALL    14379>>ASSIGN  14380>>ASSIGN  14382>>ASSIGN  14383>>ASSIGN
LDCTX
     13394**DCL     14104<<ASSIGN  14110>>IF      14114>>IF      14114>>IF      14117>>ASSIGN  14210>>IF
     14380<<ASSIGN  14381>>ASSIGN  14381>>ASSIGN  14381>>ASSIGN
L_ALTRTN IN PROCEDURE CONNECT_ACK
     14413**LABEL   14407--CALLALT 14408--CALLALT
N$DCT$$
       368**DCL       368--IMP-PTR 14117>>ASSIGN
NK$LDCT
     12305**DCL     14169<>CALL    14237<>CALL    14362<>CALL
NK$LDCT.DDT$
     12307**DCL     12307--REDEF
NK$LDCT.DFLG.FEDN
     12313**DCL     14168>>IF
NK$LDCT.GENERATION
     12328**DCL     14221>>IF      14382>>ASSIGN
NK$LDCT.IOQ$
     12306**DCL     12307--REDEF
NK$LDCT.IP$
     12327**DCL     14184>>IF
NK$LDCT.LDCTX
     12308**DCL     12308--REDEF   14306>>ASSIGN  14380>>ASSIGN
NK$LDCT.LKFLG.ABORTED
     12320**DCL     12321--REDEF
NK$LDCT.LKFLG.QDPPATH
     12322**DCL     14230<<ASSIGN  14300<<ASSIGN
NK$LDCT.LKFLG.REGGED
     12321**DCL     14252<<ASSIGN
NK$LDCT.LOCK
     12333**DCL     14219<>CALL    14224<>CALL    14240<>CALL    14343<>CALL    14350<>CALL    14377<>CALL
NK$LDCT.RAT$
     12308**DCL     14263>>ASSIGN
NK$LDCT.RESCOD
     12313**DCL     14235>>DOCASE  14262>>IF      14298<<ASSIGN  14383>>ASSIGN
NK$LDCT.RLCID
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:121  
     12329**DCL     14231<<ASSIGN  14299<<ASSIGN  14345<<ASSIGN  14379>>ASSIGN
NK$LDCT.RLCID.LDCTX
     12330**DCL     12330--REDEF
NK$LDCT.RLCID.NODE
     12329**DCL     14307>>ASSIGN
NK$LDCT.STA$
     12326**DCL     12327--REDEF
NK$LDCT.SYMB$
     12305**DCL     12305--REDEF   12305--REDEF   12306--REDEF
NK$LDCT.SYSID
     12326**DCL     14233<<ASSIGN  14347<<ASSIGN
NK$LDCT.TCTX#
     12315**DCL     14232<<ASSIGN  14301<<ASSIGN  14346<<ASSIGN
NK$LDCT.TERMID
     12333**DCL     14265<<ASSIGN
NK$LDCT.TERMID.CHAN
     12334**DCL     14267--ASSIGN  14268--ASSIGN
NK$LDCT.TERMID.SUB
     12334**DCL     14271--ASSIGN  14272--ASSIGN
NK$LDCT.TERMID.SUBSUB
     12334**DCL     14275--ASSIGN  14276--ASSIGN
NK$LDCT.USER
     12315**DCL     14248>>IF      14248>>IF      14251<>CALL
NK$LDCT$
       368**DCL     14117>>ASSIGN
NKL$GETDCT
     12246**DCL-ENT 14287--CALL
NK_CUR
       369**DCL     14114>>IF
NK_MXLOCAL
       368**DCL     14114>>IF
RECV_CNTRL
     14168**LABEL   14138--GOTO
RECV_DATA
     14101**LABEL   14064--GOTO
RLCID
PL6.E3A0      #002=KIS$RECV File=KIS$SESSION.:E05TSI                             WED 07/30/97 00:42 Page:122  
     13852**DCL     14291<<ASSIGN  14379<<ASSIGN
RLCID.LDCTX
     13878**DCL     13879--REDEF   13884--REDEF   14401>>ASSIGN
RLCID.NODE
     13856**DCL     14403>>ASSIGN
SC_BADFNC
     12248**DCL-ENT 14182--CALL    14369--CALL
SC_BADLDCTX
     12249**DCL-ENT 14121--CALL
SEND_NAK
     14291**LABEL   14215--GOTO    14227--GOTO
SHDR$
     13393**DCL     12383--IMP-PTR 14101<<ASSIGN  14102>>ASSIGN  14221>>IF      14230>>ASSIGN  14231>>ASSIGN
     14233>>ASSIGN  14265>>ASSIGN  14291>>ASSIGN  14299>>ASSIGN  14300>>ASSIGN  14308>>ASSIGN  14311>>ASSIGN
     14311>>ASSIGN  14318>>IF      14322>>ASSIGN  14345>>ASSIGN  14347>>ASSIGN
SSR$RUE
     12247**DCL-ENT 14251--CALL
TEMP
     13398**DCL     12831--IMP-SIZ 13399--REDEF   14214<<ASSIGN  14226<<ASSIGN  14267<<ASSIGN  14268>>ASSIGN
     14268>>ASSIGN  14271<<ASSIGN  14272>>ASSIGN  14272>>ASSIGN  14275<<ASSIGN  14276>>ASSIGN  14276>>ASSIGN
     14289<<ASSIGN  14314<<ASSIGN  14315>>ASSIGN  14384<<ASSIGN  14390>>ASSIGN  14396<<ASSIGN  14397>>ASSIGN
TEMPR.TOP
     13400**DCL     14391>>ASSIGN  14398>>ASSIGN

PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:123  
      720        1        /*T***********************************************************/
      721        2        /*T*                                                         */
      722        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      723        4        /*T*                                                         */
      724        5        /*T***********************************************************/
      725        6        KIS$REP_DISC: PROC(NODE);
      726        7
      727        8                                                /* Include files                      */
      728        9        %INCLUDE B$USER;
      729      225        %INCLUDE NK$LDCT;
      730      327        %INCLUDE NK_LDCT_R;
      731      336        %INCLUDE SS_SCHED_C;
      732      569
      733      570                                                /* Parameter definitions              */
      734      571    1   DCL NODE UBIN;
      735      572
      736      573                                                /* Entry point references             */
      737      574    1   DCL KIA$TERM ENTRY(1) ALTRET;
      738      575    1   DCL SSR$RUE ENTRY(4);
      739      576
      740      577                                                /* Based items                        */
      741      578        %NK$LDCT (NAME=NK$LDCT);
      742      624
      743      625    1   DCL LDCTX UBIN;
      744      626    1   DCL LDCT$ PTR;
      745      627
      746      628    1   DCL I UBIN;
      747      629    1   DCL 1 IUSER REDEF I,
      748      630    1         2 * BIT(27) UNAL,
      749      631    1         2 USER UBIN BYTE UNAL;
      750      632
      751      633                                                /* SYMREFs                            */
      752      634    1   DCL B$USRT$ PTR SYMREF;
      753      635    1   DCL B_MUAIS UBIN SYMREF;
      754      636
      755      637        %EJECT;
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:124  
      756      638        /*F* NAME: KIS$REP_DISC - Report Disconnect
      757      639
      758      640        KIS$REP_DISC is called from KIN$NODECHG to disconnect all QDP session
      759      641        connects when a local fep has disconnected.
      760      642        The parameter NODE contains the node number of the local fep.
      761      643
      762      644        KIS$REP_DISC is also called from KIT$REPDISC to disconnect remote CP-6
      763      645        session connections when a remote fep, or the local fep supporting the
      764      646        transport connection, has disconnected.
      765      647        The parameter NODE contains the node number of the remote-fep.
      766      648
      767      649        We run through the LDCTs looking for those that have RLCID.NODE
      768      650        equal to that specified in NODE.
      769      651        The DFLAG.FEDN bit is set in the LDCT and KIA$TERM is called.
      770      652
      771      653        We then run through the user table looking for users with SCIO
      772      654        set and RLCID.NODE in the LDCT addressed by MISC$ equal to that
      773      655        specified in NODE.
      774      656        For each user in this state we report an SS_FC event.
      775      657
      776      658        Finally we report an SS_CBA event and return.
      777      659        */
      778      660
      779      661    2      DO LDCTX = NK_MXLOCAL+1 TO NK_CUR;
      780      662    2           LDCT$ = NK$LDCT$(LDCTX);
      781      663    2           IF LDCT$ ~= ADDR(NIL)
      782      664    2             AND LDCT$->NK$LDCT.RLCID.NODE = NODE
      783      665    2             AND NOT LDCT$->NK$LDCT.DFLG.LOCAL
      784      666    3           THEN DO;
      785      667    3                LDCT$->NK$LDCT.DFLG.FEDN = '1'B;
      786      668    3                CALL KIA$TERM (LDCT$->NK$LDCT);
      787      669    3                END;
      788      670    2           END;
      789      671
      790      672    2      DO I = 1 TO B_MUAIS;
      791      673    2           IF B$USRT$->B$USER.FLG(I) & %U_SCIO
      792      674    2             AND B$USRT$->B$USER.MISC$(I)->NK$LDCT.RLCID.NODE = NODE
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:125  
      793      675    2           THEN CALL SSR$RUE(%SS_FC,IUSER.USER);
      794      676    2           END;
      795      677    1      CALL SSR$RUE(%SS_CBA);
      796      678
      797      679    1      RETURN;
      798      680
      799      681    1   END KIS$REP_DISC;
      800      682        %EOD;

PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:126  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIS$REP_DISC.

   Procedure KIS$REP_DISC requires 68 words for executable code.
   Procedure KIS$REP_DISC requires 12 words of local(AUTO) storage.

PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:127  

 Object Unit name= KIS$REP_DISC                               File name= KIS$SESSION.:E05TOU
 UTS= JUL 30 '97 00:43:15.04 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  KIS$REP_DISC
    1   Proc  even  none    68    104  KIS$REP_DISC
    2  RoData even  none     5      5  KIS$REP_DISC

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KIS$REP_DISC

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KIA$TERM
         yes           Std       4 SSR$RUE
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               NK_MXLOCAL                            NK_CUR
     B$USRT$                               B_MUAIS                               B_VECTNIL
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:128  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:129  


      720        1        /*T***********************************************************/
      721        2        /*T*                                                         */
      722        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      723        4        /*T*                                                         */
      724        5        /*T***********************************************************/
      725        6        KIS$REP_DISC: PROC(NODE);

      6  1 000000   000000 700200 xent  KIS$REP_DISC TSX0  ! X66_AUTO_1
         1 000001   000014 000001                    ZERO    12,1

      726        7
      727        8                                                /* Include files                      */
      728        9        %INCLUDE B$USER;
      729      225        %INCLUDE NK$LDCT;
      730      327        %INCLUDE NK_LDCT_R;
      731      336        %INCLUDE SS_SCHED_C;
      732      569
      733      570                                                /* Parameter definitions              */
      734      571    1   DCL NODE UBIN;
      735      572
      736      573                                                /* Entry point references             */
      737      574    1   DCL KIA$TERM ENTRY(1) ALTRET;
      738      575    1   DCL SSR$RUE ENTRY(4);
      739      576
      740      577                                                /* Based items                        */
      741      578        %NK$LDCT (NAME=NK$LDCT);
      742      624
      743      625    1   DCL LDCTX UBIN;
      744      626    1   DCL LDCT$ PTR;
      745      627
      746      628    1   DCL I UBIN;
      747      629    1   DCL 1 IUSER REDEF I,
      748      630    1         2 * BIT(27) UNAL,
      749      631    1         2 USER UBIN BYTE UNAL;
      750      632
      751      633                                                /* SYMREFs                            */
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:130  
      752      634    1   DCL B$USRT$ PTR SYMREF;
      753      635    1   DCL B_MUAIS UBIN SYMREF;
      754      636
      755      637        %EJECT;
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:131  
      756      638        /*F* NAME: KIS$REP_DISC - Report Disconnect
      757      639
      758      640        KIS$REP_DISC is called from KIN$NODECHG to disconnect all QDP session
      759      641        connects when a local fep has disconnected.
      760      642        The parameter NODE contains the node number of the local fep.
      761      643
      762      644        KIS$REP_DISC is also called from KIT$REPDISC to disconnect remote CP-6
      763      645        session connections when a remote fep, or the local fep supporting the
      764      646        transport connection, has disconnected.
      765      647        The parameter NODE contains the node number of the remote-fep.
      766      648
      767      649        We run through the LDCTs looking for those that have RLCID.NODE
      768      650        equal to that specified in NODE.
      769      651        The DFLAG.FEDN bit is set in the LDCT and KIA$TERM is called.
      770      652
      771      653        We then run through the user table looking for users with SCIO
      772      654        set and RLCID.NODE in the LDCT addressed by MISC$ equal to that
      773      655        specified in NODE.
      774      656        For each user in this state we report an SS_FC event.
      775      657
      776      658        Finally we report an SS_CBA event and return.
      777      659        */
      778      660
      779      661    2      DO LDCTX = NK_MXLOCAL+1 TO NK_CUR;

    661  1 000002   000000 235000 xsym               LDA     NK_MXLOCAL
         1 000003   000001 035007                    ADLA    1,DL
         1 000004   200004 755100                    STA     LDCTX,,AUTO
         1 000005   000036 710000 1                  TRA     s:670+3

      780      662    2           LDCT$ = NK$LDCT$(LDCTX);

    662  1 000006   000000 470400 xsym               LDP0    N$DCT$$
         1 000007   200004 720100                    LXL0    LDCTX,,AUTO
         1 000010   000000 236110                    LDQ     0,X0,PR0
         1 000011   200005 756100                    STQ     LDCT$,,AUTO

PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:132  
      781      663    2           IF LDCT$ ~= ADDR(NIL)

    663  1 000012   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000013   000033 600000 1                  TZE     s:670
         1 000014   200003 471500                    LDP1    @NODE,,AUTO
         1 000015   200005 473500                    LDP3    LDCT$,,AUTO
         1 000016   300015 236100                    LDQ     13,,PR3
         1 000017   000033 772000                    QRL     27
         1 000020   100000 116100                    CMPQ    0,,PR1
         1 000021   000033 601000 1                  TNZ     s:670
         1 000022   300006 236100                    LDQ     6,,PR3
         1 000023   002000 316007                    CANQ    1024,DL
         1 000024   000033 601000 1                  TNZ     s:670

      782      664    2             AND LDCT$->NK$LDCT.RLCID.NODE = NODE
      783      665    2             AND NOT LDCT$->NK$LDCT.DFLG.LOCAL
      784      666    3           THEN DO;

      785      667    3                LDCT$->NK$LDCT.DFLG.FEDN = '1'B;

    667  1 000025   000020 236007                    LDQ     16,DL
         1 000026   300006 256100                    ORSQ    6,,PR3

      786      668    3                CALL KIA$TERM (LDCT$->NK$LDCT);

    668  1 000027   200005 630500                    EPPR0   LDCT$,,AUTO
         1 000030   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000031   000000 701000 xent               TSX1    KIA$TERM
         1 000032   000000 011000                    NOP     0

      787      669    3                END;

      788      670    2           END;

    670  1 000033   200004 235100                    LDA     LDCTX,,AUTO
         1 000034   000001 035007                    ADLA    1,DL
         1 000035   200004 755100                    STA     LDCTX,,AUTO
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:133  
         1 000036   000000 236000 xsym               LDQ     NK_CUR
         1 000037   200004 116100                    CMPQ    LDCTX,,AUTO
         1 000040   000006 603000 1                  TRC     s:662

      789      671
      790      672    2      DO I = 1 TO B_MUAIS;

    672  1 000041   000001 235007                    LDA     1,DL
         1 000042   200006 755100                    STA     I,,AUTO
         1 000043   000074 710000 1                  TRA     s:676+3

      791      673    2           IF B$USRT$->B$USER.FLG(I) & %U_SCIO

    673  1 000044   200006 235100                    LDA     I,,AUTO
         1 000045   000004 735000                    ALS     4
         1 000046   000000 470400 xsym               LDP0    B$USRT$
         1 000047   000000 236105                    LDQ     0,AL,PR0
         1 000050   000000 376000 0                  ANQ     0
         1 000051   000071 600000 1                  TZE     s:676
         1 000052   000017 471505                    LDP1    15,AL,PR0
         1 000053   200003 473500                    LDP3    @NODE,,AUTO
         1 000054   100015 236100                    LDQ     13,,PR1
         1 000055   000033 772000                    QRL     27
         1 000056   300000 116100                    CMPQ    0,,PR3
         1 000057   000071 601000 1                  TNZ     s:676

      792      674    2             AND B$USRT$->B$USER.MISC$(I)->NK$LDCT.RLCID.NODE = NODE
      793      675    2           THEN CALL SSR$RUE(%SS_FC,IUSER.USER);

    675  1 000060   200012 452500                    STP2    I+4,,AUTO
         1 000061   200012 236100                    LDQ     I+4,,AUTO
         1 000062   000001 036000 2                  ADLQ    1
         1 000063   000002 235000 2                  LDA     2
         1 000064   200010 757100                    STAQ    I+2,,AUTO
         1 000065   200010 630500                    EPPR0   I+2,,AUTO
         1 000066   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000067   000000 701000 xent               TSX1    SSR$RUE
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:134  
         1 000070   000000 011000                    NOP     0

      794      676    2           END;

    676  1 000071   200006 235100                    LDA     I,,AUTO
         1 000072   000001 035007                    ADLA    1,DL
         1 000073   200006 755100                    STA     I,,AUTO
         1 000074   000000 236000 xsym               LDQ     B_MUAIS
         1 000075   200006 116100                    CMPQ    I,,AUTO
         1 000076   000044 603000 1                  TRC     s:673

      795      677    1      CALL SSR$RUE(%SS_CBA);

    677  1 000077   000004 630400 2                  EPPR0   4
         1 000100   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000101   000000 701000 xent               TSX1    SSR$RUE
         1 000102   000000 011000                    NOP     0

      796      678
      797      679    1      RETURN;

    679  1 000103   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   0     000   000000 002000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000000 000050   000006 600000   000000 006000   000000 000077    ...(...........?
   2     004   000003 006000                                                    ....
      798      680
      799      681    1   END KIS$REP_DISC;
      800      682        %EOD;

PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:135  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIS$REP_DISC.
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:136  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NODE                      6-0-0/w UBIN        r     1 I
     6-0-0/w STRC        r     1 IUSER                      5-0-0/w PTR         r     1 LDCT$
     4-0-0/w UBIN        r     1 LDCTX                     *0-0-0/w UBIN        r     1 NODE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/w UBIN        r     1 B_MUAIS
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w UBIN        r     1 NK_CUR
     0-0-0/w UBIN        r     1 NK_MXLOCAL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)


   Procedure KIS$REP_DISC requires 68 words for executable code.
   Procedure KIS$REP_DISC requires 12 words of local(AUTO) storage.
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:137  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:138  
          MINI XREF LISTING

B$DO.ECCINFO
       160**DCL       161--REDEF
B$U.MISC
       139**DCL       140--REDEF
B$USER.FLG
       185**DCL       673>>IF
B$USER.MISC
       215**DCL       216--REDEF
B$USER.MISC$
       216**DCL       673>>IF
B$USRT$
       634**DCL       673>>IF        673>>IF
B_MUAIS
       635**DCL       672>>DOINDEX
I
       628**DCL       629--REDEF     672<<DOINDEX   673>>IF        673>>IF
IUSER.USER
       631**DCL       675<>CALL
KIA$TERM
       574**DCL-ENT   668--CALL
LDCT$
       626**DCL       662<<ASSIGN    663>>IF        663>>IF        663>>IF        667>>ASSIGN    668>>CALL
LDCTX
       625**DCL       661<<DOINDEX   662>>ASSIGN
N$DCT$$
       334**DCL       334--IMP-PTR   662>>ASSIGN
NK$LDCT
       591**DCL       668<>CALL
NK$LDCT.DDT$
       593**DCL       593--REDEF
NK$LDCT.DFLG.FEDN
       599**DCL       667<<ASSIGN
PL6.E3A0      #003=KIS$REP_DISC File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:139  
NK$LDCT.DFLG.LOCAL
       597**DCL       663>>IF
NK$LDCT.IOQ$
       592**DCL       593--REDEF
NK$LDCT.LDCTX
       594**DCL       594--REDEF
NK$LDCT.LKFLG.ABORTED
       606**DCL       607--REDEF
NK$LDCT.RLCID.LDCTX
       616**DCL       616--REDEF
NK$LDCT.RLCID.NODE
       615**DCL       663>>IF        673>>IF
NK$LDCT.STA$
       612**DCL       613--REDEF
NK$LDCT.SYMB$
       591**DCL       591--REDEF     591--REDEF     592--REDEF
NK$LDCT$
       334**DCL       662>>ASSIGN
NK_CUR
       335**DCL       661>>DOINDEX
NK_MXLOCAL
       334**DCL       661>>DOINDEX
NODE
       571**DCL         6--PROC      663>>IF        673>>IF
SSR$RUE
       575**DCL-ENT   675--CALL      677--CALL

PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:140  
      801        1        /*T***********************************************************/
      802        2        /*T*                                                         */
      803        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      804        4        /*T*                                                         */
      805        5        /*T***********************************************************/
      806        6        KIS$REP_TERM: PROC(TCTX#);
      807        7
      808        8                                                /* Include files                      */
      809        9        %INCLUDE B$USER;
      810      225        %INCLUDE NK$LDCT;
      811      327        %INCLUDE NK_LDCT_R;
      812      336        %INCLUDE SS_SCHED_C;
      813      569
      814      570                                                /* Parameter definitions              */
      815      571    1   DCL TCTX# UBIN;
      816      572
      817      573                                                /* Entry point references             */
      818      574    1   DCL KIA$TERM ENTRY(1) ALTRET;
      819      575    1   DCL SSR$RUE ENTRY(4);
      820      576
      821      577                                                /* Based items                        */
      822      578        %NK$LDCT (NAME=NK$LDCT);
      823      624
      824      625    1   DCL LDCTX UBIN;
      825      626    1   DCL LDCT$ PTR;
      826      627
      827      628    1   DCL I UBIN;
      828      629    1   DCL 1 IUSER REDEF I,
      829      630    1         2 * BIT(27) UNAL,
      830      631    1         2 USER UBIN BYTE UNAL;
      831      632
      832      633                                                /* SYMREFs                            */
      833      634    1   DCL B$USRT$ PTR SYMREF;
      834      635    1   DCL B_MUAIS UBIN SYMREF;
      835      636
      836      637        %EJECT;
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:141  
      837      638        /*F* NAME: KIS$REP_TERM - Report Disconnect
      838      639
      839      640        KIS$REP_TERM is called from KIT$RECV to disconnect CP-6 session
      840      641        connections when a TPDU_DR is received.  (This routine is not currently
      841      642        used as we never disconnect CP-6 transport connects.  We may someday
      842      643        have more than one transport connection between the host and the remote
      843      644        in which case we will need this routine.)
      844      645
      845      646        The only parameter is TCTX#, the index for the transport connection
      846      647        context block.
      847      648
      848      649        We run through the LDCTs looking for those that have TCTX#
      849      650        equal to that specified in TCTX#.
      850      651        The DFLAG.FEDN bit is set in the LDCT and KIA$TERM is called.
      851      652
      852      653        We then run through the user table looking for users with SCIO
      853      654        set and RLCID.TCTX# in the LDCT addressed by MISC$ equal to that
      854      655        specified in TCTX#.
      855      656        For each user in this state we report an SS_FC event.
      856      657
      857      658        Finally we report an SS_CBA event and return.
      858      659        */
      859      660
      860      661    2      DO LDCTX = NK_MXLOCAL+1 TO NK_CUR;
      861      662    2           LDCT$ = NK$LDCT$(LDCTX);
      862      663    2           IF LDCT$ ~= ADDR(NIL)
      863      664    2             AND LDCT$->NK$LDCT.TCTX# = TCTX#
      864      665    2             AND NOT LDCT$->NK$LDCT.DFLG.LOCAL
      865      666    3           THEN DO;
      866      667    3                LDCT$->NK$LDCT.DFLG.FEDN = '1'B;
      867      668    3                CALL KIA$TERM (LDCT$->NK$LDCT);
      868      669    3                END;
      869      670    2           END;
      870      671
      871      672    2      DO I = 1 TO B_MUAIS;
      872      673    2           IF B$USRT$->B$USER.FLG(I) & %U_SCIO
      873      674    2             AND B$USRT$->B$USER.MISC$(I)->NK$LDCT.TCTX# = TCTX#
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:142  
      874      675    2           THEN CALL SSR$RUE(%SS_FC,IUSER.USER);
      875      676    2           END;
      876      677    1      CALL SSR$RUE(%SS_CBA);
      877      678
      878      679    1      RETURN;
      879      680
      880      681    1   END KIS$REP_TERM;
      881      682        %EOD;

PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:143  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIS$REP_TERM.

   Procedure KIS$REP_TERM requires 68 words for executable code.
   Procedure KIS$REP_TERM requires 12 words of local(AUTO) storage.

PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:144  

 Object Unit name= KIS$REP_TERM                               File name= KIS$SESSION.:E05TOU
 UTS= JUL 30 '97 00:43:27.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  KIS$REP_TERM
    1   Proc  even  none    68    104  KIS$REP_TERM
    2  RoData even  none     5      5  KIS$REP_TERM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  KIS$REP_TERM

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KIA$TERM
         yes           Std       4 SSR$RUE
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               NK_MXLOCAL                            NK_CUR
     B$USRT$                               B_MUAIS                               B_VECTNIL
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:145  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:146  


      801        1        /*T***********************************************************/
      802        2        /*T*                                                         */
      803        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      804        4        /*T*                                                         */
      805        5        /*T***********************************************************/
      806        6        KIS$REP_TERM: PROC(TCTX#);

      6  1 000000   000000 700200 xent  KIS$REP_TERM TSX0  ! X66_AUTO_1
         1 000001   000014 000001                    ZERO    12,1

      807        7
      808        8                                                /* Include files                      */
      809        9        %INCLUDE B$USER;
      810      225        %INCLUDE NK$LDCT;
      811      327        %INCLUDE NK_LDCT_R;
      812      336        %INCLUDE SS_SCHED_C;
      813      569
      814      570                                                /* Parameter definitions              */
      815      571    1   DCL TCTX# UBIN;
      816      572
      817      573                                                /* Entry point references             */
      818      574    1   DCL KIA$TERM ENTRY(1) ALTRET;
      819      575    1   DCL SSR$RUE ENTRY(4);
      820      576
      821      577                                                /* Based items                        */
      822      578        %NK$LDCT (NAME=NK$LDCT);
      823      624
      824      625    1   DCL LDCTX UBIN;
      825      626    1   DCL LDCT$ PTR;
      826      627
      827      628    1   DCL I UBIN;
      828      629    1   DCL 1 IUSER REDEF I,
      829      630    1         2 * BIT(27) UNAL,
      830      631    1         2 USER UBIN BYTE UNAL;
      831      632
      832      633                                                /* SYMREFs                            */
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:147  
      833      634    1   DCL B$USRT$ PTR SYMREF;
      834      635    1   DCL B_MUAIS UBIN SYMREF;
      835      636
      836      637        %EJECT;
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:148  
      837      638        /*F* NAME: KIS$REP_TERM - Report Disconnect
      838      639
      839      640        KIS$REP_TERM is called from KIT$RECV to disconnect CP-6 session
      840      641        connections when a TPDU_DR is received.  (This routine is not currently
      841      642        used as we never disconnect CP-6 transport connects.  We may someday
      842      643        have more than one transport connection between the host and the remote
      843      644        in which case we will need this routine.)
      844      645
      845      646        The only parameter is TCTX#, the index for the transport connection
      846      647        context block.
      847      648
      848      649        We run through the LDCTs looking for those that have TCTX#
      849      650        equal to that specified in TCTX#.
      850      651        The DFLAG.FEDN bit is set in the LDCT and KIA$TERM is called.
      851      652
      852      653        We then run through the user table looking for users with SCIO
      853      654        set and RLCID.TCTX# in the LDCT addressed by MISC$ equal to that
      854      655        specified in TCTX#.
      855      656        For each user in this state we report an SS_FC event.
      856      657
      857      658        Finally we report an SS_CBA event and return.
      858      659        */
      859      660
      860      661    2      DO LDCTX = NK_MXLOCAL+1 TO NK_CUR;

    661  1 000002   000000 235000 xsym               LDA     NK_MXLOCAL
         1 000003   000001 035007                    ADLA    1,DL
         1 000004   200004 755100                    STA     LDCTX,,AUTO
         1 000005   000036 710000 1                  TRA     s:670+3

      861      662    2           LDCT$ = NK$LDCT$(LDCTX);

    662  1 000006   000000 470400 xsym               LDP0    N$DCT$$
         1 000007   200004 720100                    LXL0    LDCTX,,AUTO
         1 000010   000000 236110                    LDQ     0,X0,PR0
         1 000011   200005 756100                    STQ     LDCT$,,AUTO

PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:149  
      862      663    2           IF LDCT$ ~= ADDR(NIL)

    663  1 000012   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000013   000033 600000 1                  TZE     s:670
         1 000014   200003 471500                    LDP1    @TCTX#,,AUTO
         1 000015   200005 473500                    LDP3    LDCT$,,AUTO
         1 000016   300007 236100                    LDQ     7,,PR3
         1 000017   777777 376007                    ANQ     -1,DL
         1 000020   100000 116100                    CMPQ    0,,PR1
         1 000021   000033 601000 1                  TNZ     s:670
         1 000022   300006 236100                    LDQ     6,,PR3
         1 000023   002000 316007                    CANQ    1024,DL
         1 000024   000033 601000 1                  TNZ     s:670

      863      664    2             AND LDCT$->NK$LDCT.TCTX# = TCTX#
      864      665    2             AND NOT LDCT$->NK$LDCT.DFLG.LOCAL
      865      666    3           THEN DO;

      866      667    3                LDCT$->NK$LDCT.DFLG.FEDN = '1'B;

    667  1 000025   000020 236007                    LDQ     16,DL
         1 000026   300006 256100                    ORSQ    6,,PR3

      867      668    3                CALL KIA$TERM (LDCT$->NK$LDCT);

    668  1 000027   200005 630500                    EPPR0   LDCT$,,AUTO
         1 000030   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000031   000000 701000 xent               TSX1    KIA$TERM
         1 000032   000000 011000                    NOP     0

      868      669    3                END;

      869      670    2           END;

    670  1 000033   200004 235100                    LDA     LDCTX,,AUTO
         1 000034   000001 035007                    ADLA    1,DL
         1 000035   200004 755100                    STA     LDCTX,,AUTO
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:150  
         1 000036   000000 236000 xsym               LDQ     NK_CUR
         1 000037   200004 116100                    CMPQ    LDCTX,,AUTO
         1 000040   000006 603000 1                  TRC     s:662

      870      671
      871      672    2      DO I = 1 TO B_MUAIS;

    672  1 000041   000001 235007                    LDA     1,DL
         1 000042   200006 755100                    STA     I,,AUTO
         1 000043   000074 710000 1                  TRA     s:676+3

      872      673    2           IF B$USRT$->B$USER.FLG(I) & %U_SCIO

    673  1 000044   200006 235100                    LDA     I,,AUTO
         1 000045   000004 735000                    ALS     4
         1 000046   000000 470400 xsym               LDP0    B$USRT$
         1 000047   000000 236105                    LDQ     0,AL,PR0
         1 000050   000000 376000 0                  ANQ     0
         1 000051   000071 600000 1                  TZE     s:676
         1 000052   000017 471505                    LDP1    15,AL,PR0
         1 000053   200003 473500                    LDP3    @TCTX#,,AUTO
         1 000054   100007 236100                    LDQ     7,,PR1
         1 000055   777777 376007                    ANQ     -1,DL
         1 000056   300000 116100                    CMPQ    0,,PR3
         1 000057   000071 601000 1                  TNZ     s:676

      873      674    2             AND B$USRT$->B$USER.MISC$(I)->NK$LDCT.TCTX# = TCTX#
      874      675    2           THEN CALL SSR$RUE(%SS_FC,IUSER.USER);

    675  1 000060   200012 452500                    STP2    I+4,,AUTO
         1 000061   200012 236100                    LDQ     I+4,,AUTO
         1 000062   000001 036000 2                  ADLQ    1
         1 000063   000002 235000 2                  LDA     2
         1 000064   200010 757100                    STAQ    I+2,,AUTO
         1 000065   200010 630500                    EPPR0   I+2,,AUTO
         1 000066   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000067   000000 701000 xent               TSX1    SSR$RUE
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:151  
         1 000070   000000 011000                    NOP     0

      875      676    2           END;

    676  1 000071   200006 235100                    LDA     I,,AUTO
         1 000072   000001 035007                    ADLA    1,DL
         1 000073   200006 755100                    STA     I,,AUTO
         1 000074   000000 236000 xsym               LDQ     B_MUAIS
         1 000075   200006 116100                    CMPQ    I,,AUTO
         1 000076   000044 603000 1                  TRC     s:673

      876      677    1      CALL SSR$RUE(%SS_CBA);

    677  1 000077   000004 630400 2                  EPPR0   4
         1 000100   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000101   000000 701000 xent               TSX1    SSR$RUE
         1 000102   000000 011000                    NOP     0

      877      678
      878      679    1      RETURN;

    679  1 000103   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   0     000   000000 002000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000000 000050   000006 600000   000000 006000   000000 000077    ...(...........?
   2     004   000003 006000                                                    ....
      879      680
      880      681    1   END KIS$REP_TERM;
      881      682        %EOD;

PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:152  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIS$REP_TERM.
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:153  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @TCTX#                     6-0-0/w UBIN        r     1 I
     6-0-0/w STRC        r     1 IUSER                      5-0-0/w PTR         r     1 LDCT$
     4-0-0/w UBIN        r     1 LDCTX                     *0-0-0/w UBIN        r     1 TCTX#

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/w UBIN        r     1 B_MUAIS
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w UBIN        r     1 NK_CUR
     0-0-0/w UBIN        r     1 NK_MXLOCAL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)


   Procedure KIS$REP_TERM requires 68 words for executable code.
   Procedure KIS$REP_TERM requires 12 words of local(AUTO) storage.
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:154  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:155  
          MINI XREF LISTING

B$DO.ECCINFO
       160**DCL       161--REDEF
B$U.MISC
       139**DCL       140--REDEF
B$USER.FLG
       185**DCL       673>>IF
B$USER.MISC
       215**DCL       216--REDEF
B$USER.MISC$
       216**DCL       673>>IF
B$USRT$
       634**DCL       673>>IF        673>>IF
B_MUAIS
       635**DCL       672>>DOINDEX
I
       628**DCL       629--REDEF     672<<DOINDEX   673>>IF        673>>IF
IUSER.USER
       631**DCL       675<>CALL
KIA$TERM
       574**DCL-ENT   668--CALL
LDCT$
       626**DCL       662<<ASSIGN    663>>IF        663>>IF        663>>IF        667>>ASSIGN    668>>CALL
LDCTX
       625**DCL       661<<DOINDEX   662>>ASSIGN
N$DCT$$
       334**DCL       334--IMP-PTR   662>>ASSIGN
NK$LDCT
       591**DCL       668<>CALL
NK$LDCT.DDT$
       593**DCL       593--REDEF
NK$LDCT.DFLG.FEDN
       599**DCL       667<<ASSIGN
PL6.E3A0      #004=KIS$REP_TERM File=KIS$SESSION.:E05TSI                         WED 07/30/97 00:43 Page:156  
NK$LDCT.DFLG.LOCAL
       597**DCL       663>>IF
NK$LDCT.IOQ$
       592**DCL       593--REDEF
NK$LDCT.LDCTX
       594**DCL       594--REDEF
NK$LDCT.LKFLG.ABORTED
       606**DCL       607--REDEF
NK$LDCT.RLCID.LDCTX
       616**DCL       616--REDEF
NK$LDCT.STA$
       612**DCL       613--REDEF
NK$LDCT.SYMB$
       591**DCL       591--REDEF     591--REDEF     592--REDEF
NK$LDCT.TCTX#
       601**DCL       663>>IF        673>>IF
NK$LDCT$
       334**DCL       662>>ASSIGN
NK_CUR
       335**DCL       661>>DOINDEX
NK_MXLOCAL
       334**DCL       661>>DOINDEX
SSR$RUE
       575**DCL-ENT   675--CALL      677--CALL
TCTX#
       571**DCL         6--PROC      663>>IF        673>>IF

PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:157  
      882        1        /*T***********************************************************/
      883        2        /*T*                                                         */
      884        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      885        4        /*T*                                                         */
      886        5        /*T***********************************************************/
      887        6        KIS$UNQUEUE: PROC(K$RWPARM);
      888        7
      889        8
      890        9                                                /* Include files                      */
      891       10        %INCLUDE K$RWPARM;
      892      396        %INCLUDE NK$LDCT;
      893      498        %INCLUDE NK_SUBS;
      894      523        %INCLUDE HF_LOCK_C;
      895      537        %INCLUDE SS_SCHED_C;
      896      770
      897      771                                                /* Parameter definitions              */
      898      772        %K$RWPARM (NAME=K$RWPARM);
      899     1088
      900     1089                                                /* Entry point references             */
      901     1090    1   DCL SC_BADRCD ENTRY CONV(2,0);
      902     1091    1   DCL SSR$RUE ENTRY(4);
      903     1092    1   DCL KCF$QNF ENTRY(1);
      904     1093
      905     1094                                                /* Based items                        */
      906     1095        %NK$LDCT (NAME=NK$LDCT);
      907     1141
      908     1142                                                /* AUTO Storage                       */
      909     1143    1   DCL LDCT$ PTR;
      910     1144    1   DCL QQQ$ PTR;
      911     1145        %EJECT;
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:158  
      912     1146        /*F* NAME: KIS$UNQUEUE
      913     1147
      914     1148        For the unqueue function, KI?$???????? has put the address of the
      915     1149        first queued LDCT in K$RWPARM.SHDR$.
      916     1150
      917     1151        The routine to be called depends on the value of NK$LDCT.RESCOD:
      918     1152        .fif
      919     1153        }    NK_TSTRM  -> Report SS_CUB event
      920     1154        }    NK_TSFPRG -> Report SS_CUB event
      921     1155        }    NK_CGTRM  -> Call KCF$QNF
      922     1156        }    NK_CGFPRG -> Call KCF$QNF
      923     1157        }    NK_NOCG   -> Call KCF$QNF
      924     1158        }    NK_TRMPTH -> Call KCF$QNF
      925     1159        .fin
      926     1160
      927     1161        Finally we report an SS_CBA event and return.
      928     1162        */
      929     1163
      930     1164
      931     1165    1      LDCT$ = K$RWPARM.SHDR$;
      932     1166
      933     1167    2      DO WHILE ( LDCT$ ~= ADDR(NIL) );
      934     1168
      935     1169                %LOCK (G=LDCT$->NK$LDCT.LOCK);
      936     1172    2           QQQ$ = LDCT$->NK$LDCT.LNK$;
      937     1173    2           LDCT$->NK$LDCT.LNK$ = ADDR(NIL);
      938     1174    2           LDCT$->NK$LDCT.LKFLG.QUEUED = '0'B;
      939     1175                %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      940     1178
      941     1179    3           DO CASE (LDCT$->NK$LDCT.RESCOD );
      942     1180
      943     1181    3            CASE(NK_TSTRM,NK_TSFPRG);
      944     1182    3              CALL SSR$RUE(%SS_CUB,LDCT$->NK$LDCT.USER);
      945     1183
      946     1184    3            CASE(NK_CGTRM,NK_CGFPRG,NK_NOCG,NK_TRMPTH);
      947     1185    3              CALL KCF$QNF(LDCT$->NK$LDCT);
      948     1186
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:159  
      949     1187    3            CASE (ELSE);
      950     1188    3              CALL SC_BADRCD;
      951     1189
      952     1190    3              END/*do case*/;
      953     1191
      954     1192    2           LDCT$ = QQQ$;
      955     1193    2           END;
      956     1194
      957     1195    1      CALL SSR$RUE(%SS_CBA);
      958     1196
      959     1197    1      RETURN;
      960     1198
      961     1199    1   END KIS$UNQUEUE;

PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:160  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
      No diagnostics issued in procedure KIS$UNQUEUE.

   Procedure KIS$UNQUEUE requires 68 words for executable code.
   Procedure KIS$UNQUEUE requires 8 words of local(AUTO) storage.

    No errors detected in file KIS$SESSION.:E05TSI    .

PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:161  

 Object Unit name= KIS$UNQUEUE                                File name= KIS$SESSION.:E05TOU
 UTS= JUL 30 '97 00:43:38.48 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    68    104  KIS$UNQUEUE
    1  RoData even  none     5      5  KIS$UNQUEUE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KIS$UNQUEUE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
         yes           Std       1 KCF$QNF
         yes           Std       4 SSR$RUE
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BADRCD                             B_VECTNIL
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:162  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:163  


      882        1        /*T***********************************************************/
      883        2        /*T*                                                         */
      884        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      885        4        /*T*                                                         */
      886        5        /*T***********************************************************/
      887        6        KIS$UNQUEUE: PROC(K$RWPARM);

      6  0 000000   000000 700200 xent  KIS$UNQUEUE  TSX0  ! X66_AUTO_1
         0 000001   000010 000001                    ZERO    8,1

      888        7
      889        8
      890        9                                                /* Include files                      */
      891       10        %INCLUDE K$RWPARM;
      892      396        %INCLUDE NK$LDCT;
      893      498        %INCLUDE NK_SUBS;
      894      523        %INCLUDE HF_LOCK_C;
      895      537        %INCLUDE SS_SCHED_C;
      896      770
      897      771                                                /* Parameter definitions              */
      898      772        %K$RWPARM (NAME=K$RWPARM);
      899     1088
      900     1089                                                /* Entry point references             */
      901     1090    1   DCL SC_BADRCD ENTRY CONV(2,0);
      902     1091    1   DCL SSR$RUE ENTRY(4);
      903     1092    1   DCL KCF$QNF ENTRY(1);
      904     1093
      905     1094                                                /* Based items                        */
      906     1095        %NK$LDCT (NAME=NK$LDCT);
      907     1141
      908     1142                                                /* AUTO Storage                       */
      909     1143    1   DCL LDCT$ PTR;
      910     1144    1   DCL QQQ$ PTR;
      911     1145        %EJECT;
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:164  
      912     1146        /*F* NAME: KIS$UNQUEUE
      913     1147
      914     1148        For the unqueue function, KI?$???????? has put the address of the
      915     1149        first queued LDCT in K$RWPARM.SHDR$.
      916     1150
      917     1151        The routine to be called depends on the value of NK$LDCT.RESCOD:
      918     1152        .fif
      919     1153        }    NK_TSTRM  -> Report SS_CUB event
      920     1154        }    NK_TSFPRG -> Report SS_CUB event
      921     1155        }    NK_CGTRM  -> Call KCF$QNF
      922     1156        }    NK_CGFPRG -> Call KCF$QNF
      923     1157        }    NK_NOCG   -> Call KCF$QNF
      924     1158        }    NK_TRMPTH -> Call KCF$QNF
      925     1159        .fin
      926     1160
      927     1161        Finally we report an SS_CBA event and return.
      928     1162        */
      929     1163
      930     1164
      931     1165    1      LDCT$ = K$RWPARM.SHDR$;

   1165  0 000002   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000003   000022 236100                    LDQ     18,,PR0
         0 000004   200004 756100                    STQ     LDCT$,,AUTO

      932     1166
      933     1167    2      DO WHILE ( LDCT$ ~= ADDR(NIL) );

   1167  0 000005   000075 710000 0                  TRA     s:1193

      934     1168
      935     1169                %LOCK (G=LDCT$->NK$LDCT.LOCK);

   1170  0 000006   200004 236100                    LDQ     LDCT$,,AUTO
         0 000007   000020 036003                    ADLQ    16,DU
         0 000010   200006 756100                    STQ     QQQ$+1,,AUTO
         0 000011   200006 630500                    EPPR0   QQQ$+1,,AUTO
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:165  
         0 000012   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000013   000000 701000 xent               TSX1    HFC$LOCK
         0 000014   000000 011000                    NOP     0

      936     1172    2           QQQ$ = LDCT$->NK$LDCT.LNK$;

   1172  0 000015   200004 470500                    LDP0    LDCT$,,AUTO
         0 000016   000004 236100                    LDQ     4,,PR0
         0 000017   200005 756100                    STQ     QQQ$,,AUTO

      937     1173    2           LDCT$->NK$LDCT.LNK$ = ADDR(NIL);

   1173  0 000020   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000021   000004 756100                    STQ     4,,PR0

      938     1174    2           LDCT$->NK$LDCT.LKFLG.QUEUED = '0'B;

   1174  0 000022   000000 236000 1                  LDQ     0
         0 000023   000011 356100                    ANSQ    9,,PR0

      939     1175                %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   1176  0 000024   200004 236100                    LDQ     LDCT$,,AUTO
         0 000025   000020 036003                    ADLQ    16,DU
         0 000026   200006 756100                    STQ     QQQ$+1,,AUTO
         0 000027   200006 630500                    EPPR0   QQQ$+1,,AUTO
         0 000030   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000031   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000032   000000 011000                    NOP     0

      940     1178
      941     1179    3           DO CASE (LDCT$->NK$LDCT.RESCOD );

   1179  0 000033   200004 470500                    LDP0    LDCT$,,AUTO
         0 000034   000006 720100                    LXL0    6,,PR0
         0 000035   000017 360003                    ANX0    15,DU
         0 000036   000012 100003                    CMPX0   10,DU
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:166  
         0 000037   000041 602010 0                  TNC     s:1179+6,X0
         0 000040   000071 710000 0                  TRA     s:1188
         0 000041   000071 710000 0                  TRA     s:1188
         0 000042   000053 710000 0                  TRA     s:1182
         0 000043   000064 710000 0                  TRA     s:1185
         0 000044   000071 710000 0                  TRA     s:1188
         0 000045   000071 710000 0                  TRA     s:1188
         0 000046   000064 710000 0                  TRA     s:1185
         0 000047   000064 710000 0                  TRA     s:1185
         0 000050   000071 710000 0                  TRA     s:1188
         0 000051   000053 710000 0                  TRA     s:1182
         0 000052   000064 710000 0                  TRA     s:1185

      942     1180
      943     1181    3            CASE(NK_TSTRM,NK_TSFPRG);

      944     1182    3              CALL SSR$RUE(%SS_CUB,LDCT$->NK$LDCT.USER);

   1182  0 000053   200004 236100                    LDQ     LDCT$,,AUTO
         0 000054   000001 036000 1                  ADLQ    1
         0 000055   000002 235000 1                  LDA     2
         0 000056   200006 757100                    STAQ    QQQ$+1,,AUTO
         0 000057   200006 630500                    EPPR0   QQQ$+1,,AUTO
         0 000060   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000061   000000 701000 xent               TSX1    SSR$RUE
         0 000062   000000 011000                    NOP     0
         0 000063   000073 710000 0                  TRA     s:1192

      945     1183
      946     1184    3            CASE(NK_CGTRM,NK_CGFPRG,NK_NOCG,NK_TRMPTH);

      947     1185    3              CALL KCF$QNF(LDCT$->NK$LDCT);

   1185  0 000064   200004 630500                    EPPR0   LDCT$,,AUTO
         0 000065   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000066   000000 701000 xent               TSX1    KCF$QNF
         0 000067   000000 011000                    NOP     0
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:167  
         0 000070   000073 710000 0                  TRA     s:1192

      948     1186
      949     1187    3            CASE (ELSE);

      950     1188    3              CALL SC_BADRCD;

   1188  0 000071   000000 713400 xsym               CLIMB   SC_BADRCD
         0 000072   000000 600000 xsid               climb   nvectors=         0

      951     1189
      952     1190    3              END/*do case*/;

      953     1191
      954     1192    2           LDCT$ = QQQ$;

   1192  0 000073   200005 236100                    LDQ     QQQ$,,AUTO
         0 000074   200004 756100                    STQ     LDCT$,,AUTO

      955     1193    2           END;

   1193  0 000075   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000076   000006 601000 0                  TNZ     s:1170

      956     1194
      957     1195    1      CALL SSR$RUE(%SS_CBA);

   1195  0 000077   000004 630400 1                  EPPR0   4
         0 000100   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000101   000000 701000 xent               TSX1    SSR$RUE
         0 000102   000000 011000                    NOP     0

      958     1196
      959     1197    1      RETURN;

   1197  0 000103   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:168  
(unnamed)
 Sect OctLoc
   1     000   777377 777777   000007 200000   000012 006000   000000 000077    ...............?
   1     004   000003 006000                                                    ....
      960     1198
      961     1199    1   END KIS$UNQUEUE;

PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:169  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
      No diagnostics issued in procedure KIS$UNQUEUE.
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:170  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @K$RWPARM                 *0-0-0/d STRC(1404)  r     1 K$RWPARM
     4-0-0/w PTR         r     1 LDCT$                      5-0-0/w PTR         r     1 QQQ$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(864)   r     1 NK$LDCT


   Procedure KIS$UNQUEUE requires 68 words for executable code.
   Procedure KIS$UNQUEUE requires 8 words of local(AUTO) storage.

    No errors detected in file KIS$SESSION.:E05TSI    .
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:171  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:172  
          MINI XREF LISTING

HFC$LOCK
       536**DCL-ENT  1170--CALL
HFC$UNLOCK
       536**DCL-ENT  1176--CALL
K$RWPARM
       793**DCL         6--PROC
K$RWPARM.BLKREC
       819**DCL       844--REDEF
K$RWPARM.BLKREC.BLKU#
       820**DCL       822--REDEF
K$RWPARM.BLKREC.RECU#
       832**DCL       834--REDEF
K$RWPARM.DVE.DVBYTE.VFC
       859**DCL       860--REDEF
K$RWPARM.DVE.EOMCHAR
       867**DCL       871--REDEF
K$RWPARM.ERR
       931**DCL       936--REDEF
K$RWPARM.FC
       895**DCL       896--REDEF
K$RWPARM.FLDID
      1077**DCL      1078--REDEF
K$RWPARM.FPT$
       958**DCL       965--REDEF
K$RWPARM.KEYTYPE
      1084**DCL      1085--REDEF
K$RWPARM.MSG$
       794**DCL       800--REDEF
K$RWPARM.MSGID
       906**DCL       911--REDEF
K$RWPARM.MSGIDXT
       919**DCL       923--REDEF
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:173  
K$RWPARM.ORG
      1055**DCL      1056--REDEF
K$RWPARM.SHDR$
       987**DCL      1165>>ASSIGN
K$RWPARM.THDRSZ
       999**DCL      1003--REDEF
K$RWPARM.VDOFLGS
      1057**DCL      1068--REDEF
KCF$QNF
      1092**DCL-ENT  1185--CALL
LDCT$
      1143**DCL      1165<<ASSIGN   1167>>DOWHILE  1170>>CALL     1172>>ASSIGN   1173>>ASSIGN   1174>>ASSIGN
      1176>>CALL     1179>>DOCASE   1182>>CALL     1185>>CALL     1192<<ASSIGN
NK$LDCT
      1108**DCL      1185<>CALL
NK$LDCT.DDT$
      1110**DCL      1110--REDEF
NK$LDCT.IOQ$
      1109**DCL      1110--REDEF
NK$LDCT.LDCTX
      1111**DCL      1111--REDEF
NK$LDCT.LKFLG.ABORTED
      1123**DCL      1124--REDEF
NK$LDCT.LKFLG.QUEUED
      1126**DCL      1174<<ASSIGN
NK$LDCT.LNK$
      1110**DCL      1172>>ASSIGN   1173<<ASSIGN
NK$LDCT.LOCK
      1136**DCL      1170<>CALL     1176<>CALL
NK$LDCT.RESCOD
      1116**DCL      1179>>DOCASE
NK$LDCT.RLCID.LDCTX
      1133**DCL      1133--REDEF
NK$LDCT.STA$
      1129**DCL      1130--REDEF
NK$LDCT.SYMB$
PL6.E3A0      #005=KIS$UNQUEUE File=KIS$SESSION.:E05TSI                          WED 07/30/97 00:43 Page:174  
      1108**DCL      1108--REDEF    1108--REDEF    1109--REDEF
NK$LDCT.USER
      1118**DCL      1182<>CALL
QQQ$
      1144**DCL      1172<<ASSIGN   1192>>ASSIGN
SC_BADRCD
      1090**DCL-ENT  1188--CALL
SSR$RUE
      1091**DCL-ENT  1182--CALL     1195--CALL
