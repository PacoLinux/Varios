VERSION E05

PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:1    
        1        1        /*M* GUE$ENVTCB  Move TSA or ISA to TCB      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0     */
        8        8
        9        9           /*F* NAME:   GUE$ENVTCB.
       10       10               PURPOSE: To put a TSA or ISA frame on the TCB.
       11       11           */
       12       12
       13       13           /*D* NAME:   GUE$ENVTCB.
       14       14
       15       15                INPUT:  See GUE_ENVTCB_PARAMS documentation.
       16       16
       17       17                OUTPUT: A new frame on the TCB.
       18       18
       19       19                DESCRIPTION:  GUE$ENVTCB will determine if there is suffucuent
       20       20                room on the user's TCB for the new Exceptional Condition frame
       21       21                and ALTRETURN to the caller if not.
       22       22
       23       23                Space will be obtained in the TCB and the TCB pointers and
       24       24                size indicators updated to reflect this.  The environment
       25       25                indicated via the $ENV input parameter is then moved to the
       26       26                TCB and the Program Counter in the environment is set to the
       27       27                address specified for the Exceptional Condition via the ECCB.
       28       28           */
       29       29        GUE$ENVTCB: PROC(ENVTCB_PARAMS) ALTRET;
       30       30
       31       31 S      %INCLUDE GH_LCP6_M;
       32       32 S      %INCLUDE GU_LCP6_M;
       33       33        %INCLUDE G_JIT_M;
       34      298        %INCLUDE G_ROS_M;
       35      380        %INCLUDE GU_MACROS_M;
       36      539        %INCLUDE GH_SCHD_M;
       37      683
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:2    
       38      684                                                /* Input parameters                   */
       39      685        %GUE_ENVTCB_PARAMS (FPTN=ENVTCB_PARAMS,STCLASS=" ");
       40      810
       41      811                                                /* AUTO Storage                       */
       42      812    1   DCL TCB$ PTR;
       43      813    1   DCL STK$ PTR;
       44      814    1   DCL CHAR_P# UBIN;
       45      815    1   DCL D$ PTR;
       46      816    1   DCL P# UBIN;
       47      817
       48      818                                                /* External data                      */
       49      819    1   DCL G$ROS$ PTR SYMREF READONLY;
       50      820
       51      821                                                /* Based Structures                   */
       52      822        %G$TSA;
       53     1210        %G$ISA;
       54     1513        %G$ROS;
       55     1557        %G$TCB;
       56     1578        %G$EXCFR;
       57     1960    1   DCL G$MOREINFO CHAR(CHAR_P#) BASED;
       58     1961        %G$DO (STCLASS="BASED(D$)");
       59     2024        %G$DOCONT (STCLASS="BASED(D$)");
       60     2031
       61     2032                                                /* EQUs                               */
       62     2033 S      %INCLUDE G_LCP6_E;
       63     2034
       64     2035        %EJECT;
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:3    
       65     2036    1      TCB$ = ENVTCB_PARAMS.TCB$;
       66     2037    1      IF TCB$=ADDR(NIL)
       67     2038    2      THEN DO;
       68     2039    2           TCB$=ADDR(G$ROS$->G$ROS.TCB);
       69     2040    2           END;
       70     2041
       71     2042    1      IF ENVTCB_PARAMS.ECC >= %G_TCBFULL#
       72     2043    2      THEN DO;
       73     2044    2           STK$=TCB$->G$TCB.ALT$;
       74     2045    2           STK$->G$EXCFR.ALTEMPTY=0;
       75     2046    2           END;
       76     2047    2      ELSE DO;
       77     2048    2           IF TCB$->G$TCB.AVSZ < SIZEW(G$EXCFR)+ENVTCB_PARAMS.ECINFO.P#
       78     2049    2           THEN ALTRETURN;
       79     2050    3           ELSE DO;
       80     2051    3                STK$=PINCRW(TCB$->G$TCB.STK$,TCB$->G$TCB.CURRSZ);
       81     2052    3                STK$->G$EXCFR.PREVSZ = TCB$->G$TCB.CURRSZ;
       82     2053    3                TCB$->G$TCB.STK$ = STK$;
       83     2054    3                TCB$->G$TCB.CURRSZ = SIZEW(G$EXCFR)+ENVTCB_PARAMS.ECINFO.P#;
       84     2055    3                TCB$->G$TCB.AVSZ = TCB$->G$TCB.AVSZ - TCB$->G$TCB.CURRSZ;
       85     2056    3                END;
       86     2057    2           END;
       87     2058    1      STK$->G$EXCFR.ECC = ENVTCB_PARAMS.ECC;
       88     2059
       89     2060
       90     2061    1      IF ENVTCB_PARAMS.ENVTYPE = %GUE_ENVTCB_TSA# /* If Trap Save Area           */
       91     2062    2      THEN DO;
       92     2063    2           STK$->G$EXCFR.ISM1 = ENVTCB_PARAMS.ENV$->G$TSA.ISA.ISM1;
       93     2064    2           STK$->G$EXCFR.ISM2 = ENVTCB_PARAMS.ENV$->G$TSA.ISA.ISM2;
       94     2065    2           STK$->G$EXCFR.P = ENVTCB_PARAMS.ENV$->G$TSA.P;
       95     2066    2           STK$->G$EXCFR.S = ENVTCB_PARAMS.ENV$->G$TSA.S;
       96     2067    2           STK$->G$EXCFR.REGS = ENVTCB_PARAMS.ENV$->G$TSA.ISA.REGS;
       97     2068    2           STK$->G$EXCFR.REGS.B3$ = ENVTCB_PARAMS.ENV$->G$TSA.B3$;
       98     2069    2           STK$->G$EXCFR.REGS.R3 = ENVTCB_PARAMS.ENV$->G$TSA.R3;
       99     2070    2           STK$->G$EXCFR.REGS.I = ENVTCB_PARAMS.ENV$->G$TSA.I;
      100     2071    2           ENVTCB_PARAMS.ENV$->G$TSA.P$ = ENVTCB_PARAMS.P$;
      101     2072    2           END;
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:4    
      102     2073
      103     2074    2      ELSE DO;                             /* If Interrupt Save Area             */
      104     2075    2           STK$->G$EXCFR.ISM1 = ENVTCB_PARAMS.ENV$->G$ISA.ISM1;
      105     2076    2           STK$->G$EXCFR.ISM2 = ENVTCB_PARAMS.ENV$->G$ISA.ISM2;
      106     2077    2           STK$->G$EXCFR.P$ = ENVTCB_PARAMS.ENV$->G$ISA.P$;
      107     2078    2           STK$->G$EXCFR.S = ENVTCB_PARAMS.ENV$->G$ISA.S;
      108     2079    2           STK$->G$EXCFR.REGS = ENVTCB_PARAMS.ENV$->G$ISA.REGS;
      109     2080    2           ENVTCB_PARAMS.ENV$->G$ISA.P$ = ENVTCB_PARAMS.P$;
      110     2081    2           END;
      111     2082
      112     2083    1      STK$->G$EXCFR.TRLR = ENVTCB_PARAMS.ECINFO;
      113     2084
      114     2085    1      IF ENVTCB_PARAMS.ECINFO.P# ~= 0
      115     2086    2      THEN DO;
      116     2087    2           IF ENVTCB_PARAMS.ECC >= %G_TCBFULL#
      117     2088    3           THEN DO;
      118     2089    3                STK$->G$EXCFR.TRLR.P# = 0;
      119     2090    3                RETURN;
      120     2091    3                END;
      121     2092    3           ELSE DO;
      122     2093    3                CHAR_P# = ENVTCB_PARAMS.ECINFO.P# * 2;/* #bytes of info          */
      123     2094    3                P#=CHAR_P#;
      124     2095    3                STK$ = PINCRW(STK$,SIZEW(G$EXCFR));
      125     2096    3                IF ENVTCB_PARAMS.ECC ~= %G_EVENT#
      126     2097    4                THEN DO;
      127     2098    4                     STK$->G$MOREINFO = ENVTCB_PARAMS.MOREINFO$->G$MOREINFO;
      128     2099    4                     END;
      129     2100    4                ELSE DO;
      130     2101    4                     D$=ENVTCB_PARAMS.MOREINFO$;
      131     2102    4                     IF CHAR_P# <= SIZEC(G$DO.ECCINFO)
      132     2103    5                     THEN DO;
      133     2104    5                          STK$->G$MOREINFO = ADDR(G$DO.ECCINFO)->G$MOREINFO;
      134     2105    5                          END;
      135     2106    5                     ELSE DO;
      136     2107    5                          CHAR_P# = SIZEC(G$DO.ECCINFO);
      137     2108    5                          STK$->G$MOREINFO = ADDR(G$DO.ECCINFO)->G$MOREINFO;
      138     2109    6                          DO WHILE G$DO.CONT;
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:5    
      139     2110    6                               STK$ = PINCRC(STK$,CHAR_P#);
      140     2111    6                               D$ = G$DO.LNK$;
      141     2112    6                               P# = P# - CHAR_P#;
      142     2113    6                               IF P# <= SIZEC(G$DOCONT.ECCINFO)
      143     2114    6                               THEN CHAR_P# = P#;
      144     2115    6                               ELSE CHAR_P# = SIZEC(G$DOCONT.ECCINFO);
      145     2116    6                               STK$->G$MOREINFO = ADDR(G$DOCONT.ECCINFO)->G$MOREINFO;
      146     2117    6                               END;
      147     2118    5                          END;
      148     2119    4                     END;
      149     2120    3                END;
      150     2121    2           END;
      151     2122    1   END GUE$ENVTCB;

PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:6    
--  Include file information  --

   GH_SCHD_M.:E05TOU  is referenced.
   GU_MACROS_M.:E05TOU  is referenced.
   G_ROS_M.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure GUE$ENVTCB.

   Procedure GUE$ENVTCB requires 298 words for executable code.
   Procedure GUE$ENVTCB requires 16 words of local(AUTO) storage.

    No errors detected in file GUE$ENVTCB.:E05TSI    .

PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:7    

 Object Unit name= GUE$ENVTCB                                 File name= GUE$ENVTCB.:E05TOU
 UTS= JUL 29 '97 22:14:47.32 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   298    12A  GUE$ENVTCB

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  GUE$ENVTCB

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    G$ROS$                           r    G$ROS$
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:8    


        1        1        /*M* GUE$ENVTCB  Move TSA or ISA to TCB      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0     */
        8        8
        9        9           /*F* NAME:   GUE$ENVTCB.
       10       10               PURPOSE: To put a TSA or ISA frame on the TCB.
       11       11           */
       12       12
       13       13           /*D* NAME:   GUE$ENVTCB.
       14       14
       15       15                INPUT:  See GUE_ENVTCB_PARAMS documentation.
       16       16
       17       17                OUTPUT: A new frame on the TCB.
       18       18
       19       19                DESCRIPTION:  GUE$ENVTCB will determine if there is suffucuent
       20       20                room on the user's TCB for the new Exceptional Condition frame
       21       21                and ALTRETURN to the caller if not.
       22       22
       23       23                Space will be obtained in the TCB and the TCB pointers and
       24       24                size indicators updated to reflect this.  The environment
       25       25                indicated via the $ENV input parameter is then moved to the
       26       26                TCB and the Program Counter in the environment is set to the
       27       27                address specified for the Exceptional Condition via the ECCB.
       28       28           */
       29       29        GUE$ENVTCB: PROC(ENVTCB_PARAMS) ALTRET;

     29   0 000000  D380 0000 0000  xent GUE$ENVTCB      LNJ,B5   X6A_AUTO_1
          0 000003       0010 0001                       DC       16,1

       30       30
       31       31 S      %INCLUDE GH_LCP6_M;
       32       32 S      %INCLUDE GU_LCP6_M;
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:9    
       33       33        %INCLUDE G_JIT_M;
       34      298        %INCLUDE G_ROS_M;
       35      380        %INCLUDE GU_MACROS_M;
       36      539        %INCLUDE GH_SCHD_M;
       37      683
       38      684                                                /* Input parameters                   */
       39      685        %GUE_ENVTCB_PARAMS (FPTN=ENVTCB_PARAMS,STCLASS=" ");
       40      810
       41      811                                                /* AUTO Storage                       */
       42      812    1   DCL TCB$ PTR;
       43      813    1   DCL STK$ PTR;
       44      814    1   DCL CHAR_P# UBIN;
       45      815    1   DCL D$ PTR;
       46      816    1   DCL P# UBIN;
       47      817
       48      818                                                /* External data                      */
       49      819    1   DCL G$ROS$ PTR SYMREF READONLY;
       50      820
       51      821                                                /* Based Structures                   */
       52      822        %G$TSA;
       53     1210        %G$ISA;
       54     1513        %G$ROS;
       55     1557        %G$TCB;
       56     1578        %G$EXCFR;
       57     1960    1   DCL G$MOREINFO CHAR(CHAR_P#) BASED;
       58     1961        %G$DO (STCLASS="BASED(D$)");
       59     2024        %G$DOCONT (STCLASS="BASED(D$)");
       60     2031
       61     2032                                                /* EQUs                               */
       62     2033 S      %INCLUDE G_LCP6_E;
       63     2034
       64     2035        %EJECT;
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:10   
       65     2036    1      TCB$ = ENVTCB_PARAMS.TCB$;

   2036   0 000005  ECC7 0004                            LDB,B6   @ENVTCB_PARAMS,AUTO
          0 000007  DCC6 000D                            LDB,B5   13,B6
          0 000009  DFC7 0006                            STB,B5   TCB$,AUTO

       66     2037    1      IF TCB$=ADDR(NIL)

   2037   0 00000B  8DC7 0006                            CMN      TCB$,AUTO
          0 00000D  0981 0008                            BNE      s:2042,PREL

       67     2038    2      THEN DO;

       68     2039    2           TCB$=ADDR(G$ROS$->G$ROS.TCB);

   2039   0 00000F  CC80 0000 0000  xsym                 LDB,B4   G$ROS$
          0 000012  BBC4 0004                            LAB,B3   4,B4
          0 000014  BFC7 0006                            STB,B3   TCB$,AUTO

       69     2040    2           END;

       70     2041
       71     2042    1      IF ENVTCB_PARAMS.ECC >= %G_TCBFULL#

   2042   0 000016  E846 0002                            LDR,R6   2,B6
          0 000018  6D62                                 CMV,R6   98
          0 000019  0801 0009                            BAL      s:2048,PREL

       72     2043    2      THEN DO;

       73     2044    2           STK$=TCB$->G$TCB.ALT$;

   2044   0 00001B  CCC7 0006                            LDB,B4   TCB$,AUTO
          0 00001D  BC84                                 LDB,B3   ,B4
          0 00001E  BFC7 0008                            STB,B3   STK$,AUTO

       74     2045    2           STK$->G$EXCFR.ALTEMPTY=0;
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:11   

   2045   0 000020  8703                                 CL       ,B3

       75     2046    2           END;

   2046   0 000021  0F81 0021                            B        s:2058,PREL

       76     2047    2      ELSE DO;

       77     2048    2           IF TCB$->G$TCB.AVSZ < SIZEW(G$EXCFR)+ENVTCB_PARAMS.ECINFO.P#

   2048   0 000023  CCC7 0006                            LDB,B4   TCB$,AUTO
          0 000025  D846 0007                            LDR,R5   7,B6
          0 000027  5E2E                                 ADV,R5   46
          0 000028  D944 0004                            CMR,R5   4,B4
          0 00002A  0A81 0004                            BALE     s:2051,PREL

       78     2049    2           THEN ALTRETURN;

   2049   0 00002C  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

       79     2050    3           ELSE DO;

       80     2051    3                STK$=PINCRW(TCB$->G$TCB.STK$,TCB$->G$TCB.CURRSZ);

   2051   0 00002F  B844 0005                            LDR,R3   5,B4
          0 000031  BCC4 0002                            LDB,B3   2,B4
          0 000033  ABB3                                 LAB,B2   ,B3,R3
          0 000034  AFC7 0008                            STB,B2   STK$,AUTO

       81     2052    3                STK$->G$EXCFR.PREVSZ = TCB$->G$TCB.CURRSZ;

   2052   0 000036  BF02                                 STR,R3   ,B2

       82     2053    3                TCB$->G$TCB.STK$ = STK$;

   2053   0 000037  AFC4 0002                            STB,B2   2,B4
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:12   

       83     2054    3                TCB$->G$TCB.CURRSZ = SIZEW(G$EXCFR)+ENVTCB_PARAMS.ECINFO.P#;

   2054   0 000039  E846 0007                            LDR,R6   7,B6
          0 00003B  6E2E                                 ADV,R6   46
          0 00003C  EF44 0005                            STR,R6   5,B4

       84     2055    3                TCB$->G$TCB.AVSZ = TCB$->G$TCB.AVSZ - TCB$->G$TCB.CURRSZ;

   2055   0 00003E  E244 0004                            SUB,R6   4,B4
          0 000040  8256                                 NEG      R6
          0 000041  EF44 0004                            STR,R6   4,B4

       85     2056    3                END;

       86     2057    2           END;

       87     2058    1      STK$->G$EXCFR.ECC = ENVTCB_PARAMS.ECC;

   2058   0 000043  DCC7 0008                            LDB,B5   STK$,AUTO
          0 000045  E846 0002                            LDR,R6   2,B6
          0 000047  EF45 0001                            STR,R6   1,B5

       88     2059
       89     2060
       90     2061    1      IF ENVTCB_PARAMS.ENVTYPE = %GUE_ENVTCB_TSA# /* If Trap Save Area           */

   2061   0 000049  D846 000A                            LDR,R5   10,B6
          0 00004B  5981 003C                            BNEZ,R5  s:2075,PREL

       91     2062    2      THEN DO;

       92     2063    2           STK$->G$EXCFR.ISM1 = ENVTCB_PARAMS.ENV$->G$TSA.ISA.ISM1;

   2063   0 00004D  BCC6 000B                            LDB,B3   11,B6
          0 00004F  C843 0013                            LDR,R4   19,B3
          0 000051  CF45 0002                            STR,R4   2,B5
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:13   

       93     2064    2           STK$->G$EXCFR.ISM2 = ENVTCB_PARAMS.ENV$->G$TSA.ISA.ISM2;

   2064   0 000053  BCC6 000B                            LDB,B3   11,B6
          0 000055  D843 0014                            LDR,R5   20,B3
          0 000057  DF45 0003                            STR,R5   3,B5

       94     2065    2           STK$->G$EXCFR.P = ENVTCB_PARAMS.ENV$->G$TSA.P;

   2065   0 000059  BCC6 000B                            LDB,B3   11,B6
          0 00005B  8CC3 0008                            LDI      8,B3
          0 00005D  8D45 0004                            SDI      4,B5

       95     2066    2           STK$->G$EXCFR.S = ENVTCB_PARAMS.ENV$->G$TSA.S;

   2066   0 00005F  BCC6 000B                            LDB,B3   11,B6
          0 000061  B843 000C                            LDR,R3   12,B3
          0 000063  BF45 0006                            STR,R3   6,B5

       96     2067    2           STK$->G$EXCFR.REGS = ENVTCB_PARAMS.ENV$->G$TSA.ISA.REGS;

   2067   0 000065  BCC6 000B                            LDB,B3   11,B6
          0 000067  AB83                                 LAB,B2   ,B3
          0 000068  2C30                                 LDV,R2   48
          0 000069  6C44                                 LDV,R6   68
          0 00006A  BB85                                 LAB,B3   ,B5
          0 00006B  3C0E                                 LDV,R3   14
          0 00006C  0008                                 MMM

       97     2068    2           STK$->G$EXCFR.REGS.B3$ = ENVTCB_PARAMS.ENV$->G$TSA.B3$;

   2068   0 00006D  CCC6 000B                            LDB,B4   11,B6
          0 00006F  ACC4 000A                            LDB,B2   10,B4
          0 000071  9CC7 0008                            LDB,B1   STK$,AUTO
          0 000073  AFC1 000F                            STB,B2   15,B1

       98     2069    2           STK$->G$EXCFR.REGS.R3 = ENVTCB_PARAMS.ENV$->G$TSA.R3;
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:14   

   2069   0 000075  CCC6 000B                            LDB,B4   11,B6
          0 000077  E844 0003                            LDR,R6   3,B4
          0 000079  EF41 001A                            STR,R6   26,B1

       99     2070    2           STK$->G$EXCFR.REGS.I = ENVTCB_PARAMS.ENV$->G$TSA.I;

   2070   0 00007B  CCC6 000B                            LDB,B4   11,B6
          0 00007D  D844 0002                            LDR,R5   2,B4
          0 00007F  DF41 0015                            STR,R5   21,B1

      100     2071    2           ENVTCB_PARAMS.ENV$->G$TSA.P$ = ENVTCB_PARAMS.P$;

   2071   0 000081  CCC6 000B                            LDB,B4   11,B6
          0 000083  DC86                                 LDB,B5   ,B6
          0 000084  DFC4 0008                            STB,B5   8,B4

      101     2072    2           END;

   2072   0 000086  0F81 0026                            B        s:2083,PREL

      102     2073
      103     2074    2      ELSE DO;                             /* If Interrupt Save Area             */

      104     2075    2           STK$->G$EXCFR.ISM1 = ENVTCB_PARAMS.ENV$->G$ISA.ISM1;

   2075   0 000088  BCC6 000B                            LDB,B3   11,B6
          0 00008A  C843 0006                            LDR,R4   6,B3
          0 00008C  CF45 0002                            STR,R4   2,B5

      105     2076    2           STK$->G$EXCFR.ISM2 = ENVTCB_PARAMS.ENV$->G$ISA.ISM2;

   2076   0 00008E  BCC6 000B                            LDB,B3   11,B6
          0 000090  D843 0007                            LDR,R5   7,B3
          0 000092  DF45 0003                            STR,R5   3,B5

      106     2077    2           STK$->G$EXCFR.P$ = ENVTCB_PARAMS.ENV$->G$ISA.P$;
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:15   

   2077   0 000094  BCC6 000B                            LDB,B3   11,B6
          0 000096  ACC3 0008                            LDB,B2   8,B3
          0 000098  AFC5 0004                            STB,B2   4,B5

      107     2078    2           STK$->G$EXCFR.S = ENVTCB_PARAMS.ENV$->G$ISA.S;

   2078   0 00009A  BCC6 000B                            LDB,B3   11,B6
          0 00009C  B843 000A                            LDR,R3   10,B3
          0 00009E  BF45 0006                            STR,R3   6,B5

      108     2079    2           STK$->G$EXCFR.REGS = ENVTCB_PARAMS.ENV$->G$ISA.REGS;

   2079   0 0000A0  BCC6 000B                            LDB,B3   11,B6
          0 0000A2  AB83                                 LAB,B2   ,B3
          0 0000A3  2C16                                 LDV,R2   22
          0 0000A4  6C44                                 LDV,R6   68
          0 0000A5  BB85                                 LAB,B3   ,B5
          0 0000A6  3C0E                                 LDV,R3   14
          0 0000A7  0008                                 MMM

      109     2080    2           ENVTCB_PARAMS.ENV$->G$ISA.P$ = ENVTCB_PARAMS.P$;

   2080   0 0000A8  CCC6 000B                            LDB,B4   11,B6
          0 0000AA  AC86                                 LDB,B2   ,B6
          0 0000AB  AFC4 0008                            STB,B2   8,B4

      110     2081    2           END;

      111     2082
      112     2083    1      STK$->G$EXCFR.TRLR = ENVTCB_PARAMS.ECINFO;

   2083   0 0000AD  AB86                                 LAB,B2   ,B6
          0 0000AE  2C06                                 LDV,R2   6
          0 0000AF  6C0A                                 LDV,R6   10
          0 0000B0  BCC7 0008                            LDB,B3   STK$,AUTO
          0 0000B2  3C52                                 LDV,R3   82
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:16   
          0 0000B3  0008                                 MMM

      113     2084
      114     2085    1      IF ENVTCB_PARAMS.ECINFO.P# ~= 0

   2085   0 0000B4  E842 0007                            LDR,R6   7,B2
          0 0000B6  6901 0070                            BEZ,R6   s:2122,PREL

      115     2086    2      THEN DO;

      116     2087    2           IF ENVTCB_PARAMS.ECC >= %G_TCBFULL#

   2087   0 0000B8  D842 0002                            LDR,R5   2,B2
          0 0000BA  5D62                                 CMV,R5   98
          0 0000BB  0801 0008                            BAL      s:2093,PREL

      117     2088    3           THEN DO;

      118     2089    3                STK$->G$EXCFR.TRLR.P# = 0;

   2089   0 0000BD  DCC7 0008                            LDB,B5   STK$,AUTO
          0 0000BF  8745 002D                            CL       45,B5

      119     2090    3                RETURN;

   2090   0 0000C1  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      120     2091    3                END;
      121     2092    3           ELSE DO;

      122     2093    3                CHAR_P# = ENVTCB_PARAMS.ECINFO.P# * 2;/* #bytes of info          */

   2093   0 0000C4  6001                                 SOL,R6   1
          0 0000C5  EF47 000A                            STR,R6   CHAR_P#,AUTO

      123     2094    3                P#=CHAR_P#;

PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:17   
   2094   0 0000C7  EF47 000D                            STR,R6   P#,AUTO

      124     2095    3                STK$ = PINCRW(STK$,SIZEW(G$EXCFR));

   2095   0 0000C9  DCC7 0008                            LDB,B5   STK$,AUTO
          0 0000CB  CBC5 002E                            LAB,B4   46,B5
          0 0000CD  CFC7 0008                            STB,B4   STK$,AUTO

      125     2096    3                IF ENVTCB_PARAMS.ECC ~= %G_EVENT#

   2096   0 0000CF  5901 000A                            BEZ,R5   s:2101,PREL

      126     2097    4                THEN DO;

      127     2098    4                     STK$->G$MOREINFO = ENVTCB_PARAMS.MOREINFO$->G$MOREINFO;

   2098   0 0000D1  DCC2 0008                            LDB,B5   8,B2
          0 0000D3  AB85                                 LAB,B2   ,B5
          0 0000D4  2C00                                 LDV,R2   0
          0 0000D5  BB84                                 LAB,B3   ,B4
          0 0000D6  3C00                                 LDV,R3   0
          0 0000D7  0008                                 MMM

      128     2099    4                     END;

   2099   0 0000D8  0F81 004E                            B        s:2122,PREL

      129     2100    4                ELSE DO;

      130     2101    4                     D$=ENVTCB_PARAMS.MOREINFO$;

   2101   0 0000DA  DCC2 0008                            LDB,B5   8,B2
          0 0000DC  DFC7 000B                            STB,B5   D$,AUTO

      131     2102    4                     IF CHAR_P# <= SIZEC(G$DO.ECCINFO)

   2102   0 0000DE  6D0C                                 CMV,R6   12
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:18   
          0 0000DF  0301 0008                            BG       s:2107,PREL

      132     2103    5                     THEN DO;

      133     2104    5                          STK$->G$MOREINFO = ADDR(G$DO.ECCINFO)->G$MOREINFO;

   2104   0 0000E1  AB85                                 LAB,B2   ,B5
          0 0000E2  2C14                                 LDV,R2   20
          0 0000E3  BB84                                 LAB,B3   ,B4
          0 0000E4  3C00                                 LDV,R3   0
          0 0000E5  0008                                 MMM

      134     2105    5                          END;

   2105   0 0000E6  0F81 0040                            B        s:2122,PREL

      135     2106    5                     ELSE DO;

      136     2107    5                          CHAR_P# = SIZEC(G$DO.ECCINFO);

   2107   0 0000E8  6C0C                                 LDV,R6   12
          0 0000E9  EF47 000A                            STR,R6   CHAR_P#,AUTO

      137     2108    5                          STK$->G$MOREINFO = ADDR(G$DO.ECCINFO)->G$MOREINFO;

   2108   0 0000EB  AB85                                 LAB,B2   ,B5
          0 0000EC  2C14                                 LDV,R2   20
          0 0000ED  BB84                                 LAB,B3   ,B4
          0 0000EE  3C00                                 LDV,R3   0
          0 0000EF  0008                                 MMM

      138     2109    6                          DO WHILE G$DO.CONT;

   2109   0 0000F0  9CC7 000B                            LDB,B1   D$,AUTO
          0 0000F2  82C1 0002                            LB,'4000'X        2,B1
          0 0000F4       4000
          0 0000F5  0581 0031                            BBF      s:2122,PREL
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:19   

      139     2110    6                               STK$ = PINCRC(STK$,CHAR_P#);

   2110   0 0000F7  8CC7 0008                            LDI      STK$,AUTO
          0 0000F9  7031                                 DCL,R7   1
          0 0000FA  8D47 000E                            SDI      P#+1,AUTO
          0 0000FC  F847 000A                            LDR,R7   CHAR_P#,AUTO
          0 0000FE  6C00                                 LDV,R6   0
          0 0000FF  8447 000E                            AID      P#+1,AUTO
          0 000101  7071                                 DCR,R7   1
          0 000102  8D47 0008                            SDI      STK$,AUTO

      140     2111    6                               D$ = G$DO.LNK$;

   2111   0 000104  ECC7 000B                            LDB,B6   D$,AUTO
          0 000106  DC86                                 LDB,B5   ,B6
          0 000107  DFC7 000B                            STB,B5   D$,AUTO

      141     2112    6                               P# = P# - CHAR_P#;

   2112   0 000109  D847 000D                            LDR,R5   P#,AUTO
          0 00010B  D247 000A                            SUB,R5   CHAR_P#,AUTO
          0 00010D  DF47 000D                            STR,R5   P#,AUTO

      142     2113    6                               IF P# <= SIZEC(G$DOCONT.ECCINFO)

   2113   0 00010F  5D18                                 CMV,R5   24
          0 000110  0301 0005                            BG       s:2115,PREL

      143     2114    6                               THEN CHAR_P# = P#;

   2114   0 000112  DF47 000A                            STR,R5   CHAR_P#,AUTO
          0 000114  0F81 0004                            B        s:2116,PREL

      144     2115    6                               ELSE CHAR_P# = SIZEC(G$DOCONT.ECCINFO);

   2115   0 000116  4C18                                 LDV,R4   24
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:20   
          0 000117  CF47 000A                            STR,R4   CHAR_P#,AUTO

      145     2116    6                               STK$->G$MOREINFO = ADDR(G$DOCONT.ECCINFO)->G$MOREINFO;

   2116   0 000119  AB85                                 LAB,B2   ,B5
          0 00011A  2C06                                 LDV,R2   6
          0 00011B  E847 000A                            LDR,R6   CHAR_P#,AUTO
          0 00011D  BCC7 0008                            LDB,B3   STK$,AUTO
          0 00011F  3C00                                 LDV,R3   0
          0 000120  0008                                 MMM

      146     2117    6                               END;

   2117   0 000121  ECC7 000B                            LDB,B6   D$,AUTO
          0 000123  82C6 0002                            LB,'4000'X        2,B6
          0 000125       4000
          0 000126  0551                                 BBT      s:2110,SPREL

      147     2118    5                          END;

      148     2119    4                     END;

      149     2120    3                END;

      150     2121    2           END;

      151     2122    1   END GUE$ENVTCB;

   2122   0 000127  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:21   
--  Include file information  --

   GH_SCHD_M.:E05TOU  is referenced.
   GU_MACROS_M.:E05TOU  is referenced.
   G_ROS_M.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure GUE$ENVTCB.
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:22   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ENVTCB_PARAMS             A-0-0/w UBIN(16)    r     1 CHAR_P#
     B-0-0/w PTR         r     1 D$                        *0-0-0/w STRC(240)   r     1 ENVTCB_PARAMS
     D-0-0/w UBIN(16)    r     1 P#                         8-0-0/w PTR         r     1 STK$
     6-0-0/w PTR         r     1 TCB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$ROS$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(256)   r     1 G$DO                       0-0-0/w STRC(240)   r     1 G$DOCONT
     0-0-0/w STRC(736)   r     1 G$EXCFR                    0-0-0/w STRC(720)   r     1 G$ISA
     0-0-0/c ACHR        r     1 G$MOREINFO                 0-0-0/w STRC(928)   r     1 G$ROS
     0-0-0/w STRC(96)    r     1 G$TCB                      0-0-0/w STRC(928)   r     1 G$TSA


   Procedure GUE$ENVTCB requires 298 words for executable code.
   Procedure GUE$ENVTCB requires 16 words of local(AUTO) storage.

    No errors detected in file GUE$ENVTCB.:E05TSI    .
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:23   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:24   
          MINI XREF LISTING

CHAR_P#
       814**DCL      1960--IMP-SIZ  2093<<ASSIGN   2094>>ASSIGN   2098>>ASSIGN   2098>>ASSIGN   2102>>IF
      2104>>ASSIGN   2104>>ASSIGN   2107<<ASSIGN   2108>>ASSIGN   2108>>ASSIGN   2110>>ASSIGN   2112>>ASSIGN
      2114<<ASSIGN   2115<<ASSIGN   2116>>ASSIGN   2116>>ASSIGN
D$
       815**DCL      1966--IMP-PTR  2029--IMP-PTR  2101<<ASSIGN   2104>>ASSIGN   2108>>ASSIGN   2109>>DOWHILE
      2111<<ASSIGN   2111>>ASSIGN   2116>>ASSIGN
ENVTCB_PARAMS
       686**DCL        29--PROC
ENVTCB_PARAMS.ECC
       686**DCL      2042>>IF       2058>>ASSIGN   2087>>IF       2096>>IF
ENVTCB_PARAMS.ECINFO
       703**DCL      2083>>ASSIGN
ENVTCB_PARAMS.ECINFO.EVID
       729**DCL       747--REDEF     755--REDEF     755--REDEF
ENVTCB_PARAMS.ECINFO.P#
       802**DCL      2048>>IF       2054>>ASSIGN   2085>>IF       2093>>ASSIGN
ENVTCB_PARAMS.ECINFO.SUBC
       706**DCL       706--REDEF     724--REDEF     728--REDEF     728--REDEF
ENVTCB_PARAMS.ENV$
       804**DCL      2063>>ASSIGN   2064>>ASSIGN   2065>>ASSIGN   2066>>ASSIGN   2067>>ASSIGN   2068>>ASSIGN
      2069>>ASSIGN   2070>>ASSIGN   2071>>ASSIGN   2075>>ASSIGN   2076>>ASSIGN   2077>>ASSIGN   2078>>ASSIGN
      2079>>ASSIGN   2080>>ASSIGN
ENVTCB_PARAMS.ENVTYPE
       804**DCL      2061>>IF
ENVTCB_PARAMS.MOREINFO$
       804**DCL      2098>>ASSIGN   2101>>ASSIGN
ENVTCB_PARAMS.P$
       686**DCL      2071>>ASSIGN   2080>>ASSIGN
ENVTCB_PARAMS.P$$
       686**DCL       686--REDEF
ENVTCB_PARAMS.TCB$
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:25   
       804**DCL      2036>>ASSIGN
G$DO.CONT
      1970**DCL      2109>>DOWHILE
G$DO.ECCINFO
      2022**DCL      2102--IF       2104--ASSIGN   2107--ASSIGN   2108--ASSIGN
G$DO.LNK$
      1966**DCL      2111>>ASSIGN
G$DOCONT.ECCINFO
      2029**DCL      2113--IF       2115--ASSIGN   2116--ASSIGN
G$EXCFR
      1592**DCL      2048--IF       2054--ASSIGN   2095--ASSIGN
G$EXCFR.ALTEMPTY
      1597**DCL      2045<<ASSIGN
G$EXCFR.ECC
      1597**DCL      2058<<ASSIGN
G$EXCFR.ISM1
      1615**DCL      2063<<ASSIGN   2075<<ASSIGN
G$EXCFR.ISM2
      1640**DCL      2064<<ASSIGN   2076<<ASSIGN
G$EXCFR.P
      1647**DCL      2065<<ASSIGN
G$EXCFR.P$
      1647**DCL      2077<<ASSIGN
G$EXCFR.P$$
      1647**DCL      1647--REDEF    1647--REDEF
G$EXCFR.PREVSZ
      1597**DCL      1597--REDEF    2052<<ASSIGN
G$EXCFR.REGS
      1686**DCL      2067<<ASSIGN   2079<<ASSIGN
G$EXCFR.REGS.B3$
      1690**DCL      2068<<ASSIGN
G$EXCFR.REGS.I
      1708**DCL      2070<<ASSIGN
G$EXCFR.REGS.R3
      1716**DCL      2069<<ASSIGN
G$EXCFR.S
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:26   
      1665**DCL      2066<<ASSIGN   2078<<ASSIGN
G$EXCFR.TRLR
      1858**DCL      2083<<ASSIGN
G$EXCFR.TRLR.EVID
      1884**DCL      1902--REDEF    1910--REDEF    1910--REDEF
G$EXCFR.TRLR.P#
      1957**DCL      2089<<ASSIGN
G$EXCFR.TRLR.SUBC
      1861**DCL      1861--REDEF    1879--REDEF    1883--REDEF    1883--REDEF
G$ISA.ISM1
      1281**DCL      2075>>ASSIGN
G$ISA.ISM2
      1306**DCL      2076>>ASSIGN
G$ISA.P$
      1314**DCL      2077>>ASSIGN   2080<<ASSIGN
G$ISA.P$$
      1314**DCL      1314--REDEF
G$ISA.REGS
      1356**DCL      2079>>ASSIGN
G$ISA.S
      1335**DCL      2078>>ASSIGN
G$MOREINFO
      1960**DCL      2098<<ASSIGN   2098>>ASSIGN   2104<<ASSIGN   2104>>ASSIGN   2108<<ASSIGN   2108>>ASSIGN
      2116<<ASSIGN   2116>>ASSIGN
G$ROS.AUTO_DS$
      1536**DCL      1537--REDEF
G$ROS.AUTO_T$
      1537**DCL      1537--REDEF
G$ROS.TCB
      1532**DCL      2039--ASSIGN
G$ROS$
       819**DCL      2039>>ASSIGN
G$TCB.ALT$
      1575**DCL      2044>>ASSIGN
G$TCB.AVSZ
      1575**DCL      2048>>IF       2055<<ASSIGN   2055>>ASSIGN
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:27   
G$TCB.CURRSZ
      1576**DCL      2051>>ASSIGN   2052>>ASSIGN   2054<<ASSIGN   2055>>ASSIGN
G$TCB.STK$
      1575**DCL      2051>>ASSIGN   2053<<ASSIGN
G$TSA.B3$
       882**DCL      2068>>ASSIGN
G$TSA.I
       871**DCL      2070>>ASSIGN
G$TSA.ISA.ISM1
       977**DCL      2063>>ASSIGN
G$TSA.ISA.ISM2
      1002**DCL      2064>>ASSIGN
G$TSA.ISA.P$$
      1010**DCL      1010--REDEF
G$TSA.ISA.REGS
      1052**DCL      2067>>ASSIGN
G$TSA.P
       882**DCL      2065>>ASSIGN
G$TSA.P$
       881**DCL      2071<<ASSIGN
G$TSA.P$$
       881**DCL       881--REDEF     882--REDEF
G$TSA.R3
       878**DCL      2069>>ASSIGN
G$TSA.S
       901**DCL      2066>>ASSIGN
P#
       816**DCL      2094<<ASSIGN   2112<<ASSIGN   2112>>ASSIGN   2113>>IF       2114>>ASSIGN
STK$
       813**DCL      2044<<ASSIGN   2045>>ASSIGN   2051<<ASSIGN   2052>>ASSIGN   2053>>ASSIGN   2058>>ASSIGN
      2063>>ASSIGN   2064>>ASSIGN   2065>>ASSIGN   2066>>ASSIGN   2067>>ASSIGN   2068>>ASSIGN   2069>>ASSIGN
      2070>>ASSIGN   2075>>ASSIGN   2076>>ASSIGN   2077>>ASSIGN   2078>>ASSIGN   2079>>ASSIGN   2083>>ASSIGN
      2089>>ASSIGN   2095<<ASSIGN   2095>>ASSIGN   2098>>ASSIGN   2104>>ASSIGN   2108>>ASSIGN   2110<<ASSIGN
      2110>>ASSIGN   2116>>ASSIGN
TCB$
       812**DCL      2036<<ASSIGN   2037>>IF       2039<<ASSIGN   2044>>ASSIGN   2048>>IF       2051>>ASSIGN
PL6.E3A0      #001=GUE$ENVTCB File=GUE$ENVTCB.:E05TSI                            TUE 07/29/97 22:14 Page:28   
      2051>>ASSIGN   2052>>ASSIGN   2053>>ASSIGN   2054>>ASSIGN   2055>>ASSIGN   2055>>ASSIGN   2055>>ASSIGN
