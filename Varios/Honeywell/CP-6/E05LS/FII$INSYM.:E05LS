VERSION E05

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:1    
        1        1        /*M* FII$INSYM Main routine for INSYM ghost */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         FII$INSYM
       10       10
       11       11             PURPOSE:      To provide the main routine for the INSYM ghost
       12       12
       13       13             DESCRIPTION:  The system ghost INSYM is responsible for the
       14       14                           input symbiont host functions of CP6, and also
       15       15                           administers APL shared variables.
       16       16
       17       17                           For the latter function, INSYM is the administrative
       18       18                           user of the APLCG.  See the module FIA$APL.
       19       19
       20       20                           INSYM is the administrative user of the INSYM
       21       21                           comgroup.  Each input symbiont device, whether
       22       22                           remote or local, is connected to this comgroup
       23       23                           when it logs on to CP6, whereupon INSYM is informed
       24       24                           of the connection.
       25       25
       26       26                           Upon connection to the ISCG, the device
       27       27                           is recorded as idle by INSYM.  When the
       28       28                           break or input-ready event is received
       29       29                           from the device, INSYM M$ACTIVATEs it,
       30       30                           which allows the device to be read and
       31       31                           satisfy some of INSYM's anonymous reads
       32       32                           to the ISCG.  Then, if the device has been
       33       33                           defined as a control device, INSYM flushes
       34       34                           until a !JOB or !NCTL card is read.  When
       35       35                           this happens, a DCB is opened to the ap-
       36       36                           propriate place, and cards are written to
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:2    
       37       37                           that DCB as they arrive, until an EOF con-
       38       38                           dition or new !JOB/!NCTL is encountered,
       39       39                           at which time the DCB is closed, thus creating
       40       40                           the new job or file.  Note that once !NCTL
       41       41                           is encountered, EOF (not !JOB/!NCTL) is the
       42       42                           only possible terminator of the file.  Also,
       43       43                           if a card accompanies the EOF condition, and
       44       44                           it starts with '!FIN ', then it is not echoed
       45       45                           into the file.  Lastly, records with an ARS
       46       46                           of zero are echoed into the file.
       47       47
       48       48                           Thus, control devices may submit control files
       49       49                           (via !JOB) or non-control files (via !NCTL).
       50       50                           In the case of a non-control device, only non-
       51       51                           control files may be submitted.  Files are sep-
       52       52                           arated only by EOF, and may begin with !NCTL;
       53       53                           if they do not, the default NCTL FID is used.
       54       54
       55       55                           Note that both types of devices are M$DEACTIVATEd
       56       56                           when EOF is encountered, thus requiring a new
       57       57                           break or input-ready before INSYM will read the
       58       58                           next file.
       59       59
       60       60                           Non-control files are written by INSYM to a FID.
       61       61                           Each device posesses a default NCTL FID, and an
       62       62                           account, both assigned initially by SUPER.  A
       63       63                           control device submitting a file whose first
       64       64                           card is '!NCTL ', and a non-control device whose
       65       65                           first card does not begin '!NCTL ', will submit
       66       66                           a file to the default FID.
       67       67
       68       68                           Both types of devices may submit non-control files
       69       69                           to other than the default FID by having the first
       70       70                           card be one of
       71       71
       72       72                           o '!NCTL FILENAME'
       73       73
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:3    
       74       74                           o '!NCTL DV@WSN[(FORM)]'
       75       75
       76       76                           o '!NTCL DV@[(FORM)]'
       77       77
       78       78                           o '!NCTL FILENAME.ACCN'
       79       79
       80       80                           The first case creates a file FILENAME.ACCT where
       81       81                           ACCT is the device's account.  The second case
       82       82                           writes a file to DV@WSN (e.g. LP@BOSTON).  The
       83       83                           third case writes a file to DV@DEVWSN where DEVWSN
       84       84                           is the device's default NCTL WSN, set up by SUPER.
       85       85                           In the latter two cases, the optional form name
       86       86                           tells INSYM what form to use when writing the
       87       87                           symbiont file.
       88       88                           The fourth case creates a file FILENAME.ACCN.
       89       89
       90       90                           Note the following:
       91       91
       92       92                           o As defined by SUPER, a control device may per-
       93       93                             mit or not permit !NCTL files.
       94       94
       95       95                           o A NCTL file of the form '!NCTL DV@WSN' (from
       96       96                             either type of device) may or may not be legal,
       97       97                             depending upon whether or not the device's
       98       98                             account has access to the desired WSN (if not,
       99       99                             the file is flushed).
      100      100
      101      101                           o An operator may change the device's default
      102      102                             NCTL FID via a keyin.  This enables a device
      103      103                             which is incapable of transmitting a !NCTL
      104      104                             card to send files to various destinations.
      105      105
      106      106                           o For the fourth case, access to 'ACCN' is controlled
      107      107                             through the device's account.  In other words,
      108      108                             the device's account must be authorized to create
      109      109                             the file FILENAME.ACCN
      110      110        */
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:4    
      111      111        /**/
      112      112        FII$INSYM: PROC MAIN;
      113      113        /**/
      114      114
      115      115
      116      116
      117      117        /**/
      118      118        /* INCLUDES */
      119      119        /**/
      120      120        %INCLUDE CP_6;
      121      201        %INCLUDE CP_6_SUBS;
      122      741        %INCLUDE FI_SCODE_C;
      123      758        %INCLUDE JG_EVID_C;
      124      983        %INCLUDE OC_SUBS_C;
      125     1714        %INCLUDE FI_SUBS_C;
      126     1816 S      %INCLUDE B$JIT_C;
      127     1817        %INCLUDE OC_MESSHD_C;
      128     1870        %INCLUDE JG_GHOSTS_C;
      129     1960        %INCLUDE FOO_MAC_C;
      130     2708        %INCLUDE FI_MAC_C;
      131     3078        %INCLUDE FI_DATA_R;
      132     3344        %INCLUDE NK_SUBS;
      133     3369        %INCLUDE F_ERRORS_C;
      134     3609        %INCLUDE KC_SUBS_C;
      135     3625        %INCLUDE KC_ERRORS_C;
      136     3672        %INCLUDE FS$FIT;
      137     3715        %INCLUDE F$DCB;
      138     3764        %INCLUDE JC_MACRO_C;
      139     3878
      140     3879
      141     3880
      142     3881        /**/
      143     3882        /* BASED STRUCTURES */
      144     3883        /**/
      145     3884        %B$JIT0(STCLASS=BASED);
      146     3973        %U$JIT1;
      147     4047        %A$JIT6X;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:5    
      148     4050        %B$TCB;
      149     4053        %B$ALT;
      150     4061    1   DCL B$CHAR5 CHAR(5) BASED ALIGNED;
      151     4062    1   DCL B$CHARS CHAR(I) BASED UNAL;
      152     4063    1   DCL B$CHAR6 CHAR(6) BASED ALIGNED;
      153     4064    1   DCL B$CHAR CHAR(1) BASED UNAL;
      154     4065    1   DCL B$CHAR8 CHAR(8) BASED UNAL;
      155     4066    1   DCL B$CHARSII CHAR(II) BASED UNAL;
      156     4067        %FS$JOBORIG (NAME=FS$JOBORIG,STCLASS=BASED);
      157     4073        %FI_DKEYIN (FPTN=FI$DKEYIN ,STCLASS=BASED);
      158     4102        %FI_DEV    (FPTN=FI$DEV    ,STCLASS=BASED);
      159     4146        %FI_EVNT   (FPTN=FI$EVNT   ,STCLASS=BASED);
      160     4209        %FI_CONINFO(FPTN=FI$CONINFO,STCLASS=BASED);
      161     4253        %B$CGAURD (FPTN=B$CGAURD,LAST=",");
      162     4272        %B$CGAUCI (FPTN=CONINFO,LVL=2,LAST=",");
      163     4294        %FI_CONINFO (FPTN=FIINFO,LVL=2,STCLASS=BASED);
      164     4338        %FI_CITE (FPTN=FI$ISRD,TYP=CGRD,STCLASS=BASED);
      165     4382        %FI_CITE (FPTN=FI$DSMT,TYP=DSMT,STCLASS=BASED);
      166     4426
      167     4427
      168     4428
      169     4429        /**/
      170     4430        /* AUTO */
      171     4431        /**/
      172     4432        %VLP_VECTOR (FPTN=TVEC,STCLASS=AUTO);
      173     4447        %VLP_FORM   (FPTN=OPENFORM,STCLASS=AUTO);
      174     4460    1   DCL DEV$ PTR;
      175     4461    1   DCL KEYIN$ PTR;
      176     4462    1   DCL NDEV UBIN WORD;
      177     4463    1   DCL I UBIN WORD;
      178     4464    1   DCL INFO UBIN WORD;
      179     4465    1   DCL WRITOUT UBIN WORD;
      180     4466    1   DCL ARS UBIN WORD;
      181     4467    1   DCL BUF$ PTR;
      182     4468    1   DCL P$ PTR;
      183     4469    1   DCL JJ UBIN WORD;
      184     4470    1   DCL II UBIN WORD;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:6    
      185     4471    1   DCL CONINFO$ PTR;
      186     4472    1   DCL BTWSN UBIN WORD ALIGNED;
      187     4473    1   DCL BANGDISP UBIN WORD;
      188     4474    1   DCL SAVDEV$ PTR;
      189     4475    1   DCL CITE$ PTR;
      190     4476    1   DCL CGAURD$ PTR;
      191     4477    1   DCL UTS_NOW UBIN WORD STATIC;
      192     4478
      193     4479
      194     4480
      195     4481        /**/
      196     4482        /* STATIC */
      197     4483        /**/
      198     4484    1   DCL GOODNGT SBIN WORD STATIC ALIGNED INIT(0);
      199     4485    1   DCL DEVNAME CHAR(8) STATIC DALIGNED INIT(' ');
      200     4486    1   DCL 1 DEVNAMER REDEF DEVNAME DALIGNED,
      201     4487    1         2 TYP CHAR(2) UNAL,
      202     4488    1         2 NUM CHAR(2) UNAL,
      203     4489    1         2 TWSN# CHAR(4) UNAL;
      204     4490    1   DCL FIDWSN CHAR(8) STATIC DALIGNED;
      205     4491    1   DCL FIDACCT CHAR(8) STATIC DALIGNED;
      206     4492    1   DCL 1 DCBNUMBER STATIC DALIGNED,
      207     4493    1         2 DCB# UBIN WORD UNAL,
      208     4494    1         2 * UBIN WORD UNAL;
      209     4495    1   DCL 1 JOBDEST STATIC ALIGNED,
      210     4496    1         2 * CHAR(4) UNAL INIT('Job '),
      211     4497    1         2 SYSID CHAR(6) UNAL,
      212     4498    1         2 * CHAR(%(%FIMI_NFMX#-10)) UNAL INIT(' ');
      213     4499    1   DCL JOBDESTR REDEF JOBDEST CHAR(%FIMI_NFMX#) ALIGNED;
      214     4500    1   DCL 1 FILDEST STATIC ALIGNED,
      215     4501    1         2 * CHAR(5) UNAL INIT('NCTL '),
      216     4502    1         2 FILE CHAR(%(%FIMI_NFMX#-5)) UNAL;
      217     4503    1   DCL FILDESTR REDEF FILDEST CHAR(%FIMI_NFMX#) ALIGNED;
      218     4504    1   DCL 1 DEVDEST STATIC ALIGNED,
      219     4505    1         2 * CHAR(5) UNAL INIT('NCTL '),
      220     4506    1         2 RES CHAR(2) UNAL,
      221     4507    1         2 * CHAR(1) UNAL INIT('@'),
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:7    
      222     4508    1         2 WSN CHAR(8) UNAL,
      223     4509    1         2 FORM CHAR(08) UNAL,
      224     4510    1         2 FORMR REDEF FORM UNAL,
      225     4511    1           3 O CHAR(1) UNAL,
      226     4512    1           3 NAME CHAR(06) UNAL,
      227     4513    1           3 C CHAR(1) UNAL,
      228     4514    1         2 * CHAR(%(%FIMI_NFMX#-24)) UNAL INIT(' ');
      229     4515    1   DCL DEVDESTR REDEF DEVDEST CHAR(%FIMI_NFMX#) ALIGNED;
      230     4516        %FS$JOBORIG (NAME=OPNATTR,STCLASS=STATIC,SIZ=FIT);
      231     4522        %B$JIT0X (B$JIT0=TJIT,STCLASS=STATIC);
      232     4525        %A$JIT6X;
      233     4528        %OC_MESSHD_D       (NAME=OPMSG_DINFO,
      234     4529                 NPARMS         = 10,
      235     4530            ATR       = M_UR,
      236     4531            MSG       = FI_SYMB_MSG#,
      237     4532            STCLASS   = STATIC);
      238     4545    1         2 * UBIN BYTE UNAL INIT(1),
      239     4546    1         2 * UBIN BYTE UNAL INIT(1),
      240     4547    1         2 * UBIN BYTE UNAL INIT(1),
      241     4548    1         2 * UBIN BYTE UNAL INIT(1),
      242     4549    1         2 * UBIN BYTE UNAL INIT(1),
      243     4550    1         2 * UBIN BYTE UNAL INIT(%(%FIMI_NFMX#-26)),
      244     4551    1         2 * UBIN BYTE UNAL INIT(1),
      245     4552    1         2 * UBIN BYTE UNAL INIT(%(%FIMI_NFMX#-26)),
      246     4553    1         2 * UBIN BYTE UNAL INIT(1),
      247     4554    1         2 * UBIN BYTE UNAL INIT(8),
      248     4555    1         2 STATE UBIN BYTE UNAL,
      249     4556    1         2 FIRST UBIN BYTE UNAL,
      250     4557    1         2 FLUSH UBIN BYTE UNAL,
      251     4558    1         2 NCTL UBIN BYTE UNAL,
      252     4559    1         2 CTL UBIN BYTE UNAL,
      253     4560    1         2 DEST CHAR(%(%FIMI_NFMX#-26)) UNAL,
      254     4561    1         2 PFID UBIN BYTE UNAL,
      255     4562    1         2 NFID CHAR(%(%FIMI_NFMX#-26)) UNAL,
      256     4563    1         2 SUBC UBIN BYTE UNAL,
      257     4564    1         2 TNAME CHAR(8) UNAL;
      258     4565        %OC_MESSHD_D       (NAME=OPMSG_KERR,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:8    
      259     4566            NPARMS    = 4,
      260     4567            ATR       = M_UR,
      261     4568            MSG       = FI_KERR_MSG#,
      262     4569            STCLASS   = STATIC);
      263     4582    1         2 * UBIN BYTE UNAL INIT(1),
      264     4583    1         2 * UBIN BYTE UNAL INIT(2),
      265     4584    1         2 * UBIN BYTE UNAL INIT(1),
      266     4585    1         2 * UBIN BYTE UNAL INIT(8),
      267     4586    1         2 SUBC UBIN BYTE UNAL,
      268     4587    1         2 ERRC UBIN HALF UNAL,
      269     4588    1         2 SUBC1 UBIN BYTE UNAL,
      270     4589    1         2 TNAME CHAR(8) UNAL;
      271     4590        %OC_MESSHD_D       (NAME=OPMSG_TCON,
      272     4591            NPARMS         = 4,
      273     4592            MSG       = FI_TCON_MSG#,
      274     4593            ATR       = M_UR,
      275     4594            STCLASS   = STATIC);
      276     4607    1         2 * UBIN BYTE UNAL INIT(1),
      277     4608    1         2 * UBIN BYTE UNAL INIT(1),
      278     4609    1         2 * UBIN BYTE UNAL INIT(2),
      279     4610    1         2 * UBIN BYTE UNAL INIT(%FIMI_NFMX#),
      280     4611    1         2 SUBC UBIN BYTE UNAL,
      281     4612    1         2 SUBC1 UBIN BYTE UNAL,
      282     4613    1         2 ERRC UBIN HALF UNAL,
      283     4614    1         2 NFID CHAR(%FIMI_NFMX#) UNAL;
      284     4615        %OC_MESSHD_D            (NAME=OPMSG_JBFL,
      285     4616                 NPARMS    = 3,
      286     4617                 MSG       = FI_JBFL_MSG#,
      287     4618                 ATR       = M_UR,
      288     4619                 STCLASS   = STATIC);
      289     4632    1         2 * UBIN BYTE UNAL INIT(2),
      290     4633    1         2 * UBIN BYTE UNAL INIT(2),
      291     4634    1         2 * UBIN BYTE UNAL INIT(%FIMI_NFMX#),
      292     4635    1         2 SUBC UBIN HALF UNAL,
      293     4636    1         2 ERRC UBIN HALF UNAL,
      294     4637    1         2 DEST CHAR(%FIMI_NFMX#) UNAL;
      295     4638        %OC_MESSHD_D            (NAME=OPMSG_JBSB,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:9    
      296     4639                 NPARMS    = 1,
      297     4640                 MSG       = FI_JBSB_MSG#,
      298     4641                 ATR       = M_UR,
      299     4642                 STCLASS   = STATIC);
      300     4655    1         2 * UBIN BYTE UNAL INIT(%FIMI_NFMX#),
      301     4656    1         2 DEST CHAR(%FIMI_NFMX#) UNAL;
      302     4657        %OC_MESSHD_D            (NAME=OPMSG_RESP,
      303     4658                 NPARMS    = 3,
      304     4659                 MSG       = FI_RESP_MSG#,
      305     4660                 ATR       = M_UR,
      306     4661                 STCLASS   = STATIC);
      307     4674    1         2 * UBIN BYTE UNAL INIT(2),
      308     4675    1         2 * UBIN BYTE UNAL INIT(2),
      309     4676    1         2 * UBIN BYTE UNAL INIT(%FIMI_NFMX#),
      310     4677    1         2 SUBC UBIN HALF UNAL,
      311     4678    1         2 SUBC1 UBIN HALF UNAL,
      312     4679    1         2 FID CHAR(%FIMI_NFMX#) UNAL;
      313     4680        %OC_MESSHD_D            (NAME=OPMSG_UNIMP,
      314     4681                 NPARMS    = 0,
      315     4682                 MSG       = UNIMP_MSG#,
      316     4683                 DELIM     =";",
      317     4684                 STCLASS   = STATIC);
      318     4697
      319     4698
      320     4699
      321     4700        /**/
      322     4701        /* CONSTANT */
      323     4702        /**/
      324     4703    1   DCL EODCARD CHAR(4) CONSTANT ALIGNED INIT('!EOD');
      325     4704        %JC_CITE (FPTN=JC_PCMP,TYP=PCMP,COD=JCEV_PCMP#,USR=JG_INSYM#,STCLASS=CONSTANT);
      326     4754        %OC_MESSHD_D            (NAME=ZAPRESP,
      327     4755                 FUNC      = ZAP,
      328     4756                 DELIM     =";",
      329     4757                 STCLASS   = CONSTANT);
      330     4770
      331     4771
      332     4772
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:10   
      333     4773        /**/
      334     4774        /* DCBS */
      335     4775        /**/
      336     4776    1   DCL M$ISCG DCB;
      337     4777    1   DCL M$CSCG DCB;
      338     4778    1   DCL M$APLCG DCB;
      339     4779
      340     4780
      341     4781
      342     4782        /**/
      343     4783        /* REFS */
      344     4784        /**/
      345     4785    1   DCL B$JIT$ PTR SYMREF;
      346     4786    1   DCL B$TCB$ PTR SYMREF;
      347     4787        %FI_APLMSG (FPTN=FI_APLCGBUF,STCLASS=SYMREF);
      348     4817
      349     4818    1   DCL FIA$APLAU     ENTRY;
      350     4819    1   DCL FIA$APLRD     ENTRY;
      351     4820    1   DCL FIA$INIT      ENTRY;
      352     4821    1   DCL FIA$ZAP       ENTRY;
      353     4822    1   DCL FIE$EVNT      ENTRY    ASYNC;
      354     4823    1   DCL FIE$XCON      ENTRY    ASYNC;
      355     4824    1   DCL FOI$GBUF      ENTRY(2) ALTRET;
      356     4825    1   DCL FOI$LDTRC     ENTRY(4) ALTRET;
      357     4826    1   DCL FOI$RBUF      ENTRY(2) ALTRET;
      358     4827    1   DCL FOI$SNAP      ENTRY(4) ALTRET;
      359     4828
      360     4829
      361     4830
      362     4831        /**/
      363     4832        /* PMME FPTS */
      364     4833        /**/
      365     4834        %FPT_XCON                              (FPTN=XCONSET,
      366     4835                 STCLASS   = CONSTANT,
      367     4836                 UENTRY    = FIE$XCON);
      368     4850        %FPT_EVENT                             (FPTN=EVENTSET,
      369     4851                 UENTRY    = FIE$EVNT,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:11   
      370     4852                 STCLASS   = CONSTANT);
      371     4866        %FPT_WAIT                              (FPTN=SLEEP1,
      372     4867                 UNITS     = 1,
      373     4868                 STCLASS   = CONSTANT);
      374     4882        %FPT_WAIT                              (FPTN=SLEEP,
      375     4883                 UNITS     = 1000,
      376     4884                 STCLASS   = CONSTANT);
      377     4898        %FPT_TIME                             (FPTN=GET_UTS,
      378     4899                 STCLASS = STATIC,
      379     4900                 SOURCE = CLOCK,
      380     4901                 DEST = UTS,
      381     4902                 TSTAMP = UTS_NOW);
      382     4921        %FPT_OPEN                              (FPTN=OPEN_CSCG,
      383     4922                 DCB       = M$CSCG,
      384     4923                 SCRUB     = YES,
      385     4924                 NAME      = CSCGNAME,
      386     4925                 ACCT      = FI_SYSACCT,
      387     4926                 SETSTA    = INSYMNAMECS,
      388     4927                 ASN       = COMGROUP,
      389     4928                 STCLASS   = CONSTANT);
      390     5037        %VLP_SETSTA                            (FPTN=INSYMNAME,
      391     5038                 MYSTATION = 'INSYM',
      392     5039                 DIRONLY   = NO,
      393     5040                 STCLASS   = CONSTANT);
      394     5068        %VLP_SETSTA                           (FPTN=INSYMNAMECS,
      395     5069                 DIRONLY   = YES,
      396     5070                 WAS       = YES,
      397     5071                 MYSTATION = 'INSYM',
      398     5072                 OSTATION  = 'KEYIN',
      399     5073                 STCLASS   = CONSTANT);
      400     5101        %FPT_OPEN                              (FPTN=OPEN_ISCG,
      401     5102                 DCB       = M$ISCG,
      402     5103                 SHARE     = ALL,
      403     5104                 SCRUB     = YES,
      404     5105                 CTG       = YES,
      405     5106                 IXTNSIZE  = %FIMI_CIXT#,
      406     5107                 AU        = YES,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:12   
      407     5108                 NAME      = ISCGNAME,
      408     5109                 ACCT      = FI_SYSACCT,
      409     5110                 SETSTA    = INSYMNAME,
      410     5111                 ASN       = COMGROUP,
      411     5112                 ORG       = TERMINAL,
      412     5113                 FUN       = CREATE,
      413     5114                 EXIST     = NEWFILE,
      414     5115                 ACCESS    = ISCG_ACCESS,
      415     5116                 STCLASS   = CONSTANT);
      416     5225        %VLP_ATTR                             (FPTN=ISCG_ACCESS);
      417     5239        %VLP_ACCESS                           (STCLASS=CONSTANT,
      418     5240                 READ      = NO,
      419     5241                 UPD       = NO,
      420     5242                 WNEW      = NO,
      421     5243                 DELR      = NO,
      422     5244                 DELF      = NO,
      423     5245                 REATTR    = NO,
      424     5246                 EXEC      = NO,
      425     5247                 ACCT      = '?',
      426     5248                 LAST      =";");
      427     5265        %VLP_CGCP                             (FPTN=ISCGCP,
      428     5266                 TMTYP     = ' ',
      429     5267                 DMTYP     = ' ',
      430     5268                 MAXPG     = %FIMI_CIMP#,
      431     5269                 DISKWARN  = %FIMI_CXMP#,
      432     5270                 MEMWARN   = %FIMI_CXMP#,
      433     5271                 DATAPGS   =10,
      434     5272                 DSCREQ    = YES,
      435     5273                 CONMSG    = YES,
      436     5274                 TERMCONAU = NO,
      437     5275                 DCBCONAU  = NO,
      438     5276                 TERMCONNAU= NO,
      439     5277                 DCBCONNAU = NO,
      440     5278                 AUCONTERM = NC,
      441     5279                 AUCONDCB  = NC,
      442     5280                 AUDCONTERM= DEACTIVATE,
      443     5281                 AUDCONDCB = NC,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:13   
      444     5282                 XSTALGL   = YES,
      445     5283                 WAS       = NO,
      446     5284                 RAS       = NO,
      447     5285                 SMD       = NO,
      448     5286                 XTYPLGL   = YES,
      449     5287                 MAXMC     = 1024,
      450     5288                 TERMCONLGL= YES,
      451     5289                 DCBCONLGL = NO,
      452     5290                 INPUT     = YES,
      453     5291                 OUTPUT    = NO,
      454     5292                 SECURE    = NO,
      455     5293                 STCLASS   = STATIC);
      456     5336        %FPT_CGCTL                            (FPTN=CTL_ISCG,
      457     5337                 DCB       = M$ISCG,
      458     5338                 CGCP      = ISCGCP,
      459     5339                 STCLASS   = CONSTANT);
      460     5362        %VLP_NAME          (FPTN=CSCGNAME,
      461     5363                 NAME      = 'CSCG',
      462     5364                 STCLASS   = CONSTANT);
      463     5391        %FPT_EXTEND                           (FPTN=EXTEND_ISCG,
      464     5392                 DCB       = M$ISCG,
      465     5393                 SIZ       = %FIMI_CXXT#,
      466     5394                 STCLASS   = CONSTANT);
      467     5408        %VLP_NAME          (FPTN=ISCGNAME,
      468     5409                 NAME      = 'ISCG',
      469     5410                 STCLASS   = CONSTANT);
      470     5437        %FPT_READ                              (FPTN=READ_ISCG,
      471     5438                 DCB       = M$ISCG,
      472     5439                 BUF       = FI_ISCGBUF,
      473     5440                 WAIT      = NO,
      474     5441                 EVENT     = FI_ISRD#,
      475     5442                 STCLASS   = CONSTANT);
      476     5481        %FPT_ACTIVATE                          (FPTN=DISCT_DEV,
      477     5482            DCB       = M$ISCG,
      478     5483            STATION   = DEVNAME,
      479     5484            DISCONNECT= YES,
      480     5485            STCLASS   = CONSTANT);
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:14   
      481     5508        %FPT_ACTIVATE                          (FPTN=START_DEV,
      482     5509                 DCB       = M$ISCG,
      483     5510                 STATION   = DEVNAME,
      484     5511                 STCLASS   = CONSTANT);
      485     5534        %FPT_ACTIVATE                          (FPTN=STOP_DEV,
      486     5535                 DCB       = M$ISCG,
      487     5536                 STATION   = DEVNAME,
      488     5537                 STCLASS   = CONSTANT);
      489     5560        %FPT_WRITE                             (FPTN=WRITE_ZAPRESP,
      490     5561                 DCB       = M$CSCG,
      491     5562                 BUF       = ZAPRESP,
      492     5563                 STCLASS   = CONSTANT);
      493     5594        %FPT_WRITE                             (FPTN=OCMSG_DINFO,
      494     5595                 BUF       = OPMSG_DINFO,
      495     5596                 DCB       = M$CSCG,
      496     5597                 STCLASS   = CONSTANT);
      497     5628        %FPT_WRITE                             (FPTN=OCMSG_KERR,
      498     5629                 BUF       = OPMSG_KERR,
      499     5630                 DCB       = M$CSCG,
      500     5631                 STCLASS   = CONSTANT);
      501     5662        %FPT_WRITE                             (FPTN=OCMSG_TCON,
      502     5663                 BUF       = OPMSG_TCON,
      503     5664                 DCB       = M$CSCG,
      504     5665                 STCLASS   = CONSTANT);
      505     5696        %FPT_WRITE                             (FPTN=OCMSG_JBFL,
      506     5697                 BUF       = OPMSG_JBFL,
      507     5698                 DCB       = M$CSCG,
      508     5699                 STCLASS   = CONSTANT);
      509     5730        %FPT_WRITE                             (FPTN=OCMSG_JBSB,
      510     5731                 BUF       = OPMSG_JBSB,
      511     5732                 DCB       = M$CSCG,
      512     5733                 STCLASS   = CONSTANT);
      513     5764        %FPT_WRITE                             (FPTN=OCMSG_RESP,
      514     5765                 BUF       = OPMSG_RESP,
      515     5766                 DCB       = M$CSCG,
      516     5767                 STCLASS   = CONSTANT);
      517     5798        %FPT_WRITE                             (FPTN=OCMSG_UNIMP,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:15   
      518     5799                 STCLASS   = CONSTANT,
      519     5800                 DCB       = M$CSCG,
      520     5801                 BUF       = OPMSG_UNIMP);
      521     5832        %FPT_GETDCB                            (FPTN=GET_DCB,
      522     5833                 STCLASS   = STATIC,
      523     5834                 DCBNUM    = DCBNUMBER);
      524     5849        %FPT_RELDCB                            (FPTN=REL_DCB,
      525     5850                 STCLASS   = STATIC);
      526     5864        %FPT_OPEN                              (FPTN=OPENIT,
      527     5865                 SCRUB     = YES,
      528     5866                 EXIST     = OLDFILE,
      529     5867                 FUN       = CREATE,
      530     5868                 UATTR     = OPNATTR,
      531     5869                 XTNSIZE   = 20,
      532     5870                 STCLASS   = STATIC);
      533     5979        %VLP_NAME               (FPTN=FIDNAME,
      534     5980                 NAME      = '1111111111111111111111111111111',
      535     5981                 STCLASS   = STATIC);
      536     6008        %FPT_FID                               (FPTN=FIDIT,
      537     6009                 NAME      = FIDNAME,
      538     6010                 ACCT      = FIDACCT,
      539     6011                 ASN       = OPENIT.V.ASN#,
      540     6012                 RES       = OPENIT.V.RES#,
      541     6013                 RESULTS   = VLR_FIDIT,
      542     6014                 WSN       = FIDWSN);
      543     6037        %VLR_FID                (FPTN=VLR_FIDIT,
      544     6038                 STCLASS   = STATIC);
      545     6057        %FPT_WRITE                             (FPTN=WRITEIT,
      546     6058                 STCLASS   = STATIC);
      547     6089        %FPT_CLOSE                             (FPTN=CLOSE_REL,
      548     6090                 STCLASS   = STATIC);
      549     6132        %FPT_CLOSE                             (FPTN=CLOSE_SAV,
      550     6133                 DISP      = SAVE,
      551     6134                 RELG      = YES,
      552     6135                 STCLASS   = STATIC);
      553     6177        %FPT_MADMUCK                          (FPTN=FIND_PSN,
      554     6178                 STCLASS = STATIC,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:16   
      555     6179                 READ = YES,
      556     6180                 SN = VLP_SN);
      557     6196        %VLP_SN                               (FPTN=VLP_SN,
      558     6197                 STCLASS = STATIC,
      559     6198                 N = 1);
      560     6211        %FPT_RESCTL                           (FPTN=REL_PSN,
      561     6212                 STCLASS   = CONSTANT,
      562     6213                 RPSN      = VLP_RPSN);
      563     6230        %VLP_RPSN                             (FPTN=VLP_RPSN,
      564     6231                 STCLASS   = STATIC,
      565     6232                 DISP      = REL,
      566     6233                 N         = 1);
      567     6248        %FPT_PRIV                              (FPTN=PRIVZAP,
      568     6249                 PRIV      = %PR_FMSEC#,
      569     6250                 STCLASS   = CONSTANT);
      570     6265        %FPT_READ                             (FPTN=READ_APLCG,
      571     6266                 DCB       = M$APLCG,
      572     6267                 WAIT      = NO,
      573     6268                 EVENT     = FI_APLRD#,
      574     6269                 BUF       = FI_APLCGBUF,
      575     6270                 STCLASS   = STATIC);
      576     6309        %FPT_READ                             (FPTN=READ_CSCG,
      577     6310                 DCB       = M$CSCG,
      578     6311                 WAIT      = NO,
      579     6312                 EVENT     = FI_CSRD#,
      580     6313                 BUF       = FI_CSCGBUF,
      581     6314                 STCLASS   = STATIC);
      582     6353        %FPT_ACTIVATE                         (FPTN=DSCGO_DEV,
      583     6354                 DCB       = M$ISCG,
      584     6355                 STATION   = DEVNAME,
      585     6356                 DSCGO     = YES,
      586     6357                 DISCONNECT= NO,
      587     6358                 STCLASS   = CONSTANT);
      588     6381        %FPT_WRITE                             (FPTN=SEND_PCMP,
      589     6382                 STCLASS   = CONSTANT,
      590     6383                 DCB       = M$CSCG,
      591     6384                 BUF       = JC_PCMP,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:17   
      592     6385                 STATION   = SLUGNAME);
      593     6416        %VLP_STATION       (FPTN=SLUGNAME,
      594     6417                 STCLASS   = CONSTANT,
      595     6418                 STATION   = 'SLUG  ');
      596     6445
      597     6446
      598     6447
      599     6448        /**/
      600     6449        /* SUBS */
      601     6450        /**/
      602     6451        %SUB F_FI='0611'O;
      603     6452        %SUB M_I='11'O;
      604     6453        %SUB B$ERRCODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE;
      605     6454        %SUB EVNT$ = FI_EVNT$;
      606     6455        %EQU_CG;
      607     6503        %SUB FOREVER="WHILE ('1'B)";
      608     6504        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:18   
      609     6505        /**/
      610     6506        /*
      611     6507
      612     6508             ###    #   #    ###    #   #   #   #
      613     6509              #     #   #   #   #   #   #   ## ##
      614     6510              #     ##  #   #        # #    # # #
      615     6511              #     # # #    ###      #     #   #
      616     6512              #     #  ##       #     #     #   #
      617     6513              #     #   #   #   #     #     #   #
      618     6514             ###    #   #    ###      #     #   #
      619     6515
      620     6516             ###    #   #    ###    #####
      621     6517              #     #   #     #       #
      622     6518              #     ##  #     #       #
      623     6519              #     # # #     #       #
      624     6520              #     #  ##     #       #
      625     6521              #     #   #     #       #
      626     6522             ###    #   #    ###      #
      627     6523
      628     6524        */
      629     6525
      630     6526
      631     6527        /**/
      632     6528        /* BEGIN HERE */
      633     6529        /**/
      634     6530
      635     6531
      636     6532                                /* EXIT IF NOT OURSELF */
      637     6533    1         IF B$JIT$->B$JIT.USER ~= JG_INSYM# THEN CALL M$EXIT;
      638     6534
      639     6535                                /* GET XCON */
      640     6536    1         CALL M$XCON (XCONSET);
      641     6537                                /* SET UP GOODIES */
      642     6538    1         CALL MISC_SETUP;
      643     6539                                /* GET EVENT CONTROL */
      644     6540    1         CALL M$EVENT (EVENTSET);
      645     6541                                /* CONNECT TO CS COMGROUP */
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:19   
      646     6542    1         CALL M$OPEN (OPEN_CSCG);
      647     6543                                /* CONNECT TO INSYM COMGROUP */
      648     6544    1         CALL M$OPEN (OPEN_ISCG);
      649     6545    1         CALL M$CGCTL (CTL_ISCG);
      650     6546                                /* INITIATE CSCG READS */
      651     6547    1         CALL M$READ (READ_CSCG);
      652     6548                                /* START READS ON ISCG */
      653     6549    1         CALL M$READ (READ_ISCG);
      654     6550                                /* START UP APLCG STUFF */
      655     6551    1         CALL FIA$INIT;
      656     6552    1         CALL M$READ (READ_APLCG);
      657     6553                                /* TELL SLUG OUR INIT IS FINI */
      658     6554    1         CALL M$WRITE (SEND_PCMP);
      659     6555        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:20   
      660     6556        /*
      661     6557
      662     6558                    #   #    ###     ###    #   #
      663     6559                    ## ##   #   #     #     #   #
      664     6560                    # # #   #   #     #     ##  #
      665     6561                    #   #   #####     #     # # #
      666     6562                    #   #   #   #     #     #  ##
      667     6563                    #   #   #   #     #     #   #
      668     6564                    #   #   #   #    ###    #   #
      669     6565
      670     6566
      671     6567                    #        ###     ###    ####
      672     6568                    #       #   #   #   #   #   #
      673     6569                    #       #   #   #   #   #   #
      674     6570                    #       #   #   #   #   ####
      675     6571                    #       #   #   #   #   #
      676     6572                    #       #   #   #   #   #
      677     6573                    #####    ###     ###    #
      678     6574
      679     6575        */
      680     6576    2           DO FOREVER;
      681     6577    3             DO INHIBIT;
      682     6578    3             IF FI_EVHD$=ADDR(NIL) THEN
      683     6579    3              CALL M$WAIT(SLEEP);
      684     6580    3             ELSE
      685     6581    4               DO;
      686     6582    4               EVNT$=FI_EVHD$;
      687     6583    4               FI_EVHD$=EVNT$->FI$EVNT.LNK$;
      688     6584    4               IF FI_EVHD$=ADDR(NIL) THEN FI_EVTL$=ADDR(NIL);
      689     6585    4               CALL EXT_EVENT;
      690     6586    5                 DO CASE (EVNT$->FI$EVNT.ENDAC);
      691     6587    5                   CASE (FIEA_CSCG#);
      692     6588    5                     CALL M$READ (READ_CSCG);
      693     6589    5                   CASE (FIEA_ISCG#);
      694     6590    5                     CALL M$READ (READ_ISCG);
      695     6591    5                   CASE (FIEA_APLCG#);
      696     6592    5                     IF GOODNGT = 0 THEN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:21   
      697     6593    5                      CALL M$READ (READ_APLCG);
      698     6594    5                 END;
      699     6595    4               IF FI_FEVTL$=ADDR(NIL) THEN FI_FEVHD$=EVNT$;
      700     6596    4               ELSE FI_FEVTL$->FI$EVNT.LNK$=EVNT$;
      701     6597    4               FI_FEVTL$=EVNT$;
      702     6598    4               EVNT$->FI$EVNT.LNK$=ADDR(NIL);
      703     6599    4               END;
      704     6600    3             END;
      705     6601    2           END;
      706     6602        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:22   
      707     6603        /*
      708     6604
      709     6605            #####   #   #   #####   #####   ####    #   #    ###    #
      710     6606            #       #   #     #     #       #   #   #   #   #   #   #
      711     6607            #        # #      #     #       #   #   ##  #   #   #   #
      712     6608            ####      #       #     ####    ####    # # #   #####   #
      713     6609            #        # #      #     #       # #     #  ##   #   #   #
      714     6610            #       #   #     #     #       #  #    #   #   #   #   #
      715     6611            #####   #   #     #     #####   #   #   #   #   #   #   #####
      716     6612
      717     6613
      718     6614                    #####   #   #   #####   #   #   #####
      719     6615                    #       #   #   #       #   #     #
      720     6616                    #       #   #   #       ##  #     #
      721     6617                    ####    #   #   ####    # # #     #
      722     6618                    #       #   #   #       #  ##     #
      723     6619                    #        # #    #       #   #     #
      724     6620                    #####     #     #####   #   #     #
      725     6621
      726     6622        */
      727     6623
      728     6624
      729     6625        /*****
      730     6626         *****
      731     6627         *****
      732     6628         *****   PROCESS THE EVENT HERE
      733     6629         *****
      734     6630         *****
      735     6631         *****/
      736     6632
      737     6633
      738     6634    1   EXT_EVENT: PROC;
      739     6635
      740     6636
      741     6637
      742     6638    2         DEV$=ADDR(NIL);
      743     6639    2         CITE$=EVNT$->FI$EVNT.CITE$;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:23   
      744     6640    3           DO CASE (EVNT$->FI$EVNT.CODE);
      745     6641
      746     6642
      747     6643
      748     6644
      749     6645
      750     6646        /***
      751     6647         ***
      752     6648         ***
      753     6649         ***          ISCG ADMIN USER EVENT
      754     6650         ***
      755     6651         ***
      756     6652         ***/
      757     6653    3             CASE (FIEV_ISAU#);
      758     6654
      759     6655    3               CGAURD$=ADDR(FI_ISCGBUF);
      760     6656    3               INFO=CGAURD$->B$CGAURD.INFO;
      761     6657    3               DEVNAME=CGAURD$->B$CGAURD.STATION;
      762     6658
      763     6659                                /* VECTOR ON EVENT SUBCODE */
      764     6660
      765     6661    4                 DO CASE (CGAURD$->B$CGAURD.EVENT);
      766     6662        /**
      767     6663         **
      768     6664         **      TERMINAL CONNECT
      769     6665         **
      770     6666         **/
      771     6667    4                   CASE (%CG_TCON#);
      772     6668
      773     6669    4                     CONINFO$=ADDR(CGAURD$->B$CGAURD.FIINFO);
      774     6670    4                     CALL ADD_DEV ALTRET(A10);
      775     6671    4                     GOTO ENDEVENT;
      776     6672                                /* DEVICE IS ALREADY LISTED. OOPS */
      777     6673    4   A10:              CALL FOI$SNAP (%S$FIDBLCON,F_FI,M_I);
      778     6674        /*S* SCREECH_CODE: FII-S$FIDBLCON
      779     6675             TYPE:         SNAP
      780     6676             MESSAGE:      Device connected to IS CG twice
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:24   
      781     6677             REMARKS:      INSYM  received a device-connect event as IS CG
      782     6678                           admin user, but the named device is already
      783     6679                           listed in his tables, implying the device
      784     6680                           connect event has been received twice.   */
      785     6681        /**
      786     6682         **
      787     6683         **      TERMINAL DISCONNECT REQUEST
      788     6684         **
      789     6685         **/
      790     6686    4                   CASE (%CG_TDRQ#);
      791     6687    4                     CALL FIND_DEV ALTRET(NODEV);
      792     6688    4                     CALL M$DEACTIVATE (DSCGO_DEV) ALTRET(ENDEVENT);
      793     6689        /**
      794     6690         **
      795     6691         **      TERMINAL DISCONNECT
      796     6692         **
      797     6693         **/
      798     6694    4                   CASE (%CG_TDSC#);
      799     6695
      800     6696    4                     CALL FIND_DEV ALTRET(ENDEVENT);
      801     6697    4                     DCBNUMBER.DCB#=0;
      802     6698    4                     IF DEV$->FI$DEV.STATE = FIS_BUSY# THEN
      803     6699    5                       DO;
      804     6700    5                       IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD THEN
      805     6701    6                         DO;
      806     6702    6                         CLOSE_REL.V.DCB#=DEV$->FI$DEV.DCB#;
      807     6703    6                         CALL M$CLOSE (CLOSE_REL) ALTRET(A11);
      808     6704    6                         CALL REL_RES;
      809     6705    6   A11:                  ;
      810     6706    6                         END;
      811     6707    5                       DCBNUMBER.DCB#=DEV$->FI$DEV.DCB#;
      812     6708    5                       END;
      813     6709
      814     6710    4                     CALL REM_DEV;
      815     6711    4                     OPMSG_TCON.DEVNM=DEVNAME;
      816     6712    4                     OPMSG_TCON.SUBC=1;
      817     6713    4                     OPMSG_TCON.SUBC1=FITD_NRML#;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:25   
      818     6714    4                     CALL M$WRITE (OCMSG_TCON);
      819     6715    4                     IF DCBNUMBER.DCB# ~= 0 THEN GOTO TAKEDCB1;
      820     6716        /**
      821     6717         **
      822     6718         **      TERMINAL BREAK
      823     6719         **
      824     6720         **/
      825     6721    4                   CASE (%CG_TBRK#);
      826     6722
      827     6723    4                     CALL FIND_DEV ALTRET(NODEV);
      828     6724
      829     6725    4                     IF INFO = %CG_TBRK_EC# THEN
      830     6726                                /* CONTROL-Y : DISCONNECT IT */
      831     6727    5                       DO;
      832     6728    5                       CALL M$DEACTIVATE (DISCT_DEV) ALTRET(ENDEVENT);
      833     6729    5                       GOTO ENDEVENT;
      834     6730    5                       END;
      835     6731
      836     6732    4                     IF (INFO = %CG_TBRK_BRK# OR INFO = %CG_TBRK_RDY#)
      837     6733    4                     AND DEV$->FI$DEV.STATE = FIS_IDLE# THEN
      838     6734                                /* INPUT READY EVENT ON IDLE DEVICE */
      839     6735    5                       DO;
      840     6736    5                       IF B$JIT$->B$JIT.USERWORD(0) = 0 THEN
      841     6737    6                         DO;
      842     6738    6                         DEV$->FI$DEV.FLG.READY='1'B;
      843     6739    6                         GOTO ENDEVENT;
      844     6740    6                         END;
      845     6741    5                       CALL STARTIT;
      846     6742    5                       END;
      847     6743
      848     6744                                /* UNKN EVENT. IGNORE */
      849     6745    4                     GOTO ENDEVENT;
      850     6746
      851     6747                                /* CANNOT FIND DEVICE.  SNAP */
      852     6748    4   NODEV:            ;
      853     6749    4                     CALL FOI$SNAP (%S$FINODEV,F_FI,M_I);
      854     6750        /*S* SCREECH_CODE: FII-S$FINODEV
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:26   
      855     6751             TYPE:         SNAP
      856     6752             MESSAGE:      INSYM cannot find evented device
      857     6753             REMARKS:      INSYM has received an ISCG administrative user
      858     6754                           event or ISCG read-complete event for a device
      859     6755                           not listed in its tables. */
      860     6756        /**
      861     6757         **
      862     6758         **      COMGROUP LOW-ON-SPACE WARNING
      863     6759         **
      864     6760         **/
      865     6761    4                   CASE (%CG_WARN#);
      866     6762    4                     CALL M$EXTEND (EXTEND_ISCG) ALTRET(XTNDALT);
      867     6763    4   XTNDALT:          ;
      868     6764    4                     ISCGCP.MAXPG#=ISCGCP.MAXPG#+%FIMI_CXMP#;
      869     6765    4                     CALL M$CGCTL (CTL_ISCG) ALTRET(XTNDALT0);
      870     6766    4   XTNDALT0:         ;
      871     6767        /**
      872     6768         **
      873     6769         **      ELSE CASE
      874     6770         **
      875     6771         **/
      876     6772
      877     6773    4                   CASE (ELSE);
      878     6774    4                     CALL FOI$SNAP (%S$FIUAUEV,F_FI,M_I);
      879     6775        /*S* SCREECH_CODE: FII-S$FIUAUEV
      880     6776             TYPE:         SNAP
      881     6777             MESSAGE:      Unknown ISAU event passed to INSYM
      882     6778             REMARKS:      INSYM  has received an INSYM  COMGROUP administrative
      883     6779                           user event which he does not recognize.  This sug-
      884     6780                           gests that the path between he and the event issuer
      885     6781                           has been clobbered somewhere, or that someone has
      886     6782                           added a new event INSYM  does not know about and
      887     6783                           was not expected to get.                */
      888     6784        /***
      889     6785         ***
      890     6786         ***     END OF ISAU ADMIN USER EVENT SUBC DOCASE
      891     6787         ***
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:27   
      892     6788         ***/
      893     6789    4                 END;
      894     6790        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:28   
      895     6791        /***
      896     6792         ***
      897     6793         ***
      898     6794         ***          KEYIN RECEIVED
      899     6795         ***
      900     6796         ***
      901     6797         ***/
      902     6798    3             CASE (FIEV_KEYIN#);
      903     6799
      904     6800    3               KEYIN$=CITE$;
      905     6801    3               OPMSG_KERR.CADDR=KEYIN$->FI$DKEYIN.CADDR;
      906     6802    3               DEVNAME=KEYIN$->FI$DKEYIN.NAME;
      907     6803
      908     6804    4                 DO CASE (KEYIN$->FI$DKEYIN.KIN#);
      909     6805        /**
      910     6806         **
      911     6807         ** 'SYMB' KEYINs
      912     6808         **
      913     6809         **/
      914     6810    4                   CASE (KEY_SYMBITERM#);
      915     6811    4                     DEVNAME=KEYIN$->FI$DKEYIN.NAME;
      916     6812    4                     OPMSG_DINFO.TNAME=KEYIN$->FI$DKEYIN.TERM.TNAME;
      917     6813    4                     OPMSG_DINFO.SUBC=1;
      918     6814    4                     GOTO SYMBI;
      919     6815    4                   CASE (KEY_SYMBI#);
      920     6816
      921     6817    4                     OPMSG_DINFO.SUBC=0;
      922     6818    4   SYMBI:            ;
      923     6819    4                     OPMSG_DINFO.CADDR=KEYIN$->FI$DKEYIN.CADDR;
      924     6820
      925     6821    4                     NDEV=0;
      926     6822
      927     6823    4                     DEV$=FI_DEVHD$;
      928     6824    5                       DO WHILE (DEV$ ~= ADDR(NIL));
      929     6825
      930     6826    5                       IF DEV$->FI$DEV.TNAME = KEYIN$->FI$DKEYIN.TERM.TNAME
      931     6827    5                       OR ( KEYIN$->FI$DKEYIN.TERM.TNAME = ' '
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:29   
      932     6828    5                       AND DEV$->FI$DEV.TNAME = 'LOCAL') THEN
      933     6829    5                        IF DEVNAMER.TYP = ' '
      934     6830    5                        OR (DEVNAMER.TYP = DEV$->FI$DEV.NAMER.TYP
      935     6831    5                        AND DEVNAMER.NUM = DEV$->FI$DEV.NAMER.NUM) THEN
      936     6832    6                          DO;
      937     6833                                /* FOUND IT OR ONE OF 'EM */
      938     6834    6                          NDEV=NDEV+1;
      939     6835    6                          OPMSG_DINFO.DEVNM=DEV$->FI$DEV.NAME;
      940     6836    6                          OPMSG_DINFO.STATE=DEV$->FI$DEV.STATE;
      941     6837    6                          OPMSG_DINFO.FIRST=BITBIN(DEV$->FI$DEV.FLG.FIRSTRD);
      942     6838    6                          OPMSG_DINFO.FLUSH=BITBIN(DEV$->FI$DEV.FLG.FLUSHING);
      943     6839    6                          OPMSG_DINFO.NCTL=BITBIN(DEV$->FI$DEV.FLG.NCTLDECK);
      944     6840    6                          OPMSG_DINFO.CTL=BITBIN(DEV$->FI$DEV.CTLDEV);
      945     6841    6                          OPMSG_DINFO.DEST=DEV$->FI$DEV.DEST;
      946     6842    6                          OPMSG_DINFO.PFID=BITBIN(DEV$->FI$DEV.NCTLOK|(~DEV$->FI$DEV.
              6842                                   CTLDEV));
      947     6843    6                          OPMSG_DINFO.NFID=DEV$->FI$DEV.DFID;
      948     6844    6                          CALL M$WRITE (OCMSG_DINFO);
      949     6845    6                          END;
      950     6846    5                       DEV$=DEV$->FI$DEV.LNK$;
      951     6847    5                       END;
      952     6848
      953     6849
      954     6850                                /* MESSAGE IF NONE FOUND */
      955     6851    4                     IF NDEV = 0 THEN
      956     6852    5                       DO;
      957     6853    5                       IF KEYIN$->FI$DKEYIN.KIN# = KEY_SYMBI# THEN
      958     6854    5                        OPMSG_KERR.SUBC1=0;
      959     6855    5                       ELSE
      960     6856    6                         DO;
      961     6857    6                         OPMSG_KERR.SUBC1=1;
      962     6858    6                         OPMSG_KERR.TNAME=KEYIN$->FI$DKEYIN.TERM.TNAME;
      963     6859    6                         END;
      964     6860    5                       IF DEVNAMER.TYP = ' ' THEN
      965     6861    6                         DO;
      966     6862    6                         OPMSG_KERR.SUBC=FIKE_NSDEV#;
      967     6863    6                         GOTO KERR;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:30   
      968     6864    6                         END;
      969     6865    5   KERR1:              ;
      970     6866    5                       OPMSG_KERR.SUBC=FIKE_NOTMY#;
      971     6867    5   KERR:               ;
      972     6868    5                       OPMSG_KERR.DEVNM=DEVNAME;
      973     6869    5                       OPMSG_KERR.ERRC=B$ERRCODE;
      974     6870    5                       CALL M$WRITE (OCMSG_KERR);
      975     6871    5                       END;
      976     6872        /**
      977     6873         **
      978     6874         ** 'NCTL' KEYIN
      979     6875         **
      980     6876         **/
      981     6877    4                   CASE (KEY_NCTL#);
      982     6878
      983     6879    4                     CALL FIND_DEV ALTRET(KERR1);
      984     6880    4                     IF DEV$->FI$DEV.CTLDEV AND NOT DEV$->FI$DEV.NCTLOK THEN
      985     6881    5                       DO;
      986     6882    5                       OPMSG_KERR.SUBC=FIKE_INCTL#;
      987     6883    5                       GOTO KERR;
      988     6884    5                       END;
      989     6885    4                     I=KEYIN$->FI$DKEYIN.FID.L;
      990     6886    4                     IF I > %FIMI_NFMX# THEN
      991     6887    5                       DO;
      992     6888    5                       OPMSG_KERR.SUBC=FIKE_TLFID#;
      993     6889    5                       GOTO KERR;
      994     6890    5                       END;
      995     6891    4                     FIDIT.TEXTFID_=VECTOR(ADDR(KEYIN$->FI$DKEYIN.FID.C)->B$CHARS);
      996     6892    4                     FIDWSN=' ';
      997     6893    4                     CALL DOFID ALTRET(KFIDALT);
      998     6894    4                     IF NOT (OPENIT.V.ASN# = %FILE#
      999     6895    4                     OR (OPENIT.V.ASN# = %DEVICE# AND VLR_FIDIT.WSN)) THEN
     1000     6896    5                       DO;
     1001     6897    5                       OPMSG_KERR.SUBC=FIKE_FDASN#;
     1002     6898    5                       GOTO KERR;
     1003     6899    5                       END;
     1004     6900    4                     IF OPENIT.V.ASN# = %FILE# THEN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:31   
     1005     6901    4                      CALL CHK_NAME ALTRET(KNAMALT);
     1006     6902    4                     IF OPENIT.V.ASN# = %DEVICE# THEN
     1007     6903    4                      CALL CHK_FORM ALTRET(KFORMALT);
     1008     6904    4                     DEV$->FI$DEV.CFID=ADDR(KEYIN$->FI$DKEYIN.FID.C)->B$CHARS;
     1009     6905    4                     IF KEYIN$->FI$DKEYIN.ONCE = 0 THEN
     1010     6906    5                       DO;
     1011     6907    5                       DEV$->FI$DEV.DFID=DEV$->FI$DEV.CFID;
     1012     6908    5                       OPMSG_RESP.SUBC1=0;
     1013     6909    5                       END;
     1014     6910    4                     ELSE OPMSG_RESP.SUBC1=1;
     1015     6911    4                     OPMSG_RESP.SUBC=FIKR_NCTL#;
     1016     6912    4                     OPMSG_RESP.CADDR=M_UR;
     1017     6913    4                     OPMSG_RESP.DEVNM=DEVNAME;
     1018     6914    4                     OPMSG_RESP.FID=DEV$->FI$DEV.CFID;
     1019     6915    4                     CALL M$WRITE (OCMSG_RESP);
     1020     6916    4                     GOTO ENDEVENT;
     1021     6917
     1022     6918    4   KFIDALT:          ;
     1023     6919    4                     OPMSG_KERR.SUBC=FIKE_FDALT#;
     1024     6920    4                     GOTO KERR;
     1025     6921    4   KNAMALT:          ;
     1026     6922    4                     OPMSG_KERR.SUBC=FIKE_FDNAM#;
     1027     6923    4                     GOTO KERR;
     1028     6924    4   KFORMALT:         ;
     1029     6925    4                     OPMSG_KERR.SUBC=FIKE_BFORM#;
     1030     6926    4                     GOTO KERR;
     1031     6927
     1032     6928
     1033     6929
     1034     6930
     1035     6931
     1036     6932        /**
     1037     6933         **
     1038     6934         ** FLUSH KEYIN
     1039     6935         **
     1040     6936         **/
     1041     6937    4                   CASE (KEY_FLUSH#);
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:32   
     1042     6938
     1043     6939    4                     CALL FIND_DEV ALTRET(KERR1);
     1044     6940    4                     IF DEV$->FI$DEV.STATE ~= FIS_BUSY# THEN
     1045     6941    5                       DO;
     1046     6942    5                       OPMSG_KERR.SUBC=FIKE_NBUSY#;
     1047     6943    5                       GOTO KERR;
     1048     6944    5                       END;
     1049     6945    4                     OPMSG_JBFL.SUBC=FIJF_FLUSH#;
     1050     6946    4                     CALL FLUSHIT;
     1051     6947        /**
     1052     6948         **
     1053     6949         ** ZAP KEYIN
     1054     6950         **
     1055     6951         **/
     1056     6952    4                   CASE (KEY_ZAP#);
     1057     6953
     1058     6954    4                     CALL FIA$ZAP;
     1059     6955    4                     DEV$=FI_DEVHD$;
     1060     6956    5                       DO WHILE (DEV$ ~= ADDR(NIL));
     1061     6957    5                       IF DEV$->FI$DEV.STATE = FIS_BUSY# THEN
     1062     6958    6                         DO;
     1063     6959    6                         DEVNAME=DEV$->FI$DEV.NAME;
     1064     6960    6                         OPMSG_JBFL.SUBC=FIJF_ZAP#;
     1065     6961    6                         CALL FLUSHIT;
     1066     6962    6                         CALL M$DEACTIVATE (DISCT_DEV) ALTRET(ZA0);
     1067     6963    6   ZA0:                  ;
     1068     6964    6                         END;
     1069     6965    5                       DEV$=DEV$->FI$DEV.LNK$;
     1070     6966    5                       END;
     1071     6967    4                     CALL M$WRITE (WRITE_ZAPRESP);
     1072     6968    4                     GOODNGT=-1;
     1073     6969        /**
     1074     6970         **
     1075     6971         ** UNKNOWN KEYIN.  GIVE ERROR MSG
     1076     6972         **
     1077     6973         **/
     1078     6974    4                   CASE (ELSE);
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:33   
     1079     6975    4                     OPMSG_UNIMP.CADDR=KEYIN$->FI$DKEYIN.CADDR;
     1080     6976    4                     CALL M$WRITE (OCMSG_UNIMP);
     1081     6977        /***
     1082     6978         ***
     1083     6979         ***     END OF KEYIN TYPE DOCASE
     1084     6980         ***
     1085     6981         ***/
     1086     6982    4                 END;
     1087     6983        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:34   
     1088     6984        /***
     1089     6985         ***
     1090     6986         ***
     1091     6987         ***          ISCG READ COMPLETE
     1092     6988         ***
     1093     6989         ***
     1094     6990         ***/
     1095     6991
     1096     6992    3             CASE (FIEV_ISRD#);
     1097     6993
     1098     6994                                /* INSYM READS ITS DEVICES BY ANONYMOUS READS
     1099     6995                                   TO THE ISCG, NOWAIT.  WHEN A READ COMPLETES
     1100     6996                                   INTO FI_ISCGBUF, WE GET PASSED AN EVENT BY
     1101     6997                                   FIE$EVNT, TELLING THE DEVICE NAME AND ERR
     1102     6998                                   CODE AND ARS.  THE ROUTINE ISRD PROCESSES
     1103     6999                                   THE EVENT, AND THEN WE ISSUE ANOTHER READ
     1104     7000                                   INTO THE BUFFER, AND EXIT. */
     1105     7001    3               DEVNAME=CITE$->FI$ISRD.NAME;
     1106     7002    3               CALL FIND_DEV ALTRET(ENDEVENT);
     1107     7003    3               CALL ISRD ALTRET(TAKEDCB);
     1108     7004    3               GOTO ENDEVENT;
     1109     7005    3   TAKEDCB:    ;
     1110     7006    3               DCBNUMBER.DCB#=DEV$->FI$DEV.DCB#;
     1111     7007    3               DEV$->FI$DEV.DCB#=0;
     1112     7008    3   TAKEDCB1:   ;
     1113     7009    3               CALL GIVEDCB;
     1114     7010        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:35   
     1115     7011        /***
     1116     7012         ***
     1117     7013         ***
     1118     7014         ***          SET DISMOUNT COMMAND FROM PIG
     1119     7015         ***
     1120     7016         ***
     1121     7017         ***/
     1122     7018    3             CASE (FIEV_DSMT#);
     1123     7019
     1124     7020    3               DEV$=FI_DEVHD$;
     1125     7021    4                 DO WHILE (DEV$ ~= ADDR(NIL));
     1126     7022    4                 IF DEV$->FI$DEV.STATE = FIS_BUSY# THEN
     1127     7023    4                  IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD THEN
     1128     7024    4                   IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.SETX = CITE$->FI$DSMT.SETX THEN
     1129     7025    5                     DO;
     1130     7026                                /* Blow off this file (it must be a NCTL file). */
     1131     7027    5                     DEVNAME=DEV$->FI$DEV.NAME;
     1132     7028    5                     OPMSG_JBFL.SUBC=FIJF_DSMT#;
     1133     7029    5                     CALL FLUSHIT;
     1134     7030    5                     CALL M$DEACTIVATE (STOP_DEV) ALTRET(DSMT0);
     1135     7031    5   DSMT0:            ;
     1136     7032    5                     DEV$->FI$DEV.STATE=FIS_DSMT#;
     1137     7033    5                     END;
     1138     7034    4                 DEV$=DEV$->FI$DEV.LNK$;
     1139     7035    4                 END;
     1140     7036    3               VLP_RPSN.NN#=1;
     1141     7037    3               VLP_RPSN.RPLIST.PSN#(0)=CITE$->FI$DSMT.PSN;
     1142     7038    3               CALL M$RELRES (REL_PSN) ALTRET(DSMT1);
     1143     7039    3   DSMT1:      ;
     1144     7040        /**/
     1145     7041    3               DEV$=FI_DEVHD$;
     1146     7042    4                 DO WHILE (DEV$ ~= ADDR(NIL));
     1147     7043    4                 IF DEV$->FI$DEV.STATE = FIS_DSMT# THEN
     1148     7044    5                   DO;
     1149     7045    5                   DEV$->FI$DEV.STATE=FIS_IDLE#;
     1150     7046    5                   DCBNUMBER.DCB#=DEV$->FI$DEV.DCB#;
     1151     7047    5                   DEV$->FI$DEV.DCB#=0;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:36   
     1152     7048    5                   SAVDEV$=DEV$->FI$DEV.LNK$;
     1153     7049    5                   CALL GIVEDCB;
     1154     7050    5                   DEV$=SAVDEV$;
     1155     7051    5                   END;
     1156     7052    4                 ELSE DEV$=DEV$->FI$DEV.LNK$;
     1157     7053    4                 END;
     1158     7054        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:37   
     1159     7055        /***
     1160     7056         ***
     1161     7057         ***
     1162     7058         ***          OPEN FOR BUSINESS
     1163     7059         ***
     1164     7060         ***
     1165     7061         ***/
     1166     7062    3             CASE (FIEV_OPFB#);
     1167     7063    3               B$JIT$->B$JIT.USERWORD(0)=B$JIT$->B$JIT.USERWORD(0)+1;
     1168     7064    3               IF B$JIT$->B$JIT.USERWORD(0) ~= 0 THEN
     1169     7065    4                 DO;
     1170     7066    4   STARTUP:      ;
     1171     7067    4                 DEV$=FI_DEVHD$;
     1172     7068    5                   DO WHILE (DEV$ ~= ADDR(NIL));
     1173     7069    5                   IF DEV$->FI$DEV.FLG.READY THEN
     1174     7070    6                     DO;
     1175     7071    6                     DEV$->FI$DEV.FLG.READY='0'B;
     1176     7072    6                     DEVNAME = DEV$->FI$DEV.NAME;
     1177     7073    6                     CALL STARTIT;
     1178     7074    6                     END;
     1179     7075    5                   DEV$=DEV$->FI$DEV.LNK$;
     1180     7076    5                   END;
     1181     7077    4                 END;
     1182     7078        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:38   
     1183     7079
     1184     7080        /***
     1185     7081         ***
     1186     7082         ***
     1187     7083         ***          APLCG READ COMPLETE
     1188     7084         ***
     1189     7085         ***
     1190     7086         ***/
     1191     7087
     1192     7088    3             CASE (FIEV_APLRD#);
     1193     7089
     1194     7090    3               IF GOODNGT = 0 THEN
     1195     7091    3                CALL FIA$APLRD;
     1196     7092        /***
     1197     7093         ***
     1198     7094         ***
     1199     7095         ***          APLCG ADMIN USER EVENT
     1200     7096         ***
     1201     7097         ***
     1202     7098         ***/
     1203     7099    3             CASE (FIEV_APLAU#);
     1204     7100
     1205     7101    3               IF GOODNGT = 0 THEN
     1206     7102    3                CALL FIA$APLAU;
     1207     7103        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:39   
     1208     7104        /***
     1209     7105         ***
     1210     7106         ***
     1211     7107         ***          NOP EVENT
     1212     7108         ***
     1213     7109         ***
     1214     7110         ***/
     1215     7111
     1216     7112    3             CASE (FIEV_NOP#);
     1217     7113
     1218     7114        /***
     1219     7115         ***
     1220     7116         ***
     1221     7117         ***          'ELSE' CASE: UNKNOWN EXTERNAL EVENT CODE FROM FIE$EVNT
     1222     7118         ***
     1223     7119         ***
     1224     7120         ***/
     1225     7121
     1226     7122    3             CASE (ELSE);
     1227     7123    3               CALL FOI$LDTRC (%S$FIUEXTEV,F_FI,M_I,INSYMNAME.MYSTATION#);
     1228     7124        /*S* SCREECH_CODE: FII-S$FIUEXTEV
     1229     7125             TYPE:         SNAP
     1230     7126             MESSAGE:      INSYM  - unknown external event code from FIE$EVNT
     1231     7127             REMARKS:      The event queue used to communicate from FIE$EVNT
     1232     7128                           to the INSYM  main routine contains an event code
     1233     7129                           unknown to INSYM.   This can only occur if one
     1234     7130                           of INSYM,  FIE$EVNT, and the event queue has been
     1235     7131                           clobbered.  A SNAP is taken, then INSYM LDTRCs
     1236     7132                           to itself. */
     1237     7133        /****
     1238     7134         ****
     1239     7135         ****
     1240     7136         ****         END OF MAIN EVENT CASE STMT
     1241     7137         ****
     1242     7138         ****
     1243     7139         ****/
     1244     7140    3           END;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:40   
     1245     7141    2   ENDEVENT:
     1246     7142    2         RETURN;
     1247     7143
     1248     7144        /**/
     1249     7145    2   STARTIT: PROC;
     1250     7146    3         CALL M$GETDCB (GET_DCB) ALTRET(NODCB);
     1251     7147    3   GOTDCB: ENTRY;
     1252     7148    3         DEV$->FI$DEV.DCB#=DCBNUMBER.DCB#;
     1253     7149    3         DEV$->FI$DEV.STATE=FIS_BUSY#;
     1254     7150    3         DEV$->FI$DEV.FLG='0'B;
     1255     7151    3         DEV$->FI$DEV.FLG.FIRSTRD='1'B;
     1256     7152    3         CALL M$ACTIVATE (START_DEV) ALTRET(RTN);
     1257     7153    3   RTN:  ;
     1258     7154    3         RETURN;
     1259     7155        /**/
     1260     7156    3   NODCB: ;
     1261     7157    3         DEV$->FI$DEV.STATE=FIS_DCBW#;
     1262     7158    3         RETURN;
     1263     7159    3   END STARTIT;
     1264     7160        /**/
     1265     7161    2   GIVEDCB: PROC;
     1266     7162    3         DEV$=FI_DEVHD$;
     1267     7163    4           DO WHILE (DEV$ ~= ADDR(NIL));
     1268     7164    4           IF DEV$->FI$DEV.STATE = FIS_DCBW# THEN
     1269     7165    5             DO;
     1270     7166    5             CALL GOTDCB;
     1271     7167    5             RETURN;
     1272     7168    5             END;
     1273     7169    4           DEV$=DEV$->FI$DEV.LNK$;
     1274     7170    4           END;
     1275     7171    3         REL_DCB.V.DCB#=DCBNUMBER.DCB#;
     1276     7172    3         CALL M$RELDCB (REL_DCB);
     1277     7173    3         RETURN;
     1278     7174    3   END GIVEDCB;
     1279     7175    2   END EXT_EVENT;
     1280     7176        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:41   
     1281     7177        /***************************************************************
     1282     7178         ***************************************************************
     1283     7179
     1284     7180                               ISRD
     1285     7181
     1286     7182         ***************************************************************
     1287     7183         ***************************************************************/
     1288     7184        /*D* NAME:         ISRD
     1289     7185             PURPOSE:      To process a completed read to the ISCG
     1290     7186             DESCRIPTION:  This routine does most of the actual work
     1291     7187                           of INSYM, namely, processing the data read
     1292     7188                           from the devices, and acting upon it.
     1293     7189
     1294     7190                           Basically, one of 3 actions is taken here:
     1295     7191
     1296     7192                           1) For the first read to a device, decide where
     1297     7193                           the data is going to go based possibly on the
     1298     7194                           first card read (e.g. !JOB), and open the dcb
     1299     7195                           for the device to that destination.
     1300     7196
     1301     7197                           2) In the middle of a deck, simply write the
     1302     7198                           data record to the already-open dcb
     1303     7199
     1304     7200                           3) Based on an EOF condition, or new !JOB,
     1305     7201                           close off the currently-open dcb and maybe
     1306     7202                           start a new one.
     1307     7203
     1308     7204                           The parameters to this routine are DEV$ pointing
     1309     7205                           to the device which emitted the data, and EVNT$
     1310     7206                           pointing to the event frame for the read.
     1311     7207
     1312     7208                           If the ALTRET is taken, the device's DCB is
     1313     7209                           to be given away to another device in state
     1314     7210                           dcbwait, if any, or released. */
     1315     7211    1   ISRD: PROC ALTRET;
     1316     7212
     1317     7213    2         IF DEV$->FI$DEV.STATE ~= FIS_BUSY# THEN RETURN;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:42   
     1318     7214
     1319     7215    2         ARS=CITE$->FI$ISRD.ARS;
     1320     7216    2         BUF$=CITE$->FI$ISRD.BUF$;
     1321     7217    2         WRITOUT=1;
     1322     7218
     1323     7219
     1324     7220                           /* PROCESS READ WITH NO ERROR */
     1325     7221    2         IF CITE$->FI$ISRD.ERRCODE = 0 THEN
     1326     7222    3           DO;
     1327     7223    3           IF DEV$->FI$DEV.FLG.FIRSTRD THEN
     1328     7224    4             DO;
     1329     7225                                /* TRYING TO GET FIRST CARD */
     1330     7226    4             IF DEV$->FI$DEV.FLG.FLUSHING
     1331     7227    4             AND DEV$->FI$DEV.FLG.NCTLDECK THEN RETURN;
     1332     7228    4             BANGDISP=0;
     1333     7229    4             IF DEV$->FI$DEV.CTLDEV THEN
     1334     7230    5               DO;
     1335     7231                                /* CONTROL DEVICE - !JOB OR !NCTL MUST B THERE */
     1336     7232    5               IF ARS >= 4
     1337     7233    5               AND SUBSTR(BUF$->B$CHAR5,0,MINIMUM(ARS,5)) = '!JOB ' THEN
     1338     7234    6                 DO;
     1339     7235    6   NEWJOB:
     1340     7236    6                 DEV$->FI$DEV.FLG.NCTLDECK='0'B;
     1341     7237    6                 DEV$->FI$DEV.FLG.FLUSHING='0'B;
     1342     7238    6                 OPENIT.V.ASN#=%DEVICE#;
     1343     7239    6                 OPENIT.V.RES#='JE';
     1344     7240    6                 OPENIT.WSN_=VECTOR(NIL);
     1345     7241    6                 OPENIT.NAME_=VECTOR(NIL);
     1346     7242    6                 OPENIT.ACCT_=VECTOR(NIL);
     1347     7243    6                 DEV$->FI$DEV.DESTCODE=FIDC_JOB#;
     1348     7244    6                 GOTO OPEN;
     1349     7245    6                 END;
     1350     7246    5               IF ARS >= 5
     1351     7247    5               AND SUBSTR(BUF$->B$CHAR6,0,MINIMUM(ARS,6)) = '!NCTL ' THEN
     1352     7248    6                 DO;
     1353     7249    6   CTLNCTL:
     1354     7250    6                 DEV$->FI$DEV.FLG.NCTLDECK='1'B;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:43   
     1355     7251    6                 DEV$->FI$DEV.FLG.FLUSHING='0'B;
     1356     7252    6                 IF DEV$->FI$DEV.NCTLOK THEN GOTO NCTL;
     1357     7253    6                 OPMSG_JBFL.SUBC=FIJF_INCTL#;
     1358     7254    6                 GOTO FLUSH;
     1359     7255    6                 END;
     1360     7256                                /* CONTROL CARD NOT FOUND - FLUSH */
     1361     7257    5               IF DEV$->FI$DEV.FLG.FLUSHING THEN RETURN;
     1362     7258    5               OPMSG_JBFL.SUBC=FIJF_NOCTL#;
     1363     7259    5               GOTO FLUSH;
     1364     7260    5               END;
     1365     7261    4             ELSE
     1366     7262    5               DO;
     1367     7263                                /* NON CONTROL DEVICE - 1ST CARD MAY BE !NCTL */
     1368     7264    5               IF (CITE$->FI$ISRD.DVBYTE&%DVBYTE_VFC#) THEN BANGDISP=1;
     1369     7265    5   NCTL:
     1370     7266    5               DEV$->FI$DEV.FLG.NCTLDECK='1'B;
     1371     7267    5               FIDIT.TEXTFID_=VECTOR(DEV$->FI$DEV.CFID);
     1372     7268    5               IF ARS >= 6+BANGDISP
     1373     7269    5               AND SUBSTR(PINCRC(BUF$,BANGDISP)->B$CHAR6,0,MINIMUM(ARS,6)) = '!NCTL '
              7269                        THEN
     1374     7270    6                 DO;
     1375     7271    6                 WRITOUT=0;
     1376     7272    6                 IF ARS >= 7+BANGDISP THEN
     1377     7273    7                   DO;
     1378     7274    7                   I=ARS-6-BANGDISP;
     1379     7275    7                   IF PINCRC(BUF$,6+BANGDISP)->B$CHARS ~= ' ' THEN
     1380     7276    7                    FIDIT.TEXTFID_=VECTOR(PINCRC(BUF$,6+BANGDISP)->B$CHARS);
     1381     7277    7                   END;
     1382     7278    6                 END;
     1383     7279    5               FIDWSN=' ';
     1384     7280    5               CALL DOFID ALTRET(FIDALT);
     1385     7281    5               OPENIT.UATTR_ = VECTOR(NIL);
     1386     7282    5               IF OPENIT.V.ASN# = %FILE# THEN
     1387     7283    6                 DO;
     1388     7284    6                 CALL CHK_NAME ALTRET(NAMALT);
     1389     7285    6                 IF FIDNAME.L# >= 1 AND FIDNAME.L# <= 21
     1390     7286    6                 AND SUBSTR(FIDNAME.NAME#, FIDNAME.L# - 1, 1) = '?'
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:44   
     1391     7287    7                 THEN DO;
     1392     7288    7                   CALL M$TIME (GET_UTS);
     1393     7289    7                   CALL BINCHAR (SUBSTR(FIDNAME.NAME#, FIDNAME.L# - 1, 11),
     1394     7290    7                   UTS_NOW);
     1395     7291    7                   FIDNAME.L# = FIDNAME.L# + 10;
     1396     7292    7                   END;
     1397     7293    6                 OPENIT.NAME_=VECTOR(FIDNAME);
     1398     7294    6                 OPENIT.ACCT_=VECTOR(FIDACCT);
     1399     7295    6                 OPENIT.WSN_=VECTOR(NIL);
     1400     7296    6                 OPENIT.PROCATTR_=VECTOR(NIL);
     1401     7297    6                 IF NOT VLR_FIDIT.ACCT THEN FIDACCT=DEV$->FI$DEV.ACCT;
     1402     7298    6                 DEV$->FI$DEV.DESTCODE=FIDC_FIL#;
     1403     7299    6                 FILDEST.FILE=FIDNAME.NAME#;
     1404     7300    6                 PINCRC(ADDR(FILDEST.FILE),FIDNAME.L#)->B$CHAR='.';
     1405     7301    6                 PINCRC(ADDR(FILDEST.FILE),FIDNAME.L#+1)->B$CHAR8=FIDACCT;
     1406     7302    6                 DEV$->FI$DEV.DEST=FILDESTR;
     1407     7303    6                 B$JIT$->B$JIT.ACCN=DEV$->FI$DEV.ACCT;
     1408     7304    6                 END;
     1409     7305    5               ELSE
     1410     7306    6                 DO;
     1411     7307    6                 IF OPENIT.V.ASN# ~= %DEVICE#
     1412     7308    6                 OR NOT VLR_FIDIT.WSN THEN GOTO FIDALT1;
     1413     7309    6                 IF FIDWSN = '@' THEN FIDWSN=DEV$->FI$DEV.NCTLWSN;
     1414     7310    6                 OPENIT.WSN_=VECTOR(FIDWSN);
     1415     7311    6                 OPENIT.NAME_=VECTOR(NIL);
     1416     7312    6                 ADDR(TJIT)->B$JIT.SYSID=JG_INSYM#;
     1417     7313    6                 ADDR(TJIT)->B$JIT.ACCN=DEV$->FI$DEV.ACCT;
     1418     7314    6                 ADDR(TJIT)->B$JIT.UNAME=DEV$->FI$DEV.NAME;
     1419     7315    6                 ADDR(TJIT)->B$JIT.WOO=DEV$->FI$DEV.WSN;
     1420     7316    6                 ADDR(TJIT)->B$JIT.OUTPRIO=DEV$->FI$DEV.DFPRI;
     1421     7317    6                 OPENIT.PROCATTR_=VECTOR(TJIT);
     1422     7318    6                 CALL CHK_FORM ALTRET(FORMALT);
     1423     7319    6                 DEVDEST.RES=OPENIT.V.RES#;
     1424     7320    6                 DEVDEST.WSN=FIDWSN;
     1425     7321    6                 DEV$->FI$DEV.DEST=DEVDESTR;
     1426     7322    6                 DEV$->FI$DEV.DESTCODE=FIDC_DEV#;
     1427     7323    6                 END;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:45   
     1428     7324    5               DEV$->FI$DEV.CFID=DEV$->FI$DEV.DFID;
     1429     7325    5   OPEN:
     1430     7326    5               OPNATTR.ORIGINATOR_MODE=%M_BATCH#;
     1431     7327    5               OPNATTR.ORIGINATOR_PORT.FROM_CR.DEVICE=DEVNAME;
     1432     7328    5               OPNATTR.ORIGINATOR_PORT.FROM_CR.TNAME=DEV$->FI$DEV.TNAME;
     1433     7329    5               OPNATTR.WOO=DEV$->FI$DEV.WSN;
     1434     7330    5               OPNATTR.MAXPRI=DEV$->FI$DEV.MXPRI;
     1435     7331    5               OPNATTR.DEFPRI=DEV$->FI$DEV.DFPRI;
     1436     7332    5               OPENIT.V.DCB#=DEV$->FI$DEV.DCB#;
     1437     7333    5               CALL M$OPEN (OPENIT) ALTRET(OPNALT);
     1438     7334    5               B$JIT$->B$JIT.ACCN=':SYS';
     1439     7335    5               OPENIT.UATTR_ = VECTOR(OPNATTR);
     1440     7336    5               IF DEV$->FI$DEV.DESTCODE = FIDC_JOB# THEN
     1441     7337    6                 DO;
     1442     7338    6                 JOBDEST.SYSID=SUBSTR(DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.NAME.C,0,6);
     1443     7339    6                 DEV$->FI$DEV.DEST=JOBDESTR;
     1444     7340    6                 END;
     1445     7341    5               DEV$->FI$DEV.FLG.FIRSTRD='0'B;
     1446     7342    5               CALL WRITE_REC ALTRET(FLUSH);
     1447     7343    5               RETURN;
     1448     7344    5   OPNALT:
     1449     7345    5               B$JIT$->B$JIT.ACCN=':SYS';
     1450     7346    5               OPENIT.UATTR_ = VECTOR(OPNATTR);
     1451     7347    5               OPMSG_JBFL.SUBC=FIJF_OPERR#;
     1452     7348    5               GOTO FIDALT0;
     1453     7349    5   FIDALT:
     1454     7350    5               OPMSG_JBFL.SUBC=FIJF_FDERR#;
     1455     7351    5   FIDALT0:
     1456     7352    5               OPMSG_JBFL.ERRC=B$ERRCODE;
     1457     7353    5               GOTO FLUSH0;
     1458     7354    5   FORMALT:
     1459     7355    5               OPMSG_JBFL.SUBC=FIJF_BFORM#;
     1460     7356    5               GOTO FLUSH0;
     1461     7357    5   NAMALT:
     1462     7358    5               OPMSG_JBFL.SUBC=FIJF_FDNAM#;
     1463     7359    5               GOTO FLUSH0;
     1464     7360    5   FIDALT1:
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:46   
     1465     7361    5               OPMSG_JBFL.SUBC=FIJF_FDASN#;
     1466     7362    5   FLUSH0:
     1467     7363    5               DEV$->FI$DEV.CFID=DEV$->FI$DEV.DFID;
     1468     7364    5   FLUSH:
     1469     7365    5               CALL FLUSHIT;
     1470     7366    5               RETURN;
     1471     7367    5               END;
     1472     7368    4             END;
     1473     7369    3           ELSE
     1474     7370    4             DO;
     1475     7371
     1476     7372                                /* NOT FIRST READ - WRITE RECORD */
     1477     7373                                /* BUT FIRST CHECK FOR NEW JOB */
     1478     7374    4             IF NOT DEV$->FI$DEV.FLG.NCTLDECK THEN
     1479     7375    5               DO;
     1480     7376    5               IF ARS >= 4
     1481     7377    5               AND SUBSTR(BUF$->B$CHAR5,0,MINIMUM(ARS,5)) = '!JOB ' THEN
     1482     7378    6                 DO;
     1483     7379    6                 CALL CLSSV;
     1484     7380    6                 DEV$->FI$DEV.FLG.FIRSTRD='1'B;
     1485     7381    6                 GOTO NEWJOB;
     1486     7382    6                 END;
     1487     7383    5               IF ARS >= 5
     1488     7384    5               AND SUBSTR(BUF$->B$CHAR6,0,MINIMUM(ARS,6)) = '!NCTL ' THEN
     1489     7385    6                 DO;
     1490     7386    6                 CALL CLSSV;
     1491     7387    6                 DEV$->FI$DEV.FLG.FIRSTRD='1'B;
     1492     7388    6                 GOTO CTLNCTL;
     1493     7389    6                 END;
     1494     7390    5               END;
     1495     7391
     1496     7392                  /*  Check for !FIN.
     1497     7393                      (Some devices don't return an %E$EOF error.)  */
     1498     7394    4             IF ARS >= 4
     1499     7395    4             AND SUBSTR(BUF$->B$CHAR5,0,MINIMUM(ARS,5)) = '!FIN ' THEN
     1500     7396    4              GOTO CLOSE_DCB;
     1501     7397
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:47   
     1502     7398    4             IF DEV$->FI$DEV.FLG.FLUSHING = '0'B THEN
     1503     7399    4              CALL WRITE_REC ALTRET(FLUSH);
     1504     7400    4             RETURN;
     1505     7401    4             END;
     1506     7402    3           END;
     1507     7403        /***
     1508     7404         ***
     1509     7405         ***          READ HAD AN ERROR
     1510     7406         ***
     1511     7407         ***/
     1512     7408
     1513     7409    2         IF CITE$->FI$ISRD.ERRCODE = %E$EOF THEN
     1514     7410    3           DO;
     1515     7411    3           IF (CITE$->FI$ISRD.TYC & %TYC_EOD) THEN GOTO EODERR;
     1516     7412                                /* ECHO LAST CARD IF NOT !FIN OR ZERO LEN */
     1517     7413    3           IF NOT ((CITE$->FI$ISRD.ARS >= 4
     1518     7414    3           AND SUBSTR(BUF$->B$CHAR5,0,MINIMUM(ARS,5)) = '!FIN ')
     1519     7415    3           OR (ARS=0)) THEN
     1520     7416                                /* WRITE LAST CARD */
     1521     7417    3            CALL WRITE_REC
     1522     7418    3            WHENALTRETURN
     1523     7419    4              DO;
     1524     7420    4              CALL FLUSHIT;
     1525     7421    4              GOTO STOP_CR;
     1526     7422    4              END;
     1527     7423    3   CLOSE_DCB:
     1528     7424    3           CALL CLSSV;
     1529     7425    3   STOP_CR:
     1530     7426    3           CALL M$DEACTIVATE (STOP_DEV) ALTRET(IGNORE_RUNAWAY_CR);
     1531     7427    3   IGNORE_RUNAWAY_CR:
     1532     7428    3           DEV$->FI$DEV.STATE=FIS_IDLE#;
     1533     7429    3           ALTRETURN;
     1534     7430    3           END;
     1535     7431    2         IF CITE$->FI$ISRD.ERRCODE = %E$EOD THEN
     1536     7432    3           DO;
     1537     7433    3   EODERR:
     1538     7434    3           CALL WRITE_EOD ALTRET(FLUSH);
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:48   
     1539     7435    3           RETURN;
     1540     7436    3           END;
     1541     7437    2         IF CITE$->FI$ISRD.ERRCODE = %E$DACTR THEN
     1542     7438    2   DEACTIVATED:
     1543     7439    3           DO;
     1544     7440    3           CALL FOI$SNAP (%S$FIDACTR,F_FI,M_I);
     1545     7441        /*S* SCREECH_CODE: FII-S$FIDACTR
     1546     7442             TYPE:         SNAP
     1547     7443             MESSAGE:      INSYM DEACTIVATEd on ISCG
     1548     7444             REMARKS:      INSYM has received a "you are deactivated"
     1549     7445                           error on an ISCG read.  This should never
     1550     7446                           really happen, but if it does, this snap
     1551     7447                           is intended to keep our buddy, user 5,
     1552     7448                           from tying up the system by looping forever.
     1553     7449                           Can't think of any better way to recover.  */
     1554     7450    3           END DEACTIVATED;
     1555     7451                                /* ERROR OTHER THAN EOF,EOD */
     1556     7452    2         OPMSG_JBFL.SUBC=FIJF_DVERR#;
     1557     7453    2         OPMSG_JBFL.ERRC=CITE$->FI$ISRD.ERRCODE;
     1558     7454    2         CALL FLUSHIT;
     1559     7455    2         RETURN;
     1560     7456    2   END ISRD;
     1561     7457
     1562     7458
     1563     7459
     1564     7460
     1565     7461
     1566     7462
     1567     7463
     1568     7464    1   FLUSHIT: PROC;
     1569     7465    2         IF DEV$->FI$DEV.FLG.FLUSHING THEN RETURN;
     1570     7466    2         OPMSG_JBFL.DEVNM=DEVNAME;
     1571     7467    2         OPMSG_JBFL.DEST=DEV$->FI$DEV.DEST;
     1572     7468    2         CALL M$WRITE (OCMSG_JBFL);
     1573     7469    2         DEV$->FI$DEV.FLG.FLUSHING='1'B;
     1574     7470    2         IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD THEN
     1575     7471    3           DO;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:49   
     1576     7472    3           CLOSE_REL.V.DCB#=DEV$->FI$DEV.DCB#;
     1577     7473    3           CALL M$CLOSE (CLOSE_REL) ALTRET(A1);
     1578     7474    3           CALL REL_RES;
     1579     7475    3   A1:     ;
     1580     7476    3           END;
     1581     7477    2         RETURN;
     1582     7478    2   END FLUSHIT;
     1583     7479
     1584     7480
     1585     7481
     1586     7482    1   WRITE_REC: PROC ALTRET;
     1587     7483    2         IF WRITOUT = 0 THEN RETURN;
     1588     7484    2         IF ARS ~= 0 THEN
     1589     7485    3           DO;
     1590     7486    3           WRITEIT.BUF_.BOUND=ARS-1;
     1591     7487    3           WRITEIT.BUF_.BUF$=BUF$;
     1592     7488    3           END;
     1593     7489    2         ELSE WRITEIT.BUF_=VECTOR(NIL);
     1594     7490    2         GOTO WRITE;
     1595     7491
     1596     7492    2   WRITE_EOD: ENTRY ALTRET;
     1597     7493    2         WRITEIT.BUF_=VECTOR(EODCARD);
     1598     7494    2   WRITE:;
     1599     7495    2         WRITEIT.V.DCB#=DEV$->FI$DEV.DCB#;
     1600     7496    2         WRITEIT.V.DVBYTE=CITE$->FI$ISRD.DVBYTE;
     1601     7497    2         CALL M$WRITE (WRITEIT) ALTRET(BADWRT);
     1602     7498    2         RETURN;
     1603     7499    2   BADWRT:;
     1604     7500    2         IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD = '0'B THEN RETURN;
     1605     7501    2         OPMSG_JBFL.SUBC=FIJF_BDWRT#;
     1606     7502    2         OPMSG_JBFL.ERRC=B$ERRCODE;
     1607     7503    2         ALTRETURN;
     1608     7504    2   END WRITE_REC;
     1609     7505
     1610     7506
     1611     7507
     1612     7508
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:50   
     1613     7509    1   CLSSV: PROC;
     1614     7510    2         IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD THEN
     1615     7511    3           DO;
     1616     7512    3           CLOSE_SAV.V.DCB#=DEV$->FI$DEV.DCB#;
     1617     7513    3           CALL M$CLOSE (CLOSE_SAV) ALTRET(BADCLS);
     1618     7514    3           CALL REL_RES;
     1619     7515    3           OPMSG_JBSB.DEST=DEV$->FI$DEV.DEST;
     1620     7516    3           OPMSG_JBSB.DEVNM=DEVNAME;
     1621     7517    3           CALL M$WRITE (OCMSG_JBSB);
     1622     7518    3           END;
     1623     7519    2         RETURN;
     1624     7520    2   BADCLS:;
     1625     7521    2         OPMSG_JBFL.SUBC=FIJF_CLERR#;
     1626     7522    2         OPMSG_JBFL.ERRC=B$ERRCODE;
     1627     7523    2         CALL FLUSHIT;
     1628     7524    2         RETURN;
     1629     7525    2   END CLSSV;
     1630     7526        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:51   
     1631     7527        /**************************************
     1632     7528         **************************************
     1633     7529                    ADD_DEV
     1634     7530         **************************************
     1635     7531         **************************************/
     1636     7532        /*D* NAME:         ADD_DEV
     1637     7533
     1638     7534             PURPOSE:      To add a new INSYM device
     1639     7535
     1640     7536             DESCRIPTION:
     1641     7537
     1642     7538                 DEVNAME is the name of the device.
     1643     7539                 CONINFO$ points to a FI$CONINFO frame containing the
     1644     7540                           connection information.
     1645     7541                 A device frame is allocated and the device set to
     1646     7542                           its initial state.  If any errors are
     1647     7543                           encountered in this process, an appropriate
     1648     7544                           message appears on concerned UR consoles.
     1649     7545        */
     1650     7546    1   ADD_DEV: PROC ALTRET;
     1651     7547    2         CALL FIND_DEV ALTRET(A9);
     1652     7548                                /* DEVICE ALREADY LISTED */
     1653     7549    2         ALTRETURN;
     1654     7550    2   A9:   ;
     1655     7551    2         OPMSG_TCON.DEVNM=DEVNAME;
     1656     7552    2         OPMSG_TCON.SUBC=1;
     1657     7553    2         CALL FOI$GBUF (FI_DEVSCB,DEV$) ALTRET(A2);
     1658     7554    2         DEV$->FI$DEV=FI_DEV_INIT;
     1659     7555    2         DEV$->FI$DEV.NAME=DEVNAME;
     1660     7556    2         DEV$->FI$DEV.CTLDEV= ~(CONINFO$->FI$CONINFO.NCTL);
     1661     7557    2         DEV$->FI$DEV.NCTLOK=CONINFO$->FI$CONINFO.NCTLOK;
     1662     7558    2         DEV$->FI$DEV.DFPRI=CONINFO$->FI$CONINFO.DFPRI;
     1663     7559    2         DEV$->FI$DEV.MXPRI=CONINFO$->FI$CONINFO.MXPRI;
     1664     7560    2         DEV$->FI$DEV.ACCT=CONINFO$->FI$CONINFO.NCACCT;
     1665     7561    2         IF CONINFO$->FI$CONINFO.NCTLFID THEN
     1666     7562    2          DEV$->FI$DEV.DFID=CONINFO$->FI$CONINFO.NFID;
     1667     7563    2         ELSE DEV$->FI$DEV.DFID=' ';
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:52   
     1668     7564    2         DEV$->FI$DEV.CFID=DEV$->FI$DEV.DFID;
     1669     7565    2         DEV$->FI$DEV.LNK$=FI_DEVHD$;
     1670     7566    2         DEV$->FI$DEV.WSN =CONINFO$->FI$CONINFO.WSN;
     1671     7567    2         DEV$->FI$DEV.TNAME=CONINFO$->FI$CONINFO.TNAME;
     1672     7568    2         DEV$->FI$DEV.NCTLWSN=CONINFO$->FI$CONINFO.WSN;
     1673     7569    2         FI_DEVHD$=DEV$;
     1674     7570    2         OPMSG_TCON.SUBC=0;
     1675     7571    2         IF NOT DEV$->FI$DEV.CTLDEV THEN
     1676     7572    2          OPMSG_TCON.SUBC1=1;
     1677     7573    2         ELSE OPMSG_TCON.SUBC1=0;
     1678     7574    2         OPMSG_TCON.NFID=DEV$->FI$DEV.DFID;
     1679     7575    2         CALL M$WRITE (OCMSG_TCON);
     1680     7576    2         RETURN;
     1681     7577    2   A2:   ;
     1682     7578    2         OPMSG_TCON.SUBC1=FITD_NTBL#;
     1683     7579    2   A21:  ;
     1684     7580    2         CALL M$WRITE (OCMSG_TCON);
     1685     7581    2         CALL M$DEACTIVATE (DISCT_DEV) ALTRET(RTN);
     1686     7582    2   RTN:  ;
     1687     7583    2         RETURN;
     1688     7584    2   END ADD_DEV;
     1689     7585        /**************************************
     1690     7586         **************************************
     1691     7587                    FIND_DEV
     1692     7588         **************************************
     1693     7589         **************************************/
     1694     7590        /*D* NAME:         FIND_DEV
     1695     7591             PURPOSE:      To find a device in INSYM's tables
     1696     7592             DESCRIPTION:  DEVNAME is the name of the device.  If a device
     1697     7593                           of that name is found, return is made with
     1698     7594                           DEV$ pointing to the device.  Else the routine
     1699     7595                           ALTRETs.  */
     1700     7596    1   FIND_DEV: PROC ALTRET;
     1701     7597
     1702     7598    2         DEV$=FI_DEVHD$;
     1703     7599    3           DO WHILE (DEV$ ~= ADDR(NIL));
     1704     7600    3           IF DEVNAME = DEV$->FI$DEV.NAME THEN RETURN;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:53   
     1705     7601    3           DEV$=DEV$->FI$DEV.LNK$;
     1706     7602    3           END;
     1707     7603    2         ALTRETURN;
     1708     7604    2   END FIND_DEV;
     1709     7605        /**************************************
     1710     7606         **************************************
     1711     7607                    REM_DEV
     1712     7608         **************************************
     1713     7609         **************************************/
     1714     7610        /*D* NAME:         REM_DEV
     1715     7611             PURPOSE:      To remove a device from INSYM's tables.
     1716     7612             DESCRIPTION:  The desired device is pointed to by DEV$.  The
     1717     7613                           device frame is removed and released. */
     1718     7614    1   REM_DEV: PROC;
     1719     7615    2         IF DEV$ = FI_DEVHD$ THEN
     1720     7616    3           DO;
     1721     7617    3           FI_DEVHD$=DEV$->FI$DEV.LNK$;
     1722     7618    3           GOTO DONE;
     1723     7619    3           END;
     1724     7620    2         P$=FI_DEVHD$;
     1725     7621    3           DO FOREVER;
     1726     7622    3           IF P$->FI$DEV.LNK$ = DEV$ THEN
     1727     7623    4             DO;
     1728     7624    4             P$->FI$DEV.LNK$=DEV$->FI$DEV.LNK$;
     1729     7625    4   DONE:     ;
     1730     7626    4             CALL FOI$RBUF (FI_DEVSCB,DEV$);
     1731     7627    4             RETURN;
     1732     7628    4             END;
     1733     7629    3           P$=P$->FI$DEV.LNK$;
     1734     7630    3           END;
     1735     7631    2   END REM_DEV;
     1736     7632        /**************************************
     1737     7633         **************************************
     1738     7634                    REL_RES
     1739     7635         **************************************
     1740     7636         **************************************/
     1741     7637        /*D* NAME:         REL_RES
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:54   
     1742     7638             PURPOSE:      To release a resource.
     1743     7639             DESCRIPTION:  After M$CLOSEing a file, this procedure is called
     1744     7640                           to release the resource corresponding to the
     1745     7641                           account of the file.  This is so INSYM doesn't
     1746     7642                           continue to "own" private packs which have been
     1747     7643                           NCTL'ed to.  */
     1748     7644    1   REL_RES: PROC;
     1749     7645    2         FIND_PSN.ACCT_=VECTOR(DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.ACCT);
     1750     7646    2         CALL M$MADMUCK (FIND_PSN) ALTRET (IGNORE_MADMUCK_ALTRET);
     1751     7647    2   IGNORE_MADMUCK_ALTRET:
     1752     7648    2         VLP_RPSN.NN#=1;
     1753     7649    2         VLP_RPSN.RPLIST.PSN#(0)=VLP_SN.SN#(0);
     1754     7650    2         CALL M$RELRES (REL_PSN) ALTRET (IGNORE_RELRES_ALTRET);
     1755     7651    2   IGNORE_RELRES_ALTRET:
     1756     7652              /*  Ignore this altret, too.  The SN may have said #SYS, in which
     1757     7653                  case INSYM might (should!) still have a DCB open to it.  */
     1758     7654    2         RETURN;
     1759     7655    2   END REL_RES;
     1760     7656        /**************************************
     1761     7657         **************************************
     1762     7658                    MISC_SETUP
     1763     7659         **************************************
     1764     7660         **************************************/
     1765     7661
     1766     7662    1   MISC_SETUP: PROC;
     1767     7663
     1768     7664                                /* TURN OFF SOME PRIVILEGE */
     1769     7665    2         CALL M$RPRIV (PRIVZAP) ALTRET(WHOCARES);
     1770     7666    2   WHOCARES:;
     1771     7667                                /* LINK FREE EVENT Q FRAMES TOGETHER */
     1772     7668    2         EVNT$=ADDR(FI_EVQ(0));
     1773     7669    3           DO I = 0 TO FIMI_EVMX#-1;
     1774     7670    3           EVNT$->FI$EVNT.LNK$=PINCRW(EVNT$,SIZEW(FI$EVNT));
     1775     7671    3           EVNT$=EVNT$->FI$EVNT.LNK$;
     1776     7672    3           END;
     1777     7673
     1778     7674    2         OPNATTR.FLAG=JOBORIG_DEVICE#;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:55   
     1779     7675    2         OPNATTR.SYSID=0;
     1780     7676    2         OPNATTR.SIZ=SIZEW(FS$JOBORIG);
     1781     7677    2   END MISC_SETUP;
     1782     7678        /**************************************
     1783     7679         **************************************
     1784     7680                    CHK_NAME
     1785     7681         **************************************
     1786     7682         **************************************/
     1787     7683        /*D* NAME:         CHK_NAME
     1788     7684             PURPOSE:      To validate a NCTL filename
     1789     7685             DESCRIPTION:  When  NCTL FID produces ASN=FILE, the fid
     1790     7686                           must be checked for legality.  This routine
     1791     7687                           uses VLR_FIDIT, and FIDNAME to do the chks,
     1792     7688                           returning normally if the name passes, and
     1793     7689                           ALTRETing else. */
     1794     7690    1   CHK_NAME: PROC ALTRET;
     1795     7691    2         IF FIDNAME.L# > 31
     1796     7692    2         OR VLR_FIDIT.PASS THEN ALTRETURN;
     1797     7693    2         IF FIDNAME.L# >= 1 THEN
     1798     7694    2          IF SUBSTR(FIDNAME.NAME#,0,1) = '*' THEN ALTRETURN;
     1799     7695    2         RETURN;
     1800     7696    2   END CHK_NAME;
     1801     7697        /**************************************
     1802     7698         **************************************
     1803     7699                    CHK_FORM
     1804     7700         **************************************
     1805     7701         **************************************/
     1806     7702        /*D* NAME:         CHK_FORM
     1807     7703             PURPOSE:      To check a NCTL FID for formname
     1808     7704             DESCRIPTION:  FIDIT.TEXTFID_ is a vector framing the NCTL FID
     1809     7705                           to be examined.  The formname is considered by
     1810     7706                           this routine to be the first item in the fid
     1811     7707                           that is enclosed by parentheses.  If the formname
     1812     7708                           is not present, OPENIT.FORM_ is set VECTOR(NIL),
     1813     7709                           and DEVDEST.FORM is set to blanks.
     1814     7710                           If the formname is present, OPENIT.FORM_ is set
     1815     7711                           to frame OPENFORM, which is filled with the form
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:56   
     1816     7712                           name, and DEVDEST.FORM is set to the formname.
     1817     7713                           In both of these cases, we RETURN.  Other-
     1818     7714                           wise, that is if the formname is too long or
     1819     7715                           garbled (e.g. '()'), we ALTRET. */
     1820     7716    1   CHK_FORM: PROC ALTRET;
     1821     7717
     1822     7718    2         DEVDEST.FORM=' ';
     1823     7719    2         OPENIT.FORM_=VECTOR(NIL);
     1824     7720    2         CALL FINDIT ALTRET(RTN);
     1825     7721    2         II=II-JJ;
     1826     7722    2         IF II <= 1 OR II > 07 THEN ALTRETURN;
     1827     7723    2         II=II-1;
     1828     7724    2         OPENFORM.FORM#=PINCRC(TVEC.PTR$,JJ+1)->B$CHARSII;
     1829     7725    2         OPENIT.FORM_=VECTOR(OPENFORM);
     1830     7726    2         DEVDEST.FORMR.O='(';
     1831     7727    2         DEVDEST.FORMR.C=')';
     1832     7728    2         DEVDEST.FORMR.NAME=OPENFORM.FORM#;
     1833     7729    2   RTN:  ;
     1834     7730    2         RETURN;
     1835     7731        /*D* NAME:         DOFID
     1836     7732             PURPOSE:      To do an M$FID of a NCTL FID
     1837     7733             DESCRIPTION:  The text FID is framed by FIDIT.TEXTFID_, and
     1838     7734                           an M$FID is done on the framed text minus the
     1839     7735                           formname if any. */
     1840     7736    2   DOFID: ENTRY ALTRET;
     1841     7737    2         CALL FINDIT;
     1842     7738    2         II=TVEC.W1.VSIZE#;
     1843     7739    2         TVEC.W1.VSIZE#=JJ-1;
     1844     7740    2         FIDIT.TEXTFID_=TVEC;
     1845     7741    2         TVEC.W1.VSIZE#=II;
     1846     7742    2         CALL M$FID (FIDIT) ALTRET(FIDALT);
     1847     7743    2         FIDIT.TEXTFID_=TVEC;
     1848     7744    2         RETURN;
     1849     7745    2   FIDALT:;
     1850     7746    2         FIDIT.TEXTFID_=TVEC;
     1851     7747    2         ALTRETURN;
     1852     7748
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:57   
     1853     7749    2   FINDIT: PROC ALTRET;
     1854     7750    3         TVEC=FIDIT.TEXTFID_;
     1855     7751    4           DO JJ = 0 TO TVEC.W1.VSIZE#;
     1856     7752    4           IF PINCRC(TVEC.PTR$,JJ)->B$CHAR = '(' THEN
     1857     7753    5             DO;
     1858     7754    6               DO II = JJ TO TVEC.W1.VSIZE#;
     1859     7755    6               IF PINCRC(TVEC.PTR$,II)->B$CHAR = ')' THEN RETURN;
     1860     7756    6               END;
     1861     7757    5             II=JJ;
     1862     7758    5             RETURN;
     1863     7759    5             END;
     1864     7760    4           END;
     1865     7761    3         JJ=TVEC.W1.VSIZE#+1;
     1866     7762    3         ALTRETURN;
     1867     7763    3   END FINDIT;
     1868     7764    2   END CHK_FORM;
     1869     7765    1   END FII$INSYM;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:58   
--  Include file information  --

   JC_MACRO_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   FS$FIT.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   FI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FI_MAC_C.:E05TOU  is referenced.
   FOO_MAC_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   OC_MESSHD_C.:E05TOU  is referenced.
   FI_SUBS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   FI_SCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FII$INSYM.

   Procedure FII$INSYM requires 1743 words for executable code.
   Procedure FII$INSYM requires 40 words of local(AUTO) storage.

    No errors detected in file FII$INSYM.:E05TSI    .

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:59   

 Object Unit name= FII$INSYM                                  File name= FII$INSYM.:E05TOU
 UTS= JUL 29 '97 15:27:05.48 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none   584   1110  FII$INSYM
    2  RoData even  UTS    457    711  FII$INSYM
    3   DCB   even  none     0      0  M$ISCG
    4   DCB   even  none     0      0  M$CSCG
    5   DCB   even  none     0      0  M$APLCG
    6   Proc  even  none  1743   3317  FII$INSYM
    7  RoData even  none    61     75  FII$INSYM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     6      0   yes            yes      Main       0  FII$INSYM
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:60   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          Async      0 FIE$XCON
         yes          Async      0 FIE$EVNT
         yes           Std       0 FIA$INIT
         yes           Std       0 FIA$APLAU
 yes     yes           Std       4 FOI$SNAP
         yes           Std       0 FIA$ZAP
 yes     yes           Std       4 FOI$LDTRC
         yes           Std       0 FIA$APLRD
 yes     yes           Std       2 FOI$GBUF
 yes     yes           Std       2 FOI$RBUF
                       nStd      0 X66_MAUTO
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  FI_CSCGBUF                            FI_ISCGBUF
     FI_DEVSCB                             FI_EVHD$                              FI_EVTL$
     FI_FEVHD$                             FI_FEVTL$                             FI_DEVHD$
     FI_EVNT$                              FI_DEV_INIT                           FI_EVQ
     FI_SYSACCT                            M$ISCG                                M$CSCG
     M$APLCG                               B$JIT$                                B$TCB$
     FI_APLCGBUF                           B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:61   


        1        1        /*M* FII$INSYM Main routine for INSYM ghost */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=6,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         FII$INSYM
       10       10
       11       11             PURPOSE:      To provide the main routine for the INSYM ghost
       12       12
       13       13             DESCRIPTION:  The system ghost INSYM is responsible for the
       14       14                           input symbiont host functions of CP6, and also
       15       15                           administers APL shared variables.
       16       16
       17       17                           For the latter function, INSYM is the administrative
       18       18                           user of the APLCG.  See the module FIA$APL.
       19       19
       20       20                           INSYM is the administrative user of the INSYM
       21       21                           comgroup.  Each input symbiont device, whether
       22       22                           remote or local, is connected to this comgroup
       23       23                           when it logs on to CP6, whereupon INSYM is informed
       24       24                           of the connection.
       25       25
       26       26                           Upon connection to the ISCG, the device
       27       27                           is recorded as idle by INSYM.  When the
       28       28                           break or input-ready event is received
       29       29                           from the device, INSYM M$ACTIVATEs it,
       30       30                           which allows the device to be read and
       31       31                           satisfy some of INSYM's anonymous reads
       32       32                           to the ISCG.  Then, if the device has been
       33       33                           defined as a control device, INSYM flushes
       34       34                           until a !JOB or !NCTL card is read.  When
       35       35                           this happens, a DCB is opened to the ap-
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:62   
       36       36                           propriate place, and cards are written to
       37       37                           that DCB as they arrive, until an EOF con-
       38       38                           dition or new !JOB/!NCTL is encountered,
       39       39                           at which time the DCB is closed, thus creating
       40       40                           the new job or file.  Note that once !NCTL
       41       41                           is encountered, EOF (not !JOB/!NCTL) is the
       42       42                           only possible terminator of the file.  Also,
       43       43                           if a card accompanies the EOF condition, and
       44       44                           it starts with '!FIN ', then it is not echoed
       45       45                           into the file.  Lastly, records with an ARS
       46       46                           of zero are echoed into the file.
       47       47
       48       48                           Thus, control devices may submit control files
       49       49                           (via !JOB) or non-control files (via !NCTL).
       50       50                           In the case of a non-control device, only non-
       51       51                           control files may be submitted.  Files are sep-
       52       52                           arated only by EOF, and may begin with !NCTL;
       53       53                           if they do not, the default NCTL FID is used.
       54       54
       55       55                           Note that both types of devices are M$DEACTIVATEd
       56       56                           when EOF is encountered, thus requiring a new
       57       57                           break or input-ready before INSYM will read the
       58       58                           next file.
       59       59
       60       60                           Non-control files are written by INSYM to a FID.
       61       61                           Each device posesses a default NCTL FID, and an
       62       62                           account, both assigned initially by SUPER.  A
       63       63                           control device submitting a file whose first
       64       64                           card is '!NCTL ', and a non-control device whose
       65       65                           first card does not begin '!NCTL ', will submit
       66       66                           a file to the default FID.
       67       67
       68       68                           Both types of devices may submit non-control files
       69       69                           to other than the default FID by having the first
       70       70                           card be one of
       71       71
       72       72                           o '!NCTL FILENAME'
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:63   
       73       73
       74       74                           o '!NCTL DV@WSN[(FORM)]'
       75       75
       76       76                           o '!NTCL DV@[(FORM)]'
       77       77
       78       78                           o '!NCTL FILENAME.ACCN'
       79       79
       80       80                           The first case creates a file FILENAME.ACCT where
       81       81                           ACCT is the device's account.  The second case
       82       82                           writes a file to DV@WSN (e.g. LP@BOSTON).  The
       83       83                           third case writes a file to DV@DEVWSN where DEVWSN
       84       84                           is the device's default NCTL WSN, set up by SUPER.
       85       85                           In the latter two cases, the optional form name
       86       86                           tells INSYM what form to use when writing the
       87       87                           symbiont file.
       88       88                           The fourth case creates a file FILENAME.ACCN.
       89       89
       90       90                           Note the following:
       91       91
       92       92                           o As defined by SUPER, a control device may per-
       93       93                             mit or not permit !NCTL files.
       94       94
       95       95                           o A NCTL file of the form '!NCTL DV@WSN' (from
       96       96                             either type of device) may or may not be legal,
       97       97                             depending upon whether or not the device's
       98       98                             account has access to the desired WSN (if not,
       99       99                             the file is flushed).
      100      100
      101      101                           o An operator may change the device's default
      102      102                             NCTL FID via a keyin.  This enables a device
      103      103                             which is incapable of transmitting a !NCTL
      104      104                             card to send files to various destinations.
      105      105
      106      106                           o For the fourth case, access to 'ACCN' is controlled
      107      107                             through the device's account.  In other words,
      108      108                             the device's account must be authorized to create
      109      109                             the file FILENAME.ACCN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:64   
      110      110        */
      111      111        /**/
      112      112        FII$INSYM: PROC MAIN;

    112  6 000000   000000 700200 xent  FII$INSYM    TSX0  ! X66_MAUTO
         6 000001   000050 000000                    ZERO    40,0

      113      113        /**/
      114      114
      115      115
      116      116
      117      117        /**/
      118      118        /* INCLUDES */
      119      119        /**/
      120      120        %INCLUDE CP_6;
      121      201        %INCLUDE CP_6_SUBS;
      122      741        %INCLUDE FI_SCODE_C;
      123      758        %INCLUDE JG_EVID_C;
      124      983        %INCLUDE OC_SUBS_C;
      125     1714        %INCLUDE FI_SUBS_C;
      126     1816 S      %INCLUDE B$JIT_C;
      127     1817        %INCLUDE OC_MESSHD_C;
      128     1870        %INCLUDE JG_GHOSTS_C;
      129     1960        %INCLUDE FOO_MAC_C;
      130     2708        %INCLUDE FI_MAC_C;
      131     3078        %INCLUDE FI_DATA_R;
      132     3344        %INCLUDE NK_SUBS;
      133     3369        %INCLUDE F_ERRORS_C;
      134     3609        %INCLUDE KC_SUBS_C;
      135     3625        %INCLUDE KC_ERRORS_C;
      136     3672        %INCLUDE FS$FIT;
      137     3715        %INCLUDE F$DCB;
      138     3764        %INCLUDE JC_MACRO_C;
      139     3878
      140     3879
      141     3880
      142     3881        /**/
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:65   
      143     3882        /* BASED STRUCTURES */
      144     3883        /**/
      145     3884        %B$JIT0(STCLASS=BASED);
      146     3973        %U$JIT1;
      147     4047        %A$JIT6X;
      148     4050        %B$TCB;
      149     4053        %B$ALT;
      150     4061    1   DCL B$CHAR5 CHAR(5) BASED ALIGNED;
      151     4062    1   DCL B$CHARS CHAR(I) BASED UNAL;
      152     4063    1   DCL B$CHAR6 CHAR(6) BASED ALIGNED;
      153     4064    1   DCL B$CHAR CHAR(1) BASED UNAL;
      154     4065    1   DCL B$CHAR8 CHAR(8) BASED UNAL;
      155     4066    1   DCL B$CHARSII CHAR(II) BASED UNAL;
      156     4067        %FS$JOBORIG (NAME=FS$JOBORIG,STCLASS=BASED);
      157     4073        %FI_DKEYIN (FPTN=FI$DKEYIN ,STCLASS=BASED);
      158     4102        %FI_DEV    (FPTN=FI$DEV    ,STCLASS=BASED);
      159     4146        %FI_EVNT   (FPTN=FI$EVNT   ,STCLASS=BASED);
      160     4209        %FI_CONINFO(FPTN=FI$CONINFO,STCLASS=BASED);
      161     4253        %B$CGAURD (FPTN=B$CGAURD,LAST=",");
      162     4272        %B$CGAUCI (FPTN=CONINFO,LVL=2,LAST=",");
      163     4294        %FI_CONINFO (FPTN=FIINFO,LVL=2,STCLASS=BASED);
      164     4338        %FI_CITE (FPTN=FI$ISRD,TYP=CGRD,STCLASS=BASED);
      165     4382        %FI_CITE (FPTN=FI$DSMT,TYP=DSMT,STCLASS=BASED);
      166     4426
      167     4427
      168     4428
      169     4429        /**/
      170     4430        /* AUTO */
      171     4431        /**/
      172     4432        %VLP_VECTOR (FPTN=TVEC,STCLASS=AUTO);
      173     4447        %VLP_FORM   (FPTN=OPENFORM,STCLASS=AUTO);
      174     4460    1   DCL DEV$ PTR;
      175     4461    1   DCL KEYIN$ PTR;
      176     4462    1   DCL NDEV UBIN WORD;
      177     4463    1   DCL I UBIN WORD;
      178     4464    1   DCL INFO UBIN WORD;
      179     4465    1   DCL WRITOUT UBIN WORD;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:66   
      180     4466    1   DCL ARS UBIN WORD;
      181     4467    1   DCL BUF$ PTR;
      182     4468    1   DCL P$ PTR;
      183     4469    1   DCL JJ UBIN WORD;
      184     4470    1   DCL II UBIN WORD;
      185     4471    1   DCL CONINFO$ PTR;
      186     4472    1   DCL BTWSN UBIN WORD ALIGNED;
      187     4473    1   DCL BANGDISP UBIN WORD;
      188     4474    1   DCL SAVDEV$ PTR;
      189     4475    1   DCL CITE$ PTR;
      190     4476    1   DCL CGAURD$ PTR;
      191     4477    1   DCL UTS_NOW UBIN WORD STATIC;
      192     4478
      193     4479
      194     4480
      195     4481        /**/
      196     4482        /* STATIC */
      197     4483        /**/
      198     4484    1   DCL GOODNGT SBIN WORD STATIC ALIGNED INIT(0);
      199     4485    1   DCL DEVNAME CHAR(8) STATIC DALIGNED INIT(' ');
      200     4486    1   DCL 1 DEVNAMER REDEF DEVNAME DALIGNED,
      201     4487    1         2 TYP CHAR(2) UNAL,
      202     4488    1         2 NUM CHAR(2) UNAL,
      203     4489    1         2 TWSN# CHAR(4) UNAL;
      204     4490    1   DCL FIDWSN CHAR(8) STATIC DALIGNED;
      205     4491    1   DCL FIDACCT CHAR(8) STATIC DALIGNED;
      206     4492    1   DCL 1 DCBNUMBER STATIC DALIGNED,
      207     4493    1         2 DCB# UBIN WORD UNAL,
      208     4494    1         2 * UBIN WORD UNAL;
      209     4495    1   DCL 1 JOBDEST STATIC ALIGNED,
      210     4496    1         2 * CHAR(4) UNAL INIT('Job '),
      211     4497    1         2 SYSID CHAR(6) UNAL,
      212     4498    1         2 * CHAR(%(%FIMI_NFMX#-10)) UNAL INIT(' ');
      213     4499    1   DCL JOBDESTR REDEF JOBDEST CHAR(%FIMI_NFMX#) ALIGNED;
      214     4500    1   DCL 1 FILDEST STATIC ALIGNED,
      215     4501    1         2 * CHAR(5) UNAL INIT('NCTL '),
      216     4502    1         2 FILE CHAR(%(%FIMI_NFMX#-5)) UNAL;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:67   
      217     4503    1   DCL FILDESTR REDEF FILDEST CHAR(%FIMI_NFMX#) ALIGNED;
      218     4504    1   DCL 1 DEVDEST STATIC ALIGNED,
      219     4505    1         2 * CHAR(5) UNAL INIT('NCTL '),
      220     4506    1         2 RES CHAR(2) UNAL,
      221     4507    1         2 * CHAR(1) UNAL INIT('@'),
      222     4508    1         2 WSN CHAR(8) UNAL,
      223     4509    1         2 FORM CHAR(08) UNAL,
      224     4510    1         2 FORMR REDEF FORM UNAL,
      225     4511    1           3 O CHAR(1) UNAL,
      226     4512    1           3 NAME CHAR(06) UNAL,
      227     4513    1           3 C CHAR(1) UNAL,
      228     4514    1         2 * CHAR(%(%FIMI_NFMX#-24)) UNAL INIT(' ');
      229     4515    1   DCL DEVDESTR REDEF DEVDEST CHAR(%FIMI_NFMX#) ALIGNED;
      230     4516        %FS$JOBORIG (NAME=OPNATTR,STCLASS=STATIC,SIZ=FIT);
      231     4522        %B$JIT0X (B$JIT0=TJIT,STCLASS=STATIC);
      232     4525        %A$JIT6X;
      233     4528        %OC_MESSHD_D       (NAME=OPMSG_DINFO,
      234     4529                 NPARMS         = 10,
      235     4530            ATR       = M_UR,
      236     4531            MSG       = FI_SYMB_MSG#,
      237     4532            STCLASS   = STATIC);
      238     4545    1         2 * UBIN BYTE UNAL INIT(1),
      239     4546    1         2 * UBIN BYTE UNAL INIT(1),
      240     4547    1         2 * UBIN BYTE UNAL INIT(1),
      241     4548    1         2 * UBIN BYTE UNAL INIT(1),
      242     4549    1         2 * UBIN BYTE UNAL INIT(1),
      243     4550    1         2 * UBIN BYTE UNAL INIT(%(%FIMI_NFMX#-26)),
      244     4551    1         2 * UBIN BYTE UNAL INIT(1),
      245     4552    1         2 * UBIN BYTE UNAL INIT(%(%FIMI_NFMX#-26)),
      246     4553    1         2 * UBIN BYTE UNAL INIT(1),
      247     4554    1         2 * UBIN BYTE UNAL INIT(8),
      248     4555    1         2 STATE UBIN BYTE UNAL,
      249     4556    1         2 FIRST UBIN BYTE UNAL,
      250     4557    1         2 FLUSH UBIN BYTE UNAL,
      251     4558    1         2 NCTL UBIN BYTE UNAL,
      252     4559    1         2 CTL UBIN BYTE UNAL,
      253     4560    1         2 DEST CHAR(%(%FIMI_NFMX#-26)) UNAL,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:68   
      254     4561    1         2 PFID UBIN BYTE UNAL,
      255     4562    1         2 NFID CHAR(%(%FIMI_NFMX#-26)) UNAL,
      256     4563    1         2 SUBC UBIN BYTE UNAL,
      257     4564    1         2 TNAME CHAR(8) UNAL;
      258     4565        %OC_MESSHD_D       (NAME=OPMSG_KERR,
      259     4566            NPARMS    = 4,
      260     4567            ATR       = M_UR,
      261     4568            MSG       = FI_KERR_MSG#,
      262     4569            STCLASS   = STATIC);
      263     4582    1         2 * UBIN BYTE UNAL INIT(1),
      264     4583    1         2 * UBIN BYTE UNAL INIT(2),
      265     4584    1         2 * UBIN BYTE UNAL INIT(1),
      266     4585    1         2 * UBIN BYTE UNAL INIT(8),
      267     4586    1         2 SUBC UBIN BYTE UNAL,
      268     4587    1         2 ERRC UBIN HALF UNAL,
      269     4588    1         2 SUBC1 UBIN BYTE UNAL,
      270     4589    1         2 TNAME CHAR(8) UNAL;
      271     4590        %OC_MESSHD_D       (NAME=OPMSG_TCON,
      272     4591            NPARMS         = 4,
      273     4592            MSG       = FI_TCON_MSG#,
      274     4593            ATR       = M_UR,
      275     4594            STCLASS   = STATIC);
      276     4607    1         2 * UBIN BYTE UNAL INIT(1),
      277     4608    1         2 * UBIN BYTE UNAL INIT(1),
      278     4609    1         2 * UBIN BYTE UNAL INIT(2),
      279     4610    1         2 * UBIN BYTE UNAL INIT(%FIMI_NFMX#),
      280     4611    1         2 SUBC UBIN BYTE UNAL,
      281     4612    1         2 SUBC1 UBIN BYTE UNAL,
      282     4613    1         2 ERRC UBIN HALF UNAL,
      283     4614    1         2 NFID CHAR(%FIMI_NFMX#) UNAL;
      284     4615        %OC_MESSHD_D            (NAME=OPMSG_JBFL,
      285     4616                 NPARMS    = 3,
      286     4617                 MSG       = FI_JBFL_MSG#,
      287     4618                 ATR       = M_UR,
      288     4619                 STCLASS   = STATIC);
      289     4632    1         2 * UBIN BYTE UNAL INIT(2),
      290     4633    1         2 * UBIN BYTE UNAL INIT(2),
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:69   
      291     4634    1         2 * UBIN BYTE UNAL INIT(%FIMI_NFMX#),
      292     4635    1         2 SUBC UBIN HALF UNAL,
      293     4636    1         2 ERRC UBIN HALF UNAL,
      294     4637    1         2 DEST CHAR(%FIMI_NFMX#) UNAL;
      295     4638        %OC_MESSHD_D            (NAME=OPMSG_JBSB,
      296     4639                 NPARMS    = 1,
      297     4640                 MSG       = FI_JBSB_MSG#,
      298     4641                 ATR       = M_UR,
      299     4642                 STCLASS   = STATIC);
      300     4655    1         2 * UBIN BYTE UNAL INIT(%FIMI_NFMX#),
      301     4656    1         2 DEST CHAR(%FIMI_NFMX#) UNAL;
      302     4657        %OC_MESSHD_D            (NAME=OPMSG_RESP,
      303     4658                 NPARMS    = 3,
      304     4659                 MSG       = FI_RESP_MSG#,
      305     4660                 ATR       = M_UR,
      306     4661                 STCLASS   = STATIC);
      307     4674    1         2 * UBIN BYTE UNAL INIT(2),
      308     4675    1         2 * UBIN BYTE UNAL INIT(2),
      309     4676    1         2 * UBIN BYTE UNAL INIT(%FIMI_NFMX#),
      310     4677    1         2 SUBC UBIN HALF UNAL,
      311     4678    1         2 SUBC1 UBIN HALF UNAL,
      312     4679    1         2 FID CHAR(%FIMI_NFMX#) UNAL;
      313     4680        %OC_MESSHD_D            (NAME=OPMSG_UNIMP,
      314     4681                 NPARMS    = 0,
      315     4682                 MSG       = UNIMP_MSG#,
      316     4683                 DELIM     =";",
      317     4684                 STCLASS   = STATIC);
      318     4697
      319     4698
      320     4699
      321     4700        /**/
      322     4701        /* CONSTANT */
      323     4702        /**/
      324     4703    1   DCL EODCARD CHAR(4) CONSTANT ALIGNED INIT('!EOD');
      325     4704        %JC_CITE (FPTN=JC_PCMP,TYP=PCMP,COD=JCEV_PCMP#,USR=JG_INSYM#,STCLASS=CONSTANT);
      326     4754        %OC_MESSHD_D            (NAME=ZAPRESP,
      327     4755                 FUNC      = ZAP,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:70   
      328     4756                 DELIM     =";",
      329     4757                 STCLASS   = CONSTANT);
      330     4770
      331     4771
      332     4772
      333     4773        /**/
      334     4774        /* DCBS */
      335     4775        /**/
      336     4776    1   DCL M$ISCG DCB;
      337     4777    1   DCL M$CSCG DCB;
      338     4778    1   DCL M$APLCG DCB;
      339     4779
      340     4780
      341     4781
      342     4782        /**/
      343     4783        /* REFS */
      344     4784        /**/
      345     4785    1   DCL B$JIT$ PTR SYMREF;
      346     4786    1   DCL B$TCB$ PTR SYMREF;
      347     4787        %FI_APLMSG (FPTN=FI_APLCGBUF,STCLASS=SYMREF);
      348     4817
      349     4818    1   DCL FIA$APLAU     ENTRY;
      350     4819    1   DCL FIA$APLRD     ENTRY;
      351     4820    1   DCL FIA$INIT      ENTRY;
      352     4821    1   DCL FIA$ZAP       ENTRY;
      353     4822    1   DCL FIE$EVNT      ENTRY    ASYNC;
      354     4823    1   DCL FIE$XCON      ENTRY    ASYNC;
      355     4824    1   DCL FOI$GBUF      ENTRY(2) ALTRET;
      356     4825    1   DCL FOI$LDTRC     ENTRY(4) ALTRET;
      357     4826    1   DCL FOI$RBUF      ENTRY(2) ALTRET;
      358     4827    1   DCL FOI$SNAP      ENTRY(4) ALTRET;
      359     4828
      360     4829
      361     4830
      362     4831        /**/
      363     4832        /* PMME FPTS */
      364     4833        /**/
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:71   
      365     4834        %FPT_XCON                              (FPTN=XCONSET,
      366     4835                 STCLASS   = CONSTANT,
      367     4836                 UENTRY    = FIE$XCON);
      368     4850        %FPT_EVENT                             (FPTN=EVENTSET,
      369     4851                 UENTRY    = FIE$EVNT,
      370     4852                 STCLASS   = CONSTANT);
      371     4866        %FPT_WAIT                              (FPTN=SLEEP1,
      372     4867                 UNITS     = 1,
      373     4868                 STCLASS   = CONSTANT);
      374     4882        %FPT_WAIT                              (FPTN=SLEEP,
      375     4883                 UNITS     = 1000,
      376     4884                 STCLASS   = CONSTANT);
      377     4898        %FPT_TIME                             (FPTN=GET_UTS,
      378     4899                 STCLASS = STATIC,
      379     4900                 SOURCE = CLOCK,
      380     4901                 DEST = UTS,
      381     4902                 TSTAMP = UTS_NOW);
      382     4921        %FPT_OPEN                              (FPTN=OPEN_CSCG,
      383     4922                 DCB       = M$CSCG,
      384     4923                 SCRUB     = YES,
      385     4924                 NAME      = CSCGNAME,
      386     4925                 ACCT      = FI_SYSACCT,
      387     4926                 SETSTA    = INSYMNAMECS,
      388     4927                 ASN       = COMGROUP,
      389     4928                 STCLASS   = CONSTANT);
      390     5037        %VLP_SETSTA                            (FPTN=INSYMNAME,
      391     5038                 MYSTATION = 'INSYM',
      392     5039                 DIRONLY   = NO,
      393     5040                 STCLASS   = CONSTANT);
      394     5068        %VLP_SETSTA                           (FPTN=INSYMNAMECS,
      395     5069                 DIRONLY   = YES,
      396     5070                 WAS       = YES,
      397     5071                 MYSTATION = 'INSYM',
      398     5072                 OSTATION  = 'KEYIN',
      399     5073                 STCLASS   = CONSTANT);
      400     5101        %FPT_OPEN                              (FPTN=OPEN_ISCG,
      401     5102                 DCB       = M$ISCG,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:72   
      402     5103                 SHARE     = ALL,
      403     5104                 SCRUB     = YES,
      404     5105                 CTG       = YES,
      405     5106                 IXTNSIZE  = %FIMI_CIXT#,
      406     5107                 AU        = YES,
      407     5108                 NAME      = ISCGNAME,
      408     5109                 ACCT      = FI_SYSACCT,
      409     5110                 SETSTA    = INSYMNAME,
      410     5111                 ASN       = COMGROUP,
      411     5112                 ORG       = TERMINAL,
      412     5113                 FUN       = CREATE,
      413     5114                 EXIST     = NEWFILE,
      414     5115                 ACCESS    = ISCG_ACCESS,
      415     5116                 STCLASS   = CONSTANT);
      416     5225        %VLP_ATTR                             (FPTN=ISCG_ACCESS);
      417     5239        %VLP_ACCESS                           (STCLASS=CONSTANT,
      418     5240                 READ      = NO,
      419     5241                 UPD       = NO,
      420     5242                 WNEW      = NO,
      421     5243                 DELR      = NO,
      422     5244                 DELF      = NO,
      423     5245                 REATTR    = NO,
      424     5246                 EXEC      = NO,
      425     5247                 ACCT      = '?',
      426     5248                 LAST      =";");
      427     5265        %VLP_CGCP                             (FPTN=ISCGCP,
      428     5266                 TMTYP     = ' ',
      429     5267                 DMTYP     = ' ',
      430     5268                 MAXPG     = %FIMI_CIMP#,
      431     5269                 DISKWARN  = %FIMI_CXMP#,
      432     5270                 MEMWARN   = %FIMI_CXMP#,
      433     5271                 DATAPGS   =10,
      434     5272                 DSCREQ    = YES,
      435     5273                 CONMSG    = YES,
      436     5274                 TERMCONAU = NO,
      437     5275                 DCBCONAU  = NO,
      438     5276                 TERMCONNAU= NO,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:73   
      439     5277                 DCBCONNAU = NO,
      440     5278                 AUCONTERM = NC,
      441     5279                 AUCONDCB  = NC,
      442     5280                 AUDCONTERM= DEACTIVATE,
      443     5281                 AUDCONDCB = NC,
      444     5282                 XSTALGL   = YES,
      445     5283                 WAS       = NO,
      446     5284                 RAS       = NO,
      447     5285                 SMD       = NO,
      448     5286                 XTYPLGL   = YES,
      449     5287                 MAXMC     = 1024,
      450     5288                 TERMCONLGL= YES,
      451     5289                 DCBCONLGL = NO,
      452     5290                 INPUT     = YES,
      453     5291                 OUTPUT    = NO,
      454     5292                 SECURE    = NO,
      455     5293                 STCLASS   = STATIC);
      456     5336        %FPT_CGCTL                            (FPTN=CTL_ISCG,
      457     5337                 DCB       = M$ISCG,
      458     5338                 CGCP      = ISCGCP,
      459     5339                 STCLASS   = CONSTANT);
      460     5362        %VLP_NAME          (FPTN=CSCGNAME,
      461     5363                 NAME      = 'CSCG',
      462     5364                 STCLASS   = CONSTANT);
      463     5391        %FPT_EXTEND                           (FPTN=EXTEND_ISCG,
      464     5392                 DCB       = M$ISCG,
      465     5393                 SIZ       = %FIMI_CXXT#,
      466     5394                 STCLASS   = CONSTANT);
      467     5408        %VLP_NAME          (FPTN=ISCGNAME,
      468     5409                 NAME      = 'ISCG',
      469     5410                 STCLASS   = CONSTANT);
      470     5437        %FPT_READ                              (FPTN=READ_ISCG,
      471     5438                 DCB       = M$ISCG,
      472     5439                 BUF       = FI_ISCGBUF,
      473     5440                 WAIT      = NO,
      474     5441                 EVENT     = FI_ISRD#,
      475     5442                 STCLASS   = CONSTANT);
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:74   
      476     5481        %FPT_ACTIVATE                          (FPTN=DISCT_DEV,
      477     5482            DCB       = M$ISCG,
      478     5483            STATION   = DEVNAME,
      479     5484            DISCONNECT= YES,
      480     5485            STCLASS   = CONSTANT);
      481     5508        %FPT_ACTIVATE                          (FPTN=START_DEV,
      482     5509                 DCB       = M$ISCG,
      483     5510                 STATION   = DEVNAME,
      484     5511                 STCLASS   = CONSTANT);
      485     5534        %FPT_ACTIVATE                          (FPTN=STOP_DEV,
      486     5535                 DCB       = M$ISCG,
      487     5536                 STATION   = DEVNAME,
      488     5537                 STCLASS   = CONSTANT);
      489     5560        %FPT_WRITE                             (FPTN=WRITE_ZAPRESP,
      490     5561                 DCB       = M$CSCG,
      491     5562                 BUF       = ZAPRESP,
      492     5563                 STCLASS   = CONSTANT);
      493     5594        %FPT_WRITE                             (FPTN=OCMSG_DINFO,
      494     5595                 BUF       = OPMSG_DINFO,
      495     5596                 DCB       = M$CSCG,
      496     5597                 STCLASS   = CONSTANT);
      497     5628        %FPT_WRITE                             (FPTN=OCMSG_KERR,
      498     5629                 BUF       = OPMSG_KERR,
      499     5630                 DCB       = M$CSCG,
      500     5631                 STCLASS   = CONSTANT);
      501     5662        %FPT_WRITE                             (FPTN=OCMSG_TCON,
      502     5663                 BUF       = OPMSG_TCON,
      503     5664                 DCB       = M$CSCG,
      504     5665                 STCLASS   = CONSTANT);
      505     5696        %FPT_WRITE                             (FPTN=OCMSG_JBFL,
      506     5697                 BUF       = OPMSG_JBFL,
      507     5698                 DCB       = M$CSCG,
      508     5699                 STCLASS   = CONSTANT);
      509     5730        %FPT_WRITE                             (FPTN=OCMSG_JBSB,
      510     5731                 BUF       = OPMSG_JBSB,
      511     5732                 DCB       = M$CSCG,
      512     5733                 STCLASS   = CONSTANT);
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:75   
      513     5764        %FPT_WRITE                             (FPTN=OCMSG_RESP,
      514     5765                 BUF       = OPMSG_RESP,
      515     5766                 DCB       = M$CSCG,
      516     5767                 STCLASS   = CONSTANT);
      517     5798        %FPT_WRITE                             (FPTN=OCMSG_UNIMP,
      518     5799                 STCLASS   = CONSTANT,
      519     5800                 DCB       = M$CSCG,
      520     5801                 BUF       = OPMSG_UNIMP);
      521     5832        %FPT_GETDCB                            (FPTN=GET_DCB,
      522     5833                 STCLASS   = STATIC,
      523     5834                 DCBNUM    = DCBNUMBER);
      524     5849        %FPT_RELDCB                            (FPTN=REL_DCB,
      525     5850                 STCLASS   = STATIC);
      526     5864        %FPT_OPEN                              (FPTN=OPENIT,
      527     5865                 SCRUB     = YES,
      528     5866                 EXIST     = OLDFILE,
      529     5867                 FUN       = CREATE,
      530     5868                 UATTR     = OPNATTR,
      531     5869                 XTNSIZE   = 20,
      532     5870                 STCLASS   = STATIC);
      533     5979        %VLP_NAME               (FPTN=FIDNAME,
      534     5980                 NAME      = '1111111111111111111111111111111',
      535     5981                 STCLASS   = STATIC);
      536     6008        %FPT_FID                               (FPTN=FIDIT,
      537     6009                 NAME      = FIDNAME,
      538     6010                 ACCT      = FIDACCT,
      539     6011                 ASN       = OPENIT.V.ASN#,
      540     6012                 RES       = OPENIT.V.RES#,
      541     6013                 RESULTS   = VLR_FIDIT,
      542     6014                 WSN       = FIDWSN);
      543     6037        %VLR_FID                (FPTN=VLR_FIDIT,
      544     6038                 STCLASS   = STATIC);
      545     6057        %FPT_WRITE                             (FPTN=WRITEIT,
      546     6058                 STCLASS   = STATIC);
      547     6089        %FPT_CLOSE                             (FPTN=CLOSE_REL,
      548     6090                 STCLASS   = STATIC);
      549     6132        %FPT_CLOSE                             (FPTN=CLOSE_SAV,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:76   
      550     6133                 DISP      = SAVE,
      551     6134                 RELG      = YES,
      552     6135                 STCLASS   = STATIC);
      553     6177        %FPT_MADMUCK                          (FPTN=FIND_PSN,
      554     6178                 STCLASS = STATIC,
      555     6179                 READ = YES,
      556     6180                 SN = VLP_SN);
      557     6196        %VLP_SN                               (FPTN=VLP_SN,
      558     6197                 STCLASS = STATIC,
      559     6198                 N = 1);
      560     6211        %FPT_RESCTL                           (FPTN=REL_PSN,
      561     6212                 STCLASS   = CONSTANT,
      562     6213                 RPSN      = VLP_RPSN);
      563     6230        %VLP_RPSN                             (FPTN=VLP_RPSN,
      564     6231                 STCLASS   = STATIC,
      565     6232                 DISP      = REL,
      566     6233                 N         = 1);
      567     6248        %FPT_PRIV                              (FPTN=PRIVZAP,
      568     6249                 PRIV      = %PR_FMSEC#,
      569     6250                 STCLASS   = CONSTANT);
      570     6265        %FPT_READ                             (FPTN=READ_APLCG,
      571     6266                 DCB       = M$APLCG,
      572     6267                 WAIT      = NO,
      573     6268                 EVENT     = FI_APLRD#,
      574     6269                 BUF       = FI_APLCGBUF,
      575     6270                 STCLASS   = STATIC);
      576     6309        %FPT_READ                             (FPTN=READ_CSCG,
      577     6310                 DCB       = M$CSCG,
      578     6311                 WAIT      = NO,
      579     6312                 EVENT     = FI_CSRD#,
      580     6313                 BUF       = FI_CSCGBUF,
      581     6314                 STCLASS   = STATIC);
      582     6353        %FPT_ACTIVATE                         (FPTN=DSCGO_DEV,
      583     6354                 DCB       = M$ISCG,
      584     6355                 STATION   = DEVNAME,
      585     6356                 DSCGO     = YES,
      586     6357                 DISCONNECT= NO,
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:77   
      587     6358                 STCLASS   = CONSTANT);
      588     6381        %FPT_WRITE                             (FPTN=SEND_PCMP,
      589     6382                 STCLASS   = CONSTANT,
      590     6383                 DCB       = M$CSCG,
      591     6384                 BUF       = JC_PCMP,
      592     6385                 STATION   = SLUGNAME);
      593     6416        %VLP_STATION       (FPTN=SLUGNAME,
      594     6417                 STCLASS   = CONSTANT,
      595     6418                 STATION   = 'SLUG  ');
      596     6445
      597     6446
      598     6447
      599     6448        /**/
      600     6449        /* SUBS */
      601     6450        /**/
      602     6451        %SUB F_FI='0611'O;
      603     6452        %SUB M_I='11'O;
      604     6453        %SUB B$ERRCODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE;
      605     6454        %SUB EVNT$ = FI_EVNT$;
      606     6455        %EQU_CG;
      607     6503        %SUB FOREVER="WHILE ('1'B)";
      608     6504        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:78   
      609     6505        /**/
      610     6506        /*
      611     6507
      612     6508             ###    #   #    ###    #   #   #   #
      613     6509              #     #   #   #   #   #   #   ## ##
      614     6510              #     ##  #   #        # #    # # #
      615     6511              #     # # #    ###      #     #   #
      616     6512              #     #  ##       #     #     #   #
      617     6513              #     #   #   #   #     #     #   #
      618     6514             ###    #   #    ###      #     #   #
      619     6515
      620     6516             ###    #   #    ###    #####
      621     6517              #     #   #     #       #
      622     6518              #     ##  #     #       #
      623     6519              #     # # #     #       #
      624     6520              #     #  ##     #       #
      625     6521              #     #   #     #       #
      626     6522             ###    #   #    ###      #
      627     6523
      628     6524        */
      629     6525
      630     6526
      631     6527        /**/
      632     6528        /* BEGIN HERE */
      633     6529        /**/
      634     6530
      635     6531
      636     6532                                /* EXIT IF NOT OURSELF */
      637     6533    1         IF B$JIT$->B$JIT.USER ~= JG_INSYM# THEN CALL M$EXIT;

   6533  6 000002   000000 470400 xsym               LDP0    B$JIT$
         6 000003   000000 236100                    LDQ     0,,PR0
         6 000004   000777 376003                    ANQ     511,DU
         6 000005   000005 116003                    CMPQ    5,DU
         6 000006   000011 600000 6                  TZE     s:6536

   6533  6 000007   000001 713400                    CLIMB   exit
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:79   
         6 000010   000000 401760                    pmme    nvectors=0

      638     6534
      639     6535                                /* GET XCON */
      640     6536    1         CALL M$XCON (XCONSET);

   6536  6 000011   000010 630400 2                  EPPR0   XCONSET
         6 000012   010003 713400                    CLIMB   4099
         6 000013   400400 401760                    pmme    nvectors=2

      641     6537                                /* SET UP GOODIES */
      642     6538    1         CALL MISC_SETUP;

   6538  6 000014   003061 701000 6                  TSX1    MISC_SETUP
         6 000015   000000 011000                    NOP     0

      643     6539                                /* GET EVENT CONTROL */
      644     6540    1         CALL M$EVENT (EVENTSET);

   6540  6 000016   000016 630400 2                  EPPR0   EVENTSET
         6 000017   010001 713400                    CLIMB   4097
         6 000020   400000 401760                    pmme    nvectors=1

      645     6541                                /* CONNECT TO CS COMGROUP */
      646     6542    1         CALL M$OPEN (OPEN_CSCG);

   6542  6 000021   000036 630400 2                  EPPR0   OPEN_CSCG
         6 000022   050000 713400                    CLIMB   open
         6 000023   410400 401760                    pmme    nvectors=18

      647     6543                                /* CONNECT TO INSYM COMGROUP */
      648     6544    1         CALL M$OPEN (OPEN_ISCG);

   6544  6 000024   000160 630400 2                  EPPR0   OPEN_ISCG
         6 000025   050000 713400                    CLIMB   open
         6 000026   410400 401760                    pmme    nvectors=18

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:80   
      649     6545    1         CALL M$CGCTL (CTL_ISCG);

   6545  6 000027   000252 630400 2                  EPPR0   CTL_ISCG
         6 000030   100003 713400                    CLIMB   32771
         6 000031   411400 401760                    pmme    nvectors=20

      650     6546                                /* INITIATE CSCG READS */
      651     6547    1         CALL M$READ (READ_CSCG);

   6547  6 000032   001072 630400 1                  EPPR0   READ_CSCG
         6 000033   040000 713400                    CLIMB   read
         6 000034   401400 401760                    pmme    nvectors=4

      652     6548                                /* START READS ON ISCG */
      653     6549    1         CALL M$READ (READ_ISCG);

   6549  6 000035   000346 630400 2                  EPPR0   READ_ISCG
         6 000036   040000 713400                    CLIMB   read
         6 000037   401400 401760                    pmme    nvectors=4

      654     6550                                /* START UP APLCG STUFF */
      655     6551    1         CALL FIA$INIT;

   6551  6 000040   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 000041   000000 701000 xent               TSX1    FIA$INIT
         6 000042   000000 011000                    NOP     0

      656     6552    1         CALL M$READ (READ_APLCG);

   6552  6 000043   001054 630400 1                  EPPR0   READ_APLCG
         6 000044   040000 713400                    CLIMB   read
         6 000045   401400 401760                    pmme    nvectors=4

      657     6553                                /* TELL SLUG OUR INIT IS FINI */
      658     6554    1         CALL M$WRITE (SEND_PCMP);

   6554  6 000046   000652 630400 2                  EPPR0   SEND_PCMP
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:81   
         6 000047   040001 713400                    CLIMB   write
         6 000050   401400 401760                    pmme    nvectors=4

      659     6555        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:82   
      660     6556        /*
      661     6557
      662     6558                    #   #    ###     ###    #   #
      663     6559                    ## ##   #   #     #     #   #
      664     6560                    # # #   #   #     #     ##  #
      665     6561                    #   #   #####     #     # # #
      666     6562                    #   #   #   #     #     #  ##
      667     6563                    #   #   #   #     #     #   #
      668     6564                    #   #   #   #    ###    #   #
      669     6565
      670     6566
      671     6567                    #        ###     ###    ####
      672     6568                    #       #   #   #   #   #   #
      673     6569                    #       #   #   #   #   #   #
      674     6570                    #       #   #   #   #   ####
      675     6571                    #       #   #   #   #   #
      676     6572                    #       #   #   #   #   #
      677     6573                    #####    ###     ###    #
      678     6574
      679     6575        */
      680     6576    2           DO FOREVER;

      681     6577    3             DO INHIBIT;

      682     6578    3             IF FI_EVHD$=ADDR(NIL) THEN

   6578  6 000051   000000 236200 xsym               LDQ   ! FI_EVHD$
         6 000052   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         6 000053   000060 601200 6                  TNZ   ! s:6582

      683     6579    3              CALL M$WAIT(SLEEP);

   6579  6 000054   000030 630600 2                  EPPR0 ! SLEEP
         6 000055   020006 713600                    CLIMB ! 8198
         6 000056   400400 401760                    pmme    nvectors=2
         6 000057   000136 710200 6                  TRA   ! s:6601

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:83   
      684     6580    3             ELSE
      685     6581    4               DO;

      686     6582    4               EVNT$=FI_EVHD$;

   6582  6 000060   000000 756200 xsym               STQ   ! FI_EVNT$

      687     6583    4               FI_EVHD$=EVNT$->FI$EVNT.LNK$;

   6583  6 000061   000000 470600 xsym               LDP0  ! FI_EVNT$
         6 000062   000000 236300                    LDQ   ! 0,,PR0
         6 000063   000000 756200 xsym               STQ   ! FI_EVHD$

      688     6584    4               IF FI_EVHD$=ADDR(NIL) THEN FI_EVTL$=ADDR(NIL);

   6584  6 000064   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         6 000065   000070 601200 6                  TNZ   ! s:6585

   6584  6 000066   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         6 000067   000000 756200 xsym               STQ   ! FI_EVTL$

      689     6585    4               CALL EXT_EVENT;

   6585  6 000070   000137 701200 6                  TSX1  ! EXT_EVENT
         6 000071   000000 011200                    NOP   ! 0

      690     6586    5                 DO CASE (EVNT$->FI$EVNT.ENDAC);

   6586  6 000072   000000 470600 xsym               LDP0  ! FI_EVNT$
         6 000073   000001 720300                    LXL0  ! 1,,PR0
         6 000074   000004 100203                    CMPX0 ! 4,DU
         6 000075   000077 602210 6                  TNC   ! s:6586+5,X0
         6 000076   000120 710200 6                  TRA   ! s:6595
         6 000077   000120 710200 6                  TRA   ! s:6595
         6 000100   000103 710200 6                  TRA   ! s:6588
         6 000101   000107 710200 6                  TRA   ! s:6590
         6 000102   000113 710200 6                  TRA   ! s:6592
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:84   

      691     6587    5                   CASE (FIEA_CSCG#);

      692     6588    5                     CALL M$READ (READ_CSCG);

   6588  6 000103   001072 630600 1                  EPPR0 ! READ_CSCG
         6 000104   040000 713600                    CLIMB ! read
         6 000105   401400 401760                    pmme    nvectors=4
         6 000106   000120 710200 6                  TRA   ! s:6595

      693     6589    5                   CASE (FIEA_ISCG#);

      694     6590    5                     CALL M$READ (READ_ISCG);

   6590  6 000107   000346 630600 2                  EPPR0 ! READ_ISCG
         6 000110   040000 713600                    CLIMB ! read
         6 000111   401400 401760                    pmme    nvectors=4
         6 000112   000120 710200 6                  TRA   ! s:6595

      695     6591    5                   CASE (FIEA_APLCG#);

      696     6592    5                     IF GOODNGT = 0 THEN

   6592  6 000113   000001 235200 1                  LDA   ! GOODNGT
         6 000114   000120 601200 6                  TNZ   ! s:6595

      697     6593    5                      CALL M$READ (READ_APLCG);

   6593  6 000115   001054 630600 1                  EPPR0 ! READ_APLCG
         6 000116   040000 713600                    CLIMB ! read
         6 000117   401400 401760                    pmme    nvectors=4

      698     6594    5                 END;

      699     6595    4               IF FI_FEVTL$=ADDR(NIL) THEN FI_FEVHD$=EVNT$;

   6595  6 000120   000000 236200 xsym               LDQ   ! FI_FEVTL$
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:85   
         6 000121   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         6 000122   000126 601200 6                  TNZ   ! s:6596

   6595  6 000123   000000 236200 xsym               LDQ   ! FI_EVNT$
         6 000124   000000 756200 xsym               STQ   ! FI_FEVHD$
         6 000125   000131 710200 6                  TRA   ! s:6597

      700     6596    4               ELSE FI_FEVTL$->FI$EVNT.LNK$=EVNT$;

   6596  6 000126   000000 236200 xsym               LDQ   ! FI_EVNT$
         6 000127   000000 470600 xsym               LDP0  ! FI_FEVTL$
         6 000130   000000 756300                    STQ   ! 0,,PR0

      701     6597    4               FI_FEVTL$=EVNT$;

   6597  6 000131   000000 236200 xsym               LDQ   ! FI_EVNT$
         6 000132   000000 756200 xsym               STQ   ! FI_FEVTL$

      702     6598    4               EVNT$->FI$EVNT.LNK$=ADDR(NIL);

   6598  6 000133   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         6 000134   000000 470600 xsym               LDP0  ! FI_EVNT$
         6 000135   000000 756300                    STQ   ! 0,,PR0

      703     6599    4               END;

      704     6600    3             END;

      705     6601    2           END;

   6601  6 000136   000051 710000 6                  TRA     s:6578

      706     6602        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:86   
      707     6603        /*
      708     6604
      709     6605            #####   #   #   #####   #####   ####    #   #    ###    #
      710     6606            #       #   #     #     #       #   #   #   #   #   #   #
      711     6607            #        # #      #     #       #   #   ##  #   #   #   #
      712     6608            ####      #       #     ####    ####    # # #   #####   #
      713     6609            #        # #      #     #       # #     #  ##   #   #   #
      714     6610            #       #   #     #     #       #  #    #   #   #   #   #
      715     6611            #####   #   #     #     #####   #   #   #   #   #   #   #####
      716     6612
      717     6613
      718     6614                    #####   #   #   #####   #   #   #####
      719     6615                    #       #   #   #       #   #     #
      720     6616                    #       #   #   #       ##  #     #
      721     6617                    ####    #   #   ####    # # #     #
      722     6618                    #       #   #   #       #  ##     #
      723     6619                    #        # #    #       #   #     #
      724     6620                    #####     #     #####   #   #     #
      725     6621
      726     6622        */
      727     6623
      728     6624
      729     6625        /*****
      730     6626         *****
      731     6627         *****
      732     6628         *****   PROCESS THE EVENT HERE
      733     6629         *****
      734     6630         *****
      735     6631         *****/
      736     6632
      737     6633
      738     6634    1   EXT_EVENT: PROC;

   6634  6 000137   200032 741300       EXT_EVENT    STX1  ! CGAURD$+2,,AUTO

      739     6635
      740     6636
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:87   
      741     6637
      742     6638    2         DEV$=ADDR(NIL);

   6638  6 000140   000001 236000 xsym               LDQ     B_VECTNIL+1
         6 000141   200010 756100                    STQ     DEV$,,AUTO

      743     6639    2         CITE$=EVNT$->FI$EVNT.CITE$;

   6639  6 000142   000000 470400 xsym               LDP0    FI_EVNT$
         6 000143   000002 236100                    LDQ     2,,PR0
         6 000144   200027 756100                    STQ     CITE$,,AUTO

      744     6640    3           DO CASE (EVNT$->FI$EVNT.CODE);

   6640  6 000145   000001 220100                    LDX0    1,,PR0
         6 000146   000010 100003                    CMPX0   8,DU
         6 000147   000151 602010 6                  TNC     s:6640+4,X0
         6 000150   001325 710000 6                  TRA     s:7123
         6 000151   001331 710000 6                  TRA     ENDEVENT
         6 000152   000161 710000 6                  TRA     s:6655
         6 000153   000374 710000 6                  TRA     s:6800
         6 000154   001122 710000 6                  TRA     s:7001
         6 000155   001317 710000 6                  TRA     s:7101
         6 000156   001311 710000 6                  TRA     s:7090
         6 000157   001144 710000 6                  TRA     s:7020
         6 000160   001257 710000 6                  TRA     s:7063

      745     6641
      746     6642
      747     6643
      748     6644
      749     6645
      750     6646        /***
      751     6647         ***
      752     6648         ***
      753     6649         ***          ISCG ADMIN USER EVENT
      754     6650         ***
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:88   
      755     6651         ***
      756     6652         ***/
      757     6653    3             CASE (FIEV_ISAU#);

      758     6654
      759     6655    3               CGAURD$=ADDR(FI_ISCGBUF);

   6655  6 000161   000000 236000 7                  LDQ     0
         6 000162   200030 756100                    STQ     CGAURD$,,AUTO

      760     6656    3               INFO=CGAURD$->B$CGAURD.INFO;

   6656  6 000163   200030 471500                    LDP1    CGAURD$,,AUTO
         6 000164   100003 235100                    LDA     3,,PR1
         6 000165   200014 755100                    STA     INFO,,AUTO

      761     6657    3               DEVNAME=CGAURD$->B$CGAURD.STATION;

   6657  6 000166   040000 100500                    MLR     fill='040'O
         6 000167   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         6 000170   000002 000010 1                  ADSC9   DEVNAME                  cn=0,n=8

      762     6658
      763     6659                                /* VECTOR ON EVENT SUBCODE */
      764     6660
      765     6661    4                 DO CASE (CGAURD$->B$CGAURD.EVENT);

   6661  6 000171   100000 235100                    LDA     0,,PR1
         6 000172   000027 115007                    CMPA    23,DL
         6 000173   000175 602005 6                  TNC     s:6661+4,AL
         6 000174   000367 710000 6                  TRA     s:6774
         6 000175   000367 710000 6                  TRA     s:6774
         6 000176   000367 710000 6                  TRA     s:6774
         6 000177   000224 710000 6                  TRA     s:6669
         6 000200   000245 710000 6                  TRA     s:6696
         6 000201   000314 710000 6                  TRA     s:6723
         6 000202   000367 710000 6                  TRA     s:6774
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:89   
         6 000203   000367 710000 6                  TRA     s:6774
         6 000204   000367 710000 6                  TRA     s:6774
         6 000205   000367 710000 6                  TRA     s:6774
         6 000206   000353 710000 6                  TRA     s:6762
         6 000207   000367 710000 6                  TRA     s:6774
         6 000210   000367 710000 6                  TRA     s:6774
         6 000211   000367 710000 6                  TRA     s:6774
         6 000212   000367 710000 6                  TRA     s:6774
         6 000213   000367 710000 6                  TRA     s:6774
         6 000214   000367 710000 6                  TRA     s:6774
         6 000215   000367 710000 6                  TRA     s:6774
         6 000216   000367 710000 6                  TRA     s:6774
         6 000217   000367 710000 6                  TRA     s:6774
         6 000220   000367 710000 6                  TRA     s:6774
         6 000221   000367 710000 6                  TRA     s:6774
         6 000222   000367 710000 6                  TRA     s:6774
         6 000223   000236 710000 6                  TRA     s:6687

      766     6662        /**
      767     6663         **
      768     6664         **      TERMINAL CONNECT
      769     6665         **
      770     6666         **/
      771     6667    4                   CASE (%CG_TCON#);

      772     6668
      773     6669    4                     CONINFO$=ADDR(CGAURD$->B$CGAURD.FIINFO);

   6669  6 000224   000015 036003                    ADLQ    13,DU
         6 000225   200023 756100                    STQ     CONINFO$,,AUTO

      774     6670    4                     CALL ADD_DEV ALTRET(A10);

   6670  6 000226   002572 701000 6                  TSX1    ADD_DEV
         6 000227   000231 702000 6                  TSX2    A10

      775     6671    4                     GOTO ENDEVENT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:90   

   6671  6 000230   001331 710000 6                  TRA     ENDEVENT

      776     6672                                /* DEVICE IS ALREADY LISTED. OOPS */
      777     6673    4   A10:              CALL FOI$SNAP (%S$FIDBLCON,F_FI,M_I);

   6673  6 000231   000004 630400 7     A10          EPPR0   4
         6 000232   000021 631400 xsym               EPPR1   B_VECTNIL+17
         6 000233   000000 701000 xent               TSX1    FOI$SNAP
         6 000234   000000 011000                    NOP     0
         6 000235   001331 710000 6                  TRA     ENDEVENT

      778     6674        /*S* SCREECH_CODE: FII-S$FIDBLCON
      779     6675             TYPE:         SNAP
      780     6676             MESSAGE:      Device connected to IS CG twice
      781     6677             REMARKS:      INSYM  received a device-connect event as IS CG
      782     6678                           admin user, but the named device is already
      783     6679                           listed in his tables, implying the device
      784     6680                           connect event has been received twice.   */
      785     6681        /**
      786     6682         **
      787     6683         **      TERMINAL DISCONNECT REQUEST
      788     6684         **
      789     6685         **/
      790     6686    4                   CASE (%CG_TDRQ#);

      791     6687    4                     CALL FIND_DEV ALTRET(NODEV);

   6687  6 000236   002751 701000 6                  TSX1    FIND_DEV
         6 000237   000346 702000 6                  TSX2    NODEV

      792     6688    4                     CALL M$DEACTIVATE (DSCGO_DEV) ALTRET(ENDEVENT);

   6688  6 000240   000632 630400 2                  EPPR0   DSCGO_DEV
         6 000241   500001 713400                    CLIMB   alt,+32769
         6 000242   401400 401760                    pmme    nvectors=4
         6 000243   001331 702000 6                  TSX2    ENDEVENT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:91   
         6 000244   001331 710000 6                  TRA     ENDEVENT

      793     6689        /**
      794     6690         **
      795     6691         **      TERMINAL DISCONNECT
      796     6692         **
      797     6693         **/
      798     6694    4                   CASE (%CG_TDSC#);

      799     6695
      800     6696    4                     CALL FIND_DEV ALTRET(ENDEVENT);

   6696  6 000245   002751 701000 6                  TSX1    FIND_DEV
         6 000246   001331 702000 6                  TSX2    ENDEVENT

      801     6697    4                     DCBNUMBER.DCB#=0;

   6697  6 000247   000010 450000 1                  STZ     DCBNUMBER

      802     6698    4                     IF DEV$->FI$DEV.STATE = FIS_BUSY# THEN

   6698  6 000250   200010 470500                    LDP0    DEV$,,AUTO
         6 000251   000003 720100                    LXL0    3,,PR0
         6 000252   000001 100003                    CMPX0   1,DU
         6 000253   000276 601000 6                  TNZ     s:6710

      803     6699    5                       DO;

      804     6700    5                       IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD THEN

   6700  6 000254   000007 471400 7                  LDP1    7
         6 000255   100000 473500                    LDP3    0,,PR1
         6 000256   000004 221100                    LDX1    4,,PR0
         6 000257   300000 474511                    LDP4    0,X1,PR3
         6 000260   400031 236100                    LDQ     25,,PR4
         6 000261   020000 316007                    CANQ    8192,DL
         6 000262   000272 600000 6                  TZE     A11
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:92   

      805     6701    6                         DO;

      806     6702    6                         CLOSE_REL.V.DCB#=DEV$->FI$DEV.DCB#;

   6702  6 000263   000764 741000 1                  STX1    CLOSE_REL+26

      807     6703    6                         CALL M$CLOSE (CLOSE_REL) ALTRET(A11);

   6703  6 000264   000732 630400 1                  EPPR0   CLOSE_REL
         6 000265   450001 713400                    CLIMB   alt,close
         6 000266   406000 401760                    pmme    nvectors=13
         6 000267   000272 702000 6                  TSX2    A11

      808     6704    6                         CALL REL_RES;

   6704  6 000270   003027 701000 6                  TSX1    REL_RES
         6 000271   000000 011000                    NOP     0

   6702  6 000272                       A11          null
      809     6705    6   A11:                  ;
      810     6706    6                         END;

      811     6707    5                       DCBNUMBER.DCB#=DEV$->FI$DEV.DCB#;

   6707  6 000272   200010 470500                    LDP0    DEV$,,AUTO
         6 000273   000004 236100                    LDQ     4,,PR0
         6 000274   000022 772000                    QRL     18
         6 000275   000010 756000 1                  STQ     DCBNUMBER

      812     6708    5                       END;

      813     6709
      814     6710    4                     CALL REM_DEV;

   6710  6 000276   002772 701000 6                  TSX1    REM_DEV
         6 000277   000000 011000                    NOP     0
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:93   

      815     6711    4                     OPMSG_TCON.DEVNM=DEVNAME;

   6711  6 000300   000002 237000 1                  LDAQ    DEVNAME
         6 000301   000306 757000 1                  STAQ    OPMSG_TCON+3

      816     6712    4                     OPMSG_TCON.SUBC=1;

   6712  6 000302   001000 236003                    LDQ     512,DU
         6 000303   000311 552040 1                  STBQ    OPMSG_TCON+6,'40'O

      817     6713    4                     OPMSG_TCON.SUBC1=FITD_NRML#;

   6713  6 000304   000000 236003                    LDQ     0,DU
         6 000305   000311 552020 1                  STBQ    OPMSG_TCON+6,'20'O

      818     6714    4                     CALL M$WRITE (OCMSG_TCON);

   6714  6 000306   000510 630400 2                  EPPR0   OCMSG_TCON
         6 000307   040001 713400                    CLIMB   write
         6 000310   401400 401760                    pmme    nvectors=4

      819     6715    4                     IF DCBNUMBER.DCB# ~= 0 THEN GOTO TAKEDCB1;

   6715  6 000311   000010 235000 1                  LDA     DCBNUMBER
         6 000312   001141 601000 6                  TNZ     TAKEDCB1
         6 000313   001331 710000 6                  TRA     ENDEVENT

      820     6716        /**
      821     6717         **
      822     6718         **      TERMINAL BREAK
      823     6719         **
      824     6720         **/
      825     6721    4                   CASE (%CG_TBRK#);

      826     6722
      827     6723    4                     CALL FIND_DEV ALTRET(NODEV);
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:94   

   6723  6 000314   002751 701000 6                  TSX1    FIND_DEV
         6 000315   000346 702000 6                  TSX2    NODEV

      828     6724
      829     6725    4                     IF INFO = %CG_TBRK_EC# THEN

   6725  6 000316   200014 235100                    LDA     INFO,,AUTO
         6 000317   000002 115007                    CMPA    2,DL
         6 000320   000326 601000 6                  TNZ     s:6732

      830     6726                                /* CONTROL-Y : DISCONNECT IT */
      831     6727    5                       DO;

      832     6728    5                       CALL M$DEACTIVATE (DISCT_DEV) ALTRET(ENDEVENT);

   6728  6 000321   000364 630400 2                  EPPR0   DISCT_DEV
         6 000322   500001 713400                    CLIMB   alt,+32769
         6 000323   401400 401760                    pmme    nvectors=4
         6 000324   001331 702000 6                  TSX2    ENDEVENT

      833     6729    5                       GOTO ENDEVENT;

   6729  6 000325   001331 710000 6                  TRA     ENDEVENT

      834     6730    5                       END;
      835     6731
      836     6732    4                     IF (INFO = %CG_TBRK_BRK# OR INFO = %CG_TBRK_RDY#)

   6732  6 000326   000001 115007                    CMPA    1,DL
         6 000327   000332 600000 6                  TZE     s:6732+4
         6 000330   000012 115007                    CMPA    10,DL
         6 000331   000345 601000 6                  TNZ     s:6745
         6 000332   200010 470500                    LDP0    DEV$,,AUTO
         6 000333   000003 720100                    LXL0    3,,PR0
         6 000334   000345 601000 6                  TNZ     s:6745

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:95   
      837     6733    4                     AND DEV$->FI$DEV.STATE = FIS_IDLE# THEN
      838     6734                                /* INPUT READY EVENT ON IDLE DEVICE */
      839     6735    5                       DO;

      840     6736    5                       IF B$JIT$->B$JIT.USERWORD(0) = 0 THEN

   6736  6 000335   000000 471400 xsym               LDP1    B$JIT$
         6 000336   100133 221100                    LDX1    91,,PR1
         6 000337   000343 601000 6                  TNZ     s:6741

      841     6737    6                         DO;

      842     6738    6                         DEV$->FI$DEV.FLG.READY='1'B;

   6738  6 000340   000010 236007                    LDQ     8,DL
         6 000341   000004 256100                    ORSQ    4,,PR0

      843     6739    6                         GOTO ENDEVENT;

   6739  6 000342   001331 710000 6                  TRA     ENDEVENT

      844     6740    6                         END;
      845     6741    5                       CALL STARTIT;

   6741  6 000343   001333 701000 6                  TSX1    STARTIT
         6 000344   000000 011000                    NOP     0

      846     6742    5                       END;

      847     6743
      848     6744                                /* UNKN EVENT. IGNORE */
      849     6745    4                     GOTO ENDEVENT;

   6745  6 000345   001331 710000 6                  TRA     ENDEVENT

   6741  6 000346                       NODEV        null
      850     6746
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:96   
      851     6747                                /* CANNOT FIND DEVICE.  SNAP */
      852     6748    4   NODEV:            ;
      853     6749    4                     CALL FOI$SNAP (%S$FINODEV,F_FI,M_I);

   6749  6 000346   000011 630400 7                  EPPR0   9
         6 000347   000021 631400 xsym               EPPR1   B_VECTNIL+17
         6 000350   000000 701000 xent               TSX1    FOI$SNAP
         6 000351   000000 011000                    NOP     0
         6 000352   001331 710000 6                  TRA     ENDEVENT

      854     6750        /*S* SCREECH_CODE: FII-S$FINODEV
      855     6751             TYPE:         SNAP
      856     6752             MESSAGE:      INSYM cannot find evented device
      857     6753             REMARKS:      INSYM has received an ISCG administrative user
      858     6754                           event or ISCG read-complete event for a device
      859     6755                           not listed in its tables. */
      860     6756        /**
      861     6757         **
      862     6758         **      COMGROUP LOW-ON-SPACE WARNING
      863     6759         **
      864     6760         **/
      865     6761    4                   CASE (%CG_WARN#);

      866     6762    4                     CALL M$EXTEND (EXTEND_ISCG) ALTRET(XTNDALT);

   6762  6 000353   000340 630400 2                  EPPR0   EXTEND_ISCG
         6 000354   440005 713400                    CLIMB   alt,+16389
         6 000355   400000 401760                    pmme    nvectors=1
         6 000356   000357 702000 6                  TSX2    XTNDALT

   6762  6 000357                       XTNDALT      null
      867     6763    4   XTNDALT:          ;
      868     6764    4                     ISCGCP.MAXPG#=ISCGCP.MAXPG#+%FIMI_CXMP#;

   6764  6 000357   000520 220000 1                  LDX0    ISCGCP+6
         6 000360   000031 621010                    EAX1    25,X0
         6 000361   000520 741000 1                  STX1    ISCGCP+6
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:97   

      869     6765    4                     CALL M$CGCTL (CTL_ISCG) ALTRET(XTNDALT0);

   6765  6 000362   000252 630400 2                  EPPR0   CTL_ISCG
         6 000363   500003 713400                    CLIMB   alt,+32771
         6 000364   411400 401760                    pmme    nvectors=20
         6 000365   000366 702000 6                  TSX2    XTNDALT0

   6764  6 000366   001331 710000 6     XTNDALT0     TRA     ENDEVENT

      870     6766    4   XTNDALT0:         ;
      871     6767        /**
      872     6768         **
      873     6769         **      ELSE CASE
      874     6770         **
      875     6771         **/
      876     6772
      877     6773    4                   CASE (ELSE);

      878     6774    4                     CALL FOI$SNAP (%S$FIUAUEV,F_FI,M_I);

   6774  6 000367   000015 630400 7                  EPPR0   13
         6 000370   000021 631400 xsym               EPPR1   B_VECTNIL+17
         6 000371   000000 701000 xent               TSX1    FOI$SNAP
         6 000372   000000 011000                    NOP     0

      879     6775        /*S* SCREECH_CODE: FII-S$FIUAUEV
      880     6776             TYPE:         SNAP
      881     6777             MESSAGE:      Unknown ISAU event passed to INSYM
      882     6778             REMARKS:      INSYM  has received an INSYM  COMGROUP administrative
      883     6779                           user event which he does not recognize.  This sug-
      884     6780                           gests that the path between he and the event issuer
      885     6781                           has been clobbered somewhere, or that someone has
      886     6782                           added a new event INSYM  does not know about and
      887     6783                           was not expected to get.                */
      888     6784        /***
      889     6785         ***
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:98   
      890     6786         ***     END OF ISAU ADMIN USER EVENT SUBC DOCASE
      891     6787         ***
      892     6788         ***/
      893     6789    4                 END;

   6789  6 000373   001331 710000 6                  TRA     ENDEVENT

      894     6790        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:99   
      895     6791        /***
      896     6792         ***
      897     6793         ***
      898     6794         ***          KEYIN RECEIVED
      899     6795         ***
      900     6796         ***
      901     6797         ***/
      902     6798    3             CASE (FIEV_KEYIN#);

      903     6799
      904     6800    3               KEYIN$=CITE$;

   6800  6 000374   200011 756100                    STQ     KEYIN$,,AUTO

      905     6801    3               OPMSG_KERR.CADDR=KEYIN$->FI$DKEYIN.CADDR;

   6801  6 000375   200011 471500                    LDP1    KEYIN$,,AUTO
         6 000376   100000 722100                    LXL2    0,,PR1
         6 000377   000272 742000 1                  STX2    OPMSG_KERR

      906     6802    3               DEVNAME=KEYIN$->FI$DKEYIN.NAME;

   6802  6 000400   040000 100500                    MLR     fill='040'O
         6 000401   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         6 000402   000002 000010 1                  ADSC9   DEVNAME                  cn=0,n=8

      907     6803
      908     6804    4                 DO CASE (KEYIN$->FI$DKEYIN.KIN#);

   6804  6 000403   100000 220100                    LDX0    0,,PR1
         6 000404   000070 100003                    CMPX0   56,DU
         6 000405   000407 602010 6                  TNC     s:6804+4,X0
         6 000406   001114 710000 6                  TRA     s:6975
         6 000407   001114 710000 6                  TRA     s:6975
         6 000410   000510 710000 6                  TRA     s:6817
         6 000411   000675 710000 6                  TRA     s:6879
         6 000412   000477 710000 6                  TRA     s:6811
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:100  
         6 000413   001034 710000 6                  TRA     s:6939
         6 000414   001114 710000 6                  TRA     s:6975
         6 000415   001114 710000 6                  TRA     s:6975
         6 000416   001114 710000 6                  TRA     s:6975
         6 000417   001114 710000 6                  TRA     s:6975
         6 000420   001114 710000 6                  TRA     s:6975
         6 000421   001114 710000 6                  TRA     s:6975
         6 000422   001114 710000 6                  TRA     s:6975
         6 000423   001114 710000 6                  TRA     s:6975
         6 000424   001114 710000 6                  TRA     s:6975
         6 000425   001114 710000 6                  TRA     s:6975
         6 000426   001114 710000 6                  TRA     s:6975
         6 000427   001114 710000 6                  TRA     s:6975
         6 000430   001114 710000 6                  TRA     s:6975
         6 000431   001114 710000 6                  TRA     s:6975
         6 000432   001114 710000 6                  TRA     s:6975
         6 000433   001114 710000 6                  TRA     s:6975
         6 000434   001114 710000 6                  TRA     s:6975
         6 000435   001114 710000 6                  TRA     s:6975
         6 000436   001114 710000 6                  TRA     s:6975
         6 000437   001114 710000 6                  TRA     s:6975
         6 000440   001114 710000 6                  TRA     s:6975
         6 000441   001114 710000 6                  TRA     s:6975
         6 000442   001114 710000 6                  TRA     s:6975
         6 000443   001114 710000 6                  TRA     s:6975
         6 000444   001114 710000 6                  TRA     s:6975
         6 000445   001114 710000 6                  TRA     s:6975
         6 000446   001114 710000 6                  TRA     s:6975
         6 000447   001114 710000 6                  TRA     s:6975
         6 000450   001114 710000 6                  TRA     s:6975
         6 000451   001114 710000 6                  TRA     s:6975
         6 000452   001114 710000 6                  TRA     s:6975
         6 000453   001114 710000 6                  TRA     s:6975
         6 000454   001114 710000 6                  TRA     s:6975
         6 000455   001114 710000 6                  TRA     s:6975
         6 000456   001114 710000 6                  TRA     s:6975
         6 000457   001114 710000 6                  TRA     s:6975
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:101  
         6 000460   001114 710000 6                  TRA     s:6975
         6 000461   001114 710000 6                  TRA     s:6975
         6 000462   001114 710000 6                  TRA     s:6975
         6 000463   001114 710000 6                  TRA     s:6975
         6 000464   001114 710000 6                  TRA     s:6975
         6 000465   001114 710000 6                  TRA     s:6975
         6 000466   001114 710000 6                  TRA     s:6975
         6 000467   001114 710000 6                  TRA     s:6975
         6 000470   001114 710000 6                  TRA     s:6975
         6 000471   001114 710000 6                  TRA     s:6975
         6 000472   001114 710000 6                  TRA     s:6975
         6 000473   001114 710000 6                  TRA     s:6975
         6 000474   001114 710000 6                  TRA     s:6975
         6 000475   001114 710000 6                  TRA     s:6975
         6 000476   001053 710000 6                  TRA     s:6954

      909     6805        /**
      910     6806         **
      911     6807         ** 'SYMB' KEYINs
      912     6808         **
      913     6809         **/
      914     6810    4                   CASE (KEY_SYMBITERM#);

      915     6811    4                     DEVNAME=KEYIN$->FI$DKEYIN.NAME;

   6811  6 000477   040000 100500                    MLR     fill='040'O
         6 000500   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         6 000501   000002 000010 1                  ADSC9   DEVNAME                  cn=0,n=8

      916     6812    4                     OPMSG_DINFO.TNAME=KEYIN$->FI$DKEYIN.TERM.TNAME;

   6812  6 000502   040000 100500                    MLR     fill='040'O
         6 000503   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         6 000504   000267 200010 1                  ADSC9   OPMSG_DINFO+39           cn=1,n=8

      917     6813    4                     OPMSG_DINFO.SUBC=1;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:102  
   6813  6 000505   001000 236003                    LDQ     512,DU
         6 000506   000267 552040 1                  STBQ    OPMSG_DINFO+39,'40'O

      918     6814    4                     GOTO SYMBI;

   6814  6 000507   000512 710000 6                  TRA     SYMBI

      919     6815    4                   CASE (KEY_SYMBI#);

      920     6816
      921     6817    4                     OPMSG_DINFO.SUBC=0;

   6817  6 000510   000000 236003                    LDQ     0,DU
         6 000511   000267 552040 1                  STBQ    OPMSG_DINFO+39,'40'O

   6817  6 000512                       SYMBI        null
      922     6818    4   SYMBI:            ;
      923     6819    4                     OPMSG_DINFO.CADDR=KEYIN$->FI$DKEYIN.CADDR;

   6819  6 000512   100000 720100                    LXL0    0,,PR1
         6 000513   000220 740000 1                  STX0    OPMSG_DINFO

      924     6820
      925     6821    4                     NDEV=0;

   6821  6 000514   200012 450100                    STZ     NDEV,,AUTO

      926     6822
      927     6823    4                     DEV$=FI_DEVHD$;

   6823  6 000515   000000 236000 xsym               LDQ     FI_DEVHD$
         6 000516   200010 756100                    STQ     DEV$,,AUTO

      928     6824    5                       DO WHILE (DEV$ ~= ADDR(NIL));

   6824  6 000517   000630 710000 6                  TRA     s:6847

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:103  
      929     6825
      930     6826    5                       IF DEV$->FI$DEV.TNAME = KEYIN$->FI$DKEYIN.TERM.TNAME

   6826  6 000520   200010 470500                    LDP0    DEV$,,AUTO
         6 000521   200011 471500                    LDP1    KEYIN$,,AUTO
         6 000522   040100 106500                    CMPC    fill='040'O
         6 000523   000067 000010                    ADSC9   55,,PR0                  cn=0,n=8
         6 000524   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         6 000525   000535 600000 6                  TZE     s:6829
         6 000526   100004 237100                    LDAQ    4,,PR1
         6 000527   000020 117000 7                  CMPAQ   16
         6 000530   000625 601000 6                  TNZ     s:6846
         6 000531   040000 106500                    CMPC    fill='040'O
         6 000532   000067 000010                    ADSC9   55,,PR0                  cn=0,n=8
         6 000533   000676 000005 2                  ADSC9   SLUGNAME+8               cn=0,n=5
         6 000534   000625 601000 6                  TNZ     s:6846

      931     6827    5                       OR ( KEYIN$->FI$DKEYIN.TERM.TNAME = ' '
      932     6828    5                       AND DEV$->FI$DEV.TNAME = 'LOCAL') THEN
      933     6829    5                        IF DEVNAMER.TYP = ' '

   6829  6 000535   000002 220000 1                  LDX0    DEVNAME
         6 000536   040040 100003                    CMPX0   16416,DU
         6 000537   000546 600000 6                  TZE     s:6834
         6 000540   000001 100100                    CMPX0   1,,PR0
         6 000541   000625 601000 6                  TNZ     s:6846
         6 000542   000002 236000 1                  LDQ     DEVNAME
         6 000543   000001 676100                    ERQ     1,,PR0
         6 000544   777777 376007                    ANQ     -1,DL
         6 000545   000625 601000 6                  TNZ     s:6846

      934     6830    5                        OR (DEVNAMER.TYP = DEV$->FI$DEV.NAMER.TYP
      935     6831    5                        AND DEVNAMER.NUM = DEV$->FI$DEV.NAMER.NUM) THEN
      936     6832    6                          DO;

      937     6833                                /* FOUND IT OR ONE OF 'EM */
      938     6834    6                          NDEV=NDEV+1;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:104  

   6834  6 000546   200012 235100                    LDA     NDEV,,AUTO
         6 000547   000001 035007                    ADLA    1,DL
         6 000550   200012 755100                    STA     NDEV,,AUTO

      939     6835    6                          OPMSG_DINFO.DEVNM=DEV$->FI$DEV.NAME;

   6835  6 000551   040000 100500                    MLR     fill='040'O
         6 000552   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         6 000553   000223 000010 1                  ADSC9   OPMSG_DINFO+3            cn=0,n=8

      940     6836    6                          OPMSG_DINFO.STATE=DEV$->FI$DEV.STATE;

   6836  6 000554   000003 236100                    LDQ     3,,PR0
         6 000555   000011 736000                    QLS     9
         6 000556   000227 552010 1                  STBQ    OPMSG_DINFO+7,'10'O

      941     6837    6                          OPMSG_DINFO.FIRST=BITBIN(DEV$->FI$DEV.FLG.FIRSTRD);

   6837  6 000557   000004 236100                    LDQ     4,,PR0
         6 000560   000001 376007                    ANQ     1,DL
         6 000561   000227 552004 1                  STBQ    OPMSG_DINFO+7,'04'O

      942     6838    6                          OPMSG_DINFO.FLUSH=BITBIN(DEV$->FI$DEV.FLG.FLUSHING);

   6838  6 000562   000004 236100                    LDQ     4,,PR0
         6 000563   000002 772000                    QRL     2
         6 000564   000001 376007                    ANQ     1,DL
         6 000565   000033 736000                    QLS     27
         6 000566   000230 552040 1                  STBQ    OPMSG_DINFO+8,'40'O

      943     6839    6                          OPMSG_DINFO.NCTL=BITBIN(DEV$->FI$DEV.FLG.NCTLDECK);

   6839  6 000567   000004 236100                    LDQ     4,,PR0
         6 000570   000001 772000                    QRL     1
         6 000571   000001 376007                    ANQ     1,DL
         6 000572   000022 736000                    QLS     18
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:105  
         6 000573   000230 552020 1                  STBQ    OPMSG_DINFO+8,'20'O

      944     6840    6                          OPMSG_DINFO.CTL=BITBIN(DEV$->FI$DEV.CTLDEV);

   6840  6 000574   000004 236100                    LDQ     4,,PR0
         6 000575   000021 772000                    QRL     17
         6 000576   000001 376007                    ANQ     1,DL
         6 000577   000011 736000                    QLS     9
         6 000600   000230 552010 1                  STBQ    OPMSG_DINFO+8,'10'O

      945     6841    6                          OPMSG_DINFO.DEST=DEV$->FI$DEV.DEST;

   6841  6 000601   040000 100500                    MLR     fill='040'O
         6 000602   000071 000074                    ADSC9   57,,PR0                  cn=0,n=60
         6 000603   000230 600074 1                  ADSC9   OPMSG_DINFO+8            cn=3,n=60

      946     6842    6                          OPMSG_DINFO.PFID=BITBIN(DEV$->FI$DEV.NCTLOK|(~DEV$->FI$DEV.
              6842                                   CTLDEV));

   6842  6 000604   000004 236100                    LDQ     4,,PR0
         6 000605   000022 736000                    QLS     18
         6 000606   400000 376003                    ANQ     -131072,DU
         6 000607   400000 676003                    ERQ     -131072,DU
         6 000610   200044 756100                    STQ     CGAURD$+12,,AUTO
         6 000611   000004 236100                    LDQ     4,,PR0
         6 000612   000023 736000                    QLS     19
         6 000613   400000 376003                    ANQ     -131072,DU
         6 000614   200044 276100                    ORQ     CGAURD$+12,,AUTO
         6 000615   000043 772000                    QRL     35
         6 000616   000247 552004 1                  STBQ    OPMSG_DINFO+23,'04'O

      947     6843    6                          OPMSG_DINFO.NFID=DEV$->FI$DEV.DFID;

   6843  6 000617   040000 100500                    MLR     fill='040'O
         6 000620   000012 000074                    ADSC9   10,,PR0                  cn=0,n=60
         6 000621   000250 000074 1                  ADSC9   OPMSG_DINFO+24           cn=0,n=60

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:106  
      948     6844    6                          CALL M$WRITE (OCMSG_DINFO);

   6844  6 000622   000460 630400 2                  EPPR0   OCMSG_DINFO
         6 000623   040001 713400                    CLIMB   write
         6 000624   401400 401760                    pmme    nvectors=4

      949     6845    6                          END;

      950     6846    5                       DEV$=DEV$->FI$DEV.LNK$;

   6846  6 000625   200010 470500                    LDP0    DEV$,,AUTO
         6 000626   000000 236100                    LDQ     0,,PR0
         6 000627   200010 756100                    STQ     DEV$,,AUTO

      951     6847    5                       END;

   6847  6 000630   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 000631   000520 601000 6                  TNZ     s:6826

      952     6848
      953     6849
      954     6850                                /* MESSAGE IF NONE FOUND */
      955     6851    4                     IF NDEV = 0 THEN

   6851  6 000632   200012 235100                    LDA     NDEV,,AUTO
         6 000633   001331 601000 6                  TNZ     ENDEVENT

      956     6852    5                       DO;

      957     6853    5                       IF KEYIN$->FI$DKEYIN.KIN# = KEY_SYMBI# THEN

   6853  6 000634   200011 470500                    LDP0    KEYIN$,,AUTO
         6 000635   000000 220100                    LDX0    0,,PR0
         6 000636   000001 100003                    CMPX0   1,DU
         6 000637   000643 601000 6                  TNZ     s:6857

      958     6854    5                        OPMSG_KERR.SUBC1=0;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:107  

   6854  6 000640   000000 236003                    LDQ     0,DU
         6 000641   000300 552004 1                  STBQ    OPMSG_KERR+6,'04'O
         6 000642   000650 710000 6                  TRA     s:6860

      959     6855    5                       ELSE
      960     6856    6                         DO;

      961     6857    6                         OPMSG_KERR.SUBC1=1;

   6857  6 000643   000001 236007                    LDQ     1,DL
         6 000644   000300 552004 1                  STBQ    OPMSG_KERR+6,'04'O

      962     6858    6                         OPMSG_KERR.TNAME=KEYIN$->FI$DKEYIN.TERM.TNAME;

   6858  6 000645   000004 237100                    LDAQ    4,,PR0
         6 000646   000301 755000 1                  STA     OPMSG_KERR+7
         6 000647   000302 756000 1                  STQ     OPMSG_KERR+8

      963     6859    6                         END;

      964     6860    5                       IF DEVNAMER.TYP = ' ' THEN

   6860  6 000650   000002 220000 1                  LDX0    DEVNAME
         6 000651   040040 100003                    CMPX0   16416,DU
         6 000652   000656 601000 6                  TNZ     KERR1

      965     6861    6                         DO;

      966     6862    6                         OPMSG_KERR.SUBC=FIKE_NSDEV#;

   6862  6 000653   000000 236003                    LDQ     0,DU
         6 000654   000300 552040 1                  STBQ    OPMSG_KERR+6,'40'O

      967     6863    6                         GOTO KERR;

   6863  6 000655   000660 710000 6                  TRA     KERR
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:108  

   6860  6 000656                       KERR1        null
      968     6864    6                         END;
      969     6865    5   KERR1:              ;
      970     6866    5                       OPMSG_KERR.SUBC=FIKE_NOTMY#;

   6866  6 000656   001000 236003                    LDQ     512,DU
         6 000657   000300 552040 1                  STBQ    OPMSG_KERR+6,'40'O

   6866  6 000660                       KERR         null
      971     6867    5   KERR:               ;
      972     6868    5                       OPMSG_KERR.DEVNM=DEVNAME;

   6868  6 000660   000002 237000 1                  LDAQ    DEVNAME
         6 000661   000275 755000 1                  STA     OPMSG_KERR+3
         6 000662   000276 756000 1                  STQ     OPMSG_KERR+4

      973     6869    5                       OPMSG_KERR.ERRC=B$ERRCODE;

   6869  6 000663   000000 470400 xsym               LDP0    B$TCB$
         6 000664   000000 471500                    LDP1    0,,PR0
         6 000665   100102 236100                    LDQ     66,,PR1
         6 000666   377770 376007                    ANQ     131064,DL
         6 000667   000006 736000                    QLS     6
         6 000670   000300 552030 1                  STBQ    OPMSG_KERR+6,'30'O

      974     6870    5                       CALL M$WRITE (OCMSG_KERR);

   6870  6 000671   000474 630400 2                  EPPR0   OCMSG_KERR
         6 000672   040001 713400                    CLIMB   write
         6 000673   401400 401760                    pmme    nvectors=4

      975     6871    5                       END;

   6871  6 000674   001331 710000 6                  TRA     ENDEVENT

      976     6872        /**
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:109  
      977     6873         **
      978     6874         ** 'NCTL' KEYIN
      979     6875         **
      980     6876         **/
      981     6877    4                   CASE (KEY_NCTL#);

      982     6878
      983     6879    4                     CALL FIND_DEV ALTRET(KERR1);

   6879  6 000675   002751 701000 6                  TSX1    FIND_DEV
         6 000676   000656 702000 6                  TSX2    KERR1

      984     6880    4                     IF DEV$->FI$DEV.CTLDEV AND NOT DEV$->FI$DEV.NCTLOK THEN

   6880  6 000677   200010 470500                    LDP0    DEV$,,AUTO
         6 000700   000004 236100                    LDQ     4,,PR0
         6 000701   400000 316007                    CANQ    -131072,DL
         6 000702   000710 600000 6                  TZE     s:6885
         6 000703   200000 316007                    CANQ    65536,DL
         6 000704   000710 601000 6                  TNZ     s:6885

      985     6881    5                       DO;

      986     6882    5                       OPMSG_KERR.SUBC=FIKE_INCTL#;

   6882  6 000705   006000 236003                    LDQ     3072,DU
         6 000706   000300 552040 1                  STBQ    OPMSG_KERR+6,'40'O

      987     6883    5                       GOTO KERR;

   6883  6 000707   000660 710000 6                  TRA     KERR

      988     6884    5                       END;
      989     6885    4                     I=KEYIN$->FI$DKEYIN.FID.L;

   6885  6 000710   200011 471500                    LDP1    KEYIN$,,AUTO
         6 000711   100004 236100                    LDQ     4,,PR1
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:110  
         6 000712   000033 772000                    QRL     27
         6 000713   200013 756100                    STQ     I,,AUTO

      990     6886    4                     IF I > %FIMI_NFMX# THEN

   6886  6 000714   000127 116007                    CMPQ    87,DL
         6 000715   000721 602000 6                  TNC     s:6891

      991     6887    5                       DO;

      992     6888    5                       OPMSG_KERR.SUBC=FIKE_TLFID#;

   6888  6 000716   010000 236003                    LDQ     4096,DU
         6 000717   000300 552040 1                  STBQ    OPMSG_KERR+6,'40'O

      993     6889    5                       GOTO KERR;

   6889  6 000720   000660 710000 6                  TRA     KERR

      994     6890    5                       END;
      995     6891    4                     FIDIT.TEXTFID_=VECTOR(ADDR(KEYIN$->FI$DKEYIN.FID.C)->B$CHARS);

   6891  6 000721   200013 235100                    LDA     I,,AUTO
         6 000722   000020 735000                    ALS     16
         6 000723   000140 135007                    SBLA    96,DL
         6 000724   200011 236100                    LDQ     KEYIN$,,AUTO
         6 000725   000022 036000 7                  ADLQ    18
         6 000726   000656 757000 1                  STAQ    FIDIT+2

      996     6892    4                     FIDWSN=' ';

   6892  6 000727   000035 235000 xsym               LDA     B_VECTNIL+29
         6 000730   000035 236000 xsym               LDQ     B_VECTNIL+29
         6 000731   000004 757000 1                  STAQ    FIDWSN

      997     6893    4                     CALL DOFID ALTRET(KFIDALT);

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:111  
   6893  6 000732   003207 701000 6                  TSX1    DOFID
         6 000733   001023 702000 6                  TSX2    KFIDALT

      998     6894    4                     IF NOT (OPENIT.V.ASN# = %FILE#

   6894  6 000734   000617 236000 1                  LDQ     OPENIT+37
         6 000735   000777 376007                    ANQ     511,DL
         6 000736   000001 116007                    CMPQ    1,DL
         6 000737   000750 600000 6                  TZE     s:6900
         6 000740   000003 116007                    CMPQ    3,DL
         6 000741   000745 601000 6                  TNZ     s:6897
         6 000742   000704 236000 1                  LDQ     VLR_FIDIT
         6 000743   020000 316003                    CANQ    8192,DU
         6 000744   000750 601000 6                  TNZ     s:6900

      999     6895    4                     OR (OPENIT.V.ASN# = %DEVICE# AND VLR_FIDIT.WSN)) THEN
     1000     6896    5                       DO;

     1001     6897    5                       OPMSG_KERR.SUBC=FIKE_FDASN#;

   6897  6 000745   002000 236003                    LDQ     1024,DU
         6 000746   000300 552040 1                  STBQ    OPMSG_KERR+6,'40'O

     1002     6898    5                       GOTO KERR;

   6898  6 000747   000660 710000 6                  TRA     KERR

     1003     6899    5                       END;
     1004     6900    4                     IF OPENIT.V.ASN# = %FILE# THEN

   6900  6 000750   000617 236000 1                  LDQ     OPENIT+37
         6 000751   000777 376007                    ANQ     511,DL
         6 000752   000001 116007                    CMPQ    1,DL
         6 000753   000756 601000 6                  TNZ     s:6902

     1005     6901    4                      CALL CHK_NAME ALTRET(KNAMALT);

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:112  
   6901  6 000754   003117 701000 6                  TSX1    CHK_NAME
         6 000755   001026 702000 6                  TSX2    KNAMALT

     1006     6902    4                     IF OPENIT.V.ASN# = %DEVICE# THEN

   6902  6 000756   000617 236000 1                  LDQ     OPENIT+37
         6 000757   000777 376007                    ANQ     511,DL
         6 000760   000003 116007                    CMPQ    3,DL
         6 000761   000764 601000 6                  TNZ     s:6904

     1007     6903    4                      CALL CHK_FORM ALTRET(KFORMALT);

   6903  6 000762   003140 701000 6                  TSX1    CHK_FORM
         6 000763   001031 702000 6                  TSX2    KFORMALT

     1008     6904    4                     DEV$->FI$DEV.CFID=ADDR(KEYIN$->FI$DKEYIN.FID.C)->B$CHARS;

   6904  6 000764   200011 470500                    LDP0    KEYIN$,,AUTO
         6 000765   200013 720100                    LXL0    I,,AUTO
         6 000766   200010 471500                    LDP1    DEV$,,AUTO
         6 000767   040100 100540                    MLR     fill='040'O
         6 000770   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
         6 000771   100037 400126                    ADSC9   31,,PR1                  cn=2,n=86

     1009     6905    4                     IF KEYIN$->FI$DKEYIN.ONCE = 0 THEN

   6905  6 000772   000003 235100                    LDA     3,,PR0
         6 000773   001002 601000 6                  TNZ     s:6910

     1010     6906    5                       DO;

     1011     6907    5                       DEV$->FI$DEV.DFID=DEV$->FI$DEV.CFID;

   6907  6 000774   040100 100500                    MLR     fill='040'O
         6 000775   100037 400126                    ADSC9   31,,PR1                  cn=2,n=86
         6 000776   100012 000126                    ADSC9   10,,PR1                  cn=0,n=86

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:113  
     1012     6908    5                       OPMSG_RESP.SUBC1=0;

   6908  6 000777   000000 236003                    LDQ     0,DU
         6 001000   000436 552030 1                  STBQ    OPMSG_RESP+6,'30'O

     1013     6909    5                       END;

   6909  6 001001   001004 710000 6                  TRA     s:6911

     1014     6910    4                     ELSE OPMSG_RESP.SUBC1=1;

   6910  6 001002   001000 236007                    LDQ     512,DL
         6 001003   000436 552030 1                  STBQ    OPMSG_RESP+6,'30'O

     1015     6911    4                     OPMSG_RESP.SUBC=FIKR_NCTL#;

   6911  6 001004   000000 101400                    MRL     fill='000'O
         6 001005   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         6 001006   000435 600002 1                  ADSC9   OPMSG_RESP+5             cn=3,n=2

     1016     6912    4                     OPMSG_RESP.CADDR=M_UR;

   6912  6 001007   100000 221003                    LDX1    32768,DU
         6 001010   000430 741000 1                  STX1    OPMSG_RESP

     1017     6913    4                     OPMSG_RESP.DEVNM=DEVNAME;

   6913  6 001011   000002 237000 1                  LDAQ    DEVNAME
         6 001012   000433 755000 1                  STA     OPMSG_RESP+3
         6 001013   000434 756000 1                  STQ     OPMSG_RESP+4

     1018     6914    4                     OPMSG_RESP.FID=DEV$->FI$DEV.CFID;

   6914  6 001014   040000 100500                    MLR     fill='040'O
         6 001015   100037 400126                    ADSC9   31,,PR1                  cn=2,n=86
         6 001016   000436 600126 1                  ADSC9   OPMSG_RESP+6             cn=3,n=86

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:114  
     1019     6915    4                     CALL M$WRITE (OCMSG_RESP);

   6915  6 001017   000554 630400 2                  EPPR0   OCMSG_RESP
         6 001020   040001 713400                    CLIMB   write
         6 001021   401400 401760                    pmme    nvectors=4

     1020     6916    4                     GOTO ENDEVENT;

   6916  6 001022   001331 710000 6                  TRA     ENDEVENT

   6914  6 001023                       KFIDALT      null
     1021     6917
     1022     6918    4   KFIDALT:          ;
     1023     6919    4                     OPMSG_KERR.SUBC=FIKE_FDALT#;

   6919  6 001023   003000 236003                    LDQ     1536,DU
         6 001024   000300 552040 1                  STBQ    OPMSG_KERR+6,'40'O

     1024     6920    4                     GOTO KERR;

   6920  6 001025   000660 710000 6                  TRA     KERR

   6919  6 001026                       KNAMALT      null
     1025     6921    4   KNAMALT:          ;
     1026     6922    4                     OPMSG_KERR.SUBC=FIKE_FDNAM#;

   6922  6 001026   004000 236003                    LDQ     2048,DU
         6 001027   000300 552040 1                  STBQ    OPMSG_KERR+6,'40'O

     1027     6923    4                     GOTO KERR;

   6923  6 001030   000660 710000 6                  TRA     KERR

   6922  6 001031                       KFORMALT     null
     1028     6924    4   KFORMALT:         ;
     1029     6925    4                     OPMSG_KERR.SUBC=FIKE_BFORM#;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:115  
   6925  6 001031   007000 236003                    LDQ     3584,DU
         6 001032   000300 552040 1                  STBQ    OPMSG_KERR+6,'40'O

     1030     6926    4                     GOTO KERR;

   6926  6 001033   000660 710000 6                  TRA     KERR

     1031     6927
     1032     6928
     1033     6929
     1034     6930
     1035     6931
     1036     6932        /**
     1037     6933         **
     1038     6934         ** FLUSH KEYIN
     1039     6935         **
     1040     6936         **/
     1041     6937    4                   CASE (KEY_FLUSH#);

     1042     6938
     1043     6939    4                     CALL FIND_DEV ALTRET(KERR1);

   6939  6 001034   002751 701000 6                  TSX1    FIND_DEV
         6 001035   000656 702000 6                  TSX2    KERR1

     1044     6940    4                     IF DEV$->FI$DEV.STATE ~= FIS_BUSY# THEN

   6940  6 001036   200010 470500                    LDP0    DEV$,,AUTO
         6 001037   000003 720100                    LXL0    3,,PR0
         6 001040   000001 100003                    CMPX0   1,DU
         6 001041   001045 600000 6                  TZE     s:6945

     1045     6941    5                       DO;

     1046     6942    5                       OPMSG_KERR.SUBC=FIKE_NBUSY#;

   6942  6 001042   011000 236003                    LDQ     4608,DU
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:116  
         6 001043   000300 552040 1                  STBQ    OPMSG_KERR+6,'40'O

     1047     6943    5                       GOTO KERR;

   6943  6 001044   000660 710000 6                  TRA     KERR

     1048     6944    5                       END;
     1049     6945    4                     OPMSG_JBFL.SUBC=FIJF_FLUSH#;

   6945  6 001045   000000 101400                    MRL     fill='000'O
         6 001046   000023 000004 7                  ADSC9   19                       cn=0,n=4
         6 001047   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1050     6946    4                     CALL FLUSHIT;

   6946  6 001050   002372 701000 6                  TSX1    FLUSHIT
         6 001051   000000 011000                    NOP     0
         6 001052   001331 710000 6                  TRA     ENDEVENT

     1051     6947        /**
     1052     6948         **
     1053     6949         ** ZAP KEYIN
     1054     6950         **
     1055     6951         **/
     1056     6952    4                   CASE (KEY_ZAP#);

     1057     6953
     1058     6954    4                     CALL FIA$ZAP;

   6954  6 001053   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 001054   000000 701000 xent               TSX1    FIA$ZAP
         6 001055   000000 011000                    NOP     0

     1059     6955    4                     DEV$=FI_DEVHD$;

   6955  6 001056   000000 236000 xsym               LDQ     FI_DEVHD$
         6 001057   200010 756100                    STQ     DEV$,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:117  

     1060     6956    5                       DO WHILE (DEV$ ~= ADDR(NIL));

   6956  6 001060   001104 710000 6                  TRA     s:6966

     1061     6957    5                       IF DEV$->FI$DEV.STATE = FIS_BUSY# THEN

   6957  6 001061   200010 470500                    LDP0    DEV$,,AUTO
         6 001062   000003 720100                    LXL0    3,,PR0
         6 001063   000001 100003                    CMPX0   1,DU
         6 001064   001101 601000 6                  TNZ     ZA0

     1062     6958    6                         DO;

     1063     6959    6                         DEVNAME=DEV$->FI$DEV.NAME;

   6959  6 001065   040000 100500                    MLR     fill='040'O
         6 001066   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         6 001067   000002 000010 1                  ADSC9   DEVNAME                  cn=0,n=8

     1064     6960    6                         OPMSG_JBFL.SUBC=FIJF_ZAP#;

   6960  6 001070   000000 101400                    MRL     fill='000'O
         6 001071   000015 000004 xsym               ADSC9   B_VECTNIL+13             cn=0,n=4
         6 001072   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1065     6961    6                         CALL FLUSHIT;

   6961  6 001073   002372 701000 6                  TSX1    FLUSHIT
         6 001074   000000 011000                    NOP     0

     1066     6962    6                         CALL M$DEACTIVATE (DISCT_DEV) ALTRET(ZA0);

   6962  6 001075   000364 630400 2                  EPPR0   DISCT_DEV
         6 001076   500001 713400                    CLIMB   alt,+32769
         6 001077   401400 401760                    pmme    nvectors=4
         6 001100   001101 702000 6                  TSX2    ZA0
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:118  

   6960  6 001101                       ZA0          null
     1067     6963    6   ZA0:                  ;
     1068     6964    6                         END;

     1069     6965    5                       DEV$=DEV$->FI$DEV.LNK$;

   6965  6 001101   200010 470500                    LDP0    DEV$,,AUTO
         6 001102   000000 236100                    LDQ     0,,PR0
         6 001103   200010 756100                    STQ     DEV$,,AUTO

     1070     6966    5                       END;

   6966  6 001104   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 001105   001061 601000 6                  TNZ     s:6957

     1071     6967    4                     CALL M$WRITE (WRITE_ZAPRESP);

   6967  6 001106   000444 630400 2                  EPPR0   WRITE_ZAPRESP
         6 001107   040001 713400                    CLIMB   write
         6 001110   401400 401760                    pmme    nvectors=4

     1072     6968    4                     GOODNGT=-1;

   6968  6 001111   000001 335007                    LCA     1,DL
         6 001112   000001 755000 1                  STA     GOODNGT
         6 001113   001331 710000 6                  TRA     ENDEVENT

     1073     6969        /**
     1074     6970         **
     1075     6971         ** UNKNOWN KEYIN.  GIVE ERROR MSG
     1076     6972         **
     1077     6973         **/
     1078     6974    4                   CASE (ELSE);

     1079     6975    4                     OPMSG_UNIMP.CADDR=KEYIN$->FI$DKEYIN.CADDR;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:119  
   6975  6 001114   100000 723100                    LXL3    0,,PR1
         6 001115   000465 743000 1                  STX3    OPMSG_UNIMP

     1080     6976    4                     CALL M$WRITE (OCMSG_UNIMP);

   6976  6 001116   000570 630400 2                  EPPR0   OCMSG_UNIMP
         6 001117   040001 713400                    CLIMB   write
         6 001120   401400 401760                    pmme    nvectors=4

     1081     6977        /***
     1082     6978         ***
     1083     6979         ***     END OF KEYIN TYPE DOCASE
     1084     6980         ***
     1085     6981         ***/
     1086     6982    4                 END;

   6982  6 001121   001331 710000 6                  TRA     ENDEVENT

     1087     6983        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:120  
     1088     6984        /***
     1089     6985         ***
     1090     6986         ***
     1091     6987         ***          ISCG READ COMPLETE
     1092     6988         ***
     1093     6989         ***
     1094     6990         ***/
     1095     6991
     1096     6992    3             CASE (FIEV_ISRD#);

     1097     6993
     1098     6994                                /* INSYM READS ITS DEVICES BY ANONYMOUS READS
     1099     6995                                   TO THE ISCG, NOWAIT.  WHEN A READ COMPLETES
     1100     6996                                   INTO FI_ISCGBUF, WE GET PASSED AN EVENT BY
     1101     6997                                   FIE$EVNT, TELLING THE DEVICE NAME AND ERR
     1102     6998                                   CODE AND ARS.  THE ROUTINE ISRD PROCESSES
     1103     6999                                   THE EVENT, AND THEN WE ISSUE ANOTHER READ
     1104     7000                                   INTO THE BUFFER, AND EXIT. */
     1105     7001    3               DEVNAME=CITE$->FI$ISRD.NAME;

   7001  6 001122   200027 471500                    LDP1    CITE$,,AUTO
         6 001123   040000 100500                    MLR     fill='040'O
         6 001124   100004 000010                    ADSC9   4,,PR1                   cn=0,n=8
         6 001125   000002 000010 1                  ADSC9   DEVNAME                  cn=0,n=8

     1106     7002    3               CALL FIND_DEV ALTRET(ENDEVENT);

   7002  6 001126   002751 701000 6                  TSX1    FIND_DEV
         6 001127   001331 702000 6                  TSX2    ENDEVENT

     1107     7003    3               CALL ISRD ALTRET(TAKEDCB);

   7003  6 001130   001420 701000 6                  TSX1    ISRD
         6 001131   001133 702000 6                  TSX2    TAKEDCB

     1108     7004    3               GOTO ENDEVENT;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:121  
   7004  6 001132   001331 710000 6                  TRA     ENDEVENT

   7001  6 001133                       TAKEDCB      null
     1109     7005    3   TAKEDCB:    ;
     1110     7006    3               DCBNUMBER.DCB#=DEV$->FI$DEV.DCB#;

   7006  6 001133   200010 470500                    LDP0    DEV$,,AUTO
         6 001134   000004 236100                    LDQ     4,,PR0
         6 001135   000022 772000                    QRL     18
         6 001136   000010 756000 1                  STQ     DCBNUMBER

     1111     7007    3               DEV$->FI$DEV.DCB#=0;

   7007  6 001137   000000 220003                    LDX0    0,DU
         6 001140   000004 740100                    STX0    4,,PR0

   7007  6 001141                       TAKEDCB1     null
     1112     7008    3   TAKEDCB1:   ;
     1113     7009    3               CALL GIVEDCB;

   7009  6 001141   001371 701000 6                  TSX1    GIVEDCB
         6 001142   000000 011000                    NOP     0
         6 001143   001331 710000 6                  TRA     ENDEVENT

     1114     7010        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:122  
     1115     7011        /***
     1116     7012         ***
     1117     7013         ***
     1118     7014         ***          SET DISMOUNT COMMAND FROM PIG
     1119     7015         ***
     1120     7016         ***
     1121     7017         ***/
     1122     7018    3             CASE (FIEV_DSMT#);

     1123     7019
     1124     7020    3               DEV$=FI_DEVHD$;

   7020  6 001144   000000 236000 xsym               LDQ     FI_DEVHD$
         6 001145   200010 756100                    STQ     DEV$,,AUTO

     1125     7021    4                 DO WHILE (DEV$ ~= ADDR(NIL));

   7021  6 001146   001210 710000 6                  TRA     s:7035

     1126     7022    4                 IF DEV$->FI$DEV.STATE = FIS_BUSY# THEN

   7022  6 001147   200010 470500                    LDP0    DEV$,,AUTO
         6 001150   000003 720100                    LXL0    3,,PR0
         6 001151   000001 100003                    CMPX0   1,DU
         6 001152   001205 601000 6                  TNZ     s:7034

     1127     7023    4                  IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD THEN

   7023  6 001153   000007 471400 7                  LDP1    7
         6 001154   100000 473500                    LDP3    0,,PR1
         6 001155   000004 221100                    LDX1    4,,PR0
         6 001156   300000 474511                    LDP4    0,X1,PR3
         6 001157   400031 236100                    LDQ     25,,PR4
         6 001160   020000 316007                    CANQ    8192,DL
         6 001161   001205 600000 6                  TZE     s:7034

     1128     7024    4                  IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.SETX = CITE$->FI$DSMT.SETX THEN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:123  

   7024  6 001162   400051 722100                    LXL2    41,,PR4
         6 001163   200027 475500                    LDP5    CITE$,,AUTO
         6 001164   500002 102100                    CMPX2   2,,PR5
         6 001165   001205 601000 6                  TNZ     s:7034

     1129     7025    5                     DO;

     1130     7026                                /* Blow off this file (it must be a NCTL file). */
     1131     7027    5                     DEVNAME=DEV$->FI$DEV.NAME;

   7027  6 001166   040000 100500                    MLR     fill='040'O
         6 001167   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         6 001170   000002 000010 1                  ADSC9   DEVNAME                  cn=0,n=8

     1132     7028    5                     OPMSG_JBFL.SUBC=FIJF_DSMT#;

   7028  6 001171   000000 101400                    MRL     fill='000'O
         6 001172   000024 000004 7                  ADSC9   20                       cn=0,n=4
         6 001173   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1133     7029    5                     CALL FLUSHIT;

   7029  6 001174   002372 701000 6                  TSX1    FLUSHIT
         6 001175   000000 011000                    NOP     0

     1134     7030    5                     CALL M$DEACTIVATE (STOP_DEV) ALTRET(DSMT0);

   7030  6 001176   000424 630400 2                  EPPR0   STOP_DEV
         6 001177   500001 713400                    CLIMB   alt,+32769
         6 001200   401400 401760                    pmme    nvectors=4
         6 001201   001202 702000 6                  TSX2    DSMT0

   7028  6 001202                       DSMT0        null
     1135     7031    5   DSMT0:            ;
     1136     7032    5                     DEV$->FI$DEV.STATE=FIS_DSMT#;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:124  
   7032  6 001202   000003 220003                    LDX0    3,DU
         6 001203   200010 470500                    LDP0    DEV$,,AUTO
         6 001204   000003 440100                    SXL0    3,,PR0

     1137     7033    5                     END;

     1138     7034    4                 DEV$=DEV$->FI$DEV.LNK$;

   7034  6 001205   200010 470500                    LDP0    DEV$,,AUTO
         6 001206   000000 236100                    LDQ     0,,PR0
         6 001207   200010 756100                    STQ     DEV$,,AUTO

     1139     7035    4                 END;

   7035  6 001210   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 001211   001147 601000 6                  TNZ     s:7022

     1140     7036    3               VLP_RPSN.NN#=1;

   7036  6 001212   000001 235007                    LDA     1,DL
         6 001213   001042 755000 1                  STA     VLP_RPSN

     1141     7037    3               VLP_RPSN.RPLIST.PSN#(0)=CITE$->FI$DSMT.PSN;

   7037  6 001214   200027 470500                    LDP0    CITE$,,AUTO
         6 001215   040000 100500                    MLR     fill='040'O
         6 001216   000000 400006                    ADSC9   0,,PR0                   cn=2,n=6
         6 001217   001044 000006 1                  ADSC9   VLP_RPSN+2               cn=0,n=6

     1142     7038    3               CALL M$RELRES (REL_PSN) ALTRET(DSMT1);

   7038  6 001220   000604 630400 2                  EPPR0   REL_PSN
         6 001221   550003 713400                    CLIMB   alt,+53251
         6 001222   402400 401760                    pmme    nvectors=6
         6 001223   001224 702000 6                  TSX2    DSMT1

   7037  6 001224                       DSMT1        null
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:125  
     1143     7039    3   DSMT1:      ;
     1144     7040        /**/
     1145     7041    3               DEV$=FI_DEVHD$;

   7041  6 001224   000000 236000 xsym               LDQ     FI_DEVHD$
         6 001225   200010 756100                    STQ     DEV$,,AUTO

     1146     7042    4                 DO WHILE (DEV$ ~= ADDR(NIL));

   7042  6 001226   001254 710000 6                  TRA     s:7053

     1147     7043    4                 IF DEV$->FI$DEV.STATE = FIS_DSMT# THEN

   7043  6 001227   200010 470500                    LDP0    DEV$,,AUTO
         6 001230   000003 720100                    LXL0    3,,PR0
         6 001231   000003 100003                    CMPX0   3,DU
         6 001232   001252 601000 6                  TNZ     s:7052

     1148     7044    5                   DO;

     1149     7045    5                   DEV$->FI$DEV.STATE=FIS_IDLE#;

   7045  6 001233   000000 221003                    LDX1    0,DU
         6 001234   000003 441100                    SXL1    3,,PR0

     1150     7046    5                   DCBNUMBER.DCB#=DEV$->FI$DEV.DCB#;

   7046  6 001235   200010 470500                    LDP0    DEV$,,AUTO
         6 001236   000004 236100                    LDQ     4,,PR0
         6 001237   000022 772000                    QRL     18
         6 001240   000010 756000 1                  STQ     DCBNUMBER

     1151     7047    5                   DEV$->FI$DEV.DCB#=0;

   7047  6 001241   000004 741100                    STX1    4,,PR0

     1152     7048    5                   SAVDEV$=DEV$->FI$DEV.LNK$;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:126  

   7048  6 001242   200010 470500                    LDP0    DEV$,,AUTO
         6 001243   000000 236100                    LDQ     0,,PR0
         6 001244   200026 756100                    STQ     SAVDEV$,,AUTO

     1153     7049    5                   CALL GIVEDCB;

   7049  6 001245   001371 701000 6                  TSX1    GIVEDCB
         6 001246   000000 011000                    NOP     0

     1154     7050    5                   DEV$=SAVDEV$;

   7050  6 001247   200026 236100                    LDQ     SAVDEV$,,AUTO
         6 001250   200010 756100                    STQ     DEV$,,AUTO

     1155     7051    5                   END;

   7051  6 001251   001254 710000 6                  TRA     s:7053

     1156     7052    4                 ELSE DEV$=DEV$->FI$DEV.LNK$;

   7052  6 001252   000000 236100                    LDQ     0,,PR0
         6 001253   200010 756100                    STQ     DEV$,,AUTO

     1157     7053    4                 END;

   7053  6 001254   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 001255   001227 601000 6                  TNZ     s:7043
         6 001256   001331 710000 6                  TRA     ENDEVENT

     1158     7054        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:127  
     1159     7055        /***
     1160     7056         ***
     1161     7057         ***
     1162     7058         ***          OPEN FOR BUSINESS
     1163     7059         ***
     1164     7060         ***
     1165     7061         ***/
     1166     7062    3             CASE (FIEV_OPFB#);

     1167     7063    3               B$JIT$->B$JIT.USERWORD(0)=B$JIT$->B$JIT.USERWORD(0)+1;

   7063  6 001257   000000 471400 xsym               LDP1    B$JIT$
         6 001260   100133 222100                    LDX2    91,,PR1
         6 001261   000001 623012                    EAX3    1,X2
         6 001262   100133 743100                    STX3    91,,PR1

     1168     7064    3               IF B$JIT$->B$JIT.USERWORD(0) ~= 0 THEN

   7064  6 001263   001331 600000 6                  TZE     ENDEVENT

     1169     7065    4                 DO;

     1170     7066    4   STARTUP:      ;

   7066  6 001264                       STARTUP      null
     1171     7067    4                 DEV$=FI_DEVHD$;

   7067  6 001264   000000 236000 xsym               LDQ     FI_DEVHD$
         6 001265   200010 756100                    STQ     DEV$,,AUTO

     1172     7068    5                   DO WHILE (DEV$ ~= ADDR(NIL));

   7068  6 001266   001306 710000 6                  TRA     s:7076

     1173     7069    5                   IF DEV$->FI$DEV.FLG.READY THEN

   7069  6 001267   200010 470500                    LDP0    DEV$,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:128  
         6 001270   000004 236100                    LDQ     4,,PR0
         6 001271   000010 316007                    CANQ    8,DL
         6 001272   001303 600000 6                  TZE     s:7075

     1174     7070    6                     DO;

     1175     7071    6                     DEV$->FI$DEV.FLG.READY='0'B;

   7071  6 001273   000025 236000 7                  LDQ     21
         6 001274   000004 356100                    ANSQ    4,,PR0

     1176     7072    6                     DEVNAME = DEV$->FI$DEV.NAME;

   7072  6 001275   200010 470500                    LDP0    DEV$,,AUTO
         6 001276   040000 100500                    MLR     fill='040'O
         6 001277   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         6 001300   000002 000010 1                  ADSC9   DEVNAME                  cn=0,n=8

     1177     7073    6                     CALL STARTIT;

   7073  6 001301   001333 701000 6                  TSX1    STARTIT
         6 001302   000000 011000                    NOP     0

     1178     7074    6                     END;

     1179     7075    5                   DEV$=DEV$->FI$DEV.LNK$;

   7075  6 001303   200010 470500                    LDP0    DEV$,,AUTO
         6 001304   000000 236100                    LDQ     0,,PR0
         6 001305   200010 756100                    STQ     DEV$,,AUTO

     1180     7076    5                   END;

   7076  6 001306   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 001307   001267 601000 6                  TNZ     s:7069

     1181     7077    4                 END;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:129  

   7077  6 001310   001331 710000 6                  TRA     ENDEVENT

     1182     7078        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:130  
     1183     7079
     1184     7080        /***
     1185     7081         ***
     1186     7082         ***
     1187     7083         ***          APLCG READ COMPLETE
     1188     7084         ***
     1189     7085         ***
     1190     7086         ***/
     1191     7087
     1192     7088    3             CASE (FIEV_APLRD#);

     1193     7089
     1194     7090    3               IF GOODNGT = 0 THEN

   7090  6 001311   000001 235000 1                  LDA     GOODNGT
         6 001312   001331 601000 6                  TNZ     ENDEVENT

     1195     7091    3                CALL FIA$APLRD;

   7091  6 001313   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 001314   000000 701000 xent               TSX1    FIA$APLRD
         6 001315   000000 011000                    NOP     0
         6 001316   001331 710000 6                  TRA     ENDEVENT

     1196     7092        /***
     1197     7093         ***
     1198     7094         ***
     1199     7095         ***          APLCG ADMIN USER EVENT
     1200     7096         ***
     1201     7097         ***
     1202     7098         ***/
     1203     7099    3             CASE (FIEV_APLAU#);

     1204     7100
     1205     7101    3               IF GOODNGT = 0 THEN

   7101  6 001317   000001 235000 1                  LDA     GOODNGT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:131  
         6 001320   001331 601000 6                  TNZ     ENDEVENT

     1206     7102    3                CALL FIA$APLAU;

   7102  6 001321   000002 631400 xsym               EPPR1   B_VECTNIL+2
         6 001322   000000 701000 xent               TSX1    FIA$APLAU
         6 001323   000000 011000                    NOP     0
         6 001324   001331 710000 6                  TRA     ENDEVENT

     1207     7103        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:132  
     1208     7104        /***
     1209     7105         ***
     1210     7106         ***
     1211     7107         ***          NOP EVENT
     1212     7108         ***
     1213     7109         ***
     1214     7110         ***/
     1215     7111
     1216     7112    3             CASE (FIEV_NOP#);

     1217     7113
     1218     7114        /***
     1219     7115         ***
     1220     7116         ***
     1221     7117         ***          'ELSE' CASE: UNKNOWN EXTERNAL EVENT CODE FROM FIE$EVNT
     1222     7118         ***
     1223     7119         ***
     1224     7120         ***/
     1225     7121
     1226     7122    3             CASE (ELSE);

     1227     7123    3               CALL FOI$LDTRC (%S$FIUEXTEV,F_FI,M_I,INSYMNAME.MYSTATION#);

   7123  6 001325   000027 630400 7                  EPPR0   23
         6 001326   000022 631400 xsym               EPPR1   B_VECTNIL+18
         6 001327   000000 701000 xent               TSX1    FOI$LDTRC
         6 001330   000000 011000                    NOP     0

     1228     7124        /*S* SCREECH_CODE: FII-S$FIUEXTEV
     1229     7125             TYPE:         SNAP
     1230     7126             MESSAGE:      INSYM  - unknown external event code from FIE$EVNT
     1231     7127             REMARKS:      The event queue used to communicate from FIE$EVNT
     1232     7128                           to the INSYM  main routine contains an event code
     1233     7129                           unknown to INSYM.   This can only occur if one
     1234     7130                           of INSYM,  FIE$EVNT, and the event queue has been
     1235     7131                           clobbered.  A SNAP is taken, then INSYM LDTRCs
     1236     7132                           to itself. */
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:133  
     1237     7133        /****
     1238     7134         ****
     1239     7135         ****
     1240     7136         ****         END OF MAIN EVENT CASE STMT
     1241     7137         ****
     1242     7138         ****
     1243     7139         ****/
     1244     7140    3           END;

     1245     7141    2   ENDEVENT:
     1246     7142    2         RETURN;

   7142  6 001331   200032 221300       ENDEVENT     LDX1  ! CGAURD$+2,,AUTO
         6 001332   000001 702211                    TSX2  ! 1,X1

     1247     7143
     1248     7144        /**/
     1249     7145    2   STARTIT: PROC;

   7145  6 001333   200036 741300       STARTIT      STX1  ! CGAURD$+6,,AUTO

     1250     7146    3         CALL M$GETDCB (GET_DCB) ALTRET(NODCB);

   7146  6 001334   000536 630400 1                  EPPR0   GET_DCB
         6 001335   460002 713400                    CLIMB   alt,+24578
         6 001336   401000 401760                    pmme    nvectors=3
         6 001337   001364 702000 6                  TSX2    NODCB
         6 001340   001342 710000 6                  TRA     s:7148

     1251     7147    3   GOTDCB: ENTRY;

   7147  6 001341   200036 741300       GOTDCB       STX1  ! CGAURD$+6,,AUTO

     1252     7148    3         DEV$->FI$DEV.DCB#=DCBNUMBER.DCB#;

   7148  6 001342   000010 720000 1                  LXL0    DCBNUMBER
         6 001343   200010 470500                    LDP0    DEV$,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:134  
         6 001344   000004 740100                    STX0    4,,PR0

     1253     7149    3         DEV$->FI$DEV.STATE=FIS_BUSY#;

   7149  6 001345   000001 220003                    LDX0    1,DU
         6 001346   200010 470500                    LDP0    DEV$,,AUTO
         6 001347   000003 440100                    SXL0    3,,PR0

     1254     7150    3         DEV$->FI$DEV.FLG='0'B;

   7150  6 001350   200010 470500                    LDP0    DEV$,,AUTO
         6 001351   000034 236000 xsym               LDQ     B_VECTNIL+28
         6 001352   000004 356100                    ANSQ    4,,PR0

     1255     7151    3         DEV$->FI$DEV.FLG.FIRSTRD='1'B;

   7151  6 001353   200010 470500                    LDP0    DEV$,,AUTO
         6 001354   000001 236007                    LDQ     1,DL
         6 001355   000004 256100                    ORSQ    4,,PR0

     1256     7152    3         CALL M$ACTIVATE (START_DEV) ALTRET(RTN);

   7152  6 001356   000404 630400 2                  EPPR0   START_DEV
         6 001357   500000 713400                    CLIMB   alt,+32768
         6 001360   401400 401760                    pmme    nvectors=4
         6 001361   001362 702000 6                  TSX2    RTN

   7151  6 001362                       RTN          null
     1257     7153    3   RTN:  ;
     1258     7154    3         RETURN;

   7154  6 001362   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 001363   000001 702211                    TSX2  ! 1,X1

   7151  6 001364                       NODCB        null
     1259     7155        /**/
     1260     7156    3   NODCB: ;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:135  
     1261     7157    3         DEV$->FI$DEV.STATE=FIS_DCBW#;

   7157  6 001364   000002 220003                    LDX0    2,DU
         6 001365   200010 470500                    LDP0    DEV$,,AUTO
         6 001366   000003 440100                    SXL0    3,,PR0

     1262     7158    3         RETURN;

   7158  6 001367   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 001370   000001 702211                    TSX2  ! 1,X1

     1263     7159    3   END STARTIT;
     1264     7160        /**/
     1265     7161    2   GIVEDCB: PROC;

   7161  6 001371   200034 741300       GIVEDCB      STX1  ! CGAURD$+4,,AUTO

     1266     7162    3         DEV$=FI_DEVHD$;

   7162  6 001372   000000 236000 xsym               LDQ     FI_DEVHD$
         6 001373   200010 756100                    STQ     DEV$,,AUTO

     1267     7163    4           DO WHILE (DEV$ ~= ADDR(NIL));

   7163  6 001374   001407 710000 6                  TRA     s:7170

     1268     7164    4           IF DEV$->FI$DEV.STATE = FIS_DCBW# THEN

   7164  6 001375   200010 470500                    LDP0    DEV$,,AUTO
         6 001376   000003 720100                    LXL0    3,,PR0
         6 001377   000002 100003                    CMPX0   2,DU
         6 001400   001405 601000 6                  TNZ     s:7169

     1269     7165    5             DO;

     1270     7166    5             CALL GOTDCB;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:136  
   7166  6 001401   001341 701000 6                  TSX1    GOTDCB
         6 001402   000000 011000                    NOP     0

     1271     7167    5             RETURN;

   7167  6 001403   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 001404   000001 702211                    TSX2  ! 1,X1

     1272     7168    5             END;
     1273     7169    4           DEV$=DEV$->FI$DEV.LNK$;

   7169  6 001405   000000 236100                    LDQ     0,,PR0
         6 001406   200010 756100                    STQ     DEV$,,AUTO

     1274     7170    4           END;

   7170  6 001407   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 001410   001375 601000 6                  TNZ     s:7164

     1275     7171    3         REL_DCB.V.DCB#=DCBNUMBER.DCB#;

   7171  6 001411   000010 720000 1                  LXL0    DCBNUMBER
         6 001412   000550 740000 1                  STX0    REL_DCB+2

     1276     7172    3         CALL M$RELDCB (REL_DCB);

   7172  6 001413   000546 630400 1                  EPPR0   REL_DCB
         6 001414   060003 713400                    CLIMB   24579
         6 001415   400000 401760                    pmme    nvectors=1

     1277     7173    3         RETURN;

   7173  6 001416   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 001417   000001 702211                    TSX2  ! 1,X1

     1278     7174    3   END GIVEDCB;
     1279     7175    2   END EXT_EVENT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:137  
     1280     7176        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:138  
     1281     7177        /***************************************************************
     1282     7178         ***************************************************************
     1283     7179
     1284     7180                               ISRD
     1285     7181
     1286     7182         ***************************************************************
     1287     7183         ***************************************************************/
     1288     7184        /*D* NAME:         ISRD
     1289     7185             PURPOSE:      To process a completed read to the ISCG
     1290     7186             DESCRIPTION:  This routine does most of the actual work
     1291     7187                           of INSYM, namely, processing the data read
     1292     7188                           from the devices, and acting upon it.
     1293     7189
     1294     7190                           Basically, one of 3 actions is taken here:
     1295     7191
     1296     7192                           1) For the first read to a device, decide where
     1297     7193                           the data is going to go based possibly on the
     1298     7194                           first card read (e.g. !JOB), and open the dcb
     1299     7195                           for the device to that destination.
     1300     7196
     1301     7197                           2) In the middle of a deck, simply write the
     1302     7198                           data record to the already-open dcb
     1303     7199
     1304     7200                           3) Based on an EOF condition, or new !JOB,
     1305     7201                           close off the currently-open dcb and maybe
     1306     7202                           start a new one.
     1307     7203
     1308     7204                           The parameters to this routine are DEV$ pointing
     1309     7205                           to the device which emitted the data, and EVNT$
     1310     7206                           pointing to the event frame for the read.
     1311     7207
     1312     7208                           If the ALTRET is taken, the device's DCB is
     1313     7209                           to be given away to another device in state
     1314     7210                           dcbwait, if any, or released. */
     1315     7211    1   ISRD: PROC ALTRET;

   7211  6 001420   200034 741300       ISRD         STX1  ! CGAURD$+4,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:139  

     1316     7212
     1317     7213    2         IF DEV$->FI$DEV.STATE ~= FIS_BUSY# THEN RETURN;

   7213  6 001421   200010 470500                    LDP0    DEV$,,AUTO
         6 001422   000003 720100                    LXL0    3,,PR0
         6 001423   000001 100003                    CMPX0   1,DU
         6 001424   001426 600000 6                  TZE     s:7215

   7213  6 001425   000001 702211                    TSX2  ! 1,X1

     1318     7214
     1319     7215    2         ARS=CITE$->FI$ISRD.ARS;

   7215  6 001426   200027 471500                    LDP1    CITE$,,AUTO
         6 001427   100001 235100                    LDA     1,,PR1
         6 001430   200016 755100                    STA     ARS,,AUTO

     1320     7216    2         BUF$=CITE$->FI$ISRD.BUF$;

   7216  6 001431   100006 236100                    LDQ     6,,PR1
         6 001432   200017 756100                    STQ     BUF$,,AUTO

     1321     7217    2         WRITOUT=1;

   7217  6 001433   000001 235007                    LDA     1,DL
         6 001434   200015 755100                    STA     WRITOUT,,AUTO

     1322     7218
     1323     7219
     1324     7220                           /* PROCESS READ WITH NO ERROR */
     1325     7221    2         IF CITE$->FI$ISRD.ERRCODE = 0 THEN

   7221  6 001435   100003 722100                    LXL2    3,,PR1
         6 001436   002275 601000 6                  TNZ     s:7409

     1326     7222    3           DO;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:140  

     1327     7223    3           IF DEV$->FI$DEV.FLG.FIRSTRD THEN

   7223  6 001437   000004 236100                    LDQ     4,,PR0
         6 001440   000001 316007                    CANQ    1,DL
         6 001441   002177 600000 6                  TZE     s:7374

     1328     7224    4             DO;

     1329     7225                                /* TRYING TO GET FIRST CARD */
     1330     7226    4             IF DEV$->FI$DEV.FLG.FLUSHING

   7226  6 001442   000004 316007                    CANQ    4,DL
         6 001443   001447 600000 6                  TZE     s:7228
         6 001444   000002 316007                    CANQ    2,DL
         6 001445   001447 600000 6                  TZE     s:7228

     1331     7227    4             AND DEV$->FI$DEV.FLG.NCTLDECK THEN RETURN;

   7227  6 001446   000001 702211                    TSX2  ! 1,X1

     1332     7228    4             BANGDISP=0;

   7228  6 001447   200025 450100                    STZ     BANGDISP,,AUTO

     1333     7229    4             IF DEV$->FI$DEV.CTLDEV THEN

   7229  6 001450   400000 316007                    CANQ    -131072,DL
         6 001451   001561 600000 6                  TZE     s:7264

     1334     7230    5               DO;

     1335     7231                                /* CONTROL DEVICE - !JOB OR !NCTL MUST B THERE */
     1336     7232    5               IF ARS >= 4

   7232  6 001452   200016 235100                    LDA     ARS,,AUTO
         6 001453   000004 115007                    CMPA    4,DL
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:141  
         6 001454   001516 602000 6                  TNC     s:7246
         6 001455   000005 236007                    LDQ     5,DL
         6 001456   200016 116100                    CMPQ    ARS,,AUTO
         6 001457   001462 602000 6                  TNC     s:7232+8
         6 001460   001462 600000 6                  TZE     s:7232+8
         6 001461   200016 236100                    LDQ     ARS,,AUTO
         6 001462   200017 473500                    LDP3    BUF$,,AUTO
         6 001463   000000 623006                    EAX3    0,QL
         6 001464   040000 106540                    CMPC    fill='040'O
         6 001465   300000 000013                    ADSC9   0,,PR3                   cn=0,n=*X3
         6 001466   000700 000005 2                  ADSC9   SLUGNAME+10              cn=0,n=5
         6 001467   001516 601000 6                  TNZ     s:7246

     1337     7233    5               AND SUBSTR(BUF$->B$CHAR5,0,MINIMUM(ARS,5)) = '!JOB ' THEN
     1338     7234    6                 DO;

     1339     7235    6   NEWJOB:
     1340     7236    6                 DEV$->FI$DEV.FLG.NCTLDECK='0'B;

   7236  6 001470   200010 470500       NEWJOB       LDP0    DEV$,,AUTO
         6 001471   000033 236000 7                  LDQ     27
         6 001472   000004 356100                    ANSQ    4,,PR0

     1341     7237    6                 DEV$->FI$DEV.FLG.FLUSHING='0'B;

   7237  6 001473   200010 470500                    LDP0    DEV$,,AUTO
         6 001474   000034 236000 7                  LDQ     28
         6 001475   000004 356100                    ANSQ    4,,PR0

     1342     7238    6                 OPENIT.V.ASN#=%DEVICE#;

   7238  6 001476   000003 236007                    LDQ     3,DL
         6 001477   000617 552004 1                  STBQ    OPENIT+37,'04'O

     1343     7239    6                 OPENIT.V.RES#='JE';

   7239  6 001500   000702 236000 2                  LDQ     SLUGNAME+12
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:142  
         6 001501   777777 376003                    ANQ     -1,DU
         6 001502   040040 276007                    ORQ     16416,DL
         6 001503   000622 756000 1                  STQ     OPENIT+40

     1344     7240    6                 OPENIT.WSN_=VECTOR(NIL);

   7240  6 001504   000036 237000 7                  LDAQ    30
         6 001505   000604 757000 1                  STAQ    OPENIT+26

     1345     7241    6                 OPENIT.NAME_=VECTOR(NIL);

   7241  6 001506   000036 237000 7                  LDAQ    30
         6 001507   000560 757000 1                  STAQ    OPENIT+6

     1346     7242    6                 OPENIT.ACCT_=VECTOR(NIL);

   7242  6 001510   000036 237000 7                  LDAQ    30
         6 001511   000576 757000 1                  STAQ    OPENIT+20

     1347     7243    6                 DEV$->FI$DEV.DESTCODE=FIDC_JOB#;

   7243  6 001512   200010 470500                    LDP0    DEV$,,AUTO
         6 001513   000000 236003                    LDQ     0,DU
         6 001514   000005 552104                    STBQ    5,'04'O,PR0

     1348     7244    6                 GOTO OPEN;

   7244  6 001515   002045 710000 6                  TRA     OPEN

     1349     7245    6                 END;
     1350     7246    5               IF ARS >= 5

   7246  6 001516   000005 115007                    CMPA    5,DL
         6 001517   001551 602000 6                  TNC     s:7257
         6 001520   000006 236007                    LDQ     6,DL
         6 001521   200016 116100                    CMPQ    ARS,,AUTO
         6 001522   001525 602000 6                  TNC     s:7246+7
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:143  
         6 001523   001525 600000 6                  TZE     s:7246+7
         6 001524   200016 236100                    LDQ     ARS,,AUTO
         6 001525   200017 473500                    LDP3    BUF$,,AUTO
         6 001526   000000 623006                    EAX3    0,QL
         6 001527   040000 106540                    CMPC    fill='040'O
         6 001530   300000 000013                    ADSC9   0,,PR3                   cn=0,n=*X3
         6 001531   000703 000006 2                  ADSC9   SLUGNAME+13              cn=0,n=6
         6 001532   001551 601000 6                  TNZ     s:7257

     1351     7247    5               AND SUBSTR(BUF$->B$CHAR6,0,MINIMUM(ARS,6)) = '!NCTL ' THEN
     1352     7248    6                 DO;

     1353     7249    6   CTLNCTL:
     1354     7250    6                 DEV$->FI$DEV.FLG.NCTLDECK='1'B;

   7250  6 001533   200010 470500       CTLNCTL      LDP0    DEV$,,AUTO
         6 001534   000002 236007                    LDQ     2,DL
         6 001535   000004 256100                    ORSQ    4,,PR0

     1355     7251    6                 DEV$->FI$DEV.FLG.FLUSHING='0'B;

   7251  6 001536   200010 470500                    LDP0    DEV$,,AUTO
         6 001537   000034 236000 7                  LDQ     28
         6 001540   000004 356100                    ANSQ    4,,PR0

     1356     7252    6                 IF DEV$->FI$DEV.NCTLOK THEN GOTO NCTL;

   7252  6 001541   200010 470500                    LDP0    DEV$,,AUTO
         6 001542   000004 236100                    LDQ     4,,PR0
         6 001543   200000 316007                    CANQ    65536,DL
         6 001544   001566 601000 6                  TNZ     NCTL

     1357     7253    6                 OPMSG_JBFL.SUBC=FIJF_INCTL#;

   7253  6 001545   000000 101400                    MRL     fill='000'O
         6 001546   000013 000004 xsym               ADSC9   B_VECTNIL+11             cn=0,n=4
         6 001547   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:144  

     1358     7254    6                 GOTO FLUSH;

   7254  6 001550   002173 710000 6                  TRA     FLUSH

     1359     7255    6                 END;
     1360     7256                                /* CONTROL CARD NOT FOUND - FLUSH */
     1361     7257    5               IF DEV$->FI$DEV.FLG.FLUSHING THEN RETURN;

   7257  6 001551   000004 236100                    LDQ     4,,PR0
         6 001552   000004 316007                    CANQ    4,DL
         6 001553   001555 600000 6                  TZE     s:7258

   7257  6 001554   000001 702211                    TSX2  ! 1,X1

     1362     7258    5               OPMSG_JBFL.SUBC=FIJF_NOCTL#;

   7258  6 001555   000000 101400                    MRL     fill='000'O
         6 001556   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         6 001557   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1363     7259    5               GOTO FLUSH;

   7259  6 001560   002173 710000 6                  TRA     FLUSH

     1364     7260    5               END;
     1365     7261    4             ELSE
     1366     7262    5               DO;

     1367     7263                                /* NON CONTROL DEVICE - 1ST CARD MAY BE !NCTL */
     1368     7264    5               IF (CITE$->FI$ISRD.DVBYTE&%DVBYTE_VFC#) THEN BANGDISP=1;

   7264  6 001561   100003 236100                    LDQ     3,,PR1
         6 001562   777000 376003                    ANQ     -512,DU
         6 001563   100000 376003                    ANQ     32768,DU
         6 001564   001566 600000 6                  TZE     NCTL

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:145  
   7264  6 001565   200025 755100                    STA     BANGDISP,,AUTO

     1369     7265    5   NCTL:
     1370     7266    5               DEV$->FI$DEV.FLG.NCTLDECK='1'B;

   7266  6 001566   000002 236007       NCTL         LDQ     2,DL
         6 001567   000004 256100                    ORSQ    4,,PR0

     1371     7267    5               FIDIT.TEXTFID_=VECTOR(DEV$->FI$DEV.CFID);

   7267  6 001570   000035 235000 7                  LDA     29
         6 001571   200010 236100                    LDQ     DEV$,,AUTO
         6 001572   000040 036000 7                  ADLQ    32
         6 001573   000656 757000 1                  STAQ    FIDIT+2

     1372     7268    5               IF ARS >= 6+BANGDISP

   7268  6 001574   200025 236100                    LDQ     BANGDISP,,AUTO
         6 001575   000006 036007                    ADLQ    6,DL
         6 001576   200016 116100                    CMPQ    ARS,,AUTO
         6 001577   001601 600000 6                  TZE     s:7268+5
         6 001600   001643 603000 6                  TRC     s:7279
         6 001601   000006 236007                    LDQ     6,DL
         6 001602   200016 116100                    CMPQ    ARS,,AUTO
         6 001603   001606 602000 6                  TNC     s:7268+10
         6 001604   001606 600000 6                  TZE     s:7268+10
         6 001605   200016 236100                    LDQ     ARS,,AUTO
         6 001606   200017 470500                    LDP0    BUF$,,AUTO
         6 001607   000000 620006                    EAX0    0,QL
         6 001610   200025 236100                    LDQ     BANGDISP,,AUTO
         6 001611   040000 106546                    CMPC    fill='040'O
         6 001612   000000 000010                    ADSC9   0,Q,PR0                  cn=0,n=*X0
         6 001613   000703 000006 2                  ADSC9   SLUGNAME+13              cn=0,n=6
         6 001614   001643 601000 6                  TNZ     s:7279

     1373     7269    5               AND SUBSTR(PINCRC(BUF$,BANGDISP)->B$CHAR6,0,MINIMUM(ARS,6)) = '!NCTL '
              7269                        THEN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:146  
     1374     7270    6                 DO;

     1375     7271    6                 WRITOUT=0;

   7271  6 001615   200015 450100                    STZ     WRITOUT,,AUTO

     1376     7272    6                 IF ARS >= 7+BANGDISP THEN

   7272  6 001616   000007 036007                    ADLQ    7,DL
         6 001617   200016 116100                    CMPQ    ARS,,AUTO
         6 001620   001622 600000 6                  TZE     s:7274
         6 001621   001643 603000 6                  TRC     s:7279

     1377     7273    7                   DO;

     1378     7274    7                   I=ARS-6-BANGDISP;

   7274  6 001622   200016 236100                    LDQ     ARS,,AUTO
         6 001623   200025 136100                    SBLQ    BANGDISP,,AUTO
         6 001624   000006 136007                    SBLQ    6,DL
         6 001625   200013 756100                    STQ     I,,AUTO

     1379     7275    7                   IF PINCRC(BUF$,6+BANGDISP)->B$CHARS ~= ' ' THEN

   7275  6 001626   000000 620006                    EAX0    0,QL
         6 001627   200025 236100                    LDQ     BANGDISP,,AUTO
         6 001630   040000 106546                    CMPC    fill='040'O
         6 001631   000001 400010                    ADSC9   1,Q,PR0                  cn=2,n=*X0
         6 001632   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         6 001633   001643 600000 6                  TZE     s:7279

     1380     7276    7                    FIDIT.TEXTFID_=VECTOR(PINCRC(BUF$,6+BANGDISP)->B$CHARS);

   7276  6 001634   200013 235100                    LDA     I,,AUTO
         6 001635   000020 735000                    ALS     16
         6 001636   000140 135007                    SBLA    96,DL
         6 001637   000020 736000                    QLS     16
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:147  
         6 001640   000041 036000 7                  ADLQ    33
         6 001641   200017 036100                    ADLQ    BUF$,,AUTO
         6 001642   000656 757000 1                  STAQ    FIDIT+2

     1381     7277    7                   END;

     1382     7278    6                 END;

     1383     7279    5               FIDWSN=' ';

   7279  6 001643   000035 235000 xsym               LDA     B_VECTNIL+29
         6 001644   000035 236000 xsym               LDQ     B_VECTNIL+29
         6 001645   000004 757000 1                  STAQ    FIDWSN

     1384     7280    5               CALL DOFID ALTRET(FIDALT);

   7280  6 001646   003207 701000 6                  TSX1    DOFID
         6 001647   002142 702000 6                  TSX2    FIDALT

     1385     7281    5               OPENIT.UATTR_ = VECTOR(NIL);

   7281  6 001650   000036 237000 7                  LDAQ    30
         6 001651   000570 757000 1                  STAQ    OPENIT+14

     1386     7282    5               IF OPENIT.V.ASN# = %FILE# THEN

   7282  6 001652   000617 236000 1                  LDQ     OPENIT+37
         6 001653   000777 376007                    ANQ     511,DL
         6 001654   000001 116007                    CMPQ    1,DL
         6 001655   001764 601000 6                  TNZ     s:7307

     1387     7283    6                 DO;

     1388     7284    6                 CALL CHK_NAME ALTRET(NAMALT);

   7284  6 001656   003117 701000 6                  TSX1    CHK_NAME
         6 001657   002160 702000 6                  TSX2    NAMALT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:148  

     1389     7285    6                 IF FIDNAME.L# >= 1 AND FIDNAME.L# <= 21

   7285  6 001660   000644 236000 1                  LDQ     FIDNAME
         6 001661   777000 316003                    CANQ    -512,DU
         6 001662   001715 600000 6                  TZE     s:7293
         6 001663   000644 236000 1                  LDQ     FIDNAME
         6 001664   777000 376003                    ANQ     -512,DU
         6 001665   026000 116003                    CMPQ    11264,DU
         6 001666   001715 603000 6                  TRC     s:7293
         6 001667   000644 236000 1                  LDQ     FIDNAME
         6 001670   000033 772000                    QRL     27
         6 001671   040000 106406                    CMPC    fill='040'O
         6 001672   000644 000001 1                  ADSC9   FIDNAME,Q                cn=0,n=1
         6 001673   000042 000001 7                  ADSC9   34                       cn=0,n=1
         6 001674   001715 601000 6                  TNZ     s:7293

     1390     7286    6                 AND SUBSTR(FIDNAME.NAME#, FIDNAME.L# - 1, 1) = '?'
     1391     7287    7                 THEN DO;

     1392     7288    7                   CALL M$TIME (GET_UTS);

   7288  6 001675   000472 630400 1                  EPPR0   GET_UTS
         6 001676   020004 713400                    CLIMB   8196
         6 001677   402000 401760                    pmme    nvectors=5

     1393     7289    7                   CALL BINCHAR (SUBSTR(FIDNAME.NAME#, FIDNAME.L# - 1, 11),

   7289  6 001700   000644 236000 1                  LDQ     FIDNAME
         6 001701   000033 772000                    QRL     27
         6 001702   000000 235000 1                  LDA     UTS_NOW
         6 001703   200044 756100                    STQ     CGAURD$+12,,AUTO
         6 001704   000044 773000                    LRL     36
         6 001705   200046 757100                    STAQ    CGAURD$+14,,AUTO
         6 001706   200044 235100                    LDA     CGAURD$+12,,AUTO
         6 001707   000005 301500                    BTD
         6 001710   200046 000010                    NDSC9   CGAURD$+14,,AUTO         cn=0,s=lsgnf,sf=0,n=8
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:149  
         6 001711   000644 030013 1                  NDSC9   FIDNAME,A                cn=0,s=nosgn,sf=0,n=11

     1394     7290    7                   UTS_NOW);
     1395     7291    7                   FIDNAME.L# = FIDNAME.L# + 10;

   7291  6 001712   000644 236000 1                  LDQ     FIDNAME
         6 001713   012000 036003                    ADLQ    5120,DU
         6 001714   000644 552040 1                  STBQ    FIDNAME,'40'O

     1396     7292    7                   END;

     1397     7293    6                 OPENIT.NAME_=VECTOR(FIDNAME);

   7293  6 001715   000044 237000 7                  LDAQ    36
         6 001716   000560 757000 1                  STAQ    OPENIT+6

     1398     7294    6                 OPENIT.ACCT_=VECTOR(FIDACCT);

   7294  6 001717   000046 237000 7                  LDAQ    38
         6 001720   000576 757000 1                  STAQ    OPENIT+20

     1399     7295    6                 OPENIT.WSN_=VECTOR(NIL);

   7295  6 001721   000036 237000 7                  LDAQ    30
         6 001722   000604 757000 1                  STAQ    OPENIT+26

     1400     7296    6                 OPENIT.PROCATTR_=VECTOR(NIL);

   7296  6 001723   000036 237000 7                  LDAQ    30
         6 001724   000574 757000 1                  STAQ    OPENIT+18

     1401     7297    6                 IF NOT VLR_FIDIT.ACCT THEN FIDACCT=DEV$->FI$DEV.ACCT;

   7297  6 001725   000704 236000 1                  LDQ     VLR_FIDIT
         6 001726   200000 316003                    CANQ    65536,DU
         6 001727   001733 601000 6                  TNZ     s:7298

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:150  
   7297  6 001730   200010 470500                    LDP0    DEV$,,AUTO
         6 001731   000006 237100                    LDAQ    6,,PR0
         6 001732   000006 757000 1                  STAQ    FIDACCT

     1402     7298    6                 DEV$->FI$DEV.DESTCODE=FIDC_FIL#;

   7298  6 001733   200010 470500                    LDP0    DEV$,,AUTO
         6 001734   000001 236007                    LDQ     1,DL
         6 001735   000005 552104                    STBQ    5,'04'O,PR0

     1403     7299    6                 FILDEST.FILE=FIDNAME.NAME#;

   7299  6 001736   040000 100400                    MLR     fill='040'O
         6 001737   000644 200037 1                  ADSC9   FIDNAME                  cn=1,n=31
         6 001740   000041 200121 1                  ADSC9   FILDEST+1                cn=1,n=81

     1404     7300    6                 PINCRC(ADDR(FILDEST.FILE),FIDNAME.L#)->B$CHAR='.';

   7300  6 001741   000644 236000 1                  LDQ     FIDNAME
         6 001742   000033 772000                    QRL     27
         6 001743   040006 100400                    MLR     fill='040'O
         6 001744   000043 000001 7                  ADSC9   35                       cn=0,n=1
         6 001745   000041 200001 1                  ADSC9   FILDEST+1,Q              cn=1,n=1

     1405     7301    6                 PINCRC(ADDR(FILDEST.FILE),FIDNAME.L#+1)->B$CHAR8=FIDACCT;

   7301  6 001746   000644 236000 1                  LDQ     FIDNAME
         6 001747   000033 772000                    QRL     27
         6 001750   040006 100400                    MLR     fill='040'O
         6 001751   000006 000010 1                  ADSC9   FIDACCT                  cn=0,n=8
         6 001752   000041 400010 1                  ADSC9   FILDEST+1,Q              cn=2,n=8

     1406     7302    6                 DEV$->FI$DEV.DEST=FILDESTR;

   7302  6 001753   200010 470500                    LDP0    DEV$,,AUTO
         6 001754   040100 100400                    MLR     fill='040'O
         6 001755   000040 000126 1                  ADSC9   FILDEST                  cn=0,n=86
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:151  
         6 001756   000071 000126                    ADSC9   57,,PR0                  cn=0,n=86

     1407     7303    6                 B$JIT$->B$JIT.ACCN=DEV$->FI$DEV.ACCT;

   7303  6 001757   000000 471400 xsym               LDP1    B$JIT$
         6 001760   000006 237100                    LDAQ    6,,PR0
         6 001761   100001 755100                    STA     1,,PR1
         6 001762   100002 756100                    STQ     2,,PR1

     1408     7304    6                 END;

   7304  6 001763   002041 710000 6                  TRA     s:7324

     1409     7305    5               ELSE
     1410     7306    6                 DO;

     1411     7307    6                 IF OPENIT.V.ASN# ~= %DEVICE#

   7307  6 001764   000003 116007                    CMPQ    3,DL
         6 001765   002164 601000 6                  TNZ     FIDALT1
         6 001766   000704 236000 1                  LDQ     VLR_FIDIT
         6 001767   020000 316003                    CANQ    8192,DU
         6 001770   002164 600000 6                  TZE     FIDALT1

     1412     7308    6                 OR NOT VLR_FIDIT.WSN THEN GOTO FIDALT1;
     1413     7309    6                 IF FIDWSN = '@' THEN FIDWSN=DEV$->FI$DEV.NCTLWSN;

   7309  6 001771   000004 237000 1                  LDAQ    FIDWSN
         6 001772   000050 117000 7                  CMPAQ   40
         6 001773   001777 601000 6                  TNZ     s:7310

   7309  6 001774   200010 470500                    LDP0    DEV$,,AUTO
         6 001775   000010 237100                    LDAQ    8,,PR0
         6 001776   000004 757000 1                  STAQ    FIDWSN

     1414     7310    6                 OPENIT.WSN_=VECTOR(FIDWSN);

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:152  
   7310  6 001777   000052 237000 7                  LDAQ    42
         6 002000   000604 757000 1                  STAQ    OPENIT+26

     1415     7311    6                 OPENIT.NAME_=VECTOR(NIL);

   7311  6 002001   000036 237000 7                  LDAQ    30
         6 002002   000560 757000 1                  STAQ    OPENIT+6

     1416     7312    6                 ADDR(TJIT)->B$JIT.SYSID=JG_INSYM#;

   7312  6 002003   000005 220003                    LDX0    5,DU
         6 002004   000126 440000 1                  SXL0    TJIT

     1417     7313    6                 ADDR(TJIT)->B$JIT.ACCN=DEV$->FI$DEV.ACCT;

   7313  6 002005   200010 470500                    LDP0    DEV$,,AUTO
         6 002006   000006 237100                    LDAQ    6,,PR0
         6 002007   000127 755000 1                  STA     TJIT+1
         6 002010   000130 756000 1                  STQ     TJIT+2

     1418     7314    6                 ADDR(TJIT)->B$JIT.UNAME=DEV$->FI$DEV.NAME;

   7314  6 002011   040000 100500                    MLR     fill='040'O
         6 002012   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         6 002013   000131 000014 1                  ADSC9   TJIT+3                   cn=0,n=12

     1419     7315    6                 ADDR(TJIT)->B$JIT.WOO=DEV$->FI$DEV.WSN;

   7315  6 002014   040000 100500                    MLR     fill='040'O
         6 002015   000065 000010                    ADSC9   53,,PR0                  cn=0,n=8
         6 002016   000136 000010 1                  ADSC9   TJIT+8                   cn=0,n=8

     1420     7316    6                 ADDR(TJIT)->B$JIT.OUTPRIO=DEV$->FI$DEV.DFPRI;

   7316  6 002017   000003 236100                    LDQ     3,,PR0
         6 002020   000011 772000                    QRL     9
         6 002021   000150 552010 1                  STBQ    TJIT+18,'10'O
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:153  

     1421     7317    6                 OPENIT.PROCATTR_=VECTOR(TJIT);

   7317  6 002022   000054 237000 7                  LDAQ    44
         6 002023   000574 757000 1                  STAQ    OPENIT+18

     1422     7318    6                 CALL CHK_FORM ALTRET(FORMALT);

   7318  6 002024   003140 701000 6                  TSX1    CHK_FORM
         6 002025   002154 702000 6                  TSX2    FORMALT

     1423     7319    6                 DEVDEST.RES=OPENIT.V.RES#;

   7319  6 002026   000622 236000 1                  LDQ     OPENIT+40
         6 002027   000011 772000                    QRL     9
         6 002030   000067 552030 1                  STBQ    DEVDEST+1,'30'O

     1424     7320    6                 DEVDEST.WSN=FIDWSN;

   7320  6 002031   000004 237000 1                  LDAQ    FIDWSN
         6 002032   000070 757000 1                  STAQ    DEVDEST+2

     1425     7321    6                 DEV$->FI$DEV.DEST=DEVDESTR;

   7321  6 002033   200010 470500                    LDP0    DEV$,,AUTO
         6 002034   040100 100400                    MLR     fill='040'O
         6 002035   000066 000126 1                  ADSC9   DEVDEST                  cn=0,n=86
         6 002036   000071 000126                    ADSC9   57,,PR0                  cn=0,n=86

     1426     7322    6                 DEV$->FI$DEV.DESTCODE=FIDC_DEV#;

   7322  6 002037   000002 236007                    LDQ     2,DL
         6 002040   000005 552104                    STBQ    5,'04'O,PR0

     1427     7323    6                 END;

     1428     7324    5               DEV$->FI$DEV.CFID=DEV$->FI$DEV.DFID;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:154  

   7324  6 002041   200010 470500                    LDP0    DEV$,,AUTO
         6 002042   040100 100500                    MLR     fill='040'O
         6 002043   000012 000126                    ADSC9   10,,PR0                  cn=0,n=86
         6 002044   000037 400126                    ADSC9   31,,PR0                  cn=2,n=86

     1429     7325    5   OPEN:
     1430     7326    5               OPNATTR.ORIGINATOR_MODE=%M_BATCH#;

   7326  6 002045   000123 236000 1     OPEN         LDQ     OPNATTR+7
         6 002046   000056 376000 7                  ANQ     46
         6 002047   000040 276003                    ORQ     32,DU
         6 002050   000123 756000 1                  STQ     OPNATTR+7

     1431     7327    5               OPNATTR.ORIGINATOR_PORT.FROM_CR.DEVICE=DEVNAME;

   7327  6 002051   000002 236000 1                  LDQ     DEVNAME
         6 002052   000115 756000 1                  STQ     OPNATTR+1

     1432     7328    5               OPNATTR.ORIGINATOR_PORT.FROM_CR.TNAME=DEV$->FI$DEV.TNAME;

   7328  6 002053   200010 470500                    LDP0    DEV$,,AUTO
         6 002054   040000 100500                    MLR     fill='040'O
         6 002055   000067 000010                    ADSC9   55,,PR0                  cn=0,n=8
         6 002056   000116 000010 1                  ADSC9   OPNATTR+2                cn=0,n=8

     1433     7329    5               OPNATTR.WOO=DEV$->FI$DEV.WSN;

   7329  6 002057   040000 100500                    MLR     fill='040'O
         6 002060   000065 000010                    ADSC9   53,,PR0                  cn=0,n=8
         6 002061   000120 000010 1                  ADSC9   OPNATTR+4                cn=0,n=8

     1434     7330    5               OPNATTR.MAXPRI=DEV$->FI$DEV.MXPRI;

   7330  6 002062   000003 236100                    LDQ     3,,PR0
         6 002063   000022 772000                    QRL     18
         6 002064   000122 552010 1                  STBQ    OPNATTR+6,'10'O
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:155  

     1435     7331    5               OPNATTR.DEFPRI=DEV$->FI$DEV.DFPRI;

   7331  6 002065   000003 236100                    LDQ     3,,PR0
         6 002066   000022 772000                    QRL     18
         6 002067   000122 552004 1                  STBQ    OPNATTR+6,'04'O

     1436     7332    5               OPENIT.V.DCB#=DEV$->FI$DEV.DCB#;

   7332  6 002070   000004 220100                    LDX0    4,,PR0
         6 002071   000616 740000 1                  STX0    OPENIT+36

     1437     7333    5               CALL M$OPEN (OPENIT) ALTRET(OPNALT);

   7333  6 002072   000552 630400 1                  EPPR0   OPENIT
         6 002073   450000 713400                    CLIMB   alt,open
         6 002074   410400 401760                    pmme    nvectors=18
         6 002075   002130 702000 6                  TSX2    OPNALT

     1438     7334    5               B$JIT$->B$JIT.ACCN=':SYS';

   7334  6 002076   000000 470400 xsym               LDP0    B$JIT$
         6 002077   040100 100400                    MLR     fill='040'O
         6 002100   000705 000004 2                  ADSC9   SLUGNAME+15              cn=0,n=4
         6 002101   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8

     1439     7335    5               OPENIT.UATTR_ = VECTOR(OPNATTR);

   7335  6 002102   000060 237000 7                  LDAQ    48
         6 002103   000570 757000 1                  STAQ    OPENIT+14

     1440     7336    5               IF DEV$->FI$DEV.DESTCODE = FIDC_JOB# THEN

   7336  6 002104   200010 471500                    LDP1    DEV$,,AUTO
         6 002105   100005 236100                    LDQ     5,,PR1
         6 002106   000777 316007                    CANQ    511,DL
         6 002107   002122 601000 6                  TNZ     s:7341
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:156  

     1441     7337    6                 DO;

     1442     7338    6                 JOBDEST.SYSID=SUBSTR(DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.NAME.C,0,6);

   7338  6 002110   000007 473400 7                  LDP3    7
         6 002111   300000 474500                    LDP4    0,,PR3
         6 002112   100004 220100                    LDX0    4,,PR1
         6 002113   400000 475510                    LDP5    0,X0,PR4
         6 002114   040000 100500                    MLR     fill='040'O
         6 002115   500010 200006                    ADSC9   8,,PR5                   cn=1,n=6
         6 002116   000013 000006 1                  ADSC9   JOBDEST+1                cn=0,n=6

     1443     7339    6                 DEV$->FI$DEV.DEST=JOBDESTR;

   7339  6 002117   040100 100400                    MLR     fill='040'O
         6 002120   000012 000126 1                  ADSC9   JOBDEST                  cn=0,n=86
         6 002121   100071 000126                    ADSC9   57,,PR1                  cn=0,n=86

     1444     7340    6                 END;

     1445     7341    5               DEV$->FI$DEV.FLG.FIRSTRD='0'B;

   7341  6 002122   000057 236000 7                  LDQ     47
         6 002123   100004 356100                    ANSQ    4,,PR1

     1446     7342    5               CALL WRITE_REC ALTRET(FLUSH);

   7342  6 002124   002435 701000 6                  TSX1    WRITE_REC
         6 002125   002173 702000 6                  TSX2    FLUSH

     1447     7343    5               RETURN;

   7343  6 002126   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 002127   000001 702211                    TSX2  ! 1,X1

     1448     7344    5   OPNALT:
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:157  
     1449     7345    5               B$JIT$->B$JIT.ACCN=':SYS';

   7345  6 002130   000000 470400 xsym  OPNALT       LDP0    B$JIT$
         6 002131   040100 100400                    MLR     fill='040'O
         6 002132   000705 000004 2                  ADSC9   SLUGNAME+15              cn=0,n=4
         6 002133   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8

     1450     7346    5               OPENIT.UATTR_ = VECTOR(OPNATTR);

   7346  6 002134   000060 237000 7                  LDAQ    48
         6 002135   000570 757000 1                  STAQ    OPENIT+14

     1451     7347    5               OPMSG_JBFL.SUBC=FIJF_OPERR#;

   7347  6 002136   000000 101400                    MRL     fill='000'O
         6 002137   000003 000004 xsym               ADSC9   B_VECTNIL+3              cn=0,n=4
         6 002140   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1452     7348    5               GOTO FIDALT0;

   7348  6 002141   002145 710000 6                  TRA     FIDALT0

     1453     7349    5   FIDALT:
     1454     7350    5               OPMSG_JBFL.SUBC=FIJF_FDERR#;

   7350  6 002142   000000 101400       FIDALT       MRL     fill='000'O
         6 002143   000010 000004 xsym               ADSC9   B_VECTNIL+8              cn=0,n=4
         6 002144   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1455     7351    5   FIDALT0:
     1456     7352    5               OPMSG_JBFL.ERRC=B$ERRCODE;

   7352  6 002145   000000 470400 xsym  FIDALT0      LDP0    B$TCB$
         6 002146   000000 471500                    LDP1    0,,PR0
         6 002147   100102 236100                    LDQ     66,,PR1
         6 002150   377770 376007                    ANQ     131064,DL
         6 002151   000006 736000                    QLS     6
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:158  
         6 002152   000346 552030 1                  STBQ    OPMSG_JBFL+6,'30'O

     1457     7353    5               GOTO FLUSH0;

   7353  6 002153   002167 710000 6                  TRA     FLUSH0

     1458     7354    5   FORMALT:
     1459     7355    5               OPMSG_JBFL.SUBC=FIJF_BFORM#;

   7355  6 002154   000000 101400       FORMALT      MRL     fill='000'O
         6 002155   000014 000004 xsym               ADSC9   B_VECTNIL+12             cn=0,n=4
         6 002156   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1460     7356    5               GOTO FLUSH0;

   7356  6 002157   002167 710000 6                  TRA     FLUSH0

     1461     7357    5   NAMALT:
     1462     7358    5               OPMSG_JBFL.SUBC=FIJF_FDNAM#;

   7358  6 002160   000000 101400       NAMALT       MRL     fill='000'O
         6 002161   000011 000004 xsym               ADSC9   B_VECTNIL+9              cn=0,n=4
         6 002162   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1463     7359    5               GOTO FLUSH0;

   7359  6 002163   002167 710000 6                  TRA     FLUSH0

     1464     7360    5   FIDALT1:
     1465     7361    5               OPMSG_JBFL.SUBC=FIJF_FDASN#;

   7361  6 002164   000000 101400       FIDALT1      MRL     fill='000'O
         6 002165   000004 000004 xsym               ADSC9   B_VECTNIL+4              cn=0,n=4
         6 002166   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1466     7362    5   FLUSH0:
     1467     7363    5               DEV$->FI$DEV.CFID=DEV$->FI$DEV.DFID;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:159  

   7363  6 002167   200010 470500       FLUSH0       LDP0    DEV$,,AUTO
         6 002170   040100 100500                    MLR     fill='040'O
         6 002171   000012 000126                    ADSC9   10,,PR0                  cn=0,n=86
         6 002172   000037 400126                    ADSC9   31,,PR0                  cn=2,n=86

     1468     7364    5   FLUSH:
     1469     7365    5               CALL FLUSHIT;

   7365  6 002173   002372 701000 6     FLUSH        TSX1    FLUSHIT
         6 002174   000000 011000                    NOP     0

     1470     7366    5               RETURN;

   7366  6 002175   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 002176   000001 702211                    TSX2  ! 1,X1

     1471     7367    5               END;
     1472     7368    4             END;
     1473     7369    3           ELSE
     1474     7370    4             DO;

     1475     7371
     1476     7372                                /* NOT FIRST READ - WRITE RECORD */
     1477     7373                                /* BUT FIRST CHECK FOR NEW JOB */
     1478     7374    4             IF NOT DEV$->FI$DEV.FLG.NCTLDECK THEN

   7374  6 002177   000002 316007                    CANQ    2,DL
         6 002200   002250 601000 6                  TNZ     s:7394

     1479     7375    5               DO;

     1480     7376    5               IF ARS >= 4

   7376  6 002201   200016 235100                    LDA     ARS,,AUTO
         6 002202   000004 115007                    CMPA    4,DL
         6 002203   002225 602000 6                  TNC     s:7383
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:160  
         6 002204   000005 236007                    LDQ     5,DL
         6 002205   200016 116100                    CMPQ    ARS,,AUTO
         6 002206   002211 602000 6                  TNC     s:7376+8
         6 002207   002211 600000 6                  TZE     s:7376+8
         6 002210   200016 236100                    LDQ     ARS,,AUTO
         6 002211   200017 473500                    LDP3    BUF$,,AUTO
         6 002212   000000 623006                    EAX3    0,QL
         6 002213   040000 106540                    CMPC    fill='040'O
         6 002214   300000 000013                    ADSC9   0,,PR3                   cn=0,n=*X3
         6 002215   000700 000005 2                  ADSC9   SLUGNAME+10              cn=0,n=5
         6 002216   002225 601000 6                  TNZ     s:7383

     1481     7377    5               AND SUBSTR(BUF$->B$CHAR5,0,MINIMUM(ARS,5)) = '!JOB ' THEN
     1482     7378    6                 DO;

     1483     7379    6                 CALL CLSSV;

   7379  6 002217   002522 701000 6                  TSX1    CLSSV
         6 002220   000000 011000                    NOP     0

     1484     7380    6                 DEV$->FI$DEV.FLG.FIRSTRD='1'B;

   7380  6 002221   200010 470500                    LDP0    DEV$,,AUTO
         6 002222   000001 236007                    LDQ     1,DL
         6 002223   000004 256100                    ORSQ    4,,PR0

     1485     7381    6                 GOTO NEWJOB;

   7381  6 002224   001470 710000 6                  TRA     NEWJOB

     1486     7382    6                 END;
     1487     7383    5               IF ARS >= 5

   7383  6 002225   000005 115007                    CMPA    5,DL
         6 002226   002250 602000 6                  TNC     s:7394
         6 002227   000006 236007                    LDQ     6,DL
         6 002230   200016 116100                    CMPQ    ARS,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:161  
         6 002231   002234 602000 6                  TNC     s:7383+7
         6 002232   002234 600000 6                  TZE     s:7383+7
         6 002233   200016 236100                    LDQ     ARS,,AUTO
         6 002234   200017 473500                    LDP3    BUF$,,AUTO
         6 002235   000000 623006                    EAX3    0,QL
         6 002236   040000 106540                    CMPC    fill='040'O
         6 002237   300000 000013                    ADSC9   0,,PR3                   cn=0,n=*X3
         6 002240   000703 000006 2                  ADSC9   SLUGNAME+13              cn=0,n=6
         6 002241   002250 601000 6                  TNZ     s:7394

     1488     7384    5               AND SUBSTR(BUF$->B$CHAR6,0,MINIMUM(ARS,6)) = '!NCTL ' THEN
     1489     7385    6                 DO;

     1490     7386    6                 CALL CLSSV;

   7386  6 002242   002522 701000 6                  TSX1    CLSSV
         6 002243   000000 011000                    NOP     0

     1491     7387    6                 DEV$->FI$DEV.FLG.FIRSTRD='1'B;

   7387  6 002244   200010 470500                    LDP0    DEV$,,AUTO
         6 002245   000001 236007                    LDQ     1,DL
         6 002246   000004 256100                    ORSQ    4,,PR0

     1492     7388    6                 GOTO CTLNCTL;

   7388  6 002247   001533 710000 6                  TRA     CTLNCTL

     1493     7389    6                 END;
     1494     7390    5               END;
     1495     7391
     1496     7392                  /*  Check for !FIN.
     1497     7393                      (Some devices don't return an %E$EOF error.)  */
     1498     7394    4             IF ARS >= 4

   7394  6 002250   200016 235100                    LDA     ARS,,AUTO
         6 002251   000004 115007                    CMPA    4,DL
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:162  
         6 002252   002266 602000 6                  TNC     s:7398
         6 002253   000005 236007                    LDQ     5,DL
         6 002254   200016 116100                    CMPQ    ARS,,AUTO
         6 002255   002260 602000 6                  TNC     s:7394+8
         6 002256   002260 600000 6                  TZE     s:7394+8
         6 002257   200016 236100                    LDQ     ARS,,AUTO
         6 002260   200017 473500                    LDP3    BUF$,,AUTO
         6 002261   000000 623006                    EAX3    0,QL
         6 002262   040000 106540                    CMPC    fill='040'O
         6 002263   300000 000013                    ADSC9   0,,PR3                   cn=0,n=*X3
         6 002264   000706 000005 2                  ADSC9   SLUGNAME+16              cn=0,n=5
         6 002265   002330 600000 6                  TZE     CLOSE_DCB

     1499     7395    4             AND SUBSTR(BUF$->B$CHAR5,0,MINIMUM(ARS,5)) = '!FIN ' THEN
     1500     7396    4              GOTO CLOSE_DCB;
     1501     7397
     1502     7398    4             IF DEV$->FI$DEV.FLG.FLUSHING = '0'B THEN

   7398  6 002266   000004 236100                    LDQ     4,,PR0
         6 002267   000004 316007                    CANQ    4,DL
         6 002270   002273 601000 6                  TNZ     s:7400

     1503     7399    4              CALL WRITE_REC ALTRET(FLUSH);

   7399  6 002271   002435 701000 6                  TSX1    WRITE_REC
         6 002272   002173 702000 6                  TSX2    FLUSH

     1504     7400    4             RETURN;

   7400  6 002273   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 002274   000001 702211                    TSX2  ! 1,X1

     1505     7401    4             END;
     1506     7402    3           END;
     1507     7403        /***
     1508     7404         ***
     1509     7405         ***          READ HAD AN ERROR
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:163  
     1510     7406         ***
     1511     7407         ***/
     1512     7408
     1513     7409    2         IF CITE$->FI$ISRD.ERRCODE = %E$EOF THEN

   7409  6 002275   000006 102003                    CMPX2   6,DU
         6 002276   002343 601000 6                  TNZ     s:7431

     1514     7410    3           DO;

     1515     7411    3           IF (CITE$->FI$ISRD.TYC & %TYC_EOD) THEN GOTO EODERR;

   7411  6 002277   100002 236100                    LDQ     2,,PR1
         6 002300   000710 376000 2                  ANQ     SLUGNAME+18
         6 002301   002345 601000 6                  TNZ     EODERR

     1516     7412                                /* ECHO LAST CARD IF NOT !FIN OR ZERO LEN */
     1517     7413    3           IF NOT ((CITE$->FI$ISRD.ARS >= 4

   7413  6 002302   100001 235100                    LDA     1,,PR1
         6 002303   000004 115007                    CMPA    4,DL
         6 002304   002320 602000 6                  TNC     s:7413+14
         6 002305   000005 236007                    LDQ     5,DL
         6 002306   200016 116100                    CMPQ    ARS,,AUTO
         6 002307   002312 602000 6                  TNC     s:7413+8
         6 002310   002312 600000 6                  TZE     s:7413+8
         6 002311   200016 236100                    LDQ     ARS,,AUTO
         6 002312   200017 473500                    LDP3    BUF$,,AUTO
         6 002313   000000 623006                    EAX3    0,QL
         6 002314   040000 106540                    CMPC    fill='040'O
         6 002315   300000 000013                    ADSC9   0,,PR3                   cn=0,n=*X3
         6 002316   000706 000005 2                  ADSC9   SLUGNAME+16              cn=0,n=5
         6 002317   002330 600000 6                  TZE     CLOSE_DCB
         6 002320   200016 236100                    LDQ     ARS,,AUTO
         6 002321   002330 600000 6                  TZE     CLOSE_DCB

     1518     7414    3           AND SUBSTR(BUF$->B$CHAR5,0,MINIMUM(ARS,5)) = '!FIN ')
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:164  
     1519     7415    3           OR (ARS=0)) THEN
     1520     7416                                /* WRITE LAST CARD */
     1521     7417    3            CALL WRITE_REC

   7417  6 002322   002435 701000 6                  TSX1    WRITE_REC
         6 002323   002325 702000 6                  TSX2    s:7420
         6 002324   002330 710000 6                  TRA     CLOSE_DCB

     1522     7418    3            WHENALTRETURN
     1523     7419    4              DO;

     1524     7420    4              CALL FLUSHIT;

   7420  6 002325   002372 701000 6                  TSX1    FLUSHIT
         6 002326   000000 011000                    NOP     0

     1525     7421    4              GOTO STOP_CR;

   7421  6 002327   002332 710000 6                  TRA     STOP_CR

     1526     7422    4              END;
     1527     7423    3   CLOSE_DCB:
     1528     7424    3           CALL CLSSV;

   7424  6 002330   002522 701000 6     CLOSE_DCB    TSX1    CLSSV
         6 002331   000000 011000                    NOP     0

     1529     7425    3   STOP_CR:
     1530     7426    3           CALL M$DEACTIVATE (STOP_DEV) ALTRET(IGNORE_RUNAWAY_CR);

   7426  6 002332   000424 630400 2     STOP_CR      EPPR0   STOP_DEV
         6 002333   500001 713400                    CLIMB   alt,+32769
         6 002334   401400 401760                    pmme    nvectors=4
         6 002335   002336 702000 6                  TSX2    IGNORE_RUNAWAY_CR

     1531     7427    3   IGNORE_RUNAWAY_CR:
     1532     7428    3           DEV$->FI$DEV.STATE=FIS_IDLE#;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:165  

   7428  6 002336   000000 220003       IGNORE_RUNA* LDX0    0,DU
         6 002337   200010 470500                    LDP0    DEV$,,AUTO
         6 002340   000003 440100                    SXL0    3,,PR0

     1533     7429    3           ALTRETURN;

   7429  6 002341   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 002342   000000 702211                    TSX2  ! 0,X1

     1534     7430    3           END;
     1535     7431    2         IF CITE$->FI$ISRD.ERRCODE = %E$EOD THEN

   7431  6 002343   000012 102003                    CMPX2   10,DU
         6 002344   002351 601000 6                  TNZ     s:7437

     1536     7432    3           DO;

     1537     7433    3   EODERR:
     1538     7434    3           CALL WRITE_EOD ALTRET(FLUSH);

   7434  6 002345   002456 701000 6     EODERR       TSX1    WRITE_EOD
         6 002346   002173 702000 6                  TSX2    FLUSH

     1539     7435    3           RETURN;

   7435  6 002347   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 002350   000001 702211                    TSX2  ! 1,X1

     1540     7436    3           END;
     1541     7437    2         IF CITE$->FI$ISRD.ERRCODE = %E$DACTR THEN

   7437  6 002351   000015 102003                    CMPX2   13,DU
         6 002352   002357 601000 6                  TNZ     s:7452

     1542     7438    2   DEACTIVATED:
     1543     7439    3           DO;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:166  

   7439  6 002353                       DEACTIVATED  null
     1544     7440    3           CALL FOI$SNAP (%S$FIDACTR,F_FI,M_I);

   7440  6 002353   000063 630400 7                  EPPR0   51
         6 002354   000021 631400 xsym               EPPR1   B_VECTNIL+17
         6 002355   000000 701000 xent               TSX1    FOI$SNAP
         6 002356   000000 011000                    NOP     0

     1545     7441        /*S* SCREECH_CODE: FII-S$FIDACTR
     1546     7442             TYPE:         SNAP
     1547     7443             MESSAGE:      INSYM DEACTIVATEd on ISCG
     1548     7444             REMARKS:      INSYM has received a "you are deactivated"
     1549     7445                           error on an ISCG read.  This should never
     1550     7446                           really happen, but if it does, this snap
     1551     7447                           is intended to keep our buddy, user 5,
     1552     7448                           from tying up the system by looping forever.
     1553     7449                           Can't think of any better way to recover.  */
     1554     7450    3           END DEACTIVATED;

     1555     7451                                /* ERROR OTHER THAN EOF,EOD */
     1556     7452    2         OPMSG_JBFL.SUBC=FIJF_DVERR#;

   7452  6 002357   000000 101400                    MRL     fill='000'O
         6 002360   000006 000004 xsym               ADSC9   B_VECTNIL+6              cn=0,n=4
         6 002361   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1557     7453    2         OPMSG_JBFL.ERRC=CITE$->FI$ISRD.ERRCODE;

   7453  6 002362   200027 470500                    LDP0    CITE$,,AUTO
         6 002363   000003 236100                    LDQ     3,,PR0
         6 002364   000011 736000                    QLS     9
         6 002365   000346 552030 1                  STBQ    OPMSG_JBFL+6,'30'O

     1558     7454    2         CALL FLUSHIT;

   7454  6 002366   002372 701000 6                  TSX1    FLUSHIT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:167  
         6 002367   000000 011000                    NOP     0

     1559     7455    2         RETURN;

   7455  6 002370   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 002371   000001 702211                    TSX2  ! 1,X1

     1560     7456    2   END ISRD;
     1561     7457
     1562     7458
     1563     7459
     1564     7460
     1565     7461
     1566     7462
     1567     7463
     1568     7464    1   FLUSHIT: PROC;

   7464  6 002372   200040 741300       FLUSHIT      STX1  ! CGAURD$+8,,AUTO

     1569     7465    2         IF DEV$->FI$DEV.FLG.FLUSHING THEN RETURN;

   7465  6 002373   200010 470500                    LDP0    DEV$,,AUTO
         6 002374   000004 236100                    LDQ     4,,PR0
         6 002375   000004 316007                    CANQ    4,DL
         6 002376   002400 600000 6                  TZE     s:7466

   7465  6 002377   000001 702211                    TSX2  ! 1,X1

     1570     7466    2         OPMSG_JBFL.DEVNM=DEVNAME;

   7466  6 002400   000002 237000 1                  LDAQ    DEVNAME
         6 002401   000343 755000 1                  STA     OPMSG_JBFL+3
         6 002402   000344 756000 1                  STQ     OPMSG_JBFL+4

     1571     7467    2         OPMSG_JBFL.DEST=DEV$->FI$DEV.DEST;

   7467  6 002403   040000 100500                    MLR     fill='040'O
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:168  
         6 002404   000071 000126                    ADSC9   57,,PR0                  cn=0,n=86
         6 002405   000346 600126 1                  ADSC9   OPMSG_JBFL+6             cn=3,n=86

     1572     7468    2         CALL M$WRITE (OCMSG_JBFL);

   7468  6 002406   000524 630400 2                  EPPR0   OCMSG_JBFL
         6 002407   040001 713400                    CLIMB   write
         6 002410   401400 401760                    pmme    nvectors=4

     1573     7469    2         DEV$->FI$DEV.FLG.FLUSHING='1'B;

   7469  6 002411   200010 470500                    LDP0    DEV$,,AUTO
         6 002412   000004 236007                    LDQ     4,DL
         6 002413   000004 256100                    ORSQ    4,,PR0

     1574     7470    2         IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD THEN

   7470  6 002414   000007 470400 7                  LDP0    7
         6 002415   000000 471500                    LDP1    0,,PR0
         6 002416   200010 473500                    LDP3    DEV$,,AUTO
         6 002417   300004 220100                    LDX0    4,,PR3
         6 002420   100000 474510                    LDP4    0,X0,PR1
         6 002421   400031 236100                    LDQ     25,,PR4
         6 002422   020000 316007                    CANQ    8192,DL
         6 002423   002433 600000 6                  TZE     A1

     1575     7471    3           DO;

     1576     7472    3           CLOSE_REL.V.DCB#=DEV$->FI$DEV.DCB#;

   7472  6 002424   000764 740000 1                  STX0    CLOSE_REL+26

     1577     7473    3           CALL M$CLOSE (CLOSE_REL) ALTRET(A1);

   7473  6 002425   000732 630400 1                  EPPR0   CLOSE_REL
         6 002426   450001 713400                    CLIMB   alt,close
         6 002427   406000 401760                    pmme    nvectors=13
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:169  
         6 002430   002433 702000 6                  TSX2    A1

     1578     7474    3           CALL REL_RES;

   7474  6 002431   003027 701000 6                  TSX1    REL_RES
         6 002432   000000 011000                    NOP     0

   7472  6 002433                       A1           null
     1579     7475    3   A1:     ;
     1580     7476    3           END;

     1581     7477    2         RETURN;

   7477  6 002433   200040 221300                    LDX1  ! CGAURD$+8,,AUTO
         6 002434   000001 702211                    TSX2  ! 1,X1

     1582     7478    2   END FLUSHIT;
     1583     7479
     1584     7480
     1585     7481
     1586     7482    1   WRITE_REC: PROC ALTRET;

   7482  6 002435   200036 741300       WRITE_REC    STX1  ! CGAURD$+6,,AUTO

     1587     7483    2         IF WRITOUT = 0 THEN RETURN;

   7483  6 002436   200015 235100                    LDA     WRITOUT,,AUTO
         6 002437   002441 601000 6                  TNZ     s:7484

   7483  6 002440   000001 702211                    TSX2  ! 1,X1

     1588     7484    2         IF ARS ~= 0 THEN

   7484  6 002441   200016 236100                    LDQ     ARS,,AUTO
         6 002442   002453 600000 6                  TZE     s:7489

     1589     7485    3           DO;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:170  

     1590     7486    3           WRITEIT.BUF_.BOUND=ARS-1;

   7486  6 002443   000001 136007                    SBLQ    1,DL
         6 002444   000020 736000                    QLS     16
         6 002445   000722 676000 1                  ERQ     WRITEIT+4
         6 002446   000034 376000 xsym               ANQ     B_VECTNIL+28
         6 002447   000722 656000 1                  ERSQ    WRITEIT+4

     1591     7487    3           WRITEIT.BUF_.BUF$=BUF$;

   7487  6 002450   200017 236100                    LDQ     BUF$,,AUTO
         6 002451   000723 756000 1                  STQ     WRITEIT+5

     1592     7488    3           END;

   7488  6 002452   002455 710000 6                  TRA     s:7490

     1593     7489    2         ELSE WRITEIT.BUF_=VECTOR(NIL);

   7489  6 002453   000036 237000 7                  LDAQ    30
         6 002454   000722 757000 1                  STAQ    WRITEIT+4

     1594     7490    2         GOTO WRITE;

   7490  6 002455   002461 710000 6                  TRA     WRITE

     1595     7491
     1596     7492    2   WRITE_EOD: ENTRY ALTRET;

   7492  6 002456   200036 741300       WRITE_EOD    STX1  ! CGAURD$+6,,AUTO

     1597     7493    2         WRITEIT.BUF_=VECTOR(EODCARD);

   7493  6 002457   000066 237000 7                  LDAQ    54
         6 002460   000722 757000 1                  STAQ    WRITEIT+4

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:171  
   7493  6 002461                       WRITE        null
     1598     7494    2   WRITE:;
     1599     7495    2         WRITEIT.V.DCB#=DEV$->FI$DEV.DCB#;

   7495  6 002461   200010 470500                    LDP0    DEV$,,AUTO
         6 002462   000004 220100                    LDX0    4,,PR0
         6 002463   000726 740000 1                  STX0    WRITEIT+8

     1600     7496    2         WRITEIT.V.DVBYTE=CITE$->FI$ISRD.DVBYTE;

   7496  6 002464   200027 471500                    LDP1    CITE$,,AUTO
         6 002465   100003 236100                    LDQ     3,,PR1
         6 002466   000731 552040 1                  STBQ    WRITEIT+11,'40'O

     1601     7497    2         CALL M$WRITE (WRITEIT) ALTRET(BADWRT);

   7497  6 002467   000716 630400 1                  EPPR0   WRITEIT
         6 002470   440001 713400                    CLIMB   alt,write
         6 002471   401400 401760                    pmme    nvectors=4
         6 002472   002475 702000 6                  TSX2    BADWRT

     1602     7498    2         RETURN;

   7498  6 002473   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 002474   000001 702211                    TSX2  ! 1,X1

   7496  6 002475                       BADWRT       null
     1603     7499    2   BADWRT:;
     1604     7500    2         IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD = '0'B THEN RETURN;

   7500  6 002475   000007 470400 7                  LDP0    7
         6 002476   000000 471500                    LDP1    0,,PR0
         6 002477   200010 473500                    LDP3    DEV$,,AUTO
         6 002500   300004 220100                    LDX0    4,,PR3
         6 002501   100000 474510                    LDP4    0,X0,PR1
         6 002502   400031 236100                    LDQ     25,,PR4
         6 002503   020000 316007                    CANQ    8192,DL
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:172  
         6 002504   002507 601000 6                  TNZ     s:7501

   7500  6 002505   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 002506   000001 702211                    TSX2  ! 1,X1

     1605     7501    2         OPMSG_JBFL.SUBC=FIJF_BDWRT#;

   7501  6 002507   000000 101400                    MRL     fill='000'O
         6 002510   000005 000004 xsym               ADSC9   B_VECTNIL+5              cn=0,n=4
         6 002511   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1606     7502    2         OPMSG_JBFL.ERRC=B$ERRCODE;

   7502  6 002512   000000 474400 xsym               LDP4    B$TCB$
         6 002513   400000 475500                    LDP5    0,,PR4
         6 002514   500102 236100                    LDQ     66,,PR5
         6 002515   377770 376007                    ANQ     131064,DL
         6 002516   000006 736000                    QLS     6
         6 002517   000346 552030 1                  STBQ    OPMSG_JBFL+6,'30'O

     1607     7503    2         ALTRETURN;

   7503  6 002520   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 002521   000000 702211                    TSX2  ! 0,X1

     1608     7504    2   END WRITE_REC;
     1609     7505
     1610     7506
     1611     7507
     1612     7508
     1613     7509    1   CLSSV: PROC;

   7509  6 002522   200036 741300       CLSSV        STX1  ! CGAURD$+6,,AUTO

     1614     7510    2         IF DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.FCD THEN

   7510  6 002523   000007 470400 7                  LDP0    7
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:173  
         6 002524   000000 471500                    LDP1    0,,PR0
         6 002525   200010 473500                    LDP3    DEV$,,AUTO
         6 002526   300004 220100                    LDX0    4,,PR3
         6 002527   100000 474510                    LDP4    0,X0,PR1
         6 002530   400031 236100                    LDQ     25,,PR4
         6 002531   020000 316007                    CANQ    8192,DL
         6 002532   002553 600000 6                  TZE     s:7519

     1615     7511    3           DO;

     1616     7512    3           CLOSE_SAV.V.DCB#=DEV$->FI$DEV.DCB#;

   7512  6 002533   001022 740000 1                  STX0    CLOSE_SAV+26

     1617     7513    3           CALL M$CLOSE (CLOSE_SAV) ALTRET(BADCLS);

   7513  6 002534   000770 630400 1                  EPPR0   CLOSE_SAV
         6 002535   450001 713400                    CLIMB   alt,close
         6 002536   406000 401760                    pmme    nvectors=13
         6 002537   002555 702000 6                  TSX2    BADCLS

     1618     7514    3           CALL REL_RES;

   7514  6 002540   003027 701000 6                  TSX1    REL_RES
         6 002541   000000 011000                    NOP     0

     1619     7515    3           OPMSG_JBSB.DEST=DEV$->FI$DEV.DEST;

   7515  6 002542   200010 470500                    LDP0    DEV$,,AUTO
         6 002543   040000 100500                    MLR     fill='040'O
         6 002544   000071 000126                    ADSC9   57,,PR0                  cn=0,n=86
         6 002545   000402 200126 1                  ADSC9   OPMSG_JBSB+5             cn=1,n=86

     1620     7516    3           OPMSG_JBSB.DEVNM=DEVNAME;

   7516  6 002546   000002 237000 1                  LDAQ    DEVNAME
         6 002547   000400 757000 1                  STAQ    OPMSG_JBSB+3
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:174  

     1621     7517    3           CALL M$WRITE (OCMSG_JBSB);

   7517  6 002550   000540 630400 2                  EPPR0   OCMSG_JBSB
         6 002551   040001 713400                    CLIMB   write
         6 002552   401400 401760                    pmme    nvectors=4

     1622     7518    3           END;

     1623     7519    2         RETURN;

   7519  6 002553   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 002554   000001 702211                    TSX2  ! 1,X1

   7518  6 002555                       BADCLS       null
     1624     7520    2   BADCLS:;
     1625     7521    2         OPMSG_JBFL.SUBC=FIJF_CLERR#;

   7521  6 002555   000000 101400                    MRL     fill='000'O
         6 002556   000007 000004 xsym               ADSC9   B_VECTNIL+7              cn=0,n=4
         6 002557   000345 600002 1                  ADSC9   OPMSG_JBFL+5             cn=3,n=2

     1626     7522    2         OPMSG_JBFL.ERRC=B$ERRCODE;

   7522  6 002560   000000 470400 xsym               LDP0    B$TCB$
         6 002561   000000 471500                    LDP1    0,,PR0
         6 002562   100102 236100                    LDQ     66,,PR1
         6 002563   377770 376007                    ANQ     131064,DL
         6 002564   000006 736000                    QLS     6
         6 002565   000346 552030 1                  STBQ    OPMSG_JBFL+6,'30'O

     1627     7523    2         CALL FLUSHIT;

   7523  6 002566   002372 701000 6                  TSX1    FLUSHIT
         6 002567   000000 011000                    NOP     0

     1628     7524    2         RETURN;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:175  

   7524  6 002570   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 002571   000001 702211                    TSX2  ! 1,X1

     1629     7525    2   END CLSSV;
     1630     7526        %EJECT;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:176  
     1631     7527        /**************************************
     1632     7528         **************************************
     1633     7529                    ADD_DEV
     1634     7530         **************************************
     1635     7531         **************************************/
     1636     7532        /*D* NAME:         ADD_DEV
     1637     7533
     1638     7534             PURPOSE:      To add a new INSYM device
     1639     7535
     1640     7536             DESCRIPTION:
     1641     7537
     1642     7538                 DEVNAME is the name of the device.
     1643     7539                 CONINFO$ points to a FI$CONINFO frame containing the
     1644     7540                           connection information.
     1645     7541                 A device frame is allocated and the device set to
     1646     7542                           its initial state.  If any errors are
     1647     7543                           encountered in this process, an appropriate
     1648     7544                           message appears on concerned UR consoles.
     1649     7545        */
     1650     7546    1   ADD_DEV: PROC ALTRET;

   7546  6 002572   200034 741300       ADD_DEV      STX1  ! CGAURD$+4,,AUTO

     1651     7547    2         CALL FIND_DEV ALTRET(A9);

   7547  6 002573   002751 701000 6                  TSX1    FIND_DEV
         6 002574   002577 702000 6                  TSX2    A9

     1652     7548                                /* DEVICE ALREADY LISTED */
     1653     7549    2         ALTRETURN;

   7549  6 002575   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 002576   000000 702211                    TSX2  ! 0,X1

   7547  6 002577                       A9           null
     1654     7550    2   A9:   ;
     1655     7551    2         OPMSG_TCON.DEVNM=DEVNAME;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:177  

   7551  6 002577   000002 237000 1                  LDAQ    DEVNAME
         6 002600   000306 757000 1                  STAQ    OPMSG_TCON+3

     1656     7552    2         OPMSG_TCON.SUBC=1;

   7552  6 002601   001000 236003                    LDQ     512,DU
         6 002602   000311 552040 1                  STBQ    OPMSG_TCON+6,'40'O

     1657     7553    2         CALL FOI$GBUF (FI_DEVSCB,DEV$) ALTRET(A2);

   7553  6 002603   200010 630500                    EPPR0   DEV$,,AUTO
         6 002604   200045 450500                    STP0    CGAURD$+13,,AUTO
         6 002605   000070 236000 7                  LDQ     56
         6 002606   200044 756100                    STQ     CGAURD$+12,,AUTO
         6 002607   200044 630500                    EPPR0   CGAURD$+12,,AUTO
         6 002610   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 002611   000000 701000 xent               TSX1    FOI$GBUF
         6 002612   002736 702000 6                  TSX2    A2

     1658     7554    2         DEV$->FI$DEV=FI_DEV_INIT;

   7554  6 002613   200010 470500                    LDP0    DEV$,,AUTO
         6 002614   000100 100400                    MLR     fill='000'O
         6 002615   000000 000472 xsym               ADSC9   FI_DEV_INIT              cn=0,n=314
         6 002616   000000 000472                    ADSC9   0,,PR0                   cn=0,n=314

     1659     7555    2         DEV$->FI$DEV.NAME=DEVNAME;

   7555  6 002617   200010 470500                    LDP0    DEV$,,AUTO
         6 002620   000002 237000 1                  LDAQ    DEVNAME
         6 002621   000001 755100                    STA     1,,PR0
         6 002622   000002 756100                    STQ     2,,PR0

     1660     7556    2         DEV$->FI$DEV.CTLDEV= ~(CONINFO$->FI$CONINFO.NCTL);

   7556  6 002623   200023 470500                    LDP0    CONINFO$,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:178  
         6 002624   000000 236100                    LDQ     0,,PR0
         6 002625   400000 376003                    ANQ     -131072,DU
         6 002626   400000 676003                    ERQ     -131072,DU
         6 002627   200010 471500                    LDP1    DEV$,,AUTO
         6 002630   000022 772000                    QRL     18
         6 002631   100004 676100                    ERQ     4,,PR1
         6 002632   400000 376007                    ANQ     -131072,DL
         6 002633   100004 656100                    ERSQ    4,,PR1

     1661     7557    2         DEV$->FI$DEV.NCTLOK=CONINFO$->FI$CONINFO.NCTLOK;

   7557  6 002634   200010 471500                    LDP1    DEV$,,AUTO
         6 002635   000000 236100                    LDQ     0,,PR0
         6 002636   000022 772000                    QRL     18
         6 002637   100004 676100                    ERQ     4,,PR1
         6 002640   200000 376007                    ANQ     65536,DL
         6 002641   100004 656100                    ERSQ    4,,PR1

     1662     7558    2         DEV$->FI$DEV.DFPRI=CONINFO$->FI$CONINFO.DFPRI;

   7558  6 002642   200010 471500                    LDP1    DEV$,,AUTO
         6 002643   000000 236100                    LDQ     0,,PR0
         6 002644   000011 736000                    QLS     9
         6 002645   100003 552120                    STBQ    3,'20'O,PR1

     1663     7559    2         DEV$->FI$DEV.MXPRI=CONINFO$->FI$CONINFO.MXPRI;

   7559  6 002646   200010 471500                    LDP1    DEV$,,AUTO
         6 002647   000000 236100                    LDQ     0,,PR0
         6 002650   000033 736000                    QLS     27
         6 002651   100003 552140                    STBQ    3,'40'O,PR1

     1664     7560    2         DEV$->FI$DEV.ACCT=CONINFO$->FI$CONINFO.NCACCT;

   7560  6 002652   200010 471500                    LDP1    DEV$,,AUTO
         6 002653   040100 100500                    MLR     fill='040'O
         6 002654   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:179  
         6 002655   100006 000010                    ADSC9   6,,PR1                   cn=0,n=8

     1665     7561    2         IF CONINFO$->FI$CONINFO.NCTLFID THEN

   7561  6 002656   000000 236100                    LDQ     0,,PR0
         6 002657   100000 316003                    CANQ    32768,DU
         6 002660   002666 600000 6                  TZE     s:7563

     1666     7562    2          DEV$->FI$DEV.DFID=CONINFO$->FI$CONINFO.NFID;

   7562  6 002661   200010 471500                    LDP1    DEV$,,AUTO
         6 002662   040100 100500                    MLR     fill='040'O
         6 002663   000003 000120                    ADSC9   3,,PR0                   cn=0,n=80
         6 002664   100012 000126                    ADSC9   10,,PR1                  cn=0,n=86
         6 002665   002672 710000 6                  TRA     s:7564

     1667     7563    2         ELSE DEV$->FI$DEV.DFID=' ';

   7563  6 002666   200010 471500                    LDP1    DEV$,,AUTO
         6 002667   040100 100400                    MLR     fill='040'O
         6 002670   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         6 002671   100012 000126                    ADSC9   10,,PR1                  cn=0,n=86

     1668     7564    2         DEV$->FI$DEV.CFID=DEV$->FI$DEV.DFID;

   7564  6 002672   040100 100500                    MLR     fill='040'O
         6 002673   100012 000126                    ADSC9   10,,PR1                  cn=0,n=86
         6 002674   100037 400126                    ADSC9   31,,PR1                  cn=2,n=86

     1669     7565    2         DEV$->FI$DEV.LNK$=FI_DEVHD$;

   7565  6 002675   000000 236000 xsym               LDQ     FI_DEVHD$
         6 002676   100000 756100                    STQ     0,,PR1

     1670     7566    2         DEV$->FI$DEV.WSN =CONINFO$->FI$CONINFO.WSN;

   7566  6 002677   200010 471500                    LDP1    DEV$,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:180  
         6 002700   040100 100500                    MLR     fill='040'O
         6 002701   000031 000010                    ADSC9   25,,PR0                  cn=0,n=8
         6 002702   100065 000010                    ADSC9   53,,PR1                  cn=0,n=8

     1671     7567    2         DEV$->FI$DEV.TNAME=CONINFO$->FI$CONINFO.TNAME;

   7567  6 002703   040100 100500                    MLR     fill='040'O
         6 002704   000027 000010                    ADSC9   23,,PR0                  cn=0,n=8
         6 002705   100067 000010                    ADSC9   55,,PR1                  cn=0,n=8

     1672     7568    2         DEV$->FI$DEV.NCTLWSN=CONINFO$->FI$CONINFO.WSN;

   7568  6 002706   040100 100500                    MLR     fill='040'O
         6 002707   000031 000010                    ADSC9   25,,PR0                  cn=0,n=8
         6 002710   100010 000010                    ADSC9   8,,PR1                   cn=0,n=8

     1673     7569    2         FI_DEVHD$=DEV$;

   7569  6 002711   200010 236100                    LDQ     DEV$,,AUTO
         6 002712   000000 756000 xsym               STQ     FI_DEVHD$

     1674     7570    2         OPMSG_TCON.SUBC=0;

   7570  6 002713   000000 236003                    LDQ     0,DU
         6 002714   000311 552040 1                  STBQ    OPMSG_TCON+6,'40'O

     1675     7571    2         IF NOT DEV$->FI$DEV.CTLDEV THEN

   7571  6 002715   200010 471500                    LDP1    DEV$,,AUTO
         6 002716   100004 236100                    LDQ     4,,PR1
         6 002717   400000 316007                    CANQ    -131072,DL
         6 002720   002724 601000 6                  TNZ     s:7573

     1676     7572    2          OPMSG_TCON.SUBC1=1;

   7572  6 002721   000001 236003                    LDQ     1,DU
         6 002722   000311 552020 1                  STBQ    OPMSG_TCON+6,'20'O
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:181  
         6 002723   002726 710000 6                  TRA     s:7574

     1677     7573    2         ELSE OPMSG_TCON.SUBC1=0;

   7573  6 002724   000000 236003                    LDQ     0,DU
         6 002725   000311 552020 1                  STBQ    OPMSG_TCON+6,'20'O

     1678     7574    2         OPMSG_TCON.NFID=DEV$->FI$DEV.DFID;

   7574  6 002726   040000 100500                    MLR     fill='040'O
         6 002727   100012 000126                    ADSC9   10,,PR1                  cn=0,n=86
         6 002730   000312 000126 1                  ADSC9   OPMSG_TCON+7             cn=0,n=86

     1679     7575    2         CALL M$WRITE (OCMSG_TCON);

   7575  6 002731   000510 630400 2                  EPPR0   OCMSG_TCON
         6 002732   040001 713400                    CLIMB   write
         6 002733   401400 401760                    pmme    nvectors=4

     1680     7576    2         RETURN;

   7576  6 002734   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 002735   000001 702211                    TSX2  ! 1,X1

   7574  6 002736                       A2           null
     1681     7577    2   A2:   ;
     1682     7578    2         OPMSG_TCON.SUBC1=FITD_NTBL#;

   7578  6 002736   000001 236003                    LDQ     1,DU
         6 002737   000311 552020 1                  STBQ    OPMSG_TCON+6,'20'O

   7578  6 002740                       A21          null
     1683     7579    2   A21:  ;
     1684     7580    2         CALL M$WRITE (OCMSG_TCON);

   7580  6 002740   000510 630400 2                  EPPR0   OCMSG_TCON
         6 002741   040001 713400                    CLIMB   write
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:182  
         6 002742   401400 401760                    pmme    nvectors=4

     1685     7581    2         CALL M$DEACTIVATE (DISCT_DEV) ALTRET(RTN);

   7581  6 002743   000364 630400 2                  EPPR0   DISCT_DEV
         6 002744   500001 713400                    CLIMB   alt,+32769
         6 002745   401400 401760                    pmme    nvectors=4
         6 002746   002747 702000 6                  TSX2    RTN

   7578  6 002747                       RTN          null
     1686     7582    2   RTN:  ;
     1687     7583    2         RETURN;

   7583  6 002747   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 002750   000001 702211                    TSX2  ! 1,X1

     1688     7584    2   END ADD_DEV;
     1689     7585        /**************************************
     1690     7586         **************************************
     1691     7587                    FIND_DEV
     1692     7588         **************************************
     1693     7589         **************************************/
     1694     7590        /*D* NAME:         FIND_DEV
     1695     7591             PURPOSE:      To find a device in INSYM's tables
     1696     7592             DESCRIPTION:  DEVNAME is the name of the device.  If a device
     1697     7593                           of that name is found, return is made with
     1698     7594                           DEV$ pointing to the device.  Else the routine
     1699     7595                           ALTRETs.  */
     1700     7596    1   FIND_DEV: PROC ALTRET;

   7596  6 002751   200036 741300       FIND_DEV     STX1  ! CGAURD$+6,,AUTO

     1701     7597
     1702     7598    2         DEV$=FI_DEVHD$;

   7598  6 002752   000000 236000 xsym               LDQ     FI_DEVHD$
         6 002753   200010 756100                    STQ     DEV$,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:183  

     1703     7599    3           DO WHILE (DEV$ ~= ADDR(NIL));

   7599  6 002754   002766 710000 6                  TRA     s:7602

     1704     7600    3           IF DEVNAME = DEV$->FI$DEV.NAME THEN RETURN;

   7600  6 002755   200010 470500                    LDP0    DEV$,,AUTO
         6 002756   040100 106400                    CMPC    fill='040'O
         6 002757   000002 000010 1                  ADSC9   DEVNAME                  cn=0,n=8
         6 002760   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         6 002761   002764 601000 6                  TNZ     s:7601

   7600  6 002762   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 002763   000001 702211                    TSX2  ! 1,X1

     1705     7601    3           DEV$=DEV$->FI$DEV.LNK$;

   7601  6 002764   000000 236100                    LDQ     0,,PR0
         6 002765   200010 756100                    STQ     DEV$,,AUTO

     1706     7602    3           END;

   7602  6 002766   000001 116000 xsym               CMPQ    B_VECTNIL+1
         6 002767   002755 601000 6                  TNZ     s:7600

     1707     7603    2         ALTRETURN;

   7603  6 002770   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 002771   000000 702211                    TSX2  ! 0,X1

     1708     7604    2   END FIND_DEV;
     1709     7605        /**************************************
     1710     7606         **************************************
     1711     7607                    REM_DEV
     1712     7608         **************************************
     1713     7609         **************************************/
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:184  
     1714     7610        /*D* NAME:         REM_DEV
     1715     7611             PURPOSE:      To remove a device from INSYM's tables.
     1716     7612             DESCRIPTION:  The desired device is pointed to by DEV$.  The
     1717     7613                           device frame is removed and released. */
     1718     7614    1   REM_DEV: PROC;

   7614  6 002772   200034 741300       REM_DEV      STX1  ! CGAURD$+4,,AUTO

     1719     7615    2         IF DEV$ = FI_DEVHD$ THEN

   7615  6 002773   200010 236100                    LDQ     DEV$,,AUTO
         6 002774   000000 116000 xsym               CMPQ    FI_DEVHD$
         6 002775   003002 601000 6                  TNZ     s:7620

     1720     7616    3           DO;

     1721     7617    3           FI_DEVHD$=DEV$->FI$DEV.LNK$;

   7617  6 002776   200010 470500                    LDP0    DEV$,,AUTO
         6 002777   000000 236100                    LDQ     0,,PR0
         6 003000   000000 756000 xsym               STQ     FI_DEVHD$

     1722     7618    3           GOTO DONE;

   7618  6 003001   003013 710000 6                  TRA     DONE

     1723     7619    3           END;
     1724     7620    2         P$=FI_DEVHD$;

   7620  6 003002   000000 236000 xsym               LDQ     FI_DEVHD$
         6 003003   200020 756100                    STQ     P$,,AUTO

     1725     7621    3           DO FOREVER;

     1726     7622    3           IF P$->FI$DEV.LNK$ = DEV$ THEN

   7622  6 003004   200020 470500                    LDP0    P$,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:185  
         6 003005   000000 236100                    LDQ     0,,PR0
         6 003006   200010 116100                    CMPQ    DEV$,,AUTO
         6 003007   003025 601000 6                  TNZ     s:7629

     1727     7623    4             DO;

     1728     7624    4             P$->FI$DEV.LNK$=DEV$->FI$DEV.LNK$;

   7624  6 003010   200010 471500                    LDP1    DEV$,,AUTO
         6 003011   100000 236100                    LDQ     0,,PR1
         6 003012   000000 756100                    STQ     0,,PR0

   7624  6 003013                       DONE         null
     1729     7625    4   DONE:     ;
     1730     7626    4             CALL FOI$RBUF (FI_DEVSCB,DEV$);

   7626  6 003013   200010 630500                    EPPR0   DEV$,,AUTO
         6 003014   200045 450500                    STP0    CGAURD$+13,,AUTO
         6 003015   000070 236000 7                  LDQ     56
         6 003016   200044 756100                    STQ     CGAURD$+12,,AUTO
         6 003017   200044 630500                    EPPR0   CGAURD$+12,,AUTO
         6 003020   000020 631400 xsym               EPPR1   B_VECTNIL+16
         6 003021   000000 701000 xent               TSX1    FOI$RBUF
         6 003022   000000 011000                    NOP     0

     1731     7627    4             RETURN;

   7627  6 003023   200034 221300                    LDX1  ! CGAURD$+4,,AUTO
         6 003024   000001 702211                    TSX2  ! 1,X1

     1732     7628    4             END;
     1733     7629    3           P$=P$->FI$DEV.LNK$;

   7629  6 003025   200020 756100                    STQ     P$,,AUTO

     1734     7630    3           END;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:186  
   7630  6 003026   003004 710000 6                  TRA     s:7622

     1735     7631    2   END REM_DEV;
     1736     7632        /**************************************
     1737     7633         **************************************
     1738     7634                    REL_RES
     1739     7635         **************************************
     1740     7636         **************************************/
     1741     7637        /*D* NAME:         REL_RES
     1742     7638             PURPOSE:      To release a resource.
     1743     7639             DESCRIPTION:  After M$CLOSEing a file, this procedure is called
     1744     7640                           to release the resource corresponding to the
     1745     7641                           account of the file.  This is so INSYM doesn't
     1746     7642                           continue to "own" private packs which have been
     1747     7643                           NCTL'ed to.  */
     1748     7644    1   REL_RES: PROC;

   7644  6 003027   200042 741300       REL_RES      STX1  ! CGAURD$+10,,AUTO

     1749     7645    2         FIND_PSN.ACCT_=VECTOR(DCBADDR(DEV$->FI$DEV.DCB#)->F$DCB.ACCT);

   7645  6 003030   000007 470400 7                  LDP0    7
         6 003031   000000 471500                    LDP1    0,,PR0
         6 003032   200010 473500                    LDP3    DEV$,,AUTO
         6 003033   300004 220100                    LDX0    4,,PR3
         6 003034   100000 474510                    LDP4    0,X0,PR1
         6 003035   000046 235000 7                  LDA     38
         6 003036   200044 454500                    STP4    CGAURD$+12,,AUTO
         6 003037   200044 236100                    LDQ     CGAURD$+12,,AUTO
         6 003040   000020 036003                    ADLQ    16,DU
         6 003041   001030 757000 1                  STAQ    FIND_PSN+2

     1750     7646    2         CALL M$MADMUCK (FIND_PSN) ALTRET (IGNORE_MADMUCK_ALTRET);

   7646  6 003042   001026 630400 1                  EPPR0   FIND_PSN
         6 003043   460005 713400                    CLIMB   alt,+24581
         6 003044   401000 401760                    pmme    nvectors=3
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:187  
         6 003045   003046 702000 6                  TSX2    IGNORE_MADMUCK_ALTRET

     1751     7647    2   IGNORE_MADMUCK_ALTRET:
     1752     7648    2         VLP_RPSN.NN#=1;

   7648  6 003046   000001 235007       IGNORE_MADM* LDA     1,DL
         6 003047   001042 755000 1                  STA     VLP_RPSN

     1753     7649    2         VLP_RPSN.RPLIST.PSN#(0)=VLP_SN.SN#(0);

   7649  6 003050   040000 100400                    MLR     fill='040'O
         6 003051   001037 000006 1                  ADSC9   VLP_SN+1                 cn=0,n=6
         6 003052   001044 000006 1                  ADSC9   VLP_RPSN+2               cn=0,n=6

     1754     7650    2         CALL M$RELRES (REL_PSN) ALTRET (IGNORE_RELRES_ALTRET);

   7650  6 003053   000604 630400 2                  EPPR0   REL_PSN
         6 003054   550003 713400                    CLIMB   alt,+53251
         6 003055   402400 401760                    pmme    nvectors=6
         6 003056   003057 702000 6                  TSX2    IGNORE_RELRES_ALTRET

     1755     7651    2   IGNORE_RELRES_ALTRET:
     1756     7652              /*  Ignore this altret, too.  The SN may have said #SYS, in which
     1757     7653                  case INSYM might (should!) still have a DCB open to it.  */
     1758     7654    2         RETURN;

   7654  6 003057   200042 221300       IGNORE_RELR* LDX1  ! CGAURD$+10,,AUTO
         6 003060   000001 702211                    TSX2  ! 1,X1

     1759     7655    2   END REL_RES;
     1760     7656        /**************************************
     1761     7657         **************************************
     1762     7658                    MISC_SETUP
     1763     7659         **************************************
     1764     7660         **************************************/
     1765     7661
     1766     7662    1   MISC_SETUP: PROC;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:188  

   7662  6 003061   200032 741300       MISC_SETUP   STX1  ! CGAURD$+2,,AUTO

     1767     7663
     1768     7664                                /* TURN OFF SOME PRIVILEGE */
     1769     7665    2         CALL M$RPRIV (PRIVZAP) ALTRET(WHOCARES);

   7665  6 003062   000626 630400 2                  EPPR0   PRIVZAP
         6 003063   420013 713400                    CLIMB   alt,+8203
         6 003064   400000 401760                    pmme    nvectors=1
         6 003065   003066 702000 6                  TSX2    WHOCARES

   7665  6 003066                       WHOCARES     null
     1770     7666    2   WHOCARES:;
     1771     7667                                /* LINK FREE EVENT Q FRAMES TOGETHER */
     1772     7668    2         EVNT$=ADDR(FI_EVQ(0));

   7668  6 003066   000071 236000 7                  LDQ     57
         6 003067   000000 756000 xsym               STQ     FI_EVNT$

     1773     7669    3           DO I = 0 TO FIMI_EVMX#-1;

   7669  6 003070   200013 450100                    STZ     I,,AUTO
         6 003071   003104 710000 6                  TRA     s:7672+3

     1774     7670    3           EVNT$->FI$EVNT.LNK$=PINCRW(EVNT$,SIZEW(FI$EVNT));

   7670  6 003072   000000 236000 xsym               LDQ     FI_EVNT$
         6 003073   000006 036003                    ADLQ    6,DU
         6 003074   000000 470400 xsym               LDP0    FI_EVNT$
         6 003075   000000 756100                    STQ     0,,PR0

     1775     7671    3           EVNT$=EVNT$->FI$EVNT.LNK$;

   7671  6 003076   000000 470400 xsym               LDP0    FI_EVNT$
         6 003077   000000 236100                    LDQ     0,,PR0
         6 003100   000000 756000 xsym               STQ     FI_EVNT$
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:189  

     1776     7672    3           END;

   7672  6 003101   200013 235100                    LDA     I,,AUTO
         6 003102   000001 035007                    ADLA    1,DL
         6 003103   200013 755100                    STA     I,,AUTO
         6 003104   200013 235100                    LDA     I,,AUTO
         6 003105   000012 115007                    CMPA    10,DL
         6 003106   003072 602000 6                  TNC     s:7670

     1777     7673
     1778     7674    2         OPNATTR.FLAG=JOBORIG_DEVICE#;

   7674  6 003107   000000 236003                    LDQ     0,DU
         6 003110   000123 552040 1                  STBQ    OPNATTR+7,'40'O

     1779     7675    2         OPNATTR.SYSID=0;

   7675  6 003111   000000 220003                    LDX0    0,DU
         6 003112   000122 740000 1                  STX0    OPNATTR+6

     1780     7676    2         OPNATTR.SIZ=SIZEW(FS$JOBORIG);

   7676  6 003113   000010 235007                    LDA     8,DL
         6 003114   000114 755000 1                  STA     OPNATTR

     1781     7677    2   END MISC_SETUP;

   7677  6 003115   200032 221300                    LDX1  ! CGAURD$+2,,AUTO
         6 003116   000001 702211                    TSX2  ! 1,X1

     1782     7678        /**************************************
     1783     7679         **************************************
     1784     7680                    CHK_NAME
     1785     7681         **************************************
     1786     7682         **************************************/
     1787     7683        /*D* NAME:         CHK_NAME
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:190  
     1788     7684             PURPOSE:      To validate a NCTL filename
     1789     7685             DESCRIPTION:  When  NCTL FID produces ASN=FILE, the fid
     1790     7686                           must be checked for legality.  This routine
     1791     7687                           uses VLR_FIDIT, and FIDNAME to do the chks,
     1792     7688                           returning normally if the name passes, and
     1793     7689                           ALTRETing else. */
     1794     7690    1   CHK_NAME: PROC ALTRET;

   7690  6 003117   200036 741300       CHK_NAME     STX1  ! CGAURD$+6,,AUTO

     1795     7691    2         IF FIDNAME.L# > 31

   7691  6 003120   000644 236000 1                  LDQ     FIDNAME
         6 003121   777000 376003                    ANQ     -512,DU
         6 003122   040000 116003                    CMPQ    16384,DU
         6 003123   003127 603000 6                  TRC     s:7692
         6 003124   000704 236000 1                  LDQ     VLR_FIDIT
         6 003125   100000 316003                    CANQ    32768,DU
         6 003126   003130 600000 6                  TZE     s:7693

     1796     7692    2         OR VLR_FIDIT.PASS THEN ALTRETURN;

   7692  6 003127   000000 702211                    TSX2  ! 0,X1

     1797     7693    2         IF FIDNAME.L# >= 1 THEN

   7693  6 003130   000644 236000 1                  LDQ     FIDNAME
         6 003131   777000 316003                    CANQ    -512,DU
         6 003132   003137 600000 6                  TZE     s:7695

     1798     7694    2          IF SUBSTR(FIDNAME.NAME#,0,1) = '*' THEN ALTRETURN;

   7694  6 003133   000777 376003                    ANQ     511,DU
         6 003134   000052 116003                    CMPQ    42,DU
         6 003135   003137 601000 6                  TNZ     s:7695

   7694  6 003136   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:191  

     1799     7695    2         RETURN;

   7695  6 003137   000001 702211                    TSX2  ! 1,X1

     1800     7696    2   END CHK_NAME;
     1801     7697        /**************************************
     1802     7698         **************************************
     1803     7699                    CHK_FORM
     1804     7700         **************************************
     1805     7701         **************************************/
     1806     7702        /*D* NAME:         CHK_FORM
     1807     7703             PURPOSE:      To check a NCTL FID for formname
     1808     7704             DESCRIPTION:  FIDIT.TEXTFID_ is a vector framing the NCTL FID
     1809     7705                           to be examined.  The formname is considered by
     1810     7706                           this routine to be the first item in the fid
     1811     7707                           that is enclosed by parentheses.  If the formname
     1812     7708                           is not present, OPENIT.FORM_ is set VECTOR(NIL),
     1813     7709                           and DEVDEST.FORM is set to blanks.
     1814     7710                           If the formname is present, OPENIT.FORM_ is set
     1815     7711                           to frame OPENFORM, which is filled with the form
     1816     7712                           name, and DEVDEST.FORM is set to the formname.
     1817     7713                           In both of these cases, we RETURN.  Other-
     1818     7714                           wise, that is if the formname is too long or
     1819     7715                           garbled (e.g. '()'), we ALTRET. */
     1820     7716    1   CHK_FORM: PROC ALTRET;

   7716  6 003140   200036 741300       CHK_FORM     STX1  ! CGAURD$+6,,AUTO

     1821     7717
     1822     7718    2         DEVDEST.FORM=' ';

   7718  6 003141   000035 235000 xsym               LDA     B_VECTNIL+29
         6 003142   000035 236000 xsym               LDQ     B_VECTNIL+29
         6 003143   000072 757000 1                  STAQ    DEVDEST+4

     1823     7719    2         OPENIT.FORM_=VECTOR(NIL);
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:192  

   7719  6 003144   000036 237000 7                  LDAQ    30
         6 003145   000612 757000 1                  STAQ    OPENIT+32

     1824     7720    2         CALL FINDIT ALTRET(RTN);

   7720  6 003146   003246 701000 6                  TSX1    FINDIT
         6 003147   003205 702000 6                  TSX2    RTN

     1825     7721    2         II=II-JJ;

   7721  6 003150   200022 236100                    LDQ     II,,AUTO
         6 003151   200021 136100                    SBLQ    JJ,,AUTO
         6 003152   200022 756100                    STQ     II,,AUTO

     1826     7722    2         IF II <= 1 OR II > 07 THEN ALTRETURN;

   7722  6 003153   000002 116007                    CMPQ    2,DL
         6 003154   003157 602000 6                  TNC     s:7722+4
         6 003155   000010 116007                    CMPQ    8,DL
         6 003156   003161 602000 6                  TNC     s:7723

   7722  6 003157   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 003160   000000 702211                    TSX2  ! 0,X1

     1827     7723    2         II=II-1;

   7723  6 003161   000001 136007                    SBLQ    1,DL
         6 003162   200022 756100                    STQ     II,,AUTO

     1828     7724    2         OPENFORM.FORM#=PINCRC(TVEC.PTR$,JJ+1)->B$CHARSII;

   7724  6 003163   200005 470500                    LDP0    TVEC+1,,AUTO
         6 003164   000000 620006                    EAX0    0,QL
         6 003165   200021 235100                    LDA     JJ,,AUTO
         6 003166   040100 100545                    MLR     fill='040'O
         6 003167   000000 200010                    ADSC9   0,A,PR0                  cn=1,n=*X0
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:193  
         6 003170   200006 000006                    ADSC9   OPENFORM,,AUTO           cn=0,n=6

     1829     7725    2         OPENIT.FORM_=VECTOR(OPENFORM);

   7725  6 003171   000072 235000 7                  LDA     58
         6 003172   200044 452500                    STP2    CGAURD$+12,,AUTO
         6 003173   200044 236100                    LDQ     CGAURD$+12,,AUTO
         6 003174   000006 036003                    ADLQ    6,DU
         6 003175   000612 757000 1                  STAQ    OPENIT+32

     1830     7726    2         DEVDEST.FORMR.O='(';

   7726  6 003176   050000 236003                    LDQ     20480,DU
         6 003177   000072 552040 1                  STBQ    DEVDEST+4,'40'O

     1831     7727    2         DEVDEST.FORMR.C=')';

   7727  6 003200   000051 236007                    LDQ     41,DL
         6 003201   000073 552004 1                  STBQ    DEVDEST+5,'04'O

     1832     7728    2         DEVDEST.FORMR.NAME=OPENFORM.FORM#;

   7728  6 003202   040000 100500                    MLR     fill='040'O
         6 003203   200006 000006                    ADSC9   OPENFORM,,AUTO           cn=0,n=6
         6 003204   000072 200006 1                  ADSC9   DEVDEST+4                cn=1,n=6

   7728  6 003205                       RTN          null
     1833     7729    2   RTN:  ;
     1834     7730    2         RETURN;

   7730  6 003205   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 003206   000001 702211                    TSX2  ! 1,X1

     1835     7731        /*D* NAME:         DOFID
     1836     7732             PURPOSE:      To do an M$FID of a NCTL FID
     1837     7733             DESCRIPTION:  The text FID is framed by FIDIT.TEXTFID_, and
     1838     7734                           an M$FID is done on the framed text minus the
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:194  
     1839     7735                           formname if any. */
     1840     7736    2   DOFID: ENTRY ALTRET;

   7736  6 003207   200036 741300       DOFID        STX1  ! CGAURD$+6,,AUTO

     1841     7737    2         CALL FINDIT;

   7737  6 003210   003246 701000 6                  TSX1    FINDIT
         6 003211   000000 011000                    NOP     0

     1842     7738    2         II=TVEC.W1.VSIZE#;

   7738  6 003212   200004 236100                    LDQ     TVEC,,AUTO
         6 003213   000020 772000                    QRL     16
         6 003214   200022 756100                    STQ     II,,AUTO

     1843     7739    2         TVEC.W1.VSIZE#=JJ-1;

   7739  6 003215   200021 236100                    LDQ     JJ,,AUTO
         6 003216   000001 136007                    SBLQ    1,DL
         6 003217   000020 736000                    QLS     16
         6 003220   200004 676100                    ERQ     TVEC,,AUTO
         6 003221   000034 376000 xsym               ANQ     B_VECTNIL+28
         6 003222   200004 656100                    ERSQ    TVEC,,AUTO

     1844     7740    2         FIDIT.TEXTFID_=TVEC;

   7740  6 003223   200004 237100                    LDAQ    TVEC,,AUTO
         6 003224   000656 757000 1                  STAQ    FIDIT+2

     1845     7741    2         TVEC.W1.VSIZE#=II;

   7741  6 003225   200022 236100                    LDQ     II,,AUTO
         6 003226   000020 736000                    QLS     16
         6 003227   200004 676100                    ERQ     TVEC,,AUTO
         6 003230   000034 376000 xsym               ANQ     B_VECTNIL+28
         6 003231   200004 656100                    ERSQ    TVEC,,AUTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:195  

     1846     7742    2         CALL M$FID (FIDIT) ALTRET(FIDALT);

   7742  6 003232   000654 630400 1                  EPPR0   FIDIT
         6 003233   420001 713400                    CLIMB   alt,+8193
         6 003234   404400 401760                    pmme    nvectors=10
         6 003235   003242 702000 6                  TSX2    FIDALT

     1847     7743    2         FIDIT.TEXTFID_=TVEC;

   7743  6 003236   200004 237100                    LDAQ    TVEC,,AUTO
         6 003237   000656 757000 1                  STAQ    FIDIT+2

     1848     7744    2         RETURN;

   7744  6 003240   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 003241   000001 702211                    TSX2  ! 1,X1

   7743  6 003242                       FIDALT       null
     1849     7745    2   FIDALT:;
     1850     7746    2         FIDIT.TEXTFID_=TVEC;

   7746  6 003242   200004 237100                    LDAQ    TVEC,,AUTO
         6 003243   000656 757000 1                  STAQ    FIDIT+2

     1851     7747    2         ALTRETURN;

   7747  6 003244   200036 221300                    LDX1  ! CGAURD$+6,,AUTO
         6 003245   000000 702211                    TSX2  ! 0,X1

     1852     7748
     1853     7749    2   FINDIT: PROC ALTRET;

   7749  6 003246   200040 741300       FINDIT       STX1  ! CGAURD$+8,,AUTO

     1854     7750    3         TVEC=FIDIT.TEXTFID_;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:196  
   7750  6 003247   000656 237000 1                  LDAQ    FIDIT+2
         6 003250   200004 757100                    STAQ    TVEC,,AUTO

     1855     7751    4           DO JJ = 0 TO TVEC.W1.VSIZE#;

   7751  6 003251   200021 450100                    STZ     JJ,,AUTO
         6 003252   003307 710000 6                  TRA     s:7760+2

     1856     7752    4           IF PINCRC(TVEC.PTR$,JJ)->B$CHAR = '(' THEN

   7752  6 003253   200005 470500                    LDP0    TVEC+1,,AUTO
         6 003254   200021 235100                    LDA     JJ,,AUTO
         6 003255   040000 106505                    CMPC    fill='040'O
         6 003256   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         6 003257   000073 000001 7                  ADSC9   59                       cn=0,n=1
         6 003260   003305 601000 6                  TNZ     s:7760

     1857     7753    5             DO;

     1858     7754    6               DO II = JJ TO TVEC.W1.VSIZE#;

   7754  6 003261   200022 755100                    STA     II,,AUTO
         6 003262   003275 710000 6                  TRA     s:7756+2

     1859     7755    6               IF PINCRC(TVEC.PTR$,II)->B$CHAR = ')' THEN RETURN;

   7755  6 003263   200005 470500                    LDP0    TVEC+1,,AUTO
         6 003264   200022 235100                    LDA     II,,AUTO
         6 003265   040000 106505                    CMPC    fill='040'O
         6 003266   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         6 003267   000074 000001 7                  ADSC9   60                       cn=0,n=1
         6 003270   003273 601000 6                  TNZ     s:7756

   7755  6 003271   200040 221300                    LDX1  ! CGAURD$+8,,AUTO
         6 003272   000001 702211                    TSX2  ! 1,X1

     1860     7756    6               END;
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:197  

   7756  6 003273   000001 035007                    ADLA    1,DL
         6 003274   200022 755100                    STA     II,,AUTO
         6 003275   200004 236100                    LDQ     TVEC,,AUTO
         6 003276   000020 772000                    QRL     16
         6 003277   200022 116100                    CMPQ    II,,AUTO
         6 003300   003263 603000 6                  TRC     s:7755

     1861     7757    5             II=JJ;

   7757  6 003301   200021 235100                    LDA     JJ,,AUTO
         6 003302   200022 755100                    STA     II,,AUTO

     1862     7758    5             RETURN;

   7758  6 003303   200040 221300                    LDX1  ! CGAURD$+8,,AUTO
         6 003304   000001 702211                    TSX2  ! 1,X1

     1863     7759    5             END;
     1864     7760    4           END;

   7760  6 003305   000001 035007                    ADLA    1,DL
         6 003306   200021 755100                    STA     JJ,,AUTO
         6 003307   200004 236100                    LDQ     TVEC,,AUTO
         6 003310   000020 772000                    QRL     16
         6 003311   200021 116100                    CMPQ    JJ,,AUTO
         6 003312   003253 603000 6                  TRC     s:7752

     1865     7761    3         JJ=TVEC.W1.VSIZE#+1;

   7761  6 003313   000001 036007                    ADLQ    1,DL
         6 003314   200021 756100                    STQ     JJ,,AUTO

     1866     7762    3         ALTRETURN;

   7762  6 003315   200040 221300                    LDX1  ! CGAURD$+8,,AUTO
         6 003316   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:198  
     1867     7763    3   END FINDIT;
     1868     7764    2   END CHK_FORM;
     1869     7765    1   END FII$INSYM;

PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:199  
--  Include file information  --

   JC_MACRO_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   FS$FIT.:E05TOU  is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   FI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FI_MAC_C.:E05TOU  is referenced.
   FOO_MAC_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   OC_MESSHD_C.:E05TOU  is referenced.
   FI_SUBS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   JG_EVID_C.:E05TOU  is referenced.
   FI_SCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FII$INSYM.
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:200  

 **** Variables and constants ****

  ****  Section 001  Data  FII$INSYM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   732-0-0/d STRC(1080)  r     1 CLOSE_REL                770-0-0/d STRC(1080)  r     1 CLOSE_SAV
    10-0-0/d STRC(72)    r     1 DCBNUMBER                 66-0-0/w STRC(774)   r     1 DEVDEST
    66-0-0/w CHAR(86)    r     1 DEVDESTR                   2-0-0/d CHAR(8)     r     1 DEVNAME
     2-0-0/d STRC(72)    r     1 DEVNAMER                   6-0-0/d CHAR(8)     r     1 FIDACCT
   654-0-0/d STRC(864)   r     1 FIDIT                    644-0-0/c STRC(288)   r     1 FIDNAME
     4-0-0/d CHAR(8)     r     1 FIDWSN                    40-0-0/w STRC(774)   r     1 FILDEST
    40-0-0/w CHAR(86)    r     1 FILDESTR                1026-0-0/d STRC(288)   r     1 FIND_PSN
   536-0-0/d STRC(288)   r     1 GET_DCB                  472-0-0/d STRC(432)   r     1 GET_UTS
     1-0-0/w SBIN        r     1 GOODNGT                  512-0-0/d STRC(720)   r     1 ISCGCP
   506-0-0/w STRC(126)   r     1 ISCG_ACCESS               12-0-0/w STRC(774)   r     1 JOBDEST
    12-0-0/w CHAR(86)    r     1 JOBDESTR                 552-0-0/d STRC(2088)  r     1 OPENIT
   220-0-0/c STRC(1485)  r     1 OPMSG_DINFO              340-0-0/c STRC(1017)  r     1 OPMSG_JBFL
   375-0-0/c STRC(963)   r     1 OPMSG_JBSB               272-0-0/c STRC(324)   r     1 OPMSG_KERR
   430-0-0/c STRC(1017)  r     1 OPMSG_RESP               303-0-0/c STRC(1026)  r     1 OPMSG_TCON
   465-0-0/c STRC(180)   r     1 OPMSG_UNIMP              114-0-0/w STRC(324)   r     1 OPNATTR
  1054-0-0/d STRC(504)   r     1 READ_APLCG              1072-0-0/d STRC(504)   r     1 READ_CSCG
   546-0-0/d STRC(144)   r     1 REL_DCB                  126-0-0/d STRC(2088)  r     1 TJIT
     0-0-0/w UBIN        r     1 UTS_NOW                 1042-0-0/d STRC(360)   r     1 VLP_RPSN
  1036-0-0/d STRC(90)    r     1 VLP_SN                   704-0-0/d STRC(324)   r     1 VLR_FIDIT
   716-0-0/d STRC(432)   r     1 WRITEIT

  ****  Section 002 RoData FII$INSYM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   336-0-0/c STRC(45)    r     1 CSCGNAME                 252-0-0/d STRC(1872)  r     1 CTL_ISCG
   364-0-0/d STRC(576)   r     1 DISCT_DEV                632-0-0/d STRC(576)   r     1 DSCGO_DEV
     0-0-0/w CHAR(4)     r     1 EODCARD                   16-0-0/d STRC(144)   r     1 EVENTSET
   340-0-0/d STRC(144)   r     1 EXTEND_ISCG              130-0-0/w STRC(432)   r     1 INSYMNAME
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:201  
   144-0-0/w STRC(432)   r     1 INSYMNAMECS              344-0-0/c STRC(45)    r     1 ISCGNAME
     1-0-0/w STRC(54)    r     1 JC_PCMP                  460-0-0/d STRC(432)   r     1 OCMSG_DINFO
   524-0-0/d STRC(432)   r     1 OCMSG_JBFL               540-0-0/d STRC(432)   r     1 OCMSG_JBSB
   474-0-0/d STRC(432)   r     1 OCMSG_KERR               554-0-0/d STRC(432)   r     1 OCMSG_RESP
   510-0-0/d STRC(432)   r     1 OCMSG_TCON               570-0-0/d STRC(432)   r     1 OCMSG_UNIMP
    36-0-0/d STRC(2088)  r     1 OPEN_CSCG                160-0-0/d STRC(2088)  r     1 OPEN_ISCG
   626-0-0/d STRC(144)   r     1 PRIVZAP                  346-0-0/d STRC(504)   r     1 READ_ISCG
   604-0-0/d STRC(648)   r     1 REL_PSN                  652-0-0/d STRC(432)   r     1 SEND_PCMP
    30-0-0/d STRC(216)   r     1 SLEEP                     22-0-0/d STRC(216)   r     1 SLEEP1
   666-0-0/w STRC(288)   r     1 SLUGNAME                 404-0-0/d STRC(576)   r     1 START_DEV
   424-0-0/d STRC(576)   r     1 STOP_DEV                 444-0-0/d STRC(432)   r     1 WRITE_ZAPRESP
    10-0-0/d STRC(216)   r     1 XCONSET                    3-0-0/c STRC(180)   r     1 ZAPRESP

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    16-0-0/w UBIN        r     1 ARS                       25-0-0/w UBIN        r     1 BANGDISP
    17-0-0/w PTR         r     1 BUF$                      30-0-0/w PTR         r     1 CGAURD$
    27-0-0/w PTR         r     1 CITE$                     23-0-0/w PTR         r     1 CONINFO$
    10-0-0/w PTR         r     1 DEV$                      13-0-0/w UBIN        r     1 I
    22-0-0/w UBIN        r     1 II                        14-0-0/w UBIN        r     1 INFO
    21-0-0/w UBIN        r     1 JJ                        11-0-0/w PTR         r     1 KEYIN$
    12-0-0/w UBIN        r     1 NDEV                       6-0-0/c STRC(54)    r     1 OPENFORM
    20-0-0/w PTR         r     1 P$                        26-0-0/w PTR         r     1 SAVDEV$
     4-0-0/d STRC(72)    r     1 TVEC                      15-0-0/w UBIN        r     1 WRITOUT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/w STRC(1260)  r     1 FI_APLCGBUF                0-0-0/d CHAR(140)   r     1 FI_CSCGBUF
     0-0-0/w PTR         r     1 FI_DEVHD$                  0-0-0/w STRC(288)   r     1 FI_DEVSCB
     0-0-0/d STRC(2826)  r     1 FI_DEV_INIT                0-0-0/w PTR         r     1 FI_EVHD$
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:202  
     0-0-0/w PTR         r     1 FI_EVNT$                   0-0-0/w STRC(216)   r     1 FI_EVQ(0:0)
     0-0-0/w PTR         r     1 FI_EVTL$                   0-0-0/w PTR         r     1 FI_FEVHD$
     0-0-0/w PTR         r     1 FI_FEVTL$                  0-0-0/d CHAR(1024)  r     1 FI_ISCGBUF
     0-0-0/c STRC(72)    r     1 FI_SYSACCT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(1440)  r     1 B$CGAURD
     0-0-0/c CHAR        r     1 B$CHAR                     0-0-0/w CHAR(5)     r     1 B$CHAR5
     0-0-0/w CHAR(6)     r     1 B$CHAR6                    0-0-0/c CHAR(8)     r     1 B$CHAR8
     0-0-0/c ACHR        r     1 B$CHARS                    0-0-0/c ACHR        r     1 B$CHARSII
     0-0-0/d STRC(5760)  r     1 B$JIT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(972)   r     1 FI$CONINFO
     0-0-0/d STRC(2826)  r     1 FI$DEV                     0-0-0/d STRC(594)   r     1 FI$DKEYIN
     0-0-0/w STRC(90)    r     1 FI$DSMT                    0-0-0/w STRC(216)   r     1 FI$EVNT
     0-0-0/w STRC(252)   r     1 FI$ISRD                    0-0-0/w STRC(288)   r     1 FS$JOBORIG
     0-0-0N  NULL        r     1 M$APLCG                    0-0-0N  NULL        r     1 M$CSCG
     0-0-0N  NULL        r     1 M$ISCG


   Procedure FII$INSYM requires 1743 words for executable code.
   Procedure FII$INSYM requires 40 words of local(AUTO) storage.

    No errors detected in file FII$INSYM.:E05TSI    .
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:203  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:204  
          MINI XREF LISTING

A1 IN PROCEDURE FLUSHIT
      7472**LABEL    7473--CALLALT
A10 IN PROCEDURE EXT_EVENT
      6673**LABEL    6670--CALLALT
A11 IN PROCEDURE EXT_EVENT
      6702**LABEL    6703--CALLALT
A2 IN PROCEDURE ADD_DEV
      7574**LABEL    7553--CALLALT
A9 IN PROCEDURE ADD_DEV
      7547**LABEL    7547--CALLALT
ADD_DEV
      7546**PROC     6670--CALL
ARS
      4466**DCL      7215<<ASSIGN   7232>>IF       7232>>IF       7246>>IF       7246>>IF       7268>>IF
      7268>>IF       7272>>IF       7274>>ASSIGN   7376>>IF       7376>>IF       7383>>IF       7383>>IF
      7394>>IF       7394>>IF       7413>>IF       7413>>IF       7484>>IF       7486>>ASSIGN
B$ALT.CODE
      4055**DCL      4055--REDEF    4056--REDEF    4056--REDEF
B$ALT.ERR.CODE
      4057**DCL      6869>>ASSIGN   7352>>ASSIGN   7502>>ASSIGN   7522>>ASSIGN
B$ALT.ERR.ERR#
      4057**DCL      4057--REDEF
B$ALT.EVID
      4056**DCL      4056--REDEF    4056--REDEF
B$CGAURD.CONINFO.ATTR
      4291**DCL      4291--REDEF
B$CGAURD.EVENT
      4269**DCL      6661>>DOCASE
B$CGAURD.FIINFO
      4311**DCL      6669--ASSIGN
B$CGAURD.FIINFO.DFLTPRI
      4323**DCL      4324--REDEF
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:205  
B$CGAURD.INFO
      4270**DCL      6656>>ASSIGN
B$CGAURD.STATION
      4269**DCL      4269--REDEF    6657>>ASSIGN
B$CHAR
      4064**DCL      7300<<ASSIGN   7752>>IF       7755>>IF
B$CHAR5
      4061**DCL      7232>>IF       7376>>IF       7394>>IF       7413>>IF
B$CHAR6
      4063**DCL      7246>>IF       7268>>IF       7383>>IF
B$CHAR8
      4065**DCL      7301<<ASSIGN
B$CHARS
      4062**DCL      6891--ASSIGN   6904>>ASSIGN   7275>>IF       7276--ASSIGN
B$CHARSII
      4066**DCL      7724>>ASSIGN
B$JIT.ACCN
      3890**DCL      7303<<ASSIGN   7313<<ASSIGN   7334<<ASSIGN   7345<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      3984**DCL      3984--REDEF
B$JIT.ERR.MID
      3891**DCL      3891--REDEF
B$JIT.OUTPRIO
      3971**DCL      7316<<ASSIGN
B$JIT.SYSID
      3890**DCL      7312<<ASSIGN
B$JIT.UNAME
      3890**DCL      7314<<ASSIGN
B$JIT.USER
      3890**DCL      6533>>IF
B$JIT.USERWORD
      3978**DCL      6736>>IF       7063<<ASSIGN   7063>>ASSIGN   7064>>IF
B$JIT.WOO
      3890**DCL      7315<<ASSIGN
B$JIT$
      4785**DCL      6533>>IF       6736>>IF       7063>>ASSIGN   7063>>ASSIGN   7064>>IF       7303>>ASSIGN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:206  
      7334>>ASSIGN   7345>>ASSIGN
B$TCB.ALT$
      4051**DCL      6869>>ASSIGN   7352>>ASSIGN   7502>>ASSIGN   7522>>ASSIGN
B$TCB$
      4786**DCL      6869>>ASSIGN   7352>>ASSIGN   7502>>ASSIGN   7522>>ASSIGN
BADCLS IN PROCEDURE CLSSV
      7518**LABEL    7513--CALLALT
BADWRT IN PROCEDURE WRITE_REC
      7496**LABEL    7497--CALLALT
BANGDISP
      4473**DCL      7228<<ASSIGN   7264<<ASSIGN   7268>>IF       7268>>IF       7272>>IF       7274>>ASSIGN
      7275>>IF       7276>>ASSIGN
BUF$
      4467**DCL      7216<<ASSIGN   7232>>IF       7246>>IF       7268>>IF       7275>>IF       7276>>ASSIGN
      7376>>IF       7383>>IF       7394>>IF       7413>>IF       7487>>ASSIGN
CGAURD$
      4476**DCL      6655<<ASSIGN   6656>>ASSIGN   6657>>ASSIGN   6661>>DOCASE   6669>>ASSIGN
CHK_FORM
      7716**PROC     6903--CALL     7318--CALL
CHK_NAME
      7690**PROC     6901--CALL     7284--CALL
CITE$
      4475**DCL      6639<<ASSIGN   6800>>ASSIGN   7001>>ASSIGN   7024>>IF       7037>>ASSIGN   7215>>ASSIGN
      7216>>ASSIGN   7221>>IF       7264>>IF       7409>>IF       7411>>IF       7413>>IF       7431>>IF
      7437>>IF       7453>>ASSIGN   7496>>ASSIGN
CLOSE_DCB IN PROCEDURE ISRD
      7424**LABEL    7396--GOTO
CLOSE_REL
      6113**DCL      6703<>CALL     7473<>CALL
CLOSE_REL.SN_
      6113**DCL      6113--REDEF
CLOSE_REL.UTL_
      6114**DCL      6114--REDEF
CLOSE_REL.V
      6118**DCL      6113--DCLINIT
CLOSE_REL.V.DCB#
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:207  
      6119**DCL      6702<<ASSIGN   7472<<ASSIGN
CLOSE_REL.V.EXPIRE#
      6128**DCL      6128--REDEF
CLOSE_REL.V.TYPE#
      6126**DCL      6126--REDEF
CLOSE_REL.V.XTNSIZE#
      6123**DCL      6123--REDEF    6125--REDEF
CLOSE_SAV
      6158**DCL      7513<>CALL
CLOSE_SAV.SN_
      6158**DCL      6158--REDEF
CLOSE_SAV.UTL_
      6159**DCL      6159--REDEF
CLOSE_SAV.V
      6163**DCL      6158--DCLINIT
CLOSE_SAV.V.DCB#
      6164**DCL      7512<<ASSIGN
CLOSE_SAV.V.EXPIRE#
      6173**DCL      6173--REDEF
CLOSE_SAV.V.TYPE#
      6171**DCL      6171--REDEF
CLOSE_SAV.V.XTNSIZE#
      6168**DCL      6168--REDEF    6170--REDEF
CLSSV
      7509**PROC     7379--CALL     7386--CALL     7424--CALL
CONINFO$
      4471**DCL      6669<<ASSIGN   7556>>ASSIGN   7557>>ASSIGN   7558>>ASSIGN   7559>>ASSIGN   7560>>ASSIGN
      7561>>IF       7562>>ASSIGN   7566>>ASSIGN   7567>>ASSIGN   7568>>ASSIGN
CSCGNAME
      5389**DCL      4994--DCLINIT
CTLNCTL IN PROCEDURE ISRD
      7250**LABEL    7388--GOTO
CTL_ISCG
      5350**DCL      6545<>CALL     6765<>CALL
CTL_ISCG.V
      5355**DCL      5350--DCLINIT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:208  
DCBNUMBER
      4492**DCL      5846--DCLINIT
DCBNUMBER.DCB#
      4493**DCL      6697<<ASSIGN   6707<<ASSIGN   6715>>IF       7006<<ASSIGN   7046<<ASSIGN   7148>>ASSIGN
      7171>>ASSIGN
DEV$
      4460**DCL      6638<<ASSIGN   6698>>IF       6700>>IF       6702>>ASSIGN   6707>>ASSIGN   6732>>IF
      6738>>ASSIGN   6823<<ASSIGN   6824>>DOWHILE  6826>>IF       6826>>IF       6829>>IF       6829>>IF
      6835>>ASSIGN   6836>>ASSIGN   6837>>ASSIGN   6838>>ASSIGN   6839>>ASSIGN   6840>>ASSIGN   6841>>ASSIGN
      6842>>ASSIGN   6842>>ASSIGN   6843>>ASSIGN   6846<<ASSIGN   6846>>ASSIGN   6880>>IF       6880>>IF
      6904>>ASSIGN   6907>>ASSIGN   6907>>ASSIGN   6914>>ASSIGN   6940>>IF       6955<<ASSIGN   6956>>DOWHILE
      6957>>IF       6959>>ASSIGN   6965<<ASSIGN   6965>>ASSIGN   7006>>ASSIGN   7007>>ASSIGN   7020<<ASSIGN
      7021>>DOWHILE  7022>>IF       7023>>IF       7024>>IF       7027>>ASSIGN   7032>>ASSIGN   7034<<ASSIGN
      7034>>ASSIGN   7041<<ASSIGN   7042>>DOWHILE  7043>>IF       7045>>ASSIGN   7046>>ASSIGN   7047>>ASSIGN
      7048>>ASSIGN   7050<<ASSIGN   7052<<ASSIGN   7052>>ASSIGN   7067<<ASSIGN   7068>>DOWHILE  7069>>IF
      7071>>ASSIGN   7072>>ASSIGN   7075<<ASSIGN   7075>>ASSIGN   7148>>ASSIGN   7149>>ASSIGN   7150>>ASSIGN
      7151>>ASSIGN   7157>>ASSIGN   7162<<ASSIGN   7163>>DOWHILE  7164>>IF       7169<<ASSIGN   7169>>ASSIGN
      7213>>IF       7223>>IF       7226>>IF       7226>>IF       7229>>IF       7236>>ASSIGN   7237>>ASSIGN
      7243>>ASSIGN   7250>>ASSIGN   7251>>ASSIGN   7252>>IF       7257>>IF       7266>>ASSIGN   7267>>ASSIGN
      7297>>ASSIGN   7298>>ASSIGN   7302>>ASSIGN   7303>>ASSIGN   7309>>ASSIGN   7313>>ASSIGN   7314>>ASSIGN
      7315>>ASSIGN   7316>>ASSIGN   7321>>ASSIGN   7322>>ASSIGN   7324>>ASSIGN   7324>>ASSIGN   7328>>ASSIGN
      7329>>ASSIGN   7330>>ASSIGN   7331>>ASSIGN   7332>>ASSIGN   7336>>IF       7338>>ASSIGN   7339>>ASSIGN
      7341>>ASSIGN   7363>>ASSIGN   7363>>ASSIGN   7374>>IF       7380>>ASSIGN   7387>>ASSIGN   7398>>IF
      7428>>ASSIGN   7465>>IF       7467>>ASSIGN   7469>>ASSIGN   7470>>IF       7472>>ASSIGN   7495>>ASSIGN
      7500>>IF       7510>>IF       7512>>ASSIGN   7515>>ASSIGN   7553<>CALL     7554>>ASSIGN   7555>>ASSIGN
      7556>>ASSIGN   7557>>ASSIGN   7558>>ASSIGN   7559>>ASSIGN   7560>>ASSIGN   7562>>ASSIGN   7563>>ASSIGN
      7564>>ASSIGN   7564>>ASSIGN   7565>>ASSIGN   7566>>ASSIGN   7567>>ASSIGN   7568>>ASSIGN   7569>>ASSIGN
      7571>>IF       7574>>ASSIGN   7598<<ASSIGN   7599>>DOWHILE  7600>>IF       7601<<ASSIGN   7601>>ASSIGN
      7615>>IF       7617>>ASSIGN   7622>>IF       7624>>ASSIGN   7626<>CALL     7645>>ASSIGN
DEVDEST
      4504**DCL      4515--REDEF
DEVDEST.FORM
      4509**DCL      4510--REDEF    7718<<ASSIGN
DEVDEST.FORMR.C
      4513**DCL      7727<<ASSIGN
DEVDEST.FORMR.NAME
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:209  
      4512**DCL      7728<<ASSIGN
DEVDEST.FORMR.O
      4511**DCL      7726<<ASSIGN
DEVDEST.RES
      4506**DCL      7319<<ASSIGN
DEVDEST.WSN
      4508**DCL      7320<<ASSIGN
DEVDESTR
      4515**DCL      7321>>ASSIGN
DEVNAME
      4485**DCL      4486--REDEF    5496--DCLINIT  5522--DCLINIT  5548--DCLINIT  6369--DCLINIT  6657<<ASSIGN
      6711>>ASSIGN   6802<<ASSIGN   6811<<ASSIGN   6868>>ASSIGN   6913>>ASSIGN   6959<<ASSIGN   7001<<ASSIGN
      7027<<ASSIGN   7072<<ASSIGN   7327>>ASSIGN   7466>>ASSIGN   7516>>ASSIGN   7551>>ASSIGN   7555>>ASSIGN
      7600>>IF
DEVNAMER.NUM
      4488**DCL      6829>>IF
DEVNAMER.TYP
      4487**DCL      6829>>IF       6829>>IF       6860>>IF
DISCT_DEV
      5496**DCL      6728<>CALL     6962<>CALL     7581<>CALL
DISCT_DEV.V
      5497**DCL      5496--DCLINIT
DISCT_DEV.V.DVBYTE.REREAD#
      5499**DCL      5499--REDEF
DOFID IN PROCEDURE CHK_FORM
      7736**ENTRY    6893--CALL     7280--CALL
DONE IN PROCEDURE REM_DEV
      7624**LABEL    7618--GOTO
DSCGO_DEV
      6369**DCL      6688<>CALL
DSCGO_DEV.V
      6370**DCL      6369--DCLINIT
DSCGO_DEV.V.DVBYTE.REREAD#
      6372**DCL      6372--REDEF
DSMT0 IN PROCEDURE EXT_EVENT
      7028**LABEL    7030--CALLALT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:210  
DSMT1 IN PROCEDURE EXT_EVENT
      7037**LABEL    7038--CALLALT
ENDEVENT IN PROCEDURE EXT_EVENT
      7142**LABEL    6671--GOTO     6688--CALLALT  6696--CALLALT  6728--CALLALT  6729--GOTO     6739--GOTO
      6745--GOTO     6916--GOTO     7002--CALLALT  7004--GOTO
EODCARD
      4703**DCL      7493--ASSIGN
EODERR IN PROCEDURE ISRD
      7434**LABEL    7411--GOTO
EVENTSET
      4863**DCL      6540<>CALL
EVENTSET.V
      4863**DCL      4863--DCLINIT
EXTEND_ISCG
      5405**DCL      6762<>CALL
EXTEND_ISCG.V
      5405**DCL      5405--DCLINIT
EXT_EVENT
      6634**PROC     6585--CALL
F$DCB.ACCT
      3726**DCL      7645--ASSIGN
F$DCB.ACTPOS
      3741**DCL      3741--REDEF
F$DCB.ARS
      3716**DCL      3716--REDEF
F$DCB.ATTR
      3734**DCL      3735--REDEF
F$DCB.BORROW
      3749**DCL      3749--REDEF    3749--REDEF    3749--REDEF
F$DCB.DCBNAME.L
      3763**DCL      3763--IMP-SIZ
F$DCB.EOMCHAR
      3720**DCL      3720--REDEF
F$DCB.FCD
      3729**DCL      6700>>IF       7023>>IF       7470>>IF       7500>>IF       7510>>IF
F$DCB.FLDID
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:211  
      3744**DCL      3744--REDEF
F$DCB.FORM$
      3738**DCL      3738--REDEF
F$DCB.FSECT
      3754**DCL      3754--REDEF
F$DCB.FSN
      3731**DCL      3731--REDEF    3731--REDEF    3732--REDEF
F$DCB.HEADER$
      3737**DCL      3737--REDEF
F$DCB.IXTNSIZE
      3735**DCL      3735--REDEF
F$DCB.LASTSTA$
      3725**DCL      3725--REDEF
F$DCB.LVL
      3750**DCL      3750--REDEF
F$DCB.NAME.C
      3725**DCL      3725--REDEF    7338>>ASSIGN
F$DCB.NOEOF
      3746**DCL      3746--REDEF
F$DCB.NRECS
      3736**DCL      3736--REDEF
F$DCB.NRECX
      3755**DCL      3755--REDEF
F$DCB.OHDR
      3747**DCL      3747--REDEF
F$DCB.ORG
      3730**DCL      3730--REDEF
F$DCB.PRECNO
      3753**DCL      3753--REDEF
F$DCB.RCSZ
      3758**DCL      3758--REDEF
F$DCB.RES
      3726**DCL      3726--REDEF
F$DCB.SETX
      3738**DCL      3738--REDEF    7024>>IF
F$DCB.TAB$
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:212  
      3737**DCL      3738--REDEF
F$DCB.TDA
      3752**DCL      3752--REDEF
F$DCB.WSN
      3727**DCL      3727--REDEF
FI$CONINFO.DFLTPRI
      4238**DCL      4239--REDEF
FI$CONINFO.DFPRI
      4239**DCL      7558>>ASSIGN
FI$CONINFO.MXPRI
      4240**DCL      7559>>ASSIGN
FI$CONINFO.NCACCT
      4242**DCL      7560>>ASSIGN
FI$CONINFO.NCTL
      4229**DCL      7556>>ASSIGN
FI$CONINFO.NCTLFID
      4233**DCL      7561>>IF
FI$CONINFO.NCTLOK
      4231**DCL      7557>>ASSIGN
FI$CONINFO.NFID
      4245**DCL      7562>>ASSIGN
FI$CONINFO.TNAME
      4248**DCL      7567>>ASSIGN
FI$CONINFO.WSN
      4250**DCL      7566>>ASSIGN   7568>>ASSIGN
FI$DEV
      4115**DCL      7554<<ASSIGN
FI$DEV.ACCT
      4136**DCL      7297>>ASSIGN   7303>>ASSIGN   7313>>ASSIGN   7560<<ASSIGN
FI$DEV.CFID
      4139**DCL      6904<<ASSIGN   6907>>ASSIGN   6914>>ASSIGN   7267--ASSIGN   7324<<ASSIGN   7363<<ASSIGN
      7564<<ASSIGN
FI$DEV.CTLDEV
      4126**DCL      6840>>ASSIGN   6842>>ASSIGN   6880>>IF       7229>>IF       7556<<ASSIGN   7571>>IF
FI$DEV.DCB#
      4125**DCL      6700--IF       6702>>ASSIGN   6707>>ASSIGN   7006>>ASSIGN   7007<<ASSIGN   7023--IF
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:213  
      7024--IF       7046>>ASSIGN   7047<<ASSIGN   7148<<ASSIGN   7332>>ASSIGN   7338--ASSIGN   7470--IF
      7472>>ASSIGN   7495>>ASSIGN   7500--IF       7510--IF       7512>>ASSIGN   7645--ASSIGN
FI$DEV.DEST
      4142**DCL      4143--REDEF    6841>>ASSIGN   7302<<ASSIGN   7321<<ASSIGN   7339<<ASSIGN   7467>>ASSIGN
      7515>>ASSIGN
FI$DEV.DESTCODE
      4135**DCL      7243<<ASSIGN   7298<<ASSIGN   7322<<ASSIGN   7336>>IF
FI$DEV.DFID
      4138**DCL      6843>>ASSIGN   6907<<ASSIGN   7324>>ASSIGN   7363>>ASSIGN   7562<<ASSIGN   7563<<ASSIGN
      7564>>ASSIGN   7574>>ASSIGN
FI$DEV.DFPRI
      4123**DCL      7316>>ASSIGN   7331>>ASSIGN   7558<<ASSIGN
FI$DEV.FLG
      4128**DCL      7150<<ASSIGN
FI$DEV.FLG.FIRSTRD
      4133**DCL      6837>>ASSIGN   7151<<ASSIGN   7223>>IF       7341<<ASSIGN   7380<<ASSIGN   7387<<ASSIGN
FI$DEV.FLG.FLUSHING
      4131**DCL      6838>>ASSIGN   7226>>IF       7237<<ASSIGN   7251<<ASSIGN   7257>>IF       7398>>IF
      7465>>IF       7469<<ASSIGN
FI$DEV.FLG.NCTLDECK
      4132**DCL      6839>>ASSIGN   7226>>IF       7236<<ASSIGN   7250<<ASSIGN   7266<<ASSIGN   7374>>IF
FI$DEV.FLG.READY
      4130**DCL      6738<<ASSIGN   7069>>IF       7071<<ASSIGN
FI$DEV.LNK$
      4116**DCL      6846>>ASSIGN   6965>>ASSIGN   7034>>ASSIGN   7048>>ASSIGN   7052>>ASSIGN   7075>>ASSIGN
      7169>>ASSIGN   7565<<ASSIGN   7601>>ASSIGN   7617>>ASSIGN   7622>>IF       7624<<ASSIGN   7624>>ASSIGN
      7629>>ASSIGN
FI$DEV.MXPRI
      4122**DCL      7330>>ASSIGN   7559<<ASSIGN
FI$DEV.NAME
      4117**DCL      4118--REDEF    6835>>ASSIGN   6959>>ASSIGN   7027>>ASSIGN   7072>>ASSIGN   7314>>ASSIGN
      7555<<ASSIGN   7600>>IF
FI$DEV.NAMER.NUM
      4120**DCL      6829>>IF
FI$DEV.NAMER.TYP
      4119**DCL      6829>>IF
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:214  
FI$DEV.NCTLOK
      4127**DCL      6842>>ASSIGN   6880>>IF       7252>>IF       7557<<ASSIGN
FI$DEV.NCTLWSN
      4137**DCL      7309>>ASSIGN   7568<<ASSIGN
FI$DEV.STATE
      4124**DCL      6698>>IF       6732>>IF       6836>>ASSIGN   6940>>IF       6957>>IF       7022>>IF
      7032<<ASSIGN   7043>>IF       7045<<ASSIGN   7149<<ASSIGN   7157<<ASSIGN   7164>>IF       7213>>IF
      7428<<ASSIGN
FI$DEV.TNAME
      4141**DCL      6826>>IF       6826>>IF       7328>>ASSIGN   7567<<ASSIGN
FI$DEV.WSN
      4140**DCL      7315>>ASSIGN   7329>>ASSIGN   7566<<ASSIGN
FI$DKEYIN.CADDR
      4088**DCL      6801>>ASSIGN   6819>>ASSIGN   6975>>ASSIGN
FI$DKEYIN.FID.C
      4100**DCL      6891--ASSIGN   6904--ASSIGN
FI$DKEYIN.FID.L
      4099**DCL      6885>>ASSIGN
FI$DKEYIN.KIN#
      4087**DCL      6804>>DOCASE   6853>>IF
FI$DKEYIN.NAME
      4089**DCL      4090--REDEF    6802>>ASSIGN   6811>>ASSIGN
FI$DKEYIN.ONCE
      4094**DCL      6905>>IF
FI$DKEYIN.TERM
      4095**DCL      4098--REDEF
FI$DKEYIN.TERM.TNAME
      4096**DCL      6812>>ASSIGN   6826>>IF       6826>>IF       6858>>ASSIGN
FI$DSMT.PSN
      4406**DCL      7037>>ASSIGN
FI$DSMT.SETX
      4408**DCL      7024>>IF
FI$EVNT
      4159**DCL      7670--ASSIGN
FI$EVNT.CITE$
      4163**DCL      6639>>ASSIGN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:215  
FI$EVNT.CODE
      4161**DCL      6640>>DOCASE
FI$EVNT.ENDAC
      4162**DCL      6586>>DOCASE
FI$EVNT.LNK$
      4160**DCL      6583>>ASSIGN   6596<<ASSIGN   6598<<ASSIGN   7670<<ASSIGN   7671>>ASSIGN
FI$ISRD.ARS
      4367**DCL      7215>>ASSIGN   7413>>IF
FI$ISRD.BUF$
      4378**DCL      7216>>ASSIGN
FI$ISRD.DVBYTE
      4371**DCL      7264>>IF       7496>>ASSIGN
FI$ISRD.ERRCODE
      4374**DCL      7221>>IF       7409>>IF       7431>>IF       7437>>IF       7453>>ASSIGN
FI$ISRD.NAME
      4376**DCL      7001>>ASSIGN
FI$ISRD.TYC
      4369**DCL      7411>>IF
FIA$APLAU
      4818**DCL-ENT  7102--CALL
FIA$APLRD
      4819**DCL-ENT  7091--CALL
FIA$INIT
      4820**DCL-ENT  6551--CALL
FIA$ZAP
      4821**DCL-ENT  6954--CALL
FIDACCT
      4491**DCL      6026--DCLINIT  7294--ASSIGN   7297<<ASSIGN   7301>>ASSIGN
FIDALT IN PROCEDURE CHK_FORM
      7743**LABEL    7742--CALLALT
FIDALT IN PROCEDURE ISRD
      7350**LABEL    7280--CALLALT
FIDALT0 IN PROCEDURE ISRD
      7352**LABEL    7348--GOTO
FIDALT1 IN PROCEDURE ISRD
      7361**LABEL    7308--GOTO
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:216  
FIDIT
      6025**DCL      7742<>CALL
FIDIT.TEXTFID_
      6025**DCL      6891<<ASSIGN   7267<<ASSIGN   7276<<ASSIGN   7740<<ASSIGN   7743<<ASSIGN   7746<<ASSIGN
      7750>>ASSIGN
FIDIT.V
      6029**DCL      6025--DCLINIT
FIDNAME
      6006**DCL      6026--DCLINIT  7293--ASSIGN
FIDNAME.L#
      6006**DCL      7285>>IF       7285>>IF       7285>>IF       7289>>CALLBLT  7291<<ASSIGN   7291>>ASSIGN
      7300>>ASSIGN   7301>>ASSIGN   7691>>IF       7693>>IF
FIDNAME.NAME#
      6006**DCL      7285>>IF       7289<<CALLBLT  7299>>ASSIGN   7694>>IF
FIDWSN
      4490**DCL      6027--DCLINIT  6892<<ASSIGN   7279<<ASSIGN   7309>>IF       7309<<ASSIGN   7310--ASSIGN
      7320>>ASSIGN
FIE$EVNT
      4822**DCL-ENT  4863--DCLINIT
FIE$XCON
      4823**DCL-ENT  4848--DCLINIT
FILDEST
      4500**DCL      4503--REDEF
FILDEST.FILE
      4502**DCL      7299<<ASSIGN   7300--ASSIGN   7301--ASSIGN
FILDESTR
      4503**DCL      7302>>ASSIGN
FINDIT IN PROCEDURE CHK_FORM
      7749**PROC     7720--CALL     7737--CALL
FIND_DEV
      7596**PROC     6687--CALL     6696--CALL     6723--CALL     6879--CALL     6939--CALL     7002--CALL
      7547--CALL
FIND_PSN
      6191**DCL      7646<>CALL
FIND_PSN.ACCT_
      6191**DCL      7645<<ASSIGN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:217  
FIND_PSN.V
      6192**DCL      6191--DCLINIT
FI_APLCGBUF
      4800**DCL      6289--DCLINIT  6290--DCLINIT
FI_APLCGBUF.INAME
      4803**DCL      4804--REDEF
FI_APLCGBUF.PARTNER1
      4807**DCL      4808--REDEF
FI_APLCGBUF.PARTNER2
      4811**DCL      4812--REDEF
FI_CSCGBUF
      3087**DCL      3088--REDEF    6333--DCLINIT  6334--DCLINIT
FI_DEVHD$
      3128**DCL      6823>>ASSIGN   6955>>ASSIGN   7020>>ASSIGN   7041>>ASSIGN   7067>>ASSIGN   7162>>ASSIGN
      7565>>ASSIGN   7569<<ASSIGN   7598>>ASSIGN   7615>>IF       7617<<ASSIGN   7620>>ASSIGN
FI_DEVSCB
      3107**DCL      7553<>CALL     7626<>CALL
FI_DEV_INIT
      3144**DCL      7554>>ASSIGN
FI_DEV_INIT.DEST
      3171**DCL      3172--REDEF
FI_DEV_INIT.NAME
      3146**DCL      3147--REDEF
FI_EVHD$
      3124**DCL      6578>>IF       6582>>ASSIGN   6583<<ASSIGN   6584>>IF
FI_EVNT$
      3129**DCL      6582<<ASSIGN   6583>>ASSIGN   6586>>DOCASE   6595>>ASSIGN   6596>>ASSIGN   6597>>ASSIGN
      6598>>ASSIGN   6639>>ASSIGN   6640>>DOCASE   7668<<ASSIGN   7670>>ASSIGN   7670>>ASSIGN   7671<<ASSIGN
      7671>>ASSIGN
FI_EVQ
      3279**DCL      7668--ASSIGN
FI_EVTL$
      3125**DCL      6584<<ASSIGN
FI_FEVHD$
      3126**DCL      6595<<ASSIGN
FI_FEVTL$
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:218  
      3127**DCL      6595>>IF       6596>>ASSIGN   6597<<ASSIGN
FI_ISCGBUF
      3092**DCL      5461--DCLINIT  5462--DCLINIT  6655--ASSIGN
FI_SYSACCT
      3341**DCL      4998--DCLINIT  5186--DCLINIT
FLUSH IN PROCEDURE ISRD
      7365**LABEL    7254--GOTO     7259--GOTO     7342--CALLALT  7399--CALLALT  7434--CALLALT
FLUSH0 IN PROCEDURE ISRD
      7363**LABEL    7353--GOTO     7356--GOTO     7359--GOTO
FLUSHIT
      7464**PROC     6946--CALL     6961--CALL     7029--CALL     7365--CALL     7420--CALL     7454--CALL
      7523--CALL
FOI$GBUF
      4824**DCL-ENT  7553--CALL
FOI$LDTRC
      4825**DCL-ENT  7123--CALL
FOI$RBUF
      4826**DCL-ENT  7626--CALL
FOI$SNAP
      4827**DCL-ENT  6673--CALL     6749--CALL     6774--CALL     7440--CALL
FORMALT IN PROCEDURE ISRD
      7355**LABEL    7318--CALLALT
FS$JOBORIG
      4068**DCL      7676--ASSIGN
FS$JOBORIG.ORIGINATOR_PORT.FROM_CR
      4068**DCL      4068--REDEF    4069--REDEF
GET_DCB
      5845**DCL      7146<>CALL
GET_DCB.V
      5846**DCL      5845--DCLINIT
GET_UTS
      4913**DCL      7288<>CALL
GET_UTS.V
      4917**DCL      4913--DCLINIT
GIVEDCB IN PROCEDURE EXT_EVENT
      7161**PROC     7009--CALL     7049--CALL
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:219  
GOODNGT
      4484**DCL      6592>>IF       6968<<ASSIGN   7090>>IF       7101>>IF
GOTDCB IN PROCEDURE STARTIT
      7147**ENTRY    7166--CALL
I
      4463**DCL      4062--IMP-SIZ  6885<<ASSIGN   6886>>IF       6891>>ASSIGN   6904>>ASSIGN   7274<<ASSIGN
      7275>>IF       7276>>ASSIGN   7669<<DOINDEX
IGNORE_MADMUCK_ALTRET IN PROCEDURE REL_RES
      7648**LABEL    7646--CALLALT
IGNORE_RELRES_ALTRET IN PROCEDURE REL_RES
      7654**LABEL    7650--CALLALT
IGNORE_RUNAWAY_CR IN PROCEDURE ISRD
      7428**LABEL    7426--CALLALT
II
      4470**DCL      4066--IMP-SIZ  7721<<ASSIGN   7721>>ASSIGN   7722>>IF       7722>>IF       7723<<ASSIGN
      7723>>ASSIGN   7724>>ASSIGN   7738<<ASSIGN   7741>>ASSIGN   7754<<DOINDEX  7755>>IF       7757<<ASSIGN
INFO
      4464**DCL      6656<<ASSIGN   6725>>IF       6732>>IF       6732>>IF
INSYMNAME
      5052**DCL      5182--DCLINIT
INSYMNAME.MYSTATION#
      5056**DCL      7123<>CALL
INSYMNAMECS
      5085**DCL      4994--DCLINIT
ISCGCP
      5305**DCL      5351--DCLINIT
ISCGCP.DVBYTE.REREAD#
      5319**DCL      5320--REDEF
ISCGCP.MAXPG#
      5311**DCL      6764<<ASSIGN   6764>>ASSIGN
ISCGNAME
      5435**DCL      5182--DCLINIT
ISCG_ACCESS
      5236**DCL      5183--DCLINIT
ISCG_ACCESS.Q
      5237**DCL      5236--DCLINIT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:220  
ISRD
      7211**PROC     7003--CALL
JC_PCMP
      4717**DCL      6403--DCLINIT  6404--DCLINIT
JJ
      4469**DCL      7721>>ASSIGN   7724>>ASSIGN   7739>>ASSIGN   7751<<DOINDEX  7752>>IF       7754>>DOINDEX
      7757>>ASSIGN   7761<<ASSIGN
JOBDEST
      4495**DCL      4499--REDEF
JOBDEST.SYSID
      4497**DCL      7338<<ASSIGN
JOBDESTR
      4499**DCL      7339>>ASSIGN
KERR IN PROCEDURE EXT_EVENT
      6866**LABEL    6863--GOTO     6883--GOTO     6889--GOTO     6898--GOTO     6920--GOTO     6923--GOTO
      6926--GOTO     6943--GOTO
KERR1 IN PROCEDURE EXT_EVENT
      6860**LABEL    6879--CALLALT  6939--CALLALT
KEYIN$
      4461**DCL      6800<<ASSIGN   6801>>ASSIGN   6802>>ASSIGN   6804>>DOCASE   6811>>ASSIGN   6812>>ASSIGN
      6819>>ASSIGN   6826>>IF       6826>>IF       6853>>IF       6858>>ASSIGN   6885>>ASSIGN   6891>>ASSIGN
      6904>>ASSIGN   6905>>IF       6975>>ASSIGN
KFIDALT IN PROCEDURE EXT_EVENT
      6914**LABEL    6893--CALLALT
KFORMALT IN PROCEDURE EXT_EVENT
      6922**LABEL    6903--CALLALT
KNAMALT IN PROCEDURE EXT_EVENT
      6919**LABEL    6901--CALLALT
M$ACTIVATE
       149**DCL-ENT  7152--CALL
M$CGCTL
       150**DCL-ENT  6545--CALL     6765--CALL
M$CLOSE
       129**DCL-ENT  6703--CALL     7473--CALL     7513--CALL
M$DEACTIVATE
       149**DCL-ENT  6688--CALL     6728--CALL     6962--CALL     7030--CALL     7426--CALL     7581--CALL
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:221  
M$EVENT
       184**DCL-ENT  6540--CALL
M$EXIT
       141**DCL-ENT  6533--CALL
M$EXTEND
       133**DCL-ENT  6762--CALL
M$FID
       192**DCL-ENT  7742--CALL
M$GETDCB
       135**DCL-ENT  7146--CALL
M$MADMUCK
       137**DCL-ENT  7646--CALL
M$OPEN
       129**DCL-ENT  6542--CALL     6544--CALL     7333--CALL
M$READ
       130**DCL-ENT  6547--CALL     6549--CALL     6552--CALL     6588--CALL     6590--CALL     6593--CALL
M$RELDCB
       135**DCL-ENT  7172--CALL
M$RELRES
       136**DCL-ENT  7038--CALL     7650--CALL
M$RPRIV
       188**DCL-ENT  7665--CALL
M$TIME
       196**DCL-ENT  7288--CALL
M$WAIT
       187**DCL-ENT  6579--CALL
M$WRITE
       130**DCL-ENT  6554--CALL     6714--CALL     6844--CALL     6870--CALL     6915--CALL     6967--CALL
      6976--CALL     7468--CALL     7497--CALL     7517--CALL     7575--CALL     7580--CALL
M$XCON
       184**DCL-ENT  6536--CALL
MISC_SETUP
      7662**PROC     6538--CALL
NAMALT IN PROCEDURE ISRD
      7358**LABEL    7284--CALLALT
NCTL IN PROCEDURE ISRD
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:222  
      7266**LABEL    7252--GOTO
NDEV
      4462**DCL      6821<<ASSIGN   6834<<ASSIGN   6834>>ASSIGN   6851>>IF
NEWJOB IN PROCEDURE ISRD
      7236**LABEL    7381--GOTO
NODCB IN PROCEDURE STARTIT
      7151**LABEL    7146--CALLALT
NODEV IN PROCEDURE EXT_EVENT
      6741**LABEL    6687--CALLALT  6723--CALLALT
OCMSG_DINFO
      5614**DCL      6844<>CALL
OCMSG_DINFO.STATION_
      5616**DCL      5616--REDEF
OCMSG_DINFO.V
      5617**DCL      5614--DCLINIT
OCMSG_DINFO.V.DVBYTE.VFC#
      5623**DCL      5623--REDEF
OCMSG_JBFL
      5716**DCL      7468<>CALL
OCMSG_JBFL.STATION_
      5718**DCL      5718--REDEF
OCMSG_JBFL.V
      5719**DCL      5716--DCLINIT
OCMSG_JBFL.V.DVBYTE.VFC#
      5725**DCL      5725--REDEF
OCMSG_JBSB
      5750**DCL      7517<>CALL
OCMSG_JBSB.STATION_
      5752**DCL      5752--REDEF
OCMSG_JBSB.V
      5753**DCL      5750--DCLINIT
OCMSG_JBSB.V.DVBYTE.VFC#
      5759**DCL      5759--REDEF
OCMSG_KERR
      5648**DCL      6870<>CALL
OCMSG_KERR.STATION_
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:223  
      5650**DCL      5650--REDEF
OCMSG_KERR.V
      5651**DCL      5648--DCLINIT
OCMSG_KERR.V.DVBYTE.VFC#
      5657**DCL      5657--REDEF
OCMSG_RESP
      5784**DCL      6915<>CALL
OCMSG_RESP.STATION_
      5786**DCL      5786--REDEF
OCMSG_RESP.V
      5787**DCL      5784--DCLINIT
OCMSG_RESP.V.DVBYTE.VFC#
      5793**DCL      5793--REDEF
OCMSG_TCON
      5682**DCL      6714<>CALL     7575<>CALL     7580<>CALL
OCMSG_TCON.STATION_
      5684**DCL      5684--REDEF
OCMSG_TCON.V
      5685**DCL      5682--DCLINIT
OCMSG_TCON.V.DVBYTE.VFC#
      5691**DCL      5691--REDEF
OCMSG_UNIMP
      5818**DCL      6976<>CALL
OCMSG_UNIMP.STATION_
      5820**DCL      5820--REDEF
OCMSG_UNIMP.V
      5821**DCL      5818--DCLINIT
OCMSG_UNIMP.V.DVBYTE.VFC#
      5827**DCL      5827--REDEF
OPEN IN PROCEDURE ISRD
      7326**LABEL    7244--GOTO
OPENFORM
      4458**DCL      7725--ASSIGN
OPENFORM.FORM#
      4458**DCL      7724<<ASSIGN   7728>>ASSIGN
OPENIT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:224  
      5935**DCL      7333<>CALL
OPENIT.ACCT_
      5939**DCL      7242<<ASSIGN   7294<<ASSIGN
OPENIT.ACSVEH_
      5937**DCL      5938--REDEF
OPENIT.ALTKEYS_
      5943**DCL      5944--REDEF    5944--REDEF
OPENIT.FORM_
      5943**DCL      7719<<ASSIGN   7725<<ASSIGN
OPENIT.HDR_
      5942**DCL      5943--REDEF
OPENIT.NAME_
      5936**DCL      7241<<ASSIGN   7293<<ASSIGN   7311<<ASSIGN
OPENIT.PROCATTR_
      5939**DCL      7296<<ASSIGN   7317<<ASSIGN
OPENIT.TAB_
      5941**DCL      5942--REDEF
OPENIT.UATTR_
      5938**DCL      7281<<ASSIGN   7335<<ASSIGN   7346<<ASSIGN
OPENIT.UHL_
      5935**DCL      5936--REDEF    5936--REDEF
OPENIT.V
      5944**DCL      5935--DCLINIT
OPENIT.V.ASN#
      5954**DCL      6028--DCLINIT  6894>>IF       6894>>IF       6900>>IF       6902>>IF       7238<<ASSIGN
      7282>>IF       7307>>IF
OPENIT.V.DCB#
      5944**DCL      7332<<ASSIGN
OPENIT.V.FSN#
      5975**DCL      5975--REDEF    5975--REDEF
OPENIT.V.RES#
      5959**DCL      6028--DCLINIT  7239<<ASSIGN   7319>>ASSIGN
OPENIT.WSN_
      5941**DCL      5941--REDEF    7240<<ASSIGN   7295<<ASSIGN   7310<<ASSIGN
OPEN_CSCG
      4993**DCL      6542<>CALL
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:225  
OPEN_CSCG.ACSVEH_
      4995**DCL      4996--REDEF
OPEN_CSCG.ALTKEYS_
      5001**DCL      5002--REDEF    5002--REDEF
OPEN_CSCG.HDR_
      5000**DCL      5001--REDEF
OPEN_CSCG.TAB_
      4999**DCL      5000--REDEF
OPEN_CSCG.UHL_
      4993**DCL      4994--REDEF    4994--REDEF
OPEN_CSCG.V
      5002**DCL      4993--DCLINIT
OPEN_CSCG.V.FSN#
      5033**DCL      5033--REDEF    5033--REDEF
OPEN_CSCG.WSN_
      4999**DCL      4999--REDEF
OPEN_ISCG
      5181**DCL      6544<>CALL
OPEN_ISCG.ACSVEH_
      5183**DCL      5184--REDEF
OPEN_ISCG.ALTKEYS_
      5189**DCL      5190--REDEF    5190--REDEF
OPEN_ISCG.HDR_
      5188**DCL      5189--REDEF
OPEN_ISCG.TAB_
      5187**DCL      5188--REDEF
OPEN_ISCG.UHL_
      5181**DCL      5182--REDEF    5182--REDEF
OPEN_ISCG.V
      5190**DCL      5181--DCLINIT
OPEN_ISCG.V.FSN#
      5221**DCL      5221--REDEF    5221--REDEF
OPEN_ISCG.WSN_
      5187**DCL      5187--REDEF
OPMSG_DINFO
      4533**DCL      5615--DCLINIT  5616--DCLINIT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:226  
OPMSG_DINFO.CADDR
      4534**DCL      6819<<ASSIGN
OPMSG_DINFO.CTL
      4559**DCL      6840<<ASSIGN
OPMSG_DINFO.DEST
      4560**DCL      6841<<ASSIGN
OPMSG_DINFO.DEVNM
      4543**DCL      6835<<ASSIGN
OPMSG_DINFO.FIRST
      4556**DCL      6837<<ASSIGN
OPMSG_DINFO.FLAGS
      4540**DCL      4541--REDEF
OPMSG_DINFO.FLUSH
      4557**DCL      6838<<ASSIGN
OPMSG_DINFO.MSGID
      4536**DCL      4537--REDEF
OPMSG_DINFO.NCTL
      4558**DCL      6839<<ASSIGN
OPMSG_DINFO.NFID
      4562**DCL      6843<<ASSIGN
OPMSG_DINFO.PFID
      4561**DCL      6842<<ASSIGN
OPMSG_DINFO.STATE
      4555**DCL      6836<<ASSIGN
OPMSG_DINFO.SUBC
      4563**DCL      6813<<ASSIGN   6817<<ASSIGN
OPMSG_DINFO.TNAME
      4564**DCL      6812<<ASSIGN
OPMSG_JBFL
      4620**DCL      5717--DCLINIT  5718--DCLINIT
OPMSG_JBFL.DEST
      4637**DCL      7467<<ASSIGN
OPMSG_JBFL.DEVNM
      4630**DCL      7466<<ASSIGN
OPMSG_JBFL.ERRC
      4636**DCL      7352<<ASSIGN   7453<<ASSIGN   7502<<ASSIGN   7522<<ASSIGN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:227  
OPMSG_JBFL.FLAGS
      4627**DCL      4628--REDEF
OPMSG_JBFL.MSGID
      4623**DCL      4624--REDEF
OPMSG_JBFL.SUBC
      4635**DCL      6945<<ASSIGN   6960<<ASSIGN   7028<<ASSIGN   7253<<ASSIGN   7258<<ASSIGN   7347<<ASSIGN
      7350<<ASSIGN   7355<<ASSIGN   7358<<ASSIGN   7361<<ASSIGN   7452<<ASSIGN   7501<<ASSIGN   7521<<ASSIGN
OPMSG_JBSB
      4643**DCL      5751--DCLINIT  5752--DCLINIT
OPMSG_JBSB.DEST
      4656**DCL      7515<<ASSIGN
OPMSG_JBSB.DEVNM
      4653**DCL      7516<<ASSIGN
OPMSG_JBSB.FLAGS
      4650**DCL      4651--REDEF
OPMSG_JBSB.MSGID
      4646**DCL      4647--REDEF
OPMSG_KERR
      4570**DCL      5649--DCLINIT  5650--DCLINIT
OPMSG_KERR.CADDR
      4571**DCL      6801<<ASSIGN
OPMSG_KERR.DEVNM
      4580**DCL      6868<<ASSIGN
OPMSG_KERR.ERRC
      4587**DCL      6869<<ASSIGN
OPMSG_KERR.FLAGS
      4577**DCL      4578--REDEF
OPMSG_KERR.MSGID
      4573**DCL      4574--REDEF
OPMSG_KERR.SUBC
      4586**DCL      6862<<ASSIGN   6866<<ASSIGN   6882<<ASSIGN   6888<<ASSIGN   6897<<ASSIGN   6919<<ASSIGN
      6922<<ASSIGN   6925<<ASSIGN   6942<<ASSIGN
OPMSG_KERR.SUBC1
      4588**DCL      6854<<ASSIGN   6857<<ASSIGN
OPMSG_KERR.TNAME
      4589**DCL      6858<<ASSIGN
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:228  
OPMSG_RESP
      4662**DCL      5785--DCLINIT  5786--DCLINIT
OPMSG_RESP.CADDR
      4663**DCL      6912<<ASSIGN
OPMSG_RESP.DEVNM
      4672**DCL      6913<<ASSIGN
OPMSG_RESP.FID
      4679**DCL      6914<<ASSIGN
OPMSG_RESP.FLAGS
      4669**DCL      4670--REDEF
OPMSG_RESP.MSGID
      4665**DCL      4666--REDEF
OPMSG_RESP.SUBC
      4677**DCL      6911<<ASSIGN
OPMSG_RESP.SUBC1
      4678**DCL      6908<<ASSIGN   6910<<ASSIGN
OPMSG_TCON
      4595**DCL      5683--DCLINIT  5684--DCLINIT
OPMSG_TCON.DEVNM
      4605**DCL      6711<<ASSIGN   7551<<ASSIGN
OPMSG_TCON.FLAGS
      4602**DCL      4603--REDEF
OPMSG_TCON.MSGID
      4598**DCL      4599--REDEF
OPMSG_TCON.NFID
      4614**DCL      7574<<ASSIGN
OPMSG_TCON.SUBC
      4611**DCL      6712<<ASSIGN   7552<<ASSIGN   7570<<ASSIGN
OPMSG_TCON.SUBC1
      4612**DCL      6713<<ASSIGN   7572<<ASSIGN   7573<<ASSIGN   7578<<ASSIGN
OPMSG_UNIMP
      4685**DCL      5819--DCLINIT  5820--DCLINIT
OPMSG_UNIMP.CADDR
      4686**DCL      6975<<ASSIGN
OPMSG_UNIMP.FLAGS
      4692**DCL      4693--REDEF
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:229  
OPMSG_UNIMP.MSGID
      4688**DCL      4689--REDEF
OPNALT IN PROCEDURE ISRD
      7345**LABEL    7333--CALLALT
OPNATTR
      4517**DCL      5938--DCLINIT  7335--ASSIGN   7346--ASSIGN
OPNATTR.DEFPRI
      4520**DCL      7331<<ASSIGN
OPNATTR.FLAG
      4520**DCL      7674<<ASSIGN
OPNATTR.MAXPRI
      4520**DCL      7330<<ASSIGN
OPNATTR.ORIGINATOR_MODE
      4520**DCL      7326<<ASSIGN
OPNATTR.ORIGINATOR_PORT.FROM_CR
      4517**DCL      4517--REDEF    4518--REDEF
OPNATTR.ORIGINATOR_PORT.FROM_CR.DEVICE
      4517**DCL      7327<<ASSIGN
OPNATTR.ORIGINATOR_PORT.FROM_CR.TNAME
      4517**DCL      7328<<ASSIGN
OPNATTR.SIZ
      4517**DCL      7676<<ASSIGN
OPNATTR.SYSID
      4519**DCL      7675<<ASSIGN
OPNATTR.WOO
      4519**DCL      7329<<ASSIGN
P$
      4468**DCL      7620<<ASSIGN   7622>>IF       7624>>ASSIGN   7629<<ASSIGN   7629>>ASSIGN
PRIVZAP
      6261**DCL      7665<>CALL
PRIVZAP.V
      6261**DCL      6261--DCLINIT
READ_APLCG
      6287**DCL      6552<>CALL     6593<>CALL
READ_APLCG.STATION_
      6290**DCL      6291--REDEF
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:230  
READ_APLCG.V
      6291**DCL      6287--DCLINIT
READ_APLCG.V.DVBYTE.REREAD#
      6302**DCL      6302--REDEF
READ_APLCG.V.INDX#
      6300**DCL      6300--REDEF
READ_CSCG
      6331**DCL      6547<>CALL     6588<>CALL
READ_CSCG.STATION_
      6334**DCL      6335--REDEF
READ_CSCG.V
      6335**DCL      6331--DCLINIT
READ_CSCG.V.DVBYTE.REREAD#
      6346**DCL      6346--REDEF
READ_CSCG.V.INDX#
      6344**DCL      6344--REDEF
READ_ISCG
      5459**DCL      6549<>CALL     6590<>CALL
READ_ISCG.STATION_
      5462**DCL      5463--REDEF
READ_ISCG.V
      5463**DCL      5459--DCLINIT
READ_ISCG.V.DVBYTE.REREAD#
      5474**DCL      5474--REDEF
READ_ISCG.V.INDX#
      5472**DCL      5472--REDEF
REL_DCB
      5861**DCL      7172<>CALL
REL_DCB.V
      5861**DCL      5861--DCLINIT
REL_DCB.V.DCB#
      5861**DCL      7171<<ASSIGN
REL_PSN
      6224**DCL      7038<>CALL     7650<>CALL
REL_PSN.V
      6226**DCL      6224--DCLINIT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:231  
REL_RES
      7644**PROC     6704--CALL     7474--CALL     7514--CALL
REM_DEV
      7614**PROC     6710--CALL
RTN IN PROCEDURE ADD_DEV
      7578**LABEL    7581--CALLALT
RTN IN PROCEDURE CHK_FORM
      7728**LABEL    7720--CALLALT
RTN IN PROCEDURE STARTIT
      7151**LABEL    7152--CALLALT
SAVDEV$
      4474**DCL      7048<<ASSIGN   7050>>ASSIGN
SEND_PCMP
      6402**DCL      6554<>CALL
SEND_PCMP.STATION_
      6404**DCL      6404--REDEF
SEND_PCMP.V
      6405**DCL      6402--DCLINIT
SEND_PCMP.V.DVBYTE.VFC#
      6411**DCL      6411--REDEF
SLEEP
      4895**DCL      6579<>CALL
SLEEP.V
      4896**DCL      4895--DCLINIT
SLEEP1.V
      4880**DCL      4879--DCLINIT
SLUGNAME
      6430**DCL      6404--DCLINIT
SLUGNAME.MSGIDXT
      6440**DCL      6443--REDEF
STARTIT IN PROCEDURE EXT_EVENT
      7145**PROC     6741--CALL     7073--CALL
START_DEV
      5522**DCL      7152<>CALL
START_DEV.V
      5523**DCL      5522--DCLINIT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:232  
START_DEV.V.DVBYTE.REREAD#
      5525**DCL      5525--REDEF
STOP_CR IN PROCEDURE ISRD
      7426**LABEL    7421--GOTO
STOP_DEV
      5548**DCL      7030<>CALL     7426<>CALL
STOP_DEV.V
      5549**DCL      5548--DCLINIT
STOP_DEV.V.DVBYTE.REREAD#
      5551**DCL      5551--REDEF
SYMBI IN PROCEDURE EXT_EVENT
      6817**LABEL    6814--GOTO
TAKEDCB IN PROCEDURE EXT_EVENT
      7001**LABEL    7003--CALLALT
TAKEDCB1 IN PROCEDURE EXT_EVENT
      7007**LABEL    6715--GOTO
TJIT
      4523**DCL      7312--ASSIGN   7313--ASSIGN   7314--ASSIGN   7315--ASSIGN   7316--ASSIGN   7317--ASSIGN
TVEC
      4443**DCL      7740>>ASSIGN   7743>>ASSIGN   7746>>ASSIGN   7750<<ASSIGN
TVEC.PTR$
      4445**DCL      7724>>ASSIGN   7752>>IF       7755>>IF
TVEC.W1.VSIZE#
      4443**DCL      7738>>ASSIGN   7739<<ASSIGN   7741<<ASSIGN   7751>>DOINDEX  7754>>DOINDEX  7761>>ASSIGN
TVEC.W2
      4444**DCL      4445--REDEF
UTS_NOW
      4477**DCL      4917--DCLINIT  7289>>CALLBLT
VLP_RPSN
      6244**DCL      6225--DCLINIT
VLP_RPSN.NN#
      6244**DCL      7036<<ASSIGN   7648<<ASSIGN
VLP_RPSN.RPLIST.PSN#
      6244**DCL      7037<<ASSIGN   7649<<ASSIGN
VLP_SN
      6209**DCL      6192--DCLINIT
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:233  
VLP_SN.SN#
      6209**DCL      7649>>ASSIGN
VLR_FIDIT
      6049**DCL      6029--DCLINIT
VLR_FIDIT.ACCT
      6049**DCL      7297>>IF
VLR_FIDIT.PASS
      6049**DCL      7691>>IF
VLR_FIDIT.WSN
      6049**DCL      6894>>IF       7307>>IF
WHOCARES IN PROCEDURE MISC_SETUP
      7665**LABEL    7665--CALLALT
WRITE IN PROCEDURE WRITE_REC
      7493**LABEL    7490--GOTO
WRITEIT
      6075**DCL      7497<>CALL
WRITEIT.BUF_
      6075**DCL      7489<<ASSIGN   7493<<ASSIGN
WRITEIT.BUF_.BOUND
      6075**DCL      7486<<ASSIGN
WRITEIT.BUF_.BUF$
      6077**DCL      7487<<ASSIGN
WRITEIT.STATION_
      6077**DCL      6077--REDEF
WRITEIT.V
      6078**DCL      6075--DCLINIT
WRITEIT.V.DCB#
      6078**DCL      7495<<ASSIGN
WRITEIT.V.DVBYTE
      6083**DCL      7496<<ASSIGN
WRITEIT.V.DVBYTE.VFC#
      6084**DCL      6084--REDEF
WRITE_EOD IN PROCEDURE WRITE_REC
      7492**ENTRY    7434--CALL
WRITE_REC
      7482**PROC     7342--CALL     7399--CALL     7417--CALL
PL6.E3A0      #001=FII$INSYM File=FII$INSYM.:E05TSI                              TUE 07/29/97 15:27 Page:234  
WRITE_ZAPRESP
      5580**DCL      6967<>CALL
WRITE_ZAPRESP.STATION_
      5582**DCL      5582--REDEF
WRITE_ZAPRESP.V
      5583**DCL      5580--DCLINIT
WRITE_ZAPRESP.V.DVBYTE.VFC#
      5589**DCL      5589--REDEF
WRITOUT
      4465**DCL      7217<<ASSIGN   7271<<ASSIGN   7483>>IF
XCONSET
      4847**DCL      6536<>CALL
XCONSET.V
      4848**DCL      4847--DCLINIT
XTNDALT IN PROCEDURE EXT_EVENT
      6762**LABEL    6762--CALLALT
XTNDALT0 IN PROCEDURE EXT_EVENT
      6764**LABEL    6765--CALLALT
ZA0 IN PROCEDURE EXT_EVENT
      6960**LABEL    6962--CALLALT
ZAPRESP
      4758**DCL      5581--DCLINIT  5582--DCLINIT
ZAPRESP.FLAGS
      4765**DCL      4766--REDEF
ZAPRESP.MSGID
      4761**DCL      4762--REDEF
