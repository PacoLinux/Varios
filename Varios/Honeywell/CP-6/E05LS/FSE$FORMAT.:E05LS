VERSION E05

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:1    
        1        1        /*M* FSE$FORMAT Perform PMME's to DCB's with real formatting layer */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* CLM=8,DMR,MOC,CTI=2 */
        8        8        /*P*    NAME: FSE$FORMAT
        9        9         *      PURPOSE: FSE$FORMAT handles user PMME's to DCB's with real
       10       10         *         formatting layers (Unit-Record, TTY, etc.).
       11       11         *            For a given type of formatting, there are usually two
       12       12         *         entry points: one for DCB's which are directly attached
       13       13         *         to the I/O medium, and another for DCB's which are streamed
       14       14         *         to another DCB.  The processing for streamed DCB's is
       15       15         *         complicated by the fact that any part of the formatting may
       16       16         *         be specified in either DCB.
       17       17         */
       18       18        FSE$FORMAT: PROC(FPTCODE,FPTV) ALTRET;
       19       19    1   DCL FPTCODE SBIN; /* FPT code from PMME */
       20       20        %INCLUDE F$CP6V_C;
       21      246        %FPT$WRITE_V(FPTN=FPTV,BASED=); /* FPTV is V area of PMME FPT. */
       22      252        %FPT$PRECORD_V(FPTN=PRECORDFPT);
       23      257        /**/
       24      258        /* INCLUDE FILES */
       25      259        /**/
       26      260        %INCLUDE B$JIT;
       27      863        %INCLUDE B$ROSEG;
       28      926        %INCLUDE B_SEGIDS_C;
       29     1465        %INCLUDE B_STRINGS_C;
       30     1594        %INCLUDE CP_6_SUBS;
       31     2134        %INCLUDE FM$MACROS;
       32     2509        %INCLUDE F_CP6;
       33     3534        %INCLUDE F_ERRORS_C;
       34     3774        %INCLUDE F_FMTCODE_C;
       35     3808        %INCLUDE F_FPTCODE_C;
       36     3844        %INCLUDE F$DCB;
       37     3893        %INCLUDE JG_GHOSTS_C;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:2    
       38     3983        %INCLUDE HF_LOCK_C;
       39     3997        %INCLUDE KC$CP6V_C;
       40     4117        %INCLUDE NK_VFC_C;
       41     4191        /**/
       42     4192        /* EXTERNAL ROUTINES */
       43     4193        /**/
       44     4194    1   DCL FMH$CPMME ENTRY(3)ALTRET; /* Perform I/O to UR disk file */
       45     4195    1   DCL FMH$SYMB ENTRY(3)ALTRET; /* Perform I/O to Symbiont file */
       46     4196    1   DCL NKA$DEVIO ENTRY(5)ALTRET; /* Perform I/O to Unit Record Devices */
       47     4197    1   DCL FMF$REMOTE ENTRY(1);
       48     4198    1   DCL KIA$UCIO ENTRY(5)ALTRET; /* Perform I/O to T/S terminals       */
       49     4199    1   DCL KIS$OSI_READ ENTRY(0)ALTRET; /* Perform I/O to Network Connections */
       50     4200    1   DCL KIS$OSI_WRITE ENTRY(0)ALTRET; /* Perform I/O to Network Connections */
       51     4201    1   DCL KCI$RWCG ENTRY(5)ALTRET; /* Perform I/O to Comgroups           */
       52     4202    1   DCL OCU$RWUC ENTRY(4)ALTRET; /* Perform I/O to OC Comgroups        */
       53     4203    1   DCL FTW$WRAT ENTRY(3)ALTRET; /* Perform I/O to Tapes */
       54     4204    1   DCL FSD$C1 ENTRY ALTRET; /* Perform I/O to command file.*/
       55     4205    1   DCL FSD$C1END ENTRY ALTRET; /* Advance to next CC at end of XEQ.*/
       56     4206    1   DCL FSD$REW ENTRY ALTRET; /* Rewind XEQ file.*/
       57     4207    1   DCL NKA$EVENT ENTRY(2); /* Report Event for Nowait Event I/O  */
       58     4208    1   DCL FSB$SWITCH ENTRY ALTRET; /* Switch to new symfile chunk*/
       59     4209    1   DCL FMO$GETDOMAIN ENTRY(1); /* Get domain (WSR) of PMME'er*/
       60     4210    1   DCL FMO$GETPFB ENTRY(1);
       61     4211    1   DCL SC_FSBADDCB ENTRY CONV(2,0);
       62     4212        /*S*    SCREECH_CODE:  FSE-S$FSBADDCB
       63     4213                TYPE: SUA
       64     4214                MESSAGE: Bad I/O Medium code detected in a DCB. */
       65     4215        /* Note: This screech occurs several places in this module, so its
       66     4216           description occurs here instead of at all the calls.*/
       67     4217        /**/
       68     4218        /* EXTERNAL DATA */
       69     4219        /**/
       70     4220    1   DCL B$JIT$ PTR SYMREF READONLY;
       71     4221    1   DCL B$ROSEG$ PTR SYMREF READONLY;
       72     4222    1   DCL F_DCBLOCK BIT(72) SYMREF;
       73     4223        /**/
       74     4224        /* LOCAL NON-AUTOMATIC ITEMS */
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:3    
       75     4225        /**/
       76     4226        %SUB F$USRDCB="USRDCB$->F$DCB";
       77     4227        %SUB F$MEDDCB="MEDDCB$->F$DCB";
       78     4228        %VLP$SETSTA_V (FPTN=VSST); /* BASED VLP_SETSTA FOR CALLS */
       79     4240        %VLP$STATION_V (FPTN=VSTA); /* BASED VLP_STATION FOR LASTSTA MOVE*/
       80     4252        %CODE16(BASED="BASED(FORM$)");
       81     4260        %VLP_TAB(FPTN=VLP$TAB,STCLASS="BASED(TAB$)");
       82     4274        %VLP_HDR(FPTN=VLP$HDR,STCLASS="BASED(HDR$)",LEN="VLP$HDR.TITL.L#");
       83     4290        %VLP_HDR(FPTN=VLP$HDRF,STCLASS="BASED(HDR$)",LEN=160);
       84     4306        %VLP_TAB(FPTN=TABZERO,STCLASS=CONSTANT);
       85     4320        %VLP_HDR(FPTN=NULLHDR,STCLASS=CONSTANT,HEADERHEIGHT=0);
       86     4336        %SUB FCG#="'0623'O";
       87     4337        %SUB MID#="'05'O";
       88     4338        %ERRCODE(NAME=ERR$EOF,COD#=%E$EOF);
       89     4342        /*E*    ERROR:   FSE-E$EOF-2
       90     4343                MESSAGE: End of file.
       91     4344                MESSAGE1: End of file; no more control commands are left for
       92     4345                          your batch job.
       93     4346         */
       94     4347        %ERRCODE(NAME=ERR$UNIMP,COD#=%E$UNIMP);
       95     4351        /*E*    ERROR:   FSE-E$UNIMP-2
       96     4352                MESSAGE: Unimplemented I/O Medium.
       97     4353         */
       98     4354        %ERRCODE(NAME=ERR$POS,COD#=%E$POS);
       99     4358        /*E*    ERROR:   FSE-E$POS-2
      100     4359                MESSAGE: You are not allowed to position% in %UF%
      101     4360         */
      102     4361        %ERRCODE(NAME=ERR$CANTBIN,COD#=%E$CANTBIN);
      103     4365        /*E*    ERROR: FSE-E$CANTBIN-2
      104     4366                MESSAGE: BIN writes illegal here.
      105     4367         */
      106     4368        %ERRCODE(NAME=ERR$ILLBV,COD#=%E$ILLBV);
      107     4372        /*E*    ERROR: FSE-E$ILLBV-2
      108     4373                MESSAGE: M$WRITE with BIN and VFC illegal.
      109     4374         */
      110     4375        %ERRCODE(NAME=ERR$INVVFC,COD#=%E$INVVFC,SEV#=0);
      111     4379        /*E*    ERROR:   FSE-E$INVVFC-0
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:4    
      112     4380                MESSAGE: That VFC character is invalid.
      113     4381         */
      114     4382    1   DCL NK_URTBL_BP (0:511) CHAR(1) CONSTANT
      115     4383    1        INIT(
      116     4384    1           BINASC(1)*32,BINASC(0),BINASC(1)*95,
      117     4385    1           BINASC(1)*32,BINASC(0),BINASC(1)*95,
      118     4386    1           BINASC(1)*32,BINASC(0),BINASC(1)*95,
      119     4387    1           BINASC(1)*32,BINASC(0),BINASC(1)*95);
      120     4388        /**** * * * * * * ****/
      121     4389    1   DCL USRDCB$ PTR; /*Holds address of User's DCB*/
      122     4390    1   DCL MEDDCB$ PTR; /*Holds address of I/O Medium DCB (may = user)*/
      123     4391    1   DCL FORM$ PTR; /*Holds address of Medium's Form control area*/
      124     4392    1   DCL TAB$ PTR; /*Points to Tabs while DDF'ing them.*/
      125     4393    1   DCL HDR$ REDEF TAB$ PTR; /*Points to Header while DDF'ing or writing*/
      126     4394    1   DCL MEDIUMX UBIN;
      127     4395                %EQU FMH$CPMME#=0;
      128     4396                %EQU FTW$WRAT#=1;
      129     4397    1   DCL 1 USRDVBYTE, /*DVBYTE from user, as modified.*/
      130     4398    1         2 GOOD, /*This is the DVBYTE itself.*/
      131     4399    1           3 * BIT(2), /* TOP and BP bits*/
      132     4400    1           3 VFCBIN UBIN(2)UNAL, /* VFC and BIN bits*/
      133     4401    1           3 * BIT(5), /* TRANS,x,x,x,CONT bits*/
      134     4402    1         2 * BIT(27); /*PL6 likes wholeword better.*/
      135     4403    1   DCL J SBIN; /* Various uses                       */
      136     4404    1   DCL I SBIN;
      137     4405    1   DCL K SBIN;
      138     4406    1   DCL L SBIN;
      139     4407    1   DCL UVFCLINES SBIN; /* Number of lines to upspace from user VFC.*/
      140     4408    1   DCL SAVEUB$ PTR; /* Save DCB.UB$ when sending tab/seq/hdr   */
      141     4409    1   DCL SAVEUBT UBIN; /* SAve DCB.UBYTES when send tab/seq/hdr   */
      142     4410    1   DCL VFCCHAR CHAR(1); /* Holds VFC character to pass to media    */
      143     4411        %NK$VFC(STCLASS="REDEF VFCCHAR");
      144     4429    1   DCL CHAR1 CHAR(1) CALIGNED BASED; /* For fetching VFC from user buffer  */
      145     4430    1   DCL CHARI CHAR(I)BASED;
      146     4431    1   DCL BCMEDDCB$ PTR;
      147     4432    1   DCL 1 BCMEDDCB REDEF BCMEDDCB$,
      148     4433    1         2 * BIT(24),
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:5    
      149     4434    1         2 SID BIT(12);
      150     4435        %FPT$WRITE_V(FPTN=FPTVI,BASED=);
      151     4441    1   DCL CONTFORMMORE SBIN;
      152     4442        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:6    
      153     4443        /*F*    NAME: FSE$URSTREAM
      154     4444         *      PURPOSE: FSE$URSTREAM handles PMME's for user unit-record DCB's
      155     4445         *         which are streamed to other DCB's.
      156     4446         *            There are several types of such DCB's:
      157     4447         *         1.  User assignment to stream name ("LP01") or to device
      158     4448         *               oplabels which resolve to streams.  The "secret" DCB
      159     4449         *               for such assignments is hooked to a file in the
      160     4450         *               output symbiont account (:SYMO).
      161     4451         *         2.  User assignment to device oplabels which resolve to the
      162     4452         *               interactive DCB M$UC.  M$UC is hooked either to the
      163     4453         *               timesharing user's terminal or to the ghost user's OC
      164     4454         *               via OC Comgroup.
      165     4455         *      DESCRIPTION:
      166     4456         *            If the PMME is a M$WRITE, tabstop and sequencing specifi-
      167     4457         *         cations must be analyzed.  If the user DCB's tabstops and/or
      168     4458         *         sequencing were not the last ones told to the stream, new
      169     4459         *         specification records must be sent to the stream.  If the
      170     4460         *         streamed-to DCB is interactive, the same must be done for
      171     4461         *         page-header specifications.
      172     4462         *            A VFC character is obtained from the user buffer if
      173     4463         *         VFC=YES, or from DVFC in the user DCB if VFC=NO.  If the
      174     4464         *         streamed-to DCB is not interactive, paper motion is analyzed
      175     4465         *         and if a page bound has been crossed, a new header is
      176     4466         *         written to the stream.  Page number and current line are
      177     4467         *         updated for non-interactive streams.  The user buffer is
      178     4468         *         then written to the stream.
      179     4469         *            For M$READ, the user request is simply passed along to
      180     4470         *         the stream.
      181     4471         */
      182     4472        /*D*    NAME: FSE$URSTREAM
      183     4473         *      CALL: CALL FSE$URSTREAM(FPTCODE,FPTV) ALTRET;
      184     4474         *      ENVIRONMENT:   Monitor (for user) LS.
      185     4475         *      INTERFACE:  Medium-specific routines, including --
      186     4476         *               FMH$UR - Unit-Record disk file.
      187     4477         *               KIA$UCIO - Timesharing terminal.
      188     4478         *               OCU$RWUC - OC Comgroup.
      189     4479         *      INPUT:   DCB (B$JIT.DCB$).
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:7    
      190     4480         *               FPTCODE (user PMME code).
      191     4481                         FPTV (user PMME V area).
      192     4482         *
      193     4483         */
      194     4484        /*F*    NAME: FSE$UR
      195     4485         *      PURPOSE: FSE$UR handles PMME's for user Unit-Record DCB's which
      196     4486         *         are not streamed to other DCB's.
      197     4487         *            There are several types of such DCB's:
      198     4488         *         1.  User assignment "dd@wsn".  Internally, such a DCB is a
      199     4489         *               file in the output symbiont account (:SYMO).
      200     4490         *         2.  User assignment to file with ORG=UR, CREATE or UPDATE.
      201     4491         *      DESCRIPTION:   The PMME must be a M$WRITE.
      202     4492         *            If tabstops or sequencing were changed (by M$DEVICE)
      203     4493         *         since the last M$WRITE, new tabstops/sequencing records are
      204     4494         *         written to the file.
      205     4495         *            A VFC character is acquired from the user buffer if
      206     4496         *         VFC=YES, or from DVFC in the DCB if VFC=NO.  Paper motion
      207     4497         *         is analyzed.  If a page bound has been crossed, a new header
      208     4498         *         is written to the file.  Page number and current line are
      209     4499         *         updated.
      210     4500         *            The user buffer is written to the file.
      211     4501         */
      212     4502    1   FSE$URSTREAM: ENTRY(FPTCODE,FPTV)ALTRET;
      213     4503    1           CALL STREAMPREP ALTRET(NSTRMXIT);
      214     4504    1           CALL FORMATIT;
      215     4505    1           GOTO STRMXIT;
      216     4506    1   FSE$UR: ENTRY(FPTCODE,FPTV)ALTRET;
      217     4507    1           CALL NSTRMPREP ALTRET(NSTRMXIT);
      218     4508    1           CALL FORMATIT;
      219     4509    1           GOTO NSTRMXIT;
      220     4510        /**/
      221     4511    1   FSE$GRSTRM: ENTRY(FPTCODE,FPTV)ALTRET;
      222     4512    1           CALL STREAMPREP ALTRET(NSTRMXIT);
      223     4513    1           CALL GRFORMATIT;
      224     4514    1           GOTO STRMXIT;
      225     4515        /**/
      226     4516    1   FSE$GR: ENTRY(FPTCODE,FPTV)ALTRET;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:8    
      227     4517    1           CALL NSTRMPREP ALTRET(NSTRMXIT);
      228     4518    1           CALL GRFORMATIT;
      229     4519    1           GOTO NSTRMXIT;
      230     4520        /**/
      231     4521    1   FSE$FPSTREAM: ENTRY(FPTCODE,FPTV)ALTRET;
      232     4522    1           CALL STREAMPREP ALTRET(NSTRMXIT);
      233     4523    1           CALL FPRGFORMATIT;
      234     4524    1           GOTO STRMXIT;
      235     4525        /**/
      236     4526    1   FSE$FPRG: ENTRY(FPTCODE,FPTV)ALTRET;
      237     4527    1           CALL NSTRMPREP ALTRET(NSTRMXIT);
      238     4528    1           CALL FPRGFORMATIT;
      239     4529    1           GOTO NSTRMXIT;
      240     4530        /**/
      241     4531    1   FSE$NC: ENTRY (FPTCODE, FPTV) ALTRET;
      242     4532    1           CALL NSTRMPREP ALTRET(NSTRMXIT);
      243     4533    1           CALL MEDIUM ( );
      244     4534    1           GOTO NSTRMXIT;
      245     4535        /**/
      246     4536    1   FSE$TTYSTREAM: ENTRY(FPTCODE,FPTV)ALTRET;
      247     4537    1           CALL STREAMPREP ALTRET(NSTRMXIT);
      248     4538    1           CALL TTYFORMATIT;
      249     4539    1   STRMXIT:;
      250     4540    1           CALL STREAMEND;
      251     4541    1           GOTO NSTRMXIT;
      252     4542        /**/
      253     4543    1   FSE$TTY: ENTRY(FPTCODE,FPTV)ALTRET;
      254     4544    1           CALL NSTRMPREP ALTRET(NSTRMXIT);
      255     4545    1           CALL TTYFORMATIT;
      256     4546    1   NSTRMXIT:;
      257     4547    1           IF B$JIT.ERR.CODE~=0 THEN ALTRETURN;
      258     4548    1           RETURN;
      259     4549        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:9    
      260     4550    1   STREAMPREP: PROC ALTRET;
      261     4551        /*  STREAMPREP prepares things for the output formatter for a
      262     4552            streamed user DCB.  If the output formatter isn't needed (i.e.,
      263     4553            not a WRITE, or a WRITE to NO), it ALTRETURNs.  B$JIT.ERR is set
      264     4554            zero or nonzero depending on whether the operation succeeded.
      265     4555            If the output formatter is needed, it RETURNs with --
      266     4556                USRDCB$ pointing to user's DCB.
      267     4557                MEDDCB$ pointing to I/O-medium DCB.
      268     4558            After the output formatter finishes, our caller will call
      269     4559            STREAMEND to post information from the Medium DCB to User DCB.
      270     4560         */
      271     4561    2           USRDCB$=B$JIT.DCB$;
      272     4562    3           DO CASE(FPTCODE);
      273     4563    3            CASE(FPTWEOF,FPTDELREC);
      274     4564    3              IF F$USRDCB.ORG~=%SE# THEN B$JIT.ERR='0'B;
      275     4565    3              ELSE GOTO STREAMWRT;
      276     4566    3            CASE(FPTWRITE);
      277     4567    3   STREAMWRT: ;
      278     4568    3              IF F$USRDCB.ORG=%SE# OR F$USRDCB.ORG=%FORM# THEN MEDDCB$=USRDCB$;
      279     4569    3              ELSE IF F$USRDCB.UCOUT THEN MEDDCB$=DCBADDR(%M$UC#);
      280     4570    3                 ELSE MEDDCB$=F$USRDCB.CFU$;
      281     4571    4              DO CASE(F$MEDDCB.MEDIA);
      282     4572    4               CASE(FMTCG#,FMTUC#,FMTOCCG#,FMTSYMB#); /*OK ones.*/
      283     4573    4               CASE(FMTNO#);
      284     4574    4                 B$JIT.ERR='0'B;
      285     4575    4                 MEDDCB$ = USRDCB$;
      286     4576    4                 GOTO ALTR;
      287     4577    4               CASE(ELSE);
      288     4578    4                 CALL SC_FSBADDCB;
      289     4579    4                 ALTRETURN;
      290     4580    4               END;
      291     4581    3              B$JIT.DCB$=MEDDCB$;
      292     4582    3              CALL FMO$GETPFB(I);
      293     4583    3              IF USRDCB$ = DCBADDR(%M$UC#)
      294     4584    3              THEN
      295     4585    3                 F$MEDDCB.STR = I;
      296     4586    3              ELSE
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:10   
      297     4587    3                 F$MEDDCB.STR = F$USRDCB.STR;
      298     4588    3              F$MEDDCB.TYC(1)='0'B;
      299     4589    3              F$MEDDCB.WAIT=1;
      300     4590    3              F$MEDDCB.UB$=F$USRDCB.UB$;
      301     4591    3              F$MEDDCB.UBYTES=F$USRDCB.UBYTES;
      302     4592    3              IF FPTCODE=FPTWRITE THEN RETURN;
      303     4593    4              IF F$MEDDCB.MEDIA=FMTUC# THEN DO;
      304     4594    4                 B$JIT.ERR='0'B;
      305     4595    4                 CALL KIA$UCIO(FPTCODE,0,0,0,ADDR(FPTV));
      306     4596    4                 END;
      307     4597    3            CASE(FPTREAD);
      308     4598    3              IF F$USRDCB.CTLCMDIN THEN
      309     4599    4   C1AGAIN:   DO CASE(B$ROSEG$->B$ROSEG.CR01ID.NOWIS);
      310     4600    4               CASE(%CC_FROMNO#); /* Control Command place is NO */
      311     4601    4                 F$USRDCB.DDEV.IC='0'B;
      312     4602    4                 F$USRDCB.DDEV.XEQ='0'B;
      313     4603    4                 B$JIT.ERR=ERR$EOF;
      314     4604    4                 F$USRDCB.TYC.EOF(F$USRDCB.WAIT) = '1'B;
      315     4605    4                 MEDDCB$ = USRDCB$;
      316     4606    4                 GOTO ALTR;
      317     4607    4               CASE(%CC_FROMUC#); /* Control Command place is M$UC */
      318     4608    4                 F$USRDCB.DDEV.IC=F$USRDCB.CFU$->F$DCB.DDEV.IC;
      319     4609    4                 F$USRDCB.DDEV.XEQ='0'B;
      320     4610    4               CASE(%CC_FROMJOB#,%CC_FROMXEQ#);
      321     4611    4                 CALL FSD$C1 ALTRET(C1ALTR);
      322     4612    4                 B$JIT.ERR='0'B;
      323     4613    4                 MEDDCB$ = USRDCB$;
      324     4614    4                 GOTO ALTR;
      325     4615    4               CASE(%CC_FROMXEQEND#);
      326     4616    4                 CALL FSD$C1END ALTRET(C1ALTR);
      327     4617    4                 GOTO C1AGAIN;
      328     4618    4   C1ALTR:       ;
      329     4619    4                 IF B$JIT.ERR.CODE ~= 0
      330     4620    4                 THEN
      331     4621    5                 DO;
      332     4622    5                    MEDDCB$ = USRDCB$;
      333     4623    5                    GOTO ALTR;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:11   
      334     4624    5                    END;
      335     4625    4                 GOTO C1AGAIN; /*Fell off end of CC files; retry.*/
      336     4626    4               END;
      337     4627    3              MEDDCB$=F$USRDCB.CFU$;
      338     4628    3              IF F$USRDCB.ORG=%SE# OR F$USRDCB.ORG=%FORM# THEN MEDDCB$=USRDCB$;
      339     4629    3              CALL FMO$GETPFB(I);
      340     4630    3              IF USRDCB$ = DCBADDR(%M$UC#)
      341     4631    3              THEN
      342     4632    3                 F$MEDDCB.STR = I;
      343     4633    3              ELSE
      344     4634    3                 F$MEDDCB.STR = F$USRDCB.STR;
      345     4635    3              B$JIT.DCB$=MEDDCB$;
      346     4636    3              F$MEDDCB.TYC(1)='0'B;
      347     4637    3              F$MEDDCB.UB$=F$USRDCB.UB$;
      348     4638    3              F$MEDDCB.UBYTES=F$USRDCB.UBYTES;
      349     4639    3              F$MEDDCB.ARS=0;
      350     4640    4              DO CASE(F$MEDDCB.MEDIA);
      351     4641    4               CASE(FMTNO#);
      352     4642    4                 B$JIT.ERR=ERR$EOF;
      353     4643    4                 B$JIT.DCB$=USRDCB$;
      354     4644    4                 ALTRETURN;
      355     4645    4               CASE(FMTCG#);
      356     4646    4                 F$MEDDCB.WAIT = 1;
      357     4647    4                 CALL KCI$RWCG(MFC_READ,FPTV.DVBYTE,BINASC(0),
      358     4648    4                   FPTV.EVENT,F$USRDCB.SETSTA$->VSST)
      359     4649    4                   ALTRET(ALTR);
      360     4650    4               CASE(FMTUC#);
      361     4651    4                 F$MEDDCB.WAIT = F$USRDCB.WAIT;
      362     4652    4                 CALL KIA$UCIO(MFC_READ,FPTV.DVBYTE,BINASC(0),
      363     4653    4                   FPTV.EVENT,ADDR(FPTV)) ALTRET(ALTR);
      364     4654    4                 IF F$USRDCB.WAIT = 0
      365     4655    5                 THEN DO;
      366     4656                         %LOCK (G=F_DCBLOCK);
      367     4659    5                    F$USRDCB.FCN(0) = BINBIT (F$USRDCB.FCN.CNT(0) + 1, 9);
      368     4660    5                    F$MEDDCB.FCN(0) = BINBIT (F$MEDDCB.FCN.CNT(0) + 1, 9);
      369     4661                         %UNLOCK (G=F_DCBLOCK);
      370     4664    5                    ALTRETURN;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:12   
      371     4665    5                    END;
      372     4666    4               CASE(FMTOCCG#);
      373     4667    4                 F$MEDDCB.WAIT=1;
      374     4668    4                 CALL OCU$RWUC(MFC_READ,FPTV.DVBYTE,BINASC(0),
      375     4669    4                   FPTV.EVENT) ALTRET(ALTR);
      376     4670    4               CASE(ELSE);
      377     4671    4                 CALL SC_FSBADDCB;
      378     4672    4                 B$JIT.DCB$=USRDCB$;
      379     4673    4                 ALTRETURN;
      380     4674    4               END;
      381     4675    3              B$JIT.ERR='0'B;
      382     4676    3   ALTR:      B$JIT.DCB$=USRDCB$;
      383     4677    3              BCMEDDCB$=MEDDCB$;
      384     4678    3              BCMEDDCB.SID=%RONCSID;
      385     4679    3              F$USRDCB.ARS=BCMEDDCB$->F$DCB.ARS;
      386     4680    3              F$USRDCB.DVBYTE=BCMEDDCB$->F$DCB.DVBYTE;
      387     4681    3              F$USRDCB.EOMCHAR=BCMEDDCB$->F$DCB.EOMCHAR;
      388     4682    3              F$USRDCB.ACTPOS=BCMEDDCB$->F$DCB.ACTPOS;
      389     4683    3              F$USRDCB.FLDID=BCMEDDCB$->F$DCB.FLDID;
      390     4684    3              IF BCMEDDCB$->F$DCB.ASN=%COMGROUP#
      391     4685    3                AND F$USRDCB.LASTSTA$ ~= ADDR(NIL)
      392     4686    3              THEN
      393     4687    3                 F$USRDCB.LASTSTA$->VSTA=BCMEDDCB$->F$DCB.LASTSTA$->VSTA;
      394     4688    3              IF F$USRDCB.WAIT~=0 THEN
      395     4689    3                 F$USRDCB.TYC(1)=BCMEDDCB$->F$DCB.TYC(1)|F$USRDCB.TYC(1);
      396     4690    3              ELSE IF FPTV.EVENT=0 THEN
      397     4691    3                    F$USRDCB.TYC(0)=BCMEDDCB$->F$DCB.TYC(1)|F$USRDCB.TYC(0);
      398     4692    3                 ELSE
      399     4693    3                    CALL NKA$EVENT(BCMEDDCB$->F$DCB.TYC(1),FPTV.EVENT);
      400     4694    3              ALTRETURN;
      401     4695    3            CASE(ELSE);
      402     4696    3              B$JIT.ERR='0'B;
      403     4697    3            CASE(FPTPREC);
      404     4698    3              IF ADDR(FPTV)->PRECORDFPT.BOF OR
      405     4699    3                ADDR(FPTV)->PRECORDFPT.EOF OR
      406     4700    3                ADDR(FPTV)->PRECORDFPT.N~=0 OR
      407     4701    3                ADDR(FPTV)->PRECORDFPT.KEYS OR
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:13   
      408     4702    3                ADDR(FPTV)->PRECORDFPT.KEYR THEN
      409     4703    3                 B$JIT.ERR=ERR$POS;
      410     4704    3              ELSE B$JIT.ERR='0'B;
      411     4705    3            CASE(FPTREW);
      412     4706    4              IF F$USRDCB.CTLCMDIN THEN DO;
      413     4707    4                 CALL FMO$GETDOMAIN(I);
      414     4708    5                 IF I=%CPWSR THEN DO;
      415     4709    5                    CALL FSD$REW;
      416     4710    5                    ALTRETURN;
      417     4711    5                    END;
      418     4712    4                 END;
      419     4713    3              B$JIT.ERR='0'B;
      420     4714    3            CASE(FPTPFIL);
      421     4715    3              B$JIT.ERR=ERR$POS;
      422     4716    3            END;
      423     4717    2           ALTRETURN;
      424     4718    2   END STREAMPREP;
      425     4719        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:14   
      426     4720    1   STREAMEND: PROC;
      427     4721    2           B$JIT.DCB$=USRDCB$;
      428     4722    2           BCMEDDCB$=MEDDCB$;
      429     4723    2           BCMEDDCB.SID=%RONCSID;
      430     4724    2           IF BCMEDDCB$->F$DCB.ASN=%COMGROUP# THEN
      431     4725    2              IF NOT F$MEDDCB.LSTAOR THEN
      432     4726    2                 F$USRDCB.LASTSTA$->VSTA=BCMEDDCB$->F$DCB.LASTSTA$->VSTA;
      433     4727    2           IF F$USRDCB.WAIT~=0 THEN
      434     4728    2              F$USRDCB.TYC(1)=BCMEDDCB$->F$DCB.TYC(1)|F$USRDCB.TYC(1);
      435     4729    3           ELSE DO;
      436     4730    4              IF FPTV.EVENT~=0 THEN DO;
      437     4731    4                 CALL NKA$EVENT(BCMEDDCB$->F$DCB.TYC(1),FPTV.EVENT);
      438     4732    4                 RETURN;
      439     4733    4                 END;
      440     4734    3              F$USRDCB.TYC(0)=BCMEDDCB$->F$DCB.TYC(1)|F$USRDCB.TYC(0);
      441     4735    3              END;
      442     4736    2           RETURN;
      443     4737    2   END STREAMEND;
      444     4738        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:15   
      445     4739    1   NSTRMPREP: PROC ALTRET;
      446     4740        /*  NSTRMPREP prepares things for the output formatter for a
      447     4741            non-streamed user DCB.  If the output formatter isn't needed
      448     4742            (i.e., not a WRITE), it ALTRETURNs.  B$JIT.ERR is set zero or
      449     4743            nonzero depending on whether the operation succeeded.
      450     4744            If the output formatter is needed, it RETURNs with --
      451     4745                USRDCB$ pointing to user's DCB.
      452     4746                MEDDCB$ pointing to user's DCB.
      453     4747         */
      454     4748    2           USRDCB$=B$JIT.DCB$;
      455     4749    2           MEDDCB$=USRDCB$;
      456     4750    2           CALL FMO$GETPFB(I);
      457     4751    2           IF USRDCB$ = DCBADDR(%M$UC#)
      458     4752    2           THEN
      459     4753    2              F$MEDDCB.STR = I;
      460     4754    3           DO CASE(FPTCODE);
      461     4755    3            CASE(FPTWRITE);
      462     4756    4              DO CASE(F$MEDDCB.MEDIA);
      463     4757    4               CASE(FMTCG#,FMTUC#,FMTOCCG#,FMTSYMB#,FMTDEV#,FMTNC#);
      464     4758    4                 RETURN; /* These are the good ones.*/
      465     4759        /*  Cases from here on will all ALTRETURN.*/
      466     4760    4               CASE(FMTNO#);
      467     4761    4                 B$JIT.ERR='0'B;
      468     4762    4               CASE(ELSE);
      469     4763    4                 CALL SC_FSBADDCB;
      470     4764    4                 ALTRETURN;
      471     4765    4               END;
      472     4766    3            CASE(FPTREAD);
      473     4767    3              F$MEDDCB.ARS=0;
      474     4768    4              DO CASE(F$MEDDCB.MEDIA);
      475     4769    4               CASE(FMTDEV#);
      476     4770    4                 CALL NKA$DEVIO(MFC_READ,FPTV.DVBYTE,BINASC(0),
      477     4771    4                   FPTV.EVENT) ALTRET(ALTR);
      478     4772    4               CASE(FMTNO#);
      479     4773    4                 B$JIT.ERR=ERR$EOF; GOTO ALTR;
      480     4774    4               CASE(FMTCG#);
      481     4775    4                 CALL KCI$RWCG(MFC_READ,FPTV.DVBYTE,BINASC(0),
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:16   
      482     4776    4                   FPTV.EVENT,F$USRDCB.SETSTA$->VSST)
      483     4777    4                   ALTRET(ALTR);
      484     4778    4               CASE(FMTUC#);
      485     4779    4                 F$MEDDCB.WAIT = F$USRDCB.WAIT;
      486     4780    4                 CALL KIA$UCIO(MFC_READ,FPTV.DVBYTE,BINASC(0),
      487     4781    4                   FPTV.EVENT,ADDR(FPTV)) ALTRET(ALTR);
      488     4782    4                 IF F$USRDCB.WAIT = 0
      489     4783    5                 THEN DO;
      490     4784                         %LOCK (G=F_DCBLOCK);
      491     4787    5                    F$MEDDCB.FCN(0) = BINBIT (F$MEDDCB.FCN.CNT(0) + 1, 9);
      492     4788                         %UNLOCK (G=F_DCBLOCK);
      493     4791    5                    ALTRETURN;
      494     4792    5                    END;
      495     4793    4               CASE(FMTOCCG#);
      496     4794    4                 CALL OCU$RWUC(MFC_READ,FPTV.DVBYTE,BINASC(0),
      497     4795    4                   FPTV.EVENT) ALTRET(ALTR);
      498     4796    4               CASE(FMTSYMB#);
      499     4797    4                 CALL FMH$SYMB(FPTREAD,FPTV) ALTRET(ALTR);
      500     4798
      501     4799    4               CASE(FMTNC#);
      502     4800    4                 CALL KIS$OSI_READ ALTRET(ALTR);
      503     4801
      504     4802    4               CASE(ELSE);
      505     4803    4                 CALL SC_FSBADDCB;
      506     4804    4                 ALTRETURN;
      507     4805    4               END;
      508     4806    3              B$JIT.ERR='0'B;
      509     4807    3            CASE(ELSE);
      510     4808    3              B$JIT.ERR='0'B;
      511     4809    3            CASE(FPTPREC);
      512     4810    3              IF ADDR(FPTV)->PRECORDFPT.BOF OR
      513     4811    3                ADDR(FPTV)->PRECORDFPT.EOF OR
      514     4812    3                ADDR(FPTV)->PRECORDFPT.N~=0 OR
      515     4813    3                ADDR(FPTV)->PRECORDFPT.KEYS OR
      516     4814    3                ADDR(FPTV)->PRECORDFPT.KEYR THEN
      517     4815    3                 B$JIT.ERR=ERR$POS;
      518     4816    3              ELSE B$JIT.ERR='0'B;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:17   
      519     4817    3            CASE(FPTREW);
      520     4818    3              B$JIT.ERR='0'B;
      521     4819    3            CASE(FPTPFIL);
      522     4820    3              B$JIT.ERR=ERR$POS;
      523     4821    3            END;
      524     4822    2   ALTR:   ALTRETURN;
      525     4823    2   END NSTRMPREP;
      526     4824        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:18   
      527     4825    1   TTYFORMATIT: PROC;
      528     4826    2           IF NOT F$USRDCB.IWL.TABIWL THEN
      529     4827    2              CALL DDFTAB ALTRET(ALTRETUR);
      530     4828    2           IF NOT F$USRDCB.IWL.HDRIWL THEN
      531     4829    2              CALL DDFHEADER ALTRET(ALTRETUR);
      532     4830    2           CALL PREPWRITE ALTRET(ALTRETUR);
      533     4831
      534     4832        /* If this is not an IC device we want to perserve blanks */
      535     4833    2           IF ((F$MEDDCB.DDEV & %DDEV_IC#) = '0'B)
      536     4834    2           THEN
      537     4835    2              USRDVBYTE = USRDVBYTE | %DVBYTE_BP#;
      538     4836
      539     4837    3           DO CASE(NK$VFC.FCN);
      540     4838    3            CASE(%VFCF_HDR,%VFCF_SKB,%VFCF_SPB,%VFCF_SKA,%VFCF_SPA);
      541     4839    3            CASE(%VFCF_SPC);
      542     4840    4              DO CASE(NK$VFC.COUNT);
      543     4841    4               CASE(%VFCS_OTAB,%VFCS_SEQN,%VFCS_ITAB); /*Let these through*/
      544     4842    4                 USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;
      545     4843    4               CASE(%VFCS_SPRM,%VFCS_SPRO,%VFCS_SLLN,%VFCS_SLLP);
              4843                        /*Don't let these through*/
      546     4844    4                 B$JIT.ERR='0'B;
      547     4845    4                 RETURN;
      548     4846    4               CASE(%VFCS_SHDR); /*Has already been fixed; set trans.*/
      549     4847    4                 USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;
      550     4848    4               CASE(%VFCS_SLPP); /*No-no; this is IMP stuff.*/
      551     4849    5                 IF NOT USRDVBYTE&%DVBYTE_TRANS# THEN DO;
      552     4850    5                    B$JIT.ERR='0'B;
      553     4851    5                    RETURN;
      554     4852    5                    END;
      555     4853    4                 USRDVBYTE = USRDVBYTE | %DVBYTE_RRR#;
      556     4854    4               CASE(%VFCS_PGND); /*Let this through*/
      557     4855    4               CASE(%VFCS_VFU); /*Not this one, for now.*/
      558     4856    4                 B$JIT.ERR='0'B;
      559     4857    4                 RETURN;
      560     4858    4               CASE(ELSE); /*Undefined ones give him an error.*/
      561     4859    4                 B$JIT.ERR=ERR$INVVFC;
      562     4860    4                 RETURN;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:19   
      563     4861    4               CASE(%VFCS_TRS0,%VFCS_TRS1,%VFCS_CLRWND); /*Let through as-is.*/
      564     4862    4               END;
      565     4863    3            CASE(ELSE);
      566     4864    3              B$JIT.ERR=ERR$INVVFC;
      567     4865    3              RETURN;
      568     4866    3            END;
      569     4867    2   WRTIT:  ;
      570     4868    2           CALL MEDIUM(MFC_WRITE, USRDVBYTE.GOOD, VFCCHAR)
      571     4869    2             ALTRET(ALTRETUR);
      572     4870    2           B$JIT.ERR='0'B;
      573     4871    2   ALTRETUR:;
      574     4872    2           RETURN;
      575     4873        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:20   
      576     4874    2   FPRGFORMATIT: ENTRY;
      577     4875    2           CALL PREPWRITE ALTRET (ALTRETUR);
      578     4876    2           USRDVBYTE = USRDVBYTE | %DVBYTE_BP#;
      579     4877    2           GOTO WRTIT;
      580     4878        /**/
      581     4879    2   GRFORMATIT: ENTRY;
      582     4880    2           CALL PREPWRITE ALTRET (ALTRETUR);
      583     4881    2           F$MEDDCB.FORM$->CODE16.RECNO = F$MEDDCB.FORM$->CODE16.RECNO +1;
      584     4882    2           IF (VFCCHAR = 'p')
      585     4883    3           THEN DO;
      586     4884    3              F$MEDDCB.FORM$->CODE16.PAGENO = F$MEDDCB.FORM$->CODE16.PAGENO + 1;
      587     4885    3              F$MEDDCB.PGINGRAN = F$MEDDCB.PGINGRAN + 1;
      588     4886    3              END;
      589     4887    3           ELSE DO;
      590     4888    3              VFCCHAR = BITASC ('036'O);
      591     4889    3              END;
      592     4890    2           GOTO WRTIT;
      593     4891    2   END TTYFORMATIT;
      594     4892        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:21   
      595     4893    1   FORMATIT: PROC;
      596     4894    2           IF NOT F$USRDCB.IWL.TABIWL THEN
      597     4895    2              CALL DDFTAB ALTRET(ALTRETUR);
      598     4896    2           F$USRDCB.IWL.SEQIWL='1'B;
      599     4897    2           CALL PREPWRITE ALTRET(ALTRETUR);
      600     4898        /*      We have a non-BIN M$WRITE.
      601     4899                VFCCHAR is the VFC character from buffer or DVFC.
      602     4900                USRDVBYTE is a cleaned-up DVBYTE from the M$WRITE.
      603     4901         */
      604     4902    2           USRDVBYTE=USRDVBYTE|%DVBYTE_VFC#;
      605     4903    2   MORESPA: CONTFORMMORE=0;
      606     4904    3           IF F$MEDDCB.DDEV&%DDEV_IC# THEN DO;
      607     4905    4              DO CASE(NK$VFC.FCN);
      608     4906    4               CASE(%VFCF_HDR,%VFCF_SKB,%VFCF_SPB,%VFCF_SKA,%VFCF_SPA);
      609     4907    4               CASE(%VFCF_SPC);
      610     4908    5                 DO CASE(NK$VFC.COUNT);
      611     4909    5                  CASE(%VFCS_OTAB,%VFCS_SEQN,%VFCS_ITAB); /*Let these through*/
      612     4910    5                    USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;
      613     4911    5                  CASE(%VFCS_SPRM,%VFCS_SPRO,%VFCS_SLLN,%VFCS_SLLP);
              4911                           /*Don't let these through*/
      614     4912    5                    B$JIT.ERR='0'B;
      615     4913    5                    RETURN;
      616     4914    5                  CASE(%VFCS_SHDR); /*Has already been fixed; set trans.*/
      617     4915    5                    USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;
      618     4916    5                  CASE(%VFCS_SLPP); /*No-no; this is IMP stuff.*/
      619     4917    5                    B$JIT.ERR='0'B;
      620     4918    5                    RETURN;
      621     4919    5                  CASE(%VFCS_PGND); /*Let this through*/
      622     4920    5                  CASE(%VFCS_VFU); /*Not this one, for now.*/
      623     4921    5                    B$JIT.ERR='0'B;
      624     4922    5                    RETURN;
      625     4923    5                  CASE(ELSE); /*Undefined ones give him an error.*/
      626     4924    5                    B$JIT.ERR=ERR$INVVFC;
      627     4925    5                    RETURN;
      628     4926    5                  CASE(%VFCS_TRS0,%VFCS_TRS1,%VFCS_CLRWND); /*Let through as-is.*/
      629     4927    5                  END;
      630     4928    4               CASE(ELSE);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:22   
      631     4929    4                 B$JIT.ERR=ERR$INVVFC;
      632     4930    4                 RETURN;
      633     4931    4               END;
      634     4932    3              IF F$USRDCB.HEADER$~=ADDR(NIL) AND
      635     4933    4                USRDCB$~=MEDDCB$ THEN DO;
      636     4934    4                 USRDVBYTE=USRDVBYTE|%DVBYTE_DCBHDR#;
      637     4935    4                 IF NOT F$USRDCB.IWL.HDRIWL THEN
      638     4936    4                    CALL DDFHEADER ALTRET(ALTRETUR);
      639     4937    4                 END;
      640     4938    3              END/*F$USRDCB.DDEV.IC*/;
      641     4939    3           ELSE IF F$MEDDCB.DDEV&%DDEV_LP# THEN DO;
      642     4940    3                 FORM$=F$MEDDCB.FORM$;
      643     4941    4                 DO CASE(NK$VFC.FCN);
      644     4942    4                  CASE(%VFCF_HDR);
      645     4943    4                    CALL SETHEADER ALTRET(RETUR);
      646     4944    4                    CODE16.LINENO=NK$VFC.COUNT;
      647     4945    4                    CODE16.NOTCOL1=(NK$VFC.COUNT=0);
      648     4946    4                  CASE(%VFCF_SKB);
      649     4947    4                    CALL FINDLINE ALTRET(ASIFSPB);
      650     4948    5                    IF I>=F$USRDCB.LINES THEN DO;
      651     4949    5                       CALL SETHEADER ALTRET(RETUR);
      652     4950    5                       CALL FINDLINE;
      653     4951    5                       CALL DOHEADER ALTRET(ALTRETUR);
      654     4952    6                       IF I>=F$USRDCB.LINES THEN DO;
      655     4953    6                          VFCCHAR='`' /*VFC_SPB0*/;
      656     4954    6                          I=CODE16.LINENO;
      657     4955    6                          END;
      658     4956    5                       END;
      659     4957    4                    CODE16.LINENO=I;
      660     4958    4                    CODE16.NOTCOL1=%YES#;
      661     4959    4                  CASE(%VFCF_SPB);
      662     4960    4                    UVFCLINES=NK$VFC.COUNT;
      663     4961    4   ASIFSPB:         ;
      664     4962    5                    IF CODE16.LINENO+UVFCLINES>=F$USRDCB.LINES THEN DO;
      665     4963    5                       IF CODE16.CONTFORM THEN
      666     4964    6                          IF CODE16.LINENO<F$USRDCB.LINES THEN DO;
      667     4965    6                             UVFCLINES=UVFCLINES-
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:23   
      668     4966    6                               (F$USRDCB.LINES-CODE16.LINENO);
      669     4967    6                             NK$VFC.COUNT=UVFCLINES;
      670     4968    6                             END;
      671     4969    5                       CALL SETHEADER ALTRET(RETUR);
      672     4970    5                       CALL DOHEADER ALTRET(ALTRETUR);
      673     4971    6                       IF CODE16.LINENO+UVFCLINES>=F$USRDCB.LINES THEN DO;
      674     4972    6                          UVFCLINES=0;
      675     4973    6                          VFCCHAR='`';
      676     4974    6                          END;
      677     4975    5                       END;
      678     4976    4                    CODE16.LINENO=CODE16.LINENO+UVFCLINES;
      679     4977    4                    CODE16.NOTCOL1=%YES#;
      680     4978    4                  CASE(%VFCF_SKA);
      681     4979    5                    IF CODE16.LINENO>=F$USRDCB.LINES THEN DO;
      682     4980    5                       CALL SETHEADER ALTRET(RETUR);
      683     4981    5                       CALL DOHEADER ALTRET(ALTRETUR);
      684     4982    5                       END;
      685     4983    4                    CODE16.NOTCOL1=%NO#;
      686     4984    4                    CALL FINDLINE ALTRET(ASIFSPA);
      687     4985    5                    IF I>=F$USRDCB.LINES THEN DO;
      688     4986    5                       VFCCHAR='`' /*VFC_SPB0*/;
      689     4987    5                       CODE16.LINENO=CODE16.LINES;
      690     4988    5                       END;
      691     4989    4                    ELSE
      692     4990    4                       CODE16.LINENO=I;
      693     4991    4                  CASE(%VFCF_SPA);
      694     4992    4                    UVFCLINES=NK$VFC.COUNT;
      695     4993    4   TRS1SPA:         ;
      696     4994    5                    IF CODE16.LINENO>=F$USRDCB.LINES THEN DO;
      697     4995    5                       CALL SETHEADER ALTRET(RETUR);
      698     4996    5                       IF HDR$=ADDR(NULLHDR) AND UVFCLINES~=0 THEN
      699     4997    5                          NK$VFC.FCN=%VFCF_HDR;
      700     4998    5                       ELSE
      701     4999    5                          CALL DOHEADER ALTRET(ALTRETUR);
      702     5000    5                       END;
      703     5001    4                    CODE16.NOTCOL1=(UVFCLINES=0);
      704     5002    4   ASIFSPA:         ;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:24   
      705     5003    5                    IF CODE16.LINENO+UVFCLINES>=F$USRDCB.LINES THEN DO;
      706     5004    5                       IF NK$VFC.FCN=%VFCF_HDR THEN
      707     5005    5                          NK$VFC.COUNT=0;
      708     5006    6                       ELSE DO;
      709     5007    6                          IF CODE16.CONTFORM AND
      710     5008    7                            (CODE16.LINENO<F$USRDCB.LINES) THEN DO;
      711     5009    7                             CONTFORMMORE=UVFCLINES-
      712     5010    7                               (F$USRDCB.LINES-CODE16.LINENO);
      713     5011    7                             END;
      714     5012    6                          VFCCHAR='`' /*VFC_SPB0*/;
      715     5013    6                          END;
      716     5014    5                       CODE16.LINENO=CODE16.LINES;
      717     5015    5                       END;
      718     5016    4                    ELSE
      719     5017    4                       CODE16.LINENO=CODE16.LINENO+UVFCLINES;
      720     5018    4                  CASE(%VFCF_SPC);
      721     5019    5                    DO CASE(NK$VFC.COUNT);
      722     5020    5                     CASE(%VFCS_ITAB);
      723     5021    5                       GOTO RETUR;
      724     5022    5                     CASE(%VFCS_OTAB,%VFCS_SEQN);
      725     5023    5                       USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;
      726     5024    5                     CASE(%VFCS_SPRM,%VFCS_SPRO);
      727     5025    5                       GOTO RETUR;
      728     5026    5                     CASE(%VFCS_SLLN,%VFCS_SLLP);
      729     5027    5                       GOTO RETUR;
      730     5028    5                     CASE(%VFCS_SHDR);
      731     5029    5                       GOTO RETUR;
      732     5030    5                     CASE(%VFCS_SLPP);
      733     5031    5                       GOTO RETUR;
      734     5032    5                     CASE(%VFCS_PGND,%VFCS_CLRWND);
      735     5033    5                       VFCCHAR = %VFC_PGND;
      736     5034    5                       CODE16.LINENO=CODE16.LINES;
      737     5035    5                       GOTO RETUR;
      738     5036    5                     CASE(%VFCS_VFU);
      739     5037    5                       GOTO RETUR;
      740     5038    5                     CASE(ELSE);
      741     5039    5                       B$JIT.ERR=ERR$INVVFC;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:25   
      742     5040    5                       RETURN;
      743     5041    5                     CASE(%VFCS_TRS0);
      744     5042    5                       VFCCHAR='`' /*SPB0*/;
      745     5043    5                       UVFCLINES=0;
      746     5044    5                       IF CODE16.NOTCOL1 THEN
      747     5045    6                          IF CODE16.LINENO+1<F$USRDCB.LINES THEN DO;
      748     5046    6                             VFCCHAR='a' /*SPB1*/;
      749     5047    6                             UVFCLINES=1;
      750     5048    6                             END;
      751     5049    5                          ELSE
      752     5050    5                             CODE16.LINENO=CODE16.LINES;
      753     5051    5                       GOTO ASIFSPB;
      754     5052    5                     CASE(%VFCS_TRS1);
      755     5053    6                       IF CODE16.NOTCOL1 THEN DO;
      756     5054    7                          IF CODE16.LINENO+1<F$USRDCB.LINES THEN DO;
      757     5055    7                             SAVEUB$=F$MEDDCB.UB$;
      758     5056    7                             SAVEUBT=F$MEDDCB.UBYTES;
      759     5057    7                             F$MEDDCB.UBYTES=0;
      760     5058    7                             CALL MEDIUM(MFC_WRITE,%DVBYTE_VFC#,
      761     5059    7                               'a')ALTRET(ALTRETUR);
      762     5060    7                             F$MEDDCB.UBYTES=SAVEUBT;
      763     5061    7                             F$MEDDCB.UB$=SAVEUB$;
      764     5062    7                             END;
      765     5063    6                          CODE16.LINENO=CODE16.LINENO+1;
      766     5064    6                          END;
      767     5065    5                       VFCCHAR='A' /*SPA1*/;
      768     5066    5                       UVFCLINES=1;
      769     5067    5                       GOTO TRS1SPA;
      770     5068    5                     END;
      771     5069    4                  CASE(ELSE);
      772     5070    4                    B$JIT.ERR=ERR$INVVFC;
      773     5071    4                    RETURN;
      774     5072    4                  END/*CASE(NK$VFC.FCN)*/;
      775     5073    3                 END/*F$USRDCB.DDEV.LP*/;
      776     5074    3              ELSE DO;
      777     5075    4                 IF F$MEDDCB.DDEV&%DDEV_CP# THEN DO;
      778     5076    5                    IF B$JIT.REMCPO=0 THEN DO;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:26   
      779     5077    6                       IF B$JIT.USER>JG_MING# THEN DO;
      780     5078    6                          B$JIT.XLIMFLG=B$JIT.XLIMFLG|%XL_PO#;
      781     5079    6                          B$JIT.RNST=B$JIT.RNST|%RS_LIMX#;
      782     5080    6                          GOTO RETUR;
      783     5081    6                          END;
      784     5082    5                       END;
      785     5083    4                    ELSE
      786     5084    4                       B$JIT.REMCPO=B$JIT.REMCPO-1;
      787     5085    4                    END;
      788     5086    3                 F$MEDDCB.FORM$->CODE16.RECNO=
      789     5087    3                   F$MEDDCB.FORM$->CODE16.RECNO+1;
      790     5088        /*  PGINGRAN will contain the number of records in a non-paged file
      791     5089            for SPACE and SYMBO keyin purposes.
      792     5090        */
      793     5091    3                 F$MEDDCB.PGINGRAN = F$MEDDCB.PGINGRAN + 1;
      794     5092    3                 END;
      795     5093    2           IF (USRDVBYTE & %DVBYTE_TRANS#)
      796     5094    3           THEN DO;
      797     5095    3              F$MEDDCB.ATTR.NOXLATE = '1'B;
      798     5096    3              IF NOT F$MEDDCB.MEDIA = FMTSYMB#
      799     5097    3              THEN
      800     5098    3                 USRDVBYTE = USRDVBYTE&~%DVBYTE_TRANS#|%DVBYTE_BP#;
      801     5099    3              CALL MEDIUM (MFC_WRITE, USRDVBYTE,
      802     5100    3                VFCCHAR) ALTRET(ALTRETUR);
      803     5101    3              END;
      804     5102    3           ELSE DO;
      805     5103    4              IF NOT USRDVBYTE&%DVBYTE_BP# THEN DO;
      806     5104    4                 IF F$MEDDCB.UBYTES=0 THEN GOTO BPEND;
      807     5105    4                 IF F$MEDDCB.UBYTES > 7
      808     5106    5                 THEN DO;
      809     5107        /*
      810     5108                         THIS STRANGE CODE IS DUE TO A PROBLEM WITH THE
      811     5109                         IMPLEMENTATION OF THE TCTR INSTRUCTION WHICH FAULTS
      812     5110                         WHEN ACCESSING THE FIRST DOUBLEWORD OF A SEGMENT
      813     5111                         WHICH IS NOT DOUBLEWORD ALIGNED. THE TCTR INSTRUCTION
      814     5112                         IS USED FOR ALL OF THE DATA BACK TO THE FIRST SEVEN
      815     5113                         BYTES.  IF A NON-BLANK HAS NOT BEEN FOUND, THE FIRST
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:27   
      816     5114                         SEVEN BYTES ARE EXAMINED ONE BYTE AT A TIME.
      817     5115        */
      818     5116    5                    I=F$MEDDCB.UBYTES - 7;
      819     5117    5                    CALL SEARCHR(F$MEDDCB.UBYTES,J,NK_URTBL_BP,
      820     5118    5                      PINCRC(F$MEDDCB.UB$,7)->CHARI) ALTRET(BPALLBLANK);
      821     5119    5                    F$MEDDCB.UBYTES = F$MEDDCB.UBYTES + 8;
      822     5120    5                    GOTO BPEND;
      823     5121    5   BPALLBLANK:      F$MEDDCB.UBYTES = 7;
      824     5122    5                    END;
      825     5123    4   BPLOOPER:     IF NK_URTBL_BP(ASCBIN(SUBSTR(F$MEDDCB.UB$->CHAR1,
      826     5124    5                   F$MEDDCB.UBYTES-1,1)))=BINASC(0) THEN DO;
      827     5125    5                    F$MEDDCB.UBYTES=F$MEDDCB.UBYTES-1;
      828     5126    5                    IF F$MEDDCB.UBYTES~=0 THEN GOTO BPLOOPER;
      829     5127    5                    END;
      830     5128    4   BPEND:        END;
      831     5129    3              IF F$MEDDCB.ATTR.LOWERCASE THEN
      832     5130    3                 CALL MEDIUM(MFC_WRUR,USRDVBYTE.GOOD,
      833     5131    3                   VFCCHAR) ALTRET(ALTRETUR);
      834     5132    3              ELSE
      835     5133    3                 CALL MEDIUM(MFC_WRURUC,USRDVBYTE.GOOD,
      836     5134    3                   VFCCHAR) ALTRET(ALTRETUR);
      837     5135    3              END;
      838     5136    3           IF CONTFORMMORE~=0 THEN DO;
      839     5137    3              NK$VFC.FCN=%VFCF_SPA;
      840     5138    3              NK$VFC.COUNT=CONTFORMMORE;
      841     5139    3              F$MEDDCB.UB$=ADDR(B$JIT);
      842     5140    3              F$MEDDCB.UBYTES=0;
      843     5141    3              GOTO MORESPA;
      844     5142    3              END;
      845     5143    2   RETUR:  ;
      846     5144    2           B$JIT.ERR='0'B;
      847     5145    2   ALTRETUR:;
      848     5146    2           RETURN;
      849     5147    2   END FORMATIT;
      850     5148        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:28   
      851     5149    1   MEDIUM: PROC(MFC,DVB,VFCC)ALTRET;
      852     5150    2   DCL MFC SBIN;
      853     5151    2   DCL SYMB_MFC SBIN;
      854     5152    2   DCL DVB BIT(9) ALIGNED;
      855     5153    2   DCL VFCC CHAR(1);
      856     5154    2   DCL FPTV$$ PTR;
      857     5155    2   DCL FPTV$ PTR ALIGNED BASED(FPTV$$);
      858     5156    2   DCL B$PS0$ PTR SYMREF READONLY;
      859     5157    3           DO CASE(F$MEDDCB.MEDIA);
      860     5158    3            CASE(FMTSYMB#);
      861     5159    3              FPTVI=FPTV;
      862     5160    3              FPTVI.DVBYTE=DVB;
      863     5161    3              IF ((DVB & %DVBYTE_TRANS#) OR
      864     5162    3                (F$MEDDCB.ATTR.GRLGL) OR
      865     5163    3                (F$MEDDCB.ATTR.NOXLATE) OR
      866     5164    3                (DVB & %DVBYTE_BIN#) ) THEN
      867     5165    3                 SYMB_MFC = MFC_WRITE; /* STRIP 9TH BIT */
      868     5166    3              ELSE IF F$MEDDCB.ATTR.NATL THEN
      869     5167    3                    SYMB_MFC = MFC_NATL;
      870     5168    3                 ELSE IF F$MEDDCB.ATTR.APL THEN
      871     5169    3                       SYMB_MFC = MFC_APL;
      872     5170    3                    ELSE IF F$MEDDCB.ATTR.LOWERCASE AND
      873     5171    3                         F$MEDDCB.ATTR.UPPERCASE THEN
      874     5172    3                          SYMB_MFC = MFC_WRUR;
      875     5173    3                       ELSE IF F$MEDDCB.ATTR.UPPERCASE AND
      876     5174    3                            NOT F$MEDDCB.ATTR.LOWERCASE THEN
      877     5175    3                             SYMB_MFC = MFC_WRURUC;
      878     5176    3                          ELSE IF F$MEDDCB.ATTR.LOWERCASE AND
      879     5177    3                               NOT F$MEDDCB.ATTR.UPPERCASE THEN
      880     5178    3                                SYMB_MFC = MFC_URLC;
      881     5179    4                             ELSE DO;
      882     5180    4                                SYMB_MFC = MFC_WRURUC;
      883     5181    4                                END;
      884     5182    3   CHUNKRET:  CALL FMH$SYMB(SYMB_MFC,FPTVI,VFCC)ALTRET(ALTORCHUNK);
      885     5183    3            CASE(FMTCG#);
      886     5184    3              CALL KCI$RWCG (MFC,DVB,VFCC,FPTV.EVENT,
      887     5185    3                F$USRDCB.SETSTA$->VSST) ALTRET (ALTRETUR);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:29   
      888     5186    3            CASE(FMTUC#);
      889     5187    3              IF ADDR(FPTV)~=B$PS0$ OR ADDR(VFCC)~=ADDR(VFCCHAR)
      890     5188    3              THEN FPTV$$ = ADDR(NIL);
      891     5189    3              ELSE FPTV$$ = ADDR(B$PS0$);
      892     5190    3              CALL KIA$UCIO(MFC,DVB,VFCC,FPTV.EVENT,FPTV$)ALTRET(ALTRETUR);
      893     5191    3            CASE(FMTOCCG#);
      894     5192    3              CALL OCU$RWUC(MFC,DVB,VFCC,FPTV.EVENT)ALTRET(ALTRETUR);
      895     5193    3            CASE(FMTDEV#);
      896     5194    3              CALL NKA$DEVIO(MFC,DVB,VFCC,FPTV.EVENT)ALTRET(ALTRETUR);
      897     5195
      898     5196    3            CASE(FMTNC#);
      899     5197    3              CALL KIS$OSI_WRITE ALTRET(ALTRETUR);
      900     5198
      901     5199    3            CASE(FMTREMOTE#);
      902     5200    3              F$MEDDCB.DVBYTE=DVB;
      903     5201    3              F$MEDDCB.VFCCHAR=VFCC;
      904     5202    3              CALL FMF$REMOTE(2);
      905     5203    3              IF B$JIT.ERR THEN ALTRETURN;
      906     5204    3            END;
      907     5205    2           RETURN;
      908     5206    2   ALTRETUR: ALTRETURN;
      909     5207    2   ALTORCHUNK: IF B$JIT.ERR~='000000000005'O THEN ALTRETURN;
      910     5208    2           CALL FSB$SWITCH ALTRET(ALTRETUR);
      911     5209    2           GOTO CHUNKRET;
      912     5210    2   END MEDIUM;
      913     5211        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:30   
      914     5212    1   PREPWRITE: PROC ALTRET;
      915     5213        /**This routine prepares WRITEs for the output formatter.
      916     5214          *It ALTRETURNs if the operation doesn't need the formatter.
      917     5215           . DVBYTE is BIN-VFC; JIT.ERR set.
      918     5216           . DVBYTE is BIN; the WRITE has been performed.
      919     5217           . DVBYTE is VFC and zero-length buffer; JIT.ERR is set.
      920     5218          *It RETURNs if the output formatter is needed.
      921     5219           .. USRDVBYTE is User DVBYTE, now always VFC.
      922     5220           .. VFCCHAR is the VFC character.
      923     5221        */
      924     5222    2           USRDVBYTE=FPTV.DVBYTE&%DVBYTE_USER#;
      925     5223    2           IF ((NOT F$USRDCB.ATTR.TRANSLGL) AND
      926     5224    2             F$MEDDCB.MEDIA = FMTSYMB#)
      927     5225    3           THEN DO;
      928     5226    3              IF (USRDVBYTE & %DVBYTE_TRANS#)
      929     5227    4              THEN DO; /* Force NOX on trans recs with no translgl */
      930     5228    4                 USRDVBYTE = USRDVBYTE & ~ %DVBYTE_TRANS# | %DVBYTE_BP#;
      931     5229        /* F$MEDDCB.ATTR.NOXLATE = '1'B; */ /* #31470 JLJ */
      932     5230    4                 END;
      933     5231    3              END;
      934     5232                /* That was to check the translegal FFLaG in the dcb.
      935     5233                   if that flag was set then the form specified
      936     5234                   translegal.  If that bit is 0 then translegal is not
      937     5235                   set and if the user specified transparancy we must
      938     5236                   not allow that.  That is done in the code above. If
      939     5237                   translegal is allowed then the user dv byte passes
      940     5238                   unscathed, otherwise transparancy is turned off. */
      941     5239    2           IF USRDVBYTE&%DVBYTE_BIN# THEN
      942     5240    3              IF USRDVBYTE&%DVBYTE_VFC# THEN DO;
      943     5241    3                 B$JIT.ERR=ERR$ILLBV;
      944     5242    3                 ALTRETURN;
      945     5243    3                 END;
      946     5244    3              ELSE DO;
      947     5245    4                 IF NOT F$USRDCB.ATTR.BIN THEN DO;
      948     5246    4                    B$JIT.ERR=ERR$CANTBIN;
      949     5247    4                    ALTRETURN;
      950     5248    4                    END;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:31   
      951     5249    4                 DO CASE(F$MEDDCB.MEDIA);
      952     5250    4                  CASE(FMTSYMB#);
      953     5251    5                    IF F$MEDDCB.DDEV.CP THEN DO;
      954     5252    6                       IF B$JIT.REMCPO=0 THEN DO;
      955     5253    7                          IF B$JIT.USER>JG_MING# THEN DO;
      956     5254    7                             B$JIT.XLIMFLG=B$JIT.XLIMFLG|%XL_PO#;
      957     5255    7                             B$JIT.RNST=B$JIT.RNST|%RS_LIMX#;
      958     5256    7                             GOTO RETUR;
      959     5257    7                             END;
      960     5258    6                          END;
      961     5259    5                       ELSE
      962     5260    5                          B$JIT.REMCPO=B$JIT.REMCPO-1;
      963     5261    5                       END;
      964     5262    4                    F$MEDDCB.FORM$->CODE16.RECNO=
      965     5263    4                      F$MEDDCB.FORM$->CODE16.RECNO+1;
      966     5264        /*  PGINGRAN will contain the number of records in a non-paged file
      967     5265            for SPACE and SYMBO keyin purposes.
      968     5266        */
      969     5267    4                    F$MEDDCB.PGINGRAN = F$MEDDCB.PGINGRAN + 1;
      970     5268    4   CHUNKRET:        CALL FMH$SYMB(MFC_WRBIN,FPTV)ALTRET(ALTORCHUNK);
      971     5269    4                  CASE(FMTCG#);
      972     5270    4                    CALL KCI$RWCG (MFC_WRBIN,USRDVBYTE.GOOD,'A',
      973     5271    4                      FPTV.EVENT,F$USRDCB.SETSTA$->VSST)
      974     5272    4                      ALTRET(ALTRETUR);
      975     5273    4                  CASE(FMTUC#);
      976     5274    4                    CALL KIA$UCIO(MFC_WRBIN,USRDVBYTE.GOOD,'A',
      977     5275    4                      FPTV.EVENT,ADDR(FPTV)) ALTRET(ALTRETUR);
      978     5276    4                  CASE(FMTOCCG#);
      979     5277    4                    CALL OCU$RWUC(MFC_WRBIN,USRDVBYTE.GOOD,'A',
      980     5278    4                      FPTV.EVENT) ALTRET(ALTRETUR);
      981     5279    4                  CASE(FMTDEV#);
      982     5280    4                    CALL NKA$DEVIO(MFC_WRBIN,USRDVBYTE.GOOD,'A',
      983     5281    4                      FPTV.EVENT) ALTRET(ALTRETUR);
      984     5282    4                  END;
      985     5283    3   RETUR:        ;
      986     5284    3                 B$JIT.ERR='0'B;
      987     5285    3   ALTRETUR:     ALTRETURN;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:32   
      988     5286    3                 END;
      989     5287    3           IF USRDVBYTE&%DVBYTE_VFC# THEN DO;
      990     5288    3              VFCCHAR=F$MEDDCB.UB$->CHAR1;
      991     5289    3              F$MEDDCB.UB$=PINCRC(F$MEDDCB.UB$,1);
      992     5290    3              F$MEDDCB.UBYTES=F$MEDDCB.UBYTES-1;
      993     5291    3              END;
      994     5292    2           ELSE
      995     5293    2              VFCCHAR=F$USRDCB.DVFC;
      996     5294    2           RETURN;
      997     5295    2   ALTORCHUNK: IF B$JIT.ERR~='000000000005'O THEN ALTRETURN;
      998     5296    2           CALL FSB$SWITCH ALTRET(ALTRETUR);
      999     5297    2           GOTO CHUNKRET;
     1000     5298    2   END PREPWRITE;
     1001     5299        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:33   
     1002     5300    1   FINDLINE: PROC ALTRET;
     1003     5301        /* ALTRET if no such hole in VFU image.*/
     1004     5302        /* RETURN with I=line# of next hole past currposn;
     1005     5303                       I=CODE16.LINES if none past curr.posn.*/
     1006     5304    2           J=NK$VFC.COUNT;
     1007     5305    3           IF J~=0 THEN DO;
     1008     5306    3              I=CODE16.VFCIM.LINE(J);
     1009     5307    4              IF I=0 THEN DO CASE(NK$VFC.FCN);
     1010     5308    4               CASE(%VFCF_SKB);
     1011     5309    4                 VFCCHAR='a'; UVFCLINES=1; ALTRETURN;
     1012     5310    4               CASE(%VFCF_SKA);
     1013     5311    4                 VFCCHAR='A'; UVFCLINES=1; ALTRETURN;
     1014     5312    4               END;
     1015     5313    3   LOOP:      ;
     1016     5314    3              IF I>CODE16.LINENO THEN RETURN;
     1017     5315    3              J=CODE16.VFCIM.NEXT(J);
     1018     5316    3              I=CODE16.VFCIM.LINE(J);
     1019     5317    3              IF J~=0 THEN GOTO LOOP;
     1020     5318    3              END;
     1021     5319    2           I=CODE16.LINES;
     1022     5320    2           RETURN;
     1023     5321    2   END FINDLINE;
     1024     5322        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:34   
     1025     5323    1   SETHEADER: PROC  ALTRET;
     1026     5324    3           IF USRDCB$=DCBADDR(%M$DO#) THEN DO;
     1027     5325    4              IF B$JIT.REMDO=0 THEN DO;
     1028     5326    5                 IF B$JIT.USER>JG_MING# THEN DO;
     1029     5327    5                    B$JIT.XLIMFLG=B$JIT.XLIMFLG|%XL_DO#;
     1030     5328    5                    B$JIT.RNST=B$JIT.RNST|%RS_LIMX#;
     1031     5329    5                    CODE16.LINENO = CODE16.LINES;
     1032     5330    5                    ALTRETURN;
     1033     5331    5                    END;
     1034     5332    4                 END;
     1035     5333    3              ELSE
     1036     5334    3                 B$JIT.REMDO=B$JIT.REMDO-1;
     1037     5335    3              END;
     1038     5336    3           ELSE DO;
     1039     5337    4              IF B$JIT.REMLO=0 THEN DO;
     1040     5338    5                 IF B$JIT.USER>JG_MING# THEN DO;
     1041     5339    5                    B$JIT.XLIMFLG=B$JIT.XLIMFLG|%XL_LO#;
     1042     5340    5                    B$JIT.RNST=B$JIT.RNST|%RS_LIMX#;
     1043     5341    5                    CODE16.LINENO = CODE16.LINES;
     1044     5342    5                    ALTRETURN;
     1045     5343    5                    END;
     1046     5344    4                 END;
     1047     5345    3              ELSE
     1048     5346    3                 B$JIT.REMLO=B$JIT.REMLO-1;
     1049     5347    3              END;
     1050     5348    2           HDR$=F$USRDCB.HEADER$;
     1051     5349    3           IF HDR$=ADDR(NIL) THEN DO;
     1052     5350    3              HDR$=F$MEDDCB.HEADER$;
     1053     5351    3              IF HDR$=ADDR(NIL) THEN
     1054     5352    3                 HDR$=ADDR(NULLHDR);
     1055     5353    3              END;
     1056     5354    2           CODE16.PAGENO=CODE16.PAGENO+1;
     1057     5355    2           F$MEDDCB.PGINGRAN = F$MEDDCB.PGINGRAN + 1;
     1058     5356    2           CODE16.LINENO=BITBIN(BINBIT(VLP$HDR.CTL.HEADERHEIGHT#,4));
     1059     5357    2           RETURN;
     1060     5358    2   END SETHEADER;
     1061     5359        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:35   
     1062     5360    1   DOHEADER: PROC ALTRET; /*WARNING: DON'T USE 'I' IN THIS ROUTINE */
     1063     5361    2           IF ((F$MEDDCB.DDEV & %DDEV_GR#) = %DDEV_GR#)
     1064     5362    3           THEN DO;
     1065     5363    3              RETURN; /* Don't do headers for graphics. */
     1066     5364    3              END;
     1067     5365    3           IF VLP$HDR.CTL.COUNT#~=0 THEN DO;
     1068     5366    3              J=CODE16.PAGENO-CODE16.PAGEBASE;
     1069     5367    3              K=J; L=0;
     1070     5368    4              DO WHILE (J>0); L=L+1; J=J/10; END;
     1071     5369    3              J=VLP$HDR.CTL.COUNT#-1;
     1072     5370    3              IF J>160 THEN J=160;
     1073     5371    4              DO WHILE ((L+J)>160); K=K/10; L=L-1; END;
     1074     5372    4              IF (L+J)>VLP$HDR.TITL.L# THEN DO;
     1075     5373    4                 VLP$HDRF.TITL.TITLE#= VLP$HDR.TITL.TITLE#;
     1076     5374    4                 VLP$HDR.TITL.L#=L+J;
     1077     5375    4                 END;
     1078     5376    3              IF L~=0 THEN
     1079     5377    3                 CALL BINCHAR(SUBSTR(VLP$HDR.TITL.TITLE#,J,L),K);
     1080     5378    3              END;
     1081     5379    2           SAVEUB$=F$MEDDCB.UB$;
     1082     5380    2           SAVEUBT=F$MEDDCB.UBYTES;
     1083     5381    2           F$MEDDCB.UB$=ADDR(VLP$HDR.TITL.TITLE#);
     1084     5382    2           F$MEDDCB.UBYTES=VLP$HDR.TITL.L#;
     1085     5383    2           IF F$MEDDCB.ATTR.LOWERCASE THEN
     1086     5384    2              CALL MEDIUM (MFC_WRUR, %DVBYTE_VFC#,
     1087     5385    2                BINASC(VLP$HDR.CTL.HEADERHEIGHT#+ASCBIN('p')) )
     1088     5386    2                ALTRET(ALTRETUR);
     1089     5387    2           ELSE
     1090     5388    2              CALL MEDIUM (MFC_WRURUC, %DVBYTE_VFC#,
     1091     5389    2                BINASC(VLP$HDR.CTL.HEADERHEIGHT#+ASCBIN('p')) )
     1092     5390    2                ALTRET(ALTRETUR);
     1093     5391    2           F$MEDDCB.UB$=SAVEUB$;
     1094     5392    2           F$MEDDCB.UBYTES=SAVEUBT;
     1095     5393    2           RETURN;
     1096     5394    2   ALTRETUR:;
     1097     5395    2           ALTRETURN;
     1098     5396    2   END DOHEADER;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:36   
     1099     5397        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:37   
     1100     5398    1   DDFTAB: PROC ALTRET;
     1101     5399    2           IF ((F$MEDDCB.DDEV & %DDEV_GR#) = %DDEV_GR#)
     1102     5400    3           THEN DO;
     1103     5401    3              RETURN; /* Don't do headers for graphics. */
     1104     5402    3              END;
     1105     5403    2           TAB$=F$USRDCB.TAB$;
     1106     5404    3           IF TAB$=ADDR(NIL) THEN DO;
     1107     5405    3              TAB$=F$MEDDCB.TAB$;
     1108     5406    3              IF TAB$=ADDR(NIL) THEN
     1109     5407    3                 TAB$=ADDR(TABZERO);
     1110     5408    3              END;
     1111     5409    2           IF F$MEDDCB.TAB$=ADDR(NIL) THEN
     1112     5410    2              F$MEDDCB.IWL.TABIWL=(TAB$->VLP$TAB=TABZERO);
     1113     5411    2           ELSE F$MEDDCB.IWL.TABIWL=
     1114     5412    2                (TAB$->VLP$TAB=F$MEDDCB.TAB$->VLP$TAB);
     1115     5413    3           IF (USRDCB$~=MEDDCB$)OR(USRDCB$=DCBADDR(3)) THEN DO;
     1116     5414    3              J=B$ROSEG$->B$ROSEG.NUMDCBS;
     1117     5415    4              DO WHILE (J>=%M$MAXNEG#);
     1118     5416    4                 SAVEUB$=DCBADDR(J);
     1119     5417    4                 IF SAVEUB$~=ADDR(NIL) THEN
     1120     5418    4                    IF (SAVEUB$->F$DCB.CFU$=MEDDCB$)
     1121     5419    4                      AND SAVEUB$->F$DCB.FCD THEN
     1122     5420    4                       IF SAVEUB$->F$DCB.TAB$=ADDR(NIL) THEN
     1123     5421    4                          SAVEUB$->F$DCB.IWL.TABIWL=
     1124     5422    4                            F$MEDDCB.IWL.TABIWL;
     1125     5423    4                       ELSE SAVEUB$->F$DCB.IWL.TABIWL=
     1126     5424    4                            (TAB$->VLP$TAB=SAVEUB$->F$DCB.TAB$->
     1127     5425    4                            VLP$TAB);
     1128     5426    4                 J=J-1;
     1129     5427    4                 END;
     1130     5428    3              END;
     1131     5429    2           SAVEUB$=F$MEDDCB.UB$;
     1132     5430    2           SAVEUBT=F$MEDDCB.UBYTES;
     1133     5431    2           F$MEDDCB.UB$=TAB$;
     1134     5432    2           F$MEDDCB.UBYTES=SIZEC(VLP$TAB);
     1135     5433    2           IF F$MEDDCB.ASN ~= %COMGROUP#
     1136     5434    2           THEN CALL MEDIUM(MFC_WRITE, %DVBYTE_VFC#|%DVBYTE_TRANS#,
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:38   
     1137     5435    2                %VFC_OTB) ALTRET(ALTRETUR);
     1138     5436    2           IF F$MEDDCB.FORM$~=ADDR(NIL) THEN
     1139     5437    2              F$MEDDCB.FORM$->CODE16.OLDTABS= TAB$->VLP$TAB;
     1140     5438    2           F$MEDDCB.UB$=SAVEUB$;
     1141     5439    2           F$MEDDCB.UBYTES=SAVEUBT;
     1142     5440    2           RETURN;
     1143     5441    2   ALTRETUR:;
     1144     5442    2           ALTRETURN;
     1145     5443    2   END DDFTAB;
     1146     5444        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:39   
     1147     5445    1   DDFHEADER: PROC ALTRET;
     1148     5446    2           F$USRDCB.IWL.HDRIWL='1'B;
     1149     5447    2           SAVEUB$=F$MEDDCB.UB$;
     1150     5448    2           SAVEUBT=F$MEDDCB.UBYTES;
     1151     5449    2           F$MEDDCB.UB$=F$USRDCB.HEADER$;
     1152     5450    2           F$MEDDCB.UBYTES=SIZEC(VLP$HDRF);
     1153     5451    3           IF F$MEDDCB.UB$=ADDR(NIL) THEN DO;
     1154     5452    3              F$MEDDCB.UBYTES=0;
     1155     5453    3              F$MEDDCB.UB$=ADDR(F$MEDDCB.UB$);
     1156     5454    3              END;
     1157     5455    2           CALL MEDIUM(MFC_WRITE, %DVBYTE_VFC#|%DVBYTE_TRANS#,
     1158     5456    2             %VFC_SHDR) ALTRET(ALTRETUR);
     1159     5457    2           F$MEDDCB.UB$ -> VLP$HDR.CTL.RESETPAGE# = '0'B;
     1160     5458    2           F$MEDDCB.UB$=SAVEUB$;
     1161     5459    2           F$MEDDCB.UBYTES=SAVEUBT;
     1162     5460    2           RETURN;
     1163     5461    2   ALTRETUR:;
     1164     5462    2           ALTRETURN;
     1165     5463    2   END DDFHEADER;
     1166     5464        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:40   
     1167     5465        /**/
     1168     5466    1   FSE$URFILE: ENTRY(FPTCODE,FPTV)ALTRET;
     1169     5467    1           USRDCB$=B$JIT.DCB$;
     1170     5468    2           DO CASE(F$USRDCB.MEDIA);
     1171     5469    2            CASE(FMTCON#); MEDIUMX=%FMH$CPMME#;
     1172     5470    2            CASE(FMTTAPE#); MEDIUMX=%FTW$WRAT#;
     1173     5471    2            CASE(ELSE);
     1174     5472    2              B$JIT.ERR=ERR$UNIMP;
     1175     5473    2              ALTRETURN;
     1176     5474    2            END;
     1177     5475    1           IF FPTCODE ~= FPTWRITE
     1178     5476    2           THEN DO;
     1179     5477    2              CALL MEDIUMEP(FPTCODE,FPTV)ALTRET(ALTRETUR);
     1180     5478    2              RETURN;
     1181     5479    2              END;
     1182     5480    1           FPTVI=FPTV;
     1183     5481    1           FORM$=F$USRDCB.FORM$;
     1184     5482    2           IF NOT F$USRDCB.IWL.TABIWL THEN DO;
     1185     5483    2              SAVEUB$=F$USRDCB.UB$;
     1186     5484    2              SAVEUBT=F$USRDCB.UBYTES;
     1187     5485    2              F$USRDCB.UB$=F$USRDCB.TAB$;
     1188     5486    2              IF F$USRDCB.UB$=ADDR(NIL) THEN
     1189     5487    2                 F$USRDCB.UB$=ADDR(TABZERO);
     1190     5488    2              F$USRDCB.UBYTES=SIZEC(VLP$TAB);
     1191     5489    2              FPTVI.DVBYTE=%DVBYTE_VFC#|%DVBYTE_TRANS#;
     1192     5490    2              CALL MEDIUMEP(MFC_WRITE,FPTVI,%VFC_OTB)ALTRET(ALTRETUR);
     1193     5491    2              CODE16.OLDTABS=F$USRDCB.UB$->VLP$TAB;
     1194     5492    2              F$USRDCB.IWL.TABIWL='1'B;
     1195     5493    2              F$USRDCB.UB$=SAVEUB$;
     1196     5494    2              F$USRDCB.UBYTES=SAVEUBT;
     1197     5495    2              END;
     1198     5496    1           USRDVBYTE=FPTV.DVBYTE&'370'O;
     1199     5497    1           IF USRDVBYTE&%DVBYTE_BIN# THEN
     1200     5498    2              IF USRDVBYTE&%DVBYTE_VFC# THEN DO;
     1201     5499    2                 B$JIT.ERR=ERR$ILLBV;
     1202     5500    2                 ALTRETURN;
     1203     5501    2                 END;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:41   
     1204     5502    1              ELSE
     1205     5503    2                 IF NOT F$USRDCB.ATTR&%ATTR_BIN# THEN DO;
     1206     5504    2                    B$JIT.ERR=ERR$CANTBIN;
     1207     5505    2                    ALTRETURN;
     1208     5506    2                    END;
     1209     5507    2                 ELSE DO;
     1210     5508    2                    CODE16.RECNO=CODE16.RECNO+1;
     1211     5509    2                    CALL MEDIUMEP(MFC_WRBIN,FPTV)ALTRET(ALTRETUR);
     1212     5510    2                    RETURN;
     1213     5511    2                    END;
     1214     5512    1           IF USRDVBYTE&%DVBYTE_VFC# THEN
     1215     5513    2           DO;
     1216     5514    2              VFCCHAR=F$USRDCB.UB$->CHAR1;
     1217     5515    2              F$USRDCB.UB$=PINCRC(F$USRDCB.UB$,1);
     1218     5516    2              F$USRDCB.UBYTES=F$USRDCB.UBYTES-1;
     1219     5517    2              END;
     1220     5518    2           ELSE DO;
     1221     5519    2              VFCCHAR=F$USRDCB.DVFC;
     1222     5520    2              USRDVBYTE=USRDVBYTE|%DVBYTE_VFC#;
     1223     5521    2              END;
     1224     5522    1   MORESPA: CONTFORMMORE=0;
     1225     5523    2           IF F$USRDCB.DDEV.LP THEN DO;
     1226     5524    3              DO CASE(NK$VFC.FCN);
     1227     5525    3               CASE(%VFCF_HDR);
     1228     5526    3                 CODE16.PAGENO=CODE16.PAGENO+1;
     1229     5527    3                 F$USRDCB.PGINGRAN = F$USRDCB.PGINGRAN + 1;
     1230     5528    3                 CODE16.LINENO=NK$VFC.COUNT;
     1231     5529    3                 USRDVBYTE=USRDVBYTE|%DVBYTE_TOP#;
     1232     5530    3                 CODE16.NOTCOL1=(NK$VFC.COUNT=0);
     1233     5531    3               CASE(%VFCF_SKB);
     1234     5532    3                 CALL URFILFINDLINE;
     1235     5533    4                 IF I=0 THEN DO; /* No such line in VFU.*/
     1236     5534    4                    UVFCLINES=1; /* Treat as space 1 before.*/
     1237     5535    4                    GOTO ASIFSPB;
     1238     5536    4                    END;
     1239     5537    4                 ELSE IF I>=F$USRDCB.LINES THEN DO;
     1240     5538    4                       CALL URFILHDR ALTRET(ALTRETUR);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:42   
     1241     5539    4                       CALL URFILFINDLINE;
     1242     5540    5                       IF I>=F$USRDCB.LINES THEN DO;
     1243     5541    5                          IF HDR$~=ADDR(NIL) THEN
     1244     5542    5                             VFCCHAR='`';
     1245     5543    5                          I=CODE16.LINENO;
     1246     5544    5                          END;
     1247     5545    4                       END;
     1248     5546    3                 CODE16.LINENO=I;
     1249     5547    3                 CODE16.NOTCOL1=%YES#;
     1250     5548    3               CASE(%VFCF_SPB);
     1251     5549    3                 UVFCLINES=NK$VFC.COUNT;
     1252     5550    3   ASIFSPB:      I=CODE16.LINENO+UVFCLINES;
     1253     5551    4                 IF I>=F$USRDCB.LINES THEN DO;
     1254     5552    4                    IF CODE16.CONTFORM THEN
     1255     5553    5                       IF CODE16.LINENO<F$USRDCB.LINES THEN DO;
     1256     5554    5                          UVFCLINES=UVFCLINES-
     1257     5555    5                            (F$USRDCB.LINES-CODE16.LINENO);
     1258     5556    5                          I=CODE16.LINENO+UVFCLINES;
     1259     5557    5                          END;
     1260     5558    4                    CALL URFILHDR ALTRET(ALTRETUR);
     1261     5559    4                    I=CODE16.LINENO+UVFCLINES;
     1262     5560    5                    IF I>=F$USRDCB.LINES THEN DO;
     1263     5561    5                       IF HDR$~=ADDR(NIL) THEN
     1264     5562    5                          VFCCHAR='`';
     1265     5563    5                       I=CODE16.LINENO;
     1266     5564    5                       END;
     1267     5565    4                    END;
     1268     5566    3                 CODE16.LINENO=I;
     1269     5567    3                 CODE16.NOTCOL1=%YES#;
     1270     5568    3               CASE(%VFCF_SKA);
     1271     5569    4                 IF CODE16.LINENO>=F$USRDCB.LINES THEN DO;
     1272     5570    4                    CALL URFILHDR ALTRET(ALTRETUR);
     1273     5571    4                    END;
     1274     5572    3                 CODE16.NOTCOL1=%NO#;
     1275     5573    3                 CALL URFILFINDLINE;
     1276     5574    3                 IF I=0 THEN /* No such line in VFU.*/
     1277     5575    3                    I=CODE16.LINENO+1;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:43   
     1278     5576    3                 IF I>=F$USRDCB.LINES THEN
     1279     5577    3                    CODE16.LINENO=CODE16.LINES;
     1280     5578    3                 ELSE
     1281     5579    3                    CODE16.LINENO=I;
     1282     5580    3               CASE(%VFCF_SPA);
     1283     5581    3                 UVFCLINES=NK$VFC.COUNT;
     1284     5582    4   ASIFSPA:      IF CODE16.LINENO>=F$USRDCB.LINES THEN DO;
     1285     5583    4                    CALL URFILHDR ALTRET(ALTRETUR);
     1286     5584    4                    END;
     1287     5585    3                 CODE16.NOTCOL1=(UVFCLINES=0);
     1288     5586    4                 IF CODE16.LINENO+UVFCLINES>=F$USRDCB.LINES THEN DO;
     1289     5587    4                    IF CODE16.CONTFORM AND
     1290     5588    5                      (CODE16.LINENO<F$USRDCB.LINES) THEN DO;
     1291     5589    5                       CONTFORMMORE=UVFCLINES-(F$USRDCB.LINES-CODE16.LINENO);
     1292     5590    6                       IF CONTFORMMORE~=0 THEN DO;
     1293     5591    7                          IF F$USRDCB.HEADER$~=ADDR(NIL) THEN DO;
     1294     5592    7                             NK$VFC.COUNT=NK$VFC.COUNT-CONTFORMMORE;
     1295     5593    7                             CODE16.LINENO=CODE16.LINES;
     1296     5594    7                             END;
     1297     5595    7                          ELSE DO;
     1298     5596    7                             CODE16.PAGENO=CODE16.PAGENO+1;
     1299     5597    7                             F$USRDCB.PGINGRAN = F$USRDCB.PGINGRAN + 1;
     1300     5598    7                             CODE16.LINENO=CONTFORMMORE;
     1301     5599    7                             CONTFORMMORE=0;
     1302     5600    7                             END;
     1303     5601    6                          END;
     1304     5602    5                       ELSE CODE16.LINENO=CODE16.LINES;
     1305     5603    5                       END;
     1306     5604    4                    ELSE CODE16.LINENO=CODE16.LINES;
     1307     5605    4                    END;
     1308     5606    3                 ELSE
     1309     5607    3                    CODE16.LINENO=CODE16.LINENO+UVFCLINES;
     1310     5608    3               CASE(%VFCF_SPC);
     1311     5609    4                 DO CASE(NK$VFC.COUNT);
     1312     5610    4                  CASE(%VFCS_ITAB);
     1313     5611    4                    RETURN;
     1314     5612    4                  CASE(%VFCS_OTAB,%VFCS_SEQN);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:44   
     1315     5613    4                    USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;
     1316     5614    4                  CASE(%VFCS_SPRM,%VFCS_SPRO);
     1317     5615    4                    RETURN;
     1318     5616    4                  CASE(%VFCS_SLLN,%VFCS_SLLP);
     1319     5617    4                    RETURN;
     1320     5618    4                  CASE(%VFCS_SHDR);
     1321     5619    4                    RETURN;
     1322     5620    4                  CASE(%VFCS_SLPP);
     1323     5621    4                    RETURN;
     1324     5622    4                  CASE(%VFCS_PGND,%VFCS_CLRWND);
     1325     5623    4                    CODE16.LINENO=CODE16.LINES;
     1326     5624    4                  CASE(%VFCS_VFU);
     1327     5625    4                    RETURN;
     1328     5626    4                  CASE(ELSE);
     1329     5627    4                    B$JIT.ERR=ERR$INVVFC;
     1330     5628    4                    ALTRETURN;
     1331     5629    4                  CASE(%VFCS_TRS0);
     1332     5630    4                    UVFCLINES=0;
     1333     5631    4                    IF CODE16.NOTCOL1 THEN
     1334     5632    4                       IF CODE16.LINENO+1<F$USRDCB.LINES THEN
     1335     5633    4                          UVFCLINES=1;
     1336     5634    4                       ELSE
     1337     5635    4                          CODE16.LINENO=CODE16.LINES;
     1338     5636    4                    GOTO ASIFSPB;
     1339     5637    4                  CASE(%VFCS_TRS1);
     1340     5638    4                    IF CODE16.NOTCOL1 THEN
     1341     5639    4                       CODE16.LINENO=CODE16.LINENO+1;
     1342     5640    4                    UVFCLINES=1;
     1343     5641    4                    GOTO ASIFSPA;
     1344     5642    4                  END;
     1345     5643    3               CASE(ELSE);
     1346     5644    3                 B$JIT.ERR=ERR$INVVFC;
     1347     5645    3                 ALTRETURN;
     1348     5646    3               END/*CASE(NK$VFC.FCN)*/;
     1349     5647    2              END/*F$USRDCB.DDEV.LP*/;
     1350     5648    2           ELSE DO;
     1351     5649    2              CODE16.RECNO=CODE16.RECNO+1;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:45   
     1352     5650        /*  PGINGRAN will contain the number of records in a non-paged file
     1353     5651            for SPACE and SYMBO keyin purposes.
     1354     5652        */
     1355     5653    2              F$USRDCB.PGINGRAN = F$USRDCB.PGINGRAN + 1;
     1356     5654    2              END;
     1357     5655    2           IF USRDVBYTE&%DVBYTE_TRANS# THEN DO;
     1358     5656    2              FPTVI.DVBYTE=USRDVBYTE.GOOD;
     1359     5657    2              CALL MEDIUMEP(MFC_WRITE,FPTVI,VFCCHAR)ALTRET(ALTRETUR);
     1360     5658    2              END;
     1361     5659    2           ELSE DO;
     1362     5660    3              IF NOT USRDVBYTE&%DVBYTE_BP# AND NOT FPTVI.REWRITE THEN DO;
     1363     5661    3                 IF F$USRDCB.UBYTES=0 THEN GOTO BPEND;
     1364     5662    3                 IF F$USRDCB.UBYTES > 7
     1365     5663    4                 THEN DO;
     1366     5664        /*
     1367     5665                         THIS STRANGE CODE IS DUE TO A PROBLEM WITH THE
     1368     5666                         IMPLEMENTATION OF THE TCTR INSTRUCTION WHICH FAULTS
     1369     5667                         WHEN ACCESSING THE FIRST DOUBLEWORD OF A SEGMENT
     1370     5668                         WHICH IS NOT DOUBLEWORD ALIGNED. THE TCTR INSTRUCTION
     1371     5669                         IS USED FOR ALL OF THE DATA BACK TO THE FIRST SEVEN
     1372     5670                         BYTES.  IF A NON-BLANK HAS NOT BEEN FOUND, THE FIRST
     1373     5671                         SEVEN BYTES ARE EXAMINED ONE BYTE AT A TIME.
     1374     5672        */
     1375     5673    4                    I=F$USRDCB.UBYTES - 7;
     1376     5674    4                    CALL SEARCHR(F$USRDCB.UBYTES,J,NK_URTBL_BP,
     1377     5675    4                      PINCRC(F$USRDCB.UB$,7)->CHARI) ALTRET(BPALLBLANK);
     1378     5676    4                    F$USRDCB.UBYTES = F$USRDCB.UBYTES + 8;
     1379     5677    4                    GOTO BPEND;
     1380     5678    4   BPALLBLANK:      F$USRDCB.UBYTES = 7;
     1381     5679    4                    END;
     1382     5680    3   BPLOOPER:     IF NK_URTBL_BP(ASCBIN(SUBSTR(F$USRDCB.UB$->CHAR1,
     1383     5681    4                   F$USRDCB.UBYTES-1,1)))=BINASC(0) THEN DO;
     1384     5682    4                    F$USRDCB.UBYTES=F$USRDCB.UBYTES-1;
     1385     5683    4                    IF F$USRDCB.UBYTES~=0 THEN GOTO BPLOOPER;
     1386     5684    4                    END;
     1387     5685    3   BPEND:        END;
     1388     5686    2              FPTVI.DVBYTE=USRDVBYTE.GOOD;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:46   
     1389     5687    2              CALL MEDIUMEP(MFC_WRUR,FPTVI,VFCCHAR)ALTRET(ALTRETUR);
     1390     5688    2              END;
     1391     5689    2           IF CONTFORMMORE~=0 THEN DO;
     1392     5690    2              NK$VFC.COUNT=CONTFORMMORE;
     1393     5691    2              F$USRDCB.UB$=ADDR(B$JIT);
     1394     5692    2              F$USRDCB.UBYTES=0;
     1395     5693    2              GOTO MORESPA;
     1396     5694    2              END;
     1397     5695    1           RETURN;
     1398     5696    1   ALTRETUR: IF B$JIT.ERR.CODE~=0 THEN ALTRETURN;
     1399     5697    1           RETURN;
     1400     5698        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:47   
     1401     5699    1   URFILFINDLINE: PROC;
     1402     5700        /* RETURN with I=0 if no such hole in VFU image.*/
     1403     5701        /* RETURN with I=line# of next hole past currposn;
     1404     5702                       I=CODE16.LINES if none past curr.posn.*/
     1405     5703    2           J=NK$VFC.COUNT;
     1406     5704    3           IF J~=0 THEN DO;
     1407     5705    3              I=CODE16.VFCIM.LINE(J);
     1408     5706    3              IF I=0 THEN RETURN;
     1409     5707    3   LOOP:      IF I>CODE16.LINENO THEN RETURN;
     1410     5708    3              J=CODE16.VFCIM.NEXT(J);
     1411     5709    3              I=CODE16.VFCIM.LINE(J);
     1412     5710    3              IF J~=0 THEN GOTO LOOP;
     1413     5711    3              END;
     1414     5712    2           I=CODE16.LINES;
     1415     5713    2           RETURN;
     1416     5714    2   END URFILFINDLINE;
     1417     5715        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:48   
     1418     5716    1   URFILHDR: PROC ALTRET; /*WARNING: DON'T USE 'I' IN THIS ROUTINE */
     1419     5717    2           CODE16.PAGENO=CODE16.PAGENO+1;
     1420     5718    2           F$USRDCB.PGINGRAN = F$USRDCB.PGINGRAN + 1;
     1421     5719    2           HDR$=F$USRDCB.HEADER$;
     1422     5720    3           IF HDR$=ADDR(NIL) THEN DO;
     1423     5721    3              USRDVBYTE=USRDVBYTE|%DVBYTE_TOP#;
     1424     5722    3              CODE16.LINENO=0;
     1425     5723    3              RETURN;
     1426     5724    3              END;
     1427     5725    2           CODE16.LINENO=VLP$HDR.CTL.HEADERHEIGHT#;
     1428     5726    3           IF VLP$HDR.CTL.COUNT#~=0 THEN DO;
     1429     5727    3              J=CODE16.PAGENO-CODE16.PAGEBASE;
     1430     5728    3              K=J; L=0;
     1431     5729    4              DO WHILE(J>0); L=L+1;J=J/10;END;
     1432     5730    3              J=VLP$HDR.CTL.COUNT#-1;
     1433     5731    4              DO WHILE((J+L)>160); K=K/10;L=L-1;END;
     1434     5732    3              IF (J+L)>VLP$HDR.TITL.L# THEN
     1435     5733    3                 VLP$HDR.TITL.L#=J+L;
     1436     5734    3              IF L>0 THEN
     1437     5735    3                 CALL BINCHAR(SUBSTR(VLP$HDR.TITL.TITLE#,J,L),K);
     1438     5736    3              END;
     1439     5737    2           SAVEUB$=F$USRDCB.UB$;
     1440     5738    2           SAVEUBT=F$USRDCB.UBYTES;
     1441     5739    2           F$USRDCB.UB$=ADDR(VLP$HDR.TITL.TITLE#);
     1442     5740    2           F$USRDCB.UBYTES=VLP$HDR.TITL.L#;
     1443     5741    2           FPTVI.DVBYTE=%DVBYTE_VFC#|%DVBYTE_TOP#;
     1444     5742    2           CALL MEDIUMEP(MFC_WRUR,FPTVI,
     1445     5743    2             BINASC(VLP$HDR.CTL.HEADERHEIGHT#+ASCBIN('p')))
     1446     5744    2             ALTRET(ALTR);
     1447     5745    2           F$USRDCB.UB$=SAVEUB$;
     1448     5746    2           F$USRDCB.UBYTES=SAVEUBT;
     1449     5747    2           RETURN;
     1450     5748    2   ALTR:   ALTRETURN;
     1451     5749    2   END URFILHDR;
     1452     5750        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:49   
     1453     5751    1   MEDIUMEP: PROC(FCN,FPT,VFC) ALTRET;
     1454     5752        /**/
     1455     5753    2   DCL FCN UBIN;
     1456     5754    2   DCL FPT UBIN;
     1457     5755    2   DCL VFC UBIN;
     1458     5756        /**/
     1459     5757    3           DO CASE(MEDIUMX);
     1460     5758    3            CASE(%FMH$CPMME#);
     1461     5759    4              CALL FMH$CPMME(FCN,FPT,VFC) WHENALTRETURN DO;
     1462     5760    4                 ALTRETURN;
     1463     5761    4                 END;
     1464     5762    3            CASE(%FTW$WRAT#);
     1465     5763    4              CALL FTW$WRAT(FCN,FPT,VFC) WHENALTRETURN DO;
     1466     5764    4                 ALTRETURN;
     1467     5765    4                 END;
     1468     5766    3            END;
     1469     5767    2           RETURN;
     1470     5768        /**/
     1471     5769    2   END MEDIUMEP;
     1472     5770    1   END FSE$FORMAT;
     1473     5771        %EOD;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:50   
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   F$CP6V_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FSE$FORMAT.

   Procedure FSE$FORMAT requires 3099 words for executable code.
   Procedure FSE$FORMAT requires 48 words of local(AUTO) storage.

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:51   

 Object Unit name= FSE$FORMAT                                 File name= FSE$FORMAT.:E05TOU
 UTS= JUL 29 '97 17:29:57.52 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS    144    220  FSE$FORMAT
    1   Proc  even  none  3099   6033  FSE$FORMAT
    2  RoData even  none    36     44  FSE$FORMAT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  FSE$FORMAT
     1      3          yes     yes      Std        2  FSE$URSTREAM
     1     12          yes     yes      Std        2  FSE$UR
     1     21          yes     yes      Std        2  FSE$GRSTRM
     1     30          yes     yes      Std        2  FSE$GR
     1     37          yes     yes      Std        2  FSE$FPSTREAM
     1     46          yes     yes      Std        2  FSE$FPRG
     1     55          yes     yes      Std        2  FSE$NC
     1     71          yes     yes      Std        2  FSE$TTYSTREAM
     1    102          yes     yes      Std        2  FSE$TTY
     1   4501          yes     yes      Std        2  FSE$URFILE
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:52   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMO$GETPFB
 yes     yes           Std       5 KIA$UCIO
 yes     yes           Std       4 OCU$RWUC
 yes     yes           Std       0 FSD$C1
 yes     yes           Std       0 FSD$C1END
         yes           Std       1 HFC$UNLOCK
         yes           Std       1 FMO$GETDOMAIN
         yes           Std       2 NKA$EVENT
 yes     yes           Std       5 KCI$RWCG
         yes           Std       1 HFC$LOCK
 yes     yes           Std       0 FSD$REW
 yes     yes           Std       5 NKA$DEVIO
 yes     yes           Std       3 FMH$SYMB
 yes     yes           Std       0 KIS$OSI_READ
 yes     yes           Std       0 FSB$SWITCH
 yes     yes           Std       0 KIS$OSI_WRITE
         yes           Std       1 FMF$REMOTE
 yes     yes           Std       3 FMH$CPMME
 yes     yes           Std       3 FTW$WRAT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_FSBADDCB                      r    B$JIT$                           r    B$ROSEG$
     F_DCBLOCK                        r    B$PS0$                                B_VECTNIL
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:53   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 ASLENTSID                             ISSID
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:54   


        1        1        /*M* FSE$FORMAT Perform PMME's to DCB's with real formatting layer */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* CLM=8,DMR,MOC,CTI=2 */
        8        8        /*P*    NAME: FSE$FORMAT
        9        9         *      PURPOSE: FSE$FORMAT handles user PMME's to DCB's with real
       10       10         *         formatting layers (Unit-Record, TTY, etc.).
       11       11         *            For a given type of formatting, there are usually two
       12       12         *         entry points: one for DCB's which are directly attached
       13       13         *         to the I/O medium, and another for DCB's which are streamed
       14       14         *         to another DCB.  The processing for streamed DCB's is
       15       15         *         complicated by the fact that any part of the formatting may
       16       16         *         be specified in either DCB.
       17       17         */
       18       18        FSE$FORMAT: PROC(FPTCODE,FPTV) ALTRET;

     18  1 000000   000000 700200 xent  FSE$FORMAT   TSX0  ! X66_AUTO_2
         1 000001   000060 000002                    ZERO    48,2
         1 000002   000005 710000 1                  TRA     s:4503

       19       19    1   DCL FPTCODE SBIN; /* FPT code from PMME */
       20       20        %INCLUDE F$CP6V_C;
       21      246        %FPT$WRITE_V(FPTN=FPTV,BASED=); /* FPTV is V area of PMME FPT. */
       22      252        %FPT$PRECORD_V(FPTN=PRECORDFPT);
       23      257        /**/
       24      258        /* INCLUDE FILES */
       25      259        /**/
       26      260        %INCLUDE B$JIT;
       27      863        %INCLUDE B$ROSEG;
       28      926        %INCLUDE B_SEGIDS_C;
       29     1465        %INCLUDE B_STRINGS_C;
       30     1594        %INCLUDE CP_6_SUBS;
       31     2134        %INCLUDE FM$MACROS;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:55   
       32     2509        %INCLUDE F_CP6;
       33     3534        %INCLUDE F_ERRORS_C;
       34     3774        %INCLUDE F_FMTCODE_C;
       35     3808        %INCLUDE F_FPTCODE_C;
       36     3844        %INCLUDE F$DCB;
       37     3893        %INCLUDE JG_GHOSTS_C;
       38     3983        %INCLUDE HF_LOCK_C;
       39     3997        %INCLUDE KC$CP6V_C;
       40     4117        %INCLUDE NK_VFC_C;
       41     4191        /**/
       42     4192        /* EXTERNAL ROUTINES */
       43     4193        /**/
       44     4194    1   DCL FMH$CPMME ENTRY(3)ALTRET; /* Perform I/O to UR disk file */
       45     4195    1   DCL FMH$SYMB ENTRY(3)ALTRET; /* Perform I/O to Symbiont file */
       46     4196    1   DCL NKA$DEVIO ENTRY(5)ALTRET; /* Perform I/O to Unit Record Devices */
       47     4197    1   DCL FMF$REMOTE ENTRY(1);
       48     4198    1   DCL KIA$UCIO ENTRY(5)ALTRET; /* Perform I/O to T/S terminals       */
       49     4199    1   DCL KIS$OSI_READ ENTRY(0)ALTRET; /* Perform I/O to Network Connections */
       50     4200    1   DCL KIS$OSI_WRITE ENTRY(0)ALTRET; /* Perform I/O to Network Connections */
       51     4201    1   DCL KCI$RWCG ENTRY(5)ALTRET; /* Perform I/O to Comgroups           */
       52     4202    1   DCL OCU$RWUC ENTRY(4)ALTRET; /* Perform I/O to OC Comgroups        */
       53     4203    1   DCL FTW$WRAT ENTRY(3)ALTRET; /* Perform I/O to Tapes */
       54     4204    1   DCL FSD$C1 ENTRY ALTRET; /* Perform I/O to command file.*/
       55     4205    1   DCL FSD$C1END ENTRY ALTRET; /* Advance to next CC at end of XEQ.*/
       56     4206    1   DCL FSD$REW ENTRY ALTRET; /* Rewind XEQ file.*/
       57     4207    1   DCL NKA$EVENT ENTRY(2); /* Report Event for Nowait Event I/O  */
       58     4208    1   DCL FSB$SWITCH ENTRY ALTRET; /* Switch to new symfile chunk*/
       59     4209    1   DCL FMO$GETDOMAIN ENTRY(1); /* Get domain (WSR) of PMME'er*/
       60     4210    1   DCL FMO$GETPFB ENTRY(1);
       61     4211    1   DCL SC_FSBADDCB ENTRY CONV(2,0);
       62     4212        /*S*    SCREECH_CODE:  FSE-S$FSBADDCB
       63     4213                TYPE: SUA
       64     4214                MESSAGE: Bad I/O Medium code detected in a DCB. */
       65     4215        /* Note: This screech occurs several places in this module, so its
       66     4216           description occurs here instead of at all the calls.*/
       67     4217        /**/
       68     4218        /* EXTERNAL DATA */
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:56   
       69     4219        /**/
       70     4220    1   DCL B$JIT$ PTR SYMREF READONLY;
       71     4221    1   DCL B$ROSEG$ PTR SYMREF READONLY;
       72     4222    1   DCL F_DCBLOCK BIT(72) SYMREF;
       73     4223        /**/
       74     4224        /* LOCAL NON-AUTOMATIC ITEMS */
       75     4225        /**/
       76     4226        %SUB F$USRDCB="USRDCB$->F$DCB";
       77     4227        %SUB F$MEDDCB="MEDDCB$->F$DCB";
       78     4228        %VLP$SETSTA_V (FPTN=VSST); /* BASED VLP_SETSTA FOR CALLS */
       79     4240        %VLP$STATION_V (FPTN=VSTA); /* BASED VLP_STATION FOR LASTSTA MOVE*/
       80     4252        %CODE16(BASED="BASED(FORM$)");
       81     4260        %VLP_TAB(FPTN=VLP$TAB,STCLASS="BASED(TAB$)");
       82     4274        %VLP_HDR(FPTN=VLP$HDR,STCLASS="BASED(HDR$)",LEN="VLP$HDR.TITL.L#");
       83     4290        %VLP_HDR(FPTN=VLP$HDRF,STCLASS="BASED(HDR$)",LEN=160);
       84     4306        %VLP_TAB(FPTN=TABZERO,STCLASS=CONSTANT);
       85     4320        %VLP_HDR(FPTN=NULLHDR,STCLASS=CONSTANT,HEADERHEIGHT=0);
       86     4336        %SUB FCG#="'0623'O";
       87     4337        %SUB MID#="'05'O";
       88     4338        %ERRCODE(NAME=ERR$EOF,COD#=%E$EOF);
       89     4342        /*E*    ERROR:   FSE-E$EOF-2
       90     4343                MESSAGE: End of file.
       91     4344                MESSAGE1: End of file; no more control commands are left for
       92     4345                          your batch job.
       93     4346         */
       94     4347        %ERRCODE(NAME=ERR$UNIMP,COD#=%E$UNIMP);
       95     4351        /*E*    ERROR:   FSE-E$UNIMP-2
       96     4352                MESSAGE: Unimplemented I/O Medium.
       97     4353         */
       98     4354        %ERRCODE(NAME=ERR$POS,COD#=%E$POS);
       99     4358        /*E*    ERROR:   FSE-E$POS-2
      100     4359                MESSAGE: You are not allowed to position% in %UF%
      101     4360         */
      102     4361        %ERRCODE(NAME=ERR$CANTBIN,COD#=%E$CANTBIN);
      103     4365        /*E*    ERROR: FSE-E$CANTBIN-2
      104     4366                MESSAGE: BIN writes illegal here.
      105     4367         */
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:57   
      106     4368        %ERRCODE(NAME=ERR$ILLBV,COD#=%E$ILLBV);
      107     4372        /*E*    ERROR: FSE-E$ILLBV-2
      108     4373                MESSAGE: M$WRITE with BIN and VFC illegal.
      109     4374         */
      110     4375        %ERRCODE(NAME=ERR$INVVFC,COD#=%E$INVVFC,SEV#=0);
      111     4379        /*E*    ERROR:   FSE-E$INVVFC-0
      112     4380                MESSAGE: That VFC character is invalid.
      113     4381         */
      114     4382    1   DCL NK_URTBL_BP (0:511) CHAR(1) CONSTANT
      115     4383    1        INIT(
      116     4384    1           BINASC(1)*32,BINASC(0),BINASC(1)*95,
      117     4385    1           BINASC(1)*32,BINASC(0),BINASC(1)*95,
      118     4386    1           BINASC(1)*32,BINASC(0),BINASC(1)*95,
      119     4387    1           BINASC(1)*32,BINASC(0),BINASC(1)*95);
      120     4388        /**** * * * * * * ****/
      121     4389    1   DCL USRDCB$ PTR; /*Holds address of User's DCB*/
      122     4390    1   DCL MEDDCB$ PTR; /*Holds address of I/O Medium DCB (may = user)*/
      123     4391    1   DCL FORM$ PTR; /*Holds address of Medium's Form control area*/
      124     4392    1   DCL TAB$ PTR; /*Points to Tabs while DDF'ing them.*/
      125     4393    1   DCL HDR$ REDEF TAB$ PTR; /*Points to Header while DDF'ing or writing*/
      126     4394    1   DCL MEDIUMX UBIN;
      127     4395                %EQU FMH$CPMME#=0;
      128     4396                %EQU FTW$WRAT#=1;
      129     4397    1   DCL 1 USRDVBYTE, /*DVBYTE from user, as modified.*/
      130     4398    1         2 GOOD, /*This is the DVBYTE itself.*/
      131     4399    1           3 * BIT(2), /* TOP and BP bits*/
      132     4400    1           3 VFCBIN UBIN(2)UNAL, /* VFC and BIN bits*/
      133     4401    1           3 * BIT(5), /* TRANS,x,x,x,CONT bits*/
      134     4402    1         2 * BIT(27); /*PL6 likes wholeword better.*/
      135     4403    1   DCL J SBIN; /* Various uses                       */
      136     4404    1   DCL I SBIN;
      137     4405    1   DCL K SBIN;
      138     4406    1   DCL L SBIN;
      139     4407    1   DCL UVFCLINES SBIN; /* Number of lines to upspace from user VFC.*/
      140     4408    1   DCL SAVEUB$ PTR; /* Save DCB.UB$ when sending tab/seq/hdr   */
      141     4409    1   DCL SAVEUBT UBIN; /* SAve DCB.UBYTES when send tab/seq/hdr   */
      142     4410    1   DCL VFCCHAR CHAR(1); /* Holds VFC character to pass to media    */
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:58   
      143     4411        %NK$VFC(STCLASS="REDEF VFCCHAR");
      144     4429    1   DCL CHAR1 CHAR(1) CALIGNED BASED; /* For fetching VFC from user buffer  */
      145     4430    1   DCL CHARI CHAR(I)BASED;
      146     4431    1   DCL BCMEDDCB$ PTR;
      147     4432    1   DCL 1 BCMEDDCB REDEF BCMEDDCB$,
      148     4433    1         2 * BIT(24),
      149     4434    1         2 SID BIT(12);
      150     4435        %FPT$WRITE_V(FPTN=FPTVI,BASED=);
      151     4441    1   DCL CONTFORMMORE SBIN;
      152     4442        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:59   
      153     4443        /*F*    NAME: FSE$URSTREAM
      154     4444         *      PURPOSE: FSE$URSTREAM handles PMME's for user unit-record DCB's
      155     4445         *         which are streamed to other DCB's.
      156     4446         *            There are several types of such DCB's:
      157     4447         *         1.  User assignment to stream name ("LP01") or to device
      158     4448         *               oplabels which resolve to streams.  The "secret" DCB
      159     4449         *               for such assignments is hooked to a file in the
      160     4450         *               output symbiont account (:SYMO).
      161     4451         *         2.  User assignment to device oplabels which resolve to the
      162     4452         *               interactive DCB M$UC.  M$UC is hooked either to the
      163     4453         *               timesharing user's terminal or to the ghost user's OC
      164     4454         *               via OC Comgroup.
      165     4455         *      DESCRIPTION:
      166     4456         *            If the PMME is a M$WRITE, tabstop and sequencing specifi-
      167     4457         *         cations must be analyzed.  If the user DCB's tabstops and/or
      168     4458         *         sequencing were not the last ones told to the stream, new
      169     4459         *         specification records must be sent to the stream.  If the
      170     4460         *         streamed-to DCB is interactive, the same must be done for
      171     4461         *         page-header specifications.
      172     4462         *            A VFC character is obtained from the user buffer if
      173     4463         *         VFC=YES, or from DVFC in the user DCB if VFC=NO.  If the
      174     4464         *         streamed-to DCB is not interactive, paper motion is analyzed
      175     4465         *         and if a page bound has been crossed, a new header is
      176     4466         *         written to the stream.  Page number and current line are
      177     4467         *         updated for non-interactive streams.  The user buffer is
      178     4468         *         then written to the stream.
      179     4469         *            For M$READ, the user request is simply passed along to
      180     4470         *         the stream.
      181     4471         */
      182     4472        /*D*    NAME: FSE$URSTREAM
      183     4473         *      CALL: CALL FSE$URSTREAM(FPTCODE,FPTV) ALTRET;
      184     4474         *      ENVIRONMENT:   Monitor (for user) LS.
      185     4475         *      INTERFACE:  Medium-specific routines, including --
      186     4476         *               FMH$UR - Unit-Record disk file.
      187     4477         *               KIA$UCIO - Timesharing terminal.
      188     4478         *               OCU$RWUC - OC Comgroup.
      189     4479         *      INPUT:   DCB (B$JIT.DCB$).
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:60   
      190     4480         *               FPTCODE (user PMME code).
      191     4481                         FPTV (user PMME V area).
      192     4482         *
      193     4483         */
      194     4484        /*F*    NAME: FSE$UR
      195     4485         *      PURPOSE: FSE$UR handles PMME's for user Unit-Record DCB's which
      196     4486         *         are not streamed to other DCB's.
      197     4487         *            There are several types of such DCB's:
      198     4488         *         1.  User assignment "dd@wsn".  Internally, such a DCB is a
      199     4489         *               file in the output symbiont account (:SYMO).
      200     4490         *         2.  User assignment to file with ORG=UR, CREATE or UPDATE.
      201     4491         *      DESCRIPTION:   The PMME must be a M$WRITE.
      202     4492         *            If tabstops or sequencing were changed (by M$DEVICE)
      203     4493         *         since the last M$WRITE, new tabstops/sequencing records are
      204     4494         *         written to the file.
      205     4495         *            A VFC character is acquired from the user buffer if
      206     4496         *         VFC=YES, or from DVFC in the DCB if VFC=NO.  Paper motion
      207     4497         *         is analyzed.  If a page bound has been crossed, a new header
      208     4498         *         is written to the file.  Page number and current line are
      209     4499         *         updated.
      210     4500         *            The user buffer is written to the file.
      211     4501         */
      212     4502    1   FSE$URSTREAM: ENTRY(FPTCODE,FPTV)ALTRET;

   4502  1 000003   000000 700200 xent  FSE$URSTREAM TSX0  ! X66_AUTO_2
         1 000004   000060 000002                    ZERO    48,2

      213     4503    1           CALL STREAMPREP ALTRET(NSTRMXIT);

   4503  1 000005   000116 701000 1                  TSX1    STREAMPREP
         1 000006   000110 702000 1                  TSX2    NSTRMXIT

      214     4504    1           CALL FORMATIT;

   4504  1 000007   001666 701000 1                  TSX1    FORMATIT
         1 000010   000000 011000                    NOP     0

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:61   
      215     4505    1           GOTO STRMXIT;

   4505  1 000011   000077 710000 1                  TRA     STRMXIT

      216     4506    1   FSE$UR: ENTRY(FPTCODE,FPTV)ALTRET;

   4506  1 000012   000000 700200 xent  FSE$UR       TSX0  ! X66_AUTO_2
         1 000013   000060 000002                    ZERO    48,2

      217     4507    1           CALL NSTRMPREP ALTRET(NSTRMXIT);

   4507  1 000014   001075 701000 1                  TSX1    NSTRMPREP
         1 000015   000110 702000 1                  TSX2    NSTRMXIT

      218     4508    1           CALL FORMATIT;

   4508  1 000016   001666 701000 1                  TSX1    FORMATIT
         1 000017   000000 011000                    NOP     0

      219     4509    1           GOTO NSTRMXIT;

   4509  1 000020   000110 710000 1                  TRA     NSTRMXIT

      220     4510        /**/
      221     4511    1   FSE$GRSTRM: ENTRY(FPTCODE,FPTV)ALTRET;

   4511  1 000021   000000 700200 xent  FSE$GRSTRM   TSX0  ! X66_AUTO_2
         1 000022   000060 000002                    ZERO    48,2

      222     4512    1           CALL STREAMPREP ALTRET(NSTRMXIT);

   4512  1 000023   000116 701000 1                  TSX1    STREAMPREP
         1 000024   000110 702000 1                  TSX2    NSTRMXIT

      223     4513    1           CALL GRFORMATIT;

   4513  1 000025   001637 701000 1                  TSX1    GRFORMATIT
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:62   
         1 000026   000000 011000                    NOP     0

      224     4514    1           GOTO STRMXIT;

   4514  1 000027   000077 710000 1                  TRA     STRMXIT

      225     4515        /**/
      226     4516    1   FSE$GR: ENTRY(FPTCODE,FPTV)ALTRET;

   4516  1 000030   000000 700200 xent  FSE$GR       TSX0  ! X66_AUTO_2
         1 000031   000060 000002                    ZERO    48,2

      227     4517    1           CALL NSTRMPREP ALTRET(NSTRMXIT);

   4517  1 000032   001075 701000 1                  TSX1    NSTRMPREP
         1 000033   000110 702000 1                  TSX2    NSTRMXIT

      228     4518    1           CALL GRFORMATIT;

   4518  1 000034   001637 701000 1                  TSX1    GRFORMATIT
         1 000035   000000 011000                    NOP     0

      229     4519    1           GOTO NSTRMXIT;

   4519  1 000036   000110 710000 1                  TRA     NSTRMXIT

      230     4520        /**/
      231     4521    1   FSE$FPSTREAM: ENTRY(FPTCODE,FPTV)ALTRET;

   4521  1 000037   000000 700200 xent  FSE$FPSTREAM TSX0  ! X66_AUTO_2
         1 000040   000060 000002                    ZERO    48,2

      232     4522    1           CALL STREAMPREP ALTRET(NSTRMXIT);

   4522  1 000041   000116 701000 1                  TSX1    STREAMPREP
         1 000042   000110 702000 1                  TSX2    NSTRMXIT

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:63   
      233     4523    1           CALL FPRGFORMATIT;

   4523  1 000043   001630 701000 1                  TSX1    FPRGFORMATIT
         1 000044   000000 011000                    NOP     0

      234     4524    1           GOTO STRMXIT;

   4524  1 000045   000077 710000 1                  TRA     STRMXIT

      235     4525        /**/
      236     4526    1   FSE$FPRG: ENTRY(FPTCODE,FPTV)ALTRET;

   4526  1 000046   000000 700200 xent  FSE$FPRG     TSX0  ! X66_AUTO_2
         1 000047   000060 000002                    ZERO    48,2

      237     4527    1           CALL NSTRMPREP ALTRET(NSTRMXIT);

   4527  1 000050   001075 701000 1                  TSX1    NSTRMPREP
         1 000051   000110 702000 1                  TSX2    NSTRMXIT

      238     4528    1           CALL FPRGFORMATIT;

   4528  1 000052   001630 701000 1                  TSX1    FPRGFORMATIT
         1 000053   000000 011000                    NOP     0

      239     4529    1           GOTO NSTRMXIT;

   4529  1 000054   000110 710000 1                  TRA     NSTRMXIT

      240     4530        /**/
      241     4531    1   FSE$NC: ENTRY (FPTCODE, FPTV) ALTRET;

   4531  1 000055   000000 700200 xent  FSE$NC       TSX0  ! X66_AUTO_2
         1 000056   000060 000002                    ZERO    48,2

      242     4532    1           CALL NSTRMPREP ALTRET(NSTRMXIT);

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:64   
   4532  1 000057   001075 701000 1                  TSX1    NSTRMPREP
         1 000060   000110 702000 1                  TSX2    NSTRMXIT

      243     4533    1           CALL MEDIUM ( );

   4533  1 000061   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000062   000001 235000 xsym               LDA     B_VECTNIL+1
         1 000063   200040 757100                    STAQ    @VFC+1,,AUTO
         1 000064   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000065   200037 756100                    STQ     @FPT+1,,AUTO
         1 000066   002776 701000 1                  TSX1    MEDIUM
         1 000067   000000 011000                    NOP     0

      244     4534    1           GOTO NSTRMXIT;

   4534  1 000070   000110 710000 1                  TRA     NSTRMXIT

      245     4535        /**/
      246     4536    1   FSE$TTYSTREAM: ENTRY(FPTCODE,FPTV)ALTRET;

   4536  1 000071   000000 700200 xent  FSE$TTYSTRE* TSX0  ! X66_AUTO_2
         1 000072   000060 000002                    ZERO    48,2

      247     4537    1           CALL STREAMPREP ALTRET(NSTRMXIT);

   4537  1 000073   000116 701000 1                  TSX1    STREAMPREP
         1 000074   000110 702000 1                  TSX2    NSTRMXIT

      248     4538    1           CALL TTYFORMATIT;

   4538  1 000075   001450 701000 1                  TSX1    TTYFORMATIT
         1 000076   000000 011000                    NOP     0

   4533  1 000077                       STRMXIT      null
      249     4539    1   STRMXIT:;
      250     4540    1           CALL STREAMEND;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:65   
   4540  1 000077   001012 701000 1                  TSX1    STREAMEND
         1 000100   000000 011000                    NOP     0

      251     4541    1           GOTO NSTRMXIT;

   4541  1 000101   000110 710000 1                  TRA     NSTRMXIT

      252     4542        /**/
      253     4543    1   FSE$TTY: ENTRY(FPTCODE,FPTV)ALTRET;

   4543  1 000102   000000 700200 xent  FSE$TTY      TSX0  ! X66_AUTO_2
         1 000103   000060 000002                    ZERO    48,2

      254     4544    1           CALL NSTRMPREP ALTRET(NSTRMXIT);

   4544  1 000104   001075 701000 1                  TSX1    NSTRMPREP
         1 000105   000110 702000 1                  TSX2    NSTRMXIT

      255     4545    1           CALL TTYFORMATIT;

   4545  1 000106   001450 701000 1                  TSX1    TTYFORMATIT
         1 000107   000000 011000                    NOP     0

   4544  1 000110                       NSTRMXIT     null
      256     4546    1   NSTRMXIT:;
      257     4547    1           IF B$JIT.ERR.CODE~=0 THEN ALTRETURN;

   4547  1 000110   000000 470400 xsym               LDP0    B$JIT$
         1 000111   000012 236100                    LDQ     10,,PR0
         1 000112   377770 316007                    CANQ    131064,DL
         1 000113   000115 600000 1                  TZE     s:4548

   4547  1 000114   000000 702200 xent               TSX2  ! X66_AALT

      258     4548    1           RETURN;

   4548  1 000115   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:66   

      259     4549        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:67   
      260     4550    1   STREAMPREP: PROC ALTRET;

   4550  1 000116   200032 741300       STREAMPREP   STX1  ! CONTFORMMORE+2,,AUTO

      261     4551        /*  STREAMPREP prepares things for the output formatter for a
      262     4552            streamed user DCB.  If the output formatter isn't needed (i.e.,
      263     4553            not a WRITE, or a WRITE to NO), it ALTRETURNs.  B$JIT.ERR is set
      264     4554            zero or nonzero depending on whether the operation succeeded.
      265     4555            If the output formatter is needed, it RETURNs with --
      266     4556                USRDCB$ pointing to user's DCB.
      267     4557                MEDDCB$ pointing to I/O-medium DCB.
      268     4558            After the output formatter finishes, our caller will call
      269     4559            STREAMEND to post information from the Medium DCB to User DCB.
      270     4560         */
      271     4561    2           USRDCB$=B$JIT.DCB$;

   4561  1 000117   000000 470400 xsym               LDP0    B$JIT$
         1 000120   000232 236100                    LDQ     154,,PR0
         1 000121   200005 756100                    STQ     USRDCB$,,AUTO

      272     4562    3           DO CASE(FPTCODE);

   4562  1 000122   200003 471500                    LDP1    @FPTCODE,,AUTO
         1 000123   100000 235100                    LDA     0,,PR1
         1 000124   000010 115007                    CMPA    8,DL
         1 000125   000127 602005 1                  TNC     s:4562+5,AL
         1 000126   000736 710000 1                  TRA     s:4696
         1 000127   000316 710000 1                  TRA     s:4598
         1 000130   000146 710000 1                  TRA     STREAMWRT
         1 000131   000137 710000 1                  TRA     s:4564
         1 000132   000740 710000 1                  TRA     s:4698
         1 000133   001006 710000 1                  TRA     s:4715
         1 000134   000736 710000 1                  TRA     s:4696
         1 000135   000761 710000 1                  TRA     s:4706
         1 000136   000137 710000 1                  TRA     s:4564

      273     4563    3            CASE(FPTWEOF,FPTDELREC);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:68   

      274     4564    3              IF F$USRDCB.ORG~=%SE# THEN B$JIT.ERR='0'B;

   4564  1 000137   200005 473500                    LDP3    USRDCB$,,AUTO
         1 000140   300032 236100                    LDQ     26,,PR3
         1 000141   777000 376003                    ANQ     -512,DU
         1 000142   027000 116003                    CMPQ    11776,DU
         1 000143   000146 600000 1                  TZE     STREAMWRT

   4564  1 000144   000012 450100                    STZ     10,,PR0
         1 000145   001010 710000 1                  TRA     s:4717

      275     4565    3              ELSE GOTO STREAMWRT;
      276     4566    3            CASE(FPTWRITE);

   4564  1 000146                       STREAMWRT    null
      277     4567    3   STREAMWRT: ;
      278     4568    3              IF F$USRDCB.ORG=%SE# OR F$USRDCB.ORG=%FORM# THEN MEDDCB$=USRDCB$;

   4568  1 000146   200005 473500                    LDP3    USRDCB$,,AUTO
         1 000147   300032 236100                    LDQ     26,,PR3
         1 000150   777000 376003                    ANQ     -512,DU
         1 000151   027000 116003                    CMPQ    11776,DU
         1 000152   000155 600000 1                  TZE     s:4568
         1 000153   031000 116003                    CMPQ    12800,DU
         1 000154   000160 601000 1                  TNZ     s:4569

   4568  1 000155   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000156   200006 756100                    STQ     MEDDCB$,,AUTO
         1 000157   000171 710000 1                  TRA     s:4571

      279     4569    3              ELSE IF F$USRDCB.UCOUT THEN MEDDCB$=DCBADDR(%M$UC#);

   4569  1 000160   300067 430100                    FSZN    55,,PR3
         1 000161   000167 605000 1                  TPL     s:4570

   4569  1 000162   000000 474400 2                  LDP4    0
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:69   
         1 000163   400000 475500                    LDP5    0,,PR4
         1 000164   500003 236100                    LDQ     3,,PR5
         1 000165   200006 756100                    STQ     MEDDCB$,,AUTO
         1 000166   000171 710000 1                  TRA     s:4571

      280     4570    3                 ELSE MEDDCB$=F$USRDCB.CFU$;

   4570  1 000167   300066 236100                    LDQ     54,,PR3
         1 000170   200006 756100                    STQ     MEDDCB$,,AUTO

      281     4571    4              DO CASE(F$MEDDCB.MEDIA);

   4571  1 000171   200006 474500                    LDP4    MEDDCB$,,AUTO
         1 000172   400103 236100                    LDQ     67,,PR4
         1 000173   000022 772000                    QRL     18
         1 000174   000777 376007                    ANQ     511,DL
         1 000175   000007 136007                    SBLQ    7,DL
         1 000176   000014 116007                    CMPQ    12,DL
         1 000177   000201 602006 1                  TNC     s:4571+8,QL
         1 000200   000221 710000 1                  TRA     s:4578
         1 000201   000215 710000 1                  TRA     s:4574
         1 000202   000225 710000 1                  TRA     s:4581
         1 000203   000221 710000 1                  TRA     s:4578
         1 000204   000221 710000 1                  TRA     s:4578
         1 000205   000221 710000 1                  TRA     s:4578
         1 000206   000225 710000 1                  TRA     s:4581
         1 000207   000225 710000 1                  TRA     s:4581
         1 000210   000221 710000 1                  TRA     s:4578
         1 000211   000221 710000 1                  TRA     s:4578
         1 000212   000221 710000 1                  TRA     s:4578
         1 000213   000221 710000 1                  TRA     s:4578
         1 000214   000225 710000 1                  TRA     s:4581

      282     4572    4               CASE(FMTCG#,FMTUC#,FMTOCCG#,FMTSYMB#); /*OK ones.*/

      283     4573    4               CASE(FMTNO#);

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:70   
      284     4574    4                 B$JIT.ERR='0'B;

   4574  1 000215   000012 450100                    STZ     10,,PR0

      285     4575    4                 MEDDCB$ = USRDCB$;

   4575  1 000216   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000217   200006 756100                    STQ     MEDDCB$,,AUTO

      286     4576    4                 GOTO ALTR;

   4576  1 000220   000643 710000 1                  TRA     ALTR

      287     4577    4               CASE(ELSE);

      288     4578    4                 CALL SC_FSBADDCB;

   4578  1 000221   000000 713400 xsym               CLIMB   SC_FSBADDCB
         1 000222   000000 600000 xsid               climb   nvectors=         0

      289     4579    4                 ALTRETURN;

   4579  1 000223   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 000224   000000 702211                    TSX2  ! 0,X1

      290     4580    4               END;

      291     4581    3              B$JIT.DCB$=MEDDCB$;

   4581  1 000225   200006 236100                    LDQ     MEDDCB$,,AUTO
         1 000226   000232 756100                    STQ     154,,PR0

      292     4582    3              CALL FMO$GETPFB(I);

   4582  1 000227   200014 635500                    EPPR5   I,,AUTO
         1 000230   200044 455500                    STP5    FPTV$$+1,,AUTO
         1 000231   200044 630500                    EPPR0   FPTV$$+1,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:71   
         1 000232   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000233   000000 701000 xent               TSX1    FMO$GETPFB
         1 000234   000000 011000                    NOP     0

      293     4583    3              IF USRDCB$ = DCBADDR(%M$UC#)

   4583  1 000235   000000 470400 2                  LDP0    0
         1 000236   000000 471500                    LDP1    0,,PR0
         1 000237   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000240   100003 116100                    CMPQ    3,,PR1
         1 000241   000246 601000 1                  TNZ     s:4587

      294     4584    3              THEN
      295     4585    3                 F$MEDDCB.STR = I;

   4585  1 000242   200006 473500                    LDP3    MEDDCB$,,AUTO
         1 000243   200014 236100                    LDQ     I,,AUTO
         1 000244   300077 552104                    STBQ    63,'04'O,PR3
         1 000245   000252 710000 1                  TRA     s:4588

      296     4586    3              ELSE
      297     4587    3                 F$MEDDCB.STR = F$USRDCB.STR;

   4587  1 000246   200005 473500                    LDP3    USRDCB$,,AUTO
         1 000247   200006 474500                    LDP4    MEDDCB$,,AUTO
         1 000250   300077 236100                    LDQ     63,,PR3
         1 000251   400077 552104                    STBQ    63,'04'O,PR4

      298     4588    3              F$MEDDCB.TYC(1)='0'B;

   4588  1 000252   200006 473500                    LDP3    MEDDCB$,,AUTO
         1 000253   300002 450100                    STZ     2,,PR3

      299     4589    3              F$MEDDCB.WAIT=1;

   4589  1 000254   000020 236007                    LDQ     16,DL
         1 000255   300064 256100                    ORSQ    52,,PR3
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:72   

      300     4590    3              F$MEDDCB.UB$=F$USRDCB.UB$;

   4590  1 000256   200005 474500                    LDP4    USRDCB$,,AUTO
         1 000257   400075 236100                    LDQ     61,,PR4
         1 000260   300075 756100                    STQ     61,,PR3

      301     4591    3              F$MEDDCB.UBYTES=F$USRDCB.UBYTES;

   4591  1 000261   400076 235100                    LDA     62,,PR4
         1 000262   300076 755100                    STA     62,,PR3

      302     4592    3              IF FPTCODE=FPTWRITE THEN RETURN;

   4592  1 000263   200003 475500                    LDP5    @FPTCODE,,AUTO
         1 000264   500000 235100                    LDA     0,,PR5
         1 000265   000001 115007                    CMPA    1,DL
         1 000266   000271 601000 1                  TNZ     s:4593

   4592  1 000267   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 000270   000001 702211                    TSX2  ! 1,X1

      303     4593    4              IF F$MEDDCB.MEDIA=FMTUC# THEN DO;

   4593  1 000271   300103 236100                    LDQ     67,,PR3
         1 000272   000777 376003                    ANQ     511,DU
         1 000273   000014 116003                    CMPQ    12,DU
         1 000274   001010 601000 1                  TNZ     s:4717

      304     4594    4                 B$JIT.ERR='0'B;

   4594  1 000275   000000 476400 xsym               LDP6    B$JIT$
         1 000276   600012 450100                    STZ     10,,PR6

      305     4595    4                 CALL KIA$UCIO(FPTCODE,0,0,0,ADDR(FPTV));

   4595  1 000277   200004 236100                    LDQ     @FPTV,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:73   
         1 000300   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 000301   200044 637500                    EPPR7   FPTV$$+1,,AUTO
         1 000302   200051 457500                    STP7    FPTV$$+6,,AUTO
         1 000303   000001 236000 2                  LDQ     1
         1 000304   200050 756100                    STQ     FPTV$$+5,,AUTO
         1 000305   000002 237000 2                  LDAQ    2
         1 000306   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 000307   200003 236100                    LDQ     @FPTCODE,,AUTO
         1 000310   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 000311   200045 630500                    EPPR0   FPTV$$+2,,AUTO
         1 000312   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000313   000000 701000 xent               TSX1    KIA$UCIO
         1 000314   000000 011000                    NOP     0

      306     4596    4                 END;

   4596  1 000315   001010 710000 1                  TRA     s:4717

      307     4597    3            CASE(FPTREAD);

      308     4598    3              IF F$USRDCB.CTLCMDIN THEN

   4598  1 000316   200005 473500                    LDP3    USRDCB$,,AUTO
         1 000317   300103 236100                    LDQ     67,,PR3
         1 000320   004000 316007                    CANQ    2048,DL
         1 000321   000414 600000 1                  TZE     s:4627

      309     4599    4   C1AGAIN:   DO CASE(B$ROSEG$->B$ROSEG.CR01ID.NOWIS);

   4599  1 000322   000000 470400 xsym  C1AGAIN      LDP0    B$ROSEG$
         1 000323   000114 236100                    LDQ     76,,PR0
         1 000324   000036 772000                    QRL     30
         1 000325   000017 376007                    ANQ     15,DL
         1 000326   000005 116007                    CMPQ    5,DL
         1 000327   000331 602006 1                  TNC     C1AGAIN+7,QL
         1 000330   000414 710000 1                  TRA     s:4627
         1 000331   000336 710000 1                  TRA     s:4601
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:74   
         1 000332   000370 710000 1                  TRA     s:4611
         1 000333   000370 710000 1                  TRA     s:4611
         1 000334   000357 710000 1                  TRA     s:4608
         1 000335   000400 710000 1                  TRA     s:4616

      310     4600    4               CASE(%CC_FROMNO#); /* Control Command place is NO */

      311     4601    4                 F$USRDCB.DDEV.IC='0'B;

   4601  1 000336   200005 471500                    LDP1    USRDCB$,,AUTO
         1 000337   000004 236000 2                  LDQ     4
         1 000340   100004 356100                    ANSQ    4,,PR1

      312     4602    4                 F$USRDCB.DDEV.XEQ='0'B;

   4602  1 000341   000005 236000 2                  LDQ     5
         1 000342   100004 356100                    ANSQ    4,,PR1

      313     4603    4                 B$JIT.ERR=ERR$EOF;

   4603  1 000343   000012 236000 0                  LDQ     ERR$EOF
         1 000344   000000 473400 xsym               LDP3    B$JIT$
         1 000345   300012 756100                    STQ     10,,PR3

      314     4604    4                 F$USRDCB.TYC.EOF(F$USRDCB.WAIT) = '1'B;

   4604  1 000346   100064 236100                    LDQ     52,,PR1
         1 000347   000004 772000                    QRL     4
         1 000350   000001 376007                    ANQ     1,DL
         1 000351   000000 620006                    EAX0    0,QL
         1 000352   004000 236003                    LDQ     2048,DU
         1 000353   100001 256110                    ORSQ    1,X0,PR1

      315     4605    4                 MEDDCB$ = USRDCB$;

   4605  1 000354   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000355   200006 756100                    STQ     MEDDCB$,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:75   

      316     4606    4                 GOTO ALTR;

   4606  1 000356   000643 710000 1                  TRA     ALTR

      317     4607    4               CASE(%CC_FROMUC#); /* Control Command place is M$UC */

      318     4608    4                 F$USRDCB.DDEV.IC=F$USRDCB.CFU$->F$DCB.DDEV.IC;

   4608  1 000357   200005 471500                    LDP1    USRDCB$,,AUTO
         1 000360   100066 473500                    LDP3    54,,PR1
         1 000361   300004 236100                    LDQ     4,,PR3
         1 000362   100004 676100                    ERQ     4,,PR1
         1 000363   100000 376007                    ANQ     32768,DL
         1 000364   100004 656100                    ERSQ    4,,PR1

      319     4609    4                 F$USRDCB.DDEV.XEQ='0'B;

   4609  1 000365   000005 236000 2                  LDQ     5
         1 000366   100004 356100                    ANSQ    4,,PR1
         1 000367   000414 710000 1                  TRA     s:4627

      320     4610    4               CASE(%CC_FROMJOB#,%CC_FROMXEQ#);

      321     4611    4                 CALL FSD$C1 ALTRET(C1ALTR);

   4611  1 000370   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000371   000000 701000 xent               TSX1    FSD$C1
         1 000372   000404 702000 1                  TSX2    C1ALTR

      322     4612    4                 B$JIT.ERR='0'B;

   4612  1 000373   000000 470400 xsym               LDP0    B$JIT$
         1 000374   000012 450100                    STZ     10,,PR0

      323     4613    4                 MEDDCB$ = USRDCB$;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:76   
   4613  1 000375   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000376   200006 756100                    STQ     MEDDCB$,,AUTO

      324     4614    4                 GOTO ALTR;

   4614  1 000377   000643 710000 1                  TRA     ALTR

      325     4615    4               CASE(%CC_FROMXEQEND#);

      326     4616    4                 CALL FSD$C1END ALTRET(C1ALTR);

   4616  1 000400   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000401   000000 701000 xent               TSX1    FSD$C1END
         1 000402   000404 702000 1                  TSX2    C1ALTR

      327     4617    4                 GOTO C1AGAIN;

   4617  1 000403   000322 710000 1                  TRA     C1AGAIN

   4616  1 000404                       C1ALTR       null
      328     4618    4   C1ALTR:       ;
      329     4619    4                 IF B$JIT.ERR.CODE ~= 0

   4619  1 000404   000000 470400 xsym               LDP0    B$JIT$
         1 000405   000012 236100                    LDQ     10,,PR0
         1 000406   377770 316007                    CANQ    131064,DL
         1 000407   000413 600000 1                  TZE     s:4625

      330     4620    4                 THEN
      331     4621    5                 DO;

      332     4622    5                    MEDDCB$ = USRDCB$;

   4622  1 000410   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000411   200006 756100                    STQ     MEDDCB$,,AUTO

      333     4623    5                    GOTO ALTR;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:77   

   4623  1 000412   000643 710000 1                  TRA     ALTR

      334     4624    5                    END;
      335     4625    4                 GOTO C1AGAIN; /*Fell off end of CC files; retry.*/

   4625  1 000413   000322 710000 1                  TRA     C1AGAIN

      336     4626    4               END;

      337     4627    3              MEDDCB$=F$USRDCB.CFU$;

   4627  1 000414   200005 470500                    LDP0    USRDCB$,,AUTO
         1 000415   000066 236100                    LDQ     54,,PR0
         1 000416   200006 756100                    STQ     MEDDCB$,,AUTO

      338     4628    3              IF F$USRDCB.ORG=%SE# OR F$USRDCB.ORG=%FORM# THEN MEDDCB$=USRDCB$;

   4628  1 000417   000032 236100                    LDQ     26,,PR0
         1 000420   777000 376003                    ANQ     -512,DU
         1 000421   027000 116003                    CMPQ    11776,DU
         1 000422   000425 600000 1                  TZE     s:4628+6
         1 000423   031000 116003                    CMPQ    12800,DU
         1 000424   000427 601000 1                  TNZ     s:4629

   4628  1 000425   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000426   200006 756100                    STQ     MEDDCB$,,AUTO

      339     4629    3              CALL FMO$GETPFB(I);

   4629  1 000427   200014 631500                    EPPR1   I,,AUTO
         1 000430   200044 451500                    STP1    FPTV$$+1,,AUTO
         1 000431   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 000432   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000433   000000 701000 xent               TSX1    FMO$GETPFB
         1 000434   000000 011000                    NOP     0

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:78   
      340     4630    3              IF USRDCB$ = DCBADDR(%M$UC#)

   4630  1 000435   000000 470400 2                  LDP0    0
         1 000436   000000 471500                    LDP1    0,,PR0
         1 000437   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000440   100003 116100                    CMPQ    3,,PR1
         1 000441   000446 601000 1                  TNZ     s:4634

      341     4631    3              THEN
      342     4632    3                 F$MEDDCB.STR = I;

   4632  1 000442   200006 473500                    LDP3    MEDDCB$,,AUTO
         1 000443   200014 236100                    LDQ     I,,AUTO
         1 000444   300077 552104                    STBQ    63,'04'O,PR3
         1 000445   000452 710000 1                  TRA     s:4635

      343     4633    3              ELSE
      344     4634    3                 F$MEDDCB.STR = F$USRDCB.STR;

   4634  1 000446   200005 473500                    LDP3    USRDCB$,,AUTO
         1 000447   200006 474500                    LDP4    MEDDCB$,,AUTO
         1 000450   300077 236100                    LDQ     63,,PR3
         1 000451   400077 552104                    STBQ    63,'04'O,PR4

      345     4635    3              B$JIT.DCB$=MEDDCB$;

   4635  1 000452   200006 236100                    LDQ     MEDDCB$,,AUTO
         1 000453   000000 473400 xsym               LDP3    B$JIT$
         1 000454   300232 756100                    STQ     154,,PR3

      346     4636    3              F$MEDDCB.TYC(1)='0'B;

   4636  1 000455   200006 474500                    LDP4    MEDDCB$,,AUTO
         1 000456   400002 450100                    STZ     2,,PR4

      347     4637    3              F$MEDDCB.UB$=F$USRDCB.UB$;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:79   
   4637  1 000457   200005 475500                    LDP5    USRDCB$,,AUTO
         1 000460   500075 236100                    LDQ     61,,PR5
         1 000461   400075 756100                    STQ     61,,PR4

      348     4638    3              F$MEDDCB.UBYTES=F$USRDCB.UBYTES;

   4638  1 000462   500076 235100                    LDA     62,,PR5
         1 000463   400076 755100                    STA     62,,PR4

      349     4639    3              F$MEDDCB.ARS=0;

   4639  1 000464   400000 450100                    STZ     0,,PR4

      350     4640    4              DO CASE(F$MEDDCB.MEDIA);

   4640  1 000465   400103 236100                    LDQ     67,,PR4
         1 000466   000022 772000                    QRL     18
         1 000467   000777 376007                    ANQ     511,DL
         1 000470   000007 136007                    SBLQ    7,DL
         1 000471   000007 116007                    CMPQ    7,DL
         1 000472   000474 602006 1                  TNC     s:4640+7,QL
         1 000473   000632 710000 1                  TRA     s:4671
         1 000474   000503 710000 1                  TRA     s:4642
         1 000475   000511 710000 1                  TRA     s:4646
         1 000476   000632 710000 1                  TRA     s:4671
         1 000477   000632 710000 1                  TRA     s:4671
         1 000500   000632 710000 1                  TRA     s:4671
         1 000501   000532 710000 1                  TRA     s:4651
         1 000502   000613 710000 1                  TRA     s:4667

      351     4641    4               CASE(FMTNO#);

      352     4642    4                 B$JIT.ERR=ERR$EOF;

   4642  1 000503   000012 236000 0                  LDQ     ERR$EOF
         1 000504   300012 756100                    STQ     10,,PR3

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:80   
      353     4643    4                 B$JIT.DCB$=USRDCB$;

   4643  1 000505   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000506   300232 756100                    STQ     154,,PR3

      354     4644    4                 ALTRETURN;

   4644  1 000507   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 000510   000000 702211                    TSX2  ! 0,X1

      355     4645    4               CASE(FMTCG#);

      356     4646    4                 F$MEDDCB.WAIT = 1;

   4646  1 000511   000020 236007                    LDQ     16,DL
         1 000512   400064 256100                    ORSQ    52,,PR4

      357     4647    4                 CALL KCI$RWCG(MFC_READ,FPTV.DVBYTE,BINASC(0),

   4647  1 000513   500006 476500                    LDP6    6,,PR5
         1 000514   200050 456500                    STP6    FPTV$$+5,,AUTO
         1 000515   200004 236100                    LDQ     @FPTV,,AUTO
         1 000516   000001 036003                    ADLQ    1,DU
         1 000517   000007 235000 2                  LDA     7
         1 000520   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 000521   200004 236100                    LDQ     @FPTV,,AUTO
         1 000522   000003 036003                    ADLQ    3,DU
         1 000523   000001 235000 2                  LDA     1
         1 000524   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 000525   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 000526   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000527   000000 701000 xent               TSX1    KCI$RWCG
         1 000530   000643 702000 1                  TSX2    ALTR
         1 000531   000641 710000 1                  TRA     s:4675

      358     4648    4                   FPTV.EVENT,F$USRDCB.SETSTA$->VSST)
      359     4649    4                   ALTRET(ALTR);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:81   
      360     4650    4               CASE(FMTUC#);

      361     4651    4                 F$MEDDCB.WAIT = F$USRDCB.WAIT;

   4651  1 000532   500064 236100                    LDQ     52,,PR5
         1 000533   400064 676100                    ERQ     52,,PR4
         1 000534   000020 376007                    ANQ     16,DL
         1 000535   400064 656100                    ERSQ    52,,PR4

      362     4652    4                 CALL KIA$UCIO(MFC_READ,FPTV.DVBYTE,BINASC(0),

   4652  1 000536   200004 236100                    LDQ     @FPTV,,AUTO
         1 000537   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 000540   200044 636500                    EPPR6   FPTV$$+1,,AUTO
         1 000541   200051 456500                    STP6    FPTV$$+6,,AUTO
         1 000542   000001 036003                    ADLQ    1,DU
         1 000543   200050 756100                    STQ     FPTV$$+5,,AUTO
         1 000544   000007 236000 2                  LDQ     7
         1 000545   200047 756100                    STQ     FPTV$$+4,,AUTO
         1 000546   200004 236100                    LDQ     @FPTV,,AUTO
         1 000547   000003 036003                    ADLQ    3,DU
         1 000550   200046 756100                    STQ     FPTV$$+3,,AUTO
         1 000551   000001 236000 2                  LDQ     1
         1 000552   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 000553   200045 630500                    EPPR0   FPTV$$+2,,AUTO
         1 000554   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000555   000000 701000 xent               TSX1    KIA$UCIO
         1 000556   000643 702000 1                  TSX2    ALTR

      363     4653    4                   FPTV.EVENT,ADDR(FPTV)) ALTRET(ALTR);
      364     4654    4                 IF F$USRDCB.WAIT = 0

   4654  1 000557   200005 470500                    LDP0    USRDCB$,,AUTO
         1 000560   000064 236100                    LDQ     52,,PR0
         1 000561   000020 316007                    CANQ    16,DL
         1 000562   000641 601000 1                  TNZ     s:4675

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:82   
      365     4655    5                 THEN DO;

      366     4656                         %LOCK (G=F_DCBLOCK);

   4657  1 000563   000010 630400 2                  EPPR0   8
         1 000564   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000565   000000 701000 xent               TSX1    HFC$LOCK
         1 000566   000000 011000                    NOP     0

      367     4659    5                    F$USRDCB.FCN(0) = BINBIT (F$USRDCB.FCN.CNT(0) + 1, 9);

   4659  1 000567   200005 470500                    LDP0    USRDCB$,,AUTO
         1 000570   000074 236100                    LDQ     60,,PR0
         1 000571   000033 772000                    QRL     27
         1 000572   000377 376007                    ANQ     255,DL
         1 000573   000001 036007                    ADLQ    1,DL
         1 000574   000033 736000                    QLS     27
         1 000575   000074 552140                    STBQ    60,'40'O,PR0

      368     4660    5                    F$MEDDCB.FCN(0) = BINBIT (F$MEDDCB.FCN.CNT(0) + 1, 9);

   4660  1 000576   200006 471500                    LDP1    MEDDCB$,,AUTO
         1 000577   100074 236100                    LDQ     60,,PR1
         1 000600   000033 772000                    QRL     27
         1 000601   000377 376007                    ANQ     255,DL
         1 000602   000001 036007                    ADLQ    1,DL
         1 000603   000033 736000                    QLS     27
         1 000604   100074 552140                    STBQ    60,'40'O,PR1

      369     4661                         %UNLOCK (G=F_DCBLOCK);

   4662  1 000605   000010 630400 2                  EPPR0   8
         1 000606   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000607   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000610   000000 011000                    NOP     0

      370     4664    5                    ALTRETURN;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:83   

   4664  1 000611   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 000612   000000 702211                    TSX2  ! 0,X1

      371     4665    5                    END;
      372     4666    4               CASE(FMTOCCG#);

      373     4667    4                 F$MEDDCB.WAIT=1;

   4667  1 000613   000020 236007                    LDQ     16,DL
         1 000614   400064 256100                    ORSQ    52,,PR4

      374     4668    4                 CALL OCU$RWUC(MFC_READ,FPTV.DVBYTE,BINASC(0),

   4668  1 000615   200004 236100                    LDQ     @FPTV,,AUTO
         1 000616   000001 036003                    ADLQ    1,DU
         1 000617   000007 235000 2                  LDA     7
         1 000620   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 000621   200004 236100                    LDQ     @FPTV,,AUTO
         1 000622   000003 036003                    ADLQ    3,DU
         1 000623   000001 235000 2                  LDA     1
         1 000624   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 000625   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 000626   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000627   000000 701000 xent               TSX1    OCU$RWUC
         1 000630   000643 702000 1                  TSX2    ALTR
         1 000631   000641 710000 1                  TRA     s:4675

      375     4669    4                   FPTV.EVENT) ALTRET(ALTR);
      376     4670    4               CASE(ELSE);

      377     4671    4                 CALL SC_FSBADDCB;

   4671  1 000632   000000 713400 xsym               CLIMB   SC_FSBADDCB
         1 000633   000000 600000 xsid               climb   nvectors=         0

      378     4672    4                 B$JIT.DCB$=USRDCB$;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:84   

   4672  1 000634   200005 236100                    LDQ     USRDCB$,,AUTO
         1 000635   000000 470400 xsym               LDP0    B$JIT$
         1 000636   000232 756100                    STQ     154,,PR0

      379     4673    4                 ALTRETURN;

   4673  1 000637   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 000640   000000 702211                    TSX2  ! 0,X1

      380     4674    4               END;

      381     4675    3              B$JIT.ERR='0'B;

   4675  1 000641   000000 470400 xsym               LDP0    B$JIT$
         1 000642   000012 450100                    STZ     10,,PR0

      382     4676    3   ALTR:      B$JIT.DCB$=USRDCB$;

   4676  1 000643   200005 236100       ALTR         LDQ     USRDCB$,,AUTO
         1 000644   000000 470400 xsym               LDP0    B$JIT$
         1 000645   000232 756100                    STQ     154,,PR0

      383     4677    3              BCMEDDCB$=MEDDCB$;

   4677  1 000646   200006 236100                    LDQ     MEDDCB$,,AUTO
         1 000647   200023 756100                    STQ     BCMEDDCB$,,AUTO

      384     4678    3              BCMEDDCB.SID=%RONCSID;

   4678  1 000650   006124 236007                    LDQ     3156,DL
         1 000651   200023 752103                    STCQ    BCMEDDCB$,'03'O,AUTO

      385     4679    3              F$USRDCB.ARS=BCMEDDCB$->F$DCB.ARS;

   4679  1 000652   200023 471500                    LDP1    BCMEDDCB$,,AUTO
         1 000653   200005 473500                    LDP3    USRDCB$,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:85   
         1 000654   100000 235100                    LDA     0,,PR1
         1 000655   300000 755100                    STA     0,,PR3

      386     4680    3              F$USRDCB.DVBYTE=BCMEDDCB$->F$DCB.DVBYTE;

   4680  1 000656   100003 236100                    LDQ     3,,PR1
         1 000657   300003 676100                    ERQ     3,,PR3
         1 000660   776000 376003                    ANQ     -1024,DU
         1 000661   300003 656100                    ERSQ    3,,PR3

      387     4681    3              F$USRDCB.EOMCHAR=BCMEDDCB$->F$DCB.EOMCHAR;

   4681  1 000662   100003 236100                    LDQ     3,,PR1
         1 000663   300003 552104                    STBQ    3,'04'O,PR3

      388     4682    3              F$USRDCB.ACTPOS=BCMEDDCB$->F$DCB.ACTPOS;

   4682  1 000664   100057 720100                    LXL0    47,,PR1
         1 000665   300057 440100                    SXL0    47,,PR3

      389     4683    3              F$USRDCB.FLDID=BCMEDDCB$->F$DCB.FLDID;

   4683  1 000666   100061 721100                    LXL1    49,,PR1
         1 000667   300061 441100                    SXL1    49,,PR3

      390     4684    3              IF BCMEDDCB$->F$DCB.ASN=%COMGROUP#

   4684  1 000670   100032 236100                    LDQ     26,,PR1
         1 000671   777000 376007                    ANQ     -512,DL
         1 000672   004000 116007                    CMPQ    2048,DL
         1 000673   000704 601000 1                  TNZ     s:4688
         1 000674   300007 236100                    LDQ     7,,PR3
         1 000675   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000676   000704 600000 1                  TZE     s:4688

      391     4685    3                AND F$USRDCB.LASTSTA$ ~= ADDR(NIL)
      392     4686    3              THEN
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:86   
      393     4687    3                 F$USRDCB.LASTSTA$->VSTA=BCMEDDCB$->F$DCB.LASTSTA$->VSTA;

   4687  1 000677   300007 474500                    LDP4    7,,PR3
         1 000700   100007 475500                    LDP5    7,,PR1
         1 000701   000100 100500                    MLR     fill='000'O
         1 000702   500000 000040                    ADSC9   0,,PR5                   cn=0,n=32
         1 000703   400000 000040                    ADSC9   0,,PR4                   cn=0,n=32

      394     4688    3              IF F$USRDCB.WAIT~=0 THEN

   4688  1 000704   300064 236100                    LDQ     52,,PR3
         1 000705   000020 316007                    CANQ    16,DL
         1 000706   000713 600000 1                  TZE     s:4690

      395     4689    3                 F$USRDCB.TYC(1)=BCMEDDCB$->F$DCB.TYC(1)|F$USRDCB.TYC(1);

   4689  1 000707   100002 236100                    LDQ     2,,PR1
         1 000710   300002 276100                    ORQ     2,,PR3
         1 000711   300002 756100                    STQ     2,,PR3
         1 000712   000734 710000 1                  TRA     s:4694

      396     4690    3              ELSE IF FPTV.EVENT=0 THEN

   4690  1 000713   200004 474500                    LDP4    @FPTV,,AUTO
         1 000714   400001 235100                    LDA     1,,PR4
         1 000715   000722 601000 1                  TNZ     s:4693

      397     4691    3                    F$USRDCB.TYC(0)=BCMEDDCB$->F$DCB.TYC(1)|F$USRDCB.TYC(0);

   4691  1 000716   100002 236100                    LDQ     2,,PR1
         1 000717   300001 276100                    ORQ     1,,PR3
         1 000720   300001 756100                    STQ     1,,PR3
         1 000721   000734 710000 1                  TRA     s:4694

      398     4692    3                 ELSE
      399     4693    3                    CALL NKA$EVENT(BCMEDDCB$->F$DCB.TYC(1),FPTV.EVENT);

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:87   
   4693  1 000722   200004 236100                    LDQ     @FPTV,,AUTO
         1 000723   000001 036003                    ADLQ    1,DU
         1 000724   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 000725   200023 236100                    LDQ     BCMEDDCB$,,AUTO
         1 000726   000002 036003                    ADLQ    2,DU
         1 000727   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 000730   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 000731   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000732   000000 701000 xent               TSX1    NKA$EVENT
         1 000733   000000 011000                    NOP     0

      400     4694    3              ALTRETURN;

   4694  1 000734   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 000735   000000 702211                    TSX2  ! 0,X1

      401     4695    3            CASE(ELSE);

      402     4696    3              B$JIT.ERR='0'B;

   4696  1 000736   000012 450100                    STZ     10,,PR0
         1 000737   001010 710000 1                  TRA     s:4717

      403     4697    3            CASE(FPTPREC);

      404     4698    3              IF ADDR(FPTV)->PRECORDFPT.BOF OR

   4698  1 000740   200004 473500                    LDP3    @FPTV,,AUTO
         1 000741   300000 236100                    LDQ     0,,PR3
         1 000742   020000 316007                    CANQ    8192,DL
         1 000743   000754 601000 1                  TNZ     s:4703
         1 000744   010000 316007                    CANQ    4096,DL
         1 000745   000754 601000 1                  TNZ     s:4703
         1 000746   300001 235100                    LDA     1,,PR3
         1 000747   000754 601000 1                  TNZ     s:4703
         1 000750   400000 316007                    CANQ    -131072,DL
         1 000751   000754 601000 1                  TNZ     s:4703
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:88   
         1 000752   200000 316007                    CANQ    65536,DL
         1 000753   000757 600000 1                  TZE     s:4704

      405     4699    3                ADDR(FPTV)->PRECORDFPT.EOF OR
      406     4700    3                ADDR(FPTV)->PRECORDFPT.N~=0 OR
      407     4701    3                ADDR(FPTV)->PRECORDFPT.KEYS OR
      408     4702    3                ADDR(FPTV)->PRECORDFPT.KEYR THEN
      409     4703    3                 B$JIT.ERR=ERR$POS;

   4703  1 000754   000014 236000 0                  LDQ     ERR$POS
         1 000755   000012 756100                    STQ     10,,PR0
         1 000756   001010 710000 1                  TRA     s:4717

      410     4704    3              ELSE B$JIT.ERR='0'B;

   4704  1 000757   000012 450100                    STZ     10,,PR0
         1 000760   001010 710000 1                  TRA     s:4717

      411     4705    3            CASE(FPTREW);

      412     4706    4              IF F$USRDCB.CTLCMDIN THEN DO;

   4706  1 000761   200005 473500                    LDP3    USRDCB$,,AUTO
         1 000762   300103 236100                    LDQ     67,,PR3
         1 000763   004000 316007                    CANQ    2048,DL
         1 000764   001003 600000 1                  TZE     s:4713

      413     4707    4                 CALL FMO$GETDOMAIN(I);

   4707  1 000765   200014 634500                    EPPR4   I,,AUTO
         1 000766   200044 454500                    STP4    FPTV$$+1,,AUTO
         1 000767   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 000770   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000771   000000 701000 xent               TSX1    FMO$GETDOMAIN
         1 000772   000000 011000                    NOP     0

      414     4708    5                 IF I=%CPWSR THEN DO;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:89   

   4708  1 000773   200014 235100                    LDA     I,,AUTO
         1 000774   000004 115007                    CMPA    4,DL
         1 000775   001003 601000 1                  TNZ     s:4713

      415     4709    5                    CALL FSD$REW;

   4709  1 000776   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000777   000000 701000 xent               TSX1    FSD$REW
         1 001000   000000 011000                    NOP     0

      416     4710    5                    ALTRETURN;

   4710  1 001001   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001002   000000 702211                    TSX2  ! 0,X1

      417     4711    5                    END;
      418     4712    4                 END;
      419     4713    3              B$JIT.ERR='0'B;

   4713  1 001003   000000 470400 xsym               LDP0    B$JIT$
         1 001004   000012 450100                    STZ     10,,PR0
         1 001005   001010 710000 1                  TRA     s:4717

      420     4714    3            CASE(FPTPFIL);

      421     4715    3              B$JIT.ERR=ERR$POS;

   4715  1 001006   000014 236000 0                  LDQ     ERR$POS
         1 001007   000012 756100                    STQ     10,,PR0

      422     4716    3            END;

      423     4717    2           ALTRETURN;

   4717  1 001010   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001011   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:90   

      424     4718    2   END STREAMPREP;
      425     4719        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:91   
      426     4720    1   STREAMEND: PROC;

   4720  1 001012   200032 741300       STREAMEND    STX1  ! CONTFORMMORE+2,,AUTO

      427     4721    2           B$JIT.DCB$=USRDCB$;

   4721  1 001013   200005 236100                    LDQ     USRDCB$,,AUTO
         1 001014   000000 470400 xsym               LDP0    B$JIT$
         1 001015   000232 756100                    STQ     154,,PR0

      428     4722    2           BCMEDDCB$=MEDDCB$;

   4722  1 001016   200006 236100                    LDQ     MEDDCB$,,AUTO
         1 001017   200023 756100                    STQ     BCMEDDCB$,,AUTO

      429     4723    2           BCMEDDCB.SID=%RONCSID;

   4723  1 001020   006124 236007                    LDQ     3156,DL
         1 001021   200023 752103                    STCQ    BCMEDDCB$,'03'O,AUTO

      430     4724    2           IF BCMEDDCB$->F$DCB.ASN=%COMGROUP# THEN

   4724  1 001022   200023 471500                    LDP1    BCMEDDCB$,,AUTO
         1 001023   100032 236100                    LDQ     26,,PR1
         1 001024   777000 376007                    ANQ     -512,DL
         1 001025   004000 116007                    CMPQ    2048,DL
         1 001026   001041 601000 1                  TNZ     s:4727

      431     4725    2              IF NOT F$MEDDCB.LSTAOR THEN

   4725  1 001027   200006 473500                    LDP3    MEDDCB$,,AUTO
         1 001030   300031 236100                    LDQ     25,,PR3
         1 001031   004000 316003                    CANQ    2048,DU
         1 001032   001041 601000 1                  TNZ     s:4727

      432     4726    2                 F$USRDCB.LASTSTA$->VSTA=BCMEDDCB$->F$DCB.LASTSTA$->VSTA;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:92   
   4726  1 001033   200005 474500                    LDP4    USRDCB$,,AUTO
         1 001034   400007 475500                    LDP5    7,,PR4
         1 001035   100007 476500                    LDP6    7,,PR1
         1 001036   000100 100500                    MLR     fill='000'O
         1 001037   600000 000040                    ADSC9   0,,PR6                   cn=0,n=32
         1 001040   500000 000040                    ADSC9   0,,PR5                   cn=0,n=32

      433     4727    2           IF F$USRDCB.WAIT~=0 THEN

   4727  1 001041   200005 473500                    LDP3    USRDCB$,,AUTO
         1 001042   300064 236100                    LDQ     52,,PR3
         1 001043   000020 316007                    CANQ    16,DL
         1 001044   001051 600000 1                  TZE     s:4730

      434     4728    2              F$USRDCB.TYC(1)=BCMEDDCB$->F$DCB.TYC(1)|F$USRDCB.TYC(1);

   4728  1 001045   100002 236100                    LDQ     2,,PR1
         1 001046   300002 276100                    ORQ     2,,PR3
         1 001047   300002 756100                    STQ     2,,PR3
         1 001050   001073 710000 1                  TRA     s:4736

      435     4729    3           ELSE DO;

      436     4730    4              IF FPTV.EVENT~=0 THEN DO;

   4730  1 001051   200004 474500                    LDP4    @FPTV,,AUTO
         1 001052   400001 235100                    LDA     1,,PR4
         1 001053   001070 600000 1                  TZE     s:4734

      437     4731    4                 CALL NKA$EVENT(BCMEDDCB$->F$DCB.TYC(1),FPTV.EVENT);

   4731  1 001054   200004 236100                    LDQ     @FPTV,,AUTO
         1 001055   000001 036003                    ADLQ    1,DU
         1 001056   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 001057   200023 236100                    LDQ     BCMEDDCB$,,AUTO
         1 001060   000002 036003                    ADLQ    2,DU
         1 001061   200044 756100                    STQ     FPTV$$+1,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:93   
         1 001062   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 001063   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001064   000000 701000 xent               TSX1    NKA$EVENT
         1 001065   000000 011000                    NOP     0

      438     4732    4                 RETURN;

   4732  1 001066   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001067   000001 702211                    TSX2  ! 1,X1

      439     4733    4                 END;
      440     4734    3              F$USRDCB.TYC(0)=BCMEDDCB$->F$DCB.TYC(1)|F$USRDCB.TYC(0);

   4734  1 001070   100002 236100                    LDQ     2,,PR1
         1 001071   300001 276100                    ORQ     1,,PR3
         1 001072   300001 756100                    STQ     1,,PR3

      441     4735    3              END;

      442     4736    2           RETURN;

   4736  1 001073   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001074   000001 702211                    TSX2  ! 1,X1

      443     4737    2   END STREAMEND;
      444     4738        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:94   
      445     4739    1   NSTRMPREP: PROC ALTRET;

   4739  1 001075   200032 741300       NSTRMPREP    STX1  ! CONTFORMMORE+2,,AUTO

      446     4740        /*  NSTRMPREP prepares things for the output formatter for a
      447     4741            non-streamed user DCB.  If the output formatter isn't needed
      448     4742            (i.e., not a WRITE), it ALTRETURNs.  B$JIT.ERR is set zero or
      449     4743            nonzero depending on whether the operation succeeded.
      450     4744            If the output formatter is needed, it RETURNs with --
      451     4745                USRDCB$ pointing to user's DCB.
      452     4746                MEDDCB$ pointing to user's DCB.
      453     4747         */
      454     4748    2           USRDCB$=B$JIT.DCB$;

   4748  1 001076   000000 470400 xsym               LDP0    B$JIT$
         1 001077   000232 236100                    LDQ     154,,PR0
         1 001100   200005 756100                    STQ     USRDCB$,,AUTO

      455     4749    2           MEDDCB$=USRDCB$;

   4749  1 001101   200006 756100                    STQ     MEDDCB$,,AUTO

      456     4750    2           CALL FMO$GETPFB(I);

   4750  1 001102   200014 631500                    EPPR1   I,,AUTO
         1 001103   200044 451500                    STP1    FPTV$$+1,,AUTO
         1 001104   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 001105   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001106   000000 701000 xent               TSX1    FMO$GETPFB
         1 001107   000000 011000                    NOP     0

      457     4751    2           IF USRDCB$ = DCBADDR(%M$UC#)

   4751  1 001110   000000 470400 2                  LDP0    0
         1 001111   000000 471500                    LDP1    0,,PR0
         1 001112   200005 236100                    LDQ     USRDCB$,,AUTO
         1 001113   100003 116100                    CMPQ    3,,PR1
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:95   
         1 001114   001120 601000 1                  TNZ     s:4754

      458     4752    2           THEN
      459     4753    2              F$MEDDCB.STR = I;

   4753  1 001115   200006 473500                    LDP3    MEDDCB$,,AUTO
         1 001116   200014 236100                    LDQ     I,,AUTO
         1 001117   300077 552104                    STBQ    63,'04'O,PR3

      460     4754    3           DO CASE(FPTCODE);

   4754  1 001120   200003 473500                    LDP3    @FPTCODE,,AUTO
         1 001121   300000 235100                    LDA     0,,PR3
         1 001122   000007 115007                    CMPA    7,DL
         1 001123   001125 602005 1                  TNC     s:4754+5,AL
         1 001124   001412 710000 1                  TRA     s:4808
         1 001125   001201 710000 1                  TRA     s:4767
         1 001126   001134 710000 1                  TRA     s:4756
         1 001127   001412 710000 1                  TRA     s:4808
         1 001130   001415 710000 1                  TRA     s:4810
         1 001131   001443 710000 1                  TRA     s:4820
         1 001132   001412 710000 1                  TRA     s:4808
         1 001133   001440 710000 1                  TRA     s:4818

      461     4755    3            CASE(FPTWRITE);

      462     4756    4              DO CASE(F$MEDDCB.MEDIA);

   4756  1 001134   200006 474500                    LDP4    MEDDCB$,,AUTO
         1 001135   400103 236100                    LDQ     67,,PR4
         1 001136   000022 772000                    QRL     18
         1 001137   000777 376007                    ANQ     511,DL
         1 001140   000006 136007                    SBLQ    6,DL
         1 001141   000024 116007                    CMPQ    20,DL
         1 001142   001144 602006 1                  TNC     s:4756+8,QL
         1 001143   001175 710000 1                  TRA     s:4763
         1 001144   001170 710000 1                  TRA     s:4758
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:96   
         1 001145   001172 710000 1                  TRA     s:4761
         1 001146   001170 710000 1                  TRA     s:4758
         1 001147   001175 710000 1                  TRA     s:4763
         1 001150   001175 710000 1                  TRA     s:4763
         1 001151   001175 710000 1                  TRA     s:4763
         1 001152   001170 710000 1                  TRA     s:4758
         1 001153   001170 710000 1                  TRA     s:4758
         1 001154   001175 710000 1                  TRA     s:4763
         1 001155   001175 710000 1                  TRA     s:4763
         1 001156   001175 710000 1                  TRA     s:4763
         1 001157   001175 710000 1                  TRA     s:4763
         1 001160   001170 710000 1                  TRA     s:4758
         1 001161   001175 710000 1                  TRA     s:4763
         1 001162   001175 710000 1                  TRA     s:4763
         1 001163   001175 710000 1                  TRA     s:4763
         1 001164   001175 710000 1                  TRA     s:4763
         1 001165   001175 710000 1                  TRA     s:4763
         1 001166   001175 710000 1                  TRA     s:4763
         1 001167   001170 710000 1                  TRA     s:4758

      463     4757    4               CASE(FMTCG#,FMTUC#,FMTOCCG#,FMTSYMB#,FMTDEV#,FMTNC#);

      464     4758    4                 RETURN; /* These are the good ones.*/

   4758  1 001170   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001171   000001 702211                    TSX2  ! 1,X1

      465     4759        /*  Cases from here on will all ALTRETURN.*/
      466     4760    4               CASE(FMTNO#);

      467     4761    4                 B$JIT.ERR='0'B;

   4761  1 001172   000000 475400 xsym               LDP5    B$JIT$
         1 001173   500012 450100                    STZ     10,,PR5
         1 001174   001446 710000 1                  TRA     ALTR

      468     4762    4               CASE(ELSE);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:97   

      469     4763    4                 CALL SC_FSBADDCB;

   4763  1 001175   000000 713400 xsym               CLIMB   SC_FSBADDCB
         1 001176   000000 600000 xsid               climb   nvectors=         0

      470     4764    4                 ALTRETURN;

   4764  1 001177   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001200   000000 702211                    TSX2  ! 0,X1

      471     4765    4               END;

      472     4766    3            CASE(FPTREAD);

      473     4767    3              F$MEDDCB.ARS=0;

   4767  1 001201   200006 474500                    LDP4    MEDDCB$,,AUTO
         1 001202   400000 450100                    STZ     0,,PR4

      474     4768    4              DO CASE(F$MEDDCB.MEDIA);

   4768  1 001203   400103 236100                    LDQ     67,,PR4
         1 001204   000022 772000                    QRL     18
         1 001205   000777 376007                    ANQ     511,DL
         1 001206   000006 136007                    SBLQ    6,DL
         1 001207   000024 116007                    CMPQ    20,DL
         1 001210   001212 602006 1                  TNC     s:4768+7,QL
         1 001211   001403 710000 1                  TRA     s:4803
         1 001212   001236 710000 1                  TRA     s:4770
         1 001213   001253 710000 1                  TRA     s:4773
         1 001214   001257 710000 1                  TRA     s:4775
         1 001215   001403 710000 1                  TRA     s:4803
         1 001216   001403 710000 1                  TRA     s:4803
         1 001217   001403 710000 1                  TRA     s:4803
         1 001220   001277 710000 1                  TRA     s:4779
         1 001221   001352 710000 1                  TRA     s:4794
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:98   
         1 001222   001403 710000 1                  TRA     s:4803
         1 001223   001403 710000 1                  TRA     s:4803
         1 001224   001403 710000 1                  TRA     s:4803
         1 001225   001403 710000 1                  TRA     s:4803
         1 001226   001367 710000 1                  TRA     s:4797
         1 001227   001403 710000 1                  TRA     s:4803
         1 001230   001403 710000 1                  TRA     s:4803
         1 001231   001403 710000 1                  TRA     s:4803
         1 001232   001403 710000 1                  TRA     s:4803
         1 001233   001403 710000 1                  TRA     s:4803
         1 001234   001403 710000 1                  TRA     s:4803
         1 001235   001377 710000 1                  TRA     s:4800

      475     4769    4               CASE(FMTDEV#);

      476     4770    4                 CALL NKA$DEVIO(MFC_READ,FPTV.DVBYTE,BINASC(0),

   4770  1 001236   200004 236100                    LDQ     @FPTV,,AUTO
         1 001237   000001 036003                    ADLQ    1,DU
         1 001240   000007 235000 2                  LDA     7
         1 001241   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 001242   200004 236100                    LDQ     @FPTV,,AUTO
         1 001243   000003 036003                    ADLQ    3,DU
         1 001244   000001 235000 2                  LDA     1
         1 001245   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 001246   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 001247   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 001250   000000 701000 xent               TSX1    NKA$DEVIO
         1 001251   001446 702000 1                  TSX2    ALTR
         1 001252   001407 710000 1                  TRA     s:4806

      477     4771    4                   FPTV.EVENT) ALTRET(ALTR);
      478     4772    4               CASE(FMTNO#);

      479     4773    4                 B$JIT.ERR=ERR$EOF; GOTO ALTR;

   4773  1 001253   000012 236000 0                  LDQ     ERR$EOF
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:99   
         1 001254   000000 475400 xsym               LDP5    B$JIT$
         1 001255   500012 756100                    STQ     10,,PR5

   4773  1 001256   001446 710000 1                  TRA     ALTR

      480     4774    4               CASE(FMTCG#);

      481     4775    4                 CALL KCI$RWCG(MFC_READ,FPTV.DVBYTE,BINASC(0),

   4775  1 001257   200005 475500                    LDP5    USRDCB$,,AUTO
         1 001260   500006 476500                    LDP6    6,,PR5
         1 001261   200050 456500                    STP6    FPTV$$+5,,AUTO
         1 001262   200004 236100                    LDQ     @FPTV,,AUTO
         1 001263   000001 036003                    ADLQ    1,DU
         1 001264   000007 235000 2                  LDA     7
         1 001265   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 001266   200004 236100                    LDQ     @FPTV,,AUTO
         1 001267   000003 036003                    ADLQ    3,DU
         1 001270   000001 235000 2                  LDA     1
         1 001271   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 001272   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 001273   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001274   000000 701000 xent               TSX1    KCI$RWCG
         1 001275   001446 702000 1                  TSX2    ALTR
         1 001276   001407 710000 1                  TRA     s:4806

      482     4776    4                   FPTV.EVENT,F$USRDCB.SETSTA$->VSST)
      483     4777    4                   ALTRET(ALTR);
      484     4778    4               CASE(FMTUC#);

      485     4779    4                 F$MEDDCB.WAIT = F$USRDCB.WAIT;

   4779  1 001277   200005 475500                    LDP5    USRDCB$,,AUTO
         1 001300   500064 236100                    LDQ     52,,PR5
         1 001301   400064 676100                    ERQ     52,,PR4
         1 001302   000020 376007                    ANQ     16,DL
         1 001303   400064 656100                    ERSQ    52,,PR4
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:100  

      486     4780    4                 CALL KIA$UCIO(MFC_READ,FPTV.DVBYTE,BINASC(0),

   4780  1 001304   200004 236100                    LDQ     @FPTV,,AUTO
         1 001305   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 001306   200044 636500                    EPPR6   FPTV$$+1,,AUTO
         1 001307   200051 456500                    STP6    FPTV$$+6,,AUTO
         1 001310   000001 036003                    ADLQ    1,DU
         1 001311   200050 756100                    STQ     FPTV$$+5,,AUTO
         1 001312   000007 236000 2                  LDQ     7
         1 001313   200047 756100                    STQ     FPTV$$+4,,AUTO
         1 001314   200004 236100                    LDQ     @FPTV,,AUTO
         1 001315   000003 036003                    ADLQ    3,DU
         1 001316   200046 756100                    STQ     FPTV$$+3,,AUTO
         1 001317   000001 236000 2                  LDQ     1
         1 001320   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 001321   200045 630500                    EPPR0   FPTV$$+2,,AUTO
         1 001322   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001323   000000 701000 xent               TSX1    KIA$UCIO
         1 001324   001446 702000 1                  TSX2    ALTR

      487     4781    4                   FPTV.EVENT,ADDR(FPTV)) ALTRET(ALTR);
      488     4782    4                 IF F$USRDCB.WAIT = 0

   4782  1 001325   200005 470500                    LDP0    USRDCB$,,AUTO
         1 001326   000064 236100                    LDQ     52,,PR0
         1 001327   000020 316007                    CANQ    16,DL
         1 001330   001407 601000 1                  TNZ     s:4806

      489     4783    5                 THEN DO;

      490     4784                         %LOCK (G=F_DCBLOCK);

   4785  1 001331   000010 630400 2                  EPPR0   8
         1 001332   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001333   000000 701000 xent               TSX1    HFC$LOCK
         1 001334   000000 011000                    NOP     0
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:101  

      491     4787    5                    F$MEDDCB.FCN(0) = BINBIT (F$MEDDCB.FCN.CNT(0) + 1, 9);

   4787  1 001335   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 001336   000074 236100                    LDQ     60,,PR0
         1 001337   000033 772000                    QRL     27
         1 001340   000377 376007                    ANQ     255,DL
         1 001341   000001 036007                    ADLQ    1,DL
         1 001342   000033 736000                    QLS     27
         1 001343   000074 552140                    STBQ    60,'40'O,PR0

      492     4788                         %UNLOCK (G=F_DCBLOCK);

   4789  1 001344   000010 630400 2                  EPPR0   8
         1 001345   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001346   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001347   000000 011000                    NOP     0

      493     4791    5                    ALTRETURN;

   4791  1 001350   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001351   000000 702211                    TSX2  ! 0,X1

      494     4792    5                    END;
      495     4793    4               CASE(FMTOCCG#);

      496     4794    4                 CALL OCU$RWUC(MFC_READ,FPTV.DVBYTE,BINASC(0),

   4794  1 001352   200004 236100                    LDQ     @FPTV,,AUTO
         1 001353   000001 036003                    ADLQ    1,DU
         1 001354   000007 235000 2                  LDA     7
         1 001355   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 001356   200004 236100                    LDQ     @FPTV,,AUTO
         1 001357   000003 036003                    ADLQ    3,DU
         1 001360   000001 235000 2                  LDA     1
         1 001361   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 001362   200044 630500                    EPPR0   FPTV$$+1,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:102  
         1 001363   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 001364   000000 701000 xent               TSX1    OCU$RWUC
         1 001365   001446 702000 1                  TSX2    ALTR
         1 001366   001407 710000 1                  TRA     s:4806

      497     4795    4                   FPTV.EVENT) ALTRET(ALTR);
      498     4796    4               CASE(FMTSYMB#);

      499     4797    4                 CALL FMH$SYMB(FPTREAD,FPTV) ALTRET(ALTR);

   4797  1 001367   200004 236100                    LDQ     @FPTV,,AUTO
         1 001370   000001 235000 2                  LDA     1
         1 001371   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 001372   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 001373   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001374   000000 701000 xent               TSX1    FMH$SYMB
         1 001375   001446 702000 1                  TSX2    ALTR
         1 001376   001407 710000 1                  TRA     s:4806

      500     4798
      501     4799    4               CASE(FMTNC#);

      502     4800    4                 CALL KIS$OSI_READ ALTRET(ALTR);

   4800  1 001377   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001400   000000 701000 xent               TSX1    KIS$OSI_READ
         1 001401   001446 702000 1                  TSX2    ALTR
         1 001402   001407 710000 1                  TRA     s:4806

      503     4801
      504     4802    4               CASE(ELSE);

      505     4803    4                 CALL SC_FSBADDCB;

   4803  1 001403   000000 713400 xsym               CLIMB   SC_FSBADDCB
         1 001404   000000 600000 xsid               climb   nvectors=         0

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:103  
      506     4804    4                 ALTRETURN;

   4804  1 001405   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001406   000000 702211                    TSX2  ! 0,X1

      507     4805    4               END;

      508     4806    3              B$JIT.ERR='0'B;

   4806  1 001407   000000 470400 xsym               LDP0    B$JIT$
         1 001410   000012 450100                    STZ     10,,PR0
         1 001411   001446 710000 1                  TRA     ALTR

      509     4807    3            CASE(ELSE);

      510     4808    3              B$JIT.ERR='0'B;

   4808  1 001412   000000 474400 xsym               LDP4    B$JIT$
         1 001413   400012 450100                    STZ     10,,PR4
         1 001414   001446 710000 1                  TRA     ALTR

      511     4809    3            CASE(FPTPREC);

      512     4810    3              IF ADDR(FPTV)->PRECORDFPT.BOF OR

   4810  1 001415   200004 474500                    LDP4    @FPTV,,AUTO
         1 001416   400000 236100                    LDQ     0,,PR4
         1 001417   020000 316007                    CANQ    8192,DL
         1 001420   001431 601000 1                  TNZ     s:4815
         1 001421   010000 316007                    CANQ    4096,DL
         1 001422   001431 601000 1                  TNZ     s:4815
         1 001423   400001 235100                    LDA     1,,PR4
         1 001424   001431 601000 1                  TNZ     s:4815
         1 001425   400000 316007                    CANQ    -131072,DL
         1 001426   001431 601000 1                  TNZ     s:4815
         1 001427   200000 316007                    CANQ    65536,DL
         1 001430   001435 600000 1                  TZE     s:4816
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:104  

      513     4811    3                ADDR(FPTV)->PRECORDFPT.EOF OR
      514     4812    3                ADDR(FPTV)->PRECORDFPT.N~=0 OR
      515     4813    3                ADDR(FPTV)->PRECORDFPT.KEYS OR
      516     4814    3                ADDR(FPTV)->PRECORDFPT.KEYR THEN
      517     4815    3                 B$JIT.ERR=ERR$POS;

   4815  1 001431   000014 236000 0                  LDQ     ERR$POS
         1 001432   000000 475400 xsym               LDP5    B$JIT$
         1 001433   500012 756100                    STQ     10,,PR5
         1 001434   001446 710000 1                  TRA     ALTR

      518     4816    3              ELSE B$JIT.ERR='0'B;

   4816  1 001435   000000 475400 xsym               LDP5    B$JIT$
         1 001436   500012 450100                    STZ     10,,PR5
         1 001437   001446 710000 1                  TRA     ALTR

      519     4817    3            CASE(FPTREW);

      520     4818    3              B$JIT.ERR='0'B;

   4818  1 001440   000000 474400 xsym               LDP4    B$JIT$
         1 001441   400012 450100                    STZ     10,,PR4
         1 001442   001446 710000 1                  TRA     ALTR

      521     4819    3            CASE(FPTPFIL);

      522     4820    3              B$JIT.ERR=ERR$POS;

   4820  1 001443   000014 236000 0                  LDQ     ERR$POS
         1 001444   000000 474400 xsym               LDP4    B$JIT$
         1 001445   400012 756100                    STQ     10,,PR4

      523     4821    3            END;

      524     4822    2   ALTR:   ALTRETURN;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:105  

   4822  1 001446   200032 221300       ALTR         LDX1  ! CONTFORMMORE+2,,AUTO
         1 001447   000000 702211                    TSX2  ! 0,X1

      525     4823    2   END NSTRMPREP;
      526     4824        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:106  
      527     4825    1   TTYFORMATIT: PROC;

   4825  1 001450   200032 741300       TTYFORMATIT  STX1  ! CONTFORMMORE+2,,AUTO

      528     4826    2           IF NOT F$USRDCB.IWL.TABIWL THEN

   4826  1 001451   200005 470500                    LDP0    USRDCB$,,AUTO
         1 001452   000103 236100                    LDQ     67,,PR0
         1 001453   400000 316007                    CANQ    -131072,DL
         1 001454   001457 601000 1                  TNZ     s:4828

      529     4827    2              CALL DDFTAB ALTRET(ALTRETUR);

   4827  1 001455   004222 701000 1                  TSX1    DDFTAB
         1 001456   001626 702000 1                  TSX2    ALTRETUR

      530     4828    2           IF NOT F$USRDCB.IWL.HDRIWL THEN

   4828  1 001457   200005 470500                    LDP0    USRDCB$,,AUTO
         1 001460   000103 236100                    LDQ     67,,PR0
         1 001461   100000 316007                    CANQ    32768,DL
         1 001462   001465 601000 1                  TNZ     s:4830

      531     4829    2              CALL DDFHEADER ALTRET(ALTRETUR);

   4829  1 001463   004434 701000 1                  TSX1    DDFHEADER
         1 001464   001626 702000 1                  TSX2    ALTRETUR

      532     4830    2           CALL PREPWRITE ALTRET(ALTRETUR);

   4830  1 001465   003306 701000 1                  TSX1    PREPWRITE
         1 001466   001626 702000 1                  TSX2    ALTRETUR

      533     4831
      534     4832        /* If this is not an IC device we want to perserve blanks */
      535     4833    2           IF ((F$MEDDCB.DDEV & %DDEV_IC#) = '0'B)

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:107  
   4833  1 001467   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 001470   000004 236100                    LDQ     4,,PR0
         1 001471   000022 736000                    QLS     18
         1 001472   777000 376003                    ANQ     -512,DU
         1 001473   100000 376003                    ANQ     32768,DU
         1 001474   001500 601000 1                  TNZ     s:4837

      536     4834    2           THEN
      537     4835    2              USRDVBYTE = USRDVBYTE | %DVBYTE_BP#;

   4835  1 001475   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 001476   200000 276003                    ORQ     65536,DU
         1 001477   200012 756100                    STQ     USRDVBYTE,,AUTO

      538     4836
      539     4837    3           DO CASE(NK$VFC.FCN);

   4837  1 001500   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 001501   000037 772000                    QRL     31
         1 001502   000007 376007                    ANQ     7,DL
         1 001503   000010 116007                    CMPQ    8,DL
         1 001504   001506 602006 1                  TNC     s:4837+6,QL
         1 001505   001607 710000 1                  TRA     s:4864
         1 001506   001607 710000 1                  TRA     s:4864
         1 001507   001516 710000 1                  TRA     s:4840
         1 001510   001607 710000 1                  TRA     s:4864
         1 001511   001614 710000 1                  TRA     WRTIT
         1 001512   001614 710000 1                  TRA     WRTIT
         1 001513   001614 710000 1                  TRA     WRTIT
         1 001514   001614 710000 1                  TRA     WRTIT
         1 001515   001614 710000 1                  TRA     WRTIT

      540     4838    3            CASE(%VFCF_HDR,%VFCF_SKB,%VFCF_SPB,%VFCF_SKA,%VFCF_SPA);

      541     4839    3            CASE(%VFCF_SPC);

      542     4840    4              DO CASE(NK$VFC.COUNT);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:108  

   4840  1 001516   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 001517   000033 772000                    QRL     27
         1 001520   000017 376007                    ANQ     15,DL
         1 001521   000020 116007                    CMPQ    16,DL
         1 001522   001524 602006 1                  TNC     s:4840+6,QL
         1 001523   001601 710000 1                  TRA     s:4859
         1 001524   001601 710000 1                  TRA     s:4859
         1 001525   001544 710000 1                  TRA     s:4842
         1 001526   001544 710000 1                  TRA     s:4842
         1 001527   001544 710000 1                  TRA     s:4842
         1 001530   001551 710000 1                  TRA     s:4844
         1 001531   001551 710000 1                  TRA     s:4844
         1 001532   001551 710000 1                  TRA     s:4844
         1 001533   001551 710000 1                  TRA     s:4844
         1 001534   001555 710000 1                  TRA     s:4847
         1 001535   001562 710000 1                  TRA     s:4849
         1 001536   001606 710000 1                  TRA     s:4862
         1 001537   001575 710000 1                  TRA     s:4856
         1 001540   001601 710000 1                  TRA     s:4859
         1 001541   001606 710000 1                  TRA     s:4862
         1 001542   001606 710000 1                  TRA     s:4862
         1 001543   001606 710000 1                  TRA     s:4862

      543     4841    4               CASE(%VFCS_OTAB,%VFCS_SEQN,%VFCS_ITAB); /*Let these through*/

      544     4842    4                 USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;

   4842  1 001544   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 001545   020000 276003                    ORQ     8192,DU
         1 001546   200000 276003                    ORQ     65536,DU
         1 001547   200012 756100                    STQ     USRDVBYTE,,AUTO
         1 001550   001614 710000 1                  TRA     WRTIT

      545     4843    4               CASE(%VFCS_SPRM,%VFCS_SPRO,%VFCS_SLLN,%VFCS_SLLP);
              4843                        /*Don't let these through*/

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:109  
      546     4844    4                 B$JIT.ERR='0'B;

   4844  1 001551   000000 471400 xsym               LDP1    B$JIT$
         1 001552   100012 450100                    STZ     10,,PR1

      547     4845    4                 RETURN;

   4845  1 001553   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001554   000001 702211                    TSX2  ! 1,X1

      548     4846    4               CASE(%VFCS_SHDR); /*Has already been fixed; set trans.*/

      549     4847    4                 USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;

   4847  1 001555   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 001556   020000 276003                    ORQ     8192,DU
         1 001557   200000 276003                    ORQ     65536,DU
         1 001560   200012 756100                    STQ     USRDVBYTE,,AUTO
         1 001561   001614 710000 1                  TRA     WRTIT

      550     4848    4               CASE(%VFCS_SLPP); /*No-no; this is IMP stuff.*/

      551     4849    5                 IF NOT USRDVBYTE&%DVBYTE_TRANS# THEN DO;

   4849  1 001562   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 001563   020000 376003                    ANQ     8192,DU
         1 001564   001571 601000 1                  TNZ     s:4853

      552     4850    5                    B$JIT.ERR='0'B;

   4850  1 001565   000000 471400 xsym               LDP1    B$JIT$
         1 001566   100012 450100                    STZ     10,,PR1

      553     4851    5                    RETURN;

   4851  1 001567   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001570   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:110  

      554     4852    5                    END;
      555     4853    4                 USRDVBYTE = USRDVBYTE | %DVBYTE_RRR#;

   4853  1 001571   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 001572   010000 276003                    ORQ     4096,DU
         1 001573   200012 756100                    STQ     USRDVBYTE,,AUTO
         1 001574   001614 710000 1                  TRA     WRTIT

      556     4854    4               CASE(%VFCS_PGND); /*Let this through*/

      557     4855    4               CASE(%VFCS_VFU); /*Not this one, for now.*/

      558     4856    4                 B$JIT.ERR='0'B;

   4856  1 001575   000000 471400 xsym               LDP1    B$JIT$
         1 001576   100012 450100                    STZ     10,,PR1

      559     4857    4                 RETURN;

   4857  1 001577   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001600   000001 702211                    TSX2  ! 1,X1

      560     4858    4               CASE(ELSE); /*Undefined ones give him an error.*/

      561     4859    4                 B$JIT.ERR=ERR$INVVFC;

   4859  1 001601   000017 236000 0                  LDQ     ERR$INVVFC
         1 001602   000000 471400 xsym               LDP1    B$JIT$
         1 001603   100012 756100                    STQ     10,,PR1

      562     4860    4                 RETURN;

   4860  1 001604   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001605   000001 702211                    TSX2  ! 1,X1

      563     4861    4               CASE(%VFCS_TRS0,%VFCS_TRS1,%VFCS_CLRWND); /*Let through as-is.*/
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:111  

      564     4862    4               END;

   4862  1 001606   001614 710000 1                  TRA     WRTIT

      565     4863    3            CASE(ELSE);

      566     4864    3              B$JIT.ERR=ERR$INVVFC;

   4864  1 001607   000017 236000 0                  LDQ     ERR$INVVFC
         1 001610   000000 471400 xsym               LDP1    B$JIT$
         1 001611   100012 756100                    STQ     10,,PR1

      567     4865    3              RETURN;

   4865  1 001612   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001613   000001 702211                    TSX2  ! 1,X1

      568     4866    3            END;

   4863  1 001614                       WRTIT        null
      569     4867    2   WRTIT:  ;
      570     4868    2           CALL MEDIUM(MFC_WRITE, USRDVBYTE.GOOD, VFCCHAR)

   4868  1 001614   200022 630500                    EPPR0   VFCCHAR,,AUTO
         1 001615   200041 450500                    STP0    @DVB+1,,AUTO
         1 001616   200012 631500                    EPPR1   USRDVBYTE,,AUTO
         1 001617   200040 451500                    STP1    @VFC+1,,AUTO
         1 001620   000011 236000 2                  LDQ     9
         1 001621   200037 756100                    STQ     @FPT+1,,AUTO
         1 001622   002776 701000 1                  TSX1    MEDIUM
         1 001623   001626 702000 1                  TSX2    ALTRETUR

      571     4869    2             ALTRET(ALTRETUR);
      572     4870    2           B$JIT.ERR='0'B;

   4870  1 001624   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:112  
         1 001625   000012 450100                    STZ     10,,PR0

   4870  1 001626                       ALTRETUR     null
      573     4871    2   ALTRETUR:;
      574     4872    2           RETURN;

   4872  1 001626   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001627   000001 702211                    TSX2  ! 1,X1

      575     4873        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:113  
      576     4874    2   FPRGFORMATIT: ENTRY;

   4874  1 001630   200032 741300       FPRGFORMATIT STX1  ! CONTFORMMORE+2,,AUTO

      577     4875    2           CALL PREPWRITE ALTRET (ALTRETUR);

   4875  1 001631   003306 701000 1                  TSX1    PREPWRITE
         1 001632   001626 702000 1                  TSX2    ALTRETUR

      578     4876    2           USRDVBYTE = USRDVBYTE | %DVBYTE_BP#;

   4876  1 001633   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 001634   200000 276003                    ORQ     65536,DU
         1 001635   200012 756100                    STQ     USRDVBYTE,,AUTO

      579     4877    2           GOTO WRTIT;

   4877  1 001636   001614 710000 1                  TRA     WRTIT

      580     4878        /**/
      581     4879    2   GRFORMATIT: ENTRY;

   4879  1 001637   200032 741300       GRFORMATIT   STX1  ! CONTFORMMORE+2,,AUTO

      582     4880    2           CALL PREPWRITE ALTRET (ALTRETUR);

   4880  1 001640   003306 701000 1                  TSX1    PREPWRITE
         1 001641   001626 702000 1                  TSX2    ALTRETUR

      583     4881    2           F$MEDDCB.FORM$->CODE16.RECNO = F$MEDDCB.FORM$->CODE16.RECNO +1;

   4881  1 001642   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 001643   000050 471500                    LDP1    40,,PR0
         1 001644   100004 235100                    LDA     4,,PR1
         1 001645   000001 035007                    ADLA    1,DL
         1 001646   100004 755100                    STA     4,,PR1

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:114  
      584     4882    2           IF (VFCCHAR = 'p')

   4882  1 001647   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 001650   777000 376003                    ANQ     -512,DU
         1 001651   160000 116003                    CMPQ    57344,DU
         1 001652   001663 601000 1                  TNZ     s:4888

      585     4883    3           THEN DO;

      586     4884    3              F$MEDDCB.FORM$->CODE16.PAGENO = F$MEDDCB.FORM$->CODE16.PAGENO + 1;

   4884  1 001653   000050 471500                    LDP1    40,,PR0
         1 001654   100005 220100                    LDX0    5,,PR1
         1 001655   000001 621010                    EAX1    1,X0
         1 001656   100005 741100                    STX1    5,,PR1

      587     4885    3              F$MEDDCB.PGINGRAN = F$MEDDCB.PGINGRAN + 1;

   4885  1 001657   000102 236100                    LDQ     66,,PR0
         1 001660   000001 036007                    ADLQ    1,DL
         1 001661   000102 552104                    STBQ    66,'04'O,PR0

      588     4886    3              END;

   4886  1 001662   001665 710000 1                  TRA     s:4890

      589     4887    3           ELSE DO;

      590     4888    3              VFCCHAR = BITASC ('036'O);

   4888  1 001663   036000 236003                    LDQ     15360,DU
         1 001664   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

      591     4889    3              END;

      592     4890    2           GOTO WRTIT;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:115  
   4890  1 001665   001614 710000 1                  TRA     WRTIT

      593     4891    2   END TTYFORMATIT;
      594     4892        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:116  
      595     4893    1   FORMATIT: PROC;

   4893  1 001666   200032 741300       FORMATIT     STX1  ! CONTFORMMORE+2,,AUTO

      596     4894    2           IF NOT F$USRDCB.IWL.TABIWL THEN

   4894  1 001667   200005 470500                    LDP0    USRDCB$,,AUTO
         1 001670   000103 236100                    LDQ     67,,PR0
         1 001671   400000 316007                    CANQ    -131072,DL
         1 001672   001675 601000 1                  TNZ     s:4896

      597     4895    2              CALL DDFTAB ALTRET(ALTRETUR);

   4895  1 001673   004222 701000 1                  TSX1    DDFTAB
         1 001674   002774 702000 1                  TSX2    ALTRETUR

      598     4896    2           F$USRDCB.IWL.SEQIWL='1'B;

   4896  1 001675   200005 470500                    LDP0    USRDCB$,,AUTO
         1 001676   200000 236007                    LDQ     65536,DL
         1 001677   000103 256100                    ORSQ    67,,PR0

      599     4897    2           CALL PREPWRITE ALTRET(ALTRETUR);

   4897  1 001700   003306 701000 1                  TSX1    PREPWRITE
         1 001701   002774 702000 1                  TSX2    ALTRETUR

      600     4898        /*      We have a non-BIN M$WRITE.
      601     4899                VFCCHAR is the VFC character from buffer or DVFC.
      602     4900                USRDVBYTE is a cleaned-up DVBYTE from the M$WRITE.
      603     4901         */
      604     4902    2           USRDVBYTE=USRDVBYTE|%DVBYTE_VFC#;

   4902  1 001702   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 001703   100000 276003                    ORQ     32768,DU
         1 001704   200012 756100                    STQ     USRDVBYTE,,AUTO

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:117  
      605     4903    2   MORESPA: CONTFORMMORE=0;

   4903  1 001705   200030 450100       MORESPA      STZ     CONTFORMMORE,,AUTO

      606     4904    3           IF F$MEDDCB.DDEV&%DDEV_IC# THEN DO;

   4904  1 001706   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 001707   000004 236100                    LDQ     4,,PR0
         1 001710   000022 736000                    QLS     18
         1 001711   777000 376003                    ANQ     -512,DU
         1 001712   100000 376003                    ANQ     32768,DU
         1 001713   002041 600000 1                  TZE     s:4939

      607     4905    4              DO CASE(NK$VFC.FCN);

   4905  1 001714   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 001715   000037 772000                    QRL     31
         1 001716   000007 376007                    ANQ     7,DL
         1 001717   000010 116007                    CMPQ    8,DL
         1 001720   001722 602006 1                  TNC     s:4905+6,QL
         1 001721   002014 710000 1                  TRA     s:4929
         1 001722   002014 710000 1                  TRA     s:4929
         1 001723   001732 710000 1                  TRA     s:4908
         1 001724   002014 710000 1                  TRA     s:4929
         1 001725   002021 710000 1                  TRA     s:4932
         1 001726   002021 710000 1                  TRA     s:4932
         1 001727   002021 710000 1                  TRA     s:4932
         1 001730   002021 710000 1                  TRA     s:4932
         1 001731   002021 710000 1                  TRA     s:4932

      608     4906    4               CASE(%VFCF_HDR,%VFCF_SKB,%VFCF_SPB,%VFCF_SKA,%VFCF_SPA);

      609     4907    4               CASE(%VFCF_SPC);

      610     4908    5                 DO CASE(NK$VFC.COUNT);

   4908  1 001732   200022 236100                    LDQ     VFCCHAR,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:118  
         1 001733   000033 772000                    QRL     27
         1 001734   000017 376007                    ANQ     15,DL
         1 001735   000020 116007                    CMPQ    16,DL
         1 001736   001740 602006 1                  TNC     s:4908+6,QL
         1 001737   002006 710000 1                  TRA     s:4924
         1 001740   002006 710000 1                  TRA     s:4924
         1 001741   001760 710000 1                  TRA     s:4910
         1 001742   001760 710000 1                  TRA     s:4910
         1 001743   001760 710000 1                  TRA     s:4910
         1 001744   001765 710000 1                  TRA     s:4912
         1 001745   001765 710000 1                  TRA     s:4912
         1 001746   001765 710000 1                  TRA     s:4912
         1 001747   001765 710000 1                  TRA     s:4912
         1 001750   001771 710000 1                  TRA     s:4915
         1 001751   001776 710000 1                  TRA     s:4917
         1 001752   002013 710000 1                  TRA     s:4927
         1 001753   002002 710000 1                  TRA     s:4921
         1 001754   002006 710000 1                  TRA     s:4924
         1 001755   002013 710000 1                  TRA     s:4927
         1 001756   002013 710000 1                  TRA     s:4927
         1 001757   002013 710000 1                  TRA     s:4927

      611     4909    5                  CASE(%VFCS_OTAB,%VFCS_SEQN,%VFCS_ITAB); /*Let these through*/

      612     4910    5                    USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;

   4910  1 001760   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 001761   020000 276003                    ORQ     8192,DU
         1 001762   200000 276003                    ORQ     65536,DU
         1 001763   200012 756100                    STQ     USRDVBYTE,,AUTO
         1 001764   002021 710000 1                  TRA     s:4932

      613     4911    5                  CASE(%VFCS_SPRM,%VFCS_SPRO,%VFCS_SLLN,%VFCS_SLLP);
              4911                           /*Don't let these through*/

      614     4912    5                    B$JIT.ERR='0'B;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:119  
   4912  1 001765   000000 471400 xsym               LDP1    B$JIT$
         1 001766   100012 450100                    STZ     10,,PR1

      615     4913    5                    RETURN;

   4913  1 001767   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 001770   000001 702211                    TSX2  ! 1,X1

      616     4914    5                  CASE(%VFCS_SHDR); /*Has already been fixed; set trans.*/

      617     4915    5                    USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;

   4915  1 001771   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 001772   020000 276003                    ORQ     8192,DU
         1 001773   200000 276003                    ORQ     65536,DU
         1 001774   200012 756100                    STQ     USRDVBYTE,,AUTO
         1 001775   002021 710000 1                  TRA     s:4932

      618     4916    5                  CASE(%VFCS_SLPP); /*No-no; this is IMP stuff.*/

      619     4917    5                    B$JIT.ERR='0'B;

   4917  1 001776   000000 471400 xsym               LDP1    B$JIT$
         1 001777   100012 450100                    STZ     10,,PR1

      620     4918    5                    RETURN;

   4918  1 002000   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 002001   000001 702211                    TSX2  ! 1,X1

      621     4919    5                  CASE(%VFCS_PGND); /*Let this through*/

      622     4920    5                  CASE(%VFCS_VFU); /*Not this one, for now.*/

      623     4921    5                    B$JIT.ERR='0'B;

   4921  1 002002   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:120  
         1 002003   100012 450100                    STZ     10,,PR1

      624     4922    5                    RETURN;

   4922  1 002004   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 002005   000001 702211                    TSX2  ! 1,X1

      625     4923    5                  CASE(ELSE); /*Undefined ones give him an error.*/

      626     4924    5                    B$JIT.ERR=ERR$INVVFC;

   4924  1 002006   000017 236000 0                  LDQ     ERR$INVVFC
         1 002007   000000 471400 xsym               LDP1    B$JIT$
         1 002010   100012 756100                    STQ     10,,PR1

      627     4925    5                    RETURN;

   4925  1 002011   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 002012   000001 702211                    TSX2  ! 1,X1

      628     4926    5                  CASE(%VFCS_TRS0,%VFCS_TRS1,%VFCS_CLRWND); /*Let through as-is.*/

      629     4927    5                  END;

   4927  1 002013   002021 710000 1                  TRA     s:4932

      630     4928    4               CASE(ELSE);

      631     4929    4                 B$JIT.ERR=ERR$INVVFC;

   4929  1 002014   000017 236000 0                  LDQ     ERR$INVVFC
         1 002015   000000 471400 xsym               LDP1    B$JIT$
         1 002016   100012 756100                    STQ     10,,PR1

      632     4930    4                 RETURN;

   4930  1 002017   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:121  
         1 002020   000001 702211                    TSX2  ! 1,X1

      633     4931    4               END;

      634     4932    3              IF F$USRDCB.HEADER$~=ADDR(NIL) AND

   4932  1 002021   200005 471500                    LDP1    USRDCB$,,AUTO
         1 002022   100046 236100                    LDQ     38,,PR1
         1 002023   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002024   002621 600000 1                  TZE     s:5093
         1 002025   200005 236100                    LDQ     USRDCB$,,AUTO
         1 002026   200006 116100                    CMPQ    MEDDCB$,,AUTO
         1 002027   002621 600000 1                  TZE     s:5093

      635     4933    4                USRDCB$~=MEDDCB$ THEN DO;

      636     4934    4                 USRDVBYTE=USRDVBYTE|%DVBYTE_DCBHDR#;

   4934  1 002030   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 002031   002000 276003                    ORQ     1024,DU
         1 002032   200012 756100                    STQ     USRDVBYTE,,AUTO

      637     4935    4                 IF NOT F$USRDCB.IWL.HDRIWL THEN

   4935  1 002033   100103 236100                    LDQ     67,,PR1
         1 002034   100000 316007                    CANQ    32768,DL
         1 002035   002621 601000 1                  TNZ     s:5093

      638     4936    4                    CALL DDFHEADER ALTRET(ALTRETUR);

   4936  1 002036   004434 701000 1                  TSX1    DDFHEADER
         1 002037   002774 702000 1                  TSX2    ALTRETUR

      639     4937    4                 END;

      640     4938    3              END/*F$USRDCB.DDEV.IC*/;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:122  
   4938  1 002040   002621 710000 1                  TRA     s:5093

      641     4939    3           ELSE IF F$MEDDCB.DDEV&%DDEV_LP# THEN DO;

   4939  1 002041   000004 236100                    LDQ     4,,PR0
         1 002042   000022 736000                    QLS     18
         1 002043   777000 376003                    ANQ     -512,DU
         1 002044   400000 376003                    ANQ     -131072,DU
         1 002045   002561 600000 1                  TZE     s:5075

      642     4940    3                 FORM$=F$MEDDCB.FORM$;

   4940  1 002046   000050 236100                    LDQ     40,,PR0
         1 002047   200007 756100                    STQ     FORM$,,AUTO

      643     4941    4                 DO CASE(NK$VFC.FCN);

   4941  1 002050   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 002051   000037 772000                    QRL     31
         1 002052   000007 376007                    ANQ     7,DL
         1 002053   000010 116007                    CMPQ    8,DL
         1 002054   002056 602006 1                  TNC     s:4941+6,QL
         1 002055   002554 710000 1                  TRA     s:5070
         1 002056   002554 710000 1                  TRA     s:5070
         1 002057   002414 710000 1                  TRA     s:5019
         1 002060   002554 710000 1                  TRA     s:5070
         1 002061   002110 710000 1                  TRA     s:4947
         1 002062   002301 710000 1                  TRA     s:4992
         1 002063   002244 710000 1                  TRA     s:4979
         1 002064   002146 710000 1                  TRA     s:4960
         1 002065   002066 710000 1                  TRA     s:4943

      644     4942    4                  CASE(%VFCF_HDR);

      645     4943    4                    CALL SETHEADER ALTRET(RETUR);

   4943  1 002066   003674 701000 1                  TSX1    SETHEADER
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:123  
         1 002067   002772 702000 1                  TSX2    RETUR

      646     4944    4                    CODE16.LINENO=NK$VFC.COUNT;

   4944  1 002070   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 002071   000033 772000                    QRL     27
         1 002072   000017 376007                    ANQ     15,DL
         1 002073   000000 620006                    EAX0    0,QL
         1 002074   200007 470500                    LDP0    FORM$,,AUTO
         1 002075   000005 440100                    SXL0    5,,PR0

      647     4945    4                    CODE16.NOTCOL1=(NK$VFC.COUNT=0);

   4945  1 002076   400000 221003                    LDX1    -131072,DU
         1 002077   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 002100   017000 316003                    CANQ    7680,DU
         1 002101   002103 600000 1                  TZE     s:4945+5
         1 002102   000000 221003                    LDX1    0,DU
         1 002103   000000 636011                    EAQ     0,X1
         1 002104   000007 676100                    ERQ     7,,PR0
         1 002105   400000 376003                    ANQ     -131072,DU
         1 002106   000007 656100                    ERSQ    7,,PR0
         1 002107   002621 710000 1                  TRA     s:5093

      648     4946    4                  CASE(%VFCF_SKB);

      649     4947    4                    CALL FINDLINE ALTRET(ASIFSPB);

   4947  1 002110   003604 701000 1                  TSX1    FINDLINE
         1 002111   002152 702000 1                  TSX2    ASIFSPB

      650     4948    5                    IF I>=F$USRDCB.LINES THEN DO;

   4948  1 002112   200005 470500                    LDP0    USRDCB$,,AUTO
         1 002113   000044 236100                    LDQ     36,,PR0
         1 002114   000022 772000                    QRL     18
         1 002115   200014 116100                    CMPQ    I,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:124  
         1 002116   002140 605400 1                  TPNZ    s:4957

      651     4949    5                       CALL SETHEADER ALTRET(RETUR);

   4949  1 002117   003674 701000 1                  TSX1    SETHEADER
         1 002120   002772 702000 1                  TSX2    RETUR

      652     4950    5                       CALL FINDLINE;

   4950  1 002121   003604 701000 1                  TSX1    FINDLINE
         1 002122   000000 011000                    NOP     0

      653     4951    5                       CALL DOHEADER ALTRET(ALTRETUR);

   4951  1 002123   004021 701000 1                  TSX1    DOHEADER
         1 002124   002774 702000 1                  TSX2    ALTRETUR

      654     4952    6                       IF I>=F$USRDCB.LINES THEN DO;

   4952  1 002125   200005 470500                    LDP0    USRDCB$,,AUTO
         1 002126   000044 236100                    LDQ     36,,PR0
         1 002127   000022 772000                    QRL     18
         1 002130   200014 116100                    CMPQ    I,,AUTO
         1 002131   002140 605400 1                  TPNZ    s:4957

      655     4953    6                          VFCCHAR='`' /*VFC_SPB0*/;

   4953  1 002132   140000 236003                    LDQ     49152,DU
         1 002133   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

      656     4954    6                          I=CODE16.LINENO;

   4954  1 002134   200007 471500                    LDP1    FORM$,,AUTO
         1 002135   100005 236100                    LDQ     5,,PR1
         1 002136   777777 376007                    ANQ     -1,DL
         1 002137   200014 756100                    STQ     I,,AUTO

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:125  
      657     4955    6                          END;

      658     4956    5                       END;

      659     4957    4                    CODE16.LINENO=I;

   4957  1 002140   200014 720100                    LXL0    I,,AUTO
         1 002141   200007 471500                    LDP1    FORM$,,AUTO
         1 002142   100005 440100                    SXL0    5,,PR1

      660     4958    4                    CODE16.NOTCOL1=%YES#;

   4958  1 002143   400000 236003                    LDQ     -131072,DU
         1 002144   100007 256100                    ORSQ    7,,PR1
         1 002145   002621 710000 1                  TRA     s:5093

      661     4959    4                  CASE(%VFCF_SPB);

      662     4960    4                    UVFCLINES=NK$VFC.COUNT;

   4960  1 002146   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 002147   000033 772000                    QRL     27
         1 002150   000017 376007                    ANQ     15,DL
         1 002151   200017 756100                    STQ     UVFCLINES,,AUTO

   4960  1 002152                       ASIFSPB      null
      663     4961    4   ASIFSPB:         ;
      664     4962    5                    IF CODE16.LINENO+UVFCLINES>=F$USRDCB.LINES THEN DO;

   4962  1 002152   200007 470500                    LDP0    FORM$,,AUTO
         1 002153   000005 236100                    LDQ     5,,PR0
         1 002154   777777 376007                    ANQ     -1,DL
         1 002155   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 002156   200005 471500                    LDP1    USRDCB$,,AUTO
         1 002157   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 002160   100044 236100                    LDQ     36,,PR1
         1 002161   000022 772000                    QRL     18
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:126  
         1 002162   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 002163   200044 236100                    LDQ     FPTV$$+1,,AUTO
         1 002164   200045 116100                    CMPQ    FPTV$$+2,,AUTO
         1 002165   002234 604000 1                  TMI     s:4976

      665     4963    5                       IF CODE16.CONTFORM THEN

   4963  1 002166   000007 430100                    FSZN    7,,PR0
         1 002167   002211 605000 1                  TPL     s:4969

      666     4964    6                          IF CODE16.LINENO<F$USRDCB.LINES THEN DO;

   4964  1 002170   000005 720100                    LXL0    5,,PR0
         1 002171   100044 100100                    CMPX0   36,,PR1
         1 002172   002211 603000 1                  TRC     s:4969

      667     4965    6                             UVFCLINES=UVFCLINES-

   4965  1 002173   000005 236100                    LDQ     5,,PR0
         1 002174   777777 376007                    ANQ     -1,DL
         1 002175   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 002176   100044 236100                    LDQ     36,,PR1
         1 002177   000022 772000                    QRL     18
         1 002200   200044 136100                    SBLQ    FPTV$$+1,,AUTO
         1 002201   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 002202   200017 236100                    LDQ     UVFCLINES,,AUTO
         1 002203   200045 136100                    SBLQ    FPTV$$+2,,AUTO
         1 002204   200017 756100                    STQ     UVFCLINES,,AUTO

      668     4966    6                               (F$USRDCB.LINES-CODE16.LINENO);
      669     4967    6                             NK$VFC.COUNT=UVFCLINES;

   4967  1 002205   000033 736000                    QLS     27
         1 002206   200022 676100                    ERQ     VFCCHAR,,AUTO
         1 002207   017000 376003                    ANQ     7680,DU
         1 002210   200022 656100                    ERSQ    VFCCHAR,,AUTO

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:127  
      670     4968    6                             END;

      671     4969    5                       CALL SETHEADER ALTRET(RETUR);

   4969  1 002211   003674 701000 1                  TSX1    SETHEADER
         1 002212   002772 702000 1                  TSX2    RETUR

      672     4970    5                       CALL DOHEADER ALTRET(ALTRETUR);

   4970  1 002213   004021 701000 1                  TSX1    DOHEADER
         1 002214   002774 702000 1                  TSX2    ALTRETUR

      673     4971    6                       IF CODE16.LINENO+UVFCLINES>=F$USRDCB.LINES THEN DO;

   4971  1 002215   200007 470500                    LDP0    FORM$,,AUTO
         1 002216   000005 236100                    LDQ     5,,PR0
         1 002217   777777 376007                    ANQ     -1,DL
         1 002220   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 002221   200005 471500                    LDP1    USRDCB$,,AUTO
         1 002222   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 002223   100044 236100                    LDQ     36,,PR1
         1 002224   000022 772000                    QRL     18
         1 002225   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 002226   200044 236100                    LDQ     FPTV$$+1,,AUTO
         1 002227   200045 116100                    CMPQ    FPTV$$+2,,AUTO
         1 002230   002234 604000 1                  TMI     s:4976

      674     4972    6                          UVFCLINES=0;

   4972  1 002231   200017 450100                    STZ     UVFCLINES,,AUTO

      675     4973    6                          VFCCHAR='`';

   4973  1 002232   140000 236003                    LDQ     49152,DU
         1 002233   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

      676     4974    6                          END;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:128  

      677     4975    5                       END;

      678     4976    4                    CODE16.LINENO=CODE16.LINENO+UVFCLINES;

   4976  1 002234   000005 236100                    LDQ     5,,PR0
         1 002235   777777 376007                    ANQ     -1,DL
         1 002236   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 002237   000000 620006                    EAX0    0,QL
         1 002240   000005 440100                    SXL0    5,,PR0

      679     4977    4                    CODE16.NOTCOL1=%YES#;

   4977  1 002241   400000 236003                    LDQ     -131072,DU
         1 002242   000007 256100                    ORSQ    7,,PR0
         1 002243   002621 710000 1                  TRA     s:5093

      680     4978    4                  CASE(%VFCF_SKA);

      681     4979    5                    IF CODE16.LINENO>=F$USRDCB.LINES THEN DO;

   4979  1 002244   200007 471500                    LDP1    FORM$,,AUTO
         1 002245   100005 720100                    LXL0    5,,PR1
         1 002246   200005 473500                    LDP3    USRDCB$,,AUTO
         1 002247   300044 100100                    CMPX0   36,,PR3
         1 002250   002255 602000 1                  TNC     s:4983

      682     4980    5                       CALL SETHEADER ALTRET(RETUR);

   4980  1 002251   003674 701000 1                  TSX1    SETHEADER
         1 002252   002772 702000 1                  TSX2    RETUR

      683     4981    5                       CALL DOHEADER ALTRET(ALTRETUR);

   4981  1 002253   004021 701000 1                  TSX1    DOHEADER
         1 002254   002774 702000 1                  TSX2    ALTRETUR

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:129  
      684     4982    5                       END;

      685     4983    4                    CODE16.NOTCOL1=%NO#;

   4983  1 002255   200007 470500                    LDP0    FORM$,,AUTO
         1 002256   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 002257   000007 356100                    ANSQ    7,,PR0

      686     4984    4                    CALL FINDLINE ALTRET(ASIFSPA);

   4984  1 002260   003604 701000 1                  TSX1    FINDLINE
         1 002261   002337 702000 1                  TSX2    ASIFSPA

      687     4985    5                    IF I>=F$USRDCB.LINES THEN DO;

   4985  1 002262   200005 470500                    LDP0    USRDCB$,,AUTO
         1 002263   000044 236100                    LDQ     36,,PR0
         1 002264   000022 772000                    QRL     18
         1 002265   200014 116100                    CMPQ    I,,AUTO
         1 002266   002275 605400 1                  TPNZ    s:4990

      688     4986    5                       VFCCHAR='`' /*VFC_SPB0*/;

   4986  1 002267   140000 236003                    LDQ     49152,DU
         1 002270   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

      689     4987    5                       CODE16.LINENO=CODE16.LINES;

   4987  1 002271   200007 471500                    LDP1    FORM$,,AUTO
         1 002272   100006 720100                    LXL0    6,,PR1
         1 002273   100005 440100                    SXL0    5,,PR1

      690     4988    5                       END;

   4988  1 002274   002621 710000 1                  TRA     s:5093

      691     4989    4                    ELSE
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:130  
      692     4990    4                       CODE16.LINENO=I;

   4990  1 002275   200014 720100                    LXL0    I,,AUTO
         1 002276   200007 471500                    LDP1    FORM$,,AUTO
         1 002277   100005 440100                    SXL0    5,,PR1
         1 002300   002621 710000 1                  TRA     s:5093

      693     4991    4                  CASE(%VFCF_SPA);

      694     4992    4                    UVFCLINES=NK$VFC.COUNT;

   4992  1 002301   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 002302   000033 772000                    QRL     27
         1 002303   000017 376007                    ANQ     15,DL
         1 002304   200017 756100                    STQ     UVFCLINES,,AUTO

   4992  1 002305                       TRS1SPA      null
      695     4993    4   TRS1SPA:         ;
      696     4994    5                    IF CODE16.LINENO>=F$USRDCB.LINES THEN DO;

   4994  1 002305   200007 470500                    LDP0    FORM$,,AUTO
         1 002306   000005 720100                    LXL0    5,,PR0
         1 002307   200005 471500                    LDP1    USRDCB$,,AUTO
         1 002310   100044 100100                    CMPX0   36,,PR1
         1 002311   002326 602000 1                  TNC     s:5001

      697     4995    5                       CALL SETHEADER ALTRET(RETUR);

   4995  1 002312   003674 701000 1                  TSX1    SETHEADER
         1 002313   002772 702000 1                  TSX2    RETUR

      698     4996    5                       IF HDR$=ADDR(NULLHDR) AND UVFCLINES~=0 THEN

   4996  1 002314   000012 236000 2                  LDQ     10
         1 002315   200010 116100                    CMPQ    TAB$,,AUTO
         1 002316   002324 601000 1                  TNZ     s:4999
         1 002317   200017 235100                    LDA     UVFCLINES,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:131  
         1 002320   002324 600000 1                  TZE     s:4999

      699     4997    5                          NK$VFC.FCN=%VFCF_HDR;

   4997  1 002321   160000 236003                    LDQ     57344,DU
         1 002322   200022 256100                    ORSQ    VFCCHAR,,AUTO
         1 002323   002326 710000 1                  TRA     s:5001

      700     4998    5                       ELSE
      701     4999    5                          CALL DOHEADER ALTRET(ALTRETUR);

   4999  1 002324   004021 701000 1                  TSX1    DOHEADER
         1 002325   002774 702000 1                  TSX2    ALTRETUR

      702     5000    5                       END;

      703     5001    4                    CODE16.NOTCOL1=(UVFCLINES=0);

   5001  1 002326   400000 220003                    LDX0    -131072,DU
         1 002327   200017 235100                    LDA     UVFCLINES,,AUTO
         1 002330   002332 600000 1                  TZE     s:5001+4
         1 002331   000000 220003                    LDX0    0,DU
         1 002332   200007 470500                    LDP0    FORM$,,AUTO
         1 002333   000000 636010                    EAQ     0,X0
         1 002334   000007 676100                    ERQ     7,,PR0
         1 002335   400000 376003                    ANQ     -131072,DU
         1 002336   000007 656100                    ERSQ    7,,PR0

   5001  1 002337                       ASIFSPA      null
      704     5002    4   ASIFSPA:         ;
      705     5003    5                    IF CODE16.LINENO+UVFCLINES>=F$USRDCB.LINES THEN DO;

   5003  1 002337   200007 470500                    LDP0    FORM$,,AUTO
         1 002340   000005 236100                    LDQ     5,,PR0
         1 002341   777777 376007                    ANQ     -1,DL
         1 002342   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 002343   200005 471500                    LDP1    USRDCB$,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:132  
         1 002344   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 002345   100044 236100                    LDQ     36,,PR1
         1 002346   000022 772000                    QRL     18
         1 002347   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 002350   200044 236100                    LDQ     FPTV$$+1,,AUTO
         1 002351   200045 116100                    CMPQ    FPTV$$+2,,AUTO
         1 002352   002406 604000 1                  TMI     s:5017

      706     5004    5                       IF NK$VFC.FCN=%VFCF_HDR THEN

   5004  1 002353   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 002354   160000 376003                    ANQ     57344,DU
         1 002355   160000 116003                    CMPQ    57344,DU
         1 002356   002362 601000 1                  TNZ     s:5007

      707     5005    5                          NK$VFC.COUNT=0;

   5005  1 002357   000013 236000 2                  LDQ     11
         1 002360   200022 356100                    ANSQ    VFCCHAR,,AUTO
         1 002361   002403 710000 1                  TRA     s:5014

      708     5006    6                       ELSE DO;

      709     5007    6                          IF CODE16.CONTFORM AND

   5007  1 002362   000007 430100                    FSZN    7,,PR0
         1 002363   002401 605000 1                  TPL     s:5012
         1 002364   000005 720100                    LXL0    5,,PR0
         1 002365   100044 100100                    CMPX0   36,,PR1
         1 002366   002401 603000 1                  TRC     s:5012

      710     5008    7                            (CODE16.LINENO<F$USRDCB.LINES) THEN DO;

      711     5009    7                             CONTFORMMORE=UVFCLINES-

   5009  1 002367   000005 236100                    LDQ     5,,PR0
         1 002370   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:133  
         1 002371   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 002372   100044 236100                    LDQ     36,,PR1
         1 002373   000022 772000                    QRL     18
         1 002374   200044 136100                    SBLQ    FPTV$$+1,,AUTO
         1 002375   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 002376   200017 236100                    LDQ     UVFCLINES,,AUTO
         1 002377   200045 136100                    SBLQ    FPTV$$+2,,AUTO
         1 002400   200030 756100                    STQ     CONTFORMMORE,,AUTO

      712     5010    7                               (F$USRDCB.LINES-CODE16.LINENO);
      713     5011    7                             END;

      714     5012    6                          VFCCHAR='`' /*VFC_SPB0*/;

   5012  1 002401   140000 236003                    LDQ     49152,DU
         1 002402   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

      715     5013    6                          END;

      716     5014    5                       CODE16.LINENO=CODE16.LINES;

   5014  1 002403   000006 720100                    LXL0    6,,PR0
         1 002404   000005 440100                    SXL0    5,,PR0

      717     5015    5                       END;

   5015  1 002405   002621 710000 1                  TRA     s:5093

      718     5016    4                    ELSE
      719     5017    4                       CODE16.LINENO=CODE16.LINENO+UVFCLINES;

   5017  1 002406   000005 236100                    LDQ     5,,PR0
         1 002407   777777 376007                    ANQ     -1,DL
         1 002410   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 002411   000000 620006                    EAX0    0,QL
         1 002412   000005 440100                    SXL0    5,,PR0
         1 002413   002621 710000 1                  TRA     s:5093
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:134  

      720     5018    4                  CASE(%VFCF_SPC);

      721     5019    5                    DO CASE(NK$VFC.COUNT);

   5019  1 002414   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 002415   000033 772000                    QRL     27
         1 002416   000017 376007                    ANQ     15,DL
         1 002417   000020 116007                    CMPQ    16,DL
         1 002420   002422 602006 1                  TNC     s:5019+6,QL
         1 002421   002463 710000 1                  TRA     s:5039
         1 002422   002463 710000 1                  TRA     s:5039
         1 002423   002443 710000 1                  TRA     s:5023
         1 002424   002443 710000 1                  TRA     s:5023
         1 002425   002442 710000 1                  TRA     s:5021
         1 002426   002450 710000 1                  TRA     s:5025
         1 002427   002450 710000 1                  TRA     s:5025
         1 002430   002451 710000 1                  TRA     s:5027
         1 002431   002451 710000 1                  TRA     s:5027
         1 002432   002452 710000 1                  TRA     s:5029
         1 002433   002453 710000 1                  TRA     s:5031
         1 002434   002454 710000 1                  TRA     s:5033
         1 002435   002462 710000 1                  TRA     s:5037
         1 002436   002463 710000 1                  TRA     s:5039
         1 002437   002454 710000 1                  TRA     s:5033
         1 002440   002470 710000 1                  TRA     s:5042
         1 002441   002513 710000 1                  TRA     s:5053

      722     5020    5                     CASE(%VFCS_ITAB);

      723     5021    5                       GOTO RETUR;

   5021  1 002442   002772 710000 1                  TRA     RETUR

      724     5022    5                     CASE(%VFCS_OTAB,%VFCS_SEQN);

      725     5023    5                       USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:135  

   5023  1 002443   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 002444   020000 276003                    ORQ     8192,DU
         1 002445   200000 276003                    ORQ     65536,DU
         1 002446   200012 756100                    STQ     USRDVBYTE,,AUTO
         1 002447   002621 710000 1                  TRA     s:5093

      726     5024    5                     CASE(%VFCS_SPRM,%VFCS_SPRO);

      727     5025    5                       GOTO RETUR;

   5025  1 002450   002772 710000 1                  TRA     RETUR

      728     5026    5                     CASE(%VFCS_SLLN,%VFCS_SLLP);

      729     5027    5                       GOTO RETUR;

   5027  1 002451   002772 710000 1                  TRA     RETUR

      730     5028    5                     CASE(%VFCS_SHDR);

      731     5029    5                       GOTO RETUR;

   5029  1 002452   002772 710000 1                  TRA     RETUR

      732     5030    5                     CASE(%VFCS_SLPP);

      733     5031    5                       GOTO RETUR;

   5031  1 002453   002772 710000 1                  TRA     RETUR

      734     5032    5                     CASE(%VFCS_PGND,%VFCS_CLRWND);

      735     5033    5                       VFCCHAR = %VFC_PGND;

   5033  1 002454   032000 236003                    LDQ     13312,DU
         1 002455   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:136  

      736     5034    5                       CODE16.LINENO=CODE16.LINES;

   5034  1 002456   200007 471500                    LDP1    FORM$,,AUTO
         1 002457   100006 720100                    LXL0    6,,PR1
         1 002460   100005 440100                    SXL0    5,,PR1

      737     5035    5                       GOTO RETUR;

   5035  1 002461   002772 710000 1                  TRA     RETUR

      738     5036    5                     CASE(%VFCS_VFU);

      739     5037    5                       GOTO RETUR;

   5037  1 002462   002772 710000 1                  TRA     RETUR

      740     5038    5                     CASE(ELSE);

      741     5039    5                       B$JIT.ERR=ERR$INVVFC;

   5039  1 002463   000017 236000 0                  LDQ     ERR$INVVFC
         1 002464   000000 471400 xsym               LDP1    B$JIT$
         1 002465   100012 756100                    STQ     10,,PR1

      742     5040    5                       RETURN;

   5040  1 002466   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 002467   000001 702211                    TSX2  ! 1,X1

      743     5041    5                     CASE(%VFCS_TRS0);

      744     5042    5                       VFCCHAR='`' /*SPB0*/;

   5042  1 002470   140000 236003                    LDQ     49152,DU
         1 002471   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:137  
      745     5043    5                       UVFCLINES=0;

   5043  1 002472   200017 450100                    STZ     UVFCLINES,,AUTO

      746     5044    5                       IF CODE16.NOTCOL1 THEN

   5044  1 002473   200007 471500                    LDP1    FORM$,,AUTO
         1 002474   100007 234100                    SZN     7,,PR1
         1 002475   002512 605000 1                  TPL     s:5051

      747     5045    6                          IF CODE16.LINENO+1<F$USRDCB.LINES THEN DO;

   5045  1 002476   100005 720100                    LXL0    5,,PR1
         1 002477   000001 621010                    EAX1    1,X0
         1 002500   200005 473500                    LDP3    USRDCB$,,AUTO
         1 002501   300044 101100                    CMPX1   36,,PR3
         1 002502   002510 603000 1                  TRC     s:5050

      748     5046    6                             VFCCHAR='a' /*SPB1*/;

   5046  1 002503   141000 236003                    LDQ     49664,DU
         1 002504   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

      749     5047    6                             UVFCLINES=1;

   5047  1 002505   000001 235007                    LDA     1,DL
         1 002506   200017 755100                    STA     UVFCLINES,,AUTO

      750     5048    6                             END;

   5048  1 002507   002512 710000 1                  TRA     s:5051

      751     5049    5                          ELSE
      752     5050    5                             CODE16.LINENO=CODE16.LINES;

   5050  1 002510   100006 722100                    LXL2    6,,PR1
         1 002511   100005 442100                    SXL2    5,,PR1
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:138  

      753     5051    5                       GOTO ASIFSPB;

   5051  1 002512   002152 710000 1                  TRA     ASIFSPB

      754     5052    5                     CASE(%VFCS_TRS1);

      755     5053    6                       IF CODE16.NOTCOL1 THEN DO;

   5053  1 002513   200007 471500                    LDP1    FORM$,,AUTO
         1 002514   100007 234100                    SZN     7,,PR1
         1 002515   002547 605000 1                  TPL     s:5065

      756     5054    7                          IF CODE16.LINENO+1<F$USRDCB.LINES THEN DO;

   5054  1 002516   100005 720100                    LXL0    5,,PR1
         1 002517   000001 621010                    EAX1    1,X0
         1 002520   200005 473500                    LDP3    USRDCB$,,AUTO
         1 002521   300044 101100                    CMPX1   36,,PR3
         1 002522   002543 603000 1                  TRC     s:5063

      757     5055    7                             SAVEUB$=F$MEDDCB.UB$;

   5055  1 002523   000075 236100                    LDQ     61,,PR0
         1 002524   200020 756100                    STQ     SAVEUB$,,AUTO

      758     5056    7                             SAVEUBT=F$MEDDCB.UBYTES;

   5056  1 002525   000076 235100                    LDA     62,,PR0
         1 002526   200021 755100                    STA     SAVEUBT,,AUTO

      759     5057    7                             F$MEDDCB.UBYTES=0;

   5057  1 002527   000076 450100                    STZ     62,,PR0

      760     5058    7                             CALL MEDIUM(MFC_WRITE,%DVBYTE_VFC#,

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:139  
   5058  1 002530   000016 237000 2                  LDAQ    14
         1 002531   200040 757100                    STAQ    @VFC+1,,AUTO
         1 002532   000011 236000 2                  LDQ     9
         1 002533   200037 756100                    STQ     @FPT+1,,AUTO
         1 002534   002776 701000 1                  TSX1    MEDIUM
         1 002535   002774 702000 1                  TSX2    ALTRETUR

      761     5059    7                               'a')ALTRET(ALTRETUR);
      762     5060    7                             F$MEDDCB.UBYTES=SAVEUBT;

   5060  1 002536   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 002537   200021 235100                    LDA     SAVEUBT,,AUTO
         1 002540   000076 755100                    STA     62,,PR0

      763     5061    7                             F$MEDDCB.UB$=SAVEUB$;

   5061  1 002541   200020 236100                    LDQ     SAVEUB$,,AUTO
         1 002542   000075 756100                    STQ     61,,PR0

      764     5062    7                             END;

      765     5063    6                          CODE16.LINENO=CODE16.LINENO+1;

   5063  1 002543   200007 471500                    LDP1    FORM$,,AUTO
         1 002544   100005 720100                    LXL0    5,,PR1
         1 002545   000001 621010                    EAX1    1,X0
         1 002546   100005 441100                    SXL1    5,,PR1

      766     5064    6                          END;

      767     5065    5                       VFCCHAR='A' /*SPA1*/;

   5065  1 002547   101000 236003                    LDQ     33280,DU
         1 002550   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

      768     5066    5                       UVFCLINES=1;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:140  
   5066  1 002551   000001 235007                    LDA     1,DL
         1 002552   200017 755100                    STA     UVFCLINES,,AUTO

      769     5067    5                       GOTO TRS1SPA;

   5067  1 002553   002305 710000 1                  TRA     TRS1SPA

      770     5068    5                     END;

      771     5069    4                  CASE(ELSE);

      772     5070    4                    B$JIT.ERR=ERR$INVVFC;

   5070  1 002554   000017 236000 0                  LDQ     ERR$INVVFC
         1 002555   000000 471400 xsym               LDP1    B$JIT$
         1 002556   100012 756100                    STQ     10,,PR1

      773     5071    4                    RETURN;

   5071  1 002557   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 002560   000001 702211                    TSX2  ! 1,X1

      774     5072    4                  END/*CASE(NK$VFC.FCN)*/;

      775     5073    3                 END/*F$USRDCB.DDEV.LP*/;
      776     5074    3              ELSE DO;

      777     5075    4                 IF F$MEDDCB.DDEV&%DDEV_CP# THEN DO;

   5075  1 002561   000004 236100                    LDQ     4,,PR0
         1 002562   000022 736000                    QLS     18
         1 002563   777000 376003                    ANQ     -512,DU
         1 002564   200000 376003                    ANQ     65536,DU
         1 002565   002612 600000 1                  TZE     s:5086

      778     5076    5                    IF B$JIT.REMCPO=0 THEN DO;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:141  
   5076  1 002566   000000 471400 xsym               LDP1    B$JIT$
         1 002567   100360 235100                    LDA     240,,PR1
         1 002570   002610 601000 1                  TNZ     s:5084

      779     5077    6                       IF B$JIT.USER>JG_MING# THEN DO;

   5077  1 002571   100000 236100                    LDQ     0,,PR1
         1 002572   000777 376003                    ANQ     511,DU
         1 002573   000020 116003                    CMPQ    16,DU
         1 002574   002612 602000 1                  TNC     s:5086

      780     5078    6                          B$JIT.XLIMFLG=B$JIT.XLIMFLG|%XL_PO#;

   5078  1 002575   100316 236100                    LDQ     206,,PR1
         1 002576   000022 736000                    QLS     18
         1 002577   777000 376003                    ANQ     -512,DU
         1 002600   400000 276003                    ORQ     -131072,DU
         1 002601   000022 772000                    QRL     18
         1 002602   100316 552110                    STBQ    206,'10'O,PR1

      781     5079    6                          B$JIT.RNST=B$JIT.RNST|%RS_LIMX#;

   5079  1 002603   100314 236100                    LDQ     204,,PR1
         1 002604   777000 376003                    ANQ     -512,DU
         1 002605   100000 276003                    ORQ     32768,DU
         1 002606   100314 552140                    STBQ    204,'40'O,PR1

      782     5080    6                          GOTO RETUR;

   5080  1 002607   002772 710000 1                  TRA     RETUR

      783     5081    6                          END;
      784     5082    5                       END;
      785     5083    4                    ELSE
      786     5084    4                       B$JIT.REMCPO=B$JIT.REMCPO-1;

   5084  1 002610   000001 336007                    LCQ     1,DL
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:142  
         1 002611   100360 056100                    ASQ     240,,PR1

      787     5085    4                    END;

      788     5086    3                 F$MEDDCB.FORM$->CODE16.RECNO=

   5086  1 002612   000050 471500                    LDP1    40,,PR0
         1 002613   100004 235100                    LDA     4,,PR1
         1 002614   000001 035007                    ADLA    1,DL
         1 002615   100004 755100                    STA     4,,PR1

      789     5087    3                   F$MEDDCB.FORM$->CODE16.RECNO+1;
      790     5088        /*  PGINGRAN will contain the number of records in a non-paged file
      791     5089            for SPACE and SYMBO keyin purposes.
      792     5090        */
      793     5091    3                 F$MEDDCB.PGINGRAN = F$MEDDCB.PGINGRAN + 1;

   5091  1 002616   000102 236100                    LDQ     66,,PR0
         1 002617   000001 036007                    ADLQ    1,DL
         1 002620   000102 552104                    STBQ    66,'04'O,PR0

      794     5092    3                 END;

      795     5093    2           IF (USRDVBYTE & %DVBYTE_TRANS#)

   5093  1 002621   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 002622   020000 376003                    ANQ     8192,DU
         1 002623   002650 600000 1                  TZE     s:5103

      796     5094    3           THEN DO;

      797     5095    3              F$MEDDCB.ATTR.NOXLATE = '1'B;

   5095  1 002624   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 002625   000100 236007                    LDQ     64,DL
         1 002626   000040 256100                    ORSQ    32,,PR0

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:143  
      798     5096    3              IF NOT F$MEDDCB.MEDIA = FMTSYMB#

   5096  1 002627   000103 236100                    LDQ     67,,PR0
         1 002630   000777 376003                    ANQ     511,DU
         1 002631   000022 116003                    CMPQ    18,DU
         1 002632   002637 600000 1                  TZE     s:5099

      799     5097    3              THEN
      800     5098    3                 USRDVBYTE = USRDVBYTE&~%DVBYTE_TRANS#|%DVBYTE_BP#;

   5098  1 002633   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 002634   757000 376003                    ANQ     -8704,DU
         1 002635   200000 276003                    ORQ     65536,DU
         1 002636   200012 756100                    STQ     USRDVBYTE,,AUTO

      801     5099    3              CALL MEDIUM (MFC_WRITE, USRDVBYTE,

   5099  1 002637   200022 631500                    EPPR1   VFCCHAR,,AUTO
         1 002640   200041 451500                    STP1    @DVB+1,,AUTO
         1 002641   200012 633500                    EPPR3   USRDVBYTE,,AUTO
         1 002642   200040 453500                    STP3    @VFC+1,,AUTO
         1 002643   000011 236000 2                  LDQ     9
         1 002644   200037 756100                    STQ     @FPT+1,,AUTO
         1 002645   002776 701000 1                  TSX1    MEDIUM
         1 002646   002774 702000 1                  TSX2    ALTRETUR

      802     5100    3                VFCCHAR) ALTRET(ALTRETUR);
      803     5101    3              END;

   5101  1 002647   002752 710000 1                  TRA     s:5136

      804     5102    3           ELSE DO;

      805     5103    4              IF NOT USRDVBYTE&%DVBYTE_BP# THEN DO;

   5103  1 002650   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 002651   200000 376003                    ANQ     65536,DU
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:144  
         1 002652   002725 601000 1                  TNZ     BPEND

      806     5104    4                 IF F$MEDDCB.UBYTES=0 THEN GOTO BPEND;

   5104  1 002653   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 002654   000076 235100                    LDA     62,,PR0
         1 002655   002725 600000 1                  TZE     BPEND

      807     5105    4                 IF F$MEDDCB.UBYTES > 7

   5105  1 002656   000010 115007                    CMPA    8,DL
         1 002657   002707 602000 1                  TNC     BPLOOPER

      808     5106    5                 THEN DO;

      809     5107        /*
      810     5108                         THIS STRANGE CODE IS DUE TO A PROBLEM WITH THE
      811     5109                         IMPLEMENTATION OF THE TCTR INSTRUCTION WHICH FAULTS
      812     5110                         WHEN ACCESSING THE FIRST DOUBLEWORD OF A SEGMENT
      813     5111                         WHICH IS NOT DOUBLEWORD ALIGNED. THE TCTR INSTRUCTION
      814     5112                         IS USED FOR ALL OF THE DATA BACK TO THE FIRST SEVEN
      815     5113                         BYTES.  IF A NON-BLANK HAS NOT BEEN FOUND, THE FIRST
      816     5114                         SEVEN BYTES ARE EXAMINED ONE BYTE AT A TIME.
      817     5115        */
      818     5116    5                    I=F$MEDDCB.UBYTES - 7;

   5116  1 002660   000007 135007                    SBLA    7,DL
         1 002661   200014 755100                    STA     I,,AUTO

      819     5117    5                    CALL SEARCHR(F$MEDDCB.UBYTES,J,NK_URTBL_BP,

   5117  1 002662   000075 471500                    LDP1    61,,PR0
         1 002663   200014 236100                    LDQ     I,,AUTO
         1 002664   000000 620006                    EAX0    0,QL
         1 002665   000000 165540                    TCTR
         1 002666   100001 600010                    ADSC9   1,,PR1                   cn=3,n=*X0
         1 002667   000020 000000 0                  ARG     NK_URTBL_BP
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:145  
         1 002670   000076 000100                    ARG     62,,PR0
         1 002671   000076 235100                    LDA     62,,PR0
         1 002672   000033 771000                    ARL     27
         1 002673   200013 755100                    STA     J,,AUTO
         1 002674   000076 551140                    STBA    62,'40'O,PR0
         1 002675   002704 606400 1                  TTN     BPALLBLANK
         1 002676   000076 054100                    AOS     62,,PR0
         1 002677   000076 156100                    SSQ     62,,PR0

      820     5118    5                      PINCRC(F$MEDDCB.UB$,7)->CHARI) ALTRET(BPALLBLANK);
      821     5119    5                    F$MEDDCB.UBYTES = F$MEDDCB.UBYTES + 8;

   5119  1 002700   000076 235100                    LDA     62,,PR0
         1 002701   000010 035007                    ADLA    8,DL
         1 002702   000076 755100                    STA     62,,PR0

      822     5120    5                    GOTO BPEND;

   5120  1 002703   002725 710000 1                  TRA     BPEND

      823     5121    5   BPALLBLANK:      F$MEDDCB.UBYTES = 7;

   5121  1 002704   000007 235007       BPALLBLANK   LDA     7,DL
         1 002705   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 002706   000076 755100                    STA     62,,PR0

      824     5122    5                    END;

      825     5123    4   BPLOOPER:     IF NK_URTBL_BP(ASCBIN(SUBSTR(F$MEDDCB.UB$->CHAR1,

   5123  1 002707   200006 470500       BPLOOPER     LDP0    MEDDCB$,,AUTO
         1 002710   000075 471500                    LDP1    61,,PR0
         1 002711   000076 235100                    LDA     62,,PR0
         1 002712   000100 101505                    MRL     fill='000'O
         1 002713   177777 600001                    ADSC9   -1,A,PR1                 cn=3,n=1
         1 002714   200044 000004                    ADSC9   FPTV$$+1,,AUTO           cn=0,n=4
         1 002715   200044 236100                    LDQ     FPTV$$+1,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:146  
         1 002716   040000 106406                    CMPC    fill='040'O
         1 002717   000020 000001 0                  ADSC9   NK_URTBL_BP,Q            cn=0,n=1
         1 002720   000006 000001 2                  ADSC9   6                        cn=0,n=1
         1 002721   002725 601000 1                  TNZ     BPEND

      826     5124    5                   F$MEDDCB.UBYTES-1,1)))=BINASC(0) THEN DO;

      827     5125    5                    F$MEDDCB.UBYTES=F$MEDDCB.UBYTES-1;

   5125  1 002722   000001 135007                    SBLA    1,DL
         1 002723   000076 755100                    STA     62,,PR0

      828     5126    5                    IF F$MEDDCB.UBYTES~=0 THEN GOTO BPLOOPER;

   5126  1 002724   002707 601000 1                  TNZ     BPLOOPER

      829     5127    5                    END;

      830     5128    4   BPEND:        END;

   5128  1 002725                       BPEND        null
      831     5129    3              IF F$MEDDCB.ATTR.LOWERCASE THEN

   5129  1 002725   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 002726   000040 236100                    LDQ     32,,PR0
         1 002727   000001 316007                    CANQ    1,DL
         1 002730   002742 600000 1                  TZE     s:5133

      832     5130    3                 CALL MEDIUM(MFC_WRUR,USRDVBYTE.GOOD,

   5130  1 002731   200022 631500                    EPPR1   VFCCHAR,,AUTO
         1 002732   200041 451500                    STP1    @DVB+1,,AUTO
         1 002733   200012 633500                    EPPR3   USRDVBYTE,,AUTO
         1 002734   200040 453500                    STP3    @VFC+1,,AUTO
         1 002735   000020 236000 2                  LDQ     16
         1 002736   200037 756100                    STQ     @FPT+1,,AUTO
         1 002737   002776 701000 1                  TSX1    MEDIUM
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:147  
         1 002740   002774 702000 1                  TSX2    ALTRETUR
         1 002741   002752 710000 1                  TRA     s:5136

      833     5131    3                   VFCCHAR) ALTRET(ALTRETUR);
      834     5132    3              ELSE
      835     5133    3                 CALL MEDIUM(MFC_WRURUC,USRDVBYTE.GOOD,

   5133  1 002742   200022 631500                    EPPR1   VFCCHAR,,AUTO
         1 002743   200041 451500                    STP1    @DVB+1,,AUTO
         1 002744   200012 633500                    EPPR3   USRDVBYTE,,AUTO
         1 002745   200040 453500                    STP3    @VFC+1,,AUTO
         1 002746   000022 236000 2                  LDQ     18
         1 002747   200037 756100                    STQ     @FPT+1,,AUTO
         1 002750   002776 701000 1                  TSX1    MEDIUM
         1 002751   002774 702000 1                  TSX2    ALTRETUR

      836     5134    3                   VFCCHAR) ALTRET(ALTRETUR);
      837     5135    3              END;

      838     5136    3           IF CONTFORMMORE~=0 THEN DO;

   5136  1 002752   200030 235100                    LDA     CONTFORMMORE,,AUTO
         1 002753   002772 600000 1                  TZE     RETUR

      839     5137    3              NK$VFC.FCN=%VFCF_SPA;

   5137  1 002754   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 002755   000023 376000 2                  ANQ     19
         1 002756   100000 276003                    ORQ     32768,DU
         1 002757   200022 756100                    STQ     VFCCHAR,,AUTO

      840     5138    3              NK$VFC.COUNT=CONTFORMMORE;

   5138  1 002760   200030 236100                    LDQ     CONTFORMMORE,,AUTO
         1 002761   000033 736000                    QLS     27
         1 002762   200022 676100                    ERQ     VFCCHAR,,AUTO
         1 002763   017000 376003                    ANQ     7680,DU
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:148  
         1 002764   200022 656100                    ERSQ    VFCCHAR,,AUTO

      841     5139    3              F$MEDDCB.UB$=ADDR(B$JIT);

   5139  1 002765   000000 236000 xsym               LDQ     B$JIT$
         1 002766   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 002767   000075 756100                    STQ     61,,PR0

      842     5140    3              F$MEDDCB.UBYTES=0;

   5140  1 002770   000076 450100                    STZ     62,,PR0

      843     5141    3              GOTO MORESPA;

   5141  1 002771   001705 710000 1                  TRA     MORESPA

   5136  1 002772                       RETUR        null
      844     5142    3              END;
      845     5143    2   RETUR:  ;
      846     5144    2           B$JIT.ERR='0'B;

   5144  1 002772   000000 470400 xsym               LDP0    B$JIT$
         1 002773   000012 450100                    STZ     10,,PR0

   5144  1 002774                       ALTRETUR     null
      847     5145    2   ALTRETUR:;
      848     5146    2           RETURN;

   5146  1 002774   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 002775   000001 702211                    TSX2  ! 1,X1

      849     5147    2   END FORMATIT;
      850     5148        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:149  
      851     5149    1   MEDIUM: PROC(MFC,DVB,VFCC)ALTRET;

   5149  1 002776   200036 741300       MEDIUM       STX1  ! @FCN+1,,AUTO

      852     5150    2   DCL MFC SBIN;
      853     5151    2   DCL SYMB_MFC SBIN;
      854     5152    2   DCL DVB BIT(9) ALIGNED;
      855     5153    2   DCL VFCC CHAR(1);
      856     5154    2   DCL FPTV$$ PTR;
      857     5155    2   DCL FPTV$ PTR ALIGNED BASED(FPTV$$);
      858     5156    2   DCL B$PS0$ PTR SYMREF READONLY;
      859     5157    3           DO CASE(F$MEDDCB.MEDIA);

   5157  1 002777   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 003000   000103 236100                    LDQ     67,,PR0
         1 003001   000022 772000                    QRL     18
         1 003002   000777 376007                    ANQ     511,DL
         1 003003   000006 136007                    SBLQ    6,DL
         1 003004   000026 116007                    CMPQ    22,DL
         1 003005   003007 602006 1                  TNC     s:5157+8,QL
         1 003006   003270 710000 1                  TRA     s:5205
         1 003007   003226 710000 1                  TRA     s:5194
         1 003010   003270 710000 1                  TRA     s:5205
         1 003011   003141 710000 1                  TRA     s:5184
         1 003012   003270 710000 1                  TRA     s:5205
         1 003013   003270 710000 1                  TRA     s:5205
         1 003014   003270 710000 1                  TRA     s:5205
         1 003015   003160 710000 1                  TRA     s:5187
         1 003016   003212 710000 1                  TRA     s:5192
         1 003017   003270 710000 1                  TRA     s:5205
         1 003020   003270 710000 1                  TRA     s:5205
         1 003021   003270 710000 1                  TRA     s:5205
         1 003022   003270 710000 1                  TRA     s:5205
         1 003023   003035 710000 1                  TRA     s:5159
         1 003024   003270 710000 1                  TRA     s:5205
         1 003025   003270 710000 1                  TRA     s:5205
         1 003026   003270 710000 1                  TRA     s:5205
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:150  
         1 003027   003270 710000 1                  TRA     s:5205
         1 003030   003270 710000 1                  TRA     s:5205
         1 003031   003270 710000 1                  TRA     s:5205
         1 003032   003242 710000 1                  TRA     s:5197
         1 003033   003270 710000 1                  TRA     s:5205
         1 003034   003246 710000 1                  TRA     s:5200

      860     5158    3            CASE(FMTSYMB#);

      861     5159    3              FPTVI=FPTV;

   5159  1 003035   200004 471500                    LDP1    @FPTV,,AUTO
         1 003036   000100 100500                    MLR     fill='000'O
         1 003037   100000 000020                    ADSC9   0,,PR1                   cn=0,n=16
         1 003040   200024 000020                    ADSC9   FPTVI,,AUTO              cn=0,n=16

      862     5160    3              FPTVI.DVBYTE=DVB;

   5160  1 003041   200040 473500                    LDP3    @DVB,,AUTO
         1 003042   300000 236100                    LDQ     0,,PR3
         1 003043   200027 552140                    STBQ    FPTVI+3,'40'O,AUTO

      863     5161    3              IF ((DVB & %DVBYTE_TRANS#) OR

   5161  1 003044   300000 236100                    LDQ     0,,PR3
         1 003045   777000 376003                    ANQ     -512,DU
         1 003046   020000 376003                    ANQ     8192,DU
         1 003047   003061 601000 1                  TNZ     s:5165
         1 003050   000040 236100                    LDQ     32,,PR0
         1 003051   000400 316007                    CANQ    256,DL
         1 003052   003061 601000 1                  TNZ     s:5165
         1 003053   000100 316007                    CANQ    64,DL
         1 003054   003061 601000 1                  TNZ     s:5165
         1 003055   300000 236100                    LDQ     0,,PR3
         1 003056   777000 376003                    ANQ     -512,DU
         1 003057   040000 376003                    ANQ     16384,DU
         1 003060   003064 600000 1                  TZE     s:5166
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:151  

      864     5162    3                (F$MEDDCB.ATTR.GRLGL) OR
      865     5163    3                (F$MEDDCB.ATTR.NOXLATE) OR
      866     5164    3                (DVB & %DVBYTE_BIN#) ) THEN
      867     5165    3                 SYMB_MFC = MFC_WRITE; /* STRIP 9TH BIT */

   5165  1 003061   000001 235007                    LDA     1,DL
         1 003062   200042 755100                    STA     SYMB_MFC,,AUTO
         1 003063   003126 710000 1                  TRA     CHUNKRET

      868     5166    3              ELSE IF F$MEDDCB.ATTR.NATL THEN

   5166  1 003064   000040 236100                    LDQ     32,,PR0
         1 003065   000020 316007                    CANQ    16,DL
         1 003066   003072 600000 1                  TZE     s:5168

      869     5167    3                    SYMB_MFC = MFC_NATL;

   5167  1 003067   000020 235007                    LDA     16,DL
         1 003070   200042 755100                    STA     SYMB_MFC,,AUTO
         1 003071   003126 710000 1                  TRA     CHUNKRET

      870     5168    3                 ELSE IF F$MEDDCB.ATTR.APL THEN

   5168  1 003072   000004 316007                    CANQ    4,DL
         1 003073   003077 600000 1                  TZE     s:5170

      871     5169    3                       SYMB_MFC = MFC_APL;

   5169  1 003074   000021 235007                    LDA     17,DL
         1 003075   200042 755100                    STA     SYMB_MFC,,AUTO
         1 003076   003126 710000 1                  TRA     CHUNKRET

      872     5170    3                    ELSE IF F$MEDDCB.ATTR.LOWERCASE AND

   5170  1 003077   000001 316007                    CANQ    1,DL
         1 003100   003106 600000 1                  TZE     s:5173
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:152  
         1 003101   000040 316007                    CANQ    32,DL
         1 003102   003106 600000 1                  TZE     s:5173

      873     5171    3                         F$MEDDCB.ATTR.UPPERCASE THEN
      874     5172    3                          SYMB_MFC = MFC_WRUR;

   5172  1 003103   000012 235007                    LDA     10,DL
         1 003104   200042 755100                    STA     SYMB_MFC,,AUTO
         1 003105   003126 710000 1                  TRA     CHUNKRET

      875     5173    3                       ELSE IF F$MEDDCB.ATTR.UPPERCASE AND

   5173  1 003106   000040 316007                    CANQ    32,DL
         1 003107   003115 600000 1                  TZE     s:5176
         1 003110   000001 316007                    CANQ    1,DL
         1 003111   003115 601000 1                  TNZ     s:5176

      876     5174    3                            NOT F$MEDDCB.ATTR.LOWERCASE THEN
      877     5175    3                             SYMB_MFC = MFC_WRURUC;

   5175  1 003112   000015 235007                    LDA     13,DL
         1 003113   200042 755100                    STA     SYMB_MFC,,AUTO
         1 003114   003126 710000 1                  TRA     CHUNKRET

      878     5176    3                          ELSE IF F$MEDDCB.ATTR.LOWERCASE AND

   5176  1 003115   000001 316007                    CANQ    1,DL
         1 003116   003124 600000 1                  TZE     s:5180
         1 003117   000040 316007                    CANQ    32,DL
         1 003120   003124 601000 1                  TNZ     s:5180

      879     5177    3                               NOT F$MEDDCB.ATTR.UPPERCASE THEN
      880     5178    3                                SYMB_MFC = MFC_URLC;

   5178  1 003121   000022 235007                    LDA     18,DL
         1 003122   200042 755100                    STA     SYMB_MFC,,AUTO
         1 003123   003126 710000 1                  TRA     CHUNKRET
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:153  

      881     5179    4                             ELSE DO;

      882     5180    4                                SYMB_MFC = MFC_WRURUC;

   5180  1 003124   000015 235007                    LDA     13,DL
         1 003125   200042 755100                    STA     SYMB_MFC,,AUTO

      883     5181    4                                END;

      884     5182    3   CHUNKRET:  CALL FMH$SYMB(SYMB_MFC,FPTVI,VFCC)ALTRET(ALTORCHUNK);

   5182  1 003126   200041 236100       CHUNKRET     LDQ     @VFCC,,AUTO
         1 003127   200046 756100                    STQ     FPTV$$+3,,AUTO
         1 003130   200024 630500                    EPPR0   FPTVI,,AUTO
         1 003131   200045 450500                    STP0    FPTV$$+2,,AUTO
         1 003132   200042 631500                    EPPR1   SYMB_MFC,,AUTO
         1 003133   200044 451500                    STP1    FPTV$$+1,,AUTO
         1 003134   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 003135   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003136   000000 701000 xent               TSX1    FMH$SYMB
         1 003137   003274 702000 1                  TSX2    ALTORCHUNK
         1 003140   003270 710000 1                  TRA     s:5205

      885     5183    3            CASE(FMTCG#);

      886     5184    3              CALL KCI$RWCG (MFC,DVB,VFCC,FPTV.EVENT,

   5184  1 003141   200005 471500                    LDP1    USRDCB$,,AUTO
         1 003142   100006 473500                    LDP3    6,,PR1
         1 003143   200050 453500                    STP3    FPTV$$+5,,AUTO
         1 003144   200004 236100                    LDQ     @FPTV,,AUTO
         1 003145   000001 036003                    ADLQ    1,DU
         1 003146   200041 235100                    LDA     @VFCC,,AUTO
         1 003147   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 003150   200040 236100                    LDQ     @DVB,,AUTO
         1 003151   200037 235100                    LDA     @MFC,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:154  
         1 003152   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 003153   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 003154   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 003155   000000 701000 xent               TSX1    KCI$RWCG
         1 003156   003272 702000 1                  TSX2    ALTRETUR
         1 003157   003270 710000 1                  TRA     s:5205

      887     5185    3                F$USRDCB.SETSTA$->VSST) ALTRET (ALTRETUR);
      888     5186    3            CASE(FMTUC#);

      889     5187    3              IF ADDR(FPTV)~=B$PS0$ OR ADDR(VFCC)~=ADDR(VFCCHAR)

   5187  1 003160   200004 236100                    LDQ     @FPTV,,AUTO
         1 003161   000000 116000 xsym               CMPQ    B$PS0$
         1 003162   003170 601000 1                  TNZ     s:5188
         1 003163   200044 452500                    STP2    FPTV$$+1,,AUTO
         1 003164   200044 236100                    LDQ     FPTV$$+1,,AUTO
         1 003165   000022 036003                    ADLQ    18,DU
         1 003166   200041 116100                    CMPQ    @VFCC,,AUTO
         1 003167   003173 600000 1                  TZE     s:5189

      890     5188    3              THEN FPTV$$ = ADDR(NIL);

   5188  1 003170   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003171   200043 756100                    STQ     FPTV$$,,AUTO
         1 003172   003175 710000 1                  TRA     s:5190

      891     5189    3              ELSE FPTV$$ = ADDR(B$PS0$);

   5189  1 003173   000024 236000 2                  LDQ     20
         1 003174   200043 756100                    STQ     FPTV$$,,AUTO

      892     5190    3              CALL KIA$UCIO(MFC,DVB,VFCC,FPTV.EVENT,FPTV$)ALTRET(ALTRETUR);

   5190  1 003175   200050 756100                    STQ     FPTV$$+5,,AUTO
         1 003176   200004 236100                    LDQ     @FPTV,,AUTO
         1 003177   000001 036003                    ADLQ    1,DU
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:155  
         1 003200   200041 235100                    LDA     @VFCC,,AUTO
         1 003201   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 003202   200040 236100                    LDQ     @DVB,,AUTO
         1 003203   200037 235100                    LDA     @MFC,,AUTO
         1 003204   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 003205   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 003206   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 003207   000000 701000 xent               TSX1    KIA$UCIO
         1 003210   003272 702000 1                  TSX2    ALTRETUR
         1 003211   003270 710000 1                  TRA     s:5205

      893     5191    3            CASE(FMTOCCG#);

      894     5192    3              CALL OCU$RWUC(MFC,DVB,VFCC,FPTV.EVENT)ALTRET(ALTRETUR);

   5192  1 003212   200004 236100                    LDQ     @FPTV,,AUTO
         1 003213   000001 036003                    ADLQ    1,DU
         1 003214   200041 235100                    LDA     @VFCC,,AUTO
         1 003215   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 003216   200040 236100                    LDQ     @DVB,,AUTO
         1 003217   200037 235100                    LDA     @MFC,,AUTO
         1 003220   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 003221   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 003222   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 003223   000000 701000 xent               TSX1    OCU$RWUC
         1 003224   003272 702000 1                  TSX2    ALTRETUR
         1 003225   003270 710000 1                  TRA     s:5205

      895     5193    3            CASE(FMTDEV#);

      896     5194    3              CALL NKA$DEVIO(MFC,DVB,VFCC,FPTV.EVENT)ALTRET(ALTRETUR);

   5194  1 003226   200004 236100                    LDQ     @FPTV,,AUTO
         1 003227   000001 036003                    ADLQ    1,DU
         1 003230   200041 235100                    LDA     @VFCC,,AUTO
         1 003231   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 003232   200040 236100                    LDQ     @DVB,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:156  
         1 003233   200037 235100                    LDA     @MFC,,AUTO
         1 003234   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 003235   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 003236   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 003237   000000 701000 xent               TSX1    NKA$DEVIO
         1 003240   003272 702000 1                  TSX2    ALTRETUR
         1 003241   003270 710000 1                  TRA     s:5205

      897     5195
      898     5196    3            CASE(FMTNC#);

      899     5197    3              CALL KIS$OSI_WRITE ALTRET(ALTRETUR);

   5197  1 003242   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003243   000000 701000 xent               TSX1    KIS$OSI_WRITE
         1 003244   003272 702000 1                  TSX2    ALTRETUR
         1 003245   003270 710000 1                  TRA     s:5205

      900     5198
      901     5199    3            CASE(FMTREMOTE#);

      902     5200    3              F$MEDDCB.DVBYTE=DVB;

   5200  1 003246   200040 471500                    LDP1    @DVB,,AUTO
         1 003247   100000 236100                    LDQ     0,,PR1
         1 003250   000003 676100                    ERQ     3,,PR0
         1 003251   776000 376003                    ANQ     -1024,DU
         1 003252   000003 656100                    ERSQ    3,,PR0

      903     5201    3              F$MEDDCB.VFCCHAR=VFCC;

   5201  1 003253   200041 473500                    LDP3    @VFCC,,AUTO
         1 003254   040100 100500                    MLR     fill='040'O
         1 003255   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 003256   000056 000001                    ADSC9   46,,PR0                  cn=0,n=1

      904     5202    3              CALL FMF$REMOTE(2);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:157  

   5202  1 003257   000025 630400 2                  EPPR0   21
         1 003260   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003261   000000 701000 xent               TSX1    FMF$REMOTE
         1 003262   000000 011000                    NOP     0

      905     5203    3              IF B$JIT.ERR THEN ALTRETURN;

   5203  1 003263   000000 470400 xsym               LDP0    B$JIT$
         1 003264   000012 235100                    LDA     10,,PR0
         1 003265   003270 600000 1                  TZE     s:5205

   5203  1 003266   200036 221300                    LDX1  ! @FCN+1,,AUTO
         1 003267   000000 702211                    TSX2  ! 0,X1

      906     5204    3            END;

      907     5205    2           RETURN;

   5205  1 003270   200036 221300                    LDX1  ! @FCN+1,,AUTO
         1 003271   000001 702211                    TSX2  ! 1,X1

      908     5206    2   ALTRETUR: ALTRETURN;

   5206  1 003272   200036 221300       ALTRETUR     LDX1  ! @FCN+1,,AUTO
         1 003273   000000 702211                    TSX2  ! 0,X1

      909     5207    2   ALTORCHUNK: IF B$JIT.ERR~='000000000005'O THEN ALTRETURN;

   5207  1 003274   000000 470400 xsym  ALTORCHUNK   LDP0    B$JIT$
         1 003275   000012 236100                    LDQ     10,,PR0
         1 003276   000007 116000 xsym               CMPQ    B_VECTNIL+7
         1 003277   003302 600000 1                  TZE     s:5208

   5207  1 003300   200036 221300                    LDX1  ! @FCN+1,,AUTO
         1 003301   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:158  
      910     5208    2           CALL FSB$SWITCH ALTRET(ALTRETUR);

   5208  1 003302   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003303   000000 701000 xent               TSX1    FSB$SWITCH
         1 003304   003272 702000 1                  TSX2    ALTRETUR

      911     5209    2           GOTO CHUNKRET;

   5209  1 003305   003126 710000 1                  TRA     CHUNKRET

      912     5210    2   END MEDIUM;
      913     5211        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:159  
      914     5212    1   PREPWRITE: PROC ALTRET;

   5212  1 003306   200034 741300       PREPWRITE    STX1  ! CONTFORMMORE+4,,AUTO

      915     5213        /**This routine prepares WRITEs for the output formatter.
      916     5214          *It ALTRETURNs if the operation doesn't need the formatter.
      917     5215           . DVBYTE is BIN-VFC; JIT.ERR set.
      918     5216           . DVBYTE is BIN; the WRITE has been performed.
      919     5217           . DVBYTE is VFC and zero-length buffer; JIT.ERR is set.
      920     5218          *It RETURNs if the output formatter is needed.
      921     5219           .. USRDVBYTE is User DVBYTE, now always VFC.
      922     5220           .. VFCCHAR is the VFC character.
      923     5221        */
      924     5222    2           USRDVBYTE=FPTV.DVBYTE&%DVBYTE_USER#;

   5222  1 003307   200004 470500                    LDP0    @FPTV,,AUTO
         1 003310   000003 236100                    LDQ     3,,PR0
         1 003311   777000 376003                    ANQ     -512,DU
         1 003312   375000 376003                    ANQ     129536,DU
         1 003313   200012 756100                    STQ     USRDVBYTE,,AUTO

      925     5223    2           IF ((NOT F$USRDCB.ATTR.TRANSLGL) AND

   5223  1 003314   200005 471500                    LDP1    USRDCB$,,AUTO
         1 003315   100040 236100                    LDQ     32,,PR1
         1 003316   000200 316007                    CANQ    128,DL
         1 003317   003334 601000 1                  TNZ     s:5239
         1 003320   200006 473500                    LDP3    MEDDCB$,,AUTO
         1 003321   300103 236100                    LDQ     67,,PR3
         1 003322   000777 376003                    ANQ     511,DU
         1 003323   000022 116003                    CMPQ    18,DU
         1 003324   003334 601000 1                  TNZ     s:5239

      926     5224    2             F$MEDDCB.MEDIA = FMTSYMB#)
      927     5225    3           THEN DO;

      928     5226    3              IF (USRDVBYTE & %DVBYTE_TRANS#)
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:160  

   5226  1 003325   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 003326   020000 376003                    ANQ     8192,DU
         1 003327   003334 600000 1                  TZE     s:5239

      929     5227    4              THEN DO; /* Force NOX on trans recs with no translgl */

      930     5228    4                 USRDVBYTE = USRDVBYTE & ~ %DVBYTE_TRANS# | %DVBYTE_BP#;

   5228  1 003330   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 003331   757000 376003                    ANQ     -8704,DU
         1 003332   200000 276003                    ORQ     65536,DU
         1 003333   200012 756100                    STQ     USRDVBYTE,,AUTO

      931     5229        /* F$MEDDCB.ATTR.NOXLATE = '1'B; */ /* #31470 JLJ */
      932     5230    4                 END;

      933     5231    3              END;

      934     5232                /* That was to check the translegal FFLaG in the dcb.
      935     5233                   if that flag was set then the form specified
      936     5234                   translegal.  If that bit is 0 then translegal is not
      937     5235                   set and if the user specified transparancy we must
      938     5236                   not allow that.  That is done in the code above. If
      939     5237                   translegal is allowed then the user dv byte passes
      940     5238                   unscathed, otherwise transparancy is turned off. */
      941     5239    2           IF USRDVBYTE&%DVBYTE_BIN# THEN

   5239  1 003334   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 003335   040000 376003                    ANQ     16384,DU
         1 003336   003547 600000 1                  TZE     s:5287

      942     5240    3              IF USRDVBYTE&%DVBYTE_VFC# THEN DO;

   5240  1 003337   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 003340   100000 376003                    ANQ     32768,DU
         1 003341   003347 600000 1                  TZE     s:5245
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:161  

      943     5241    3                 B$JIT.ERR=ERR$ILLBV;

   5241  1 003342   000016 236000 0                  LDQ     ERR$ILLBV
         1 003343   000000 473400 xsym               LDP3    B$JIT$
         1 003344   300012 756100                    STQ     10,,PR3

      944     5242    3                 ALTRETURN;

   5242  1 003345   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 003346   000000 702211                    TSX2  ! 0,X1

      945     5243    3                 END;
      946     5244    3              ELSE DO;

      947     5245    4                 IF NOT F$USRDCB.ATTR.BIN THEN DO;

   5245  1 003347   100040 236100                    LDQ     32,,PR1
         1 003350   000002 316007                    CANQ    2,DL
         1 003351   003357 601000 1                  TNZ     s:5249

      948     5246    4                    B$JIT.ERR=ERR$CANTBIN;

   5246  1 003352   000015 236000 0                  LDQ     ERR$CANTBIN
         1 003353   000000 473400 xsym               LDP3    B$JIT$
         1 003354   300012 756100                    STQ     10,,PR3

      949     5247    4                    ALTRETURN;

   5247  1 003355   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 003356   000000 702211                    TSX2  ! 0,X1

      950     5248    4                    END;
      951     5249    4                 DO CASE(F$MEDDCB.MEDIA);

   5249  1 003357   200006 473500                    LDP3    MEDDCB$,,AUTO
         1 003360   300103 236100                    LDQ     67,,PR3
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:162  
         1 003361   000022 772000                    QRL     18
         1 003362   000777 376007                    ANQ     511,DL
         1 003363   000006 136007                    SBLQ    6,DL
         1 003364   000015 116007                    CMPQ    13,DL
         1 003365   003367 602006 1                  TNC     s:5249+8,QL
         1 003366   003543 710000 1                  TRA     RETUR
         1 003367   003527 710000 1                  TRA     s:5280
         1 003370   003543 710000 1                  TRA     RETUR
         1 003371   003452 710000 1                  TRA     s:5270
         1 003372   003543 710000 1                  TRA     RETUR
         1 003373   003543 710000 1                  TRA     RETUR
         1 003374   003543 710000 1                  TRA     RETUR
         1 003375   003471 710000 1                  TRA     s:5274
         1 003376   003512 710000 1                  TRA     s:5277
         1 003377   003543 710000 1                  TRA     RETUR
         1 003400   003543 710000 1                  TRA     RETUR
         1 003401   003543 710000 1                  TRA     RETUR
         1 003402   003543 710000 1                  TRA     RETUR
         1 003403   003404 710000 1                  TRA     s:5251

      952     5250    4                  CASE(FMTSYMB#);

      953     5251    5                    IF F$MEDDCB.DDEV.CP THEN DO;

   5251  1 003404   300004 236100                    LDQ     4,,PR3
         1 003405   200000 316007                    CANQ    65536,DL
         1 003406   003433 600000 1                  TZE     s:5262

      954     5252    6                       IF B$JIT.REMCPO=0 THEN DO;

   5252  1 003407   000000 474400 xsym               LDP4    B$JIT$
         1 003410   400360 235100                    LDA     240,,PR4
         1 003411   003431 601000 1                  TNZ     s:5260

      955     5253    7                          IF B$JIT.USER>JG_MING# THEN DO;

   5253  1 003412   400000 236100                    LDQ     0,,PR4
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:163  
         1 003413   000777 376003                    ANQ     511,DU
         1 003414   000020 116003                    CMPQ    16,DU
         1 003415   003433 602000 1                  TNC     s:5262

      956     5254    7                             B$JIT.XLIMFLG=B$JIT.XLIMFLG|%XL_PO#;

   5254  1 003416   400316 236100                    LDQ     206,,PR4
         1 003417   000022 736000                    QLS     18
         1 003420   777000 376003                    ANQ     -512,DU
         1 003421   400000 276003                    ORQ     -131072,DU
         1 003422   000022 772000                    QRL     18
         1 003423   400316 552110                    STBQ    206,'10'O,PR4

      957     5255    7                             B$JIT.RNST=B$JIT.RNST|%RS_LIMX#;

   5255  1 003424   400314 236100                    LDQ     204,,PR4
         1 003425   777000 376003                    ANQ     -512,DU
         1 003426   100000 276003                    ORQ     32768,DU
         1 003427   400314 552140                    STBQ    204,'40'O,PR4

      958     5256    7                             GOTO RETUR;

   5256  1 003430   003543 710000 1                  TRA     RETUR

      959     5257    7                             END;
      960     5258    6                          END;
      961     5259    5                       ELSE
      962     5260    5                          B$JIT.REMCPO=B$JIT.REMCPO-1;

   5260  1 003431   000001 336007                    LCQ     1,DL
         1 003432   400360 056100                    ASQ     240,,PR4

      963     5261    5                       END;

      964     5262    4                    F$MEDDCB.FORM$->CODE16.RECNO=

   5262  1 003433   300050 474500                    LDP4    40,,PR3
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:164  
         1 003434   400004 235100                    LDA     4,,PR4
         1 003435   000001 035007                    ADLA    1,DL
         1 003436   400004 755100                    STA     4,,PR4

      965     5263    4                      F$MEDDCB.FORM$->CODE16.RECNO+1;
      966     5264        /*  PGINGRAN will contain the number of records in a non-paged file
      967     5265            for SPACE and SYMBO keyin purposes.
      968     5266        */
      969     5267    4                    F$MEDDCB.PGINGRAN = F$MEDDCB.PGINGRAN + 1;

   5267  1 003437   300102 236100                    LDQ     66,,PR3
         1 003440   000001 036007                    ADLQ    1,DL
         1 003441   300102 552104                    STBQ    66,'04'O,PR3

      970     5268    4   CHUNKRET:        CALL FMH$SYMB(MFC_WRBIN,FPTV)ALTRET(ALTORCHUNK);

   5268  1 003442   200004 236100       CHUNKRET     LDQ     @FPTV,,AUTO
         1 003443   000026 235000 2                  LDA     22
         1 003444   200044 757100                    STAQ    FPTV$$+1,,AUTO
         1 003445   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 003446   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003447   000000 701000 xent               TSX1    FMH$SYMB
         1 003450   003572 702000 1                  TSX2    ALTORCHUNK
         1 003451   003543 710000 1                  TRA     RETUR

      971     5269    4                  CASE(FMTCG#);

      972     5270    4                    CALL KCI$RWCG (MFC_WRBIN,USRDVBYTE.GOOD,'A',

   5270  1 003452   100006 474500                    LDP4    6,,PR1
         1 003453   200050 454500                    STP4    FPTV$$+5,,AUTO
         1 003454   200004 236100                    LDQ     @FPTV,,AUTO
         1 003455   000001 036003                    ADLQ    1,DU
         1 003456   000030 235000 2                  LDA     24
         1 003457   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 003460   200012 635500                    EPPR5   USRDVBYTE,,AUTO
         1 003461   200045 455500                    STP5    FPTV$$+2,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:165  
         1 003462   000026 236000 2                  LDQ     22
         1 003463   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 003464   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 003465   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 003466   000000 701000 xent               TSX1    KCI$RWCG
         1 003467   003545 702000 1                  TSX2    ALTRETUR
         1 003470   003543 710000 1                  TRA     RETUR

      973     5271    4                      FPTV.EVENT,F$USRDCB.SETSTA$->VSST)
      974     5272    4                      ALTRET(ALTRETUR);
      975     5273    4                  CASE(FMTUC#);

      976     5274    4                    CALL KIA$UCIO(MFC_WRBIN,USRDVBYTE.GOOD,'A',

   5274  1 003471   200004 236100                    LDQ     @FPTV,,AUTO
         1 003472   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 003473   200044 634500                    EPPR4   FPTV$$+1,,AUTO
         1 003474   200051 454500                    STP4    FPTV$$+6,,AUTO
         1 003475   000001 036003                    ADLQ    1,DU
         1 003476   200050 756100                    STQ     FPTV$$+5,,AUTO
         1 003477   000030 236000 2                  LDQ     24
         1 003500   200047 756100                    STQ     FPTV$$+4,,AUTO
         1 003501   200012 635500                    EPPR5   USRDVBYTE,,AUTO
         1 003502   200046 455500                    STP5    FPTV$$+3,,AUTO
         1 003503   000026 236000 2                  LDQ     22
         1 003504   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 003505   200045 630500                    EPPR0   FPTV$$+2,,AUTO
         1 003506   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 003507   000000 701000 xent               TSX1    KIA$UCIO
         1 003510   003545 702000 1                  TSX2    ALTRETUR
         1 003511   003543 710000 1                  TRA     RETUR

      977     5275    4                      FPTV.EVENT,ADDR(FPTV)) ALTRET(ALTRETUR);
      978     5276    4                  CASE(FMTOCCG#);

      979     5277    4                    CALL OCU$RWUC(MFC_WRBIN,USRDVBYTE.GOOD,'A',

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:166  
   5277  1 003512   200004 236100                    LDQ     @FPTV,,AUTO
         1 003513   000001 036003                    ADLQ    1,DU
         1 003514   000030 235000 2                  LDA     24
         1 003515   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 003516   200012 634500                    EPPR4   USRDVBYTE,,AUTO
         1 003517   200045 454500                    STP4    FPTV$$+2,,AUTO
         1 003520   000026 236000 2                  LDQ     22
         1 003521   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 003522   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 003523   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 003524   000000 701000 xent               TSX1    OCU$RWUC
         1 003525   003545 702000 1                  TSX2    ALTRETUR
         1 003526   003543 710000 1                  TRA     RETUR

      980     5278    4                      FPTV.EVENT) ALTRET(ALTRETUR);
      981     5279    4                  CASE(FMTDEV#);

      982     5280    4                    CALL NKA$DEVIO(MFC_WRBIN,USRDVBYTE.GOOD,'A',

   5280  1 003527   200004 236100                    LDQ     @FPTV,,AUTO
         1 003530   000001 036003                    ADLQ    1,DU
         1 003531   000030 235000 2                  LDA     24
         1 003532   200046 757100                    STAQ    FPTV$$+3,,AUTO
         1 003533   200012 634500                    EPPR4   USRDVBYTE,,AUTO
         1 003534   200045 454500                    STP4    FPTV$$+2,,AUTO
         1 003535   000026 236000 2                  LDQ     22
         1 003536   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 003537   200044 630500                    EPPR0   FPTV$$+1,,AUTO
         1 003540   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 003541   000000 701000 xent               TSX1    NKA$DEVIO
         1 003542   003545 702000 1                  TSX2    ALTRETUR

      983     5281    4                      FPTV.EVENT) ALTRET(ALTRETUR);
      984     5282    4                  END;

   5277  1 003543                       RETUR        null
      985     5283    3   RETUR:        ;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:167  
      986     5284    3                 B$JIT.ERR='0'B;

   5284  1 003543   000000 470400 xsym               LDP0    B$JIT$
         1 003544   000012 450100                    STZ     10,,PR0

      987     5285    3   ALTRETUR:     ALTRETURN;

   5285  1 003545   200034 221300       ALTRETUR     LDX1  ! CONTFORMMORE+4,,AUTO
         1 003546   000000 702211                    TSX2  ! 0,X1

      988     5286    3                 END;
      989     5287    3           IF USRDVBYTE&%DVBYTE_VFC# THEN DO;

   5287  1 003547   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 003550   100000 376003                    ANQ     32768,DU
         1 003551   003566 600000 1                  TZE     s:5293

      990     5288    3              VFCCHAR=F$MEDDCB.UB$->CHAR1;

   5288  1 003552   200006 473500                    LDP3    MEDDCB$,,AUTO
         1 003553   300075 474500                    LDP4    61,,PR3
         1 003554   040100 100500                    MLR     fill='040'O
         1 003555   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
         1 003556   200022 000001                    ADSC9   VFCCHAR,,AUTO            cn=0,n=1

      991     5289    3              F$MEDDCB.UB$=PINCRC(F$MEDDCB.UB$,1);

   5289  1 003557   300075 236100                    LDQ     61,,PR3
         1 003560   200000 036007                    ADLQ    65536,DL
         1 003561   300075 756100                    STQ     61,,PR3

      992     5290    3              F$MEDDCB.UBYTES=F$MEDDCB.UBYTES-1;

   5290  1 003562   300076 235100                    LDA     62,,PR3
         1 003563   000001 135007                    SBLA    1,DL
         1 003564   300076 755100                    STA     62,,PR3

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:168  
      993     5291    3              END;

   5291  1 003565   003571 710000 1                  TRA     s:5294

      994     5292    2           ELSE
      995     5293    2              VFCCHAR=F$USRDCB.DVFC;

   5293  1 003566   100044 236100                    LDQ     36,,PR1
         1 003567   000022 736000                    QLS     18
         1 003570   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

      996     5294    2           RETURN;

   5294  1 003571   000001 702211                    TSX2  ! 1,X1

      997     5295    2   ALTORCHUNK: IF B$JIT.ERR~='000000000005'O THEN ALTRETURN;

   5295  1 003572   000000 470400 xsym  ALTORCHUNK   LDP0    B$JIT$
         1 003573   000012 236100                    LDQ     10,,PR0
         1 003574   000007 116000 xsym               CMPQ    B_VECTNIL+7
         1 003575   003600 600000 1                  TZE     s:5296

   5295  1 003576   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 003577   000000 702211                    TSX2  ! 0,X1

      998     5296    2           CALL FSB$SWITCH ALTRET(ALTRETUR);

   5296  1 003600   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003601   000000 701000 xent               TSX1    FSB$SWITCH
         1 003602   003545 702000 1                  TSX2    ALTRETUR

      999     5297    2           GOTO CHUNKRET;

   5297  1 003603   003442 710000 1                  TRA     CHUNKRET

     1000     5298    2   END PREPWRITE;
     1001     5299        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:169  
     1002     5300    1   FINDLINE: PROC ALTRET;

   5300  1 003604   200034 741300       FINDLINE     STX1  ! CONTFORMMORE+4,,AUTO

     1003     5301        /* ALTRET if no such hole in VFU image.*/
     1004     5302        /* RETURN with I=line# of next hole past currposn;
     1005     5303                       I=CODE16.LINES if none past curr.posn.*/
     1006     5304    2           J=NK$VFC.COUNT;

   5304  1 003605   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 003606   000033 772000                    QRL     27
         1 003607   000017 376007                    ANQ     15,DL
         1 003610   200013 756100                    STQ     J,,AUTO

     1007     5305    3           IF J~=0 THEN DO;

   5305  1 003611   003666 600000 1                  TZE     s:5319

     1008     5306    3              I=CODE16.VFCIM.LINE(J);

   5306  1 003612   200007 470500                    LDP0    FORM$,,AUTO
         1 003613   000100 101506                    MRL     fill='000'O
         1 003614   000027 000001                    ADSC9   23,Q,PR0                 cn=0,n=1
         1 003615   200014 000004                    ADSC9   I,,AUTO                  cn=0,n=4

     1009     5307    4              IF I=0 THEN DO CASE(NK$VFC.FCN);

   5307  1 003616   200014 235100                    LDA     I,,AUTO
         1 003617   003646 601000 1                  TNZ     LOOP

   5307  1 003620   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 003621   000037 772000                    QRL     31
         1 003622   000007 376007                    ANQ     7,DL
         1 003623   000006 116007                    CMPQ    6,DL
         1 003624   003626 602006 1                  TNC     s:5307+8,QL
         1 003625   003646 710000 1                  TRA     LOOP
         1 003626   003646 710000 1                  TRA     LOOP
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:170  
         1 003627   003646 710000 1                  TRA     LOOP
         1 003630   003646 710000 1                  TRA     LOOP
         1 003631   003634 710000 1                  TRA     s:5309
         1 003632   003646 710000 1                  TRA     LOOP
         1 003633   003641 710000 1                  TRA     s:5311

     1010     5308    4               CASE(%VFCF_SKB);

     1011     5309    4                 VFCCHAR='a'; UVFCLINES=1; ALTRETURN;

   5309  1 003634   141000 236003                    LDQ     49664,DU
         1 003635   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

   5309  1 003636   000001 235007                    LDA     1,DL
         1 003637   200017 755100                    STA     UVFCLINES,,AUTO

   5309  1 003640   000000 702211                    TSX2  ! 0,X1

     1012     5310    4               CASE(%VFCF_SKA);

     1013     5311    4                 VFCCHAR='A'; UVFCLINES=1; ALTRETURN;

   5311  1 003641   101000 236003                    LDQ     33280,DU
         1 003642   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

   5311  1 003643   000001 235007                    LDA     1,DL
         1 003644   200017 755100                    STA     UVFCLINES,,AUTO

   5311  1 003645   000000 702211                    TSX2  ! 0,X1

     1014     5312    4               END;

   5307  1 003646                       LOOP         null
     1015     5313    3   LOOP:      ;
     1016     5314    3              IF I>CODE16.LINENO THEN RETURN;

   5314  1 003646   200007 470500                    LDP0    FORM$,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:171  
         1 003647   000005 236100                    LDQ     5,,PR0
         1 003650   777777 376007                    ANQ     -1,DL
         1 003651   200014 116100                    CMPQ    I,,AUTO
         1 003652   003655 605000 1                  TPL     s:5315

   5314  1 003653   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 003654   000001 702211                    TSX2  ! 1,X1

     1017     5315    3              J=CODE16.VFCIM.NEXT(J);

   5315  1 003655   200013 235100                    LDA     J,,AUTO
         1 003656   000100 101505                    MRL     fill='000'O
         1 003657   000037 000001                    ADSC9   31,A,PR0                 cn=0,n=1
         1 003660   200013 000004                    ADSC9   J,,AUTO                  cn=0,n=4

     1018     5316    3              I=CODE16.VFCIM.LINE(J);

   5316  1 003661   200013 235100                    LDA     J,,AUTO
         1 003662   000100 101505                    MRL     fill='000'O
         1 003663   000027 000001                    ADSC9   23,A,PR0                 cn=0,n=1
         1 003664   200014 000004                    ADSC9   I,,AUTO                  cn=0,n=4

     1019     5317    3              IF J~=0 THEN GOTO LOOP;

   5317  1 003665   003646 601000 1                  TNZ     LOOP

     1020     5318    3              END;

     1021     5319    2           I=CODE16.LINES;

   5319  1 003666   200007 470500                    LDP0    FORM$,,AUTO
         1 003667   000006 236100                    LDQ     6,,PR0
         1 003670   777777 376007                    ANQ     -1,DL
         1 003671   200014 756100                    STQ     I,,AUTO

     1022     5320    2           RETURN;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:172  
   5320  1 003672   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 003673   000001 702211                    TSX2  ! 1,X1

     1023     5321    2   END FINDLINE;
     1024     5322        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:173  
     1025     5323    1   SETHEADER: PROC  ALTRET;

   5323  1 003674   200034 741300       SETHEADER    STX1  ! CONTFORMMORE+4,,AUTO

     1026     5324    3           IF USRDCB$=DCBADDR(%M$DO#) THEN DO;

   5324  1 003675   000000 470400 2                  LDP0    0
         1 003676   000000 471500                    LDP1    0,,PR0
         1 003677   200005 236100                    LDQ     USRDCB$,,AUTO
         1 003700   100004 116100                    CMPQ    4,,PR1
         1 003701   003733 601000 1                  TNZ     s:5337

     1027     5325    4              IF B$JIT.REMDO=0 THEN DO;

   5325  1 003702   000000 473400 xsym               LDP3    B$JIT$
         1 003703   300362 235100                    LDA     242,,PR3
         1 003704   003730 601000 1                  TNZ     s:5334

     1028     5326    5                 IF B$JIT.USER>JG_MING# THEN DO;

   5326  1 003705   300000 236100                    LDQ     0,,PR3
         1 003706   000777 376003                    ANQ     511,DU
         1 003707   000020 116003                    CMPQ    16,DU
         1 003710   003763 602000 1                  TNC     s:5348

     1029     5327    5                    B$JIT.XLIMFLG=B$JIT.XLIMFLG|%XL_DO#;

   5327  1 003711   300316 236100                    LDQ     206,,PR3
         1 003712   000022 736000                    QLS     18
         1 003713   777000 376003                    ANQ     -512,DU
         1 003714   040000 276003                    ORQ     16384,DU
         1 003715   000022 772000                    QRL     18
         1 003716   300316 552110                    STBQ    206,'10'O,PR3

     1030     5328    5                    B$JIT.RNST=B$JIT.RNST|%RS_LIMX#;

   5328  1 003717   300314 236100                    LDQ     204,,PR3
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:174  
         1 003720   777000 376003                    ANQ     -512,DU
         1 003721   100000 276003                    ORQ     32768,DU
         1 003722   300314 552140                    STBQ    204,'40'O,PR3

     1031     5329    5                    CODE16.LINENO = CODE16.LINES;

   5329  1 003723   200007 474500                    LDP4    FORM$,,AUTO
         1 003724   400006 720100                    LXL0    6,,PR4
         1 003725   400005 440100                    SXL0    5,,PR4

     1032     5330    5                    ALTRETURN;

   5330  1 003726   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 003727   000000 702211                    TSX2  ! 0,X1

     1033     5331    5                    END;
     1034     5332    4                 END;
     1035     5333    3              ELSE
     1036     5334    3                 B$JIT.REMDO=B$JIT.REMDO-1;

   5334  1 003730   000001 336007                    LCQ     1,DL
         1 003731   300362 056100                    ASQ     242,,PR3

     1037     5335    3              END;

   5335  1 003732   003763 710000 1                  TRA     s:5348

     1038     5336    3           ELSE DO;

     1039     5337    4              IF B$JIT.REMLO=0 THEN DO;

   5337  1 003733   000000 473400 xsym               LDP3    B$JIT$
         1 003734   300361 235100                    LDA     241,,PR3
         1 003735   003761 601000 1                  TNZ     s:5346

     1040     5338    5                 IF B$JIT.USER>JG_MING# THEN DO;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:175  
   5338  1 003736   300000 236100                    LDQ     0,,PR3
         1 003737   000777 376003                    ANQ     511,DU
         1 003740   000020 116003                    CMPQ    16,DU
         1 003741   003763 602000 1                  TNC     s:5348

     1041     5339    5                    B$JIT.XLIMFLG=B$JIT.XLIMFLG|%XL_LO#;

   5339  1 003742   300316 236100                    LDQ     206,,PR3
         1 003743   000022 736000                    QLS     18
         1 003744   777000 376003                    ANQ     -512,DU
         1 003745   100000 276003                    ORQ     32768,DU
         1 003746   000022 772000                    QRL     18
         1 003747   300316 552110                    STBQ    206,'10'O,PR3

     1042     5340    5                    B$JIT.RNST=B$JIT.RNST|%RS_LIMX#;

   5340  1 003750   300314 236100                    LDQ     204,,PR3
         1 003751   777000 376003                    ANQ     -512,DU
         1 003752   100000 276003                    ORQ     32768,DU
         1 003753   300314 552140                    STBQ    204,'40'O,PR3

     1043     5341    5                    CODE16.LINENO = CODE16.LINES;

   5341  1 003754   200007 474500                    LDP4    FORM$,,AUTO
         1 003755   400006 720100                    LXL0    6,,PR4
         1 003756   400005 440100                    SXL0    5,,PR4

     1044     5342    5                    ALTRETURN;

   5342  1 003757   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 003760   000000 702211                    TSX2  ! 0,X1

     1045     5343    5                    END;
     1046     5344    4                 END;
     1047     5345    3              ELSE
     1048     5346    3                 B$JIT.REMLO=B$JIT.REMLO-1;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:176  
   5346  1 003761   000001 336007                    LCQ     1,DL
         1 003762   300361 056100                    ASQ     241,,PR3

     1049     5347    3              END;

     1050     5348    2           HDR$=F$USRDCB.HEADER$;

   5348  1 003763   200005 474500                    LDP4    USRDCB$,,AUTO
         1 003764   400046 236100                    LDQ     38,,PR4
         1 003765   200010 756100                    STQ     TAB$,,AUTO

     1051     5349    3           IF HDR$=ADDR(NIL) THEN DO;

   5349  1 003766   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003767   003777 601000 1                  TNZ     s:5354

     1052     5350    3              HDR$=F$MEDDCB.HEADER$;

   5350  1 003770   200006 475500                    LDP5    MEDDCB$,,AUTO
         1 003771   500046 236100                    LDQ     38,,PR5
         1 003772   200010 756100                    STQ     TAB$,,AUTO

     1053     5351    3              IF HDR$=ADDR(NIL) THEN

   5351  1 003773   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003774   003777 601000 1                  TNZ     s:5354

     1054     5352    3                 HDR$=ADDR(NULLHDR);

   5352  1 003775   000012 236000 2                  LDQ     10
         1 003776   200010 756100                    STQ     TAB$,,AUTO

     1055     5353    3              END;

     1056     5354    2           CODE16.PAGENO=CODE16.PAGENO+1;

   5354  1 003777   200007 475500                    LDP5    FORM$,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:177  
         1 004000   500005 220100                    LDX0    5,,PR5
         1 004001   000001 622010                    EAX2    1,X0
         1 004002   500005 742100                    STX2    5,,PR5

     1057     5355    2           F$MEDDCB.PGINGRAN = F$MEDDCB.PGINGRAN + 1;

   5355  1 004003   200006 476500                    LDP6    MEDDCB$,,AUTO
         1 004004   600102 236100                    LDQ     66,,PR6
         1 004005   000001 036007                    ADLQ    1,DL
         1 004006   600102 552104                    STBQ    66,'04'O,PR6

     1058     5356    2           CODE16.LINENO=BITBIN(BINBIT(VLP$HDR.CTL.HEADERHEIGHT#,4));

   5356  1 004007   200010 477500                    LDP7    TAB$,,AUTO
         1 004010   700000 236100                    LDQ     0,,PR7
         1 004011   000022 772000                    QRL     18
         1 004012   000017 376007                    ANQ     15,DL
         1 004013   000040 736000                    QLS     32
         1 004014   000040 772000                    QRL     32
         1 004015   000000 620006                    EAX0    0,QL
         1 004016   500005 440100                    SXL0    5,,PR5

     1059     5357    2           RETURN;

   5357  1 004017   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 004020   000001 702211                    TSX2  ! 1,X1

     1060     5358    2   END SETHEADER;
     1061     5359        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:178  
     1062     5360    1   DOHEADER: PROC ALTRET; /*WARNING: DON'T USE 'I' IN THIS ROUTINE */

   5360  1 004021   200034 741300       DOHEADER     STX1  ! CONTFORMMORE+4,,AUTO

     1063     5361    2           IF ((F$MEDDCB.DDEV & %DDEV_GR#) = %DDEV_GR#)

   5361  1 004022   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 004023   000004 236100                    LDQ     4,,PR0
         1 004024   000022 736000                    QLS     18
         1 004025   777000 376003                    ANQ     -512,DU
         1 004026   010000 376003                    ANQ     4096,DU
         1 004027   010000 116003                    CMPQ    4096,DU
         1 004030   004032 601000 1                  TNZ     s:5365

     1064     5362    3           THEN DO;

     1065     5363    3              RETURN; /* Don't do headers for graphics. */

   5363  1 004031   000001 702211                    TSX2  ! 1,X1

     1066     5364    3              END;
     1067     5365    3           IF VLP$HDR.CTL.COUNT#~=0 THEN DO;

   5365  1 004032   200010 471500                    LDP1    TAB$,,AUTO
         1 004033   100000 236100                    LDQ     0,,PR1
         1 004034   000777 316007                    CANQ    511,DL
         1 004035   004133 600000 1                  TZE     s:5379

     1068     5366    3              J=CODE16.PAGENO-CODE16.PAGEBASE;

   5366  1 004036   200007 473500                    LDP3    FORM$,,AUTO
         1 004037   300006 236100                    LDQ     6,,PR3
         1 004040   000022 772000                    QRL     18
         1 004041   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 004042   300005 236100                    LDQ     5,,PR3
         1 004043   000022 772000                    QRL     18
         1 004044   200044 136100                    SBLQ    FPTV$$+1,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:179  
         1 004045   200013 756100                    STQ     J,,AUTO

     1069     5367    3              K=J; L=0;

   5367  1 004046   200015 756100                    STQ     K,,AUTO

   5367  1 004047   200016 450100                    STZ     L,,AUTO

     1070     5368    4              DO WHILE (J>0); L=L+1; J=J/10; END;

   5368  1 004050   004057 604400 1                  TMOZ    s:5369

   5368  1 004051   200016 054100                    AOS     L,,AUTO

   5368  1 004052   200013 236100                    LDQ     J,,AUTO
         1 004053   000012 506007                    DIV     10,DL
         1 004054   200013 756100                    STQ     J,,AUTO

   5368  1 004055   000000 116003                    CMPQ    0,DU
         1 004056   004051 605400 1                  TPNZ    s:5368+1

     1071     5369    3              J=VLP$HDR.CTL.COUNT#-1;

   5369  1 004057   200010 470500                    LDP0    TAB$,,AUTO
         1 004060   000000 236100                    LDQ     0,,PR0
         1 004061   000777 376007                    ANQ     511,DL
         1 004062   000001 136007                    SBLQ    1,DL
         1 004063   200013 756100                    STQ     J,,AUTO

     1072     5370    3              IF J>160 THEN J=160;

   5370  1 004064   000240 116007                    CMPQ    160,DL
         1 004065   004070 604400 1                  TMOZ    s:5371

   5370  1 004066   000240 235007                    LDA     160,DL
         1 004067   200013 755100                    STA     J,,AUTO

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:180  
     1073     5371    4              DO WHILE ((L+J)>160); K=K/10; L=L-1; END;

   5371  1 004070   004076 710000 1                  TRA     s:5371+6

   5371  1 004071   200015 236100                    LDQ     K,,AUTO
         1 004072   000012 506007                    DIV     10,DL
         1 004073   200015 756100                    STQ     K,,AUTO

   5371  1 004074   000001 336007                    LCQ     1,DL
         1 004075   200016 056100                    ASQ     L,,AUTO

   5371  1 004076   200016 236100                    LDQ     L,,AUTO
         1 004077   200013 036100                    ADLQ    J,,AUTO
         1 004100   000240 116007                    CMPQ    160,DL
         1 004101   004071 605400 1                  TPNZ    s:5371+1

     1074     5372    4              IF (L+J)>VLP$HDR.TITL.L# THEN DO;

   5372  1 004102   200016 236100                    LDQ     L,,AUTO
         1 004103   200013 036100                    ADLQ    J,,AUTO
         1 004104   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 004105   200010 470500                    LDP0    TAB$,,AUTO
         1 004106   000001 236100                    LDQ     1,,PR0
         1 004107   000033 772000                    QRL     27
         1 004110   200044 116100                    CMPQ    FPTV$$+1,,AUTO
         1 004111   004122 605000 1                  TPL     s:5376

     1075     5373    4                 VLP$HDRF.TITL.TITLE#= VLP$HDR.TITL.TITLE#;

   5373  1 004112   000000 620006                    EAX0    0,QL
         1 004113   040100 100540                    MLR     fill='040'O
         1 004114   000001 200010                    ADSC9   1,,PR0                   cn=1,n=*X0
         1 004115   000001 200240                    ADSC9   1,,PR0                   cn=1,n=160

     1076     5374    4                 VLP$HDR.TITL.L#=L+J;

   5374  1 004116   200016 236100                    LDQ     L,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:181  
         1 004117   200013 036100                    ADLQ    J,,AUTO
         1 004120   000033 736000                    QLS     27
         1 004121   000001 552140                    STBQ    1,'40'O,PR0

     1077     5375    4                 END;

     1078     5376    3              IF L~=0 THEN

   5376  1 004122   200016 235100                    LDA     L,,AUTO
         1 004123   004133 600000 1                  TZE     s:5379

     1079     5377    3                 CALL BINCHAR(SUBSTR(VLP$HDR.TITL.TITLE#,J,L),K);

   5377  1 004124   000001 236100                    LDQ     1,,PR0
         1 004125   000033 772000                    QRL     27
         1 004126   000000 620005                    EAX0    0,AL
         1 004127   200013 235100                    LDA     J,,AUTO
         1 004130   000145 301500                    BTD
         1 004131   200015 000004                    NDSC9   K,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
         1 004132   000001 230010                    NDSC9   1,A,PR0                  cn=1,s=nosgn,sf=0,n=*X0

     1080     5378    3              END;

     1081     5379    2           SAVEUB$=F$MEDDCB.UB$;

   5379  1 004133   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 004134   000075 236100                    LDQ     61,,PR0
         1 004135   200020 756100                    STQ     SAVEUB$,,AUTO

     1082     5380    2           SAVEUBT=F$MEDDCB.UBYTES;

   5380  1 004136   000076 235100                    LDA     62,,PR0
         1 004137   200021 755100                    STA     SAVEUBT,,AUTO

     1083     5381    2           F$MEDDCB.UB$=ADDR(VLP$HDR.TITL.TITLE#);

   5381  1 004140   200010 236100                    LDQ     TAB$,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:182  
         1 004141   000031 036000 2                  ADLQ    25
         1 004142   000075 756100                    STQ     61,,PR0

     1084     5382    2           F$MEDDCB.UBYTES=VLP$HDR.TITL.L#;

   5382  1 004143   200010 471500                    LDP1    TAB$,,AUTO
         1 004144   100001 236100                    LDQ     1,,PR1
         1 004145   000033 772000                    QRL     27
         1 004146   000076 756100                    STQ     62,,PR0

     1085     5383    2           IF F$MEDDCB.ATTR.LOWERCASE THEN

   5383  1 004147   000040 236100                    LDQ     32,,PR0
         1 004150   000001 316007                    CANQ    1,DL
         1 004151   004172 600000 1                  TZE     s:5388

     1086     5384    2              CALL MEDIUM (MFC_WRUR, %DVBYTE_VFC#,

   5384  1 004152   100000 236100                    LDQ     0,,PR1
         1 004153   000022 772000                    QRL     18
         1 004154   000017 376007                    ANQ     15,DL
         1 004155   000160 036007                    ADLQ    112,DL
         1 004156   000033 736000                    QLS     27
         1 004157   000006 276000 2                  ORQ     6
         1 004160   200052 552140                    STBQ    FPTV$$+7,'40'O,AUTO
         1 004161   200052 633500                    EPPR3   FPTV$$+7,,AUTO
         1 004162   200041 453500                    STP3    @VFCC,,AUTO
         1 004163   000016 236000 2                  LDQ     14
         1 004164   200040 756100                    STQ     @DVB,,AUTO
         1 004165   000020 236000 2                  LDQ     16
         1 004166   200037 756100                    STQ     @MFC,,AUTO
         1 004167   002776 701000 1                  TSX1    MEDIUM
         1 004170   004220 702000 1                  TSX2    ALTRETUR
         1 004171   004211 710000 1                  TRA     s:5391

     1087     5385    2                BINASC(VLP$HDR.CTL.HEADERHEIGHT#+ASCBIN('p')) )
     1088     5386    2                ALTRET(ALTRETUR);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:183  
     1089     5387    2           ELSE
     1090     5388    2              CALL MEDIUM (MFC_WRURUC, %DVBYTE_VFC#,

   5388  1 004172   100000 236100                    LDQ     0,,PR1
         1 004173   000022 772000                    QRL     18
         1 004174   000017 376007                    ANQ     15,DL
         1 004175   000160 036007                    ADLQ    112,DL
         1 004176   000033 736000                    QLS     27
         1 004177   000006 276000 2                  ORQ     6
         1 004200   200054 552140                    STBQ    FPTV$$+9,'40'O,AUTO
         1 004201   200054 633500                    EPPR3   FPTV$$+9,,AUTO
         1 004202   200041 453500                    STP3    @VFCC,,AUTO
         1 004203   000016 236000 2                  LDQ     14
         1 004204   200040 756100                    STQ     @DVB,,AUTO
         1 004205   000022 236000 2                  LDQ     18
         1 004206   200037 756100                    STQ     @MFC,,AUTO
         1 004207   002776 701000 1                  TSX1    MEDIUM
         1 004210   004220 702000 1                  TSX2    ALTRETUR

     1091     5389    2                BINASC(VLP$HDR.CTL.HEADERHEIGHT#+ASCBIN('p')) )
     1092     5390    2                ALTRET(ALTRETUR);
     1093     5391    2           F$MEDDCB.UB$=SAVEUB$;

   5391  1 004211   200020 236100                    LDQ     SAVEUB$,,AUTO
         1 004212   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 004213   000075 756100                    STQ     61,,PR0

     1094     5392    2           F$MEDDCB.UBYTES=SAVEUBT;

   5392  1 004214   200021 235100                    LDA     SAVEUBT,,AUTO
         1 004215   000076 755100                    STA     62,,PR0

     1095     5393    2           RETURN;

   5393  1 004216   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 004217   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:184  
   5392  1 004220                       ALTRETUR     null
     1096     5394    2   ALTRETUR:;
     1097     5395    2           ALTRETURN;

   5395  1 004220   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 004221   000000 702211                    TSX2  ! 0,X1

     1098     5396    2   END DOHEADER;
     1099     5397        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:185  
     1100     5398    1   DDFTAB: PROC ALTRET;

   5398  1 004222   200034 741300       DDFTAB       STX1  ! CONTFORMMORE+4,,AUTO

     1101     5399    2           IF ((F$MEDDCB.DDEV & %DDEV_GR#) = %DDEV_GR#)

   5399  1 004223   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 004224   000004 236100                    LDQ     4,,PR0
         1 004225   000022 736000                    QLS     18
         1 004226   777000 376003                    ANQ     -512,DU
         1 004227   010000 376003                    ANQ     4096,DU
         1 004230   010000 116003                    CMPQ    4096,DU
         1 004231   004233 601000 1                  TNZ     s:5403

     1102     5400    3           THEN DO;

     1103     5401    3              RETURN; /* Don't do headers for graphics. */

   5401  1 004232   000001 702211                    TSX2  ! 1,X1

     1104     5402    3              END;
     1105     5403    2           TAB$=F$USRDCB.TAB$;

   5403  1 004233   200005 471500                    LDP1    USRDCB$,,AUTO
         1 004234   100047 236100                    LDQ     39,,PR1
         1 004235   200010 756100                    STQ     TAB$,,AUTO

     1106     5404    3           IF TAB$=ADDR(NIL) THEN DO;

   5404  1 004236   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004237   004246 601000 1                  TNZ     s:5409

     1107     5405    3              TAB$=F$MEDDCB.TAB$;

   5405  1 004240   000047 236100                    LDQ     39,,PR0
         1 004241   200010 756100                    STQ     TAB$,,AUTO

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:186  
     1108     5406    3              IF TAB$=ADDR(NIL) THEN

   5406  1 004242   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004243   004246 601000 1                  TNZ     s:5409

     1109     5407    3                 TAB$=ADDR(TABZERO);

   5407  1 004244   000032 236000 2                  LDQ     26
         1 004245   200010 756100                    STQ     TAB$,,AUTO

     1110     5408    3              END;

     1111     5409    2           IF F$MEDDCB.TAB$=ADDR(NIL) THEN

   5409  1 004246   000047 236100                    LDQ     39,,PR0
         1 004247   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004250   004266 601000 1                  TNZ     s:5411

     1112     5410    2              F$MEDDCB.IWL.TABIWL=(TAB$->VLP$TAB=TABZERO);

   5410  1 004251   400000 220003                    LDX0    -131072,DU
         1 004252   200010 473500                    LDP3    TAB$,,AUTO
         1 004253   000000 106500                    CMPC    fill='000'O
         1 004254   300000 000040                    ADSC9   0,,PR3                   cn=0,n=32
         1 004255   000000 000040 0                  ADSC9   TABZERO                  cn=0,n=32
         1 004256   004260 600000 1                  TZE     s:5410+7
         1 004257   000000 220003                    LDX0    0,DU
         1 004260   000000 636010                    EAQ     0,X0
         1 004261   000022 772000                    QRL     18
         1 004262   000103 676100                    ERQ     67,,PR0
         1 004263   400000 376007                    ANQ     -131072,DL
         1 004264   000103 656100                    ERSQ    67,,PR0
         1 004265   004303 710000 1                  TRA     s:5413

     1113     5411    2           ELSE F$MEDDCB.IWL.TABIWL=

   5411  1 004266   000047 473500                    LDP3    39,,PR0
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:187  
         1 004267   400000 220003                    LDX0    -131072,DU
         1 004270   200010 474500                    LDP4    TAB$,,AUTO
         1 004271   000100 106500                    CMPC    fill='000'O
         1 004272   400000 000040                    ADSC9   0,,PR4                   cn=0,n=32
         1 004273   300000 000040                    ADSC9   0,,PR3                   cn=0,n=32
         1 004274   004276 600000 1                  TZE     s:5411+8
         1 004275   000000 220003                    LDX0    0,DU
         1 004276   000000 636010                    EAQ     0,X0
         1 004277   000022 772000                    QRL     18
         1 004300   000103 676100                    ERQ     67,,PR0
         1 004301   400000 376007                    ANQ     -131072,DL
         1 004302   000103 656100                    ERSQ    67,,PR0

     1114     5412    2                (TAB$->VLP$TAB=F$MEDDCB.TAB$->VLP$TAB);
     1115     5413    3           IF (USRDCB$~=MEDDCB$)OR(USRDCB$=DCBADDR(3)) THEN DO;

   5413  1 004303   200005 236100                    LDQ     USRDCB$,,AUTO
         1 004304   200006 116100                    CMPQ    MEDDCB$,,AUTO
         1 004305   004312 601000 1                  TNZ     s:5414
         1 004306   000000 473400 2                  LDP3    0
         1 004307   300000 474500                    LDP4    0,,PR3
         1 004310   400003 116100                    CMPQ    3,,PR4
         1 004311   004370 601000 1                  TNZ     s:5429

     1116     5414    3              J=B$ROSEG$->B$ROSEG.NUMDCBS;

   5414  1 004312   000000 473400 xsym               LDP3    B$ROSEG$
         1 004313   300002 236100                    LDQ     2,,PR3
         1 004314   000022 772000                    QRL     18
         1 004315   200013 756100                    STQ     J,,AUTO

     1117     5415    4              DO WHILE (J>=%M$MAXNEG#);

   5415  1 004316   004365 710000 1                  TRA     s:5427

     1118     5416    4                 SAVEUB$=DCBADDR(J);

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:188  
   5416  1 004317   000000 470400 2                  LDP0    0
         1 004320   000000 471500                    LDP1    0,,PR0
         1 004321   200013 720100                    LXL0    J,,AUTO
         1 004322   100000 236110                    LDQ     0,X0,PR1
         1 004323   200020 756100                    STQ     SAVEUB$,,AUTO

     1119     5417    4                 IF SAVEUB$~=ADDR(NIL) THEN

   5417  1 004324   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004325   004363 600000 1                  TZE     s:5426

     1120     5418    4                    IF (SAVEUB$->F$DCB.CFU$=MEDDCB$)

   5418  1 004326   200020 473500                    LDP3    SAVEUB$,,AUTO
         1 004327   300066 236100                    LDQ     54,,PR3
         1 004330   200006 116100                    CMPQ    MEDDCB$,,AUTO
         1 004331   004363 601000 1                  TNZ     s:5426
         1 004332   300031 236100                    LDQ     25,,PR3
         1 004333   020000 316007                    CANQ    8192,DL
         1 004334   004363 600000 1                  TZE     s:5426

     1121     5419    4                      AND SAVEUB$->F$DCB.FCD THEN
     1122     5420    4                       IF SAVEUB$->F$DCB.TAB$=ADDR(NIL) THEN

   5420  1 004335   300047 236100                    LDQ     39,,PR3
         1 004336   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004337   004346 601000 1                  TNZ     s:5423

     1123     5421    4                          SAVEUB$->F$DCB.IWL.TABIWL=

   5421  1 004340   200006 474500                    LDP4    MEDDCB$,,AUTO
         1 004341   400103 236100                    LDQ     67,,PR4
         1 004342   300103 676100                    ERQ     67,,PR3
         1 004343   400000 376007                    ANQ     -131072,DL
         1 004344   300103 656100                    ERSQ    67,,PR3
         1 004345   004363 710000 1                  TRA     s:5426

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:189  
     1124     5422    4                            F$MEDDCB.IWL.TABIWL;
     1125     5423    4                       ELSE SAVEUB$->F$DCB.IWL.TABIWL=

   5423  1 004346   300047 474500                    LDP4    39,,PR3
         1 004347   400000 221003                    LDX1    -131072,DU
         1 004350   200010 475500                    LDP5    TAB$,,AUTO
         1 004351   000100 106500                    CMPC    fill='000'O
         1 004352   500000 000040                    ADSC9   0,,PR5                   cn=0,n=32
         1 004353   400000 000040                    ADSC9   0,,PR4                   cn=0,n=32
         1 004354   004356 600000 1                  TZE     s:5423+8
         1 004355   000000 221003                    LDX1    0,DU
         1 004356   000000 636011                    EAQ     0,X1
         1 004357   000022 772000                    QRL     18
         1 004360   300103 676100                    ERQ     67,,PR3
         1 004361   400000 376007                    ANQ     -131072,DL
         1 004362   300103 656100                    ERSQ    67,,PR3

     1126     5424    4                            (TAB$->VLP$TAB=SAVEUB$->F$DCB.TAB$->
     1127     5425    4                            VLP$TAB);
     1128     5426    4                 J=J-1;

   5426  1 004363   000001 336007                    LCQ     1,DL
         1 004364   200013 056100                    ASQ     J,,AUTO

     1129     5427    4                 END;

   5427  1 004365   200013 235100                    LDA     J,,AUTO
         1 004366   000033 115000 2                  CMPA    27
         1 004367   004317 605000 1                  TPL     s:5416

     1130     5428    3              END;

     1131     5429    2           SAVEUB$=F$MEDDCB.UB$;

   5429  1 004370   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 004371   000075 236100                    LDQ     61,,PR0
         1 004372   200020 756100                    STQ     SAVEUB$,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:190  

     1132     5430    2           SAVEUBT=F$MEDDCB.UBYTES;

   5430  1 004373   000076 235100                    LDA     62,,PR0
         1 004374   200021 755100                    STA     SAVEUBT,,AUTO

     1133     5431    2           F$MEDDCB.UB$=TAB$;

   5431  1 004375   200010 236100                    LDQ     TAB$,,AUTO
         1 004376   000075 756100                    STQ     61,,PR0

     1134     5432    2           F$MEDDCB.UBYTES=SIZEC(VLP$TAB);

   5432  1 004377   000040 235007                    LDA     32,DL
         1 004400   000076 755100                    STA     62,,PR0

     1135     5433    2           IF F$MEDDCB.ASN ~= %COMGROUP#

   5433  1 004401   000032 236100                    LDQ     26,,PR0
         1 004402   777000 376007                    ANQ     -512,DL
         1 004403   004000 116007                    CMPQ    2048,DL
         1 004404   004413 600000 1                  TZE     s:5436

     1136     5434    2           THEN CALL MEDIUM(MFC_WRITE, %DVBYTE_VFC#|%DVBYTE_TRANS#,

   5434  1 004405   000036 237000 2                  LDAQ    30
         1 004406   200040 757100                    STAQ    @DVB,,AUTO
         1 004407   000011 236000 2                  LDQ     9
         1 004410   200037 756100                    STQ     @MFC,,AUTO
         1 004411   002776 701000 1                  TSX1    MEDIUM
         1 004412   004432 702000 1                  TSX2    ALTRETUR

     1137     5435    2                %VFC_OTB) ALTRET(ALTRETUR);
     1138     5436    2           IF F$MEDDCB.FORM$~=ADDR(NIL) THEN

   5436  1 004413   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 004414   000050 236100                    LDQ     40,,PR0
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:191  
         1 004415   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004416   004424 600000 1                  TZE     s:5438

     1139     5437    2              F$MEDDCB.FORM$->CODE16.OLDTABS= TAB$->VLP$TAB;

   5437  1 004417   000050 471500                    LDP1    40,,PR0
         1 004420   200010 473500                    LDP3    TAB$,,AUTO
         1 004421   000100 100500                    MLR     fill='000'O
         1 004422   300000 000040                    ADSC9   0,,PR3                   cn=0,n=32
         1 004423   100014 000040                    ADSC9   12,,PR1                  cn=0,n=32

     1140     5438    2           F$MEDDCB.UB$=SAVEUB$;

   5438  1 004424   200020 236100                    LDQ     SAVEUB$,,AUTO
         1 004425   000075 756100                    STQ     61,,PR0

     1141     5439    2           F$MEDDCB.UBYTES=SAVEUBT;

   5439  1 004426   200021 235100                    LDA     SAVEUBT,,AUTO
         1 004427   000076 755100                    STA     62,,PR0

     1142     5440    2           RETURN;

   5440  1 004430   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 004431   000001 702211                    TSX2  ! 1,X1

   5439  1 004432                       ALTRETUR     null
     1143     5441    2   ALTRETUR:;
     1144     5442    2           ALTRETURN;

   5442  1 004432   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 004433   000000 702211                    TSX2  ! 0,X1

     1145     5443    2   END DDFTAB;
     1146     5444        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:192  
     1147     5445    1   DDFHEADER: PROC ALTRET;

   5445  1 004434   200034 741300       DDFHEADER    STX1  ! CONTFORMMORE+4,,AUTO

     1148     5446    2           F$USRDCB.IWL.HDRIWL='1'B;

   5446  1 004435   200005 470500                    LDP0    USRDCB$,,AUTO
         1 004436   100000 236007                    LDQ     32768,DL
         1 004437   000103 256100                    ORSQ    67,,PR0

     1149     5447    2           SAVEUB$=F$MEDDCB.UB$;

   5447  1 004440   200006 471500                    LDP1    MEDDCB$,,AUTO
         1 004441   100075 236100                    LDQ     61,,PR1
         1 004442   200020 756100                    STQ     SAVEUB$,,AUTO

     1150     5448    2           SAVEUBT=F$MEDDCB.UBYTES;

   5448  1 004443   100076 235100                    LDA     62,,PR1
         1 004444   200021 755100                    STA     SAVEUBT,,AUTO

     1151     5449    2           F$MEDDCB.UB$=F$USRDCB.HEADER$;

   5449  1 004445   000046 236100                    LDQ     38,,PR0
         1 004446   100075 756100                    STQ     61,,PR1

     1152     5450    2           F$MEDDCB.UBYTES=SIZEC(VLP$HDRF);

   5450  1 004447   000250 235007                    LDA     168,DL
         1 004450   100076 755100                    STA     62,,PR1

     1153     5451    3           IF F$MEDDCB.UB$=ADDR(NIL) THEN DO;

   5451  1 004451   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004452   004457 601000 1                  TNZ     s:5455

     1154     5452    3              F$MEDDCB.UBYTES=0;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:193  

   5452  1 004453   100076 450100                    STZ     62,,PR1

     1155     5453    3              F$MEDDCB.UB$=ADDR(F$MEDDCB.UB$);

   5453  1 004454   200006 236100                    LDQ     MEDDCB$,,AUTO
         1 004455   000075 036003                    ADLQ    61,DU
         1 004456   100075 756100                    STQ     61,,PR1

     1156     5454    3              END;

     1157     5455    2           CALL MEDIUM(MFC_WRITE, %DVBYTE_VFC#|%DVBYTE_TRANS#,

   5455  1 004457   000042 237000 2                  LDAQ    34
         1 004460   200040 757100                    STAQ    @DVB,,AUTO
         1 004461   000011 236000 2                  LDQ     9
         1 004462   200037 756100                    STQ     @MFC,,AUTO
         1 004463   002776 701000 1                  TSX1    MEDIUM
         1 004464   004477 702000 1                  TSX2    ALTRETUR

     1158     5456    2             %VFC_SHDR) ALTRET(ALTRETUR);
     1159     5457    2           F$MEDDCB.UB$ -> VLP$HDR.CTL.RESETPAGE# = '0'B;

   5457  1 004465   200006 470500                    LDP0    MEDDCB$,,AUTO
         1 004466   000075 471500                    LDP1    61,,PR0
         1 004467   000041 236000 2                  LDQ     33
         1 004470   100000 356100                    ANSQ    0,,PR1

     1160     5458    2           F$MEDDCB.UB$=SAVEUB$;

   5458  1 004471   200020 236100                    LDQ     SAVEUB$,,AUTO
         1 004472   000075 756100                    STQ     61,,PR0

     1161     5459    2           F$MEDDCB.UBYTES=SAVEUBT;

   5459  1 004473   200021 235100                    LDA     SAVEUBT,,AUTO
         1 004474   000076 755100                    STA     62,,PR0
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:194  

     1162     5460    2           RETURN;

   5460  1 004475   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 004476   000001 702211                    TSX2  ! 1,X1

   5459  1 004477                       ALTRETUR     null
     1163     5461    2   ALTRETUR:;
     1164     5462    2           ALTRETURN;

   5462  1 004477   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 004500   000000 702211                    TSX2  ! 0,X1

     1165     5463    2   END DDFHEADER;
     1166     5464        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:195  
     1167     5465        /**/
     1168     5466    1   FSE$URFILE: ENTRY(FPTCODE,FPTV)ALTRET;

   5466  1 004501   000000 700200 xent  FSE$URFILE   TSX0  ! X66_AUTO_2
         1 004502   000060 000002                    ZERO    48,2

     1169     5467    1           USRDCB$=B$JIT.DCB$;

   5467  1 004503   000000 470400 xsym               LDP0    B$JIT$
         1 004504   000232 236100                    LDQ     154,,PR0
         1 004505   200005 756100                    STQ     USRDCB$,,AUTO

     1170     5468    2           DO CASE(F$USRDCB.MEDIA);

   5468  1 004506   200005 471500                    LDP1    USRDCB$,,AUTO
         1 004507   100103 220100                    LDX0    67,,PR1
         1 004510   000777 360003                    ANX0    511,DU
         1 004511   000006 100003                    CMPX0   6,DU
         1 004512   004514 602010 1                  TNC     s:5468+6,X0
         1 004513   004527 710000 1                  TRA     s:5472
         1 004514   004527 710000 1                  TRA     s:5472
         1 004515   004522 710000 1                  TRA     s:5469
         1 004516   004527 710000 1                  TRA     s:5472
         1 004517   004527 710000 1                  TRA     s:5472
         1 004520   004527 710000 1                  TRA     s:5472
         1 004521   004524 710000 1                  TRA     s:5470

     1171     5469    2            CASE(FMTCON#); MEDIUMX=%FMH$CPMME#;

   5469  1 004522   200011 450100                    STZ     MEDIUMX,,AUTO
         1 004523   004532 710000 1                  TRA     s:5475

     1172     5470    2            CASE(FMTTAPE#); MEDIUMX=%FTW$WRAT#;

   5470  1 004524   000001 235007                    LDA     1,DL
         1 004525   200011 755100                    STA     MEDIUMX,,AUTO
         1 004526   004532 710000 1                  TRA     s:5475
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:196  

     1173     5471    2            CASE(ELSE);

     1174     5472    2              B$JIT.ERR=ERR$UNIMP;

   5472  1 004527   000013 236000 0                  LDQ     ERR$UNIMP
         1 004530   000012 756100                    STQ     10,,PR0

     1175     5473    2              ALTRETURN;

   5473  1 004531   000000 702200 xent               TSX2  ! X66_AALT

     1176     5474    2            END;

     1177     5475    1           IF FPTCODE ~= FPTWRITE

   5475  1 004532   200003 473500                    LDP3    @FPTCODE,,AUTO
         1 004533   300000 235100                    LDA     0,,PR3
         1 004534   000001 115007                    CMPA    1,DL
         1 004535   004546 600000 1                  TZE     s:5480

     1178     5476    2           THEN DO;

     1179     5477    2              CALL MEDIUMEP(FPTCODE,FPTV)ALTRET(ALTRETUR);

   5477  1 004536   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004537   200004 235100                    LDA     @FPTV,,AUTO
         1 004540   200036 757100                    STAQ    @FCN+1,,AUTO
         1 004541   200003 236100                    LDQ     @FPTCODE,,AUTO
         1 004542   200035 756100                    STQ     CONTFORMMORE+5,,AUTO
         1 004543   006003 701000 1                  TSX1    MEDIUMEP
         1 004544   005545 702000 1                  TSX2    ALTRETUR

     1180     5478    2              RETURN;

   5478  1 004545   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:197  
     1181     5479    2              END;
     1182     5480    1           FPTVI=FPTV;

   5480  1 004546   200004 474500                    LDP4    @FPTV,,AUTO
         1 004547   000100 100500                    MLR     fill='000'O
         1 004550   400000 000020                    ADSC9   0,,PR4                   cn=0,n=16
         1 004551   200024 000020                    ADSC9   FPTVI,,AUTO              cn=0,n=16

     1183     5481    1           FORM$=F$USRDCB.FORM$;

   5481  1 004552   100050 236100                    LDQ     40,,PR1
         1 004553   200007 756100                    STQ     FORM$,,AUTO

     1184     5482    2           IF NOT F$USRDCB.IWL.TABIWL THEN DO;

   5482  1 004554   100103 236100                    LDQ     67,,PR1
         1 004555   400000 316007                    CANQ    -131072,DL
         1 004556   004621 601000 1                  TNZ     s:5496

     1185     5483    2              SAVEUB$=F$USRDCB.UB$;

   5483  1 004557   100075 236100                    LDQ     61,,PR1
         1 004560   200020 756100                    STQ     SAVEUB$,,AUTO

     1186     5484    2              SAVEUBT=F$USRDCB.UBYTES;

   5484  1 004561   100076 235100                    LDA     62,,PR1
         1 004562   200021 755100                    STA     SAVEUBT,,AUTO

     1187     5485    2              F$USRDCB.UB$=F$USRDCB.TAB$;

   5485  1 004563   100047 236100                    LDQ     39,,PR1
         1 004564   100075 756100                    STQ     61,,PR1

     1188     5486    2              IF F$USRDCB.UB$=ADDR(NIL) THEN

   5486  1 004565   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:198  
         1 004566   004571 601000 1                  TNZ     s:5488

     1189     5487    2                 F$USRDCB.UB$=ADDR(TABZERO);

   5487  1 004567   000032 236000 2                  LDQ     26
         1 004570   100075 756100                    STQ     61,,PR1

     1190     5488    2              F$USRDCB.UBYTES=SIZEC(VLP$TAB);

   5488  1 004571   000040 235007                    LDA     32,DL
         1 004572   100076 755100                    STA     62,,PR1

     1191     5489    2              FPTVI.DVBYTE=%DVBYTE_VFC#|%DVBYTE_TRANS#;

   5489  1 004573   120000 236003                    LDQ     40960,DU
         1 004574   200027 552140                    STBQ    FPTVI+3,'40'O,AUTO

     1192     5490    2              CALL MEDIUMEP(MFC_WRITE,FPTVI,%VFC_OTB)ALTRET(ALTRETUR);

   5490  1 004575   000037 236000 2                  LDQ     31
         1 004576   200037 756100                    STQ     @FPT+1,,AUTO
         1 004577   200024 635500                    EPPR5   FPTVI,,AUTO
         1 004600   200036 455500                    STP5    @FCN+1,,AUTO
         1 004601   000011 236000 2                  LDQ     9
         1 004602   200035 756100                    STQ     CONTFORMMORE+5,,AUTO
         1 004603   006003 701000 1                  TSX1    MEDIUMEP
         1 004604   005545 702000 1                  TSX2    ALTRETUR

     1193     5491    2              CODE16.OLDTABS=F$USRDCB.UB$->VLP$TAB;

   5491  1 004605   200005 470500                    LDP0    USRDCB$,,AUTO
         1 004606   000075 471500                    LDP1    61,,PR0
         1 004607   200007 473500                    LDP3    FORM$,,AUTO
         1 004610   000100 100500                    MLR     fill='000'O
         1 004611   100000 000040                    ADSC9   0,,PR1                   cn=0,n=32
         1 004612   300014 000040                    ADSC9   12,,PR3                  cn=0,n=32

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:199  
     1194     5492    2              F$USRDCB.IWL.TABIWL='1'B;

   5492  1 004613   400000 236007                    LDQ     -131072,DL
         1 004614   000103 256100                    ORSQ    67,,PR0

     1195     5493    2              F$USRDCB.UB$=SAVEUB$;

   5493  1 004615   200020 236100                    LDQ     SAVEUB$,,AUTO
         1 004616   000075 756100                    STQ     61,,PR0

     1196     5494    2              F$USRDCB.UBYTES=SAVEUBT;

   5494  1 004617   200021 235100                    LDA     SAVEUBT,,AUTO
         1 004620   000076 755100                    STA     62,,PR0

     1197     5495    2              END;

     1198     5496    1           USRDVBYTE=FPTV.DVBYTE&'370'O;

   5496  1 004621   200004 470500                    LDP0    @FPTV,,AUTO
         1 004622   000003 236100                    LDQ     3,,PR0
         1 004623   777000 376003                    ANQ     -512,DU
         1 004624   370000 376003                    ANQ     126976,DU
         1 004625   200012 756100                    STQ     USRDVBYTE,,AUTO

     1199     5497    1           IF USRDVBYTE&%DVBYTE_BIN# THEN

   5497  1 004626   040000 376003                    ANQ     16384,DU
         1 004627   004663 600000 1                  TZE     s:5512

     1200     5498    2              IF USRDVBYTE&%DVBYTE_VFC# THEN DO;

   5498  1 004630   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 004631   100000 376003                    ANQ     32768,DU
         1 004632   004637 600000 1                  TZE     s:5503

     1201     5499    2                 B$JIT.ERR=ERR$ILLBV;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:200  

   5499  1 004633   000016 236000 0                  LDQ     ERR$ILLBV
         1 004634   000000 471400 xsym               LDP1    B$JIT$
         1 004635   100012 756100                    STQ     10,,PR1

     1202     5500    2                 ALTRETURN;

   5500  1 004636   000000 702200 xent               TSX2  ! X66_AALT

     1203     5501    2                 END;
     1204     5502    1              ELSE
     1205     5503    2                 IF NOT F$USRDCB.ATTR&%ATTR_BIN# THEN DO;

   5503  1 004637   200005 471500                    LDP1    USRDCB$,,AUTO
         1 004640   100040 720100                    LXL0    32,,PR1
         1 004641   000002 360003                    ANX0    2,DU
         1 004642   004647 601000 1                  TNZ     s:5508

     1206     5504    2                    B$JIT.ERR=ERR$CANTBIN;

   5504  1 004643   000015 236000 0                  LDQ     ERR$CANTBIN
         1 004644   000000 473400 xsym               LDP3    B$JIT$
         1 004645   300012 756100                    STQ     10,,PR3

     1207     5505    2                    ALTRETURN;

   5505  1 004646   000000 702200 xent               TSX2  ! X66_AALT

     1208     5506    2                    END;
     1209     5507    2                 ELSE DO;

     1210     5508    2                    CODE16.RECNO=CODE16.RECNO+1;

   5508  1 004647   200007 473500                    LDP3    FORM$,,AUTO
         1 004650   300004 235100                    LDA     4,,PR3
         1 004651   000001 035007                    ADLA    1,DL
         1 004652   300004 755100                    STA     4,,PR3
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:201  

     1211     5509    2                    CALL MEDIUMEP(MFC_WRBIN,FPTV)ALTRET(ALTRETUR);

   5509  1 004653   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 004654   200004 235100                    LDA     @FPTV,,AUTO
         1 004655   200036 757100                    STAQ    @FCN+1,,AUTO
         1 004656   000026 236000 2                  LDQ     22
         1 004657   200035 756100                    STQ     CONTFORMMORE+5,,AUTO
         1 004660   006003 701000 1                  TSX1    MEDIUMEP
         1 004661   005545 702000 1                  TSX2    ALTRETUR

     1212     5510    2                    RETURN;

   5510  1 004662   000000 702200 xent               TSX2  ! X66_ARET

     1213     5511    2                    END;
     1214     5512    1           IF USRDVBYTE&%DVBYTE_VFC# THEN

   5512  1 004663   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 004664   100000 376003                    ANQ     32768,DU
         1 004665   004702 600000 1                  TZE     s:5519

     1215     5513    2           DO;

     1216     5514    2              VFCCHAR=F$USRDCB.UB$->CHAR1;

   5514  1 004666   200005 471500                    LDP1    USRDCB$,,AUTO
         1 004667   100075 473500                    LDP3    61,,PR1
         1 004670   040100 100500                    MLR     fill='040'O
         1 004671   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 004672   200022 000001                    ADSC9   VFCCHAR,,AUTO            cn=0,n=1

     1217     5515    2              F$USRDCB.UB$=PINCRC(F$USRDCB.UB$,1);

   5515  1 004673   100075 236100                    LDQ     61,,PR1
         1 004674   200000 036007                    ADLQ    65536,DL
         1 004675   100075 756100                    STQ     61,,PR1
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:202  

     1218     5516    2              F$USRDCB.UBYTES=F$USRDCB.UBYTES-1;

   5516  1 004676   100076 235100                    LDA     62,,PR1
         1 004677   000001 135007                    SBLA    1,DL
         1 004700   100076 755100                    STA     62,,PR1

     1219     5517    2              END;

   5517  1 004701   004711 710000 1                  TRA     MORESPA

     1220     5518    2           ELSE DO;

     1221     5519    2              VFCCHAR=F$USRDCB.DVFC;

   5519  1 004702   200005 471500                    LDP1    USRDCB$,,AUTO
         1 004703   100044 236100                    LDQ     36,,PR1
         1 004704   000022 736000                    QLS     18
         1 004705   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

     1222     5520    2              USRDVBYTE=USRDVBYTE|%DVBYTE_VFC#;

   5520  1 004706   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 004707   100000 276003                    ORQ     32768,DU
         1 004710   200012 756100                    STQ     USRDVBYTE,,AUTO

     1223     5521    2              END;

     1224     5522    1   MORESPA: CONTFORMMORE=0;

   5522  1 004711   200030 450100       MORESPA      STZ     CONTFORMMORE,,AUTO

     1225     5523    2           IF F$USRDCB.DDEV.LP THEN DO;

   5523  1 004712   200005 470500                    LDP0    USRDCB$,,AUTO
         1 004713   000004 236100                    LDQ     4,,PR0
         1 004714   400000 316007                    CANQ    -131072,DL
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:203  
         1 004715   005411 600000 1                  TZE     s:5649

     1226     5524    3              DO CASE(NK$VFC.FCN);

   5524  1 004716   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 004717   000037 772000                    QRL     31
         1 004720   000007 376007                    ANQ     7,DL
         1 004721   000010 116007                    CMPQ    8,DL
         1 004722   004724 602006 1                  TNC     s:5524+6,QL
         1 004723   005405 710000 1                  TRA     s:5644
         1 004724   005405 710000 1                  TRA     s:5644
         1 004725   005305 710000 1                  TRA     s:5609
         1 004726   005405 710000 1                  TRA     s:5644
         1 004727   004765 710000 1                  TRA     s:5532
         1 004730   005162 710000 1                  TRA     s:5581
         1 004731   005123 710000 1                  TRA     s:5569
         1 004732   005031 710000 1                  TRA     s:5549
         1 004733   004734 710000 1                  TRA     s:5526

     1227     5525    3               CASE(%VFCF_HDR);

     1228     5526    3                 CODE16.PAGENO=CODE16.PAGENO+1;

   5526  1 004734   200007 471500                    LDP1    FORM$,,AUTO
         1 004735   100005 220100                    LDX0    5,,PR1
         1 004736   000001 621010                    EAX1    1,X0
         1 004737   100005 741100                    STX1    5,,PR1

     1229     5527    3                 F$USRDCB.PGINGRAN = F$USRDCB.PGINGRAN + 1;

   5527  1 004740   000102 236100                    LDQ     66,,PR0
         1 004741   000001 036007                    ADLQ    1,DL
         1 004742   000102 552104                    STBQ    66,'04'O,PR0

     1230     5528    3                 CODE16.LINENO=NK$VFC.COUNT;

   5528  1 004743   200022 236100                    LDQ     VFCCHAR,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:204  
         1 004744   000033 772000                    QRL     27
         1 004745   000017 376007                    ANQ     15,DL
         1 004746   000000 620006                    EAX0    0,QL
         1 004747   100005 440100                    SXL0    5,,PR1

     1231     5529    3                 USRDVBYTE=USRDVBYTE|%DVBYTE_TOP#;

   5529  1 004750   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 004751   400000 276003                    ORQ     -131072,DU
         1 004752   200012 756100                    STQ     USRDVBYTE,,AUTO

     1232     5530    3                 CODE16.NOTCOL1=(NK$VFC.COUNT=0);

   5530  1 004753   400000 220003                    LDX0    -131072,DU
         1 004754   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 004755   017000 316003                    CANQ    7680,DU
         1 004756   004760 600000 1                  TZE     s:5530+5
         1 004757   000000 220003                    LDX0    0,DU
         1 004760   000000 636010                    EAQ     0,X0
         1 004761   100007 676100                    ERQ     7,,PR1
         1 004762   400000 376003                    ANQ     -131072,DU
         1 004763   100007 656100                    ERSQ    7,,PR1
         1 004764   005420 710000 1                  TRA     s:5655

     1233     5531    3               CASE(%VFCF_SKB);

     1234     5532    3                 CALL URFILFINDLINE;

   5532  1 004765   005553 701000 1                  TSX1    URFILFINDLINE
         1 004766   000000 011000                    NOP     0

     1235     5533    4                 IF I=0 THEN DO; /* No such line in VFU.*/

   5533  1 004767   200014 235100                    LDA     I,,AUTO
         1 004770   004774 601000 1                  TNZ     s:5537

     1236     5534    4                    UVFCLINES=1; /* Treat as space 1 before.*/
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:205  

   5534  1 004771   000001 236007                    LDQ     1,DL
         1 004772   200017 756100                    STQ     UVFCLINES,,AUTO

     1237     5535    4                    GOTO ASIFSPB;

   5535  1 004773   005035 710000 1                  TRA     ASIFSPB

     1238     5536    4                    END;
     1239     5537    4                 ELSE IF I>=F$USRDCB.LINES THEN DO;

   5537  1 004774   200005 470500                    LDP0    USRDCB$,,AUTO
         1 004775   000044 236100                    LDQ     36,,PR0
         1 004776   000022 772000                    QRL     18
         1 004777   200014 116100                    CMPQ    I,,AUTO
         1 005000   005023 605400 1                  TPNZ    s:5546

     1240     5538    4                       CALL URFILHDR ALTRET(ALTRETUR);

   5538  1 005001   005616 701000 1                  TSX1    URFILHDR
         1 005002   005545 702000 1                  TSX2    ALTRETUR

     1241     5539    4                       CALL URFILFINDLINE;

   5539  1 005003   005553 701000 1                  TSX1    URFILFINDLINE
         1 005004   000000 011000                    NOP     0

     1242     5540    5                       IF I>=F$USRDCB.LINES THEN DO;

   5540  1 005005   200005 470500                    LDP0    USRDCB$,,AUTO
         1 005006   000044 236100                    LDQ     36,,PR0
         1 005007   000022 772000                    QRL     18
         1 005010   200014 116100                    CMPQ    I,,AUTO
         1 005011   005023 605400 1                  TPNZ    s:5546

     1243     5541    5                          IF HDR$~=ADDR(NIL) THEN

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:206  
   5541  1 005012   200010 236100                    LDQ     TAB$,,AUTO
         1 005013   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005014   005017 600000 1                  TZE     s:5543

     1244     5542    5                             VFCCHAR='`';

   5542  1 005015   140000 236003                    LDQ     49152,DU
         1 005016   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

     1245     5543    5                          I=CODE16.LINENO;

   5543  1 005017   200007 471500                    LDP1    FORM$,,AUTO
         1 005020   100005 236100                    LDQ     5,,PR1
         1 005021   777777 376007                    ANQ     -1,DL
         1 005022   200014 756100                    STQ     I,,AUTO

     1246     5544    5                          END;

     1247     5545    4                       END;

     1248     5546    3                 CODE16.LINENO=I;

   5546  1 005023   200014 720100                    LXL0    I,,AUTO
         1 005024   200007 471500                    LDP1    FORM$,,AUTO
         1 005025   100005 440100                    SXL0    5,,PR1

     1249     5547    3                 CODE16.NOTCOL1=%YES#;

   5547  1 005026   400000 236003                    LDQ     -131072,DU
         1 005027   100007 256100                    ORSQ    7,,PR1
         1 005030   005420 710000 1                  TRA     s:5655

     1250     5548    3               CASE(%VFCF_SPB);

     1251     5549    3                 UVFCLINES=NK$VFC.COUNT;

   5549  1 005031   200022 236100                    LDQ     VFCCHAR,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:207  
         1 005032   000033 772000                    QRL     27
         1 005033   000017 376007                    ANQ     15,DL
         1 005034   200017 756100                    STQ     UVFCLINES,,AUTO

     1252     5550    3   ASIFSPB:      I=CODE16.LINENO+UVFCLINES;

   5550  1 005035   200007 470500       ASIFSPB      LDP0    FORM$,,AUTO
         1 005036   000005 236100                    LDQ     5,,PR0
         1 005037   777777 376007                    ANQ     -1,DL
         1 005040   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 005041   200014 756100                    STQ     I,,AUTO

     1253     5551    4                 IF I>=F$USRDCB.LINES THEN DO;

   5551  1 005042   200005 471500                    LDP1    USRDCB$,,AUTO
         1 005043   100044 236100                    LDQ     36,,PR1
         1 005044   000022 772000                    QRL     18
         1 005045   200014 116100                    CMPQ    I,,AUTO
         1 005046   005116 605400 1                  TPNZ    s:5566

     1254     5552    4                    IF CODE16.CONTFORM THEN

   5552  1 005047   000007 430100                    FSZN    7,,PR0
         1 005050   005072 605000 1                  TPL     s:5558

     1255     5553    5                       IF CODE16.LINENO<F$USRDCB.LINES THEN DO;

   5553  1 005051   000005 720100                    LXL0    5,,PR0
         1 005052   100044 100100                    CMPX0   36,,PR1
         1 005053   005072 603000 1                  TRC     s:5558

     1256     5554    5                          UVFCLINES=UVFCLINES-

   5554  1 005054   000005 236100                    LDQ     5,,PR0
         1 005055   777777 376007                    ANQ     -1,DL
         1 005056   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 005057   100044 236100                    LDQ     36,,PR1
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:208  
         1 005060   000022 772000                    QRL     18
         1 005061   200044 136100                    SBLQ    FPTV$$+1,,AUTO
         1 005062   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 005063   200017 236100                    LDQ     UVFCLINES,,AUTO
         1 005064   200045 136100                    SBLQ    FPTV$$+2,,AUTO
         1 005065   200017 756100                    STQ     UVFCLINES,,AUTO

     1257     5555    5                            (F$USRDCB.LINES-CODE16.LINENO);
     1258     5556    5                          I=CODE16.LINENO+UVFCLINES;

   5556  1 005066   000005 236100                    LDQ     5,,PR0
         1 005067   777777 376007                    ANQ     -1,DL
         1 005070   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 005071   200014 756100                    STQ     I,,AUTO

     1259     5557    5                          END;

     1260     5558    4                    CALL URFILHDR ALTRET(ALTRETUR);

   5558  1 005072   005616 701000 1                  TSX1    URFILHDR
         1 005073   005545 702000 1                  TSX2    ALTRETUR

     1261     5559    4                    I=CODE16.LINENO+UVFCLINES;

   5559  1 005074   200007 470500                    LDP0    FORM$,,AUTO
         1 005075   000005 236100                    LDQ     5,,PR0
         1 005076   777777 376007                    ANQ     -1,DL
         1 005077   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 005100   200014 756100                    STQ     I,,AUTO

     1262     5560    5                    IF I>=F$USRDCB.LINES THEN DO;

   5560  1 005101   200005 471500                    LDP1    USRDCB$,,AUTO
         1 005102   100044 236100                    LDQ     36,,PR1
         1 005103   000022 772000                    QRL     18
         1 005104   200014 116100                    CMPQ    I,,AUTO
         1 005105   005116 605400 1                  TPNZ    s:5566
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:209  

     1263     5561    5                       IF HDR$~=ADDR(NIL) THEN

   5561  1 005106   200010 236100                    LDQ     TAB$,,AUTO
         1 005107   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005110   005113 600000 1                  TZE     s:5563

     1264     5562    5                          VFCCHAR='`';

   5562  1 005111   140000 236003                    LDQ     49152,DU
         1 005112   200022 552140                    STBQ    VFCCHAR,'40'O,AUTO

     1265     5563    5                       I=CODE16.LINENO;

   5563  1 005113   000005 236100                    LDQ     5,,PR0
         1 005114   777777 376007                    ANQ     -1,DL
         1 005115   200014 756100                    STQ     I,,AUTO

     1266     5564    5                       END;

     1267     5565    4                    END;

     1268     5566    3                 CODE16.LINENO=I;

   5566  1 005116   200014 720100                    LXL0    I,,AUTO
         1 005117   000005 440100                    SXL0    5,,PR0

     1269     5567    3                 CODE16.NOTCOL1=%YES#;

   5567  1 005120   400000 236003                    LDQ     -131072,DU
         1 005121   000007 256100                    ORSQ    7,,PR0
         1 005122   005420 710000 1                  TRA     s:5655

     1270     5568    3               CASE(%VFCF_SKA);

     1271     5569    4                 IF CODE16.LINENO>=F$USRDCB.LINES THEN DO;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:210  
   5569  1 005123   200007 471500                    LDP1    FORM$,,AUTO
         1 005124   100005 720100                    LXL0    5,,PR1
         1 005125   000044 100100                    CMPX0   36,,PR0
         1 005126   005131 602000 1                  TNC     s:5572

     1272     5570    4                    CALL URFILHDR ALTRET(ALTRETUR);

   5570  1 005127   005616 701000 1                  TSX1    URFILHDR
         1 005130   005545 702000 1                  TSX2    ALTRETUR

     1273     5571    4                    END;

     1274     5572    3                 CODE16.NOTCOL1=%NO#;

   5572  1 005131   200007 470500                    LDP0    FORM$,,AUTO
         1 005132   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 005133   000007 356100                    ANSQ    7,,PR0

     1275     5573    3                 CALL URFILFINDLINE;

   5573  1 005134   005553 701000 1                  TSX1    URFILFINDLINE
         1 005135   000000 011000                    NOP     0

     1276     5574    3                 IF I=0 THEN /* No such line in VFU.*/

   5574  1 005136   200014 235100                    LDA     I,,AUTO
         1 005137   005145 601000 1                  TNZ     s:5576

     1277     5575    3                    I=CODE16.LINENO+1;

   5575  1 005140   200007 470500                    LDP0    FORM$,,AUTO
         1 005141   000005 236100                    LDQ     5,,PR0
         1 005142   777777 376007                    ANQ     -1,DL
         1 005143   000001 036007                    ADLQ    1,DL
         1 005144   200014 756100                    STQ     I,,AUTO

     1278     5576    3                 IF I>=F$USRDCB.LINES THEN
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:211  

   5576  1 005145   200005 470500                    LDP0    USRDCB$,,AUTO
         1 005146   000044 236100                    LDQ     36,,PR0
         1 005147   000022 772000                    QRL     18
         1 005150   200014 116100                    CMPQ    I,,AUTO
         1 005151   005156 605400 1                  TPNZ    s:5579

     1279     5577    3                    CODE16.LINENO=CODE16.LINES;

   5577  1 005152   200007 471500                    LDP1    FORM$,,AUTO
         1 005153   100006 720100                    LXL0    6,,PR1
         1 005154   100005 440100                    SXL0    5,,PR1
         1 005155   005420 710000 1                  TRA     s:5655

     1280     5578    3                 ELSE
     1281     5579    3                    CODE16.LINENO=I;

   5579  1 005156   200014 720100                    LXL0    I,,AUTO
         1 005157   200007 471500                    LDP1    FORM$,,AUTO
         1 005160   100005 440100                    SXL0    5,,PR1
         1 005161   005420 710000 1                  TRA     s:5655

     1282     5580    3               CASE(%VFCF_SPA);

     1283     5581    3                 UVFCLINES=NK$VFC.COUNT;

   5581  1 005162   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 005163   000033 772000                    QRL     27
         1 005164   000017 376007                    ANQ     15,DL
         1 005165   200017 756100                    STQ     UVFCLINES,,AUTO

     1284     5582    4   ASIFSPA:      IF CODE16.LINENO>=F$USRDCB.LINES THEN DO;

   5582  1 005166   200007 470500       ASIFSPA      LDP0    FORM$,,AUTO
         1 005167   000005 720100                    LXL0    5,,PR0
         1 005170   200005 471500                    LDP1    USRDCB$,,AUTO
         1 005171   100044 100100                    CMPX0   36,,PR1
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:212  
         1 005172   005175 602000 1                  TNC     s:5585

     1285     5583    4                    CALL URFILHDR ALTRET(ALTRETUR);

   5583  1 005173   005616 701000 1                  TSX1    URFILHDR
         1 005174   005545 702000 1                  TSX2    ALTRETUR

     1286     5584    4                    END;

     1287     5585    3                 CODE16.NOTCOL1=(UVFCLINES=0);

   5585  1 005175   400000 220003                    LDX0    -131072,DU
         1 005176   200017 235100                    LDA     UVFCLINES,,AUTO
         1 005177   005201 600000 1                  TZE     s:5585+4
         1 005200   000000 220003                    LDX0    0,DU
         1 005201   200007 470500                    LDP0    FORM$,,AUTO
         1 005202   000000 636010                    EAQ     0,X0
         1 005203   000007 676100                    ERQ     7,,PR0
         1 005204   400000 376003                    ANQ     -131072,DU
         1 005205   000007 656100                    ERSQ    7,,PR0

     1288     5586    4                 IF CODE16.LINENO+UVFCLINES>=F$USRDCB.LINES THEN DO;

   5586  1 005206   000005 236100                    LDQ     5,,PR0
         1 005207   777777 376007                    ANQ     -1,DL
         1 005210   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 005211   200005 471500                    LDP1    USRDCB$,,AUTO
         1 005212   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 005213   100044 236100                    LDQ     36,,PR1
         1 005214   000022 772000                    QRL     18
         1 005215   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 005216   200044 236100                    LDQ     FPTV$$+1,,AUTO
         1 005217   200045 116100                    CMPQ    FPTV$$+2,,AUTO
         1 005220   005277 604000 1                  TMI     s:5607

     1289     5587    4                    IF CODE16.CONTFORM AND

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:213  
   5587  1 005221   000007 430100                    FSZN    7,,PR0
         1 005222   005274 605000 1                  TPL     s:5604
         1 005223   000005 720100                    LXL0    5,,PR0
         1 005224   100044 100100                    CMPX0   36,,PR1
         1 005225   005274 603000 1                  TRC     s:5604

     1290     5588    5                      (CODE16.LINENO<F$USRDCB.LINES) THEN DO;

     1291     5589    5                       CONTFORMMORE=UVFCLINES-(F$USRDCB.LINES-CODE16.LINENO);

   5589  1 005226   000005 236100                    LDQ     5,,PR0
         1 005227   777777 376007                    ANQ     -1,DL
         1 005230   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 005231   100044 236100                    LDQ     36,,PR1
         1 005232   000022 772000                    QRL     18
         1 005233   200044 136100                    SBLQ    FPTV$$+1,,AUTO
         1 005234   200045 756100                    STQ     FPTV$$+2,,AUTO
         1 005235   200017 236100                    LDQ     UVFCLINES,,AUTO
         1 005236   200045 136100                    SBLQ    FPTV$$+2,,AUTO
         1 005237   200030 756100                    STQ     CONTFORMMORE,,AUTO

     1292     5590    6                       IF CONTFORMMORE~=0 THEN DO;

   5590  1 005240   005271 600000 1                  TZE     s:5602

     1293     5591    7                          IF F$USRDCB.HEADER$~=ADDR(NIL) THEN DO;

   5591  1 005241   100046 236100                    LDQ     38,,PR1
         1 005242   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005243   005257 600000 1                  TZE     s:5596

     1294     5592    7                             NK$VFC.COUNT=NK$VFC.COUNT-CONTFORMMORE;

   5592  1 005244   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 005245   000033 772000                    QRL     27
         1 005246   000017 376007                    ANQ     15,DL
         1 005247   200030 136100                    SBLQ    CONTFORMMORE,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:214  
         1 005250   000033 736000                    QLS     27
         1 005251   200022 676100                    ERQ     VFCCHAR,,AUTO
         1 005252   017000 376003                    ANQ     7680,DU
         1 005253   200022 656100                    ERSQ    VFCCHAR,,AUTO

     1295     5593    7                             CODE16.LINENO=CODE16.LINES;

   5593  1 005254   000006 720100                    LXL0    6,,PR0
         1 005255   000005 440100                    SXL0    5,,PR0

     1296     5594    7                             END;

   5594  1 005256   005420 710000 1                  TRA     s:5655

     1297     5595    7                          ELSE DO;

     1298     5596    7                             CODE16.PAGENO=CODE16.PAGENO+1;

   5596  1 005257   000005 220100                    LDX0    5,,PR0
         1 005260   000001 621010                    EAX1    1,X0
         1 005261   000005 741100                    STX1    5,,PR0

     1299     5597    7                             F$USRDCB.PGINGRAN = F$USRDCB.PGINGRAN + 1;

   5597  1 005262   100102 236100                    LDQ     66,,PR1
         1 005263   000001 036007                    ADLQ    1,DL
         1 005264   100102 552104                    STBQ    66,'04'O,PR1

     1300     5598    7                             CODE16.LINENO=CONTFORMMORE;

   5598  1 005265   200030 720100                    LXL0    CONTFORMMORE,,AUTO
         1 005266   000005 440100                    SXL0    5,,PR0

     1301     5599    7                             CONTFORMMORE=0;

   5599  1 005267   200030 450100                    STZ     CONTFORMMORE,,AUTO

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:215  
     1302     5600    7                             END;

     1303     5601    6                          END;

   5601  1 005270   005420 710000 1                  TRA     s:5655

     1304     5602    5                       ELSE CODE16.LINENO=CODE16.LINES;

   5602  1 005271   000006 720100                    LXL0    6,,PR0
         1 005272   000005 440100                    SXL0    5,,PR0

     1305     5603    5                       END;

   5603  1 005273   005420 710000 1                  TRA     s:5655

     1306     5604    4                    ELSE CODE16.LINENO=CODE16.LINES;

   5604  1 005274   000006 720100                    LXL0    6,,PR0
         1 005275   000005 440100                    SXL0    5,,PR0

     1307     5605    4                    END;

   5605  1 005276   005420 710000 1                  TRA     s:5655

     1308     5606    3                 ELSE
     1309     5607    3                    CODE16.LINENO=CODE16.LINENO+UVFCLINES;

   5607  1 005277   000005 236100                    LDQ     5,,PR0
         1 005300   777777 376007                    ANQ     -1,DL
         1 005301   200017 036100                    ADLQ    UVFCLINES,,AUTO
         1 005302   000000 620006                    EAX0    0,QL
         1 005303   000005 440100                    SXL0    5,,PR0
         1 005304   005420 710000 1                  TRA     s:5655

     1310     5608    3               CASE(%VFCF_SPC);

     1311     5609    4                 DO CASE(NK$VFC.COUNT);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:216  

   5609  1 005305   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 005306   000033 772000                    QRL     27
         1 005307   000017 376007                    ANQ     15,DL
         1 005310   000020 116007                    CMPQ    16,DL
         1 005311   005313 602006 1                  TNC     s:5609+6,QL
         1 005312   005352 710000 1                  TRA     s:5627
         1 005313   005352 710000 1                  TRA     s:5627
         1 005314   005334 710000 1                  TRA     s:5613
         1 005315   005334 710000 1                  TRA     s:5613
         1 005316   005333 710000 1                  TRA     s:5611
         1 005317   005341 710000 1                  TRA     s:5615
         1 005320   005341 710000 1                  TRA     s:5615
         1 005321   005342 710000 1                  TRA     s:5617
         1 005322   005342 710000 1                  TRA     s:5617
         1 005323   005343 710000 1                  TRA     s:5619
         1 005324   005344 710000 1                  TRA     s:5621
         1 005325   005345 710000 1                  TRA     s:5623
         1 005326   005351 710000 1                  TRA     s:5625
         1 005327   005352 710000 1                  TRA     s:5627
         1 005330   005345 710000 1                  TRA     s:5623
         1 005331   005356 710000 1                  TRA     s:5630
         1 005332   005374 710000 1                  TRA     s:5638

     1312     5610    4                  CASE(%VFCS_ITAB);

     1313     5611    4                    RETURN;

   5611  1 005333   000000 702200 xent               TSX2  ! X66_ARET

     1314     5612    4                  CASE(%VFCS_OTAB,%VFCS_SEQN);

     1315     5613    4                    USRDVBYTE=USRDVBYTE|%DVBYTE_TRANS#|%DVBYTE_BP#;

   5613  1 005334   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 005335   020000 276003                    ORQ     8192,DU
         1 005336   200000 276003                    ORQ     65536,DU
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:217  
         1 005337   200012 756100                    STQ     USRDVBYTE,,AUTO
         1 005340   005420 710000 1                  TRA     s:5655

     1316     5614    4                  CASE(%VFCS_SPRM,%VFCS_SPRO);

     1317     5615    4                    RETURN;

   5615  1 005341   000000 702200 xent               TSX2  ! X66_ARET

     1318     5616    4                  CASE(%VFCS_SLLN,%VFCS_SLLP);

     1319     5617    4                    RETURN;

   5617  1 005342   000000 702200 xent               TSX2  ! X66_ARET

     1320     5618    4                  CASE(%VFCS_SHDR);

     1321     5619    4                    RETURN;

   5619  1 005343   000000 702200 xent               TSX2  ! X66_ARET

     1322     5620    4                  CASE(%VFCS_SLPP);

     1323     5621    4                    RETURN;

   5621  1 005344   000000 702200 xent               TSX2  ! X66_ARET

     1324     5622    4                  CASE(%VFCS_PGND,%VFCS_CLRWND);

     1325     5623    4                    CODE16.LINENO=CODE16.LINES;

   5623  1 005345   200007 471500                    LDP1    FORM$,,AUTO
         1 005346   100006 720100                    LXL0    6,,PR1
         1 005347   100005 440100                    SXL0    5,,PR1
         1 005350   005420 710000 1                  TRA     s:5655

     1326     5624    4                  CASE(%VFCS_VFU);
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:218  

     1327     5625    4                    RETURN;

   5625  1 005351   000000 702200 xent               TSX2  ! X66_ARET

     1328     5626    4                  CASE(ELSE);

     1329     5627    4                    B$JIT.ERR=ERR$INVVFC;

   5627  1 005352   000017 236000 0                  LDQ     ERR$INVVFC
         1 005353   000000 471400 xsym               LDP1    B$JIT$
         1 005354   100012 756100                    STQ     10,,PR1

     1330     5628    4                    ALTRETURN;

   5628  1 005355   000000 702200 xent               TSX2  ! X66_AALT

     1331     5629    4                  CASE(%VFCS_TRS0);

     1332     5630    4                    UVFCLINES=0;

   5630  1 005356   200017 450100                    STZ     UVFCLINES,,AUTO

     1333     5631    4                    IF CODE16.NOTCOL1 THEN

   5631  1 005357   200007 471500                    LDP1    FORM$,,AUTO
         1 005360   100007 234100                    SZN     7,,PR1
         1 005361   005373 605000 1                  TPL     s:5636

     1334     5632    4                       IF CODE16.LINENO+1<F$USRDCB.LINES THEN

   5632  1 005362   100005 720100                    LXL0    5,,PR1
         1 005363   000001 621010                    EAX1    1,X0
         1 005364   000044 101100                    CMPX1   36,,PR0
         1 005365   005371 603000 1                  TRC     s:5635

     1335     5633    4                          UVFCLINES=1;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:219  

   5633  1 005366   000001 235007                    LDA     1,DL
         1 005367   200017 755100                    STA     UVFCLINES,,AUTO
         1 005370   005373 710000 1                  TRA     s:5636

     1336     5634    4                       ELSE
     1337     5635    4                          CODE16.LINENO=CODE16.LINES;

   5635  1 005371   100006 722100                    LXL2    6,,PR1
         1 005372   100005 442100                    SXL2    5,,PR1

     1338     5636    4                    GOTO ASIFSPB;

   5636  1 005373   005035 710000 1                  TRA     ASIFSPB

     1339     5637    4                  CASE(%VFCS_TRS1);

     1340     5638    4                    IF CODE16.NOTCOL1 THEN

   5638  1 005374   200007 471500                    LDP1    FORM$,,AUTO
         1 005375   100007 234100                    SZN     7,,PR1
         1 005376   005402 605000 1                  TPL     s:5640

     1341     5639    4                       CODE16.LINENO=CODE16.LINENO+1;

   5639  1 005377   100005 720100                    LXL0    5,,PR1
         1 005400   000001 621010                    EAX1    1,X0
         1 005401   100005 441100                    SXL1    5,,PR1

     1342     5640    4                    UVFCLINES=1;

   5640  1 005402   000001 235007                    LDA     1,DL
         1 005403   200017 755100                    STA     UVFCLINES,,AUTO

     1343     5641    4                    GOTO ASIFSPA;

   5641  1 005404   005166 710000 1                  TRA     ASIFSPA
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:220  

     1344     5642    4                  END;

     1345     5643    3               CASE(ELSE);

     1346     5644    3                 B$JIT.ERR=ERR$INVVFC;

   5644  1 005405   000017 236000 0                  LDQ     ERR$INVVFC
         1 005406   000000 471400 xsym               LDP1    B$JIT$
         1 005407   100012 756100                    STQ     10,,PR1

     1347     5645    3                 ALTRETURN;

   5645  1 005410   000000 702200 xent               TSX2  ! X66_AALT

     1348     5646    3               END/*CASE(NK$VFC.FCN)*/;

     1349     5647    2              END/*F$USRDCB.DDEV.LP*/;
     1350     5648    2           ELSE DO;

     1351     5649    2              CODE16.RECNO=CODE16.RECNO+1;

   5649  1 005411   200007 471500                    LDP1    FORM$,,AUTO
         1 005412   100004 235100                    LDA     4,,PR1
         1 005413   000001 035007                    ADLA    1,DL
         1 005414   100004 755100                    STA     4,,PR1

     1352     5650        /*  PGINGRAN will contain the number of records in a non-paged file
     1353     5651            for SPACE and SYMBO keyin purposes.
     1354     5652        */
     1355     5653    2              F$USRDCB.PGINGRAN = F$USRDCB.PGINGRAN + 1;

   5653  1 005415   000102 236100                    LDQ     66,,PR0
         1 005416   000001 036007                    ADLQ    1,DL
         1 005417   000102 552104                    STBQ    66,'04'O,PR0

     1356     5654    2              END;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:221  

     1357     5655    2           IF USRDVBYTE&%DVBYTE_TRANS# THEN DO;

   5655  1 005420   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 005421   020000 376003                    ANQ     8192,DU
         1 005422   005436 600000 1                  TZE     s:5660

     1358     5656    2              FPTVI.DVBYTE=USRDVBYTE.GOOD;

   5656  1 005423   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 005424   200027 552140                    STBQ    FPTVI+3,'40'O,AUTO

     1359     5657    2              CALL MEDIUMEP(MFC_WRITE,FPTVI,VFCCHAR)ALTRET(ALTRETUR);

   5657  1 005425   200022 630500                    EPPR0   VFCCHAR,,AUTO
         1 005426   200037 450500                    STP0    @FPT+1,,AUTO
         1 005427   200024 631500                    EPPR1   FPTVI,,AUTO
         1 005430   200036 451500                    STP1    @FCN+1,,AUTO
         1 005431   000011 236000 2                  LDQ     9
         1 005432   200035 756100                    STQ     CONTFORMMORE+5,,AUTO
         1 005433   006003 701000 1                  TSX1    MEDIUMEP
         1 005434   005545 702000 1                  TSX2    ALTRETUR

     1360     5658    2              END;

   5658  1 005435   005530 710000 1                  TRA     s:5689

     1361     5659    2           ELSE DO;

     1362     5660    3              IF NOT USRDVBYTE&%DVBYTE_BP# AND NOT FPTVI.REWRITE THEN DO;

   5660  1 005436   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 005437   200000 376003                    ANQ     65536,DU
         1 005440   005516 601000 1                  TNZ     BPEND
         1 005441   200024 236100                    LDQ     FPTVI,,AUTO
         1 005442   000100 316007                    CANQ    64,DL
         1 005443   005516 601000 1                  TNZ     BPEND
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:222  

     1363     5661    3                 IF F$USRDCB.UBYTES=0 THEN GOTO BPEND;

   5661  1 005444   200005 470500                    LDP0    USRDCB$,,AUTO
         1 005445   000076 235100                    LDA     62,,PR0
         1 005446   005516 600000 1                  TZE     BPEND

     1364     5662    3                 IF F$USRDCB.UBYTES > 7

   5662  1 005447   000010 115007                    CMPA    8,DL
         1 005450   005500 602000 1                  TNC     BPLOOPER

     1365     5663    4                 THEN DO;

     1366     5664        /*
     1367     5665                         THIS STRANGE CODE IS DUE TO A PROBLEM WITH THE
     1368     5666                         IMPLEMENTATION OF THE TCTR INSTRUCTION WHICH FAULTS
     1369     5667                         WHEN ACCESSING THE FIRST DOUBLEWORD OF A SEGMENT
     1370     5668                         WHICH IS NOT DOUBLEWORD ALIGNED. THE TCTR INSTRUCTION
     1371     5669                         IS USED FOR ALL OF THE DATA BACK TO THE FIRST SEVEN
     1372     5670                         BYTES.  IF A NON-BLANK HAS NOT BEEN FOUND, THE FIRST
     1373     5671                         SEVEN BYTES ARE EXAMINED ONE BYTE AT A TIME.
     1374     5672        */
     1375     5673    4                    I=F$USRDCB.UBYTES - 7;

   5673  1 005451   000007 135007                    SBLA    7,DL
         1 005452   200014 755100                    STA     I,,AUTO

     1376     5674    4                    CALL SEARCHR(F$USRDCB.UBYTES,J,NK_URTBL_BP,

   5674  1 005453   000075 471500                    LDP1    61,,PR0
         1 005454   200014 236100                    LDQ     I,,AUTO
         1 005455   000000 620006                    EAX0    0,QL
         1 005456   000000 165540                    TCTR
         1 005457   100001 600010                    ADSC9   1,,PR1                   cn=3,n=*X0
         1 005460   000020 000000 0                  ARG     NK_URTBL_BP
         1 005461   000076 000100                    ARG     62,,PR0
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:223  
         1 005462   000076 235100                    LDA     62,,PR0
         1 005463   000033 771000                    ARL     27
         1 005464   200013 755100                    STA     J,,AUTO
         1 005465   000076 551140                    STBA    62,'40'O,PR0
         1 005466   005475 606400 1                  TTN     BPALLBLANK
         1 005467   000076 054100                    AOS     62,,PR0
         1 005470   000076 156100                    SSQ     62,,PR0

     1377     5675    4                      PINCRC(F$USRDCB.UB$,7)->CHARI) ALTRET(BPALLBLANK);
     1378     5676    4                    F$USRDCB.UBYTES = F$USRDCB.UBYTES + 8;

   5676  1 005471   000076 235100                    LDA     62,,PR0
         1 005472   000010 035007                    ADLA    8,DL
         1 005473   000076 755100                    STA     62,,PR0

     1379     5677    4                    GOTO BPEND;

   5677  1 005474   005516 710000 1                  TRA     BPEND

     1380     5678    4   BPALLBLANK:      F$USRDCB.UBYTES = 7;

   5678  1 005475   000007 235007       BPALLBLANK   LDA     7,DL
         1 005476   200005 470500                    LDP0    USRDCB$,,AUTO
         1 005477   000076 755100                    STA     62,,PR0

     1381     5679    4                    END;

     1382     5680    3   BPLOOPER:     IF NK_URTBL_BP(ASCBIN(SUBSTR(F$USRDCB.UB$->CHAR1,

   5680  1 005500   200005 470500       BPLOOPER     LDP0    USRDCB$,,AUTO
         1 005501   000075 471500                    LDP1    61,,PR0
         1 005502   000076 235100                    LDA     62,,PR0
         1 005503   000100 101505                    MRL     fill='000'O
         1 005504   177777 600001                    ADSC9   -1,A,PR1                 cn=3,n=1
         1 005505   200044 000004                    ADSC9   FPTV$$+1,,AUTO           cn=0,n=4
         1 005506   200044 236100                    LDQ     FPTV$$+1,,AUTO
         1 005507   040000 106406                    CMPC    fill='040'O
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:224  
         1 005510   000020 000001 0                  ADSC9   NK_URTBL_BP,Q            cn=0,n=1
         1 005511   000006 000001 2                  ADSC9   6                        cn=0,n=1
         1 005512   005516 601000 1                  TNZ     BPEND

     1383     5681    4                   F$USRDCB.UBYTES-1,1)))=BINASC(0) THEN DO;

     1384     5682    4                    F$USRDCB.UBYTES=F$USRDCB.UBYTES-1;

   5682  1 005513   000001 135007                    SBLA    1,DL
         1 005514   000076 755100                    STA     62,,PR0

     1385     5683    4                    IF F$USRDCB.UBYTES~=0 THEN GOTO BPLOOPER;

   5683  1 005515   005500 601000 1                  TNZ     BPLOOPER

     1386     5684    4                    END;

     1387     5685    3   BPEND:        END;

   5685  1 005516                       BPEND        null
     1388     5686    2              FPTVI.DVBYTE=USRDVBYTE.GOOD;

   5686  1 005516   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 005517   200027 552140                    STBQ    FPTVI+3,'40'O,AUTO

     1389     5687    2              CALL MEDIUMEP(MFC_WRUR,FPTVI,VFCCHAR)ALTRET(ALTRETUR);

   5687  1 005520   200022 630500                    EPPR0   VFCCHAR,,AUTO
         1 005521   200037 450500                    STP0    @FPT+1,,AUTO
         1 005522   200024 631500                    EPPR1   FPTVI,,AUTO
         1 005523   200036 451500                    STP1    @FCN+1,,AUTO
         1 005524   000020 236000 2                  LDQ     16
         1 005525   200035 756100                    STQ     CONTFORMMORE+5,,AUTO
         1 005526   006003 701000 1                  TSX1    MEDIUMEP
         1 005527   005545 702000 1                  TSX2    ALTRETUR

     1390     5688    2              END;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:225  

     1391     5689    2           IF CONTFORMMORE~=0 THEN DO;

   5689  1 005530   200030 235100                    LDA     CONTFORMMORE,,AUTO
         1 005531   005544 600000 1                  TZE     s:5695

     1392     5690    2              NK$VFC.COUNT=CONTFORMMORE;

   5690  1 005532   200030 236100                    LDQ     CONTFORMMORE,,AUTO
         1 005533   000033 736000                    QLS     27
         1 005534   200022 676100                    ERQ     VFCCHAR,,AUTO
         1 005535   017000 376003                    ANQ     7680,DU
         1 005536   200022 656100                    ERSQ    VFCCHAR,,AUTO

     1393     5691    2              F$USRDCB.UB$=ADDR(B$JIT);

   5691  1 005537   000000 236000 xsym               LDQ     B$JIT$
         1 005540   200005 470500                    LDP0    USRDCB$,,AUTO
         1 005541   000075 756100                    STQ     61,,PR0

     1394     5692    2              F$USRDCB.UBYTES=0;

   5692  1 005542   000076 450100                    STZ     62,,PR0

     1395     5693    2              GOTO MORESPA;

   5693  1 005543   004711 710000 1                  TRA     MORESPA

     1396     5694    2              END;
     1397     5695    1           RETURN;

   5695  1 005544   000000 702200 xent               TSX2  ! X66_ARET

     1398     5696    1   ALTRETUR: IF B$JIT.ERR.CODE~=0 THEN ALTRETURN;

   5696  1 005545   000000 470400 xsym  ALTRETUR     LDP0    B$JIT$
         1 005546   000012 236100                    LDQ     10,,PR0
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:226  
         1 005547   377770 316007                    CANQ    131064,DL
         1 005550   005552 600000 1                  TZE     s:5697

   5696  1 005551   000000 702200 xent               TSX2  ! X66_AALT

     1399     5697    1           RETURN;

   5697  1 005552   000000 702200 xent               TSX2  ! X66_ARET

     1400     5698        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:227  
     1401     5699    1   URFILFINDLINE: PROC;

   5699  1 005553   200032 741300       URFILFINDLI* STX1  ! CONTFORMMORE+2,,AUTO

     1402     5700        /* RETURN with I=0 if no such hole in VFU image.*/
     1403     5701        /* RETURN with I=line# of next hole past currposn;
     1404     5702                       I=CODE16.LINES if none past curr.posn.*/
     1405     5703    2           J=NK$VFC.COUNT;

   5703  1 005554   200022 236100                    LDQ     VFCCHAR,,AUTO
         1 005555   000033 772000                    QRL     27
         1 005556   000017 376007                    ANQ     15,DL
         1 005557   200013 756100                    STQ     J,,AUTO

     1406     5704    3           IF J~=0 THEN DO;

   5704  1 005560   005610 600000 1                  TZE     s:5712

     1407     5705    3              I=CODE16.VFCIM.LINE(J);

   5705  1 005561   200007 470500                    LDP0    FORM$,,AUTO
         1 005562   000100 101506                    MRL     fill='000'O
         1 005563   000027 000001                    ADSC9   23,Q,PR0                 cn=0,n=1
         1 005564   200014 000004                    ADSC9   I,,AUTO                  cn=0,n=4

     1408     5706    3              IF I=0 THEN RETURN;

   5706  1 005565   200014 235100                    LDA     I,,AUTO
         1 005566   005570 601000 1                  TNZ     LOOP

   5706  1 005567   000001 702211                    TSX2  ! 1,X1

     1409     5707    3   LOOP:      IF I>CODE16.LINENO THEN RETURN;

   5707  1 005570   200007 470500       LOOP         LDP0    FORM$,,AUTO
         1 005571   000005 236100                    LDQ     5,,PR0
         1 005572   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:228  
         1 005573   200014 116100                    CMPQ    I,,AUTO
         1 005574   005577 605000 1                  TPL     s:5708

   5707  1 005575   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 005576   000001 702211                    TSX2  ! 1,X1

     1410     5708    3              J=CODE16.VFCIM.NEXT(J);

   5708  1 005577   200013 235100                    LDA     J,,AUTO
         1 005600   000100 101505                    MRL     fill='000'O
         1 005601   000037 000001                    ADSC9   31,A,PR0                 cn=0,n=1
         1 005602   200013 000004                    ADSC9   J,,AUTO                  cn=0,n=4

     1411     5709    3              I=CODE16.VFCIM.LINE(J);

   5709  1 005603   200013 235100                    LDA     J,,AUTO
         1 005604   000100 101505                    MRL     fill='000'O
         1 005605   000027 000001                    ADSC9   23,A,PR0                 cn=0,n=1
         1 005606   200014 000004                    ADSC9   I,,AUTO                  cn=0,n=4

     1412     5710    3              IF J~=0 THEN GOTO LOOP;

   5710  1 005607   005570 601000 1                  TNZ     LOOP

     1413     5711    3              END;

     1414     5712    2           I=CODE16.LINES;

   5712  1 005610   200007 470500                    LDP0    FORM$,,AUTO
         1 005611   000006 236100                    LDQ     6,,PR0
         1 005612   777777 376007                    ANQ     -1,DL
         1 005613   200014 756100                    STQ     I,,AUTO

     1415     5713    2           RETURN;

   5713  1 005614   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 005615   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:229  

     1416     5714    2   END URFILFINDLINE;
     1417     5715        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:230  
     1418     5716    1   URFILHDR: PROC ALTRET; /*WARNING: DON'T USE 'I' IN THIS ROUTINE */

   5716  1 005616   200032 741300       URFILHDR     STX1  ! CONTFORMMORE+2,,AUTO

     1419     5717    2           CODE16.PAGENO=CODE16.PAGENO+1;

   5717  1 005617   200007 470500                    LDP0    FORM$,,AUTO
         1 005620   000005 220100                    LDX0    5,,PR0
         1 005621   000001 622010                    EAX2    1,X0
         1 005622   000005 742100                    STX2    5,,PR0

     1420     5718    2           F$USRDCB.PGINGRAN = F$USRDCB.PGINGRAN + 1;

   5718  1 005623   200005 471500                    LDP1    USRDCB$,,AUTO
         1 005624   100102 236100                    LDQ     66,,PR1
         1 005625   000001 036007                    ADLQ    1,DL
         1 005626   100102 552104                    STBQ    66,'04'O,PR1

     1421     5719    2           HDR$=F$USRDCB.HEADER$;

   5719  1 005627   100046 236100                    LDQ     38,,PR1
         1 005630   200010 756100                    STQ     TAB$,,AUTO

     1422     5720    3           IF HDR$=ADDR(NIL) THEN DO;

   5720  1 005631   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005632   005642 601000 1                  TNZ     s:5725

     1423     5721    3              USRDVBYTE=USRDVBYTE|%DVBYTE_TOP#;

   5721  1 005633   200012 236100                    LDQ     USRDVBYTE,,AUTO
         1 005634   400000 276003                    ORQ     -131072,DU
         1 005635   200012 756100                    STQ     USRDVBYTE,,AUTO

     1424     5722    3              CODE16.LINENO=0;

   5722  1 005636   000000 220003                    LDX0    0,DU
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:231  
         1 005637   000005 440100                    SXL0    5,,PR0

     1425     5723    3              RETURN;

   5723  1 005640   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 005641   000001 702211                    TSX2  ! 1,X1

     1426     5724    3              END;
     1427     5725    2           CODE16.LINENO=VLP$HDR.CTL.HEADERHEIGHT#;

   5725  1 005642   200010 473500                    LDP3    TAB$,,AUTO
         1 005643   300000 220100                    LDX0    0,,PR3
         1 005644   000017 360003                    ANX0    15,DU
         1 005645   000005 440100                    SXL0    5,,PR0

     1428     5726    3           IF VLP$HDR.CTL.COUNT#~=0 THEN DO;

   5726  1 005646   300000 236100                    LDQ     0,,PR3
         1 005647   000777 316007                    CANQ    511,DL
         1 005650   005735 600000 1                  TZE     s:5737

     1429     5727    3              J=CODE16.PAGENO-CODE16.PAGEBASE;

   5727  1 005651   000006 236100                    LDQ     6,,PR0
         1 005652   000022 772000                    QRL     18
         1 005653   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 005654   000005 236100                    LDQ     5,,PR0
         1 005655   000022 772000                    QRL     18
         1 005656   200044 136100                    SBLQ    FPTV$$+1,,AUTO
         1 005657   200013 756100                    STQ     J,,AUTO

     1430     5728    3              K=J; L=0;

   5728  1 005660   200015 756100                    STQ     K,,AUTO

   5728  1 005661   200016 450100                    STZ     L,,AUTO

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:232  
     1431     5729    4              DO WHILE(J>0); L=L+1;J=J/10;END;

   5729  1 005662   005671 604400 1                  TMOZ    s:5730

   5729  1 005663   200016 054100                    AOS     L,,AUTO

   5729  1 005664   200013 236100                    LDQ     J,,AUTO
         1 005665   000012 506007                    DIV     10,DL
         1 005666   200013 756100                    STQ     J,,AUTO

   5729  1 005667   000000 116003                    CMPQ    0,DU
         1 005670   005663 605400 1                  TPNZ    s:5729+1

     1432     5730    3              J=VLP$HDR.CTL.COUNT#-1;

   5730  1 005671   200010 470500                    LDP0    TAB$,,AUTO
         1 005672   000000 236100                    LDQ     0,,PR0
         1 005673   000777 376007                    ANQ     511,DL
         1 005674   000001 136007                    SBLQ    1,DL
         1 005675   200013 756100                    STQ     J,,AUTO

     1433     5731    4              DO WHILE((J+L)>160); K=K/10;L=L-1;END;

   5731  1 005676   005704 710000 1                  TRA     s:5731+6

   5731  1 005677   200015 236100                    LDQ     K,,AUTO
         1 005700   000012 506007                    DIV     10,DL
         1 005701   200015 756100                    STQ     K,,AUTO

   5731  1 005702   000001 336007                    LCQ     1,DL
         1 005703   200016 056100                    ASQ     L,,AUTO

   5731  1 005704   200013 236100                    LDQ     J,,AUTO
         1 005705   200016 036100                    ADLQ    L,,AUTO
         1 005706   000240 116007                    CMPQ    160,DL
         1 005707   005677 605400 1                  TPNZ    s:5731+1

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:233  
     1434     5732    3              IF (J+L)>VLP$HDR.TITL.L# THEN

   5732  1 005710   200013 236100                    LDQ     J,,AUTO
         1 005711   200016 036100                    ADLQ    L,,AUTO
         1 005712   200044 756100                    STQ     FPTV$$+1,,AUTO
         1 005713   200010 470500                    LDP0    TAB$,,AUTO
         1 005714   000001 236100                    LDQ     1,,PR0
         1 005715   000033 772000                    QRL     27
         1 005716   200044 116100                    CMPQ    FPTV$$+1,,AUTO
         1 005717   005724 605000 1                  TPL     s:5734

     1435     5733    3                 VLP$HDR.TITL.L#=J+L;

   5733  1 005720   200013 236100                    LDQ     J,,AUTO
         1 005721   200016 036100                    ADLQ    L,,AUTO
         1 005722   000033 736000                    QLS     27
         1 005723   000001 552140                    STBQ    1,'40'O,PR0

     1436     5734    3              IF L>0 THEN

   5734  1 005724   200016 235100                    LDA     L,,AUTO
         1 005725   005735 604400 1                  TMOZ    s:5737

     1437     5735    3                 CALL BINCHAR(SUBSTR(VLP$HDR.TITL.TITLE#,J,L),K);

   5735  1 005726   000001 236100                    LDQ     1,,PR0
         1 005727   000033 772000                    QRL     27
         1 005730   000000 620005                    EAX0    0,AL
         1 005731   200013 235100                    LDA     J,,AUTO
         1 005732   000145 301500                    BTD
         1 005733   200015 000004                    NDSC9   K,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
         1 005734   000001 230010                    NDSC9   1,A,PR0                  cn=1,s=nosgn,sf=0,n=*X0

     1438     5736    3              END;

     1439     5737    2           SAVEUB$=F$USRDCB.UB$;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:234  
   5737  1 005735   200005 470500                    LDP0    USRDCB$,,AUTO
         1 005736   000075 236100                    LDQ     61,,PR0
         1 005737   200020 756100                    STQ     SAVEUB$,,AUTO

     1440     5738    2           SAVEUBT=F$USRDCB.UBYTES;

   5738  1 005740   000076 235100                    LDA     62,,PR0
         1 005741   200021 755100                    STA     SAVEUBT,,AUTO

     1441     5739    2           F$USRDCB.UB$=ADDR(VLP$HDR.TITL.TITLE#);

   5739  1 005742   200010 236100                    LDQ     TAB$,,AUTO
         1 005743   000031 036000 2                  ADLQ    25
         1 005744   000075 756100                    STQ     61,,PR0

     1442     5740    2           F$USRDCB.UBYTES=VLP$HDR.TITL.L#;

   5740  1 005745   200010 471500                    LDP1    TAB$,,AUTO
         1 005746   100001 236100                    LDQ     1,,PR1
         1 005747   000033 772000                    QRL     27
         1 005750   000076 756100                    STQ     62,,PR0

     1443     5741    2           FPTVI.DVBYTE=%DVBYTE_VFC#|%DVBYTE_TOP#;

   5741  1 005751   500000 236003                    LDQ     -98304,DU
         1 005752   200027 552140                    STBQ    FPTVI+3,'40'O,AUTO

     1444     5742    2           CALL MEDIUMEP(MFC_WRUR,FPTVI,

   5742  1 005753   100000 236100                    LDQ     0,,PR1
         1 005754   000022 772000                    QRL     18
         1 005755   000017 376007                    ANQ     15,DL
         1 005756   000160 036007                    ADLQ    112,DL
         1 005757   000033 736000                    QLS     27
         1 005760   000006 276000 2                  ORQ     6
         1 005761   200056 552140                    STBQ    FPTV$$+11,'40'O,AUTO
         1 005762   200056 633500                    EPPR3   FPTV$$+11,,AUTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:235  
         1 005763   200037 453500                    STP3    @MFC,,AUTO
         1 005764   200024 634500                    EPPR4   FPTVI,,AUTO
         1 005765   200036 454500                    STP4    @FCN+1,,AUTO
         1 005766   000020 236000 2                  LDQ     16
         1 005767   200035 756100                    STQ     CONTFORMMORE+5,,AUTO
         1 005770   006003 701000 1                  TSX1    MEDIUMEP
         1 005771   006001 702000 1                  TSX2    ALTR

     1445     5743    2             BINASC(VLP$HDR.CTL.HEADERHEIGHT#+ASCBIN('p')))
     1446     5744    2             ALTRET(ALTR);
     1447     5745    2           F$USRDCB.UB$=SAVEUB$;

   5745  1 005772   200020 236100                    LDQ     SAVEUB$,,AUTO
         1 005773   200005 470500                    LDP0    USRDCB$,,AUTO
         1 005774   000075 756100                    STQ     61,,PR0

     1448     5746    2           F$USRDCB.UBYTES=SAVEUBT;

   5746  1 005775   200021 235100                    LDA     SAVEUBT,,AUTO
         1 005776   000076 755100                    STA     62,,PR0

     1449     5747    2           RETURN;

   5747  1 005777   200032 221300                    LDX1  ! CONTFORMMORE+2,,AUTO
         1 006000   000001 702211                    TSX2  ! 1,X1

     1450     5748    2   ALTR:   ALTRETURN;

   5748  1 006001   200032 221300       ALTR         LDX1  ! CONTFORMMORE+2,,AUTO
         1 006002   000000 702211                    TSX2  ! 0,X1

     1451     5749    2   END URFILHDR;
     1452     5750        %EJECT;
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:236  
     1453     5751    1   MEDIUMEP: PROC(FCN,FPT,VFC) ALTRET;

   5751  1 006003   200034 741300       MEDIUMEP     STX1  ! CONTFORMMORE+4,,AUTO

     1454     5752        /**/
     1455     5753    2   DCL FCN UBIN;
     1456     5754    2   DCL FPT UBIN;
     1457     5755    2   DCL VFC UBIN;
     1458     5756        /**/
     1459     5757    3           DO CASE(MEDIUMX);

   5757  1 006004   200011 235100                    LDA     MEDIUMX,,AUTO
         1 006005   000002 115007                    CMPA    2,DL
         1 006006   006010 602005 1                  TNC     s:5757+4,AL
         1 006007   006031 710000 1                  TRA     s:5767
         1 006010   006012 710000 1                  TRA     s:5759
         1 006011   006022 710000 1                  TRA     s:5763

     1460     5758    3            CASE(%FMH$CPMME#);

     1461     5759    4              CALL FMH$CPMME(FCN,FPT,VFC) WHENALTRETURN DO;

   5759  1 006012   200035 630500                    EPPR0   @FCN,,AUTO
         1 006013   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 006014   000000 701000 xent               TSX1    FMH$CPMME
         1 006015   006017 702000 1                  TSX2    s:5760
         1 006016   006021 710000 1                  TRA     s:5760+2

     1462     5760    4                 ALTRETURN;

   5760  1 006017   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 006020   000000 702211                    TSX2  ! 0,X1
         1 006021   006031 710000 1                  TRA     s:5767

     1463     5761    4                 END;
     1464     5762    3            CASE(%FTW$WRAT#);

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:237  
     1465     5763    4              CALL FTW$WRAT(FCN,FPT,VFC) WHENALTRETURN DO;

   5763  1 006022   200035 630500                    EPPR0   @FCN,,AUTO
         1 006023   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 006024   000000 701000 xent               TSX1    FTW$WRAT
         1 006025   006027 702000 1                  TSX2    s:5764
         1 006026   006031 710000 1                  TRA     s:5767

     1466     5764    4                 ALTRETURN;

   5764  1 006027   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 006030   000000 702211                    TSX2  ! 0,X1

     1467     5765    4                 END;
     1468     5766    3            END;

     1469     5767    2           RETURN;

   5767  1 006031   200034 221300                    LDX1  ! CONTFORMMORE+4,,AUTO
         1 006032   000001 702211                    TSX2  ! 1,X1

TABZERO
 Sect OctLoc
   0     000   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0     004   000000 000000   000000 000000   000000 000000   000000 000000    ................

NULLHDR
 Sect OctLoc
   0     010   000000 000000   001040 ******                                    ..... ..

ERR$EOF
 Sect OctLoc
   0     012   062305 000062                                                    2..2

ERR$UNIMP
 Sect OctLoc
   0     013   062305 003072                                                    2..:
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:238  

ERR$POS
 Sect OctLoc
   0     014   062305 000722                                                    2...

ERR$CANTBIN
 Sect OctLoc
   0     015   062305 014152                                                    2..j

ERR$ILLBV
 Sect OctLoc
   0     016   062305 014162                                                    2..r

ERR$INVVFC
 Sect OctLoc
   0     017   062305 014140                                                    2..`

NK_URTBL_BP
 Sect OctLoc
   0     020   001001 001001   001001 001001   001001 001001   001001 001001    ................
   0     030*  000001 001001   001001 001001   001001 001001   001001 001001    ................
   0     034   001001 001001   001001 001001   001001 001001   001001 001001    ................
   0     070*  000001 001001   001001 001001   001001 001001   001001 001001    ................
   0     074   001001 001001   001001 001001   001001 001001   001001 001001    ................
   0     130*  000001 001001   001001 001001   001001 001001   001001 001001    ................
   0     134   001001 001001   001001 001001   001001 001001   001001 001001    ................
   0     170*  000001 001001   001001 001001   001001 001001   001001 001001    ................
   0     174   001001 001001   001001 001001   001001 001001   001001 001001    ................
   0     214*  001001 001001   001001 001001   001001 001001   001001 001001    ................

(unnamed)
 Sect OctLoc
   2     000   000000 006003   000002 006000   000002 006000   000002 006000    ................
   2     004   777777 677777   777777 737777   000040 040040   000006 006000    .........   ....
   2     010   000000 006000   000003 006000   000010 006000   760777 777777    ................
   2     014   100000 000000   141040 040040   000014 006000   000015 006000    @...a   ........
   2     020   000014 006000   000000 000015   000021 006000   617777 777777    ................
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:239  
   2     024   000000 006000   000004 006000   000015 006000   101040 040040    ............A
   2     030   000027 006000   000001 200000   000000 006000   777777 777740    ................
   2     034   120000 000000   021040 040040   000034 006000   000035 006000    P....   ........
   2     040   030040 040040   776777 777777   000034 006000   000040 006000    .   ......... ..
     1470     5768        /**/
     1471     5769    2   END MEDIUMEP;
     1472     5770    1   END FSE$FORMAT;
     1473     5771        %EOD;

PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:240  
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   F_CP6.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   F$CP6V_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FSE$FORMAT.
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:241  

 **** Variables and constants ****

  ****  Section 000 RoData FSE$FORMAT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    15-0-0/b STRC        r     1 ERR$CANTBIN               12-0-0/b STRC        r     1 ERR$EOF
    16-0-0/b STRC        r     1 ERR$ILLBV                 17-0-0/b STRC        r     1 ERR$INVVFC
    14-0-0/b STRC        r     1 ERR$POS                   13-0-0/b STRC        r     1 ERR$UNIMP
    20-0-0/c CHAR        r     1 NK_URTBL_BP(0:511)
    10-0-0/w STRC(54)    r     1 NULLHDR                    0-0-0/w STRC(288)   r     1 TABZERO

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    40-0-0/w PTR         r     1 @DVB                      35-0-0/w PTR         r     1 @FCN
    36-0-0/w PTR         r     1 @FPT                       3-0-0/w PTR         r     1 @FPTCODE
     4-0-0/w PTR         r     1 @FPTV                     37-0-0/w PTR         r     1 @MFC
    37-0-0/w PTR         r     1 @VFC                      41-0-0/w PTR         r     1 @VFCC
    23-0-0/w STRC        r     1 BCMEDDCB                  23-0-0/w PTR         r     1 BCMEDDCB$
    30-0-0/w SBIN        r     1 CONTFORMMORE              *0-0-0/w BIT (9)     r     1 DVB
    *0-0-0/w UBIN        r     1 FCN                        7-0-0/w PTR         r     1 FORM$
    *0-0-0/w UBIN        r     1 FPT                       *0-0-0/w SBIN        r     1 FPTCODE
    *0-0-0/d STRC(144)   r     1 FPTV                      43-0-0/w PTR         r     1 FPTV$$
    24-0-0/d STRC(144)   r     1 FPTVI                     10-0-0/w PTR         r     1 HDR$
    14-0-0/w SBIN        r     1 I                         13-0-0/w SBIN        r     1 J
    15-0-0/w SBIN        r     1 K                         16-0-0/w SBIN        r     1 L
     6-0-0/w PTR         r     1 MEDDCB$                   11-0-0/w UBIN        r     1 MEDIUMX
    *0-0-0/w SBIN        r     1 MFC                       22-0-0/c STRC(9)     r     1 NK$VFC
    20-0-0/w PTR         r     1 SAVEUB$                   21-0-0/w UBIN        r     1 SAVEUBT
    42-0-0/w SBIN        r     1 SYMB_MFC                  10-0-0/w PTR         r     1 TAB$
     5-0-0/w PTR         r     1 USRDCB$                   12-0-0/b STRC        r     1 USRDVBYTE
    17-0-0/w SBIN        r     1 UVFCLINES                 *0-0-0/w UBIN        r     1 VFC
    *0-0-0/c CHAR        r     1 VFCC                      22-0-0/c CHAR        r     1 VFCCHAR
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:242  

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$ROSEG$                   0-0-0/b BIT (72)    r     1 F_DCBLOCK

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(3024)  r     1 B$ROSEG
     0-0-0/c CHAR        r     1 CHAR1                      0-0-0/c ACHR        r     1 CHARI
     0-0-0/w STRC(1404)  r     1 CODE16                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w PTR         r     1 FPTV$                      0-0-0/d STRC(108)   r     1 PRECORDFPT
     0-0-0/w ASTR(45)    r     1 VLP$HDR                    0-0-0/w STRC(1485)  r     1 VLP$HDRF
     0-0-0/w STRC(288)   r     1 VLP$TAB                    0-0-0/w STRC(432)   r     1 VSST
     0-0-0/w STRC(288)   r     1 VSTA


   Procedure FSE$FORMAT requires 3099 words for executable code.
   Procedure FSE$FORMAT requires 48 words of local(AUTO) storage.
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:243  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:244  
          MINI XREF LISTING

ALTORCHUNK IN PROCEDURE MEDIUM
      5207**LABEL    5182--CALLALT
ALTORCHUNK IN PROCEDURE PREPWRITE
      5295**LABEL    5268--CALLALT
ALTR IN PROCEDURE NSTRMPREP
      4822**LABEL    4770--CALLALT  4773--GOTO     4775--CALLALT  4780--CALLALT  4794--CALLALT  4797--CALLALT
      4800--CALLALT
ALTR IN PROCEDURE STREAMPREP
      4676**LABEL    4576--GOTO     4606--GOTO     4614--GOTO     4623--GOTO     4647--CALLALT  4652--CALLALT
      4668--CALLALT
ALTR IN PROCEDURE URFILHDR
      5748**LABEL    5742--CALLALT
ALTRETUR
      5696**LABEL    5477--CALLALT  5490--CALLALT  5509--CALLALT  5538--CALLALT  5558--CALLALT  5570--CALLALT
      5583--CALLALT  5657--CALLALT  5687--CALLALT
ALTRETUR IN PROCEDURE DDFHEADER
      5459**LABEL    5455--CALLALT
ALTRETUR IN PROCEDURE DDFTAB
      5439**LABEL    5434--CALLALT
ALTRETUR IN PROCEDURE DOHEADER
      5392**LABEL    5384--CALLALT  5388--CALLALT
ALTRETUR IN PROCEDURE FORMATIT
      5144**LABEL    4895--CALLALT  4897--CALLALT  4936--CALLALT  4951--CALLALT  4970--CALLALT  4981--CALLALT
      4999--CALLALT  5058--CALLALT  5099--CALLALT  5130--CALLALT  5133--CALLALT
ALTRETUR IN PROCEDURE MEDIUM
      5206**LABEL    5184--CALLALT  5190--CALLALT  5192--CALLALT  5194--CALLALT  5197--CALLALT  5208--CALLALT
ALTRETUR IN PROCEDURE PREPWRITE
      5285**LABEL    5270--CALLALT  5274--CALLALT  5277--CALLALT  5280--CALLALT  5296--CALLALT
ALTRETUR IN PROCEDURE TTYFORMATIT
      4870**LABEL    4827--CALLALT  4829--CALLALT  4830--CALLALT  4868--CALLALT  4875--CALLALT  4880--CALLALT
ASIFSPA
      5582**LABEL    5641--GOTO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:245  
ASIFSPA IN PROCEDURE FORMATIT
      5001**LABEL    4984--CALLALT
ASIFSPB
      5550**LABEL    5535--GOTO     5636--GOTO
ASIFSPB IN PROCEDURE FORMATIT
      4960**LABEL    4947--CALLALT  5051--GOTO
B$JIT
       582**DCL      5139--ASSIGN   5691--ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       681**DCL       681--REDEF
B$JIT.DCB$
       755**DCL      4561>>ASSIGN   4581<<ASSIGN   4635<<ASSIGN   4643<<ASSIGN   4672<<ASSIGN   4676<<ASSIGN
      4721<<ASSIGN   4748>>ASSIGN   5467>>ASSIGN
B$JIT.ERR
       587**DCL      4564<<ASSIGN   4574<<ASSIGN   4594<<ASSIGN   4603<<ASSIGN   4612<<ASSIGN   4642<<ASSIGN
      4675<<ASSIGN   4696<<ASSIGN   4703<<ASSIGN   4704<<ASSIGN   4713<<ASSIGN   4715<<ASSIGN   4761<<ASSIGN
      4773<<ASSIGN   4806<<ASSIGN   4808<<ASSIGN   4815<<ASSIGN   4816<<ASSIGN   4818<<ASSIGN   4820<<ASSIGN
      4844<<ASSIGN   4850<<ASSIGN   4856<<ASSIGN   4859<<ASSIGN   4864<<ASSIGN   4870<<ASSIGN   4912<<ASSIGN
      4917<<ASSIGN   4921<<ASSIGN   4924<<ASSIGN   4929<<ASSIGN   5039<<ASSIGN   5070<<ASSIGN   5144<<ASSIGN
      5203>>IF       5207>>IF       5241<<ASSIGN   5246<<ASSIGN   5284<<ASSIGN   5295>>IF       5472<<ASSIGN
      5499<<ASSIGN   5504<<ASSIGN   5627<<ASSIGN   5644<<ASSIGN
B$JIT.ERR.CODE
       588**DCL      4547>>IF       4619>>IF       5696>>IF
B$JIT.ERR.MID
       588**DCL       588--REDEF
B$JIT.JRESPEAK
       749**DCL       750--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       858**DCL       858--REDEF     859--REDEF
B$JIT.PNR
       762**DCL       762--REDEF
B$JIT.REMCPO
       860**DCL      5076>>IF       5084<<ASSIGN   5084>>ASSIGN   5252>>IF       5260<<ASSIGN   5260>>ASSIGN
B$JIT.REMDO
       860**DCL      5325>>IF       5334<<ASSIGN   5334>>ASSIGN
B$JIT.REMLO
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:246  
       860**DCL      5337>>IF       5346<<ASSIGN   5346>>ASSIGN
B$JIT.RNST
       766**DCL      5079<<ASSIGN   5079>>ASSIGN   5255<<ASSIGN   5255>>ASSIGN   5328<<ASSIGN   5328>>ASSIGN
      5340<<ASSIGN   5340>>ASSIGN
B$JIT.TSLINE
       856**DCL       857--REDEF
B$JIT.USER
       587**DCL      5077>>IF       5253>>IF       5326>>IF       5338>>IF
B$JIT.XLIMFLG
       818**DCL      5078<<ASSIGN   5078>>ASSIGN   5254<<ASSIGN   5254>>ASSIGN   5327<<ASSIGN   5327>>ASSIGN
      5339<<ASSIGN   5339>>ASSIGN
B$JIT$
      4220**DCL       582--IMP-PTR  4547>>IF       4561>>ASSIGN   4564>>ASSIGN   4574>>ASSIGN   4581>>ASSIGN
      4594>>ASSIGN   4603>>ASSIGN   4612>>ASSIGN   4619>>IF       4635>>ASSIGN   4642>>ASSIGN   4643>>ASSIGN
      4672>>ASSIGN   4675>>ASSIGN   4676>>ASSIGN   4696>>ASSIGN   4703>>ASSIGN   4704>>ASSIGN   4713>>ASSIGN
      4715>>ASSIGN   4721>>ASSIGN   4748>>ASSIGN   4761>>ASSIGN   4773>>ASSIGN   4806>>ASSIGN   4808>>ASSIGN
      4815>>ASSIGN   4816>>ASSIGN   4818>>ASSIGN   4820>>ASSIGN   4844>>ASSIGN   4850>>ASSIGN   4856>>ASSIGN
      4859>>ASSIGN   4864>>ASSIGN   4870>>ASSIGN   4912>>ASSIGN   4917>>ASSIGN   4921>>ASSIGN   4924>>ASSIGN
      4929>>ASSIGN   5039>>ASSIGN   5070>>ASSIGN   5076>>IF       5077>>IF       5078>>ASSIGN   5078>>ASSIGN
      5079>>ASSIGN   5079>>ASSIGN   5084>>ASSIGN   5084>>ASSIGN   5139>>ASSIGN   5144>>ASSIGN   5203>>IF
      5207>>IF       5241>>ASSIGN   5246>>ASSIGN   5252>>IF       5253>>IF       5254>>ASSIGN   5254>>ASSIGN
      5255>>ASSIGN   5255>>ASSIGN   5260>>ASSIGN   5260>>ASSIGN   5284>>ASSIGN   5295>>IF       5325>>IF
      5326>>IF       5327>>ASSIGN   5327>>ASSIGN   5328>>ASSIGN   5328>>ASSIGN   5334>>ASSIGN   5334>>ASSIGN
      5337>>IF       5338>>IF       5339>>ASSIGN   5339>>ASSIGN   5340>>ASSIGN   5340>>ASSIGN   5346>>ASSIGN
      5346>>ASSIGN   5467>>ASSIGN   5472>>ASSIGN   5499>>ASSIGN   5504>>ASSIGN   5627>>ASSIGN   5644>>ASSIGN
      5691>>ASSIGN   5696>>IF
B$PS0$ IN PROCEDURE MEDIUM
      5156**DCL      5187>>IF       5189--ASSIGN
B$ROSEG.CR01ID.NOWIS
       898**DCL      4599>>DOCASE
B$ROSEG.NUMDCBS
       876**DCL      5414>>ASSIGN
B$ROSEG$
      4221**DCL      4599>>DOCASE   5414>>ASSIGN
BCMEDDCB.SID
      4434**DCL      4678<<ASSIGN   4723<<ASSIGN
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:247  
BCMEDDCB$
      4431**DCL      4432--REDEF    4677<<ASSIGN   4679>>ASSIGN   4680>>ASSIGN   4681>>ASSIGN   4682>>ASSIGN
      4683>>ASSIGN   4684>>IF       4687>>ASSIGN   4689>>ASSIGN   4691>>ASSIGN   4693>>CALL     4722<<ASSIGN
      4724>>IF       4726>>ASSIGN   4728>>ASSIGN   4731>>CALL     4734>>ASSIGN
BPALLBLANK
      5678**LABEL    5674--CALLALT
BPALLBLANK IN PROCEDURE FORMATIT
      5121**LABEL    5117--CALLALT
BPEND
      5685**LABEL    5661--GOTO     5677--GOTO
BPEND IN PROCEDURE FORMATIT
      5128**LABEL    5104--GOTO     5120--GOTO
BPLOOPER
      5680**LABEL    5683--GOTO
BPLOOPER IN PROCEDURE FORMATIT
      5123**LABEL    5126--GOTO
C1AGAIN IN PROCEDURE STREAMPREP
      4599**LABEL    4617--GOTO     4625--GOTO
C1ALTR IN PROCEDURE STREAMPREP
      4616**LABEL    4611--CALLALT  4616--CALLALT
CHAR1
      4429**DCL      5123>>IF       5288>>ASSIGN   5514>>ASSIGN   5680>>IF
CHARI
      4430**DCL      5117>>CALLBLT  5674>>CALLBLT
CHUNKRET IN PROCEDURE MEDIUM
      5182**LABEL    5209--GOTO
CHUNKRET IN PROCEDURE PREPWRITE
      5268**LABEL    5297--GOTO
CODE16.CONTFORM
      4255**DCL      4963>>IF       5007>>IF       5552>>IF       5587>>IF
CODE16.LINENO
      4254**DCL      4944<<ASSIGN   4954>>ASSIGN   4957<<ASSIGN   4962>>IF       4964>>IF       4965>>ASSIGN
      4971>>IF       4976<<ASSIGN   4976>>ASSIGN   4979>>IF       4987<<ASSIGN   4990<<ASSIGN   4994>>IF
      5003>>IF       5007>>IF       5009>>ASSIGN   5014<<ASSIGN   5017<<ASSIGN   5017>>ASSIGN   5034<<ASSIGN
      5045>>IF       5050<<ASSIGN   5054>>IF       5063<<ASSIGN   5063>>ASSIGN   5314>>IF       5329<<ASSIGN
      5341<<ASSIGN   5356<<ASSIGN   5528<<ASSIGN   5543>>ASSIGN   5546<<ASSIGN   5550>>ASSIGN   5553>>IF
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:248  
      5554>>ASSIGN   5556>>ASSIGN   5559>>ASSIGN   5563>>ASSIGN   5566<<ASSIGN   5569>>IF       5575>>ASSIGN
      5577<<ASSIGN   5579<<ASSIGN   5582>>IF       5586>>IF       5587>>IF       5589>>ASSIGN   5593<<ASSIGN
      5598<<ASSIGN   5602<<ASSIGN   5604<<ASSIGN   5607<<ASSIGN   5607>>ASSIGN   5623<<ASSIGN   5632>>IF
      5635<<ASSIGN   5639<<ASSIGN   5639>>ASSIGN   5707>>IF       5722<<ASSIGN   5725<<ASSIGN
CODE16.LINES
      4254**DCL      4987>>ASSIGN   5014>>ASSIGN   5034>>ASSIGN   5050>>ASSIGN   5319>>ASSIGN   5329>>ASSIGN
      5341>>ASSIGN   5577>>ASSIGN   5593>>ASSIGN   5602>>ASSIGN   5604>>ASSIGN   5623>>ASSIGN   5635>>ASSIGN
      5712>>ASSIGN
CODE16.NOTCOL1
      4254**DCL      4945<<ASSIGN   4958<<ASSIGN   4977<<ASSIGN   4983<<ASSIGN   5001<<ASSIGN   5044>>IF
      5053>>IF       5530<<ASSIGN   5547<<ASSIGN   5567<<ASSIGN   5572<<ASSIGN   5585<<ASSIGN   5631>>IF
      5638>>IF
CODE16.OLDTABS
      4256**DCL      5437<<ASSIGN   5491<<ASSIGN
CODE16.PAGEBASE
      4254**DCL      5366>>ASSIGN   5727>>ASSIGN
CODE16.PAGENO
      4253**DCL      4884<<ASSIGN   4884>>ASSIGN   5354<<ASSIGN   5354>>ASSIGN   5366>>ASSIGN   5526<<ASSIGN
      5526>>ASSIGN   5596<<ASSIGN   5596>>ASSIGN   5717<<ASSIGN   5717>>ASSIGN   5727>>ASSIGN
CODE16.RECNO
      4253**DCL      4881<<ASSIGN   4881>>ASSIGN   5086<<ASSIGN   5086>>ASSIGN   5262<<ASSIGN   5262>>ASSIGN
      5508<<ASSIGN   5508>>ASSIGN   5649<<ASSIGN   5649>>ASSIGN
CODE16.VFCIM.LINE
      4258**DCL      5306>>ASSIGN   5316>>ASSIGN   5705>>ASSIGN   5709>>ASSIGN
CODE16.VFCIM.NEXT
      4258**DCL      5315>>ASSIGN   5708>>ASSIGN
CONTFORMMORE
      4441**DCL      4903<<ASSIGN   5009<<ASSIGN   5136>>IF       5138>>ASSIGN   5522<<ASSIGN   5589<<ASSIGN
      5590>>IF       5592>>ASSIGN   5598>>ASSIGN   5599<<ASSIGN   5689>>IF       5690>>ASSIGN
DDFHEADER
      5445**PROC     4829--CALL     4936--CALL
DDFTAB
      5398**PROC     4827--CALL     4895--CALL
DOHEADER
      5360**PROC     4951--CALL     4970--CALL     4981--CALL     4999--CALL
DVB IN PROCEDURE MEDIUM
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:249  
      5152**DCL      5149--PROC     5160>>ASSIGN   5161>>IF       5161>>IF       5184<>CALL     5190<>CALL
      5192<>CALL     5194<>CALL     5200>>ASSIGN
ERR$CANTBIN
      4362**DCL      5246>>ASSIGN   5504>>ASSIGN
ERR$EOF
      4339**DCL      4603>>ASSIGN   4642>>ASSIGN   4773>>ASSIGN
ERR$ILLBV
      4369**DCL      5241>>ASSIGN   5499>>ASSIGN
ERR$INVVFC
      4376**DCL      4859>>ASSIGN   4864>>ASSIGN   4924>>ASSIGN   4929>>ASSIGN   5039>>ASSIGN   5070>>ASSIGN
      5627>>ASSIGN   5644>>ASSIGN
ERR$POS
      4355**DCL      4703>>ASSIGN   4715>>ASSIGN   4815>>ASSIGN   4820>>ASSIGN
ERR$UNIMP
      4348**DCL      5472>>ASSIGN
F$DCB.ACTPOS
      3870**DCL      3870--REDEF    4682<<ASSIGN   4682>>ASSIGN
F$DCB.ARS
      3845**DCL      3845--REDEF    4639<<ASSIGN   4679<<ASSIGN   4679>>ASSIGN   4767<<ASSIGN
F$DCB.ASN
      3860**DCL      4684>>IF       4724>>IF       5433>>IF
F$DCB.ATTR
      3863**DCL      3864--REDEF    5503>>IF
F$DCB.ATTR.APL
      3864**DCL      5168>>IF
F$DCB.ATTR.BIN
      3864**DCL      5245>>IF
F$DCB.ATTR.GRLGL
      3863**DCL      5161>>IF
F$DCB.ATTR.LOWERCASE
      3864**DCL      5129>>IF       5170>>IF       5173>>IF       5176>>IF       5383>>IF
F$DCB.ATTR.NATL
      3863**DCL      5166>>IF
F$DCB.ATTR.NOXLATE
      3863**DCL      5095<<ASSIGN   5161>>IF
F$DCB.ATTR.TRANSLGL
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:250  
      3863**DCL      5223>>IF
F$DCB.ATTR.UPPERCASE
      3863**DCL      5170>>IF       5173>>IF       5176>>IF
F$DCB.BORROW
      3878**DCL      3878--REDEF    3878--REDEF    3878--REDEF
F$DCB.CFU$
      3879**DCL      4570>>ASSIGN   4608>>ASSIGN   4627>>ASSIGN   5418>>IF
F$DCB.CTLCMDIN
      3886**DCL      4598>>IF       4706>>IF
F$DCB.DCBNAME.L
      3892**DCL      3892--IMP-SIZ
F$DCB.DDEV
      3851**DCL      4833>>IF       4904>>IF       4939>>IF       5075>>IF       5361>>IF       5399>>IF
F$DCB.DDEV.CP
      3851**DCL      5251>>IF
F$DCB.DDEV.IC
      3851**DCL      4601<<ASSIGN   4608<<ASSIGN   4608>>ASSIGN
F$DCB.DDEV.LP
      3851**DCL      5523>>IF
F$DCB.DDEV.XEQ
      3851**DCL      4602<<ASSIGN   4609<<ASSIGN
F$DCB.DVBYTE
      3848**DCL      4680<<ASSIGN   4680>>ASSIGN   5200<<ASSIGN
F$DCB.DVFC
      3866**DCL      5293>>ASSIGN   5519>>ASSIGN
F$DCB.EOMCHAR
      3849**DCL      3849--REDEF    4681<<ASSIGN   4681>>ASSIGN
F$DCB.FCD
      3858**DCL      5418>>IF
F$DCB.FCN
      3882**DCL      4659<<ASSIGN   4660<<ASSIGN   4787<<ASSIGN
F$DCB.FCN.CNT
      3882**DCL      4659>>ASSIGN   4660>>ASSIGN   4787>>ASSIGN
F$DCB.FLDID
      3873**DCL      3873--REDEF    4683<<ASSIGN   4683>>ASSIGN
F$DCB.FORM$
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:251  
      3867**DCL      3867--REDEF    4881>>ASSIGN   4881>>ASSIGN   4884>>ASSIGN   4884>>ASSIGN   4940>>ASSIGN
      5086>>ASSIGN   5086>>ASSIGN   5262>>ASSIGN   5262>>ASSIGN   5436>>IF       5437>>ASSIGN   5481>>ASSIGN
F$DCB.FSECT
      3883**DCL      3883--REDEF
F$DCB.FSN
      3860**DCL      3860--REDEF    3860--REDEF    3861--REDEF
F$DCB.HEADER$
      3866**DCL      3866--REDEF    4932>>IF       5348>>ASSIGN   5350>>ASSIGN   5449>>ASSIGN   5591>>IF
      5719>>ASSIGN
F$DCB.IWL.HDRIWL
      3886**DCL      4828>>IF       4935>>IF       5446<<ASSIGN
F$DCB.IWL.SEQIWL
      3886**DCL      4896<<ASSIGN
F$DCB.IWL.TABIWL
      3886**DCL      4826>>IF       4894>>IF       5410<<ASSIGN   5411<<ASSIGN   5421<<ASSIGN   5421>>ASSIGN
      5423<<ASSIGN   5482>>IF       5492<<ASSIGN
F$DCB.IXTNSIZE
      3864**DCL      3864--REDEF
F$DCB.LASTSTA$
      3854**DCL      3854--REDEF    4684>>IF       4687>>ASSIGN   4687>>ASSIGN   4726>>ASSIGN   4726>>ASSIGN
F$DCB.LINES
      3866**DCL      4948>>IF       4952>>IF       4962>>IF       4964>>IF       4965>>ASSIGN   4971>>IF
      4979>>IF       4985>>IF       4994>>IF       5003>>IF       5007>>IF       5009>>ASSIGN   5045>>IF
      5054>>IF       5537>>IF       5540>>IF       5551>>IF       5553>>IF       5554>>ASSIGN   5560>>IF
      5569>>IF       5576>>IF       5582>>IF       5586>>IF       5587>>IF       5589>>ASSIGN   5632>>IF
F$DCB.LSTAOR
      3857**DCL      4725>>IF
F$DCB.LVL
      3879**DCL      3879--REDEF
F$DCB.MEDIA
      3885**DCL      4571>>DOCASE   4593>>IF       4640>>DOCASE   4756>>DOCASE   4768>>DOCASE   5096>>IF
      5157>>DOCASE   5223>>IF       5249>>DOCASE   5468>>DOCASE
F$DCB.NAME.C
      3854**DCL      3854--REDEF
F$DCB.NOEOF
      3875**DCL      3875--REDEF
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:252  
F$DCB.NRECS
      3865**DCL      3865--REDEF
F$DCB.NRECX
      3884**DCL      3884--REDEF
F$DCB.OHDR
      3876**DCL      3876--REDEF
F$DCB.ORG
      3859**DCL      3859--REDEF    4564>>IF       4568>>IF       4568>>IF       4628>>IF       4628>>IF
F$DCB.PGINGRAN
      3885**DCL      4885<<ASSIGN   4885>>ASSIGN   5091<<ASSIGN   5091>>ASSIGN   5267<<ASSIGN   5267>>ASSIGN
      5355<<ASSIGN   5355>>ASSIGN   5527<<ASSIGN   5527>>ASSIGN   5597<<ASSIGN   5597>>ASSIGN   5653<<ASSIGN
      5653>>ASSIGN   5718<<ASSIGN   5718>>ASSIGN
F$DCB.PRECNO
      3882**DCL      3882--REDEF
F$DCB.RCSZ
      3887**DCL      3887--REDEF
F$DCB.RES
      3855**DCL      3855--REDEF
F$DCB.SETSTA$
      3854**DCL      4647>>CALL     4775>>CALL     5184>>CALL     5270>>CALL
F$DCB.SETX
      3867**DCL      3867--REDEF
F$DCB.STR
      3883**DCL      4585<<ASSIGN   4587<<ASSIGN   4587>>ASSIGN   4632<<ASSIGN   4634<<ASSIGN   4634>>ASSIGN
      4753<<ASSIGN
F$DCB.TAB$
      3866**DCL      3867--REDEF    5403>>ASSIGN   5405>>ASSIGN   5409>>IF       5411>>ASSIGN   5420>>IF
      5423>>ASSIGN   5485>>ASSIGN
F$DCB.TDA
      3881**DCL      3881--REDEF
F$DCB.TYC
      3845**DCL      4588<<ASSIGN   4636<<ASSIGN   4689<<ASSIGN   4689>>ASSIGN   4689>>ASSIGN   4691<<ASSIGN
      4691>>ASSIGN   4691>>ASSIGN   4693<>CALL     4728<<ASSIGN   4728>>ASSIGN   4728>>ASSIGN   4731<>CALL
      4734<<ASSIGN   4734>>ASSIGN   4734>>ASSIGN
F$DCB.TYC.EOF
      3846**DCL      4604<<ASSIGN
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:253  
F$DCB.UB$
      3883**DCL      4590<<ASSIGN   4590>>ASSIGN   4637<<ASSIGN   4637>>ASSIGN   5055>>ASSIGN   5061<<ASSIGN
      5117>>CALLBLT  5123>>IF       5139<<ASSIGN   5288>>ASSIGN   5289<<ASSIGN   5289>>ASSIGN   5379>>ASSIGN
      5381<<ASSIGN   5391<<ASSIGN   5429>>ASSIGN   5431<<ASSIGN   5438<<ASSIGN   5447>>ASSIGN   5449<<ASSIGN
      5451>>IF       5453<<ASSIGN   5453--ASSIGN   5457>>ASSIGN   5458<<ASSIGN   5483>>ASSIGN   5485<<ASSIGN
      5486>>IF       5487<<ASSIGN   5491>>ASSIGN   5493<<ASSIGN   5514>>ASSIGN   5515<<ASSIGN   5515>>ASSIGN
      5674>>CALLBLT  5680>>IF       5691<<ASSIGN   5737>>ASSIGN   5739<<ASSIGN   5745<<ASSIGN
F$DCB.UBYTES
      3883**DCL      4591<<ASSIGN   4591>>ASSIGN   4638<<ASSIGN   4638>>ASSIGN   5056>>ASSIGN   5057<<ASSIGN
      5060<<ASSIGN   5104>>IF       5105>>IF       5116>>ASSIGN   5117<<CALLBLT  5119<<ASSIGN   5119>>ASSIGN
      5121<<ASSIGN   5123>>IF       5125<<ASSIGN   5125>>ASSIGN   5126>>IF       5140<<ASSIGN   5290<<ASSIGN
      5290>>ASSIGN   5380>>ASSIGN   5382<<ASSIGN   5392<<ASSIGN   5430>>ASSIGN   5432<<ASSIGN   5439<<ASSIGN
      5448>>ASSIGN   5450<<ASSIGN   5452<<ASSIGN   5459<<ASSIGN   5484>>ASSIGN   5488<<ASSIGN   5494<<ASSIGN
      5516<<ASSIGN   5516>>ASSIGN   5661>>IF       5662>>IF       5673>>ASSIGN   5674<<CALLBLT  5676<<ASSIGN
      5676>>ASSIGN   5678<<ASSIGN   5680>>IF       5682<<ASSIGN   5682>>ASSIGN   5683>>IF       5692<<ASSIGN
      5738>>ASSIGN   5740<<ASSIGN   5746<<ASSIGN
F$DCB.UCOUT
      3880**DCL      4569>>IF
F$DCB.VFCCHAR
      3869**DCL      5201<<ASSIGN
F$DCB.WAIT
      3877**DCL      4589<<ASSIGN   4604>>ASSIGN   4646<<ASSIGN   4651<<ASSIGN   4651>>ASSIGN   4654>>IF
      4667<<ASSIGN   4688>>IF       4727>>IF       4779<<ASSIGN   4779>>ASSIGN   4782>>IF
F$DCB.WSN
      3856**DCL      3856--REDEF
FCN IN PROCEDURE MEDIUMEP
      5753**DCL      5751--PROC     5759<>CALL     5763<>CALL
FINDLINE
      5300**PROC     4947--CALL     4950--CALL     4984--CALL
FMF$REMOTE
      4197**DCL-ENT  5202--CALL
FMH$CPMME
      4194**DCL-ENT  5759--CALL
FMH$SYMB
      4195**DCL-ENT  4797--CALL     5182--CALL     5268--CALL
FMO$GETDOMAIN
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:254  
      4209**DCL-ENT  4707--CALL
FMO$GETPFB
      4210**DCL-ENT  4582--CALL     4629--CALL     4750--CALL
FORM$
      4391**DCL      4253--IMP-PTR  4940<<ASSIGN   4944>>ASSIGN   4945>>ASSIGN   4954>>ASSIGN   4957>>ASSIGN
      4958>>ASSIGN   4962>>IF       4963>>IF       4964>>IF       4965>>ASSIGN   4971>>IF       4976>>ASSIGN
      4976>>ASSIGN   4977>>ASSIGN   4979>>IF       4983>>ASSIGN   4987>>ASSIGN   4987>>ASSIGN   4990>>ASSIGN
      4994>>IF       5001>>ASSIGN   5003>>IF       5007>>IF       5007>>IF       5009>>ASSIGN   5014>>ASSIGN
      5014>>ASSIGN   5017>>ASSIGN   5017>>ASSIGN   5034>>ASSIGN   5034>>ASSIGN   5044>>IF       5045>>IF
      5050>>ASSIGN   5050>>ASSIGN   5053>>IF       5054>>IF       5063>>ASSIGN   5063>>ASSIGN   5306>>ASSIGN
      5314>>IF       5315>>ASSIGN   5316>>ASSIGN   5319>>ASSIGN   5329>>ASSIGN   5329>>ASSIGN   5341>>ASSIGN
      5341>>ASSIGN   5354>>ASSIGN   5354>>ASSIGN   5356>>ASSIGN   5366>>ASSIGN   5366>>ASSIGN   5481<<ASSIGN
      5491>>ASSIGN   5508>>ASSIGN   5508>>ASSIGN   5526>>ASSIGN   5526>>ASSIGN   5528>>ASSIGN   5530>>ASSIGN
      5543>>ASSIGN   5546>>ASSIGN   5547>>ASSIGN   5550>>ASSIGN   5552>>IF       5553>>IF       5554>>ASSIGN
      5556>>ASSIGN   5559>>ASSIGN   5563>>ASSIGN   5566>>ASSIGN   5567>>ASSIGN   5569>>IF       5572>>ASSIGN
      5575>>ASSIGN   5577>>ASSIGN   5577>>ASSIGN   5579>>ASSIGN   5582>>IF       5585>>ASSIGN   5586>>IF
      5587>>IF       5587>>IF       5589>>ASSIGN   5593>>ASSIGN   5593>>ASSIGN   5596>>ASSIGN   5596>>ASSIGN
      5598>>ASSIGN   5602>>ASSIGN   5602>>ASSIGN   5604>>ASSIGN   5604>>ASSIGN   5607>>ASSIGN   5607>>ASSIGN
      5623>>ASSIGN   5623>>ASSIGN   5631>>IF       5632>>IF       5635>>ASSIGN   5635>>ASSIGN   5638>>IF
      5639>>ASSIGN   5639>>ASSIGN   5649>>ASSIGN   5649>>ASSIGN   5705>>ASSIGN   5707>>IF       5708>>ASSIGN
      5709>>ASSIGN   5712>>ASSIGN   5717>>ASSIGN   5717>>ASSIGN   5722>>ASSIGN   5725>>ASSIGN   5727>>ASSIGN
      5727>>ASSIGN
FORMATIT
      4893**PROC     4504--CALL     4508--CALL
FPRGFORMATIT IN PROCEDURE TTYFORMATIT
      4874**ENTRY    4523--CALL     4528--CALL
FPT IN PROCEDURE MEDIUMEP
      5754**DCL      5751--PROC     5759<>CALL     5763<>CALL
FPTCODE
        19**DCL        18--PROC     4502--ENTRY    4506--ENTRY    4511--ENTRY    4516--ENTRY    4521--ENTRY
      4526--ENTRY    4531--ENTRY    4536--ENTRY    4543--ENTRY    4562>>DOCASE   4592>>IF       4595<>CALL
      4754>>DOCASE   5466--ENTRY    5475>>IF       5477<>CALL
FPTV
       247**DCL        18--PROC     4502--ENTRY    4506--ENTRY    4511--ENTRY    4516--ENTRY    4521--ENTRY
      4526--ENTRY    4531--ENTRY    4536--ENTRY    4543--ENTRY    4595--CALL     4652--CALL     4698--IF
      4698--IF       4698--IF       4698--IF       4698--IF       4780--CALL     4797<>CALL     4810--IF
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:255  
      4810--IF       4810--IF       4810--IF       4810--IF       5159>>ASSIGN   5187--IF       5268<>CALL
      5274--CALL     5466--ENTRY    5477<>CALL     5480>>ASSIGN   5509<>CALL
FPTV.DVBYTE
       248**DCL      4647<>CALL     4652<>CALL     4668<>CALL     4770<>CALL     4775<>CALL     4780<>CALL
      4794<>CALL     5222>>ASSIGN   5496>>ASSIGN
FPTV.DVBYTE.VFC
       249**DCL       249--REDEF
FPTV.EVENT
       248**DCL      4647<>CALL     4652<>CALL     4668<>CALL     4690>>IF       4693<>CALL     4730>>IF
      4731<>CALL     4770<>CALL     4775<>CALL     4780<>CALL     4794<>CALL     5184<>CALL     5190<>CALL
      5192<>CALL     5194<>CALL     5270<>CALL     5274<>CALL     5277<>CALL     5280<>CALL
FPTV$ IN PROCEDURE MEDIUM
      5155**DCL      5190<>CALL
FPTV$$ IN PROCEDURE MEDIUM
      5154**DCL      5155--IMP-PTR  5188<<ASSIGN   5189<<ASSIGN   5190>>CALL
FPTVI
      4436**DCL      5159<<ASSIGN   5182<>CALL     5480<<ASSIGN   5490<>CALL     5657<>CALL     5687<>CALL
      5742<>CALL
FPTVI.DVBYTE
      4437**DCL      5160<<ASSIGN   5489<<ASSIGN   5656<<ASSIGN   5686<<ASSIGN   5741<<ASSIGN
FPTVI.DVBYTE.VFC
      4438**DCL      4438--REDEF
FPTVI.REWRITE
      4437**DCL      5660>>IF
FSB$SWITCH
      4208**DCL-ENT  5208--CALL     5296--CALL
FSD$C1
      4204**DCL-ENT  4611--CALL
FSD$C1END
      4205**DCL-ENT  4616--CALL
FSD$REW
      4206**DCL-ENT  4709--CALL
FTW$WRAT
      4203**DCL-ENT  5763--CALL
F_DCBLOCK
      4222**DCL      4657<>CALL     4662<>CALL     4785<>CALL     4789<>CALL
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:256  
GRFORMATIT IN PROCEDURE TTYFORMATIT
      4879**ENTRY    4513--CALL     4518--CALL
HDR$
      4393**DCL      4285--IMP-PTR  4301--IMP-PTR  4996>>IF       5348<<ASSIGN   5349>>IF       5350<<ASSIGN
      5351>>IF       5352<<ASSIGN   5356>>ASSIGN   5365>>IF       5369>>ASSIGN   5372>>IF       5373>>ASSIGN
      5373>>ASSIGN   5373>>ASSIGN   5374>>ASSIGN   5377>>CALLBLT  5377>>CALLBLT  5381>>ASSIGN   5382>>ASSIGN
      5384>>CALL     5388>>CALL     5541>>IF       5561>>IF       5719<<ASSIGN   5720>>IF       5725>>ASSIGN
      5726>>IF       5730>>ASSIGN   5732>>IF       5733>>ASSIGN   5735>>CALLBLT  5735>>CALLBLT  5739>>ASSIGN
      5740>>ASSIGN   5742>>CALL
HFC$LOCK
      3996**DCL-ENT  4657--CALL     4785--CALL
HFC$UNLOCK
      3996**DCL-ENT  4662--CALL     4789--CALL
I
      4404**DCL      4430--IMP-SIZ  4582<>CALL     4585>>ASSIGN   4629<>CALL     4632>>ASSIGN   4707<>CALL
      4708>>IF       4750<>CALL     4753>>ASSIGN   4948>>IF       4952>>IF       4954<<ASSIGN   4957>>ASSIGN
      4985>>IF       4990>>ASSIGN   5116<<ASSIGN   5117>>CALLBLT  5306<<ASSIGN   5307>>IF       5314>>IF
      5316<<ASSIGN   5319<<ASSIGN   5533>>IF       5537>>IF       5540>>IF       5543<<ASSIGN   5546>>ASSIGN
      5550<<ASSIGN   5551>>IF       5556<<ASSIGN   5559<<ASSIGN   5560>>IF       5563<<ASSIGN   5566>>ASSIGN
      5574>>IF       5575<<ASSIGN   5576>>IF       5579>>ASSIGN   5673<<ASSIGN   5674>>CALLBLT  5705<<ASSIGN
      5706>>IF       5707>>IF       5709<<ASSIGN   5712<<ASSIGN
J
      4403**DCL      5117<<CALLBLT  5304<<ASSIGN   5305>>IF       5306>>ASSIGN   5315<<ASSIGN   5315>>ASSIGN
      5316>>ASSIGN   5317>>IF       5366<<ASSIGN   5367>>ASSIGN   5368>>DOWHILE  5368<<ASSIGN   5368>>ASSIGN
      5369<<ASSIGN   5370>>IF       5370<<ASSIGN   5371>>DOWHILE  5372>>IF       5374>>ASSIGN   5377>>CALLBLT
      5414<<ASSIGN   5415>>DOWHILE  5416--ASSIGN   5426<<ASSIGN   5426>>ASSIGN   5674<<CALLBLT  5703<<ASSIGN
      5704>>IF       5705>>ASSIGN   5708<<ASSIGN   5708>>ASSIGN   5709>>ASSIGN   5710>>IF       5727<<ASSIGN
      5728>>ASSIGN   5729>>DOWHILE  5729<<ASSIGN   5729>>ASSIGN   5730<<ASSIGN   5731>>DOWHILE  5732>>IF
      5733>>ASSIGN   5735>>CALLBLT
K
      4405**DCL      5367<<ASSIGN   5371<<ASSIGN   5371>>ASSIGN   5377>>CALLBLT  5728<<ASSIGN   5731<<ASSIGN
      5731>>ASSIGN   5735>>CALLBLT
KCI$RWCG
      4201**DCL-ENT  4647--CALL     4775--CALL     5184--CALL     5270--CALL
KIA$UCIO
      4198**DCL-ENT  4595--CALL     4652--CALL     4780--CALL     5190--CALL     5274--CALL
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:257  
KIS$OSI_READ
      4199**DCL-ENT  4800--CALL
KIS$OSI_WRITE
      4200**DCL-ENT  5197--CALL
L
      4406**DCL      5367<<ASSIGN   5368<<ASSIGN   5368>>ASSIGN   5371>>DOWHILE  5371<<ASSIGN   5371>>ASSIGN
      5372>>IF       5374>>ASSIGN   5376>>IF       5377>>CALLBLT  5728<<ASSIGN   5729<<ASSIGN   5729>>ASSIGN
      5731>>DOWHILE  5731<<ASSIGN   5731>>ASSIGN   5732>>IF       5733>>ASSIGN   5734>>IF       5735>>CALLBLT
LOOP IN PROCEDURE FINDLINE
      5307**LABEL    5317--GOTO
LOOP IN PROCEDURE URFILFINDLINE
      5707**LABEL    5710--GOTO
MEDDCB$
      4390**DCL      4568<<ASSIGN   4569<<ASSIGN   4570<<ASSIGN   4571>>DOCASE   4575<<ASSIGN   4581>>ASSIGN
      4585>>ASSIGN   4587>>ASSIGN   4588>>ASSIGN   4589>>ASSIGN   4590>>ASSIGN   4591>>ASSIGN   4593>>IF
      4605<<ASSIGN   4613<<ASSIGN   4622<<ASSIGN   4627<<ASSIGN   4628<<ASSIGN   4632>>ASSIGN   4634>>ASSIGN
      4635>>ASSIGN   4636>>ASSIGN   4637>>ASSIGN   4638>>ASSIGN   4639>>ASSIGN   4640>>DOCASE   4646>>ASSIGN
      4651>>ASSIGN   4660>>ASSIGN   4660>>ASSIGN   4667>>ASSIGN   4677>>ASSIGN   4722>>ASSIGN   4725>>IF
      4749<<ASSIGN   4753>>ASSIGN   4756>>DOCASE   4767>>ASSIGN   4768>>DOCASE   4779>>ASSIGN   4787>>ASSIGN
      4787>>ASSIGN   4833>>IF       4881>>ASSIGN   4881>>ASSIGN   4884>>ASSIGN   4884>>ASSIGN   4885>>ASSIGN
      4885>>ASSIGN   4904>>IF       4932>>IF       4939>>IF       4940>>ASSIGN   5055>>ASSIGN   5056>>ASSIGN
      5057>>ASSIGN   5060>>ASSIGN   5061>>ASSIGN   5075>>IF       5086>>ASSIGN   5086>>ASSIGN   5091>>ASSIGN
      5091>>ASSIGN   5095>>ASSIGN   5096>>IF       5104>>IF       5105>>IF       5116>>ASSIGN   5117>>CALLBLT
      5117>>CALLBLT  5119>>ASSIGN   5119>>ASSIGN   5121>>ASSIGN   5123>>IF       5123>>IF       5125>>ASSIGN
      5125>>ASSIGN   5126>>IF       5129>>IF       5139>>ASSIGN   5140>>ASSIGN   5157>>DOCASE   5161>>IF
      5161>>IF       5166>>IF       5168>>IF       5170>>IF       5170>>IF       5173>>IF       5173>>IF
      5176>>IF       5176>>IF       5200>>ASSIGN   5201>>ASSIGN   5223>>IF       5249>>DOCASE   5251>>IF
      5262>>ASSIGN   5262>>ASSIGN   5267>>ASSIGN   5267>>ASSIGN   5288>>ASSIGN   5289>>ASSIGN   5289>>ASSIGN
      5290>>ASSIGN   5290>>ASSIGN   5350>>ASSIGN   5355>>ASSIGN   5355>>ASSIGN   5361>>IF       5379>>ASSIGN
      5380>>ASSIGN   5381>>ASSIGN   5382>>ASSIGN   5383>>IF       5391>>ASSIGN   5392>>ASSIGN   5399>>IF
      5405>>ASSIGN   5409>>IF       5410>>ASSIGN   5411>>ASSIGN   5411>>ASSIGN   5413>>IF       5418>>IF
      5421>>ASSIGN   5429>>ASSIGN   5430>>ASSIGN   5431>>ASSIGN   5432>>ASSIGN   5433>>IF       5436>>IF
      5437>>ASSIGN   5438>>ASSIGN   5439>>ASSIGN   5447>>ASSIGN   5448>>ASSIGN   5449>>ASSIGN   5450>>ASSIGN
      5451>>IF       5452>>ASSIGN   5453>>ASSIGN   5453>>ASSIGN   5457>>ASSIGN   5458>>ASSIGN   5459>>ASSIGN
MEDIUM
      5149**PROC     4533--CALL     4868--CALL     5058--CALL     5099--CALL     5130--CALL     5133--CALL
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:258  
      5384--CALL     5388--CALL     5434--CALL     5455--CALL
MEDIUMEP
      5751**PROC     5477--CALL     5490--CALL     5509--CALL     5657--CALL     5687--CALL     5742--CALL
MEDIUMX
      4394**DCL      5469<<ASSIGN   5470<<ASSIGN   5757>>DOCASE
MFC IN PROCEDURE MEDIUM
      5150**DCL      5149--PROC     5184<>CALL     5190<>CALL     5192<>CALL     5194<>CALL
MORESPA
      5522**LABEL    5693--GOTO
MORESPA IN PROCEDURE FORMATIT
      4903**LABEL    5141--GOTO
NK$VFC.COUNT
      4426**DCL      4840>>DOCASE   4908>>DOCASE   4944>>ASSIGN   4945>>ASSIGN   4960>>ASSIGN   4967<<ASSIGN
      4992>>ASSIGN   5005<<ASSIGN   5019>>DOCASE   5138<<ASSIGN   5304>>ASSIGN   5528>>ASSIGN   5530>>ASSIGN
      5549>>ASSIGN   5581>>ASSIGN   5592<<ASSIGN   5592>>ASSIGN   5609>>DOCASE   5690<<ASSIGN   5703>>ASSIGN
NK$VFC.FCN
      4426**DCL      4837>>DOCASE   4905>>DOCASE   4941>>DOCASE   4997<<ASSIGN   5004>>IF       5137<<ASSIGN
      5307>>DOCASE   5524>>DOCASE
NKA$DEVIO
      4196**DCL-ENT  4770--CALL     5194--CALL     5280--CALL
NKA$EVENT
      4207**DCL-ENT  4693--CALL     4731--CALL
NK_URTBL_BP
      4382**DCL      5117>>CALLBLT  5123>>IF       5674>>CALLBLT  5680>>IF
NSTRMPREP
      4739**PROC     4507--CALL     4517--CALL     4527--CALL     4532--CALL     4544--CALL
NSTRMXIT
      4544**LABEL    4503--CALLALT  4507--CALLALT  4509--GOTO     4512--CALLALT  4517--CALLALT  4519--GOTO
      4522--CALLALT  4527--CALLALT  4529--GOTO     4532--CALLALT  4534--GOTO     4537--CALLALT  4541--GOTO
      4544--CALLALT
NULLHDR
      4331**DCL      4996--IF       5352--ASSIGN
OCU$RWUC
      4202**DCL-ENT  4668--CALL     4794--CALL     5192--CALL     5277--CALL
PRECORDFPT.BOF
       253**DCL      4698>>IF       4810>>IF
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:259  
PRECORDFPT.EOF
       253**DCL      4698>>IF       4810>>IF
PRECORDFPT.KEYR
       253**DCL      4698>>IF       4810>>IF
PRECORDFPT.KEYS
       253**DCL      4698>>IF       4810>>IF
PRECORDFPT.N
       254**DCL      4698>>IF       4810>>IF
PREPWRITE
      5212**PROC     4830--CALL     4875--CALL     4880--CALL     4897--CALL
RETUR IN PROCEDURE FORMATIT
      5136**LABEL    4943--CALLALT  4949--CALLALT  4969--CALLALT  4980--CALLALT  4995--CALLALT  5021--GOTO
      5025--GOTO     5027--GOTO     5029--GOTO     5031--GOTO     5035--GOTO     5037--GOTO     5080--GOTO
RETUR IN PROCEDURE PREPWRITE
      5277**LABEL    5256--GOTO
SAVEUB$
      4408**DCL      5055<<ASSIGN   5061>>ASSIGN   5379<<ASSIGN   5391>>ASSIGN   5416<<ASSIGN   5417>>IF
      5418>>IF       5418>>IF       5420>>IF       5421>>ASSIGN   5423>>ASSIGN   5423>>ASSIGN   5429<<ASSIGN
      5438>>ASSIGN   5447<<ASSIGN   5458>>ASSIGN   5483<<ASSIGN   5493>>ASSIGN   5737<<ASSIGN   5745>>ASSIGN
SAVEUBT
      4409**DCL      5056<<ASSIGN   5060>>ASSIGN   5380<<ASSIGN   5392>>ASSIGN   5430<<ASSIGN   5439>>ASSIGN
      5448<<ASSIGN   5459>>ASSIGN   5484<<ASSIGN   5494>>ASSIGN   5738<<ASSIGN   5746>>ASSIGN
SC_FSBADDCB
      4211**DCL-ENT  4578--CALL     4671--CALL     4763--CALL     4803--CALL
SETHEADER
      5323**PROC     4943--CALL     4949--CALL     4969--CALL     4980--CALL     4995--CALL
STREAMEND
      4720**PROC     4540--CALL
STREAMPREP
      4550**PROC     4503--CALL     4512--CALL     4522--CALL     4537--CALL
STREAMWRT IN PROCEDURE STREAMPREP
      4564**LABEL    4565--GOTO
STRMXIT
      4533**LABEL    4505--GOTO     4514--GOTO     4524--GOTO
SYMB_MFC IN PROCEDURE MEDIUM
      5151**DCL      5165<<ASSIGN   5167<<ASSIGN   5169<<ASSIGN   5172<<ASSIGN   5175<<ASSIGN   5178<<ASSIGN
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:260  
      5180<<ASSIGN   5182<>CALL
TAB$
      4392**DCL      4271--IMP-PTR  4393--REDEF    5403<<ASSIGN   5404>>IF       5405<<ASSIGN   5406>>IF
      5407<<ASSIGN   5410>>ASSIGN   5411>>ASSIGN   5423>>ASSIGN   5431>>ASSIGN   5437>>ASSIGN
TABZERO
      4317**DCL      5407--ASSIGN   5410>>ASSIGN   5487--ASSIGN
TRS1SPA IN PROCEDURE FORMATIT
      4992**LABEL    5067--GOTO
TTYFORMATIT
      4825**PROC     4538--CALL     4545--CALL
URFILFINDLINE
      5699**PROC     5532--CALL     5539--CALL     5573--CALL
URFILHDR
      5716**PROC     5538--CALL     5558--CALL     5570--CALL     5583--CALL
USRDCB$
      4389**DCL      4561<<ASSIGN   4564>>IF       4568>>IF       4568>>IF       4568>>ASSIGN   4569>>IF
      4570>>ASSIGN   4575>>ASSIGN   4583>>IF       4587>>ASSIGN   4590>>ASSIGN   4591>>ASSIGN   4598>>IF
      4601>>ASSIGN   4602>>ASSIGN   4604>>ASSIGN   4604>>ASSIGN   4605>>ASSIGN   4608>>ASSIGN   4608>>ASSIGN
      4609>>ASSIGN   4613>>ASSIGN   4622>>ASSIGN   4627>>ASSIGN   4628>>IF       4628>>IF       4628>>ASSIGN
      4630>>IF       4634>>ASSIGN   4637>>ASSIGN   4638>>ASSIGN   4643>>ASSIGN   4647>>CALL     4651>>ASSIGN
      4654>>IF       4659>>ASSIGN   4659>>ASSIGN   4672>>ASSIGN   4676>>ASSIGN   4679>>ASSIGN   4680>>ASSIGN
      4681>>ASSIGN   4682>>ASSIGN   4683>>ASSIGN   4684>>IF       4687>>ASSIGN   4688>>IF       4689>>ASSIGN
      4689>>ASSIGN   4691>>ASSIGN   4691>>ASSIGN   4706>>IF       4721>>ASSIGN   4726>>ASSIGN   4727>>IF
      4728>>ASSIGN   4728>>ASSIGN   4734>>ASSIGN   4734>>ASSIGN   4748<<ASSIGN   4749>>ASSIGN   4751>>IF
      4775>>CALL     4779>>ASSIGN   4782>>IF       4826>>IF       4828>>IF       4894>>IF       4896>>ASSIGN
      4932>>IF       4932>>IF       4935>>IF       4948>>IF       4952>>IF       4962>>IF       4964>>IF
      4965>>ASSIGN   4971>>IF       4979>>IF       4985>>IF       4994>>IF       5003>>IF       5007>>IF
      5009>>ASSIGN   5045>>IF       5054>>IF       5184>>CALL     5223>>IF       5245>>IF       5270>>CALL
      5293>>ASSIGN   5324>>IF       5348>>ASSIGN   5403>>ASSIGN   5413>>IF       5413>>IF       5446>>ASSIGN
      5449>>ASSIGN   5467<<ASSIGN   5468>>DOCASE   5481>>ASSIGN   5482>>IF       5483>>ASSIGN   5484>>ASSIGN
      5485>>ASSIGN   5485>>ASSIGN   5486>>IF       5487>>ASSIGN   5488>>ASSIGN   5491>>ASSIGN   5492>>ASSIGN
      5493>>ASSIGN   5494>>ASSIGN   5503>>IF       5514>>ASSIGN   5515>>ASSIGN   5515>>ASSIGN   5516>>ASSIGN
      5516>>ASSIGN   5519>>ASSIGN   5523>>IF       5527>>ASSIGN   5527>>ASSIGN   5537>>IF       5540>>IF
      5551>>IF       5553>>IF       5554>>ASSIGN   5560>>IF       5569>>IF       5576>>IF       5582>>IF
      5586>>IF       5587>>IF       5589>>ASSIGN   5591>>IF       5597>>ASSIGN   5597>>ASSIGN   5632>>IF
      5653>>ASSIGN   5653>>ASSIGN   5661>>IF       5662>>IF       5673>>ASSIGN   5674>>CALLBLT  5674>>CALLBLT
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:261  
      5676>>ASSIGN   5676>>ASSIGN   5678>>ASSIGN   5680>>IF       5680>>IF       5682>>ASSIGN   5682>>ASSIGN
      5683>>IF       5691>>ASSIGN   5692>>ASSIGN   5718>>ASSIGN   5718>>ASSIGN   5719>>ASSIGN   5737>>ASSIGN
      5738>>ASSIGN   5739>>ASSIGN   5740>>ASSIGN   5745>>ASSIGN   5746>>ASSIGN
USRDVBYTE
      4397**DCL      4835<<ASSIGN   4835>>ASSIGN   4842<<ASSIGN   4842>>ASSIGN   4847<<ASSIGN   4847>>ASSIGN
      4849>>IF       4853<<ASSIGN   4853>>ASSIGN   4876<<ASSIGN   4876>>ASSIGN   4902<<ASSIGN   4902>>ASSIGN
      4910<<ASSIGN   4910>>ASSIGN   4915<<ASSIGN   4915>>ASSIGN   4934<<ASSIGN   4934>>ASSIGN   5023<<ASSIGN
      5023>>ASSIGN   5093>>IF       5098<<ASSIGN   5098>>ASSIGN   5099<>CALL     5103>>IF       5222<<ASSIGN
      5226>>IF       5228<<ASSIGN   5228>>ASSIGN   5239>>IF       5240>>IF       5287>>IF       5496<<ASSIGN
      5497>>IF       5498>>IF       5512>>IF       5520<<ASSIGN   5520>>ASSIGN   5529<<ASSIGN   5529>>ASSIGN
      5613<<ASSIGN   5613>>ASSIGN   5655>>IF       5660>>IF       5721<<ASSIGN   5721>>ASSIGN
USRDVBYTE.GOOD
      4398**DCL      4868<>CALL     5130<>CALL     5133<>CALL     5270<>CALL     5274<>CALL     5277<>CALL
      5280<>CALL     5656>>ASSIGN   5686>>ASSIGN
UVFCLINES
      4407**DCL      4960<<ASSIGN   4962>>IF       4965<<ASSIGN   4965>>ASSIGN   4967>>ASSIGN   4971>>IF
      4972<<ASSIGN   4976>>ASSIGN   4992<<ASSIGN   4996>>IF       5001>>ASSIGN   5003>>IF       5009>>ASSIGN
      5017>>ASSIGN   5043<<ASSIGN   5047<<ASSIGN   5066<<ASSIGN   5309<<ASSIGN   5311<<ASSIGN   5534<<ASSIGN
      5549<<ASSIGN   5550>>ASSIGN   5554<<ASSIGN   5554>>ASSIGN   5556>>ASSIGN   5559>>ASSIGN   5581<<ASSIGN
      5585>>ASSIGN   5586>>IF       5589>>ASSIGN   5607>>ASSIGN   5630<<ASSIGN   5633<<ASSIGN   5640<<ASSIGN
VFC IN PROCEDURE MEDIUMEP
      5755**DCL      5751--PROC     5759<>CALL     5763<>CALL
VFCC IN PROCEDURE MEDIUM
      5153**DCL      5149--PROC     5182<>CALL     5184<>CALL     5187--IF       5190<>CALL     5192<>CALL
      5194<>CALL     5201>>ASSIGN
VFCCHAR
      4410**DCL      4422--REDEF    4868<>CALL     4882>>IF       4888<<ASSIGN   4953<<ASSIGN   4973<<ASSIGN
      4986<<ASSIGN   5012<<ASSIGN   5033<<ASSIGN   5042<<ASSIGN   5046<<ASSIGN   5065<<ASSIGN   5099<>CALL
      5130<>CALL     5133<>CALL     5187--IF       5288<<ASSIGN   5293<<ASSIGN   5309<<ASSIGN   5311<<ASSIGN
      5514<<ASSIGN   5519<<ASSIGN   5542<<ASSIGN   5562<<ASSIGN   5657<>CALL     5687<>CALL
VLP$HDR.CTL.COUNT#
      4287**DCL      5365>>IF       5369>>ASSIGN   5726>>IF       5730>>ASSIGN
VLP$HDR.CTL.HEADERHEIGHT#
      4286**DCL      5356>>ASSIGN   5384>>CALL     5388>>CALL     5725>>ASSIGN   5742>>CALL
VLP$HDR.CTL.RESETPAGE#
      4285**DCL      5457<<ASSIGN
PL6.E3A0      #001=FSE$FORMAT File=FSE$FORMAT.:E05TSI                            TUE 07/29/97 17:29 Page:262  
VLP$HDR.TITL.L#
      4287**DCL      4288--IMP-SIZ  5372>>IF       5373>>ASSIGN   5374<<ASSIGN   5377>>CALLBLT  5382>>ASSIGN
      5732>>IF       5733<<ASSIGN   5735>>CALLBLT  5740>>ASSIGN
VLP$HDR.TITL.TITLE#
      4288**DCL      5373>>ASSIGN   5377<<CALLBLT  5381--ASSIGN   5735<<CALLBLT  5739--ASSIGN
VLP$HDRF
      4301**DCL      5450--ASSIGN
VLP$HDRF.TITL.TITLE#
      4304**DCL      5373<<ASSIGN
VLP$TAB
      4271**DCL      5410>>ASSIGN   5411>>ASSIGN   5411>>ASSIGN   5423>>ASSIGN   5423>>ASSIGN   5432--ASSIGN
      5437>>ASSIGN   5488--ASSIGN   5491>>ASSIGN
VSST
      4230**DCL      4647<>CALL     4775<>CALL     5184<>CALL     5270<>CALL
VSTA
      4242**DCL      4687<<ASSIGN   4687>>ASSIGN   4726<<ASSIGN   4726>>ASSIGN
VSTA.MSGIDXT
      4248**DCL      4250--REDEF
WRTIT IN PROCEDURE TTYFORMATIT
      4863**LABEL    4877--GOTO     4890--GOTO

PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:263  
     1474        1        /*T***********************************************************/
     1475        2        /*T*                                                         */
     1476        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1477        4        /*T*                                                         */
     1478        5        /*T***********************************************************/
     1479        6        /*F*    NAME: FSE$GETGRAN
     1480        7                PURPOSE: FSE$GETGRAN is the granule getter for SYMBIONT files.
     1481        8                DESCRIPTION:  FSE$GETGRAN is just like FAF$GETGRAN (which it
     1482        9                   calls), except that it ALTRETs with JIT.ERR zero when it
     1483       10                   is time to break the symbiont output into another file.
     1484       11        */
     1485       12        /*D*    NAME: FSE$GETGRAN
     1486       13                CALL: CALL  FSE$GETGRAN(DA)ALTRET;
     1487       14                INTERFACE: FAF$GETGRAN
     1488       15                INPUT: DCB pointed to by B$JIT.DCB$.
     1489       16                OUTPUT: DA contains the disk address of another granule.
     1490       17        */
     1491       18        FSE$GETGRAN: PROC(DA)ALTRET;
     1492       19    1   DCL DA SBIN;
     1493       20        /***   DATA REFERENCES   ***/
     1494       21    1   DCL B$JIT$ PTR SYMREF;
     1495       22    1   DCL F$CFU$ PTR SYMREF;
     1496       23        /***   ENTRY REFERENCES   ***/
     1497       24    1   DCL FAF$GETGRAN ENTRY(1)ALTRET;
     1498       25        /***   INCLUDES, ETC.   ***/
     1499       26        %INCLUDE F$JIT_C;
     1500      456        %INCLUDE F$DCB;
     1501      505        %INCLUDE FM$MACROS;
     1502      880        %INCLUDE CP_6_SUBS;
     1503     1420        %FM$CFU(BASED="BASED(CFU$)");
     1504     1426        %FM$CFUEXT;
     1505     1430    1   DCL FSE_CHUNK UBIN STATIC SYMDEF INIT(1);
     1506     1431    1   DCL FSE_CHUNKSIZ UBIN STATIC SYMDEF INIT(70);
     1507     1432        /***   AUTOMATIC   ***/
     1508     1433    1   DCL CFU$ PTR;
     1509     1434        /**/
     1510     1435    1           CFU$=B$JIT.DCB$->F$DCB.CFU$;
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:264  
     1511     1436    1           IF FM$CFU.NGAVAL=0 THEN
     1512     1437    2              IF FM$CFU.UGRANS>=FSE_CHUNKSIZ THEN DO;
     1513     1438    2                 IF B$JIT.DCB$->F$DCB.ASN~=%FILE# AND
     1514     1439    3                   FSE_CHUNK~=0 THEN DO;
     1515     1440    3                    B$JIT.ERR='000000000005'O;
     1516     1441    3                    ALTRETURN;
     1517     1442    3                    END;
     1518     1443    2                 END;
     1519     1444    1           CALL FAF$GETGRAN(DA)ALTRET(ALTR);
     1520     1445    1           RETURN;
     1521     1446    1   ALTR:   ALTRETURN;
     1522     1447    1   END FSE$GETGRAN;

PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:265  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FSE$GETGRAN.

   Procedure FSE$GETGRAN requires 29 words for executable code.
   Procedure FSE$GETGRAN requires 6 words of local(AUTO) storage.

    No errors detected in file FSE$FORMAT.:E05TSI    .

PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:266  

 Object Unit name= FSE$GETGRAN                                File name= FSE$FORMAT.:E05TOU
 UTS= JUL 29 '97 17:31:38.88 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     2      2  FSE$GETGRAN
    1   Proc  even  none    29     35  FSE$GETGRAN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  FSE$GETGRAN

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  FSE_CHUNK                          0      1  FSE_CHUNKSIZ

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 FAF$GETGRAN
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:267  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                B_VECTNIL
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:268  


     1474        1        /*T***********************************************************/
     1475        2        /*T*                                                         */
     1476        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1477        4        /*T*                                                         */
     1478        5        /*T***********************************************************/
     1479        6        /*F*    NAME: FSE$GETGRAN
     1480        7                PURPOSE: FSE$GETGRAN is the granule getter for SYMBIONT files.
     1481        8                DESCRIPTION:  FSE$GETGRAN is just like FAF$GETGRAN (which it
     1482        9                   calls), except that it ALTRETs with JIT.ERR zero when it
     1483       10                   is time to break the symbiont output into another file.
     1484       11        */
     1485       12        /*D*    NAME: FSE$GETGRAN
     1486       13                CALL: CALL  FSE$GETGRAN(DA)ALTRET;
     1487       14                INTERFACE: FAF$GETGRAN
     1488       15                INPUT: DCB pointed to by B$JIT.DCB$.
     1489       16                OUTPUT: DA contains the disk address of another granule.
     1490       17        */
     1491       18        FSE$GETGRAN: PROC(DA)ALTRET;

     18  1 000000   000000 700200 xent  FSE$GETGRAN  TSX0  ! X66_AUTO_1
         1 000001   000006 000001                    ZERO    6,1

     1492       19    1   DCL DA SBIN;
     1493       20        /***   DATA REFERENCES   ***/
     1494       21    1   DCL B$JIT$ PTR SYMREF;
     1495       22    1   DCL F$CFU$ PTR SYMREF;
     1496       23        /***   ENTRY REFERENCES   ***/
     1497       24    1   DCL FAF$GETGRAN ENTRY(1)ALTRET;
     1498       25        /***   INCLUDES, ETC.   ***/
     1499       26        %INCLUDE F$JIT_C;
     1500      456        %INCLUDE F$DCB;
     1501      505        %INCLUDE FM$MACROS;
     1502      880        %INCLUDE CP_6_SUBS;
     1503     1420        %FM$CFU(BASED="BASED(CFU$)");
     1504     1426        %FM$CFUEXT;
     1505     1430    1   DCL FSE_CHUNK UBIN STATIC SYMDEF INIT(1);
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:269  
     1506     1431    1   DCL FSE_CHUNKSIZ UBIN STATIC SYMDEF INIT(70);
     1507     1432        /***   AUTOMATIC   ***/
     1508     1433    1   DCL CFU$ PTR;
     1509     1434        /**/
     1510     1435    1           CFU$=B$JIT.DCB$->F$DCB.CFU$;

   1435  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 471500                    LDP1    154,,PR0
         1 000004   100066 236100                    LDQ     54,,PR1
         1 000005   200004 756100                    STQ     CFU$,,AUTO

     1511     1436    1           IF FM$CFU.NGAVAL=0 THEN

   1436  1 000006   200004 473500                    LDP3    CFU$,,AUTO
         1 000007   300007 236100                    LDQ     7,,PR3
         1 000010   000032 316000 xsym               CANQ    B_VECTNIL+26
         1 000011   000027 601000 1                  TNZ     s:1444

     1512     1437    2              IF FM$CFU.UGRANS>=FSE_CHUNKSIZ THEN DO;

   1437  1 000012   300004 236100                    LDQ     4,,PR3
         1 000013   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000014   000001 116000 0                  CMPQ    FSE_CHUNKSIZ
         1 000015   000027 602000 1                  TNC     s:1444

     1513     1438    2                 IF B$JIT.DCB$->F$DCB.ASN~=%FILE# AND

   1438  1 000016   100032 236100                    LDQ     26,,PR1
         1 000017   777000 376007                    ANQ     -512,DL
         1 000020   001000 116007                    CMPQ    512,DL
         1 000021   000027 600000 1                  TZE     s:1444
         1 000022   000000 235000 0                  LDA     FSE_CHUNK
         1 000023   000027 600000 1                  TZE     s:1444

     1514     1439    3                   FSE_CHUNK~=0 THEN DO;

     1515     1440    3                    B$JIT.ERR='000000000005'O;
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:270  

   1440  1 000024   000007 236000 xsym               LDQ     B_VECTNIL+7
         1 000025   000012 756100                    STQ     10,,PR0

     1516     1441    3                    ALTRETURN;

   1441  1 000026   000000 702200 xent               TSX2  ! X66_AALT

     1517     1442    3                    END;
     1518     1443    2                 END;
     1519     1444    1           CALL FAF$GETGRAN(DA)ALTRET(ALTR);

   1444  1 000027   200003 630500                    EPPR0   @DA,,AUTO
         1 000030   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000031   000000 701000 xent               TSX1    FAF$GETGRAN
         1 000032   000034 702000 1                  TSX2    ALTR

     1520     1445    1           RETURN;

   1445  1 000033   000000 702200 xent               TSX2  ! X66_ARET

     1521     1446    1   ALTR:   ALTRETURN;

   1446  1 000034   000000 702200 xent  ALTR         TSX2  ! X66_AALT

FSE_CHUNK
 Sect OctLoc
   0     000   000000 000001                                                    ....

FSE_CHUNKSIZ
 Sect OctLoc
   0     001   000000 000106                                                    ...F
     1522     1447    1   END FSE$GETGRAN;

PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:271  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FSE$GETGRAN.
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:272  

 **** Variables and constants ****

  ****  Section 000  Data  FSE$GETGRAN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 FSE_CHUNK                  1-0-0/w UBIN        r     1 FSE_CHUNKSIZ

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DA                        4-0-0/w PTR         r     1 CFU$
    *0-0-0/w SBIN        r     1 DA

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU


   Procedure FSE$GETGRAN requires 29 words for executable code.
   Procedure FSE$GETGRAN requires 6 words of local(AUTO) storage.
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:273  

    No errors detected in file FSE$FORMAT.:E05TSI    .
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:274  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:275  
          MINI XREF LISTING

ALTR
      1446**LABEL    1444--CALLALT
B$JIT.DCB$
       443**DCL      1435>>ASSIGN   1438>>IF
B$JIT.ERR
       353**DCL      1440<<ASSIGN
B$JIT.ERR.MID
       354**DCL       354--REDEF
B$JIT$
        21**DCL       348--IMP-PTR  1435>>ASSIGN   1438>>IF       1440>>ASSIGN
CFU$
      1433**DCL      1421--IMP-PTR  1435<<ASSIGN   1436>>IF       1437>>IF
DA
        19**DCL        18--PROC     1444<>CALL
F$DCB.ACTPOS
       482**DCL       482--REDEF
F$DCB.ARS
       457**DCL       457--REDEF
F$DCB.ASN
       472**DCL      1438>>IF
F$DCB.ATTR
       475**DCL       476--REDEF
F$DCB.BORROW
       490**DCL       490--REDEF     490--REDEF     490--REDEF
F$DCB.CFU$
       491**DCL      1435>>ASSIGN
F$DCB.DCBNAME.L
       504**DCL       504--IMP-SIZ
F$DCB.EOMCHAR
       461**DCL       461--REDEF
F$DCB.FLDID
       485**DCL       485--REDEF
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:276  
F$DCB.FORM$
       479**DCL       479--REDEF
F$DCB.FSECT
       495**DCL       495--REDEF
F$DCB.FSN
       472**DCL       472--REDEF     472--REDEF     473--REDEF
F$DCB.HEADER$
       478**DCL       478--REDEF
F$DCB.IXTNSIZE
       476**DCL       476--REDEF
F$DCB.LASTSTA$
       466**DCL       466--REDEF
F$DCB.LVL
       491**DCL       491--REDEF
F$DCB.NAME.C
       466**DCL       466--REDEF
F$DCB.NOEOF
       487**DCL       487--REDEF
F$DCB.NRECS
       477**DCL       477--REDEF
F$DCB.NRECX
       496**DCL       496--REDEF
F$DCB.OHDR
       488**DCL       488--REDEF
F$DCB.ORG
       471**DCL       471--REDEF
F$DCB.PRECNO
       494**DCL       494--REDEF
F$DCB.RCSZ
       499**DCL       499--REDEF
F$DCB.RES
       467**DCL       467--REDEF
F$DCB.SETX
       479**DCL       479--REDEF
F$DCB.TAB$
       478**DCL       479--REDEF
PL6.E3A0      #002=FSE$GETGRAN File=FSE$FORMAT.:E05TSI                           TUE 07/29/97 17:31 Page:277  
F$DCB.TDA
       493**DCL       493--REDEF
F$DCB.WSN
       468**DCL       468--REDEF
FAF$GETGRAN
        24**DCL-ENT  1444--CALL
FM$CFU.ACCTX
      1422**DCL      1422--REDEF
FM$CFU.NGAVAL
      1424**DCL      1436>>IF
FM$CFU.UGRANS
      1423**DCL      1437>>IF
FM$CFUEXT.XTNT
      1427**DCL      1428--REDEF
FSE_CHUNK
      1430**DCL      1438>>IF
FSE_CHUNKSIZ
      1431**DCL      1437>>IF
