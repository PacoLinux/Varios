VERSION E05

PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:1    
        1        1        /*M* KVF$TBLSCN VIRTUAL DEVICE HANDLER FIELD TABLE SCANNING ROUTINES          */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        8        8
        9        9        KVF$TOPPAG: PROC;
       10       10
       11       11        /* The purpose of this routine is to dump the current form to the
       12       12           virtual device. For CRT's,  return,  they're painted a bit at a time.
       13       13           paper is advanced to limbo.                                                */
       14       14
       15       15 S      %INCLUDE KV$GLB;
       16       16 S      %INCLUDE KV$GLBCTX;
       17       17 S      %INCLUDE KV_GLBCNS_E;
       18       18 S      %INCLUDE KV$INT;
       19       19
       20       20        %KV$PTR;
       21       63        %KV$LIN;
       22       87        %KV$SRD;
       23      362        %KV$MVD;
       24      406        %KV$LINLST;
       25      433
       26      434    1   DCL KVF$UPDFRM_HRDCPY ENTRY(1);
       27      435    1   DCL KVO$PAGBRK ENTRY;
       28      436    1   DCL KVO$UP_SPC_NO_PAGBRK ENTRY(1);
       29      437        /*
       30      438        Pointer into KV$LINLST to the current KV$LIN entry.
       31      439        */
       32      440    1   DCL Y@LINLST$ PTR AUTO;
       33      441        /*
       34      442        Pointer to the last KV$LIN entry.
       35      443        */
       36      444    1   DCL Y@LSTLIN$ PTR AUTO;
       37      445
PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:2    
       38      446        /* If retypovr is set,  we assume this is a CRT                               */
       39      447
       40      448    2      IF NOT %KV_MVD.RETYPOVR THEN DO;
       41      449    2         CALL KVO$PAGBRK;
       42      450
       43      451        /* Insure that the form display bits are reset for every line
       44      452           on the form, since we are going to eject a page                           */
       45      453
       46      454    2         Y@LINLST$ = PINCRW(KV$PTR.LINLST$, SIZEW(KV$lINLST));
       47      455    2         Y@LSTLIN$ = PINCRW(KV$PTR.LINLST$,%KV_LINLST.LSTENTWRDX);
       48      456    3         DO UNTIL Y@LINLST$ = Y@LSTLIN$;
       49      457    3            Y@LINLST$->KV$LIN.FRMDSP = '0'B;
       50      458    3            Y@LINLST$ = PINCRW(Y@LINLST$,SIZEW(KV$LIN));
       51      459    3         END;                              /* LOOP                               */
       52      460    2         %KV_SRD.NXTNONBLNLIN = 255;
       53      461    2         CALL KVF$UPDFRM_HRDCPY (Y@LINLST$->KV$LIN);
       54      462    2         CALL KVO$UP_SPC_NO_PAGBRK(%KV_SRD.MINLNG - KV$PTR.VRTLIN) ;
       55      463    2      END; /* IF */
       56      464    1   END; /* SUBROUTINE */
       57      465        %EOD;

PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:3    
--  Include file information  --

   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$TOPPAG.

   Procedure KVF$TOPPAG requires 92 words for executable code.
   Procedure KVF$TOPPAG requires 11 words of local(AUTO) storage.

PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:4    

 Object Unit name= KVF$TOPPAG                                 File name= KVF$TBLSCN.:E05TOU
 UTS= JUL 30 '97 01:58:53.52 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none    92     5C  KVF$TOPPAG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        0  KVF$TOPPAG

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 KVO$PAGBRK
         yes           Std       1 KVF$UPDFRM_HRDCPY
         yes           Std       1 KVO$UP_SPC_NO_PAGBRK
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                          r    G$ROS$
PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:5    


        1        1        /*M* KVF$TBLSCN VIRTUAL DEVICE HANDLER FIELD TABLE SCANNING ROUTINES          */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
        8        8
        9        9        KVF$TOPPAG: PROC;

      9   0 000000  D380 0000 0000  xent KVF$TOPPAG      LNJ,B5   X6A_AUTO_0
          0 000003       000B 0000                       DC       11,0

       10       10
       11       11        /* The purpose of this routine is to dump the current form to the
       12       12           virtual device. For CRT's,  return,  they're painted a bit at a time.
       13       13           paper is advanced to limbo.                                                */
       14       14
       15       15 S      %INCLUDE KV$GLB;
       16       16 S      %INCLUDE KV$GLBCTX;
       17       17 S      %INCLUDE KV_GLBCNS_E;
       18       18 S      %INCLUDE KV$INT;
       19       19
       20       20        %KV$PTR;
       21       63        %KV$LIN;
       22       87        %KV$SRD;
       23      362        %KV$MVD;
       24      406        %KV$LINLST;
       25      433
       26      434    1   DCL KVF$UPDFRM_HRDCPY ENTRY(1);
       27      435    1   DCL KVO$PAGBRK ENTRY;
       28      436    1   DCL KVO$UP_SPC_NO_PAGBRK ENTRY(1);
       29      437        /*
       30      438        Pointer into KV$LINLST to the current KV$LIN entry.
       31      439        */
       32      440    1   DCL Y@LINLST$ PTR AUTO;
PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:6    
       33      441        /*
       34      442        Pointer to the last KV$LIN entry.
       35      443        */
       36      444    1   DCL Y@LSTLIN$ PTR AUTO;
       37      445
       38      446        /* If retypovr is set,  we assume this is a CRT                               */
       39      447
       40      448    2      IF NOT %KV_MVD.RETYPOVR THEN DO;

    448   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DCC6 0006                            LDB,B5   6,B6
          0 00000A  82C5 0016                            LB,'0080'X        22,B5
          0 00000C       0080
          0 00000D  0501 004B                            BBT      s:464,PREL

       41      449    2         CALL KVO$PAGBRK;

    449   0 00000F  CBF0 0000                            LAB,B4   0,IMO
          0 000011  E380 0000 0000  xent                 LNJ,B6   KVO$PAGBRK
          0 000014       0001                            DC       s:454,PREL

       42      450
       43      451        /* Insure that the form display bits are reset for every line
       44      452           on the form, since we are going to eject a page                           */
       45      453
       46      454    2         Y@LINLST$ = PINCRW(KV$PTR.LINLST$, SIZEW(KV$lINLST));

    454   0 000015  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000018  DCC6 000E                            LDB,B5   14,B6
          0 00001A  CBC5 0008                            LAB,B4   8,B5
          0 00001C  CFC7 0004                            STB,B4   Y@LINLST$,AUTO

       47      455    2         Y@LSTLIN$ = PINCRW(KV$PTR.LINLST$,%KV_LINLST.LSTENTWRDX);

    455   0 00001E  B845 0001                            LDR,R3   1,B5
          0 000020  BBB5                                 LAB,B3   ,B5,R3
          0 000021  BFC7 0006                            STB,B3   Y@LSTLIN$,AUTO
PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:7    

       48      456    3         DO UNTIL Y@LINLST$ = Y@LSTLIN$;

       49      457    3            Y@LINLST$->KV$LIN.FRMDSP = '0'B;

    457   0 000023  ECC7 0004                            LDB,B6   Y@LINLST$,AUTO
          0 000025  8846 0003                            LBF,'0080'X       3,B6
          0 000027       0080

       50      458    3            Y@LINLST$ = PINCRW(Y@LINLST$,SIZEW(KV$LIN));

    458   0 000028  DBC6 0004                            LAB,B5   4,B6
          0 00002A  DFC7 0004                            STB,B5   Y@LINLST$,AUTO

       51      459    3         END;                              /* LOOP                               */

    459   0 00002C  DDC7 0006                            CMB,B5   Y@LSTLIN$,AUTO
          0 00002E  09F5                                 BNE      s:457,SPREL

       52      460    2         %KV_SRD.NXTNONBLNLIN = 255;

    460   0 00002F  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000032  CCC6 000A                            LDB,B4   10,B6
          0 000034  E870 00FF                            LDR,R6   255,IMO
          0 000036  EF44 0014                            STR,R6   20,B4

       53      461    2         CALL KVF$UPDFRM_HRDCPY (Y@LINLST$->KV$LIN);

    461   0 000038  BBC7 0004                            LAB,B3   Y@LINLST$,AUTO
          0 00003A  CBF0 0100                            LAB,B4   256,IMO
          0 00003C  E380 0000 0000  xent                 LNJ,B6   KVF$UPDFRM_HRDCPY
          0 00003F       0001                            DC       s:462,PREL

       54      462    2         CALL KVO$UP_SPC_NO_PAGBRK(%KV_SRD.MINLNG - KV$PTR.VRTLIN) ;

    462   0 000040  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000043  DCC6 000A                            LDB,B5   10,B6
PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:8    
          0 000045  E845 001E                            LDR,R6   30,B5
          0 000047  E570 00FF                            AND,R6   255,IMO
          0 000049  E246 0019                            SUB,R6   25,B6
          0 00004B  EF47 0008                            STR,R6   Y@LSTLIN$+2,AUTO
          0 00004D  CBC7 0008                            LAB,B4   Y@LSTLIN$+2,AUTO
          0 00004F  CFC7 0009                            STB,B4   Y@LSTLIN$+3,AUTO
          0 000051  BBC7 0009                            LAB,B3   Y@LSTLIN$+3,AUTO
          0 000053  CBF0 0100                            LAB,B4   256,IMO
          0 000055  E380 0000 0000  xent                 LNJ,B6   KVO$UP_SPC_NO_PAGBRK
          0 000058       0001                            DC       s:464,PREL

       55      463    2      END; /* IF */

       56      464    1   END; /* SUBROUTINE */

    464   0 000059  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
       57      465        %EOD;

PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:9    
--  Include file information  --

   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$TOPPAG.
PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:10   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 Y@LINLST$                  6-0-0/w PTR         r     1 Y@LSTLIN$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(64)    r     1 KV$LIN                     0-0-0/w STRC(128)   r     1 KV$LINLST
     0-0-0/w STRC(512)   r     1 KV$MVD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(496)   r     1 KV$SRD


   Procedure KVF$TOPPAG requires 92 words for executable code.
   Procedure KVF$TOPPAG requires 11 words of local(AUTO) storage.
PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:11   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:12   
          MINI XREF LISTING

KV$LIN
        84**DCL       458--ASSIGN    461<>CALL
KV$LIN.FRMDSP
        85**DCL       457<<ASSIGN
KV$LINLST
       427**DCL       454--ASSIGN
KV$LINLST.LSTENTWRDX
       427**DCL       455>>ASSIGN
KV$MVD.RETYPOVR
       392**DCL       448>>IF
KV$PTR.INPCNDPND
        47**DCL        56--REDEF      60--REDEF
KV$PTR.LINLST$
        43**DCL        44--REDEF     454>>ASSIGN    455>>ASSIGN    455>>ASSIGN
KV$PTR.MVD$
        42**DCL       448>>IF
KV$PTR.SRD$
        43**DCL       460>>ASSIGN    462>>CALL
KV$PTR.VRTLIN
        46**DCL       462>>CALL
KV$PTR$
        35**DCL        41--IMP-PTR   448>>IF        454>>ASSIGN    455>>ASSIGN    455>>ASSIGN    460>>ASSIGN
       462>>CALL      462>>CALL
KV$SRD.BTMRHT
       204**DCL       209--REDEF
KV$SRD.CRT
       280**DCL       285--REDEF
KV$SRD.FLDEND
       244**DCL       249--REDEF
KV$SRD.HI_NONBLN
       314**DCL       319--REDEF
KV$SRD.MINLNG
PL6.E3A0      #001=KVF$TOPPAG File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:58 Page:13   
       360**DCL       462>>CALL
KV$SRD.NXTNONBLNLIN
       252**DCL       460<<ASSIGN
KV$SRD.ORG
       136**DCL       141--REDEF
KV$SRD.SRDEND
       349**DCL       354--REDEF
KV$SRD.TOPLFT
       170**DCL       175--REDEF
KVF$UPDFRM_HRDCPY
       434**DCL-ENT   461--CALL
KVO$PAGBRK
       435**DCL-ENT   449--CALL
KVO$UP_SPC_NO_PAGBRK
       436**DCL-ENT   462--CALL
Y@LINLST$
       440**DCL       454<<ASSIGN    456>>DOUNTIL   457>>ASSIGN    458<<ASSIGN    458>>ASSIGN    461>>CALL
Y@LSTLIN$
       444**DCL       455<<ASSIGN    456>>DOUNTIL

PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:14   
       58        1        /*T***********************************************************/
       59        2        /*T*                                                         */
       60        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       61        4        /*T*                                                         */
       62        5        /*T***********************************************************/
       63        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
       64        7        KVF$RQSDAT: PROC(PRM_USR_RQSDAT);
       65        8
       66        9        /* The purpose of this routine is to initiate the scanning of a form
       67       10           as a result of a request for data to the forms virtual device. If the real device
       68       11           is a CRT,  we first call a routine to update the screen (if any
       69       12           fields have been updated).                                                 */
       70       13
       71       14 S      %INCLUDE KV$GLB;
       72       15 S      %INCLUDE KV$GLBCTX;
       73       16 S      %INCLUDE KV_GLBCNS_E;
       74       17 S      %INCLUDE KV$INT;
       75       18 S      %INCLUDE KV$USR;
       76       19        %INCLUDE KV_GLB_M;
       77      141
       78      142        %KV$PTR;
       79      185        %KV$FLD;
       80      273        %KV$LIN;
       81      297        %KV$LINLST;
       82      324        %KV$MVD;
       83      368        %KV$STR;
       84      455        %KV$USR_RQSDAT (NAME = PRM_USR_RQSDAT, STCLASS = PARAM);
       85      518        %KV$VDI;
       86      589        %KV_PTR_STT_E;
       87      604        %KV_LINLST_SLCFLDSTT_E;
       88      610        %KV_INPUNT_E;
       89      615
       90      616    1   DCL KVF$NXTSLCFLD ENTRY(1) ALTRET;
       91      617    1   DCL KVF$REDFRM ENTRY;
       92      618    1   DCL KVF$SND ENTRY;
       93      619    1   DCL KVF$UPDFRM_CRT ENTRY;
       94      620    1   DCL KVF$UPDFRM_HRDCPY ENTRY(1);
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:15   
       95      621        %EJECT;
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:16   
       96      622
       97      623    1      %KV_LINLST.LSTOPRSLC = '0'B;
       98      624
       99      625    1      IF %KV_MVD.FRMSCNINH
      100      626
      101      627        /* The scan inhibit flag means more data must be sent
      102      628           if no read is pending                                                      */
      103      629
      104      630
      105      631    1        OR %KV_STR.ERR.COD~=0
      106      632
      107      633        /* Don't start a new read if the selection got errors */
      108      634    2        OR %KV_LINLST.SLCFLDSTT=%KV_LINLST_SLCFLDSTT_NON THEN DO;
      109      635
      110      636        /* There are no selected fields                                               */
      111      637
      112      638    2         CALL KVF$SND;
      113      639    2         RETURN;
      114      640    2      END; /* IF */
      115      641
      116      642        /* Set a flag in KV$PTR to say we are to start at beginning of form           */
      117      643
      118      644    1      KV$PTR.STT = %KV_PTR_STT_BGNOF_FRM;
      119      645
      120      646    2      IF (%KV_LINLST.SLCFLDSTT = %KV_LINLST_SLCFLDSTT_ONE) THEN DO;
      121      647        /*
      122      648        There is only one field selected,  dont bother to search for the
      123      649           first input field
      124      650        */
      125      651    2         KV$PTR.LIN$ = %KV_LINLST.ONEFLDLIN$;
      126      652    2         KV$PTR.FLD$ = PINCRW(%KV_LIN.FLDLST$,%KV_LINLST.ONEFLDWRDX);
      127      653    2         IF %KV_FLD.INP THEN CALL Y$UPDATR;
      128      654    2         ELSE %KV_LINLST.ONEFLDWRDX = 0;   /* Can't do input here.               */
      129      655    2      END; ELSE DO;
      130      656
      131      657        /* Got to search for the fields                                               */
      132      658
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:17   
      133      659    2         %KV_LINLST.ONEFLDWRDX = 0;
      134      660    3         IF KV$PTR.FLD$~=ADDR(NIL) THEN IF %KV_FLD.INP AND %KV_FLD.SLC THEN DO;
      135      661        /*
      136      662           The read specified a key.  Start the read at that field.
      137      663        */
      138      664    3            %KV_LINLST.ONEFLDWRDX = KV$PTR.FLDWRDX;
      139      665    3            %KV_LINLST.ONEFLDLIN$ = KV$PTR.LIN$;
      140      666    3         END;
      141      667    2         KV$PTR.FLDWRDX = 0;
      142      668
      143      669    2   FLDSRC:
      144      670    3         DO WHILE ('1'B);                  /* LOOP START                         */
      145      671
      146      672    3            CALL KVF$NXTSLCFLD(KV$PTR)
      147      673    4            WHENALTRETURN DO; EXIT FLDSRC; END;
      148      674    3            IF NOT %KV_FLD.INP THEN %KV_FLD.SLC = '0'B;
      149      675    4            ELSE DO;
      150      676    4               %KV_FLD.SLC = '1'B;
      151      677    4               CALL Y$UPDATR;
      152      678    4            END;                           /* IF                                 */
      153      679    3         END;                              /* LOOP                               */
      154      680    2      END;                                 /* IF                                 */
      155      681
      156      682    2      IF %KV_LINLST.ONEFLDWRDX=0 THEN DO;
      157      683
      158      684        /* We didn't really have any thing to read. */
      159      685
      160      686    2         CALL KVF$SND;
      161      687    2         RETURN;
      162      688    2      END;
      163      689
      164      690    2      IF %KV_MVD.RETYPOVR THEN DO;
      165      691
      166      692        /* Update the form and then call the routine which reads CRT
      167      693           forms                                                                      */
      168      694
      169      695    2         CALL KVF$UPDFRM_CRT;
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:18   
      170      696
      171      697    2      END; ELSE DO;
      172      698
      173      699        /* Call the routine to read a form from a hardcopy device                     */
      174      700
      175      701    2         KV$PTR.LIN$ = %KV_LINLST.ONEFLDLIN$;
      176      702    2         %KV_LIN.FRMDSP = '0'B;
      177      703    2         CALL KVF$UPDFRM_HRDCPY(%KV_LIN);
      178      704
      179      705    2      END; /* IF */
      180      706    1      CALL KVF$REDFRM;
      181      707    1      RETURN;
      182      708        %EJECT;
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:19   
      183      709    1   Y$UPDATR: PROC;
      184      710
      185      711        /* If this is a selected input field,
      186      712           get the attribute updated for block input devices
      187      713           set up KV$PTR to point to the first one.                                   */
      188      714
      189      715    3      IF %KV_LINLST.ONEFLDWRDX=0 THEN DO;
      190      716
      191      717        /* This is the first selected input field.  Save for use later. */
      192      718
      193      719    3         %KV_LINLST.ONEFLDLIN$ = KV$PTR.LIN$;
      194      720    3         %KV_LINLST.ONEFLDWRDX = KV$PTR.FLDWRDX;
      195      721    3      END;                                 /* IF                                 */
      196      722    2      %KV_FLD.RED = '1'B;
      197      723         /* Make sure visible fields show up when reading. */
      198      724    2      IF %KV_FLD.TXTSIZ=0 THEN %KV_FLD.UPD.TXT = '1'B;
      199      725    3      IF %KV_MVD.RETYPOVR THEN DO;
      200      726    3         %KV_LIN.UPDFLDCNT = 1;
      201      727    3      END;                                 /* IF                                 */
      202      728    3      IF %KV_VDI.INPUNT=%KV_INPUNT_BLK THEN DO;
      203      729    3         %KV_FLD.UPD.ATR = '1'B;
      204      730    3         %KV_FLD.QLF.PRT = '0'B;
      205      731    3         RETURN;
      206      732    3      END;                                 /* IF                                 */
      207      733    2   END Y$UPDATR;                           /* END Y$UPDATR PROC                  */
      208      734    1   END KVF$RQSDAT;                         /* SUBROUTINE                         */
      209      735        %EOD;

PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:20   
--  Include file information  --

   KV_GLB_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$RQSDAT.

   Procedure KVF$RQSDAT requires 280 words for executable code.
   Procedure KVF$RQSDAT requires 10 words of local(AUTO) storage.

PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:21   

 Object Unit name= KVF$RQSDAT                                 File name= KVF$TBLSCN.:E05TOU
 UTS= JUL 30 '97 01:59:05.56 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   280    118  KVF$RQSDAT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KVF$RQSDAT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 KVF$SND
 yes     yes           Std       1 KVF$NXTSLCFLD
         yes           Std       1 KVF$UPDFRM_HRDCPY
         yes           Std       0 KVF$UPDFRM_CRT
         yes           Std       0 KVF$REDFRM
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                          r    G$ROS$
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:22   


       58        1        /*T***********************************************************/
       59        2        /*T*                                                         */
       60        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       61        4        /*T*                                                         */
       62        5        /*T***********************************************************/
       63        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
       64        7        KVF$RQSDAT: PROC(PRM_USR_RQSDAT);

      7   0 000000  D380 0000 0000  xent KVF$RQSDAT      LNJ,B5   X6A_AUTO_1
          0 000003       000A 0001                       DC       10,1

       65        8
       66        9        /* The purpose of this routine is to initiate the scanning of a form
       67       10          as a result of a request for data to the forms virtual device. If the real device
       68       11           is a CRT,  we first call a routine to update the screen (if any
       69       12           fields have been updated).                                                 */
       70       13
       71       14 S      %INCLUDE KV$GLB;
       72       15 S      %INCLUDE KV$GLBCTX;
       73       16 S      %INCLUDE KV_GLBCNS_E;
       74       17 S      %INCLUDE KV$INT;
       75       18 S      %INCLUDE KV$USR;
       76       19        %INCLUDE KV_GLB_M;
       77      141
       78      142        %KV$PTR;
       79      185        %KV$FLD;
       80      273        %KV$LIN;
       81      297        %KV$LINLST;
       82      324        %KV$MVD;
       83      368        %KV$STR;
       84      455        %KV$USR_RQSDAT (NAME = PRM_USR_RQSDAT, STCLASS = PARAM);
       85      518        %KV$VDI;
       86      589        %KV_PTR_STT_E;
       87      604        %KV_LINLST_SLCFLDSTT_E;
       88      610        %KV_INPUNT_E;
       89      615
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:23   
       90      616    1   DCL KVF$NXTSLCFLD ENTRY(1) ALTRET;
       91      617    1   DCL KVF$REDFRM ENTRY;
       92      618    1   DCL KVF$SND ENTRY;
       93      619    1   DCL KVF$UPDFRM_CRT ENTRY;
       94      620    1   DCL KVF$UPDFRM_HRDCPY ENTRY(1);
       95      621        %EJECT;
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:24   
       96      622
       97      623    1      %KV_LINLST.LSTOPRSLC = '0'B;

    623   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DCC6 000E                            LDB,B5   14,B6
          0 00000A  8845 0005                            LBF,'0080'X       5,B5
          0 00000C       0080

       98      624
       99      625    1      IF %KV_MVD.FRMSCNINH

    625   0 00000D  DCC6 0006                            LDB,B5   6,B6
          0 00000F  82C5 0016                            LB,'0010'X        22,B5
          0 000011       0010
          0 000012  0501 000D                            BBT      s:638,PREL
          0 000014  CCC6 0004                            LDB,B4   4,B6
          0 000016  E844 0013                            LDR,R6   19,B4
          0 000018  6981 0007                            BNEZ,R6  s:638,PREL
          0 00001A  BCC6 000E                            LDB,B3   14,B6
          0 00001C  D2C3 0005                            LLH,R5   5,B3
          0 00001E  5981 000A                            BNEZ,R5  s:644,PREL

      100      626
      101      627        /* The scan inhibit flag means more data must be sent
      102      628           if no read is pending                                                      */
      103      629
      104      630
      105      631    1        OR %KV_STR.ERR.COD~=0
      106      632
      107      633        /* Don't start a new read if the selection got errors */
      108      634    2        OR %KV_LINLST.SLCFLDSTT=%KV_LINLST_SLCFLDSTT_NON THEN DO;

      109      635
      110      636        /* There are no selected fields                                               */
      111      637
      112      638    2         CALL KVF$SND;

PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:25   
    638   0 000020  CBF0 0000                            LAB,B4   0,IMO
          0 000022  E380 0000 0000  xent                 LNJ,B6   KVF$SND
          0 000025       0001                            DC       s:639,PREL

      113      639    2         RETURN;

    639   0 000026  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      114      640    2      END; /* IF */
      115      641
      116      642        /* Set a flag in KV$PTR to say we are to start at beginning of form           */
      117      643
      118      644    1      KV$PTR.STT = %KV_PTR_STT_BGNOF_FRM;

    644   0 000029  4C09                                 LDV,R4   9
          0 00002A  C7C6 001D                            STH,R4   29,B6

      119      645
      120      646    2      IF (%KV_LINLST.SLCFLDSTT = %KV_LINLST_SLCFLDSTT_ONE) THEN DO;

    646   0 00002C  E2C3 0005                            LLH,R6   5,B3
          0 00002E  6D01                                 CMV,R6   1
          0 00002F  0981 001E                            BNE      s:659,PREL

      121      647        /*
      122      648        There is only one field selected,  dont bother to search for the
      123      649           first input field
      124      650        */
      125      651    2         KV$PTR.LIN$ = %KV_LINLST.ONEFLDLIN$;

    651   0 000031  ACC3 0002                            LDB,B2   2,B3
          0 000033  AFC6 0010                            STB,B2   16,B6

      126      652    2         KV$PTR.FLD$ = PINCRW(%KV_LIN.FLDLST$,%KV_LINLST.ONEFLDWRDX);

    652   0 000035  B843 0004                            LDR,R3   4,B3
          0 000037  9C82                                 LDB,B1   ,B2
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:26   
          0 000038  EBB1                                 LAB,B6   ,B1,R3
          0 000039  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 00003C  EFC5 0014                            STB,B6   20,B5

      127      653    2         IF %KV_FLD.INP THEN CALL Y$UPDATR;

    653   0 00003E  82C6 0002                            LB,'0010'X        2,B6
    653   0 000040       0010
          0 000041  0581 0006                            BBF      s:654,PREL

    653   0 000043  E3C0 0089                            LNJ,B6   s:0,PREL
          0 000045       0001                            DC       s:653+8,PREL
          0 000046  0F81 0049                            B        s:682,PREL

      128      654    2         ELSE %KV_LINLST.ONEFLDWRDX = 0;   /* Can't do input here.               */

    654   0 000048  CCC5 000E                            LDB,B4   14,B5
          0 00004A  8744 0004                            CL       4,B4

      129      655    2      END; ELSE DO;

    655   0 00004C  0F81 0043                            B        s:682,PREL

      130      656
      131      657        /* Got to search for the fields                                               */
      132      658
      133      659    2         %KV_LINLST.ONEFLDWRDX = 0;

    659   0 00004E  8743 0004                            CL       4,B3

      134      660    3         IF KV$PTR.FLD$~=ADDR(NIL) THEN IF %KV_FLD.INP AND %KV_FLD.SLC THEN DO;

    660   0 000050  8DC6 0014                            CMN      20,B6
          0 000052  0901 0019                            BE       s:667,PREL

    660   0 000054  DCC6 0014                            LDB,B5   20,B6
          0 000056  82C5 0002                            LB,'0010'X        2,B5
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:27   
          0 000058       0010
          0 000059  0581 0012                            BBF      s:667,PREL
          0 00005B  82C5 0002                            LB,'0020'X        2,B5
          0 00005D       0020
          0 00005E  0581 000D                            BBF      s:667,PREL

      135      661        /*
      136      662           The read specified a key.  Start the read at that field.
      137      663        */
      138      664    3            %KV_LINLST.ONEFLDWRDX = KV$PTR.FLDWRDX;

    664   0 000060  CCC6 000E                            LDB,B4   14,B6
          0 000062  E846 0018                            LDR,R6   24,B6
          0 000064  EF44 0004                            STR,R6   4,B4

      139      665    3            %KV_LINLST.ONEFLDLIN$ = KV$PTR.LIN$;

    665   0 000066  DCC6 000E                            LDB,B5   14,B6
          0 000068  CCC6 0010                            LDB,B4   16,B6
          0 00006A  CFC5 0002                            STB,B4   2,B5

      140      666    3         END;

      141      667    2         KV$PTR.FLDWRDX = 0;

    667   0 00006C  8746 0018                            CL       24,B6

      142      668
      143      669    2   FLDSRC:
      144      670    3         DO WHILE ('1'B);                  /* LOOP START                         */

    670   0                              FLDSRC          null
      145      671
      146      672    3            CALL KVF$NXTSLCFLD(KV$PTR)

    672   0 00006E  BB80 0000 0000  xsym FLDSRC          LAB,B3   KV$PTR$
          0 000071  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:28   
          0 000073  E380 0000 0000  xent                 LNJ,B6   KVF$NXTSLCFLD
          0 000076       0003                            DC       s:673,PREL
          0 000077  0F81 0003                            B        s:674,PREL

      147      673    4            WHENALTRETURN DO; EXIT FLDSRC; END;

    673   0 000079  0F81 0016                            B        s:682,PREL

      148      674    3            IF NOT %KV_FLD.INP THEN %KV_FLD.SLC = '0'B;

    674   0 00007B  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00007E  DCC6 0014                            LDB,B5   20,B6
          0 000080  82C5 0002                            LB,'0010'X        2,B5
          0 000082       0010
          0 000083  0501 0005                            BBT      s:676,PREL

    674   0 000085  8845 0002                            LBF,'0020'X       2,B5
    674   0 000087       0020
          0 000088  0FE6                                 B        s:670,SPREL

      149      675    4            ELSE DO;

      150      676    4               %KV_FLD.SLC = '1'B;

    676   0 000089  8945 0002                            LBT,'0020'X       2,B5
    676   0 00008B       0020

      151      677    4               CALL Y$UPDATR;

    677   0 00008C  E3C0 0040                            LNJ,B6   s:0,PREL
          0 00008E       0001                            DC       s:679,PREL

      152      678    4            END;                           /* IF                                 */

      153      679    3         END;                              /* LOOP                               */

    679   0 00008F  0FDF                                 B        s:670,SPREL
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:29   

      154      680    2      END;                                 /* IF                                 */

      155      681
      156      682    2      IF %KV_LINLST.ONEFLDWRDX=0 THEN DO;

    682   0 000090  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000093  DCC6 000E                            LDB,B5   14,B6
          0 000095  E845 0004                            LDR,R6   4,B5
          0 000097  6981 000A                            BNEZ,R6  s:690,PREL

      157      683
      158      684        /* We didn't really have any thing to read. */
      159      685
      160      686    2         CALL KVF$SND;

    686   0 000099  CBF0 0000                            LAB,B4   0,IMO
          0 00009B  E380 0000 0000  xent                 LNJ,B6   KVF$SND
          0 00009E       0001                            DC       s:687,PREL

      161      687    2         RETURN;

    687   0 00009F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      162      688    2      END;
      163      689
      164      690    2      IF %KV_MVD.RETYPOVR THEN DO;

    690   0 0000A2  CCC6 0006                            LDB,B4   6,B6
          0 0000A4  82C4 0016                            LB,'0080'X        22,B4
          0 0000A6       0080
          0 0000A7  0581 0009                            BBF      s:701,PREL

      165      691
      166      692        /* Update the form and then call the routine which reads CRT
      167      693           forms                                                                      */
      168      694
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:30   
      169      695    2         CALL KVF$UPDFRM_CRT;

    695   0 0000A9  CBF0 0000                            LAB,B4   0,IMO
          0 0000AB  E380 0000 0000  xent                 LNJ,B6   KVF$UPDFRM_CRT
          0 0000AE       0001                            DC       s:697,PREL

      170      696
      171      697    2      END; ELSE DO;

    697   0 0000AF  0F81 0014                            B        s:706,PREL

      172      698
      173      699        /* Call the routine to read a form from a hardcopy device                     */
      174      700
      175      701    2         KV$PTR.LIN$ = %KV_LINLST.ONEFLDLIN$;

    701   0 0000B1  BCC5 0002                            LDB,B3   2,B5
          0 0000B3  BFC6 0010                            STB,B3   16,B6

      176      702    2         %KV_LIN.FRMDSP = '0'B;

    702   0 0000B5  8843 0003                            LBF,'0080'X       3,B3
    702   0 0000B7       0080

      177      703    2         CALL KVF$UPDFRM_HRDCPY(%KV_LIN);

    703   0 0000B8  DCC6 0010                            LDB,B5   16,B6
          0 0000BA  DFC7 0008                            STB,B5   @PRM_USR_RQSDAT+4,AUTO
          0 0000BC  BBC7 0008                            LAB,B3   @PRM_USR_RQSDAT+4,AUTO
          0 0000BE  CBF0 0100                            LAB,B4   256,IMO
          0 0000C0  E380 0000 0000  xent                 LNJ,B6   KVF$UPDFRM_HRDCPY
          0 0000C3       0001                            DC       s:706,PREL

      178      704
      179      705    2      END; /* IF */

      180      706    1      CALL KVF$REDFRM;
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:31   

    706   0 0000C4  CBF0 0000                            LAB,B4   0,IMO
          0 0000C6  E380 0000 0000  xent                 LNJ,B6   KVF$REDFRM
          0 0000C9       0001                            DC       s:707,PREL

      181      707    1      RETURN;

    707   0 0000CA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      182      708        %EJECT;
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:32   
      183      709    1   Y$UPDATR: PROC;

    709   0 0000CD  EFC7 0006            Y$UPDATR        STB,B6   @PRM_USR_RQSDAT+2,AUTO

      184      710
      185      711        /* If this is a selected input field,
      186      712           get the attribute updated for block input devices
      187      713           set up KV$PTR to point to the first one.                                   */
      188      714
      189      715    3      IF %KV_LINLST.ONEFLDWRDX=0 THEN DO;

    715   0 0000CF  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 0000D2  CCC5 000E                            LDB,B4   14,B5
          0 0000D4  E844 0004                            LDR,R6   4,B4
          0 0000D6  6981 000B                            BNEZ,R6  s:722,PREL

      190      716
      191      717        /* This is the first selected input field.  Save for use later. */
      192      718
      193      719    3         %KV_LINLST.ONEFLDLIN$ = KV$PTR.LIN$;

    719   0 0000D8  BCC5 0010                            LDB,B3   16,B5
          0 0000DA  BFC4 0002                            STB,B3   2,B4

      194      720    3         %KV_LINLST.ONEFLDWRDX = KV$PTR.FLDWRDX;

    720   0 0000DC  ECC5 000E                            LDB,B6   14,B5
          0 0000DE  E845 0018                            LDR,R6   24,B5
          0 0000E0  EF46 0004                            STR,R6   4,B6

      195      721    3      END;                                 /* IF                                 */

      196      722    2      %KV_FLD.RED = '1'B;

    722   0 0000E2  ECC5 0014                            LDB,B6   20,B5
          0 0000E4  8946 0002                            LBT,'0004'X       2,B6
          0 0000E6       0004
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:33   

      197      723         /* Make sure visible fields show up when reading. */
      198      724    2      IF %KV_FLD.TXTSIZ=0 THEN %KV_FLD.UPD.TXT = '1'B;

    724   0 0000E7  ECC5 0014                            LDB,B6   20,B5
          0 0000E9  82C6 0005                            LB,'00FF'X        5,B6
          0 0000EB       00FF
          0 0000EC  0501 0004                            BBT      s:725,PREL

    724   0 0000EE  8946 0002                            LBT,'0040'X       2,B6
    724   0 0000F0       0040

      199      725    3      IF %KV_MVD.RETYPOVR THEN DO;

    725   0 0000F1  ECC5 0006                            LDB,B6   6,B5
          0 0000F3  82C6 0016                            LB,'0080'X        22,B6
          0 0000F5       0080
          0 0000F6  0581 0006                            BBF      s:728,PREL

      200      726    3         %KV_LIN.UPDFLDCNT = 1;

    726   0 0000F8  CCC5 0010                            LDB,B4   16,B5
          0 0000FA  6C01                                 LDV,R6   1
          0 0000FB  E7C4 0003                            STH,R6   3,B4

      201      727    3      END;                                 /* IF                                 */

      202      728    3      IF %KV_VDI.INPUNT=%KV_INPUNT_BLK THEN DO;

    728   0 0000FD  EC85                                 LDB,B6   ,B5
          0 0000FE  E846 001D                            LDR,R6   29,B6
          0 000100  6045                                 SOR,R6   5
          0 000101  E570 0003                            AND,R6   3,IMO
          0 000103  6D03                                 CMV,R6   3
          0 000104  0981 000F                            BNE      s:733,PREL

      203      729    3         %KV_FLD.UPD.ATR = '1'B;
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:34   

    729   0 000106  CCC5 0014                            LDB,B4   20,B5
          0 000108  8944 0002                            LBT,'0080'X       2,B4
          0 00010A       0080

      204      730    3         %KV_FLD.QLF.PRT = '0'B;

    730   0 00010B  ECC5 0014                            LDB,B6   20,B5
          0 00010D  8846 0003                            LBF,'0400'X       3,B6
          0 00010F       0400

      205      731    3         RETURN;

    731   0 000110  ECC7 0006                            LDB,B6   @PRM_USR_RQSDAT+2,AUTO
          0 000112  C3C6 0001                            LNJ,B4   1,B6

      206      732    3      END;                                 /* IF                                 */
      207      733    2   END Y$UPDATR;                           /* END Y$UPDATR PROC                  */

    733   0 000114  ECC7 0006                            LDB,B6   @PRM_USR_RQSDAT+2,AUTO
          0 000116  C3C6 0001                            LNJ,B4   1,B6
      208      734    1   END KVF$RQSDAT;                         /* SUBROUTINE                         */
      209      735        %EOD;

PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:35   
--  Include file information  --

   KV_GLB_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$RQSDAT.
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:36   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PRM_USR_RQSDAT           *0-0-0/w STRC(96)    r     1 PRM_USR_RQSDAT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(104)   r     1 KV$FLD                     0-0-0/w STRC(64)    r     1 KV$LIN
     0-0-0/w STRC(128)   r     1 KV$LINLST                  0-0-0/w STRC(512)   r     1 KV$MVD
     0-0-0/w STRC(480)   r     1 KV$PTR                     0-0-0/w STRC(512)   r     1 KV$STR
     0-0-0/w STRC(512)   r     1 KV$VDI


   Procedure KVF$RQSDAT requires 280 words for executable code.
   Procedure KVF$RQSDAT requires 10 words of local(AUTO) storage.
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:37   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:38   
          MINI XREF LISTING

FLDSRC
       670**LABEL     673--EXIT
KV$FLD.INP
       208**DCL       653>>IF        660>>IF        674>>IF
KV$FLD.QLF.PRT
       234**DCL       730<<ASSIGN
KV$FLD.RED
       208**DCL       722<<ASSIGN
KV$FLD.SLC
       208**DCL       660>>IF        674<<ASSIGN    676<<ASSIGN
KV$FLD.TXTSIZ
       265**DCL       724>>IF
KV$FLD.UPD.ATR
       207**DCL       729<<ASSIGN
KV$FLD.UPD.TXT
       207**DCL       724<<ASSIGN
KV$LIN
       294**DCL       703<>CALL
KV$LIN.FLDLST$
       294**DCL       652>>ASSIGN
KV$LIN.FRMDSP
       295**DCL       702<<ASSIGN
KV$LIN.UPDFLDCNT
       295**DCL       726<<ASSIGN
KV$LINLST.LSTOPRSLC
       320**DCL       623<<ASSIGN
KV$LINLST.ONEFLDLIN$
       319**DCL       651>>ASSIGN    665<<ASSIGN    701>>ASSIGN    719<<ASSIGN
KV$LINLST.ONEFLDWRDX
       319**DCL       652>>ASSIGN    654<<ASSIGN    659<<ASSIGN    664<<ASSIGN    682>>IF        715>>IF
       720<<ASSIGN
KV$LINLST.SLCFLDSTT
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:39   
       320**DCL       625>>IF        646>>IF
KV$MVD.FRMSCNINH
       355**DCL       625>>IF
KV$MVD.RETYPOVR
       354**DCL       690>>IF        725>>IF
KV$PTR
       163**DCL       672<>CALL
KV$PTR.FLD$
       167**DCL       652<<ASSIGN    653>>IF        660>>IF        660>>IF        660>>IF        674>>IF
       674>>ASSIGN    676>>ASSIGN    722>>ASSIGN    724>>IF        724>>ASSIGN    729>>ASSIGN    730>>ASSIGN
KV$PTR.FLDWRDX
       167**DCL       664>>ASSIGN    667<<ASSIGN    720>>ASSIGN
KV$PTR.INPCNDPND
       169**DCL       178--REDEF     182--REDEF
KV$PTR.LIN$
       166**DCL       651<<ASSIGN    652>>ASSIGN    665>>ASSIGN    701<<ASSIGN    702>>ASSIGN    703>>CALL
       719>>ASSIGN    726>>ASSIGN
KV$PTR.LINLST$
       165**DCL       166--REDEF     623>>ASSIGN    625>>IF        646>>IF        651>>ASSIGN    652>>ASSIGN
       654>>ASSIGN    659>>ASSIGN    664>>ASSIGN    665>>ASSIGN    682>>IF        701>>ASSIGN    715>>IF
       719>>ASSIGN    720>>ASSIGN
KV$PTR.MVD$
       164**DCL       625>>IF        690>>IF        725>>IF
KV$PTR.STR$
       163**DCL       625>>IF
KV$PTR.STT
       183**DCL       644<<ASSIGN
KV$PTR.VDI$
       163**DCL       728>>IF
KV$PTR$
       157**DCL       163--IMP-PTR   623>>ASSIGN    625>>IF        625>>IF        625>>IF        644>>ASSIGN
       646>>IF        651>>ASSIGN    651>>ASSIGN    652>>ASSIGN    652>>ASSIGN    652>>ASSIGN    653>>IF
       654>>ASSIGN    659>>ASSIGN    660>>IF        660>>IF        660>>IF        664>>ASSIGN    664>>ASSIGN
       665>>ASSIGN    665>>ASSIGN    667>>ASSIGN    672>>CALL      674>>IF        674>>ASSIGN    676>>ASSIGN
       682>>IF        690>>IF        701>>ASSIGN    701>>ASSIGN    702>>ASSIGN    703>>CALL      715>>IF
       719>>ASSIGN    719>>ASSIGN    720>>ASSIGN    720>>ASSIGN    722>>ASSIGN    724>>IF        724>>ASSIGN
PL6.E3A0      #002=KVF$RQSDAT File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 01:59 Page:40   
       725>>IF        726>>ASSIGN    728>>IF        729>>ASSIGN    730>>ASSIGN
KV$STR.ERR.COD
       443**DCL       625>>IF
KV$VDI.INPUNT
       580**DCL       728>>IF
KVF$NXTSLCFLD
       616**DCL-ENT   672--CALL
KVF$REDFRM
       617**DCL-ENT   706--CALL
KVF$SND
       618**DCL-ENT   638--CALL      686--CALL
KVF$UPDFRM_CRT
       619**DCL-ENT   695--CALL
KVF$UPDFRM_HRDCPY
       620**DCL-ENT   703--CALL
PRM_USR_RQSDAT
       482**DCL         7--PROC
Y$UPDATR
       709**PROC      653--CALL      677--CALL

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:41   
      210        1        /*T***********************************************************/
      211        2        /*T*                                                         */
      212        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      213        4        /*T*                                                         */
      214        5        /*T***********************************************************/
      215        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
      216        7        KVF$UPDFRM_CRT: PROC;
      217        8
      218        9        /* The purpose of this routine is to insure that the current form
      219       10           is completely displayed on the given virtual device. We go through each
      220       11           field on the form and display it on the device if it is not
      221       12           already there or it has been updated since we last displayed it.           */
      222       13
      223       14 S      %INCLUDE KV$GLB;
      224       15 S      %INCLUDE KV$GLBCTX;
      225       16 S      %INCLUDE KV_GLBCNS_E;
      226       17        %INCLUDE KV$INPFNC;
      227      576 S      %INCLUDE KV$INT;
      228      577 S      %INCLUDE KV$USR;
      229      578 S      %INCLUDE KV$VDH;
      230      579        %INCLUDE K_CP6_M;
      231      775        %G#GRPRND_E;
      232      785        %G#QLF_E;
      233      795
      234      796    1   DCL OTHER_FLDS BASED ALIGNED CHAR(KV@USR_ERS.BGNPHSCLM);
      235      797        %KV$FLD (STCLASS="BASED(Y@FLD$)");
      236      885        %EQU KV_FLD = CHARTEXT('KV$FLD');
      237      886        %EQU KV_NXTFLD = CHARTEXT('PINCRW(Y@FLD$,KV$FLD.STRWRDSIZ)->KV$FLD');
      238      887        %KV$FLDLST (STCLASS="BASED(Y@FLD$)");
      239      911        %EQU KV_FLDLST = CHARTEXT('KV$LIN.FLDLST$->KV$FLDLST');
      240      912        %KV$LIN (STCLASS="BASED(Y@LIN$)");
      241      936        %EQU KV_LIN = CHARTEXT('KV$LIN');
      242      937        %EQU KV_NXTLIN = CHARTEXT('PINCRW(Y@LIN$,SIZEW(KV$LIN))->KV$LIN');
      243      938        %EQU KV_NXTFLDLST = CHARTEXT(
               938            'PINCRW(Y@LIN$,SIZEW(KV$LIN))->KV$LIN.FLDLST$->KV$FLDLST');
      244      939        %EQU KV_NXTLINFLD = CHARTEXT(
               939            'PINCRW(PINCRW(Y@LIN$,SIZEW(KV$LIN))->KV$LIN.FLDLST$,SIZEW(KV$FLDLST))->KV$FLD')
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:42   
               939            ;
      245      940        %KV$LINLST;
      246      967        %KV$PTR;
      247     1010        %KV$SRD;
      248     1285        %KV$MRD;
      249     1332        %KV$VDI;
      250     1403        %KV_PHSPSTMOD_E;
      251     1410
      252     1411    1   DCL KVO$PST ENTRY(1);
      253     1412    1   DCL KVO$OTPLCL ENTRY(1);
      254     1413    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
      255     1414
      256     1415        /*
      257     1416        Pointer to the current KV$FLD structure.
      258     1417        */
      259     1418    1   DCL Y@FLD$ PTR AUTO;
      260     1419        /*
      261     1420        Pointer to the current KV$LIN structure.
      262     1421        */
      263     1422    1   DCL Y@LIN$ PTR AUTO;
      264     1423        /*
      265     1424        Pointer to previous field.
      266     1425        */
      267     1426    1   DCL Y@PRVFLD$ PTR AUTO;
      268     1427        %EQU KV_PRVFLD=CHARTEXT('Y@PRVFLD$->KV$FLD');
      269     1428        /*
      270     1429        Field is column 1 and it's always there.
      271     1430        */
      272     1431    1   DCL Y@FRSCLMFLD BIT(1) AUTO;
      273     1432        /*
      274     1433        Word index to the current KV$FLD structure.
      275     1434        */
      276     1435    1   DCL Y@FLDWRDX SBIN WORD AUTO;
      277     1436        /*
      278     1437        Word index to the current KV$LIN structure.
      279     1438        */
      280     1439    1   DCL Y@LINWRDX SBIN WORD AUTO;
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:43   
      281     1440
      282     1441        %KV$USR_ERS (NAME=KV@USR_ERS, STCLASS=AUTO);
      283     1545        %KV$USR_ERS (NAME=KV_USR_ERS, STCLASS=SYMREF);
      284     1649        %KV$USR_SETATR (NAME = KV@USR_SETATR, STCLASS = AUTO);
      285     1772        %KV$USR_SETATR (NAME = KV_USR_SETATR, STCLASS = SYMREF READONLY);
      286     1895        %KV$VDH_OTPLCL (NAME = KV@VDH_OTPLCL, STCLASS = AUTO);
      287     1968        %KV$VDH_OTPLCL (NAME=Y_VDH_OTPLCL, STCLASS=CONSTANT, BYTX="LENGTHV(KV$FLD)",
      288     1969         NO_WRAP=YES, NONVRT=YES);
      289     2042        %KV$VDH_PST (NAME = KV@VDH_PST, STCLASS = AUTO);
      290     2116        %KV$VDH_PST (NAME=KV_VDH_PST_SRD, STCLASS=SYMREF READONLY);
      291     2190        %KV$FLD (NAME=KV_FLD, STCLASS=SYMREF);
      292     2278        %EJECT;
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:44   
      293     2279
      294     2280        /* Setup the default output local and positioning structures
      295     2281           we will need for the rest of this routine.                                 */
      296     2282
      297     2283    1      KV@VDH_OTPLCL = Y_VDH_OTPLCL;
      298     2284
      299     2285    1      KV@VDH_PST = KV_VDH_PST_SRD;
      300     2286
      301     2287    1      KV@USR_ERS = KV_USR_ERS;
      302     2288    1      KV@USR_ERS.NO_RE_PST = '1'B;
      303     2289
      304     2290        /* Restore srd margins in case we broke out of a read                         */
      305     2291
      306     2292    1      %KV_SRD.FLDEND_PST = 0;
      307     2293
      308     2294        /* Start at the first line list entry                                         */
      309     2295
      310     2296    1      Y@LINWRDX = SIZEW(KV$LINLST);
      311     2297
      312     2298        /* Line list loop                                                             */
      313     2299
      314     2300    1   Y$LINLSTLOP:
      315     2301    2      DO WHILE ('1'B);                     /* LOOP START                         */
      316     2302
      317     2303    2         IF Y@LINWRDX>%KV_LINLST.LSTENTWRDX THEN EXIT Y$LINLSTLOP;
      318     2304
      319     2305        /* Build a pointer to the line list entry                                     */
      320     2306
      321     2307    2         Y@LIN$ = PINCRW(ADDR(%KV_LINLST), Y@LINWRDX);
      322     2308
      323     2309        /* We scan this lines field list if it exists and either there
      324     2310           is no form on the device or there are updated fields on this
      325     2311           line.                                                                      */
      326     2312
      327     2313    3         IF %KV_LIN.UPDFLDCNT~=0 THEN DO;
      328     2314    3            %KV_LIN.UPDFLDCNT = 0;
      329     2315
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:45   
      330     2316        /* Start at the first field on the line                                       */
      331     2317
      332     2318    3            Y@FLDWRDX = SIZEW(KV$FLDLST);
      333     2319    3            Y@PRVFLD$ = ADDR(KV_FLD);
      334     2320
      335     2321        /* Field list loop                                                            */
      336     2322
      337     2323    3   Y$FLDLSTLOP:
      338     2324    4            DO WHILE ('1'B);               /* LOOP START                         */
      339     2325
      340     2326    4               IF Y@FLDWRDX>%KV_FLDLST.LSTENTWRDX THEN EXIT Y$FLDLSTLOP;
      341     2327
      342     2328        /* Build a PTR to this field list entry                                       */
      343     2329
      344     2330    4               Y@FLD$ = PINCRW(%KV_LIN.FLDLST$, Y@FLDWRDX);
      345     2331
      346     2332    4               IF %KV_FLD.NEW AND NOT %KV_MRD.DCLATRWHNOTP THEN
      347     2333        /*
      348     2334           The field needs to have its ending attribute position defined.
      349     2335        */
      350     2336
      351     2337    4   DCLFLD:
      352     2338    5               DO;                         /* GROUP START                        */
      353     2339
      354     2340        /* Setup a KV$USR_SETATR to use                                               */
      355     2341
      356     2342    5                  KV@USR_SETATR = KV_USR_SETATR;
      357     2343    5                  %KV_FLD.NEW = '0'B;
      358     2344    5                  IF %KV_FLD.VRTCLM=1 AND %KV_SRD.ORG.CLM=0 AND %KV_MRD.FRSCLMFLD
      359     2345        /*
      360     2346        If we're not counting this attribute,
      361     2347        */
      362     2348    5                  THEN Y@FRSCLMFLD = '1'B;
      363     2349    5                  ELSE Y@FRSCLMFLD = '0'B;
      364     2350    6                  IF NOT %KV_FLD.QLF AND NOT %KV_FLD.INP THEN DO;
      365     2351        /*
      366     2352           This field is being deleted.  Make note of that.
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:46   
      367     2353        */
      368     2354    6                     KV@USR_SETATR.DLTFLD = '1'B;
      369     2355    6                     IF %KV_PRVFLD.TRMATRRQR AND NOT Y@FRSCLMFLD
      370     2356    6                     THEN %KV_FLDLST.ATRCNT = %KV_FLDLST.ATRCNT-1;
      371     2357    6                  END;
      372     2358
      373     2359        /* If declaring this attribute will exceed the max attr count
      374     2360           dont declare it                                                            */
      375     2361
      376     2362        /* Otherwise just bump the attribute count                                    */
      377     2363
      378     2364    6                  ELSE IF NOT Y@FRSCLMFLD THEN DO;
      379     2365    6                     IF %KV_PRVFLD.TRMATRRQR
      380     2366    6                     THEN %KV_FLDLST.ATRCNT = %KV_FLDLST.ATRCNT+1;
      381     2367    6                     IF %KV_FLDLST.ATRCNT>=%KV_MRD.MAXATRPERLIN
      382     2368    6                     THEN %KV_FLD.ATRCLM = 0; /* Just don't set any here         */
      383     2369    6                  END;                     /* IF                                 */
      384     2370
      385     2371        /* Figure out what column immediately follows this field                       */
      386     2372
      387     2373    5                  KV@USR_SETATR.PHSPST.CLM =
      388     2374    5                    %KV_FLD.VRTCLM+%KV_FLD.WDT+%KV_SRD.ORG.CLM;
      389     2375    6                  IF %KV_MRD.ATRRQRDSPPST THEN DO;
      390     2376    6                     KV@USR_SETATR.PHSPST.CLM = KV@USR_SETATR.PHSPST.CLM+1;
      391     2377    6                  END;                     /* IF                                 */
      392     2378
      393     2379        /* See if we need to setup a restore attribute in column Y@ATRCLM
              2379        */
      394     2380
      395     2381    5                  KV@USR_SETATR.QLF = %(G#QLF_PRT|G#QLF_ACPNMR);
      396     2382    5                  KV@USR_SETATR.PHSPST.LIN = %KV_LIN.VRTLIN+%KV_SRD.ORG.LIN;
      397     2383
      398     2384        /* If this is not the last field on the line check to see if the
      399     2385           next field immedialtly follows this one                                    */
      400     2386
      401     2387    6                  IF KV@USR_SETATR.PHSPST.CLM<=%KV_MRD.WDT THEN DO;
      402     2388    6                     IF %KV_FLD.TRMATRRQR OR %KV_NXTFLD.NEW
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:47   
      403     2389
      404     2390        /* To make field insertion count properly,
      405     2391           count the end attr of 2 new shared ones. */
      406     2392
      407     2393    6                     THEN IF NOT KV@USR_SETATR.DLTFLD
      408     2394    6                     THEN %KV_FLDLST.ATRCNT = %KV_FLDLST.ATRCNT+1;
      409     2395    6                     ELSE IF %KV_FLD.TRMATRRQR
      410     2396    6                     THEN %KV_FLDLST.ATRCNT = %KV_FLDLST.ATRCNT-1;
      411     2397    6                     IF NOT %KV_FLD.TRMATRRQR
      412     2398    6                     THEN IF %KV_NXTFLD.TXTSIZ~=0 OR KV@USR_SETATR.DLTFLD
      413     2399    6                     THEN EXIT DCLFLD;
      414     2400
      415     2401        /* Don't bother if the attr is already there, or going to be momentarily.     */
      416     2402
      417     2403    6                  END; ELSE DO;
      418     2404
      419     2405        /* If this field terminates on the last display position for this
      420     2406           device and attribute dcls only take effect to end of line,  theres
      421     2407           nothing to do                                                              */
      422     2408
      423     2409    6                     IF NOT %KV_MRD.NO_FLDTRM THEN EXIT DCLFLD;
      424     2410
      425     2411        /* Otherwise,  we must place the restore attr in column 1 of the next
      426     2412           line                                                                       */
      427     2413
      428     2414
      429     2415    6                     IF Y@LINWRDX<%KV_LINLST.LSTENTWRDX
      430     2416    7                     THEN IF %KV_NXTLIN.FLDLST$~=ADDR(NIL) THEN DO;
      431     2417    7                        IF %KV_NXTLINFLD.VRTCLM=1
      432     2418    8                          AND %KV_SRD.ORG.CLM=0 THEN DO;
      433     2419
      434     2420    8                           IF %KV_NXTLINFLD.TXTSIZ~=0 OR KV@USR_SETATR.DLTFLD
      435     2421    8                           THEN EXIT DCLFLD;
      436     2422    8                        END; ELSE IF KV@USR_SETATR.DLTFLD THEN DO;
      437     2423    8                           %KV_NXTFLDLST.ATRCNT = %KV_NXTFLDLST.ATRCNT-1;
      438     2424    8                        END; ELSE DO;
      439     2425    8                           %KV_NXTFLDLST.ATRCNT = %KV_NXTFLDLST.ATRCNT+1;
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:48   
      440     2426    8                        END;               /* IF                                 */
      441     2427    7                     END;                  /* IF                                 */
      442     2428    6                     KV@USR_SETATR.PHSPST.LIN = KV@USR_SETATR.PHSPST.LIN + 1;
      443     2429    6                     KV@USR_SETATR.PHSPST.CLM = 1;
      444     2430    6                  END;                     /* IF                                 */
      445     2431
      446     2432        /* Check that there are enough spots on the line                              */
      447     2433
      448     2434    5                  IF %KV_FLDLST.ATRCNT<=%KV_MRD.MAXATRPERLIN
      449     2435    6                    OR KV@USR_SETATR.DLTFLD THEN DO;
      450     2436
      451     2437        /* Set the restore attribute                                                  */
      452     2438
      453     2439    6                     CALL KVV$CALUSR(KV@USR_SETATR);
      454     2440    6                  END;                     /* IF                                 */
      455     2441    5                  ELSE %KV_FLD.TRMATRRQR = '1'B;
      456     2442
      457     2443    5               END; ELSE DO;               /* IF                                 */
      458     2444    5                  IF %KV_FLD.NEW THEN %KV_FLD.UPD.ATR = '0'B;
      459     2445    5                  %KV_FLD.NEW = '0'B;
      460     2446    5                  KV@USR_SETATR.DLTFLD = '0'B;
      461     2447    5               END;
      462     2448
      463     2449        /* Only set (new) attributes if there's text in the field
      464     2450           or if this is a block mode input field                                     */
      465     2451
      466     2452    4               IF %KV_FLD.TXTSIZ>0
      467     2453    4                 OR %KV_FLD.RED
      468     2454    5                 OR %KV_FLD.UPD.TXT THEN DO;
      469     2455
      470     2456        /* If the attributes have been updated,  call the RDH to process new
      471     2457           attributes for this field.                                                 */
      472     2458
      473     2459    5                  IF %KV_FLD.UPD.ATR OR %KV_MRD.DCLATRWHNOTP AND %KV_FLD.UPD.TXT
      474     2460    6                  THEN DO;
      475     2461    6                     KV@USR_SETATR = KV_USR_SETATR;
      476     2462    6                     KV@USR_SETATR.PHSPST.CLM = %KV_FLD.ATRCLM+%KV_SRD.ORG.CLM;
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:49   
      477     2463    6                     KV@USR_SETATR.PHSPST.LIN = %KV_LIN.VRTLIN+%KV_SRD.ORG.LIN;
      478     2464
      479     2465        /* Just redeclare the attribute at this location                              */
      480     2466
      481     2467    6                     KV@USR_SETATR.GRPRND = %KV_FLD.GRPRND;
      482     2468    6                     KV@USR_SETATR.QLF = %KV_FLD.QLF;
      483     2469    6                     IF NOT %KV_FLD.RED THEN KV@USR_SETATR.QLF.ACPNMR = '1'B;
      484     2470    7                     IF NOT %KV_FLD.INP AND NOT %KV_FLD.QLF THEN DO;
      485     2471    7                        IF NOT %KV_PRVFLD.TRMATRRQR
      486     2472    7                        THEN %KV_PRVFLD.TRMATRRQR = '1'B;
      487     2473    7                        ELSE IF NOT Y@FRSCLMFLD
      488     2474    7                        THEN KV@USR_SETATR.DLTFLD = '1'B;
      489     2475    7                        KV@USR_SETATR.QLF.PRT = '1'B;
      490     2476    7                     END;
      491     2477    6                     IF %KV_FLD.TXTSIZ=0
      492     2478    7                       AND NOT %KV_FLD.RED THEN DO;
      493     2479    7                        IF %KV_FLD.UPD.ATR THEN KV@USR_SETATR.GRPRND = '0'B;
      494     2480    7                     END; ELSE DO;
      495     2481    7                        %KV_FLD.UPD.ATR = '0'B;
      496     2482    7                     END;                  /* IF                                 */
      497     2483    6                     IF %KV_FLD.ATRCLM~=0 AND (NOT %KV_MRD.DCLATRWHNOTP
      498     2484    6                       OR BITBIN(%KV_MRD.DVCATR)~=BITBIN(%KV_FLD.GRPRND) )
      499     2485    6                     THEN CALL KVV$CALUSR (KV@USR_SETATR);
      500     2486    6                  END;                     /* IF                                 */
      501     2487
      502     2488        /* If the text has been updated,  send it out to the RDH                      */
      503     2489
      504     2490        /* First check if we're turning visible blanks on or off and compensate. */
      505     2491
      506     2492    5                  IF %KV_MRD.DCLATRWHNOTP
      507     2493    5                  THEN IF %KV_FLD.GRPRND&%(G#GRPRND_RVRVID|G#GRPRND_UNDSCR)
      508     2494    5                  THEN %KV_FLD.HI_NONBLNCLM = 255;
      509     2495    5                  ELSE IF %KV_FLD.HI_NONBLNCLM=255
      510     2496    5                  THEN %KV_FLD.HI_NONBLNCLM = %KV_FLD.VRTCLM+%KV_FLD.WDT-1;
      511     2497    5                  IF %KV_FLD.UPD.TXT
      512     2498    5                    AND (%KV_FLD.TXTSIZ>0 OR %KV_FLD.HI_NONBLNCLM>=%KV_FLD.VRTCLM)
      513     2499    6                  THEN DO;
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:50   
      514     2500
      515     2501        /* Position to start of output field. If the attribute requires
      516     2502           a display position,  account for it                                        */
      517     2503
      518     2504    6                     KV@VDH_PST.PSTVAL.LIN = %KV_LIN.VRTLIN;
      519     2505    6                     KV@VDH_PST.PSTVAL.CLM = %KV_FLD.VRTCLM;
      520     2506    7                     IF %KV_MRD.ATRRQRDSPPST THEN DO;
      521     2507    7                        KV@VDH_PST.PSTVAL.CLM = KV@VDH_PST.PSTVAL.CLM + 1;
      522     2508    7                     END;                  /* IF                                 */
      523     2509
      524     2510    6                     %KV_SRD.HI_NONBLN.CLM = %KV_FLD.HI_NONBLNCLM+%KV_SRD.ORG.CLM;
      525     2511    6                     %KV_SRD.HI_NONBLN.LIN = %KV_LIN.VRTLIN+%KV_SRD.ORG.LIN;
      526     2512    6                     CALL KVO$PST (KV@VDH_PST);
      527     2513    7                     IF %KV_MRD.SMLHDNATR THEN DO;
      528     2514    7                        KV@VDH_OTPLCL.HDN = %KV_FLD.GRPRND.HDN;
      529     2515    7                     END;                  /* IF                                 */
      530     2516
      531     2517        /* Setup the output local structure and do the write                          */
      532     2518
      533     2519    6                     KV@VDH_OTPLCL.BFR_.ADR$ = Y@FLD$;
      534     2520    6                     KV@VDH_OTPLCL.BFR_.BYTSIZ = %KV_FLD.TXTSIZ;
      535     2521    6                     IF KV@VDH_OTPLCL.BFR_.BYTSIZ~=0
      536     2522    6                     THEN CALL KVO$OTPLCL(KV@VDH_OTPLCL) ;
      537     2523    7                     IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN THEN DO;
      538     2524        /*
      539     2525           If the new field ends in some blanks, back up to the last non-blank,
      540     2526           and use an erase function to do it instead.
      541     2527        */
      542     2528    7                        %KV_VDI.OTPCNDPND.PST = 0;
      543     2529    7                        %KV_SRD.CRT.CLM = %KV_MRD.DVCCLM;
      544     2530    7                     END;
      545     2531
      546     2532        /* Erase to end_of_field if required. */
      547     2533
      548     2534    6                     IF %KV_FLD.HI_NONBLNCLM>=%KV_SRD.CRT.CLM-%KV_SRD.ORG.CLM
      549     2535    7                     THEN DO;
      550     2536    7                        KV@USR_ERS.TOPLFT_PST = %KV_SRD.CRT_PST;
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:51   
      551     2537    7                        KV@USR_ERS.BGNPHSCLM = KV@USR_ERS.TOPLFT.CLM;
      552     2538    7                        KV@USR_ERS.BTMRHT.LIN = KV@USR_ERS.TOPLFT.LIN;
      553     2539    7                        KV@USR_ERS.ENDPHSCLM = KV@VDH_PST.PSTVAL.CLM+
      554     2540    7                          %KV_SRD.ORG.CLM+%KV_FLD.WDT-1;
      555     2541    7                        KV@USR_ERS.BTMRHT.CLM = KV@USR_ERS.ENDPHSCLM;
      556     2542    7                        IF %KV_FLD.HI_NONBLNCLM=255
      557     2543    7                        THEN KV@USR_ERS.BTMRHT.CLM = KV@USR_ERS.BTMRHT.CLM+1;
      558     2544        /* Don't allow EL0 if we're trying to extend the visible attribute to EOF */
      559     2545    7                        IF KV@USR_ERS.BGNPHSCLM<=KV@USR_ERS.ENDPHSCLM
      560     2546    7                        THEN CALL KVV$CALUSR (KV@USR_ERS);
      561     2547    7                     END;
      562     2548
      563     2549    6                     %KV_FLD.HI_NONBLNCLM = %KV_SRD.HI_NONBLN.CLM-%KV_SRD.ORG.CLM;
      564     2550    6                  END;                     /* IF                                 */
      565     2551    5                  %KV_FLD.UPD.TXT = '0'B;
      566     2552    5               END;                        /* IF                                 */
      567     2553
      568     2554        /* Next field on this line                                                    */
      569     2555
      570     2556    5               IF %KV_FLD.QLF OR %KV_FLD.INP THEN DO;
      571     2557    5                  Y@FLDWRDX = Y@FLDWRDX+%KV_FLD.STRWRDSIZ;
      572     2558    5                  Y@PRVFLD$ = Y@FLD$;
      573     2559    5               END; ELSE DO;
      574     2560        /*
      575     2561           Squeeze the diseased field out of the fieldlist.
      576     2562        */
      577     2563    5                  IF Y@FLDWRDX=%KV_FLDLST.LSTENTWRDX
      578     2564    5                  THEN %KV_FLDLST.LSTENTWRDX = Y@FLDWRDX-%KV_FLD.PRVSTRWRDSIZ;
      579     2565    6                  ELSE DO;
      580     2566    6                     KV@USR_ERS.BGNPHSCLM = /* Bytes to move                     */
      581     2567    6                       2*(%KV_FLDLST.LSTENTWRDX+PINCRW(ADDR(%KV_FLDLST),
      582     2568    6                       %KV_FLDLST.LSTENTWRDX)->KV$FLD.STRWRDSIZ-Y@FLDWRDX-
      583     2569    6                       %KV_FLD.STRWRDSIZ);
      584     2570    6                     %KV_FLDLST.LSTENTWRDX = %KV_FLDLST.LSTENTWRDX-%KV_FLD.STRWRDSIZ;
      585     2571    6                     %KV_NXTFLD.PRVSTRWRDSIZ = %KV_FLD.PRVSTRWRDSIZ;
      586     2572    6                     ADDR(%KV_FLD)->OTHER_FLDS = ADDR(%KV_NXTFLD)->OTHER_FLDS;
      587     2573    6                  END;
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:52   
      588     2574    5               END;
      589     2575    4            END;                           /* LOOP                               */
      590     2576    3         END;                              /* IF                                 */
      591     2577
      592     2578        /* Indicate this line is completely displayed on the real device               */
      593     2579
      594     2580    2         %KV_LIN.FRMDSP = '1'B;
      595     2581
      596     2582        /* Next line                                                                  */
      597     2583
      598     2584    2         Y@LINWRDX = Y@LINWRDX + SIZEW(KV$LIN);
      599     2585
      600     2586    2      END; /* LOOP */
      601     2587
      602     2588        /* Indicate this devices form is completely displayed                          */
      603     2589
      604     2590    1      %KV_LINLST.FRMDSP = '1'B;
      605     2591
      606     2592    1   END; /* SUBROUTINE */
      607     2593        %EOD;

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:53   
--  Include file information  --

   K_CP6_M.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$UPDFRM_CRT.

   Procedure KVF$UPDFRM_CRT requires 961 words for executable code.
   Procedure KVF$UPDFRM_CRT requires 36 words of local(AUTO) storage.

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:54   

 Object Unit name= KVF$UPDFRM_CRT                             File name= KVF$TBLSCN.:E05TOU
 UTS= JUL 30 '97 01:59:26.84 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS      5      5  KVF$UPDFRM_CRT
    1   Proc  even  none   961    3C1  KVF$UPDFRM_CRT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  KVF$UPDFRM_CRT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KVV$CALUSR
         yes           Std       1 KVO$PST
         yes           Std       1 KVO$OTPLCL
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               KV_USR_ERS                       r    KV_USR_SETATR
r    KV_VDH_PST_SRD                        KV_FLD                           r    G$ROS$
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:55   


      210        1        /*T***********************************************************/
      211        2        /*T*                                                         */
      212        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      213        4        /*T*                                                         */
      214        5        /*T***********************************************************/
      215        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
      216        7        KVF$UPDFRM_CRT: PROC;

      7   1 000000  D380 0000 0000  xent KVF$UPDFRM_CRT  LNJ,B5   X6A_AUTO_0
          1 000003       0024 0000                       DC       36,0

      217        8
      218        9        /* The purpose of this routine is to insure that the current form
      219       10           is completely displayed on the given virtual device. We go through each
      220       11           field on the form and display it on the device if it is not
      221       12           already there or it has been updated since we last displayed it.           */
      222       13
      223       14 S      %INCLUDE KV$GLB;
      224       15 S      %INCLUDE KV$GLBCTX;
      225       16 S      %INCLUDE KV_GLBCNS_E;
      226       17        %INCLUDE KV$INPFNC;
      227      576 S      %INCLUDE KV$INT;
      228      577 S      %INCLUDE KV$USR;
      229      578 S      %INCLUDE KV$VDH;
      230      579        %INCLUDE K_CP6_M;
      231      775        %G#GRPRND_E;
      232      785        %G#QLF_E;
      233      795
      234      796    1   DCL OTHER_FLDS BASED ALIGNED CHAR(KV@USR_ERS.BGNPHSCLM);
      235      797        %KV$FLD (STCLASS="BASED(Y@FLD$)");
      236      885        %EQU KV_FLD = CHARTEXT('KV$FLD');
      237      886        %EQU KV_NXTFLD = CHARTEXT('PINCRW(Y@FLD$,KV$FLD.STRWRDSIZ)->KV$FLD');
      238      887        %KV$FLDLST (STCLASS="BASED(Y@FLD$)");
      239      911        %EQU KV_FLDLST = CHARTEXT('KV$LIN.FLDLST$->KV$FLDLST');
      240      912        %KV$LIN (STCLASS="BASED(Y@LIN$)");
      241      936        %EQU KV_LIN = CHARTEXT('KV$LIN');
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:56   
      242      937        %EQU KV_NXTLIN = CHARTEXT('PINCRW(Y@LIN$,SIZEW(KV$LIN))->KV$LIN');
      243      938        %EQU KV_NXTFLDLST = CHARTEXT(
               938            'PINCRW(Y@LIN$,SIZEW(KV$LIN))->KV$LIN.FLDLST$->KV$FLDLST');
      244      939        %EQU KV_NXTLINFLD = CHARTEXT(
               939           'PINCRW(PINCRW(Y@LIN$,SIZEW(KV$LIN))->KV$LIN.FLDLST$,SIZEW(KV$FLDLST))->KV$FLD')
               939            ;
      245      940        %KV$LINLST;
      246      967        %KV$PTR;
      247     1010        %KV$SRD;
      248     1285        %KV$MRD;
      249     1332        %KV$VDI;
      250     1403        %KV_PHSPSTMOD_E;
      251     1410
      252     1411    1   DCL KVO$PST ENTRY(1);
      253     1412    1   DCL KVO$OTPLCL ENTRY(1);
      254     1413    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
      255     1414
      256     1415        /*
      257     1416        Pointer to the current KV$FLD structure.
      258     1417        */
      259     1418    1   DCL Y@FLD$ PTR AUTO;
      260     1419        /*
      261     1420        Pointer to the current KV$LIN structure.
      262     1421        */
      263     1422    1   DCL Y@LIN$ PTR AUTO;
      264     1423        /*
      265     1424        Pointer to previous field.
      266     1425        */
      267     1426    1   DCL Y@PRVFLD$ PTR AUTO;
      268     1427        %EQU KV_PRVFLD=CHARTEXT('Y@PRVFLD$->KV$FLD');
      269     1428        /*
      270     1429        Field is column 1 and it's always there.
      271     1430        */
      272     1431    1   DCL Y@FRSCLMFLD BIT(1) AUTO;
      273     1432        /*
      274     1433        Word index to the current KV$FLD structure.
      275     1434        */
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:57   
      276     1435    1   DCL Y@FLDWRDX SBIN WORD AUTO;
      277     1436        /*
      278     1437        Word index to the current KV$LIN structure.
      279     1438        */
      280     1439    1   DCL Y@LINWRDX SBIN WORD AUTO;
      281     1440
      282     1441        %KV$USR_ERS (NAME=KV@USR_ERS, STCLASS=AUTO);
      283     1545        %KV$USR_ERS (NAME=KV_USR_ERS, STCLASS=SYMREF);
      284     1649        %KV$USR_SETATR (NAME = KV@USR_SETATR, STCLASS = AUTO);
      285     1772        %KV$USR_SETATR (NAME = KV_USR_SETATR, STCLASS = SYMREF READONLY);
      286     1895        %KV$VDH_OTPLCL (NAME = KV@VDH_OTPLCL, STCLASS = AUTO);
      287     1968        %KV$VDH_OTPLCL (NAME=Y_VDH_OTPLCL, STCLASS=CONSTANT, BYTX="LENGTHV(KV$FLD)",
      288     1969         NO_WRAP=YES, NONVRT=YES);
      289     2042        %KV$VDH_PST (NAME = KV@VDH_PST, STCLASS = AUTO);
      290     2116        %KV$VDH_PST (NAME=KV_VDH_PST_SRD, STCLASS=SYMREF READONLY);
      291     2190        %KV$FLD (NAME=KV_FLD, STCLASS=SYMREF);
      292     2278        %EJECT;
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:58   
      293     2279
      294     2280        /* Setup the default output local and positioning structures
      295     2281           we will need for the rest of this routine.                                 */
      296     2282
      297     2283    1      KV@VDH_OTPLCL = Y_VDH_OTPLCL;

   2283   1 000005  AB80 0000 0000  00                   LAB,B2   Y_VDH_OTPLCL
          1 000008  2C00                                 LDV,R2   0
          1 000009  6C0A                                 LDV,R6   10
          1 00000A  BB87                                 LAB,B3   ,AUTO
          1 00000B  3C30                                 LDV,R3   48
          1 00000C  0008                                 MMM

      298     2284
      299     2285    1      KV@VDH_PST = KV_VDH_PST_SRD;

   2285   1 00000D  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_PST_SRD
          1 000010  2C00                                 LDV,R2   0
          1 000011  6C08                                 LDV,R6   8
          1 000012  BB87                                 LAB,B3   ,AUTO
          1 000013  3C3A                                 LDV,R3   58
          1 000014  0008                                 MMM

      300     2286
      301     2287    1      KV@USR_ERS = KV_USR_ERS;

   2287   1 000015  AB80 0000 0000  xsym                 LAB,B2   KV_USR_ERS
          1 000018  2C00                                 LDV,R2   0
          1 000019  6C0E                                 LDV,R6   14
          1 00001A  BB87                                 LAB,B3   ,AUTO
          1 00001B  3C1A                                 LDV,R3   26
          1 00001C  0008                                 MMM

      302     2288    1      KV@USR_ERS.NO_RE_PST = '1'B;

   2288   1 00001D  8947 000D                            LBT,'0040'X       KV@USR_ERS,AUTO
   2288   1 00001F       0040
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:59   

      303     2289
      304     2290        /* Restore srd margins in case we broke out of a read                         */
      305     2291
      306     2292    1      %KV_SRD.FLDEND_PST = 0;

   2292   1 000020  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000023  DCC6 000A                            LDB,B5   10,B6
          1 000025  8745 0010                            CL       16,B5
          1 000027  8745 0011                            CL       17,B5

      307     2293
      308     2294        /* Start at the first line list entry                                         */
      309     2295
      310     2296    1      Y@LINWRDX = SIZEW(KV$LINLST);

   2296   1 000029  6C08                                 LDV,R6   8
          1 00002A  EF47 000C                            STR,R6   Y@LINWRDX,AUTO

      311     2297
      312     2298        /* Line list loop                                                             */
      313     2299
      314     2300    1   Y$LINLSTLOP:
      315     2301    2      DO WHILE ('1'B);                     /* LOOP START                         */

   2301   1                              Y$LINLSTLOP     null
      316     2302
      317     2303    2         IF Y@LINWRDX>%KV_LINLST.LSTENTWRDX THEN EXIT Y$LINLSTLOP;

   2303   1 00002C  EC80 0000 0000  xsym Y$LINLSTLOP     LDB,B6   KV$PTR$
          1 00002F  DCC6 000E                            LDB,B5   14,B6
          1 000031  E847 000C                            LDR,R6   Y@LINWRDX,AUTO
          1 000033  E945 0001                            CMR,R6   1,B5
          1 000035  0A01 0385                            BAG      s:2590,PREL

      318     2304
      319     2305        /* Build a pointer to the line list entry                                     */
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:60   
      320     2306
      321     2307    2         Y@LIN$ = PINCRW(ADDR(%KV_LINLST), Y@LINWRDX);

   2307   1 000037  B856                                 LDR,R3   R6
          1 000038  CBB5                                 LAB,B4   ,B5,R3
          1 000039  CFC7 0006                            STB,B4   Y@LIN$,AUTO

      322     2308
      323     2309        /* We scan this lines field list if it exists and either there
      324     2310           is no form on the device or there are updated fields on this
      325     2311           line.                                                                      */
      326     2312
      327     2313    3         IF %KV_LIN.UPDFLDCNT~=0 THEN DO;

   2313   1 00003B  D2C4 0003                            LLH,R5   3,B4
          1 00003D  5901 0371                            BEZ,R5   s:2580,PREL

      328     2314    3            %KV_LIN.UPDFLDCNT = 0;

   2314   1 00003F  87C4 0003                            CLH      3,B4

      329     2315
      330     2316        /* Start at the first field on the line                                       */
      331     2317
      332     2318    3            Y@FLDWRDX = SIZEW(KV$FLDLST);

   2318   1 000041  5C03                                 LDV,R5   3
          1 000042  DF47 000B                            STR,R5   Y@FLDWRDX,AUTO

      333     2319    3            Y@PRVFLD$ = ADDR(KV_FLD);

   2319   1 000044  DB80 0000 0000  xsym                 LAB,B5   KV_FLD
          1 000047  DFC7 0008                            STB,B5   Y@PRVFLD$,AUTO

      334     2320
      335     2321        /* Field list loop                                                            */
      336     2322
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:61   
      337     2323    3   Y$FLDLSTLOP:
      338     2324    4            DO WHILE ('1'B);               /* LOOP START                         */

   2324   1                              Y$FLDLSTLOP     null
      339     2325
      340     2326    4               IF Y@FLDWRDX>%KV_FLDLST.LSTENTWRDX THEN EXIT Y$FLDLSTLOP;

   2326   1 000049  ECC7 0006            Y$FLDLSTLOP     LDB,B6   Y@LIN$,AUTO
          1 00004B  DC86                                 LDB,B5   ,B6
          1 00004C  E847 000B                            LDR,R6   Y@FLDWRDX,AUTO
          1 00004E  E945 0001                            CMR,R6   1,B5
          1 000050  0A01 035E                            BAG      s:2580,PREL

      341     2327
      342     2328        /* Build a PTR to this field list entry                                       */
      343     2329
      344     2330    4               Y@FLD$ = PINCRW(%KV_LIN.FLDLST$, Y@FLDWRDX);

   2330   1 000052  B856                                 LDR,R3   R6
          1 000053  CBB5                                 LAB,B4   ,B5,R3
          1 000054  CFC7 0004                            STB,B4   Y@FLD$,AUTO

      345     2331
      346     2332    4               IF %KV_FLD.NEW AND NOT %KV_MRD.DCLATRWHNOTP THEN

   2332   1 000056  82C4 0002                            LB,'0002'X        2,B4
   2332   1 000058       0002
          1 000059  0581 013E                            BBF      s:2444,PREL
          1 00005B  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          1 00005E  ACC3 0008                            LDB,B2   8,B3
          1 000060  82C2 0018                            LB,'0200'X        24,B2
          1 000062       0200
          1 000063  0501 0134                            BBT      s:2444,PREL

      347     2333        /*
      348     2334           The field needs to have its ending attribute position defined.
      349     2335        */
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:62   
      350     2336
      351     2337    4   DCLFLD:
      352     2338    5               DO;                         /* GROUP START                        */

   2338   1                              DCLFLD          null
      353     2339
      354     2340        /* Setup a KV$USR_SETATR to use                                               */
      355     2341
      356     2342    5                  KV@USR_SETATR = KV_USR_SETATR;

   2342   1 000065  AB80 0000 0000  xsym DCLFLD          LAB,B2   KV_USR_SETATR
          1 000068  2C00                                 LDV,R2   0
          1 000069  6C08                                 LDV,R6   8
          1 00006A  BB87                                 LAB,B3   ,AUTO
          1 00006B  3C28                                 LDV,R3   40
          1 00006C  0008                                 MMM

      357     2343    5                  %KV_FLD.NEW = '0'B;

   2343   1 00006D  ECC7 0004                            LDB,B6   Y@FLD$,AUTO
          1 00006F  8846 0002                            LBF,'0002'X       2,B6
          1 000071       0002

      358     2344    5                  IF %KV_FLD.VRTCLM=1 AND %KV_SRD.ORG.CLM=0 AND %KV_MRD.FRSCLMFLD

   2344   1 000072  E2C6 0002                            LLH,R6   2,B6
          1 000074  6D01                                 CMV,R6   1
          1 000075  0981 0016                            BNE      s:2349,PREL
          1 000077  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 00007A  CCC5 000A                            LDB,B4   10,B5
          1 00007C  D844 0008                            LDR,R5   8,B4
          1 00007E  5981 000D                            BNEZ,R5  s:2349,PREL
          1 000080  ACC5 0008                            LDB,B2   8,B5
          1 000082  82C2 0018                            LB,'0010'X        24,B2
          1 000084       0010
          1 000085  0581 0006                            BBF      s:2349,PREL

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:63   
      359     2345        /*
      360     2346        If we're not counting this attribute,
      361     2347        */
      362     2348    5                  THEN Y@FRSCLMFLD = '1'B;

   2348   1 000087  8947 000A                            LBT,'8000'X       Y@FRSCLMFLD,AUTO
   2348   1 000089       8000
          1 00008A  0F81 0003                            B        s:2350,PREL

      363     2349    5                  ELSE Y@FRSCLMFLD = '0'B;

   2349   1 00008C  8747 000A                            CL       Y@FRSCLMFLD,AUTO

      364     2350    6                  IF NOT %KV_FLD.QLF AND NOT %KV_FLD.INP THEN DO;

   2350   1 00008E  D2C6 0003                            LLH,R5   3,B6
          1 000090  5008                                 SOL,R5   8
          1 000091  5981 001B                            BNEZ,R5  s:2364,PREL
          1 000093  82C6 0002                            LB,'0010'X        2,B6
          1 000095       0010
          1 000096  0501 0016                            BBT      s:2364,PREL

      365     2351        /*
      366     2352           This field is being deleted.  Make note of that.
      367     2353        */
      368     2354    6                     KV@USR_SETATR.DLTFLD = '1'B;

   2354   1 000098  8947 0014                            LBT,'0040'X       KV@USR_SETATR,AUTO
   2354   1 00009A       0040

      369     2355    6                     IF %KV_PRVFLD.TRMATRRQR AND NOT Y@FRSCLMFLD

   2355   1 00009B  DCC7 0008                            LDB,B5   Y@PRVFLD$,AUTO
          1 00009D  82C5 0002                            LB,'0001'X        2,B5
          1 00009F       0001
          1 0000A0  0581 002E                            BBF      s:2373,PREL
          1 0000A2  89C7 000A                            CMZ      Y@FRSCLMFLD,AUTO
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:64   
          1 0000A4  0801 002A                            BAL      s:2373,PREL

      370     2356    6                     THEN %KV_FLDLST.ATRCNT = %KV_FLDLST.ATRCNT-1;

   2356   1 0000A6  CCC7 0006                            LDB,B4   Y@LIN$,AUTO
          1 0000A8  AC84                                 LDB,B2   ,B4
          1 0000A9  88C2 0002                            DEC      2,B2

      371     2357    6                  END;

   2357   1 0000AB  0F81 0023                            B        s:2373,PREL

      372     2358
      373     2359        /* If declaring this attribute will exceed the max attr count
      374     2360           dont declare it                                                            */
      375     2361
      376     2362        /* Otherwise just bump the attribute count                                    */
      377     2363
      378     2364    6                  ELSE IF NOT Y@FRSCLMFLD THEN DO;

   2364   1 0000AD  89C7 000A                            CMZ      Y@FRSCLMFLD,AUTO
          1 0000AF  0801 001F                            BAL      s:2373,PREL

      379     2365    6                     IF %KV_PRVFLD.TRMATRRQR

   2365   1 0000B1  DCC7 0008                            LDB,B5   Y@PRVFLD$,AUTO
          1 0000B3  82C5 0002                            LB,'0001'X        2,B5
          1 0000B5       0001
          1 0000B6  0581 0006                            BBF      s:2367,PREL

      380     2366    6                     THEN %KV_FLDLST.ATRCNT = %KV_FLDLST.ATRCNT+1;

   2366   1 0000B8  CCC7 0006                            LDB,B4   Y@LIN$,AUTO
          1 0000BA  AC84                                 LDB,B2   ,B4
          1 0000BB  8AC2 0002                            INC      2,B2

      381     2367    6                     IF %KV_FLDLST.ATRCNT>=%KV_MRD.MAXATRPERLIN
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:65   

   2367   1 0000BD  CCC7 0006                            LDB,B4   Y@LIN$,AUTO
          1 0000BF  AC84                                 LDB,B2   ,B4
          1 0000C0  9C80 0000 0000  xsym                 LDB,B1   KV$PTR$
          1 0000C3  ECC1 0008                            LDB,B6   8,B1
          1 0000C5  E2C6 0016                            LLH,R6   22,B6
          1 0000C7  E942 0002                            CMR,R6   2,B2
          1 0000C9  0301 0005                            BG       s:2373,PREL

      382     2368    6                     THEN %KV_FLD.ATRCLM = 0; /* Just don't set any here         */

   2368   1 0000CB  ECC7 0004                            LDB,B6   Y@FLD$,AUTO
          1 0000CD  87C6 0005                            CLH      5,B6

      383     2369    6                  END;                     /* IF                                 */

      384     2370
      385     2371        /* Figure out what column immediately follows this field                       */
      386     2372
      387     2373    5                  KV@USR_SETATR.PHSPST.CLM =

   2373   1 0000CF  ECC7 0004                            LDB,B6   Y@FLD$,AUTO
          1 0000D1  E2C6 0002                            LLH,R6   2,B6
          1 0000D3  D2C6 0004                            LLH,R5   4,B6
          1 0000D5  EA55                                 ADD,R6   R5
          1 0000D6  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0000D9  CCC5 000A                            LDB,B4   10,B5
          1 0000DB  EA44 0008                            ADD,R6   8,B4
          1 0000DD  EF47 0016                            STR,R6   KV@USR_SETATR+2,AUTO

      388     2374    5                    %KV_FLD.VRTCLM+%KV_FLD.WDT+%KV_SRD.ORG.CLM;
      389     2375    6                  IF %KV_MRD.ATRRQRDSPPST THEN DO;

   2375   1 0000DF  CCC5 0008                            LDB,B4   8,B5
          1 0000E1  89C4 0018                            CMZ      24,B4
          1 0000E3  0881 0003                            BAGE     s:2381,PREL

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:66   
      390     2376    6                     KV@USR_SETATR.PHSPST.CLM = KV@USR_SETATR.PHSPST.CLM+1;

   2376   1 0000E5  8AC7 0016                            INC      KV@USR_SETATR+2,AUTO

      391     2377    6                  END;                     /* IF                                 */

      392     2378
      393     2379        /* See if we need to setup a restore attribute in column Y@ATRCLM
              2379        */
      394     2380
      395     2381    5                  KV@USR_SETATR.QLF = %(G#QLF_PRT|G#QLF_ACPNMR);

   2381   1 0000E7  E870 1400                            LDR,R6   5120,IMO
          1 0000E9  6048                                 SOR,R6   8
          1 0000EA  E7C7 0017                            STH,R6   KV@USR_SETATR+3,AUTO

      396     2382    5                  KV@USR_SETATR.PHSPST.LIN = %KV_LIN.VRTLIN+%KV_SRD.ORG.LIN;

   2382   1 0000EC  CCC5 000A                            LDB,B4   10,B5
          1 0000EE  ACC7 0006                            LDB,B2   Y@LIN$,AUTO
          1 0000F0  E842 0002                            LDR,R6   2,B2
          1 0000F2  EA44 0007                            ADD,R6   7,B4
          1 0000F4  EF47 0015                            STR,R6   KV@USR_SETATR+1,AUTO

      397     2383
      398     2384        /* If this is not the last field on the line check to see if the
      399     2385           next field immedialtly follows this one                                    */
      400     2386
      401     2387    6                  IF KV@USR_SETATR.PHSPST.CLM<=%KV_MRD.WDT THEN DO;

   2387   1 0000F6  CCC5 0008                            LDB,B4   8,B5
          1 0000F8  D847 0016                            LDR,R5   KV@USR_SETATR+2,AUTO
          1 0000FA  5801 0005                            BLZ,R5   s:2388,PREL
          1 0000FC  D944 000B                            CMR,R5   11,B4
          1 0000FE  0301 0036                            BG       s:2409,PREL

      402     2388    6                     IF %KV_FLD.TRMATRRQR OR %KV_NXTFLD.NEW
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:67   

   2388   1 000100  82C6 0002                            LB,'0001'X        2,B6
   2388   1 000102       0001
          1 000103  0501 000A                            BBT      s:2393,PREL
          1 000105  B846 0001                            LDR,R3   1,B6
          1 000107  3008                                 SOL,R3   8
          1 000108  3068                                 SAR,R3   8
          1 000109  3004                                 SOL,R3   4
          1 00010A  3E2E                                 ADV,R3   46
          1 00010B  82B6                                 LB       ,B6,R3
          1 00010C  0581 0013                            BBF      s:2397,PREL

      403     2389
      404     2390        /* To make field insertion count properly,
      405     2391           count the end attr of 2 new shared ones. */
      406     2392
      407     2393    6                     THEN IF NOT KV@USR_SETATR.DLTFLD

   2393   1 00010E  82C7 0014                            LB,'0040'X        KV@USR_SETATR,AUTO
   2393   1 000110       0040
          1 000111  0501 0006                            BBT      s:2395,PREL

      408     2394    6                     THEN %KV_FLDLST.ATRCNT = %KV_FLDLST.ATRCNT+1;

   2394   1 000113  9C82                                 LDB,B1   ,B2
          1 000114  8AC1 0002                            INC      2,B1
          1 000116  0F81 0009                            B        s:2397,PREL

      409     2395    6                     ELSE IF %KV_FLD.TRMATRRQR

   2395   1 000118  82C6 0002                            LB,'0001'X        2,B6
   2395   1 00011A       0001
          1 00011B  0581 0004                            BBF      s:2397,PREL

      410     2396    6                     THEN %KV_FLDLST.ATRCNT = %KV_FLDLST.ATRCNT-1;

   2396   1 00011D  9C82                                 LDB,B1   ,B2
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:68   
          1 00011E  88C1 0002                            DEC      2,B1

      411     2397    6                     IF NOT %KV_FLD.TRMATRRQR

   2397   1 000120  82C6 0002                            LB,'0001'X        2,B6
   2397   1 000122       0001
          1 000123  0501 0051                            BBT      s:2434,PREL

      412     2398    6                     THEN IF %KV_NXTFLD.TXTSIZ~=0 OR KV@USR_SETATR.DLTFLD

   2398   1 000125  B846 0001                            LDR,R3   1,B6
          1 000127  3008                                 SOL,R3   8
          1 000128  3068                                 SAR,R3   8
          1 000129  3001                                 SOL,R3   1
          1 00012A  3E0B                                 ADV,R3   11
          1 00012B  E2B6                                 LLH,R6   ,B6,R3
          1 00012C  6981 0069                            BNEZ,R6  s:2443,PREL
          1 00012E  82C7 0014                            LB,'0040'X        KV@USR_SETATR,AUTO
          1 000130       0040
          1 000131  0501 0064                            BBT      s:2443,PREL

      413     2399    6                     THEN EXIT DCLFLD;
      414     2400
      415     2401        /* Don't bother if the attr is already there, or going to be momentarily.     */
      416     2402
      417     2403    6                  END; ELSE DO;

   2403   1 000133  0F81 0041                            B        s:2434,PREL

      418     2404
      419     2405        /* If this field terminates on the last display position for this
      420     2406           device and attribute dcls only take effect to end of line,  theres
      421     2407           nothing to do                                                              */
      422     2408
      423     2409    6                     IF NOT %KV_MRD.NO_FLDTRM THEN EXIT DCLFLD;

   2409   1 000135  82C4 0016                            LB,'0080'X        22,B4
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:69   
   2409   1 000137       0080
          1 000138  0581 005D                            BBF      s:2443,PREL

      424     2410
      425     2411        /* Otherwise,  we must place the restore attr in column 1 of the next
      426     2412           line                                                                       */
      427     2413
      428     2414
      429     2415    6                     IF Y@LINWRDX<%KV_LINLST.LSTENTWRDX

   2415   1 00013A  9CC5 000E                            LDB,B1   14,B5
          1 00013C  C847 000C                            LDR,R4   Y@LINWRDX,AUTO
          1 00013E  C941 0001                            CMR,R4   1,B1
          1 000140  0881 002F                            BAGE     s:2428,PREL

      430     2416    7                     THEN IF %KV_NXTLIN.FLDLST$~=ADDR(NIL) THEN DO;

   2416   1 000142  8DC2 0004                            CMN      4,B2
          1 000144  0901 002B                            BE       s:2428,PREL

      431     2417    7                        IF %KV_NXTLINFLD.VRTCLM=1

   2417   1 000146  ECC2 0004                            LDB,B6   4,B2
          1 000148  B2C6 0005                            LLH,R3   5,B6
          1 00014A  3D01                                 CMV,R3   1
          1 00014B  0981 0015                            BNE      s:2422+2,PREL
          1 00014D  ECC5 000A                            LDB,B6   10,B5
          1 00014F  B846 0008                            LDR,R3   8,B6
          1 000151  3981 000F                            BNEZ,R3  s:2422+2,PREL

      432     2418    8                          AND %KV_SRD.ORG.CLM=0 THEN DO;

      433     2419
      434     2420    8                           IF %KV_NXTLINFLD.TXTSIZ~=0 OR KV@USR_SETATR.DLTFLD

   2420   1 000153  ECC2 0004                            LDB,B6   4,B2
          1 000155  82C6 0008                            LB,'00FF'X        8,B6
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:70   
          1 000157       00FF
          1 000158  0501 003D                            BBT      s:2443,PREL
          1 00015A  82C7 0014                            LB,'0040'X        KV@USR_SETATR,AUTO
          1 00015C       0040
          1 00015D  0501 0038                            BBT      s:2443,PREL

      435     2421    8                           THEN EXIT DCLFLD;
      436     2422    8                        END; ELSE IF KV@USR_SETATR.DLTFLD THEN DO;

   2422   1 00015F  0F81 0010                            B        s:2428,PREL

   2422   1 000161  82C7 0014                            LB,'0040'X        KV@USR_SETATR,AUTO
   2422   1 000163       0040
          1 000164  0581 0007                            BBF      s:2425,PREL

      437     2423    8                           %KV_NXTFLDLST.ATRCNT = %KV_NXTFLDLST.ATRCNT-1;

   2423   1 000166  ECC2 0004                            LDB,B6   4,B2
          1 000168  88C6 0002                            DEC      2,B6

      438     2424    8                        END; ELSE DO;

   2424   1 00016A  0F81 0005                            B        s:2428,PREL

      439     2425    8                           %KV_NXTFLDLST.ATRCNT = %KV_NXTFLDLST.ATRCNT+1;

   2425   1 00016C  ECC2 0004                            LDB,B6   4,B2
          1 00016E  8AC6 0002                            INC      2,B6

      440     2426    8                        END;               /* IF                                 */

      441     2427    7                     END;                  /* IF                                 */

      442     2428    6                     KV@USR_SETATR.PHSPST.LIN = KV@USR_SETATR.PHSPST.LIN + 1;

   2428   1 000170  8AC7 0015                            INC      KV@USR_SETATR+1,AUTO

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:71   
      443     2429    6                     KV@USR_SETATR.PHSPST.CLM = 1;

   2429   1 000172  6C01                                 LDV,R6   1
          1 000173  EF47 0016                            STR,R6   KV@USR_SETATR+2,AUTO

      444     2430    6                  END;                     /* IF                                 */

      445     2431
      446     2432        /* Check that there are enough spots on the line                              */
      447     2433
      448     2434    5                  IF %KV_FLDLST.ATRCNT<=%KV_MRD.MAXATRPERLIN

   2434   1 000175  EC82                                 LDB,B6   ,B2
          1 000176  CCC5 0008                            LDB,B4   8,B5
          1 000178  E2C4 0016                            LLH,R6   22,B4
          1 00017A  E946 0002                            CMR,R6   2,B6
          1 00017C  0281 0006                            BGE      s:2439,PREL
          1 00017E  82C7 0014                            LB,'0040'X        KV@USR_SETATR,AUTO
          1 000180       0040
          1 000181  0581 000F                            BBF      s:2441,PREL

      449     2435    6                    OR KV@USR_SETATR.DLTFLD THEN DO;

      450     2436
      451     2437        /* Set the restore attribute                                                  */
      452     2438
      453     2439    6                     CALL KVV$CALUSR(KV@USR_SETATR);

   2439   1 000183  9BC7 0014                            LAB,B1   KV@USR_SETATR,AUTO
          1 000185  9FC7 0022                            STB,B1   KV@VDH_PST+5,AUTO
          1 000187  BBC7 0022                            LAB,B3   KV@VDH_PST+5,AUTO
          1 000189  CBF0 0100                            LAB,B4   256,IMO
          1 00018B  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 00018E       0001                            DC       s:2440,PREL

      454     2440    6                  END;                     /* IF                                 */

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:72   
   2440   1 00018F  0F81 0016                            B        s:2452,PREL

      455     2441    5                  ELSE %KV_FLD.TRMATRRQR = '1'B;

   2441   1 000191  9CC7 0004                            LDB,B1   Y@FLD$,AUTO
          1 000193  8941 0002                            LBT,'0001'X       2,B1
          1 000195       0001

      456     2442
      457     2443    5               END; ELSE DO;               /* IF                                 */

   2443   1 000196  0F81 000F                            B        s:2452,PREL

      458     2444    5                  IF %KV_FLD.NEW THEN %KV_FLD.UPD.ATR = '0'B;

   2444   1 000198  82C4 0002                            LB,'0002'X        2,B4
   2444   1 00019A       0002
          1 00019B  0581 0004                            BBF      s:2445,PREL

   2444   1 00019D  8844 0002                            LBF,'0080'X       2,B4
   2444   1 00019F       0080

      459     2445    5                  %KV_FLD.NEW = '0'B;

   2445   1 0001A0  8844 0002                            LBF,'0002'X       2,B4
   2445   1 0001A2       0002

      460     2446    5                  KV@USR_SETATR.DLTFLD = '0'B;

   2446   1 0001A3  8847 0014                            LBF,'0040'X       KV@USR_SETATR,AUTO
   2446   1 0001A5       0040

      461     2447    5               END;

      462     2448
      463     2449        /* Only set (new) attributes if there's text in the field
      464     2450           or if this is a block mode input field                                     */
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:73   
      465     2451
      466     2452    4               IF %KV_FLD.TXTSIZ>0

   2452   1 0001A6  ECC7 0004                            LDB,B6   Y@FLD$,AUTO
          1 0001A8  82C6 0005                            LB,'00FF'X        5,B6
          1 0001AA       00FF
          1 0001AB  0501 000B                            BBT      s:2459,PREL
          1 0001AD  82C6 0002                            LB,'0004'X        2,B6
          1 0001AF       0004
          1 0001B0  0501 0006                            BBT      s:2459,PREL
          1 0001B2  82C6 0002                            LB,'0040'X        2,B6
          1 0001B4       0040
          1 0001B5  0581 019E                            BBF      s:2556,PREL

      467     2453    4                 OR %KV_FLD.RED
      468     2454    5                 OR %KV_FLD.UPD.TXT THEN DO;

      469     2455
      470     2456        /* If the attributes have been updated,  call the RDH to process new
      471     2457           attributes for this field.                                                 */
      472     2458
      473     2459    5                  IF %KV_FLD.UPD.ATR OR %KV_MRD.DCLATRWHNOTP AND %KV_FLD.UPD.TXT

   2459   1 0001B7  82C6 0002                            LB,'0080'X        2,B6
   2459   1 0001B9       0080
          1 0001BA  0501 0010                            BBT      s:2461,PREL
          1 0001BC  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          1 0001BF  CCC5 0008                            LDB,B4   8,B5
          1 0001C1  82C4 0018                            LB,'0200'X        24,B4
          1 0001C3       0200
          1 0001C4  0581 008F                            BBF      s:2492,PREL
          1 0001C6  82C6 0002                            LB,'0040'X        2,B6
          1 0001C8       0040
          1 0001C9  0581 008A                            BBF      s:2492,PREL

      474     2460    6                  THEN DO;

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:74   
      475     2461    6                     KV@USR_SETATR = KV_USR_SETATR;

   2461   1 0001CB  AB80 0000 0000  xsym                 LAB,B2   KV_USR_SETATR
          1 0001CE  2C00                                 LDV,R2   0
          1 0001CF  6C08                                 LDV,R6   8
          1 0001D0  BB87                                 LAB,B3   ,AUTO
          1 0001D1  3C28                                 LDV,R3   40
          1 0001D2  0008                                 MMM

      476     2462    6                     KV@USR_SETATR.PHSPST.CLM = %KV_FLD.ATRCLM+%KV_SRD.ORG.CLM;

   2462   1 0001D3  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0001D6  DCC6 000A                            LDB,B5   10,B6
          1 0001D8  CCC7 0004                            LDB,B4   Y@FLD$,AUTO
          1 0001DA  E2C4 0005                            LLH,R6   5,B4
          1 0001DC  EA45 0008                            ADD,R6   8,B5
          1 0001DE  EF47 0016                            STR,R6   KV@USR_SETATR+2,AUTO

      477     2463    6                     KV@USR_SETATR.PHSPST.LIN = %KV_LIN.VRTLIN+%KV_SRD.ORG.LIN;

   2463   1 0001E0  DCC6 000A                            LDB,B5   10,B6
          1 0001E2  ACC7 0006                            LDB,B2   Y@LIN$,AUTO
          1 0001E4  D842 0002                            LDR,R5   2,B2
          1 0001E6  DA45 0007                            ADD,R5   7,B5
          1 0001E8  DF47 0015                            STR,R5   KV@USR_SETATR+1,AUTO

      478     2464
      479     2465        /* Just redeclare the attribute at this location                              */
      480     2466
      481     2467    6                     KV@USR_SETATR.GRPRND = %KV_FLD.GRPRND;

   2467   1 0001EA  C844 0003                            LDR,R4   3,B4
          1 0001EC  CAC7 0017                            SRM,R4,'00FF'X    KV@USR_SETATR+3,AUTO
          1 0001EE       00FF

      482     2468    6                     KV@USR_SETATR.QLF = %KV_FLD.QLF;

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:75   
   2468   1 0001EF  C2C4 0003                            LLH,R4   3,B4
          1 0001F1  4008                                 SOL,R4   8
          1 0001F2  4048                                 SOR,R4   8
          1 0001F3  C7C7 0017                            STH,R4   KV@USR_SETATR+3,AUTO

      483     2469    6                     IF NOT %KV_FLD.RED THEN KV@USR_SETATR.QLF.ACPNMR = '1'B;

   2469   1 0001F5  82C4 0002                            LB,'0004'X        2,B4
   2469   1 0001F7       0004
          1 0001F8  0501 0004                            BBT      s:2470,PREL

   2469   1 0001FA  8947 0017                            LBT,'1000'X       KV@USR_SETATR+3,AUTO
   2469   1 0001FC       1000

      484     2470    7                     IF NOT %KV_FLD.INP AND NOT %KV_FLD.QLF THEN DO;

   2470   1 0001FD  82C4 0002                            LB,'0010'X        2,B4
   2470   1 0001FF       0010
          1 000200  0501 001C                            BBT      s:2477,PREL
          1 000202  C2C4 0003                            LLH,R4   3,B4
          1 000204  4008                                 SOL,R4   8
          1 000205  4981 0017                            BNEZ,R4  s:2477,PREL

      485     2471    7                        IF NOT %KV_PRVFLD.TRMATRRQR

   2471   1 000207  DCC7 0008                            LDB,B5   Y@PRVFLD$,AUTO
          1 000209  82C5 0002                            LB,'0001'X        2,B5
          1 00020B       0001
          1 00020C  0501 0006                            BBT      s:2473,PREL

      486     2472    7                        THEN %KV_PRVFLD.TRMATRRQR = '1'B;

   2472   1 00020E  8945 0002                            LBT,'0001'X       2,B5
   2472   1 000210       0001
          1 000211  0F81 0008                            B        s:2475,PREL

      487     2473    7                        ELSE IF NOT Y@FRSCLMFLD
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:76   

   2473   1 000213  89C7 000A                            CMZ      Y@FRSCLMFLD,AUTO
          1 000215  0801 0004                            BAL      s:2475,PREL

      488     2474    7                        THEN KV@USR_SETATR.DLTFLD = '1'B;

   2474   1 000217  8947 0014                            LBT,'0040'X       KV@USR_SETATR,AUTO
   2474   1 000219       0040

      489     2475    7                        KV@USR_SETATR.QLF.PRT = '1'B;

   2475   1 00021A  8947 0017                            LBT,'0400'X       KV@USR_SETATR+3,AUTO
   2475   1 00021C       0400

      490     2476    7                     END;

      491     2477    6                     IF %KV_FLD.TXTSIZ=0

   2477   1 00021D  82C4 0005                            LB,'00FF'X        5,B4
   2477   1 00021F       00FF
          1 000220  0501 0010                            BBT      s:2481,PREL
          1 000222  82C4 0002                            LB,'0004'X        2,B4
          1 000224       0004
          1 000225  0501 000B                            BBT      s:2481,PREL

      492     2478    7                       AND NOT %KV_FLD.RED THEN DO;

      493     2479    7                        IF %KV_FLD.UPD.ATR THEN KV@USR_SETATR.GRPRND = '0'B;

   2479   1 000227  82C4 0002                            LB,'0080'X        2,B4
   2479   1 000229       0080
          1 00022A  0581 0009                            BBF      s:2483,PREL

   2479   1 00022C  8847 0017                            LBF,'00FF'X       KV@USR_SETATR+3,AUTO
   2479   1 00022E       00FF

      494     2480    7                     END; ELSE DO;
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:77   

   2480   1 00022F  0F81 0004                            B        s:2483,PREL

      495     2481    7                        %KV_FLD.UPD.ATR = '0'B;

   2481   1 000231  8844 0002                            LBF,'0080'X       2,B4
   2481   1 000233       0080

      496     2482    7                     END;                  /* IF                                 */

      497     2483    6                     IF %KV_FLD.ATRCLM~=0 AND (NOT %KV_MRD.DCLATRWHNOTP

   2483   1 000234  E2C4 0005                            LLH,R6   5,B4
          1 000236  6901 001D                            BEZ,R6   s:2492,PREL
          1 000238  DCC6 0008                            LDB,B5   8,B6
          1 00023A  82C5 0018                            LB,'0200'X        24,B5
          1 00023C       0200
          1 00023D  0581 000A                            BBF      s:2485,PREL
          1 00023F  D2C5 001F                            LLH,R5   31,B5
          1 000241  C844 0003                            LDR,R4   3,B4
          1 000243  C570 00FF                            AND,R4   255,IMO
          1 000245  D954                                 CMR,R5   R4
          1 000246  0901 000D                            BE       s:2492,PREL

      498     2484    6                       OR BITBIN(%KV_MRD.DVCATR)~=BITBIN(%KV_FLD.GRPRND) )
      499     2485    6                     THEN CALL KVV$CALUSR (KV@USR_SETATR);

   2485   1 000248  9BC7 0014                            LAB,B1   KV@USR_SETATR,AUTO
          1 00024A  9FC7 0022                            STB,B1   KV@VDH_PST+5,AUTO
          1 00024C  BBC7 0022                            LAB,B3   KV@VDH_PST+5,AUTO
          1 00024E  CBF0 0100                            LAB,B4   256,IMO
          1 000250  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 000253       0001                            DC       s:2492,PREL

      500     2486    6                  END;                     /* IF                                 */

      501     2487
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:78   
      502     2488        /* If the text has been updated,  send it out to the RDH                      */
      503     2489
      504     2490        /* First check if we're turning visible blanks on or off and compensate. */
      505     2491
      506     2492    5                  IF %KV_MRD.DCLATRWHNOTP

   2492   1 000254  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000257  DCC6 0008                            LDB,B5   8,B6
          1 000259  82C5 0018                            LB,'0200'X        24,B5
          1 00025B       0200
          1 00025C  0581 0020                            BBF      s:2497,PREL

      507     2493    5                  THEN IF %KV_FLD.GRPRND&%(G#GRPRND_RVRVID|G#GRPRND_UNDSCR)

   2493   1 00025E  CCC7 0004                            LDB,B4   Y@FLD$,AUTO
          1 000260  E844 0003                            LDR,R6   3,B4
          1 000262  6008                                 SOL,R6   8
          1 000263  E570 0900                            AND,R6   2304,IMO
          1 000265  6901 0006                            BEZ,R6   s:2495,PREL

      508     2494    5                  THEN %KV_FLD.HI_NONBLNCLM = 255;

   2494   1 000267  8944 0004                            LBT,'00FF'X       4,B4
   2494   1 000269       00FF
          1 00026A  0F81 0012                            B        s:2497,PREL

      509     2495    5                  ELSE IF %KV_FLD.HI_NONBLNCLM=255

   2495   1 00026C  E844 0004                            LDR,R6   4,B4
          1 00026E  E570 00FF                            AND,R6   255,IMO
          1 000270  E970 00FF                            CMR,R6   255,IMO
          1 000272  0981 000A                            BNE      s:2497,PREL

      510     2496    5                  THEN %KV_FLD.HI_NONBLNCLM = %KV_FLD.VRTCLM+%KV_FLD.WDT-1;

   2496   1 000274  D2C4 0002                            LLH,R5   2,B4
          1 000276  C2C4 0004                            LLH,R4   4,B4
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:79   
          1 000278  DA54                                 ADD,R5   R4
          1 000279  5EFF                                 ADV,R5   -1
          1 00027A  DAC4 0004                            SRM,R5,'00FF'X    4,B4
          1 00027C       00FF

      511     2497    5                  IF %KV_FLD.UPD.TXT

   2497   1 00027D  DCC7 0004                            LDB,B5   Y@FLD$,AUTO
          1 00027F  82C5 0002                            LB,'0040'X        2,B5
          1 000281       0040
          1 000282  0581 00CC                            BBF      s:2551,PREL
          1 000284  82C5 0005                            LB,'00FF'X        5,B5
          1 000286       00FF
          1 000287  0501 000A                            BBT      s:2504,PREL
          1 000289  E845 0004                            LDR,R6   4,B5
          1 00028B  E570 00FF                            AND,R6   255,IMO
          1 00028D  D2C5 0002                            LLH,R5   2,B5
          1 00028F  E955                                 CMR,R6   R5
          1 000290  0801 00BE                            BAL      s:2551,PREL

      512     2498    5                    AND (%KV_FLD.TXTSIZ>0 OR %KV_FLD.HI_NONBLNCLM>=%KV_FLD.VRTCLM)
      513     2499    6                  THEN DO;

      514     2500
      515     2501        /* Position to start of output field. If the attribute requires
      516     2502           a display position,  account for it                                        */
      517     2503
      518     2504    6                     KV@VDH_PST.PSTVAL.LIN = %KV_LIN.VRTLIN;

   2504   1 000292  CCC7 0006                            LDB,B4   Y@LIN$,AUTO
          1 000294  E844 0002                            LDR,R6   2,B4
          1 000296  EF47 001F                            STR,R6   KV@VDH_PST+2,AUTO

      519     2505    6                     KV@VDH_PST.PSTVAL.CLM = %KV_FLD.VRTCLM;

   2505   1 000298  D2C5 0002                            LLH,R5   2,B5
          1 00029A  DF47 0020                            STR,R5   KV@VDH_PST+3,AUTO
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:80   

      520     2506    7                     IF %KV_MRD.ATRRQRDSPPST THEN DO;

   2506   1 00029C  BCC6 0008                            LDB,B3   8,B6
          1 00029E  89C3 0018                            CMZ      24,B3
          1 0002A0  0881 0003                            BAGE     s:2510,PREL

      521     2507    7                        KV@VDH_PST.PSTVAL.CLM = KV@VDH_PST.PSTVAL.CLM + 1;

   2507   1 0002A2  8AC7 0020                            INC      KV@VDH_PST+3,AUTO

      522     2508    7                     END;                  /* IF                                 */

      523     2509
      524     2510    6                     %KV_SRD.HI_NONBLN.CLM = %KV_FLD.HI_NONBLNCLM+%KV_SRD.ORG.CLM;

   2510   1 0002A4  BCC6 000A                            LDB,B3   10,B6
          1 0002A6  D845 0004                            LDR,R5   4,B5
          1 0002A8  D570 00FF                            AND,R5   255,IMO
          1 0002AA  DA43 0008                            ADD,R5   8,B3
          1 0002AC  DF43 0018                            STR,R5   24,B3

      525     2511    6                     %KV_SRD.HI_NONBLN.LIN = %KV_LIN.VRTLIN+%KV_SRD.ORG.LIN;

   2511   1 0002AE  BCC6 000A                            LDB,B3   10,B6
          1 0002B0  E844 0002                            LDR,R6   2,B4
          1 0002B2  EA43 0007                            ADD,R6   7,B3
          1 0002B4  EF43 0017                            STR,R6   23,B3

      526     2512    6                     CALL KVO$PST (KV@VDH_PST);

   2512   1 0002B6  BBC7 001D                            LAB,B3   KV@VDH_PST,AUTO
          1 0002B8  BFC7 0022                            STB,B3   KV@VDH_PST+5,AUTO
          1 0002BA  BBC7 0022                            LAB,B3   KV@VDH_PST+5,AUTO
          1 0002BC  CBF0 0100                            LAB,B4   256,IMO
          1 0002BE  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          1 0002C1       0001                            DC       s:2513,PREL
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:81   

      527     2513    7                     IF %KV_MRD.SMLHDNATR THEN DO;

   2513   1 0002C2  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0002C5  DCC6 0008                            LDB,B5   8,B6
          1 0002C7  82C5 0016                            LB,'0040'X        22,B5
          1 0002C9       0040
          1 0002CA  0581 0009                            BBF      s:2519,PREL

      528     2514    7                        KV@VDH_OTPLCL.HDN = %KV_FLD.GRPRND.HDN;

   2514   1 0002CC  CCC7 0004                            LDB,B4   Y@FLD$,AUTO
          1 0002CE  E844 0003                            LDR,R6   3,B4
          1 0002D0  6041                                 SOR,R6   1
          1 0002D1  EAC7 0018                            SRM,R6,'0020'X    KV@VDH_OTPLCL,AUTO
          1 0002D3       0020

      529     2515    7                     END;                  /* IF                                 */

      530     2516
      531     2517        /* Setup the output local structure and do the write                          */
      532     2518
      533     2519    6                     KV@VDH_OTPLCL.BFR_.ADR$ = Y@FLD$;

   2519   1 0002D4  DCC7 0004                            LDB,B5   Y@FLD$,AUTO
          1 0002D6  DFC7 0019                            STB,B5   KV@VDH_OTPLCL+1,AUTO

      534     2520    6                     KV@VDH_OTPLCL.BFR_.BYTSIZ = %KV_FLD.TXTSIZ;

   2520   1 0002D8  E845 0005                            LDR,R6   5,B5
          1 0002DA  E570 00FF                            AND,R6   255,IMO
          1 0002DC  EF47 001C                            STR,R6   KV@VDH_OTPLCL+4,AUTO

      535     2521    6                     IF KV@VDH_OTPLCL.BFR_.BYTSIZ~=0

   2521   1 0002DE  6901 000D                            BEZ,R6   s:2523,PREL

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:82   
      536     2522    6                     THEN CALL KVO$OTPLCL(KV@VDH_OTPLCL) ;

   2522   1 0002E0  CBC7 0018                            LAB,B4   KV@VDH_OTPLCL,AUTO
          1 0002E2  CFC7 0022                            STB,B4   KV@VDH_PST+5,AUTO
          1 0002E4  BBC7 0022                            LAB,B3   KV@VDH_PST+5,AUTO
          1 0002E6  CBF0 0100                            LAB,B4   256,IMO
          1 0002E8  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          1 0002EB       0001                            DC       s:2523,PREL

      537     2523    7                     IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN THEN DO;

   2523   1 0002EC  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 0002EF  DC86                                 LDB,B5   ,B6
          1 0002F0  E845 001A                            LDR,R6   26,B5
          1 0002F2  6D02                                 CMV,R6   2
          1 0002F3  0981 000B                            BNE      s:2534,PREL

      538     2524        /*
      539     2525           If the new field ends in some blanks, back up to the last non-blank,
      540     2526           and use an erase function to do it instead.
      541     2527        */
      542     2528    7                        %KV_VDI.OTPCNDPND.PST = 0;

   2528   1 0002F5  8745 001A                            CL       26,B5

      543     2529    7                        %KV_SRD.CRT.CLM = %KV_MRD.DVCCLM;

   2529   1 0002F7  DCC6 000A                            LDB,B5   10,B6
          1 0002F9  CCC6 0008                            LDB,B4   8,B6
          1 0002FB  E844 001E                            LDR,R6   30,B4
          1 0002FD  EF45 0016                            STR,R6   22,B5

      544     2530    7                     END;

      545     2531
      546     2532        /* Erase to end_of_field if required. */
      547     2533
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:83   
      548     2534    6                     IF %KV_FLD.HI_NONBLNCLM>=%KV_SRD.CRT.CLM-%KV_SRD.ORG.CLM

   2534   1 0002FF  DCC6 000A                            LDB,B5   10,B6
          1 000301  E845 0016                            LDR,R6   22,B5
          1 000303  E245 0008                            SUB,R6   8,B5
          1 000305  CCC7 0004                            LDB,B4   Y@FLD$,AUTO
          1 000307  D844 0004                            LDR,R5   4,B4
          1 000309  D570 00FF                            AND,R5   255,IMO
          1 00030B  D956                                 CMR,R5   R6
          1 00030C  0801 0034                            BAL      s:2549,PREL

      549     2535    7                     THEN DO;

      550     2536    7                        KV@USR_ERS.TOPLFT_PST = %KV_SRD.CRT_PST;

   2536   1 00030E  8CC5 0015                            LDI      21,B5
          1 000310  8D47 000E                            SDI      KV@USR_ERS+1,AUTO

      551     2537    7                        KV@USR_ERS.BGNPHSCLM = KV@USR_ERS.TOPLFT.CLM;

   2537   1 000312  D847 000F                            LDR,R5   KV@USR_ERS+2,AUTO
          1 000314  DF47 0012                            STR,R5   KV@USR_ERS+5,AUTO

      552     2538    7                        KV@USR_ERS.BTMRHT.LIN = KV@USR_ERS.TOPLFT.LIN;

   2538   1 000316  C847 000E                            LDR,R4   KV@USR_ERS+1,AUTO
          1 000318  CF47 0010                            STR,R4   KV@USR_ERS+3,AUTO

      553     2539    7                        KV@USR_ERS.ENDPHSCLM = KV@VDH_PST.PSTVAL.CLM+

   2539   1 00031A  DCC6 000A                            LDB,B5   10,B6
          1 00031C  B847 0020                            LDR,R3   KV@VDH_PST+3,AUTO
          1 00031E  BA45 0008                            ADD,R3   8,B5
          1 000320  A2C4 0004                            LLH,R2   4,B4
          1 000322  AA53                                 ADD,R2   R3
          1 000323  2EFF                                 ADV,R2   -1
          1 000324  AF47 0013                            STR,R2   KV@USR_ERS+6,AUTO
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:84   

      554     2540    7                          %KV_SRD.ORG.CLM+%KV_FLD.WDT-1;
      555     2541    7                        KV@USR_ERS.BTMRHT.CLM = KV@USR_ERS.ENDPHSCLM;

   2541   1 000326  AF47 0011                            STR,R2   KV@USR_ERS+4,AUTO

      556     2542    7                        IF %KV_FLD.HI_NONBLNCLM=255

   2542   1 000328  B844 0004                            LDR,R3   4,B4
          1 00032A  B570 00FF                            AND,R3   255,IMO
          1 00032C  B970 00FF                            CMR,R3   255,IMO
          1 00032E  0981 0003                            BNE      s:2545,PREL

      557     2543    7                        THEN KV@USR_ERS.BTMRHT.CLM = KV@USR_ERS.BTMRHT.CLM+1;

   2543   1 000330  8AC7 0011                            INC      KV@USR_ERS+4,AUTO

      558     2544        /* Don't allow EL0 if we're trying to extend the visible attribute to EOF */
      559     2545    7                        IF KV@USR_ERS.BGNPHSCLM<=KV@USR_ERS.ENDPHSCLM

   2545   1 000332  D952                                 CMR,R5   R2
          1 000333  0301 000D                            BG       s:2549,PREL

      560     2546    7                        THEN CALL KVV$CALUSR (KV@USR_ERS);

   2546   1 000335  DBC7 000D                            LAB,B5   KV@USR_ERS,AUTO
          1 000337  DFC7 0022                            STB,B5   KV@VDH_PST+5,AUTO
          1 000339  BBC7 0022                            LAB,B3   KV@VDH_PST+5,AUTO
          1 00033B  CBF0 0100                            LAB,B4   256,IMO
          1 00033D  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          1 000340       0001                            DC       s:2549,PREL

      561     2547    7                     END;

      562     2548
      563     2549    6                     %KV_FLD.HI_NONBLNCLM = %KV_SRD.HI_NONBLN.CLM-%KV_SRD.ORG.CLM;

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:85   
   2549   1 000341  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          1 000344  DCC6 000A                            LDB,B5   10,B6
          1 000346  E845 0018                            LDR,R6   24,B5
          1 000348  E245 0008                            SUB,R6   8,B5
          1 00034A  CCC7 0004                            LDB,B4   Y@FLD$,AUTO
          1 00034C  EAC4 0004                            SRM,R6,'00FF'X    4,B4
          1 00034E       00FF

      564     2550    6                  END;                     /* IF                                 */

      565     2551    5                  %KV_FLD.UPD.TXT = '0'B;

   2551   1 00034F  DCC7 0004                            LDB,B5   Y@FLD$,AUTO
          1 000351  8845 0002                            LBF,'0040'X       2,B5
          1 000353       0040

      566     2552    5               END;                        /* IF                                 */

      567     2553
      568     2554        /* Next field on this line                                                    */
      569     2555
      570     2556    5               IF %KV_FLD.QLF OR %KV_FLD.INP THEN DO;

   2556   1 000354  ECC7 0004                            LDB,B6   Y@FLD$,AUTO
          1 000356  E2C6 0003                            LLH,R6   3,B6
          1 000358  6008                                 SOL,R6   8
          1 000359  6981 0006                            BNEZ,R6  s:2557,PREL
          1 00035B  82C6 0002                            LB,'0010'X        2,B6
          1 00035D       0010
          1 00035E  0581 000D                            BBF      s:2563,PREL

      571     2557    5                  Y@FLDWRDX = Y@FLDWRDX+%KV_FLD.STRWRDSIZ;

   2557   1 000360  D846 0001                            LDR,R5   1,B6
          1 000362  5008                                 SOL,R5   8
          1 000363  5068                                 SAR,R5   8
          1 000364  DA47 000B                            ADD,R5   Y@FLDWRDX,AUTO
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:86   
          1 000366  DF47 000B                            STR,R5   Y@FLDWRDX,AUTO

      572     2558    5                  Y@PRVFLD$ = Y@FLD$;

   2558   1 000368  EFC7 0008                            STB,B6   Y@PRVFLD$,AUTO

      573     2559    5               END; ELSE DO;

   2559   1 00036A  0F81 FCDE                            B        s:2324,PREL

      574     2560        /*
      575     2561           Squeeze the diseased field out of the fieldlist.
      576     2562        */
      577     2563    5                  IF Y@FLDWRDX=%KV_FLDLST.LSTENTWRDX

   2563   1 00036C  DCC7 0006                            LDB,B5   Y@LIN$,AUTO
          1 00036E  CC85                                 LDB,B4   ,B5
          1 00036F  D847 000B                            LDR,R5   Y@FLDWRDX,AUTO
          1 000371  D944 0001                            CMR,R5   1,B4
          1 000373  0981 0009                            BNE      s:2566,PREL

      578     2564    5                  THEN %KV_FLDLST.LSTENTWRDX = Y@FLDWRDX-%KV_FLD.PRVSTRWRDSIZ;

   2564   1 000375  C0C6 0001                            LDH,R4   1,B6
          1 000377  C255                                 SUB,R4   R5
          1 000378  8254                                 NEG      R4
          1 000379  CF44 0001                            STR,R4   1,B4
          1 00037B  0F81 FCCD                            B        s:2324,PREL

      579     2565    6                  ELSE DO;

      580     2566    6                     KV@USR_ERS.BGNPHSCLM = /* Bytes to move                     */

   2566   1 00037D  B844 0001                            LDR,R3   1,B4
          1 00037F  3001                                 SOL,R3   1
          1 000380  3E03                                 ADV,R3   3
          1 000381  C0B4                                 LDH,R4   ,B4,R3
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:87   
          1 000382  CA44 0001                            ADD,R4   1,B4
          1 000384  C255                                 SUB,R4   R5
          1 000385  B846 0001                            LDR,R3   1,B6
          1 000387  3008                                 SOL,R3   8
          1 000388  3068                                 SAR,R3   8
          1 000389  B254                                 SUB,R3   R4
          1 00038A  3001                                 SOL,R3   1
          1 00038B  8253                                 NEG      R3
          1 00038C  BF47 0012                            STR,R3   KV@USR_ERS+5,AUTO

      581     2567    6                       2*(%KV_FLDLST.LSTENTWRDX+PINCRW(ADDR(%KV_FLDLST),
      582     2568    6                       %KV_FLDLST.LSTENTWRDX)->KV$FLD.STRWRDSIZ-Y@FLDWRDX-
      583     2569    6                       %KV_FLD.STRWRDSIZ);
      584     2570    6                     %KV_FLDLST.LSTENTWRDX = %KV_FLDLST.LSTENTWRDX-%KV_FLD.STRWRDSIZ;

   2570   1 00038E  CC85                                 LDB,B4   ,B5
          1 00038F  E846 0001                            LDR,R6   1,B6
          1 000391  6008                                 SOL,R6   8
          1 000392  6068                                 SAR,R6   8
          1 000393  E244 0001                            SUB,R6   1,B4
          1 000395  8256                                 NEG      R6
          1 000396  EF44 0001                            STR,R6   1,B4

      585     2571    6                     %KV_NXTFLD.PRVSTRWRDSIZ = %KV_FLD.PRVSTRWRDSIZ;

   2571   1 000398  B846 0001                            LDR,R3   1,B6
          1 00039A  3008                                 SOL,R3   8
          1 00039B  3068                                 SAR,R3   8
          1 00039C  E0C6 0001                            LDH,R6   1,B6
          1 00039E  3001                                 SOL,R3   1
          1 00039F  3E02                                 ADV,R3   2
          1 0003A0  E7B6                                 STH,R6   ,B6,R3

      586     2572    6                     ADDR(%KV_FLD)->OTHER_FLDS = ADDR(%KV_NXTFLD)->OTHER_FLDS;

   2572   1 0003A1  B846 0001                            LDR,R3   1,B6
          1 0003A3  3008                                 SOL,R3   8
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:88   
          1 0003A4  3068                                 SAR,R3   8
          1 0003A5  AB86                                 LAB,B2   ,B6
          1 0003A6  A853                                 LDR,R2   R3
          1 0003A7  2001                                 SOL,R2   1
          1 0003A8  E847 0012                            LDR,R6   KV@USR_ERS+5,AUTO
          1 0003AA  BB82                                 LAB,B3   ,B2
          1 0003AB  3C00                                 LDV,R3   0
          1 0003AC  0008                                 MMM

      587     2573    6                  END;

      588     2574    5               END;

      589     2575    4            END;                           /* LOOP                               */

   2575   1 0003AD  0F81 FC9B                            B        s:2324,PREL

      590     2576    3         END;                              /* IF                                 */

      591     2577
      592     2578        /* Indicate this line is completely displayed on the real device               */
      593     2579
      594     2580    2         %KV_LIN.FRMDSP = '1'B;

   2580   1 0003AF  ECC7 0006                            LDB,B6   Y@LIN$,AUTO
          1 0003B1  8946 0003                            LBT,'0080'X       3,B6
          1 0003B3       0080

      595     2581
      596     2582        /* Next line                                                                  */
      597     2583
      598     2584    2         Y@LINWRDX = Y@LINWRDX + SIZEW(KV$LIN);

   2584   1 0003B4  E847 000C                            LDR,R6   Y@LINWRDX,AUTO
          1 0003B6  6E04                                 ADV,R6   4
          1 0003B7  EF47 000C                            STR,R6   Y@LINWRDX,AUTO

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:89   
      599     2585
      600     2586    2      END; /* LOOP */

   2586   1 0003B9  0F81 FC72                            B        s:2301,PREL

      601     2587
      602     2588        /* Indicate this devices form is completely displayed                          */
      603     2589
      604     2590    1      %KV_LINLST.FRMDSP = '1'B;

   2590   1 0003BB  8945 0005                            LBT,'0040'X       5,B5
   2590   1 0003BD       0040

      605     2591
      606     2592    1   END; /* SUBROUTINE */

   2592   1 0003BE  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
      607     2593        %EOD;

PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:90   
--  Include file information  --

   K_CP6_M.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$UPDFRM_CRT.
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:91   

 **** Variables and constants ****

  ****  Section 000 RoData KVF$UPDFRM_CRT

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(80)    r     1 Y_VDH_OTPLCL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     D-0-0/w STRC(112)   r     1 KV@USR_ERS                14-0-0/w STRC(64)    r     1 KV@USR_SETATR
    18-0-0/w STRC(80)    r     1 KV@VDH_OTPLCL             1D-0-0/w STRC(64)    r     1 KV@VDH_PST
     4-0-0/w PTR         r     1 Y@FLD$                     B-0-0/w SBIN(16)    r     1 Y@FLDWRDX
     A-0-0/b BIT         r     1 Y@FRSCLMFLD                6-0-0/w PTR         r     1 Y@LIN$
     C-0-0/w SBIN(16)    r     1 Y@LINWRDX                  8-0-0/w PTR         r     1 Y@PRVFLD$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(104)   r     1 KV_FLD
     0-0-0/w STRC(112)   r     1 KV_USR_ERS                 0-0-0/w STRC(64)    r     1 KV_USR_SETATR
     0-0-0/w STRC(64)    r     1 KV_VDH_PST_SRD

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(104)   r     1 KV$FLD                     0-0-0/w STRC(48)    r     1 KV$FLDLST
     0-0-0/w STRC(64)    r     1 KV$LIN                     0-0-0/w STRC(128)   r     1 KV$LINLST
     0-0-0/w STRC(512)   r     1 KV$MRD                     0-0-0/w STRC(480)   r     1 KV$PTR
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:92   
     0-0-0/w STRC(496)   r     1 KV$SRD                     0-0-0/w STRC(512)   r     1 KV$VDI
     0-0-0/w ACHR        r     1 OTHER_FLDS


   Procedure KVF$UPDFRM_CRT requires 961 words for executable code.
   Procedure KVF$UPDFRM_CRT requires 36 words of local(AUTO) storage.
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:93   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:94   
          MINI XREF LISTING

DCLFLD
      2338**LABEL    2399--EXIT     2409--EXIT     2421--EXIT
KV$FLD
       818**DCL      2038--DCLINIT  2572--ASSIGN   2572--ASSIGN
KV$FLD.ATRCLM
       877**DCL      2368<<ASSIGN   2462>>ASSIGN   2483>>IF
KV$FLD.GRPRND
       871**DCL      2467>>ASSIGN   2483>>IF       2493>>IF
KV$FLD.GRPRND.HDN
       873**DCL      2514>>ASSIGN
KV$FLD.HI_NONBLNCLM
       877**DCL      2494<<ASSIGN   2495>>IF       2496<<ASSIGN   2497>>IF       2510>>ASSIGN   2534>>IF
      2542>>IF       2549<<ASSIGN
KV$FLD.INP
       820**DCL      2350>>IF       2470>>IF       2556>>IF
KV$FLD.NEW
       821**DCL      2332>>IF       2343<<ASSIGN   2388>>IF       2444>>IF       2445<<ASSIGN
KV$FLD.PRVSTRWRDSIZ
       818**DCL      2564>>ASSIGN   2571<<ASSIGN   2571>>ASSIGN
KV$FLD.QLF
       843**DCL      2350>>IF       2468>>ASSIGN   2470>>IF       2556>>IF
KV$FLD.RED
       820**DCL      2452>>IF       2469>>IF       2477>>IF
KV$FLD.STRWRDSIZ
       818**DCL      2388>>IF       2398>>IF       2557>>ASSIGN   2566>>ASSIGN   2566>>ASSIGN   2570>>ASSIGN
      2571>>ASSIGN   2572>>ASSIGN
KV$FLD.TRMATRRQR
       821**DCL      2355>>IF       2365>>IF       2388>>IF       2395>>IF       2397>>IF       2441<<ASSIGN
      2471>>IF       2472<<ASSIGN
KV$FLD.TXTSIZ
       877**DCL      2398>>IF       2420>>IF       2452>>IF       2477>>IF       2497>>IF       2520>>ASSIGN
KV$FLD.UPD.ATR
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:95   
       819**DCL      2444<<ASSIGN   2459>>IF       2479>>IF       2481<<ASSIGN
KV$FLD.UPD.TXT
       819**DCL      2452>>IF       2459>>IF       2497>>IF       2551<<ASSIGN
KV$FLD.VRTCLM
       819**DCL      2344>>IF       2373>>ASSIGN   2417>>IF       2496>>ASSIGN   2497>>IF       2505>>ASSIGN
KV$FLD.WDT
       877**DCL      2373>>ASSIGN   2496>>ASSIGN   2539>>ASSIGN
KV$FLDLST
       908**DCL      2318--ASSIGN   2417--IF       2420--IF       2566--ASSIGN
KV$FLDLST.ATRCNT
       909**DCL      2356<<ASSIGN   2356>>ASSIGN   2366<<ASSIGN   2366>>ASSIGN   2367>>IF       2394<<ASSIGN
      2394>>ASSIGN   2396<<ASSIGN   2396>>ASSIGN   2423<<ASSIGN   2423>>ASSIGN   2425<<ASSIGN   2425>>ASSIGN
      2434>>IF
KV$FLDLST.LSTENTWRDX
       908**DCL      2326>>IF       2563>>IF       2564<<ASSIGN   2566>>ASSIGN   2566>>ASSIGN   2570<<ASSIGN
      2570>>ASSIGN
KV$LIN
       933**DCL      2416--IF       2417--IF       2420--IF       2423--ASSIGN   2423--ASSIGN   2425--ASSIGN
      2425--ASSIGN   2584--ASSIGN
KV$LIN.FLDLST$
       933**DCL      2326>>IF       2330>>ASSIGN   2356>>ASSIGN   2356>>ASSIGN   2366>>ASSIGN   2366>>ASSIGN
      2367>>IF       2394>>ASSIGN   2394>>ASSIGN   2396>>ASSIGN   2396>>ASSIGN   2416>>IF       2417>>IF
      2420>>IF       2423>>ASSIGN   2423>>ASSIGN   2425>>ASSIGN   2425>>ASSIGN   2434>>IF       2563>>IF
      2564>>ASSIGN   2566>>ASSIGN   2566>>ASSIGN   2566>>ASSIGN   2570>>ASSIGN   2570>>ASSIGN
KV$LIN.FRMDSP
       934**DCL      2580<<ASSIGN
KV$LIN.UPDFLDCNT
       934**DCL      2313>>IF       2314<<ASSIGN
KV$LIN.VRTLIN
       933**DCL      2382>>ASSIGN   2463>>ASSIGN   2504>>ASSIGN   2511>>ASSIGN
KV$LINLST
       961**DCL      2296--ASSIGN   2307--ASSIGN
KV$LINLST.FRMDSP
       963**DCL      2590<<ASSIGN
KV$LINLST.LSTENTWRDX
       961**DCL      2303>>IF       2415>>IF
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:96   
KV$MRD.ATRRQRDSPPST
      1319**DCL      2375>>IF       2506>>IF
KV$MRD.DCLATRWHNOTP
      1320**DCL      2332>>IF       2459>>IF       2483>>IF       2492>>IF
KV$MRD.DVCATR
      1329**DCL      2483>>IF
KV$MRD.DVCCLM
      1329**DCL      2529>>ASSIGN
KV$MRD.FRSCLMFLD
      1322**DCL      2344>>IF
KV$MRD.MAXATRPERLIN
      1312**DCL      2367>>IF       2434>>IF
KV$MRD.NO_FLDTRM
      1312**DCL      2409>>IF
KV$MRD.SMLHDNATR
      1312**DCL      2513>>IF
KV$MRD.WDT
      1308**DCL      2387>>IF
KV$PTR.INPCNDPND
       994**DCL      1003--REDEF    1007--REDEF
KV$PTR.LINLST$
       990**DCL       991--REDEF    2303>>IF       2307>>ASSIGN   2415>>IF       2590>>ASSIGN
KV$PTR.MRD$
       989**DCL      2332>>IF       2344>>IF       2367>>IF       2375>>IF       2387>>IF       2409>>IF
      2434>>IF       2459>>IF       2483>>IF       2483>>IF       2492>>IF       2506>>IF       2513>>IF
      2529>>ASSIGN
KV$PTR.SRD$
       990**DCL      2292>>ASSIGN   2344>>IF       2373>>ASSIGN   2382>>ASSIGN   2417>>IF       2462>>ASSIGN
      2463>>ASSIGN   2510>>ASSIGN   2510>>ASSIGN   2511>>ASSIGN   2511>>ASSIGN   2529>>ASSIGN   2534>>IF
      2534>>IF       2536>>ASSIGN   2539>>ASSIGN   2549>>ASSIGN   2549>>ASSIGN
KV$PTR.VDI$
       988**DCL      2523>>IF       2528>>ASSIGN
KV$PTR$
       982**DCL       988--IMP-PTR  2292>>ASSIGN   2303>>IF       2307>>ASSIGN   2332>>IF       2344>>IF
      2344>>IF       2367>>IF       2373>>ASSIGN   2375>>IF       2382>>ASSIGN   2387>>IF       2409>>IF
      2415>>IF       2417>>IF       2434>>IF       2459>>IF       2462>>ASSIGN   2463>>ASSIGN   2483>>IF
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:97   
      2483>>IF       2492>>IF       2506>>IF       2510>>ASSIGN   2510>>ASSIGN   2511>>ASSIGN   2511>>ASSIGN
      2513>>IF       2523>>IF       2528>>ASSIGN   2529>>ASSIGN   2529>>ASSIGN   2534>>IF       2534>>IF
      2536>>ASSIGN   2539>>ASSIGN   2549>>ASSIGN   2549>>ASSIGN   2590>>ASSIGN
KV$SRD.BTMRHT
      1127**DCL      1132--REDEF
KV$SRD.CRT
      1203**DCL      1208--REDEF
KV$SRD.CRT.CLM
      1205**DCL      2529<<ASSIGN   2534>>IF
KV$SRD.CRT_PST
      1208**DCL      2536>>ASSIGN
KV$SRD.FLDEND
      1167**DCL      1172--REDEF
KV$SRD.FLDEND_PST
      1172**DCL      2292<<ASSIGN
KV$SRD.HI_NONBLN
      1237**DCL      1242--REDEF
KV$SRD.HI_NONBLN.CLM
      1239**DCL      2510<<ASSIGN   2549>>ASSIGN
KV$SRD.HI_NONBLN.LIN
      1239**DCL      2511<<ASSIGN
KV$SRD.ORG
      1059**DCL      1064--REDEF
KV$SRD.ORG.CLM
      1061**DCL      2344>>IF       2373>>ASSIGN   2417>>IF       2462>>ASSIGN   2510>>ASSIGN   2534>>IF
      2539>>ASSIGN   2549>>ASSIGN
KV$SRD.ORG.LIN
      1061**DCL      2382>>ASSIGN   2463>>ASSIGN   2511>>ASSIGN
KV$SRD.SRDEND
      1272**DCL      1277--REDEF
KV$SRD.TOPLFT
      1093**DCL      1098--REDEF
KV$VDI.OTPCNDPND.PST
      1390**DCL      2523>>IF       2528<<ASSIGN
KV@USR_ERS
      1468**DCL      2287<<ASSIGN   2546<>CALL
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:98   
KV@USR_ERS.BGNPHSCLM
      1543**DCL       796--IMP-SIZ  2537<<ASSIGN   2545>>IF       2566<<ASSIGN   2572>>ASSIGN   2572>>ASSIGN
KV@USR_ERS.BTMRHT
      1535**DCL      1540--REDEF
KV@USR_ERS.BTMRHT.CLM
      1537**DCL      2541<<ASSIGN   2543<<ASSIGN   2543>>ASSIGN
KV@USR_ERS.BTMRHT.LIN
      1537**DCL      2538<<ASSIGN
KV@USR_ERS.ENDPHSCLM
      1543**DCL      2539<<ASSIGN   2541>>ASSIGN   2545>>IF
KV@USR_ERS.NO_RE_PST
      1474**DCL      2288<<ASSIGN
KV@USR_ERS.TOPLFT
      1501**DCL      1506--REDEF
KV@USR_ERS.TOPLFT.CLM
      1503**DCL      2537>>ASSIGN
KV@USR_ERS.TOPLFT.LIN
      1503**DCL      2538>>ASSIGN
KV@USR_ERS.TOPLFT_PST
      1506**DCL      2536<<ASSIGN
KV@USR_SETATR
      1676**DCL      2342<<ASSIGN   2439<>CALL     2461<<ASSIGN   2485<>CALL
KV@USR_SETATR.DLTFLD
      1682**DCL      2354<<ASSIGN   2393>>IF       2398>>IF       2420>>IF       2422>>IF       2434>>IF
      2446<<ASSIGN   2474<<ASSIGN
KV@USR_SETATR.GRPRND
      1765**DCL      2467<<ASSIGN   2479<<ASSIGN
KV@USR_SETATR.PHSPST
      1709**DCL      1714--REDEF
KV@USR_SETATR.PHSPST.CLM
      1711**DCL      2373<<ASSIGN   2376<<ASSIGN   2376>>ASSIGN   2387>>IF       2429<<ASSIGN   2462<<ASSIGN
KV@USR_SETATR.PHSPST.LIN
      1711**DCL      2382<<ASSIGN   2428<<ASSIGN   2428>>ASSIGN   2463<<ASSIGN
KV@USR_SETATR.QLF
      1738**DCL      2381<<ASSIGN   2468<<ASSIGN
KV@USR_SETATR.QLF.ACPNMR
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:99   
      1740**DCL      2469<<ASSIGN
KV@USR_SETATR.QLF.PRT
      1741**DCL      2475<<ASSIGN
KV@VDH_OTPLCL
      1931**DCL      2283<<ASSIGN   2522<>CALL
KV@VDH_OTPLCL.BFR_.ADR$
      1964**DCL      2519<<ASSIGN
KV@VDH_OTPLCL.BFR_.BYTSIZ
      1964**DCL      2520<<ASSIGN   2521>>IF
KV@VDH_OTPLCL.HDN
      1937**DCL      2514<<ASSIGN
KV@VDH_PST
      2069**DCL      2285<<ASSIGN   2512<>CALL
KV@VDH_PST.PSTVAL
      2107**DCL      2112--REDEF
KV@VDH_PST.PSTVAL.CLM
      2109**DCL      2505<<ASSIGN   2507<<ASSIGN   2507>>ASSIGN   2539>>ASSIGN
KV@VDH_PST.PSTVAL.LIN
      2109**DCL      2504<<ASSIGN
KVO$OTPLCL
      1412**DCL-ENT  2522--CALL
KVO$PST
      1411**DCL-ENT  2512--CALL
KVV$CALUSR
      1413**DCL-ENT  2439--CALL     2485--CALL     2546--CALL
KV_FLD
      2211**DCL      2319--ASSIGN
KV_USR_ERS
      1572**DCL      2287>>ASSIGN
KV_USR_ERS.BTMRHT
      1639**DCL      1644--REDEF
KV_USR_ERS.TOPLFT
      1605**DCL      1610--REDEF
KV_USR_SETATR
      1799**DCL      2342>>ASSIGN   2461>>ASSIGN
KV_USR_SETATR.PHSPST
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:100  
      1832**DCL      1837--REDEF
KV_VDH_PST_SRD
      2143**DCL      2285>>ASSIGN
KV_VDH_PST_SRD.PSTVAL
      2181**DCL      2186--REDEF
OTHER_FLDS
       796**DCL      2572<<ASSIGN   2572>>ASSIGN
Y$FLDLSTLOP
      2324**LABEL    2326--EXIT
Y$LINLSTLOP
      2301**LABEL    2303--EXIT
Y@FLD$
      1418**DCL       818--IMP-PTR   908--IMP-PTR  2330<<ASSIGN   2332>>IF       2343>>ASSIGN   2344>>IF
      2350>>IF       2350>>IF       2368>>ASSIGN   2373>>ASSIGN   2373>>ASSIGN   2388>>IF       2388>>IF
      2388>>IF       2395>>IF       2397>>IF       2398>>IF       2398>>IF       2441>>ASSIGN   2444>>IF
      2444>>ASSIGN   2445>>ASSIGN   2452>>IF       2452>>IF       2452>>IF       2459>>IF       2459>>IF
      2462>>ASSIGN   2467>>ASSIGN   2468>>ASSIGN   2469>>IF       2470>>IF       2470>>IF       2477>>IF
      2477>>IF       2479>>IF       2481>>ASSIGN   2483>>IF       2483>>IF       2493>>IF       2494>>ASSIGN
      2495>>IF       2496>>ASSIGN   2496>>ASSIGN   2496>>ASSIGN   2497>>IF       2497>>IF       2497>>IF
      2497>>IF       2505>>ASSIGN   2510>>ASSIGN   2514>>ASSIGN   2519>>ASSIGN   2520>>ASSIGN   2534>>IF
      2539>>ASSIGN   2542>>IF       2549>>ASSIGN   2551>>ASSIGN   2556>>IF       2556>>IF       2557>>ASSIGN
      2558>>ASSIGN   2564>>ASSIGN   2566>>ASSIGN   2570>>ASSIGN   2571>>ASSIGN   2571>>ASSIGN   2571>>ASSIGN
      2572>>ASSIGN   2572>>ASSIGN   2572>>ASSIGN
Y@FLDWRDX
      1435**DCL      2318<<ASSIGN   2326>>IF       2330>>ASSIGN   2557<<ASSIGN   2557>>ASSIGN   2563>>IF
      2564>>ASSIGN   2566>>ASSIGN
Y@FRSCLMFLD
      1431**DCL      2348<<ASSIGN   2349<<ASSIGN   2355>>IF       2364>>IF       2473>>IF
Y@LIN$
      1422**DCL       933--IMP-PTR  2307<<ASSIGN   2313>>IF       2314>>ASSIGN   2326>>IF       2330>>ASSIGN
      2356>>ASSIGN   2356>>ASSIGN   2366>>ASSIGN   2366>>ASSIGN   2367>>IF       2382>>ASSIGN   2394>>ASSIGN
      2394>>ASSIGN   2396>>ASSIGN   2396>>ASSIGN   2416>>IF       2417>>IF       2420>>IF       2423>>ASSIGN
      2423>>ASSIGN   2425>>ASSIGN   2425>>ASSIGN   2434>>IF       2463>>ASSIGN   2504>>ASSIGN   2511>>ASSIGN
      2563>>IF       2564>>ASSIGN   2566>>ASSIGN   2566>>ASSIGN   2566>>ASSIGN   2570>>ASSIGN   2570>>ASSIGN
      2580>>ASSIGN
Y@LINWRDX
PL6.E3A0      #003=KVF$UPDFRM_CRT File=KVF$TBLSCN.:E05TSI                        WED 07/30/97 01:59 Page:101  
      1439**DCL      2296<<ASSIGN   2303>>IF       2307>>ASSIGN   2415>>IF       2584<<ASSIGN   2584>>ASSIGN
Y@PRVFLD$
      1426**DCL      2319<<ASSIGN   2355>>IF       2365>>IF       2471>>IF       2472>>ASSIGN   2558<<ASSIGN
Y_VDH_OTPLCL
      2005**DCL      2283>>ASSIGN

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:102  
      608        1        /*T***********************************************************/
      609        2        /*T*                                                         */
      610        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      611        4        /*T*                                                         */
      612        5        /*T***********************************************************/
      613        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
      614        7        KVF$PST: PROC(PRM_VDH_PST);
      615        8
      616        9        /* The purpose of this routine is to translate a relative
      617       10           positioing request into an actual field location,  and then
      618       11           co-ordinate the operations of positioning to that field and getting
      619       12           a read up. This involves translating the information in the
      620       13           KV$VDH_PST structure into an actual field location-loading
      621       14           that field location into a temporary KV$PTR and then calling
      622       15           a routine (there's one for CRT's and one for hardcopy),  that
      623       16           understands where we are on the form,  looks at where we want
      624       17           to go,  and simply gets us there. Once there,  a read is started.
      625       18           This routine will also be nice enough to terminate the current
      626       19           read if we are in an input field at call time.                             */
      627       20
      628       21 S      %INCLUDE KV$GLB;
      629       22 S      %INCLUDE KV$GLBCTX;
      630       23 S      %INCLUDE KV_GLBCNS_E;
      631       24 S      %INCLUDE KV$INT;
      632       25 S      %INCLUDE KV$VDH;
      633       26
      634       27        %KV$PTR;
      635       70        %KV$FLD (STCLASS="BASED(KV@PTR.FLD$)", LAST=",");
      636      158        %EQU KV_FLD = CHARTEXT('KV$FLD');
      637      159    1          2 TXTCHR REDEF TXT CHAR(KV$FLD.WDT) UNAL;
      638      160        %KV$FLDLST (STCLASS="BASED(KV@PTR.FLDLST$)");
      639      184        %EQU KV_FLDLST = CHARTEXT('KV$FLDLST');
      640      185        %KV$LIN (STCLASS="BASED(KV@PTR.LIN$)");
      641      209        %EQU KV_LIN = CHARTEXT('KV$LIN');
      642      210        %KV$LINLST (STCLASS="BASED(KV@PTR.LINLST$)");
      643      237        %EQU KV_LINLST = CHARTEXT('KV$LINLST');
      644      238        %KV$MVD (STCLASS="BASED(KV@PTR.MVD$)");
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:103  
      645      282        %EQU KV_MVD = CHARTEXT('KV$MVD');
      646      283        %KV$SRD (STCLASS="BASED(KV@PTR.SRD$)");
      647      558        %EQU KV_SRD = CHARTEXT('KV$SRD');
      648      559        %KV$SSN (STCLASS="BASED(KV@PTR.SSN$)");
      649      638        %EQU KV_SSN = CHARTEXT('KV$SSN');
      650      639        %KV$STR (STCLASS="BASED(KV@PTR.STR$)");
      651      726        %EQU KV_STR = CHARTEXT('KV$STR');
      652      727        %KV$VDI (STCLASS="BASED(KV@PTR.VDI$)");
      653      798        %EQU KV_VDI = CHARTEXT('KV$VDI');
      654      799        %KV_PSTORG_E;
      655      804        %KV_PTR_STT_E;
      656      819        %KV_LINLST_SLCFLDSTT_E;
      657      825        %KV_INPUNT_E;
      658      830        %KV_PSTUNT_E;
      659      836
      660      837    1   DCL KVF$ALLFLD_RSTRED ENTRY ALTRET;
      661      838    1   DCL KVF$NXTFLD ENTRY;
      662      839    1   DCL KVF$REDFRM ENTRY;
      663      840    1   DCL KVF$SND ENTRY;
      664      841    1   DCL KVF$UPDFRM_CRT ENTRY;
      665      842    1   DCL KVF$UPDFRM_HRDCPY ENTRY(1);
      666      843    1   DCL KVI$PRGRED ENTRY;
      667      844    1   DCL KVI$RE_DSPINP ENTRY;
      668      845    1   DCL KVI$TRMRED_VDH_DAT ENTRY(1);
      669      846    1   DCL KVO$PST ENTRY(1);
      670      847    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
      671      848
      672      849
      673      850        /* Working column                                                             */
      674      851
      675      852    1   DCL Y@CLM SBIN WORD;
      676      853
      677      854        /* Working line                                                               */
      678      855
      679      856    1   DCL Y@LIN SBIN WORD;
      680      857
      681      858        /* Vertical search direction                                                  */
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:104  
      682      859
      683      860    1   DCL Y@SRCDWN BIT(1) WALIGNED AUTO;
      684      861
      685      862        /* Misc.                                                                      */
      686      863
      687      864        /*
      688      865        Structure framing the characters in a KV$REDBFR.
      689      866        */
      690      867    1   DCL Y$REDBFR CHAR(Y@FLDTXTSIZ) WALIGNED BASED;
      691      868        /*
      692      869        Field text size, for moving the text from a read buffer to the
      693      870        KV$FLD entry.
      694      871        */
      695      872    1   DCL Y@FLDTXTSIZ UBIN BYTE AUTO;
      696      873
      697      874        %KV$PTR (NAME = KV@PTR, STCLASS = AUTO);
      698      917        %KV$VDH_PST (NAME = PRM_VDH_PST, STCLASS = PARAM);
      699      991    1   DCL KV_VDH_PST_ENDFRM UBIN SYMREF;
      700      992    1   DCL KV_VDH_PST_HOM UBIN SYMREF;
      701      993    1   DCL KV_VDH_PST_NEWLIN_VRT UBIN SYMREF;
      702      994        %EJECT;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:105  
      703      995    1      KV$PTR.STT = 0;
      704      996    1      KV@PTR = KV$PTR;
      705      997
      706      998    2      IF %KV_MVD.FRMSCNINH THEN DO;
      707      999
      708     1000        /* The form scan inhibit flag is on,  we have previously
      709     1001           entered this code and ended up going off to the RDH to do
      710     1002           a read that could not be satisfied by typeahead. Now that
      711     1003           the read has been satisfied,  we're being called back. We want to
      712     1004           ignore this call,  since we'll eventually unwind back to the
      713     1005           place we did the read from.                                                */
      714     1006
      715     1007    2         RETURN;
      716     1008    2      END; /* IF */
      717     1009
      718     1010        /* Set form scan inhibit to prevent recursion                                 */
      719     1011
      720     1012    1      %KV_MVD.FRMSCNINH = '1'B;
      721     1013
      722     1014        /* Check to see if we were in an input field,  and if we were, terminate
      723     1015           the outstanding read                                                       */
      724     1016
      725     1017    2      IF %KV_FLD.INP THEN DO;
      726     1018
      727     1019        /* Copy the data,  set snd if updated                                         */
      728     1020
      729     1021    2         %KV_FLD.TXTSIZ = MINIMUM (%KV_SSN.REDBFR__.DATBYTSIZ, %KV_FLD.WDT);
      730     1022    2         Y@FLDTXTSIZ = %KV_FLD.TXTSIZ;
      731     1023    2         %KV_FLD.SND = '1'B;
      732     1024    3         IF %KV_SSN.REDBFR__.DATBYTSIZ > 0 THEN DO;
      733     1025
      734     1026        /* There is data in the read buffer to move. */
      735     1027
      736     1028    3            %KV_FLD.TXTCHR = %KV_SSN.REDBFR__.ADR$->Y$REDBFR;
      737     1029    3         END;                              /* END IF DATBYTSIZ > 0               */
      738     1030    3         IF %KV_VDI.RE_DSPINP THEN DO;
      739     1031    3            CALL KVI$RE_DSPINP;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:106  
      740     1032    3            %KV_VDI.RE_DSPINP = '1'B;
      741     1033    3            %KV_VDI.RE_DSPLOWX = 0;
      742     1034    3         END;                              /* IF                                 */
      743     1035    2         %KV_SRD.FLDEND_PST = 0;
      744     1036    2         KV@PTR.VRTCLM = %KV_FLD.VRTCLM;
      745     1037    2         %KV_FLD.HI_NONBLNCLM = %KV_SRD.HI_NONBLN.CLM-%KV_SRD.ORG.CLM;
      746     1038    2      END; /* IF */
      747     1039
      748     1040        /* Repaint the screen if it's been requested                                  */
      749     1041
      750     1042    2      IF NOT %KV_LINLST.FRMDSP AND %KV_MVD.RETYPOVR THEN DO;
      751     1043    2         CALL KVF$UPDFRM_CRT;
      752     1044    2      END; /* IF */
      753     1045
      754     1046        /* If there are no selected fields,  dont bother to waste any more time       */
      755     1047
      756     1048    2      IF (%KV_LINLST.SLCFLDSTT = %KV_LINLST_SLCFLDSTT_NON) THEN DO;
      757     1049    2         KV$PTR.STT = %KV_PTR_STT_NO_FLD;
      758     1050    2         %KV_MVD.FRMSCNINH = '0'B;
      759     1051    2         RETURN;
      760     1052    2      END; /* IF */
      761     1053
      762     1054    2      IF ADDR(PRM_VDH_PST)=ADDR(KV_VDH_PST_ENDFRM) THEN DO;
      763     1055
      764     1056        /* Must be time to return the data                                            */
      765     1057
      766     1058        /* Reset all KV$FLD.RED flags.  If blockmode device, protect the input fields
      767     1059           and echo the input                                                         */
      768     1060
      769     1061    2         CALL KVF$ALLFLD_RSTRED;
      770     1062    3         IF (%KV_VDI.INPUNT = %KV_INPUNT_BLK) THEN DO;
      771     1063    3            CALL KVF$UPDFRM_CRT;
      772     1064    3         END;                              /* IF                                 */
      773     1065    2         %KV_STR.EDTBFR__ = '0'B;
      774     1066    3         IF %KV_MVD.RETYPOVR THEN DO;
      775     1067    3            %KV_VDI.RE_DSPINP = '0'B;
      776     1068    3            IF %KV_SRD.PRKCRS THEN CALL KVO$PST(KV_VDH_PST_HOM);
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:107  
      777     1069    3         END; ELSE DO;
      778     1070    3            %KV_SRD.NXTNONBLNLIN =
      779     1071    3              %KV_SRD.NXTNONBLNLIN + 1;
      780     1072    3            CALL KVO$PST(KV_VDH_PST_NEWLIN_VRT);
      781     1073    3         END;                              /* IF                                 */
      782     1074        /*
      783     1075           Remember a few items for eventual transmission to the user.
      784     1076        */
      785     1077    2         %KV_STR.ERR.VDOTYP = ASCBIN(%KV_SSN.INPCHR);
      786     1078    2         %KV_LINLST.ERRFLDID = %KV_FLD.ID;
      787     1079    2         IF %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR.NXTX THEN %KV_STR.RE_REDCLM = 0;
      788     1080    2         ELSE %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;
      789     1081    2         CALL KVI$PRGRED;
      790     1082    2         CALL KVI$TRMRED_VDH_DAT;
      791     1083    2         IF %KV_LINLST.SLCFLDSTT~=%KV_LINLST_SLCFLDSTT_ONE
      792     1084    2         THEN %KV_LINLST.ONEFLDLIN$ = PINCRW(ADDR(%KV_LINLST), SIZEW(KV$LINLST));
      793     1085    2         CALL KVF$SND;
      794     1086    2         RETURN;
      795     1087    2      END;
      796     1088        %EJECT;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:108  
      797     1089        /* If there is only one field selected,  dont bother to search. */
      798     1090
      799     1091    2      IF %KV_LINLST.SLCFLDSTT~=%KV_LINLST_SLCFLDSTT_ONE THEN DO;
      800     1092
      801     1093        /* Start by calculating which line within the form to position to             */
      802     1094
      803     1095    2         Y@SRCDWN = '1'B;
      804     1096    2         Y@LIN = PRM_VDH_PST.PSTVAL.LIN;
      805     1097        /* Check for absolute vs. Relative positioing                                 */
      806     1098
      807     1099    2         IF PRM_VDH_PST.VRTPSTORG=%KV_PSTORG_ABS
      808     1100    2         THEN Y@LIN = Y@LIN-%KV_SRD.ORG.LIN;
      809     1101
      810     1102        /* Might be SRD-relative, too. */
      811     1103
      812     1104    3         ELSE IF PRM_VDH_PST.VRTPSTORG~=%KV_PSTORG_SRD THEN DO;
      813     1105        /* Otherwise,  we have relative virtual positioning                           */
      814     1106
      815     1107        /* Whether the eventual input field search direction should be
      816     1108           up or down is dependant on whether vrtpstval is pos or neg                 */
      817     1109
      818     1110    3            IF Y@LIN<0 THEN Y@SRCDWN = '0'B; /* Search up                        */
      819     1111    3            Y@LIN = Y@LIN+KV@PTR.VRTLIN;
      820     1112    3         END;                              /* IF                                 */
      821     1113
      822     1114        /* Next we evaluate the horizontal positioing request. In order
      823     1115           to do this,  we must first determine if the horiz. Pos units are
      824     1116           in fields or columns                                                       */
      825     1117
      826     1118    3         IF (PRM_VDH_PST.HRZPSTUNT = %KV_PSTUNT_CLM) THEN DO;
      827     1119
      828     1120        /* The positioning unit specified columns. Determine whether the
      829     1121           units specified are absolute or relative                                   */
      830     1122
      831     1123    3            Y@CLM = PRM_VDH_PST.PSTVAL.CLM;
      832     1124    3            IF PRM_VDH_PST.HRZPSTORG=%KV_PSTORG_ABS
      833     1125    3            THEN Y@CLM = Y@CLM-%KV_SRD.ORG.CLM;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:109  
      834     1126    3            ELSE IF PRM_VDH_PST.HRZPSTORG=%KV_PSTORG_CRTPST
      835     1127    3            THEN Y@CLM = KV@PTR.VRTCLM+Y@CLM;
      836     1128
      837     1129        /* If the column is greater than the line width or equal to 0,  we need
      838     1130           to either wrap or unwrap the line before we continue                       */
      839     1131
      840     1132    4            DO WHILE Y@CLM<=0;
      841     1133    4               Y@LIN = Y@LIN - 1;
      842     1134    4               Y@CLM = %KV_MVD.WDT + Y@CLM;
      843     1135    4            END;
      844     1136    4            DO WHILE Y@CLM>%KV_MVD.WDT;
      845     1137    4               Y@CLM = Y@CLM - %KV_MVD.WDT;
      846     1138    4               Y@LIN = Y@LIN + 1;
      847     1139    4            END;                           /* IF                                 */
      848     1140    4            DO WHILE Y@LIN<=0;
      849     1141    4               Y@LIN = Y@LIN+%KV_SRD.MINLNG;
      850     1142    4            END;
      851     1143    4            DO WHILE Y@LIN>%KV_SRD.MINLNG;
      852     1144    4               Y@LIN = Y@LIN-%KV_SRD.MINLNG;
      853     1145    4            END;
      854     1146
      855     1147        /* Find the closest selected input field to the desired line and column. */
      856     1148
      857     1149    3            KV@PTR.VRTLIN = (Y@LIN-1)*SIZEW(KV$LIN)+SIZEW(KV$LINLST);
      858     1150    3            KV@PTR.FLDWRDX = 0;
      859     1151    4   FLDLST0: DO WHILE '1'B;
      860     1152    4               KV@PTR.LIN$ = PINCRW(KV@PTR.LINLST$, KV@PTR.VRTLIN);
      861     1153    4               KV@PTR.FLDLST$ = %KV_LIN.FLDLST$;
      862     1154    4               Y@LIN = SIZEW(KV$FLDLST);
      863     1155    4               IF KV@PTR.FLDLST$~=ADDR(NIL) THEN
      864     1156    5   FLDLST1:    DO WHILE Y@LIN<=%KV_FLDLST.LSTENTWRDX;
      865     1157    5                  KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$, Y@LIN);
      866     1158    6                  IF %KV_FLD.RED THEN DO;
      867     1159    6                     IF KV@PTR.FLDWRDX~=0
      868     1160    6                     THEN IF %KV_FLD.VRTCLM-Y@CLM>=
      869     1161    6                       Y@CLM-PINCRW(KV@PTR.FLDLST$,KV@PTR.FLDWRDX)->KV$FLD.VRTCLM
      870     1162    6                     THEN EXIT FLDLST1;    /* Past it too far                    */
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:110  
      871     1163    6                     KV@PTR.FLDWRDX = Y@LIN;
      872     1164    6                     IF %KV_FLD.VRTCLM>=Y@CLM THEN EXIT FLDLST1; /* gets worse   */
      873     1165    6                  END;
      874     1166    5                  Y@LIN = Y@LIN+%KV_FLD.STRWRDSIZ;
      875     1167    5               END FLDLST1;
      876     1168    5               IF KV@PTR.FLDWRDX~=0 THEN DO;
      877     1169    5                  KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$, KV@PTR.FLDWRDX);
      878     1170    5                  EXIT FLDLST0;
      879     1171    5               END;
      880     1172    5               IF Y@SRCDWN THEN DO;
      881     1173    5                  IF KV@PTR.VRTLIN<%KV_LINLST.LSTENTWRDX
      882     1174    5                  THEN KV@PTR.VRTLIN = KV@PTR.VRTLIN+SIZEW(KV$LIN);
      883     1175    5                  ELSE KV@PTR.VRTLIN = SIZEW(KV$LINLST);
      884     1176    5               END; ELSE DO;
      885     1177    5                  IF KV@PTR.VRTLIN>SIZEW(KV$LINLST)
      886     1178    5                  THEN KV@PTR.VRTLIN = KV@PTR.VRTLIN-SIZEW(KV$LIN);
      887     1179    5                  ELSE KV@PTR.VRTLIN = %KV_LINLST.LSTENTWRDX;
      888     1180    5               END;
      889     1181    4            END FLDLST0;
      890     1182
      891     1183        /* Otherwise,  the horizontal positioing units are specified as
      892     1184           fields. Do a little search to get KV@PTR loaded with
      893     1185           the location of the indicated field.                                       */
      894     1186
      895     1187    3         END; ELSE DO;
      896     1188
      897     1189        /* Get the field count to position by. */
      898     1190
      899     1191    3            Y@CLM = PRM_VDH_PST.PSTVAL.CLM;
      900     1192
      901     1193        /* If we're to start on a different line, get there.
              1193          */
      902     1194
      903     1195    4            IF Y@LIN~=KV@PTR.VRTLIN THEN DO;
      904     1196    4               Y@LIN = (Y@LIN-1)*SIZEW(KV$LIN)+SIZEW(KV$LINLST);
      905     1197    4               KV@PTR.FLDWRDX = SIZEW(KV$FLDLST);
      906     1198    5               IF Y@LIN<SIZEW(KV$LINLST) THEN DO;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:111  
      907     1199    5                  Y@LIN = SIZEW(KV$LINLST)-SIZEW(KV$LIN);
      908     1200    5                  KV@PTR.FLDWRDX = 0;
      909     1201    5               END; ELSE IF Y@LIN>%KV_LINLST.LSTENTWRDX THEN DO;
      910     1202    5                  Y@LIN = %KV_LINLST.LSTENTWRDX+SIZEW(KV$LIN);
      911     1203    5                  KV@PTR.FLDWRDX = 0;
      912     1204    5               END; ELSE DO;
      913     1205    5                  KV@PTR.LIN$ = PINCRW(KV@PTR.LINLST$,Y@LIN);
      914     1206    5                  KV@PTR.FLDLST$ = %KV_LIN.FLDLST$;
      915     1207    5                  IF KV@PTR.FLDLST$=ADDR(NIL) THEN KV@PTR.FLDWRDX = 0;
      916     1208    5               END;
      917     1209    4               IF PRM_VDH_PST.HRZPSTORG=%KV_PSTORG_ABS
      918     1210    4                 OR KV@PTR.FLDWRDX=0 THEN EXIT;
      919     1211    5   FLDLST2:    DO WHILE '1'B;
      920     1212    5                  KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$, KV@PTR.FLDWRDX);
      921     1213    5                  IF %KV_FLD.VRTCLM=KV@PTR.VRTCLM THEN EXIT FLDLST2;
      922     1214    6                  IF %KV_FLD.VRTCLM>KV@PTR.VRTCLM THEN DO;
      923     1215    6                     IF Y@CLM<0 THEN EXIT FLDLST2;
      924     1216    6                     KV@PTR.FLDWRDX = KV@PTR.FLDWRDX-%KV_FLD.PRVSTRWRDSIZ;
      925     1217    6                     IF KV@PTR.FLDWRDX=0 THEN Y@LIN = Y@LIN-SIZEW(KV$LIN);
      926     1218    6                     ELSE KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$,KV@PTR.FLDWRDX);
      927     1219    6                     EXIT FLDLST2;
      928     1220    6                  END;
      929     1221    6                  IF KV@PTR.FLDWRDX>=%KV_FLDLST.LSTENTWRDX THEN DO;
      930     1222    6                     IF Y@CLM>0 THEN EXIT FLDLST2;
      931     1223    6                     KV@PTR.FLDWRDX = 0;
      932     1224    6                     Y@LIN = Y@LIN+SIZEW(KV$LIN);
      933     1225    6                     EXIT FLDLST2;
      934     1226    5                  END; ELSE KV@PTR.FLDWRDX = KV@PTR.FLDWRDX+%KV_FLD.STRWRDSIZ;
      935     1227    5               END FLDLST2;
      936     1228    4            END;                           /* IF going to a different line       */
      937     1229    3            ELSE Y@LIN = (Y@LIN-1)*SIZEW(KV$LIN)+SIZEW(KV$LINLST);
      938     1230
      939     1231        /* If ABS field number is specified, indicate that we're between lines */
      940     1232
      941     1233    4            IF PRM_VDH_PST.HRZPSTORG=%KV_PSTORG_ABS THEN DO;
      942     1234    4               KV@PTR.FLDWRDX = 0;
      943     1235    4               IF Y@CLM>0 THEN Y@LIN = Y@LIN-SIZEW(KV$LIN);
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:112  
      944     1236    4            END;
      945     1237
      946     1238        /* Now count Y@CLM input fields from the indicated KV@PTR position. */
      947     1239
      948     1240    4   FLDLST3: DO WHILE '1'B;
      949     1241    4               IF KV@PTR.FLDWRDX~=0 THEN IF Y@CLM>=0
      950     1242    4               THEN IF KV@PTR.FLDWRDX<%KV_FLDLST.LSTENTWRDX
      951     1243    4               THEN KV@PTR.FLDWRDX = KV@PTR.FLDWRDX+%KV_FLD.STRWRDSIZ;
      952     1244    4               ELSE KV@PTR.FLDWRDX = 0;
      953     1245    4               ELSE /*Y@CLM<0*/ IF KV@PTR.FLDWRDX>SIZEW(KV$FLDLST)
      954     1246    4               THEN KV@PTR.FLDWRDX = KV@PTR.FLDWRDX-%KV_FLD.PRVSTRWRDSIZ;
      955     1247    4               ELSE KV@PTR.FLDWRDX = 0;
      956     1248
      957     1249        /* FLDWRDX now at the next field or zero if a line-change is needed */
      958     1250
      959     1251    5               IF KV@PTR.FLDWRDX=0 THEN DO;
      960     1252    5                  IF Y@CLM>=0 THEN IF Y@LIN<%KV_LINLST.LSTENTWRDX
      961     1253    5                  THEN Y@LIN = Y@LIN+SIZEW(KV$LIN);
      962     1254    6                  ELSE DO;            /* ran out of fields, find the last one    */
      963     1255    6                     Y@LIN = %KV_LINLST.LSTENTWRDX;
      964     1256    6                     Y@CLM = -1;
      965     1257    6                  END;
      966     1258    5                  ELSE /*Y@CLM<0*/ IF Y@LIN>SIZEW(KV$LINLST)
      967     1259    5                  THEN Y@LIN = Y@LIN-SIZEW(KV$LIN);
      968     1260    6                  ELSE DO;            /* ran out t'other way, find the first     */
      969     1261    6                     Y@LIN = SIZEW(KV$LINLST);
      970     1262    6                     Y@CLM = 1;
      971     1263    6                  END;
      972     1264    5                  KV@PTR.LIN$ = PINCRW(KV@PTR.LINLST$, Y@LIN);
      973     1265    5                  KV@PTR.FLDLST$ = %KV_LIN.FLDLST$;
      974     1266    5                  IF KV@PTR.FLDLST$~=ADDR(NIL)
      975     1267    5                  THEN IF Y@CLM>=0 THEN KV@PTR.FLDWRDX = SIZEW(KV$FLDLST);
      976     1268    5                  ELSE KV@PTR.FLDWRDX = %KV_FLDLST.LSTENTWRDX;
      977     1269    5               END;
      978     1270
      979     1271        /* Time to take a peek at the next field. */
      980     1272
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:113  
      981     1273    5               IF KV@PTR.FLDWRDX~=0 THEN DO;
      982     1274    5                  KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$, KV@PTR.FLDWRDX);
      983     1275    6                  IF %KV_FLD.RED THEN DO;
      984     1276    6                     IF Y@CLM>0 THEN Y@CLM=Y@CLM-1;
      985     1277    6                     ELSE IF Y@CLM<0 THEN Y@CLM = Y@CLM+1;
      986     1278    6                     IF Y@CLM=0 THEN EXIT FLDLST3;
      987     1279    6                  END;
      988     1280    5               END;
      989     1281    4            END FLDLST3;
      990     1282    3         END;                              /* IF                                 */
      991     1283    2      END;
      992     1284
      993     1285        /* Hopefully,  at this point,  we have 2 KV$PTR's setup. One tells
      994     1286           us where we are and the other tells us where we want to be
      995     1287           we now call a routine to get us where we need to go and post a new
      996     1288           read. The routine called depends on whether we are dealing
      997     1289           with a hardcopy device or a CRT.                                           */
      998     1290
      999     1291        /* Get the right line display for hardcopy forms                              */
     1000     1292
     1001     1293    1      IF NOT %KV_MVD.RETYPOVR THEN CALL KVF$UPDFRM_HRDCPY(%KV_LIN);
     1002     1294    1      %KV_LINLST.ONEFLDLIN$ = KV@PTR.LIN$;
     1003     1295    1      %KV_LINLST.ONEFLDWRDX = KV@PTR.FLDWRDX;
     1004     1296    1      %KV_STR.RE_REDCLM = 1;
     1005     1297    1      CALL KVF$REDFRM;
     1006     1298
     1007     1299        /* Reset form scan inhibit                                                    */
     1008     1300
     1009     1301    1      %KV_MVD.FRMSCNINH = '0'B;
     1010     1302    1      RETURN;
     1011     1303    1   END; /* SUBROUTINE */
     1012     1304        %EOD;

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:114  
--  Include file information  --

   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$PST.

   Procedure KVF$PST requires 929 words for executable code.
   Procedure KVF$PST requires 41 words of local(AUTO) storage.

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:115  

 Object Unit name= KVF$PST                                    File name= KVF$TBLSCN.:E05TOU
 UTS= JUL 30 '97 02:00:16.36 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   929    3A1  KVF$PST
    1  RoData even  none     4      4  KVF$PST

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KVF$PST

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 KVI$RE_DSPINP
 yes     yes           Std       0 KVF$ALLFLD_RSTRED
         yes           Std       0 KVI$PRGRED
         yes           Std       0 KVF$SND
         yes           Std       1 KVF$UPDFRM_HRDCPY
         yes           Std       0 KVF$REDFRM
         yes           Std       0 KVF$UPDFRM_CRT
         yes           Std       1 KVO$PST
         yes           Std       1 KVI$TRMRED_VDH_DAT
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:116  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               KV_VDH_PST_ENDFRM                     KV_VDH_PST_HOM
     KV_VDH_PST_NEWLIN_VRT            r    G$ROS$
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:117  


      608        1        /*T***********************************************************/
      609        2        /*T*                                                         */
      610        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      611        4        /*T*                                                         */
      612        5        /*T***********************************************************/
      613        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
      614        7        KVF$PST: PROC(PRM_VDH_PST);

      7   0 000000  D380 0000 0000  xent KVF$PST         LNJ,B5   X6A_AUTO_1
          0 000003       0029 0001                       DC       41,1

      615        8
      616        9        /* The purpose of this routine is to translate a relative
      617       10           positioing request into an actual field location,  and then
      618       11           co-ordinate the operations of positioning to that field and getting
      619       12           a read up. This involves translating the information in the
      620       13           KV$VDH_PST structure into an actual field location-loading
      621       14           that field location into a temporary KV$PTR and then calling
      622       15           a routine (there's one for CRT's and one for hardcopy),  that
      623       16           understands where we are on the form,  looks at where we want
      624       17           to go,  and simply gets us there. Once there,  a read is started.
      625       18           This routine will also be nice enough to terminate the current
      626       19           read if we are in an input field at call time.                             */
      627       20
      628       21 S      %INCLUDE KV$GLB;
      629       22 S      %INCLUDE KV$GLBCTX;
      630       23 S      %INCLUDE KV_GLBCNS_E;
      631       24 S      %INCLUDE KV$INT;
      632       25 S      %INCLUDE KV$VDH;
      633       26
      634       27        %KV$PTR;
      635       70        %KV$FLD (STCLASS="BASED(KV@PTR.FLD$)", LAST=",");
      636      158        %EQU KV_FLD = CHARTEXT('KV$FLD');
      637      159    1          2 TXTCHR REDEF TXT CHAR(KV$FLD.WDT) UNAL;
      638      160        %KV$FLDLST (STCLASS="BASED(KV@PTR.FLDLST$)");
      639      184        %EQU KV_FLDLST = CHARTEXT('KV$FLDLST');
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:118  
      640      185        %KV$LIN (STCLASS="BASED(KV@PTR.LIN$)");
      641      209        %EQU KV_LIN = CHARTEXT('KV$LIN');
      642      210        %KV$LINLST (STCLASS="BASED(KV@PTR.LINLST$)");
      643      237        %EQU KV_LINLST = CHARTEXT('KV$LINLST');
      644      238        %KV$MVD (STCLASS="BASED(KV@PTR.MVD$)");
      645      282        %EQU KV_MVD = CHARTEXT('KV$MVD');
      646      283        %KV$SRD (STCLASS="BASED(KV@PTR.SRD$)");
      647      558        %EQU KV_SRD = CHARTEXT('KV$SRD');
      648      559        %KV$SSN (STCLASS="BASED(KV@PTR.SSN$)");
      649      638        %EQU KV_SSN = CHARTEXT('KV$SSN');
      650      639        %KV$STR (STCLASS="BASED(KV@PTR.STR$)");
      651      726        %EQU KV_STR = CHARTEXT('KV$STR');
      652      727        %KV$VDI (STCLASS="BASED(KV@PTR.VDI$)");
      653      798        %EQU KV_VDI = CHARTEXT('KV$VDI');
      654      799        %KV_PSTORG_E;
      655      804        %KV_PTR_STT_E;
      656      819        %KV_LINLST_SLCFLDSTT_E;
      657      825        %KV_INPUNT_E;
      658      830        %KV_PSTUNT_E;
      659      836
      660      837    1   DCL KVF$ALLFLD_RSTRED ENTRY ALTRET;
      661      838    1   DCL KVF$NXTFLD ENTRY;
      662      839    1   DCL KVF$REDFRM ENTRY;
      663      840    1   DCL KVF$SND ENTRY;
      664      841    1   DCL KVF$UPDFRM_CRT ENTRY;
      665      842    1   DCL KVF$UPDFRM_HRDCPY ENTRY(1);
      666      843    1   DCL KVI$PRGRED ENTRY;
      667      844    1   DCL KVI$RE_DSPINP ENTRY;
      668      845    1   DCL KVI$TRMRED_VDH_DAT ENTRY(1);
      669      846    1   DCL KVO$PST ENTRY(1);
      670      847    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
      671      848
      672      849
      673      850        /* Working column                                                             */
      674      851
      675      852    1   DCL Y@CLM SBIN WORD;
      676      853
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:119  
      677      854        /* Working line                                                               */
      678      855
      679      856    1   DCL Y@LIN SBIN WORD;
      680      857
      681      858        /* Vertical search direction                                                  */
      682      859
      683      860    1   DCL Y@SRCDWN BIT(1) WALIGNED AUTO;
      684      861
      685      862        /* Misc.                                                                      */
      686      863
      687      864        /*
      688      865        Structure framing the characters in a KV$REDBFR.
      689      866        */
      690      867    1   DCL Y$REDBFR CHAR(Y@FLDTXTSIZ) WALIGNED BASED;
      691      868        /*
      692      869        Field text size, for moving the text from a read buffer to the
      693      870        KV$FLD entry.
      694      871        */
      695      872    1   DCL Y@FLDTXTSIZ UBIN BYTE AUTO;
      696      873
      697      874        %KV$PTR (NAME = KV@PTR, STCLASS = AUTO);
      698      917        %KV$VDH_PST (NAME = PRM_VDH_PST, STCLASS = PARAM);
      699      991    1   DCL KV_VDH_PST_ENDFRM UBIN SYMREF;
      700      992    1   DCL KV_VDH_PST_HOM UBIN SYMREF;
      701      993    1   DCL KV_VDH_PST_NEWLIN_VRT UBIN SYMREF;
      702      994        %EJECT;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:120  
      703      995    1      KV$PTR.STT = 0;

    995   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  87C6 001D                            CLH      29,B6

      704      996    1      KV@PTR = KV$PTR;

    996   0 00000A  AB86                                 LAB,B2   ,B6
          0 00000B  2C00                                 LDV,R2   0
          0 00000C  6C3C                                 LDV,R6   60
          0 00000D  BB87                                 LAB,B3   ,AUTO
          0 00000E  3C14                                 LDV,R3   20
          0 00000F  0008                                 MMM

      705      997
      706      998    2      IF %KV_MVD.FRMSCNINH THEN DO;

    998   0 000010  DCC7 0010                            LDB,B5   KV@PTR+6,AUTO
          0 000012  82C5 0016                            LB,'0010'X        22,B5
          0 000014       0010
          0 000015  0581 0004                            BBF      s:1012,PREL

      707      999
      708     1000        /* The form scan inhibit flag is on,  we have previously
      709     1001           entered this code and ended up going off to the RDH to do
      710     1002           a read that could not be satisfied by typeahead. Now that
      711     1003           the read has been satisfied,  we're being called back. We want to
      712     1004           ignore this call,  since we'll eventually unwind back to the
      713     1005           place we did the read from.                                                */
      714     1006
      715     1007    2         RETURN;

   1007   0 000017  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      716     1008    2      END; /* IF */
      717     1009
      718     1010        /* Set form scan inhibit to prevent recursion                                 */
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:121  
      719     1011
      720     1012    1      %KV_MVD.FRMSCNINH = '1'B;

   1012   0 00001A  8945 0016                            LBT,'0010'X       22,B5
   1012   0 00001C       0010

      721     1013
      722     1014        /* Check to see if we were in an input field,  and if we were, terminate
      723     1015           the outstanding read                                                       */
      724     1016
      725     1017    2      IF %KV_FLD.INP THEN DO;

   1017   0 00001D  CCC7 001E                            LDB,B4   KV@PTR+20,AUTO
          0 00001F  82C4 0002                            LB,'0010'X        2,B4
          0 000021       0010
          0 000022  0581 0054                            BBF      s:1042,PREL

      726     1018
      727     1019        /* Copy the data,  set snd if updated                                         */
      728     1020
      729     1021    2         %KV_FLD.TXTSIZ = MINIMUM (%KV_SSN.REDBFR__.DATBYTSIZ, %KV_FLD.WDT);

   1021   0 000024  E2C4 0004                            LLH,R6   4,B4
          0 000026  9CC7 000C                            LDB,B1   KV@PTR+2,AUTO
          0 000028  E941 0033                            CMR,R6   51,B1
          0 00002A  0381 0003                            BLE      s:1021+10,PREL
          0 00002C  E841 0033                            LDR,R6   51,B1
          0 00002E  EAC4 0005                            SRM,R6,'00FF'X    5,B4
          0 000030       00FF

      730     1022    2         Y@FLDTXTSIZ = %KV_FLD.TXTSIZ;

   1022   0 000031  E844 0005                            LDR,R6   5,B4
          0 000033  E570 00FF                            AND,R6   255,IMO
          0 000035  E7C7 0009                            STH,R6   Y@FLDTXTSIZ,AUTO

      731     1023    2         %KV_FLD.SND = '1'B;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:122  

   1023   0 000037  8944 0002                            LBT,'0008'X       2,B4
   1023   0 000039       0008

      732     1024    3         IF %KV_SSN.REDBFR__.DATBYTSIZ > 0 THEN DO;

   1024   0 00003A  D841 0033                            LDR,R5   51,B1
          0 00003C  5901 0012                            BEZ,R5   s:1030,PREL

      733     1025
      734     1026        /* There is data in the read buffer to move. */
      735     1027
      736     1028    3            %KV_FLD.TXTCHR = %KV_SSN.REDBFR__.ADR$->Y$REDBFR;

   1028   0 00003E  C2C4 0004                            LLH,R4   4,B4
          0 000040  ECC1 0030                            LDB,B6   48,B1
          0 000042  CF47 0028                            STR,R4   KV@PTR+30,AUTO
          0 000044  C2C7 0009                            LLH,R4   Y@FLDTXTSIZ,AUTO
          0 000046  D847 0028                            LDR,R5   KV@PTR+30,AUTO
          0 000048  DA70 2000                            ADD,R5   8192,IMO
          0 00004A  0021                                 ALR      ;
          0 00004B       4006 0000                                ALPHANUM(0,B6,,R4),;
          0 00004D       4004 0006                                ALPHANUM(6,B4,,R5,FILL)

      737     1029    3         END;                              /* END IF DATBYTSIZ > 0               */

      738     1030    3         IF %KV_VDI.RE_DSPINP THEN DO;

   1030   0 00004F  437F                                 CSYNC    s:1028+16,SPREL
          0 000050  ECC7 000A                            LDB,B6   KV@PTR,AUTO
          0 000052  82C6 0019                            LB,'0010'X        25,B6
          0 000054       0010
          0 000055  0581 000E                            BBF      s:1035,PREL

      739     1031    3            CALL KVI$RE_DSPINP;

   1031   0 000057  CBF0 0000                            LAB,B4   0,IMO
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:123  
          0 000059  E380 0000 0000  xent                 LNJ,B6   KVI$RE_DSPINP
          0 00005C       0001                            DC       s:1032,PREL

      740     1032    3            %KV_VDI.RE_DSPINP = '1'B;

   1032   0 00005D  ECC7 000A                            LDB,B6   KV@PTR,AUTO
          0 00005F  8946 0019                            LBT,'0010'X       25,B6
          0 000061       0010

      741     1033    3            %KV_VDI.RE_DSPLOWX = 0;

   1033   0 000062  8746 0016                            CL       22,B6

      742     1034    3         END;                              /* IF                                 */

      743     1035    2         %KV_SRD.FLDEND_PST = 0;

   1035   0 000064  DCC7 0014                            LDB,B5   KV@PTR+10,AUTO
          0 000066  8745 0010                            CL       16,B5
          0 000068  8745 0011                            CL       17,B5

      744     1036    2         KV@PTR.VRTCLM = %KV_FLD.VRTCLM;

   1036   0 00006A  CCC7 001E                            LDB,B4   KV@PTR+20,AUTO
          0 00006C  E2C4 0002                            LLH,R6   2,B4
          0 00006E  EF47 0024                            STR,R6   KV@PTR+26,AUTO

      745     1037    2         %KV_FLD.HI_NONBLNCLM = %KV_SRD.HI_NONBLN.CLM-%KV_SRD.ORG.CLM;

   1037   0 000070  D845 0018                            LDR,R5   24,B5
          0 000072  D245 0008                            SUB,R5   8,B5
          0 000074  DAC4 0004                            SRM,R5,'00FF'X    4,B4
          0 000076       00FF

      746     1038    2      END; /* IF */

      747     1039
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:124  
      748     1040        /* Repaint the screen if it's been requested                                  */
      749     1041
      750     1042    2      IF NOT %KV_LINLST.FRMDSP AND %KV_MVD.RETYPOVR THEN DO;

   1042   0 000077  ECC7 0018                            LDB,B6   KV@PTR+14,AUTO
          0 000079  82C6 0005                            LB,'0040'X        5,B6
          0 00007B       0040
          0 00007C  0501 000E                            BBT      s:1048,PREL
          0 00007E  DCC7 0010                            LDB,B5   KV@PTR+6,AUTO
          0 000080  82C5 0016                            LB,'0080'X        22,B5
          0 000082       0080
          0 000083  0581 0007                            BBF      s:1048,PREL

      751     1043    2         CALL KVF$UPDFRM_CRT;

   1043   0 000085  CBF0 0000                            LAB,B4   0,IMO
          0 000087  E380 0000 0000  xent                 LNJ,B6   KVF$UPDFRM_CRT
          0 00008A       0001                            DC       s:1048,PREL

      752     1044    2      END; /* IF */

      753     1045
      754     1046        /* If there are no selected fields,  dont bother to waste any more time       */
      755     1047
      756     1048    2      IF (%KV_LINLST.SLCFLDSTT = %KV_LINLST_SLCFLDSTT_NON) THEN DO;

   1048   0 00008B  ECC7 0018                            LDB,B6   KV@PTR+14,AUTO
          0 00008D  E2C6 0005                            LLH,R6   5,B6
          0 00008F  6981 000F                            BNEZ,R6  s:1054,PREL

      757     1049    2         KV$PTR.STT = %KV_PTR_STT_NO_FLD;

   1049   0 000091  5C05                                 LDV,R5   5
          0 000092  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 000095  D7C5 001D                            STH,R5   29,B5

      758     1050    2         %KV_MVD.FRMSCNINH = '0'B;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:125  

   1050   0 000097  CCC7 0010                            LDB,B4   KV@PTR+6,AUTO
          0 000099  8844 0016                            LBF,'0010'X       22,B4
          0 00009B       0010

      759     1051    2         RETURN;

   1051   0 00009C  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      760     1052    2      END; /* IF */
      761     1053
      762     1054    2      IF ADDR(PRM_VDH_PST)=ADDR(KV_VDH_PST_ENDFRM) THEN DO;

   1054   0 00009F  DB80 0000 0000  xsym                 LAB,B5   KV_VDH_PST_ENDFRM
          0 0000A2  DDC7 0004                            CMB,B5   @PRM_VDH_PST,AUTO
          0 0000A4  0981 0087                            BNE      s:1091,PREL

      763     1055
      764     1056        /* Must be time to return the data                                            */
      765     1057
      766     1058        /* Reset all KV$FLD.RED flags.  If blockmode device, protect the input fields
      767     1059           and echo the input                                                         */
      768     1060
      769     1061    2         CALL KVF$ALLFLD_RSTRED;

   1061   0 0000A6  CBF0 0000                            LAB,B4   0,IMO
          0 0000A8  E380 0000 0000  xent                 LNJ,B6   KVF$ALLFLD_RSTRED
          0 0000AB       0001                            DC       s:1062,PREL

      770     1062    3         IF (%KV_VDI.INPUNT = %KV_INPUNT_BLK) THEN DO;

   1062   0 0000AC  ECC7 000A                            LDB,B6   KV@PTR,AUTO
          0 0000AE  E846 001D                            LDR,R6   29,B6
          0 0000B0  6045                                 SOR,R6   5
          0 0000B1  E570 0003                            AND,R6   3,IMO
          0 0000B3  6D03                                 CMV,R6   3
          0 0000B4  0981 0007                            BNE      s:1065,PREL
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:126  

      771     1063    3            CALL KVF$UPDFRM_CRT;

   1063   0 0000B6  CBF0 0000                            LAB,B4   0,IMO
          0 0000B8  E380 0000 0000  xent                 LNJ,B6   KVF$UPDFRM_CRT
          0 0000BB       0001                            DC       s:1065,PREL

      772     1064    3         END;                              /* IF                                 */

      773     1065    2         %KV_STR.EDTBFR__ = '0'B;

   1065   0 0000BC  ECC7 000E                            LDB,B6   KV@PTR+4,AUTO
          0 0000BE  5C0C                                 LDV,R5   12
          0 0000BF  0021                                 ALR      ;
          0 0000C0       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          0 0000C2       4006 000C                                ALPHANUM(12,B6,,R5,FILL)

      774     1066    3         IF %KV_MVD.RETYPOVR THEN DO;

   1066   0 0000C4  437F                                 CSYNC    s:1065+7,SPREL
          0 0000C5  ECC7 0010                            LDB,B6   KV@PTR+6,AUTO
          0 0000C7  82C6 0016                            LB,'0080'X        22,B6
          0 0000C9       0080
          0 0000CA  0581 0018                            BBF      s:1070,PREL

      775     1067    3            %KV_VDI.RE_DSPINP = '0'B;

   1067   0 0000CC  DCC7 000A                            LDB,B5   KV@PTR,AUTO
          0 0000CE  8845 0019                            LBF,'0010'X       25,B5
          0 0000D0       0010

      776     1068    3            IF %KV_SRD.PRKCRS THEN CALL KVO$PST(KV_VDH_PST_HOM);

   1068   0 0000D1  CCC7 0014                            LDB,B4   KV@PTR+10,AUTO
          0 0000D3  82C4 000F                            LB,'0004'X        15,B4
          0 0000D5       0004
          0 0000D6  0581 0019                            BBF      s:1077,PREL
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:127  

   1068   0 0000D8  BB80 0000 0000  01                   LAB,B3   0
          0 0000DB  CBF0 0100                            LAB,B4   256,IMO
          0 0000DD  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          0 0000E0       0001                            DC       s:1069,PREL

      777     1069    3         END; ELSE DO;

   1069   0 0000E1  0F81 000E                            B        s:1077,PREL

      778     1070    3            %KV_SRD.NXTNONBLNLIN =

   1070   0 0000E3  DCC7 0014                            LDB,B5   KV@PTR+10,AUTO
          0 0000E5  8AC5 0014                            INC      20,B5

      779     1071    3              %KV_SRD.NXTNONBLNLIN + 1;
      780     1072    3            CALL KVO$PST(KV_VDH_PST_NEWLIN_VRT);

   1072   0 0000E7  BB80 0000 0002  01                   LAB,B3   +2
          0 0000EA  CBF0 0100                            LAB,B4   256,IMO
          0 0000EC  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          0 0000EF       0001                            DC       s:1077,PREL

      781     1073    3         END;                              /* IF                                 */

      782     1074        /*
      783     1075           Remember a few items for eventual transmission to the user.
      784     1076        */
      785     1077    2         %KV_STR.ERR.VDOTYP = ASCBIN(%KV_SSN.INPCHR);

   1077   0 0000F0  ECC7 000C                            LDB,B6   KV@PTR+2,AUTO
          0 0000F2  E2C6 0029                            LLH,R6   41,B6
          0 0000F4  DCC7 000E                            LDB,B5   KV@PTR+4,AUTO
          0 0000F6  E7C5 0014                            STH,R6   20,B5

      786     1078    2         %KV_LINLST.ERRFLDID = %KV_FLD.ID;

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:128  
   1078   0 0000F8  CCC7 0018                            LDB,B4   KV@PTR+14,AUTO
          0 0000FA  BCC7 001E                            LDB,B3   KV@PTR+20,AUTO
          0 0000FC  E803                                 LDR,R6   ,B3
          0 0000FD  EF44 0007                            STR,R6   7,B4

      787     1079    2         IF %KV_SSN.REDBFR.EDTLOWX=%KV_SSN.REDBFR.NXTX THEN %KV_STR.RE_REDCLM = 0;

   1079   0 0000FF  D846 002B                            LDR,R5   43,B6
          0 000101  D946 002A                            CMR,R5   42,B6
          0 000103  0981 0005                            BNE      s:1080,PREL

   1079   0 000105  8745 0012                            CL       18,B5
          0 000107  0F81 0004                            B        s:1081,PREL

      788     1080    2         ELSE %KV_STR.RE_REDCLM = %KV_SSN.REDBFR.EDTLOWX+1;

   1080   0 000109  5E01                                 ADV,R5   1
          0 00010A  DF45 0012                            STR,R5   18,B5

      789     1081    2         CALL KVI$PRGRED;

   1081   0 00010C  CBF0 0000                            LAB,B4   0,IMO
          0 00010E  E380 0000 0000  xent                 LNJ,B6   KVI$PRGRED
          0 000111       0001                            DC       s:1082,PREL

      790     1082    2         CALL KVI$TRMRED_VDH_DAT;

   1082   0 000112  CBF0 0000                            LAB,B4   0,IMO
          0 000114  E380 0000 0000  xent                 LNJ,B6   KVI$TRMRED_VDH_DAT
          0 000117       0001                            DC       s:1083,PREL

      791     1083    2         IF %KV_LINLST.SLCFLDSTT~=%KV_LINLST_SLCFLDSTT_ONE

   1083   0 000118  ECC7 0018                            LDB,B6   KV@PTR+14,AUTO
          0 00011A  E2C6 0005                            LLH,R6   5,B6
          0 00011C  6D01                                 CMV,R6   1
          0 00011D  0901 0005                            BE       s:1085,PREL
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:129  

      792     1084    2         THEN %KV_LINLST.ONEFLDLIN$ = PINCRW(ADDR(%KV_LINLST), SIZEW(KV$LINLST));

   1084   0 00011F  DBC6 0008                            LAB,B5   8,B6
          0 000121  DFC6 0002                            STB,B5   2,B6

      793     1085    2         CALL KVF$SND;

   1085   0 000123  CBF0 0000                            LAB,B4   0,IMO
          0 000125  E380 0000 0000  xent                 LNJ,B6   KVF$SND
          0 000128       0001                            DC       s:1086,PREL

      794     1086    2         RETURN;

   1086   0 000129  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      795     1087    2      END;
      796     1088        %EJECT;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:130  
      797     1089        /* If there is only one field selected,  dont bother to search. */
      798     1090
      799     1091    2      IF %KV_LINLST.SLCFLDSTT~=%KV_LINLST_SLCFLDSTT_ONE THEN DO;

   1091   0 00012C  6D01                                 CMV,R6   1
          0 00012D  0901 0247                            BE       s:1293,PREL

      800     1092
      801     1093        /* Start by calculating which line within the form to position to             */
      802     1094
      803     1095    2         Y@SRCDWN = '1'B;

   1095   0 00012F  8947 0008                            LBT,'8000'X       Y@SRCDWN,AUTO
   1095   0 000131       8000

      804     1096    2         Y@LIN = PRM_VDH_PST.PSTVAL.LIN;

   1096   0 000132  DCC7 0004                            LDB,B5   @PRM_VDH_PST,AUTO
          0 000134  D845 0002                            LDR,R5   2,B5
          0 000136  DF47 0007                            STR,R5   Y@LIN,AUTO

      805     1097        /* Check for absolute vs. Relative positioing                                 */
      806     1098
      807     1099    2         IF PRM_VDH_PST.VRTPSTORG=%KV_PSTORG_ABS

   1099   0 000138  C845 0001                            LDR,R4   1,B5
          0 00013A  404B                                 SOR,R4   11
          0 00013B  C570 0003                            AND,R4   3,IMO
          0 00013D  4D01                                 CMV,R4   1
          0 00013E  0981 0009                            BNE      s:1104,PREL

      808     1100    2         THEN Y@LIN = Y@LIN-%KV_SRD.ORG.LIN;

   1100   0 000140  CCC7 0014                            LDB,B4   KV@PTR+10,AUTO
          0 000142  D244 0007                            SUB,R5   7,B4
          0 000144  DF47 0007                            STR,R5   Y@LIN,AUTO
          0 000146  0F81 000C                            B        s:1118,PREL
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:131  

      809     1101
      810     1102        /* Might be SRD-relative, too. */
      811     1103
      812     1104    3         ELSE IF PRM_VDH_PST.VRTPSTORG~=%KV_PSTORG_SRD THEN DO;

   1104   0 000148  4D03                                 CMV,R4   3
          0 000149  0901 0009                            BE       s:1118,PREL

      813     1105        /* Otherwise,  we have relative virtual positioning                           */
      814     1106
      815     1107        /* Whether the eventual input field search direction should be
      816     1108           up or down is dependant on whether vrtpstval is pos or neg                 */
      817     1109
      818     1110    3            IF Y@LIN<0 THEN Y@SRCDWN = '0'B; /* Search up                        */

   1110   0 00014B  5881 0003                            BGEZ,R5  s:1111,PREL

   1110   0 00014D  8747 0008                            CL       Y@SRCDWN,AUTO

      819     1111    3            Y@LIN = Y@LIN+KV@PTR.VRTLIN;

   1111   0 00014F  DA47 0023                            ADD,R5   KV@PTR+25,AUTO
          0 000151  DF47 0007                            STR,R5   Y@LIN,AUTO

      820     1112    3         END;                              /* IF                                 */

      821     1113
      822     1114        /* Next we evaluate the horizontal positioing request. In order
      823     1115           to do this,  we must first determine if the horiz. Pos units are
      824     1116           in fields or columns                                                       */
      825     1117
      826     1118    3         IF (PRM_VDH_PST.HRZPSTUNT = %KV_PSTUNT_CLM) THEN DO;

   1118   0 000153  B845 0001                            LDR,R3   1,B5
          0 000155  304D                                 SOR,R3   13
          0 000156  3D01                                 CMV,R3   1
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:132  
          0 000157  0981 00EF                            BNE      s:1191,PREL

      827     1119
      828     1120        /* The positioning unit specified columns. Determine whether the
      829     1121           units specified are absolute or relative                                   */
      830     1122
      831     1123    3            Y@CLM = PRM_VDH_PST.PSTVAL.CLM;

   1123   0 000159  A845 0003                            LDR,R2   3,B5
          0 00015B  AF47 0006                            STR,R2   Y@CLM,AUTO

      832     1124    3            IF PRM_VDH_PST.HRZPSTORG=%KV_PSTORG_ABS

   1124   0 00015D  9805                                 LDR,R1   ,B5
          0 00015E  9570 0003                            AND,R1   3,IMO
          0 000160  1D01                                 CMV,R1   1
          0 000161  0981 0009                            BNE      s:1126,PREL

      833     1125    3            THEN Y@CLM = Y@CLM-%KV_SRD.ORG.CLM;

   1125   0 000163  CCC7 0014                            LDB,B4   KV@PTR+10,AUTO
          0 000165  A244 0008                            SUB,R2   8,B4
          0 000167  AF47 0006                            STR,R2   Y@CLM,AUTO
          0 000169  0F81 0008                            B        s:1132,PREL

      834     1126    3            ELSE IF PRM_VDH_PST.HRZPSTORG=%KV_PSTORG_CRTPST

   1126   0 00016B  1D02                                 CMV,R1   2
          0 00016C  0981 0005                            BNE      s:1132,PREL

      835     1127    3            THEN Y@CLM = KV@PTR.VRTCLM+Y@CLM;

   1127   0 00016E  AA47 0024                            ADD,R2   KV@PTR+26,AUTO
          0 000170  AF47 0006                            STR,R2   Y@CLM,AUTO

      836     1128
      837     1129        /* If the column is greater than the line width or equal to 0,  we need
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:133  
      838     1130           to either wrap or unwrap the line before we continue                       */
      839     1131
      840     1132    4            DO WHILE Y@CLM<=0;

   1132   0 000172  2A01 000C                            BGZ,R2   s:1136,PREL

      841     1133    4               Y@LIN = Y@LIN - 1;

   1133   0 000174  88C7 0007                            DEC      Y@LIN,AUTO

      842     1134    4               Y@CLM = %KV_MVD.WDT + Y@CLM;

   1134   0 000176  ECC7 0010                            LDB,B6   KV@PTR+6,AUTO
          0 000178  E846 0013                            LDR,R6   19,B6
          0 00017A  EA47 0006                            ADD,R6   Y@CLM,AUTO
          0 00017C  EF47 0006                            STR,R6   Y@CLM,AUTO

      843     1135    4            END;

   1135   0 00017E  6AF6                                 BLEZ,R6  s:1133,SPREL

      844     1136    4            DO WHILE Y@CLM>%KV_MVD.WDT;

   1136   0 00017F  ECC7 0010                            LDB,B6   KV@PTR+6,AUTO
          0 000181  E847 0006                            LDR,R6   Y@CLM,AUTO
          0 000183  6801 0014                            BLZ,R6   s:1140,PREL
          0 000185  E946 0013                            CMR,R6   19,B6
          0 000187  0381 0010                            BLE      s:1140,PREL

      845     1137    4               Y@CLM = Y@CLM - %KV_MVD.WDT;

   1137   0 000189  ECC7 0010                            LDB,B6   KV@PTR+6,AUTO
          0 00018B  E847 0006                            LDR,R6   Y@CLM,AUTO
          0 00018D  E246 0013                            SUB,R6   19,B6
          0 00018F  EF47 0006                            STR,R6   Y@CLM,AUTO

      846     1138    4               Y@LIN = Y@LIN + 1;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:134  

   1138   0 000191  8AC7 0007                            INC      Y@LIN,AUTO

      847     1139    4            END;                           /* IF                                 */

   1139   0 000193  6801 0004                            BLZ,R6   s:1140,PREL
          0 000195  E946 0013                            CMR,R6   19,B6
          0 000197  0372                                 BG       s:1137,SPREL

      848     1140    4            DO WHILE Y@LIN<=0;

   1140   0 000198  D847 0007                            LDR,R5   Y@LIN,AUTO
          0 00019A  5A01 000C                            BGZ,R5   s:1143,PREL

      849     1141    4               Y@LIN = Y@LIN+%KV_SRD.MINLNG;

   1141   0 00019C  ECC7 0014                            LDB,B6   KV@PTR+10,AUTO
          0 00019E  E846 001E                            LDR,R6   30,B6
          0 0001A0  E570 00FF                            AND,R6   255,IMO
          0 0001A2  EA47 0007                            ADD,R6   Y@LIN,AUTO
          0 0001A4  EF47 0007                            STR,R6   Y@LIN,AUTO

      850     1142    4            END;

   1142   0 0001A6  6AF6                                 BLEZ,R6  s:1141,SPREL

      851     1143    4            DO WHILE Y@LIN>%KV_SRD.MINLNG;

   1143   0 0001A7  ECC7 0014                            LDB,B6   KV@PTR+10,AUTO
          0 0001A9  E846 001E                            LDR,R6   30,B6
          0 0001AB  E570 00FF                            AND,R6   255,IMO
          0 0001AD  E947 0007                            CMR,R6   Y@LIN,AUTO
          0 0001AF  0881 0012                            BAGE     s:1149,PREL

      852     1144    4               Y@LIN = Y@LIN-%KV_SRD.MINLNG;

   1144   0 0001B1  ECC7 0014                            LDB,B6   KV@PTR+10,AUTO
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:135  
          0 0001B3  E846 001E                            LDR,R6   30,B6
          0 0001B5  E570 00FF                            AND,R6   255,IMO
          0 0001B7  E247 0007                            SUB,R6   Y@LIN,AUTO
          0 0001B9  8256                                 NEG      R6
          0 0001BA  EF47 0007                            STR,R6   Y@LIN,AUTO

      853     1145    4            END;

   1145   0 0001BC  D846 001E                            LDR,R5   30,B6
          0 0001BE  D570 00FF                            AND,R5   255,IMO
          0 0001C0  D956                                 CMR,R5   R6
          0 0001C1  0870                                 BAL      s:1144,SPREL

      854     1146
      855     1147        /* Find the closest selected input field to the desired line and column. */
      856     1148
      857     1149    3            KV@PTR.VRTLIN = (Y@LIN-1)*SIZEW(KV$LIN)+SIZEW(KV$LINLST);

   1149   0 0001C2  E847 0007                            LDR,R6   Y@LIN,AUTO
          0 0001C4  6002                                 SOL,R6   2
          0 0001C5  6E04                                 ADV,R6   4
          0 0001C6  EF47 0023                            STR,R6   KV@PTR+25,AUTO

      858     1150    3            KV@PTR.FLDWRDX = 0;

   1150   0 0001C8  8747 0022                            CL       KV@PTR+24,AUTO

      859     1151    4   FLDLST0: DO WHILE '1'B;

   1151   0                              FLDLST0         null
      860     1152    4               KV@PTR.LIN$ = PINCRW(KV@PTR.LINLST$, KV@PTR.VRTLIN);

   1152   0 0001CA  ECC7 0018            FLDLST0         LDB,B6   KV@PTR+14,AUTO
          0 0001CC  B847 0023                            LDR,R3   KV@PTR+25,AUTO
          0 0001CE  DBB6                                 LAB,B5   ,B6,R3
          0 0001CF  DFC7 001A                            STB,B5   KV@PTR+16,AUTO

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:136  
      861     1153    4               KV@PTR.FLDLST$ = %KV_LIN.FLDLST$;

   1153   0 0001D1  CC85                                 LDB,B4   ,B5
          0 0001D2  CFC7 001C                            STB,B4   KV@PTR+18,AUTO

      862     1154    4               Y@LIN = SIZEW(KV$FLDLST);

   1154   0 0001D4  6C03                                 LDV,R6   3
          0 0001D5  EF47 0007                            STR,R6   Y@LIN,AUTO

      863     1155    4               IF KV@PTR.FLDLST$~=ADDR(NIL) THEN

   1155   0 0001D7  8DC7 001C                            CMN      KV@PTR+18,AUTO
          0 0001D9  0901 0037                            BE       s:1168,PREL

      864     1156    5   FLDLST1:    DO WHILE Y@LIN<=%KV_FLDLST.LSTENTWRDX;

   1156   0 0001DB  E944 0001            FLDLST1         CMR,R6   1,B4
          0 0001DD  0A01 0033                            BAG      s:1168,PREL

      865     1157    5                  KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$, Y@LIN);

   1157   0 0001DF  ECC7 001C                            LDB,B6   KV@PTR+18,AUTO
          0 0001E1  B847 0007                            LDR,R3   Y@LIN,AUTO
          0 0001E3  DBB6                                 LAB,B5   ,B6,R3
          0 0001E4  DFC7 001E                            STB,B5   KV@PTR+20,AUTO

      866     1158    6                  IF %KV_FLD.RED THEN DO;

   1158   0 0001E6  82C5 0002                            LB,'0004'X        2,B5
   1158   0 0001E8       0004
          0 0001E9  0581 001C                            BBF      s:1166,PREL

      867     1159    6                     IF KV@PTR.FLDWRDX~=0

   1159   0 0001EB  E847 0022                            LDR,R6   KV@PTR+24,AUTO
          0 0001ED  6901 000F                            BEZ,R6   s:1163,PREL
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:137  

      868     1160    6                     THEN IF %KV_FLD.VRTCLM-Y@CLM>=

   1160   0 0001EF  D2C5 0002                            LLH,R5   2,B5
          0 0001F1  D247 0006                            SUB,R5   Y@CLM,AUTO
          0 0001F3  A856                                 LDR,R2   R6
          0 0001F4  2001                                 SOL,R2   1
          0 0001F5  2E04                                 ADV,R2   4
          0 0001F6  C2A6                                 LLH,R4   ,B6,R2
          0 0001F7  C247 0006                            SUB,R4   Y@CLM,AUTO
          0 0001F9  8254                                 NEG      R4
          0 0001FA  C955                                 CMR,R4   R5
          0 0001FB  0A81 0015                            BALE     s:1168,PREL

      869     1161    6                       Y@CLM-PINCRW(KV@PTR.FLDLST$,KV@PTR.FLDWRDX)->KV$FLD.VRTCLM
      870     1162    6                     THEN EXIT FLDLST1;    /* Past it too far                    */
      871     1163    6                     KV@PTR.FLDWRDX = Y@LIN;

   1163   0 0001FD  E853                                 LDR,R6   R3
          0 0001FE  EF47 0022                            STR,R6   KV@PTR+24,AUTO

      872     1164    6                     IF %KV_FLD.VRTCLM>=Y@CLM THEN EXIT FLDLST1; /* gets worse   */

   1164   0 000200  D2C5 0002                            LLH,R5   2,B5
          0 000202  D947 0006                            CMR,R5   Y@CLM,AUTO
          0 000204  0881 000C                            BAGE     s:1168,PREL

      873     1165    6                  END;

      874     1166    5                  Y@LIN = Y@LIN+%KV_FLD.STRWRDSIZ;

   1166   0 000206  E845 0001                            LDR,R6   1,B5
          0 000208  6008                                 SOL,R6   8
          0 000209  6068                                 SAR,R6   8
          0 00020A  EA53                                 ADD,R6   R3
          0 00020B  B856                                 LDR,R3   R6
          0 00020C  BF47 0007                            STR,R3   Y@LIN,AUTO
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:138  

      875     1167    5               END FLDLST1;

   1167   0 00020E  B946 0001                            CMR,R3   1,B6
          0 000210  0ACF                                 BALE     s:1157,SPREL

      876     1168    5               IF KV@PTR.FLDWRDX~=0 THEN DO;

   1168   0 000211  E847 0022                            LDR,R6   KV@PTR+24,AUTO
          0 000213  6901 0009                            BEZ,R6   s:1172,PREL

      877     1169    5                  KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$, KV@PTR.FLDWRDX);

   1169   0 000215  ECC7 001C                            LDB,B6   KV@PTR+18,AUTO
          0 000217  B856                                 LDR,R3   R6
          0 000218  DBB6                                 LAB,B5   ,B6,R3
          0 000219  DFC7 001E                            STB,B5   KV@PTR+20,AUTO

      878     1170    5                  EXIT FLDLST0;

   1170   0 00021B  0F81 0029                            B        s:1187,PREL

      879     1171    5               END;
      880     1172    5               IF Y@SRCDWN THEN DO;

   1172   0 00021D  89C7 0008                            CMZ      Y@SRCDWN,AUTO
          0 00021F  0881 0013                            BAGE     s:1177,PREL

      881     1173    5                  IF KV@PTR.VRTLIN<%KV_LINLST.LSTENTWRDX

   1173   0 000221  ECC7 0018                            LDB,B6   KV@PTR+14,AUTO
          0 000223  D847 0023                            LDR,R5   KV@PTR+25,AUTO
          0 000225  D946 0001                            CMR,R5   1,B6
          0 000227  0881 0006                            BAGE     s:1175,PREL

      882     1174    5                  THEN KV@PTR.VRTLIN = KV@PTR.VRTLIN+SIZEW(KV$LIN);

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:139  
   1174   0 000229  5E04                                 ADV,R5   4
          0 00022A  DF47 0023                            STR,R5   KV@PTR+25,AUTO
          0 00022C  0F81 FF9D                            B        s:1151,PREL

      883     1175    5                  ELSE KV@PTR.VRTLIN = SIZEW(KV$LINLST);

   1175   0 00022E  5C08                                 LDV,R5   8
          0 00022F  DF47 0023                            STR,R5   KV@PTR+25,AUTO

      884     1176    5               END; ELSE DO;

   1176   0 000231  0F81 FF98                            B        s:1151,PREL

      885     1177    5                  IF KV@PTR.VRTLIN>SIZEW(KV$LINLST)

   1177   0 000233  D847 0023                            LDR,R5   KV@PTR+25,AUTO
          0 000235  5D08                                 CMV,R5   8
          0 000236  0A81 0006                            BALE     s:1179,PREL

      886     1178    5                  THEN KV@PTR.VRTLIN = KV@PTR.VRTLIN-SIZEW(KV$LIN);

   1178   0 000238  5EFC                                 ADV,R5   -4
          0 000239  DF47 0023                            STR,R5   KV@PTR+25,AUTO
          0 00023B  0F81 FF8E                            B        s:1151,PREL

      887     1179    5                  ELSE KV@PTR.VRTLIN = %KV_LINLST.LSTENTWRDX;

   1179   0 00023D  ECC7 0018                            LDB,B6   KV@PTR+14,AUTO
          0 00023F  D846 0001                            LDR,R5   1,B6
          0 000241  DF47 0023                            STR,R5   KV@PTR+25,AUTO

      888     1180    5               END;

      889     1181    4            END FLDLST0;

   1181   0 000243  0F81 FF86                            B        s:1151,PREL

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:140  
      890     1182
      891     1183        /* Otherwise,  the horizontal positioing units are specified as
      892     1184           fields. Do a little search to get KV@PTR loaded with
      893     1185           the location of the indicated field.                                       */
      894     1186
      895     1187    3         END; ELSE DO;

   1187   0 000245  0F81 012F                            B        s:1293,PREL

      896     1188
      897     1189        /* Get the field count to position by. */
      898     1190
      899     1191    3            Y@CLM = PRM_VDH_PST.PSTVAL.CLM;

   1191   0 000247  A845 0003                            LDR,R2   3,B5
          0 000249  AF47 0006                            STR,R2   Y@CLM,AUTO

      900     1192
      901     1193        /* If we're to start on a different line, get there.
              1193          */
      902     1194
      903     1195    4            IF Y@LIN~=KV@PTR.VRTLIN THEN DO;

   1195   0 00024B  D947 0023                            CMR,R5   KV@PTR+25,AUTO
          0 00024D  0901 007B                            BE       s:1229,PREL

      904     1196    4               Y@LIN = (Y@LIN-1)*SIZEW(KV$LIN)+SIZEW(KV$LINLST);

   1196   0 00024F  5002                                 SOL,R5   2
          0 000250  5E04                                 ADV,R5   4
          0 000251  DF47 0007                            STR,R5   Y@LIN,AUTO

      905     1197    4               KV@PTR.FLDWRDX = SIZEW(KV$FLDLST);

   1197   0 000253  1C03                                 LDV,R1   3
          0 000254  9F47 0022                            STR,R1   KV@PTR+24,AUTO

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:141  
      906     1198    5               IF Y@LIN<SIZEW(KV$LINLST) THEN DO;

   1198   0 000256  5D08                                 CMV,R5   8
          0 000257  0881 0008                            BAGE     s:1201+2,PREL

      907     1199    5                  Y@LIN = SIZEW(KV$LINLST)-SIZEW(KV$LIN);

   1199   0 000259  5C04                                 LDV,R5   4
          0 00025A  DF47 0007                            STR,R5   Y@LIN,AUTO

      908     1200    5                  KV@PTR.FLDWRDX = 0;

   1200   0 00025C  8747 0022                            CL       KV@PTR+24,AUTO

      909     1201    5               END; ELSE IF Y@LIN>%KV_LINLST.LSTENTWRDX THEN DO;

   1201   0 00025E  0F81 001B                            B        s:1209,PREL

   1201   0 000260  D946 0001                            CMR,R5   1,B6
          0 000262  0A81 000A                            BALE     s:1205,PREL

      910     1202    5                  Y@LIN = %KV_LINLST.LSTENTWRDX+SIZEW(KV$LIN);

   1202   0 000264  D846 0001                            LDR,R5   1,B6
          0 000266  5E04                                 ADV,R5   4
          0 000267  DF47 0007                            STR,R5   Y@LIN,AUTO

      911     1203    5                  KV@PTR.FLDWRDX = 0;

   1203   0 000269  8747 0022                            CL       KV@PTR+24,AUTO

      912     1204    5               END; ELSE DO;

   1204   0 00026B  0F81 000E                            B        s:1209,PREL

      913     1205    5                  KV@PTR.LIN$ = PINCRW(KV@PTR.LINLST$,Y@LIN);

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:142  
   1205   0 00026D  B855                                 LDR,R3   R5
          0 00026E  CBB6                                 LAB,B4   ,B6,R3
          0 00026F  CFC7 001A                            STB,B4   KV@PTR+16,AUTO

      914     1206    5                  KV@PTR.FLDLST$ = %KV_LIN.FLDLST$;

   1206   0 000271  BC84                                 LDB,B3   ,B4
          0 000272  BFC7 001C                            STB,B3   KV@PTR+18,AUTO

      915     1207    5                  IF KV@PTR.FLDLST$=ADDR(NIL) THEN KV@PTR.FLDWRDX = 0;

   1207   0 000274  8DC7 001C                            CMN      KV@PTR+18,AUTO
          0 000276  0981 0003                            BNE      s:1209,PREL

   1207   0 000278  8747 0022                            CL       KV@PTR+24,AUTO

      916     1208    5               END;

      917     1209    4               IF PRM_VDH_PST.HRZPSTORG=%KV_PSTORG_ABS

   1209   0 00027A  B805                                 LDR,R3   ,B5
          0 00027B  B570 0003                            AND,R3   3,IMO
          0 00027D  3D01                                 CMV,R3   1
          0 00027E  0901 0048                            BE       s:1228,PREL
          0 000280  E847 0022                            LDR,R6   KV@PTR+24,AUTO
          0 000282  6901 0044                            BEZ,R6   s:1228,PREL

      918     1210    4                 OR KV@PTR.FLDWRDX=0 THEN EXIT;
      919     1211    5   FLDLST2:    DO WHILE '1'B;

   1211   0                              FLDLST2         null
      920     1212    5                  KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$, KV@PTR.FLDWRDX);

   1212   0 000284  ECC7 001C            FLDLST2         LDB,B6   KV@PTR+18,AUTO
          0 000286  B847 0022                            LDR,R3   KV@PTR+24,AUTO
          0 000288  DBB6                                 LAB,B5   ,B6,R3
          0 000289  DFC7 001E                            STB,B5   KV@PTR+20,AUTO
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:143  

      921     1213    5                  IF %KV_FLD.VRTCLM=KV@PTR.VRTCLM THEN EXIT FLDLST2;

   1213   0 00028B  E2C5 0002                            LLH,R6   2,B5
          0 00028D  E947 0024                            CMR,R6   KV@PTR+26,AUTO
          0 00028F  0901 0037                            BE       s:1228,PREL

      922     1214    6                  IF %KV_FLD.VRTCLM>KV@PTR.VRTCLM THEN DO;

   1214   0 000291  0381 001A                            BLE      s:1221,PREL

      923     1215    6                     IF Y@CLM<0 THEN EXIT FLDLST2;

   1215   0 000293  D847 0006                            LDR,R5   Y@CLM,AUTO
          0 000295  5801 0031                            BLZ,R5   s:1228,PREL

      924     1216    6                     KV@PTR.FLDWRDX = KV@PTR.FLDWRDX-%KV_FLD.PRVSTRWRDSIZ;

   1216   0 000297  C0C5 0001                            LDH,R4   1,B5
          0 000299  C253                                 SUB,R4   R3
          0 00029A  B854                                 LDR,R3   R4
          0 00029B  8253                                 NEG      R3
          0 00029C  BF47 0022                            STR,R3   KV@PTR+24,AUTO

      925     1217    6                     IF KV@PTR.FLDWRDX=0 THEN Y@LIN = Y@LIN-SIZEW(KV$LIN);

   1217   0 00029E  3981 0008                            BNEZ,R3  s:1218,PREL

   1217   0 0002A0  C847 0007                            LDR,R4   Y@LIN,AUTO
          0 0002A2  4EFC                                 ADV,R4   -4
          0 0002A3  CF47 0007                            STR,R4   Y@LIN,AUTO
          0 0002A5  0F81 0004                            B        s:1219,PREL

      926     1218    6                     ELSE KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$,KV@PTR.FLDWRDX);

   1218   0 0002A7  CBB6                                 LAB,B4   ,B6,R3
          0 0002A8  CFC7 001E                            STB,B4   KV@PTR+20,AUTO
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:144  

      927     1219    6                     EXIT FLDLST2;

   1219   0 0002AA  0F81 001C                            B        s:1228,PREL

      928     1220    6                  END;
      929     1221    6                  IF KV@PTR.FLDWRDX>=%KV_FLDLST.LSTENTWRDX THEN DO;

   1221   0 0002AC  B946 0001                            CMR,R3   1,B6
          0 0002AE  0801 000E                            BAL      s:1226,PREL

      930     1222    6                     IF Y@CLM>0 THEN EXIT FLDLST2;

   1222   0 0002B0  D847 0006                            LDR,R5   Y@CLM,AUTO
          0 0002B2  5A01 0014                            BGZ,R5   s:1228,PREL

      931     1223    6                     KV@PTR.FLDWRDX = 0;

   1223   0 0002B4  8747 0022                            CL       KV@PTR+24,AUTO

      932     1224    6                     Y@LIN = Y@LIN+SIZEW(KV$LIN);

   1224   0 0002B6  C847 0007                            LDR,R4   Y@LIN,AUTO
          0 0002B8  4E04                                 ADV,R4   4
          0 0002B9  CF47 0007                            STR,R4   Y@LIN,AUTO

      933     1225    6                     EXIT FLDLST2;

   1225   0 0002BB  0F81 000B                            B        s:1228,PREL

      934     1226    5                  END; ELSE KV@PTR.FLDWRDX = KV@PTR.FLDWRDX+%KV_FLD.STRWRDSIZ;

   1226   0 0002BD  D845 0001                            LDR,R5   1,B5
          0 0002BF  5008                                 SOL,R5   8
          0 0002C0  5068                                 SAR,R5   8
          0 0002C1  DA53                                 ADD,R5   R3
          0 0002C2  B855                                 LDR,R3   R5
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:145  
          0 0002C3  BF47 0022                            STR,R3   KV@PTR+24,AUTO

      935     1227    5               END FLDLST2;

   1227   0 0002C5  0F81 FFBE                            B        s:1211,PREL

      936     1228    4            END;                           /* IF going to a different line       */

   1228   0 0002C7  0F81 0005                            B        s:1233,PREL

      937     1229    3            ELSE Y@LIN = (Y@LIN-1)*SIZEW(KV$LIN)+SIZEW(KV$LINLST);

   1229   0 0002C9  5002                                 SOL,R5   2
          0 0002CA  5E04                                 ADV,R5   4
          0 0002CB  DF47 0007                            STR,R5   Y@LIN,AUTO

      938     1230
      939     1231        /* If ABS field number is specified, indicate that we're between lines */
      940     1232
      941     1233    4            IF PRM_VDH_PST.HRZPSTORG=%KV_PSTORG_ABS THEN DO;

   1233   0 0002CD  ECC7 0004                            LDB,B6   @PRM_VDH_PST,AUTO
          0 0002CF  E806                                 LDR,R6   ,B6
          0 0002D0  E570 0003                            AND,R6   3,IMO
          0 0002D2  6D01                                 CMV,R6   1
          0 0002D3  0981 000C                            BNE      s:1236,PREL

      942     1234    4               KV@PTR.FLDWRDX = 0;

   1234   0 0002D5  8747 0022                            CL       KV@PTR+24,AUTO

      943     1235    4               IF Y@CLM>0 THEN Y@LIN = Y@LIN-SIZEW(KV$LIN);

   1235   0 0002D7  D847 0006                            LDR,R5   Y@CLM,AUTO
          0 0002D9  5A81 0006                            BLEZ,R5  s:1236,PREL

   1235   0 0002DB  C847 0007                            LDR,R4   Y@LIN,AUTO
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:146  
          0 0002DD  4EFC                                 ADV,R4   -4
          0 0002DE  CF47 0007                            STR,R4   Y@LIN,AUTO

      944     1236    4            END;

      945     1237
      946     1238        /* Now count Y@CLM input fields from the indicated KV@PTR position. */
      947     1239
      948     1240    4   FLDLST3: DO WHILE '1'B;

   1240   0                              FLDLST3         null
      949     1241    4               IF KV@PTR.FLDWRDX~=0 THEN IF Y@CLM>=0

   1241   0 0002E0  E847 0022            FLDLST3         LDR,R6   KV@PTR+24,AUTO
          0 0002E2  6901 002B                            BEZ,R6   s:1251,PREL

   1241   0 0002E4  D847 0006                            LDR,R5   Y@CLM,AUTO
          0 0002E6  5801 0017                            BLZ,R5   s:1245,PREL

      950     1242    4               THEN IF KV@PTR.FLDWRDX<%KV_FLDLST.LSTENTWRDX

   1242   0 0002E8  ECC7 001C                            LDB,B6   KV@PTR+18,AUTO
          0 0002EA  E946 0001                            CMR,R6   1,B6
          0 0002EC  0881 000D                            BAGE     s:1244,PREL

      951     1243    4               THEN KV@PTR.FLDWRDX = KV@PTR.FLDWRDX+%KV_FLD.STRWRDSIZ;

   1243   0 0002EE  DCC7 001E                            LDB,B5   KV@PTR+20,AUTO
          0 0002F0  C845 0001                            LDR,R4   1,B5
          0 0002F2  4008                                 SOL,R4   8
          0 0002F3  4068                                 SAR,R4   8
          0 0002F4  CA56                                 ADD,R4   R6
          0 0002F5  E854                                 LDR,R6   R4
          0 0002F6  EF47 0022                            STR,R6   KV@PTR+24,AUTO
          0 0002F8  0F81 0015                            B        s:1251,PREL

      952     1244    4               ELSE KV@PTR.FLDWRDX = 0;
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:147  

   1244   0 0002FA  8747 0022                            CL       KV@PTR+24,AUTO
          0 0002FC  0F81 0011                            B        s:1251,PREL

      953     1245    4               ELSE /*Y@CLM<0*/ IF KV@PTR.FLDWRDX>SIZEW(KV$FLDLST)

   1245   0 0002FE  6D03                                 CMV,R6   3
          0 0002FF  0A81 000C                            BALE     s:1247,PREL

      954     1246    4               THEN KV@PTR.FLDWRDX = KV@PTR.FLDWRDX-%KV_FLD.PRVSTRWRDSIZ;

   1246   0 000301  ECC7 001E                            LDB,B6   KV@PTR+20,AUTO
          0 000303  C0C6 0001                            LDH,R4   1,B6
          0 000305  C256                                 SUB,R4   R6
          0 000306  E854                                 LDR,R6   R4
          0 000307  8256                                 NEG      R6
          0 000308  EF47 0022                            STR,R6   KV@PTR+24,AUTO
          0 00030A  0F81 0003                            B        s:1251,PREL

      955     1247    4               ELSE KV@PTR.FLDWRDX = 0;

   1247   0 00030C  8747 0022                            CL       KV@PTR+24,AUTO

      956     1248
      957     1249        /* FLDWRDX now at the next field or zero if a line-change is needed */
      958     1250
      959     1251    5               IF KV@PTR.FLDWRDX=0 THEN DO;

   1251   0 00030E  E847 0022                            LDR,R6   KV@PTR+24,AUTO
          0 000310  6981 0045                            BNEZ,R6  s:1273,PREL

      960     1252    5                  IF Y@CLM>=0 THEN IF Y@LIN<%KV_LINLST.LSTENTWRDX

   1252   0 000312  D847 0006                            LDR,R5   Y@CLM,AUTO
          0 000314  5801 0017                            BLZ,R5   s:1258,PREL

   1252   0 000316  ECC7 0018                            LDB,B6   KV@PTR+14,AUTO
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:148  
          0 000318  C847 0007                            LDR,R4   Y@LIN,AUTO
          0 00031A  C946 0001                            CMR,R4   1,B6
          0 00031C  0881 0006                            BAGE     s:1255,PREL

      961     1253    5                  THEN Y@LIN = Y@LIN+SIZEW(KV$LIN);

   1253   0 00031E  4E04                                 ADV,R4   4
          0 00031F  CF47 0007                            STR,R4   Y@LIN,AUTO
          0 000321  0F81 001A                            B        s:1264,PREL

      962     1254    6                  ELSE DO;            /* ran out of fields, find the last one    */

      963     1255    6                     Y@LIN = %KV_LINLST.LSTENTWRDX;

   1255   0 000323  C846 0001                            LDR,R4   1,B6
          0 000325  CF47 0007                            STR,R4   Y@LIN,AUTO

      964     1256    6                     Y@CLM = -1;

   1256   0 000327  8947 0006                            LBT,'FFFF'X       Y@CLM,AUTO
   1256   0 000329       FFFF

      965     1257    6                  END;

   1257   0 00032A  0F81 0011                            B        s:1264,PREL

      966     1258    5                  ELSE /*Y@CLM<0*/ IF Y@LIN>SIZEW(KV$LINLST)

   1258   0 00032C  C847 0007                            LDR,R4   Y@LIN,AUTO
          0 00032E  4D08                                 CMV,R4   8
          0 00032F  0A81 0006                            BALE     s:1261,PREL

      967     1259    5                  THEN Y@LIN = Y@LIN-SIZEW(KV$LIN);

   1259   0 000331  4EFC                                 ADV,R4   -4
          0 000332  CF47 0007                            STR,R4   Y@LIN,AUTO
          0 000334  0F81 0007                            B        s:1264,PREL
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:149  

      968     1260    6                  ELSE DO;            /* ran out t'other way, find the first     */

      969     1261    6                     Y@LIN = SIZEW(KV$LINLST);

   1261   0 000336  4C08                                 LDV,R4   8
          0 000337  CF47 0007                            STR,R4   Y@LIN,AUTO

      970     1262    6                     Y@CLM = 1;

   1262   0 000339  5C01                                 LDV,R5   1
          0 00033A  DF47 0006                            STR,R5   Y@CLM,AUTO

      971     1263    6                  END;

      972     1264    5                  KV@PTR.LIN$ = PINCRW(KV@PTR.LINLST$, Y@LIN);

   1264   0 00033C  ECC7 0018                            LDB,B6   KV@PTR+14,AUTO
          0 00033E  B854                                 LDR,R3   R4
          0 00033F  DBB6                                 LAB,B5   ,B6,R3
          0 000340  DFC7 001A                            STB,B5   KV@PTR+16,AUTO

      973     1265    5                  KV@PTR.FLDLST$ = %KV_LIN.FLDLST$;

   1265   0 000342  CC85                                 LDB,B4   ,B5
          0 000343  CFC7 001C                            STB,B4   KV@PTR+18,AUTO

      974     1266    5                  IF KV@PTR.FLDLST$~=ADDR(NIL)

   1266   0 000345  8DC7 001C                            CMN      KV@PTR+18,AUTO
          0 000347  0901 000E                            BE       s:1273,PREL

      975     1267    5                  THEN IF Y@CLM>=0 THEN KV@PTR.FLDWRDX = SIZEW(KV$FLDLST);

   1267   0 000349  D847 0006                            LDR,R5   Y@CLM,AUTO
          0 00034B  5801 0006                            BLZ,R5   s:1268,PREL

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:150  
   1267   0 00034D  6C03                                 LDV,R6   3
          0 00034E  EF47 0022                            STR,R6   KV@PTR+24,AUTO
          0 000350  0F81 0005                            B        s:1273,PREL

      976     1268    5                  ELSE KV@PTR.FLDWRDX = %KV_FLDLST.LSTENTWRDX;

   1268   0 000352  E844 0001                            LDR,R6   1,B4
          0 000354  EF47 0022                            STR,R6   KV@PTR+24,AUTO

      977     1269    5               END;

      978     1270
      979     1271        /* Time to take a peek at the next field. */
      980     1272
      981     1273    5               IF KV@PTR.FLDWRDX~=0 THEN DO;

   1273   0 000356  6901 FF89                            BEZ,R6   s:1236,PREL

      982     1274    5                  KV@PTR.FLD$ = PINCRW(KV@PTR.FLDLST$, KV@PTR.FLDWRDX);

   1274   0 000358  ECC7 001C                            LDB,B6   KV@PTR+18,AUTO
          0 00035A  B856                                 LDR,R3   R6
          0 00035B  DBB6                                 LAB,B5   ,B6,R3
          0 00035C  DFC7 001E                            STB,B5   KV@PTR+20,AUTO

      983     1275    6                  IF %KV_FLD.RED THEN DO;

   1275   0 00035E  82C5 0002                            LB,'0004'X        2,B5
   1275   0 000360       0004
          0 000361  0581 FF7E                            BBF      s:1236,PREL

      984     1276    6                     IF Y@CLM>0 THEN Y@CLM=Y@CLM-1;

   1276   0 000363  D847 0006                            LDR,R5   Y@CLM,AUTO
          0 000365  5A81 0005                            BLEZ,R5  s:1277,PREL

   1276   0 000367  88C7 0006                            DEC      Y@CLM,AUTO
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:151  
          0 000369  0F81 0005                            B        s:1278,PREL

      985     1277    6                     ELSE IF Y@CLM<0 THEN Y@CLM = Y@CLM+1;

   1277   0 00036B  5881 0003                            BGEZ,R5  s:1278,PREL

   1277   0 00036D  8AC7 0006                            INC      Y@CLM,AUTO

      986     1278    6                     IF Y@CLM=0 THEN EXIT FLDLST3;

   1278   0 00036F  D847 0006                            LDR,R5   Y@CLM,AUTO
          0 000371  5901 0003                            BEZ,R5   s:1293,PREL

      987     1279    6                  END;

      988     1280    5               END;

      989     1281    4            END FLDLST3;

   1281   0 000373  0F81 FF6C                            B        s:1236,PREL

      990     1282    3         END;                              /* IF                                 */

      991     1283    2      END;

      992     1284
      993     1285        /* Hopefully,  at this point,  we have 2 KV$PTR's setup. One tells
      994     1286           us where we are and the other tells us where we want to be
      995     1287           we now call a routine to get us where we need to go and post a new
      996     1288           read. The routine called depends on whether we are dealing
      997     1289           with a hardcopy device or a CRT.                                           */
      998     1290
      999     1291        /* Get the right line display for hardcopy forms                              */
     1000     1292
     1001     1293    1      IF NOT %KV_MVD.RETYPOVR THEN CALL KVF$UPDFRM_HRDCPY(%KV_LIN);

   1293   0 000375  ECC7 0010                            LDB,B6   KV@PTR+6,AUTO
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:152  
          0 000377  82C6 0016                            LB,'0080'X        22,B6
          0 000379       0080
          0 00037A  0501 0009                            BBT      s:1294,PREL

   1293   0 00037C  BBC7 001A                            LAB,B3   KV@PTR+16,AUTO
          0 00037E  CBF0 0100                            LAB,B4   256,IMO
          0 000380  E380 0000 0000  xent                 LNJ,B6   KVF$UPDFRM_HRDCPY
          0 000383       0001                            DC       s:1294,PREL

     1002     1294    1      %KV_LINLST.ONEFLDLIN$ = KV@PTR.LIN$;

   1294   0 000384  ECC7 001A                            LDB,B6   KV@PTR+16,AUTO
          0 000386  DCC7 0018                            LDB,B5   KV@PTR+14,AUTO
          0 000388  EFC5 0002                            STB,B6   2,B5

     1003     1295    1      %KV_LINLST.ONEFLDWRDX = KV@PTR.FLDWRDX;

   1295   0 00038A  E847 0022                            LDR,R6   KV@PTR+24,AUTO
          0 00038C  EF45 0004                            STR,R6   4,B5

     1004     1296    1      %KV_STR.RE_REDCLM = 1;

   1296   0 00038E  CCC7 000E                            LDB,B4   KV@PTR+4,AUTO
          0 000390  5C01                                 LDV,R5   1
          0 000391  DF44 0012                            STR,R5   18,B4

     1005     1297    1      CALL KVF$REDFRM;

   1297   0 000393  CBF0 0000                            LAB,B4   0,IMO
          0 000395  E380 0000 0000  xent                 LNJ,B6   KVF$REDFRM
          0 000398       0001                            DC       s:1301,PREL

     1006     1298
     1007     1299        /* Reset form scan inhibit                                                    */
     1008     1300
     1009     1301    1      %KV_MVD.FRMSCNINH = '0'B;

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:153  
   1301   0 000399  ECC7 0010                            LDB,B6   KV@PTR+6,AUTO
          0 00039B  8846 0016                            LBF,'0010'X       22,B6
          0 00039D       0010

     1010     1302    1      RETURN;

   1302   0 00039E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1011     1303    1   END; /* SUBROUTINE */
     1012     1304        %EOD;

PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:154  
--  Include file information  --

   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$PST.
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:155  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PRM_VDH_PST               A-0-0/w STRC(480)   r     1 KV@PTR
    *0-0-0/w STRC(64)    r     1 PRM_VDH_PST                6-0-0/w SBIN(16)    r     1 Y@CLM
     9-0-0/w UBIN(8)     r     1 Y@FLDTXTSIZ                7-0-0/w SBIN(16)    r     1 Y@LIN
     8-0-0/w BIT         r     1 Y@SRCDWN

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w UBIN(16)    r     1 KV_VDH_PST_ENDFRM
     0-0-0/w UBIN(16)    r     1 KV_VDH_PST_HOM
     0-0-0/w UBIN(16)    r     1 KV_VDH_PST_NEWLIN_VRT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w ASTR(96)    r     1 KV$FLD                     0-0-0/w STRC(48)    r     1 KV$FLDLST
     0-0-0/w STRC(64)    r     1 KV$LIN                     0-0-0/w STRC(128)   r     1 KV$LINLST
     0-0-0/w STRC(512)   r     1 KV$MVD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(496)   r     1 KV$SRD                     0-0-0/w STRC(1024)  r     1 KV$SSN
     0-0-0/w STRC(512)   r     1 KV$STR                     0-0-0/w STRC(512)   r     1 KV$VDI
     0-0-0/w ACHR        r     1 Y$REDBFR


   Procedure KVF$PST requires 929 words for executable code.
   Procedure KVF$PST requires 41 words of local(AUTO) storage.
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:156  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:157  
          MINI XREF LISTING

FLDLST0
      1151**LABEL    1170--EXIT
FLDLST1
      1156**LABEL    1162--EXIT     1164--EXIT
FLDLST2
      1211**LABEL    1213--EXIT     1215--EXIT     1219--EXIT     1222--EXIT     1225--EXIT
FLDLST3
      1240**LABEL    1278--EXIT
KV$FLD.HI_NONBLNCLM
       150**DCL      1037<<ASSIGN
KV$FLD.ID
        91**DCL      1078>>ASSIGN
KV$FLD.INP
        93**DCL      1017>>IF
KV$FLD.PRVSTRWRDSIZ
        91**DCL      1216>>ASSIGN   1246>>ASSIGN
KV$FLD.RED
        93**DCL      1158>>IF       1275>>IF
KV$FLD.SND
        93**DCL      1023<<ASSIGN
KV$FLD.STRWRDSIZ
        91**DCL      1166>>ASSIGN   1226>>ASSIGN   1243>>ASSIGN
KV$FLD.TXT
       155**DCL       159--REDEF
KV$FLD.TXTCHR
       159**DCL      1028<<ASSIGN
KV$FLD.TXTSIZ
       150**DCL      1021<<ASSIGN   1022>>ASSIGN
KV$FLD.VRTCLM
        92**DCL      1036>>ASSIGN   1160>>IF       1160>>IF       1164>>IF       1213>>IF       1214>>IF
KV$FLD.WDT
       150**DCL       159--IMP-SIZ  1021>>ASSIGN   1028>>ASSIGN
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:158  
KV$FLDLST
       181**DCL      1154--ASSIGN   1197--ASSIGN   1245--IF       1267--ASSIGN
KV$FLDLST.LSTENTWRDX
       181**DCL      1156>>DOWHILE  1221>>IF       1242>>IF       1268>>ASSIGN
KV$LIN
       206**DCL      1149--ASSIGN   1174--ASSIGN   1178--ASSIGN   1196--ASSIGN   1199--ASSIGN   1202--ASSIGN
      1217--ASSIGN   1224--ASSIGN   1229--ASSIGN   1235--ASSIGN   1253--ASSIGN   1259--ASSIGN   1293<>CALL
KV$LIN.FLDLST$
       206**DCL      1153>>ASSIGN   1206>>ASSIGN   1265>>ASSIGN
KV$LINLST
       231**DCL      1084--ASSIGN   1084--ASSIGN   1149--ASSIGN   1175--ASSIGN   1177--IF       1196--ASSIGN
      1198--IF       1199--ASSIGN   1229--ASSIGN   1258--IF       1261--ASSIGN
KV$LINLST.ERRFLDID
       234**DCL      1078<<ASSIGN
KV$LINLST.FRMDSP
       233**DCL      1042>>IF
KV$LINLST.LSTENTWRDX
       231**DCL      1173>>IF       1179>>ASSIGN   1201>>IF       1202>>ASSIGN   1252>>IF       1255>>ASSIGN
KV$LINLST.ONEFLDLIN$
       232**DCL      1084<<ASSIGN   1294<<ASSIGN
KV$LINLST.ONEFLDWRDX
       232**DCL      1295<<ASSIGN
KV$LINLST.SLCFLDSTT
       233**DCL      1048>>IF       1083>>IF       1091>>IF
KV$MVD.FRMSCNINH
       269**DCL       998>>IF       1012<<ASSIGN   1050<<ASSIGN   1301<<ASSIGN
KV$MVD.RETYPOVR
       268**DCL      1042>>IF       1066>>IF       1293>>IF
KV$MVD.WDT
       264**DCL      1134>>ASSIGN   1136>>DOWHILE  1137>>ASSIGN
KV$PTR
        48**DCL       996>>ASSIGN
KV$PTR.INPCNDPND
        54**DCL        63--REDEF      67--REDEF
KV$PTR.LINLST$
        50**DCL        51--REDEF
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:159  
KV$PTR.STT
        68**DCL       995<<ASSIGN   1049<<ASSIGN
KV$PTR$
        42**DCL        48--IMP-PTR   995>>ASSIGN    996>>ASSIGN   1049>>ASSIGN
KV$SRD.BTMRHT
       400**DCL       405--REDEF
KV$SRD.CRT
       476**DCL       481--REDEF
KV$SRD.FLDEND
       440**DCL       445--REDEF
KV$SRD.FLDEND_PST
       445**DCL      1035<<ASSIGN
KV$SRD.HI_NONBLN
       510**DCL       515--REDEF
KV$SRD.HI_NONBLN.CLM
       512**DCL      1037>>ASSIGN
KV$SRD.MINLNG
       556**DCL      1141>>ASSIGN   1143>>DOWHILE  1144>>ASSIGN
KV$SRD.NXTNONBLNLIN
       448**DCL      1070<<ASSIGN   1070>>ASSIGN
KV$SRD.ORG
       332**DCL       337--REDEF
KV$SRD.ORG.CLM
       334**DCL      1037>>ASSIGN   1125>>ASSIGN
KV$SRD.ORG.LIN
       334**DCL      1100>>ASSIGN
KV$SRD.PRKCRS
       412**DCL      1068>>IF
KV$SRD.SRDEND
       545**DCL       550--REDEF
KV$SRD.TOPLFT
       366**DCL       371--REDEF
KV$SSN.INPCHR
       600**DCL      1077>>ASSIGN
KV$SSN.REDBFR.EDTLOWX
       602**DCL      1079>>IF       1080>>ASSIGN
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:160  
KV$SSN.REDBFR.NXTX
       601**DCL      1079>>IF
KV$SSN.REDBFR__.ADR$
       628**DCL      1028>>ASSIGN
KV$SSN.REDBFR__.DATBYTSIZ
       628**DCL      1021>>ASSIGN   1024>>IF
KV$SSN.REDRSPCNT
       588**DCL       589--REDEF
KV$STR.EDTBFR__
       684**DCL      1065<<ASSIGN
KV$STR.ERR.VDOTYP
       714**DCL      1077<<ASSIGN
KV$STR.RE_REDCLM
       690**DCL      1079<<ASSIGN   1080<<ASSIGN   1296<<ASSIGN
KV$VDI.INPUNT
       789**DCL      1062>>IF
KV$VDI.RE_DSPINP
       783**DCL      1030>>IF       1032<<ASSIGN   1067<<ASSIGN
KV$VDI.RE_DSPLOWX
       779**DCL      1033<<ASSIGN
KV@PTR
       895**DCL       996<<ASSIGN
KV@PTR.FLD$
       899**DCL        91--IMP-PTR  1017>>IF       1021>>ASSIGN   1021>>ASSIGN   1022>>ASSIGN   1023>>ASSIGN
      1028>>ASSIGN   1028>>ASSIGN   1036>>ASSIGN   1037>>ASSIGN   1078>>ASSIGN   1157<<ASSIGN   1158>>IF
      1160>>IF       1164>>IF       1166>>ASSIGN   1169<<ASSIGN   1212<<ASSIGN   1213>>IF       1214>>IF
      1216>>ASSIGN   1218<<ASSIGN   1226>>ASSIGN   1243>>ASSIGN   1246>>ASSIGN   1274<<ASSIGN   1275>>IF
KV@PTR.FLDLST$
       898**DCL       181--IMP-PTR  1153<<ASSIGN   1155>>IF       1156>>DOWHILE  1157>>ASSIGN   1160>>IF
      1169>>ASSIGN   1206<<ASSIGN   1207>>IF       1212>>ASSIGN   1218>>ASSIGN   1221>>IF       1242>>IF
      1265<<ASSIGN   1266>>IF       1268>>ASSIGN   1274>>ASSIGN
KV@PTR.FLDWRDX
       899**DCL      1150<<ASSIGN   1159>>IF       1160>>IF       1163<<ASSIGN   1168>>IF       1169>>ASSIGN
      1197<<ASSIGN   1200<<ASSIGN   1203<<ASSIGN   1207<<ASSIGN   1209>>IF       1212>>ASSIGN   1216<<ASSIGN
      1216>>ASSIGN   1217>>IF       1218>>ASSIGN   1221>>IF       1223<<ASSIGN   1226<<ASSIGN   1226>>ASSIGN
      1234<<ASSIGN   1241>>IF       1242>>IF       1243<<ASSIGN   1243>>ASSIGN   1244<<ASSIGN   1245>>IF
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:161  
      1246<<ASSIGN   1246>>ASSIGN   1247<<ASSIGN   1251>>IF       1267<<ASSIGN   1268<<ASSIGN   1273>>IF
      1274>>ASSIGN   1295>>ASSIGN
KV@PTR.INPCNDPND
       901**DCL       910--REDEF     914--REDEF
KV@PTR.LIN$
       898**DCL       206--IMP-PTR  1152<<ASSIGN   1153>>ASSIGN   1205<<ASSIGN   1206>>ASSIGN   1264<<ASSIGN
      1265>>ASSIGN   1293>>CALL     1294>>ASSIGN
KV@PTR.LINLST$
       897**DCL       231--IMP-PTR   898--REDEF    1042>>IF       1048>>IF       1078>>ASSIGN   1083>>IF
      1084>>ASSIGN   1084>>ASSIGN   1091>>IF       1152>>ASSIGN   1173>>IF       1179>>ASSIGN   1201>>IF
      1202>>ASSIGN   1205>>ASSIGN   1252>>IF       1255>>ASSIGN   1264>>ASSIGN   1294>>ASSIGN   1295>>ASSIGN
KV@PTR.MVD$
       896**DCL       260--IMP-PTR   998>>IF       1012>>ASSIGN   1042>>IF       1050>>ASSIGN   1066>>IF
      1134>>ASSIGN   1136>>DOWHILE  1137>>ASSIGN   1293>>IF       1301>>ASSIGN
KV@PTR.SRD$
       897**DCL       304--IMP-PTR  1035>>ASSIGN   1037>>ASSIGN   1037>>ASSIGN   1068>>IF       1070>>ASSIGN
      1070>>ASSIGN   1100>>ASSIGN   1125>>ASSIGN   1141>>ASSIGN   1143>>DOWHILE  1144>>ASSIGN
KV@PTR.SSN$
       895**DCL       582--IMP-PTR  1021>>ASSIGN   1024>>IF       1028>>ASSIGN   1077>>ASSIGN   1079>>IF
      1079>>IF       1080>>ASSIGN
KV@PTR.STR$
       895**DCL       660--IMP-PTR  1065>>ASSIGN   1077>>ASSIGN   1079>>ASSIGN   1080>>ASSIGN   1296>>ASSIGN
KV@PTR.VDI$
       895**DCL       748--IMP-PTR  1030>>IF       1032>>ASSIGN   1033>>ASSIGN   1062>>IF       1067>>ASSIGN
KV@PTR.VRTCLM
       900**DCL      1036<<ASSIGN   1127>>ASSIGN   1213>>IF       1214>>IF
KV@PTR.VRTLIN
       900**DCL      1111>>ASSIGN   1149<<ASSIGN   1152>>ASSIGN   1173>>IF       1174<<ASSIGN   1174>>ASSIGN
      1175<<ASSIGN   1177>>IF       1178<<ASSIGN   1178>>ASSIGN   1179<<ASSIGN   1195>>IF
KVF$ALLFLD_RSTRED
       837**DCL-ENT  1061--CALL
KVF$REDFRM
       839**DCL-ENT  1297--CALL
KVF$SND
       840**DCL-ENT  1085--CALL
KVF$UPDFRM_CRT
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:162  
       841**DCL-ENT  1043--CALL     1063--CALL
KVF$UPDFRM_HRDCPY
       842**DCL-ENT  1293--CALL
KVI$PRGRED
       843**DCL-ENT  1081--CALL
KVI$RE_DSPINP
       844**DCL-ENT  1031--CALL
KVI$TRMRED_VDH_DAT
       845**DCL-ENT  1082--CALL
KVO$PST
       846**DCL-ENT  1068--CALL     1072--CALL
KV_VDH_PST_ENDFRM
       991**DCL      1054--IF
KV_VDH_PST_HOM
       992**DCL      1068<>CALL
KV_VDH_PST_NEWLIN_VRT
       993**DCL      1072<>CALL
PRM_VDH_PST
       944**DCL         7--PROC     1054--IF
PRM_VDH_PST.HRZPSTORG
       951**DCL      1124>>IF       1126>>IF       1209>>IF       1233>>IF
PRM_VDH_PST.HRZPSTUNT
       952**DCL      1118>>IF
PRM_VDH_PST.PSTVAL
       982**DCL       987--REDEF
PRM_VDH_PST.PSTVAL.CLM
       984**DCL      1123>>ASSIGN   1191>>ASSIGN
PRM_VDH_PST.PSTVAL.LIN
       984**DCL      1096>>ASSIGN
PRM_VDH_PST.VRTPSTORG
       952**DCL      1099>>IF       1104>>IF
Y$REDBFR
       867**DCL      1028>>ASSIGN
Y@CLM
       852**DCL      1123<<ASSIGN   1125<<ASSIGN   1125>>ASSIGN   1127<<ASSIGN   1127>>ASSIGN   1132>>DOWHILE
      1134<<ASSIGN   1134>>ASSIGN   1136>>DOWHILE  1137<<ASSIGN   1137>>ASSIGN   1160>>IF       1160>>IF
PL6.E3A0      #004=KVF$PST File=KVF$TBLSCN.:E05TSI                               WED 07/30/97 02:00 Page:163  
      1164>>IF       1191<<ASSIGN   1215>>IF       1222>>IF       1235>>IF       1241>>IF       1252>>IF
      1256<<ASSIGN   1262<<ASSIGN   1267>>IF       1276>>IF       1276<<ASSIGN   1276>>ASSIGN   1277>>IF
      1277<<ASSIGN   1277>>ASSIGN   1278>>IF
Y@FLDTXTSIZ
       872**DCL       867--IMP-SIZ  1022<<ASSIGN   1028>>ASSIGN
Y@LIN
       856**DCL      1096<<ASSIGN   1100<<ASSIGN   1100>>ASSIGN   1110>>IF       1111<<ASSIGN   1111>>ASSIGN
      1133<<ASSIGN   1133>>ASSIGN   1138<<ASSIGN   1138>>ASSIGN   1140>>DOWHILE  1141<<ASSIGN   1141>>ASSIGN
      1143>>DOWHILE  1144<<ASSIGN   1144>>ASSIGN   1149>>ASSIGN   1154<<ASSIGN   1156>>DOWHILE  1157>>ASSIGN
      1163>>ASSIGN   1166<<ASSIGN   1166>>ASSIGN   1195>>IF       1196<<ASSIGN   1196>>ASSIGN   1198>>IF
      1199<<ASSIGN   1201>>IF       1202<<ASSIGN   1205>>ASSIGN   1217<<ASSIGN   1217>>ASSIGN   1224<<ASSIGN
      1224>>ASSIGN   1229<<ASSIGN   1229>>ASSIGN   1235<<ASSIGN   1235>>ASSIGN   1252>>IF       1253<<ASSIGN
      1253>>ASSIGN   1255<<ASSIGN   1258>>IF       1259<<ASSIGN   1259>>ASSIGN   1261<<ASSIGN   1264>>ASSIGN
Y@SRCDWN
       860**DCL      1095<<ASSIGN   1110<<ASSIGN   1172>>IF

PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:164  
     1013        1        /*T***********************************************************/
     1014        2        /*T*                                                         */
     1015        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1016        4        /*T*                                                         */
     1017        5        /*T***********************************************************/
     1018        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     1019        7        KVF$UPDFRM_HRDCPY: PROC (PRM_LIN);
     1020        8
     1021        9        /* The purpose of this routine is to do all the necessary positioing,
     1022       10           and display all the necessary fields,  to do a read from a hardcopy
     1023       11           forms device. The current KV$PTR and SRD.NXTNONBLNLIN,  tell
     1024       12           us where we are. KV$LIN.VRTLIN in the argument KV$LIN tells
     1025       13           us what line to go to.                                                    */
     1026       14
     1027       15 S      %INCLUDE KV$GLB;
     1028       16 S      %INCLUDE KV$GLBCTX;
     1029       17 S      %INCLUDE KV_GLBCNS_E;
     1030       18        %INCLUDE KV$INPFNC;
     1031      577 S      %INCLUDE KV$INT;
     1032      578 S      %INCLUDE KV$VDH;
     1033      579        %INCLUDE KV_GLB_M;
     1034      701        %INCLUDE KV_INT_M;
     1035      844
     1036      845        %KV$VDH_OTPLCL;
     1037      918        %KV$VDH_PST;
     1038      992        %KV$FLD;
     1039     1080        %KV$FLDLST;
     1040     1104        %KV$LIN;
     1041     1128        %KV$LINLST;
     1042     1155        %KV$SRD;
     1043     1430        %KV$VDI;
     1044     1501        %KV$PTR;
     1045     1544        %KV$LIN (NAME = PRM_LIN, STCLASS = PARAM);
     1046     1568        %KV_VRTPSTMOD_E;
     1047     1574
     1048     1575    1   DCL KVO$PST ENTRY(1);
     1049     1576    1   DCL KVO$OTPLCL ENTRY(1);
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:165  
     1050     1577
     1051     1578
     1052     1579        %KV$VDH_OTPLCL (NAME = KV@VDH_OTPLCL, STCLASS = AUTO);
     1053     1652        %KV$VDH_OTPLCL (NAME = KV_VDH_OTPLCL, STCLASS = SYMREF READONLY);
     1054     1725        %KV$VDH_PST (NAME = KV@VDH_PST, STCLASS = AUTO);
     1055     1799        %KV$VDH_PST (NAME = KV_VDH_PST_NEWLIN_VRT, STCLASS = SYMREF READONLY);
     1056     1873        /*
     1057     1874        Pointer to the current KV$FLD entry.
     1058     1875        */
     1059     1876    1   DCL Y@FLD$ PTR AUTO;
     1060     1877        /*
     1061     1878        Pointer to the current KV$LIN entry.
     1062     1879        */
     1063     1880    1   DCL Y@LIN$ PTR AUTO;
     1064     1881        /*
     1065     1882        Current KV$FLD's word index into KV$FLDLST.
     1066     1883        */
     1067     1884    1   DCL Y@FLDWRDX UBIN WORD AUTO;
     1068     1885        /*
     1069     1886        Also used in initialization to remember line to go to.
     1070     1887        */
     1071     1888    1   DCL Y@DSTLINX REDEF Y@FLDWRDX UBIN;
     1072     1889        /*
     1073     1890        Current KV$LIN's word index into KV$LINLST.
     1074     1891        */
     1075     1892    1   DCL Y@LINWRDX UBIN WORD AUTO;
     1076     1893
     1077     1894        /* Setup an initialized position structure                                    */
     1078     1895
     1079     1896    1      KV@VDH_PST = KV_VDH_PST_NEWLIN_VRT;
     1080     1897    1      KV@VDH_PST.VRTPSTMOD = %KV_VRTPSTMOD_WHTSPC;
     1081     1898
     1082     1899        /* And one for output                                                         */
     1083     1900
     1084     1901    1      KV@VDH_OTPLCL = KV_VDH_OTPLCL;
     1085     1902
     1086     1903        /* Restore srd margins in case we broke out of a read                         */
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:166  
     1087     1904
     1088     1905    1      %KV_SRD.FLDEND_PST = 0;
     1089     1906    1      Y@LIN$ = KV$PTR.LINLST$;
     1090     1907
     1091     1908    1      Y@DSTLINX = PRM_LIN.VRTLIN;
     1092     1909
     1093     1910        /* If we are at beginning of form,  output all protected and constant
     1094     1911           fields up to the first field to read from                                  */
     1095     1912
     1096     1913    1      Y@LINWRDX = %KV_SRD.NXTNONBLNLIN;
     1097     1914
     1098     1915        /* Start where we left off                                                    */
     1099     1916
     1100     1917    2      IF (Y@LINWRDX <= %KV_SRD.MINLNG) THEN DO;
     1101     1918    2         KV$PTR.VRTLIN = Y@LINWRDX;
     1102     1919    2         IF (Y@DSTLINX ~= Y@LINWRDX)
     1103     1920    3           OR NOT %KV_VDI.USRRQSDAT.RED THEN DO;
     1104     1921
     1105     1922        /* Going to a new line,  display it (at least)                                */
     1106     1923
     1107     1924    3            PRM_LIN.FRMDSP = '0'B;
     1108     1925    3            IF %KV_VDI.USRRQSDAT.RED
     1109     1926    4              OR (Y@DSTLINX = Y@LINWRDX) THEN DO;
     1110     1927    5               IF (Y@DSTLINX < Y@LINWRDX) THEN DO;
     1111     1928
     1112     1929        /* We're going up,  only put out one line (the destination)                   */
     1113     1930
     1114     1931    5                  Y@LINWRDX = Y@DSTLINX;
     1115     1932    5               END; ELSE DO;
     1116     1933    5                  KV$PTR.VRTLIN = KV$PTR.VRTLIN - 1;
     1117     1934    5               END;                        /* IF                                 */
     1118     1935    4            END;                           /* IF                                 */
     1119     1936    3         END; ELSE DO;
     1120     1937    3            RETURN;
     1121     1938    3         END;                              /* IF                                 */
     1122     1939    2         Y@LINWRDX = Y@LINWRDX*SIZEW(KV$LIN);
     1123     1940    2         Y@LINWRDX = Y@LINWRDX + SIZEW(KV$LINLST) - SIZEW(KV$LIN);
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:167  
     1124     1941    2      END; ELSE DO;
     1125     1942
     1126     1943        /* Build a pointer to the first line list entry                               */
     1127     1944
     1128     1945    2         Y@LINWRDX = SIZEW(KV$LINLST);
     1129     1946    2         KV$PTR.VRTLIN = 0;
     1130     1947    2      END; /* IF */
     1131     1948
     1132     1949        /* Dump all lines that have not been displayed up to the line that
     1133     1950           has the first input field on it                                            */
     1134     1951
     1135     1952    2      DO WHILE ('1'B);                     /* LOOP START                         */
     1136     1953
     1137     1954        /* Allways start dumping from first field on line                             */
     1138     1955
     1139     1956    2         Y@FLDWRDX = SIZEW(KV$FLDLST);
     1140     1957
     1141     1958        /* Build a pointer to this KV$LIN entry                                       */
     1142     1959
     1143     1960    2         Y@LIN$ = PINCRW(Y@LIN$, Y@LINWRDX);
     1144     1961
     1145     1962        /* If there are fields on this line,  its a candidate                         */
     1146     1963
     1147     1964
     1148     1965        /* Unless,  of course,  its beyond the desired range of lines                 */
     1149     1966
     1150     1967    2         IF NOT Y@LIN$->KV$LIN.FRMDSP
     1151     1968    3           OR Y@LIN$->KV$LIN.UPDFLDCNT > 0 THEN DO;
     1152     1969    3            Y@LIN$->KV$LIN.UPDFLDCNT = 0;
     1153     1970
     1154     1971    3            Y@LIN$->KV$LIN.FRMDSP = '1'B;
     1155     1972
     1156     1973    4            IF (Y@LIN$->KV$LIN.FLDLST$ ~= ADDR(NIL)) THEN DO;
     1157     1974    5               DO WHILE ('1'B);            /* LOOP START                         */
     1158     1975
     1159     1976        /* Dump the fields on this line                                               */
     1160     1977
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:168  
     1161     1978    5                  Y@FLD$ = Y@LIN$->KV$LIN.FLDLST$;
     1162     1979    5                  IF (Y@FLDWRDX > Y@FLD$->KV$FLDLST.LSTENTWRDX) THEN EXIT;
     1163     1980
     1164     1981        /* Point to the next field                                                    */
     1165     1982
     1166     1983    5                  Y@FLD$ = PINCRW(Y@FLD$, Y@FLDWRDX);
     1167     1984    6                  IF (Y@FLD$->KV$FLD.TXTSIZ ~= 0) AND NOT Y@FLD$->KV$FLD.GRPRND.HDN
              1984                           THEN DO;
     1168     1985
     1169     1986        /* Position to the field                                                      */
     1170     1987
     1171     1988    6                     KV@VDH_PST.PSTVAL.LIN = Y@LIN$->KV$LIN.VRTLIN - KV$PTR.VRTLIN;
     1172     1989    7                     IF (KV@VDH_PST.PSTVAL.LIN < 0) THEN DO;
     1173     1990    7                        KV@VDH_PST.PSTVAL.LIN = 1;
     1174     1991    7                     END;                  /* IF                                 */
     1175     1992    6                     KV$PTR.VRTLIN = Y@LIN$->KV$LIN.VRTLIN;
     1176     1993    6                     KV@VDH_PST.PSTVAL.CLM = Y@FLD$->KV$FLD.VRTCLM;
     1177     1994    6                     CALL KVO$PST(KV@VDH_PST) ;
     1178     1995    6                     KV@VDH_OTPLCL.BFR_.ADR$ = Y@FLD$;
     1179     1996    6                     KV@VDH_OTPLCL.BFR_.BYTSIZ = Y@FLD$->KV$FLD.TXTSIZ;
     1180     1997    6                     KV@VDH_OTPLCL.BFR_.BYTX = LENGTHC(KV$FLD) - 1;
     1181     1998    6                     CALL KVO$OTPLCL(KV@VDH_OTPLCL) ;
     1182     1999    6                  END;                     /* IF                                 */
     1183     2000    5                  Y@FLDWRDX = Y@FLDWRDX + Y@FLD$->KV$FLD.STRWRDSIZ;
     1184     2001    5               END;                        /* LOOP                               */
     1185     2002    4            END;                           /* IF                                 */
     1186     2003    3         END; ELSE DO;
     1187     2004    3            KV$PTR.VRTLIN = KV$PTR.VRTLIN + 1;
     1188     2005    3         END;                              /* IF                                 */
     1189     2006
     1190     2007    3         IF Y@LIN$=ADDR(PRM_LIN) THEN DO;
     1191     2008    3            %KV_SRD.NXTNONBLNLIN = KV$PTR.VRTLIN;
     1192     2009    3            RETURN;
     1193     2010    3         END;                              /* IF                                 */
     1194     2011    2         Y@LINWRDX = Y@LINWRDX + SIZEW(KV$LIN);
     1195     2012    2         Y@LIN$ = KV$PTR.LINLST$;
     1196     2013    3         IF (Y@LINWRDX > Y@LIN$->KV$LINLST.LSTENTWRDX) THEN DO;
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:169  
     1197     2014    3            Y@LINWRDX = SIZEW(KV$LINLST);
     1198     2015    3            KV$PTR.VRTLIN = 0;
     1199     2016    3         END;                              /* IF                                 */
     1200     2017
     1201     2018    2      END; /* LOOP */
     1202     2019    1   END; /* SUBROUTINE */
     1203     2020        %EOD;

PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:170  
--  Include file information  --

   KV_INT_M.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$UPDFRM_HRDCPY.

   Procedure KVF$UPDFRM_HRDCPY requires 286 words for executable code.
   Procedure KVF$UPDFRM_HRDCPY requires 24 words of local(AUTO) storage.

PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:171  

 Object Unit name= KVF$UPDFRM_HRDCPY                          File name= KVF$TBLSCN.:E05TOU
 UTS= JUL 30 '97 02:01:07.08 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   286    11E  KVF$UPDFRM_HRDCPY

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  KVF$UPDFRM_HRDCPY

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KVO$PST
         yes           Std       1 KVO$OTPLCL
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                          r    KV_VDH_OTPLCL                    r    KV_VDH_PST_NEWLIN_VRT
r    G$ROS$
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:172  


     1013        1        /*T***********************************************************/
     1014        2        /*T*                                                         */
     1015        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1016        4        /*T*                                                         */
     1017        5        /*T***********************************************************/
     1018        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     1019        7        KVF$UPDFRM_HRDCPY: PROC (PRM_LIN);

      7   0 000000  D380 0000 0000  xent KVF$UPDFRM_HRDC*LNJ,B5   X6A_AUTO_1
          0 000003       0018 0001                       DC       24,1

     1020        8
     1021        9        /* The purpose of this routine is to do all the necessary positioing,
     1022       10           and display all the necessary fields,  to do a read from a hardcopy
     1023       11           forms device. The current KV$PTR and SRD.NXTNONBLNLIN,  tell
     1024       12           us where we are. KV$LIN.VRTLIN in the argument KV$LIN tells
     1025       13           us what line to go to.                                                    */
     1026       14
     1027       15 S      %INCLUDE KV$GLB;
     1028       16 S      %INCLUDE KV$GLBCTX;
     1029       17 S      %INCLUDE KV_GLBCNS_E;
     1030       18        %INCLUDE KV$INPFNC;
     1031      577 S      %INCLUDE KV$INT;
     1032      578 S      %INCLUDE KV$VDH;
     1033      579        %INCLUDE KV_GLB_M;
     1034      701        %INCLUDE KV_INT_M;
     1035      844
     1036      845        %KV$VDH_OTPLCL;
     1037      918        %KV$VDH_PST;
     1038      992        %KV$FLD;
     1039     1080        %KV$FLDLST;
     1040     1104        %KV$LIN;
     1041     1128        %KV$LINLST;
     1042     1155        %KV$SRD;
     1043     1430        %KV$VDI;
     1044     1501        %KV$PTR;
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:173  
     1045     1544        %KV$LIN (NAME = PRM_LIN, STCLASS = PARAM);
     1046     1568        %KV_VRTPSTMOD_E;
     1047     1574
     1048     1575    1   DCL KVO$PST ENTRY(1);
     1049     1576    1   DCL KVO$OTPLCL ENTRY(1);
     1050     1577
     1051     1578
     1052     1579        %KV$VDH_OTPLCL (NAME = KV@VDH_OTPLCL, STCLASS = AUTO);
     1053     1652        %KV$VDH_OTPLCL (NAME = KV_VDH_OTPLCL, STCLASS = SYMREF READONLY);
     1054     1725        %KV$VDH_PST (NAME = KV@VDH_PST, STCLASS = AUTO);
     1055     1799        %KV$VDH_PST (NAME = KV_VDH_PST_NEWLIN_VRT, STCLASS = SYMREF READONLY);
     1056     1873        /*
     1057     1874        Pointer to the current KV$FLD entry.
     1058     1875        */
     1059     1876    1   DCL Y@FLD$ PTR AUTO;
     1060     1877        /*
     1061     1878        Pointer to the current KV$LIN entry.
     1062     1879        */
     1063     1880    1   DCL Y@LIN$ PTR AUTO;
     1064     1881        /*
     1065     1882        Current KV$FLD's word index into KV$FLDLST.
     1066     1883        */
     1067     1884    1   DCL Y@FLDWRDX UBIN WORD AUTO;
     1068     1885        /*
     1069     1886        Also used in initialization to remember line to go to.
     1070     1887        */
     1071     1888    1   DCL Y@DSTLINX REDEF Y@FLDWRDX UBIN;
     1072     1889        /*
     1073     1890        Current KV$LIN's word index into KV$LINLST.
     1074     1891        */
     1075     1892    1   DCL Y@LINWRDX UBIN WORD AUTO;
     1076     1893
     1077     1894        /* Setup an initialized position structure                                    */
     1078     1895
     1079     1896    1      KV@VDH_PST = KV_VDH_PST_NEWLIN_VRT;

   1896   0 000005  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_PST_NEWLIN_VRT
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:174  
          0 000008  2C00                                 LDV,R2   0
          0 000009  6C08                                 LDV,R6   8
          0 00000A  BB87                                 LAB,B3   ,AUTO
          0 00000B  3C16                                 LDV,R3   22
          0 00000C  0008                                 MMM

     1080     1897    1      KV@VDH_PST.VRTPSTMOD = %KV_VRTPSTMOD_WHTSPC;

   1897   0 00000D  6C20                                 LDV,R6   32
          0 00000E  EAC7 000B                            SRM,R6,'0060'X    KV@VDH_PST,AUTO
          0 000010       0060

     1081     1898
     1082     1899        /* And one for output                                                         */
     1083     1900
     1084     1901    1      KV@VDH_OTPLCL = KV_VDH_OTPLCL;

   1901   0 000011  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_OTPLCL
          0 000014  2C00                                 LDV,R2   0
          0 000015  6C0A                                 LDV,R6   10
          0 000016  BB87                                 LAB,B3   ,AUTO
          0 000017  3C0C                                 LDV,R3   12
          0 000018  0008                                 MMM

     1085     1902
     1086     1903        /* Restore srd margins in case we broke out of a read                         */
     1087     1904
     1088     1905    1      %KV_SRD.FLDEND_PST = 0;

   1905   0 000019  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 00001C  DCC6 000A                            LDB,B5   10,B6
          0 00001E  8745 0010                            CL       16,B5
          0 000020  8745 0011                            CL       17,B5

     1089     1906    1      Y@LIN$ = KV$PTR.LINLST$;

   1906   0 000022  DCC6 000E                            LDB,B5   14,B6
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:175  
          0 000024  DFC7 0011                            STB,B5   Y@LIN$,AUTO

     1090     1907
     1091     1908    1      Y@DSTLINX = PRM_LIN.VRTLIN;

   1908   0 000026  CCC7 0004                            LDB,B4   @PRM_LIN,AUTO
          0 000028  E844 0002                            LDR,R6   2,B4
          0 00002A  EF47 0013                            STR,R6   Y@FLDWRDX,AUTO

     1092     1909
     1093     1910        /* If we are at beginning of form,  output all protected and constant
     1094     1911           fields up to the first field to read from                                  */
     1095     1912
     1096     1913    1      Y@LINWRDX = %KV_SRD.NXTNONBLNLIN;

   1913   0 00002C  ACC6 000A                            LDB,B2   10,B6
          0 00002E  D842 0014                            LDR,R5   20,B2
          0 000030  DF47 0014                            STR,R5   Y@LINWRDX,AUTO

     1097     1914
     1098     1915        /* Start where we left off                                                    */
     1099     1916
     1100     1917    2      IF (Y@LINWRDX <= %KV_SRD.MINLNG) THEN DO;

   1917   0 000032  C842 001E                            LDR,R4   30,B2
          0 000034  C570 00FF                            AND,R4   255,IMO
          0 000036  C955                                 CMR,R4   R5
          0 000037  0201 002E                            BL       s:1945,PREL

     1101     1918    2         KV$PTR.VRTLIN = Y@LINWRDX;

   1918   0 000039  DF46 0019                            STR,R5   25,B6

     1102     1919    2         IF (Y@DSTLINX ~= Y@LINWRDX)

   1919   0 00003B  E955                                 CMR,R6   R5
          0 00003C  0981 0007                            BNE      s:1924,PREL
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:176  
          0 00003E  9C86                                 LDB,B1   ,B6
          0 00003F  82C1 001D                            LB,'0010'X        29,B1
          0 000041       0010
          0 000042  0501 0018                            BBT      s:1937,PREL

     1103     1920    3           OR NOT %KV_VDI.USRRQSDAT.RED THEN DO;

     1104     1921
     1105     1922        /* Going to a new line,  display it (at least)                                */
     1106     1923
     1107     1924    3            PRM_LIN.FRMDSP = '0'B;

   1924   0 000044  8844 0003                            LBF,'0080'X       3,B4
   1924   0 000046       0080

     1108     1925    3            IF %KV_VDI.USRRQSDAT.RED

   1925   0 000047  AC86                                 LDB,B2   ,B6
          0 000048  82C2 001D                            LB,'0010'X        29,B2
          0 00004A       0010
          0 00004B  0501 0003                            BBT      s:1927,PREL
          0 00004D  0981 0010                            BNE      s:1939,PREL

     1109     1926    4              OR (Y@DSTLINX = Y@LINWRDX) THEN DO;

     1110     1927    5               IF (Y@DSTLINX < Y@LINWRDX) THEN DO;

   1927   0 00004F  E955                                 CMR,R6   R5
          0 000050  0281 0006                            BGE      s:1933,PREL

     1111     1928
     1112     1929        /* We're going up,  only put out one line (the destination)                   */
     1113     1930
     1114     1931    5                  Y@LINWRDX = Y@DSTLINX;

   1931   0 000052  D856                                 LDR,R5   R6
          0 000053  DF47 0014                            STR,R5   Y@LINWRDX,AUTO
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:177  

     1115     1932    5               END; ELSE DO;

   1932   0 000055  0F81 0008                            B        s:1939,PREL

     1116     1933    5                  KV$PTR.VRTLIN = KV$PTR.VRTLIN - 1;

   1933   0 000057  88C6 0019                            DEC      25,B6

     1117     1934    5               END;                        /* IF                                 */

     1118     1935    4            END;                           /* IF                                 */

     1119     1936    3         END; ELSE DO;

   1936   0 000059  0F81 0004                            B        s:1939,PREL

     1120     1937    3            RETURN;

   1937   0 00005B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1121     1938    3         END;                              /* IF                                 */
     1122     1939    2         Y@LINWRDX = Y@LINWRDX*SIZEW(KV$LIN);

   1939   0 00005E  5002                                 SOL,R5   2
          0 00005F  DF47 0014                            STR,R5   Y@LINWRDX,AUTO

     1123     1940    2         Y@LINWRDX = Y@LINWRDX + SIZEW(KV$LINLST) - SIZEW(KV$LIN);

   1940   0 000061  5E04                                 ADV,R5   4
          0 000062  DF47 0014                            STR,R5   Y@LINWRDX,AUTO

     1124     1941    2      END; ELSE DO;

   1941   0 000064  0F81 0006                            B        s:1956,PREL

     1125     1942
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:178  
     1126     1943        /* Build a pointer to the first line list entry                               */
     1127     1944
     1128     1945    2         Y@LINWRDX = SIZEW(KV$LINLST);

   1945   0 000066  5C08                                 LDV,R5   8
          0 000067  DF47 0014                            STR,R5   Y@LINWRDX,AUTO

     1129     1946    2         KV$PTR.VRTLIN = 0;

   1946   0 000069  8746 0019                            CL       25,B6

     1130     1947    2      END; /* IF */

     1131     1948
     1132     1949        /* Dump all lines that have not been displayed up to the line that
     1133     1950           has the first input field on it                                            */
     1134     1951
     1135     1952    2      DO WHILE ('1'B);                     /* LOOP START                         */

     1136     1953
     1137     1954        /* Allways start dumping from first field on line                             */
     1138     1955
     1139     1956    2         Y@FLDWRDX = SIZEW(KV$FLDLST);

   1956   0 00006B  6C03                                 LDV,R6   3
          0 00006C  EF47 0013                            STR,R6   Y@FLDWRDX,AUTO

     1140     1957
     1141     1958        /* Build a pointer to this KV$LIN entry                                       */
     1142     1959
     1143     1960    2         Y@LIN$ = PINCRW(Y@LIN$, Y@LINWRDX);

   1960   0 00006E  F847 0014                            LDR,R7   Y@LINWRDX,AUTO
          0 000070  6C00                                 LDV,R6   0
          0 000071  8447 0011                            AID      Y@LIN$,AUTO
          0 000073  8D47 0011                            SDI      Y@LIN$,AUTO

PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:179  
     1144     1961
     1145     1962        /* If there are fields on this line,  its a candidate                         */
     1146     1963
     1147     1964
     1148     1965        /* Unless,  of course,  its beyond the desired range of lines                 */
     1149     1966
     1150     1967    2         IF NOT Y@LIN$->KV$LIN.FRMDSP

   1967   0 000075  ECC7 0011                            LDB,B6   Y@LIN$,AUTO
          0 000077  82C6 0003                            LB,'0080'X        3,B6
          0 000079       0080
          0 00007A  0581 0005                            BBF      s:1969,PREL
          0 00007C  D2C6 0003                            LLH,R5   3,B6
          0 00007E  5901 0071                            BEZ,R5   s:2004,PREL

     1151     1968    3           OR Y@LIN$->KV$LIN.UPDFLDCNT > 0 THEN DO;

     1152     1969    3            Y@LIN$->KV$LIN.UPDFLDCNT = 0;

   1969   0 000080  87C6 0003                            CLH      3,B6

     1153     1970
     1154     1971    3            Y@LIN$->KV$LIN.FRMDSP = '1'B;

   1971   0 000082  8946 0003                            LBT,'0080'X       3,B6
   1971   0 000084       0080

     1155     1972
     1156     1973    4            IF (Y@LIN$->KV$LIN.FLDLST$ ~= ADDR(NIL)) THEN DO;

   1973   0 000085  8D86                                 CMN      ,B6
          0 000086  0901 006E                            BE       s:2007,PREL

     1157     1974    5               DO WHILE ('1'B);            /* LOOP START                         */

     1158     1975
     1159     1976        /* Dump the fields on this line                                               */
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:180  
     1160     1977
     1161     1978    5                  Y@FLD$ = Y@LIN$->KV$LIN.FLDLST$;

   1978   0 000088  ECC7 0011                            LDB,B6   Y@LIN$,AUTO
          0 00008A  DC86                                 LDB,B5   ,B6
          0 00008B  DFC7 000F                            STB,B5   Y@FLD$,AUTO

     1162     1979    5                  IF (Y@FLDWRDX > Y@FLD$->KV$FLDLST.LSTENTWRDX) THEN EXIT;

   1979   0 00008D  E847 0013                            LDR,R6   Y@FLDWRDX,AUTO
          0 00008F  6801 005E                            BLZ,R6   s:2003,PREL
          0 000091  E945 0001                            CMR,R6   1,B5
          0 000093  0A01 005A                            BAG      s:2003,PREL

     1163     1980
     1164     1981        /* Point to the next field                                                    */
     1165     1982
     1166     1983    5                  Y@FLD$ = PINCRW(Y@FLD$, Y@FLDWRDX);

   1983   0 000095  F856                                 LDR,R7   R6
          0 000096  6C00                                 LDV,R6   0
          0 000097  8447 000F                            AID      Y@FLD$,AUTO
          0 000099  8D47 000F                            SDI      Y@FLD$,AUTO

     1167     1984    6                  IF (Y@FLD$->KV$FLD.TXTSIZ ~= 0) AND NOT Y@FLD$->KV$FLD.GRPRND.HDN
              1984                           THEN DO;

   1984   0 00009B  CCC7 000F                            LDB,B4   Y@FLD$,AUTO
          0 00009D  82C4 0005                            LB,'00FF'X        5,B4
          0 00009F       00FF
          0 0000A0  0581 0041                            BBF      s:2000,PREL
          0 0000A2  82C4 0003                            LB,'0040'X        3,B4
          0 0000A4       0040
          0 0000A5  0501 003C                            BBT      s:2000,PREL

     1168     1985
     1169     1986        /* Position to the field                                                      */
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:181  
     1170     1987
     1171     1988    6                     KV@VDH_PST.PSTVAL.LIN = Y@LIN$->KV$LIN.VRTLIN - KV$PTR.VRTLIN;

   1988   0 0000A7  BC80 0000 0000  xsym                 LDB,B3   KV$PTR$
          0 0000AA  D846 0002                            LDR,R5   2,B6
          0 0000AC  D243 0019                            SUB,R5   25,B3
          0 0000AE  DF47 000D                            STR,R5   KV@VDH_PST+2,AUTO

     1172     1989    7                     IF (KV@VDH_PST.PSTVAL.LIN < 0) THEN DO;

   1989   0 0000B0  5881 0004                            BGEZ,R5  s:1992,PREL

     1173     1990    7                        KV@VDH_PST.PSTVAL.LIN = 1;

   1990   0 0000B2  5C01                                 LDV,R5   1
          0 0000B3  DF47 000D                            STR,R5   KV@VDH_PST+2,AUTO

     1174     1991    7                     END;                  /* IF                                 */

     1175     1992    6                     KV$PTR.VRTLIN = Y@LIN$->KV$LIN.VRTLIN;

   1992   0 0000B5  C846 0002                            LDR,R4   2,B6
          0 0000B7  CF43 0019                            STR,R4   25,B3

     1176     1993    6                     KV@VDH_PST.PSTVAL.CLM = Y@FLD$->KV$FLD.VRTCLM;

   1993   0 0000B9  B2C4 0002                            LLH,R3   2,B4
          0 0000BB  BF47 000E                            STR,R3   KV@VDH_PST+3,AUTO

     1177     1994    6                     CALL KVO$PST(KV@VDH_PST) ;

   1994   0 0000BD  DBC7 000B                            LAB,B5   KV@VDH_PST,AUTO
          0 0000BF  DFC7 0016                            STB,B5   Y@LINWRDX+2,AUTO
          0 0000C1  BBC7 0016                            LAB,B3   Y@LINWRDX+2,AUTO
          0 0000C3  CBF0 0100                            LAB,B4   256,IMO
          0 0000C5  E380 0000 0000  xent                 LNJ,B6   KVO$PST
          0 0000C8       0001                            DC       s:1995,PREL
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:182  

     1178     1995    6                     KV@VDH_OTPLCL.BFR_.ADR$ = Y@FLD$;

   1995   0 0000C9  ECC7 000F                            LDB,B6   Y@FLD$,AUTO
          0 0000CB  EFC7 0007                            STB,B6   KV@VDH_OTPLCL+1,AUTO

     1179     1996    6                     KV@VDH_OTPLCL.BFR_.BYTSIZ = Y@FLD$->KV$FLD.TXTSIZ;

   1996   0 0000CD  E846 0005                            LDR,R6   5,B6
          0 0000CF  E570 00FF                            AND,R6   255,IMO
          0 0000D1  EF47 000A                            STR,R6   KV@VDH_OTPLCL+4,AUTO

     1180     1997    6                     KV@VDH_OTPLCL.BFR_.BYTX = LENGTHC(KV$FLD) - 1;

   1997   0 0000D3  5C0C                                 LDV,R5   12
          0 0000D4  DF47 0009                            STR,R5   KV@VDH_OTPLCL+3,AUTO

     1181     1998    6                     CALL KVO$OTPLCL(KV@VDH_OTPLCL) ;

   1998   0 0000D6  DBC7 0006                            LAB,B5   KV@VDH_OTPLCL,AUTO
          0 0000D8  DFC7 0016                            STB,B5   Y@LINWRDX+2,AUTO
          0 0000DA  BBC7 0016                            LAB,B3   Y@LINWRDX+2,AUTO
          0 0000DC  CBF0 0100                            LAB,B4   256,IMO
          0 0000DE  E380 0000 0000  xent                 LNJ,B6   KVO$OTPLCL
          0 0000E1       0001                            DC       s:2000,PREL

     1182     1999    6                  END;                     /* IF                                 */

     1183     2000    5                  Y@FLDWRDX = Y@FLDWRDX + Y@FLD$->KV$FLD.STRWRDSIZ;

   2000   0 0000E2  ECC7 000F                            LDB,B6   Y@FLD$,AUTO
          0 0000E4  E846 0001                            LDR,R6   1,B6
          0 0000E6  6008                                 SOL,R6   8
          0 0000E7  6068                                 SAR,R6   8
          0 0000E8  EA47 0013                            ADD,R6   Y@FLDWRDX,AUTO
          0 0000EA  EF47 0013                            STR,R6   Y@FLDWRDX,AUTO

PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:183  
     1184     2001    5               END;                        /* LOOP                               */

   2001   0 0000EC  0F81 FF9B                            B        s:1978,PREL

     1185     2002    4            END;                           /* IF                                 */

     1186     2003    3         END; ELSE DO;

   2003   0 0000EE  0F81 0006                            B        s:2007,PREL

     1187     2004    3            KV$PTR.VRTLIN = KV$PTR.VRTLIN + 1;

   2004   0 0000F0  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 0000F3  8AC5 0019                            INC      25,B5

     1188     2005    3         END;                              /* IF                                 */

     1189     2006
     1190     2007    3         IF Y@LIN$=ADDR(PRM_LIN) THEN DO;

   2007   0 0000F5  EDC7 0004                            CMB,B6   @PRM_LIN,AUTO
          0 0000F7  0981 000D                            BNE      s:2011,PREL

     1191     2008    3            %KV_SRD.NXTNONBLNLIN = KV$PTR.VRTLIN;

   2008   0 0000F9  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 0000FC  CCC5 000A                            LDB,B4   10,B5
          0 0000FE  E845 0019                            LDR,R6   25,B5
          0 000100  EF44 0014                            STR,R6   20,B4

     1192     2009    3            RETURN;

   2009   0 000102  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1193     2010    3         END;                              /* IF                                 */
     1194     2011    2         Y@LINWRDX = Y@LINWRDX + SIZEW(KV$LIN);

PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:184  
   2011   0 000105  E847 0014                            LDR,R6   Y@LINWRDX,AUTO
          0 000107  6E04                                 ADV,R6   4
          0 000108  EF47 0014                            STR,R6   Y@LINWRDX,AUTO

     1195     2012    2         Y@LIN$ = KV$PTR.LINLST$;

   2012   0 00010A  DC80 0000 0000  xsym                 LDB,B5   KV$PTR$
          0 00010D  CCC5 000E                            LDB,B4   14,B5
          0 00010F  CFC7 0011                            STB,B4   Y@LIN$,AUTO

     1196     2013    3         IF (Y@LINWRDX > Y@LIN$->KV$LINLST.LSTENTWRDX) THEN DO;

   2013   0 000111  6801 0005                            BLZ,R6   s:2014,PREL
          0 000113  E944 0001                            CMR,R6   1,B4
          0 000115  0A81 FF55                            BALE     s:1956,PREL

     1197     2014    3            Y@LINWRDX = SIZEW(KV$LINLST);

   2014   0 000117  6C08                                 LDV,R6   8
          0 000118  EF47 0014                            STR,R6   Y@LINWRDX,AUTO

     1198     2015    3            KV$PTR.VRTLIN = 0;

   2015   0 00011A  8745 0019                            CL       25,B5

     1199     2016    3         END;                              /* IF                                 */

     1200     2017
     1201     2018    2      END; /* LOOP */

   2018   0 00011C  0F81 FF4E                            B        s:1956,PREL
     1202     2019    1   END; /* SUBROUTINE */
     1203     2020        %EOD;

PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:185  
--  Include file information  --

   KV_INT_M.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$UPDFRM_HRDCPY.
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:186  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PRM_LIN                   6-0-0/w STRC(80)    r     1 KV@VDH_OTPLCL
     B-0-0/w STRC(64)    r     1 KV@VDH_PST                *0-0-0/w STRC(64)    r     1 PRM_LIN
    13-0-0/w UBIN(16)    r     1 Y@DSTLINX                  F-0-0/w PTR         r     1 Y@FLD$
    13-0-0/w UBIN(16)    r     1 Y@FLDWRDX                 11-0-0/w PTR         r     1 Y@LIN$
    14-0-0/w UBIN(16)    r     1 Y@LINWRDX

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(80)    r     1 KV_VDH_OTPLCL
     0-0-0/w STRC(64)    r     1 KV_VDH_PST_NEWLIN_VRT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(104)   r     1 KV$FLD                     0-0-0/w STRC(48)    r     1 KV$FLDLST
     0-0-0/w STRC(64)    r     1 KV$LIN                     0-0-0/w STRC(128)   r     1 KV$LINLST
     0-0-0/w STRC(480)   r     1 KV$PTR                     0-0-0/w STRC(496)   r     1 KV$SRD
     0-0-0/w STRC(512)   r     1 KV$VDI


   Procedure KVF$UPDFRM_HRDCPY requires 286 words for executable code.
   Procedure KVF$UPDFRM_HRDCPY requires 24 words of local(AUTO) storage.
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:187  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:188  
          MINI XREF LISTING

KV$FLD
      1013**DCL      1997--ASSIGN
KV$FLD.GRPRND.HDN
      1068**DCL      1984>>IF
KV$FLD.STRWRDSIZ
      1013**DCL      2000>>ASSIGN
KV$FLD.TXTSIZ
      1072**DCL      1984>>IF       1996>>ASSIGN
KV$FLD.VRTCLM
      1014**DCL      1993>>ASSIGN
KV$FLDLST
      1101**DCL      1956--ASSIGN
KV$FLDLST.LSTENTWRDX
      1101**DCL      1979>>IF
KV$LIN
      1125**DCL      1939--ASSIGN   1940--ASSIGN   2011--ASSIGN
KV$LIN.FLDLST$
      1125**DCL      1973>>IF       1978>>ASSIGN
KV$LIN.FRMDSP
      1126**DCL      1967>>IF       1971<<ASSIGN
KV$LIN.UPDFLDCNT
      1126**DCL      1967>>IF       1969<<ASSIGN
KV$LIN.VRTLIN
      1125**DCL      1988>>ASSIGN   1992>>ASSIGN
KV$LINLST
      1149**DCL      1940--ASSIGN   1945--ASSIGN   2014--ASSIGN
KV$LINLST.LSTENTWRDX
      1149**DCL      2013>>IF
KV$PTR.INPCNDPND
      1528**DCL      1537--REDEF    1541--REDEF
KV$PTR.LINLST$
      1524**DCL      1525--REDEF    1906>>ASSIGN   2012>>ASSIGN
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:189  
KV$PTR.SRD$
      1524**DCL      1905>>ASSIGN   1913>>ASSIGN   1917>>IF       2008>>ASSIGN
KV$PTR.VDI$
      1522**DCL      1919>>IF       1925>>IF
KV$PTR.VRTLIN
      1527**DCL      1918<<ASSIGN   1933<<ASSIGN   1933>>ASSIGN   1946<<ASSIGN   1988>>ASSIGN   1992<<ASSIGN
      2004<<ASSIGN   2004>>ASSIGN   2008>>ASSIGN   2015<<ASSIGN
KV$PTR$
      1516**DCL      1522--IMP-PTR  1905>>ASSIGN   1906>>ASSIGN   1913>>ASSIGN   1917>>IF       1918>>ASSIGN
      1919>>IF       1925>>IF       1933>>ASSIGN   1933>>ASSIGN   1946>>ASSIGN   1988>>ASSIGN   1992>>ASSIGN
      2004>>ASSIGN   2004>>ASSIGN   2008>>ASSIGN   2008>>ASSIGN   2012>>ASSIGN   2015>>ASSIGN
KV$SRD.BTMRHT
      1272**DCL      1277--REDEF
KV$SRD.CRT
      1348**DCL      1353--REDEF
KV$SRD.FLDEND
      1312**DCL      1317--REDEF
KV$SRD.FLDEND_PST
      1317**DCL      1905<<ASSIGN
KV$SRD.HI_NONBLN
      1382**DCL      1387--REDEF
KV$SRD.MINLNG
      1428**DCL      1917>>IF
KV$SRD.NXTNONBLNLIN
      1320**DCL      1913>>ASSIGN   2008<<ASSIGN
KV$SRD.ORG
      1204**DCL      1209--REDEF
KV$SRD.SRDEND
      1417**DCL      1422--REDEF
KV$SRD.TOPLFT
      1238**DCL      1243--REDEF
KV$VDH_PST.PSTVAL
       983**DCL       988--REDEF
KV$VDI.USRRQSDAT.RED
      1492**DCL      1919>>IF       1925>>IF
KV@VDH_OTPLCL
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:190  
      1615**DCL      1901<<ASSIGN   1998<>CALL
KV@VDH_OTPLCL.BFR_.ADR$
      1648**DCL      1995<<ASSIGN
KV@VDH_OTPLCL.BFR_.BYTSIZ
      1648**DCL      1996<<ASSIGN
KV@VDH_OTPLCL.BFR_.BYTX
      1648**DCL      1997<<ASSIGN
KV@VDH_PST
      1752**DCL      1896<<ASSIGN   1994<>CALL
KV@VDH_PST.PSTVAL
      1790**DCL      1795--REDEF
KV@VDH_PST.PSTVAL.CLM
      1792**DCL      1993<<ASSIGN
KV@VDH_PST.PSTVAL.LIN
      1792**DCL      1988<<ASSIGN   1989>>IF       1990<<ASSIGN
KV@VDH_PST.VRTPSTMOD
      1758**DCL      1897<<ASSIGN
KVO$OTPLCL
      1576**DCL-ENT  1998--CALL
KVO$PST
      1575**DCL-ENT  1994--CALL
KV_VDH_OTPLCL
      1688**DCL      1901>>ASSIGN
KV_VDH_PST_NEWLIN_VRT
      1826**DCL      1896>>ASSIGN
KV_VDH_PST_NEWLIN_VRT.PSTVAL
      1864**DCL      1869--REDEF
PRM_LIN
      1565**DCL         7--PROC     2007--IF
PRM_LIN.FRMDSP
      1566**DCL      1924<<ASSIGN
PRM_LIN.VRTLIN
      1565**DCL      1908>>ASSIGN
Y@DSTLINX
      1888**DCL      1908<<ASSIGN   1919>>IF       1925>>IF       1927>>IF       1931>>ASSIGN
Y@FLD$
PL6.E3A0      #005=KVF$UPDFRM_HRDCPY File=KVF$TBLSCN.:E05TSI                     WED 07/30/97 02:01 Page:191  
      1876**DCL      1978<<ASSIGN   1979>>IF       1983<<ASSIGN   1983>>ASSIGN   1984>>IF       1984>>IF
      1993>>ASSIGN   1995>>ASSIGN   1996>>ASSIGN   2000>>ASSIGN
Y@FLDWRDX
      1884**DCL      1888--REDEF    1956<<ASSIGN   1979>>IF       1983>>ASSIGN   2000<<ASSIGN   2000>>ASSIGN
Y@LIN$
      1880**DCL      1906<<ASSIGN   1960<<ASSIGN   1960>>ASSIGN   1967>>IF       1967>>IF       1969>>ASSIGN
      1971>>ASSIGN   1973>>IF       1978>>ASSIGN   1988>>ASSIGN   1992>>ASSIGN   2007>>IF       2012<<ASSIGN
      2013>>IF
Y@LINWRDX
      1892**DCL      1913<<ASSIGN   1917>>IF       1918>>ASSIGN   1919>>IF       1925>>IF       1927>>IF
      1931<<ASSIGN   1939<<ASSIGN   1939>>ASSIGN   1940<<ASSIGN   1940>>ASSIGN   1945<<ASSIGN   1960>>ASSIGN
      2011<<ASSIGN   2011>>ASSIGN   2013>>IF       2014<<ASSIGN

PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:192  
     1204        1        /*T***********************************************************/
     1205        2        /*T*                                                         */
     1206        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1207        4        /*T*                                                         */
     1208        5        /*T***********************************************************/
     1209        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     1210        7        KVF$REDFRM: PROC;
     1211        8
     1212        9        /* The purpose of this routine is to read a form from a CRT type
     1213       10           device. This routine assumes that the form is allready present
     1214       11           on the device and that all that is basically necessary is to
     1215       12           position to the start of the input field indicated by KV$LINLST.ONEFLDLIN$
     1216       13           and KV$LINLST.ONEFLDWRDX and do the read.                       */
     1217       14
     1218       15 S      %INCLUDE KV$GLB;
     1219       16 S      %INCLUDE KV$GLBCTX;
     1220       17 S      %INCLUDE KV_GLBCNS_E;
     1221       18        %INCLUDE KV$INPFNC;
     1222      577 S      %INCLUDE KV$INT;
     1223      578 S      %INCLUDE KV$USR;
     1224      579 S      %INCLUDE KV$VDH;
     1225      580        %INCLUDE KV_GLB_M;
     1226      702        %INCLUDE KV_INT_M;
     1227      845
     1228      846    1   DCL KVI$RQSDAT ENTRY(1);
     1229      847    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
     1230      848    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
     1231      849
     1232      850        %KV$PTR;
     1233      893        %KV$FLD (STCLASS="BASED(Y@FLD$)");
     1234      981        %EQU KV_FLD=CHARTEXT('KV$FLD');
     1235      982        %KV$LIN;
     1236     1006        %KV$LINLST;
     1237     1033        %KV$MRD (NAME=Y@MRD);
     1238     1080        %EQU KV_MRD=CHARTEXT('KV$SRD.MRD$->Y@MRD');
     1239     1081        %KV$MVD;
     1240     1125        %KV$SRD (STCLASS="BASED(Y@SRD$)");
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:193  
     1241     1400        %EQU KV_SRD=CHARTEXT('KV$SRD');
     1242     1401        %KV$STR;
     1243     1488        %KV$VDI;
     1244     1559        %KV_INPUNT_E;
     1245     1564        %KV_PHSPSTMOD_E;
     1246     1571
     1247     1572    1   DCL Y@SRD$ PTR;
     1248     1573    1   DCL Y@FLD$ PTR;
     1249     1574        %KV$USR_RQSDAT (NAME = KV@USR_RQSDAT, STCLASS = AUTO);
     1250     1637        %KV$USR_RQSDAT (NAME = KV_USR_RQSDAT, STCLASS = SYMREF READONLY);
     1251     1700        %KV$USR_SETATR (NAME = KV@USR_SETATR, STCLASS = AUTO);
     1252     1823        %KV$USR_SETATR (NAME = KV_USR_SETATR, STCLASS = SYMREF READONLY);
     1253     1946    1   DCL FRSWRD UBIN BASED ALIGNED;
     1254     1947
     1255     1948        /* Set up KV$PTR. */
     1256     1949
     1257     1950    1      KV$PTR.FLDWRDX = %KV_LINLST.ONEFLDWRDX;
     1258     1951    1      KV$PTR.LIN$ = %KV_LINLST.ONEFLDLIN$;
     1259     1952    1      KV$PTR.FLDLST$ = %KV_LIN.FLDLST$;
     1260     1953    1      KV$PTR.FLD$ = PINCRW(KV$PTR.FLDLST$,KV$PTR.FLDWRDX);
     1261     1954    1      Y@FLD$ = KV$PTR.FLD$;
     1262     1955    1      Y@SRD$ = KV$PTR.SRD$;
     1263     1956    1      KV$PTR.VRTLIN = %KV_LIN.VRTLIN;
     1264     1957    1      KV@USR_SETATR.PHSPST.LIN = KV$PTR.VRTLIN+%KV_SRD.ORG.LIN;
     1265     1958    2      IF %KV_FLD.ATRCLM~=0 AND (%KV_MRD.DCLATRWHNOTP OR %KV_FLD.UPD.ATR) THEN DO;
     1266     1959    2         %KV_STR.GRPRND = %KV_FLD.GRPRND;
     1267     1960    2         IF %KV_MRD.DCLATRWHNOTP
     1268     1961    2           AND BITBIN(%KV_FLD.GRPRND)=BITBIN(%KV_MRD.DVCATR) THEN EXIT;
     1269     1962
     1270     1963        /* If we've never set the attribute here . Or ..                             */
     1271     1964
     1272     1965        /* Since this device works that way,  enter the proper screen mode            */
     1273     1966
     1274     1967    2         ADDR(KV@USR_SETATR)->FRSWRD = ADDR(KV_USR_SETATR)->FRSWRD;
     1275     1968    2         KV@USR_SETATR.PHSPST.CLM = %KV_FLD.ATRCLM+%KV_SRD.ORG.CLM;
     1276     1969    2         %KV_FLD.UPD.ATR = '0'B;
     1277     1970    2         KV@USR_SETATR.GRPRND = %KV_FLD.GRPRND;
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:194  
     1278     1971    2         KV@USR_SETATR.QLF = %KV_FLD.QLF;
     1279     1972    2         CALL KVV$CALUSR (KV@USR_SETATR);
     1280     1973    2      END; /* IF */
     1281     1974    1      ELSE IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN
     1282     1975    1      THEN CALL KVV$CALUSR_PST;
     1283     1976
     1284     1977        /* Setup the SRD structure to get to start of field                      */
     1285     1978
     1286     1979    1      KV@USR_SETATR.PHSPST.CLM = %KV_FLD.VRTCLM+%KV_SRD.ORG.CLM;
     1287     1980    1      IF %KV_MRD.ATRRQRDSPPST
     1288     1981    1      THEN KV@USR_SETATR.PHSPST.CLM = KV@USR_SETATR.PHSPST.CLM+1;
     1289     1982    1      IF NOT %KV_MVD.RETYPOVR
     1290     1983    1      THEN KV@USR_SETATR.PHSPST.LIN = %KV_SRD.CRT.LIN;
     1291     1984    2      ELSE DO;
     1292     1985    2         %KV_SRD.HI_NONBLN.LIN = KV@USR_SETATR.PHSPST.LIN;
     1293     1986    2         %KV_SRD.FLDEND.LIN = KV@USR_SETATR.PHSPST.LIN;
     1294     1987    2         %KV_SRD.HI_NONBLN.CLM = %KV_FLD.HI_NONBLNCLM+%KV_SRD.ORG.CLM;
     1295     1988    2         IF %KV_MRD.SMLHDNATR AND %KV_FLD.GRPRND.HDN
     1296     1989    2         THEN %KV_MVD.DISPINPUT = '0'B;
     1297     1990    2         ELSE %KV_MVD.DISPINPUT = '1'B;
     1298     1991    2      END; /* IF */
     1299     1992    2      IF KV@USR_SETATR.PHSPST_PST~=%KV_SRD.CRT_PST THEN DO;
     1300     1993    2         %KV_SRD.CRT_PST = KV@USR_SETATR.PHSPST_PST;
     1301     1994    2         %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;
     1302     1995    2      END;
     1303     1996    1      %KV_MVD.VRTCLM = %KV_SRD.CRT.CLM;
     1304     1997    1      %KV_SRD.FLDEND.CLM = %KV_SRD.CRT.CLM+%KV_FLD.WDT-1;
     1305     1998    1      %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRT.LIN;
     1306     1999
     1307     2000    1      %KV_SRD.VRTPSTOK = '1'B;
     1308     2001    1      %KV_SRD.HI_NONBLNVRT = '1'B;
     1309     2002
     1310     2003        /* Do the read                                                                */
     1311     2004
     1312     2005    1      KV@USR_RQSDAT = KV_USR_RQSDAT;
     1313     2006    1      KV@USR_RQSDAT.BFR_.ADR$ = KV$PTR.FLD$;
     1314     2007    1      KV@USR_RQSDAT.BFR_.BYTX = LENGTHC(KV$FLD) - 1;
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:195  
     1315     2008    1      KV@USR_RQSDAT.MAXRCRBYTSIZ = %KV_FLD.WDT;
     1316     2009    1      KV@USR_RQSDAT.BFR_.BYTSIZ = %KV_FLD.TXTSIZ;
     1317     2010    1      KV@USR_RQSDAT.RE_RED = '1'B;
     1318     2011    1      CALL KVI$RQSDAT(KV@USR_RQSDAT) ;
     1319     2012    1      RETURN;
     1320     2013    1   END; /* SUBROUTINE */

PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:196  
--  Include file information  --

   KV_INT_M.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$REDFRM.

   Procedure KVF$REDFRM requires 285 words for executable code.
   Procedure KVF$REDFRM requires 20 words of local(AUTO) storage.

    No errors detected in file KVF$TBLSCN.:E05TSI    .

PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:197  

 Object Unit name= KVF$REDFRM                                 File name= KVF$TBLSCN.:E05TOU
 UTS= JUL 30 '97 02:01:41.92 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   285    11D  KVF$REDFRM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        0  KVF$REDFRM

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KVV$CALUSR
 yes     yes           Std       0 KVV$CALUSR_PST
         yes           Std       1 KVI$RQSDAT
                       nStd      0 X6A_AUTO_0
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                          r    KV_USR_RQSDAT                    r    KV_USR_SETATR
r    G$ROS$
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:198  


     1204        1        /*T***********************************************************/
     1205        2        /*T*                                                         */
     1206        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1207        4        /*T*                                                         */
     1208        5        /*T***********************************************************/
     1209        6        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IND=0,IAD=3 */
     1210        7        KVF$REDFRM: PROC;

      7   0 000000  D380 0000 0000  xent KVF$REDFRM      LNJ,B5   X6A_AUTO_0
          0 000003       0014 0000                       DC       20,0

     1211        8
     1212        9        /* The purpose of this routine is to read a form from a CRT type
     1213       10           device. This routine assumes that the form is allready present
     1214       11           on the device and that all that is basically necessary is to
     1215       12           position to the start of the input field indicated by KV$LINLST.ONEFLDLIN$
     1216       13           and KV$LINLST.ONEFLDWRDX and do the read.                       */
     1217       14
     1218       15 S      %INCLUDE KV$GLB;
     1219       16 S      %INCLUDE KV$GLBCTX;
     1220       17 S      %INCLUDE KV_GLBCNS_E;
     1221       18        %INCLUDE KV$INPFNC;
     1222      577 S      %INCLUDE KV$INT;
     1223      578 S      %INCLUDE KV$USR;
     1224      579 S      %INCLUDE KV$VDH;
     1225      580        %INCLUDE KV_GLB_M;
     1226      702        %INCLUDE KV_INT_M;
     1227      845
     1228      846    1   DCL KVI$RQSDAT ENTRY(1);
     1229      847    1   DCL KVV$CALUSR ENTRY(1) ALTRET;
     1230      848    1   DCL KVV$CALUSR_PST ENTRY ALTRET;
     1231      849
     1232      850        %KV$PTR;
     1233      893        %KV$FLD (STCLASS="BASED(Y@FLD$)");
     1234      981        %EQU KV_FLD=CHARTEXT('KV$FLD');
     1235      982        %KV$LIN;
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:199  
     1236     1006        %KV$LINLST;
     1237     1033        %KV$MRD (NAME=Y@MRD);
     1238     1080        %EQU KV_MRD=CHARTEXT('KV$SRD.MRD$->Y@MRD');
     1239     1081        %KV$MVD;
     1240     1125        %KV$SRD (STCLASS="BASED(Y@SRD$)");
     1241     1400        %EQU KV_SRD=CHARTEXT('KV$SRD');
     1242     1401        %KV$STR;
     1243     1488        %KV$VDI;
     1244     1559        %KV_INPUNT_E;
     1245     1564        %KV_PHSPSTMOD_E;
     1246     1571
     1247     1572    1   DCL Y@SRD$ PTR;
     1248     1573    1   DCL Y@FLD$ PTR;
     1249     1574        %KV$USR_RQSDAT (NAME = KV@USR_RQSDAT, STCLASS = AUTO);
     1250     1637        %KV$USR_RQSDAT (NAME = KV_USR_RQSDAT, STCLASS = SYMREF READONLY);
     1251     1700        %KV$USR_SETATR (NAME = KV@USR_SETATR, STCLASS = AUTO);
     1252     1823        %KV$USR_SETATR (NAME = KV_USR_SETATR, STCLASS = SYMREF READONLY);
     1253     1946    1   DCL FRSWRD UBIN BASED ALIGNED;
     1254     1947
     1255     1948        /* Set up KV$PTR. */
     1256     1949
     1257     1950    1      KV$PTR.FLDWRDX = %KV_LINLST.ONEFLDWRDX;

   1950   0 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 000008  DCC6 000E                            LDB,B5   14,B6
          0 00000A  E845 0004                            LDR,R6   4,B5
          0 00000C  EF46 0018                            STR,R6   24,B6

     1258     1951    1      KV$PTR.LIN$ = %KV_LINLST.ONEFLDLIN$;

   1951   0 00000E  CCC5 0002                            LDB,B4   2,B5
          0 000010  CFC6 0010                            STB,B4   16,B6

     1259     1952    1      KV$PTR.FLDLST$ = %KV_LIN.FLDLST$;

   1952   0 000012  BC84                                 LDB,B3   ,B4
          0 000013  BFC6 0012                            STB,B3   18,B6
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:200  

     1260     1953    1      KV$PTR.FLD$ = PINCRW(KV$PTR.FLDLST$,KV$PTR.FLDWRDX);

   1953   0 000015  B856                                 LDR,R3   R6
          0 000016  ABB3                                 LAB,B2   ,B3,R3
          0 000017  AFC6 0014                            STB,B2   20,B6

     1261     1954    1      Y@FLD$ = KV$PTR.FLD$;

   1954   0 000019  AFC7 0006                            STB,B2   Y@FLD$,AUTO

     1262     1955    1      Y@SRD$ = KV$PTR.SRD$;

   1955   0 00001B  9CC6 000A                            LDB,B1   10,B6
          0 00001D  9FC7 0004                            STB,B1   Y@SRD$,AUTO

     1263     1956    1      KV$PTR.VRTLIN = %KV_LIN.VRTLIN;

   1956   0 00001F  D844 0002                            LDR,R5   2,B4
          0 000021  DF46 0019                            STR,R5   25,B6

     1264     1957    1      KV@USR_SETATR.PHSPST.LIN = KV$PTR.VRTLIN+%KV_SRD.ORG.LIN;

   1957   0 000023  DA41 0007                            ADD,R5   7,B1
          0 000025  DF47 000F                            STR,R5   KV@USR_SETATR+1,AUTO

     1265     1958    2      IF %KV_FLD.ATRCLM~=0 AND (%KV_MRD.DCLATRWHNOTP OR %KV_FLD.UPD.ATR) THEN DO;

   1958   0 000027  C2C2 0005                            LLH,R4   5,B2
          0 000029  4901 004A                            BEZ,R4   s:1974,PREL
          0 00002B  DC81                                 LDB,B5   ,B1
          0 00002C  82C5 0018                            LB,'0200'X        24,B5
          0 00002E       0200
          0 00002F  0501 0006                            BBT      s:1959,PREL
          0 000031  82C2 0002                            LB,'0080'X        2,B2
          0 000033       0080
          0 000034  0581 003F                            BBF      s:1974,PREL
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:201  

     1266     1959    2         %KV_STR.GRPRND = %KV_FLD.GRPRND;

   1959   0 000036  DCC6 0004                            LDB,B5   4,B6
          0 000038  A842 0003                            LDR,R2   3,B2
          0 00003A  2008                                 SOL,R2   8
          0 00003B  2048                                 SOR,R2   8
          0 00003C  A7C5 001F                            STH,R2   31,B5

     1267     1960    2         IF %KV_MRD.DCLATRWHNOTP

   1960   0 00003E  DC81                                 LDB,B5   ,B1
          0 00003F  82C5 0018                            LB,'0200'X        24,B5
          0 000041       0200
          0 000042  0581 000A                            BBF      s:1967,PREL
          0 000044  C842 0003                            LDR,R4   3,B2
          0 000046  C570 00FF                            AND,R4   255,IMO
          0 000048  A2C5 001F                            LLH,R2   31,B5
          0 00004A  C952                                 CMR,R4   R2
          0 00004B  0901 0026                            BE       s:1973,PREL

     1268     1961    2           AND BITBIN(%KV_FLD.GRPRND)=BITBIN(%KV_MRD.DVCATR) THEN EXIT;
     1269     1962
     1270     1963        /* If we've never set the attribute here . Or ..                             */
     1271     1964
     1272     1965        /* Since this device works that way,  enter the proper screen mode            */
     1273     1966
     1274     1967    2         ADDR(KV@USR_SETATR)->FRSWRD = ADDR(KV_USR_SETATR)->FRSWRD;

   1967   0 00004D  C800 0000 0000  xsym                 LDR,R4   KV_USR_SETATR
          0 000050  CF47 000E                            STR,R4   KV@USR_SETATR,AUTO

     1275     1968    2         KV@USR_SETATR.PHSPST.CLM = %KV_FLD.ATRCLM+%KV_SRD.ORG.CLM;

   1968   0 000052  A2C2 0005                            LLH,R2   5,B2
          0 000054  AA41 0008                            ADD,R2   8,B1
          0 000056  AF47 0010                            STR,R2   KV@USR_SETATR+2,AUTO
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:202  

     1276     1969    2         %KV_FLD.UPD.ATR = '0'B;

   1969   0 000058  8842 0002                            LBF,'0080'X       2,B2
   1969   0 00005A       0080

     1277     1970    2         KV@USR_SETATR.GRPRND = %KV_FLD.GRPRND;

   1970   0 00005B  D842 0003                            LDR,R5   3,B2
          0 00005D  DAC7 0011                            SRM,R5,'00FF'X    KV@USR_SETATR+3,AUTO
          0 00005F       00FF

     1278     1971    2         KV@USR_SETATR.QLF = %KV_FLD.QLF;

   1971   0 000060  D2C2 0003                            LLH,R5   3,B2
          0 000062  5008                                 SOL,R5   8
          0 000063  5048                                 SOR,R5   8
          0 000064  D7C7 0011                            STH,R5   KV@USR_SETATR+3,AUTO

     1279     1972    2         CALL KVV$CALUSR (KV@USR_SETATR);

   1972   0 000066  DBC7 000E                            LAB,B5   KV@USR_SETATR,AUTO
          0 000068  DFC7 0012                            STB,B5   KV@USR_SETATR+4,AUTO
          0 00006A  BBC7 0012                            LAB,B3   KV@USR_SETATR+4,AUTO
          0 00006C  CBF0 0100                            LAB,B4   256,IMO
          0 00006E  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR
          0 000071       0001                            DC       s:1973,PREL

     1280     1973    2      END; /* IF */

   1973   0 000072  0F81 000D                            B        s:1979,PREL

     1281     1974    1      ELSE IF %KV_VDI.OTPCNDPND.PST=%KV_PHSPSTMOD_BLN

   1974   0 000074  DC86                                 LDB,B5   ,B6
          0 000075  A845 001A                            LDR,R2   26,B5
          0 000077  2D02                                 CMV,R2   2
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:203  
          0 000078  0981 0007                            BNE      s:1979,PREL

     1282     1975    1      THEN CALL KVV$CALUSR_PST;

   1975   0 00007A  CBF0 0000                            LAB,B4   0,IMO
          0 00007C  E380 0000 0000  xent                 LNJ,B6   KVV$CALUSR_PST
          0 00007F       0001                            DC       s:1979,PREL

     1283     1976
     1284     1977        /* Setup the SRD structure to get to start of field                      */
     1285     1978
     1286     1979    1      KV@USR_SETATR.PHSPST.CLM = %KV_FLD.VRTCLM+%KV_SRD.ORG.CLM;

   1979   0 000080  ECC7 0004                            LDB,B6   Y@SRD$,AUTO
          0 000082  DCC7 0006                            LDB,B5   Y@FLD$,AUTO
          0 000084  E2C5 0002                            LLH,R6   2,B5
          0 000086  EA46 0008                            ADD,R6   8,B6
          0 000088  EF47 0010                            STR,R6   KV@USR_SETATR+2,AUTO

     1287     1980    1      IF %KV_MRD.ATRRQRDSPPST

   1980   0 00008A  CC86                                 LDB,B4   ,B6
          0 00008B  89C4 0018                            CMZ      24,B4
          0 00008D  0881 0003                            BAGE     s:1982,PREL

     1288     1981    1      THEN KV@USR_SETATR.PHSPST.CLM = KV@USR_SETATR.PHSPST.CLM+1;

   1981   0 00008F  8AC7 0010                            INC      KV@USR_SETATR+2,AUTO

     1289     1982    1      IF NOT %KV_MVD.RETYPOVR

   1982   0 000091  CC80 0000 0000  xsym                 LDB,B4   KV$PTR$
          0 000094  BCC4 0006                            LDB,B3   6,B4
          0 000096  82C3 0016                            LB,'0080'X        22,B3
          0 000098       0080
          0 000099  0501 0007                            BBT      s:1985,PREL

PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:204  
     1290     1983    1      THEN KV@USR_SETATR.PHSPST.LIN = %KV_SRD.CRT.LIN;

   1983   0 00009B  E846 0015                            LDR,R6   21,B6
          0 00009D  EF47 000F                            STR,R6   KV@USR_SETATR+1,AUTO
          0 00009F  0F81 0026                            B        s:1992,PREL

     1291     1984    2      ELSE DO;

     1292     1985    2         %KV_SRD.HI_NONBLN.LIN = KV@USR_SETATR.PHSPST.LIN;

   1985   0 0000A1  E847 000F                            LDR,R6   KV@USR_SETATR+1,AUTO
          0 0000A3  EF46 0017                            STR,R6   23,B6

     1293     1986    2         %KV_SRD.FLDEND.LIN = KV@USR_SETATR.PHSPST.LIN;

   1986   0 0000A5  EF46 0010                            STR,R6   16,B6

     1294     1987    2         %KV_SRD.HI_NONBLN.CLM = %KV_FLD.HI_NONBLNCLM+%KV_SRD.ORG.CLM;

   1987   0 0000A7  D845 0004                            LDR,R5   4,B5
          0 0000A9  D570 00FF                            AND,R5   255,IMO
          0 0000AB  DA46 0008                            ADD,R5   8,B6
          0 0000AD  DF46 0018                            STR,R5   24,B6

     1295     1988    2         IF %KV_MRD.SMLHDNATR AND %KV_FLD.GRPRND.HDN

   1988   0 0000AF  BC86                                 LDB,B3   ,B6
          0 0000B0  82C3 0016                            LB,'0040'X        22,B3
          0 0000B2       0040
          0 0000B3  0581 000D                            BBF      s:1990,PREL
          0 0000B5  82C5 0003                            LB,'0040'X        3,B5
          0 0000B7       0040
          0 0000B8  0581 0008                            BBF      s:1990,PREL

     1296     1989    2         THEN %KV_MVD.DISPINPUT = '0'B;

   1989   0 0000BA  ACC4 0006                            LDB,B2   6,B4
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:205  
          0 0000BC  8842 0015                            LBF,'0080'X       21,B2
          0 0000BE       0080
          0 0000BF  0F81 0006                            B        s:1992,PREL

     1297     1990    2         ELSE %KV_MVD.DISPINPUT = '1'B;

   1990   0 0000C1  ACC4 0006                            LDB,B2   6,B4
          0 0000C3  8942 0015                            LBT,'0080'X       21,B2
          0 0000C5       0080

     1298     1991    2      END; /* IF */

     1299     1992    2      IF KV@USR_SETATR.PHSPST_PST~=%KV_SRD.CRT_PST THEN DO;

   1992   0 0000C6  8CC7 000F                            LDI      KV@USR_SETATR+1,AUTO
          0 0000C8  84C6 0015                            SID      21,B6
          0 0000CA  6981 0003                            BNEZ,R6  s:1993,PREL
          0 0000CC  7901 0009                            BEZ,R7   s:1996,PREL

     1300     1993    2         %KV_SRD.CRT_PST = KV@USR_SETATR.PHSPST_PST;

   1993   0 0000CE  8CC7 000F                            LDI      KV@USR_SETATR+1,AUTO
          0 0000D0  8D46 0015                            SDI      21,B6

     1301     1994    2         %KV_VDI.OTPCNDPND.PST = %KV_PHSPSTMOD_SKP;

   1994   0 0000D2  BC84                                 LDB,B3   ,B4
          0 0000D3  5C01                                 LDV,R5   1
          0 0000D4  DF43 001A                            STR,R5   26,B3

     1302     1995    2      END;

     1303     1996    1      %KV_MVD.VRTCLM = %KV_SRD.CRT.CLM;

   1996   0 0000D6  BCC4 0006                            LDB,B3   6,B4
          0 0000D8  E846 0016                            LDR,R6   22,B6
          0 0000DA  EF43 001B                            STR,R6   27,B3
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:206  

     1304     1997    1      %KV_SRD.FLDEND.CLM = %KV_SRD.CRT.CLM+%KV_FLD.WDT-1;

   1997   0 0000DC  E2C5 0004                            LLH,R6   4,B5
          0 0000DE  EA46 0016                            ADD,R6   22,B6
          0 0000E0  6EFF                                 ADV,R6   -1
          0 0000E1  EF46 0011                            STR,R6   17,B6

     1305     1998    1      %KV_SRD.CRTVRTLINPHSLIN = %KV_SRD.CRT.LIN;

   1998   0 0000E3  D846 0015                            LDR,R5   21,B6
          0 0000E5  DF46 0013                            STR,R5   19,B6

     1306     1999
     1307     2000    1      %KV_SRD.VRTPSTOK = '1'B;

   2000   0 0000E7  8946 000E                            LBT,'0010'X       14,B6
   2000   0 0000E9       0010

     1308     2001    1      %KV_SRD.HI_NONBLNVRT = '1'B;

   2001   0 0000EA  8946 000E                            LBT,'0002'X       14,B6
   2001   0 0000EC       0002

     1309     2002
     1310     2003        /* Do the read                                                                */
     1311     2004
     1312     2005    1      KV@USR_RQSDAT = KV_USR_RQSDAT;

   2005   0 0000ED  AB80 0000 0000  xsym                 LAB,B2   KV_USR_RQSDAT
          0 0000F0  2C00                                 LDV,R2   0
          0 0000F1  6C0C                                 LDV,R6   12
          0 0000F2  BB87                                 LAB,B3   ,AUTO
          0 0000F3  3C10                                 LDV,R3   16
          0 0000F4  0008                                 MMM

     1313     2006    1      KV@USR_RQSDAT.BFR_.ADR$ = KV$PTR.FLD$;
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:207  

   2006   0 0000F5  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          0 0000F8  DCC6 0014                            LDB,B5   20,B6
          0 0000FA  DFC7 0009                            STB,B5   KV@USR_RQSDAT+1,AUTO

     1314     2007    1      KV@USR_RQSDAT.BFR_.BYTX = LENGTHC(KV$FLD) - 1;

   2007   0 0000FC  6C0C                                 LDV,R6   12
          0 0000FD  EF47 000B                            STR,R6   KV@USR_RQSDAT+3,AUTO

     1315     2008    1      KV@USR_RQSDAT.MAXRCRBYTSIZ = %KV_FLD.WDT;

   2008   0 0000FF  CCC7 0006                            LDB,B4   Y@FLD$,AUTO
          0 000101  D2C4 0004                            LLH,R5   4,B4
          0 000103  DF47 000D                            STR,R5   KV@USR_RQSDAT+5,AUTO

     1316     2009    1      KV@USR_RQSDAT.BFR_.BYTSIZ = %KV_FLD.TXTSIZ;

   2009   0 000105  C844 0005                            LDR,R4   5,B4
          0 000107  C570 00FF                            AND,R4   255,IMO
          0 000109  CF47 000C                            STR,R4   KV@USR_RQSDAT+4,AUTO

     1317     2010    1      KV@USR_RQSDAT.RE_RED = '1'B;

   2010   0 00010B  8947 0008                            LBT,'0080'X       KV@USR_RQSDAT,AUTO
   2010   0 00010D       0080

     1318     2011    1      CALL KVI$RQSDAT(KV@USR_RQSDAT) ;

   2011   0 00010E  ABC7 0008                            LAB,B2   KV@USR_RQSDAT,AUTO
          0 000110  AFC7 0012                            STB,B2   KV@USR_SETATR+4,AUTO
          0 000112  BBC7 0012                            LAB,B3   KV@USR_SETATR+4,AUTO
          0 000114  CBF0 0100                            LAB,B4   256,IMO
          0 000116  E380 0000 0000  xent                 LNJ,B6   KVI$RQSDAT
          0 000119       0001                            DC       s:2012,PREL

     1319     2012    1      RETURN;
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:208  

   2012   0 00011A  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1320     2013    1   END; /* SUBROUTINE */

PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:209  
--  Include file information  --

   KV_INT_M.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV$INPFNC.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is referenced.
   KV$USR.:E05TOU  was found in the system file and is referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KVF$REDFRM.
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:210  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     8-0-0/w STRC(96)    r     1 KV@USR_RQSDAT              E-0-0/w STRC(64)    r     1 KV@USR_SETATR
     6-0-0/w PTR         r     1 Y@FLD$                     4-0-0/w PTR         r     1 Y@SRD$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KV$PTR$                    0-0-0/w STRC(96)    r     1 KV_USR_RQSDAT
     0-0-0/w STRC(64)    r     1 KV_USR_SETATR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(16)    r     1 FRSWRD                     0-0-0/w STRC(104)   r     1 KV$FLD
     0-0-0/w STRC(64)    r     1 KV$LIN                     0-0-0/w STRC(128)   r     1 KV$LINLST
     0-0-0/w STRC(512)   r     1 KV$MVD                     0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(496)   r     1 KV$SRD                     0-0-0/w STRC(512)   r     1 KV$STR
     0-0-0/w STRC(512)   r     1 KV$VDI                     0-0-0/w STRC(512)   r     1 Y@MRD


   Procedure KVF$REDFRM requires 285 words for executable code.
   Procedure KVF$REDFRM requires 20 words of local(AUTO) storage.

    No errors detected in file KVF$TBLSCN.:E05TSI    .
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:211  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:212  
          MINI XREF LISTING

FRSWRD
      1946**DCL      1967<<ASSIGN   1967>>ASSIGN
KV$FLD
       914**DCL      2007--ASSIGN
KV$FLD.ATRCLM
       973**DCL      1958>>IF       1968>>ASSIGN
KV$FLD.GRPRND
       967**DCL      1959>>ASSIGN   1960>>IF       1970>>ASSIGN
KV$FLD.GRPRND.HDN
       969**DCL      1988>>IF
KV$FLD.HI_NONBLNCLM
       973**DCL      1987>>ASSIGN
KV$FLD.QLF
       939**DCL      1971>>ASSIGN
KV$FLD.TXTSIZ
       973**DCL      2009>>ASSIGN
KV$FLD.UPD.ATR
       915**DCL      1958>>IF       1969<<ASSIGN
KV$FLD.VRTCLM
       915**DCL      1979>>ASSIGN
KV$FLD.WDT
       973**DCL      1997>>ASSIGN   2008>>ASSIGN
KV$LIN.FLDLST$
      1003**DCL      1952>>ASSIGN
KV$LIN.VRTLIN
      1003**DCL      1956>>ASSIGN
KV$LINLST.ONEFLDLIN$
      1028**DCL      1951>>ASSIGN
KV$LINLST.ONEFLDWRDX
      1028**DCL      1950>>ASSIGN
KV$MVD.DISPINPUT
      1108**DCL      1989<<ASSIGN   1990<<ASSIGN
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:213  
KV$MVD.RETYPOVR
      1111**DCL      1982>>IF
KV$MVD.VRTCLM
      1120**DCL      1996<<ASSIGN
KV$PTR.FLD$
       875**DCL      1953<<ASSIGN   1954>>ASSIGN   2006>>ASSIGN
KV$PTR.FLDLST$
       874**DCL      1952<<ASSIGN   1953>>ASSIGN
KV$PTR.FLDWRDX
       875**DCL      1950<<ASSIGN   1953>>ASSIGN
KV$PTR.INPCNDPND
       877**DCL       886--REDEF     890--REDEF
KV$PTR.LIN$
       874**DCL      1951<<ASSIGN   1952>>ASSIGN   1956>>ASSIGN
KV$PTR.LINLST$
       873**DCL       874--REDEF    1950>>ASSIGN   1951>>ASSIGN
KV$PTR.MVD$
       872**DCL      1982>>IF       1989>>ASSIGN   1990>>ASSIGN   1996>>ASSIGN
KV$PTR.SRD$
       873**DCL      1955>>ASSIGN
KV$PTR.STR$
       871**DCL      1959>>ASSIGN
KV$PTR.VDI$
       871**DCL      1974>>IF       1994>>ASSIGN
KV$PTR.VRTLIN
       876**DCL      1956<<ASSIGN   1957>>ASSIGN
KV$PTR$
       865**DCL       871--IMP-PTR  1950>>ASSIGN   1950>>ASSIGN   1951>>ASSIGN   1951>>ASSIGN   1952>>ASSIGN
      1952>>ASSIGN   1953>>ASSIGN   1953>>ASSIGN   1953>>ASSIGN   1954>>ASSIGN   1955>>ASSIGN   1956>>ASSIGN
      1956>>ASSIGN   1957>>ASSIGN   1959>>ASSIGN   1974>>IF       1982>>IF       1989>>ASSIGN   1990>>ASSIGN
      1994>>ASSIGN   1996>>ASSIGN   2006>>ASSIGN
KV$SRD.BTMRHT
      1242**DCL      1247--REDEF
KV$SRD.CRT
      1318**DCL      1323--REDEF
KV$SRD.CRT.CLM
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:214  
      1320**DCL      1996>>ASSIGN   1997>>ASSIGN
KV$SRD.CRT.LIN
      1320**DCL      1983>>ASSIGN   1998>>ASSIGN
KV$SRD.CRTVRTLINPHSLIN
      1290**DCL      1998<<ASSIGN
KV$SRD.CRT_PST
      1323**DCL      1992>>IF       1993<<ASSIGN
KV$SRD.FLDEND
      1282**DCL      1287--REDEF
KV$SRD.FLDEND.CLM
      1284**DCL      1997<<ASSIGN
KV$SRD.FLDEND.LIN
      1284**DCL      1986<<ASSIGN
KV$SRD.HI_NONBLN
      1352**DCL      1357--REDEF
KV$SRD.HI_NONBLN.CLM
      1354**DCL      1987<<ASSIGN
KV$SRD.HI_NONBLN.LIN
      1354**DCL      1985<<ASSIGN
KV$SRD.HI_NONBLNVRT
      1252**DCL      2001<<ASSIGN
KV$SRD.MRD$
      1146**DCL      1958>>IF       1960>>IF       1960>>IF       1980>>IF       1988>>IF
KV$SRD.ORG
      1174**DCL      1179--REDEF
KV$SRD.ORG.CLM
      1176**DCL      1968>>ASSIGN   1979>>ASSIGN   1987>>ASSIGN
KV$SRD.ORG.LIN
      1176**DCL      1957>>ASSIGN
KV$SRD.SRDEND
      1387**DCL      1392--REDEF
KV$SRD.TOPLFT
      1208**DCL      1213--REDEF
KV$SRD.VRTPSTOK
      1251**DCL      2000<<ASSIGN
KV$STR.GRPRND
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:215  
      1486**DCL      1959<<ASSIGN
KV$VDI.OTPCNDPND.PST
      1546**DCL      1974>>IF       1994<<ASSIGN
KV@USR_RQSDAT
      1601**DCL      2005<<ASSIGN   2011<>CALL
KV@USR_RQSDAT.BFR_.ADR$
      1632**DCL      2006<<ASSIGN
KV@USR_RQSDAT.BFR_.BYTSIZ
      1632**DCL      2009<<ASSIGN
KV@USR_RQSDAT.BFR_.BYTX
      1632**DCL      2007<<ASSIGN
KV@USR_RQSDAT.MAXRCRBYTSIZ
      1635**DCL      2008<<ASSIGN
KV@USR_RQSDAT.RE_RED
      1607**DCL      2010<<ASSIGN
KV@USR_SETATR
      1727**DCL      1967--ASSIGN   1972<>CALL
KV@USR_SETATR.GRPRND
      1816**DCL      1970<<ASSIGN
KV@USR_SETATR.PHSPST
      1760**DCL      1765--REDEF
KV@USR_SETATR.PHSPST.CLM
      1762**DCL      1968<<ASSIGN   1979<<ASSIGN   1981<<ASSIGN   1981>>ASSIGN
KV@USR_SETATR.PHSPST.LIN
      1762**DCL      1957<<ASSIGN   1983<<ASSIGN   1985>>ASSIGN   1986>>ASSIGN
KV@USR_SETATR.PHSPST_PST
      1765**DCL      1992>>IF       1993>>ASSIGN
KV@USR_SETATR.QLF
      1789**DCL      1971<<ASSIGN
KVI$RQSDAT
       846**DCL-ENT  2011--CALL
KVV$CALUSR
       847**DCL-ENT  1972--CALL
KVV$CALUSR_PST
       848**DCL-ENT  1975--CALL
KV_USR_RQSDAT
PL6.E3A0      #006=KVF$REDFRM File=KVF$TBLSCN.:E05TSI                            WED 07/30/97 02:01 Page:216  
      1664**DCL      2005>>ASSIGN
KV_USR_SETATR
      1850**DCL      1967--ASSIGN
KV_USR_SETATR.PHSPST
      1883**DCL      1888--REDEF
Y@FLD$
      1573**DCL       914--IMP-PTR  1954<<ASSIGN   1958>>IF       1958>>IF       1959>>ASSIGN   1960>>IF
      1968>>ASSIGN   1969>>ASSIGN   1970>>ASSIGN   1971>>ASSIGN   1979>>ASSIGN   1987>>ASSIGN   1988>>IF
      1997>>ASSIGN   2008>>ASSIGN   2009>>ASSIGN
Y@MRD.ATRRQRDSPPST
      1067**DCL      1980>>IF
Y@MRD.DCLATRWHNOTP
      1068**DCL      1958>>IF       1960>>IF
Y@MRD.DVCATR
      1077**DCL      1960>>IF
Y@MRD.SMLHDNATR
      1060**DCL      1988>>IF
Y@SRD$
      1572**DCL      1146--IMP-PTR  1955<<ASSIGN   1957>>ASSIGN   1958>>IF       1960>>IF       1960>>IF
      1968>>ASSIGN   1979>>ASSIGN   1980>>IF       1983>>ASSIGN   1985>>ASSIGN   1986>>ASSIGN   1987>>ASSIGN
      1987>>ASSIGN   1988>>IF       1992>>IF       1993>>ASSIGN   1996>>ASSIGN   1997>>ASSIGN   1997>>ASSIGN
      1998>>ASSIGN   1998>>ASSIGN   2000>>ASSIGN   2001>>ASSIGN
