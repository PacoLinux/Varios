VERSION E05

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:1    
        1        1        /*M* JDP$SEGLD: Shared program overlaying routines.                */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8
        9        9        /*F*   NAME:   JDP$SEGLD                                           */
       10       10        /*F*   PURPOSE: To perform shared processor overlaying.            */
       11       11
       12       12        JDP$SEGLD: PROC(NODE,ENTRY_ADDR) ALTRET;
       13       13
       14       14    1   DCL NODE UBIN;
       15       15    1   DCL ENTRY_ADDR UBIN;
       16       16
       17       17        %INCLUDE B$OBJECT_C;
       18     3447        %INCLUDE B$USER;
       19     3663        %B$USERREFS;
       20     3667        %INCLUDE B$P;
       21     3751        %INCLUDE M$JIT_C;
       22     4271        %INCLUDE B$ROSEG;
       23     4334        %INCLUDE B$MAP;
       24     4433        %INCLUDE MM_DATA_R;
       25     4953        %INCLUDE B_MACROS_C;
       26     5064        %INCLUDE HF_LOCK_C;
       27     5078        %INCLUDE HF_DATA_R;
       28     5121        %INCLUDE JD_SUBS_C;
       29     5133        %INCLUDE J_ERRORS_C;
       30     5220        %INCLUDE J_ERRSET_C;
       31     5240        %INCLUDE SS_SCHED_C;
       32     5473        %INCLUDE JS$CP6V_C;
       33     5536
       34     5537        %FPT$OLAY_V;
       35     5540    1   DCL FLAGS BIT(9) ALIGNED;
       36     5541
       37     5542    1   DCL APR UBIN;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:2    
       38     5543    1   DCL APO UBIN;
       39     5544    1   DCL ONUM SBIN;
       40     5545    1   DCL ONUM$ PTR;
       41     5546    1   DCL APO$ PTR;
       42     5547    1   DCL APR$ PTR;
       43     5548    1   DCL I SBIN;
       44     5549    1   DCL TEMP1 SBIN;
       45     5550    1   DCL TEMP2 SBIN;
       46     5551    1   DCL TEMP3 SBIN;
       47     5552    1   DCL NODE$ PTR;
       48     5553    1   DCL OVENT$ EPTR;
       49     5554    1   DCL 1 OVENT REDEF OVENT$,
       50     5555    1         2 ADDRESS UBIN(18) UNAL,
       51     5556    1         2 * UBIN(18) UNAL;
       52     5557
       53     5558    1   DCL B$JIT$ PTR SYMREF READONLY;
       54     5559    1   DCL B$PS0$ PTR SYMREF READONLY;
       55     5560    1   DCL B$PS1$ PTR SYMREF READONLY;
       56     5561    1   DCL B$ROSEG$ PTR SYMREF READONLY;
       57     5562    1   DCL B$UPT$ PTR SYMREF READONLY;
       58     5563    1   DCL B$WSQ0PT$ PTR SYMREF READONLY;
       59     5564    1   DCL B$IPHYMAP$ PTR SYMREF READONLY;
       60     5565
       61     5566    1   DCL J_PLOCK SYMREF BIT(72) DALIGNED;
       62     5567
       63     5568    1   DCL HFC$ASSOCCLR ENTRY(3);
       64     5569    1   DCL JDS$OVRLY ENTRY(3) ALTRET;
       65     5570    1   DCL JDU$MEMSET ENTRY(4) ALTRET;
       66     5571    1   DCL JDU$READ_OVRLY ENTRY(5) ALTRET;
       67     5572    1   DCL SSR$REG ENTRY(3) ALTRET;
       68     5573        /**/
       69     5574        %B$TREE_TABLE(HDR_NAME=B$TREEHDR,
       70     5575                      NODE_NAME=B$NODE);
       71     5633
       72     5634        %INCLUDE UD_SEV_C;
       73     5648        %SUB FCG#='1204'O;
       74     5649        %SUB MID#='20'O;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:3    
       75     5650        %ERRCODE (NAME=ENOOVRLY,COD#=%E$NOOVRLY);
       76     5658
       77     5659        %TEXTC;
       78     5664        /**/
       79     5665        %SUB   B$JIT=B$JIT$->B$JIT;
       80     5666        %SUB   B$UPT = B$UPT$->B$MAP;
       81     5667        %SUB   B$U=S$CU$->B$U;
       82     5668        %SUB   B$TREEHDR=B$ROSEG$->B$ROSEG.TREE$->B$TREEHDR;
       83     5669        %SUB    B$NODE = NODE$->B$NODE;
       84     5670        %SUB    MM$PPUT = B$PPUT$->MM$PPUT;
       85     5671        %SUB   B$ROSEG = B$ROSEG$->B$ROSEG;
       86     5672        /**/
       87     5673        %EJECT;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:4    
       88     5674        /*************************************************************
       89     5675         *                                                           *
       90     5676         *                    INSTALL_OVRLY                          *
       91     5677         *                                                           *
       92     5678         *************************************************************/
       93     5679
       94     5680        /*    This routine will install a shared processor overlay from    */
       95     5681        /*    the processor's run unit as a result of the processor in :SYS*/
       96     5682        /*    having been replaced at some earlier time.                   */
       97     5683    1   INSTALL_OVRLY: PROC ALTRET;
       98     5684        /**/
       99     5685    2   DCL TAILPG SBIN;
      100     5686    2   DCL HIPG SBIN;
      101     5687    2   DCL LOPG SBIN;
      102     5688    2   DCL ROOTENDPP UBIN;
      103     5689    2   DCL ROOTENDVP UBIN;
      104     5690    2   DCL ERR UBIN;
      105     5691    2   DCL TEMP REDEF ERR SBIN;
      106     5692    2   DCL OVERLAP SBIN;
      107     5693    2   DCL CHARS CHAR(OVERLAP) BASED;
      108     5694    2   DCL PROC$ PTR;
      109     5695    2   DCL B$SBUF2$ PTR SYMREF READONLY;
      110     5696    2   DCL B$USERIS$ PTR SYMREF READONLY;
      111     5697    2   DCL B$PPUT$ PTR SYMREF READONLY;
      112     5698        /**/
      113     5699    2   DCL MME$CVM ENTRY(4) ALTRET;
      114     5700    2   DCL MME$WFVP ENTRY(4) ALTRET;
      115     5701    2   DCL SC_SEGLD ENTRY CONV(2,0);
      116     5702    2   DCL SSR$REG ENTRY(3) ALTRET;
      117     5703        /**/
      118     5704        /* Remember the root's ending page # - we'll need it later */
      119     5705    2      ONUM$ -> B$P.UC(0) = ONUM$ -> B$P.UC(0)+1; /* Locks all other users        */
      120     5706           %UNLOCK (G=J_PLOCK);                 /* Unlock tables                      */
      121     5709    2      ROOTENDVP = APR$ ->B$P.PVA(0) + APR$ -> B$P.PPC(0) - 1;
      122     5710    2      ROOTENDPP = APR$ -> B$P.TPP(0);
      123     5711    2      B$UPT(ROOTENDVP) = MM_FPMC;
      124     5712    2      CALL HFC$ASSOCCLR(%USERWSQ,ROOTENDVP,1);
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:5    
      125     5713    2      IF B$UPT.SCTRL(ROOTENDVP) ~= '0'B    /* Something is wrong                 */
      126     5714    2      THEN CALL SC_SEGLD;
      127     5715    2      B$UPT.CTRL(ROOTENDVP)='0'B;          /* Clear out control flags            */
      128     5716    2      B$JIT.PCP = B$JIT.PCP - 1;           /* Dcrement for jds                   */
      129     5717    2      CALL JDS$OVRLY (NODE,ENTRY_ADDR,FLAGS) ALTRET(INSTALL_ERR);
      130     5718    2      B$JIT.PCP = B$JIT.PCP + 1;           /* Readjust pcp after jds             */
      131     5719    2      NODE$ = PINCRW(B$ROSEG.TREE$,SIZEW(B$TREEHDR)
      132     5720    2        + NODE*SIZEW(B$NODE));
      133     5721    2      IF B$NODE.PSIZE = 0                  /* No procedure                       */
      134     5722    3      THEN DO;
      135     5723                %LOCK (G=J_PLOCK);
      136     5726    3           ONUM$ -> B$P.UC(0) = ONUM$ -> B$P.UC(0) - 1;
      137     5727    3           ONUM = 0;
      138     5728    3           B$U.APO = 0;
      139     5729    3           IF B$UPT.RPN(ROOTENDVP) ~= MM_FPMC.RPN
      140     5730    3           THEN CALL MME$WFVP(%USERWSQ,ROOTENDVP,ERR,ERR)ALTRET(JD_SUA);
      141     5731    3           IF HW_WSQ0PT THEN
      142     5732    3                B$UPT.RPN(ROOTENDVP) = B$WSQ0PT$->B$MAP.RPN(ROOTENDPP);
      143     5733    3           ELSE
      144     5734    3                B$UPT.RPN(ROOTENDVP) = ROOTENDPP;
      145     5735                %SAC (VPNO = ROOTENDVP , AC = "%PGINMEM|%PGIOM");
      146     5738                %UNLOCK (G=J_PLOCK);
      147     5741    3           RETURN;
      148     5742    3           END;
      149     5743    2      LOPG = B$NODE.PADDR/1024 + %ISEGLO;
      150     5744    2      IF B$UPT.RPN(LOPG) = %FPMC           /* Something is terribly wrong        */
      151     5745    3      THEN DO;
      152     5746    3           CALL SC_SEGLD;
      153     5747    3           ALTRETURN;
      154     5748    3           END;
      155     5749
      156     5750        /* Copy end of last root proc. page into start of overlay pg. */
      157     5751    2      OVERLAP = MOD(B$NODE.PADDR,1024) * 4;
      158     5752    2      IF OVERLAP <= 0
      159     5753    3      THEN DO;
      160     5754    3           CALL MME$WFVP(%USERWSQ,ROOTENDVP,ERR,ERR) ALTRET(JD_SUA);
      161     5755    3           IF HW_WSQ0PT THEN
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:6    
      162     5756    3                B$UPT.RPN(ROOTENDVP) = B$WSQ0PT$->B$MAP.RPN(ROOTENDPP);
      163     5757    3           ELSE
      164     5758    3                B$UPT.RPN(ROOTENDVP) = ROOTENDPP;
      165     5759                %SAC (VPNO = ROOTENDVP , AC = "%PGINMEM|%PGIOM");
      166     5762    3           END;
      167     5763    3      ELSE DO;
      168     5764    3           CALL MME$CVM(%USERWSQ,%SBUF2PG,ROOTENDPP,ERR) ALTRET(JD_SUA);
      169     5765    3           PROC$ = PINCRW(B$USERIS$,(LOPG-%ISEGLO)*1024);
      170     5766                %SAC (VPNO = LOPG , AC = "%PGINMEM|%PGWRITE|%PGIOM");
      171     5769    3           PROC$ -> CHARS = B$SBUF2$ -> CHARS;
      172     5770                %SAC (VPNO = LOPG , AC = "%PGIOM|%PGINMEM");
      173     5773    3           CALL MME$CVM(%USERWSQ,%SBUF2PG,-1,ERR) ALTRET(JD_SUA);
      174     5774        /* Allow for the replaced root end page, which at this point will  */
      175     5775        /* have been counted twice in B$JIT.PCP if no previous overlay.    */
      176     5776    3           B$JIT.PCP = B$JIT.PCP - 1;
      177     5777    3           END;
      178     5778    2      HIPG = %ISEGLO + (B$NODE.PADDR + B$NODE.PSIZE - 1)/1024;
      179     5779        /* Reset the "page belongs to user" bit for the overlay's proc. pgs */
      180     5780    3      DO I = LOPG TO HIPG;
      181     5781                %SSC (VPNO = I , SC = '0'B);
      182     5784    4           IF HW_WSQ0PT THEN DO;
      183     5785    4                TEMP1 = B$IPHYMAP$->MM$IPHY_MAP(B$UPT.RPN(I));
      184     5786    4                IF I~=HIPG THEN
      185     5787    4                     MM$PPUT.PPNO(TEMP1) = B$IPHYMAP$->MM$IPHY_MAP(B$UPT.RPN(I+1));
      186     5788    4                END;
      187     5789    4           ELSE DO;
      188     5790    4                TEMP1 = B$UPT.RPN(I);
      189     5791    4                MM$PPUT.PPNO(TEMP1) = B$UPT.RPN(I+1);
      190     5792    4                END;
      191     5793    3           MM$PPUT.USER(TEMP1) = '0'B;
      192     5794    3           MM$PPUT.PRC(TEMP1) = '1'B;
      193     5795    3           MM$PPUT.PNUM(TEMP1) = ONUM;     /* Store processor number             */
      194     5796    3           END;
      195     5797    2      MM$PPUT.PPNO(TEMP1) = 0;             /* End of chain                       */
      196     5798    2      TEMP = HIPG - LOPG + 1;
      197     5799    2      B$JIT.PPC = B$JIT.PPC - TEMP;
      198     5800    2      B$U.PCT = B$U.PCT - TEMP;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:7    
      199     5801        /* Set up the necessary new processor table information */
      200     5802           %LOCK (G=J_PLOCK);
      201     5805    3      IF HW_WSQ0PT THEN DO;
      202     5806    3           ONUM$->B$P.HPP(0)=B$IPHYMAP$->MM$IPHY_MAP(B$UPT.RPN(LOPG));
      203     5807    3           ONUM$->B$P.TPP(0)=B$IPHYMAP$->MM$IPHY_MAP(B$UPT.RPN(HIPG));
      204     5808    3           END;
      205     5809    3      ELSE DO;
      206     5810    3           ONUM$ -> B$P.HPP(0) = B$UPT.RPN(LOPG);
      207     5811    3           ONUM$ -> B$P.TPP(0) = B$UPT.RPN(HIPG);
      208     5812    3           END;
      209     5813    2      ONUM$ -> B$P.PPC(0) = TEMP;
      210     5814    2      ONUM$ -> B$P.INSTDATE(0) = APR$ -> B$P.INSTDATE(0);
      211     5815    2      OVENT$=B$NODE.ENTRY$;
      212     5816    2      ONUM$ -> B$P.SA(0)=OVENT.ADDRESS;
      213     5817
      214     5818    2      MM$BYP.AUTOINUSE = MM$BYP.AUTOINUSE + TEMP;
      215     5819    2      ONUM$ -> B$P.PVA(0) = LOPG;
      216     5820    2      ONUM$ -> B$P.HVA(0) = HIPG + 1;
      217     5821        /* And finally, fill in the rest of the processor table. */
      218     5822    2      ONUM$ -> B$P.DADDR(0) = B$NODE.DADDR;
      219     5823    2      ONUM$ -> B$P.DSZ(0) = B$NODE.DSIZE;
      220     5824           %UNLOCK(G=J_PLOCK);
      221     5827    2      RETURN;
      222     5828        /**/
      223     5829    2   INSTALL_ERR:;
      224     5830    2      B$U.APO = 0;
      225     5831    2      ONUM$ -> B$P.UC(0) = ONUM$ -> B$P.UC(0) - 1;
      226     5832             /* Check if we got a new physical page for the end of
      227     5833                  the root and free it */
      228     5834    2      IF B$UPT.RPN(ROOTENDVP) ~= MM_FPMC.RPN
      229     5835    2      THEN
      230     5836    2           CALL MME$WFVP(%USERWSQ,ROOTENDVP,ERR,ERR)ALTRET(JD_SUA);
      231     5837    2      IF HW_WSQ0PT THEN
      232     5838    2           B$UPT.RPN(ROOTENDVP) = B$WSQ0PT$->B$MAP.RPN(ROOTENDPP);
      233     5839    2      ELSE
      234     5840    2           B$UPT.RPN(ROOTENDVP) = ROOTENDPP;
      235     5841           %SAC (VPNO = ROOTENDVP , AC = "%PGINMEM|%PGIOM");
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:8    
      236     5844
      237     5845        /* Clear out any pages that were allocated for this overlay */
      238     5846    2      HIPG = APO$ -> B$P.HVA(0) - 1;
      239     5847    3      DO I = ROOTENDVP+1 TO HIPG;
      240     5848    3           IF B$UPT.SCTRL(I) = %SCUSER
      241     5849    3           THEN
      242     5850    3                CALL MME$WFVP(%USERWSQ,I,ERR,ERR) ALTRET(JD_SUA);
      243     5851    3           END;
      244     5852    2      ALTRETURN;
      245     5853        /**/
      246     5854    2   JD_SUA:
      247     5855    2      ONUM$ -> B$P.UC(0) = 0;    /* Reset ucount to zero since we are only one   */
      248     5856        /*S*    SCREECH_CODE: JDS-S$SEGLD                                  */
      249     5857        /*S*    TYPE:   SUA                                                */
      250     5858        /*S*    MESSAGE: Internal error installing shared overlay.         */
      251     5859    2      CALL SC_SEGLD;
      252     5860        /**/
      253     5861    2   END INSTALL_OVRLY;
      254     5862        /**/
      255     5863        %EJECT;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:9    
      256     5864        /*************************************************************
      257     5865         *                                                           *
      258     5866         *                      JDP$SEGLD                            *
      259     5867         *                                                           *
      260     5868         *************************************************************/
      261     5869
      262     5870        /* Move frequently accessed data to AUTO    */
      263     5871    1      FLAGS = B$PS1$->FPT$OLAY_V.FLGS;
      264     5872    1      APR = B$U.APR;
      265     5873    1      APR$ = ADDR (B$P$ -> B$P(APR));
      266     5874
      267     5875        /* Find the requested overlay number in the shared processor tables */
      268     5876    1      ONUM = APR$ -> B$P.LNK(0);
      269     5877    2      DO WHILE (ONUM ~= 0);
      270     5878    2           ONUM$ = ADDR (B$P$ -> B$P(ONUM));
      271     5879    2           IF B$PS0$->TEXTC.TEXT = ADDR(ONUM$ -> B$P.NAME(0))->TEXTC.TEXT
      272     5880    2           THEN GOTO FOUND;
      273     5881    2           ONUM = ONUM$ -> B$P.LNK(0);
      274     5882    2           END;
      275     5883
      276     5884    1      B$JIT.ERR=ENOOVRLY;
      277     5885    1      ALTRETURN;
      278     5886        /*E*    ERROR:  JDP-E$NOOVRLY-4                                      */
      279     5887        /*E*   MESSAGE: That shared processor overlay does not exist.      */
      280     5888
      281     5889    1   FOUND: ;
      282     5890    1      APO = B$U.APO;
      283     5891    1      APO$ = ADDR (B$P$ -> B$P(APO));
      284     5892    1      IF (FLAGS & JD_CANCEL)
      285     5893    1      THEN IF APO ~= ONUM
      286     5894    1           THEN RETURN;
      287     5895    1           ELSE ;
      288     5896    1      ELSE IF APO = ONUM
      289     5897    1           THEN GOTO RETURN_NODE;
      290     5898
      291     5899        /* Clear out any previously associated overlay from the page table */
      292     5900    1      IF APO ~= 0
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:10   
      293     5901    2      THEN DO;
      294     5902        /* Don't free the last page of root procedure (yet)...*/
      295     5903    3           DO I = APR$ -> B$P.PVA(0) + APR$ -> B$P.PPC(0) TO APO$ -> B$P.HVA(0) - 1;
      296     5904    3                B$UPT(I) = MM_FPMC;
      297     5905    3                B$UPT.CTRL(I) = '0'B;
      298     5906    3                END;
      299     5907    2           B$JIT.PCP = APR$ -> B$P.PPC(0);
      300     5908    2           B$U.APO = 0;                    /* Reset associated processor overlay */
      301     5909    2           NODE$=PINCRW(B$ROSEG.TREE$,SIZEW(B$TREEHDR)
      302     5910    2             + APO$ -> B$P.NODE(0)*SIZEW(B$NODE));
      303     5911    2           B$NODE.FLGS.NOW_IN = '0'B;
      304     5912    2           END;
      305     5913    1      TEMP1 = APR$->B$P.PVA(0)+APR$->B$P.PPC(0)-1;
      306     5914    1      IF HW_WSQ0PT THEN
      307     5915    1           B$UPT.RPN(TEMP1) = B$WSQ0PT$->B$MAP.RPN(APR$->B$P.TPP(0));
      308     5916    1      ELSE
      309     5917    1           B$UPT.RPN(TEMP1) = APR$ -> B$P.TPP(0);
      310     5918    1      CALL HFC$ASSOCCLR(%USERWSQ,TEMP1,APO$->B$P.HVA(0)-TEMP1);
      311     5919
      312     5920        /* Wait for other users doing overlay  */
      313     5921           %LOCK(G=J_PLOCK);                    /* Lock tables                        */
      314     5924    1      APO$ -> B$P.UC(0) = APO$ -> B$P.UC(0) - 1;
      315     5925    1      IF APO$ -> B$P.UC(0) = 0             /* Last user                          */
      316     5926    2      THEN DO;
      317     5927    2           MM$BYP.AUTOP = MM$BYP.AUTOP + APO$ -> B$P.PPC(0);
      318     5928    2           MM$BYP.AUTOINUSE = MM$BYP.AUTOINUSE - APO$ -> B$P.PPC(0);
      319     5929    2           END;
      320     5930    1      B$U.APO = 0;
      321     5931
      322     5932    1   DONE_YET: ;
      323     5933    1      IF ONUM$ -> B$P.UC(0) ~= 0 AND ONUM$ -> B$P.PPC(0) = 0
      324     5934    2      THEN DO;
      325     5935                %UNLOCK(G=J_PLOCK);
      326     5938    2           CALL SSR$REG(%SS_SL,,1);
      327     5939                %LOCK(G=J_PLOCK);
      328     5942    2           GOTO DONE_YET;
      329     5943    2           END;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:11   
      330     5944
      331     5945    1      IF (NOT (FLAGS & JD_CANCEL)) AND (ONUM$ -> B$P.PPC(0) = 0)
      332     5946    2      THEN DO;
      333     5947    2           B$U.APO = ONUM;
      334     5948    2           CALL INSTALL_OVRLY ALTRET(SEGLD_ERR);
      335     5949    2           END;
      336     5950    2      ELSE DO;
      337     5951    2           IF (NOT (FLAGS & JD_CANCEL))
      338     5952    3           THEN DO;
      339     5953    3                ONUM$ -> B$P.UC(0) = ONUM$ -> B$P.UC(0) +1;
      340     5954    3                IF ONUM$ -> B$P.UC(0) = 1
      341     5955    4                THEN DO;
      342     5956    4                     MM$BYP.AUTOP = MM$BYP.AUTOP - ONUM$ -> B$P.PPC(0);
      343     5957    4                     MM$BYP.AUTOINUSE = MM$BYP.AUTOINUSE + ONUM$ -> B$P.PPC(0);
      344     5958    4                     END;
      345     5959    3                B$U.APO = ONUM;
      346     5960    3                END;
      347     5961                %UNLOCK (G=J_PLOCK);
      348     5964
      349     5965        /* Access controls will be set by SSR.
      350     5966        */
      351     5967        /* Allocate the necessary data pages for this overlay.             */
      352     5968    2           TEMP1 = ONUM$ -> B$P.DADDR(0);
      353     5969    2           TEMP2 = ONUM$ -> B$P.DSZ(0);
      354     5970    2           CALL JDU$MEMSET(DATA_TYPE , TEMP1 , TEMP2 ,
      355     5971    2             FLAGS) ALTRET(SEGLD_ERR);
      356     5972        /* Read in this overlay's data...                                  */
      357     5973    2           IF NOT (FLAGS & JD_CANCEL)
      358     5974    3           THEN DO;
      359     5975    3                I = ONUM$ -> B$P.NODE(0);
      360     5976    3                TEMP3 = B$TREEHDR.PRECSIZE;
      361     5977    3                CALL JDU$READ_OVRLY(DATA_TYPE , I , TEMP1 , TEMP2 ,
      362     5978    3                  TEMP3 ) ALTRET(SEGLD_ERR);
      363     5979    3                END;
      364     5980    2           IF (FLAGS & JD_CANCEL)
      365     5981    3           THEN DO;
      366     5982    3                B$U.APO = 0;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:12   
      367     5983    3                END;
      368     5984    3           ELSE DO;
      369     5985    3                B$U.APO = ONUM;
      370     5986    3                NODE$=PINCRW(B$ROSEG.TREE$,SIZEW(B$TREEHDR)
      371     5987    3                  + ONUM$ -> B$P.NODE(0)*SIZEW(B$NODE));
      372     5988    3                B$NODE.FLGS.NOW_IN = '1'B;
      373     5989    3                B$JIT.PCP = B$JIT.PCP + ONUM$ -> B$P.PPC(0) - 1;
      374     5990    3                CALL SSR$REG(%SS_AP);
      375     5991    3                END;
      376     5992    2           END;
      377     5993    1   RETURN_NODE: ;
      378     5994    1      NODE = ONUM$ -> B$P.NODE(0);
      379     5995    1      ENTRY_ADDR = ONUM$ -> B$P.SA(0);
      380     5996    1      RETURN;
      381     5997
      382     5998    1   SEGLD_ERR:;
      383     5999    1      ALTRETURN;
      384     6000    1   END JDP$SEGLD;

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:13   
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   JS$CP6V_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   J_ERRSET_C.:E05TOU  is referenced.
   J_ERRORS_C.:E05TOU  is referenced.
   JD_SUBS_C.:E05TOU  is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   MM_MACRO_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   MM$SYSGEN.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   MM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   M$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure JDP$SEGLD.

   Procedure JDP$SEGLD requires 747 words for executable code.
   Procedure JDP$SEGLD requires 34 words of local(AUTO) storage.

    No errors detected in file JDP$SEGLD.:E05TSI    .

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:14   

 Object Unit name= JDP$SEGLD                                  File name= JDP$SEGLD.:E05TOU
 UTS= JUL 29 '97 23:21:46.04 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  JDP$SEGLD
    1   Proc  even  none   747   1353  JDP$SEGLD
    2  RoData even  none    15     17  JDP$SEGLD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  JDP$SEGLD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       3 HFC$ASSOCCLR
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 SSR$REG
 yes     yes           Std       4 JDU$MEMSET
         yes           Std       1 HFC$LOCK
 yes     yes           Std       5 JDU$READ_OVRLY
 yes     yes           Std       4 MME$WFVP
 yes     yes           Std       3 JDS$OVRLY
 yes     yes           Std       4 MME$CVM
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:15   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_SEGLD                              S$CU$                                 B$P$
r    MM_BYP$                               MM_FPMC                               HW_WSQ0PT
r    B$JIT$                           r    B$PS0$                           r    B$PS1$
r    B$ROSEG$                         r    B$UPT$                           r    B$WSQ0PT$
r    B$IPHYMAP$                            J_PLOCK                          r    B$SBUF2$
r    B$USERIS$                        r    B$PPUT$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:16   


        1        1        /*M* JDP$SEGLD: Shared program overlaying routines.                */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8
        9        9        /*F*   NAME:   JDP$SEGLD                                           */
       10       10        /*F*   PURPOSE: To perform shared processor overlaying.            */
       11       11
       12       12        JDP$SEGLD: PROC(NODE,ENTRY_ADDR) ALTRET;

     12  1 000000   000000 700200 xent  JDP$SEGLD    TSX0  ! X66_AUTO_2
         1 000001   000042 000002                    ZERO    34,2
         1 000002   000700 710000 1                  TRA     s:5871

       13       13
       14       14    1   DCL NODE UBIN;
       15       15    1   DCL ENTRY_ADDR UBIN;
       16       16
       17       17        %INCLUDE B$OBJECT_C;
       18     3447        %INCLUDE B$USER;
       19     3663        %B$USERREFS;
       20     3667        %INCLUDE B$P;
       21     3751        %INCLUDE M$JIT_C;
       22     4271        %INCLUDE B$ROSEG;
       23     4334        %INCLUDE B$MAP;
       24     4433        %INCLUDE MM_DATA_R;
       25     4953        %INCLUDE B_MACROS_C;
       26     5064        %INCLUDE HF_LOCK_C;
       27     5078        %INCLUDE HF_DATA_R;
       28     5121        %INCLUDE JD_SUBS_C;
       29     5133        %INCLUDE J_ERRORS_C;
       30     5220        %INCLUDE J_ERRSET_C;
       31     5240        %INCLUDE SS_SCHED_C;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:17   
       32     5473        %INCLUDE JS$CP6V_C;
       33     5536
       34     5537        %FPT$OLAY_V;
       35     5540    1   DCL FLAGS BIT(9) ALIGNED;
       36     5541
       37     5542    1   DCL APR UBIN;
       38     5543    1   DCL APO UBIN;
       39     5544    1   DCL ONUM SBIN;
       40     5545    1   DCL ONUM$ PTR;
       41     5546    1   DCL APO$ PTR;
       42     5547    1   DCL APR$ PTR;
       43     5548    1   DCL I SBIN;
       44     5549    1   DCL TEMP1 SBIN;
       45     5550    1   DCL TEMP2 SBIN;
       46     5551    1   DCL TEMP3 SBIN;
       47     5552    1   DCL NODE$ PTR;
       48     5553    1   DCL OVENT$ EPTR;
       49     5554    1   DCL 1 OVENT REDEF OVENT$,
       50     5555    1         2 ADDRESS UBIN(18) UNAL,
       51     5556    1         2 * UBIN(18) UNAL;
       52     5557
       53     5558    1   DCL B$JIT$ PTR SYMREF READONLY;
       54     5559    1   DCL B$PS0$ PTR SYMREF READONLY;
       55     5560    1   DCL B$PS1$ PTR SYMREF READONLY;
       56     5561    1   DCL B$ROSEG$ PTR SYMREF READONLY;
       57     5562    1   DCL B$UPT$ PTR SYMREF READONLY;
       58     5563    1   DCL B$WSQ0PT$ PTR SYMREF READONLY;
       59     5564    1   DCL B$IPHYMAP$ PTR SYMREF READONLY;
       60     5565
       61     5566    1   DCL J_PLOCK SYMREF BIT(72) DALIGNED;
       62     5567
       63     5568    1   DCL HFC$ASSOCCLR ENTRY(3);
       64     5569    1   DCL JDS$OVRLY ENTRY(3) ALTRET;
       65     5570    1   DCL JDU$MEMSET ENTRY(4) ALTRET;
       66     5571    1   DCL JDU$READ_OVRLY ENTRY(5) ALTRET;
       67     5572    1   DCL SSR$REG ENTRY(3) ALTRET;
       68     5573        /**/
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:18   
       69     5574        %B$TREE_TABLE(HDR_NAME=B$TREEHDR,
       70     5575                      NODE_NAME=B$NODE);
       71     5633
       72     5634        %INCLUDE UD_SEV_C;
       73     5648        %SUB FCG#='1204'O;
       74     5649        %SUB MID#='20'O;
       75     5650        %ERRCODE (NAME=ENOOVRLY,COD#=%E$NOOVRLY);
       76     5658
       77     5659        %TEXTC;
       78     5664        /**/
       79     5665        %SUB   B$JIT=B$JIT$->B$JIT;
       80     5666        %SUB   B$UPT = B$UPT$->B$MAP;
       81     5667        %SUB   B$U=S$CU$->B$U;
       82     5668        %SUB   B$TREEHDR=B$ROSEG$->B$ROSEG.TREE$->B$TREEHDR;
       83     5669        %SUB    B$NODE = NODE$->B$NODE;
       84     5670        %SUB    MM$PPUT = B$PPUT$->MM$PPUT;
       85     5671        %SUB   B$ROSEG = B$ROSEG$->B$ROSEG;
       86     5672        /**/
       87     5673        %EJECT;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:19   
       88     5674        /*************************************************************
       89     5675         *                                                           *
       90     5676         *                    INSTALL_OVRLY                          *
       91     5677         *                                                           *
       92     5678         *************************************************************/
       93     5679
       94     5680        /*    This routine will install a shared processor overlay from    */
       95     5681        /*    the processor's run unit as a result of the processor in :SYS*/
       96     5682        /*    having been replaced at some earlier time.                   */
       97     5683    1   INSTALL_OVRLY: PROC ALTRET;

   5683  1 000003   200022 741300       INSTALL_OVR* STX1  ! OVENT$+1,,AUTO

       98     5684        /**/
       99     5685    2   DCL TAILPG SBIN;
      100     5686    2   DCL HIPG SBIN;
      101     5687    2   DCL LOPG SBIN;
      102     5688    2   DCL ROOTENDPP UBIN;
      103     5689    2   DCL ROOTENDVP UBIN;
      104     5690    2   DCL ERR UBIN;
      105     5691    2   DCL TEMP REDEF ERR SBIN;
      106     5692    2   DCL OVERLAP SBIN;
      107     5693    2   DCL CHARS CHAR(OVERLAP) BASED;
      108     5694    2   DCL PROC$ PTR;
      109     5695    2   DCL B$SBUF2$ PTR SYMREF READONLY;
      110     5696    2   DCL B$USERIS$ PTR SYMREF READONLY;
      111     5697    2   DCL B$PPUT$ PTR SYMREF READONLY;
      112     5698        /**/
      113     5699    2   DCL MME$CVM ENTRY(4) ALTRET;
      114     5700    2   DCL MME$WFVP ENTRY(4) ALTRET;
      115     5701    2   DCL SC_SEGLD ENTRY CONV(2,0);
      116     5702    2   DCL SSR$REG ENTRY(3) ALTRET;
      117     5703        /**/
      118     5704        /* Remember the root's ending page # - we'll need it later */
      119     5705    2      ONUM$ -> B$P.UC(0) = ONUM$ -> B$P.UC(0)+1; /* Locks all other users        */

   5705  1 000004   200011 470500                    LDP0    ONUM$,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:20   
         1 000005   000000 054100                    AOS     0,,PR0

      120     5706           %UNLOCK (G=J_PLOCK);                 /* Unlock tables                      */

   5707  1 000006   000000 630400 2                  EPPR0   0
         1 000007   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000010   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000011   000000 011000                    NOP     0

      121     5709    2      ROOTENDVP = APR$ ->B$P.PVA(0) + APR$ -> B$P.PPC(0) - 1;

   5709  1 000012   200013 470500                    LDP0    APR$,,AUTO
         1 000013   000025 236100                    LDQ     21,,PR0
         1 000014   000022 772000                    QRL     18
         1 000015   000003 036100                    ADLQ    3,,PR0
         1 000016   000001 136007                    SBLQ    1,DL
         1 000017   200027 756100                    STQ     ROOTENDVP,,AUTO

      122     5710    2      ROOTENDPP = APR$ -> B$P.TPP(0);

   5710  1 000020   000023 236100                    LDQ     19,,PR0
         1 000021   000022 772000                    QRL     18
         1 000022   200026 756100                    STQ     ROOTENDPP,,AUTO

      123     5711    2      B$UPT(ROOTENDVP) = MM_FPMC;

   5711  1 000023   000000 236000 xsym               LDQ     MM_FPMC
         1 000024   000000 471400 xsym               LDP1    B$UPT$
         1 000025   200027 720100                    LXL0    ROOTENDVP,,AUTO
         1 000026   100000 756110                    STQ     0,X0,PR1

      124     5712    2      CALL HFC$ASSOCCLR(%USERWSQ,ROOTENDVP,1);

   5712  1 000027   000001 236000 2                  LDQ     1
         1 000030   200036 756100                    STQ     PROC$+4,,AUTO
         1 000031   200027 633500                    EPPR3   ROOTENDVP,,AUTO
         1 000032   200035 453500                    STP3    PROC$+3,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:21   
         1 000033   000002 236000 2                  LDQ     2
         1 000034   200034 756100                    STQ     PROC$+2,,AUTO
         1 000035   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 000036   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000037   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 000040   000000 011000                    NOP     0

      125     5713    2      IF B$UPT.SCTRL(ROOTENDVP) ~= '0'B    /* Something is wrong                 */

   5713  1 000041   000000 470400 xsym               LDP0    B$UPT$
         1 000042   200027 720100                    LXL0    ROOTENDVP,,AUTO
         1 000043   000000 236110                    LDQ     0,X0,PR0
         1 000044   777400 316007                    CANQ    -256,DL
         1 000045   000050 600000 1                  TZE     s:5715

      126     5714    2      THEN CALL SC_SEGLD;

   5714  1 000046   000000 713400 xsym               CLIMB   SC_SEGLD
         1 000047   000000 600000 xsid               climb   nvectors=         0

      127     5715    2      B$UPT.CTRL(ROOTENDVP)='0'B;          /* Clear out control flags            */

   5715  1 000050   000000 470400 xsym               LDP0    B$UPT$
         1 000051   200027 720100                    LXL0    ROOTENDVP,,AUTO
         1 000052   000003 236000 2                  LDQ     3
         1 000053   000000 356110                    ANSQ    0,X0,PR0

      128     5716    2      B$JIT.PCP = B$JIT.PCP - 1;           /* Dcrement for jds                   */

   5716  1 000054   000000 471400 xsym               LDP1    B$JIT$
         1 000055   100201 220100                    LDX0    129,,PR1
         1 000056   777777 621010                    EAX1    -1,X0
         1 000057   100201 741100                    STX1    129,,PR1

      129     5717    2      CALL JDS$OVRLY (NODE,ENTRY_ADDR,FLAGS) ALTRET(INSTALL_ERR);

   5717  1 000060   200005 633500                    EPPR3   FLAGS,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:22   
         1 000061   200036 453500                    STP3    PROC$+4,,AUTO
         1 000062   200004 236100                    LDQ     @ENTRY_ADDR,,AUTO
         1 000063   200003 235100                    LDA     @NODE,,AUTO
         1 000064   200034 757100                    STAQ    PROC$+2,,AUTO
         1 000065   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 000066   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000067   000000 701000 xent               TSX1    JDS$OVRLY
         1 000070   000557 702000 1                  TSX2    INSTALL_ERR

      130     5718    2      B$JIT.PCP = B$JIT.PCP + 1;           /* Readjust pcp after jds             */

   5718  1 000071   000000 470400 xsym               LDP0    B$JIT$
         1 000072   000201 220100                    LDX0    129,,PR0
         1 000073   000001 621010                    EAX1    1,X0
         1 000074   000201 741100                    STX1    129,,PR0

      131     5719    2      NODE$ = PINCRW(B$ROSEG.TREE$,SIZEW(B$TREEHDR)

   5719  1 000075   000000 471400 xsym               LDP1    B$ROSEG$
         1 000076   100001 473500                    LDP3    1,,PR1
         1 000077   200003 474500                    LDP4    @NODE,,AUTO
         1 000100   400000 720100                    LXL0    0,,PR4
         1 000101   000000 636010                    EAQ     0,X0
         1 000102   000022 772000                    QRL     18
         1 000103   000006 402007                    MPY     6,DL
         1 000104   300003 635506                    EPPR5   3,QL,PR3
         1 000105   200020 455500                    STP5    NODE$,,AUTO

      132     5720    2        + NODE*SIZEW(B$NODE));
      133     5721    2      IF B$NODE.PSIZE = 0                  /* No procedure                       */

   5721  1 000106   500003 722100                    LXL2    3,,PR5
         1 000107   000175 601000 1                  TNZ     s:5743

      134     5722    3      THEN DO;

      135     5723                %LOCK (G=J_PLOCK);
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:23   

   5724  1 000110   000000 630400 2                  EPPR0   0
         1 000111   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000112   000000 701000 xent               TSX1    HFC$LOCK
         1 000113   000000 011000                    NOP     0

      136     5726    3           ONUM$ -> B$P.UC(0) = ONUM$ -> B$P.UC(0) - 1;

   5726  1 000114   200011 470500                    LDP0    ONUM$,,AUTO
         1 000115   000001 336007                    LCQ     1,DL
         1 000116   000000 056100                    ASQ     0,,PR0

      137     5727    3           ONUM = 0;

   5727  1 000117   200010 450100                    STZ     ONUM,,AUTO

      138     5728    3           B$U.APO = 0;

   5728  1 000120   000000 471400 xsym               LDP1    S$CU$
         1 000121   000000 236003                    LDQ     0,DU
         1 000122   100007 752114                    STCQ    7,'14'O,PR1

      139     5729    3           IF B$UPT.RPN(ROOTENDVP) ~= MM_FPMC.RPN

   5729  1 000123   000000 473400 xsym               LDP3    B$UPT$
         1 000124   200027 720100                    LXL0    ROOTENDVP,,AUTO
         1 000125   300000 221110                    LDX1    0,X0,PR3
         1 000126   000000 101000 xsym               CMPX1   MM_FPMC
         1 000127   000144 600000 1                  TZE     s:5731

      140     5730    3           THEN CALL MME$WFVP(%USERWSQ,ROOTENDVP,ERR,ERR)ALTRET(JD_SUA);

   5730  1 000130   200030 634500                    EPPR4   ERR,,AUTO
         1 000131   200037 454500                    STP4    PROC$+5,,AUTO
         1 000132   200030 635500                    EPPR5   ERR,,AUTO
         1 000133   200036 455500                    STP5    PROC$+4,,AUTO
         1 000134   200027 636500                    EPPR6   ROOTENDVP,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:24   
         1 000135   200035 456500                    STP6    PROC$+3,,AUTO
         1 000136   000002 236000 2                  LDQ     2
         1 000137   200034 756100                    STQ     PROC$+2,,AUTO
         1 000140   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 000141   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000142   000000 701000 xent               TSX1    MME$WFVP
         1 000143   000672 702000 1                  TSX2    JD_SUA

      141     5731    3           IF HW_WSQ0PT THEN

   5731  1 000144   000000 234000 xsym               SZN     HW_WSQ0PT
         1 000145   000155 605000 1                  TPL     s:5734

      142     5732    3                B$UPT.RPN(ROOTENDVP) = B$WSQ0PT$->B$MAP.RPN(ROOTENDPP);

   5732  1 000146   000000 470400 xsym               LDP0    B$WSQ0PT$
         1 000147   200026 720100                    LXL0    ROOTENDPP,,AUTO
         1 000150   000000 221110                    LDX1    0,X0,PR0
         1 000151   000000 471400 xsym               LDP1    B$UPT$
         1 000152   200027 722100                    LXL2    ROOTENDVP,,AUTO
         1 000153   100000 741112                    STX1    0,X2,PR1
         1 000154   000161 710000 1                  TRA     s:5736

      143     5733    3           ELSE
      144     5734    3                B$UPT.RPN(ROOTENDVP) = ROOTENDPP;

   5734  1 000155   200026 720100                    LXL0    ROOTENDPP,,AUTO
         1 000156   000000 470400 xsym               LDP0    B$UPT$
         1 000157   200027 721100                    LXL1    ROOTENDVP,,AUTO
         1 000160   000000 740111                    STX0    0,X1,PR0

      145     5735                %SAC (VPNO = ROOTENDVP , AC = "%PGINMEM|%PGIOM");

   5736  1 000161   000000 470400 xsym               LDP0    B$UPT$
         1 000162   200027 720100                    LXL0    ROOTENDVP,,AUTO
         1 000163   000000 236110                    LDQ     0,X0,PR0
         1 000164   000003 376000 2                  ANQ     3
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:25   
         1 000165   000044 276007                    ORQ     36,DL
         1 000166   000000 756110                    STQ     0,X0,PR0

      146     5738                %UNLOCK (G=J_PLOCK);

   5739  1 000167   000000 630400 2                  EPPR0   0
         1 000170   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000171   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000172   000000 011000                    NOP     0

      147     5741    3           RETURN;

   5741  1 000173   200022 221300                    LDX1  ! OVENT$+1,,AUTO
         1 000174   000001 702211                    TSX2  ! 1,X1

      148     5742    3           END;
      149     5743    2      LOPG = B$NODE.PADDR/1024 + %ISEGLO;

   5743  1 000175   500003 236100                    LDQ     3,,PR5
         1 000176   000022 772000                    QRL     18
         1 000177   000012 772000                    QRL     10
         1 000200   000100 036007                    ADLQ    64,DL
         1 000201   200025 756100                    STQ     LOPG,,AUTO

      150     5744    2      IF B$UPT.RPN(LOPG) = %FPMC           /* Something is terribly wrong        */

   5744  1 000202   000000 476400 xsym               LDP6    B$UPT$
         1 000203   600000 223106                    LDX3    0,QL,PR6
         1 000204   777777 103003                    CMPX3   -1,DU
         1 000205   000212 601000 1                  TNZ     s:5751

      151     5745    3      THEN DO;

      152     5746    3           CALL SC_SEGLD;

   5746  1 000206   000000 713400 xsym               CLIMB   SC_SEGLD
         1 000207   000000 600000 xsid               climb   nvectors=         0
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:26   

      153     5747    3           ALTRETURN;

   5747  1 000210   200022 221300                    LDX1  ! OVENT$+1,,AUTO
         1 000211   000000 702211                    TSX2  ! 0,X1

      154     5748    3           END;
      155     5749
      156     5750        /* Copy end of last root proc. page into start of overlay pg. */
      157     5751    2      OVERLAP = MOD(B$NODE.PADDR,1024) * 4;

   5751  1 000212   500003 236100                    LDQ     3,,PR5
         1 000213   000022 772000                    QRL     18
         1 000214   001777 376007                    ANQ     1023,DL
         1 000215   000002 736000                    QLS     2
         1 000216   200031 756100                    STQ     OVERLAP,,AUTO

      158     5752    2      IF OVERLAP <= 0

   5752  1 000217   000260 605400 1                  TPNZ    s:5764

      159     5753    3      THEN DO;

      160     5754    3           CALL MME$WFVP(%USERWSQ,ROOTENDVP,ERR,ERR) ALTRET(JD_SUA);

   5754  1 000220   200030 637500                    EPPR7   ERR,,AUTO
         1 000221   200037 457500                    STP7    PROC$+5,,AUTO
         1 000222   200030 633500                    EPPR3   ERR,,AUTO
         1 000223   200036 453500                    STP3    PROC$+4,,AUTO
         1 000224   200027 630500                    EPPR0   ROOTENDVP,,AUTO
         1 000225   200035 450500                    STP0    PROC$+3,,AUTO
         1 000226   000002 236000 2                  LDQ     2
         1 000227   200034 756100                    STQ     PROC$+2,,AUTO
         1 000230   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 000231   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000232   000000 701000 xent               TSX1    MME$WFVP
         1 000233   000672 702000 1                  TSX2    JD_SUA
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:27   

      161     5755    3           IF HW_WSQ0PT THEN

   5755  1 000234   000000 234000 xsym               SZN     HW_WSQ0PT
         1 000235   000245 605000 1                  TPL     s:5758

      162     5756    3                B$UPT.RPN(ROOTENDVP) = B$WSQ0PT$->B$MAP.RPN(ROOTENDPP);

   5756  1 000236   000000 470400 xsym               LDP0    B$WSQ0PT$
         1 000237   200026 720100                    LXL0    ROOTENDPP,,AUTO
         1 000240   000000 221110                    LDX1    0,X0,PR0
         1 000241   000000 471400 xsym               LDP1    B$UPT$
         1 000242   200027 722100                    LXL2    ROOTENDVP,,AUTO
         1 000243   100000 741112                    STX1    0,X2,PR1
         1 000244   000251 710000 1                  TRA     s:5760

      163     5757    3           ELSE
      164     5758    3                B$UPT.RPN(ROOTENDVP) = ROOTENDPP;

   5758  1 000245   200026 720100                    LXL0    ROOTENDPP,,AUTO
         1 000246   000000 470400 xsym               LDP0    B$UPT$
         1 000247   200027 721100                    LXL1    ROOTENDVP,,AUTO
         1 000250   000000 740111                    STX0    0,X1,PR0

      165     5759                %SAC (VPNO = ROOTENDVP , AC = "%PGINMEM|%PGIOM");

   5760  1 000251   000000 470400 xsym               LDP0    B$UPT$
         1 000252   200027 720100                    LXL0    ROOTENDVP,,AUTO
         1 000253   000000 236110                    LDQ     0,X0,PR0
         1 000254   000003 376000 2                  ANQ     3
         1 000255   000044 276007                    ORQ     36,DL
         1 000256   000000 756110                    STQ     0,X0,PR0

      166     5762    3           END;

   5762  1 000257   000335 710000 1                  TRA     s:5778

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:28   
      167     5763    3      ELSE DO;

      168     5764    3           CALL MME$CVM(%USERWSQ,%SBUF2PG,ROOTENDPP,ERR) ALTRET(JD_SUA);

   5764  1 000260   200030 637500                    EPPR7   ERR,,AUTO
         1 000261   200037 457500                    STP7    PROC$+5,,AUTO
         1 000262   200026 633500                    EPPR3   ROOTENDPP,,AUTO
         1 000263   200036 453500                    STP3    PROC$+4,,AUTO
         1 000264   000006 237000 2                  LDAQ    6
         1 000265   200034 757100                    STAQ    PROC$+2,,AUTO
         1 000266   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 000267   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000270   000000 701000 xent               TSX1    MME$CVM
         1 000271   000672 702000 1                  TSX2    JD_SUA

      169     5765    3           PROC$ = PINCRW(B$USERIS$,(LOPG-%ISEGLO)*1024);

   5765  1 000272   200025 236100                    LDQ     LOPG,,AUTO
         1 000273   000034 736000                    QLS     28
         1 000274   200000 136003                    SBLQ    65536,DU
         1 000275   000000 036000 xsym               ADLQ    B$USERIS$
         1 000276   200032 756100                    STQ     PROC$,,AUTO

      170     5766                %SAC (VPNO = LOPG , AC = "%PGINMEM|%PGWRITE|%PGIOM");

   5767  1 000277   000000 470400 xsym               LDP0    B$UPT$
         1 000300   200025 720100                    LXL0    LOPG,,AUTO
         1 000301   000000 236110                    LDQ     0,X0,PR0
         1 000302   000003 376000 2                  ANQ     3
         1 000303   000064 276007                    ORQ     52,DL
         1 000304   000000 756110                    STQ     0,X0,PR0

      171     5769    3           PROC$ -> CHARS = B$SBUF2$ -> CHARS;

   5769  1 000305   000000 471400 xsym               LDP1    B$SBUF2$
         1 000306   200031 721100                    LXL1    OVERLAP,,AUTO
         1 000307   200032 473500                    LDP3    PROC$,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:29   
         1 000310   040140 100540                    MLR     fill='040'O
         1 000311   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1
         1 000312   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1

      172     5770                %SAC (VPNO = LOPG , AC = "%PGIOM|%PGINMEM");

   5771  1 000313   000000 236110                    LDQ     0,X0,PR0
         1 000314   000003 376000 2                  ANQ     3
         1 000315   000044 276007                    ORQ     36,DL
         1 000316   000000 756110                    STQ     0,X0,PR0

      173     5773    3           CALL MME$CVM(%USERWSQ,%SBUF2PG,-1,ERR) ALTRET(JD_SUA);

   5773  1 000317   200030 634500                    EPPR4   ERR,,AUTO
         1 000320   200037 454500                    STP4    PROC$+5,,AUTO
         1 000321   000005 236000 2                  LDQ     5
         1 000322   200036 756100                    STQ     PROC$+4,,AUTO
         1 000323   000006 237000 2                  LDAQ    6
         1 000324   200034 757100                    STAQ    PROC$+2,,AUTO
         1 000325   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 000326   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000327   000000 701000 xent               TSX1    MME$CVM
         1 000330   000672 702000 1                  TSX2    JD_SUA

      174     5774        /* Allow for the replaced root end page, which at this point will  */
      175     5775        /* have been counted twice in B$JIT.PCP if no previous overlay.    */
      176     5776    3           B$JIT.PCP = B$JIT.PCP - 1;

   5776  1 000331   000000 470400 xsym               LDP0    B$JIT$
         1 000332   000201 220100                    LDX0    129,,PR0
         1 000333   777777 621010                    EAX1    -1,X0
         1 000334   000201 741100                    STX1    129,,PR0

      177     5777    3           END;

      178     5778    2      HIPG = %ISEGLO + (B$NODE.PADDR + B$NODE.PSIZE - 1)/1024;

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:30   
   5778  1 000335   200020 470500                    LDP0    NODE$,,AUTO
         1 000336   000003 236100                    LDQ     3,,PR0
         1 000337   777777 376007                    ANQ     -1,DL
         1 000340   200034 756100                    STQ     PROC$+2,,AUTO
         1 000341   000003 236100                    LDQ     3,,PR0
         1 000342   000022 772000                    QRL     18
         1 000343   200034 036100                    ADLQ    PROC$+2,,AUTO
         1 000344   000001 136007                    SBLQ    1,DL
         1 000345   002000 506007                    DIV     1024,DL
         1 000346   000100 036007                    ADLQ    64,DL
         1 000347   200024 756100                    STQ     HIPG,,AUTO

      179     5779        /* Reset the "page belongs to user" bit for the overlay's proc. pgs */
      180     5780    3      DO I = LOPG TO HIPG;

   5780  1 000350   200025 235100                    LDA     LOPG,,AUTO
         1 000351   200014 755100                    STA     I,,AUTO
         1 000352   000433 710000 1                  TRA     s:5796+1

      181     5781                %SSC (VPNO = I , SC = '0'B);

   5782  1 000353   000000 470400 xsym               LDP0    B$UPT$
         1 000354   200014 720100                    LXL0    I,,AUTO
         1 000355   000010 236000 2                  LDQ     8
         1 000356   000000 356110                    ANSQ    0,X0,PR0

      182     5784    4           IF HW_WSQ0PT THEN DO;

   5784  1 000357   000000 234000 xsym               SZN     HW_WSQ0PT
         1 000360   000406 605000 1                  TPL     s:5790

      183     5785    4                TEMP1 = B$IPHYMAP$->MM$IPHY_MAP(B$UPT.RPN(I));

   5785  1 000361   200014 720100                    LXL0    I,,AUTO
         1 000362   000000 236110                    LDQ     0,X0,PR0
         1 000363   000022 772000                    QRL     18
         1 000364   000001 736000                    QLS     1
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:31   
         1 000365   000000 471400 xsym               LDP1    B$IPHYMAP$
         1 000366   000100 101506                    MRL     fill='000'O
         1 000367   100000 000002                    ADSC9   0,Q,PR1                  cn=0,n=2
         1 000370   200015 000004                    ADSC9   TEMP1,,AUTO              cn=0,n=4

      184     5786    4                IF I~=HIPG THEN

   5786  1 000371   200014 236100                    LDQ     I,,AUTO
         1 000372   200024 116100                    CMPQ    HIPG,,AUTO
         1 000373   000415 600000 1                  TZE     s:5793

      185     5787    4                     MM$PPUT.PPNO(TEMP1) = B$IPHYMAP$->MM$IPHY_MAP(B$UPT.RPN(I+1));

   5787  1 000374   000001 236110                    LDQ     1,X0,PR0
         1 000375   000022 772000                    QRL     18
         1 000376   000001 736000                    QLS     1
         1 000377   200015 235100                    LDA     TEMP1,,AUTO
         1 000400   000002 735000                    ALS     2
         1 000401   000000 473400 xsym               LDP3    B$PPUT$
         1 000402   000105 100506                    MLR     fill='000'O
         1 000403   100000 000002                    ADSC9   0,Q,PR1                  cn=0,n=2
         1 000404   300000 400002                    ADSC9   0,A,PR3                  cn=2,n=2

      186     5788    4                END;

   5788  1 000405   000415 710000 1                  TRA     s:5793

      187     5789    4           ELSE DO;

      188     5790    4                TEMP1 = B$UPT.RPN(I);

   5790  1 000406   200014 720100                    LXL0    I,,AUTO
         1 000407   000000 236110                    LDQ     0,X0,PR0
         1 000410   000022 772000                    QRL     18
         1 000411   200015 756100                    STQ     TEMP1,,AUTO

      189     5791    4                MM$PPUT.PPNO(TEMP1) = B$UPT.RPN(I+1);
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:32   

   5791  1 000412   000001 221110                    LDX1    1,X0,PR0
         1 000413   000000 471400 xsym               LDP1    B$PPUT$
         1 000414   100000 441106                    SXL1    0,QL,PR1

      190     5792    4                END;

      191     5793    3           MM$PPUT.USER(TEMP1) = '0'B;

   5793  1 000415   000000 471400 xsym               LDP1    B$PPUT$
         1 000416   200015 720100                    LXL0    TEMP1,,AUTO
         1 000417   000011 236000 2                  LDQ     9
         1 000420   100000 356110                    ANSQ    0,X0,PR1

      192     5794    3           MM$PPUT.PRC(TEMP1) = '1'B;

   5794  1 000421   200015 720100                    LXL0    TEMP1,,AUTO
         1 000422   004000 236003                    LDQ     2048,DU
         1 000423   100000 256110                    ORSQ    0,X0,PR1

      193     5795    3           MM$PPUT.PNUM(TEMP1) = ONUM;     /* Store processor number             */

   5795  1 000424   200015 720100                    LXL0    TEMP1,,AUTO
         1 000425   200010 236100                    LDQ     ONUM,,AUTO
         1 000426   000022 736000                    QLS     18
         1 000427   100000 676110                    ERQ     0,X0,PR1
         1 000430   000777 376003                    ANQ     511,DU
         1 000431   100000 656110                    ERSQ    0,X0,PR1

      194     5796    3           END;

   5796  1 000432   200014 054100                    AOS     I,,AUTO
         1 000433   200014 236100                    LDQ     I,,AUTO
         1 000434   200024 116100                    CMPQ    HIPG,,AUTO
         1 000435   000353 604400 1                  TMOZ    s:5782

      195     5797    2      MM$PPUT.PPNO(TEMP1) = 0;             /* End of chain                       */
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:33   

   5797  1 000436   000000 220003                    LDX0    0,DU
         1 000437   000000 470400 xsym               LDP0    B$PPUT$
         1 000440   200015 721100                    LXL1    TEMP1,,AUTO
         1 000441   000000 440111                    SXL0    0,X1,PR0

      196     5798    2      TEMP = HIPG - LOPG + 1;

   5798  1 000442   200024 236100                    LDQ     HIPG,,AUTO
         1 000443   200025 136100                    SBLQ    LOPG,,AUTO
         1 000444   000001 036007                    ADLQ    1,DL
         1 000445   200030 756100                    STQ     ERR,,AUTO

      197     5799    2      B$JIT.PPC = B$JIT.PPC - TEMP;

   5799  1 000446   000000 471400 xsym               LDP1    B$JIT$
         1 000447   100207 236100                    LDQ     135,,PR1
         1 000450   777777 376007                    ANQ     -1,DL
         1 000451   200030 136100                    SBLQ    ERR,,AUTO
         1 000452   000000 621006                    EAX1    0,QL
         1 000453   100207 441100                    SXL1    135,,PR1

      198     5800    2      B$U.PCT = B$U.PCT - TEMP;

   5800  1 000454   000000 473400 xsym               LDP3    S$CU$
         1 000455   300010 236100                    LDQ     8,,PR3
         1 000456   000022 772000                    QRL     18
         1 000457   200030 136100                    SBLQ    ERR,,AUTO
         1 000460   000000 622006                    EAX2    0,QL
         1 000461   300010 742100                    STX2    8,,PR3

      199     5801        /* Set up the necessary new processor table information */
      200     5802           %LOCK (G=J_PLOCK);

   5803  1 000462   000000 630400 2                  EPPR0   0
         1 000463   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000464   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:34   
         1 000465   000000 011000                    NOP     0

      201     5805    3      IF HW_WSQ0PT THEN DO;

   5805  1 000466   000000 234000 xsym               SZN     HW_WSQ0PT
         1 000467   000512 605000 1                  TPL     s:5810

      202     5806    3           ONUM$->B$P.HPP(0)=B$IPHYMAP$->MM$IPHY_MAP(B$UPT.RPN(LOPG));

   5806  1 000470   000000 470400 xsym               LDP0    B$UPT$
         1 000471   200025 720100                    LXL0    LOPG,,AUTO
         1 000472   000000 236110                    LDQ     0,X0,PR0
         1 000473   000022 772000                    QRL     18
         1 000474   000001 736000                    QLS     1
         1 000475   000000 471400 xsym               LDP1    B$IPHYMAP$
         1 000476   200011 473500                    LDP3    ONUM$,,AUTO
         1 000477   000100 101506                    MRL     fill='000'O
         1 000500   100000 000002                    ADSC9   0,Q,PR1                  cn=0,n=2
         1 000501   300002 000004                    ADSC9   2,,PR3                   cn=0,n=4

      203     5807    3           ONUM$->B$P.TPP(0)=B$IPHYMAP$->MM$IPHY_MAP(B$UPT.RPN(HIPG));

   5807  1 000502   200024 721100                    LXL1    HIPG,,AUTO
         1 000503   000000 236111                    LDQ     0,X1,PR0
         1 000504   000022 772000                    QRL     18
         1 000505   000001 736000                    QLS     1
         1 000506   000100 100506                    MLR     fill='000'O
         1 000507   100000 000002                    ADSC9   0,Q,PR1                  cn=0,n=2
         1 000510   300023 000002                    ADSC9   19,,PR3                  cn=0,n=2

      204     5808    3           END;

   5808  1 000511   000523 710000 1                  TRA     s:5813

      205     5809    3      ELSE DO;

      206     5810    3           ONUM$ -> B$P.HPP(0) = B$UPT.RPN(LOPG);
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:35   

   5810  1 000512   000000 470400 xsym               LDP0    B$UPT$
         1 000513   200025 720100                    LXL0    LOPG,,AUTO
         1 000514   000000 236110                    LDQ     0,X0,PR0
         1 000515   000022 772000                    QRL     18
         1 000516   200011 471500                    LDP1    ONUM$,,AUTO
         1 000517   100002 756100                    STQ     2,,PR1

      207     5811    3           ONUM$ -> B$P.TPP(0) = B$UPT.RPN(HIPG);

   5811  1 000520   200024 721100                    LXL1    HIPG,,AUTO
         1 000521   000000 222111                    LDX2    0,X1,PR0
         1 000522   100023 742100                    STX2    19,,PR1

      208     5812    3           END;

      209     5813    2      ONUM$ -> B$P.PPC(0) = TEMP;

   5813  1 000523   200030 235100                    LDA     ERR,,AUTO
         1 000524   200011 471500                    LDP1    ONUM$,,AUTO
         1 000525   100003 755100                    STA     3,,PR1

      210     5814    2      ONUM$ -> B$P.INSTDATE(0) = APR$ -> B$P.INSTDATE(0);

   5814  1 000526   200013 473500                    LDP3    APR$,,AUTO
         1 000527   300005 235100                    LDA     5,,PR3
         1 000530   100005 755100                    STA     5,,PR1

      211     5815    2      OVENT$=B$NODE.ENTRY$;

   5815  1 000531   200020 474500                    LDP4    NODE$,,AUTO
         1 000532   400005 236100                    LDQ     5,,PR4
         1 000533   200021 756100                    STQ     OVENT$,,AUTO

      212     5816    2      ONUM$ -> B$P.SA(0)=OVENT.ADDRESS;

   5816  1 000534   200021 222100                    LDX2    OVENT$,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:36   
         1 000535   100026 442100                    SXL2    22,,PR1

      213     5817
      214     5818    2      MM$BYP.AUTOINUSE = MM$BYP.AUTOINUSE + TEMP;

   5818  1 000536   000000 475400 xsym               LDP5    MM_BYP$
         1 000537   500015 236100                    LDQ     13,,PR5
         1 000540   200030 036100                    ADLQ    ERR,,AUTO
         1 000541   500015 756100                    STQ     13,,PR5

      215     5819    2      ONUM$ -> B$P.PVA(0) = LOPG;

   5819  1 000542   100025 740100                    STX0    21,,PR1

      216     5820    2      ONUM$ -> B$P.HVA(0) = HIPG + 1;

   5820  1 000543   000001 623011                    EAX3    1,X1
         1 000544   100026 743100                    STX3    22,,PR1

      217     5821        /* And finally, fill in the rest of the processor table. */
      218     5822    2      ONUM$ -> B$P.DADDR(0) = B$NODE.DADDR;

   5822  1 000545   400004 224100                    LDX4    4,,PR4
         1 000546   100024 744100                    STX4    20,,PR1

      219     5823    2      ONUM$ -> B$P.DSZ(0) = B$NODE.DSIZE;

   5823  1 000547   400004 725100                    LXL5    4,,PR4
         1 000550   100024 445100                    SXL5    20,,PR1

      220     5824           %UNLOCK(G=J_PLOCK);

   5825  1 000551   000000 630400 2                  EPPR0   0
         1 000552   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000553   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000554   000000 011000                    NOP     0

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:37   
      221     5827    2      RETURN;

   5827  1 000555   200022 221300                    LDX1  ! OVENT$+1,,AUTO
         1 000556   000001 702211                    TSX2  ! 1,X1

   5823  1 000557                       INSTALL_ERR  null
      222     5828        /**/
      223     5829    2   INSTALL_ERR:;
      224     5830    2      B$U.APO = 0;

   5830  1 000557   000000 470400 xsym               LDP0    S$CU$
         1 000560   000000 236003                    LDQ     0,DU
         1 000561   000007 752114                    STCQ    7,'14'O,PR0

      225     5831    2      ONUM$ -> B$P.UC(0) = ONUM$ -> B$P.UC(0) - 1;

   5831  1 000562   200011 471500                    LDP1    ONUM$,,AUTO
         1 000563   000001 336007                    LCQ     1,DL
         1 000564   100000 056100                    ASQ     0,,PR1

      226     5832             /* Check if we got a new physical page for the end of
      227     5833                  the root and free it */
      228     5834    2      IF B$UPT.RPN(ROOTENDVP) ~= MM_FPMC.RPN

   5834  1 000565   000000 470400 xsym               LDP0    B$UPT$
         1 000566   200027 720100                    LXL0    ROOTENDVP,,AUTO
         1 000567   000000 221110                    LDX1    0,X0,PR0
         1 000570   000000 101000 xsym               CMPX1   MM_FPMC
         1 000571   000606 600000 1                  TZE     s:5837

      229     5835    2      THEN
      230     5836    2           CALL MME$WFVP(%USERWSQ,ROOTENDVP,ERR,ERR)ALTRET(JD_SUA);

   5836  1 000572   200030 633500                    EPPR3   ERR,,AUTO
         1 000573   200037 453500                    STP3    PROC$+5,,AUTO
         1 000574   200030 634500                    EPPR4   ERR,,AUTO
         1 000575   200036 454500                    STP4    PROC$+4,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:38   
         1 000576   200027 635500                    EPPR5   ROOTENDVP,,AUTO
         1 000577   200035 455500                    STP5    PROC$+3,,AUTO
         1 000600   000002 236000 2                  LDQ     2
         1 000601   200034 756100                    STQ     PROC$+2,,AUTO
         1 000602   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 000603   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000604   000000 701000 xent               TSX1    MME$WFVP
         1 000605   000672 702000 1                  TSX2    JD_SUA

      231     5837    2      IF HW_WSQ0PT THEN

   5837  1 000606   000000 234000 xsym               SZN     HW_WSQ0PT
         1 000607   000617 605000 1                  TPL     s:5840

      232     5838    2           B$UPT.RPN(ROOTENDVP) = B$WSQ0PT$->B$MAP.RPN(ROOTENDPP);

   5838  1 000610   000000 470400 xsym               LDP0    B$WSQ0PT$
         1 000611   200026 720100                    LXL0    ROOTENDPP,,AUTO
         1 000612   000000 221110                    LDX1    0,X0,PR0
         1 000613   000000 471400 xsym               LDP1    B$UPT$
         1 000614   200027 722100                    LXL2    ROOTENDVP,,AUTO
         1 000615   100000 741112                    STX1    0,X2,PR1
         1 000616   000623 710000 1                  TRA     s:5842

      233     5839    2      ELSE
      234     5840    2           B$UPT.RPN(ROOTENDVP) = ROOTENDPP;

   5840  1 000617   200026 720100                    LXL0    ROOTENDPP,,AUTO
         1 000620   000000 470400 xsym               LDP0    B$UPT$
         1 000621   200027 721100                    LXL1    ROOTENDVP,,AUTO
         1 000622   000000 740111                    STX0    0,X1,PR0

      235     5841           %SAC (VPNO = ROOTENDVP , AC = "%PGINMEM|%PGIOM");

   5842  1 000623   000000 470400 xsym               LDP0    B$UPT$
         1 000624   200027 720100                    LXL0    ROOTENDVP,,AUTO
         1 000625   000000 236110                    LDQ     0,X0,PR0
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:39   
         1 000626   000003 376000 2                  ANQ     3
         1 000627   000044 276007                    ORQ     36,DL
         1 000630   000000 756110                    STQ     0,X0,PR0

      236     5844
      237     5845        /* Clear out any pages that were allocated for this overlay */
      238     5846    2      HIPG = APO$ -> B$P.HVA(0) - 1;

   5846  1 000631   200012 471500                    LDP1    APO$,,AUTO
         1 000632   100026 236100                    LDQ     22,,PR1
         1 000633   000022 772000                    QRL     18
         1 000634   000001 136007                    SBLQ    1,DL
         1 000635   200024 756100                    STQ     HIPG,,AUTO

      239     5847    3      DO I = ROOTENDVP+1 TO HIPG;

   5847  1 000636   200027 235100                    LDA     ROOTENDVP,,AUTO
         1 000637   000001 035007                    ADLA    1,DL
         1 000640   200014 755100                    STA     I,,AUTO
         1 000641   000665 710000 1                  TRA     s:5851+1

      240     5848    3           IF B$UPT.SCTRL(I) = %SCUSER

   5848  1 000642   000000 470400 xsym               LDP0    B$UPT$
         1 000643   200014 720100                    LXL0    I,,AUTO
         1 000644   000000 236110                    LDQ     0,X0,PR0
         1 000645   777400 376007                    ANQ     -256,DL
         1 000646   000400 116007                    CMPQ    256,DL
         1 000647   000664 601000 1                  TNZ     s:5851

      241     5849    3           THEN
      242     5850    3                CALL MME$WFVP(%USERWSQ,I,ERR,ERR) ALTRET(JD_SUA);

   5850  1 000650   200030 631500                    EPPR1   ERR,,AUTO
         1 000651   200037 451500                    STP1    PROC$+5,,AUTO
         1 000652   200030 633500                    EPPR3   ERR,,AUTO
         1 000653   200036 453500                    STP3    PROC$+4,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:40   
         1 000654   200014 634500                    EPPR4   I,,AUTO
         1 000655   200035 454500                    STP4    PROC$+3,,AUTO
         1 000656   000002 236000 2                  LDQ     2
         1 000657   200034 756100                    STQ     PROC$+2,,AUTO
         1 000660   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 000661   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000662   000000 701000 xent               TSX1    MME$WFVP
         1 000663   000672 702000 1                  TSX2    JD_SUA

      243     5851    3           END;

   5851  1 000664   200014 054100                    AOS     I,,AUTO
         1 000665   200014 236100                    LDQ     I,,AUTO
         1 000666   200024 116100                    CMPQ    HIPG,,AUTO
         1 000667   000642 604400 1                  TMOZ    s:5848

      244     5852    2      ALTRETURN;

   5852  1 000670   200022 221300                    LDX1  ! OVENT$+1,,AUTO
         1 000671   000000 702211                    TSX2  ! 0,X1

      245     5853        /**/
      246     5854    2   JD_SUA:
      247     5855    2      ONUM$ -> B$P.UC(0) = 0;    /* Reset ucount to zero since we are only one   */

   5855  1 000672   200011 470500       JD_SUA       LDP0    ONUM$,,AUTO
         1 000673   000000 450100                    STZ     0,,PR0

      248     5856        /*S*    SCREECH_CODE: JDS-S$SEGLD                                  */
      249     5857        /*S*    TYPE:   SUA                                                */
      250     5858        /*S*    MESSAGE: Internal error installing shared overlay.         */
      251     5859    2      CALL SC_SEGLD;

   5859  1 000674   000000 713400 xsym               CLIMB   SC_SEGLD
         1 000675   000000 600000 xsid               climb   nvectors=         0

      252     5860        /**/
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:41   
      253     5861    2   END INSTALL_OVRLY;

   5861  1 000676   200022 221300                    LDX1  ! OVENT$+1,,AUTO
         1 000677   000001 702211                    TSX2  ! 1,X1

      254     5862        /**/
      255     5863        %EJECT;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:42   
      256     5864        /*************************************************************
      257     5865         *                                                           *
      258     5866         *                      JDP$SEGLD                            *
      259     5867         *                                                           *
      260     5868         *************************************************************/
      261     5869
      262     5870        /* Move frequently accessed data to AUTO    */
      263     5871    1      FLAGS = B$PS1$->FPT$OLAY_V.FLGS;

   5871  1 000700   000000 470400 xsym               LDP0    B$PS1$
         1 000701   000000 236100                    LDQ     0,,PR0
         1 000702   777000 376003                    ANQ     -512,DU
         1 000703   200005 756100                    STQ     FLAGS,,AUTO

      264     5872    1      APR = B$U.APR;

   5872  1 000704   000000 471400 xsym               LDP1    S$CU$
         1 000705   100007 236100                    LDQ     7,,PR1
         1 000706   000030 772000                    QRL     24
         1 000707   200006 756100                    STQ     APR,,AUTO

      265     5873    1      APR$ = ADDR (B$P$ -> B$P(APR));

   5873  1 000710   000042 402003                    MPY     34,DU
         1 000711   000000 036000 xsym               ADLQ    B$P$
         1 000712   200013 756100                    STQ     APR$,,AUTO

      266     5874
      267     5875        /* Find the requested overlay number in the shared processor tables */
      268     5876    1      ONUM = APR$ -> B$P.LNK(0);

   5876  1 000713   200013 473500                    LDP3    APR$,,AUTO
         1 000714   300022 236100                    LDQ     18,,PR3
         1 000715   777777 376007                    ANQ     -1,DL
         1 000716   200010 756100                    STQ     ONUM,,AUTO

      269     5877    2      DO WHILE (ONUM ~= 0);
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:43   

   5877  1 000717   000745 600000 1                  TZE     s:5884

      270     5878    2           ONUM$ = ADDR (B$P$ -> B$P(ONUM));

   5878  1 000720   200010 236100                    LDQ     ONUM,,AUTO
         1 000721   000042 402003                    MPY     34,DU
         1 000722   000000 036000 xsym               ADLQ    B$P$
         1 000723   200011 756100                    STQ     ONUM$,,AUTO

      271     5879    2           IF B$PS0$->TEXTC.TEXT = ADDR(ONUM$ -> B$P.NAME(0))->TEXTC.TEXT

   5879  1 000724   000000 470400 xsym               LDP0    B$PS0$
         1 000725   000100 101500                    MRL     fill='000'O
         1 000726   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         1 000727   200034 000002                    ADSC9   PROC$+2,,AUTO            cn=0,n=2
         1 000730   200034 220100                    LDX0    PROC$+2,,AUTO
         1 000731   200011 471500                    LDP1    ONUM$,,AUTO
         1 000732   100032 236100                    LDQ     26,,PR1
         1 000733   000033 772000                    QRL     27
         1 000734   000000 621006                    EAX1    0,QL
         1 000735   040140 106540                    CMPC    fill='040'O
         1 000736   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
         1 000737   100032 200011                    ADSC9   26,,PR1                  cn=1,n=*X1
         1 000740   000751 600000 1                  TZE     FOUND

      272     5880    2           THEN GOTO FOUND;
      273     5881    2           ONUM = ONUM$ -> B$P.LNK(0);

   5881  1 000741   100022 236100                    LDQ     18,,PR1
         1 000742   777777 376007                    ANQ     -1,DL
         1 000743   200010 756100                    STQ     ONUM,,AUTO

      274     5882    2           END;

   5882  1 000744   000720 601000 1                  TNZ     s:5878

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:44   
      275     5883
      276     5884    1      B$JIT.ERR=ENOOVRLY;

   5884  1 000745   000000 236000 0                  LDQ     ENOOVRLY
         1 000746   000000 470400 xsym               LDP0    B$JIT$
         1 000747   000012 756100                    STQ     10,,PR0

      277     5885    1      ALTRETURN;

   5885  1 000750   000000 702200 xent               TSX2  ! X66_AALT

   5884  1 000751                       FOUND        null
      278     5886        /*E*    ERROR:  JDP-E$NOOVRLY-4                                      */
      279     5887        /*E*   MESSAGE: That shared processor overlay does not exist.      */
      280     5888
      281     5889    1   FOUND: ;
      282     5890    1      APO = B$U.APO;

   5890  1 000751   000000 473400 xsym               LDP3    S$CU$
         1 000752   300007 236100                    LDQ     7,,PR3
         1 000753   000014 772000                    QRL     12
         1 000754   007777 376007                    ANQ     4095,DL
         1 000755   200007 756100                    STQ     APO,,AUTO

      283     5891    1      APO$ = ADDR (B$P$ -> B$P(APO));

   5891  1 000756   000042 402003                    MPY     34,DU
         1 000757   000000 036000 xsym               ADLQ    B$P$
         1 000760   200012 756100                    STQ     APO$,,AUTO

      284     5892    1      IF (FLAGS & JD_CANCEL)

   5892  1 000761   200005 236100                    LDQ     FLAGS,,AUTO
         1 000762   777000 376003                    ANQ     -512,DU
         1 000763   001000 376003                    ANQ     512,DU
         1 000764   000772 600000 1                  TZE     s:5896

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:45   
      285     5893    1      THEN IF APO ~= ONUM

   5893  1 000765   200007 236100                    LDQ     APO,,AUTO
         1 000766   000771 604000 1                  TMI     s:5894
         1 000767   200010 116100                    CMPQ    ONUM,,AUTO
         1 000770   000776 600000 1                  TZE     s:5900

      286     5894    1           THEN RETURN;

   5894  1 000771   000000 702200 xent               TSX2  ! X66_ARET

      287     5895    1           ELSE ;
      288     5896    1      ELSE IF APO = ONUM

   5896  1 000772   200007 236100                    LDQ     APO,,AUTO
         1 000773   000776 604000 1                  TMI     s:5900
         1 000774   200010 116100                    CMPQ    ONUM,,AUTO
         1 000775   001340 600000 1                  TZE     RETURN_NODE

      289     5897    1           THEN GOTO RETURN_NODE;
      290     5898
      291     5899        /* Clear out any previously associated overlay from the page table */
      292     5900    1      IF APO ~= 0

   5900  1 000776   000000 116003                    CMPQ    0,DU
         1 000777   001044 600000 1                  TZE     s:5913

      293     5901    2      THEN DO;

      294     5902        /* Don't free the last page of root procedure (yet)...*/
      295     5903    3           DO I = APR$ -> B$P.PVA(0) + APR$ -> B$P.PPC(0) TO APO$ -> B$P.HVA(0) - 1;

   5903  1 001000   200013 474500                    LDP4    APR$,,AUTO
         1 001001   400025 236100                    LDQ     21,,PR4
         1 001002   000022 772000                    QRL     18
         1 001003   400003 036100                    ADLQ    3,,PR4
         1 001004   200014 756100                    STQ     I,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:46   
         1 001005   001016 710000 1                  TRA     s:5906+1

      296     5904    3                B$UPT(I) = MM_FPMC;

   5904  1 001006   000000 236000 xsym               LDQ     MM_FPMC
         1 001007   000000 470400 xsym               LDP0    B$UPT$
         1 001010   200014 720100                    LXL0    I,,AUTO
         1 001011   000000 756110                    STQ     0,X0,PR0

      297     5905    3                B$UPT.CTRL(I) = '0'B;

   5905  1 001012   200014 720100                    LXL0    I,,AUTO
         1 001013   000003 236000 2                  LDQ     3
         1 001014   000000 356110                    ANSQ    0,X0,PR0

      298     5906    3                END;

   5906  1 001015   200014 054100                    AOS     I,,AUTO
         1 001016   200012 470500                    LDP0    APO$,,AUTO
         1 001017   000026 236100                    LDQ     22,,PR0
         1 001020   000022 772000                    QRL     18
         1 001021   200014 116100                    CMPQ    I,,AUTO
         1 001022   001006 605400 1                  TPNZ    s:5904

      299     5907    2           B$JIT.PCP = APR$ -> B$P.PPC(0);

   5907  1 001023   200013 471500                    LDP1    APR$,,AUTO
         1 001024   100003 720100                    LXL0    3,,PR1
         1 001025   000000 473400 xsym               LDP3    B$JIT$
         1 001026   300201 740100                    STX0    129,,PR3

      300     5908    2           B$U.APO = 0;                    /* Reset associated processor overlay */

   5908  1 001027   000000 474400 xsym               LDP4    S$CU$
         1 001030   000000 236003                    LDQ     0,DU
         1 001031   400007 752114                    STCQ    7,'14'O,PR4

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:47   
      301     5909    2           NODE$=PINCRW(B$ROSEG.TREE$,SIZEW(B$TREEHDR)

   5909  1 001032   000000 475400 xsym               LDP5    B$ROSEG$
         1 001033   500001 476500                    LDP6    1,,PR5
         1 001034   000023 720100                    LXL0    19,,PR0
         1 001035   000000 636010                    EAQ     0,X0
         1 001036   000022 772000                    QRL     18
         1 001037   000006 402007                    MPY     6,DL
         1 001040   600003 637506                    EPPR7   3,QL,PR6
         1 001041   200020 457500                    STP7    NODE$,,AUTO

      302     5910    2             + APO$ -> B$P.NODE(0)*SIZEW(B$NODE));
      303     5911    2           B$NODE.FLGS.NOW_IN = '0'B;

   5911  1 001042   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 001043   700001 356100                    ANSQ    1,,PR7

      304     5912    2           END;

      305     5913    1      TEMP1 = APR$->B$P.PVA(0)+APR$->B$P.PPC(0)-1;

   5913  1 001044   200013 470500                    LDP0    APR$,,AUTO
         1 001045   000025 236100                    LDQ     21,,PR0
         1 001046   000022 772000                    QRL     18
         1 001047   000003 036100                    ADLQ    3,,PR0
         1 001050   000001 136007                    SBLQ    1,DL
         1 001051   200015 756100                    STQ     TEMP1,,AUTO

      306     5914    1      IF HW_WSQ0PT THEN

   5914  1 001052   000000 234000 xsym               SZN     HW_WSQ0PT
         1 001053   001062 605000 1                  TPL     s:5917

      307     5915    1           B$UPT.RPN(TEMP1) = B$WSQ0PT$->B$MAP.RPN(APR$->B$P.TPP(0));

   5915  1 001054   000023 220100                    LDX0    19,,PR0
         1 001055   000000 471400 xsym               LDP1    B$WSQ0PT$
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:48   
         1 001056   100000 221110                    LDX1    0,X0,PR1
         1 001057   000000 473400 xsym               LDP3    B$UPT$
         1 001060   300000 741106                    STX1    0,QL,PR3
         1 001061   001065 710000 1                  TRA     s:5918

      308     5916    1      ELSE
      309     5917    1           B$UPT.RPN(TEMP1) = APR$ -> B$P.TPP(0);

   5917  1 001062   000023 220100                    LDX0    19,,PR0
         1 001063   000000 471400 xsym               LDP1    B$UPT$
         1 001064   100000 740106                    STX0    0,QL,PR1

      310     5918    1      CALL HFC$ASSOCCLR(%USERWSQ,TEMP1,APO$->B$P.HVA(0)-TEMP1);

   5918  1 001065   200012 471500                    LDP1    APO$,,AUTO
         1 001066   100026 236100                    LDQ     22,,PR1
         1 001067   000022 772000                    QRL     18
         1 001070   200015 136100                    SBLQ    TEMP1,,AUTO
         1 001071   200034 756100                    STQ     PROC$+2,,AUTO
         1 001072   200034 633500                    EPPR3   PROC$+2,,AUTO
         1 001073   200037 453500                    STP3    PROC$+5,,AUTO
         1 001074   200015 634500                    EPPR4   TEMP1,,AUTO
         1 001075   200036 454500                    STP4    PROC$+4,,AUTO
         1 001076   000002 236000 2                  LDQ     2
         1 001077   200035 756100                    STQ     PROC$+3,,AUTO
         1 001100   200035 630500                    EPPR0   PROC$+3,,AUTO
         1 001101   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001102   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 001103   000000 011000                    NOP     0

      311     5919
      312     5920        /* Wait for other users doing overlay  */
      313     5921           %LOCK(G=J_PLOCK);                    /* Lock tables                        */

   5922  1 001104   000000 630400 2                  EPPR0   0
         1 001105   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001106   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:49   
         1 001107   000000 011000                    NOP     0

      314     5924    1      APO$ -> B$P.UC(0) = APO$ -> B$P.UC(0) - 1;

   5924  1 001110   200012 470500                    LDP0    APO$,,AUTO
         1 001111   000001 336007                    LCQ     1,DL
         1 001112   000000 056100                    ASQ     0,,PR0

      315     5925    1      IF APO$ -> B$P.UC(0) = 0             /* Last user                          */

   5925  1 001113   001123 601000 1                  TNZ     s:5930

      316     5926    2      THEN DO;

      317     5927    2           MM$BYP.AUTOP = MM$BYP.AUTOP + APO$ -> B$P.PPC(0);

   5927  1 001114   000000 471400 xsym               LDP1    MM_BYP$
         1 001115   100014 236100                    LDQ     12,,PR1
         1 001116   000003 036100                    ADLQ    3,,PR0
         1 001117   100014 756100                    STQ     12,,PR1

      318     5928    2           MM$BYP.AUTOINUSE = MM$BYP.AUTOINUSE - APO$ -> B$P.PPC(0);

   5928  1 001120   100015 236100                    LDQ     13,,PR1
         1 001121   000003 136100                    SBLQ    3,,PR0
         1 001122   100015 756100                    STQ     13,,PR1

      319     5929    2           END;

      320     5930    1      B$U.APO = 0;

   5930  1 001123   000000 471400 xsym               LDP1    S$CU$
         1 001124   000000 236003                    LDQ     0,DU
         1 001125   100007 752114                    STCQ    7,'14'O,PR1

   5930  1 001126                       DONE_YET     null
      321     5931
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:50   
      322     5932    1   DONE_YET: ;
      323     5933    1      IF ONUM$ -> B$P.UC(0) ~= 0 AND ONUM$ -> B$P.PPC(0) = 0

   5933  1 001126   200011 470500                    LDP0    ONUM$,,AUTO
         1 001127   000000 235100                    LDA     0,,PR0
         1 001130   001155 600000 1                  TZE     s:5945
         1 001131   000003 235100                    LDA     3,,PR0
         1 001132   001155 601000 1                  TNZ     s:5945

      324     5934    2      THEN DO;

      325     5935                %UNLOCK(G=J_PLOCK);

   5936  1 001133   000000 630400 2                  EPPR0   0
         1 001134   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001135   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001136   000000 011000                    NOP     0

      326     5938    2           CALL SSR$REG(%SS_SL,,1);

   5938  1 001137   000001 236000 2                  LDQ     1
         1 001140   200036 756100                    STQ     PROC$+4,,AUTO
         1 001141   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001142   000013 235000 2                  LDA     11
         1 001143   200034 757100                    STAQ    PROC$+2,,AUTO
         1 001144   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 001145   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001146   000000 701000 xent               TSX1    SSR$REG
         1 001147   000000 011000                    NOP     0

      327     5939                %LOCK(G=J_PLOCK);

   5940  1 001150   000000 630400 2                  EPPR0   0
         1 001151   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001152   000000 701000 xent               TSX1    HFC$LOCK
         1 001153   000000 011000                    NOP     0

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:51   
      328     5942    2           GOTO DONE_YET;

   5942  1 001154   001126 710000 1                  TRA     DONE_YET

      329     5943    2           END;
      330     5944
      331     5945    1      IF (NOT (FLAGS & JD_CANCEL)) AND (ONUM$ -> B$P.PPC(0) = 0)

   5945  1 001155   200005 236100                    LDQ     FLAGS,,AUTO
         1 001156   777000 376003                    ANQ     -512,DU
         1 001157   001000 376003                    ANQ     512,DU
         1 001160   001172 601000 1                  TNZ     s:5951
         1 001161   000003 235100                    LDA     3,,PR0
         1 001162   001172 601000 1                  TNZ     s:5951

      332     5946    2      THEN DO;

      333     5947    2           B$U.APO = ONUM;

   5947  1 001163   000000 471400 xsym               LDP1    S$CU$
         1 001164   200010 236100                    LDQ     ONUM,,AUTO
         1 001165   000014 736000                    QLS     12
         1 001166   100007 752114                    STCQ    7,'14'O,PR1

      334     5948    2           CALL INSTALL_OVRLY ALTRET(SEGLD_ERR);

   5948  1 001167   000003 701000 1                  TSX1    INSTALL_OVRLY
         1 001170   001352 702000 1                  TSX2    SEGLD_ERR

      335     5949    2           END;

   5949  1 001171   001340 710000 1                  TRA     RETURN_NODE

      336     5950    2      ELSE DO;

      337     5951    2           IF (NOT (FLAGS & JD_CANCEL))

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:52   
   5951  1 001172   200005 236100                    LDQ     FLAGS,,AUTO
         1 001173   777000 376003                    ANQ     -512,DU
         1 001174   001000 376003                    ANQ     512,DU
         1 001175   001215 601000 1                  TNZ     s:5962

      338     5952    3           THEN DO;

      339     5953    3                ONUM$ -> B$P.UC(0) = ONUM$ -> B$P.UC(0) +1;

   5953  1 001176   000000 054100                    AOS     0,,PR0

      340     5954    3                IF ONUM$ -> B$P.UC(0) = 1

   5954  1 001177   000000 235100                    LDA     0,,PR0
         1 001200   000001 115007                    CMPA    1,DL
         1 001201   001211 601000 1                  TNZ     s:5959

      341     5955    4                THEN DO;

      342     5956    4                     MM$BYP.AUTOP = MM$BYP.AUTOP - ONUM$ -> B$P.PPC(0);

   5956  1 001202   000000 471400 xsym               LDP1    MM_BYP$
         1 001203   100014 236100                    LDQ     12,,PR1
         1 001204   000003 136100                    SBLQ    3,,PR0
         1 001205   100014 756100                    STQ     12,,PR1

      343     5957    4                     MM$BYP.AUTOINUSE = MM$BYP.AUTOINUSE + ONUM$ -> B$P.PPC(0);

   5957  1 001206   100015 236100                    LDQ     13,,PR1
         1 001207   000003 036100                    ADLQ    3,,PR0
         1 001210   100015 756100                    STQ     13,,PR1

      344     5958    4                     END;

      345     5959    3                B$U.APO = ONUM;

   5959  1 001211   000000 471400 xsym               LDP1    S$CU$
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:53   
         1 001212   200010 236100                    LDQ     ONUM,,AUTO
         1 001213   000014 736000                    QLS     12
         1 001214   100007 752114                    STCQ    7,'14'O,PR1

      346     5960    3                END;

      347     5961                %UNLOCK (G=J_PLOCK);

   5962  1 001215   000000 630400 2                  EPPR0   0
         1 001216   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001217   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001220   000000 011000                    NOP     0

      348     5964
      349     5965        /* Access controls will be set by SSR.
      350     5966        */
      351     5967        /* Allocate the necessary data pages for this overlay.             */
      352     5968    2           TEMP1 = ONUM$ -> B$P.DADDR(0);

   5968  1 001221   200011 470500                    LDP0    ONUM$,,AUTO
         1 001222   000024 236100                    LDQ     20,,PR0
         1 001223   000022 772000                    QRL     18
         1 001224   200015 756100                    STQ     TEMP1,,AUTO

      353     5969    2           TEMP2 = ONUM$ -> B$P.DSZ(0);

   5969  1 001225   000024 236100                    LDQ     20,,PR0
         1 001226   777777 376007                    ANQ     -1,DL
         1 001227   200016 756100                    STQ     TEMP2,,AUTO

      354     5970    2           CALL JDU$MEMSET(DATA_TYPE , TEMP1 , TEMP2 ,

   5970  1 001230   200005 631500                    EPPR1   FLAGS,,AUTO
         1 001231   200037 451500                    STP1    PROC$+5,,AUTO
         1 001232   200016 633500                    EPPR3   TEMP2,,AUTO
         1 001233   200036 453500                    STP3    PROC$+4,,AUTO
         1 001234   200015 634500                    EPPR4   TEMP1,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:54   
         1 001235   200035 454500                    STP4    PROC$+3,,AUTO
         1 001236   000014 236000 2                  LDQ     12
         1 001237   200034 756100                    STQ     PROC$+2,,AUTO
         1 001240   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 001241   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 001242   000000 701000 xent               TSX1    JDU$MEMSET
         1 001243   001352 702000 1                  TSX2    SEGLD_ERR

      355     5971    2             FLAGS) ALTRET(SEGLD_ERR);
      356     5972        /* Read in this overlay's data...                                  */
      357     5973    2           IF NOT (FLAGS & JD_CANCEL)

   5973  1 001244   200005 236100                    LDQ     FLAGS,,AUTO
         1 001245   777000 376003                    ANQ     -512,DU
         1 001246   001000 376003                    ANQ     512,DU
         1 001247   001277 601000 1                  TNZ     s:5980

      358     5974    3           THEN DO;

      359     5975    3                I = ONUM$ -> B$P.NODE(0);

   5975  1 001250   200011 470500                    LDP0    ONUM$,,AUTO
         1 001251   000023 236100                    LDQ     19,,PR0
         1 001252   777777 376007                    ANQ     -1,DL
         1 001253   200014 756100                    STQ     I,,AUTO

      360     5976    3                TEMP3 = B$TREEHDR.PRECSIZE;

   5976  1 001254   000000 471400 xsym               LDP1    B$ROSEG$
         1 001255   100001 473500                    LDP3    1,,PR1
         1 001256   300002 236100                    LDQ     2,,PR3
         1 001257   000022 772000                    QRL     18
         1 001260   200017 756100                    STQ     TEMP3,,AUTO

      361     5977    3                CALL JDU$READ_OVRLY(DATA_TYPE , I , TEMP1 , TEMP2 ,

   5977  1 001261   200017 633500                    EPPR3   TEMP3,,AUTO
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:55   
         1 001262   200040 453500                    STP3    PROC$+6,,AUTO
         1 001263   200016 634500                    EPPR4   TEMP2,,AUTO
         1 001264   200037 454500                    STP4    PROC$+5,,AUTO
         1 001265   200015 635500                    EPPR5   TEMP1,,AUTO
         1 001266   200036 455500                    STP5    PROC$+4,,AUTO
         1 001267   200014 636500                    EPPR6   I,,AUTO
         1 001270   200035 456500                    STP6    PROC$+3,,AUTO
         1 001271   000014 236000 2                  LDQ     12
         1 001272   200034 756100                    STQ     PROC$+2,,AUTO
         1 001273   200034 630500                    EPPR0   PROC$+2,,AUTO
         1 001274   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001275   000000 701000 xent               TSX1    JDU$READ_OVRLY
         1 001276   001352 702000 1                  TSX2    SEGLD_ERR

      362     5978    3                  TEMP3 ) ALTRET(SEGLD_ERR);
      363     5979    3                END;

      364     5980    2           IF (FLAGS & JD_CANCEL)

   5980  1 001277   200005 236100                    LDQ     FLAGS,,AUTO
         1 001300   777000 376003                    ANQ     -512,DU
         1 001301   001000 376003                    ANQ     512,DU
         1 001302   001307 600000 1                  TZE     s:5985

      365     5981    3           THEN DO;

      366     5982    3                B$U.APO = 0;

   5982  1 001303   000000 470400 xsym               LDP0    S$CU$
         1 001304   000000 236003                    LDQ     0,DU
         1 001305   000007 752114                    STCQ    7,'14'O,PR0

      367     5983    3                END;

   5983  1 001306   001340 710000 1                  TRA     RETURN_NODE

      368     5984    3           ELSE DO;
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:56   

      369     5985    3                B$U.APO = ONUM;

   5985  1 001307   000000 470400 xsym               LDP0    S$CU$
         1 001310   200010 236100                    LDQ     ONUM,,AUTO
         1 001311   000014 736000                    QLS     12
         1 001312   000007 752114                    STCQ    7,'14'O,PR0

      370     5986    3                NODE$=PINCRW(B$ROSEG.TREE$,SIZEW(B$TREEHDR)

   5986  1 001313   000000 471400 xsym               LDP1    B$ROSEG$
         1 001314   100001 473500                    LDP3    1,,PR1
         1 001315   200011 474500                    LDP4    ONUM$,,AUTO
         1 001316   400023 720100                    LXL0    19,,PR4
         1 001317   000000 636010                    EAQ     0,X0
         1 001320   000022 772000                    QRL     18
         1 001321   000006 402007                    MPY     6,DL
         1 001322   300003 635506                    EPPR5   3,QL,PR3
         1 001323   200020 455500                    STP5    NODE$,,AUTO

      371     5987    3                  + ONUM$ -> B$P.NODE(0)*SIZEW(B$NODE));
      372     5988    3                B$NODE.FLGS.NOW_IN = '1'B;

   5988  1 001324   400000 236003                    LDQ     -131072,DU
         1 001325   500001 256100                    ORSQ    1,,PR5

      373     5989    3                B$JIT.PCP = B$JIT.PCP + ONUM$ -> B$P.PPC(0) - 1;

   5989  1 001326   000000 473400 xsym               LDP3    B$JIT$
         1 001327   300201 236100                    LDQ     129,,PR3
         1 001330   000022 772000                    QRL     18
         1 001331   400003 036100                    ADLQ    3,,PR4
         1 001332   777777 620006                    EAX0    -1,QL
         1 001333   300201 740100                    STX0    129,,PR3

      374     5990    3                CALL SSR$REG(%SS_AP);

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:57   
   5990  1 001334   000016 630400 2                  EPPR0   14
         1 001335   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001336   000000 701000 xent               TSX1    SSR$REG
         1 001337   000000 011000                    NOP     0

      375     5991    3                END;

      376     5992    2           END;

   5988  1 001340                       RETURN_NODE  null
      377     5993    1   RETURN_NODE: ;
      378     5994    1      NODE = ONUM$ -> B$P.NODE(0);

   5994  1 001340   200011 470500                    LDP0    ONUM$,,AUTO
         1 001341   000023 236100                    LDQ     19,,PR0
         1 001342   777777 376007                    ANQ     -1,DL
         1 001343   200003 471500                    LDP1    @NODE,,AUTO
         1 001344   100000 756100                    STQ     0,,PR1

      379     5995    1      ENTRY_ADDR = ONUM$ -> B$P.SA(0);

   5995  1 001345   000026 236100                    LDQ     22,,PR0
         1 001346   777777 376007                    ANQ     -1,DL
         1 001347   200004 473500                    LDP3    @ENTRY_ADDR,,AUTO
         1 001350   300000 756100                    STQ     0,,PR3

      380     5996    1      RETURN;

   5996  1 001351   000000 702200 xent               TSX2  ! X66_ARET

   5995  1 001352                       SEGLD_ERR    null
      381     5997
      382     5998    1   SEGLD_ERR:;
      383     5999    1      ALTRETURN;

   5999  1 001352   000000 702200 xent               TSX2  ! X66_AALT

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:58   
ENOOVRLY
 Sect OctLoc
   0     000   120420 404544                                                    P...

(unnamed)
 Sect OctLoc
   2     000   000000 006000   000003 006000   000012 006000   777777 777700    ................
   2     004   000000 000500   000027 006000   000012 006000   000004 006000    ................
   2     010   777777 000377   757777 777777   000000 000031   000012 006000    ................
   2     014   000002 006000   000000 000043   000015 006000                    .......#....
      384     6000    1   END JDP$SEGLD;

PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:59   
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   JS$CP6V_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   J_ERRSET_C.:E05TOU  is referenced.
   J_ERRORS_C.:E05TOU  is referenced.
   JD_SUBS_C.:E05TOU  is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   MM_MACRO_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   MM$SYSGEN.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   MM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   M$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure JDP$SEGLD.
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:60   

 **** Variables and constants ****

  ****  Section 000 RoData JDP$SEGLD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 ENOOVRLY

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ENTRY_ADDR                3-0-0/w PTR         r     1 @NODE
     7-0-0/w UBIN        r     1 APO                       12-0-0/w PTR         r     1 APO$
     6-0-0/w UBIN        r     1 APR                       13-0-0/w PTR         r     1 APR$
    *0-0-0/w UBIN        r     1 ENTRY_ADDR                30-0-0/w UBIN        r     1 ERR
     5-0-0/w BIT (9)     r     1 FLAGS                     24-0-0/w SBIN        r     1 HIPG
    14-0-0/w SBIN        r     1 I                         25-0-0/w SBIN        r     1 LOPG
    *0-0-0/w UBIN        r     1 NODE                      20-0-0/w PTR         r     1 NODE$
    10-0-0/w SBIN        r     1 ONUM                      11-0-0/w PTR         r     1 ONUM$
    21-0-0/w STRC        r     1 OVENT                     21-0-0/w EPTR        r     1 OVENT$
    31-0-0/w SBIN        r     1 OVERLAP                   32-0-0/w PTR         r     1 PROC$
    26-0-0/w UBIN        r     1 ROOTENDPP                 27-0-0/w UBIN        r     1 ROOTENDVP
    30-0-0/w SBIN        r     1 TEMP                      15-0-0/w SBIN        r     1 TEMP1
    16-0-0/w SBIN        r     1 TEMP2                     17-0-0/w SBIN        r     1 TEMP3

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$IPHYMAP$                 0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$P$                       0-0-0/w PTR         r     1 B$PPUT$
     0-0-0/w PTR         r     1 B$PS0$                     0-0-0/w PTR         r     1 B$PS1$
     0-0-0/w PTR         r     1 B$ROSEG$                   0-0-0/w PTR         r     1 B$SBUF2$
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:61   
     0-0-0/w PTR         r     1 B$UPT$                     0-0-0/w PTR         r     1 B$USERIS$
     0-0-0/w PTR         r     1 B$WSQ0PT$                  0-0-0/w BIT         r     1 HW_WSQ0PT
     0-0-0/d BIT (72)    r     1 J_PLOCK                    0-0-0/w PTR         r     1 MM_BYP$
     0-0-0/b STRC        r     1 MM_FPMC                    0-0-0/w PTR         r     1 S$CU$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC        r     1 B$MAP(0:1023)
     0-0-0/w STRC(216)   r     1 B$NODE                     0-0-0/d STRC(1224)  r     1 B$P(0:0)
     0-0-0/d STRC(3024)  r     1 B$ROSEG                    0-0-0/w STRC(108)   r     1 B$TREEHDR
     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/c ACHR        r     1 CHARS
     0-0-0/d STRC(72)    r     1 FPT$OLAY_V                 0-0-0/w STRC(576)   r     1 MM$BYP
     0-0-0/h UBIN(18)    r     1 MM$IPHY_MAP(0:0)
     0-0-0/w STRC        r     1 MM$PPUT(0:0)
     0-0-0/c ASTR(9)     r     1 TEXTC


   Procedure JDP$SEGLD requires 747 words for executable code.
   Procedure JDP$SEGLD requires 34 words of local(AUTO) storage.

    No errors detected in file JDP$SEGLD.:E05TSI    .
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:62   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:63   
          MINI XREF LISTING

APO
      5543**DCL      5890<<ASSIGN   5891>>ASSIGN   5893>>IF       5896>>IF       5900>>IF
APO$
      5546**DCL      5846>>ASSIGN   5891<<ASSIGN   5903>>DOINDEX  5909>>ASSIGN   5918>>CALL     5924>>ASSIGN
      5924>>ASSIGN   5925>>IF       5927>>ASSIGN   5928>>ASSIGN
APR
      5542**DCL      5872<<ASSIGN   5873>>ASSIGN
APR$
      5547**DCL      5709>>ASSIGN   5709>>ASSIGN   5710>>ASSIGN   5814>>ASSIGN   5873<<ASSIGN   5876>>ASSIGN
      5903>>DOINDEX  5903>>DOINDEX  5907>>ASSIGN   5913>>ASSIGN   5913>>ASSIGN   5915>>ASSIGN   5917>>ASSIGN
B$DO.ECCINFO
      3598**DCL      3599--REDEF
B$IPHYMAP$
      5564**DCL      5785>>ASSIGN   5787>>ASSIGN   5806>>ASSIGN   5807>>ASSIGN
B$JIT.ERR
      4078**DCL      5884<<ASSIGN
B$JIT.ERR.MID
      4079**DCL      4079--REDEF
B$JIT.JRESPEAK
      4169**DCL      4170--REDEF
B$JIT.PCP
      4166**DCL      5716<<ASSIGN   5716>>ASSIGN   5718<<ASSIGN   5718>>ASSIGN   5776<<ASSIGN   5776>>ASSIGN
      5907<<ASSIGN   5989<<ASSIGN   5989>>ASSIGN
B$JIT.PPC
      4168**DCL      5799<<ASSIGN   5799>>ASSIGN
B$JIT$
      5558**DCL      4073--IMP-PTR  5716>>ASSIGN   5716>>ASSIGN   5718>>ASSIGN   5718>>ASSIGN   5776>>ASSIGN
      5776>>ASSIGN   5799>>ASSIGN   5799>>ASSIGN   5884>>ASSIGN   5907>>ASSIGN   5989>>ASSIGN   5989>>ASSIGN
B$MAP
      4375**DCL      5711<<ASSIGN   5904<<ASSIGN
B$MAP.CTRL
      4380**DCL      5715<<ASSIGN   5736<<ASSIGN   5760<<ASSIGN   5767<<ASSIGN   5771<<ASSIGN   5842<<ASSIGN
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:64   
      5905<<ASSIGN
B$MAP.RPN
      4376**DCL      5729>>IF       5732<<ASSIGN   5732>>ASSIGN   5734<<ASSIGN   5744>>IF       5756<<ASSIGN
      5756>>ASSIGN   5758<<ASSIGN   5785>>ASSIGN   5787>>ASSIGN   5790>>ASSIGN   5791>>ASSIGN   5806>>ASSIGN
      5807>>ASSIGN   5810>>ASSIGN   5811>>ASSIGN   5834>>IF       5838<<ASSIGN   5838>>ASSIGN   5840<<ASSIGN
      5915<<ASSIGN   5915>>ASSIGN   5917<<ASSIGN
B$MAP.SCTRL
      4377**DCL      4378--REDEF    5713>>IF       5782<<ASSIGN   5848>>IF
B$NODE
      5592**DCL      5719--ASSIGN   5909--ASSIGN   5986--ASSIGN
B$NODE.DADDR
      5626**DCL      5822>>ASSIGN
B$NODE.DSIZE
      5628**DCL      5823>>ASSIGN
B$NODE.ENTRY$
      5630**DCL      5815>>ASSIGN
B$NODE.FLGS.NOW_IN
      5598**DCL      5911<<ASSIGN   5988<<ASSIGN
B$NODE.PADDR
      5622**DCL      5743>>ASSIGN   5751>>ASSIGN   5778>>ASSIGN
B$NODE.PSIZE
      5624**DCL      5721>>IF       5778>>ASSIGN
B$P
      3675**DCL      5873--ASSIGN   5878--ASSIGN   5891--ASSIGN
B$P.DADDR
      3690**DCL      5822<<ASSIGN   5968>>ASSIGN
B$P.DSZ
      3691**DCL      5823<<ASSIGN   5969>>ASSIGN
B$P.HPP
      3678**DCL      5806<<ASSIGN   5810<<ASSIGN
B$P.HVA
      3694**DCL      5820<<ASSIGN   5846>>ASSIGN   5903>>DOINDEX  5918>>CALL
B$P.INSTDATE
      3681**DCL      5814<<ASSIGN   5814>>ASSIGN
B$P.LNK
      3687**DCL      5876>>ASSIGN   5881>>ASSIGN
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:65   
B$P.NAME
      3699**DCL      5879--IF       5879--IF
B$P.NODE
      3689**DCL      5909>>ASSIGN   5975>>ASSIGN   5986>>ASSIGN   5994>>ASSIGN
B$P.PPC
      3679**DCL      5709>>ASSIGN   5813<<ASSIGN   5903>>DOINDEX  5907>>ASSIGN   5913>>ASSIGN   5927>>ASSIGN
      5928>>ASSIGN   5933>>IF       5945>>IF       5956>>ASSIGN   5957>>ASSIGN   5989>>ASSIGN
B$P.PVA
      3692**DCL      5709>>ASSIGN   5819<<ASSIGN   5903>>DOINDEX  5913>>ASSIGN
B$P.SA
      3695**DCL      5816<<ASSIGN   5995>>ASSIGN
B$P.TPP
      3688**DCL      5710>>ASSIGN   5807<<ASSIGN   5811<<ASSIGN   5915>>ASSIGN   5917>>ASSIGN
B$P.UC
      3676**DCL      5705<<ASSIGN   5705>>ASSIGN   5726<<ASSIGN   5726>>ASSIGN   5831<<ASSIGN   5831>>ASSIGN
      5855<<ASSIGN   5924<<ASSIGN   5924>>ASSIGN   5925>>IF       5933>>IF       5953<<ASSIGN   5953>>ASSIGN
      5954>>IF
B$P$
      3729**DCL      5873>>ASSIGN   5878>>ASSIGN   5891>>ASSIGN
B$PPUT$ IN PROCEDURE INSTALL_OVRLY
      5697**DCL      5787>>ASSIGN   5791>>ASSIGN   5793>>ASSIGN   5794>>ASSIGN   5795>>ASSIGN   5797>>ASSIGN
B$PS0$
      5559**DCL      5879>>IF       5879>>IF
B$PS1$
      5560**DCL      5871>>ASSIGN
B$ROSEG.TREE$
      4283**DCL      5719>>ASSIGN   5719>>ASSIGN   5909>>ASSIGN   5909>>ASSIGN   5976>>ASSIGN   5986>>ASSIGN
      5986>>ASSIGN
B$ROSEG$
      5561**DCL      5719>>ASSIGN   5719>>ASSIGN   5909>>ASSIGN   5909>>ASSIGN   5976>>ASSIGN   5986>>ASSIGN
      5986>>ASSIGN
B$SBUF2$ IN PROCEDURE INSTALL_OVRLY
      5695**DCL      5769>>ASSIGN
B$TREEHDR
      5576**DCL      5719--ASSIGN   5909--ASSIGN   5986--ASSIGN
B$TREEHDR.PRECSIZE
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:66   
      5586**DCL      5976>>ASSIGN
B$U.APO
      3558**DCL      5728<<ASSIGN   5830<<ASSIGN   5890>>ASSIGN   5908<<ASSIGN   5930<<ASSIGN   5947<<ASSIGN
      5959<<ASSIGN   5982<<ASSIGN   5985<<ASSIGN
B$U.APR
      3557**DCL      5872>>ASSIGN
B$U.MISC
      3577**DCL      3578--REDEF
B$U.PCT
      3561**DCL      5800<<ASSIGN   5800>>ASSIGN
B$UPT$
      5562**DCL      5711>>ASSIGN   5713>>IF       5715>>ASSIGN   5729>>IF       5732>>ASSIGN   5734>>ASSIGN
      5736>>ASSIGN   5744>>IF       5756>>ASSIGN   5758>>ASSIGN   5760>>ASSIGN   5767>>ASSIGN   5771>>ASSIGN
      5782>>ASSIGN   5785>>ASSIGN   5787>>ASSIGN   5790>>ASSIGN   5791>>ASSIGN   5806>>ASSIGN   5807>>ASSIGN
      5810>>ASSIGN   5811>>ASSIGN   5834>>IF       5838>>ASSIGN   5840>>ASSIGN   5842>>ASSIGN   5848>>IF
      5904>>ASSIGN   5905>>ASSIGN   5915>>ASSIGN   5917>>ASSIGN
B$USER.MISC
      3653**DCL      3654--REDEF
B$USERIS$ IN PROCEDURE INSTALL_OVRLY
      5696**DCL      5765>>ASSIGN
B$WSQ0PT$
      5563**DCL      5732>>ASSIGN   5756>>ASSIGN   5838>>ASSIGN   5915>>ASSIGN
CHARS IN PROCEDURE INSTALL_OVRLY
      5693**DCL      5769<<ASSIGN   5769>>ASSIGN
DONE_YET
      5930**LABEL    5942--GOTO
ENOOVRLY
      5651**DCL      5884>>ASSIGN
ENTRY_ADDR
        15**DCL        12--PROC     5717<>CALL     5995<<ASSIGN
ERR IN PROCEDURE INSTALL_OVRLY
      5690**DCL      5691--REDEF    5730<>CALL     5730<>CALL     5754<>CALL     5754<>CALL     5764<>CALL
      5773<>CALL     5836<>CALL     5836<>CALL     5850<>CALL     5850<>CALL
FLAGS
      5540**DCL      5717<>CALL     5871<<ASSIGN   5892>>IF       5945>>IF       5951>>IF       5970<>CALL
      5973>>IF       5980>>IF
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:67   
FOUND
      5884**LABEL    5880--GOTO
FPT$OLAY_V.FLGS
      5538**DCL      5871>>ASSIGN
HFC$ASSOCCLR
      5568**DCL-ENT  5712--CALL     5918--CALL
HFC$LOCK
      5077**DCL-ENT  5724--CALL     5803--CALL     5922--CALL     5940--CALL
HFC$UNLOCK
      5077**DCL-ENT  5707--CALL     5739--CALL     5825--CALL     5936--CALL     5962--CALL
HIPG IN PROCEDURE INSTALL_OVRLY
      5686**DCL      5778<<ASSIGN   5780>>DOINDEX  5786>>IF       5798>>ASSIGN   5807>>ASSIGN   5811>>ASSIGN
      5820>>ASSIGN   5846<<ASSIGN   5847>>DOINDEX
HW_WSQ0PT
      5116**DCL      5731>>IF       5755>>IF       5784>>IF       5805>>IF       5837>>IF       5914>>IF
I
      5548**DCL      5780<<DOINDEX  5782>>ASSIGN   5785>>ASSIGN   5786>>IF       5787>>ASSIGN   5790>>ASSIGN
      5791>>ASSIGN   5847<<DOINDEX  5848>>IF       5850<>CALL     5903<<DOINDEX  5904>>ASSIGN   5905>>ASSIGN
      5975<<ASSIGN   5977<>CALL
INSTALL_ERR IN PROCEDURE INSTALL_OVRLY
      5823**LABEL    5717--CALLALT
INSTALL_OVRLY
      5683**PROC     5948--CALL
JDS$OVRLY
      5569**DCL-ENT  5717--CALL
JDU$MEMSET
      5570**DCL-ENT  5970--CALL
JDU$READ_OVRLY
      5571**DCL-ENT  5977--CALL
JD_SUA IN PROCEDURE INSTALL_OVRLY
      5855**LABEL    5730--CALLALT  5754--CALLALT  5764--CALLALT  5773--CALLALT  5836--CALLALT  5850--CALLALT
J_PLOCK
      5566**DCL      5707<>CALL     5724<>CALL     5739<>CALL     5803<>CALL     5825<>CALL     5922<>CALL
      5936<>CALL     5940<>CALL     5962<>CALL
LOPG IN PROCEDURE INSTALL_OVRLY
      5687**DCL      5743<<ASSIGN   5744>>IF       5765>>ASSIGN   5767>>ASSIGN   5771>>ASSIGN   5780>>DOINDEX
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:68   
      5798>>ASSIGN   5806>>ASSIGN   5810>>ASSIGN   5819>>ASSIGN
MM$BYP.AUTOINUSE
      4826**DCL      5818<<ASSIGN   5818>>ASSIGN   5928<<ASSIGN   5928>>ASSIGN   5957<<ASSIGN   5957>>ASSIGN
MM$BYP.AUTOP
      4826**DCL      5927<<ASSIGN   5927>>ASSIGN   5956<<ASSIGN   5956>>ASSIGN
MM$DESC.BOUND
      4904**DCL      4905--REDEF
MM$DESC.FLGS
      4905**DCL      4905--REDEF
MM$IPHY_MAP
      4431**DCL      5785>>ASSIGN   5787>>ASSIGN   5806>>ASSIGN   5807>>ASSIGN
MM$PPUT.PNUM
      4893**DCL      5795<<ASSIGN
MM$PPUT.PPNO
      4893**DCL      5787<<ASSIGN   5791<<ASSIGN   5797<<ASSIGN
MM$PPUT.PRC
      4892**DCL      5794<<ASSIGN
MM$PPUT.USER
      4892**DCL      5793<<ASSIGN
MM$PPUT.USER#
      4893**DCL      4893--REDEF
MME$CVM IN PROCEDURE INSTALL_OVRLY
      5699**DCL-ENT  5764--CALL     5773--CALL
MME$WFVP IN PROCEDURE INSTALL_OVRLY
      5700**DCL-ENT  5730--CALL     5754--CALL     5836--CALL     5850--CALL
MM_BYP$
      4824**DCL      4824--IMP-PTR  5818>>ASSIGN   5818>>ASSIGN   5927>>ASSIGN   5927>>ASSIGN   5928>>ASSIGN
      5928>>ASSIGN   5956>>ASSIGN   5956>>ASSIGN   5957>>ASSIGN   5957>>ASSIGN
MM_FPMC
      4830**DCL      5711>>ASSIGN   5904>>ASSIGN
MM_FPMC.RPN
      4830**DCL      5729>>IF       5834>>IF
NODE
        14**DCL        12--PROC     5717<>CALL     5719>>ASSIGN   5994<<ASSIGN
NODE$
      5552**DCL      5719<<ASSIGN   5719>>ASSIGN   5721>>IF       5743>>ASSIGN   5751>>ASSIGN   5778>>ASSIGN
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:69   
      5778>>ASSIGN   5815>>ASSIGN   5822>>ASSIGN   5823>>ASSIGN   5909<<ASSIGN   5909>>ASSIGN   5911>>ASSIGN
      5986<<ASSIGN   5986>>ASSIGN   5988>>ASSIGN
ONUM
      5544**DCL      5727<<ASSIGN   5795>>ASSIGN   5876<<ASSIGN   5877>>DOWHILE  5878>>ASSIGN   5881<<ASSIGN
      5893>>IF       5896>>IF       5947>>ASSIGN   5959>>ASSIGN   5985>>ASSIGN
ONUM$
      5545**DCL      5705>>ASSIGN   5705>>ASSIGN   5726>>ASSIGN   5726>>ASSIGN   5806>>ASSIGN   5807>>ASSIGN
      5810>>ASSIGN   5811>>ASSIGN   5813>>ASSIGN   5814>>ASSIGN   5816>>ASSIGN   5819>>ASSIGN   5820>>ASSIGN
      5822>>ASSIGN   5823>>ASSIGN   5831>>ASSIGN   5831>>ASSIGN   5855>>ASSIGN   5878<<ASSIGN   5879>>IF
      5879>>IF       5881>>ASSIGN   5933>>IF       5933>>IF       5945>>IF       5953>>ASSIGN   5953>>ASSIGN
      5954>>IF       5956>>ASSIGN   5957>>ASSIGN   5968>>ASSIGN   5969>>ASSIGN   5975>>ASSIGN   5986>>ASSIGN
      5989>>ASSIGN   5994>>ASSIGN   5995>>ASSIGN
OVENT.ADDRESS
      5555**DCL      5816>>ASSIGN
OVENT$
      5553**DCL      5554--REDEF    5815<<ASSIGN
OVERLAP IN PROCEDURE INSTALL_OVRLY
      5692**DCL      5693--IMP-SIZ  5751<<ASSIGN   5752>>IF       5769>>ASSIGN   5769>>ASSIGN
PROC$ IN PROCEDURE INSTALL_OVRLY
      5694**DCL      5765<<ASSIGN   5769>>ASSIGN
RETURN_NODE
      5988**LABEL    5897--GOTO
ROOTENDPP IN PROCEDURE INSTALL_OVRLY
      5688**DCL      5710<<ASSIGN   5732>>ASSIGN   5734>>ASSIGN   5756>>ASSIGN   5758>>ASSIGN   5764<>CALL
      5838>>ASSIGN   5840>>ASSIGN
ROOTENDVP IN PROCEDURE INSTALL_OVRLY
      5689**DCL      5709<<ASSIGN   5711>>ASSIGN   5712<>CALL     5713>>IF       5715>>ASSIGN   5729>>IF
      5730<>CALL     5732>>ASSIGN   5734>>ASSIGN   5736>>ASSIGN   5754<>CALL     5756>>ASSIGN   5758>>ASSIGN
      5760>>ASSIGN   5834>>IF       5836<>CALL     5838>>ASSIGN   5840>>ASSIGN   5842>>ASSIGN   5847>>DOINDEX
S$CU$
      3664**DCL      5728>>ASSIGN   5800>>ASSIGN   5800>>ASSIGN   5830>>ASSIGN   5872>>ASSIGN   5890>>ASSIGN
      5908>>ASSIGN   5930>>ASSIGN   5947>>ASSIGN   5959>>ASSIGN   5982>>ASSIGN   5985>>ASSIGN
SC_SEGLD IN PROCEDURE INSTALL_OVRLY
      5701**DCL-ENT  5714--CALL     5746--CALL     5859--CALL
SEGLD_ERR
      5995**LABEL    5948--CALLALT  5970--CALLALT  5977--CALLALT
PL6.E3A0      #001=JDP$SEGLD File=JDP$SEGLD.:E05TSI                              TUE 07/29/97 23:21 Page:70   
SSR$REG
      5572**DCL-ENT  5938--CALL     5990--CALL
TEMP IN PROCEDURE INSTALL_OVRLY
      5691**DCL      5798<<ASSIGN   5799>>ASSIGN   5800>>ASSIGN   5813>>ASSIGN   5818>>ASSIGN
TEMP1
      5549**DCL      5785<<ASSIGN   5787>>ASSIGN   5790<<ASSIGN   5791>>ASSIGN   5793>>ASSIGN   5794>>ASSIGN
      5795>>ASSIGN   5797>>ASSIGN   5913<<ASSIGN   5915>>ASSIGN   5917>>ASSIGN   5918<>CALL     5918>>CALL
      5968<<ASSIGN   5970<>CALL     5977<>CALL
TEMP2
      5550**DCL      5969<<ASSIGN   5970<>CALL     5977<>CALL
TEMP3
      5551**DCL      5976<<ASSIGN   5977<>CALL
TEXTC.SIZ
      5661**DCL      5662--IMP-SIZ  5879>>IF       5879>>IF
TEXTC.TEXT
      5662**DCL      5879>>IF       5879>>IF
