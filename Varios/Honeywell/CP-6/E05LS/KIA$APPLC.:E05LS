VERSION E05

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:1    
        1        1        /*M* KIA$APPLC - Application layer service routines*/
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8
        9        9        /*P*
       10       10             NAME: KIA$APPLC
       11       11             PURPOSE:
       12       12                  The module contains the routines that are the application and
       13       13                  presentation layers of the network.
       14       14             DESCRIPTION:
       15       15                  None.
       16       16        */
       17       17        KIA$UCIOND: PROC (FCN,DVBYTE,VFC,EVENT,BUF$,BUFLEN,NDLDCT) ALTRET;
       18       18
       19       19        /*F*
       20       20              NAME:        KIA$UCIOND
       21       21              PURPOSE:     To interface with TS terminals with an LDCT$ instead of a DCB
       22       22              INPUT:       FCN - read, write, etc.
       23       23                           DVBYTE
       24       24                           VFC
       25       25                           EVENT
       26       26                           BUF$ - Pointer to the caller's buffer
       27       27                           BUFLEN - Byte length of the caller's buffer
       28       28                           NDLDCT - The caller's LDCT
       29       29              OUTPUT:      Caller's buffer may be filled in if write
       30       30                           DVBYTE
       31       31                           EOMCHAR is passed back in VFC parameter
       32       32                           TYC is passed back in EVENT parameter
       33       33                           ARS is passed back in BUFLEN parameter
       34       34              DESCRIPTION: KIA$UCIOND is called passing an LDCT instead of
       35       35                           JIT.DCB$. LDCT, MSGSZ, and UB$ are passed as parameters
       36       36                           instead of via JIT.DCB$. Also DVBYTE, EOMCHAR, TYC
       37       37                           and ARS are passed back as parameters instead of in
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:2    
       38       38                           JIT.DCB$.                                                 */
       39       39        %PLIST;
       40       40        %INCLUDE B$ROSEG;
       41      103        %INCLUDE B_STRINGS_C;
       42      232        %INCLUDE F$CP6V_C;
       43      458        %INCLUDE NK_LDCT_R;
       44      467        %INCLUDE B$TABLES_C;
       45      575        %B$XL_UR;
       46      579        %B$XL_UPPER_UR;
       47      583        %INCLUDE KI_DATA_R;
       48      609        %INCLUDE B$USER;
       49      825        %B$USERREFS;
       50      829        %INCLUDE B$JIT_C;
       51     1143        %B$JIT0;
       52     1232        %U$JIT1;
       53     1306        %M$JIT2X;
       54     1309        %F$JIT3;
       55     1314        %S$JIT4X;
       56     1317        %J$JIT5;
       57     1405        %A$JIT6;
       58     1415        %INCLUDE NK$LDCT;
       59     1517        %INCLUDE F$DCB;
       60     1566        %INCLUDE KI$MHDR;
       61     1707        %INCLUDE KV$VDO;
       62     2722        %INCLUDE KI$CP6V_C;
       63     3161        %INCLUDE KV_GLBCNS_E;
       64     3502        %INCLUDE KV_PRMID_E;
       65     3676        %INCLUDE HF_LOCK_C;
       66     3690        %INCLUDE F_FPTCODE_C;
       67     3726        %INCLUDE CP_6_SUBS;
       68     4266        %INCLUDE SS_SCHED_C;
       69     4499        %INCLUDE NK_SUBS;
       70     4524        %INCLUDE KI_SUBS_C;
       71     4660        %INCLUDE K_SUBS_C;
       72     4693        %INCLUDE K_DATA_R;
       73     5404
       74     5405        %NK$LDCT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:3    
       75     5451        %K$RWPARM (STCLASS="",NAME=K$RWPARM);
       76     5767        %KV_PRMID_E;
       77     5923        %KV_VDO_ALL_E;
       78     6002        %KV#VD_ORG_E;
       79     6010        %FPT$READ_V;
       80     6017        %FPT$WRITE_V;
       81     6023    1   DCL USRKEY CHAR(USRKEYSZ) BASED;
       82     6024    1   DCL KEY CHAR(K$RWPARM.KEYSZ) BASED;
       83     6025    1   DCL USRKEYSZ UBIN;
       84     6026    1   DCL 1 FEPSIZ REDEF USRKEYSZ,
       85     6027    1            2 BUF UBIN(18) UNAL,
       86     6028    1            2 KEY UBIN(18) UNAL;
       87     6029    1   DCL DCB_FCN_CNT0 REDEF USRKEYSZ UBIN;
       88     6030    1   DCL 1 NOWAIT,
       89     6031    1            2 KEYTYP UBIN(6) UNAL,
       90     6032    1            2 DMN UBIN(3) UNAL,
       91     6033    1            2 STREAM UBIN(9) UNAL,
       92     6034    1            2 DCB# UBIN(9) UNAL,
       93     6035    1            2 * UBIN(9) UNAL;
       94     6036    1   DCL 1 FEPIO,
       95     6037    1            2 EVENT SBIN,
       96     6038    1            2 KEYX SBIN(18) UNAL,
       97     6039    1            2 BUFX SBIN(18) UNAL,
       98     6040    1            2 BPP(0:1) BIT(18) UNAL,
       99     6041    1            2 KPP(0:1) BIT(18) UNAL;
      100     6042    1   DCL 1 PTW(0:1),
      101     6043    1            2 PP BIT(18) ALIGNED;
      102     6044    1   DCL FPT$ PTR;
      103     6045        %KV$VDO_PRM (STCLASS="BASED(K$RWPARM.UHDR$)");
      104     6086        %KV$VDO_DAT (STCLASS="BASED(K$RWPARM.UHDR$)");
      105     6131        %KV$VDO_RQSDAT (STCLASS="BASED(K$RWPARM.UHDR$)");
      106     6179        %KV$VDO_RQSPRM (STCLASS="BASED(K$RWPARM.UHDR$)");
      107     6222        %KI$QMHDR;
      108     6271        %KV$VDOVLP_DAT1;
      109     6321        %KV$VDOVLP_DAT2;
      110     6371        %KV$VDOVLP_MRK;
      111     6424        %KV$VDO_MRK (NAME=KV$VDO_MRKRSP,STCLASS="BASED(K$RWPARM.UHDR$)",LAST=",");
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:4    
      112     6465        %KV$VDOVLP_MRK (NAME=MRKR,LVL=2);
      113     6518        %VLP$WINDOW_V;
      114     6540        %VLP$WINDOW_V(FPTN=WINDOW,ALGN=CALIGNED);
      115     6562        %K$RWPARM (NAME=KI$RWPARM,STCLASS=BASED);
      116     6878
      117     6879        /* Symrefs */
      118     6880
      119     6881    1   DCL FCN UBIN WORD;
      120     6882    1   DCL FCN1 UBIN WORD;
      121     6883    1   DCL DVBYTE BIT(9) CALIGNED;
      122     6884    1   DCL TFCN REDEF DVBYTE UBIN(9) CALIGNED;
      123     6885    1   DCL DVBYTE1 BIT(9);
      124     6886    1   DCL VFC CHAR(1) UNAL;
      125     6887    1   DCL EOMCHAR REDEF VFC CHAR(1);
      126     6888    1   DCL PCODE REDEF VFC UBIN BYTE UNAL;
      127     6889    1   DCL 1 SPREAD BASED UNAL ,
      128     6890    1            2 HI UBIN(10) UNAL ,
      129     6891    1            2 LO8 UBIN(8) UNAL ;
      130     6892    1   DCL EVENT UBIN WORD;
      131     6893    1   DCL TYC REDEF EVENT BIT(36);
      132     6894    1   DCL BUF$ PTR;
      133     6895    1   DCL BUFLEN UBIN;
      134     6896    1   DCL NDLDCT UBIN;    /* Actually an LDCT, but its address is copied to LDCT$ */
      135     6897    1   DCL ENTFLG UBIN;
      136     6898        %EQU DCB#=0;
      137     6899        %EQU NODCB#=1;
      138     6900    1   DCL MSG$ PTR;
      139     6901    1   DCL TDVB BIT(36) ALIGNED;
      140     6902    1   DCL MSGSZ UBIN WORD;
      141     6903    1   DCL 1 MSZ REDEF MSGSZ,
      142     6904        %INCLUDE UM_CP6;
      143     7756    1            2 TOP UBIN(28) UNAL,
      144     7757    1            2 BOT UBIN(8) UNAL;
      145     7758    1   DCL DCB$ PTR;
      146     7759    1   DCL LDCT$ PTR;
      147     7760    1   DCL PFCN UBIN WORD;
      148     7761    1   DCL B$CGCTXT$ PTR SYMREF READONLY;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:5    
      149     7762    1   DCL B$JIT$ PTR SYMREF READONLY;
      150     7763    1   DCL B$PS1$ PTR SYMREF READONLY;
      151     7764    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      152     7765    1   DCL B$M$UC$ PTR SYMREF READONLY;
      153     7766    1   DCL KIA_TCTLMAX SBIN CONSTANT SYMDEF INIT(16);
      154     7767    1   DCL NI_MFGATE BIT(72) SYMREF;
      155     7768    1   DCL PFB UBIN WORD;
      156     7769    1   DCL MSGSZT REDEF PFB UBIN WORD;
      157     7770    1   DCL 1 MSZT REDEF PFB,
      158     7771    1            2 T UBIN(28) UNAL,
      159     7772    1            2 B UBIN(8) UNAL;
      160     7773    1   DCL VCHRM CHAR(MSGSZ) BASED CALIGNED;
      161     7774    1   DCL STR UBIN BASED;
      162     7775    1   DCL STRID UBIN BASED;
      163     7776    1   DCL DLTSTR BIT(1) BASED;
      164     7777    1   DCL NEWSSN BIT(1) BASED;
      165     7778    1   DCL RPTR$ PTR;
      166     7779    1   DCL WINDOW$ PTR BASED;
      167     7780    1   DCL 1 VSIN ,
      168     7781    1            2 PFB UBIN BYTE CALIGNED,
      169     7782    1            2 RFU UBIN BYTE CALIGNED,
      170     7783    1            2 POS UBIN(18) CALIGNED,
      171     7784    1            2 POSL6 REDEF POS,
      172     7785    1                 3 T BIT(9), 3 * BIT(9),
      173     7786    1            2 POSL66 REDEF POS,
      174     7787    1                 3 T BIT(10), 3 * BIT(8);
      175     7788
      176     7789        /* Entry point references */
      177     7790    1   DCL FMO$GETDOMAIN ENTRY(1);
      178     7791    1   DCL KIA$COMP ENTRY(2);
      179     7792    1   DCL FSN$CONV_STR ENTRY(2) ALTRET;
      180     7793    1   DCL KIQ$MAPFEP ENTRY(1);
      181     7794    1   DCL KIA$9TO8 ENTRY(3);
      182     7795    1   DCL KIA$FCNOU ENTRY(3) ALTRET;
      183     7796    1   DCL KIA$OQFL ENTRY(1) ALTRET;
      184     7797    1   DCL KIA$MSG ENTRY(1) ALTRET;
      185     7798    1   DCL KIA$WRITE_USER ENTRY(2) ALTRET;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:6    
      186     7799    1   DCL KIS$SEND ENTRY(1) ALTRET;
      187     7800    1   DCL SSR$REG ENTRY(3) ALTRET;
      188     7801    1   DCL HFF$DSIZ ENTRY(2);
      189     7802    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      190     7803    1   DCL HFF$TRAPALT ENTRY ALTRET;
      191     7804    1   DCL HFF$WRITE1 ENTRY(1) ALTRET;
      192     7805    1   DCL MMS$SETUP_BUF ENTRY(5) ALTRET;
      193     7806    1   DCL NKA$EVENT ENTRY(2);
      194     7807    1   DCL UMD$DIN ENTRY(1) ALTRET;
      195     7808    1   DCL UMD$DPMT ENTRY ALTRET;
      196     7809    1   DCL UMD$DOU ENTRY(2) ALTRET;
      197     7810
      198     7811    1   DCL SC_NTSDCTI ENTRY CONV(2,0);
      199     7812    1   DCL SC_NTSLCL ENTRY CONV(2,0);
      200     7813    1   DCL SC_BTSFCN ENTRY CONV(2,0);
      201     7814    1   DCL SC_ICQLST ENTRY CONV(2,0);
      202     7815
      203     7816        %INCLUDE KI_ERRORS_C;
      204     7901        %INCLUDE KV_ERRORS_C;
      205     7961        %INCLUDE F_ERRORS_C;
      206     8201        %INCLUDE UD_SEV_C;
      207     8215        %MACRO ERRCODE( NAME=ERRDUMMY, CODE=0, STC=CONSTANT, SL=SEV_CONT#);
      208     8216            %VLP_ERRCODE( FPTN=NAME, STCLASS=STC, FCG='KI', MID='A',
      209     8217                          MON='1'B, ERR#=CODE, SEV=SL);
      210     8218        %MEND;
      211     8219            %ERRCODE( NAME=BADFMT, CODE=%E$BADFMT, SL=SEV_ABORT#);
      212     8267            %ERRCODE( NAME=BYD, CODE=%E$BYD);
      213     8315            %ERRCODE( NAME=BYDR, CODE=%E$BYDR);
      214     8363            %ERRCODE( NAME=DELRECER, CODE=%E$RECORD_DELETED, SL=0);
      215     8411            %ERRCODE( NAME=EOFERR, CODE=%E$EOF, SL=0);
      216     8459            %ERRCODE( NAME=KIA_NODAT, CODE=%E$NODAT, STC="CONSTANT SYMDEF");
      217     8507            %ERRCODE( NAME=LDSC, CODE=%E$LDSC, SL=SEV_ABORT#);
      218     8555            %ERRCODE( NAME=MTRAPERR, CODE=%E$MTRAP, SL=7);
      219     8603            %ERRCODE( NAME=NOFPRG, CODE=%E$NOFPRG, SL=SEV_ABORT#);
      220     8651            %ERRCODE( NAME=NORES, CODE=%E$NOFEPRES, SL=SEV_ABORT#);
      221     8699            %ERRCODE( NAME=XTRARD, CODE=%E$XTRARD);
      222     8747        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:7    
      223     8748    1        ENTFLG=%NODCB#;
      224     8749    1        DCB$=ADDR(NIL);               /* So we trap if I screwed up coding this */
      225     8750    1        FPT$ = ADDR(NIL);
      226     8751    1        LDCT$=ADDR(NDLDCT);
      227     8752    1        MSGSZ=BUFLEN;
      228     8753    1        MSG$=BUF$;
      229     8754    1        PFB = KIDM_MON;
      230     8755    1        IF LDCT$->NK$LDCT.RESCOD=NK_RES
      231     8756    1        THEN PFB = KIDM_CP;
      232     8757    1        GOTO CMN;
      233     8758
      234     8759
      235     8760        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:8    
      236     8761    1   KIA$UCIOD: ENTRY (FCN,DVBYTE,VFC,EVENT) ALTRET;
      237     8762
      238     8763        /*F*
      239     8764             NAME: KIA$UCIOD
      240     8765             PURPOSE:
      241     8766                  This routine is the read and write interface for TS terminals.
      242     8767             DESCRIPTION:
      243     8768                  KIA$UCIOD is called from FSE$FORMAT whenever there is a write
      244     8769                  or read to a time sharing terminal It is also called from
      245     8770                  KIP$PMME when a terminal control function needs to be performed.
      246     8771        */
      247     8772
      248     8773    1   KIA$UCIO: ENTRY (FCN,DVBYTE,VFC,EVENT,BUF$) ALTRET;
      249     8774    1        IF ADDR(BUF$)=ADDR(NIL) THEN
      250     8775    1             FPT$=ADDR(NIL);
      251     8776    1        ELSE
      252     8777    1             FPT$=BUF$;
      253     8778
      254     8779    1        ENTFLG=%DCB#;
      255     8780    1        DCB$=B$JIT$->B$JIT.DCB$;
      256     8781    1        IF DCB$->F$DCB.IASN = %STREAM#
      257     8782    1        THEN
      258     8783    1             LDCT$ = NK$LDCT$(DCB$->F$DCB.CFU$->F$DCB.LDCTX);
      259     8784    1        ELSE
      260     8785    1             LDCT$=NK$LDCT$(DCB$->F$DCB.LDCTX);
      261     8786    1        MSGSZ=DCB$->F$DCB.UBYTES;
      262     8787    1        MSG$=DCB$->F$DCB.UB$;
      263     8788    1        PFB = DCB$->F$DCB.STR;
      264     8789
      265     8790
      266     8791        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:9    
      267     8792    1   CMN: ;
      268     8793    1        IF LDCT$=ADDR(NIL)
      269     8794    1        THEN
      270     8795    1             CALL SC_NTSDCTI;
      271     8796        /*S*  SCREECH_CODE:  KIA-S$NTSDCT
      272     8797              TYPE:          SUA
      273     8798              MESSAGE:       LDCT for timesharing users terminal lost (during I/O)
      274     8799              REMARKS:       This SUA occurs when LDCTX in a timesharing user's
      275     8800                             M$UC DCB does not point to a valid LDCT entry.  This
      276     8801                             suggests that either the DCB is clobbered or KIA$UCIO
      277     8802                             has been incorrectly called.  The same screech code
      278     8803                             is reported by NKU$UCCLS (NKU-S$NTSDCT) when it
      279     8804                             detects the same problem.                               */
      280     8805
      281     8806        /* If there is a marker pending a break, control Y or disconnect
      282     8807             has come in.  If B$U.ASYNC not reset then return with back IC
      283     8808             set otherwise just send the marker.
      284     8809         */
      285     8810             %LOCK (G=LDCT$->NK$LDCT.LOCK);
      286     8813    1        IF LDCT$->LDCT.DFLG.FEDN
      287     8814    2        THEN DO;
      288     8815    2   DISC:     ;
      289     8816    2             B$JIT.ERR=LDSC;
      290     8817        /*E*  ERROR:         KIA-E$LDSC-A
      291     8818               MESSAGE: Your timesharing line %thru %DC %is disconnected!
      292     8819              DESCRIPTION:   Only logoff should see this error JIT.BAKIC would
      293     8820                             loop.                                                   */
      294     8821                  %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      295     8824    2             ALTRETURN;
      296     8825    2           END;
      297     8826    1        IF S$CU$->B$U.ASYNCH&%(~U_RESET) AND ENTFLG = %DCB#
      298     8827    1             AND NOT S$CU$->B$U.FLG&%U_STIP
      299     8828    2        THEN DO;
      300     8829                  %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      301     8832    2             B$JIT$->B$JIT.ERR = BYD;
      302     8833    2             B$JIT$->B$JIT.JUNK = B$JIT$->B$JIT.JUNK | %JJ_BAKIC#;
      303     8834    2             ALTRETURN;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:10   
      304     8835    2           END;
      305     8836
      306     8837    1        IF LDCT$->LDCT.LKFLG.MRKPND
      307     8838    2        THEN DO;
      308     8839    2             K$RWPARM = K_RWPARM_CON;
      309     8840    2             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_MRK;
      310     8841    2             K$RWPARM.MARKER = LDCT$->LDCT.MARKER;
      311     8842    2             CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_MRK,K$RWPARM) ALTRET(BRKOUT);
      312     8843    2             LDCT$->LDCT.LKFLG.MRKPND = '0'B;
      313     8844    2           END;
      314     8845
      315     8846             %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      316     8849
      317     8850
      318     8851
      319     8852    1   RESTART:
      320     8853    1        K$RWPARM = K_RWPARM_CON;
      321     8854    1        DVBYTE1 = DVBYTE;
      322     8855    1        K$RWPARM.DVE.DVBYTE = DVBYTE1;
      323     8856    1        K$RWPARM.DVE.VFC = VFC;
      324     8857    1        K$RWPARM.STR = PFB;
      325     8858    1        IF FPT$ ~= ADDR(NIL)
      326     8859    1        THEN
      327     8860    1             IF DCB$->F$DCB.ORG=%SE# OR FPT$->FPT$WRITE_V.KEYTYPE = 0
      328     8861    1             THEN
      329     8862    1                  K$RWPARM.KEYTYPE = DCB$->F$DCB.KEYTYPE;
      330     8863    1             ELSE
      331     8864    1                  K$RWPARM.KEYTYPE = FPT$->FPT$WRITE_V.KEYTYPE;
      332     8865    1        IF MSGSZ<=4096
      333     8866    1        THEN
      334     8867    1             K$RWPARM.TYC='0'B;
      335     8868    2        ELSE DO;
      336     8869    2             MSGSZ=4096;
      337     8870    2             K$RWPARM.TYC=%TYC_LD|%TYC_EGV;
      338     8871    2           END;
      339     8872    1        K$RWPARM.MAXNMBBYT = MSGSZ + 40;
      340     8873    1        K$RWPARM.MAXRCRBYTSIZ = MSGSZ;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:11   
      341     8874    1        K$RWPARM.MAXNMBRCR = 1;
      342     8875
      343     8876
      344     8877    1        FCN1 = FCN ;
      345     8878    2        DO CASE (FCN1);
      346     8879        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:12   
      347     8880    2        CASE (MFC_DELREC);
      348     8881    2           K$RWPARM.MSG_ERRCODE = DELRECER;
      349     8882    2           K$RWPARM.KEYTYPE = DCB$->F$DCB.KEYTYPE;
      350     8883    2           DVBYTE1 = DVBYTE1|%DVBYTE_TRANS#;
      351     8884    2           K$RWPARM.CVTDAT = '1'B;
      352     8885    2           GOTO WRT1;
      353     8886        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:13   
      354     8887    2        CASE (MFC_WEOF);
      355     8888    2           K$RWPARM.MSG_ERRCODE = EOFERR;
      356     8889    2           GOTO WRT1;
      357     8890        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:14   
      358     8891    2        CASE (MFC_WRIMD);
      359     8892    2           K$RWPARM.MSG$ = MSG$;
      360     8893    2           K$RWPARM.MSGSZ = MSGSZ;
      361     8894                %LOCK(G=LDCT$->LDCT.LOCK);
      362     8897    2           CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_DAT_IMD,K$RWPARM) ALTRET(BRKOUT);
      363     8898                %UNLOCK (G=LDCT$->LDCT.LOCK);
      364     8901
      365     8902        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:15   
      366     8903    2        CASE (MFC_WRITE,MFC_WRUR,MFC_WRBIN,MFC_WRURUC);
      367     8904    2   WRT1:   ;
      368     8905    3           IF LDCT$->LDCT.LKFLG.FPSTEP AND ENTFLG=%DCB# THEN DO;
      369     8906    3                B$JIT.ERR = LDCT$->NK$LDCT.ERR;
      370     8907    3                ALTRETURN;
      371     8908    3              END;
      372     8909    2           K$RWPARM.MSG$ = MSG$;
      373     8910    2           K$RWPARM.MSGSZ = MSGSZ;
      374     8911    2           IF FPT$ ~= ADDR(NIL)
      375     8912    3           THEN DO;
      376     8913    3                CALL HFF$NILERASE (1) ALTRET (NOWRTKEY);
      377     8914    3                CALL HFF$DSIZ(1,USRKEYSZ);
      378     8915    3                USRKEYSZ = MINIMUM(255,USRKEYSZ);
      379     8916    3                K$RWPARM.KEYSZ = USRKEYSZ;
      380     8917    3                K$RWPARM.KEY$ = B$PS1$;
      381     8918    3              END;
      382     8919    2   NOWRTKEY: ;
      383     8920    2           IF FCN1=MFC_WRUR
      384     8921    2           THEN
      385     8922    2                K$RWPARM.TRANS$ = B$XL_UR$;
      386     8923    2           ELSE
      387     8924    2                IF FCN1=MFC_WRURUC
      388     8925    2                THEN
      389     8926    2                     K$RWPARM.TRANS$ = B$XL_UPPER_UR$;
      390     8927    2                ELSE
      391     8928    2                     K$RWPARM.TRANS$ = ADDR(NIL);
      392     8929                %LOCK (G=LDCT$->LDCT.LOCK);
      393     8932    2           IF DVBYTE1&%DVBYTE_RRR#
      394     8933    3           THEN DO;
      395     8934    3                K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
      396     8935    3              END;
      397     8936
      398     8937    2           K$RWPARM.DVE.DVBYTE = DVBYTE1;
      399     8938
      400     8939
      401     8940    2   TRY_WRT_AGAIN:;
      402     8941    2           CALL KIA$WRITE_USER (LDCT$->LDCT,K$RWPARM)
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:16   
      403     8942    3           WHENALTRETURN DO;
      404     8943
      405     8944    3                IF S$CU$->B$U.ASYNCH & %(~U_RESET) AND (ENTFLG=%DCB#)
      406     8945    3                     AND NOT S$CU$->B$U.FLG & %U_STIP
      407     8946    3                     OR LDCT$->NK$LDCT.DFLG.FEDN
      408     8947    3                THEN
      409     8948    3                     GOTO BRKOUT;
      410     8949    3                IF K$RWPARM.ERR = %K$NO_THROT
      411     8950    3                THEN
      412     8951    3                     IF K$RWPARM.DVE.DVBYTE.NODAT
      413     8952    4                     THEN DO;
      414     8953    4                          B$JIT.ERR = KIA_NODAT;
      415     8954               /*E* ERROR: KIA-E$NODAT-C
      416     8955                    MESSAGE: No throttling to write %thru %DC %and NODAT specified.
      417     8956                   */
      418     8957    4                          GOTO BRKOUT;
      419     8958    4                        END;
      420     8959    4                     ELSE DO;
      421     8960    4                          CALL SSR$REG (%SS_CBL,LDCT$);
      422     8961                               %LOCK (G=LDCT$->NK$LDCT.LOCK);
      423     8964    4                          GOTO TRY_WRT_AGAIN ;
      424     8965    4                        END;
      425     8966
      426     8967    3                IF K$RWPARM.ERR ~= %K$QFULL
      427     8968    3                THEN
      428     8969    3                     GOTO BRKOUT;
      429     8970    3                CALL KIA$OQFL (LDCT$->LDCT) ALTRET(BRKOUT) ;
      430     8971    3                GOTO TRY_WRT_AGAIN ;
      431     8972    3              END;
      432     8973    2   WAIT_RRR_RESP: ;
      433     8974    2           IF K$RWPARM.MRKTYP ~= 0         /* Must wait for output complete      */
      434     8975    3           THEN DO;
      435     8976    3                PFB = K$RWPARM.STR;        /* clobbered by KIA$MSG (probably) */
      436     8977        /* S unlocks LDCT$->NK$LDCT.LOCK */
      437     8978    3                CALL SSR$REG (%SS_CW,LDCT$);
      438     8979                     %LOCK (G=LDCT$->NK$LDCT.LOCK);
      439     8982    3                K$RWPARM.IP$ = LDCT$->LDCT.IP$;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:17   
      440     8983
      441     8984    3                LDCT$->LDCT.IP$ = ADDR(NIL);
      442     8985    3                IF K$RWPARM.IP$ = ADDR(NIL)
      443     8986    3                THEN
      444     8987    3                     GOTO BRKOUT ;
      445     8988
      446     8989    3                CALL KIQ$MAPFEP(LDCT$->LDCT.IPFEI#);
      447     8990    3                K$RWPARM.UHDR$ = PINCRC(K$RWPARM.IP$,K$RWPARM.IP$->KI$QMHDR.OFFSET);
      448     8991    3                K$RWPARM.UHDRSZ = K$RWPARM.IP$->KI$QMHDR.SIZE;
      449     8992    3                CALL KIA$MSG (K$RWPARM);
      450     8993    3                B$JIT.ERR = K$RWPARM.MSG_ERRCODE;
      451     8994    3                IF NOT B$JIT.ERR
      452     8995    3                THEN
      453     8996    3                     IF K$RWPARM.VDOFLGS.NEWSSN
      454     8997    3                     THEN
      455     8998    3                          B$ROSEG$->B$ROSEG.STREAM_VALID(PFB) = '0'B;
      456     8999    3                     ELSE
      457     9000    3                          B$ROSEG$->B$ROSEG.STREAM_VALID(PFB) = '1'B;
      458     9001    3                IF ENTFLG = %DCB#
      459     9002    3                THEN
      460     9003    3                     DCB$->F$DCB.FLDID = K$RWPARM.FLDID;
      461     9004    3                K$RWPARM.LDCT$ = LDCT$;
      462     9005    3                K$RWPARM.FUNCTION = %K_READDONE;
      463     9006    3                CALL KIS$SEND (K$RWPARM);
      464     9007    3              END;
      465     9008
      466     9009                %UNLOCK (G=LDCT$->LDCT.LOCK);
      467     9012    2           IF B$JIT$->B$JIT.CPFLAGS1 & %CP_DRIBBLE# AND ENTFLG = %DCB#
      468     9013    2                AND DCB$ = B$M$UC$ AND (FCN1 ~= MFC_TCTL)
      469     9014    2           THEN
      470     9015    2                CALL UMD$DOU(DVBYTE,VFC);
      471     9016    2           IF K$RWPARM.TYC
      472     9017    2           THEN
      473     9018    2                B$JIT.ERR = K$RWPARM.MSG_ERRCODE;
      474     9019
      475     9020
      476     9021        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:18   
      477     9022    2        CASE (MFC_READ);
      478     9023
      479     9024         /* If the front end has reported a disconnect read is no longer allowedA */
      480     9025    2           IF LDCT$->NK$LDCT.DFLG.OLDSC
      481     9026    3           THEN DO;
      482     9027    3                B$JIT.ERR = LDSC;
      483     9028    3                ALTRETURN;
      484     9029    3              END;
      485     9030
      486     9031    2           CALL HFF$DSIZ(0,USRKEYSZ);
      487     9032    2           IF FPT$~= ADDR(NIL)
      488     9033    2           THEN
      489     9034    2                IF USRKEYSZ = SIZEC(FPT$->FPT$READ_V)
      490     9035    2                THEN
      491     9036    2                     IF FPT$->FPT$READ_V.SINPUTSIZE ~= 0 AND
      492     9037    2                          NOT (ENTFLG = %DCB# AND
      493     9038    2                          (DCB$ -> F$DCB.ORG = %SE# OR
      494     9039    2                          DCB$ -> F$DCB.ORG = %FORM#))
      495     9040    3                     THEN DO;
      496     9041    3                          K$RWPARM.V$ = ADDR(VSIN);
      497     9042    3                          K$RWPARM.VSZ = LENGTHC(VSIN);
      498     9043    3                          K$RWPARM.PRMID = %KV_PRMID_SINPUT;
      499     9044    3                          K$RWPARM.MSG$ = MSG$;
      500     9045    3                          K$RWPARM.MSGSZ = MINIMUM(MSGSZ,FPT$->FPT$READ_V.SINPUTSIZE);
      501     9046    3                          VSIN.PFB = PFB;
      502     9047    3                          VSIN.POS = FPT$->FPT$READ_V.REREADPOS;
      503     9048    3                          VSIN.POSL6.T = VSIN.POSL66.T;
      504     9049                               %LOCK (G=LDCT$->NK$LDCT.LOCK);
      505     9052    3                          CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_PRM_SET,K$RWPARM)
              9052                                   ALTRET(BRKOUT);
      506     9053                               %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      507     9056    3                          K$RWPARM.MSGSZ = 0;
      508     9057    3                          K$RWPARM.MSG$ = ADDR(NIL);
      509     9058    3                        END;
      510     9059
      511     9060    3           IF LDCT$->LDCT.LKFLG.FPSTEP AND ENTFLG=%DCB# THEN DO;
      512     9061    3                B$JIT.ERR=NOFPRG;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:19   
      513     9062    3                ALTRETURN;
      514     9063    3              END;
      515     9064    2           IF FPT$ ~= ADDR(NIL) AND FPT$->FPT$READ_V.KEYS
      516     9065    3           THEN DO;
      517     9066    3                CALL HFF$NILERASE (1) ALTRET (NORDKEY);
      518     9067    3                CALL HFF$DSIZ(1,USRKEYSZ);
      519     9068    3                USRKEYSZ = MINIMUM(31,USRKEYSZ);
      520     9069    3                K$RWPARM.KEYSZ = USRKEYSZ;
      521     9070    3                K$RWPARM.KEY$ = B$PS1$;
      522     9071    3              END;
      523     9072    2   NORDKEY: ;
      524     9073    2           TDVB=DVBYTE1;                   /* TO AVOID CALLING TRAPALT           */
      525     9074
      526     9075                %LOCK (G=LDCT$->NK$LDCT.LOCK);
      527     9078
      528     9079        /* If there is a no wait read pending, cancel it */
      529     9080    2           IF DCB$ ~= ADDR(NIL)
      530     9081    2           THEN IF DCB$->F$DCB.WAIT~=0 AND DCB$->F$DCB.FCN.CNT(0) ~= 0
      531     9082    3                THEN DO;
      532     9083
      533     9084    3   CANCEL_READ:      ;
      534     9085        /*
      535     9086             Send a cancel down to other end
      536     9087         */
      537     9088    3                     K$RWPARM = K_RWPARM_CON;
      538     9089    3                     K$RWPARM.STR = LDCT$->NK$LDCT.NOWAIT.STREAM;
      539     9090    3                     K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
      540     9091    3                     CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM)
      541     9092    3                          ALTRET (BRKOUT);
      542     9093
      543     9094        /*
      544     9095             Wait for cancel to be acked
      545     9096         */
      546     9097    3                     LDCT$->NK$LDCT.LKFLG.WTMRK = '1'B;
      547     9098    3                     CALL SSR$REG(%SS_CW,LDCT$);
      548     9099                          %LOCK (G=LDCT$->NK$LDCT.LOCK);
      549     9102
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:20   
      550     9103        /*
      551     9104             Check to see if the no wait read is still pending
      552     9105          */
      553     9106    4                     DO WHILE LDCT$->NK$LDCT.LKFLG.NOWAIT; /* Need to event */
      554     9107
      555     9108    4                          K$RWPARM = K_RWPARM_CON;
      556     9109    4                          K$RWPARM.MSG_ERRCODE = XTRARD;
      557     9110        /*E* ERROR: KIA-E$XTRARD
      558     9111             MESSAGE: Nowait read %thru %DC %canceled by another read request.
      559     9112             MESSAGE1: A nowait read %thru %DC %was canceled either because
      560     9113                       a subsequent read request specified wait, a different
      561     9114                       buffer size, key size, or keytype, or would have exceeded
      562     9115                       the system maximum of three nowait reads per connection.
      563     9116           */
      564     9117    4                          K$RWPARM.TYC = %TYC_XTRARD;
      565     9118    4                          CALL KIA$COMP(LDCT$->NK$LDCT,K$RWPARM);
      566     9119    4                        END;
      567     9120                          %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      568     9123    3                     GOTO CMN;             /* rebuild K$RWPARM */
      569     9124    3                   END;
      570     9125                %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      571     9128        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:21   
      572     9129    2           IF DCB$~=ADDR(NIL) AND DCB$->F$DCB.WAIT=0
      573     9130    3           THEN DO;
      574     9131        /*I*
      575     9132             NAME: NOWAIT_READ
      576     9133             PURPOSE:
      577     9134                  To set up a no wait read function to a terminal
      578     9135             DATA:
      579     9136                  K$RWPARM - Set up with the read information
      580     9137                  LDCT$    - Pointing to the TS's terminal LDCT
      581     9138             DESCRIPTION:
      582     9139                  When a no wait read is performed to a terminal this
      583     9140                  routine sets up the information.  The read will
      584     9141                  be completed by KIA$UCIN calling KIA$COMP when data
      585     9142                  comes in satisfying this read.  We use the comgroup
      586     9143                  context area to map onto the buffers.
      587     9144
      588     9145         */
      589     9146
      590     9147        /*
      591     9148             Check if we need to return a KEY
      592     9149         */
      593     9150    3                NOWAIT = '0'B;
      594     9151    3                USRKEYSZ = 0;
      595     9152    3                IF FPT$~= ADDR(NIL) AND FPT$->FPT$READ_V.KEYR
      596     9153    4                THEN DO;
      597     9154    4                     CALL HFF$NILERASE(1)
      598     9155    5                     WHENRETURN DO;
      599     9156    5                          CALL HFF$DSIZ(1,USRKEYSZ);
      600     9157    5                          IF USRKEYSZ>256 THEN USRKEYSZ = 256;
      601     9158    5                          CALL HFF$WRITE1(1) ALTRET (MTRAP);
      602     9159    5                          NOWAIT.KEYTYP = K$RWPARM.KEYTYPE;
      603     9160    5                          CALL MMS$SETUP_BUF(%USERWSQ,B$PS1$,USRKEYSZ,RPTR$,PTW);
      604     9161    5                          FEPIO.KEYX = POFFC(RPTR$,B$CGCTXT$);
      605     9162    5                          FEPIO.KPP(0) = PTW.PP(0);
      606     9163    5                          FEPIO.KPP(1) = PTW.PP(1);
      607     9164    5                        END;
      608     9165    4                   END;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:22   
      609     9166
      610     9167        /*
      611     9168             Set up the buffer area of the DCB
      612     9169         */
      613     9170    3                FEPSIZ.BUF = MSGSZ;
      614     9171    3                CALL MMS$SETUP_BUF(%USERWSQ,DCB$->F$DCB.UB$,MSGSZ,RPTR$,PTW);
      615     9172    3                FEPIO.BUFX = POFFC(RPTR$,B$CGCTXT$);
      616     9173    3                FEPIO.BPP(0) = PTW.PP(0);
      617     9174    3                FEPIO.BPP(1) = PTW.PP(1);
      618     9175
      619     9176        /* Save the DCB# of the user specified DCB and the event
      620     9177         */
      621     9178    3                FEPIO.EVENT = EVENT;
      622     9179    3                NOWAIT.DCB# = B$JIT.DCBNO;
      623     9180    3                NOWAIT.STREAM = K$RWPARM.STR;
      624     9181    3                CALL FMO$GETDOMAIN(PFB);
      625     9182    3                NOWAIT.DMN = PFB;
      626     9183
      627     9184        /* Make sure we have write access */
      628     9185    3                CALL HFF$WRITE1(2)
      629     9186    4                WHENALTRETURN DO;
      630     9187    4   MTRAP:            B$JIT.ERR = MTRAPERR;
      631     9188                  /*E* ERROR: KIA-E$MTRAP
      632     9189                       MESSAGE: Your buffer is invalid for this read %thru %DC%.
      633     9190                       MESSAGE1: Either the buffer is missing or the wrong access.
      634     9191                        */
      635     9192    4                     K$RWPARM.TYC = %TYC_MTRAP | %TYC_EGV;
      636     9193    4                     GOTO CSEND;
      637     9194    4                   END;
      638     9195
      639     9196        /*
      640     9197             Send the request data
      641     9198         */
      642     9199                     %LOCK (G=LDCT$->NK$LDCT.LOCK);
      643     9202    4                IF LDCT$->NK$LDCT.LKFLG.NOWAIT THEN DO;
      644     9203        /* Some already pending, see if this one is ok to add */
      645     9204
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:23   
      646     9205    4                     IF FEPSIZ~=DCB$->F$DCB.FEPSIZ
      647     9206    4                          OR LDCT$->NK$LDCT.NOWAIT~=NOWAIT
      648     9207    4                     THEN GOTO CANCEL_READ;
      649     9208    4                     K$RWPARM.VDOFLGS.INCNMBRCR = '1'B;
      650     9209    4                   END;
      651     9210    4                ELSE DO;
      652     9211    4                     LDCT$->NK$LDCT.NOWAIT = NOWAIT;
      653     9212    4                     DCB$->F$DCB.FEPSIZ = FEPSIZ;
      654     9213    4                   END;
      655     9214    3                DCB_FCN_CNT0 = DCB$->F$DCB.FCN.CNT(0);
      656     9215    3                IF DCB_FCN_CNT0<3
      657     9216    3                     AND (DCB_FCN_CNT0=0
      658     9217    3                     OR FEPIO.BUFX~=DCB$->F$DCB.FEPIO.BUFX
      659     9218    3                     OR FEPIO.BPP(0)~=DCB$->F$DCB.FEPIO.BPP(0))
      660     9219    3                THEN
      661     9220    3                     CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM)
      662     9221    3                          ALTRET (BRKOUT);
      663     9222    4                ELSE DO;
      664     9223        /* Gotta cancel one of them */
      665     9224
      666     9225    4                     K$RWPARM = K_RWPARM_CON;
      667     9226    4                     K$RWPARM.MSG_ERRCODE = XTRARD;
      668     9227    4                     K$RWPARM.TYC = %TYC_XTRARD;
      669     9228    4                     CALL KIA$COMP(LDCT$->NK$LDCT, K$RWPARM);
      670     9229    4                     DCB_FCN_CNT0 = DCB_FCN_CNT0 - 1;
      671     9230    4                   END;
      672     9231    3                LDCT$->NK$LDCT.LKFLG.NOWAIT = '1'B;
      673     9232
      674     9233        /*
      675     9234             Increment the user's MF count
      676     9235         */
      677     9236                     %LOCK (G=NI_MFGATE);
      678     9239    3                S$CU$->B$U.MF = S$CU$->B$U.MF + 1;
      679     9240    3                S$CU$->B$U.CMF = S$CU$->B$U.CMF + 1;
      680     9241                     %UNLOCK (G=NI_MFGATE);
      681     9244
      682     9245    3                IF DCB_FCN_CNT0=1
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:24   
      683     9246    3                THEN DCB$->F$DCB.FEPIO2 = FEPIO;
      684     9247    3                ELSE IF DCB_FCN_CNT0<1
      685     9248    3                     THEN DCB$->F$DCB.FEPIO = FEPIO;
      686     9249    3                     ELSE DCB$->F$DCB.FEPIO3 = FEPIO;
      687     9250                     %UNLOCK (G=LDCT$->LDCT.LOCK);
      688     9253
      689     9254    3                RETURN;
      690     9255    3              END;
      691     9256        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:25   
      692     9257    2           IF B$JIT$->B$JIT.CPFLAGS1 & %CP_DRIBBLE# AND ENTFLG = %DCB#
      693     9258    2                AND DCB$ = B$M$UC$ AND NOT K$RWPARM.DVE.DVBYTE.TRANS
      694     9259    2           THEN
      695     9260    2                CALL UMD$DPMT;             /* Dribble the prompt string */
      696     9261    2           K$RWPARM.VDOFLGS.WAIT = '1'B;
      697     9262    2           CALL READS ALTRET (BRKOUTR);
      698     9263    2           B$JIT.INTER=B$JIT.INTER+1;
      699     9264    3           IF ENTFLG=%DCB# THEN DO;
      700     9265    3                DCB$->F$DCB.DVBYTE=K$RWPARM.DVE.DVBYTE;
      701     9266    3                DCB$->F$DCB.EOMCHAR=K$RWPARM.DVE.EOMCHAR;
      702     9267    3                DCB$->F$DCB.FLDID=K$RWPARM.FLDID;
      703     9268    3                DCB$->F$DCB.ACTPOS=K$RWPARM.ACTPOS;
      704     9269    3              END;
      705     9270    3           ELSE DO;
      706     9271    3                DVBYTE=K$RWPARM.DVE.DVBYTE;
      707     9272    3                EOMCHAR=K$RWPARM.DVE.EOMCHAR;
      708     9273    3              END;
      709     9274    2           IF B$JIT$->B$JIT.CPFLAGS1 & %CP_DRIBBLE# AND ENTFLG = %DCB#
      710     9275    2                AND DCB$ = B$M$UC$ AND NOT K$RWPARM.DVE.DVBYTE.TRANS
      711     9276    2           THEN
      712     9277    2                CALL UMD$DIN(K$RWPARM.TYC);
      713     9278
      714     9279
      715     9280        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:26   
      716     9281    2        CASE (MFC_RSTAT);
      717     9282    2           K$RWPARM.PRMID=PCODE;
      718     9283    2           CALL READS ALTRET (BRKOUTR);
      719     9284
      720     9285
      721     9286        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:27   
      722     9287    2        CASE (MFC_TCTL);
      723     9288    2           PFCN=TFCN;
      724     9289    2           IF ADDR(BUF$)~=ADDR(NIL)
      725     9290    2           THEN
      726     9291    2                K$RWPARM = BUF$->KI$RWPARM;
      727     9292    2           ELSE
      728     9293    2                K$RWPARM = K_RWPARM_CON;
      729     9294    2           K$RWPARM.STR = PFB;
      730     9295    2           K$RWPARM.DVE.VFC = VFC;
      731     9296    2           K$RWPARM.TYC='0'B;
      732     9297    2           IF K$RWPARM.DVE.DVBYTE.RRR OR LDCT$->LDCT.TCTLCNT >= KIA_TCTLMAX
      733     9298    2           THEN
      734     9299    2                K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
      735     9300    2           K$RWPARM.DVE.DVBYTE = '0'B;
      736     9301    2           IF PFCN = 0
      737     9302    2           THEN
      738     9303    2                LDCT$->LDCT.DFLG.NOSND = ~K$RWPARM.VDOFLGS.SEND;
      739     9304    3           ELSE DO;
      740     9305                     %LOCK (G=LDCT$->LDCT.LOCK);
      741     9308    3                CALL KIA$FCNOU (LDCT$->LDCT,PFCN,K$RWPARM) ALTRET (BRKOUT);
      742     9309    3                LDCT$->LDCT.TCTLCNT = LDCT$->LDCT.TCTLCNT + 1;
      743     9310    3                GOTO WAIT_RRR_RESP;
      744     9311    3              END;
      745     9312
      746     9313
      747     9314        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:28   
      748     9315    2        CASE (ELSE);
      749     9316    2           CALL SC_BTSFCN;
      750     9317        /*S*  SCREECH_CODE:  KIA-S$BMDFCN
      751     9318              TYPE:          SUA
      752     9319              MESSAGE:       Illegal media function passed on timesharing I/O
      753     9320              REMARKS:       Several media layer functions which are legal for
      754     9321                             files, etc. are not legal for timesharing terminals
      755     9322                             This SUA occurs when one of these is passed to KIA$UCIO
      756     9323                             NKA$DEVIO (NKA-S$BMDFCN) and KCI$RWCG (KCI-S$BMDFCN)
      757     9324                             also report this screech code in similar situations     */
      758     9325    2        END;
      759     9326
      760     9327
      761     9328
      762     9329
      763     9330
      764     9331    1   CSEND: ;
      765     9332    1        IF ENTFLG~=%DCB#
      766     9333    2        THEN DO;
      767     9334    2             IF ADDR(TYC) ~= ADDR(NIL)
      768     9335    2             THEN
      769     9336    2                  TYC = K$RWPARM.TYC;
      770     9337    2           END;
      771     9338    1        ELSE IF DCB$->F$DCB.WAIT ~= 0
      772     9339    1             THEN
      773     9340    1                  DCB$->F$DCB.TYC(1)=K$RWPARM.TYC;
      774     9341    1             ELSE IF EVENT=0
      775     9342    1                  THEN
      776     9343    1                       DCB$->F$DCB.TYC(0)=DCB$->F$DCB.TYC(0)|K$RWPARM.TYC;
      777     9344    1                  ELSE
      778     9345    1                       CALL NKA$EVENT (K$RWPARM.TYC,EVENT);
      779     9346
      780     9347    1        IF B$JIT.ERR
      781     9348    1        THEN
      782     9349    1             ALTRETURN;
      783     9350
      784     9351    1        RETURN;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:29   
      785     9352
      786     9353
      787     9354    1   BRKOUTR: ;
      788     9355
      789     9356        /* Check to see if there was a trap on the buffer */
      790     9357    1        IF K$RWPARM.ERR = %K$BAD_BUFFER
      791     9358    2        THEN DO;
      792     9359    2             K$RWPARM.TYC = %TYC_MTRAP | %TYC_EGV;
      793     9360    2             ALTRETURN;
      794     9361    2           END;
      795     9362    1        B$JIT$->B$JIT.ERR=BYDR;
      796     9363        /*E*  ERROR:         KIA-E$BYDR-C
      797     9364               MESSAGE: Asynchronous event interrupted terminal read %thru %DC%.
      798     9365              MESSAGE1: One of the following occurred while a read to
      799     9366                        your timesharing terminal was pending: BREAK,
      800     9367                        CONTROL-Y, X keyin, E keyin,  DISCONNECT.  If
      801     9368                        you can continue the read will be re-issued.
      802     9369              DESCRIPTION:   As a rule, the user never sees this error.  Either
      803     9370                             he is Xed, ERRORed, or disconnected such that he
      804     9371                             does not continue to run; or BREAK or CTL-Y was
      805     9372                             hit.  In the case of BREAK, the users break control
      806     9373                             routine can examine this code to discover whether
      807     9374                             a read to the terminal was interrupted.
      808     9375                             In any case B$JIT.JUNK.JJ_BAKIC is set such that
      809     9376                             if the user does an M$TRTN or says GO to IBEX the
      810     9377                             interrupted pmme is re-issued                           */
      811     9378    1        GOTO BKOUT;
      812     9379
      813     9380    1   BRKOUT: ;
      814     9381
      815     9382             %UNLOCK (G=LDCT$->LDCT.LOCK);
      816     9385    1        IF B$JIT.ERR = KIA_NODAT
      817     9386    1        THEN
      818     9387    1             ALTRETURN;
      819     9388        /* Check to see if there was a trap on the buffer */
      820     9389    1        IF K$RWPARM.ERR = %K$BAD_BUFFER
      821     9390    2        THEN DO;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:30   
      822     9391    2             K$RWPARM.TYC = %TYC_MTRAP | %TYC_EGV;
      823     9392    2             ALTRETURN;
      824     9393    2           END;
      825     9394    1        B$JIT$->B$JIT.ERR=BYD;
      826     9395        /*E*  ERROR:         KIA-E$BYD-C
      827     9396               MESSAGE: Asynchronous event interrupted terminal I/O %thru %DC%.
      828     9397              MESSAGE1: One of the following occurred while I/O to
      829     9398                        your timesharing terminal was pending: BREAK,
      830     9399                        CONTROL-Y, X keyin, E keyin,  DISCONNECT.  If
      831     9400                        you can continue the I/O will be re-issued.
      832     9401              DESCRIPTION:   As a rule, the user never sees this error.  Either
      833     9402                             he is Xed, ERRORed, or disconnected such that he
      834     9403                             does not continue to run; or BREAK or CTL-Y was
      835     9404                             hit.  In the case of BREAK, the users break control
      836     9405                             routine can examine this code to discover whether
      837     9406                             terminal writes or control pmmes were in progress.
      838     9407                             In any case B$JIT.JUNK.JJ_BAKIC is set such that
      839     9408                             if the user does an M$TRTN or says GO to IBEX the
      840     9409                             interrupted pmme is re-issued                           */
      841     9410    1   BKOUT: ;
      842     9411    1        IF LDCT$->NK$LDCT.DFLG.OLDSC       /* ERRCODE IS IN LDCT */
      843     9412    1             AND LDCT$->NK$LDCT.ERR ~= '0'B
      844     9413    2        THEN DO;
      845     9414    2             B$JIT$->B$JIT.ERR = LDCT$->NK$LDCT.ERR;
      846     9415    2             LDCT$->NK$LDCT.ERR = '0'B;
      847     9416    2           END;
      848     9417    1        IF S$CU$->B$U.ASYNCH & %(~U_RESET)
      849     9418    1        THEN
      850     9419    1             B$JIT$->B$JIT.JUNK=B$JIT$->B$JIT.JUNK|%JJ_BAKIC#;
      851     9420    1        ALTRETURN;
      852     9421        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:31   
      853     9422    1   KIA$CLSSTR: ENTRY (FCN,DVBYTE,VFC) ALTRET;
      854     9423
      855     9424    1        ENTFLG = %NODCB#;
      856     9425    1        K$RWPARM = K_RWPARM_CON;
      857     9426    1        K$RWPARM.STR = ADDR(FCN)->STR;
      858     9427    1        K$RWPARM.VDOFLGS.DLTSTR = ADDR(DVBYTE)->DLTSTR;
      859     9428    1        K$RWPARM.VDOFLGS.NEWSSN = ADDR(VFC)->NEWSSN;
      860     9429    1        LDCT$ = NK$LDCT$(B$M$UC$->F$DCB.LDCTX);
      861     9430    1        B$M$UC$->F$DCB.STR = 1;       /* Don't leave this strid lying around */
      862     9431             %LOCK (G=LDCT$->LDCT.LOCK);
      863     9434    1        IF K$RWPARM.VDOFLGS.NEWSSN
      864     9435    1        THEN
      865     9436    1             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
      866     9437    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_CLSSTR,K$RWPARM) ALTRET(BRKOUT);
      867     9438    1        IF K$RWPARM.VDOFLGS.DLTSTR
      868     9439    1        THEN
      869     9440    1             B$ROSEG$->B$ROSEG.STREAM_VALID(K$RWPARM.STR) = '0'B;
      870     9441    1        GOTO WAIT_RRR_RESP;
      871     9442        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:32   
      872     9443    1   KIA$OPNSSN: ENTRY (FCN) ALTRET;
      873     9444
      874     9445    1        ENTFLG = %NODCB#;
      875     9446    1        K$RWPARM = K_RWPARM_CON;
      876     9447    1        LDCT$ = ADDR(FCN);
      877     9448             %LOCK (G=LDCT$->LDCT.LOCK);
      878     9451    1        K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
      879     9452    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_OPNSSN_RQS,K$RWPARM) ALTRET(BRKOUT);
      880     9453    1        GOTO WAIT_RRR_RESP;
      881     9454        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:33   
      882     9455    1   KIA$DCLSTR: ENTRY (FCN,DVBYTE) ALTRET;
      883     9456
      884     9457    1        ENTFLG = %NODCB#;
      885     9458    1        K$RWPARM = K_RWPARM_CON;
      886     9459    1   DCLSTR: ;
      887     9460    1        K$RWPARM.STR = ADDR(FCN)->STR;
      888     9461    1        K$RWPARM.STRID = ADDR(DVBYTE)->STRID;
      889     9462    1        LDCT$ = NK$LDCT$(B$M$UC$->F$DCB.LDCTX);
      890     9463             %LOCK (G=LDCT$->LDCT.LOCK);
      891     9466    1        K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
      892     9467    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_DCLSTR,K$RWPARM) ALTRET(BRKOUT);
      893     9468    1        K$RWPARM.STR = K$RWPARM.STRID;     /* mark the stream ok if no error */
      894     9469    1        GOTO WAIT_RRR_RESP;
      895     9470        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:34   
      896     9471    1   KIA$REDSTR: ENTRY(FCN,DVBYTE) ALTRET;
      897     9472
      898     9473    1        ENTFLG = %NODCB#;
      899     9474    1        K$RWPARM = K_RWPARM_CON;
      900     9475    1        K$RWPARM.VDOFLGS.REDSTR = '1'B;
      901     9476    1        GOTO DCLSTR;
      902     9477
      903     9478        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:35   
      904     9479    1   KIA$OPNSTR: ENTRY (FCN,DVBYTE) ALTRET;
      905     9480
      906     9481    1        ENTFLG = %NODCB#;
      907     9482    1        K$RWPARM = K_RWPARM_CON;
      908     9483    1        K$RWPARM.STR = ADDR(FCN)->STR;
      909     9484
      910     9485    1        IF ADDR(DVBYTE)->F$DCB.ORG = %FORM#
      911     9486    1        THEN
      912     9487    1             K$RWPARM.ORG = %KV#VD_ORG_FORM;
      913     9488    1        ELSE IF ADDR(DVBYTE)->F$DCB.ORG = %X364#
      914     9489    1             THEN
      915     9490    1                  K$RWPARM.ORG = %KV#VD_ORG_X364;
      916     9491    1             ELSE IF ADDR(DVBYTE)->F$DCB.ORG = %SE#
      917     9492    2                  THEN DO;
      918     9493    2                       K$RWPARM.ORG = %KV#VD_ORG_SE;
      919     9494    2                       IF ADDR(DVBYTE)->F$DCB.KEYL=0 OR ADDR(DVBYTE)->F$DCB.KEYL>4
      920     9495    2                       THEN ADDR(DVBYTE)->F$DCB.KEYL = 4;
      921     9496    2                       K$RWPARM.KEYSZ = ADDR(DVBYTE)->F$DCB.KEYL;
      922     9497    2                       K$RWPARM.SPARE = ADDR(DVBYTE)->F$DCB.SPARE;
      923     9498    2                       K$RWPARM.NRECS = ADDR(DVBYTE)->F$DCB.NRECS;
      924     9499    2                       IF ADDR(DVBYTE)->F$DCB.KEYTYPE=0
      925     9500    2                       THEN ADDR(DVBYTE)->F$DCB.KEYTYPE = %KEYTYPE_BIN10#;
      926     9501    2                     END;
      927     9502    1                  ELSE
      928     9503    1                       K$RWPARM.ORG = %KV#VD_ORG_UR;
      929     9504    1        LDCT$ = NK$LDCT$(B$M$UC$->F$DCB.LDCTX);
      930     9505             %LOCK (G=LDCT$->LDCT.LOCK);
      931     9508    1        IF K$RWPARM.ORG ~= %KV#VD_ORG_UR
      932     9509    1        THEN
      933     9510    1             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
      934     9511    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_OPNSTR,K$RWPARM) ALTRET(BRKOUT);
      935     9512    1        GOTO WAIT_RRR_RESP;
      936     9513        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:36   
      937     9514    1   KIA$WINDOW: ENTRY(FCN,DVBYTE) ALTRET;
      938     9515
      939     9516    1        ENTFLG = %NODCB#;
      940     9517    1        CALL FSN$CONV_STR (ADDR(DVBYTE)->VLP$WINDOW_V.FWINDOW,ADDR(DVBYTE)->
              9517                 VLP$WINDOW_V.FSTR.ID)
      941     9518    2        WHENALTRETURN DO;
      942     9519    2             ALTRETURN;
      943     9520    2           END;
      944     9521    1        CALL KIA$9TO8 (ADDR(DVBYTE)->WINDOW.LENGTH,
      945     9522    1             ADDR(DVBYTE)->WINDOW.LENGTH,2);
      946     9523    1        CALL KIA$9TO8 (ADDR(DVBYTE)->WINDOW.WIDTH,
      947     9524    1             ADDR(DVBYTE)->WINDOW.WIDTH,2);
      948     9525    1        CALL KIA$9TO8 (ADDR(DVBYTE)->WINDOW.ORG_PST.COLUMN,
      949     9526    1             ADDR(DVBYTE)->WINDOW.ORG_PST.COLUMN,2);
      950     9527    1        K$RWPARM = K_RWPARM_CON;
      951     9528    1        K$RWPARM.STR = ADDR(FCN)->STR;
      952     9529    1        K$RWPARM.MSG$ = ADDR(DVBYTE);
      953     9530    1        K$RWPARM.MSGSZ = SIZEC(VLP$WINDOW_V);
      954     9531    1        K$RWPARM.PRMID = %KV_PRMID_WINDOW;
      955     9532    1        LDCT$ = NK$LDCT$(B$M$UC$->F$DCB.LDCTX);
      956     9533             %LOCK (G=LDCT$->LDCT.LOCK);
      957     9536    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_PRM_SET,K$RWPARM) ALTRET(BRKOUT);
      958     9537             %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
      959     9540    1        RETURN;
      960     9541
      961     9542        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:37   
      962     9543    1   READS: PROC ALTRET;
      963     9544
      964     9545        /*I*
      965     9546             NAME: READS
      966     9547             PURPOSE:
      967     9548                  To perform a read function from the terminal.
      968     9549             CALL:
      969     9550                  CALL READS ALTRET( );
      970     9551             DATA:
      971     9552                  K$RWPARM - Set up with the read information
      972     9553                  LDCT$    - Pointing to the TS terminal's LDCT
      973     9554             DESCRIPTION:
      974     9555                  When a read is done from the terminal the first thing send
      975     9556                  to the terminal is a read request then the user if regged for
      976     9557                  communication read event. When a message comes in satisfying the
      977     9558                  read, KIA$UCIN unreg's the user. A read is done from KIS$SEND
      978     9559                  which will find the message that caused the read completion and
      979     9560                  move it into the user's buffer. If a BRK or CNTRL Y interrupted
      980     9561                  the read and this is not KIA$UCIOND, this procedure
      981     9562                  will ALTRETURN.
      982     9563        */
      983     9564    2        IF MSGSZ = 0 OR MSG$ = ADDR(NIL)   /* No read buffer */
      984     9565    2        THEN
      985     9566    2             RETURN;
      986     9567             %LOCK (G=LDCT$->NK$LDCT.LOCK);
      987     9570    2        IF FCN = MFC_READ
      988     9571    2        THEN
      989     9572    2             CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM) ALTRET (BRKCK)
              9572                      ;
      990     9573    2        ELSE
      991     9574    2             CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSPRM,K$RWPARM) ALTRET (BRKCK)
              9574                      ;
      992     9575
      993     9576        /* SS unlock LDCT$->NK$LDCT.LOCK */
      994     9577    2        IF ENTFLG ~= %DCB#
      995     9578    2        THEN
      996     9579    2             CALL SSR$REG(%SS_CW,LDCT$) ALTRET(REGALT);
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:38   
      997     9580    2        ELSE
      998     9581    2             CALL SSR$REG (%SS_CRD,LDCT$) ALTRET(REGALT);
      999     9582             %LOCK (G=LDCT$->NK$LDCT.LOCK);
     1000     9585    2   READ_IT: ;
     1001     9586    2        K$RWPARM.IP$ = LDCT$->LDCT.IP$;
     1002     9587    2        LDCT$->LDCT.IP$ = ADDR(NIL);
     1003     9588    2        IF K$RWPARM.IP$ = ADDR(NIL)
     1004     9589    2        THEN GOTO BRKCK;
     1005     9590    2        CALL KIQ$MAPFEP (LDCT$->NK$LDCT.IPFEI#);
     1006     9591    2        K$RWPARM.UHDR$ = PINCRC(K$RWPARM.IP$,K$RWPARM.IP$->KI$QMHDR.OFFSET);
     1007     9592    2        K$RWPARM.UHDRSZ = K$RWPARM.IP$->KI$QMHDR.SIZE;
     1008     9593    2        K$RWPARM.TYC = '0'B;
     1009     9594    2        CALL KIA$MSG (K$RWPARM);
     1010     9595    2        IF MSGSZ<K$RWPARM.MSGSZ THEN K$RWPARM.TYC=K$RWPARM.TYC|%TYC_DI|%TYC_EGV;
     1011     9596    2        ELSE MSGSZ=K$RWPARM.MSGSZ;
     1012     9597    2        IF ENTFLG=%DCB#
     1013     9598    2        THEN DCB$->F$DCB.ARS=MSGSZ;
     1014     9599    2        ELSE BUFLEN=MSGSZ;
     1015     9600    2        IF K$RWPARM.MSG$ ~= ADDR(NIL)
     1016     9601    3        THEN DO;
     1017     9602    3             CALL HFF$TRAPALT ALTRET (BADRBUF);
     1018     9603    3             MSG$->VCHRM = K$RWPARM.MSG$->VCHRM;
     1019     9604    3           END;
     1020     9605    2        IF K$RWPARM.KEY$ ~= ADDR(NIL) AND FPT$ ~= ADDR(NIL) AND FPT$->FPT$READ_V.KEYR
     1021     9606    3        THEN DO;
     1022     9607    3             CALL HFF$TRAPALT ALTRET (BADRBUF);
     1023     9608    3             CALL HFF$DSIZ(1,USRKEYSZ);
     1024     9609    3             B$PS1$->USRKEY = K$RWPARM.KEY$->KEY;
     1025     9610    3           END;
     1026     9611    2   TRTNR: ;
     1027     9612    2        B$JIT.ERR = K$RWPARM.MSG_ERRCODE;
     1028     9613    2        K$RWPARM.LDCT$ = LDCT$;
     1029     9614    2        K$RWPARM.FUNCTION = %K_READDONE;
     1030     9615    2        CALL KIS$SEND (K$RWPARM) ALTRET(BRKCK);
     1031     9616    2        IF LDCT$->LDCT.LKFLG.WTMRK
     1032     9617    2        THEN
     1033     9618    2             CALL SSR$REG(%SS_CW,LDCT$);
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:39   
     1034     9619    2        ELSE
     1035     9620                  %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
     1036     9623    2        IF K$RWPARM.TYC&%TYC_DISC
     1037     9624    3        THEN DO;
     1038     9625    3             K$RWPARM.TYC='0'B;
     1039     9626    3             ALTRETURN;
     1040     9627    3           END;
     1041     9628    2        RETURN;
     1042     9629
     1043     9630
     1044     9631    2   BADRBUF: ;
     1045     9632    2        K$RWPARM.TYC = %TYC_MTRAP | %TYC_EGV;
     1046     9633    2        GOTO TRTNR;
     1047     9634    2   REGALT: ;
     1048     9635             %LOCK (G=LDCT$->NK$LDCT.LOCK);
     1049     9638    2        IF NOT LDCT$->LDCT.LKFLG.MRKPND    /* Pending marker from brk  */
     1050     9639    3        THEN DO;
     1051     9640    3             IF LDCT$->LDCT.IP$ ~= ADDR(NIL)
     1052     9641    3             THEN
     1053     9642    3                  GOTO READ_IT;
     1054     9643    3             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
     1055     9644    3             LDCT$->LDCT.LKFLG.WTMRK = '1'B;
     1056     9645    3             K$RWPARM.MAXNMBRCR = 0;
     1057     9646    3             CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM) ALTRET(BRKCK);
     1058     9647        /* SS unlocks LDCT$->LDCT.LOCK */
     1059     9648    3             CALL SSR$REG (%SS_CW,LDCT$);
     1060     9649                  %LOCK (G=LDCT$->LDCT.LOCK);
     1061     9652    3           END;
     1062     9653    2        IF LDCT$->LDCT.IP$ ~= ADDR(NIL)
     1063     9654    2        THEN
     1064     9655    2             GOTO READ_IT;
     1065     9656    2   BRKCK: ;
     1066     9657             %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
     1067     9660    2        IF K$RWPARM.ERR~=0
     1068     9661    2        THEN
     1069     9662    2             ALTRETURN;
     1070     9663    2        IF S$CU$->B$U.ASYNCH&%(~U_RESET)='0'B
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:40   
     1071     9664    2        THEN
     1072     9665    2             CALL SC_ICQLST;
     1073     9666        /*S*  SCREECH_CODE:  KIA-S$ICQLDT
     1074     9667              TYPE:          Screech
     1075     9668              MESSAGE:       FEP input circular queue data inconsistancy
     1076     9669              REMARKS:       When timesharing input data is recieved into the
     1077     9670                             ICQ at interrupt time it is left there to be picked
     1078     9671                             up in this code while running on behalf of the user.
     1079     9672                             This screech occurs when the user is unREGed for
     1080     9673                             other than asynchronous (break,etc.) reasons and his
     1081     9674                             data cannot be found.  This suggests that the ICQ
     1082     9675                             has been clobbered in some way or the scheduler is
     1083     9676                             sick.  Experience suggests checking SCHED first.        */
     1084     9677    2   ALTRT: ;
     1085     9678    2        ALTRETURN;
     1086     9679    2   END READS;
     1087     9680
     1088     9681        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:41   
     1089     9682
     1090     9683    1   END KIA$UCIOND;
     1091     9684
     1092     9685
     1093     9686        %EOD;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:42   
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KV_ERRORS_C.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI$MHDR.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$UCIOND.

   Procedure KIA$UCIOND requires 1743 words for executable code.
   Procedure KIA$UCIOND requires 80 words of local(AUTO) storage.
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:43   

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:44   

 Object Unit name= KIA$UCIOND                                 File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:30:52.36 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     20     24  KIA$UCIOND
    1   Proc  even  none  1743   3317  KIA$UCIOND
    2  RoData even  none    29     35  KIA$UCIOND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        7  KIA$UCIOND
     1     31          yes     yes      Std        4  KIA$UCIOD
     1     34          yes     yes      Std        5  KIA$UCIO
     1   2232          yes     yes      Std        3  KIA$CLSSTR
     1   2322          yes     yes      Std        1  KIA$OPNSSN
     1   2355          yes     yes      Std        2  KIA$DCLSTR
     1   2425          yes     yes      Std        2  KIA$REDSTR
     1   2437          yes     yes      Std        2  KIA$OPNSTR
     1   2557          yes     yes      Std        2  KIA$WINDOW

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  KIA_TCTLMAX                        0      6  KIA_NODAT
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:45   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 SSR$REG
 yes     yes           Std       5 MMS$SETUP_BUF
         yes           Std       1 FMO$GETDOMAIN
 yes     yes           Std       1 HFF$WRITE1
 yes     yes           Std       2 FSN$CONV_STR
         yes           Std       1 HFC$LOCK
 yes     yes           Std       3 KIA$FCNOU
 yes     yes           Std       1 HFF$NILERASE
         yes           Std       2 HFF$DSIZ
 yes     yes           Std       1 KIS$SEND
         yes           Std       1 KIQ$MAPFEP
         yes           Std       3 KIA$9TO8
 yes     yes           Std       0 UMD$DPMT
         yes           Std       2 NKA$EVENT
 yes     yes           Std       2 KIA$WRITE_USER
 yes     yes           Std       1 KIA$OQFL
 yes     yes           Std       2 UMD$DOU
         yes           Std       2 KIA$COMP
 yes     yes           Std       1 UMD$DIN
 yes     yes           Std       1 KIA$MSG
 yes     yes           Std       0 HFF$TRAPALT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_N
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:46   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BTSFCN                             SC_NTSDCTI                            SC_ICQLST
     N$DCT$$                          r    B$XL_UR$                         r    B$XL_UPPER_UR$
     KI_FEI$$                              S$CU$                            r    K_RWPARM_CON
r    B$CGCTXT$                        r    B$JIT$                           r    B$PS1$
r    B$ROSEG$                         r    B$M$UC$                               NI_MFGATE
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:47   


        1        1        /*M* KIA$APPLC - Application layer service routines*/
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR,PLM=5,IND=5,CTI=5,SDI=5,MCL=10,CSI=0,ECI=0 */
        8        8
        9        9        /*P*
       10       10             NAME: KIA$APPLC
       11       11             PURPOSE:
       12       12                  The module contains the routines that are the application and
       13       13                  presentation layers of the network.
       14       14             DESCRIPTION:
       15       15                  None.
       16       16        */
       17       17        KIA$UCIOND: PROC (FCN,DVBYTE,VFC,EVENT,BUF$,BUFLEN,NDLDCT) ALTRET;

     17  1 000000   000000 700200 xent  KIA$UCIOND   TSX0  ! X66_AUTO_N
         1 000001   000120 000007                    ZERO    80,7

       18       18
       19       19        /*F*
       20       20              NAME:        KIA$UCIOND
       21       21              PURPOSE:     To interface with TS terminals with an LDCT$ instead of a DCB
       22       22              INPUT:       FCN - read, write, etc.
       23       23                           DVBYTE
       24       24                           VFC
       25       25                           EVENT
       26       26                           BUF$ - Pointer to the caller's buffer
       27       27                           BUFLEN - Byte length of the caller's buffer
       28       28                           NDLDCT - The caller's LDCT
       29       29              OUTPUT:      Caller's buffer may be filled in if write
       30       30                           DVBYTE
       31       31                           EOMCHAR is passed back in VFC parameter
       32       32                           TYC is passed back in EVENT parameter
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:48   
       33       33                           ARS is passed back in BUFLEN parameter
       34       34              DESCRIPTION: KIA$UCIOND is called passing an LDCT instead of
       35       35                           JIT.DCB$. LDCT, MSGSZ, and UB$ are passed as parameters
       36       36                           instead of via JIT.DCB$. Also DVBYTE, EOMCHAR, TYC
       37       37                           and ARS are passed back as parameters instead of in
       38       38                           JIT.DCB$.                                                 */
       39       39        %PLIST;
       40       40        %INCLUDE B$ROSEG;
       41      103        %INCLUDE B_STRINGS_C;
       42      232        %INCLUDE F$CP6V_C;
       43      458        %INCLUDE NK_LDCT_R;
       44      467        %INCLUDE B$TABLES_C;
       45      575        %B$XL_UR;
       46      579        %B$XL_UPPER_UR;
       47      583        %INCLUDE KI_DATA_R;
       48      609        %INCLUDE B$USER;
       49      825        %B$USERREFS;
       50      829        %INCLUDE B$JIT_C;
       51     1143        %B$JIT0;
       52     1232        %U$JIT1;
       53     1306        %M$JIT2X;
       54     1309        %F$JIT3;
       55     1314        %S$JIT4X;
       56     1317        %J$JIT5;
       57     1405        %A$JIT6;
       58     1415        %INCLUDE NK$LDCT;
       59     1517        %INCLUDE F$DCB;
       60     1566        %INCLUDE KI$MHDR;
       61     1707        %INCLUDE KV$VDO;
       62     2722        %INCLUDE KI$CP6V_C;
       63     3161        %INCLUDE KV_GLBCNS_E;
       64     3502        %INCLUDE KV_PRMID_E;
       65     3676        %INCLUDE HF_LOCK_C;
       66     3690        %INCLUDE F_FPTCODE_C;
       67     3726        %INCLUDE CP_6_SUBS;
       68     4266        %INCLUDE SS_SCHED_C;
       69     4499        %INCLUDE NK_SUBS;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:49   
       70     4524        %INCLUDE KI_SUBS_C;
       71     4660        %INCLUDE K_SUBS_C;
       72     4693        %INCLUDE K_DATA_R;
       73     5404
       74     5405        %NK$LDCT;
       75     5451        %K$RWPARM (STCLASS="",NAME=K$RWPARM);
       76     5767        %KV_PRMID_E;
       77     5923        %KV_VDO_ALL_E;
       78     6002        %KV#VD_ORG_E;
       79     6010        %FPT$READ_V;
       80     6017        %FPT$WRITE_V;
       81     6023    1   DCL USRKEY CHAR(USRKEYSZ) BASED;
       82     6024    1   DCL KEY CHAR(K$RWPARM.KEYSZ) BASED;
       83     6025    1   DCL USRKEYSZ UBIN;
       84     6026    1   DCL 1 FEPSIZ REDEF USRKEYSZ,
       85     6027    1            2 BUF UBIN(18) UNAL,
       86     6028    1            2 KEY UBIN(18) UNAL;
       87     6029    1   DCL DCB_FCN_CNT0 REDEF USRKEYSZ UBIN;
       88     6030    1   DCL 1 NOWAIT,
       89     6031    1            2 KEYTYP UBIN(6) UNAL,
       90     6032    1            2 DMN UBIN(3) UNAL,
       91     6033    1            2 STREAM UBIN(9) UNAL,
       92     6034    1            2 DCB# UBIN(9) UNAL,
       93     6035    1            2 * UBIN(9) UNAL;
       94     6036    1   DCL 1 FEPIO,
       95     6037    1            2 EVENT SBIN,
       96     6038    1            2 KEYX SBIN(18) UNAL,
       97     6039    1            2 BUFX SBIN(18) UNAL,
       98     6040    1            2 BPP(0:1) BIT(18) UNAL,
       99     6041    1            2 KPP(0:1) BIT(18) UNAL;
      100     6042    1   DCL 1 PTW(0:1),
      101     6043    1            2 PP BIT(18) ALIGNED;
      102     6044    1   DCL FPT$ PTR;
      103     6045        %KV$VDO_PRM (STCLASS="BASED(K$RWPARM.UHDR$)");
      104     6086        %KV$VDO_DAT (STCLASS="BASED(K$RWPARM.UHDR$)");
      105     6131        %KV$VDO_RQSDAT (STCLASS="BASED(K$RWPARM.UHDR$)");
      106     6179        %KV$VDO_RQSPRM (STCLASS="BASED(K$RWPARM.UHDR$)");
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:50   
      107     6222        %KI$QMHDR;
      108     6271        %KV$VDOVLP_DAT1;
      109     6321        %KV$VDOVLP_DAT2;
      110     6371        %KV$VDOVLP_MRK;
      111     6424        %KV$VDO_MRK (NAME=KV$VDO_MRKRSP,STCLASS="BASED(K$RWPARM.UHDR$)",LAST=",");
      112     6465        %KV$VDOVLP_MRK (NAME=MRKR,LVL=2);
      113     6518        %VLP$WINDOW_V;
      114     6540        %VLP$WINDOW_V(FPTN=WINDOW,ALGN=CALIGNED);
      115     6562        %K$RWPARM (NAME=KI$RWPARM,STCLASS=BASED);
      116     6878
      117     6879        /* Symrefs */
      118     6880
      119     6881    1   DCL FCN UBIN WORD;
      120     6882    1   DCL FCN1 UBIN WORD;
      121     6883    1   DCL DVBYTE BIT(9) CALIGNED;
      122     6884    1   DCL TFCN REDEF DVBYTE UBIN(9) CALIGNED;
      123     6885    1   DCL DVBYTE1 BIT(9);
      124     6886    1   DCL VFC CHAR(1) UNAL;
      125     6887    1   DCL EOMCHAR REDEF VFC CHAR(1);
      126     6888    1   DCL PCODE REDEF VFC UBIN BYTE UNAL;
      127     6889    1   DCL 1 SPREAD BASED UNAL ,
      128     6890    1            2 HI UBIN(10) UNAL ,
      129     6891    1            2 LO8 UBIN(8) UNAL ;
      130     6892    1   DCL EVENT UBIN WORD;
      131     6893    1   DCL TYC REDEF EVENT BIT(36);
      132     6894    1   DCL BUF$ PTR;
      133     6895    1   DCL BUFLEN UBIN;
      134     6896    1   DCL NDLDCT UBIN;    /* Actually an LDCT, but its address is copied to LDCT$ */
      135     6897    1   DCL ENTFLG UBIN;
      136     6898        %EQU DCB#=0;
      137     6899        %EQU NODCB#=1;
      138     6900    1   DCL MSG$ PTR;
      139     6901    1   DCL TDVB BIT(36) ALIGNED;
      140     6902    1   DCL MSGSZ UBIN WORD;
      141     6903    1   DCL 1 MSZ REDEF MSGSZ,
      142     6904        %INCLUDE UM_CP6;
      143     7756    1            2 TOP UBIN(28) UNAL,
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:51   
      144     7757    1            2 BOT UBIN(8) UNAL;
      145     7758    1   DCL DCB$ PTR;
      146     7759    1   DCL LDCT$ PTR;
      147     7760    1   DCL PFCN UBIN WORD;
      148     7761    1   DCL B$CGCTXT$ PTR SYMREF READONLY;
      149     7762    1   DCL B$JIT$ PTR SYMREF READONLY;
      150     7763    1   DCL B$PS1$ PTR SYMREF READONLY;
      151     7764    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      152     7765    1   DCL B$M$UC$ PTR SYMREF READONLY;
      153     7766    1   DCL KIA_TCTLMAX SBIN CONSTANT SYMDEF INIT(16);
      154     7767    1   DCL NI_MFGATE BIT(72) SYMREF;
      155     7768    1   DCL PFB UBIN WORD;
      156     7769    1   DCL MSGSZT REDEF PFB UBIN WORD;
      157     7770    1   DCL 1 MSZT REDEF PFB,
      158     7771    1            2 T UBIN(28) UNAL,
      159     7772    1            2 B UBIN(8) UNAL;
      160     7773    1   DCL VCHRM CHAR(MSGSZ) BASED CALIGNED;
      161     7774    1   DCL STR UBIN BASED;
      162     7775    1   DCL STRID UBIN BASED;
      163     7776    1   DCL DLTSTR BIT(1) BASED;
      164     7777    1   DCL NEWSSN BIT(1) BASED;
      165     7778    1   DCL RPTR$ PTR;
      166     7779    1   DCL WINDOW$ PTR BASED;
      167     7780    1   DCL 1 VSIN ,
      168     7781    1            2 PFB UBIN BYTE CALIGNED,
      169     7782    1            2 RFU UBIN BYTE CALIGNED,
      170     7783    1            2 POS UBIN(18) CALIGNED,
      171     7784    1            2 POSL6 REDEF POS,
      172     7785    1                 3 T BIT(9), 3 * BIT(9),
      173     7786    1            2 POSL66 REDEF POS,
      174     7787    1                 3 T BIT(10), 3 * BIT(8);
      175     7788
      176     7789        /* Entry point references */
      177     7790    1   DCL FMO$GETDOMAIN ENTRY(1);
      178     7791    1   DCL KIA$COMP ENTRY(2);
      179     7792    1   DCL FSN$CONV_STR ENTRY(2) ALTRET;
      180     7793    1   DCL KIQ$MAPFEP ENTRY(1);
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:52   
      181     7794    1   DCL KIA$9TO8 ENTRY(3);
      182     7795    1   DCL KIA$FCNOU ENTRY(3) ALTRET;
      183     7796    1   DCL KIA$OQFL ENTRY(1) ALTRET;
      184     7797    1   DCL KIA$MSG ENTRY(1) ALTRET;
      185     7798    1   DCL KIA$WRITE_USER ENTRY(2) ALTRET;
      186     7799    1   DCL KIS$SEND ENTRY(1) ALTRET;
      187     7800    1   DCL SSR$REG ENTRY(3) ALTRET;
      188     7801    1   DCL HFF$DSIZ ENTRY(2);
      189     7802    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      190     7803    1   DCL HFF$TRAPALT ENTRY ALTRET;
      191     7804    1   DCL HFF$WRITE1 ENTRY(1) ALTRET;
      192     7805    1   DCL MMS$SETUP_BUF ENTRY(5) ALTRET;
      193     7806    1   DCL NKA$EVENT ENTRY(2);
      194     7807    1   DCL UMD$DIN ENTRY(1) ALTRET;
      195     7808    1   DCL UMD$DPMT ENTRY ALTRET;
      196     7809    1   DCL UMD$DOU ENTRY(2) ALTRET;
      197     7810
      198     7811    1   DCL SC_NTSDCTI ENTRY CONV(2,0);
      199     7812    1   DCL SC_NTSLCL ENTRY CONV(2,0);
      200     7813    1   DCL SC_BTSFCN ENTRY CONV(2,0);
      201     7814    1   DCL SC_ICQLST ENTRY CONV(2,0);
      202     7815
      203     7816        %INCLUDE KI_ERRORS_C;
      204     7901        %INCLUDE KV_ERRORS_C;
      205     7961        %INCLUDE F_ERRORS_C;
      206     8201        %INCLUDE UD_SEV_C;
      207     8215        %MACRO ERRCODE( NAME=ERRDUMMY, CODE=0, STC=CONSTANT, SL=SEV_CONT#);
      208     8216            %VLP_ERRCODE( FPTN=NAME, STCLASS=STC, FCG='KI', MID='A',
      209     8217                          MON='1'B, ERR#=CODE, SEV=SL);
      210     8218        %MEND;
      211     8219            %ERRCODE( NAME=BADFMT, CODE=%E$BADFMT, SL=SEV_ABORT#);
      212     8267            %ERRCODE( NAME=BYD, CODE=%E$BYD);
      213     8315            %ERRCODE( NAME=BYDR, CODE=%E$BYDR);
      214     8363            %ERRCODE( NAME=DELRECER, CODE=%E$RECORD_DELETED, SL=0);
      215     8411            %ERRCODE( NAME=EOFERR, CODE=%E$EOF, SL=0);
      216     8459            %ERRCODE( NAME=KIA_NODAT, CODE=%E$NODAT, STC="CONSTANT SYMDEF");
      217     8507            %ERRCODE( NAME=LDSC, CODE=%E$LDSC, SL=SEV_ABORT#);
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:53   
      218     8555            %ERRCODE( NAME=MTRAPERR, CODE=%E$MTRAP, SL=7);
      219     8603            %ERRCODE( NAME=NOFPRG, CODE=%E$NOFPRG, SL=SEV_ABORT#);
      220     8651            %ERRCODE( NAME=NORES, CODE=%E$NOFEPRES, SL=SEV_ABORT#);
      221     8699            %ERRCODE( NAME=XTRARD, CODE=%E$XTRARD);
      222     8747        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:54   
      223     8748    1        ENTFLG=%NODCB#;

   8748  1 000002   000001 235007                    LDA     1,DL
         1 000003   200075 755100                    STA     ENTFLG,,AUTO

      224     8749    1        DCB$=ADDR(NIL);               /* So we trap if I screwed up coding this */

   8749  1 000004   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000005   200101 756100                    STQ     DCB$,,AUTO

      225     8750    1        FPT$ = ADDR(NIL);

   8750  1 000006   200072 756100                    STQ     FPT$,,AUTO

      226     8751    1        LDCT$=ADDR(NDLDCT);

   8751  1 000007   200011 236100                    LDQ     @NDLDCT,,AUTO
         1 000010   200102 756100                    STQ     LDCT$,,AUTO

      227     8752    1        MSGSZ=BUFLEN;

   8752  1 000011   200010 470500                    LDP0    @BUFLEN,,AUTO
         1 000012   000000 235100                    LDA     0,,PR0
         1 000013   200100 755100                    STA     MSGSZ,,AUTO

      228     8753    1        MSG$=BUF$;

   8753  1 000014   200007 471500                    LDP1    @BUF$,,AUTO
         1 000015   100000 236100                    LDQ     0,,PR1
         1 000016   200076 756100                    STQ     MSG$,,AUTO

      229     8754    1        PFB = KIDM_MON;

   8754  1 000017   000177 235007                    LDA     127,DL
         1 000020   200104 755100                    STA     PFB,,AUTO

      230     8755    1        IF LDCT$->NK$LDCT.RESCOD=NK_RES
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:55   

   8755  1 000021   200102 473500                    LDP3    LDCT$,,AUTO
         1 000022   300006 236100                    LDQ     6,,PR3
         1 000023   000017 376007                    ANQ     15,DL
         1 000024   000013 116007                    CMPQ    11,DL
         1 000025   000030 601000 1                  TNZ     s:8757

      231     8756    1        THEN PFB = KIDM_CP;

   8756  1 000026   000001 235007                    LDA     1,DL
         1 000027   200104 755100                    STA     PFB,,AUTO

      232     8757    1        GOTO CMN;

   8757  1 000030   000101 710000 1                  TRA     CMN

      233     8758
      234     8759
      235     8760        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:56   
      236     8761    1   KIA$UCIOD: ENTRY (FCN,DVBYTE,VFC,EVENT) ALTRET;

   8761  1 000031   000000 700200 xent  KIA$UCIOD    TSX0  ! X66_AUTO_N
         1 000032   000120 000007                    ZERO    80,7
         1 000033   000036 710000 1                  TRA     s:8774

      237     8762
      238     8763        /*F*
      239     8764             NAME: KIA$UCIOD
      240     8765             PURPOSE:
      241     8766                  This routine is the read and write interface for TS terminals.
      242     8767             DESCRIPTION:
      243     8768                  KIA$UCIOD is called from FSE$FORMAT whenever there is a write
      244     8769                  or read to a time sharing terminal It is also called from
      245     8770                  KIP$PMME when a terminal control function needs to be performed.
      246     8771        */
      247     8772
      248     8773    1   KIA$UCIO: ENTRY (FCN,DVBYTE,VFC,EVENT,BUF$) ALTRET;

   8773  1 000034   000000 700200 xent  KIA$UCIO     TSX0  ! X66_AUTO_N
         1 000035   000120 000007                    ZERO    80,7

      249     8774    1        IF ADDR(BUF$)=ADDR(NIL) THEN

   8774  1 000036   200007 236100                    LDQ     @BUF$,,AUTO
         1 000037   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000040   000044 601000 1                  TNZ     s:8777

      250     8775    1             FPT$=ADDR(NIL);

   8775  1 000041   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000042   200072 756100                    STQ     FPT$,,AUTO
         1 000043   000047 710000 1                  TRA     s:8779

      251     8776    1        ELSE
      252     8777    1             FPT$=BUF$;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:57   
   8777  1 000044   200007 470500                    LDP0    @BUF$,,AUTO
         1 000045   000000 236100                    LDQ     0,,PR0
         1 000046   200072 756100                    STQ     FPT$,,AUTO

      253     8778
      254     8779    1        ENTFLG=%DCB#;

   8779  1 000047   200075 450100                    STZ     ENTFLG,,AUTO

      255     8780    1        DCB$=B$JIT$->B$JIT.DCB$;

   8780  1 000050   000000 470400 xsym               LDP0    B$JIT$
         1 000051   000232 236100                    LDQ     154,,PR0
         1 000052   200101 756100                    STQ     DCB$,,AUTO

      256     8781    1        IF DCB$->F$DCB.IASN = %STREAM#

   8781  1 000053   200101 471500                    LDP1    DCB$,,AUTO
         1 000054   100103 236100                    LDQ     67,,PR1
         1 000055   000777 376007                    ANQ     511,DL
         1 000056   000005 116007                    CMPQ    5,DL
         1 000057   000066 601000 1                  TNZ     s:8785

      257     8782    1        THEN
      258     8783    1             LDCT$ = NK$LDCT$(DCB$->F$DCB.CFU$->F$DCB.LDCTX);

   8783  1 000060   100066 473500                    LDP3    54,,PR1
         1 000061   300051 220100                    LDX0    41,,PR3
         1 000062   000000 474400 xsym               LDP4    N$DCT$$
         1 000063   400000 236110                    LDQ     0,X0,PR4
         1 000064   200102 756100                    STQ     LDCT$,,AUTO
         1 000065   000072 710000 1                  TRA     s:8786

      259     8784    1        ELSE
      260     8785    1             LDCT$=NK$LDCT$(DCB$->F$DCB.LDCTX);

   8785  1 000066   100051 220100                    LDX0    41,,PR1
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:58   
         1 000067   000000 473400 xsym               LDP3    N$DCT$$
         1 000070   300000 236110                    LDQ     0,X0,PR3
         1 000071   200102 756100                    STQ     LDCT$,,AUTO

      261     8786    1        MSGSZ=DCB$->F$DCB.UBYTES;

   8786  1 000072   100076 235100                    LDA     62,,PR1
         1 000073   200100 755100                    STA     MSGSZ,,AUTO

      262     8787    1        MSG$=DCB$->F$DCB.UB$;

   8787  1 000074   100075 236100                    LDQ     61,,PR1
         1 000075   200076 756100                    STQ     MSG$,,AUTO

      263     8788    1        PFB = DCB$->F$DCB.STR;

   8788  1 000076   100077 236100                    LDQ     63,,PR1
         1 000077   000777 376007                    ANQ     511,DL
         1 000100   200104 756100                    STQ     PFB,,AUTO

   8788  1 000101                       CMN          null
      264     8789
      265     8790
      266     8791        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:59   
      267     8792    1   CMN: ;
      268     8793    1        IF LDCT$=ADDR(NIL)

   8793  1 000101   200102 236100                    LDQ     LDCT$,,AUTO
         1 000102   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000103   000106 601000 1                  TNZ     s:8811

      269     8794    1        THEN
      270     8795    1             CALL SC_NTSDCTI;

   8795  1 000104   000000 713400 xsym               CLIMB   SC_NTSDCTI
         1 000105   000000 600000 xsid               climb   nvectors=         0

      271     8796        /*S*  SCREECH_CODE:  KIA-S$NTSDCT
      272     8797              TYPE:          SUA
      273     8798              MESSAGE:       LDCT for timesharing users terminal lost (during I/O)
      274     8799              REMARKS:       This SUA occurs when LDCTX in a timesharing user's
      275     8800                             M$UC DCB does not point to a valid LDCT entry.  This
      276     8801                             suggests that either the DCB is clobbered or KIA$UCIO
      277     8802                             has been incorrectly called.  The same screech code
      278     8803                             is reported by NKU$UCCLS (NKU-S$NTSDCT) when it
      279     8804                             detects the same problem.                               */
      280     8805
      281     8806        /* If there is a marker pending a break, control Y or disconnect
      282     8807             has come in.  If B$U.ASYNC not reset then return with back IC
      283     8808             set otherwise just send the marker.
      284     8809         */
      285     8810             %LOCK (G=LDCT$->NK$LDCT.LOCK);

   8811  1 000106   200102 236100                    LDQ     LDCT$,,AUTO
         1 000107   000020 036003                    ADLQ    16,DU
         1 000110   200112 756100                    STQ     VSIN+4,,AUTO
         1 000111   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000112   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000113   000000 701000 xent               TSX1    HFC$LOCK
         1 000114   000000 011000                    NOP     0

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:60   
      286     8813    1        IF LDCT$->LDCT.DFLG.FEDN

   8813  1 000115   200102 470500                    LDP0    LDCT$,,AUTO
         1 000116   000006 236100                    LDQ     6,,PR0
         1 000117   000020 316007                    CANQ    16,DL
         1 000120   000134 600000 1                  TZE     s:8826

      287     8814    2        THEN DO;

   8811  1 000121                       DISC         null
      288     8815    2   DISC:     ;
      289     8816    2             B$JIT.ERR=LDSC;

   8816  1 000121   000007 236000 0                  LDQ     LDSC
         1 000122   000000 471400 xsym               LDP1    B$JIT$
         1 000123   100012 756100                    STQ     10,,PR1

      290     8817        /*E*  ERROR:         KIA-E$LDSC-A
      291     8818               MESSAGE: Your timesharing line %thru %DC %is disconnected!
      292     8819              DESCRIPTION:   Only logoff should see this error JIT.BAKIC would
      293     8820                             loop.                                                   */
      294     8821                  %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   8822  1 000124   200102 236100                    LDQ     LDCT$,,AUTO
         1 000125   000020 036003                    ADLQ    16,DU
         1 000126   200112 756100                    STQ     VSIN+4,,AUTO
         1 000127   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000130   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000131   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000132   000000 011000                    NOP     0

      295     8824    2             ALTRETURN;

   8824  1 000133   000000 702200 xent               TSX2  ! X66_AALT

      296     8825    2           END;
      297     8826    1        IF S$CU$->B$U.ASYNCH&%(~U_RESET) AND ENTFLG = %DCB#
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:61   

   8826  1 000134   000000 471400 xsym               LDP1    S$CU$
         1 000135   100001 236100                    LDQ     1,,PR1
         1 000136   000014 376000 0                  ANQ     XTRARD+1
         1 000137   000163 600000 1                  TZE     s:8837
         1 000140   200075 235100                    LDA     ENTFLG,,AUTO
         1 000141   000163 601000 1                  TNZ     s:8837
         1 000142   100000 236100                    LDQ     0,,PR1
         1 000143   000015 376000 0                  ANQ     XTRARD+2
         1 000144   000163 601000 1                  TNZ     s:8837

      298     8827    1             AND NOT S$CU$->B$U.FLG&%U_STIP
      299     8828    2        THEN DO;

      300     8829                  %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   8830  1 000145   200102 236100                    LDQ     LDCT$,,AUTO
         1 000146   000020 036003                    ADLQ    16,DU
         1 000147   200112 756100                    STQ     VSIN+4,,AUTO
         1 000150   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000151   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000152   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000153   000000 011000                    NOP     0

      301     8832    2             B$JIT$->B$JIT.ERR = BYD;

   8832  1 000154   000002 236000 0                  LDQ     BYD
         1 000155   000000 470400 xsym               LDP0    B$JIT$
         1 000156   000012 756100                    STQ     10,,PR0

      302     8833    2             B$JIT$->B$JIT.JUNK = B$JIT$->B$JIT.JUNK | %JJ_BAKIC#;

   8833  1 000157   000315 220100                    LDX0    205,,PR0
         1 000160   001000 260003                    ORX0    512,DU
         1 000161   000315 740100                    STX0    205,,PR0

      303     8834    2             ALTRETURN;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:62   

   8834  1 000162   000000 702200 xent               TSX2  ! X66_AALT

      304     8835    2           END;
      305     8836
      306     8837    1        IF LDCT$->LDCT.LKFLG.MRKPND

   8837  1 000163   000011 234100                    SZN     9,,PR0
         1 000164   000210 605000 1                  TPL     s:8847

      307     8838    2        THEN DO;

      308     8839    2             K$RWPARM = K_RWPARM_CON;

   8839  1 000165   000100 100400                    MLR     fill='000'O
         1 000166   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000167   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      309     8840    2             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_MRK;

   8840  1 000170   003000 236007                    LDQ     1536,DL
         1 000171   200052 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      310     8841    2             K$RWPARM.MARKER = LDCT$->LDCT.MARKER;

   8841  1 000172   000001 236100                    LDQ     1,,PR0
         1 000173   200021 756100                    STQ     K$RWPARM+7,,AUTO

      311     8842    2             CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_MRK,K$RWPARM) ALTRET(BRKOUT);

   8842  1 000174   200012 633500                    EPPR3   K$RWPARM,,AUTO
         1 000175   200114 453500                    STP3    VSIN+6,,AUTO
         1 000176   000001 236000 2                  LDQ     1
         1 000177   200102 235100                    LDA     LDCT$,,AUTO
         1 000200   200112 757100                    STAQ    VSIN+4,,AUTO
         1 000201   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000202   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:63   
         1 000203   000000 701000 xent               TSX1    KIA$FCNOU
         1 000204   002163 702000 1                  TSX2    BRKOUT

      312     8843    2             LDCT$->LDCT.LKFLG.MRKPND = '0'B;

   8843  1 000205   200102 470500                    LDP0    LDCT$,,AUTO
         1 000206   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000207   000011 356100                    ANSQ    9,,PR0

      313     8844    2           END;

      314     8845
      315     8846             %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   8847  1 000210   200102 236100                    LDQ     LDCT$,,AUTO
         1 000211   000020 036003                    ADLQ    16,DU
         1 000212   200112 756100                    STQ     VSIN+4,,AUTO
         1 000213   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000214   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000215   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000216   000000 011000                    NOP     0

      316     8849
      317     8850
      318     8851
      319     8852    1   RESTART:
      320     8853    1        K$RWPARM = K_RWPARM_CON;

   8853  1 000217   000100 100400       RESTART      MLR     fill='000'O
         1 000220   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000221   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      321     8854    1        DVBYTE1 = DVBYTE;

   8854  1 000222   200004 470500                    LDP0    @DVBYTE,,AUTO
         1 000223   000100 100500                    MLR     fill='000'O
         1 000224   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:64   
         1 000225   200074 000001                    ADSC9   DVBYTE1,,AUTO            cn=0,n=1

      322     8855    1        K$RWPARM.DVE.DVBYTE = DVBYTE1;

   8855  1 000226   200074 236100                    LDQ     DVBYTE1,,AUTO
         1 000227   200022 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

      323     8856    1        K$RWPARM.DVE.VFC = VFC;

   8856  1 000230   200005 471500                    LDP1    @VFC,,AUTO
         1 000231   040100 100500                    MLR     fill='040'O
         1 000232   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000233   200022 200001                    ADSC9   K$RWPARM+8,,AUTO         cn=1,n=1

      324     8857    1        K$RWPARM.STR = PFB;

   8857  1 000234   200104 236100                    LDQ     PFB,,AUTO
         1 000235   200052 552104                    STBQ    K$RWPARM+32,'04'O,AUTO

      325     8858    1        IF FPT$ ~= ADDR(NIL)

   8858  1 000236   200072 236100                    LDQ     FPT$,,AUTO
         1 000237   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000240   000261 600000 1                  TZE     s:8865

      326     8859    1        THEN
      327     8860    1             IF DCB$->F$DCB.ORG=%SE# OR FPT$->FPT$WRITE_V.KEYTYPE = 0

   8860  1 000241   200101 473500                    LDP3    DCB$,,AUTO
         1 000242   300032 236100                    LDQ     26,,PR3
         1 000243   777000 376003                    ANQ     -512,DU
         1 000244   027000 116003                    CMPQ    11776,DU
         1 000245   000252 600000 1                  TZE     s:8862
         1 000246   200072 474500                    LDP4    FPT$,,AUTO
         1 000247   400000 236100                    LDQ     0,,PR4
         1 000250   000017 316007                    CANQ    15,DL
         1 000251   000256 601000 1                  TNZ     s:8864
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:65   

      328     8861    1             THEN
      329     8862    1                  K$RWPARM.KEYTYPE = DCB$->F$DCB.KEYTYPE;

   8862  1 000252   300056 236100                    LDQ     46,,PR3
         1 000253   000011 772000                    QRL     9
         1 000254   200060 552110                    STBQ    K$RWPARM+38,'10'O,AUTO
         1 000255   000261 710000 1                  TRA     s:8865

      330     8863    1             ELSE
      331     8864    1                  K$RWPARM.KEYTYPE = FPT$->FPT$WRITE_V.KEYTYPE;

   8864  1 000256   000017 376007                    ANQ     15,DL
         1 000257   000011 736000                    QLS     9
         1 000260   200060 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      332     8865    1        IF MSGSZ<=4096

   8865  1 000261   200100 235100                    LDA     MSGSZ,,AUTO
         1 000262   010001 115007                    CMPA    4097,DL
         1 000263   000266 603000 1                  TRC     s:8869

      333     8866    1        THEN
      334     8867    1             K$RWPARM.TYC='0'B;

   8867  1 000264   200020 450100                    STZ     K$RWPARM+6,,AUTO
         1 000265   000273 710000 1                  TRA     s:8872

      335     8868    2        ELSE DO;

      336     8869    2             MSGSZ=4096;

   8869  1 000266   010000 236007                    LDQ     4096,DL
         1 000267   200100 756100                    STQ     MSGSZ,,AUTO

      337     8870    2             K$RWPARM.TYC=%TYC_LD|%TYC_EGV;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:66   
   8870  1 000270   000016 236000 0                  LDQ     XTRARD+3
         1 000271   000030 276000 xsym               ORQ     B_VECTNIL+24
         1 000272   200020 756100                    STQ     K$RWPARM+6,,AUTO

      338     8871    2           END;

      339     8872    1        K$RWPARM.MAXNMBBYT = MSGSZ + 40;

   8872  1 000273   200100 720100                    LXL0    MSGSZ,,AUTO
         1 000274   000050 621010                    EAX1    40,X0
         1 000275   200053 441100                    SXL1    K$RWPARM+33,,AUTO

      340     8873    1        K$RWPARM.MAXRCRBYTSIZ = MSGSZ;

   8873  1 000276   200100 722100                    LXL2    MSGSZ,,AUTO
         1 000277   200054 742100                    STX2    K$RWPARM+34,,AUTO

      341     8874    1        K$RWPARM.MAXNMBRCR = 1;

   8874  1 000300   000001 223003                    LDX3    1,DU
         1 000301   200053 743100                    STX3    K$RWPARM+33,,AUTO

      342     8875
      343     8876
      344     8877    1        FCN1 = FCN ;

   8877  1 000302   200003 473500                    LDP3    @FCN,,AUTO
         1 000303   300000 235100                    LDA     0,,PR3
         1 000304   200073 755100                    STA     FCN1,,AUTO

      345     8878    2        DO CASE (FCN1);

   8878  1 000305   000017 115007                    CMPA    15,DL
         1 000306   000310 602005 1                  TNC     s:8878+3,AL
         1 000307   002102 710000 1                  TRA     s:9316
         1 000310   000755 710000 1                  TRA     s:9025
         1 000311   000403 710000 1                  TRA     WRT1
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:67   
         1 000312   000327 710000 1                  TRA     s:8881
         1 000313   002102 710000 1                  TRA     s:9316
         1 000314   002102 710000 1                  TRA     s:9316
         1 000315   002102 710000 1                  TRA     s:9316
         1 000316   002102 710000 1                  TRA     s:9316
         1 000317   000344 710000 1                  TRA     s:8888
         1 000320   002102 710000 1                  TRA     s:9316
         1 000321   001770 710000 1                  TRA     s:9282
         1 000322   000403 710000 1                  TRA     WRT1
         1 000323   000403 710000 1                  TRA     WRT1
         1 000324   001776 710000 1                  TRA     s:9288
         1 000325   000403 710000 1                  TRA     WRT1
         1 000326   000347 710000 1                  TRA     s:8892

      346     8879        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:68   
      347     8880    2        CASE (MFC_DELREC);

      348     8881    2           K$RWPARM.MSG_ERRCODE = DELRECER;

   8881  1 000327   000004 236000 0                  LDQ     DELRECER
         1 000330   200051 756100                    STQ     K$RWPARM+31,,AUTO

      349     8882    2           K$RWPARM.KEYTYPE = DCB$->F$DCB.KEYTYPE;

   8882  1 000331   200101 474500                    LDP4    DCB$,,AUTO
         1 000332   400056 236100                    LDQ     46,,PR4
         1 000333   000011 772000                    QRL     9
         1 000334   200060 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      350     8883    2           DVBYTE1 = DVBYTE1|%DVBYTE_TRANS#;

   8883  1 000335   200074 236100                    LDQ     DVBYTE1,,AUTO
         1 000336   777000 376003                    ANQ     -512,DU
         1 000337   020000 276003                    ORQ     8192,DU
         1 000340   200074 756100                    STQ     DVBYTE1,,AUTO

      351     8884    2           K$RWPARM.CVTDAT = '1'B;

   8884  1 000341   100000 236007                    LDQ     32768,DL
         1 000342   200022 256100                    ORSQ    K$RWPARM+8,,AUTO

      352     8885    2           GOTO WRT1;

   8885  1 000343   000403 710000 1                  TRA     WRT1

      353     8886        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:69   
      354     8887    2        CASE (MFC_WEOF);

      355     8888    2           K$RWPARM.MSG_ERRCODE = EOFERR;

   8888  1 000344   000005 236000 0                  LDQ     EOFERR
         1 000345   200051 756100                    STQ     K$RWPARM+31,,AUTO

      356     8889    2           GOTO WRT1;

   8889  1 000346   000403 710000 1                  TRA     WRT1

      357     8890        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:70   
      358     8891    2        CASE (MFC_WRIMD);

      359     8892    2           K$RWPARM.MSG$ = MSG$;

   8892  1 000347   200076 236100                    LDQ     MSG$,,AUTO
         1 000350   200012 756100                    STQ     K$RWPARM,,AUTO

      360     8893    2           K$RWPARM.MSGSZ = MSGSZ;

   8893  1 000351   200100 235100                    LDA     MSGSZ,,AUTO
         1 000352   200013 755100                    STA     K$RWPARM+1,,AUTO

      361     8894                %LOCK(G=LDCT$->LDCT.LOCK);

   8895  1 000353   200102 236100                    LDQ     LDCT$,,AUTO
         1 000354   000020 036003                    ADLQ    16,DU
         1 000355   200112 756100                    STQ     VSIN+4,,AUTO
         1 000356   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000357   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000360   000000 701000 xent               TSX1    HFC$LOCK
         1 000361   000000 011000                    NOP     0

      362     8897    2           CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_DAT_IMD,K$RWPARM) ALTRET(BRKOUT);

   8897  1 000362   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 000363   200114 450500                    STP0    VSIN+6,,AUTO
         1 000364   000002 236000 2                  LDQ     2
         1 000365   200102 235100                    LDA     LDCT$,,AUTO
         1 000366   200112 757100                    STAQ    VSIN+4,,AUTO
         1 000367   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000370   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000371   000000 701000 xent               TSX1    KIA$FCNOU
         1 000372   002163 702000 1                  TSX2    BRKOUT

      363     8898                %UNLOCK (G=LDCT$->LDCT.LOCK);

   8899  1 000373   200102 236100                    LDQ     LDCT$,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:71   
         1 000374   000020 036003                    ADLQ    16,DU
         1 000375   200112 756100                    STQ     VSIN+4,,AUTO
         1 000376   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000377   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000400   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000401   000000 011000                    NOP     0
         1 000402   002104 710000 1                  TRA     CSEND

      364     8901
      365     8902        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:72   
      366     8903    2        CASE (MFC_WRITE,MFC_WRUR,MFC_WRBIN,MFC_WRURUC);

      367     8904    2   WRT1:   ;

   8904  1 000403                       WRT1         null
      368     8905    3           IF LDCT$->LDCT.LKFLG.FPSTEP AND ENTFLG=%DCB# THEN DO;

   8905  1 000403   200102 474500                    LDP4    LDCT$,,AUTO
         1 000404   400011 236100                    LDQ     9,,PR4
         1 000405   000010 316003                    CANQ    8,DU
         1 000406   000415 600000 1                  TZE     s:8909
         1 000407   200075 235100                    LDA     ENTFLG,,AUTO
         1 000410   000415 601000 1                  TNZ     s:8909

      369     8906    3                B$JIT.ERR = LDCT$->NK$LDCT.ERR;

   8906  1 000411   400000 236100                    LDQ     0,,PR4
         1 000412   000000 475400 xsym               LDP5    B$JIT$
         1 000413   500012 756100                    STQ     10,,PR5

      370     8907    3                ALTRETURN;

   8907  1 000414   000000 702200 xent               TSX2  ! X66_AALT

      371     8908    3              END;
      372     8909    2           K$RWPARM.MSG$ = MSG$;

   8909  1 000415   200076 236100                    LDQ     MSG$,,AUTO
         1 000416   200012 756100                    STQ     K$RWPARM,,AUTO

      373     8910    2           K$RWPARM.MSGSZ = MSGSZ;

   8910  1 000417   200100 235100                    LDA     MSGSZ,,AUTO
         1 000420   200013 755100                    STA     K$RWPARM+1,,AUTO

      374     8911    2           IF FPT$ ~= ADDR(NIL)

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:73   
   8911  1 000421   200072 236100                    LDQ     FPT$,,AUTO
         1 000422   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000423   000451 600000 1                  TZE     NOWRTKEY

      375     8912    3           THEN DO;

      376     8913    3                CALL HFF$NILERASE (1) ALTRET (NOWRTKEY);

   8913  1 000424   000003 630400 2                  EPPR0   3
         1 000425   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000426   000000 701000 xent               TSX1    HFF$NILERASE
         1 000427   000451 702000 1                  TSX2    NOWRTKEY

      377     8914    3                CALL HFF$DSIZ(1,USRKEYSZ);

   8914  1 000430   200062 630500                    EPPR0   USRKEYSZ,,AUTO
         1 000431   200113 450500                    STP0    VSIN+5,,AUTO
         1 000432   000003 236000 2                  LDQ     3
         1 000433   200112 756100                    STQ     VSIN+4,,AUTO
         1 000434   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000435   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000436   000000 701000 xent               TSX1    HFF$DSIZ
         1 000437   000000 011000                    NOP     0

      378     8915    3                USRKEYSZ = MINIMUM(255,USRKEYSZ);

   8915  1 000440   200062 236100                    LDQ     USRKEYSZ,,AUTO
         1 000441   000377 116007                    CMPQ    255,DL
         1 000442   000445 602000 1                  TNC     s:8915+5
         1 000443   000445 600000 1                  TZE     s:8915+5
         1 000444   000377 236007                    LDQ     255,DL
         1 000445   200062 756100                    STQ     USRKEYSZ,,AUTO

      379     8916    3                K$RWPARM.KEYSZ = USRKEYSZ;

   8916  1 000446   200060 552104                    STBQ    K$RWPARM+38,'04'O,AUTO

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:74   
      380     8917    3                K$RWPARM.KEY$ = B$PS1$;

   8917  1 000447   000000 236000 xsym               LDQ     B$PS1$
         1 000450   200056 756100                    STQ     K$RWPARM+36,,AUTO

      381     8918    3              END;

      382     8919    2   NOWRTKEY: ;

   8919  1 000451                       NOWRTKEY     null
      383     8920    2           IF FCN1=MFC_WRUR

   8920  1 000451   200073 235100                    LDA     FCN1,,AUTO
         1 000452   000012 115007                    CMPA    10,DL
         1 000453   000457 601000 1                  TNZ     s:8924

      384     8921    2           THEN
      385     8922    2                K$RWPARM.TRANS$ = B$XL_UR$;

   8922  1 000454   000000 236000 xsym               LDQ     B$XL_UR$
         1 000455   200043 756100                    STQ     K$RWPARM+25,,AUTO
         1 000456   000466 710000 1                  TRA     s:8930

      386     8923    2           ELSE
      387     8924    2                IF FCN1=MFC_WRURUC

   8924  1 000457   000015 115007                    CMPA    13,DL
         1 000460   000464 601000 1                  TNZ     s:8928

      388     8925    2                THEN
      389     8926    2                     K$RWPARM.TRANS$ = B$XL_UPPER_UR$;

   8926  1 000461   000000 236000 xsym               LDQ     B$XL_UPPER_UR$
         1 000462   200043 756100                    STQ     K$RWPARM+25,,AUTO
         1 000463   000466 710000 1                  TRA     s:8930

      390     8927    2                ELSE
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:75   
      391     8928    2                     K$RWPARM.TRANS$ = ADDR(NIL);

   8928  1 000464   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000465   200043 756100                    STQ     K$RWPARM+25,,AUTO

      392     8929                %LOCK (G=LDCT$->LDCT.LOCK);

   8930  1 000466   200102 236100                    LDQ     LDCT$,,AUTO
         1 000467   000020 036003                    ADLQ    16,DU
         1 000470   200112 756100                    STQ     VSIN+4,,AUTO
         1 000471   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000472   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000473   000000 701000 xent               TSX1    HFC$LOCK
         1 000474   000000 011000                    NOP     0

      393     8932    2           IF DVBYTE1&%DVBYTE_RRR#

   8932  1 000475   200074 236100                    LDQ     DVBYTE1,,AUTO
         1 000476   777000 376003                    ANQ     -512,DU
         1 000477   010000 376003                    ANQ     4096,DU
         1 000500   000503 600000 1                  TZE     s:8937

      394     8933    3           THEN DO;

      395     8934    3                K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

   8934  1 000501   001000 236007                    LDQ     512,DL
         1 000502   200052 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      396     8935    3              END;

      397     8936
      398     8937    2           K$RWPARM.DVE.DVBYTE = DVBYTE1;

   8937  1 000503   200074 236100                    LDQ     DVBYTE1,,AUTO
         1 000504   200022 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:76   
   8937  1 000505                       TRY_WRT_AGA* null
      399     8938
      400     8939
      401     8940    2   TRY_WRT_AGAIN:;
      402     8941    2           CALL KIA$WRITE_USER (LDCT$->LDCT,K$RWPARM)

   8941  1 000505   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 000506   200113 450500                    STP0    VSIN+5,,AUTO
         1 000507   200102 236100                    LDQ     LDCT$,,AUTO
         1 000510   200112 756100                    STQ     VSIN+4,,AUTO
         1 000511   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000512   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000513   000000 701000 xent               TSX1    KIA$WRITE_USER
         1 000514   000516 702000 1                  TSX2    s:8944
         1 000515   000574 710000 1                  TRA     WAIT_RRR_RESP

      403     8942    3           WHENALTRETURN DO;

      404     8943
      405     8944    3                IF S$CU$->B$U.ASYNCH & %(~U_RESET) AND (ENTFLG=%DCB#)

   8944  1 000516   000000 470400 xsym               LDP0    S$CU$
         1 000517   000001 236100                    LDQ     1,,PR0
         1 000520   000014 376000 0                  ANQ     XTRARD+1
         1 000521   000527 600000 1                  TZE     s:8944+9
         1 000522   200075 235100                    LDA     ENTFLG,,AUTO
         1 000523   000527 601000 1                  TNZ     s:8944+9
         1 000524   000000 236100                    LDQ     0,,PR0
         1 000525   000015 376000 0                  ANQ     XTRARD+2
         1 000526   002163 600000 1                  TZE     BRKOUT
         1 000527   200102 471500                    LDP1    LDCT$,,AUTO
         1 000530   100006 236100                    LDQ     6,,PR1
         1 000531   000020 316007                    CANQ    16,DL
         1 000532   002163 601000 1                  TNZ     BRKOUT

      406     8945    3                     AND NOT S$CU$->B$U.FLG & %U_STIP
      407     8946    3                     OR LDCT$->NK$LDCT.DFLG.FEDN
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:77   
      408     8947    3                THEN
      409     8948    3                     GOTO BRKOUT;
      410     8949    3                IF K$RWPARM.ERR = %K$NO_THROT

   8949  1 000533   200025 235100                    LDA     K$RWPARM+11,,AUTO
         1 000534   000004 115007                    CMPA    4,DL
         1 000535   000565 601000 1                  TNZ     s:8967

      411     8950    3                THEN
      412     8951    3                     IF K$RWPARM.DVE.DVBYTE.NODAT

   8951  1 000536   200022 236100                    LDQ     K$RWPARM+8,,AUTO
         1 000537   004000 316003                    CANQ    2048,DU
         1 000540   000545 600000 1                  TZE     s:8960

      413     8952    4                     THEN DO;

      414     8953    4                          B$JIT.ERR = KIA_NODAT;

   8953  1 000541   000006 236000 0                  LDQ     KIA_NODAT
         1 000542   000000 473400 xsym               LDP3    B$JIT$
         1 000543   300012 756100                    STQ     10,,PR3

      415     8954               /*E* ERROR: KIA-E$NODAT-C
      416     8955                    MESSAGE: No throttling to write %thru %DC %and NODAT specified.
      417     8956                   */
      418     8957    4                          GOTO BRKOUT;

   8957  1 000544   002163 710000 1                  TRA     BRKOUT

      419     8958    4                        END;
      420     8959    4                     ELSE DO;

      421     8960    4                          CALL SSR$REG (%SS_CBL,LDCT$);

   8960  1 000545   200102 633500                    EPPR3   LDCT$,,AUTO
         1 000546   200113 453500                    STP3    VSIN+5,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:78   
         1 000547   000004 236000 2                  LDQ     4
         1 000550   200112 756100                    STQ     VSIN+4,,AUTO
         1 000551   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000552   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000553   000000 701000 xent               TSX1    SSR$REG
         1 000554   000000 011000                    NOP     0

      422     8961                               %LOCK (G=LDCT$->NK$LDCT.LOCK);

   8962  1 000555   200102 236100                    LDQ     LDCT$,,AUTO
         1 000556   000020 036003                    ADLQ    16,DU
         1 000557   200112 756100                    STQ     VSIN+4,,AUTO
         1 000560   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000561   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000562   000000 701000 xent               TSX1    HFC$LOCK
         1 000563   000000 011000                    NOP     0

      423     8964    4                          GOTO TRY_WRT_AGAIN ;

   8964  1 000564   000505 710000 1                  TRA     TRY_WRT_AGAIN

      424     8965    4                        END;
      425     8966
      426     8967    3                IF K$RWPARM.ERR ~= %K$QFULL

   8967  1 000565   000001 115007                    CMPA    1,DL
         1 000566   002163 601000 1                  TNZ     BRKOUT

      427     8968    3                THEN
      428     8969    3                     GOTO BRKOUT;
      429     8970    3                CALL KIA$OQFL (LDCT$->LDCT) ALTRET(BRKOUT) ;

   8970  1 000567   200102 630500                    EPPR0   LDCT$,,AUTO
         1 000570   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000571   000000 701000 xent               TSX1    KIA$OQFL
         1 000572   002163 702000 1                  TSX2    BRKOUT

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:79   
      430     8971    3                GOTO TRY_WRT_AGAIN ;

   8971  1 000573   000505 710000 1                  TRA     TRY_WRT_AGAIN

   8964  1 000574                       WAIT_RRR_RE* null
      431     8972    3              END;
      432     8973    2   WAIT_RRR_RESP: ;
      433     8974    2           IF K$RWPARM.MRKTYP ~= 0         /* Must wait for output complete      */

   8974  1 000574   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 000575   777000 316007                    CANQ    -512,DL
         1 000576   000720 600000 1                  TZE     s:9010

      434     8975    3           THEN DO;

      435     8976    3                PFB = K$RWPARM.STR;        /* clobbered by KIA$MSG (probably) */

   8976  1 000577   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 000600   000777 376007                    ANQ     511,DL
         1 000601   200104 756100                    STQ     PFB,,AUTO

      436     8977        /* S unlocks LDCT$->NK$LDCT.LOCK */
      437     8978    3                CALL SSR$REG (%SS_CW,LDCT$);

   8978  1 000602   200102 630500                    EPPR0   LDCT$,,AUTO
         1 000603   200113 450500                    STP0    VSIN+5,,AUTO
         1 000604   000006 236000 2                  LDQ     6
         1 000605   200112 756100                    STQ     VSIN+4,,AUTO
         1 000606   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000607   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000610   000000 701000 xent               TSX1    SSR$REG
         1 000611   000000 011000                    NOP     0

      438     8979                     %LOCK (G=LDCT$->NK$LDCT.LOCK);

   8980  1 000612   200102 236100                    LDQ     LDCT$,,AUTO
         1 000613   000020 036003                    ADLQ    16,DU
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:80   
         1 000614   200112 756100                    STQ     VSIN+4,,AUTO
         1 000615   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000616   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000617   000000 701000 xent               TSX1    HFC$LOCK
         1 000620   000000 011000                    NOP     0

      439     8982    3                K$RWPARM.IP$ = LDCT$->LDCT.IP$;

   8982  1 000621   200102 470500                    LDP0    LDCT$,,AUTO
         1 000622   000013 236100                    LDQ     11,,PR0
         1 000623   200024 756100                    STQ     K$RWPARM+10,,AUTO

      440     8983
      441     8984    3                LDCT$->LDCT.IP$ = ADDR(NIL);

   8984  1 000624   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000625   000013 756100                    STQ     11,,PR0

      442     8985    3                IF K$RWPARM.IP$ = ADDR(NIL)

   8985  1 000626   200024 236100                    LDQ     K$RWPARM+10,,AUTO
         1 000627   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000630   002163 600000 1                  TZE     BRKOUT

      443     8986    3                THEN
      444     8987    3                     GOTO BRKOUT ;
      445     8988
      446     8989    3                CALL KIQ$MAPFEP(LDCT$->LDCT.IPFEI#);

   8989  1 000631   200102 236100                    LDQ     LDCT$,,AUTO
         1 000632   000007 036000 2                  ADLQ    7
         1 000633   200112 756100                    STQ     VSIN+4,,AUTO
         1 000634   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000635   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000636   000000 701000 xent               TSX1    KIQ$MAPFEP
         1 000637   000000 011000                    NOP     0

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:81   
      447     8990    3                K$RWPARM.UHDR$ = PINCRC(K$RWPARM.IP$,K$RWPARM.IP$->KI$QMHDR.OFFSET);

   8990  1 000640   200024 470500                    LDP0    K$RWPARM+10,,AUTO
         1 000641   000001 236100                    LDQ     1,,PR0
         1 000642   000022 772000                    QRL     18
         1 000643   000020 736000                    QLS     16
         1 000644   200024 036100                    ADLQ    K$RWPARM+10,,AUTO
         1 000645   200026 756100                    STQ     K$RWPARM+12,,AUTO

      448     8991    3                K$RWPARM.UHDRSZ = K$RWPARM.IP$->KI$QMHDR.SIZE;

   8991  1 000646   000001 236100                    LDQ     1,,PR0
         1 000647   777777 376007                    ANQ     -1,DL
         1 000650   200027 756100                    STQ     K$RWPARM+13,,AUTO

      449     8992    3                CALL KIA$MSG (K$RWPARM);

   8992  1 000651   200012 631500                    EPPR1   K$RWPARM,,AUTO
         1 000652   200112 451500                    STP1    VSIN+4,,AUTO
         1 000653   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000654   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000655   000000 701000 xent               TSX1    KIA$MSG
         1 000656   000000 011000                    NOP     0

      450     8993    3                B$JIT.ERR = K$RWPARM.MSG_ERRCODE;

   8993  1 000657   200051 236100                    LDQ     K$RWPARM+31,,AUTO
         1 000660   000000 470400 xsym               LDP0    B$JIT$
         1 000661   000012 756100                    STQ     10,,PR0

      451     8994    3                IF NOT B$JIT.ERR

   8994  1 000662   000701 601000 1                  TNZ     s:9001

      452     8995    3                THEN
      453     8996    3                     IF K$RWPARM.VDOFLGS.NEWSSN

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:82   
   8996  1 000663   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 000664   000100 316003                    CANQ    64,DU
         1 000665   000674 600000 1                  TZE     s:9000

      454     8997    3                     THEN
      455     8998    3                          B$ROSEG$->B$ROSEG.STREAM_VALID(PFB) = '0'B;

   8998  1 000666   000000 471400 xsym               LDP1    B$ROSEG$
         1 000667   200104 235100                    LDA     PFB,,AUTO
         1 000670   003105 060400                    CSL     bolr='003'O
         1 000671   000002 000001 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=1
         1 000672   100117 000001                    BDSC    79,A,PR1                 by=0,bit=0,n=1
         1 000673   000701 710000 1                  TRA     s:9001

      456     8999    3                     ELSE
      457     9000    3                          B$ROSEG$->B$ROSEG.STREAM_VALID(PFB) = '1'B;

   9000  1 000674   000000 471400 xsym               LDP1    B$ROSEG$
         1 000675   200104 235100                    LDA     PFB,,AUTO
         1 000676   003105 060400                    CSL     bolr='003'O
         1 000677   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 000700   100117 000001                    BDSC    79,A,PR1                 by=0,bit=0,n=1

      458     9001    3                IF ENTFLG = %DCB#

   9001  1 000701   200075 235100                    LDA     ENTFLG,,AUTO
         1 000702   000706 601000 1                  TNZ     s:9004

      459     9002    3                THEN
      460     9003    3                     DCB$->F$DCB.FLDID = K$RWPARM.FLDID;

   9003  1 000703   200057 720100                    LXL0    K$RWPARM+37,,AUTO
         1 000704   200101 471500                    LDP1    DCB$,,AUTO
         1 000705   100061 440100                    SXL0    49,,PR1

      461     9004    3                K$RWPARM.LDCT$ = LDCT$;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:83   
   9004  1 000706   200102 236100                    LDQ     LDCT$,,AUTO
         1 000707   200030 756100                    STQ     K$RWPARM+14,,AUTO

      462     9005    3                K$RWPARM.FUNCTION = %K_READDONE;

   9005  1 000710   000011 235007                    LDA     9,DL
         1 000711   200032 755100                    STA     K$RWPARM+16,,AUTO

      463     9006    3                CALL KIS$SEND (K$RWPARM);

   9006  1 000712   200012 631500                    EPPR1   K$RWPARM,,AUTO
         1 000713   200112 451500                    STP1    VSIN+4,,AUTO
         1 000714   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000715   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000716   000000 701000 xent               TSX1    KIS$SEND
         1 000717   000000 011000                    NOP     0

      464     9007    3              END;

      465     9008
      466     9009                %UNLOCK (G=LDCT$->LDCT.LOCK);

   9010  1 000720   200102 236100                    LDQ     LDCT$,,AUTO
         1 000721   000020 036003                    ADLQ    16,DU
         1 000722   200112 756100                    STQ     VSIN+4,,AUTO
         1 000723   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000724   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000725   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000726   000000 011000                    NOP     0

      467     9012    2           IF B$JIT$->B$JIT.CPFLAGS1 & %CP_DRIBBLE# AND ENTFLG = %DCB#

   9012  1 000727   000000 470400 xsym               LDP0    B$JIT$
         1 000730   000143 236100                    LDQ     99,,PR0
         1 000731   000017 376000 0                  ANQ     XTRARD+4
         1 000732   000747 600000 1                  TZE     s:9016
         1 000733   200075 235100                    LDA     ENTFLG,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:84   
         1 000734   000747 601000 1                  TNZ     s:9016
         1 000735   200101 236100                    LDQ     DCB$,,AUTO
         1 000736   000000 116000 xsym               CMPQ    B$M$UC$
         1 000737   000747 601000 1                  TNZ     s:9016
         1 000740   200073 235100                    LDA     FCN1,,AUTO
         1 000741   000014 115007                    CMPA    12,DL
         1 000742   000747 600000 1                  TZE     s:9016

      468     9013    2                AND DCB$ = B$M$UC$ AND (FCN1 ~= MFC_TCTL)
      469     9014    2           THEN
      470     9015    2                CALL UMD$DOU(DVBYTE,VFC);

   9015  1 000743   200004 630500                    EPPR0   @DVBYTE,,AUTO
         1 000744   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000745   000000 701000 xent               TSX1    UMD$DOU
         1 000746   000000 011000                    NOP     0

      471     9016    2           IF K$RWPARM.TYC

   9016  1 000747   200020 235100                    LDA     K$RWPARM+6,,AUTO
         1 000750   002104 600000 1                  TZE     CSEND

      472     9017    2           THEN
      473     9018    2                B$JIT.ERR = K$RWPARM.MSG_ERRCODE;

   9018  1 000751   200051 236100                    LDQ     K$RWPARM+31,,AUTO
         1 000752   000000 470400 xsym               LDP0    B$JIT$
         1 000753   000012 756100                    STQ     10,,PR0
         1 000754   002104 710000 1                  TRA     CSEND

      474     9019
      475     9020
      476     9021        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:85   
      477     9022    2        CASE (MFC_READ);

      478     9023
      479     9024         /* If the front end has reported a disconnect read is no longer allowedA */
      480     9025    2           IF LDCT$->NK$LDCT.DFLG.OLDSC

   9025  1 000755   200102 474500                    LDP4    LDCT$,,AUTO
         1 000756   400006 236100                    LDQ     6,,PR4
         1 000757   010000 316007                    CANQ    4096,DL
         1 000760   000765 600000 1                  TZE     s:9031

      481     9026    3           THEN DO;

      482     9027    3                B$JIT.ERR = LDSC;

   9027  1 000761   000007 236000 0                  LDQ     LDSC
         1 000762   000000 475400 xsym               LDP5    B$JIT$
         1 000763   500012 756100                    STQ     10,,PR5

      483     9028    3                ALTRETURN;

   9028  1 000764   000000 702200 xent               TSX2  ! X66_AALT

      484     9029    3              END;
      485     9030
      486     9031    2           CALL HFF$DSIZ(0,USRKEYSZ);

   9031  1 000765   200062 635500                    EPPR5   USRKEYSZ,,AUTO
         1 000766   200113 455500                    STP5    VSIN+5,,AUTO
         1 000767   000010 236000 2                  LDQ     8
         1 000770   200112 756100                    STQ     VSIN+4,,AUTO
         1 000771   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 000772   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000773   000000 701000 xent               TSX1    HFF$DSIZ
         1 000774   000000 011000                    NOP     0

      487     9032    2           IF FPT$~= ADDR(NIL)
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:86   

   9032  1 000775   200072 236100                    LDQ     FPT$,,AUTO
         1 000776   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000777   001077 600000 1                  TZE     s:9060

      488     9033    2           THEN
      489     9034    2                IF USRKEYSZ = SIZEC(FPT$->FPT$READ_V)

   9034  1 001000   200062 235100                    LDA     USRKEYSZ,,AUTO
         1 001001   000030 115007                    CMPA    24,DL
         1 001002   001077 601000 1                  TNZ     s:9060

      490     9035    2                THEN
      491     9036    2                     IF FPT$->FPT$READ_V.SINPUTSIZE ~= 0 AND

   9036  1 001003   200072 470500                    LDP0    FPT$,,AUTO
         1 001004   000004 220100                    LDX0    4,,PR0
         1 001005   001077 600000 1                  TZE     s:9060
         1 001006   200075 235100                    LDA     ENTFLG,,AUTO
         1 001007   001017 601000 1                  TNZ     s:9041
         1 001010   200101 471500                    LDP1    DCB$,,AUTO
         1 001011   100032 236100                    LDQ     26,,PR1
         1 001012   777000 376003                    ANQ     -512,DU
         1 001013   027000 116003                    CMPQ    11776,DU
         1 001014   001077 600000 1                  TZE     s:9060
         1 001015   031000 116003                    CMPQ    12800,DU
         1 001016   001077 600000 1                  TZE     s:9060

      492     9037    2                          NOT (ENTFLG = %DCB# AND
      493     9038    2                          (DCB$ -> F$DCB.ORG = %SE# OR
      494     9039    2                          DCB$ -> F$DCB.ORG = %FORM#))
      495     9040    3                     THEN DO;

      496     9041    3                          K$RWPARM.V$ = ADDR(VSIN);

   9041  1 001017   200106 631500                    EPPR1   VSIN,,AUTO
         1 001020   200055 451500                    STP1    K$RWPARM+35,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:87   

      497     9042    3                          K$RWPARM.VSZ = LENGTHC(VSIN);

   9042  1 001021   000004 220003                    LDX0    4,DU
         1 001022   200057 740100                    STX0    K$RWPARM+37,,AUTO

      498     9043    3                          K$RWPARM.PRMID = %KV_PRMID_SINPUT;

   9043  1 001023   000013 221003                    LDX1    11,DU
         1 001024   200057 441100                    SXL1    K$RWPARM+37,,AUTO

      499     9044    3                          K$RWPARM.MSG$ = MSG$;

   9044  1 001025   200076 236100                    LDQ     MSG$,,AUTO
         1 001026   200012 756100                    STQ     K$RWPARM,,AUTO

      500     9045    3                          K$RWPARM.MSGSZ = MINIMUM(MSGSZ,FPT$->FPT$READ_V.SINPUTSIZE);

   9045  1 001027   000004 236100                    LDQ     4,,PR0
         1 001030   000022 772000                    QRL     18
         1 001031   200100 116100                    CMPQ    MSGSZ,,AUTO
         1 001032   001035 602000 1                  TNC     s:9045+6
         1 001033   001035 600000 1                  TZE     s:9045+6
         1 001034   200100 236100                    LDQ     MSGSZ,,AUTO
         1 001035   200013 756100                    STQ     K$RWPARM+1,,AUTO

      501     9046    3                          VSIN.PFB = PFB;

   9046  1 001036   200104 236100                    LDQ     PFB,,AUTO
         1 001037   000033 736000                    QLS     27
         1 001040   200106 552140                    STBQ    VSIN,'40'O,AUTO

      502     9047    3                          VSIN.POS = FPT$->FPT$READ_V.REREADPOS;

   9047  1 001041   000004 722100                    LXL2    4,,PR0
         1 001042   200106 442100                    SXL2    VSIN,,AUTO

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:88   
      503     9048    3                          VSIN.POSL6.T = VSIN.POSL66.T;

   9048  1 001043   200106 236100                    LDQ     VSIN,,AUTO
         1 001044   200106 552110                    STBQ    VSIN,'10'O,AUTO

      504     9049                               %LOCK (G=LDCT$->NK$LDCT.LOCK);

   9050  1 001045   200102 236100                    LDQ     LDCT$,,AUTO
         1 001046   000020 036003                    ADLQ    16,DU
         1 001047   200112 756100                    STQ     VSIN+4,,AUTO
         1 001050   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001051   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001052   000000 701000 xent               TSX1    HFC$LOCK
         1 001053   000000 011000                    NOP     0

      505     9052    3                          CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_PRM_SET,K$RWPARM)
              9052                                   ALTRET(BRKOUT);

   9052  1 001054   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 001055   200114 450500                    STP0    VSIN+6,,AUTO
         1 001056   000012 236000 2                  LDQ     10
         1 001057   200102 235100                    LDA     LDCT$,,AUTO
         1 001060   200112 757100                    STAQ    VSIN+4,,AUTO
         1 001061   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001062   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001063   000000 701000 xent               TSX1    KIA$FCNOU
         1 001064   002163 702000 1                  TSX2    BRKOUT

      506     9053                               %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   9054  1 001065   200102 236100                    LDQ     LDCT$,,AUTO
         1 001066   000020 036003                    ADLQ    16,DU
         1 001067   200112 756100                    STQ     VSIN+4,,AUTO
         1 001070   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001071   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001072   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001073   000000 011000                    NOP     0
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:89   

      507     9056    3                          K$RWPARM.MSGSZ = 0;

   9056  1 001074   200013 450100                    STZ     K$RWPARM+1,,AUTO

      508     9057    3                          K$RWPARM.MSG$ = ADDR(NIL);

   9057  1 001075   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001076   200012 756100                    STQ     K$RWPARM,,AUTO

      509     9058    3                        END;

      510     9059
      511     9060    3           IF LDCT$->LDCT.LKFLG.FPSTEP AND ENTFLG=%DCB# THEN DO;

   9060  1 001077   200102 470500                    LDP0    LDCT$,,AUTO
         1 001100   000011 236100                    LDQ     9,,PR0
         1 001101   000010 316003                    CANQ    8,DU
         1 001102   001111 600000 1                  TZE     s:9064
         1 001103   200075 235100                    LDA     ENTFLG,,AUTO
         1 001104   001111 601000 1                  TNZ     s:9064

      512     9061    3                B$JIT.ERR=NOFPRG;

   9061  1 001105   000011 236000 0                  LDQ     NOFPRG
         1 001106   000000 471400 xsym               LDP1    B$JIT$
         1 001107   100012 756100                    STQ     10,,PR1

      513     9062    3                ALTRETURN;

   9062  1 001110   000000 702200 xent               TSX2  ! X66_AALT

      514     9063    3              END;
      515     9064    2           IF FPT$ ~= ADDR(NIL) AND FPT$->FPT$READ_V.KEYS

   9064  1 001111   200072 236100                    LDQ     FPT$,,AUTO
         1 001112   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:90   
         1 001113   001145 600000 1                  TZE     NORDKEY
         1 001114   200072 471500                    LDP1    FPT$,,AUTO
         1 001115   100000 236100                    LDQ     0,,PR1
         1 001116   200000 316007                    CANQ    65536,DL
         1 001117   001145 600000 1                  TZE     NORDKEY

      516     9065    3           THEN DO;

      517     9066    3                CALL HFF$NILERASE (1) ALTRET (NORDKEY);

   9066  1 001120   000003 630400 2                  EPPR0   3
         1 001121   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001122   000000 701000 xent               TSX1    HFF$NILERASE
         1 001123   001145 702000 1                  TSX2    NORDKEY

      518     9067    3                CALL HFF$DSIZ(1,USRKEYSZ);

   9067  1 001124   200062 630500                    EPPR0   USRKEYSZ,,AUTO
         1 001125   200113 450500                    STP0    VSIN+5,,AUTO
         1 001126   000003 236000 2                  LDQ     3
         1 001127   200112 756100                    STQ     VSIN+4,,AUTO
         1 001130   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001131   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001132   000000 701000 xent               TSX1    HFF$DSIZ
         1 001133   000000 011000                    NOP     0

      519     9068    3                USRKEYSZ = MINIMUM(31,USRKEYSZ);

   9068  1 001134   200062 236100                    LDQ     USRKEYSZ,,AUTO
         1 001135   000037 116007                    CMPQ    31,DL
         1 001136   001141 602000 1                  TNC     s:9068+5
         1 001137   001141 600000 1                  TZE     s:9068+5
         1 001140   000037 236007                    LDQ     31,DL
         1 001141   200062 756100                    STQ     USRKEYSZ,,AUTO

      520     9069    3                K$RWPARM.KEYSZ = USRKEYSZ;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:91   
   9069  1 001142   200060 552104                    STBQ    K$RWPARM+38,'04'O,AUTO

      521     9070    3                K$RWPARM.KEY$ = B$PS1$;

   9070  1 001143   000000 236000 xsym               LDQ     B$PS1$
         1 001144   200056 756100                    STQ     K$RWPARM+36,,AUTO

      522     9071    3              END;

   9070  1 001145                       NORDKEY      null
      523     9072    2   NORDKEY: ;
      524     9073    2           TDVB=DVBYTE1;                   /* TO AVOID CALLING TRAPALT           */

   9073  1 001145   200074 236100                    LDQ     DVBYTE1,,AUTO
         1 001146   777000 376003                    ANQ     -512,DU
         1 001147   200077 756100                    STQ     TDVB,,AUTO

      525     9074
      526     9075                %LOCK (G=LDCT$->NK$LDCT.LOCK);

   9076  1 001150   200102 236100                    LDQ     LDCT$,,AUTO
         1 001151   000020 036003                    ADLQ    16,DU
         1 001152   200112 756100                    STQ     VSIN+4,,AUTO
         1 001153   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001154   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001155   000000 701000 xent               TSX1    HFC$LOCK
         1 001156   000000 011000                    NOP     0

      527     9078
      528     9079        /* If there is a no wait read pending, cancel it */
      529     9080    2           IF DCB$ ~= ADDR(NIL)

   9080  1 001157   200101 236100                    LDQ     DCB$,,AUTO
         1 001160   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001161   001274 600000 1                  TZE     s:9126

      530     9081    2           THEN IF DCB$->F$DCB.WAIT~=0 AND DCB$->F$DCB.FCN.CNT(0) ~= 0
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:92   

   9081  1 001162   200101 470500                    LDP0    DCB$,,AUTO
         1 001163   000064 236100                    LDQ     52,,PR0
         1 001164   000020 316007                    CANQ    16,DL
         1 001165   001274 600000 1                  TZE     s:9126
         1 001166   000074 236100                    LDQ     60,,PR0
         1 001167   377000 316003                    CANQ    130560,DU
         1 001170   001274 600000 1                  TZE     s:9126

      531     9082    3                THEN DO;

   9081  1 001171                       CANCEL_READ  null
      532     9083
      533     9084    3   CANCEL_READ:      ;
      534     9085        /*
      535     9086             Send a cancel down to other end
      536     9087         */
      537     9088    3                     K$RWPARM = K_RWPARM_CON;

   9088  1 001171   000100 100400                    MLR     fill='000'O
         1 001172   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 001173   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      538     9089    3                     K$RWPARM.STR = LDCT$->NK$LDCT.NOWAIT.STREAM;

   9089  1 001174   200102 470500                    LDP0    LDCT$,,AUTO
         1 001175   000010 236100                    LDQ     8,,PR0
         1 001176   000022 772000                    QRL     18
         1 001177   200052 552104                    STBQ    K$RWPARM+32,'04'O,AUTO

      539     9090    3                     K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

   9090  1 001200   001000 236007                    LDQ     512,DL
         1 001201   200052 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      540     9091    3                     CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM)

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:93   
   9091  1 001202   200012 631500                    EPPR1   K$RWPARM,,AUTO
         1 001203   200114 451500                    STP1    VSIN+6,,AUTO
         1 001204   000014 236000 2                  LDQ     12
         1 001205   200102 235100                    LDA     LDCT$,,AUTO
         1 001206   200112 757100                    STAQ    VSIN+4,,AUTO
         1 001207   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001210   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001211   000000 701000 xent               TSX1    KIA$FCNOU
         1 001212   002163 702000 1                  TSX2    BRKOUT

      541     9092    3                          ALTRET (BRKOUT);
      542     9093
      543     9094        /*
      544     9095             Wait for cancel to be acked
      545     9096         */
      546     9097    3                     LDCT$->NK$LDCT.LKFLG.WTMRK = '1'B;

   9097  1 001213   200102 470500                    LDP0    LDCT$,,AUTO
         1 001214   020000 236003                    LDQ     8192,DU
         1 001215   000011 256100                    ORSQ    9,,PR0

      547     9098    3                     CALL SSR$REG(%SS_CW,LDCT$);

   9098  1 001216   200102 630500                    EPPR0   LDCT$,,AUTO
         1 001217   200113 450500                    STP0    VSIN+5,,AUTO
         1 001220   000006 236000 2                  LDQ     6
         1 001221   200112 756100                    STQ     VSIN+4,,AUTO
         1 001222   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001223   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001224   000000 701000 xent               TSX1    SSR$REG
         1 001225   000000 011000                    NOP     0

      548     9099                          %LOCK (G=LDCT$->NK$LDCT.LOCK);

   9100  1 001226   200102 236100                    LDQ     LDCT$,,AUTO
         1 001227   000020 036003                    ADLQ    16,DU
         1 001230   200112 756100                    STQ     VSIN+4,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:94   
         1 001231   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001232   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001233   000000 701000 xent               TSX1    HFC$LOCK
         1 001234   000000 011000                    NOP     0

      549     9102
      550     9103        /*
      551     9104             Check to see if the no wait read is still pending
      552     9105          */
      553     9106    4                     DO WHILE LDCT$->NK$LDCT.LKFLG.NOWAIT; /* Need to event */

   9106  1 001235   200102 470500                    LDP0    LDCT$,,AUTO
         1 001236   000011 236100                    LDQ     9,,PR0
         1 001237   000001 316003                    CANQ    1,DU
         1 001240   001264 600000 1                  TZE     s:9121

      554     9107
      555     9108    4                          K$RWPARM = K_RWPARM_CON;

   9108  1 001241   000100 100400                    MLR     fill='000'O
         1 001242   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 001243   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      556     9109    4                          K$RWPARM.MSG_ERRCODE = XTRARD;

   9109  1 001244   000013 236000 0                  LDQ     XTRARD
         1 001245   200051 756100                    STQ     K$RWPARM+31,,AUTO

      557     9110        /*E* ERROR: KIA-E$XTRARD
      558     9111             MESSAGE: Nowait read %thru %DC %canceled by another read request.
      559     9112             MESSAGE1: A nowait read %thru %DC %was canceled either because
      560     9113                       a subsequent read request specified wait, a different
      561     9114                       buffer size, key size, or keytype, or would have exceeded
      562     9115                       the system maximum of three nowait reads per connection.
      563     9116           */
      564     9117    4                          K$RWPARM.TYC = %TYC_XTRARD;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:95   
   9117  1 001246   000020 236000 0                  LDQ     XTRARD+5
         1 001247   200020 756100                    STQ     K$RWPARM+6,,AUTO

      565     9118    4                          CALL KIA$COMP(LDCT$->NK$LDCT,K$RWPARM);

   9118  1 001250   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 001251   200113 450500                    STP0    VSIN+5,,AUTO
         1 001252   200102 236100                    LDQ     LDCT$,,AUTO
         1 001253   200112 756100                    STQ     VSIN+4,,AUTO
         1 001254   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001255   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001256   000000 701000 xent               TSX1    KIA$COMP
         1 001257   000000 011000                    NOP     0

      566     9119    4                        END;

   9119  1 001260   200102 470500                    LDP0    LDCT$,,AUTO
         1 001261   000011 236100                    LDQ     9,,PR0
         1 001262   000001 316003                    CANQ    1,DU
         1 001263   001241 601000 1                  TNZ     s:9108

      567     9120                          %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   9121  1 001264   200102 236100                    LDQ     LDCT$,,AUTO
         1 001265   000020 036003                    ADLQ    16,DU
         1 001266   200112 756100                    STQ     VSIN+4,,AUTO
         1 001267   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001270   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001271   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001272   000000 011000                    NOP     0

      568     9123    3                     GOTO CMN;             /* rebuild K$RWPARM */

   9123  1 001273   000101 710000 1                  TRA     CMN

      569     9124    3                   END;
      570     9125                %UNLOCK (G=LDCT$->NK$LDCT.LOCK);
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:96   

   9126  1 001274   200102 236100                    LDQ     LDCT$,,AUTO
         1 001275   000020 036003                    ADLQ    16,DU
         1 001276   200112 756100                    STQ     VSIN+4,,AUTO
         1 001277   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001300   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001301   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001302   000000 011000                    NOP     0

      571     9128        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:97   
      572     9129    2           IF DCB$~=ADDR(NIL) AND DCB$->F$DCB.WAIT=0

   9129  1 001303   200101 236100                    LDQ     DCB$,,AUTO
         1 001304   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001305   001670 600000 1                  TZE     s:9257
         1 001306   200101 470500                    LDP0    DCB$,,AUTO
         1 001307   000064 236100                    LDQ     52,,PR0
         1 001310   000020 316007                    CANQ    16,DL
         1 001311   001670 601000 1                  TNZ     s:9257

      573     9130    3           THEN DO;

      574     9131        /*I*
      575     9132             NAME: NOWAIT_READ
      576     9133             PURPOSE:
      577     9134                  To set up a no wait read function to a terminal
      578     9135             DATA:
      579     9136                  K$RWPARM - Set up with the read information
      580     9137                  LDCT$    - Pointing to the TS's terminal LDCT
      581     9138             DESCRIPTION:
      582     9139                  When a no wait read is performed to a terminal this
      583     9140                  routine sets up the information.  The read will
      584     9141                  be completed by KIA$UCIN calling KIA$COMP when data
      585     9142                  comes in satisfying this read.  We use the comgroup
      586     9143                  context area to map onto the buffers.
      587     9144
      588     9145         */
      589     9146
      590     9147        /*
      591     9148             Check if we need to return a KEY
      592     9149         */
      593     9150    3                NOWAIT = '0'B;

   9150  1 001312   200063 450100                    STZ     NOWAIT,,AUTO

      594     9151    3                USRKEYSZ = 0;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:98   
   9151  1 001313   200062 450100                    STZ     USRKEYSZ,,AUTO

      595     9152    3                IF FPT$~= ADDR(NIL) AND FPT$->FPT$READ_V.KEYR

   9152  1 001314   200072 236100                    LDQ     FPT$,,AUTO
         1 001315   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001316   001403 600000 1                  TZE     s:9170
         1 001317   200072 471500                    LDP1    FPT$,,AUTO
         1 001320   100000 236100                    LDQ     0,,PR1
         1 001321   100000 316007                    CANQ    32768,DL
         1 001322   001403 600000 1                  TZE     s:9170

      596     9153    4                THEN DO;

      597     9154    4                     CALL HFF$NILERASE(1)

   9154  1 001323   000003 630400 2                  EPPR0   3
         1 001324   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001325   000000 701000 xent               TSX1    HFF$NILERASE
         1 001326   001403 702000 1                  TSX2    s:9170

      598     9155    5                     WHENRETURN DO;

      599     9156    5                          CALL HFF$DSIZ(1,USRKEYSZ);

   9156  1 001327   200062 630500                    EPPR0   USRKEYSZ,,AUTO
         1 001330   200113 450500                    STP0    VSIN+5,,AUTO
         1 001331   000003 236000 2                  LDQ     3
         1 001332   200112 756100                    STQ     VSIN+4,,AUTO
         1 001333   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001334   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001335   000000 701000 xent               TSX1    HFF$DSIZ
         1 001336   000000 011000                    NOP     0

      600     9157    5                          IF USRKEYSZ>256 THEN USRKEYSZ = 256;

   9157  1 001337   200062 235100                    LDA     USRKEYSZ,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:99   
         1 001340   000401 115007                    CMPA    257,DL
         1 001341   001344 602000 1                  TNC     s:9158

   9157  1 001342   000400 236007                    LDQ     256,DL
         1 001343   200062 756100                    STQ     USRKEYSZ,,AUTO

      601     9158    5                          CALL HFF$WRITE1(1) ALTRET (MTRAP);

   9158  1 001344   000003 630400 2                  EPPR0   3
         1 001345   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001346   000000 701000 xent               TSX1    HFF$WRITE1
         1 001347   001471 702000 1                  TSX2    MTRAP

      602     9159    5                          NOWAIT.KEYTYP = K$RWPARM.KEYTYPE;

   9159  1 001350   200060 236100                    LDQ     K$RWPARM+38,,AUTO
         1 001351   000025 736000                    QLS     21
         1 001352   200063 752140                    STCQ    NOWAIT,'40'O,AUTO

      603     9160    5                          CALL MMS$SETUP_BUF(%USERWSQ,B$PS1$,USRKEYSZ,RPTR$,PTW);

   9160  1 001353   200070 630500                    EPPR0   PTW,,AUTO
         1 001354   200116 450500                    STP0    VSIN+8,,AUTO
         1 001355   200105 631500                    EPPR1   RPTR$,,AUTO
         1 001356   200115 451500                    STP1    VSIN+7,,AUTO
         1 001357   200062 633500                    EPPR3   USRKEYSZ,,AUTO
         1 001360   200114 453500                    STP3    VSIN+6,,AUTO
         1 001361   000016 237000 2                  LDAQ    14
         1 001362   200112 757100                    STAQ    VSIN+4,,AUTO
         1 001363   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001364   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001365   000000 701000 xent               TSX1    MMS$SETUP_BUF
         1 001366   000000 011000                    NOP     0

      604     9161    5                          FEPIO.KEYX = POFFC(RPTR$,B$CGCTXT$);

   9161  1 001367   000000 236000 xsym               LDQ     B$CGCTXT$
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:100  
         1 001370   000020 772000                    QRL     16
         1 001371   200112 756100                    STQ     VSIN+4,,AUTO
         1 001372   200105 236100                    LDQ     RPTR$,,AUTO
         1 001373   000020 772000                    QRL     16
         1 001374   200112 136100                    SBLQ    VSIN+4,,AUTO
         1 001375   000000 620006                    EAX0    0,QL
         1 001376   200065 740100                    STX0    FEPIO+1,,AUTO

      605     9162    5                          FEPIO.KPP(0) = PTW.PP(0);

   9162  1 001377   200070 221100                    LDX1    PTW,,AUTO
         1 001400   200067 741100                    STX1    FEPIO+3,,AUTO

      606     9163    5                          FEPIO.KPP(1) = PTW.PP(1);

   9163  1 001401   200071 222100                    LDX2    PTW+1,,AUTO
         1 001402   200067 442100                    SXL2    FEPIO+3,,AUTO

      607     9164    5                        END;

      608     9165    4                   END;

      609     9166
      610     9167        /*
      611     9168             Set up the buffer area of the DCB
      612     9169         */
      613     9170    3                FEPSIZ.BUF = MSGSZ;

   9170  1 001403   200100 720100                    LXL0    MSGSZ,,AUTO
         1 001404   200062 740100                    STX0    USRKEYSZ,,AUTO

      614     9171    3                CALL MMS$SETUP_BUF(%USERWSQ,DCB$->F$DCB.UB$,MSGSZ,RPTR$,PTW);

   9171  1 001405   200070 630500                    EPPR0   PTW,,AUTO
         1 001406   200116 450500                    STP0    VSIN+8,,AUTO
         1 001407   200105 631500                    EPPR1   RPTR$,,AUTO
         1 001410   200115 451500                    STP1    VSIN+7,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:101  
         1 001411   200100 633500                    EPPR3   MSGSZ,,AUTO
         1 001412   200114 453500                    STP3    VSIN+6,,AUTO
         1 001413   200101 236100                    LDQ     DCB$,,AUTO
         1 001414   000075 036003                    ADLQ    61,DU
         1 001415   000016 235000 2                  LDA     14
         1 001416   200112 757100                    STAQ    VSIN+4,,AUTO
         1 001417   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001420   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 001421   000000 701000 xent               TSX1    MMS$SETUP_BUF
         1 001422   000000 011000                    NOP     0

      615     9172    3                FEPIO.BUFX = POFFC(RPTR$,B$CGCTXT$);

   9172  1 001423   000000 236000 xsym               LDQ     B$CGCTXT$
         1 001424   000020 772000                    QRL     16
         1 001425   200112 756100                    STQ     VSIN+4,,AUTO
         1 001426   200105 236100                    LDQ     RPTR$,,AUTO
         1 001427   000020 772000                    QRL     16
         1 001430   200112 136100                    SBLQ    VSIN+4,,AUTO
         1 001431   000000 620006                    EAX0    0,QL
         1 001432   200065 440100                    SXL0    FEPIO+1,,AUTO

      616     9173    3                FEPIO.BPP(0) = PTW.PP(0);

   9173  1 001433   200070 221100                    LDX1    PTW,,AUTO
         1 001434   200066 741100                    STX1    FEPIO+2,,AUTO

      617     9174    3                FEPIO.BPP(1) = PTW.PP(1);

   9174  1 001435   200071 222100                    LDX2    PTW+1,,AUTO
         1 001436   200066 442100                    SXL2    FEPIO+2,,AUTO

      618     9175
      619     9176        /* Save the DCB# of the user specified DCB and the event
      620     9177         */
      621     9178    3                FEPIO.EVENT = EVENT;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:102  
   9178  1 001437   200006 470500                    LDP0    @EVENT,,AUTO
         1 001440   000000 235100                    LDA     0,,PR0
         1 001441   200064 755100                    STA     FEPIO,,AUTO

      622     9179    3                NOWAIT.DCB# = B$JIT.DCBNO;

   9179  1 001442   000000 471400 xsym               LDP1    B$JIT$
         1 001443   100022 236100                    LDQ     18,,PR1
         1 001444   000011 736000                    QLS     9
         1 001445   200063 552110                    STBQ    NOWAIT,'10'O,AUTO

      623     9180    3                NOWAIT.STREAM = K$RWPARM.STR;

   9180  1 001446   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 001447   000022 736000                    QLS     18
         1 001450   200063 552120                    STBQ    NOWAIT,'20'O,AUTO

      624     9181    3                CALL FMO$GETDOMAIN(PFB);

   9181  1 001451   200104 633500                    EPPR3   PFB,,AUTO
         1 001452   200112 453500                    STP3    VSIN+4,,AUTO
         1 001453   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001454   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001455   000000 701000 xent               TSX1    FMO$GETDOMAIN
         1 001456   000000 011000                    NOP     0

      625     9182    3                NOWAIT.DMN = PFB;

   9182  1 001457   200104 236100                    LDQ     PFB,,AUTO
         1 001460   000033 736000                    QLS     27
         1 001461   200063 676100                    ERQ     NOWAIT,,AUTO
         1 001462   007000 376003                    ANQ     3584,DU
         1 001463   200063 656100                    ERSQ    NOWAIT,,AUTO

      626     9183
      627     9184        /* Make sure we have write access */
      628     9185    3                CALL HFF$WRITE1(2)
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:103  

   9185  1 001464   000020 630400 2                  EPPR0   16
         1 001465   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001466   000000 701000 xent               TSX1    HFF$WRITE1
         1 001467   001471 702000 1                  TSX2    MTRAP
         1 001470   001500 710000 1                  TRA     s:9200

      629     9186    4                WHENALTRETURN DO;

      630     9187    4   MTRAP:            B$JIT.ERR = MTRAPERR;

   9187  1 001471   000010 236000 0     MTRAP        LDQ     MTRAPERR
         1 001472   000000 470400 xsym               LDP0    B$JIT$
         1 001473   000012 756100                    STQ     10,,PR0

      631     9188                  /*E* ERROR: KIA-E$MTRAP
      632     9189                       MESSAGE: Your buffer is invalid for this read %thru %DC%.
      633     9190                       MESSAGE1: Either the buffer is missing or the wrong access.
      634     9191                        */
      635     9192    4                     K$RWPARM.TYC = %TYC_MTRAP | %TYC_EGV;

   9192  1 001474   000021 236000 0                  LDQ     XTRARD+6
         1 001475   000030 276000 xsym               ORQ     B_VECTNIL+24
         1 001476   200020 756100                    STQ     K$RWPARM+6,,AUTO

      636     9193    4                     GOTO CSEND;

   9193  1 001477   002104 710000 1                  TRA     CSEND

      637     9194    4                   END;
      638     9195
      639     9196        /*
      640     9197             Send the request data
      641     9198         */
      642     9199                     %LOCK (G=LDCT$->NK$LDCT.LOCK);

   9200  1 001500   200102 236100                    LDQ     LDCT$,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:104  
         1 001501   000020 036003                    ADLQ    16,DU
         1 001502   200112 756100                    STQ     VSIN+4,,AUTO
         1 001503   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001504   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001505   000000 701000 xent               TSX1    HFC$LOCK
         1 001506   000000 011000                    NOP     0

      643     9202    4                IF LDCT$->NK$LDCT.LKFLG.NOWAIT THEN DO;

   9202  1 001507   200102 470500                    LDP0    LDCT$,,AUTO
         1 001510   000011 236100                    LDQ     9,,PR0
         1 001511   000001 316003                    CANQ    1,DU
         1 001512   001526 600000 1                  TZE     s:9211

      644     9203        /* Some already pending, see if this one is ok to add */
      645     9204
      646     9205    4                     IF FEPSIZ~=DCB$->F$DCB.FEPSIZ

   9205  1 001513   200101 471500                    LDP1    DCB$,,AUTO
         1 001514   200062 236100                    LDQ     USRKEYSZ,,AUTO
         1 001515   100106 116100                    CMPQ    70,,PR1
         1 001516   001171 601000 1                  TNZ     CANCEL_READ
         1 001517   000100 106500                    CMPC    fill='000'O
         1 001520   000010 000003                    ADSC9   8,,PR0                   cn=0,n=3
         1 001521   200063 000004                    ADSC9   NOWAIT,,AUTO             cn=0,n=4
         1 001522   001171 601000 1                  TNZ     CANCEL_READ

      647     9206    4                          OR LDCT$->NK$LDCT.NOWAIT~=NOWAIT
      648     9207    4                     THEN GOTO CANCEL_READ;
      649     9208    4                     K$RWPARM.VDOFLGS.INCNMBRCR = '1'B;

   9208  1 001523   000004 236003                    LDQ     4,DU
         1 001524   200052 256100                    ORSQ    K$RWPARM+32,,AUTO

      650     9209    4                   END;

   9209  1 001525   001533 710000 1                  TRA     s:9214
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:105  

      651     9210    4                ELSE DO;

      652     9211    4                     LDCT$->NK$LDCT.NOWAIT = NOWAIT;

   9211  1 001526   200063 236100                    LDQ     NOWAIT,,AUTO
         1 001527   000010 552170                    STBQ    8,'70'O,PR0

      653     9212    4                     DCB$->F$DCB.FEPSIZ = FEPSIZ;

   9212  1 001530   200062 236100                    LDQ     USRKEYSZ,,AUTO
         1 001531   200101 470500                    LDP0    DCB$,,AUTO
         1 001532   000106 756100                    STQ     70,,PR0

      654     9213    4                   END;

      655     9214    3                DCB_FCN_CNT0 = DCB$->F$DCB.FCN.CNT(0);

   9214  1 001533   200101 470500                    LDP0    DCB$,,AUTO
         1 001534   000074 236100                    LDQ     60,,PR0
         1 001535   000033 772000                    QRL     27
         1 001536   000377 376007                    ANQ     255,DL
         1 001537   200062 756100                    STQ     USRKEYSZ,,AUTO

      656     9215    3                IF DCB_FCN_CNT0<3

   9215  1 001540   000003 116007                    CMPQ    3,DL
         1 001541   001571 603000 1                  TRC     s:9225
         1 001542   000000 116003                    CMPQ    0,DU
         1 001543   001557 600000 1                  TZE     s:9220
         1 001544   000111 236100                    LDQ     73,,PR0
         1 001545   777777 376007                    ANQ     -1,DL
         1 001546   200112 756100                    STQ     VSIN+4,,AUTO
         1 001547   200065 236100                    LDQ     FEPIO+1,,AUTO
         1 001550   000022 736000                    QLS     18
         1 001551   000022 732000                    QRS     18
         1 001552   200112 116100                    CMPQ    VSIN+4,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:106  
         1 001553   001557 601000 1                  TNZ     s:9220
         1 001554   200066 220100                    LDX0    FEPIO+2,,AUTO
         1 001555   000112 100100                    CMPX0   74,,PR0
         1 001556   001571 600000 1                  TZE     s:9225

      657     9216    3                     AND (DCB_FCN_CNT0=0
      658     9217    3                     OR FEPIO.BUFX~=DCB$->F$DCB.FEPIO.BUFX
      659     9218    3                     OR FEPIO.BPP(0)~=DCB$->F$DCB.FEPIO.BPP(0))
      660     9219    3                THEN
      661     9220    3                     CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM)

   9220  1 001557   200012 631500                    EPPR1   K$RWPARM,,AUTO
         1 001560   200114 451500                    STP1    VSIN+6,,AUTO
         1 001561   000014 236000 2                  LDQ     12
         1 001562   200102 235100                    LDA     LDCT$,,AUTO
         1 001563   200112 757100                    STAQ    VSIN+4,,AUTO
         1 001564   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001565   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001566   000000 701000 xent               TSX1    KIA$FCNOU
         1 001567   002163 702000 1                  TSX2    BRKOUT
         1 001570   001613 710000 1                  TRA     s:9231

      662     9221    3                          ALTRET (BRKOUT);
      663     9222    4                ELSE DO;

      664     9223        /* Gotta cancel one of them */
      665     9224
      666     9225    4                     K$RWPARM = K_RWPARM_CON;

   9225  1 001571   000100 100400                    MLR     fill='000'O
         1 001572   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 001573   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      667     9226    4                     K$RWPARM.MSG_ERRCODE = XTRARD;

   9226  1 001574   000013 236000 0                  LDQ     XTRARD
         1 001575   200051 756100                    STQ     K$RWPARM+31,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:107  

      668     9227    4                     K$RWPARM.TYC = %TYC_XTRARD;

   9227  1 001576   000020 236000 0                  LDQ     XTRARD+5
         1 001577   200020 756100                    STQ     K$RWPARM+6,,AUTO

      669     9228    4                     CALL KIA$COMP(LDCT$->NK$LDCT, K$RWPARM);

   9228  1 001600   200012 631500                    EPPR1   K$RWPARM,,AUTO
         1 001601   200113 451500                    STP1    VSIN+5,,AUTO
         1 001602   200102 236100                    LDQ     LDCT$,,AUTO
         1 001603   200112 756100                    STQ     VSIN+4,,AUTO
         1 001604   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001605   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001606   000000 701000 xent               TSX1    KIA$COMP
         1 001607   000000 011000                    NOP     0

      670     9229    4                     DCB_FCN_CNT0 = DCB_FCN_CNT0 - 1;

   9229  1 001610   200062 235100                    LDA     USRKEYSZ,,AUTO
         1 001611   000001 135007                    SBLA    1,DL
         1 001612   200062 755100                    STA     USRKEYSZ,,AUTO

      671     9230    4                   END;

      672     9231    3                LDCT$->NK$LDCT.LKFLG.NOWAIT = '1'B;

   9231  1 001613   200102 470500                    LDP0    LDCT$,,AUTO
         1 001614   000001 236003                    LDQ     1,DU
         1 001615   000011 256100                    ORSQ    9,,PR0

      673     9232
      674     9233        /*
      675     9234             Increment the user's MF count
      676     9235         */
      677     9236                     %LOCK (G=NI_MFGATE);

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:108  
   9237  1 001616   000021 630400 2                  EPPR0   17
         1 001617   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001620   000000 701000 xent               TSX1    HFC$LOCK
         1 001621   000000 011000                    NOP     0

      678     9239    3                S$CU$->B$U.MF = S$CU$->B$U.MF + 1;

   9239  1 001622   000000 470400 xsym               LDP0    S$CU$
         1 001623   000006 236100                    LDQ     6,,PR0
         1 001624   001000 036003                    ADLQ    512,DU
         1 001625   000006 552140                    STBQ    6,'40'O,PR0

      679     9240    3                S$CU$->B$U.CMF = S$CU$->B$U.CMF + 1;

   9240  1 001626   000007 236100                    LDQ     7,,PR0
         1 001627   000001 036007                    ADLQ    1,DL
         1 001630   000007 752101                    STCQ    7,'01'O,PR0

      680     9241                     %UNLOCK (G=NI_MFGATE);

   9242  1 001631   000021 630400 2                  EPPR0   17
         1 001632   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001633   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001634   000000 011000                    NOP     0

      681     9244
      682     9245    3                IF DCB_FCN_CNT0=1

   9245  1 001635   200062 235100                    LDA     USRKEYSZ,,AUTO
         1 001636   000001 115007                    CMPA    1,DL
         1 001637   001645 601000 1                  TNZ     s:9247

      683     9246    3                THEN DCB$->F$DCB.FEPIO2 = FEPIO;

   9246  1 001640   200101 470500                    LDP0    DCB$,,AUTO
         1 001641   000100 100500                    MLR     fill='000'O
         1 001642   200064 000020                    ADSC9   FEPIO,,AUTO              cn=0,n=16
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:109  
         1 001643   000127 000020                    ADSC9   87,,PR0                  cn=0,n=16
         1 001644   001660 710000 1                  TRA     s:9251

      684     9247    3                ELSE IF DCB_FCN_CNT0<1

   9247  1 001645   000000 115003                    CMPA    0,DU
         1 001646   001654 601000 1                  TNZ     s:9249

      685     9248    3                     THEN DCB$->F$DCB.FEPIO = FEPIO;

   9248  1 001647   200101 470500                    LDP0    DCB$,,AUTO
         1 001650   000100 100500                    MLR     fill='000'O
         1 001651   200064 000020                    ADSC9   FEPIO,,AUTO              cn=0,n=16
         1 001652   000110 000020                    ADSC9   72,,PR0                  cn=0,n=16
         1 001653   001660 710000 1                  TRA     s:9251

      686     9249    3                     ELSE DCB$->F$DCB.FEPIO3 = FEPIO;

   9249  1 001654   200101 470500                    LDP0    DCB$,,AUTO
         1 001655   000100 100500                    MLR     fill='000'O
         1 001656   200064 000020                    ADSC9   FEPIO,,AUTO              cn=0,n=16
         1 001657   000133 000020                    ADSC9   91,,PR0                  cn=0,n=16

      687     9250                     %UNLOCK (G=LDCT$->LDCT.LOCK);

   9251  1 001660   200102 236100                    LDQ     LDCT$,,AUTO
         1 001661   000020 036003                    ADLQ    16,DU
         1 001662   200112 756100                    STQ     VSIN+4,,AUTO
         1 001663   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001664   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001665   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001666   000000 011000                    NOP     0

      688     9253
      689     9254    3                RETURN;

   9254  1 001667   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:110  

      690     9255    3              END;
      691     9256        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:111  
      692     9257    2           IF B$JIT$->B$JIT.CPFLAGS1 & %CP_DRIBBLE# AND ENTFLG = %DCB#

   9257  1 001670   000000 470400 xsym               LDP0    B$JIT$
         1 001671   000143 236100                    LDQ     99,,PR0
         1 001672   000017 376000 0                  ANQ     XTRARD+4
         1 001673   001707 600000 1                  TZE     s:9261
         1 001674   200075 235100                    LDA     ENTFLG,,AUTO
         1 001675   001707 601000 1                  TNZ     s:9261
         1 001676   200101 236100                    LDQ     DCB$,,AUTO
         1 001677   000000 116000 xsym               CMPQ    B$M$UC$
         1 001700   001707 601000 1                  TNZ     s:9261
         1 001701   200022 236100                    LDQ     K$RWPARM+8,,AUTO
         1 001702   020000 316003                    CANQ    8192,DU
         1 001703   001707 601000 1                  TNZ     s:9261

      693     9258    2                AND DCB$ = B$M$UC$ AND NOT K$RWPARM.DVE.DVBYTE.TRANS
      694     9259    2           THEN
      695     9260    2                CALL UMD$DPMT;             /* Dribble the prompt string */

   9260  1 001704   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001705   000000 701000 xent               TSX1    UMD$DPMT
         1 001706   000000 011000                    NOP     0

      696     9261    2           K$RWPARM.VDOFLGS.WAIT = '1'B;

   9261  1 001707   000020 236003                    LDQ     16,DU
         1 001710   200052 256100                    ORSQ    K$RWPARM+32,,AUTO

      697     9262    2           CALL READS ALTRET (BRKOUTR);

   9262  1 001711   002702 701000 1                  TSX1    READS
         1 001712   002150 702000 1                  TSX2    BRKOUTR

      698     9263    2           B$JIT.INTER=B$JIT.INTER+1;

   9263  1 001713   000000 470400 xsym               LDP0    B$JIT$
         1 001714   000325 720100                    LXL0    213,,PR0
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:112  
         1 001715   000001 621010                    EAX1    1,X0
         1 001716   000325 441100                    SXL1    213,,PR0

      699     9264    3           IF ENTFLG=%DCB# THEN DO;

   9264  1 001717   200075 235100                    LDA     ENTFLG,,AUTO
         1 001720   001736 601000 1                  TNZ     s:9271

      700     9265    3                DCB$->F$DCB.DVBYTE=K$RWPARM.DVE.DVBYTE;

   9265  1 001721   200101 471500                    LDP1    DCB$,,AUTO
         1 001722   200022 236100                    LDQ     K$RWPARM+8,,AUTO
         1 001723   100003 676100                    ERQ     3,,PR1
         1 001724   776000 376003                    ANQ     -1024,DU
         1 001725   100003 656100                    ERSQ    3,,PR1

      701     9266    3                DCB$->F$DCB.EOMCHAR=K$RWPARM.DVE.EOMCHAR;

   9266  1 001726   200022 236100                    LDQ     K$RWPARM+8,,AUTO
         1 001727   000022 772000                    QRL     18
         1 001730   100003 552104                    STBQ    3,'04'O,PR1

      702     9267    3                DCB$->F$DCB.FLDID=K$RWPARM.FLDID;

   9267  1 001731   200057 720100                    LXL0    K$RWPARM+37,,AUTO
         1 001732   100061 440100                    SXL0    49,,PR1

      703     9268    3                DCB$->F$DCB.ACTPOS=K$RWPARM.ACTPOS;

   9268  1 001733   200060 221100                    LDX1    K$RWPARM+38,,AUTO
         1 001734   100057 441100                    SXL1    47,,PR1

      704     9269    3              END;

   9269  1 001735   001746 710000 1                  TRA     s:9274

      705     9270    3           ELSE DO;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:113  

      706     9271    3                DVBYTE=K$RWPARM.DVE.DVBYTE;

   9271  1 001736   200004 471500                    LDP1    @DVBYTE,,AUTO
         1 001737   000100 100500                    MLR     fill='000'O
         1 001740   200022 000001                    ADSC9   K$RWPARM+8,,AUTO         cn=0,n=1
         1 001741   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

      707     9272    3                EOMCHAR=K$RWPARM.DVE.EOMCHAR;

   9272  1 001742   200005 473500                    LDP3    @VFC,,AUTO
         1 001743   040100 100500                    MLR     fill='040'O
         1 001744   200022 200001                    ADSC9   K$RWPARM+8,,AUTO         cn=1,n=1
         1 001745   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

      708     9273    3              END;

      709     9274    2           IF B$JIT$->B$JIT.CPFLAGS1 & %CP_DRIBBLE# AND ENTFLG = %DCB#

   9274  1 001746   000143 236100                    LDQ     99,,PR0
         1 001747   000017 376000 0                  ANQ     XTRARD+4
         1 001750   002104 600000 1                  TZE     CSEND
         1 001751   000000 115003                    CMPA    0,DU
         1 001752   002104 601000 1                  TNZ     CSEND
         1 001753   200101 236100                    LDQ     DCB$,,AUTO
         1 001754   000000 116000 xsym               CMPQ    B$M$UC$
         1 001755   002104 601000 1                  TNZ     CSEND
         1 001756   200022 236100                    LDQ     K$RWPARM+8,,AUTO
         1 001757   020000 316003                    CANQ    8192,DU
         1 001760   002104 601000 1                  TNZ     CSEND

      710     9275    2                AND DCB$ = B$M$UC$ AND NOT K$RWPARM.DVE.DVBYTE.TRANS
      711     9276    2           THEN
      712     9277    2                CALL UMD$DIN(K$RWPARM.TYC);

   9277  1 001761   200020 631500                    EPPR1   K$RWPARM+6,,AUTO
         1 001762   200112 451500                    STP1    VSIN+4,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:114  
         1 001763   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 001764   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001765   000000 701000 xent               TSX1    UMD$DIN
         1 001766   000000 011000                    NOP     0
         1 001767   002104 710000 1                  TRA     CSEND

      713     9278
      714     9279
      715     9280        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:115  
      716     9281    2        CASE (MFC_RSTAT);

      717     9282    2           K$RWPARM.PRMID=PCODE;

   9282  1 001770   000100 101500                    MRL     fill='000'O
         1 001771   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 001772   200057 400002                    ADSC9   K$RWPARM+37,,AUTO        cn=2,n=2

      718     9283    2           CALL READS ALTRET (BRKOUTR);

   9283  1 001773   002702 701000 1                  TSX1    READS
         1 001774   002150 702000 1                  TSX2    BRKOUTR
         1 001775   002104 710000 1                  TRA     CSEND

      719     9284
      720     9285
      721     9286        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:116  
      722     9287    2        CASE (MFC_TCTL);

      723     9288    2           PFCN=TFCN;

   9288  1 001776   000100 101500                    MRL     fill='000'O
         1 001777   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         1 002000   200103 000004                    ADSC9   PFCN,,AUTO               cn=0,n=4

      724     9289    2           IF ADDR(BUF$)~=ADDR(NIL)

   9289  1 002001   200007 236100                    LDQ     @BUF$,,AUTO
         1 002002   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002003   002012 600000 1                  TZE     s:9293

      725     9290    2           THEN
      726     9291    2                K$RWPARM = BUF$->KI$RWPARM;

   9291  1 002004   200007 474500                    LDP4    @BUF$,,AUTO
         1 002005   400000 475500                    LDP5    0,,PR4
         1 002006   000100 100500                    MLR     fill='000'O
         1 002007   500000 000234                    ADSC9   0,,PR5                   cn=0,n=156
         1 002010   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156
         1 002011   002015 710000 1                  TRA     s:9294

      727     9292    2           ELSE
      728     9293    2                K$RWPARM = K_RWPARM_CON;

   9293  1 002012   000100 100400                    MLR     fill='000'O
         1 002013   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 002014   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      729     9294    2           K$RWPARM.STR = PFB;

   9294  1 002015   200104 236100                    LDQ     PFB,,AUTO
         1 002016   200052 552104                    STBQ    K$RWPARM+32,'04'O,AUTO

      730     9295    2           K$RWPARM.DVE.VFC = VFC;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:117  

   9295  1 002017   040100 100500                    MLR     fill='040'O
         1 002020   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 002021   200022 200001                    ADSC9   K$RWPARM+8,,AUTO         cn=1,n=1

      731     9296    2           K$RWPARM.TYC='0'B;

   9296  1 002022   200020 450100                    STZ     K$RWPARM+6,,AUTO

      732     9297    2           IF K$RWPARM.DVE.DVBYTE.RRR OR LDCT$->LDCT.TCTLCNT >= KIA_TCTLMAX

   9297  1 002023   200022 236100                    LDQ     K$RWPARM+8,,AUTO
         1 002024   010000 316003                    CANQ    4096,DU
         1 002025   002034 601000 1                  TNZ     s:9299
         1 002026   200102 474500                    LDP4    LDCT$,,AUTO
         1 002027   400026 236100                    LDQ     22,,PR4
         1 002030   000011 772000                    QRL     9
         1 002031   000777 376007                    ANQ     511,DL
         1 002032   000000 116000 0                  CMPQ    KIA_TCTLMAX
         1 002033   002036 604000 1                  TMI     s:9300

      733     9298    2           THEN
      734     9299    2                K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

   9299  1 002034   001000 236007                    LDQ     512,DL
         1 002035   200052 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      735     9300    2           K$RWPARM.DVE.DVBYTE = '0'B;

   9300  1 002036   000000 236003                    LDQ     0,DU
         1 002037   200022 552140                    STBQ    K$RWPARM+8,'40'O,AUTO

      736     9301    2           IF PFCN = 0

   9301  1 002040   200103 235100                    LDA     PFCN,,AUTO
         1 002041   002054 601000 1                  TNZ     s:9306

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:118  
      737     9302    2           THEN
      738     9303    2                LDCT$->LDCT.DFLG.NOSND = ~K$RWPARM.VDOFLGS.SEND;

   9303  1 002042   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 002043   000016 736000                    QLS     14
         1 002044   400000 376003                    ANQ     -131072,DU
         1 002045   400000 676003                    ERQ     -131072,DU
         1 002046   200102 474500                    LDP4    LDCT$,,AUTO
         1 002047   000030 772000                    QRL     24
         1 002050   400006 676100                    ERQ     6,,PR4
         1 002051   004000 376007                    ANQ     2048,DL
         1 002052   400006 656100                    ERSQ    6,,PR4
         1 002053   002104 710000 1                  TRA     CSEND

      739     9304    3           ELSE DO;

      740     9305                     %LOCK (G=LDCT$->LDCT.LOCK);

   9306  1 002054   200102 236100                    LDQ     LDCT$,,AUTO
         1 002055   000020 036003                    ADLQ    16,DU
         1 002056   200112 756100                    STQ     VSIN+4,,AUTO
         1 002057   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002060   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002061   000000 701000 xent               TSX1    HFC$LOCK
         1 002062   000000 011000                    NOP     0

      741     9308    3                CALL KIA$FCNOU (LDCT$->LDCT,PFCN,K$RWPARM) ALTRET (BRKOUT);

   9308  1 002063   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 002064   200114 450500                    STP0    VSIN+6,,AUTO
         1 002065   200103 631500                    EPPR1   PFCN,,AUTO
         1 002066   200113 451500                    STP1    VSIN+5,,AUTO
         1 002067   200102 236100                    LDQ     LDCT$,,AUTO
         1 002070   200112 756100                    STQ     VSIN+4,,AUTO
         1 002071   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002072   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002073   000000 701000 xent               TSX1    KIA$FCNOU
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:119  
         1 002074   002163 702000 1                  TSX2    BRKOUT

      742     9309    3                LDCT$->LDCT.TCTLCNT = LDCT$->LDCT.TCTLCNT + 1;

   9309  1 002075   200102 470500                    LDP0    LDCT$,,AUTO
         1 002076   000026 236100                    LDQ     22,,PR0
         1 002077   001000 036007                    ADLQ    512,DL
         1 002100   000026 552110                    STBQ    22,'10'O,PR0

      743     9310    3                GOTO WAIT_RRR_RESP;

   9310  1 002101   000574 710000 1                  TRA     WAIT_RRR_RESP

      744     9311    3              END;
      745     9312
      746     9313
      747     9314        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:120  
      748     9315    2        CASE (ELSE);

      749     9316    2           CALL SC_BTSFCN;

   9316  1 002102   000000 713400 xsym               CLIMB   SC_BTSFCN
         1 002103   000000 600000 xsid               climb   nvectors=         0

      750     9317        /*S*  SCREECH_CODE:  KIA-S$BMDFCN
      751     9318              TYPE:          SUA
      752     9319              MESSAGE:       Illegal media function passed on timesharing I/O
      753     9320              REMARKS:       Several media layer functions which are legal for
      754     9321                             files, etc. are not legal for timesharing terminals
      755     9322                             This SUA occurs when one of these is passed to KIA$UCIO
      756     9323                             NKA$DEVIO (NKA-S$BMDFCN) and KCI$RWCG (KCI-S$BMDFCN)
      757     9324                             also report this screech code in similar situations     */
      758     9325    2        END;

   9308  1 002104                       CSEND        null
      759     9326
      760     9327
      761     9328
      762     9329
      763     9330
      764     9331    1   CSEND: ;
      765     9332    1        IF ENTFLG~=%DCB#

   9332  1 002104   200075 235100                    LDA     ENTFLG,,AUTO
         1 002105   002115 600000 1                  TZE     s:9338

      766     9333    2        THEN DO;

      767     9334    2             IF ADDR(TYC) ~= ADDR(NIL)

   9334  1 002106   200006 236100                    LDQ     @EVENT,,AUTO
         1 002107   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002110   002143 600000 1                  TZE     s:9347

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:121  
      768     9335    2             THEN
      769     9336    2                  TYC = K$RWPARM.TYC;

   9336  1 002111   200020 236100                    LDQ     K$RWPARM+6,,AUTO
         1 002112   200006 470500                    LDP0    @EVENT,,AUTO
         1 002113   000000 756100                    STQ     0,,PR0

      770     9337    2           END;

   9337  1 002114   002143 710000 1                  TRA     s:9347

      771     9338    1        ELSE IF DCB$->F$DCB.WAIT ~= 0

   9338  1 002115   200101 470500                    LDP0    DCB$,,AUTO
         1 002116   000064 236100                    LDQ     52,,PR0
         1 002117   000020 316007                    CANQ    16,DL
         1 002120   002124 600000 1                  TZE     s:9341

      772     9339    1             THEN
      773     9340    1                  DCB$->F$DCB.TYC(1)=K$RWPARM.TYC;

   9340  1 002121   200020 236100                    LDQ     K$RWPARM+6,,AUTO
         1 002122   000002 756100                    STQ     2,,PR0
         1 002123   002143 710000 1                  TRA     s:9347

      774     9341    1             ELSE IF EVENT=0

   9341  1 002124   200006 471500                    LDP1    @EVENT,,AUTO
         1 002125   100000 235100                    LDA     0,,PR1
         1 002126   002133 601000 1                  TNZ     s:9345

      775     9342    1                  THEN
      776     9343    1                       DCB$->F$DCB.TYC(0)=DCB$->F$DCB.TYC(0)|K$RWPARM.TYC;

   9343  1 002127   000001 236100                    LDQ     1,,PR0
         1 002130   200020 276100                    ORQ     K$RWPARM+6,,AUTO
         1 002131   000001 756100                    STQ     1,,PR0
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:122  
         1 002132   002143 710000 1                  TRA     s:9347

      777     9344    1                  ELSE
      778     9345    1                       CALL NKA$EVENT (K$RWPARM.TYC,EVENT);

   9345  1 002133   200006 236100                    LDQ     @EVENT,,AUTO
         1 002134   200113 756100                    STQ     VSIN+5,,AUTO
         1 002135   200020 633500                    EPPR3   K$RWPARM+6,,AUTO
         1 002136   200112 453500                    STP3    VSIN+4,,AUTO
         1 002137   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002140   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002141   000000 701000 xent               TSX1    NKA$EVENT
         1 002142   000000 011000                    NOP     0

      779     9346
      780     9347    1        IF B$JIT.ERR

   9347  1 002143   000000 470400 xsym               LDP0    B$JIT$
         1 002144   000012 235100                    LDA     10,,PR0
         1 002145   002147 600000 1                  TZE     s:9351

      781     9348    1        THEN
      782     9349    1             ALTRETURN;

   9349  1 002146   000000 702200 xent               TSX2  ! X66_AALT

      783     9350
      784     9351    1        RETURN;

   9351  1 002147   000000 702200 xent               TSX2  ! X66_ARET

   9347  1 002150                       BRKOUTR      null
      785     9352
      786     9353
      787     9354    1   BRKOUTR: ;
      788     9355
      789     9356        /* Check to see if there was a trap on the buffer */
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:123  
      790     9357    1        IF K$RWPARM.ERR = %K$BAD_BUFFER

   9357  1 002150   200025 235100                    LDA     K$RWPARM+11,,AUTO
         1 002151   000002 115007                    CMPA    2,DL
         1 002152   002157 601000 1                  TNZ     s:9362

      791     9358    2        THEN DO;

      792     9359    2             K$RWPARM.TYC = %TYC_MTRAP | %TYC_EGV;

   9359  1 002153   000021 236000 0                  LDQ     XTRARD+6
         1 002154   000030 276000 xsym               ORQ     B_VECTNIL+24
         1 002155   200020 756100                    STQ     K$RWPARM+6,,AUTO

      793     9360    2             ALTRETURN;

   9360  1 002156   000000 702200 xent               TSX2  ! X66_AALT

      794     9361    2           END;
      795     9362    1        B$JIT$->B$JIT.ERR=BYDR;

   9362  1 002157   000003 236000 0                  LDQ     BYDR
         1 002160   000000 470400 xsym               LDP0    B$JIT$
         1 002161   000012 756100                    STQ     10,,PR0

      796     9363        /*E*  ERROR:         KIA-E$BYDR-C
      797     9364               MESSAGE: Asynchronous event interrupted terminal read %thru %DC%.
      798     9365              MESSAGE1: One of the following occurred while a read to
      799     9366                        your timesharing terminal was pending: BREAK,
      800     9367                        CONTROL-Y, X keyin, E keyin,  DISCONNECT.  If
      801     9368                        you can continue the read will be re-issued.
      802     9369              DESCRIPTION:   As a rule, the user never sees this error.  Either
      803     9370                             he is Xed, ERRORed, or disconnected such that he
      804     9371                             does not continue to run; or BREAK or CTL-Y was
      805     9372                             hit.  In the case of BREAK, the users break control
      806     9373                             routine can examine this code to discover whether
      807     9374                             a read to the terminal was interrupted.
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:124  
      808     9375                             In any case B$JIT.JUNK.JJ_BAKIC is set such that
      809     9376                             if the user does an M$TRTN or says GO to IBEX the
      810     9377                             interrupted pmme is re-issued                           */
      811     9378    1        GOTO BKOUT;

   9378  1 002162   002210 710000 1                  TRA     BKOUT

   9362  1 002163                       BRKOUT       null
      812     9379
      813     9380    1   BRKOUT: ;
      814     9381
      815     9382             %UNLOCK (G=LDCT$->LDCT.LOCK);

   9383  1 002163   200102 236100                    LDQ     LDCT$,,AUTO
         1 002164   000020 036003                    ADLQ    16,DU
         1 002165   200112 756100                    STQ     VSIN+4,,AUTO
         1 002166   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002167   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002170   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002171   000000 011000                    NOP     0

      816     9385    1        IF B$JIT.ERR = KIA_NODAT

   9385  1 002172   000000 470400 xsym               LDP0    B$JIT$
         1 002173   000012 236100                    LDQ     10,,PR0
         1 002174   000006 116000 0                  CMPQ    KIA_NODAT
         1 002175   002177 601000 1                  TNZ     s:9389

      817     9386    1        THEN
      818     9387    1             ALTRETURN;

   9387  1 002176   000000 702200 xent               TSX2  ! X66_AALT

      819     9388        /* Check to see if there was a trap on the buffer */
      820     9389    1        IF K$RWPARM.ERR = %K$BAD_BUFFER

   9389  1 002177   200025 235100                    LDA     K$RWPARM+11,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:125  
         1 002200   000002 115007                    CMPA    2,DL
         1 002201   002206 601000 1                  TNZ     s:9394

      821     9390    2        THEN DO;

      822     9391    2             K$RWPARM.TYC = %TYC_MTRAP | %TYC_EGV;

   9391  1 002202   000021 236000 0                  LDQ     XTRARD+6
         1 002203   000030 276000 xsym               ORQ     B_VECTNIL+24
         1 002204   200020 756100                    STQ     K$RWPARM+6,,AUTO

      823     9392    2             ALTRETURN;

   9392  1 002205   000000 702200 xent               TSX2  ! X66_AALT

      824     9393    2           END;
      825     9394    1        B$JIT$->B$JIT.ERR=BYD;

   9394  1 002206   000002 236000 0                  LDQ     BYD
         1 002207   000012 756100                    STQ     10,,PR0

   9394  1 002210                       BKOUT        null
      826     9395        /*E*  ERROR:         KIA-E$BYD-C
      827     9396               MESSAGE: Asynchronous event interrupted terminal I/O %thru %DC%.
      828     9397              MESSAGE1: One of the following occurred while I/O to
      829     9398                        your timesharing terminal was pending: BREAK,
      830     9399                        CONTROL-Y, X keyin, E keyin,  DISCONNECT.  If
      831     9400                        you can continue the I/O will be re-issued.
      832     9401              DESCRIPTION:   As a rule, the user never sees this error.  Either
      833     9402                             he is Xed, ERRORed, or disconnected such that he
      834     9403                             does not continue to run; or BREAK or CTL-Y was
      835     9404                             hit.  In the case of BREAK, the users break control
      836     9405                             routine can examine this code to discover whether
      837     9406                             terminal writes or control pmmes were in progress.
      838     9407                             In any case B$JIT.JUNK.JJ_BAKIC is set such that
      839     9408                             if the user does an M$TRTN or says GO to IBEX the
      840     9409                             interrupted pmme is re-issued                           */
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:126  
      841     9410    1   BKOUT: ;
      842     9411    1        IF LDCT$->NK$LDCT.DFLG.OLDSC       /* ERRCODE IS IN LDCT */

   9411  1 002210   200102 471500                    LDP1    LDCT$,,AUTO
         1 002211   100006 236100                    LDQ     6,,PR1
         1 002212   010000 316007                    CANQ    4096,DL
         1 002213   002222 600000 1                  TZE     s:9417
         1 002214   100000 235100                    LDA     0,,PR1
         1 002215   002222 600000 1                  TZE     s:9417

      843     9412    1             AND LDCT$->NK$LDCT.ERR ~= '0'B
      844     9413    2        THEN DO;

      845     9414    2             B$JIT$->B$JIT.ERR = LDCT$->NK$LDCT.ERR;

   9414  1 002216   100000 236100                    LDQ     0,,PR1
         1 002217   000012 756100                    STQ     10,,PR0

      846     9415    2             LDCT$->NK$LDCT.ERR = '0'B;

   9415  1 002220   200102 471500                    LDP1    LDCT$,,AUTO
         1 002221   100000 450100                    STZ     0,,PR1

      847     9416    2           END;

      848     9417    1        IF S$CU$->B$U.ASYNCH & %(~U_RESET)

   9417  1 002222   000000 471400 xsym               LDP1    S$CU$
         1 002223   100001 236100                    LDQ     1,,PR1
         1 002224   000014 376000 0                  ANQ     XTRARD+1
         1 002225   002231 600000 1                  TZE     s:9420

      849     9418    1        THEN
      850     9419    1             B$JIT$->B$JIT.JUNK=B$JIT$->B$JIT.JUNK|%JJ_BAKIC#;

   9419  1 002226   000315 220100                    LDX0    205,,PR0
         1 002227   001000 260003                    ORX0    512,DU
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:127  
         1 002230   000315 740100                    STX0    205,,PR0

      851     9420    1        ALTRETURN;

   9420  1 002231   000000 702200 xent               TSX2  ! X66_AALT

      852     9421        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:128  
      853     9422    1   KIA$CLSSTR: ENTRY (FCN,DVBYTE,VFC) ALTRET;

   9422  1 002232   000000 700200 xent  KIA$CLSSTR   TSX0  ! X66_AUTO_N
         1 002233   000120 000007                    ZERO    80,7

      854     9423
      855     9424    1        ENTFLG = %NODCB#;

   9424  1 002234   000001 235007                    LDA     1,DL
         1 002235   200075 755100                    STA     ENTFLG,,AUTO

      856     9425    1        K$RWPARM = K_RWPARM_CON;

   9425  1 002236   000100 100400                    MLR     fill='000'O
         1 002237   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 002240   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      857     9426    1        K$RWPARM.STR = ADDR(FCN)->STR;

   9426  1 002241   200003 470500                    LDP0    @FCN,,AUTO
         1 002242   000000 236100                    LDQ     0,,PR0
         1 002243   200052 552104                    STBQ    K$RWPARM+32,'04'O,AUTO

      858     9427    1        K$RWPARM.VDOFLGS.DLTSTR = ADDR(DVBYTE)->DLTSTR;

   9427  1 002244   200004 471500                    LDP1    @DVBYTE,,AUTO
         1 002245   003100 060500                    CSL     bolr='003'O
         1 002246   100000 000001                    BDSC    0,,PR1                   by=0,bit=0,n=1
         1 002247   200052 210001                    BDSC    K$RWPARM+32,,AUTO        by=1,bit=1,n=1

      859     9428    1        K$RWPARM.VDOFLGS.NEWSSN = ADDR(VFC)->NEWSSN;

   9428  1 002250   200005 473500                    LDP3    @VFC,,AUTO
         1 002251   003100 060500                    CSL     bolr='003'O
         1 002252   300000 000001                    BDSC    0,,PR3                   by=0,bit=0,n=1
         1 002253   200052 220001                    BDSC    K$RWPARM+32,,AUTO        by=1,bit=2,n=1

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:129  
      860     9429    1        LDCT$ = NK$LDCT$(B$M$UC$->F$DCB.LDCTX);

   9429  1 002254   000000 474400 xsym               LDP4    B$M$UC$
         1 002255   400051 220100                    LDX0    41,,PR4
         1 002256   000000 475400 xsym               LDP5    N$DCT$$
         1 002257   500000 236110                    LDQ     0,X0,PR5
         1 002260   200102 756100                    STQ     LDCT$,,AUTO

      861     9430    1        B$M$UC$->F$DCB.STR = 1;       /* Don't leave this strid lying around */

   9430  1 002261   000001 236007                    LDQ     1,DL
         1 002262   400077 552104                    STBQ    63,'04'O,PR4

      862     9431             %LOCK (G=LDCT$->LDCT.LOCK);

   9432  1 002263   200102 236100                    LDQ     LDCT$,,AUTO
         1 002264   000020 036003                    ADLQ    16,DU
         1 002265   200112 756100                    STQ     VSIN+4,,AUTO
         1 002266   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002267   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002270   000000 701000 xent               TSX1    HFC$LOCK
         1 002271   000000 011000                    NOP     0

      863     9434    1        IF K$RWPARM.VDOFLGS.NEWSSN

   9434  1 002272   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 002273   000100 316003                    CANQ    64,DU
         1 002274   002277 600000 1                  TZE     s:9437

      864     9435    1        THEN
      865     9436    1             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

   9436  1 002275   001000 236007                    LDQ     512,DL
         1 002276   200052 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      866     9437    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_CLSSTR,K$RWPARM) ALTRET(BRKOUT);

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:130  
   9437  1 002277   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 002300   200114 450500                    STP0    VSIN+6,,AUTO
         1 002301   000023 236000 2                  LDQ     19
         1 002302   200102 235100                    LDA     LDCT$,,AUTO
         1 002303   200112 757100                    STAQ    VSIN+4,,AUTO
         1 002304   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002305   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002306   000000 701000 xent               TSX1    KIA$FCNOU
         1 002307   002163 702000 1                  TSX2    BRKOUT

      867     9438    1        IF K$RWPARM.VDOFLGS.DLTSTR

   9438  1 002310   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 002311   000200 316003                    CANQ    128,DU
         1 002312   002321 600000 1                  TZE     s:9441

      868     9439    1        THEN
      869     9440    1             B$ROSEG$->B$ROSEG.STREAM_VALID(K$RWPARM.STR) = '0'B;

   9440  1 002313   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 002314   000777 376007                    ANQ     511,DL
         1 002315   000000 470400 xsym               LDP0    B$ROSEG$
         1 002316   003106 060400                    CSL     bolr='003'O
         1 002317   000002 000001 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=1
         1 002320   000117 000001                    BDSC    79,Q,PR0                 by=0,bit=0,n=1

      870     9441    1        GOTO WAIT_RRR_RESP;

   9441  1 002321   000574 710000 1                  TRA     WAIT_RRR_RESP

      871     9442        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:131  
      872     9443    1   KIA$OPNSSN: ENTRY (FCN) ALTRET;

   9443  1 002322   000000 700200 xent  KIA$OPNSSN   TSX0  ! X66_AUTO_N
         1 002323   000120 000007                    ZERO    80,7

      873     9444
      874     9445    1        ENTFLG = %NODCB#;

   9445  1 002324   000001 235007                    LDA     1,DL
         1 002325   200075 755100                    STA     ENTFLG,,AUTO

      875     9446    1        K$RWPARM = K_RWPARM_CON;

   9446  1 002326   000100 100400                    MLR     fill='000'O
         1 002327   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 002330   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      876     9447    1        LDCT$ = ADDR(FCN);

   9447  1 002331   200003 236100                    LDQ     @FCN,,AUTO
         1 002332   200102 756100                    STQ     LDCT$,,AUTO

      877     9448             %LOCK (G=LDCT$->LDCT.LOCK);

   9449  1 002333   000020 036003                    ADLQ    16,DU
         1 002334   200112 756100                    STQ     VSIN+4,,AUTO
         1 002335   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002336   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002337   000000 701000 xent               TSX1    HFC$LOCK
         1 002340   000000 011000                    NOP     0

      878     9451    1        K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

   9451  1 002341   001000 236007                    LDQ     512,DL
         1 002342   200052 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      879     9452    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_OPNSSN_RQS,K$RWPARM) ALTRET(BRKOUT);
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:132  

   9452  1 002343   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 002344   200114 450500                    STP0    VSIN+6,,AUTO
         1 002345   000025 236000 2                  LDQ     21
         1 002346   200102 235100                    LDA     LDCT$,,AUTO
         1 002347   200112 757100                    STAQ    VSIN+4,,AUTO
         1 002350   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002351   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002352   000000 701000 xent               TSX1    KIA$FCNOU
         1 002353   002163 702000 1                  TSX2    BRKOUT

      880     9453    1        GOTO WAIT_RRR_RESP;

   9453  1 002354   000574 710000 1                  TRA     WAIT_RRR_RESP

      881     9454        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:133  
      882     9455    1   KIA$DCLSTR: ENTRY (FCN,DVBYTE) ALTRET;

   9455  1 002355   000000 700200 xent  KIA$DCLSTR   TSX0  ! X66_AUTO_N
         1 002356   000120 000007                    ZERO    80,7

      883     9456
      884     9457    1        ENTFLG = %NODCB#;

   9457  1 002357   000001 235007                    LDA     1,DL
         1 002360   200075 755100                    STA     ENTFLG,,AUTO

      885     9458    1        K$RWPARM = K_RWPARM_CON;

   9458  1 002361   000100 100400                    MLR     fill='000'O
         1 002362   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 002363   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

   9458  1 002364                       DCLSTR       null
      886     9459    1   DCLSTR: ;
      887     9460    1        K$RWPARM.STR = ADDR(FCN)->STR;

   9460  1 002364   200003 470500                    LDP0    @FCN,,AUTO
         1 002365   000000 236100                    LDQ     0,,PR0
         1 002366   200052 552104                    STBQ    K$RWPARM+32,'04'O,AUTO

      888     9461    1        K$RWPARM.STRID = ADDR(DVBYTE)->STRID;

   9461  1 002367   200004 471500                    LDP1    @DVBYTE,,AUTO
         1 002370   100000 236100                    LDQ     0,,PR1
         1 002371   000033 736000                    QLS     27
         1 002372   200052 552140                    STBQ    K$RWPARM+32,'40'O,AUTO

      889     9462    1        LDCT$ = NK$LDCT$(B$M$UC$->F$DCB.LDCTX);

   9462  1 002373   000000 473400 xsym               LDP3    B$M$UC$
         1 002374   300051 220100                    LDX0    41,,PR3
         1 002375   000000 474400 xsym               LDP4    N$DCT$$
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:134  
         1 002376   400000 236110                    LDQ     0,X0,PR4
         1 002377   200102 756100                    STQ     LDCT$,,AUTO

      890     9463             %LOCK (G=LDCT$->LDCT.LOCK);

   9464  1 002400   000020 036003                    ADLQ    16,DU
         1 002401   200112 756100                    STQ     VSIN+4,,AUTO
         1 002402   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002403   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002404   000000 701000 xent               TSX1    HFC$LOCK
         1 002405   000000 011000                    NOP     0

      891     9466    1        K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

   9466  1 002406   001000 236007                    LDQ     512,DL
         1 002407   200052 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      892     9467    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_DCLSTR,K$RWPARM) ALTRET(BRKOUT);

   9467  1 002410   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 002411   200114 450500                    STP0    VSIN+6,,AUTO
         1 002412   000016 236000 2                  LDQ     14
         1 002413   200102 235100                    LDA     LDCT$,,AUTO
         1 002414   200112 757100                    STAQ    VSIN+4,,AUTO
         1 002415   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002416   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002417   000000 701000 xent               TSX1    KIA$FCNOU
         1 002420   002163 702000 1                  TSX2    BRKOUT

      893     9468    1        K$RWPARM.STR = K$RWPARM.STRID;     /* mark the stream ok if no error */

   9468  1 002421   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 002422   000033 772000                    QRL     27
         1 002423   200052 552104                    STBQ    K$RWPARM+32,'04'O,AUTO

      894     9469    1        GOTO WAIT_RRR_RESP;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:135  
   9469  1 002424   000574 710000 1                  TRA     WAIT_RRR_RESP

      895     9470        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:136  
      896     9471    1   KIA$REDSTR: ENTRY(FCN,DVBYTE) ALTRET;

   9471  1 002425   000000 700200 xent  KIA$REDSTR   TSX0  ! X66_AUTO_N
         1 002426   000120 000007                    ZERO    80,7

      897     9472
      898     9473    1        ENTFLG = %NODCB#;

   9473  1 002427   000001 235007                    LDA     1,DL
         1 002430   200075 755100                    STA     ENTFLG,,AUTO

      899     9474    1        K$RWPARM = K_RWPARM_CON;

   9474  1 002431   000100 100400                    MLR     fill='000'O
         1 002432   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 002433   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      900     9475    1        K$RWPARM.VDOFLGS.REDSTR = '1'B;

   9475  1 002434   000040 236003                    LDQ     32,DU
         1 002435   200052 256100                    ORSQ    K$RWPARM+32,,AUTO

      901     9476    1        GOTO DCLSTR;

   9476  1 002436   002364 710000 1                  TRA     DCLSTR

      902     9477
      903     9478        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:137  
      904     9479    1   KIA$OPNSTR: ENTRY (FCN,DVBYTE) ALTRET;

   9479  1 002437   000000 700200 xent  KIA$OPNSTR   TSX0  ! X66_AUTO_N
         1 002440   000120 000007                    ZERO    80,7

      905     9480
      906     9481    1        ENTFLG = %NODCB#;

   9481  1 002441   000001 235007                    LDA     1,DL
         1 002442   200075 755100                    STA     ENTFLG,,AUTO

      907     9482    1        K$RWPARM = K_RWPARM_CON;

   9482  1 002443   000100 100400                    MLR     fill='000'O
         1 002444   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 002445   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      908     9483    1        K$RWPARM.STR = ADDR(FCN)->STR;

   9483  1 002446   200003 470500                    LDP0    @FCN,,AUTO
         1 002447   000000 236100                    LDQ     0,,PR0
         1 002450   200052 552104                    STBQ    K$RWPARM+32,'04'O,AUTO

      909     9484
      910     9485    1        IF ADDR(DVBYTE)->F$DCB.ORG = %FORM#

   9485  1 002451   200004 471500                    LDP1    @DVBYTE,,AUTO
         1 002452   100032 236100                    LDQ     26,,PR1
         1 002453   777000 376003                    ANQ     -512,DU
         1 002454   031000 116003                    CMPQ    12800,DU
         1 002455   002461 601000 1                  TNZ     s:9488

      911     9486    1        THEN
      912     9487    1             K$RWPARM.ORG = %KV#VD_ORG_FORM;

   9487  1 002456   004000 236003                    LDQ     2048,DU
         1 002457   200052 552140                    STBQ    K$RWPARM+32,'40'O,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:138  
         1 002460   002524 710000 1                  TRA     s:9504

      913     9488    1        ELSE IF ADDR(DVBYTE)->F$DCB.ORG = %X364#

   9488  1 002461   030000 116003                    CMPQ    12288,DU
         1 002462   002466 601000 1                  TNZ     s:9491

      914     9489    1             THEN
      915     9490    1                  K$RWPARM.ORG = %KV#VD_ORG_X364;

   9490  1 002463   002000 236003                    LDQ     1024,DU
         1 002464   200052 552140                    STBQ    K$RWPARM+32,'40'O,AUTO
         1 002465   002524 710000 1                  TRA     s:9504

      916     9491    1             ELSE IF ADDR(DVBYTE)->F$DCB.ORG = %SE#

   9491  1 002466   027000 116003                    CMPQ    11776,DU
         1 002467   002522 601000 1                  TNZ     s:9503

      917     9492    2                  THEN DO;

      918     9493    2                       K$RWPARM.ORG = %KV#VD_ORG_SE;

   9493  1 002470   005000 236003                    LDQ     2560,DU
         1 002471   200052 552140                    STBQ    K$RWPARM+32,'40'O,AUTO

      919     9494    2                       IF ADDR(DVBYTE)->F$DCB.KEYL=0 OR ADDR(DVBYTE)->F$DCB.KEYL>4

   9494  1 002472   100036 236100                    LDQ     30,,PR1
         1 002473   777000 316007                    CANQ    -512,DL
         1 002474   002501 600000 1                  TZE     s:9495
         1 002475   100036 236100                    LDQ     30,,PR1
         1 002476   777000 376007                    ANQ     -512,DL
         1 002477   005000 116007                    CMPQ    2560,DL
         1 002500   002503 602000 1                  TNC     s:9496

      920     9495    2                       THEN ADDR(DVBYTE)->F$DCB.KEYL = 4;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:139  

   9495  1 002501   004000 236007                    LDQ     2048,DL
         1 002502   100036 552110                    STBQ    30,'10'O,PR1

      921     9496    2                       K$RWPARM.KEYSZ = ADDR(DVBYTE)->F$DCB.KEYL;

   9496  1 002503   100036 236100                    LDQ     30,,PR1
         1 002504   000011 772000                    QRL     9
         1 002505   200060 552104                    STBQ    K$RWPARM+38,'04'O,AUTO

      922     9497    2                       K$RWPARM.SPARE = ADDR(DVBYTE)->F$DCB.SPARE;

   9497  1 002506   100040 236100                    LDQ     32,,PR1
         1 002507   000011 772000                    QRL     9
         1 002510   200052 552120                    STBQ    K$RWPARM+32,'20'O,AUTO

      923     9498    2                       K$RWPARM.NRECS = ADDR(DVBYTE)->F$DCB.NRECS;

   9498  1 002511   100042 236100                    LDQ     34,,PR1
         1 002512   000011 736000                    QLS     9
         1 002513   200060 552110                    STBQ    K$RWPARM+38,'10'O,AUTO

      924     9499    2                       IF ADDR(DVBYTE)->F$DCB.KEYTYPE=0

   9499  1 002514   100056 236100                    LDQ     46,,PR1
         1 002515   000777 316003                    CANQ    511,DU
         1 002516   002524 601000 1                  TNZ     s:9504

      925     9500    2                       THEN ADDR(DVBYTE)->F$DCB.KEYTYPE = %KEYTYPE_BIN10#;

   9500  1 002517   000004 236003                    LDQ     4,DU
         1 002520   100056 552120                    STBQ    46,'20'O,PR1

      926     9501    2                     END;

   9501  1 002521   002524 710000 1                  TRA     s:9504

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:140  
      927     9502    1                  ELSE
      928     9503    1                       K$RWPARM.ORG = %KV#VD_ORG_UR;

   9503  1 002522   001000 236003                    LDQ     512,DU
         1 002523   200052 552140                    STBQ    K$RWPARM+32,'40'O,AUTO

      929     9504    1        LDCT$ = NK$LDCT$(B$M$UC$->F$DCB.LDCTX);

   9504  1 002524   000000 473400 xsym               LDP3    B$M$UC$
         1 002525   300051 220100                    LDX0    41,,PR3
         1 002526   000000 474400 xsym               LDP4    N$DCT$$
         1 002527   400000 236110                    LDQ     0,X0,PR4
         1 002530   200102 756100                    STQ     LDCT$,,AUTO

      930     9505             %LOCK (G=LDCT$->LDCT.LOCK);

   9506  1 002531   000020 036003                    ADLQ    16,DU
         1 002532   200112 756100                    STQ     VSIN+4,,AUTO
         1 002533   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002534   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002535   000000 701000 xent               TSX1    HFC$LOCK
         1 002536   000000 011000                    NOP     0

      931     9508    1        IF K$RWPARM.ORG ~= %KV#VD_ORG_UR

   9508  1 002537   200052 236100                    LDQ     K$RWPARM+32,,AUTO
         1 002540   777000 376003                    ANQ     -512,DU
         1 002541   001000 116003                    CMPQ    512,DU
         1 002542   002545 600000 1                  TZE     s:9511

      932     9509    1        THEN
      933     9510    1             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

   9510  1 002543   001000 236007                    LDQ     512,DL
         1 002544   200052 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

      934     9511    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_OPNSTR,K$RWPARM) ALTRET(BRKOUT);
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:141  

   9511  1 002545   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 002546   200114 450500                    STP0    VSIN+6,,AUTO
         1 002547   000027 236000 2                  LDQ     23
         1 002550   200102 235100                    LDA     LDCT$,,AUTO
         1 002551   200112 757100                    STAQ    VSIN+4,,AUTO
         1 002552   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002553   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002554   000000 701000 xent               TSX1    KIA$FCNOU
         1 002555   002163 702000 1                  TSX2    BRKOUT

      935     9512    1        GOTO WAIT_RRR_RESP;

   9512  1 002556   000574 710000 1                  TRA     WAIT_RRR_RESP

      936     9513        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:142  
      937     9514    1   KIA$WINDOW: ENTRY(FCN,DVBYTE) ALTRET;

   9514  1 002557   000000 700200 xent  KIA$WINDOW   TSX0  ! X66_AUTO_N
         1 002560   000120 000007                    ZERO    80,7

      938     9515
      939     9516    1        ENTFLG = %NODCB#;

   9516  1 002561   000001 235007                    LDA     1,DL
         1 002562   200075 755100                    STA     ENTFLG,,AUTO

      940     9517    1        CALL FSN$CONV_STR (ADDR(DVBYTE)->VLP$WINDOW_V.FWINDOW,ADDR(DVBYTE)->
              9517                 VLP$WINDOW_V.FSTR.ID)

   9517  1 002563   200004 236100                    LDQ     @DVBYTE,,AUTO
         1 002564   200004 235100                    LDA     @DVBYTE,,AUTO
         1 002565   200112 757100                    STAQ    VSIN+4,,AUTO
         1 002566   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002567   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002570   000000 701000 xent               TSX1    FSN$CONV_STR
         1 002571   002573 702000 1                  TSX2    s:9519
         1 002572   002574 710000 1                  TRA     s:9521

      941     9518    2        WHENALTRETURN DO;

      942     9519    2             ALTRETURN;

   9519  1 002573   000000 702200 xent               TSX2  ! X66_AALT

      943     9520    2           END;
      944     9521    1        CALL KIA$9TO8 (ADDR(DVBYTE)->WINDOW.LENGTH,

   9521  1 002574   000020 236000 2                  LDQ     16
         1 002575   200114 756100                    STQ     VSIN+6,,AUTO
         1 002576   200004 236100                    LDQ     @DVBYTE,,AUTO
         1 002577   000001 036003                    ADLQ    1,DU
         1 002600   200113 756100                    STQ     VSIN+5,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:143  
         1 002601   200112 756100                    STQ     VSIN+4,,AUTO
         1 002602   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002603   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002604   000000 701000 xent               TSX1    KIA$9TO8
         1 002605   000000 011000                    NOP     0

      945     9522    1             ADDR(DVBYTE)->WINDOW.LENGTH,2);
      946     9523    1        CALL KIA$9TO8 (ADDR(DVBYTE)->WINDOW.WIDTH,

   9523  1 002606   000020 236000 2                  LDQ     16
         1 002607   200114 756100                    STQ     VSIN+6,,AUTO
         1 002610   200004 236100                    LDQ     @DVBYTE,,AUTO
         1 002611   000030 036000 2                  ADLQ    24
         1 002612   200113 756100                    STQ     VSIN+5,,AUTO
         1 002613   200112 756100                    STQ     VSIN+4,,AUTO
         1 002614   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002615   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002616   000000 701000 xent               TSX1    KIA$9TO8
         1 002617   000000 011000                    NOP     0

      947     9524    1             ADDR(DVBYTE)->WINDOW.WIDTH,2);
      948     9525    1        CALL KIA$9TO8 (ADDR(DVBYTE)->WINDOW.ORG_PST.COLUMN,

   9525  1 002620   000020 236000 2                  LDQ     16
         1 002621   200114 756100                    STQ     VSIN+6,,AUTO
         1 002622   200004 236100                    LDQ     @DVBYTE,,AUTO
         1 002623   000031 036000 2                  ADLQ    25
         1 002624   200113 756100                    STQ     VSIN+5,,AUTO
         1 002625   200112 756100                    STQ     VSIN+4,,AUTO
         1 002626   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002627   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002630   000000 701000 xent               TSX1    KIA$9TO8
         1 002631   000000 011000                    NOP     0

      949     9526    1             ADDR(DVBYTE)->WINDOW.ORG_PST.COLUMN,2);
      950     9527    1        K$RWPARM = K_RWPARM_CON;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:144  
   9527  1 002632   000100 100400                    MLR     fill='000'O
         1 002633   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 002634   200012 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

      951     9528    1        K$RWPARM.STR = ADDR(FCN)->STR;

   9528  1 002635   200003 470500                    LDP0    @FCN,,AUTO
         1 002636   000000 236100                    LDQ     0,,PR0
         1 002637   200052 552104                    STBQ    K$RWPARM+32,'04'O,AUTO

      952     9529    1        K$RWPARM.MSG$ = ADDR(DVBYTE);

   9529  1 002640   200004 236100                    LDQ     @DVBYTE,,AUTO
         1 002641   200012 756100                    STQ     K$RWPARM,,AUTO

      953     9530    1        K$RWPARM.MSGSZ = SIZEC(VLP$WINDOW_V);

   9530  1 002642   000040 235007                    LDA     32,DL
         1 002643   200013 755100                    STA     K$RWPARM+1,,AUTO

      954     9531    1        K$RWPARM.PRMID = %KV_PRMID_WINDOW;

   9531  1 002644   000020 220003                    LDX0    16,DU
         1 002645   200057 440100                    SXL0    K$RWPARM+37,,AUTO

      955     9532    1        LDCT$ = NK$LDCT$(B$M$UC$->F$DCB.LDCTX);

   9532  1 002646   000000 471400 xsym               LDP1    B$M$UC$
         1 002647   100051 221100                    LDX1    41,,PR1
         1 002650   000000 473400 xsym               LDP3    N$DCT$$
         1 002651   300000 236111                    LDQ     0,X1,PR3
         1 002652   200102 756100                    STQ     LDCT$,,AUTO

      956     9533             %LOCK (G=LDCT$->LDCT.LOCK);

   9534  1 002653   000020 036003                    ADLQ    16,DU
         1 002654   200112 756100                    STQ     VSIN+4,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:145  
         1 002655   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002656   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002657   000000 701000 xent               TSX1    HFC$LOCK
         1 002660   000000 011000                    NOP     0

      957     9536    1        CALL KIA$FCNOU(LDCT$->LDCT,%KV_VDO_FNC_PRM_SET,K$RWPARM) ALTRET(BRKOUT);

   9536  1 002661   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 002662   200114 450500                    STP0    VSIN+6,,AUTO
         1 002663   000012 236000 2                  LDQ     10
         1 002664   200102 235100                    LDA     LDCT$,,AUTO
         1 002665   200112 757100                    STAQ    VSIN+4,,AUTO
         1 002666   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002667   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002670   000000 701000 xent               TSX1    KIA$FCNOU
         1 002671   002163 702000 1                  TSX2    BRKOUT

      958     9537             %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   9538  1 002672   200102 236100                    LDQ     LDCT$,,AUTO
         1 002673   000020 036003                    ADLQ    16,DU
         1 002674   200112 756100                    STQ     VSIN+4,,AUTO
         1 002675   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002676   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002677   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002700   000000 011000                    NOP     0

      959     9540    1        RETURN;

   9540  1 002701   000000 702200 xent               TSX2  ! X66_ARET

      960     9541
      961     9542        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:146  
      962     9543    1   READS: PROC ALTRET;

   9543  1 002702   200110 741300       READS        STX1  ! VSIN+2,,AUTO

      963     9544
      964     9545        /*I*
      965     9546             NAME: READS
      966     9547             PURPOSE:
      967     9548                  To perform a read function from the terminal.
      968     9549             CALL:
      969     9550                  CALL READS ALTRET( );
      970     9551             DATA:
      971     9552                  K$RWPARM - Set up with the read information
      972     9553                  LDCT$    - Pointing to the TS terminal's LDCT
      973     9554             DESCRIPTION:
      974     9555                  When a read is done from the terminal the first thing send
      975     9556                  to the terminal is a read request then the user if regged for
      976     9557                  communication read event. When a message comes in satisfying the
      977     9558                  read, KIA$UCIN unreg's the user. A read is done from KIS$SEND
      978     9559                  which will find the message that caused the read completion and
      979     9560                  move it into the user's buffer. If a BRK or CNTRL Y interrupted
      980     9561                  the read and this is not KIA$UCIOND, this procedure
      981     9562                  will ALTRETURN.
      982     9563        */
      983     9564    2        IF MSGSZ = 0 OR MSG$ = ADDR(NIL)   /* No read buffer */

   9564  1 002703   200100 235100                    LDA     MSGSZ,,AUTO
         1 002704   002710 600000 1                  TZE     s:9566
         1 002705   200076 236100                    LDQ     MSG$,,AUTO
         1 002706   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002707   002711 601000 1                  TNZ     s:9568

      984     9565    2        THEN
      985     9566    2             RETURN;

   9566  1 002710   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:147  
      986     9567             %LOCK (G=LDCT$->NK$LDCT.LOCK);

   9568  1 002711   200102 236100                    LDQ     LDCT$,,AUTO
         1 002712   000020 036003                    ADLQ    16,DU
         1 002713   200112 756100                    STQ     VSIN+4,,AUTO
         1 002714   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002715   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002716   000000 701000 xent               TSX1    HFC$LOCK
         1 002717   000000 011000                    NOP     0

      987     9570    2        IF FCN = MFC_READ

   9570  1 002720   200003 470500                    LDP0    @FCN,,AUTO
         1 002721   000000 235100                    LDA     0,,PR0
         1 002722   002735 601000 1                  TNZ     s:9574

      988     9571    2        THEN
      989     9572    2            CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM) ALTRET (BRKCK)
              9572                      ;

   9572  1 002723   200012 631500                    EPPR1   K$RWPARM,,AUTO
         1 002724   200114 451500                    STP1    VSIN+6,,AUTO
         1 002725   000014 236000 2                  LDQ     12
         1 002726   200102 235100                    LDA     LDCT$,,AUTO
         1 002727   200112 757100                    STAQ    VSIN+4,,AUTO
         1 002730   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002731   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002732   000000 701000 xent               TSX1    KIA$FCNOU
         1 002733   003270 702000 1                  TSX2    BRKCK
         1 002734   002746 710000 1                  TRA     s:9577

      990     9573    2        ELSE
      991     9574    2            CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSPRM,K$RWPARM) ALTRET (BRKCK)
              9574                      ;

   9574  1 002735   200012 631500                    EPPR1   K$RWPARM,,AUTO
         1 002736   200114 451500                    STP1    VSIN+6,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:148  
         1 002737   000033 236000 2                  LDQ     27
         1 002740   200102 235100                    LDA     LDCT$,,AUTO
         1 002741   200112 757100                    STAQ    VSIN+4,,AUTO
         1 002742   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002743   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002744   000000 701000 xent               TSX1    KIA$FCNOU
         1 002745   003270 702000 1                  TSX2    BRKCK

      992     9575
      993     9576        /* SS unlock LDCT$->NK$LDCT.LOCK */
      994     9577    2        IF ENTFLG ~= %DCB#

   9577  1 002746   200075 235100                    LDA     ENTFLG,,AUTO
         1 002747   002761 600000 1                  TZE     s:9581

      995     9578    2        THEN
      996     9579    2             CALL SSR$REG(%SS_CW,LDCT$) ALTRET(REGALT);

   9579  1 002750   200102 630500                    EPPR0   LDCT$,,AUTO
         1 002751   200113 450500                    STP0    VSIN+5,,AUTO
         1 002752   000006 236000 2                  LDQ     6
         1 002753   200112 756100                    STQ     VSIN+4,,AUTO
         1 002754   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002755   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002756   000000 701000 xent               TSX1    SSR$REG
         1 002757   003211 702000 1                  TSX2    REGALT
         1 002760   002771 710000 1                  TRA     s:9583

      997     9580    2        ELSE
      998     9581    2             CALL SSR$REG (%SS_CRD,LDCT$) ALTRET(REGALT);

   9581  1 002761   200102 630500                    EPPR0   LDCT$,,AUTO
         1 002762   200113 450500                    STP0    VSIN+5,,AUTO
         1 002763   000034 236000 2                  LDQ     28
         1 002764   200112 756100                    STQ     VSIN+4,,AUTO
         1 002765   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002766   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:149  
         1 002767   000000 701000 xent               TSX1    SSR$REG
         1 002770   003211 702000 1                  TSX2    REGALT

      999     9582             %LOCK (G=LDCT$->NK$LDCT.LOCK);

   9583  1 002771   200102 236100                    LDQ     LDCT$,,AUTO
         1 002772   000020 036003                    ADLQ    16,DU
         1 002773   200112 756100                    STQ     VSIN+4,,AUTO
         1 002774   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 002775   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002776   000000 701000 xent               TSX1    HFC$LOCK
         1 002777   000000 011000                    NOP     0

   9577  1 003000                       READ_IT      null
     1000     9585    2   READ_IT: ;
     1001     9586    2        K$RWPARM.IP$ = LDCT$->LDCT.IP$;

   9586  1 003000   200102 470500                    LDP0    LDCT$,,AUTO
         1 003001   000013 236100                    LDQ     11,,PR0
         1 003002   200024 756100                    STQ     K$RWPARM+10,,AUTO

     1002     9587    2        LDCT$->LDCT.IP$ = ADDR(NIL);

   9587  1 003003   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003004   000013 756100                    STQ     11,,PR0

     1003     9588    2        IF K$RWPARM.IP$ = ADDR(NIL)

   9588  1 003005   200024 236100                    LDQ     K$RWPARM+10,,AUTO
         1 003006   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003007   003270 600000 1                  TZE     BRKCK

     1004     9589    2        THEN GOTO BRKCK;
     1005     9590    2        CALL KIQ$MAPFEP (LDCT$->NK$LDCT.IPFEI#);

   9590  1 003010   200102 236100                    LDQ     LDCT$,,AUTO
         1 003011   000007 036000 2                  ADLQ    7
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:150  
         1 003012   200112 756100                    STQ     VSIN+4,,AUTO
         1 003013   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003014   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003015   000000 701000 xent               TSX1    KIQ$MAPFEP
         1 003016   000000 011000                    NOP     0

     1006     9591    2        K$RWPARM.UHDR$ = PINCRC(K$RWPARM.IP$,K$RWPARM.IP$->KI$QMHDR.OFFSET);

   9591  1 003017   200024 470500                    LDP0    K$RWPARM+10,,AUTO
         1 003020   000001 236100                    LDQ     1,,PR0
         1 003021   000022 772000                    QRL     18
         1 003022   000020 736000                    QLS     16
         1 003023   200024 036100                    ADLQ    K$RWPARM+10,,AUTO
         1 003024   200026 756100                    STQ     K$RWPARM+12,,AUTO

     1007     9592    2        K$RWPARM.UHDRSZ = K$RWPARM.IP$->KI$QMHDR.SIZE;

   9592  1 003025   000001 236100                    LDQ     1,,PR0
         1 003026   777777 376007                    ANQ     -1,DL
         1 003027   200027 756100                    STQ     K$RWPARM+13,,AUTO

     1008     9593    2        K$RWPARM.TYC = '0'B;

   9593  1 003030   200020 450100                    STZ     K$RWPARM+6,,AUTO

     1009     9594    2        CALL KIA$MSG (K$RWPARM);

   9594  1 003031   200012 631500                    EPPR1   K$RWPARM,,AUTO
         1 003032   200112 451500                    STP1    VSIN+4,,AUTO
         1 003033   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003034   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003035   000000 701000 xent               TSX1    KIA$MSG
         1 003036   000000 011000                    NOP     0

     1010     9595    2        IF MSGSZ<K$RWPARM.MSGSZ THEN K$RWPARM.TYC=K$RWPARM.TYC|%TYC_DI|%TYC_EGV;

   9595  1 003037   200100 236100                    LDQ     MSGSZ,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:151  
         1 003040   003050 604000 1                  TMI     s:9596
         1 003041   200013 116100                    CMPQ    K$RWPARM+1,,AUTO
         1 003042   003050 605000 1                  TPL     s:9596

   9595  1 003043   200020 236100                    LDQ     K$RWPARM+6,,AUTO
         1 003044   000022 276000 0                  ORQ     XTRARD+7
         1 003045   000030 276000 xsym               ORQ     B_VECTNIL+24
         1 003046   200020 756100                    STQ     K$RWPARM+6,,AUTO
         1 003047   003052 710000 1                  TRA     s:9597

     1011     9596    2        ELSE MSGSZ=K$RWPARM.MSGSZ;

   9596  1 003050   200013 235100                    LDA     K$RWPARM+1,,AUTO
         1 003051   200100 755100                    STA     MSGSZ,,AUTO

     1012     9597    2        IF ENTFLG=%DCB#

   9597  1 003052   200075 235100                    LDA     ENTFLG,,AUTO
         1 003053   003060 601000 1                  TNZ     s:9599

     1013     9598    2        THEN DCB$->F$DCB.ARS=MSGSZ;

   9598  1 003054   200100 236100                    LDQ     MSGSZ,,AUTO
         1 003055   200101 470500                    LDP0    DCB$,,AUTO
         1 003056   000000 756100                    STQ     0,,PR0
         1 003057   003063 710000 1                  TRA     s:9600

     1014     9599    2        ELSE BUFLEN=MSGSZ;

   9599  1 003060   200010 470500                    LDP0    @BUFLEN,,AUTO
         1 003061   200100 236100                    LDQ     MSGSZ,,AUTO
         1 003062   000000 756100                    STQ     0,,PR0

     1015     9600    2        IF K$RWPARM.MSG$ ~= ADDR(NIL)

   9600  1 003063   200012 236100                    LDQ     K$RWPARM,,AUTO
         1 003064   000001 116000 xsym               CMPQ    B_VECTNIL+1
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:152  
         1 003065   003077 600000 1                  TZE     s:9605

     1016     9601    3        THEN DO;

     1017     9602    3             CALL HFF$TRAPALT ALTRET (BADRBUF);

   9602  1 003066   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003067   000000 701000 xent               TSX1    HFF$TRAPALT
         1 003070   003205 702000 1                  TSX2    BADRBUF

     1018     9603    3             MSG$->VCHRM = K$RWPARM.MSG$->VCHRM;

   9603  1 003071   200012 470500                    LDP0    K$RWPARM,,AUTO
         1 003072   200100 720100                    LXL0    MSGSZ,,AUTO
         1 003073   200076 471500                    LDP1    MSG$,,AUTO
         1 003074   040140 100540                    MLR     fill='040'O
         1 003075   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 003076   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

     1019     9604    3           END;

     1020     9605    2        IF K$RWPARM.KEY$ ~= ADDR(NIL) AND FPT$ ~= ADDR(NIL) AND FPT$->FPT$READ_V.KEYR

   9605  1 003077   200056 236100                    LDQ     K$RWPARM+36,,AUTO
         1 003100   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003101   003134 600000 1                  TZE     TRTNR
         1 003102   200072 236100                    LDQ     FPT$,,AUTO
         1 003103   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003104   003134 600000 1                  TZE     TRTNR
         1 003105   200072 470500                    LDP0    FPT$,,AUTO
         1 003106   000000 236100                    LDQ     0,,PR0
         1 003107   100000 316007                    CANQ    32768,DL
         1 003110   003134 600000 1                  TZE     TRTNR

     1021     9606    3        THEN DO;

     1022     9607    3             CALL HFF$TRAPALT ALTRET (BADRBUF);
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:153  

   9607  1 003111   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003112   000000 701000 xent               TSX1    HFF$TRAPALT
         1 003113   003205 702000 1                  TSX2    BADRBUF

     1023     9608    3             CALL HFF$DSIZ(1,USRKEYSZ);

   9608  1 003114   200062 630500                    EPPR0   USRKEYSZ,,AUTO
         1 003115   200113 450500                    STP0    VSIN+5,,AUTO
         1 003116   000003 236000 2                  LDQ     3
         1 003117   200112 756100                    STQ     VSIN+4,,AUTO
         1 003120   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003121   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003122   000000 701000 xent               TSX1    HFF$DSIZ
         1 003123   000000 011000                    NOP     0

     1024     9609    3             B$PS1$->USRKEY = K$RWPARM.KEY$->KEY;

   9609  1 003124   200060 720100                    LXL0    K$RWPARM+38,,AUTO
         1 003125   000777 360003                    ANX0    511,DU
         1 003126   200056 470500                    LDP0    K$RWPARM+36,,AUTO
         1 003127   000000 471400 xsym               LDP1    B$PS1$
         1 003130   200062 721100                    LXL1    USRKEYSZ,,AUTO
         1 003131   040140 100540                    MLR     fill='040'O
         1 003132   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         1 003133   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

     1025     9610    3           END;

     1026     9611    2   TRTNR: ;

   9611  1 003134                       TRTNR        null
     1027     9612    2        B$JIT.ERR = K$RWPARM.MSG_ERRCODE;

   9612  1 003134   200051 236100                    LDQ     K$RWPARM+31,,AUTO
         1 003135   000000 470400 xsym               LDP0    B$JIT$
         1 003136   000012 756100                    STQ     10,,PR0
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:154  

     1028     9613    2        K$RWPARM.LDCT$ = LDCT$;

   9613  1 003137   200102 236100                    LDQ     LDCT$,,AUTO
         1 003140   200030 756100                    STQ     K$RWPARM+14,,AUTO

     1029     9614    2        K$RWPARM.FUNCTION = %K_READDONE;

   9614  1 003141   000011 235007                    LDA     9,DL
         1 003142   200032 755100                    STA     K$RWPARM+16,,AUTO

     1030     9615    2        CALL KIS$SEND (K$RWPARM) ALTRET(BRKCK);

   9615  1 003143   200012 631500                    EPPR1   K$RWPARM,,AUTO
         1 003144   200112 451500                    STP1    VSIN+4,,AUTO
         1 003145   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003146   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003147   000000 701000 xent               TSX1    KIS$SEND
         1 003150   003270 702000 1                  TSX2    BRKCK

     1031     9616    2        IF LDCT$->LDCT.LKFLG.WTMRK

   9616  1 003151   200102 470500                    LDP0    LDCT$,,AUTO
         1 003152   000011 236100                    LDQ     9,,PR0
         1 003153   020000 316003                    CANQ    8192,DU
         1 003154   003166 600000 1                  TZE     s:9621

     1032     9617    2        THEN
     1033     9618    2             CALL SSR$REG(%SS_CW,LDCT$);

   9618  1 003155   200102 631500                    EPPR1   LDCT$,,AUTO
         1 003156   200113 451500                    STP1    VSIN+5,,AUTO
         1 003157   000006 236000 2                  LDQ     6
         1 003160   200112 756100                    STQ     VSIN+4,,AUTO
         1 003161   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003162   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003163   000000 701000 xent               TSX1    SSR$REG
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:155  
         1 003164   000000 011000                    NOP     0
         1 003165   003175 710000 1                  TRA     s:9623

     1034     9619    2        ELSE
     1035     9620                  %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   9621  1 003166   200102 236100                    LDQ     LDCT$,,AUTO
         1 003167   000020 036003                    ADLQ    16,DU
         1 003170   200112 756100                    STQ     VSIN+4,,AUTO
         1 003171   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003172   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003173   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003174   000000 011000                    NOP     0

     1036     9623    2        IF K$RWPARM.TYC&%TYC_DISC

   9623  1 003175   200020 236100                    LDQ     K$RWPARM+6,,AUTO
         1 003176   000023 376000 0                  ANQ     XTRARD+8
         1 003177   003203 600000 1                  TZE     s:9628

     1037     9624    3        THEN DO;

     1038     9625    3             K$RWPARM.TYC='0'B;

   9625  1 003200   200020 450100                    STZ     K$RWPARM+6,,AUTO

     1039     9626    3             ALTRETURN;

   9626  1 003201   200110 221300                    LDX1  ! VSIN+2,,AUTO
         1 003202   000000 702211                    TSX2  ! 0,X1

     1040     9627    3           END;
     1041     9628    2        RETURN;

   9628  1 003203   200110 221300                    LDX1  ! VSIN+2,,AUTO
         1 003204   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:156  
   9623  1 003205                       BADRBUF      null
     1042     9629
     1043     9630
     1044     9631    2   BADRBUF: ;
     1045     9632    2        K$RWPARM.TYC = %TYC_MTRAP | %TYC_EGV;

   9632  1 003205   000021 236000 0                  LDQ     XTRARD+6
         1 003206   000030 276000 xsym               ORQ     B_VECTNIL+24
         1 003207   200020 756100                    STQ     K$RWPARM+6,,AUTO

     1046     9633    2        GOTO TRTNR;

   9633  1 003210   003134 710000 1                  TRA     TRTNR

   9632  1 003211                       REGALT       null
     1047     9634    2   REGALT: ;
     1048     9635             %LOCK (G=LDCT$->NK$LDCT.LOCK);

   9636  1 003211   200102 236100                    LDQ     LDCT$,,AUTO
         1 003212   000020 036003                    ADLQ    16,DU
         1 003213   200112 756100                    STQ     VSIN+4,,AUTO
         1 003214   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003215   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003216   000000 701000 xent               TSX1    HFC$LOCK
         1 003217   000000 011000                    NOP     0

     1049     9638    2        IF NOT LDCT$->LDCT.LKFLG.MRKPND    /* Pending marker from brk  */

   9638  1 003220   200102 470500                    LDP0    LDCT$,,AUTO
         1 003221   000011 234100                    SZN     9,,PR0
         1 003222   003264 604000 1                  TMI     s:9653

     1050     9639    3        THEN DO;

     1051     9640    3             IF LDCT$->LDCT.IP$ ~= ADDR(NIL)

   9640  1 003223   000013 236100                    LDQ     11,,PR0
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:157  
         1 003224   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003225   003000 601000 1                  TNZ     READ_IT

     1052     9641    3             THEN
     1053     9642    3                  GOTO READ_IT;
     1054     9643    3             K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

   9643  1 003226   001000 236007                    LDQ     512,DL
         1 003227   200052 552110                    STBQ    K$RWPARM+32,'10'O,AUTO

     1055     9644    3             LDCT$->LDCT.LKFLG.WTMRK = '1'B;

   9644  1 003230   020000 236003                    LDQ     8192,DU
         1 003231   000011 256100                    ORSQ    9,,PR0

     1056     9645    3             K$RWPARM.MAXNMBRCR = 0;

   9645  1 003232   000000 220003                    LDX0    0,DU
         1 003233   200053 740100                    STX0    K$RWPARM+33,,AUTO

     1057     9646    3            CALL KIA$FCNOU (LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,K$RWPARM) ALTRET(BRKCK);

   9646  1 003234   200012 630500                    EPPR0   K$RWPARM,,AUTO
         1 003235   200114 450500                    STP0    VSIN+6,,AUTO
         1 003236   000014 236000 2                  LDQ     12
         1 003237   200102 235100                    LDA     LDCT$,,AUTO
         1 003240   200112 757100                    STAQ    VSIN+4,,AUTO
         1 003241   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003242   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003243   000000 701000 xent               TSX1    KIA$FCNOU
         1 003244   003270 702000 1                  TSX2    BRKCK

     1058     9647        /* SS unlocks LDCT$->LDCT.LOCK */
     1059     9648    3             CALL SSR$REG (%SS_CW,LDCT$);

   9648  1 003245   200102 630500                    EPPR0   LDCT$,,AUTO
         1 003246   200113 450500                    STP0    VSIN+5,,AUTO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:158  
         1 003247   000006 236000 2                  LDQ     6
         1 003250   200112 756100                    STQ     VSIN+4,,AUTO
         1 003251   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003252   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003253   000000 701000 xent               TSX1    SSR$REG
         1 003254   000000 011000                    NOP     0

     1060     9649                  %LOCK (G=LDCT$->LDCT.LOCK);

   9650  1 003255   200102 236100                    LDQ     LDCT$,,AUTO
         1 003256   000020 036003                    ADLQ    16,DU
         1 003257   200112 756100                    STQ     VSIN+4,,AUTO
         1 003260   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003261   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003262   000000 701000 xent               TSX1    HFC$LOCK
         1 003263   000000 011000                    NOP     0

     1061     9652    3           END;

     1062     9653    2        IF LDCT$->LDCT.IP$ ~= ADDR(NIL)

   9653  1 003264   200102 470500                    LDP0    LDCT$,,AUTO
         1 003265   000013 236100                    LDQ     11,,PR0
         1 003266   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003267   003000 601000 1                  TNZ     READ_IT

   9653  1 003270                       BRKCK        null
     1063     9654    2        THEN
     1064     9655    2             GOTO READ_IT;
     1065     9656    2   BRKCK: ;
     1066     9657             %UNLOCK (G=LDCT$->NK$LDCT.LOCK);

   9658  1 003270   200102 236100                    LDQ     LDCT$,,AUTO
         1 003271   000020 036003                    ADLQ    16,DU
         1 003272   200112 756100                    STQ     VSIN+4,,AUTO
         1 003273   200112 630500                    EPPR0   VSIN+4,,AUTO
         1 003274   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:159  
         1 003275   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003276   000000 011000                    NOP     0

     1067     9660    2        IF K$RWPARM.ERR~=0

   9660  1 003277   200025 235100                    LDA     K$RWPARM+11,,AUTO
         1 003300   003303 600000 1                  TZE     s:9663

     1068     9661    2        THEN
     1069     9662    2             ALTRETURN;

   9662  1 003301   200110 221300                    LDX1  ! VSIN+2,,AUTO
         1 003302   000000 702211                    TSX2  ! 0,X1

     1070     9663    2        IF S$CU$->B$U.ASYNCH&%(~U_RESET)='0'B

   9663  1 003303   400000 220003                    LDX0    -131072,DU
         1 003304   000014 236000 0                  LDQ     XTRARD+1
         1 003305   003307 600000 1                  TZE     s:9663+4
         1 003306   000000 220003                    LDX0    0,DU
         1 003307   000000 470400 xsym               LDP0    S$CU$
         1 003310   000000 636010                    EAQ     0,X0
         1 003311   000001 376100                    ANQ     1,,PR0
         1 003312   003315 600000 1                  TZE     ALTRT

     1071     9664    2        THEN
     1072     9665    2             CALL SC_ICQLST;

   9665  1 003313   000000 713400 xsym               CLIMB   SC_ICQLST
         1 003314   000000 600000 xsid               climb   nvectors=         0

   9663  1 003315                       ALTRT        null
     1073     9666        /*S*  SCREECH_CODE:  KIA-S$ICQLDT
     1074     9667              TYPE:          Screech
     1075     9668              MESSAGE:       FEP input circular queue data inconsistancy
     1076     9669              REMARKS:       When timesharing input data is recieved into the
     1077     9670                             ICQ at interrupt time it is left there to be picked
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:160  
     1078     9671                             up in this code while running on behalf of the user.
     1079     9672                             This screech occurs when the user is unREGed for
     1080     9673                             other than asynchronous (break,etc.) reasons and his
     1081     9674                             data cannot be found.  This suggests that the ICQ
     1082     9675                             has been clobbered in some way or the scheduler is
     1083     9676                             sick.  Experience suggests checking SCHED first.        */
     1084     9677    2   ALTRT: ;
     1085     9678    2        ALTRETURN;

   9678  1 003315   200110 221300                    LDX1  ! VSIN+2,,AUTO
         1 003316   000000 702211                    TSX2  ! 0,X1

KIA_TCTLMAX
 Sect OctLoc
   0     000   000000 000020                                                    ....

(unnamed)
 Sect OctLoc
   0     001   131101 420646                                                    YA..

BYD
 Sect OctLoc
   0     002   131101 420400                                                    YA..

BYDR
 Sect OctLoc
   0     003   131101 420430                                                    YA..

DELRECER
 Sect OctLoc
   0     004   131101 426460                                                    YA..

EOFERR
 Sect OctLoc
   0     005   131101 400060                                                    YA.0

KIA_NODAT
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:161  
 Sect OctLoc
   0     006   131101 421000                                                    YA..

LDSC
 Sect OctLoc
   0     007   131101 400146                                                    YA.f

MTRAPERR
 Sect OctLoc
   0     010   131101 400137                                                    YA._

NOFPRG
 Sect OctLoc
   0     011   131101 420656                                                    YA..

(unnamed)
 Sect OctLoc
   0     012   131101 420636                                                    YA..

XTRARD
 Sect OctLoc
   0     013   131101 400230                                                    YA..

(unnamed)
 Sect OctLoc
   0     014   777777 777776   000200 000000   002000 000000   000000 100000    ..............@.
   0     020   000000 200000   000100 000000   000400 000000   000040 000000    .....@....... ..

(unnamed)
 Sect OctLoc
   2     000   000000 000037   000000 006000   000010 006000   000003 006000    ................
   2     004   000011 006000   000000 000047   000005 006000   000014 400000    .......'........
   2     010   000002 006000   000000 000023   000011 006000   000000 000026    ................
   2     014   000013 006000   000000 000000   000012 006000   000000 006000    ................
   2     020   000004 006000   000000 006000   000000 000042   000022 006000    ..........."....
   2     024   000000 000020   000024 006000   000000 000041   000026 006000    ...........!....
   2     030   000001 400000   000002 400000   000000 000027   000032 006000    ................
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:162  
   2     034   000006 006000                                                    ....
     1086     9679    2   END READS;
     1087     9680
     1088     9681        %EJECT;
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:163  
     1089     9682
     1090     9683    1   END KIA$UCIOND;
     1091     9684
     1092     9685
     1093     9686        %EOD;

PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:164  
--  Include file information  --

   UD_SEV_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   KV_ERRORS_C.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI$MHDR.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$UCIOND.
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:165  

 **** Variables and constants ****

  ****  Section 000 RoData KIA$UCIOND

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/w STRC        r     1 BYD                        3-0-0/w STRC        r     1 BYDR
     4-0-0/w STRC        r     1 DELRECER                   5-0-0/w STRC        r     1 EOFERR
     6-0-0/w STRC        r     1 KIA_NODAT                  0-0-0/w SBIN        r     1 KIA_TCTLMAX
     7-0-0/w STRC        r     1 LDSC                      10-0-0/w STRC        r     1 MTRAPERR
    11-0-0/w STRC        r     1 NOFPRG                    13-0-0/w STRC        r     1 XTRARD

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/w PTR         r     1 @BUF$                     10-0-0/w PTR         r     1 @BUFLEN
     4-0-0/w PTR         r     1 @DVBYTE                    6-0-0/w PTR         r     1 @EVENT
     3-0-0/w PTR         r     1 @FCN                      11-0-0/w PTR         r     1 @NDLDCT
     5-0-0/w PTR         r     1 @VFC                      *0-0-0/w PTR         r     1 BUF$
    *0-0-0/w UBIN        r     1 BUFLEN                   101-0-0/w PTR         r     1 DCB$
    62-0-0/w UBIN        r     1 DCB_FCN_CNT0              *0-0-0/c BIT (9)     r     1 DVBYTE
    74-0-0/b BIT (9)     r     1 DVBYTE1                   75-0-0/w UBIN        r     1 ENTFLG
    *0-0-0/c CHAR        r     1 EOMCHAR                   *0-0-0/w UBIN        r     1 EVENT
    *0-0-0/w UBIN        r     1 FCN                       73-0-0/w UBIN        r     1 FCN1
    64-0-0/w STRC(144)   r     1 FEPIO                     62-0-0/w STRC        r     1 FEPSIZ
    72-0-0/w PTR         r     1 FPT$                      12-0-0/d STRC(1404)  r     1 K$RWPARM
   102-0-0/w PTR         r     1 LDCT$                     76-0-0/w PTR         r     1 MSG$
   100-0-0/w UBIN        r     1 MSGSZ                     *0-0-0/w UBIN        r     1 NDLDCT
    63-0-0/b STRC        r     1 NOWAIT                    *0-0-0/c UBIN(9)     r     1 PCODE
   104-0-0/w UBIN        r     1 PFB                      103-0-0/w UBIN        r     1 PFCN
    70-0-0/w STRC        r     1 PTW(0:1)                 105-0-0/w PTR         r     1 RPTR$
    77-0-0/w BIT         r     1 TDVB                      *0-0-0/c UBIN(9)     r     1 TFCN
    *0-0-0/w BIT         r     1 TYC                       62-0-0/w UBIN        r     1 USRKEYSZ
    *0-0-0/c CHAR        r     1 VFC                      106-0-0/c STRC        r     1 VSIN
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:166  

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$CGCTXT$                  0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$M$UC$                    0-0-0/w PTR         r     1 B$PS1$
     0-0-0/w PTR         r     1 B$ROSEG$                   0-0-0/w PTR         r     1 B$XL_UPPER_UR$
     0-0-0/w PTR         r     1 B$XL_UR$                   0-0-0/w PTR         r     1 KI_FEI$$
     0-0-0/d STRC(1404)  r     1 K_RWPARM_CON               0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/b BIT (72)    r     1 NI_MFGATE                  0-0-0/w PTR         r     1 S$CU$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(3024)  r     1 B$ROSEG
     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/b BIT         r     1 DLTSTR
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/d STRC(216)   r     1 FPT$READ_V
     0-0-0/d STRC(144)   r     1 FPT$WRITE_V                0-0-0/c ACHR        r     1 KEY
     0-0-0/w STRC(144)   r     1 KI$QMHDR                   0-0-0/d STRC(1404)  r     1 KI$RWPARM
     0-0-0/b BIT         r     1 NEWSSN                     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/w UBIN        r     1 STR                        0-0-0/w UBIN        r     1 STRID
     0-0-0/c ACHR        r     1 USRKEY                     0-0-0/c ACHR        r     1 VCHRM
     0-0-0/d STRC(288)   r     1 VLP$WINDOW_V               0-0-0/w STRC(288)   r     1 WINDOW


   Procedure KIA$UCIOND requires 1743 words for executable code.
   Procedure KIA$UCIOND requires 80 words of local(AUTO) storage.
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:167  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:168  
          MINI XREF LISTING

B$CGCTXT$
      7761**DCL      9161>>ASSIGN   9172>>ASSIGN
B$DO.ECCINFO
       760**DCL       761--REDEF
B$JIT.CPFLAGS1
      1238**DCL      9012>>IF       9257>>IF       9274>>IF
B$JIT.CPFLAGS1.SLEAZE
      1243**DCL      1243--REDEF
B$JIT.DCB$
      1310**DCL      8780>>ASSIGN
B$JIT.DCBNO
      1230**DCL      9179>>ASSIGN
B$JIT.ERR
      1149**DCL      8816<<ASSIGN   8832<<ASSIGN   8906<<ASSIGN   8953<<ASSIGN   8993<<ASSIGN   8994>>IF
      9018<<ASSIGN   9027<<ASSIGN   9061<<ASSIGN   9187<<ASSIGN   9347>>IF       9362<<ASSIGN   9385>>IF
      9394<<ASSIGN   9414<<ASSIGN   9612<<ASSIGN
B$JIT.ERR.MID
      1150**DCL      1150--REDEF
B$JIT.INTER
      1406**DCL      9263<<ASSIGN   9263>>ASSIGN
B$JIT.JUNK
      1339**DCL      8833<<ASSIGN   8833>>ASSIGN   9419<<ASSIGN   9419>>ASSIGN
B$JIT.ORIGINATOR_PORT.FROM_CR
      1410**DCL      1410--REDEF    1411--REDEF
B$JIT.TSLINE
      1408**DCL      1409--REDEF
B$JIT$
      7762**DCL      1144--IMP-PTR  8780>>ASSIGN   8816>>ASSIGN   8832>>ASSIGN   8833>>ASSIGN   8833>>ASSIGN
      8906>>ASSIGN   8953>>ASSIGN   8993>>ASSIGN   8994>>IF       9012>>IF       9018>>ASSIGN   9027>>ASSIGN
      9061>>ASSIGN   9179>>ASSIGN   9187>>ASSIGN   9257>>IF       9263>>ASSIGN   9263>>ASSIGN   9274>>IF
      9347>>IF       9362>>ASSIGN   9385>>IF       9394>>ASSIGN   9414>>ASSIGN   9419>>ASSIGN   9419>>ASSIGN
      9612>>ASSIGN
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:169  
B$M$UC$
      7765**DCL      9012>>IF       9257>>IF       9274>>IF       9429>>ASSIGN   9430>>ASSIGN   9462>>ASSIGN
      9504>>ASSIGN   9532>>ASSIGN
B$PS1$
      7763**DCL      8917>>ASSIGN   9070>>ASSIGN   9160<>CALL     9609>>ASSIGN
B$ROSEG.STREAM_VALID
        83**DCL      8998<<ASSIGN   9000<<ASSIGN   9440<<ASSIGN
B$ROSEG$
      7764**DCL      8998>>ASSIGN   9000>>ASSIGN   9440>>ASSIGN
B$U.ASYNCH
       697**DCL      8826>>IF       8944>>IF       9417>>IF       9663>>IF
B$U.CMF
       722**DCL      9240<<ASSIGN   9240>>ASSIGN
B$U.FLG
       626**DCL      8826>>IF       8944>>IF
B$U.MF
       715**DCL      9239<<ASSIGN   9239>>ASSIGN
B$U.MISC
       739**DCL       740--REDEF
B$USER.MISC
       815**DCL       816--REDEF
B$XL_UPPER_UR$
       580**DCL       581--IMP-PTR  8926>>ASSIGN
B$XL_UR$
       576**DCL       577--IMP-PTR  8922>>ASSIGN
BADRBUF IN PROCEDURE READS
      9623**LABEL    9602--CALLALT  9607--CALLALT
BKOUT
      9394**LABEL    9378--GOTO
BRKCK IN PROCEDURE READS
      9653**LABEL    9572--CALLALT  9574--CALLALT  9589--GOTO     9615--CALLALT  9646--CALLALT
BRKOUT
      9362**LABEL    8842--CALLALT  8897--CALLALT  8948--GOTO     8957--GOTO     8969--GOTO     8970--CALLALT
      8987--GOTO     9052--CALLALT  9091--CALLALT  9220--CALLALT  9308--CALLALT  9437--CALLALT  9452--CALLALT
      9467--CALLALT  9511--CALLALT  9536--CALLALT
BRKOUTR
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:170  
      9347**LABEL    9262--CALLALT  9283--CALLALT
BUF$
      6894**DCL        17--PROC     8753>>ASSIGN   8773--ENTRY    8774--IF       8777>>ASSIGN   9289--IF
      9291>>ASSIGN
BUFLEN
      6895**DCL        17--PROC     8752>>ASSIGN   9599<<ASSIGN
BYD
      8281**DCL      8832>>ASSIGN   9394>>ASSIGN
BYDR
      8329**DCL      9362>>ASSIGN
CANCEL_READ
      9081**LABEL    9207--GOTO
CMN
      8788**LABEL    8757--GOTO     9123--GOTO
CSEND
      9308**LABEL    9193--GOTO
DCB$
      7758**DCL      8749<<ASSIGN   8780<<ASSIGN   8781>>IF       8783>>ASSIGN   8785>>ASSIGN   8786>>ASSIGN
      8787>>ASSIGN   8788>>ASSIGN   8860>>IF       8862>>ASSIGN   8882>>ASSIGN   9003>>ASSIGN   9012>>IF
      9036>>IF       9036>>IF       9080>>IF       9081>>IF       9081>>IF       9129>>IF       9129>>IF
      9171>>CALL     9205>>IF       9212>>ASSIGN   9214>>ASSIGN   9215>>IF       9215>>IF       9246>>ASSIGN
      9248>>ASSIGN   9249>>ASSIGN   9257>>IF       9265>>ASSIGN   9266>>ASSIGN   9267>>ASSIGN   9268>>ASSIGN
      9274>>IF       9338>>IF       9340>>ASSIGN   9343>>ASSIGN   9343>>ASSIGN   9598>>ASSIGN
DCB_FCN_CNT0
      6029**DCL      9214<<ASSIGN   9215>>IF       9215>>IF       9229<<ASSIGN   9229>>ASSIGN   9245>>IF
      9247>>IF
DCLSTR
      9458**LABEL    9476--GOTO
DELRECER
      8377**DCL      8881>>ASSIGN
DLTSTR
      7776**DCL      9427>>ASSIGN
DVBYTE
      6883**DCL        17--PROC     6884--REDEF    8761--ENTRY    8773--ENTRY    8854>>ASSIGN   9015<>CALL
      9271<<ASSIGN   9422--ENTRY    9427--ASSIGN   9455--ENTRY    9461--ASSIGN   9471--ENTRY    9479--ENTRY
      9485--IF       9488--IF       9491--IF       9494--IF       9494--IF       9495--ASSIGN   9496--ASSIGN
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:171  
      9497--ASSIGN   9498--ASSIGN   9499--IF       9500--ASSIGN   9514--ENTRY    9517--CALL     9517--CALL
      9521--CALL     9521--CALL     9523--CALL     9523--CALL     9525--CALL     9525--CALL     9529--ASSIGN
DVBYTE1
      6885**DCL      8854<<ASSIGN   8855>>ASSIGN   8883<<ASSIGN   8883>>ASSIGN   8932>>IF       8937>>ASSIGN
      9073>>ASSIGN
ENTFLG
      6897**DCL      8748<<ASSIGN   8779<<ASSIGN   8826>>IF       8905>>IF       8944>>IF       9001>>IF
      9012>>IF       9036>>IF       9060>>IF       9257>>IF       9264>>IF       9274>>IF       9332>>IF
      9424<<ASSIGN   9445<<ASSIGN   9457<<ASSIGN   9473<<ASSIGN   9481<<ASSIGN   9516<<ASSIGN   9577>>IF
      9597>>IF
EOFERR
      8425**DCL      8888>>ASSIGN
EOMCHAR
      6887**DCL      9272<<ASSIGN
EVENT
      6892**DCL        17--PROC     6893--REDEF    8761--ENTRY    8773--ENTRY    9178>>ASSIGN   9341>>IF
      9345<>CALL
F$DCB.ACTPOS
      1543**DCL      1543--REDEF    9268<<ASSIGN
F$DCB.ARS
      1518**DCL      1518--REDEF    9598<<ASSIGN
F$DCB.ATTR
      1536**DCL      1537--REDEF
F$DCB.BORROW
      1551**DCL      1551--REDEF    1551--REDEF    1551--REDEF
F$DCB.CFU$
      1552**DCL      8783>>ASSIGN
F$DCB.DCBNAME.L
      1565**DCL      1565--IMP-SIZ
F$DCB.DVBYTE
      1521**DCL      9265<<ASSIGN
F$DCB.EOMCHAR
      1522**DCL      1522--REDEF    9266<<ASSIGN
F$DCB.FCN.CNT
      1555**DCL      9081>>IF       9214>>ASSIGN
F$DCB.FEPIO
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:172  
      1561**DCL      9248<<ASSIGN
F$DCB.FEPIO.BPP
      1562**DCL      9215>>IF
F$DCB.FEPIO.BUFX
      1562**DCL      9215>>IF
F$DCB.FEPIO2
      1564**DCL      9246<<ASSIGN
F$DCB.FEPIO3
      1564**DCL      9249<<ASSIGN
F$DCB.FEPSIZ
      1560**DCL      9205>>IF       9212<<ASSIGN
F$DCB.FLDID
      1546**DCL      1546--REDEF    9003<<ASSIGN   9267<<ASSIGN
F$DCB.FORM$
      1540**DCL      1540--REDEF
F$DCB.FSECT
      1556**DCL      1556--REDEF
F$DCB.FSN
      1533**DCL      1533--REDEF    1533--REDEF    1534--REDEF
F$DCB.HEADER$
      1539**DCL      1539--REDEF
F$DCB.IASN
      1559**DCL      8781>>IF
F$DCB.IXTNSIZE
      1537**DCL      1537--REDEF
F$DCB.KEYL
      1535**DCL      9494>>IF       9494>>IF       9495<<ASSIGN   9496>>ASSIGN
F$DCB.KEYTYPE
      1542**DCL      8862>>ASSIGN   8882>>ASSIGN   9499>>IF       9500<<ASSIGN
F$DCB.LASTSTA$
      1527**DCL      1527--REDEF
F$DCB.LDCTX
      1540**DCL      8783>>ASSIGN   8785>>ASSIGN   9429>>ASSIGN   9462>>ASSIGN   9504>>ASSIGN   9532>>ASSIGN
F$DCB.LVL
      1552**DCL      1552--REDEF
F$DCB.NAME.C
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:173  
      1527**DCL      1527--REDEF
F$DCB.NOEOF
      1548**DCL      1548--REDEF
F$DCB.NRECS
      1538**DCL      1538--REDEF    9498>>ASSIGN
F$DCB.NRECX
      1557**DCL      1557--REDEF
F$DCB.OHDR
      1549**DCL      1549--REDEF
F$DCB.ORG
      1532**DCL      1532--REDEF    8860>>IF       9036>>IF       9036>>IF       9485>>IF       9488>>IF
      9491>>IF
F$DCB.PRECNO
      1555**DCL      1555--REDEF
F$DCB.RCSZ
      1560**DCL      1560--REDEF
F$DCB.RES
      1528**DCL      1528--REDEF
F$DCB.SETX
      1540**DCL      1540--REDEF
F$DCB.SPARE
      1535**DCL      9497>>ASSIGN
F$DCB.STR
      1556**DCL      8788>>ASSIGN   9430<<ASSIGN
F$DCB.TAB$
      1539**DCL      1540--REDEF
F$DCB.TDA
      1554**DCL      1554--REDEF
F$DCB.TYC
      1518**DCL      9340<<ASSIGN   9343<<ASSIGN   9343>>ASSIGN
F$DCB.UB$
      1556**DCL      8787>>ASSIGN   9171<>CALL
F$DCB.UBYTES
      1556**DCL      8786>>ASSIGN
F$DCB.WAIT
      1550**DCL      9081>>IF       9129>>IF       9338>>IF
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:174  
F$DCB.WSN
      1529**DCL      1529--REDEF
FCN
      6881**DCL        17--PROC     8761--ENTRY    8773--ENTRY    8877>>ASSIGN   9422--ENTRY    9426--ASSIGN
      9443--ENTRY    9447--ASSIGN   9455--ENTRY    9460--ASSIGN   9471--ENTRY    9479--ENTRY    9483--ASSIGN
      9514--ENTRY    9528--ASSIGN   9570>>IF
FCN1
      6882**DCL      8877<<ASSIGN   8878>>DOCASE   8920>>IF       8924>>IF       9012>>IF
FEPIO
      6036**DCL      9246>>ASSIGN   9248>>ASSIGN   9249>>ASSIGN
FEPIO.BPP
      6040**DCL      9173<<ASSIGN   9174<<ASSIGN   9215>>IF
FEPIO.BUFX
      6039**DCL      9172<<ASSIGN   9215>>IF
FEPIO.EVENT
      6037**DCL      9178<<ASSIGN
FEPIO.KEYX
      6038**DCL      9161<<ASSIGN
FEPIO.KPP
      6041**DCL      9162<<ASSIGN   9163<<ASSIGN
FEPSIZ
      6026**DCL      9205>>IF       9212>>ASSIGN
FEPSIZ.BUF
      6027**DCL      9170<<ASSIGN
FMO$GETDOMAIN
      7790**DCL-ENT  9181--CALL
FPT$
      6044**DCL      8750<<ASSIGN   8775<<ASSIGN   8777<<ASSIGN   8858>>IF       8860>>IF       8864>>ASSIGN
      8911>>IF       9032>>IF       9034>>IF       9036>>IF       9045>>ASSIGN   9047>>ASSIGN   9064>>IF
      9064>>IF       9152>>IF       9152>>IF       9605>>IF       9605>>IF
FPT$READ_V
      6011**DCL      9034--IF
FPT$READ_V.DVBYTE.REREAD
      6013**DCL      6014--REDEF
FPT$READ_V.INDX
      6013**DCL      6013--REDEF
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:175  
FPT$READ_V.KEYR
      6011**DCL      9152>>IF       9605>>IF
FPT$READ_V.KEYS
      6011**DCL      9064>>IF
FPT$READ_V.REREADPOS
      6015**DCL      9047>>ASSIGN
FPT$READ_V.SINPUTSIZE
      6015**DCL      9036>>IF       9045>>ASSIGN
FPT$WRITE_V.DVBYTE.VFC
      6020**DCL      6020--REDEF
FPT$WRITE_V.KEYTYPE
      6019**DCL      8860>>IF       8864>>ASSIGN
FSN$CONV_STR
      7792**DCL-ENT  9517--CALL
HFC$LOCK
      3689**DCL-ENT  8811--CALL     8895--CALL     8930--CALL     8962--CALL     8980--CALL     9050--CALL
      9076--CALL     9100--CALL     9200--CALL     9237--CALL     9306--CALL     9432--CALL     9449--CALL
      9464--CALL     9506--CALL     9534--CALL     9568--CALL     9583--CALL     9636--CALL     9650--CALL
HFC$UNLOCK
      3689**DCL-ENT  8822--CALL     8830--CALL     8847--CALL     8899--CALL     9010--CALL     9054--CALL
      9121--CALL     9126--CALL     9242--CALL     9251--CALL     9383--CALL     9538--CALL     9621--CALL
      9658--CALL
HFF$DSIZ
      7801**DCL-ENT  8914--CALL     9031--CALL     9067--CALL     9156--CALL     9608--CALL
HFF$NILERASE
      7802**DCL-ENT  8913--CALL     9066--CALL     9154--CALL
HFF$TRAPALT
      7803**DCL-ENT  9602--CALL     9607--CALL
HFF$WRITE1
      7804**DCL-ENT  9158--CALL     9185--CALL
K$RWPARM
      5472**DCL      8839<<ASSIGN   8842<>CALL     8853<<ASSIGN   8897<>CALL     8941<>CALL     8992<>CALL
      9006<>CALL     9052<>CALL     9088<<ASSIGN   9091<>CALL     9108<<ASSIGN   9118<>CALL     9220<>CALL
      9225<<ASSIGN   9228<>CALL     9291<<ASSIGN   9293<<ASSIGN   9308<>CALL     9425<<ASSIGN   9437<>CALL
      9446<<ASSIGN   9452<>CALL     9458<<ASSIGN   9467<>CALL     9474<<ASSIGN   9482<<ASSIGN   9511<>CALL
      9527<<ASSIGN   9536<>CALL     9572<>CALL     9574<>CALL     9594<>CALL     9615<>CALL     9646<>CALL
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:176  
K$RWPARM.ACTPOS
      5758**DCL      9268>>ASSIGN
K$RWPARM.BLKREC
      5498**DCL      5523--REDEF
K$RWPARM.BLKREC.BLKU#
      5499**DCL      5501--REDEF
K$RWPARM.BLKREC.RECU#
      5511**DCL      5513--REDEF
K$RWPARM.CVTDAT
      5564**DCL      8884<<ASSIGN
K$RWPARM.DVE.DVBYTE
      5530**DCL      8855<<ASSIGN   8937<<ASSIGN   9265>>ASSIGN   9271>>ASSIGN   9300<<ASSIGN
K$RWPARM.DVE.DVBYTE.NODAT
      5543**DCL      8951>>IF
K$RWPARM.DVE.DVBYTE.RRR
      5542**DCL      9297>>IF
K$RWPARM.DVE.DVBYTE.TRANS
      5541**DCL      9257>>IF       9274>>IF
K$RWPARM.DVE.DVBYTE.VFC
      5538**DCL      5539--REDEF
K$RWPARM.DVE.EOMCHAR
      5546**DCL      5550--REDEF    9266>>ASSIGN   9272>>ASSIGN
K$RWPARM.DVE.VFC
      5550**DCL      8856<<ASSIGN   9295<<ASSIGN
K$RWPARM.ERR
      5610**DCL      5615--REDEF    8949>>IF       8967>>IF       9357>>IF       9389>>IF       9660>>IF
K$RWPARM.FC
      5574**DCL      5575--REDEF
K$RWPARM.FLDID
      5756**DCL      5757--REDEF    9003>>ASSIGN   9267>>ASSIGN
K$RWPARM.FPT$
      5637**DCL      5644--REDEF
K$RWPARM.FUNCTION
      5651**DCL      9005<<ASSIGN   9614<<ASSIGN
K$RWPARM.IP$
      5602**DCL      8982<<ASSIGN   8985>>IF       8990>>ASSIGN   8990>>ASSIGN   8991>>ASSIGN   9586<<ASSIGN
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:177  
      9588>>IF       9591>>ASSIGN   9591>>ASSIGN   9592>>ASSIGN
K$RWPARM.KEY$
      5754**DCL      8917<<ASSIGN   9070<<ASSIGN   9605>>IF       9609>>ASSIGN
K$RWPARM.KEYSZ
      5765**DCL      6024--IMP-SIZ  8916<<ASSIGN   9069<<ASSIGN   9496<<ASSIGN   9609>>ASSIGN
K$RWPARM.KEYTYPE
      5763**DCL      5764--REDEF    8862<<ASSIGN   8864<<ASSIGN   8882<<ASSIGN   9159>>ASSIGN
K$RWPARM.LDCT$
      5633**DCL      9004<<ASSIGN   9613<<ASSIGN
K$RWPARM.MARKER
      5523**DCL      8841<<ASSIGN
K$RWPARM.MAXNMBBYT
      5751**DCL      8872<<ASSIGN
K$RWPARM.MAXNMBRCR
      5750**DCL      8874<<ASSIGN   9645<<ASSIGN
K$RWPARM.MAXRCRBYTSIZ
      5752**DCL      8873<<ASSIGN
K$RWPARM.MRKTYP
      5748**DCL      8840<<ASSIGN   8934<<ASSIGN   8974>>IF       9090<<ASSIGN   9299<<ASSIGN   9436<<ASSIGN
      9451<<ASSIGN   9466<<ASSIGN   9510<<ASSIGN   9643<<ASSIGN
K$RWPARM.MSG$
      5473**DCL      5479--REDEF    8892<<ASSIGN   8909<<ASSIGN   9044<<ASSIGN   9057<<ASSIGN   9529<<ASSIGN
      9600>>IF       9603>>ASSIGN
K$RWPARM.MSGID
      5585**DCL      5590--REDEF
K$RWPARM.MSGIDXT
      5598**DCL      5602--REDEF
K$RWPARM.MSGSZ
      5480**DCL      8893<<ASSIGN   8910<<ASSIGN   9045<<ASSIGN   9056<<ASSIGN   9530<<ASSIGN   9595>>IF
      9596>>ASSIGN
K$RWPARM.MSG_ERRCODE
      5733**DCL      8881<<ASSIGN   8888<<ASSIGN   8993>>ASSIGN   9018>>ASSIGN   9109<<ASSIGN   9226<<ASSIGN
      9612>>ASSIGN
K$RWPARM.NRECS
      5764**DCL      9498<<ASSIGN
K$RWPARM.ORG
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:178  
      5734**DCL      5735--REDEF    9487<<ASSIGN   9490<<ASSIGN   9493<<ASSIGN   9503<<ASSIGN   9508>>IF
K$RWPARM.PRMID
      5757**DCL      9043<<ASSIGN   9282<<ASSIGN   9531<<ASSIGN
K$RWPARM.SPARE
      5747**DCL      9497<<ASSIGN
K$RWPARM.STR
      5749**DCL      8857<<ASSIGN   8976>>ASSIGN   9089<<ASSIGN   9180>>ASSIGN   9294<<ASSIGN   9426<<ASSIGN
      9440>>ASSIGN   9460<<ASSIGN   9468<<ASSIGN   9483<<ASSIGN   9528<<ASSIGN
K$RWPARM.STRID
      5735**DCL      9461<<ASSIGN   9468>>ASSIGN
K$RWPARM.THDRSZ
      5678**DCL      5682--REDEF
K$RWPARM.TRANS$
      5697**DCL      8922<<ASSIGN   8926<<ASSIGN   8928<<ASSIGN
K$RWPARM.TYC
      5494**DCL      8867<<ASSIGN   8870<<ASSIGN   9016>>IF       9117<<ASSIGN   9192<<ASSIGN   9227<<ASSIGN
      9277<>CALL     9296<<ASSIGN   9336>>ASSIGN   9340>>ASSIGN   9343>>ASSIGN   9345<>CALL     9359<<ASSIGN
      9391<<ASSIGN   9593<<ASSIGN   9595<<ASSIGN   9595>>ASSIGN   9623>>IF       9625<<ASSIGN   9632<<ASSIGN
K$RWPARM.UHDR$
      5623**DCL      6078--IMP-PTR  6119--IMP-PTR  6164--IMP-PTR  6212--IMP-PTR  6457--IMP-PTR  8990<<ASSIGN
      9591<<ASSIGN
K$RWPARM.UHDRSZ
      5628**DCL      8991<<ASSIGN   9592<<ASSIGN
K$RWPARM.V$
      5753**DCL      9041<<ASSIGN
K$RWPARM.VDOFLGS
      5736**DCL      5747--REDEF
K$RWPARM.VDOFLGS.DLTSTR
      5740**DCL      9427<<ASSIGN   9438>>IF
K$RWPARM.VDOFLGS.INCNMBRCR
      5745**DCL      9208<<ASSIGN
K$RWPARM.VDOFLGS.NEWSSN
      5741**DCL      8996>>IF       9428<<ASSIGN   9434>>IF
K$RWPARM.VDOFLGS.REDSTR
      5742**DCL      9475<<ASSIGN
K$RWPARM.VDOFLGS.SEND
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:179  
      5744**DCL      9303>>ASSIGN
K$RWPARM.VDOFLGS.WAIT
      5743**DCL      9261<<ASSIGN
K$RWPARM.VSZ
      5755**DCL      9042<<ASSIGN
KEY
      6024**DCL      9609>>ASSIGN
KI$QMHDR.FPTSZ
      6258**DCL      6259--REDEF
KI$QMHDR.MSGSZ
      6264**DCL      6265--REDEF
KI$QMHDR.OFFSET
      6252**DCL      8990>>ASSIGN   9591>>ASSIGN
KI$QMHDR.SIZE
      6253**DCL      8991>>ASSIGN   9592>>ASSIGN
KI$QMHDR.UID
      6254**DCL      6255--REDEF
KI$RWPARM
      6583**DCL      9291>>ASSIGN
KI$RWPARM.BLKREC
      6609**DCL      6634--REDEF
KI$RWPARM.BLKREC.BLKU#
      6610**DCL      6612--REDEF
KI$RWPARM.BLKREC.RECU#
      6622**DCL      6624--REDEF
KI$RWPARM.DVE.DVBYTE.VFC
      6649**DCL      6650--REDEF
KI$RWPARM.DVE.EOMCHAR
      6657**DCL      6661--REDEF
KI$RWPARM.ERR
      6721**DCL      6726--REDEF
KI$RWPARM.FC
      6685**DCL      6686--REDEF
KI$RWPARM.FLDID
      6867**DCL      6868--REDEF
KI$RWPARM.FPT$
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:180  
      6748**DCL      6755--REDEF
KI$RWPARM.KEYTYPE
      6874**DCL      6875--REDEF
KI$RWPARM.MSG$
      6584**DCL      6590--REDEF
KI$RWPARM.MSGID
      6696**DCL      6701--REDEF
KI$RWPARM.MSGIDXT
      6709**DCL      6713--REDEF
KI$RWPARM.ORG
      6845**DCL      6846--REDEF
KI$RWPARM.THDRSZ
      6789**DCL      6793--REDEF
KI$RWPARM.VDOFLGS
      6847**DCL      6858--REDEF
KIA$9TO8
      7794**DCL-ENT  9521--CALL     9523--CALL     9525--CALL
KIA$COMP
      7791**DCL-ENT  9118--CALL     9228--CALL
KIA$FCNOU
      7795**DCL-ENT  8842--CALL     8897--CALL     9052--CALL     9091--CALL     9220--CALL     9308--CALL
      9437--CALL     9452--CALL     9467--CALL     9511--CALL     9536--CALL     9572--CALL     9574--CALL
      9646--CALL
KIA$MSG
      7797**DCL-ENT  8992--CALL     9594--CALL
KIA$OQFL
      7796**DCL-ENT  8970--CALL
KIA$WRITE_USER
      7798**DCL-ENT  8941--CALL
KIA_NODAT
      8473**DCL      8953>>ASSIGN   9385>>IF
KIA_TCTLMAX
      7766**DCL      9297>>IF
KIQ$MAPFEP
      7793**DCL-ENT  8989--CALL     9590--CALL
KIS$SEND
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:181  
      7799**DCL-ENT  9006--CALL     9615--CALL
KI_FEI$$
       594**DCL       595--IMP-PTR
K_RWPARM_CON
      5108**DCL      8839>>ASSIGN   8853>>ASSIGN   9088>>ASSIGN   9108>>ASSIGN   9225>>ASSIGN   9293>>ASSIGN
      9425>>ASSIGN   9446>>ASSIGN   9458>>ASSIGN   9474>>ASSIGN   9482>>ASSIGN   9527>>ASSIGN
K_RWPARM_CON.BLKREC
      5134**DCL      5159--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      5135**DCL      5137--REDEF
K_RWPARM_CON.BLKREC.RECU#
      5147**DCL      5149--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      5174**DCL      5175--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      5182**DCL      5186--REDEF
K_RWPARM_CON.ERR
      5246**DCL      5251--REDEF
K_RWPARM_CON.FC
      5210**DCL      5211--REDEF
K_RWPARM_CON.FLDID
      5392**DCL      5393--REDEF
K_RWPARM_CON.FPT$
      5273**DCL      5280--REDEF
K_RWPARM_CON.KEYTYPE
      5399**DCL      5400--REDEF
K_RWPARM_CON.MSG$
      5109**DCL      5115--REDEF
K_RWPARM_CON.MSGID
      5221**DCL      5226--REDEF
K_RWPARM_CON.MSGIDXT
      5234**DCL      5238--REDEF
K_RWPARM_CON.ORG
      5370**DCL      5371--REDEF
K_RWPARM_CON.THDRSZ
      5314**DCL      5318--REDEF
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:182  
K_RWPARM_CON.VDOFLGS
      5372**DCL      5383--REDEF
LDCT$
      7759**DCL      8751<<ASSIGN   8755>>IF       8783<<ASSIGN   8785<<ASSIGN   8793>>IF       8811>>CALL
      8813>>IF       8822>>CALL     8830>>CALL     8837>>IF       8841>>ASSIGN   8842>>CALL     8843>>ASSIGN
      8847>>CALL     8895>>CALL     8897>>CALL     8899>>CALL     8905>>IF       8906>>ASSIGN   8930>>CALL
      8941>>CALL     8944>>IF       8960<>CALL     8962>>CALL     8970>>CALL     8978<>CALL     8980>>CALL
      8982>>ASSIGN   8984>>ASSIGN   8989>>CALL     9004>>ASSIGN   9010>>CALL     9025>>IF       9050>>CALL
      9052>>CALL     9054>>CALL     9060>>IF       9076>>CALL     9089>>ASSIGN   9091>>CALL     9097>>ASSIGN
      9098<>CALL     9100>>CALL     9106>>DOWHILE  9118>>CALL     9121>>CALL     9126>>CALL     9200>>CALL
      9202>>IF       9205>>IF       9211>>ASSIGN   9220>>CALL     9228>>CALL     9231>>ASSIGN   9251>>CALL
      9297>>IF       9303>>ASSIGN   9306>>CALL     9308>>CALL     9309>>ASSIGN   9309>>ASSIGN   9383>>CALL
      9411>>IF       9411>>IF       9414>>ASSIGN   9415>>ASSIGN   9429<<ASSIGN   9432>>CALL     9437>>CALL
      9447<<ASSIGN   9449>>CALL     9452>>CALL     9462<<ASSIGN   9464>>CALL     9467>>CALL     9504<<ASSIGN
      9506>>CALL     9511>>CALL     9532<<ASSIGN   9534>>CALL     9536>>CALL     9538>>CALL     9568>>CALL
      9572>>CALL     9574>>CALL     9579<>CALL     9581<>CALL     9583>>CALL     9586>>ASSIGN   9587>>ASSIGN
      9590>>CALL     9613>>ASSIGN   9616>>IF       9618<>CALL     9621>>CALL     9636>>CALL     9638>>IF
      9640>>IF       9644>>ASSIGN   9646>>CALL     9648<>CALL     9650>>CALL     9653>>IF       9658>>CALL
LDSC
      8521**DCL      8816>>ASSIGN   9027>>ASSIGN
MMS$SETUP_BUF
      7805**DCL-ENT  9160--CALL     9171--CALL
MSG$
      6900**DCL      8753<<ASSIGN   8787<<ASSIGN   8892>>ASSIGN   8909>>ASSIGN   9044>>ASSIGN   9564>>IF
      9603>>ASSIGN
MSGSZ
      6902**DCL      6903--REDEF    7773--IMP-SIZ  8752<<ASSIGN   8786<<ASSIGN   8865>>IF       8869<<ASSIGN
      8872>>ASSIGN   8873>>ASSIGN   8893>>ASSIGN   8910>>ASSIGN   9045>>ASSIGN   9170>>ASSIGN   9171<>CALL
      9564>>IF       9595>>IF       9596<<ASSIGN   9598>>ASSIGN   9599>>ASSIGN   9603>>ASSIGN   9603>>ASSIGN
MTRAP
      9187**LABEL    9158--CALLALT
MTRAPERR
      8569**DCL      9187>>ASSIGN
N$DCT$$
       465**DCL       465--IMP-PTR  8783>>ASSIGN   8785>>ASSIGN   9429>>ASSIGN   9462>>ASSIGN   9504>>ASSIGN
      9532>>ASSIGN
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:183  
NDLDCT
      6896**DCL        17--PROC     8751--ASSIGN
NEWSSN
      7777**DCL      9428>>ASSIGN
NI_MFGATE
      7767**DCL      9237<>CALL     9242<>CALL
NK$LDCT
      5418**DCL      8842<>CALL     8897<>CALL     8941<>CALL     8970<>CALL     9052<>CALL     9091<>CALL
      9118<>CALL     9220<>CALL     9228<>CALL     9308<>CALL     9437<>CALL     9452<>CALL     9467<>CALL
      9511<>CALL     9536<>CALL     9572<>CALL     9574<>CALL     9646<>CALL
NK$LDCT.DDT$
      5420**DCL      5420--REDEF
NK$LDCT.DFLG.FEDN
      5426**DCL      8813>>IF       8944>>IF
NK$LDCT.DFLG.NOSND
      5424**DCL      9303<<ASSIGN
NK$LDCT.DFLG.OLDSC
      5423**DCL      9025>>IF       9411>>IF
NK$LDCT.ERR
      5419**DCL      8906>>ASSIGN   9411>>IF       9414>>ASSIGN   9415<<ASSIGN
NK$LDCT.IOQ$
      5419**DCL      5420--REDEF
NK$LDCT.IP$
      5440**DCL      8982>>ASSIGN   8984<<ASSIGN   9586>>ASSIGN   9587<<ASSIGN   9640>>IF       9653>>IF
NK$LDCT.IPFEI#
      5441**DCL      8989<>CALL     9590<>CALL
NK$LDCT.LDCTX
      5421**DCL      5421--REDEF
NK$LDCT.LKFLG.ABORTED
      5433**DCL      5434--REDEF
NK$LDCT.LKFLG.FPSTEP
      5438**DCL      8905>>IF       9060>>IF
NK$LDCT.LKFLG.MRKPND
      5433**DCL      8837>>IF       8843<<ASSIGN   9638>>IF
NK$LDCT.LKFLG.NOWAIT
      5439**DCL      9106>>DOWHILE  9202>>IF       9231<<ASSIGN
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:184  
NK$LDCT.LKFLG.WTMRK
      5434**DCL      9097<<ASSIGN   9616>>IF       9644<<ASSIGN
NK$LDCT.LOCK
      5446**DCL      8811<>CALL     8822<>CALL     8830<>CALL     8847<>CALL     8895<>CALL     8899<>CALL
      8930<>CALL     8962<>CALL     8980<>CALL     9010<>CALL     9050<>CALL     9054<>CALL     9076<>CALL
      9100<>CALL     9121<>CALL     9126<>CALL     9200<>CALL     9251<>CALL     9306<>CALL     9383<>CALL
      9432<>CALL     9449<>CALL     9464<>CALL     9506<>CALL     9534<>CALL     9538<>CALL     9568<>CALL
      9583<>CALL     9621<>CALL     9636<>CALL     9650<>CALL     9658<>CALL
NK$LDCT.MARKER
      5420**DCL      8841>>ASSIGN
NK$LDCT.NOWAIT
      5429**DCL      9205>>IF       9211<<ASSIGN
NK$LDCT.NOWAIT.STREAM
      5429**DCL      9089>>ASSIGN
NK$LDCT.RESCOD
      5426**DCL      8755>>IF
NK$LDCT.RLCID.LDCTX
      5443**DCL      5443--REDEF
NK$LDCT.STA$
      5439**DCL      5440--REDEF
NK$LDCT.SYMB$
      5418**DCL      5418--REDEF    5418--REDEF    5419--REDEF
NK$LDCT.TCTLCNT
      5448**DCL      9297>>IF       9309<<ASSIGN   9309>>ASSIGN
NK$LDCT$
       465**DCL      8783>>ASSIGN   8785>>ASSIGN   9429>>ASSIGN   9462>>ASSIGN   9504>>ASSIGN   9532>>ASSIGN
NKA$EVENT
      7806**DCL-ENT  9345--CALL
NOFPRG
      8617**DCL      9061>>ASSIGN
NORDKEY
      9070**LABEL    9066--CALLALT
NOWAIT
      6030**DCL      9150<<ASSIGN   9205>>IF       9211>>ASSIGN
NOWAIT.DCB#
      6034**DCL      9179<<ASSIGN
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:185  
NOWAIT.DMN
      6032**DCL      9182<<ASSIGN
NOWAIT.KEYTYP
      6031**DCL      9159<<ASSIGN
NOWAIT.STREAM
      6033**DCL      9180<<ASSIGN
NOWRTKEY
      8919**LABEL    8913--CALLALT
PCODE
      6888**DCL      9282>>ASSIGN
PFB
      7768**DCL      7769--REDEF    7770--REDEF    8754<<ASSIGN   8756<<ASSIGN   8788<<ASSIGN   8857>>ASSIGN
      8976<<ASSIGN   8998>>ASSIGN   9000>>ASSIGN   9046>>ASSIGN   9181<>CALL     9182>>ASSIGN   9294>>ASSIGN
PFCN
      7760**DCL      9288<<ASSIGN   9301>>IF       9308<>CALL
PTW
      6042**DCL      9160<>CALL     9171<>CALL
PTW.PP
      6043**DCL      9162>>ASSIGN   9163>>ASSIGN   9173>>ASSIGN   9174>>ASSIGN
READS
      9543**PROC     9262--CALL     9283--CALL
READ_IT IN PROCEDURE READS
      9577**LABEL    9642--GOTO     9655--GOTO
REGALT IN PROCEDURE READS
      9632**LABEL    9579--CALLALT  9581--CALLALT
RPTR$
      7778**DCL      9160<>CALL     9161>>ASSIGN   9171<>CALL     9172>>ASSIGN
S$CU$
       826**DCL      8826>>IF       8826>>IF       8944>>IF       8944>>IF       9239>>ASSIGN   9239>>ASSIGN
      9240>>ASSIGN   9240>>ASSIGN   9417>>IF       9663>>IF
SC_BTSFCN
      7813**DCL-ENT  9316--CALL
SC_ICQLST
      7814**DCL-ENT  9665--CALL
SC_NTSDCTI
      7811**DCL-ENT  8795--CALL
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:186  
SSR$REG
      7800**DCL-ENT  8960--CALL     8978--CALL     9098--CALL     9579--CALL     9581--CALL     9618--CALL
      9648--CALL
STR
      7774**DCL      9426>>ASSIGN   9460>>ASSIGN   9483>>ASSIGN   9528>>ASSIGN
STRID
      7775**DCL      9461>>ASSIGN
TDVB
      6901**DCL      9073<<ASSIGN
TFCN
      6884**DCL      9288>>ASSIGN
TRTNR IN PROCEDURE READS
      9611**LABEL    9633--GOTO
TRY_WRT_AGAIN
      8937**LABEL    8964--GOTO     8971--GOTO
TYC
      6893**DCL      9334--IF       9336<<ASSIGN
UMD$DIN
      7807**DCL-ENT  9277--CALL
UMD$DOU
      7809**DCL-ENT  9015--CALL
UMD$DPMT
      7808**DCL-ENT  9260--CALL
USRKEY
      6023**DCL      9609<<ASSIGN
USRKEYSZ
      6025**DCL      6023--IMP-SIZ  6026--REDEF    6029--REDEF    8914<>CALL     8915<<ASSIGN   8915>>ASSIGN
      8916>>ASSIGN   9031<>CALL     9034>>IF       9067<>CALL     9068<<ASSIGN   9068>>ASSIGN   9069>>ASSIGN
      9151<<ASSIGN   9156<>CALL     9157>>IF       9157<<ASSIGN   9160<>CALL     9608<>CALL     9609>>ASSIGN
VCHRM
      7773**DCL      9603<<ASSIGN   9603>>ASSIGN
VFC
      6886**DCL        17--PROC     6887--REDEF    6888--REDEF    8761--ENTRY    8773--ENTRY    8856>>ASSIGN
      9015<>CALL     9295>>ASSIGN   9422--ENTRY    9428--ASSIGN
VLP$WINDOW_V
      6531**DCL      9530--ASSIGN
PL6.E3A0      #001=KIA$UCIOND File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:30 Page:187  
VLP$WINDOW_V.FSTR.ID
      6531**DCL      9517<>CALL
VLP$WINDOW_V.FWINDOW
      6531**DCL      6531--REDEF    6531--REDEF    9517<>CALL
VSIN
      7780**DCL      9041--ASSIGN   9042--ASSIGN
VSIN.PFB
      7781**DCL      9046<<ASSIGN
VSIN.POS
      7783**DCL      7784--REDEF    7786--REDEF    9047<<ASSIGN
VSIN.POSL6.T
      7785**DCL      9048<<ASSIGN
VSIN.POSL66.T
      7787**DCL      9048>>ASSIGN
WAIT_RRR_RESP
      8964**LABEL    9310--GOTO     9441--GOTO     9453--GOTO     9469--GOTO     9512--GOTO
WINDOW.FWINDOW
      6553**DCL      6553--REDEF    6553--REDEF
WINDOW.LENGTH
      6554**DCL      9521<>CALL     9521<>CALL
WINDOW.ORG_PST.COLUMN
      6554**DCL      9525<>CALL     9525<>CALL
WINDOW.WIDTH
      6554**DCL      9523<>CALL     9523<>CALL
WRT1
      8904**LABEL    8885--GOTO     8889--GOTO
XTRARD
      8713**DCL      9109>>ASSIGN   9226>>ASSIGN

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:188  
     1094        1        /*T***********************************************************/
     1095        2        /*T*                                                         */
     1096        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1097        4        /*T*                                                         */
     1098        5        /*T***********************************************************/
     1099        6
     1100        7
     1101        8        KIA$UCIN: PROC (NK$LDCT,K$RWPARM) ALTRET;
     1102        9
     1103       10        /*F*
     1104       11             NAME: KIA$UCIN
     1105       12             PURPOSE:
     1106       13                  This routine is the receiver for all messages destined for
     1107       14                  a time sharing terminal.
     1108       15             DESCRIPTION:
     1109       16                  When ever a message comes in to the host for a time sharing
     1110       17                  terminal KIA$UCIN is called from KIA$ISCAN to determine what
     1111       18                  functions needs to be performed. KIA$UCIN will return normally
     1112       19                  if it processed the message, altreturn with the error K$WAIT_READ
     1113       20                  to specify leave the message in the queue and a read will be
     1114       21                  done for it later, or altreturn with K$DEFER_IO which says
     1115       22                  it can not process the message right now, but call back later.
     1116       23        */
     1117       24
     1118       25        %INCLUDE B_STRINGS_C;
     1119      154        %INCLUDE CP_6;
     1120     5713        %INCLUDE KI$MHDR;
     1121     5854        %INCLUDE KV$VDO;
     1122     6869        %INCLUDE KI_DATA_R;
     1123     6895        %INCLUDE HF_LOCK_C;
     1124     6909        %INCLUDE NK$LDCT;
     1125     7011        %INCLUDE NK_SUBS;
     1126     7036        %INCLUDE KI_SUBS_C;
     1127     7172        %INCLUDE K_SUBS_C;
     1128     7205        %INCLUDE SS_SCHED_C;
     1129     7438        %INCLUDE K_DATA_R;
     1130     8149        %INCLUDE B$USER;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:189  
     1131     8365        %INCLUDE KL_MACRO_C;
     1132    11717        %INCLUDE KL_AFCN_C;
     1133    11818
     1134    11819        %NK$LDCT (STCLASS="");
     1135    11865        %K$RWPARM (NAME=K$RWPARM);
     1136    12181        %KI$QMHDR;
     1137    12230        %KL_FEPST(STCLASS="");
     1138    12265        %KV_VDO_ALL_E;
     1139    12344        %KV$VDO (STCLASS="BASED(K$RWPARM.UHDR$)");
     1140    12371        %KV$VDO_PRM;
     1141    12412        %KV$VDO_EVT (STCLASS="BASED(K$RWPARM.UHDR$)");
     1142    12454        %KV$VDO_DLT (STCLASS="BASED(K$RWPARM.UHDR$)");
     1143    12499        %KV$VDO_BLKDAT (STCLASS="BASED(K$RWPARM.UHDR$)");
     1144    12542        %KV$VDO_RQSDAT (STCLASS="BASED(K$RWPARM.UHDR$)");
     1145    12590
     1146    12591        %B$COMIO (NAME=COMIOEV,STCLASS=AUTO,PARONLY=1);
     1147    12600        %K$RWPARM (NAME=OPARM,STCLASS=AUTO);
     1148    12916        %KV$VDO_EVT (STCLASS=AUTO,NAME=VDO);
     1149    12958    1   DCL 1 VDO1 REDEF VDO,
     1150    12959    1            2 * BIT(18) UNAL ,
     1151    12960    1            2 RCRBYTSIZ UBIN(18) UNAL ;
     1152    12961    1   DCL UBNBSD UBIN WORD ALIGNED BASED;
     1153    12962    1   DCL OCQ$ PTR;
     1154    12963    1   DCL P$ PTR;
     1155    12964    1   DCL BCNT UBIN WORD;
     1156    12965    1   DCL DOMN REDEF BCNT UBIN WORD;
     1157    12966    1   DCL EVNT UBIN WORD;
     1158    12967    1   DCL TSTATE REDEF EVNT CHAR(4);
     1159    12968    1   DCL FEI UBIN WORD;
     1160    12969    1   DCL USER UBIN BYTE UNAL;
     1161    12970    1   DCL MARKER BIT(36);
     1162    12971    1   DCL SSC$TSTATE ENTRY(2);
     1163    12972    1   DCL SSV$EVENT ENTRY(7);
     1164    12973    1   DCL KIA$FCNO ENTRY (3) ALTRET;
     1165    12974    1   DCL SSR$RUE ENTRY(4);
     1166    12975    1   DCL KIA$COMP ENTRY(2);
     1167    12976    1   DCL KIQ$FEABT ENTRY(2);
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:190  
     1168    12977    1   DCL KIA$DSCTS ENTRY(2) ALTRET;
     1169    12978    1   DCL KIA$GETEVNT ENTRY(3);
     1170    12979    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1171    12980
     1172    12981        %SUB_EXC;
     1173    13028    1   DCL KIA$MSG ENTRY(1) ALTRET;
     1174    13029
     1175    13030    1   DCL B$USRT$ PTR SYMREF;
     1176    13031
     1177    13032
     1178    13033    1        FEI=LDCT.IPFEI#;
     1179    13034    1        VDO = KV$VDO_EVT ;
     1180    13035
     1181    13036    2        DO CASE (VDO.FNC);
     1182    13037        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:191  
     1183    13038    2        CASE(%KV_VDO_FNC_EVT);
     1184    13039    2           IF VDO.TYP = %KV_EVTTYP_MNTATN THEN
     1185    13040    2                GOTO L1 ;
     1186    13041    3           ELSE DO;
     1187    13042    3                BCNT = VDO.BRKCNT;
     1188    13043    3                IF BCNT > 3
     1189    13044    3                THEN
     1190    13045    3   L1:
     1191    13046    3                     EVNT=%SS_CEC;
     1192    13047    3                ELSE
     1193    13048    3                     EVNT = %SS_CBK;
     1194    13049    3              END;
     1195    13050
     1196    13051        /* Reset both RDPND and RRRPND */
     1197    13052                %LOCK (G=NK$LDCT.LOCK);
     1198    13055
     1199    13056    2           IF K$RWPARM.MRKTYP ~= 0
     1200    13057    3           THEN DO;
     1201    13058        /* If there is already a marker pending send a mark response */
     1202    13059    3                IF LDCT.LKFLG.MRKPND
     1203    13060    4                THEN DO;
     1204    13061    4                     MARKER = LDCT.MARKER;
     1205    13062    4                     LDCT.LKFLG.MRKPND = '0'B;
     1206    13063    4                     CALL SEND_MARKER ALTRET (GETOUT);
     1207    13064    4                   END;
     1208    13065
     1209    13066    3                MARKER = K$RWPARM.MARKER;
     1210    13067    3                LDCT.MARKER = MARKER;
     1211    13068    3                IF B$USRT$->B$USER.FLG(LDCT.USER)&%U_SCIO
     1212    13069    3                     AND B$USRT$->B$USER.MISC$(LDCT.USER) = ADDR(LDCT)
     1213    13070    3                THEN LDCT.LKFLG.MRKPND = '1'B;
     1214    13071    3                ELSE CALL SEND_MARKER ALTRET(GETOUT);
     1215    13072    3              END;
     1216    13073    2           CALL SSR$RUE (EVNT,LDCT.USER,BCNT);
     1217    13074                %UNLOCK (G=NK$LDCT.LOCK);
     1218    13077
     1219    13078        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:192  
     1220    13079    2        CASE (%KV_VDO_FNC_DAT,%KV_VDO_FNC_PRM_RSP);
     1221    13080                %LOCK (G=NK$LDCT.LOCK);
     1222    13083    2           IF K$RWPARM.MRKTYP ~= 0
     1223    13084    3           THEN DO;
     1224    13085    3                MARKER = K$RWPARM.MARKER;
     1225    13086    3                CALL SEND_MARKER ALTRET(GETOUT);
     1226    13087    3              END;
     1227    13088
     1228    13089    2           IF VDO.FNC = %KV_VDO_FNC_DAT AND NK$LDCT.LKFLG.NOWAIT
     1229    13090    3           THEN DO;
     1230    13091    3                CALL KIA$COMP(NK$LDCT,K$RWPARM);
     1231    13092                     %UNLOCK (G=NK$LDCT.LOCK);
     1232    13095    3                RETURN;
     1233    13096    3              END;
     1234    13097    2           P$ = ADDR(B$USRT$->B$USER(LDCT.USER));
     1235    13098    2           IF P$->B$U.FLG & %U_SCIO AND
     1236    13099    2                P$->B$U.MISC$ = ADDR(NK$LDCT) AND
     1237    13100    2                (P$->B$U.US = %SS_STI OR
     1238    13101    2                P$->B$U.US = %SS_SCW)
     1239    13102    2           THEN
     1240    13103    2                CALL SSR$RUE (%SS_CIC,LDCT.USER);
     1241    13104    2           GOTO L4 ;
     1242    13105
     1243    13106        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:193  
     1244    13107    2        CASE(%KV_VDO_FNC_DSC_RQS);
     1245    13108    2           CALL KIA$DSCTS (LDCT,K$RWPARM) ALTRET(GETOUT);
     1246    13109
     1247    13110
     1248    13111    2        CASE(%KV_VDO_FNC_OPNSSN_RQS);
     1249    13112
     1250    13113
     1251    13114
     1252    13115    2        CASE(%KV_VDO_FNC_RQSSTT);
     1253    13116    2           CALL SSC$TSTATE (LDCT.USER,TSTATE);
     1254    13117    2           OPARM = K_RWPARM_CON;
     1255    13118    2           OPARM.MSG$ = ADDR(TSTATE);
     1256    13119    2           OPARM.MSGSZ = LENGTHC(TSTATE);
     1257    13120    2           CALL KIA$FCNO(LDCT,%KV_VDO_FNC_STT,OPARM) ALTRET(GETOUT);
     1258    13121
     1259    13122        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:194  
     1260    13123    2        CASE(%KV_VDO_FNC_RQSDAT);
     1261    13124                %LOCK (G=NK$LDCT.LOCK);
     1262    13127    2           IF NK$LDCT.TH.MAXNMBRCR = 0 OR NK$LDCT.TH.MAXNMBBYT = 0
     1263    13128    3           THEN DO;
     1264    13129    3                OPARM = K_RWPARM_CON;
     1265    13130    3                CALL KIA$FCNO(NK$LDCT,%KV_VDO_FNC_BLKDAT,OPARM)
     1266    13131    4                WHENALTRETURN DO;
     1267    13132                          %UNLOCK (G=NK$LDCT.LOCK);
     1268    13135    4                     GOTO GETOUT;
     1269    13136    4                   END;
     1270    13137    3                IF K$RWPARM.MRKTYP ~= 0
     1271    13138    4                THEN DO;
     1272    13139    4                     MARKER = K$RWPARM.MARKER;
     1273    13140    4                     CALL SEND_MARKER ALTRET(GETOUT);
     1274    13141    4                   END;
     1275    13142                     %UNLOCK (G=NK$LDCT.LOCK);
     1276    13145    3                RETURN;
     1277    13146    3              END;
     1278    13147                %UNLOCK (G=NK$LDCT.LOCK);
     1279    13150                       /* Report COMIO event to user if an event is specified     */
     1280    13151                       /* in the DCB.                                             */
     1281    13152    2           IF VDO.STR~=KIDM_MON AND VDO.STR~=KIDM_DB
     1282    13153    3           THEN DO;
     1283    13154    3                CALL KIA$GETEVNT(LDCT,EVNT,DOMN);
     1284    13155    4                IF EVNT~=0 THEN DO;
     1285    13156    4                     CALL SSR$RUE (%SS_FPEVNT,LDCT.USER);
     1286    13157    4                     COMIOEV='0'B;
     1287    13158    4                     IF DOMN=%DBWSR THEN COMIOEV.FLAGS.DELTA='1'B; /* DELTA only  */
     1288    13159    4                     COMIOEV.P#=SIZEW(COMIOEV)-SIZEW(COMIOEV.P#);
     1289    13160    4                     COMIOEV.SUBC2=%SUBC2_DATA_RQS#;
     1290    13161    4                     COMIOEV.ARS=256*VDO1.RCRBYTSIZ/512+MOD(VDO1.RCRBYTSIZ,512);
     1291    13162    4                     CALL SSV$EVENT(LDCT.USER,DOMN,%SUBC_COMIO#,EVNT,0,ADDR(COMIOEV));
     1292    13163    4                   END;
     1293    13164    3              END;                         /* CASE */
     1294    13165    2           IF NK$LDCT.TH.MAXNMBRCR > 0 OR NK$LDCT.TH.MAXNMBBYT > 0
     1295    13166    2           THEN
     1296    13167    2                CALL SSR$RUE (%SS_CUB,LDCT.USER);
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:195  
     1297    13168
     1298    13169        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:196  
     1299    13170    2        CASE(%KV_VDO_FNC_MRK);
     1300    13171                %LOCK (G=NK$LDCT.LOCK);
     1301    13174    2           IF (B$USRT$->B$USER.FLG(LDCT.USER)&%U_SCIO)
     1302    13175    2                AND B$USRT$->B$USER.MISC$(LDCT.USER) = ADDR(LDCT)
     1303    13176    2           THEN
     1304    13177    2                CALL SSR$RUE (%SS_CIC,LDCT.USER);
     1305    13178    2           IF LDCT.LKFLG.WTMRK             /* Waiting marker */
     1306    13179    3           THEN DO;
     1307    13180    3                LDCT.LKFLG.WTMRK = '0'B;
     1308    13181                     %UNLOCK (G=NK$LDCT.LOCK);
     1309    13184    3                RETURN;
     1310    13185    3              END;
     1311    13186    2   L4:     ;
     1312    13187    2           IF LDCT.IP$ ~= ADDR(NIL)
     1313    13188    3           THEN DO;
     1314    13189                     %UNLOCK (G=NK$LDCT.LOCK);
     1315    13192    3                GOTO CRASH_IT;
     1316    13193    3              END;
     1317    13194    2           LDCT.IP$ = K$RWPARM.IP$;
     1318    13195    2           LDCT.IPFEI# = K$RWPARM.IP$->KI$QMHDR.FEI#;
     1319    13196                %UNLOCK (G=NK$LDCT.LOCK);
     1320    13199    2           ADDR(K$RWPARM.IP$->KI$QMHDR.OFFSET)->UBNBSD = POFFC(K$RWPARM.UHDR$,K$RWPARM.
             13199                    IP$)
     1321    13200    2                * 262144 + K$RWPARM.UHDRSZ;
     1322    13201    2           K$RWPARM.ERR = %K$WAIT_READ;
     1323    13202    2           ALTRETURN;
     1324    13203
     1325    13204
     1326    13205        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:197  
     1327    13206    2        CASE(%KV_VDO_FNC_BLKDAT);
     1328    13207                       /* Report COMIO event to user if an event is specified     */
     1329    13208                       /* in the DCB                                              */
     1330    13209    2           IF VDO.STR=KIDM_MON THEN RETURN;
     1331    13210    2           CALL KIA$GETEVNT(LDCT,EVNT,DOMN);
     1332    13211        /*
     1333    13212             if sched for i/o but remote write was issued before rqsdat,
     1334    13213             just return and wait for data.
     1335    13214        */
     1336    13215    2           P$ = ADDR(B$USRT$->B$USER(LDCT.USER));
     1337    13216    2           IF P$->B$U.FLG & %U_SCIO AND
     1338    13217    2                P$->B$U.MISC$ = ADDR(NK$LDCT) AND
     1339    13218    2                KV$VDO_BLKDAT.RSN = %KV_BLKRSN_MAXNMBRCR AND
     1340    13219    2                (P$->B$U.US = %SS_STI OR
     1341    13220    2                P$->B$U.US = %SS_SCW)
     1342    13221    2           THEN
     1343    13222    2                RETURN;
     1344    13223    3           IF EVNT~=0 THEN DO;
     1345    13224    3                CALL SSR$RUE (%SS_FPEVNT,LDCT.USER);
     1346    13225    3                COMIOEV='0'B;
     1347    13226    3                IF DOMN=%DBWSR THEN COMIOEV.FLAGS.DELTA='1'B; /* DELTA only */
     1348    13227    3                COMIOEV.P#=SIZEW(COMIOEV)-SIZEW(COMIOEV.P#);
     1349    13228    3                COMIOEV.SUBC2=%SUBC2_DATA_AVL#;
     1350    13229    3                COMIOEV.ARS=256*VDO1.RCRBYTSIZ/512+MOD(VDO1.RCRBYTSIZ,512);
     1351    13230    3                CALL SSV$EVENT(LDCT.USER,DOMN,%SUBC_COMIO#,EVNT,0,ADDR(COMIOEV));
     1352    13231    3              END;
     1353    13232
     1354    13233        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:198  
     1355    13234    2        CASE(ELSE);
     1356    13235    2   CRASH_IT: ;                   /* Lop off this diseased branch of the network */
     1357    13236    2           KL_FEPST.FEP = K$RWPARM.FEX;
     1358    13237    2           KL_FEPST.FCN = IGA_CRASHFEP_BF;
     1359    13238    2           CALL KUB$WRITE(KL_FEPST, LENGTHC(KL_FEPST), 'HLPADMIN');
     1360    13239    2           K$RWPARM.ERR = %K$WAIT_READ;
     1361    13240    2           ALTRETURN;       /* Freeze the Q so that there's something to see */
     1362    13241    2        END;
     1363    13242    1   OUT: ;
     1364    13243    1        RETURN;
     1365    13244
     1366    13245    1   GETOUT: ;
     1367    13246    1        K$RWPARM.ERR = %K$DEFER_IO;
     1368    13247    1        ALTRETURN;
     1369    13248        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:199  
     1370    13249        /*I* NAME: SEND_MARKER
     1371    13250             DESCRIPTION: Returns a marker, using the auto variable as data.
     1372    13251        */
     1373    13252    1   SEND_MARKER: PROC ALTRET;
     1374    13253    2        OPARM = K_RWPARM_CON;
     1375    13254    2        OPARM.MARKER = MARKER;
     1376    13255    2        OPARM.MRKTYP = %KV_VDOMRKTYP_MRK;
     1377    13256    2        CALL KIA$FCNO (LDCT,%KV_VDO_FNC_MRK,OPARM)
     1378    13257    3        WHENALTRETURN DO;
     1379    13258                  %UNLOCK (G=LDCT.LOCK);
     1380    13261    3             ALTRETURN;
     1381    13262    3           END;
     1382    13263    2        RETURN;
     1383    13264    2   END SEND_MARKER;
     1384    13265
     1385    13266    1   END KIA$UCIN;
     1386    13267
     1387    13268
     1388    13269        %EOD;

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:200  
--  Include file information  --

   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI$MHDR.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$UCIN.

   Procedure KIA$UCIN requires 592 words for executable code.
   Procedure KIA$UCIN requires 70 words of local(AUTO) storage.

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:201  

 Object Unit name= KIA$UCIN                                   File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:32:35.84 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS      3      3  KIA$UCIN
    2   Proc  even  none   592   1120  KIA$UCIN
    3  RoData even  none    17     21  KIA$UCIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        2  KIA$UCIN
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:202  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
         yes           Std       2 SSC$TSTATE
         yes           Std       2 KIA$COMP
         yes           Std       3 KIA$GETEVNT
         yes           Std       7 SSV$EVENT
         yes           Std       4 SSR$RUE
 yes     yes           Std       2 KIA$DSCTS
 yes     yes           Std       3 KIA$FCNO
 yes     yes           Std       3 KUB$WRITE
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  KI_FEI$$                         r    K_RWPARM_CON
     B$USRT$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:203  


     1094        1        /*T***********************************************************/
     1095        2        /*T*                                                         */
     1096        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1097        4        /*T*                                                         */
     1098        5        /*T***********************************************************/
     1099        6
     1100        7
     1101        8        KIA$UCIN: PROC (NK$LDCT,K$RWPARM) ALTRET;

      8  2 000000   000000 700200 xent  KIA$UCIN     TSX0  ! X66_AUTO_2
         2 000001   000106 000002                    ZERO    70,2

     1102        9
     1103       10        /*F*
     1104       11             NAME: KIA$UCIN
     1105       12             PURPOSE:
     1106       13                  This routine is the receiver for all messages destined for
     1107       14                  a time sharing terminal.
     1108       15             DESCRIPTION:
     1109       16                  When ever a message comes in to the host for a time sharing
     1110       17                  terminal KIA$UCIN is called from KIA$ISCAN to determine what
     1111       18                  functions needs to be performed. KIA$UCIN will return normally
     1112       19                  if it processed the message, altreturn with the error K$WAIT_READ
     1113       20                  to specify leave the message in the queue and a read will be
     1114       21                  done for it later, or altreturn with K$DEFER_IO which says
     1115       22                  it can not process the message right now, but call back later.
     1116       23        */
     1117       24
     1118       25        %INCLUDE B_STRINGS_C;
     1119      154        %INCLUDE CP_6;
     1120     5713        %INCLUDE KI$MHDR;
     1121     5854        %INCLUDE KV$VDO;
     1122     6869        %INCLUDE KI_DATA_R;
     1123     6895        %INCLUDE HF_LOCK_C;
     1124     6909        %INCLUDE NK$LDCT;
     1125     7011        %INCLUDE NK_SUBS;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:204  
     1126     7036        %INCLUDE KI_SUBS_C;
     1127     7172        %INCLUDE K_SUBS_C;
     1128     7205        %INCLUDE SS_SCHED_C;
     1129     7438        %INCLUDE K_DATA_R;
     1130     8149        %INCLUDE B$USER;
     1131     8365        %INCLUDE KL_MACRO_C;
     1132    11717        %INCLUDE KL_AFCN_C;
     1133    11818
     1134    11819        %NK$LDCT (STCLASS="");
     1135    11865        %K$RWPARM (NAME=K$RWPARM);
     1136    12181        %KI$QMHDR;
     1137    12230        %KL_FEPST(STCLASS="");
     1138    12265        %KV_VDO_ALL_E;
     1139    12344        %KV$VDO (STCLASS="BASED(K$RWPARM.UHDR$)");
     1140    12371        %KV$VDO_PRM;
     1141    12412        %KV$VDO_EVT (STCLASS="BASED(K$RWPARM.UHDR$)");
     1142    12454        %KV$VDO_DLT (STCLASS="BASED(K$RWPARM.UHDR$)");
     1143    12499        %KV$VDO_BLKDAT (STCLASS="BASED(K$RWPARM.UHDR$)");
     1144    12542        %KV$VDO_RQSDAT (STCLASS="BASED(K$RWPARM.UHDR$)");
     1145    12590
     1146    12591        %B$COMIO (NAME=COMIOEV,STCLASS=AUTO,PARONLY=1);
     1147    12600        %K$RWPARM (NAME=OPARM,STCLASS=AUTO);
     1148    12916        %KV$VDO_EVT (STCLASS=AUTO,NAME=VDO);
     1149    12958    1   DCL 1 VDO1 REDEF VDO,
     1150    12959    1            2 * BIT(18) UNAL ,
     1151    12960    1            2 RCRBYTSIZ UBIN(18) UNAL ;
     1152    12961    1   DCL UBNBSD UBIN WORD ALIGNED BASED;
     1153    12962    1   DCL OCQ$ PTR;
     1154    12963    1   DCL P$ PTR;
     1155    12964    1   DCL BCNT UBIN WORD;
     1156    12965    1   DCL DOMN REDEF BCNT UBIN WORD;
     1157    12966    1   DCL EVNT UBIN WORD;
     1158    12967    1   DCL TSTATE REDEF EVNT CHAR(4);
     1159    12968    1   DCL FEI UBIN WORD;
     1160    12969    1   DCL USER UBIN BYTE UNAL;
     1161    12970    1   DCL MARKER BIT(36);
     1162    12971    1   DCL SSC$TSTATE ENTRY(2);
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:205  
     1163    12972    1   DCL SSV$EVENT ENTRY(7);
     1164    12973    1   DCL KIA$FCNO ENTRY (3) ALTRET;
     1165    12974    1   DCL SSR$RUE ENTRY(4);
     1166    12975    1   DCL KIA$COMP ENTRY(2);
     1167    12976    1   DCL KIQ$FEABT ENTRY(2);
     1168    12977    1   DCL KIA$DSCTS ENTRY(2) ALTRET;
     1169    12978    1   DCL KIA$GETEVNT ENTRY(3);
     1170    12979    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1171    12980
     1172    12981        %SUB_EXC;
     1173    13028    1   DCL KIA$MSG ENTRY(1) ALTRET;
     1174    13029
     1175    13030    1   DCL B$USRT$ PTR SYMREF;
     1176    13031
     1177    13032
     1178    13033    1        FEI=LDCT.IPFEI#;

  13033  2 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000003   000014 236100                    LDQ     12,,PR0
         2 000004   000011 772000                    QRL     9
         2 000005   000777 376007                    ANQ     511,DL
         2 000006   200071 756100                    STQ     FEI,,AUTO

     1179    13034    1        VDO = KV$VDO_EVT ;

  13034  2 000007   200004 471500                    LDP1    @K$RWPARM,,AUTO
         2 000010   100014 473500                    LDP3    12,,PR1
         2 000011   000100 100500                    MLR     fill='000'O
         2 000012   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
         2 000013   200064 000004                    ADSC9   VDO,,AUTO                cn=0,n=4

     1180    13035
     1181    13036    2        DO CASE (VDO.FNC);

  13036  2 000014   200064 236100                    LDQ     VDO,,AUTO
         2 000015   000033 772000                    QRL     27
         2 000016   000040 116007                    CMPQ    32,DL
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:206  
         2 000017   000021 602006 2                  TNC     s:13036+5,QL
         2 000020   001032 710000 2                  TRA     CRASH_IT
         2 000021   001032 710000 2                  TRA     CRASH_IT
         2 000022   001032 710000 2                  TRA     CRASH_IT
         2 000023   000672 710000 2                  TRA     s:13209
         2 000024   001032 710000 2                  TRA     CRASH_IT
         2 000025   001032 710000 2                  TRA     CRASH_IT
         2 000026   000176 710000 2                  TRA     s:13081
         2 000027   001032 710000 2                  TRA     CRASH_IT
         2 000030   001032 710000 2                  TRA     CRASH_IT
         2 000031   001032 710000 2                  TRA     CRASH_IT
         2 000032   001032 710000 2                  TRA     CRASH_IT
         2 000033   000276 710000 2                  TRA     s:13108
         2 000034   001032 710000 2                  TRA     CRASH_IT
         2 000035   001032 710000 2                  TRA     CRASH_IT
         2 000036   000061 710000 2                  TRA     s:13039
         2 000037   001032 710000 2                  TRA     CRASH_IT
         2 000040   001032 710000 2                  TRA     CRASH_IT
         2 000041   001056 710000 2                  TRA     OUT
         2 000042   001032 710000 2                  TRA     CRASH_IT
         2 000043   000176 710000 2                  TRA     s:13081
         2 000044   001032 710000 2                  TRA     CRASH_IT
         2 000045   001032 710000 2                  TRA     CRASH_IT
         2 000046   001032 710000 2                  TRA     CRASH_IT
         2 000047   000335 710000 2                  TRA     s:13125
         2 000050   001032 710000 2                  TRA     CRASH_IT
         2 000051   000303 710000 2                  TRA     s:13116
         2 000052   001032 710000 2                  TRA     CRASH_IT
         2 000053   001032 710000 2                  TRA     CRASH_IT
         2 000054   001032 710000 2                  TRA     CRASH_IT
         2 000055   001032 710000 2                  TRA     CRASH_IT
         2 000056   001032 710000 2                  TRA     CRASH_IT
         2 000057   001032 710000 2                  TRA     CRASH_IT
         2 000060   000546 710000 2                  TRA     s:13172

     1182    13037        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:207  
     1183    13038    2        CASE(%KV_VDO_FNC_EVT);

     1184    13039    2           IF VDO.TYP = %KV_EVTTYP_MNTATN THEN

  13039  2 000061   200064 236100                    LDQ     VDO,,AUTO
         2 000062   000777 376007                    ANQ     511,DL
         2 000063   000002 116007                    CMPQ    2,DL
         2 000064   000073 600000 2                  TZE     L1

     1185    13040    2                GOTO L1 ;
     1186    13041    3           ELSE DO;

     1187    13042    3                BCNT = VDO.BRKCNT;

  13042  2 000065   200064 236100                    LDQ     VDO,,AUTO
         2 000066   000011 772000                    QRL     9
         2 000067   000777 376007                    ANQ     511,DL
         2 000070   200067 756100                    STQ     BCNT,,AUTO

     1188    13043    3                IF BCNT > 3

  13043  2 000071   000004 116007                    CMPQ    4,DL
         2 000072   000076 602000 2                  TNC     s:13048

     1189    13044    3                THEN
     1190    13045    3   L1:
     1191    13046    3                     EVNT=%SS_CEC;

  13046  2 000073   000014 235007       L1           LDA     12,DL
         2 000074   200070 755100                    STA     EVNT,,AUTO
         2 000075   000100 710000 2                  TRA     s:13053

     1192    13047    3                ELSE
     1193    13048    3                     EVNT = %SS_CBK;

  13048  2 000076   000012 235007                    LDA     10,DL
         2 000077   200070 755100                    STA     EVNT,,AUTO
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:208  

     1194    13049    3              END;

     1195    13050
     1196    13051        /* Reset both RDPND and RRRPND */
     1197    13052                %LOCK (G=NK$LDCT.LOCK);

  13053  2 000100   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000101   000020 036003                    ADLQ    16,DU
         2 000102   200076 756100                    STQ     MARKER+3,,AUTO
         2 000103   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000104   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000105   000000 701000 xent               TSX1    HFC$LOCK
         2 000106   000000 011000                    NOP     0

     1198    13055
     1199    13056    2           IF K$RWPARM.MRKTYP ~= 0

  13056  2 000107   200004 470500                    LDP0    @K$RWPARM,,AUTO
         2 000110   000040 236100                    LDQ     32,,PR0
         2 000111   777000 316007                    CANQ    -512,DL
         2 000112   000153 600000 2                  TZE     s:13073

     1200    13057    3           THEN DO;

     1201    13058        /* If there is already a marker pending send a mark response */
     1202    13059    3                IF LDCT.LKFLG.MRKPND

  13059  2 000113   200003 471500                    LDP1    @NK$LDCT,,AUTO
         2 000114   100011 234100                    SZN     9,,PR1
         2 000115   000124 605000 2                  TPL     s:13066

     1203    13060    4                THEN DO;

     1204    13061    4                     MARKER = LDCT.MARKER;

  13061  2 000116   100001 236100                    LDQ     1,,PR1
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:209  
         2 000117   200073 756100                    STQ     MARKER,,AUTO

     1205    13062    4                     LDCT.LKFLG.MRKPND = '0'B;

  13062  2 000120   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 000121   100011 356100                    ANSQ    9,,PR1

     1206    13063    4                     CALL SEND_MARKER ALTRET (GETOUT);

  13063  2 000122   001063 701000 2                  TSX1    SEND_MARKER
         2 000123   001057 702000 2                  TSX2    GETOUT

     1207    13064    4                   END;

     1208    13065
     1209    13066    3                MARKER = K$RWPARM.MARKER;

  13066  2 000124   200004 470500                    LDP0    @K$RWPARM,,AUTO
         2 000125   000007 236100                    LDQ     7,,PR0
         2 000126   200073 756100                    STQ     MARKER,,AUTO

     1210    13067    3                LDCT.MARKER = MARKER;

  13067  2 000127   200003 471500                    LDP1    @NK$LDCT,,AUTO
         2 000130   100001 756100                    STQ     1,,PR1

     1211    13068    3                IF B$USRT$->B$USER.FLG(LDCT.USER)&%U_SCIO

  13068  2 000131   100007 236100                    LDQ     7,,PR1
         2 000132   000016 772000                    QRL     14
         2 000133   017760 376007                    ANQ     8176,DL
         2 000134   000000 473400 xsym               LDP3    B$USRT$
         2 000135   300000 236106                    LDQ     0,QL,PR3
         2 000136   000000 376000 1                  ANQ     0
         2 000137   000151 600000 2                  TZE     s:13071
         2 000140   100007 236100                    LDQ     7,,PR1
         2 000141   000016 772000                    QRL     14
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:210  
         2 000142   017760 376007                    ANQ     8176,DL
         2 000143   300017 236106                    LDQ     15,QL,PR3
         2 000144   200003 116100                    CMPQ    @NK$LDCT,,AUTO
         2 000145   000151 601000 2                  TNZ     s:13071

     1212    13069    3                     AND B$USRT$->B$USER.MISC$(LDCT.USER) = ADDR(LDCT)
     1213    13070    3                THEN LDCT.LKFLG.MRKPND = '1'B;

  13070  2 000146   400000 236003                    LDQ     -131072,DU
         2 000147   100011 256100                    ORSQ    9,,PR1
         2 000150   000153 710000 2                  TRA     s:13073

     1214    13071    3                ELSE CALL SEND_MARKER ALTRET(GETOUT);

  13071  2 000151   001063 701000 2                  TSX1    SEND_MARKER
         2 000152   001057 702000 2                  TSX2    GETOUT

     1215    13072    3              END;

     1216    13073    2           CALL SSR$RUE (EVNT,LDCT.USER,BCNT);

  13073  2 000153   200067 630500                    EPPR0   BCNT,,AUTO
         2 000154   200100 450500                    STP0    MARKER+5,,AUTO
         2 000155   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000156   000000 036000 3                  ADLQ    0
         2 000157   200077 756100                    STQ     MARKER+4,,AUTO
         2 000160   200070 631500                    EPPR1   EVNT,,AUTO
         2 000161   200076 451500                    STP1    MARKER+3,,AUTO
         2 000162   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000163   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000164   000000 701000 xent               TSX1    SSR$RUE
         2 000165   000000 011000                    NOP     0

     1217    13074                %UNLOCK (G=NK$LDCT.LOCK);

  13075  2 000166   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000167   000020 036003                    ADLQ    16,DU
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:211  
         2 000170   200076 756100                    STQ     MARKER+3,,AUTO
         2 000171   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000172   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000173   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000174   000000 011000                    NOP     0
         2 000175   001056 710000 2                  TRA     OUT

     1218    13077
     1219    13078        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:212  
     1220    13079    2        CASE (%KV_VDO_FNC_DAT,%KV_VDO_FNC_PRM_RSP);

     1221    13080                %LOCK (G=NK$LDCT.LOCK);

  13081  2 000176   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000177   000020 036003                    ADLQ    16,DU
         2 000200   200076 756100                    STQ     MARKER+3,,AUTO
         2 000201   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000202   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000203   000000 701000 xent               TSX1    HFC$LOCK
         2 000204   000000 011000                    NOP     0

     1222    13083    2           IF K$RWPARM.MRKTYP ~= 0

  13083  2 000205   200004 470500                    LDP0    @K$RWPARM,,AUTO
         2 000206   000040 236100                    LDQ     32,,PR0
         2 000207   777000 316007                    CANQ    -512,DL
         2 000210   000215 600000 2                  TZE     s:13089

     1223    13084    3           THEN DO;

     1224    13085    3                MARKER = K$RWPARM.MARKER;

  13085  2 000211   000007 236100                    LDQ     7,,PR0
         2 000212   200073 756100                    STQ     MARKER,,AUTO

     1225    13086    3                CALL SEND_MARKER ALTRET(GETOUT);

  13086  2 000213   001063 701000 2                  TSX1    SEND_MARKER
         2 000214   001057 702000 2                  TSX2    GETOUT

     1226    13087    3              END;

     1227    13088
     1228    13089    2           IF VDO.FNC = %KV_VDO_FNC_DAT AND NK$LDCT.LKFLG.NOWAIT

  13089  2 000215   200064 236100                    LDQ     VDO,,AUTO
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:213  
         2 000216   777000 376003                    ANQ     -512,DU
         2 000217   005000 116003                    CMPQ    2560,DU
         2 000220   000241 601000 2                  TNZ     s:13097
         2 000221   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000222   000011 236100                    LDQ     9,,PR0
         2 000223   000001 316003                    CANQ    1,DU
         2 000224   000241 600000 2                  TZE     s:13097

     1229    13090    3           THEN DO;

     1230    13091    3                CALL KIA$COMP(NK$LDCT,K$RWPARM);

  13091  2 000225   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         2 000226   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000227   000000 701000 xent               TSX1    KIA$COMP
         2 000230   000000 011000                    NOP     0

     1231    13092                     %UNLOCK (G=NK$LDCT.LOCK);

  13093  2 000231   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000232   000020 036003                    ADLQ    16,DU
         2 000233   200076 756100                    STQ     MARKER+3,,AUTO
         2 000234   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000235   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000236   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000237   000000 011000                    NOP     0

     1232    13095    3                RETURN;

  13095  2 000240   000000 702200 xent               TSX2  ! X66_ARET

     1233    13096    3              END;
     1234    13097    2           P$ = ADDR(B$USRT$->B$USER(LDCT.USER));

  13097  2 000241   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000242   000007 236100                    LDQ     7,,PR0
         2 000243   000016 772000                    QRL     14
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:214  
         2 000244   017760 376007                    ANQ     8176,DL
         2 000245   000022 736000                    QLS     18
         2 000246   000000 036000 xsym               ADLQ    B$USRT$
         2 000247   200066 756100                    STQ     P$,,AUTO

     1235    13098    2           IF P$->B$U.FLG & %U_SCIO AND

  13098  2 000250   200066 471500                    LDP1    P$,,AUTO
         2 000251   100000 236100                    LDQ     0,,PR1
         2 000252   000000 376000 1                  ANQ     0
         2 000253   000275 600000 2                  TZE     s:13104
         2 000254   100017 236100                    LDQ     15,,PR1
         2 000255   200003 116100                    CMPQ    @NK$LDCT,,AUTO
         2 000256   000275 601000 2                  TNZ     s:13104
         2 000257   100011 236100                    LDQ     9,,PR1
         2 000260   770000 376003                    ANQ     -4096,DU
         2 000261   250000 116003                    CMPQ    86016,DU
         2 000262   000265 600000 2                  TZE     s:13103
         2 000263   270000 116003                    CMPQ    94208,DU
         2 000264   000275 601000 2                  TNZ     s:13104

     1236    13099    2                P$->B$U.MISC$ = ADDR(NK$LDCT) AND
     1237    13100    2                (P$->B$U.US = %SS_STI OR
     1238    13101    2                P$->B$U.US = %SS_SCW)
     1239    13102    2           THEN
     1240    13103    2                CALL SSR$RUE (%SS_CIC,LDCT.USER);

  13103  2 000265   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000266   000000 036000 3                  ADLQ    0
         2 000267   000001 235000 3                  LDA     1
         2 000270   200076 757100                    STAQ    MARKER+3,,AUTO
         2 000271   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000272   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000273   000000 701000 xent               TSX1    SSR$RUE
         2 000274   000000 011000                    NOP     0

     1241    13104    2           GOTO L4 ;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:215  

  13104  2 000275   000621 710000 2                  TRA     L4

     1242    13105
     1243    13106        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:216  
     1244    13107    2        CASE(%KV_VDO_FNC_DSC_RQS);

     1245    13108    2           CALL KIA$DSCTS (LDCT,K$RWPARM) ALTRET(GETOUT);

  13108  2 000276   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         2 000277   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000300   000000 701000 xent               TSX1    KIA$DSCTS
         2 000301   001057 702000 2                  TSX2    GETOUT
         2 000302   001056 710000 2                  TRA     OUT

     1246    13109
     1247    13110
     1248    13111    2        CASE(%KV_VDO_FNC_OPNSSN_RQS);

     1249    13112
     1250    13113
     1251    13114
     1252    13115    2        CASE(%KV_VDO_FNC_RQSSTT);

     1253    13116    2           CALL SSC$TSTATE (LDCT.USER,TSTATE);

  13116  2 000303   200070 634500                    EPPR4   EVNT,,AUTO
         2 000304   200077 454500                    STP4    MARKER+4,,AUTO
         2 000305   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000306   000000 036000 3                  ADLQ    0
         2 000307   200076 756100                    STQ     MARKER+3,,AUTO
         2 000310   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000311   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000312   000000 701000 xent               TSX1    SSC$TSTATE
         2 000313   000000 011000                    NOP     0

     1254    13117    2           OPARM = K_RWPARM_CON;

  13117  2 000314   000100 100400                    MLR     fill='000'O
         2 000315   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 000316   200014 000234                    ADSC9   OPARM,,AUTO              cn=0,n=156

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:217  
     1255    13118    2           OPARM.MSG$ = ADDR(TSTATE);

  13118  2 000317   200070 630500                    EPPR0   EVNT,,AUTO
         2 000320   200014 450500                    STP0    OPARM,,AUTO

     1256    13119    2           OPARM.MSGSZ = LENGTHC(TSTATE);

  13119  2 000321   000004 235007                    LDA     4,DL
         2 000322   200015 755100                    STA     OPARM+1,,AUTO

     1257    13120    2           CALL KIA$FCNO(LDCT,%KV_VDO_FNC_STT,OPARM) ALTRET(GETOUT);

  13120  2 000323   200014 631500                    EPPR1   OPARM,,AUTO
         2 000324   200100 451500                    STP1    MARKER+5,,AUTO
         2 000325   000003 236000 3                  LDQ     3
         2 000326   200003 235100                    LDA     @NK$LDCT,,AUTO
         2 000327   200076 757100                    STAQ    MARKER+3,,AUTO
         2 000330   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000331   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000332   000000 701000 xent               TSX1    KIA$FCNO
         2 000333   001057 702000 2                  TSX2    GETOUT
         2 000334   001056 710000 2                  TRA     OUT

     1258    13121
     1259    13122        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:218  
     1260    13123    2        CASE(%KV_VDO_FNC_RQSDAT);

     1261    13124                %LOCK (G=NK$LDCT.LOCK);

  13125  2 000335   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000336   000020 036003                    ADLQ    16,DU
         2 000337   200076 756100                    STQ     MARKER+3,,AUTO
         2 000340   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000341   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000342   000000 701000 xent               TSX1    HFC$LOCK
         2 000343   000000 011000                    NOP     0

     1262    13127    2           IF NK$LDCT.TH.MAXNMBRCR = 0 OR NK$LDCT.TH.MAXNMBBYT = 0

  13127  2 000344   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000345   000016 720100                    LXL0    14,,PR0
         2 000346   000351 600000 2                  TZE     s:13129
         2 000347   000017 721100                    LXL1    15,,PR0
         2 000350   000416 601000 2                  TNZ     s:13148

     1263    13128    3           THEN DO;

     1264    13129    3                OPARM = K_RWPARM_CON;

  13129  2 000351   000100 100400                    MLR     fill='000'O
         2 000352   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 000353   200014 000234                    ADSC9   OPARM,,AUTO              cn=0,n=156

     1265    13130    3                CALL KIA$FCNO(NK$LDCT,%KV_VDO_FNC_BLKDAT,OPARM)

  13130  2 000354   200014 631500                    EPPR1   OPARM,,AUTO
         2 000355   200100 451500                    STP1    MARKER+5,,AUTO
         2 000356   000004 236000 3                  LDQ     4
         2 000357   200003 235100                    LDA     @NK$LDCT,,AUTO
         2 000360   200076 757100                    STAQ    MARKER+3,,AUTO
         2 000361   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000362   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:219  
         2 000363   000000 701000 xent               TSX1    KIA$FCNO
         2 000364   000366 702000 2                  TSX2    s:13133
         2 000365   000376 710000 2                  TRA     s:13137

     1266    13131    4                WHENALTRETURN DO;

     1267    13132                          %UNLOCK (G=NK$LDCT.LOCK);

  13133  2 000366   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000367   000020 036003                    ADLQ    16,DU
         2 000370   200076 756100                    STQ     MARKER+3,,AUTO
         2 000371   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000372   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000373   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000374   000000 011000                    NOP     0

     1268    13135    4                     GOTO GETOUT;

  13135  2 000375   001057 710000 2                  TRA     GETOUT

     1269    13136    4                   END;
     1270    13137    3                IF K$RWPARM.MRKTYP ~= 0

  13137  2 000376   200004 470500                    LDP0    @K$RWPARM,,AUTO
         2 000377   000040 236100                    LDQ     32,,PR0
         2 000400   777000 316007                    CANQ    -512,DL
         2 000401   000406 600000 2                  TZE     s:13143

     1271    13138    4                THEN DO;

     1272    13139    4                     MARKER = K$RWPARM.MARKER;

  13139  2 000402   000007 236100                    LDQ     7,,PR0
         2 000403   200073 756100                    STQ     MARKER,,AUTO

     1273    13140    4                     CALL SEND_MARKER ALTRET(GETOUT);

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:220  
  13140  2 000404   001063 701000 2                  TSX1    SEND_MARKER
         2 000405   001057 702000 2                  TSX2    GETOUT

     1274    13141    4                   END;

     1275    13142                     %UNLOCK (G=NK$LDCT.LOCK);

  13143  2 000406   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000407   000020 036003                    ADLQ    16,DU
         2 000410   200076 756100                    STQ     MARKER+3,,AUTO
         2 000411   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000412   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000413   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000414   000000 011000                    NOP     0

     1276    13145    3                RETURN;

  13145  2 000415   000000 702200 xent               TSX2  ! X66_ARET

     1277    13146    3              END;
     1278    13147                %UNLOCK (G=NK$LDCT.LOCK);

  13148  2 000416   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000417   000020 036003                    ADLQ    16,DU
         2 000420   200076 756100                    STQ     MARKER+3,,AUTO
         2 000421   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000422   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000423   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000424   000000 011000                    NOP     0

     1279    13150                       /* Report COMIO event to user if an event is specified     */
     1280    13151                       /* in the DCB.                                             */
     1281    13152    2           IF VDO.STR~=KIDM_MON AND VDO.STR~=KIDM_DB

  13152  2 000425   200064 236100                    LDQ     VDO,,AUTO
         2 000426   000177 376003                    ANQ     127,DU
         2 000427   000177 116003                    CMPQ    127,DU
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:221  
         2 000430   000530 600000 2                  TZE     s:13165
         2 000431   000003 116003                    CMPQ    3,DU
         2 000432   000530 600000 2                  TZE     s:13165

     1282    13153    3           THEN DO;

     1283    13154    3                CALL KIA$GETEVNT(LDCT,EVNT,DOMN);

  13154  2 000433   200067 630500                    EPPR0   BCNT,,AUTO
         2 000434   200100 450500                    STP0    MARKER+5,,AUTO
         2 000435   200070 631500                    EPPR1   EVNT,,AUTO
         2 000436   200077 451500                    STP1    MARKER+4,,AUTO
         2 000437   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000440   200076 756100                    STQ     MARKER+3,,AUTO
         2 000441   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000442   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000443   000000 701000 xent               TSX1    KIA$GETEVNT
         2 000444   000000 011000                    NOP     0

     1284    13155    4                IF EVNT~=0 THEN DO;

  13155  2 000445   200070 235100                    LDA     EVNT,,AUTO
         2 000446   000530 600000 2                  TZE     s:13165

     1285    13156    4                     CALL SSR$RUE (%SS_FPEVNT,LDCT.USER);

  13156  2 000447   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000450   000000 036000 3                  ADLQ    0
         2 000451   000006 235000 3                  LDA     6
         2 000452   200076 757100                    STAQ    MARKER+3,,AUTO
         2 000453   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000454   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000455   000000 701000 xent               TSX1    SSR$RUE
         2 000456   000000 011000                    NOP     0

     1286    13157    4                     COMIOEV='0'B;

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:222  
  13157  2 000457   000100 100400                    MLR     fill='000'O
         2 000460   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000461   200011 000014                    ADSC9   COMIOEV,,AUTO            cn=0,n=12

     1287    13158    4                     IF DOMN=%DBWSR THEN COMIOEV.FLAGS.DELTA='1'B; /* DELTA only  */

  13158  2 000462   200067 235100                    LDA     BCNT,,AUTO
         2 000463   000005 115007                    CMPA    5,DL
         2 000464   000467 601000 2                  TNZ     s:13159

  13158  2 000465   400000 236007                    LDQ     -131072,DL
         2 000466   200012 256100                    ORSQ    COMIOEV+1,,AUTO

     1288    13159    4                     COMIOEV.P#=SIZEW(COMIOEV)-SIZEW(COMIOEV.P#);

  13159  2 000467   000002 236007                    LDQ     2,DL
         2 000470   200011 756100                    STQ     COMIOEV,,AUTO

     1289    13160    4                     COMIOEV.SUBC2=%SUBC2_DATA_RQS#;

  13160  2 000471   000001 236007                    LDQ     1,DL
         2 000472   200012 552104                    STBQ    COMIOEV+1,'04'O,AUTO

     1290    13161    4                     COMIOEV.ARS=256*VDO1.RCRBYTSIZ/512+MOD(VDO1.RCRBYTSIZ,512);

  13161  2 000473   200064 236100                    LDQ     VDO,,AUTO
         2 000474   000010 736000                    QLS     8
         2 000475   000007 376000 3                  ANQ     7
         2 000476   000011 772000                    QRL     9
         2 000477   200076 756100                    STQ     MARKER+3,,AUTO
         2 000500   200064 236100                    LDQ     VDO,,AUTO
         2 000501   777777 376007                    ANQ     -1,DL
         2 000502   000777 376007                    ANQ     511,DL
         2 000503   200076 036100                    ADLQ    MARKER+3,,AUTO
         2 000504   200013 756100                    STQ     COMIOEV+2,,AUTO

     1291    13162    4                     CALL SSV$EVENT(LDCT.USER,DOMN,%SUBC_COMIO#,EVNT,0,ADDR(COMIOEV));
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:223  

  13162  2 000505   200011 630500                    EPPR0   COMIOEV,,AUTO
         2 000506   200076 450500                    STP0    MARKER+3,,AUTO
         2 000507   200076 631500                    EPPR1   MARKER+3,,AUTO
         2 000510   200105 451500                    STP1    MARKER+10,,AUTO
         2 000511   000010 236000 3                  LDQ     8
         2 000512   200104 756100                    STQ     MARKER+9,,AUTO
         2 000513   200070 633500                    EPPR3   EVNT,,AUTO
         2 000514   200103 453500                    STP3    MARKER+8,,AUTO
         2 000515   000011 236000 3                  LDQ     9
         2 000516   200102 756100                    STQ     MARKER+7,,AUTO
         2 000517   200067 634500                    EPPR4   BCNT,,AUTO
         2 000520   200101 454500                    STP4    MARKER+6,,AUTO
         2 000521   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000522   000000 036000 3                  ADLQ    0
         2 000523   200100 756100                    STQ     MARKER+5,,AUTO
         2 000524   200100 630500                    EPPR0   MARKER+5,,AUTO
         2 000525   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 000526   000000 701000 xent               TSX1    SSV$EVENT
         2 000527   000000 011000                    NOP     0

     1292    13163    4                   END;

     1293    13164    3              END;                         /* CASE */

     1294    13165    2           IF NK$LDCT.TH.MAXNMBRCR > 0 OR NK$LDCT.TH.MAXNMBBYT > 0

  13165  2 000530   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000531   000016 720100                    LXL0    14,,PR0
         2 000532   000535 605400 2                  TPNZ    s:13167
         2 000533   000017 721100                    LXL1    15,,PR0
         2 000534   001056 604400 2                  TMOZ    OUT

     1295    13166    2           THEN
     1296    13167    2                CALL SSR$RUE (%SS_CUB,LDCT.USER);

  13167  2 000535   200003 236100                    LDQ     @NK$LDCT,,AUTO
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:224  
         2 000536   000000 036000 3                  ADLQ    0
         2 000537   000012 235000 3                  LDA     10
         2 000540   200076 757100                    STAQ    MARKER+3,,AUTO
         2 000541   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000542   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000543   000000 701000 xent               TSX1    SSR$RUE
         2 000544   000000 011000                    NOP     0
         2 000545   001056 710000 2                  TRA     OUT

     1297    13168
     1298    13169        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:225  
     1299    13170    2        CASE(%KV_VDO_FNC_MRK);

     1300    13171                %LOCK (G=NK$LDCT.LOCK);

  13172  2 000546   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000547   000020 036003                    ADLQ    16,DU
         2 000550   200076 756100                    STQ     MARKER+3,,AUTO
         2 000551   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000552   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000553   000000 701000 xent               TSX1    HFC$LOCK
         2 000554   000000 011000                    NOP     0

     1301    13174    2           IF (B$USRT$->B$USER.FLG(LDCT.USER)&%U_SCIO)

  13174  2 000555   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000556   000007 236100                    LDQ     7,,PR0
         2 000557   000016 772000                    QRL     14
         2 000560   017760 376007                    ANQ     8176,DL
         2 000561   000000 471400 xsym               LDP1    B$USRT$
         2 000562   100000 236106                    LDQ     0,QL,PR1
         2 000563   000000 376000 1                  ANQ     0
         2 000564   000603 600000 2                  TZE     s:13178
         2 000565   000007 236100                    LDQ     7,,PR0
         2 000566   000016 772000                    QRL     14
         2 000567   017760 376007                    ANQ     8176,DL
         2 000570   100017 236106                    LDQ     15,QL,PR1
         2 000571   200003 116100                    CMPQ    @NK$LDCT,,AUTO
         2 000572   000603 601000 2                  TNZ     s:13178

     1302    13175    2                AND B$USRT$->B$USER.MISC$(LDCT.USER) = ADDR(LDCT)
     1303    13176    2           THEN
     1304    13177    2                CALL SSR$RUE (%SS_CIC,LDCT.USER);

  13177  2 000573   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000574   000000 036000 3                  ADLQ    0
         2 000575   000001 235000 3                  LDA     1
         2 000576   200076 757100                    STAQ    MARKER+3,,AUTO
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:226  
         2 000577   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000600   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000601   000000 701000 xent               TSX1    SSR$RUE
         2 000602   000000 011000                    NOP     0

     1305    13178    2           IF LDCT.LKFLG.WTMRK             /* Waiting marker */

  13178  2 000603   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000604   000011 236100                    LDQ     9,,PR0
         2 000605   020000 316003                    CANQ    8192,DU
         2 000606   000621 600000 2                  TZE     L4

     1306    13179    3           THEN DO;

     1307    13180    3                LDCT.LKFLG.WTMRK = '0'B;

  13180  2 000607   000013 236000 3                  LDQ     11
         2 000610   000011 356100                    ANSQ    9,,PR0

     1308    13181                     %UNLOCK (G=NK$LDCT.LOCK);

  13182  2 000611   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000612   000020 036003                    ADLQ    16,DU
         2 000613   200076 756100                    STQ     MARKER+3,,AUTO
         2 000614   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000615   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000616   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000617   000000 011000                    NOP     0

     1309    13184    3                RETURN;

  13184  2 000620   000000 702200 xent               TSX2  ! X66_ARET

  13178  2 000621                       L4           null
     1310    13185    3              END;
     1311    13186    2   L4:     ;
     1312    13187    2           IF LDCT.IP$ ~= ADDR(NIL)
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:227  

  13187  2 000621   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000622   000013 236100                    LDQ     11,,PR0
         2 000623   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000624   000635 600000 2                  TZE     s:13194

     1313    13188    3           THEN DO;

     1314    13189                     %UNLOCK (G=NK$LDCT.LOCK);

  13190  2 000625   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000626   000020 036003                    ADLQ    16,DU
         2 000627   200076 756100                    STQ     MARKER+3,,AUTO
         2 000630   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000631   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000632   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000633   000000 011000                    NOP     0

     1315    13192    3                GOTO CRASH_IT;

  13192  2 000634   001032 710000 2                  TRA     CRASH_IT

     1316    13193    3              END;
     1317    13194    2           LDCT.IP$ = K$RWPARM.IP$;

  13194  2 000635   200004 471500                    LDP1    @K$RWPARM,,AUTO
         2 000636   100012 236100                    LDQ     10,,PR1
         2 000637   000013 756100                    STQ     11,,PR0

     1318    13195    2           LDCT.IPFEI# = K$RWPARM.IP$->KI$QMHDR.FEI#;

  13195  2 000640   100012 473500                    LDP3    10,,PR1
         2 000641   300000 236100                    LDQ     0,,PR3
         2 000642   377000 376003                    ANQ     130560,DU
         2 000643   000022 772000                    QRL     18
         2 000644   000014 552110                    STBQ    12,'10'O,PR0

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:228  
     1319    13196                %UNLOCK (G=NK$LDCT.LOCK);

  13197  2 000645   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000646   000020 036003                    ADLQ    16,DU
         2 000647   200076 756100                    STQ     MARKER+3,,AUTO
         2 000650   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000651   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000652   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000653   000000 011000                    NOP     0

     1320    13199    2          ADDR(K$RWPARM.IP$->KI$QMHDR.OFFSET)->UBNBSD = POFFC(K$RWPARM.UHDR$,K$RWPARM.
             13199                    IP$)

  13199  2 000654   200004 470500                    LDP0    @K$RWPARM,,AUTO
         2 000655   000012 471500                    LDP1    10,,PR0
         2 000656   000012 236100                    LDQ     10,,PR0
         2 000657   000020 772000                    QRL     16
         2 000660   200076 756100                    STQ     MARKER+3,,AUTO
         2 000661   000014 236100                    LDQ     12,,PR0
         2 000662   000020 772000                    QRL     16
         2 000663   200076 136100                    SBLQ    MARKER+3,,AUTO
         2 000664   000022 736000                    QLS     18
         2 000665   000015 036100                    ADLQ    13,,PR0
         2 000666   100001 756100                    STQ     1,,PR1

     1321    13200    2                * 262144 + K$RWPARM.UHDRSZ;
     1322    13201    2           K$RWPARM.ERR = %K$WAIT_READ;

  13201  2 000667   000006 235007                    LDA     6,DL
         2 000670   000013 755100                    STA     11,,PR0

     1323    13202    2           ALTRETURN;

  13202  2 000671   000000 702200 xent               TSX2  ! X66_AALT

     1324    13203
     1325    13204
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:229  
     1326    13205        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:230  
     1327    13206    2        CASE(%KV_VDO_FNC_BLKDAT);

     1328    13207                       /* Report COMIO event to user if an event is specified     */
     1329    13208                       /* in the DCB                                              */
     1330    13209    2           IF VDO.STR=KIDM_MON THEN RETURN;

  13209  2 000672   200064 236100                    LDQ     VDO,,AUTO
         2 000673   000177 376003                    ANQ     127,DU
         2 000674   000177 116003                    CMPQ    127,DU
         2 000675   000677 601000 2                  TNZ     s:13210

  13209  2 000676   000000 702200 xent               TSX2  ! X66_ARET

     1331    13210    2           CALL KIA$GETEVNT(LDCT,EVNT,DOMN);

  13210  2 000677   200067 634500                    EPPR4   BCNT,,AUTO
         2 000700   200100 454500                    STP4    MARKER+5,,AUTO
         2 000701   200070 633500                    EPPR3   EVNT,,AUTO
         2 000702   200077 453500                    STP3    MARKER+4,,AUTO
         2 000703   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000704   200076 756100                    STQ     MARKER+3,,AUTO
         2 000705   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000706   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000707   000000 701000 xent               TSX1    KIA$GETEVNT
         2 000710   000000 011000                    NOP     0

     1332    13211        /*
     1333    13212             if sched for i/o but remote write was issued before rqsdat,
     1334    13213             just return and wait for data.
     1335    13214        */
     1336    13215    2           P$ = ADDR(B$USRT$->B$USER(LDCT.USER));

  13215  2 000711   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000712   000007 236100                    LDQ     7,,PR0
         2 000713   000016 772000                    QRL     14
         2 000714   017760 376007                    ANQ     8176,DL
         2 000715   000022 736000                    QLS     18
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:231  
         2 000716   000000 036000 xsym               ADLQ    B$USRT$
         2 000717   200066 756100                    STQ     P$,,AUTO

     1337    13216    2           IF P$->B$U.FLG & %U_SCIO AND

  13216  2 000720   200066 471500                    LDP1    P$,,AUTO
         2 000721   100000 236100                    LDQ     0,,PR1
         2 000722   000000 376000 1                  ANQ     0
         2 000723   000746 600000 2                  TZE     s:13223
         2 000724   100017 236100                    LDQ     15,,PR1
         2 000725   200003 116100                    CMPQ    @NK$LDCT,,AUTO
         2 000726   000746 601000 2                  TNZ     s:13223
         2 000727   200004 473500                    LDP3    @K$RWPARM,,AUTO
         2 000730   300014 474500                    LDP4    12,,PR3
         2 000731   000100 101500                    MRL     fill='000'O
         2 000732   400001 000001                    ADSC9   1,,PR4                   cn=0,n=1
         2 000733   200076 000004                    ADSC9   MARKER+3,,AUTO           cn=0,n=4
         2 000734   200076 236100                    LDQ     MARKER+3,,AUTO
         2 000735   000002 116007                    CMPQ    2,DL
         2 000736   000746 601000 2                  TNZ     s:13223
         2 000737   100011 236100                    LDQ     9,,PR1
         2 000740   770000 376003                    ANQ     -4096,DU
         2 000741   250000 116003                    CMPQ    86016,DU
         2 000742   000745 600000 2                  TZE     s:13222
         2 000743   270000 116003                    CMPQ    94208,DU
         2 000744   000746 601000 2                  TNZ     s:13223

     1338    13217    2                P$->B$U.MISC$ = ADDR(NK$LDCT) AND
     1339    13218    2                KV$VDO_BLKDAT.RSN = %KV_BLKRSN_MAXNMBRCR AND
     1340    13219    2                (P$->B$U.US = %SS_STI OR
     1341    13220    2                P$->B$U.US = %SS_SCW)
     1342    13221    2           THEN
     1343    13222    2                RETURN;

  13222  2 000745   000000 702200 xent               TSX2  ! X66_ARET

     1344    13223    3           IF EVNT~=0 THEN DO;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:232  

  13223  2 000746   200070 235100                    LDA     EVNT,,AUTO
         2 000747   001056 600000 2                  TZE     OUT

     1345    13224    3                CALL SSR$RUE (%SS_FPEVNT,LDCT.USER);

  13224  2 000750   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000751   000000 036000 3                  ADLQ    0
         2 000752   000006 235000 3                  LDA     6
         2 000753   200076 757100                    STAQ    MARKER+3,,AUTO
         2 000754   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 000755   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000756   000000 701000 xent               TSX1    SSR$RUE
         2 000757   000000 011000                    NOP     0

     1346    13225    3                COMIOEV='0'B;

  13225  2 000760   000100 100400                    MLR     fill='000'O
         2 000761   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000762   200011 000014                    ADSC9   COMIOEV,,AUTO            cn=0,n=12

     1347    13226    3                IF DOMN=%DBWSR THEN COMIOEV.FLAGS.DELTA='1'B; /* DELTA only */

  13226  2 000763   200067 235100                    LDA     BCNT,,AUTO
         2 000764   000005 115007                    CMPA    5,DL
         2 000765   000770 601000 2                  TNZ     s:13227

  13226  2 000766   400000 236007                    LDQ     -131072,DL
         2 000767   200012 256100                    ORSQ    COMIOEV+1,,AUTO

     1348    13227    3                COMIOEV.P#=SIZEW(COMIOEV)-SIZEW(COMIOEV.P#);

  13227  2 000770   000002 236007                    LDQ     2,DL
         2 000771   200011 756100                    STQ     COMIOEV,,AUTO

     1349    13228    3                COMIOEV.SUBC2=%SUBC2_DATA_AVL#;

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:233  
  13228  2 000772   000002 236007                    LDQ     2,DL
         2 000773   200012 552104                    STBQ    COMIOEV+1,'04'O,AUTO

     1350    13229    3                COMIOEV.ARS=256*VDO1.RCRBYTSIZ/512+MOD(VDO1.RCRBYTSIZ,512);

  13229  2 000774   200064 236100                    LDQ     VDO,,AUTO
         2 000775   000010 736000                    QLS     8
         2 000776   000007 376000 3                  ANQ     7
         2 000777   000011 772000                    QRL     9
         2 001000   200076 756100                    STQ     MARKER+3,,AUTO
         2 001001   200064 236100                    LDQ     VDO,,AUTO
         2 001002   777777 376007                    ANQ     -1,DL
         2 001003   000777 376007                    ANQ     511,DL
         2 001004   200076 036100                    ADLQ    MARKER+3,,AUTO
         2 001005   200013 756100                    STQ     COMIOEV+2,,AUTO

     1351    13230    3                CALL SSV$EVENT(LDCT.USER,DOMN,%SUBC_COMIO#,EVNT,0,ADDR(COMIOEV));

  13230  2 001006   200011 630500                    EPPR0   COMIOEV,,AUTO
         2 001007   200076 450500                    STP0    MARKER+3,,AUTO
         2 001010   200076 631500                    EPPR1   MARKER+3,,AUTO
         2 001011   200105 451500                    STP1    MARKER+10,,AUTO
         2 001012   000010 236000 3                  LDQ     8
         2 001013   200104 756100                    STQ     MARKER+9,,AUTO
         2 001014   200070 633500                    EPPR3   EVNT,,AUTO
         2 001015   200103 453500                    STP3    MARKER+8,,AUTO
         2 001016   000011 236000 3                  LDQ     9
         2 001017   200102 756100                    STQ     MARKER+7,,AUTO
         2 001020   200067 634500                    EPPR4   BCNT,,AUTO
         2 001021   200101 454500                    STP4    MARKER+6,,AUTO
         2 001022   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 001023   000000 036000 3                  ADLQ    0
         2 001024   200100 756100                    STQ     MARKER+5,,AUTO
         2 001025   200100 630500                    EPPR0   MARKER+5,,AUTO
         2 001026   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 001027   000000 701000 xent               TSX1    SSV$EVENT
         2 001030   000000 011000                    NOP     0
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:234  

     1352    13231    3              END;

  13231  2 001031   001056 710000 2                  TRA     OUT

     1353    13232
     1354    13233        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:235  
     1355    13234    2        CASE(ELSE);

  13230  2 001032                       CRASH_IT     null
     1356    13235    2   CRASH_IT: ;                   /* Lop off this diseased branch of the network */
     1357    13236    2           KL_FEPST.FEP = K$RWPARM.FEX;

  13236  2 001032   200004 470500                    LDP0    @K$RWPARM,,AUTO
         2 001033   000021 236100                    LDQ     17,,PR0
         2 001034   000022 736000                    QLS     18
         2 001035   200005 552120                    STBQ    KL_FEPST,'20'O,AUTO

     1358    13237    2           KL_FEPST.FCN = IGA_CRASHFEP_BF;

  13237  2 001036   120000 236003                    LDQ     40960,DU
         2 001037   200005 552140                    STBQ    KL_FEPST,'40'O,AUTO

     1359    13238    2           CALL KUB$WRITE(KL_FEPST, LENGTHC(KL_FEPST), 'HLPADMIN');

  13238  2 001040   000015 236000 3                  LDQ     13
         2 001041   200100 756100                    STQ     MARKER+5,,AUTO
         2 001042   000016 236000 3                  LDQ     14
         2 001043   200077 756100                    STQ     MARKER+4,,AUTO
         2 001044   200005 631500                    EPPR1   KL_FEPST,,AUTO
         2 001045   200076 451500                    STP1    MARKER+3,,AUTO
         2 001046   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 001047   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001050   000000 701000 xent               TSX1    KUB$WRITE
         2 001051   000000 011000                    NOP     0

     1360    13239    2           K$RWPARM.ERR = %K$WAIT_READ;

  13239  2 001052   000006 235007                    LDA     6,DL
         2 001053   200004 470500                    LDP0    @K$RWPARM,,AUTO
         2 001054   000013 755100                    STA     11,,PR0

     1361    13240    2           ALTRETURN;       /* Freeze the Q so that there's something to see */

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:236  
  13240  2 001055   000000 702200 xent               TSX2  ! X66_AALT

     1362    13241    2        END;

  13236  2 001056                       OUT          null
     1363    13242    1   OUT: ;
     1364    13243    1        RETURN;

  13243  2 001056   000000 702200 xent               TSX2  ! X66_ARET

  13236  2 001057                       GETOUT       null
     1365    13244
     1366    13245    1   GETOUT: ;
     1367    13246    1        K$RWPARM.ERR = %K$DEFER_IO;

  13246  2 001057   000003 235007                    LDA     3,DL
         2 001060   200004 470500                    LDP0    @K$RWPARM,,AUTO
         2 001061   000013 755100                    STA     11,,PR0

     1368    13247    1        ALTRETURN;

  13247  2 001062   000000 702200 xent               TSX2  ! X66_AALT

     1369    13248        %EJECT;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:237  
     1370    13249        /*I* NAME: SEND_MARKER
     1371    13250             DESCRIPTION: Returns a marker, using the auto variable as data.
     1372    13251        */
     1373    13252    1   SEND_MARKER: PROC ALTRET;

  13252  2 001063   200074 741300       SEND_MARKER  STX1  ! MARKER+1,,AUTO

     1374    13253    2        OPARM = K_RWPARM_CON;

  13253  2 001064   000100 100400                    MLR     fill='000'O
         2 001065   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 001066   200014 000234                    ADSC9   OPARM,,AUTO              cn=0,n=156

     1375    13254    2        OPARM.MARKER = MARKER;

  13254  2 001067   200073 236100                    LDQ     MARKER,,AUTO
         2 001070   200023 756100                    STQ     OPARM+7,,AUTO

     1376    13255    2        OPARM.MRKTYP = %KV_VDOMRKTYP_MRK;

  13255  2 001071   003000 236007                    LDQ     1536,DL
         2 001072   200054 552110                    STBQ    OPARM+32,'10'O,AUTO

     1377    13256    2        CALL KIA$FCNO (LDCT,%KV_VDO_FNC_MRK,OPARM)

  13256  2 001073   200014 630500                    EPPR0   OPARM,,AUTO
         2 001074   200100 450500                    STP0    MARKER+5,,AUTO
         2 001075   000020 236000 3                  LDQ     16
         2 001076   200003 235100                    LDA     @NK$LDCT,,AUTO
         2 001077   200076 757100                    STAQ    MARKER+3,,AUTO
         2 001100   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 001101   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001102   000000 701000 xent               TSX1    KIA$FCNO
         2 001103   001105 702000 2                  TSX2    s:13259
         2 001104   001116 710000 2                  TRA     s:13263

     1378    13257    3        WHENALTRETURN DO;
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:238  

     1379    13258                  %UNLOCK (G=LDCT.LOCK);

  13259  2 001105   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 001106   000020 036003                    ADLQ    16,DU
         2 001107   200076 756100                    STQ     MARKER+3,,AUTO
         2 001110   200076 630500                    EPPR0   MARKER+3,,AUTO
         2 001111   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001112   000000 701000 xent               TSX1    HFC$UNLOCK
         2 001113   000000 011000                    NOP     0

     1380    13261    3             ALTRETURN;

  13261  2 001114   200074 221300                    LDX1  ! MARKER+1,,AUTO
         2 001115   000000 702211                    TSX2  ! 0,X1

     1381    13262    3           END;
     1382    13263    2        RETURN;

  13263  2 001116   200074 221300                    LDX1  ! MARKER+1,,AUTO
         2 001117   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   1     000   000000 002000   110114 120101   104115 111116                    ....HLPADMIN

(unnamed)
 Sect OctLoc
   3     000   000007 200000   000007 006000   000000 000035   000002 006000    ................
   3     004   000004 006000   000000 000053   000005 006000   000377 777400    .......+........
   3     010   000002 006000   000010 006000   000012 006000   757777 777777    ................
   3     014   000000 000016   000001 006000   000014 006000   000000 000037    ................
   3     020   000017 006000                                                    ....
     1383    13264    2   END SEND_MARKER;
     1384    13265
     1385    13266    1   END KIA$UCIN;
     1386    13267
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:239  
     1387    13268
     1388    13269        %EOD;

PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:240  
--  Include file information  --

   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI$MHDR.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$UCIN.
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:241  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
    67-0-0/w UBIN        r     1 BCNT                      11-0-0/w STRC(108)   r     1 COMIOEV
    67-0-0/w UBIN        r     1 DOMN                      70-0-0/w UBIN        r     1 EVNT
    71-0-0/w UBIN        r     1 FEI                       *0-0-0/d STRC(1404)  r     1 K$RWPARM
     5-0-0/w STRC(126)   r     1 KL_FEPST                  73-0-0/b BIT         r     1 MARKER
    *0-0-0/d STRC(864)   r     1 NK$LDCT                   14-0-0/d STRC(1404)  r     1 OPARM
    66-0-0/w PTR         r     1 P$                        70-0-0/w CHAR(4)     r     1 TSTATE
    64-0-0/h STRC        r     1 VDO                       64-0-0/h STRC        r     1 VDO1

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/w PTR         r     1 KI_FEI$$
     0-0-0/d STRC(1404)  r     1 K_RWPARM_CON

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/w STRC(576)   r     1 B$USER(0:0)
     0-0-0/w STRC(144)   r     1 KI$QMHDR                   0-0-0/h STRC(54)    r     1 KV$VDO_BLKDAT
     0-0-0/h STRC        r     1 KV$VDO_EVT                 0-0-0/w UBIN        r     1 UBNBSD


   Procedure KIA$UCIN requires 592 words for executable code.
   Procedure KIA$UCIN requires 70 words of local(AUTO) storage.
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:242  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:243  
          MINI XREF LISTING

B$DO.ECCINFO
      8300**DCL      8301--REDEF
B$U.FLG
      8166**DCL     13098>>IF      13216>>IF
B$U.MISC
      8279**DCL      8280--REDEF
B$U.MISC$
      8280**DCL     13098>>IF      13216>>IF
B$U.US
      8266**DCL     13098>>IF      13098>>IF      13216>>IF      13216>>IF
B$USER
      8324**DCL     13097--ASSIGN  13215--ASSIGN
B$USER.FLG
      8325**DCL     13068>>IF      13174>>IF
B$USER.MISC
      8355**DCL      8356--REDEF
B$USER.MISC$
      8356**DCL     13068>>IF      13174>>IF
B$USRT$
     13030**DCL     13068>>IF      13068>>IF      13097>>ASSIGN  13174>>IF      13174>>IF      13215>>ASSIGN
BCNT
     12964**DCL     12965--REDEF   13042<<ASSIGN  13043>>IF      13073<>CALL
COMIOEV
     12595**DCL     13157<<ASSIGN  13159--ASSIGN  13162--CALL    13225<<ASSIGN  13227--ASSIGN  13230--CALL
COMIOEV.ARS
     12597**DCL     12597--REDEF   13161<<ASSIGN  13229<<ASSIGN
COMIOEV.FLAGS.DELTA
     12597**DCL     13158<<ASSIGN  13226<<ASSIGN
COMIOEV.P#
     12597**DCL     13159<<ASSIGN  13159--ASSIGN  13227<<ASSIGN  13227--ASSIGN
COMIOEV.SUBC2
     12597**DCL     13160<<ASSIGN  13228<<ASSIGN
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:244  
CRASH_IT
     13230**LABEL   13192--GOTO
DOMN
     12965**DCL     13154<>CALL    13158>>IF      13162<>CALL    13210<>CALL    13226>>IF      13230<>CALL
EVNT
     12966**DCL     12967--REDEF   13046<<ASSIGN  13048<<ASSIGN  13073<>CALL    13154<>CALL    13155>>IF
     13162<>CALL    13210<>CALL    13223>>IF      13230<>CALL
FEI
     12968**DCL     13033<<ASSIGN
GETOUT
     13236**LABEL   13063--CALLALT 13071--CALLALT 13086--CALLALT 13108--CALLALT 13120--CALLALT 13135--GOTO
     13140--CALLALT
HFC$LOCK
      6908**DCL-ENT 13053--CALL    13081--CALL    13125--CALL    13172--CALL
HFC$UNLOCK
      6908**DCL-ENT 13075--CALL    13093--CALL    13133--CALL    13143--CALL    13148--CALL    13182--CALL
     13190--CALL    13197--CALL    13259--CALL
K$RWPARM
     11886**DCL         8--PROC    13091<>CALL    13108<>CALL
K$RWPARM.BLKREC
     11912**DCL     11937--REDEF
K$RWPARM.BLKREC.BLKU#
     11913**DCL     11915--REDEF
K$RWPARM.BLKREC.RECU#
     11925**DCL     11927--REDEF
K$RWPARM.DVE.DVBYTE.VFC
     11952**DCL     11953--REDEF
K$RWPARM.DVE.EOMCHAR
     11960**DCL     11964--REDEF
K$RWPARM.ERR
     12024**DCL     12029--REDEF   13201<<ASSIGN  13239<<ASSIGN  13246<<ASSIGN
K$RWPARM.FC
     11988**DCL     11989--REDEF
K$RWPARM.FEX
     12070**DCL     13236>>ASSIGN
K$RWPARM.FLDID
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:245  
     12170**DCL     12171--REDEF
K$RWPARM.FPT$
     12051**DCL     12058--REDEF
K$RWPARM.IP$
     12016**DCL     13194>>ASSIGN  13195>>ASSIGN  13199>>ASSIGN  13199>>ASSIGN
K$RWPARM.KEYTYPE
     12177**DCL     12178--REDEF
K$RWPARM.MARKER
     11937**DCL     13066>>ASSIGN  13085>>ASSIGN  13139>>ASSIGN
K$RWPARM.MRKTYP
     12162**DCL     13056>>IF      13083>>IF      13137>>IF
K$RWPARM.MSG$
     11887**DCL     11893--REDEF
K$RWPARM.MSGID
     11999**DCL     12004--REDEF
K$RWPARM.MSGIDXT
     12012**DCL     12016--REDEF
K$RWPARM.ORG
     12148**DCL     12149--REDEF
K$RWPARM.THDRSZ
     12092**DCL     12096--REDEF
K$RWPARM.UHDR$
     12037**DCL     12364--IMP-PTR 12445--IMP-PTR 12487--IMP-PTR 12532--IMP-PTR 12575--IMP-PTR 13034>>ASSIGN
     13199>>ASSIGN  13216>>IF
K$RWPARM.UHDRSZ
     12042**DCL     13199>>ASSIGN
K$RWPARM.VDOFLGS
     12150**DCL     12161--REDEF
KI$QMHDR.FEI#
     12184**DCL     13195>>ASSIGN
KI$QMHDR.FPTSZ
     12217**DCL     12218--REDEF
KI$QMHDR.MSGSZ
     12223**DCL     12224--REDEF
KI$QMHDR.OFFSET
     12211**DCL     13199--ASSIGN
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:246  
KI$QMHDR.UID
     12213**DCL     12214--REDEF
KIA$COMP
     12975**DCL-ENT 13091--CALL
KIA$DSCTS
     12977**DCL-ENT 13108--CALL
KIA$FCNO
     12973**DCL-ENT 13120--CALL    13130--CALL    13256--CALL
KIA$GETEVNT
     12978**DCL-ENT 13154--CALL    13210--CALL
KI_FEI$$
      6880**DCL      6881--IMP-PTR
KL_FEPST
     12243**DCL     13238<>CALL    13238--CALL
KL_FEPST.FCN
     12244**DCL     13237<<ASSIGN
KL_FEPST.FEP
     12246**DCL     13236<<ASSIGN
KUB$WRITE
     12979**DCL-ENT 13238--CALL
KV$VDO_BLKDAT.RSN
     12539**DCL     13216>>IF
KV$VDO_EVT
     12445**DCL     13034>>ASSIGN
K_RWPARM_CON
      7853**DCL     13117>>ASSIGN  13129>>ASSIGN  13253>>ASSIGN
K_RWPARM_CON.BLKREC
      7879**DCL      7904--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      7880**DCL      7882--REDEF
K_RWPARM_CON.BLKREC.RECU#
      7892**DCL      7894--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      7919**DCL      7920--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      7927**DCL      7931--REDEF
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:247  
K_RWPARM_CON.ERR
      7991**DCL      7996--REDEF
K_RWPARM_CON.FC
      7955**DCL      7956--REDEF
K_RWPARM_CON.FLDID
      8137**DCL      8138--REDEF
K_RWPARM_CON.FPT$
      8018**DCL      8025--REDEF
K_RWPARM_CON.KEYTYPE
      8144**DCL      8145--REDEF
K_RWPARM_CON.MSG$
      7854**DCL      7860--REDEF
K_RWPARM_CON.MSGID
      7966**DCL      7971--REDEF
K_RWPARM_CON.MSGIDXT
      7979**DCL      7983--REDEF
K_RWPARM_CON.ORG
      8115**DCL      8116--REDEF
K_RWPARM_CON.THDRSZ
      8059**DCL      8063--REDEF
K_RWPARM_CON.VDOFLGS
      8117**DCL      8128--REDEF
L1
     13046**LABEL   13040--GOTO
L4
     13178**LABEL   13104--GOTO
MARKER
     12970**DCL     13061<<ASSIGN  13066<<ASSIGN  13067>>ASSIGN  13085<<ASSIGN  13139<<ASSIGN  13254>>ASSIGN
NK$LDCT
     11832**DCL         8--PROC    13068--IF      13091<>CALL    13098--IF      13108<>CALL    13120<>CALL
     13130<>CALL    13154<>CALL    13174--IF      13210<>CALL    13216--IF      13256<>CALL
NK$LDCT.DDT$
     11834**DCL     11834--REDEF
NK$LDCT.IOQ$
     11833**DCL     11834--REDEF
NK$LDCT.IP$
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:248  
     11854**DCL     13187>>IF      13194<<ASSIGN
NK$LDCT.IPFEI#
     11855**DCL     13033>>ASSIGN  13195<<ASSIGN
NK$LDCT.LDCTX
     11835**DCL     11835--REDEF
NK$LDCT.LKFLG.ABORTED
     11847**DCL     11848--REDEF
NK$LDCT.LKFLG.MRKPND
     11847**DCL     13059>>IF      13062<<ASSIGN  13070<<ASSIGN
NK$LDCT.LKFLG.NOWAIT
     11853**DCL     13089>>IF
NK$LDCT.LKFLG.WTMRK
     11848**DCL     13178>>IF      13180<<ASSIGN
NK$LDCT.LOCK
     11860**DCL     13053<>CALL    13075<>CALL    13081<>CALL    13093<>CALL    13125<>CALL    13133<>CALL
     13143<>CALL    13148<>CALL    13172<>CALL    13182<>CALL    13190<>CALL    13197<>CALL    13259<>CALL
NK$LDCT.MARKER
     11834**DCL     13061>>ASSIGN  13067<<ASSIGN
NK$LDCT.RLCID.LDCTX
     11857**DCL     11857--REDEF
NK$LDCT.STA$
     11853**DCL     11854--REDEF
NK$LDCT.SYMB$
     11832**DCL     11832--REDEF   11832--REDEF   11833--REDEF
NK$LDCT.TH.MAXNMBBYT
     11859**DCL     13127>>IF      13165>>IF
NK$LDCT.TH.MAXNMBRCR
     11858**DCL     13127>>IF      13165>>IF
NK$LDCT.USER
     11842**DCL     13068>>IF      13068>>IF      13073<>CALL    13097>>ASSIGN  13103<>CALL    13116<>CALL
     13156<>CALL    13162<>CALL    13167<>CALL    13174>>IF      13174>>IF      13177<>CALL    13215>>ASSIGN
     13224<>CALL    13230<>CALL
OPARM
     12621**DCL     13117<<ASSIGN  13120<>CALL    13129<<ASSIGN  13130<>CALL    13253<<ASSIGN  13256<>CALL
OPARM.BLKREC
     12647**DCL     12672--REDEF
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:249  
OPARM.BLKREC.BLKU#
     12648**DCL     12650--REDEF
OPARM.BLKREC.RECU#
     12660**DCL     12662--REDEF
OPARM.DVE.DVBYTE.VFC
     12687**DCL     12688--REDEF
OPARM.DVE.EOMCHAR
     12695**DCL     12699--REDEF
OPARM.ERR
     12759**DCL     12764--REDEF
OPARM.FC
     12723**DCL     12724--REDEF
OPARM.FLDID
     12905**DCL     12906--REDEF
OPARM.FPT$
     12786**DCL     12793--REDEF
OPARM.KEYTYPE
     12912**DCL     12913--REDEF
OPARM.MARKER
     12672**DCL     13254<<ASSIGN
OPARM.MRKTYP
     12897**DCL     13255<<ASSIGN
OPARM.MSG$
     12622**DCL     12628--REDEF   13118<<ASSIGN
OPARM.MSGID
     12734**DCL     12739--REDEF
OPARM.MSGIDXT
     12747**DCL     12751--REDEF
OPARM.MSGSZ
     12629**DCL     13119<<ASSIGN
OPARM.ORG
     12883**DCL     12884--REDEF
OPARM.THDRSZ
     12827**DCL     12831--REDEF
OPARM.VDOFLGS
     12885**DCL     12896--REDEF
PL6.E3A0      #002=KIA$UCIN File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:32 Page:250  
P$
     12963**DCL     13097<<ASSIGN  13098>>IF      13098>>IF      13098>>IF      13098>>IF      13215<<ASSIGN
     13216>>IF      13216>>IF      13216>>IF      13216>>IF
SEND_MARKER
     13252**PROC    13063--CALL    13071--CALL    13086--CALL    13140--CALL
SSC$TSTATE
     12971**DCL-ENT 13116--CALL
SSR$RUE
     12974**DCL-ENT 13073--CALL    13103--CALL    13156--CALL    13167--CALL    13177--CALL    13224--CALL
SSV$EVENT
     12972**DCL-ENT 13162--CALL    13230--CALL
TSTATE
     12967**DCL     13116<>CALL    13118--ASSIGN  13119--ASSIGN
UBNBSD
     12961**DCL     13199<<ASSIGN
VDO
     12949**DCL     12958--REDEF   13034<<ASSIGN
VDO.BRKCNT
     12956**DCL     13042>>ASSIGN
VDO.FNC
     12953**DCL     13036>>DOCASE  13089>>IF
VDO.STR
     12953**DCL     13152>>IF      13152>>IF      13209>>IF
VDO.TYP
     12956**DCL     13039>>IF
VDO1.RCRBYTSIZ
     12960**DCL     13161>>ASSIGN  13161>>ASSIGN  13229>>ASSIGN  13229>>ASSIGN

PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:251  
     1389        1        /*T***********************************************************/
     1390        2        /*T*                                                         */
     1391        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1392        4        /*T*                                                         */
     1393        5        /*T***********************************************************/
     1394        6
     1395        7
     1396        8        KIA$DSCTS: PROC (NK$LDCT,K$RWPARM) ALTRET;
     1397        9
     1398       10        /*F*
     1399       11             NAME: KIA$DSCTS
     1400       12             PURPOSE:
     1401       13                  To report disconnect events for TS users.
     1402       14             DESCRIPTION:
     1403       15                  On receipt of an disconnect from the front end, KIA$DSCTS will
     1404       16                  set the LDCT to show a disconnect was received and report a
     1405       17                  disconnect event if it has not already been reported.
     1406       18        */
     1407       19
     1408       20        %INCLUDE B$USER;
     1409      236        %INCLUDE B_ERRORS_C;
     1410     1363        %INCLUDE B_STRINGS_C;
     1411     1492        %INCLUDE CP_6;
     1412     7051        %INCLUDE CP_6_SUBS;
     1413     7591        %INCLUDE SS_SCHED_C;
     1414     7824        %INCLUDE HF_LOCK_C;
     1415     7838        %INCLUDE NK$LDCT;
     1416     7940        %INCLUDE KI_DATA_R;
     1417     7966        %INCLUDE K_DATA_R;
     1418     8677        %INCLUDE NK_SUBS;
     1419     8702        %INCLUDE NK_VFC_C;
     1420     8776
     1421     8777        %NK$LDCT (STCLASS="");
     1422     8823        %K$RWPARM (NAME=K$RWPARM);
     1423     9139
     1424     9140    1   DCL TOLD BIT(36) ALIGNED;
     1425     9141        %VLP_ERRCODE (FPTN=ERR_DISC,FCG=KI,MID=A,MON='1'B,ERR#=%E$LDSC,SEV=7,STCLASS=
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:252  
              9141            CONSTANT);
     1426     9186    1   DCL SSR$RUE ENTRY(4);
     1427     9187    1   DCL KIA$COMP ENTRY(2);
     1428     9188
     1429     9189                %LOCK (G#=NK$LDCT.LOCK);
     1430     9192    2        DO WHILE (NK$LDCT.LKFLG.NOWAIT);   /* Kill any no wait reads */
     1431     9193    2             K$RWPARM.TYC = %TYC_DISC;
     1432     9194    2             K$RWPARM.MSG_ERRCODE = ERR_DISC;
     1433     9195    2             CALL KIA$COMP(NK$LDCT,K$RWPARM);
     1434     9196    2           END;
     1435     9197    1        TOLD=LDCT.DFLG.OLDSC;
     1436     9198    1        LDCT.DFLG.OLDSC='1'B;
     1437     9199             %UNLOCK (G#=NK$LDCT.LOCK);
     1438     9202    1        IF TOLD='0'B AND NK$LDCT.DEVNM = '*TSTERM*'
     1439     9203    2        THEN DO;
     1440     9204    2             CALL SSR$RUE (%SS_DISC,LDCT.USER);
     1441     9205    2           END;
     1442     9206    1        RETURN;
     1443     9207
     1444     9208    1   END KIA$DSCTS;
     1445     9209
     1446     9210
     1447     9211        %EOD;

PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:253  
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$DSCTS.

   Procedure KIA$DSCTS requires 54 words for executable code.
   Procedure KIA$DSCTS requires 8 words of local(AUTO) storage.

PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:254  

 Object Unit name= KIA$DSCTS                                  File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:33:56.36 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS      4      4  KIA$DSCTS
    2   Proc  even  none    54     66  KIA$DSCTS
    3  RoData even  none     3      3  KIA$DSCTS

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        2  KIA$DSCTS

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       2 KIA$COMP
         yes           Std       1 HFC$UNLOCK
         yes           Std       4 SSR$RUE
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:255  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  KI_FEI$$                              B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:256  


     1389        1        /*T***********************************************************/
     1390        2        /*T*                                                         */
     1391        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1392        4        /*T*                                                         */
     1393        5        /*T***********************************************************/
     1394        6
     1395        7
     1396        8        KIA$DSCTS: PROC (NK$LDCT,K$RWPARM) ALTRET;

      8  2 000000   000000 700200 xent  KIA$DSCTS    TSX0  ! X66_AUTO_2
         2 000001   000010 000002                    ZERO    8,2

     1397        9
     1398       10        /*F*
     1399       11             NAME: KIA$DSCTS
     1400       12             PURPOSE:
     1401       13                  To report disconnect events for TS users.
     1402       14             DESCRIPTION:
     1403       15                  On receipt of an disconnect from the front end, KIA$DSCTS will
     1404       16                  set the LDCT to show a disconnect was received and report a
     1405       17                  disconnect event if it has not already been reported.
     1406       18        */
     1407       19
     1408       20        %INCLUDE B$USER;
     1409      236        %INCLUDE B_ERRORS_C;
     1410     1363        %INCLUDE B_STRINGS_C;
     1411     1492        %INCLUDE CP_6;
     1412     7051        %INCLUDE CP_6_SUBS;
     1413     7591        %INCLUDE SS_SCHED_C;
     1414     7824        %INCLUDE HF_LOCK_C;
     1415     7838        %INCLUDE NK$LDCT;
     1416     7940        %INCLUDE KI_DATA_R;
     1417     7966        %INCLUDE K_DATA_R;
     1418     8677        %INCLUDE NK_SUBS;
     1419     8702        %INCLUDE NK_VFC_C;
     1420     8776
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:257  
     1421     8777        %NK$LDCT (STCLASS="");
     1422     8823        %K$RWPARM (NAME=K$RWPARM);
     1423     9139
     1424     9140    1   DCL TOLD BIT(36) ALIGNED;
     1425     9141        %VLP_ERRCODE (FPTN=ERR_DISC,FCG=KI,MID=A,MON='1'B,ERR#=%E$LDSC,SEV=7,STCLASS=
              9141            CONSTANT);
     1426     9186    1   DCL SSR$RUE ENTRY(4);
     1427     9187    1   DCL KIA$COMP ENTRY(2);
     1428     9188
     1429     9189                %LOCK (G#=NK$LDCT.LOCK);

   9190  2 000002   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000003   000020 036003                    ADLQ    16,DU
         2 000004   200006 756100                    STQ     TOLD+1,,AUTO
         2 000005   200006 630500                    EPPR0   TOLD+1,,AUTO
         2 000006   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000007   000000 701000 xent               TSX1    HFC$LOCK
         2 000010   000000 011000                    NOP     0

     1430     9192    2        DO WHILE (NK$LDCT.LKFLG.NOWAIT);   /* Kill any no wait reads */

   9192  2 000011   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000012   000011 236100                    LDQ     9,,PR0
         2 000013   000001 316003                    CANQ    1,DU
         2 000014   000032 600000 2                  TZE     s:9197

     1431     9193    2             K$RWPARM.TYC = %TYC_DISC;

   9193  2 000015   000001 236000 1                  LDQ     ERR_DISC+1
         2 000016   200004 470500                    LDP0    @K$RWPARM,,AUTO
         2 000017   000006 756100                    STQ     6,,PR0

     1432     9194    2             K$RWPARM.MSG_ERRCODE = ERR_DISC;

   9194  2 000020   000000 236000 1                  LDQ     ERR_DISC
         2 000021   000037 756100                    STQ     31,,PR0

PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:258  
     1433     9195    2             CALL KIA$COMP(NK$LDCT,K$RWPARM);

   9195  2 000022   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         2 000023   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000024   000000 701000 xent               TSX1    KIA$COMP
         2 000025   000000 011000                    NOP     0

     1434     9196    2           END;

   9196  2 000026   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000027   000011 236100                    LDQ     9,,PR0
         2 000030   000001 316003                    CANQ    1,DU
         2 000031   000015 601000 2                  TNZ     s:9193

     1435     9197    1        TOLD=LDCT.DFLG.OLDSC;

   9197  2 000032   000006 236100                    LDQ     6,,PR0
         2 000033   000027 736000                    QLS     23
         2 000034   400000 376003                    ANQ     -131072,DU
         2 000035   200005 756100                    STQ     TOLD,,AUTO

     1436     9198    1        LDCT.DFLG.OLDSC='1'B;

   9198  2 000036   010000 236007                    LDQ     4096,DL
         2 000037   000006 256100                    ORSQ    6,,PR0

     1437     9199             %UNLOCK (G#=NK$LDCT.LOCK);

   9200  2 000040   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000041   000020 036003                    ADLQ    16,DU
         2 000042   200006 756100                    STQ     TOLD+1,,AUTO
         2 000043   200006 630500                    EPPR0   TOLD+1,,AUTO
         2 000044   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000045   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000046   000000 011000                    NOP     0

     1438     9202    1        IF TOLD='0'B AND NK$LDCT.DEVNM = '*TSTERM*'
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:259  

   9202  2 000047   200005 235100                    LDA     TOLD,,AUTO
         2 000050   000065 601000 2                  TNZ     s:9206
         2 000051   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000052   000002 237100                    LDAQ    2,,PR0
         2 000053   000002 117000 1                  CMPAQ   ERR_DISC+2
         2 000054   000065 601000 2                  TNZ     s:9206

     1439     9203    2        THEN DO;

     1440     9204    2             CALL SSR$RUE (%SS_DISC,LDCT.USER);

   9204  2 000055   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000056   000001 036000 3                  ADLQ    1
         2 000057   000002 235000 3                  LDA     2
         2 000060   200006 757100                    STAQ    TOLD+1,,AUTO
         2 000061   200006 630500                    EPPR0   TOLD+1,,AUTO
         2 000062   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000063   000000 701000 xent               TSX1    SSR$RUE
         2 000064   000000 011000                    NOP     0

     1441     9205    2           END;

     1442     9206    1        RETURN;

   9206  2 000065   000000 702200 xent               TSX2  ! X66_ARET

ERR_DISC
 Sect OctLoc
   1     000   131101 400147                                                    YA.g

(unnamed)
 Sect OctLoc
   1     001   000040 000000   052124 123124   105122 115052                    . ..*TSTERM*

(unnamed)
 Sect OctLoc
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:260  
   3     000   000000 000024   000007 200000   000000 006000                    ............
     1443     9207
     1444     9208    1   END KIA$DSCTS;
     1445     9209
     1446     9210
     1447     9211        %EOD;

PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:261  
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$DSCTS.
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:262  

 **** Variables and constants ****

  ****  Section 001 RoData KIA$DSCTS

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 ERR_DISC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                  *0-0-0/d STRC(864)   r     1 NK$LDCT
     5-0-0/w BIT         r     1 TOLD

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KI_FEI$$


   Procedure KIA$DSCTS requires 54 words for executable code.
   Procedure KIA$DSCTS requires 8 words of local(AUTO) storage.
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:263  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:264  
          MINI XREF LISTING

B$DO.ECCINFO
       171**DCL       172--REDEF
B$U.MISC
       150**DCL       151--REDEF
B$USER.MISC
       226**DCL       227--REDEF
ERR_DISC
      9153**DCL      9194>>ASSIGN
HFC$LOCK
      7837**DCL-ENT  9190--CALL
HFC$UNLOCK
      7837**DCL-ENT  9200--CALL
K$RWPARM
      8844**DCL         8--PROC     9195<>CALL
K$RWPARM.BLKREC
      8870**DCL      8895--REDEF
K$RWPARM.BLKREC.BLKU#
      8871**DCL      8873--REDEF
K$RWPARM.BLKREC.RECU#
      8883**DCL      8885--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      8910**DCL      8911--REDEF
K$RWPARM.DVE.EOMCHAR
      8918**DCL      8922--REDEF
K$RWPARM.ERR
      8982**DCL      8987--REDEF
K$RWPARM.FC
      8946**DCL      8947--REDEF
K$RWPARM.FLDID
      9128**DCL      9129--REDEF
K$RWPARM.FPT$
      9009**DCL      9016--REDEF
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:265  
K$RWPARM.KEYTYPE
      9135**DCL      9136--REDEF
K$RWPARM.MSG$
      8845**DCL      8851--REDEF
K$RWPARM.MSGID
      8957**DCL      8962--REDEF
K$RWPARM.MSGIDXT
      8970**DCL      8974--REDEF
K$RWPARM.MSG_ERRCODE
      9105**DCL      9194<<ASSIGN
K$RWPARM.ORG
      9106**DCL      9107--REDEF
K$RWPARM.THDRSZ
      9050**DCL      9054--REDEF
K$RWPARM.TYC
      8866**DCL      9193<<ASSIGN
K$RWPARM.VDOFLGS
      9108**DCL      9119--REDEF
KIA$COMP
      9187**DCL-ENT  9195--CALL
KI_FEI$$
      7951**DCL      7952--IMP-PTR
K_RWPARM_CON.BLKREC
      8407**DCL      8432--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      8408**DCL      8410--REDEF
K_RWPARM_CON.BLKREC.RECU#
      8420**DCL      8422--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      8447**DCL      8448--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      8455**DCL      8459--REDEF
K_RWPARM_CON.ERR
      8519**DCL      8524--REDEF
K_RWPARM_CON.FC
      8483**DCL      8484--REDEF
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:266  
K_RWPARM_CON.FLDID
      8665**DCL      8666--REDEF
K_RWPARM_CON.FPT$
      8546**DCL      8553--REDEF
K_RWPARM_CON.KEYTYPE
      8672**DCL      8673--REDEF
K_RWPARM_CON.MSG$
      8382**DCL      8388--REDEF
K_RWPARM_CON.MSGID
      8494**DCL      8499--REDEF
K_RWPARM_CON.MSGIDXT
      8507**DCL      8511--REDEF
K_RWPARM_CON.ORG
      8643**DCL      8644--REDEF
K_RWPARM_CON.THDRSZ
      8587**DCL      8591--REDEF
K_RWPARM_CON.VDOFLGS
      8645**DCL      8656--REDEF
NK$LDCT
      8790**DCL         8--PROC     9195<>CALL
NK$LDCT.DDT$
      8792**DCL      8792--REDEF
NK$LDCT.DEVNM
      8792**DCL      9202>>IF
NK$LDCT.DFLG.OLDSC
      8795**DCL      9197>>ASSIGN   9198<<ASSIGN
NK$LDCT.IOQ$
      8791**DCL      8792--REDEF
NK$LDCT.LDCTX
      8793**DCL      8793--REDEF
NK$LDCT.LKFLG.ABORTED
      8805**DCL      8806--REDEF
NK$LDCT.LKFLG.NOWAIT
      8811**DCL      9192>>DOWHILE
NK$LDCT.LOCK
      8818**DCL      9190<>CALL     9200<>CALL
PL6.E3A0      #003=KIA$DSCTS File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:33 Page:267  
NK$LDCT.RLCID.LDCTX
      8815**DCL      8815--REDEF
NK$LDCT.STA$
      8811**DCL      8812--REDEF
NK$LDCT.SYMB$
      8790**DCL      8790--REDEF    8790--REDEF    8791--REDEF
NK$LDCT.USER
      8800**DCL      9204<>CALL
SSR$RUE
      9186**DCL-ENT  9204--CALL
TOLD
      9140**DCL      9197<<ASSIGN   9202>>IF

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:268  
     1448        1        /*T***********************************************************/
     1449        2        /*T*                                                         */
     1450        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1451        4        /*T*                                                         */
     1452        5        /*T***********************************************************/
     1453        6        /*X* DTI=2,DCI=4,THI=2,CSI=2,ECI=2,STI=2,IND=2,ENI=2 */
     1454        7
     1455        8
     1456        9        KIA$ISCAN: PROC (NK$LDCT,K$RWPARM) ALTRET;
     1457       10
     1458       11        /*F*
     1459       12             NAME: KIA$ISCAN
     1460       13             PURPOSE:
     1461       14                  KIA$ISCAN does the initial scanning for all messages from the
     1462       15                  front end.
     1463       16             DESCRIPTION:
     1464       17                  Messages received from the front end are initially scanned
     1465       18                  here to determine what function needs to be performed.
     1466       19                  KIA$ISCAN performs all functions that are common to all front
     1467       20                  end connected devices. If the messages needs to be handles
     1468       21                  further the resource code in the LDCT determines what routine
     1469       22                  to be called for further processing.
     1470       23        */
     1471       24
     1472       25        %PLIST;
     1473       26        %INCLUDE B$USER;
     1474      242        %INCLUDE KV$VDO;
     1475     1257        %INCLUDE HF_LOCK_C;
     1476     1271        %INCLUDE NK$LDCT;
     1477     1373        %INCLUDE NK_LDCT_R;
     1478     1382        %INCLUDE KI_DATA_R;
     1479     1408        %INCLUDE KC_SUBS_C;
     1480     1424        %INCLUDE NK_SUBS;
     1481     1449        %INCLUDE SS_SCHED_C;
     1482     1682        %INCLUDE KL_AFCN_C;
     1483     1783        %INCLUDE KL_SUBS_C;
     1484     1837        %INCLUDE K_DATA_R;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:269  
     1485     2548        %INCLUDE K_SUBS_C;
     1486     2581        %INCLUDE KI_ERRORS_C;
     1487     2666        %INCLUDE UM_CP6;
     1488     3518        %INCLUDE KL_MACRO_C;
     1489     6870
     1490     6871        %NK$LDCT (STCLASS="");
     1491     6917        %K$RWPARM (NAME=K$RWPARM);
     1492     7233        %K$RWPARM (NAME=OPARM);
     1493     7549        %KL_FEPST(STCLASS="");
     1494     7584        %KV_VDO_ALL_E;
     1495     7663        %KV$VDO (STCLASS="BASED(K$RWPARM.UHDR$)");
     1496     7690        %KV$VDO_PRM (STCLASS="BASED(K$RWPARM.UHDR$)");
     1497     7731        %KV$VDO_RQSDAT (STCLASS="BASED(K$RWPARM.UHDR$)",NAME=VDO);
     1498     7779        %KV$VDO_RQSDAT (STCLASS=AUTO);
     1499     7827        %KV$VDO_DSC (STCLASS="BASED(K$RWPARM.UHDR$)");
     1500     7869
     1501     7870    1   DCL KIA_NODAT BIT(36) SYMREF ALIGNED;
     1502     7871        %VLP_ERRCODE (FPTN=ERR_TERM,FCG=KI,MID=A,MON='1'B,ERR#=%E$TERM,SEV=7,STCLASS=
              7871            CONSTANT);
     1503     7916
     1504     7917    1   DCL MSIZC SBIN WORD;
     1505     7918    1   DCL 1 MZC REDEF MSIZC,
     1506     7919    1         2 TOP UBIN(28) UNAL,
     1507     7920    1         2 BOT UBIN(8) UNAL;
     1508     7921    1   DCL MSIZW UBIN(36);
     1509     7922    1   DCL FPA$ODIN ENTRY(2) ALTRET;
     1510     7923    1   DCL FPA$ODDN ENTRY(1) ALTRET;
     1511     7924    1   DCL FRF$DISC ENTRY(1) ALTRET;
     1512     7925    1   DCL FRF$IN ENTRY(2) ALTRET;
     1513     7926    1   DCL KIA$DSC ENTRY(3) ALTRET;
     1514     7927    1   DCL KIA$FCNO ENTRY(3) ALTRET;
     1515     7928    1   DCL KIA$UCIN ENTRY(2) ALTRET;
     1516     7929    1   DCL KIA$FPRGIN ENTRY(2) ALTRET;
     1517     7930    1   DCL KCF$FEIN ENTRY(2) ALTRET;
     1518     7931    1   DCL KCF$QNF ENTRY(1);
     1519     7932    1   DCL SSR$RUE ENTRY(4);
     1520     7933    1   DCL KQP$EVNT ENTRY(2) ALTRET;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:270  
     1521     7934    1   DCL KCF$NOCG ENTRY(2) ALTRET;
     1522     7935    1   DCL MMS$VREL ENTRY(2) ALTRET;
     1523     7936    1   DCL KIA$ACUP ENTRY(2) ALTRET;
     1524     7937    1   DCL KIA$MSG ENTRY(1) ALTRET;
     1525     7938    1   DCL NKL$RELDCTP ENTRY(1) ALTRET;
     1526     7939    1   DCL SC_BADRCD ENTRY CONV(2,0);
     1527     7940    1   DCL KCD$DSCTRM ENTRY(2);
     1528     7941    1   DCL KCF$RLNCG ENTRY(1);
     1529     7942    1   DCL KIA$DSCTS ENTRY(2) ALTRET;
     1530     7943    1   DCL KIS$SEND ENTRY(1) ALTRET;
     1531     7944    1   DCL NKL$RELDCT ENTRY(1) ALTRET;
     1532     7945
     1533     7946    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1534     7947    1   DCL SC_BDRCDI ENTRY CONV(2,0);
     1535     7948    1   DCL B$USRT$ PTR SYMREF;
     1536     7949
     1537     7950
     1538     7951    1   DCL 1 SPREAD BASED UNAL ,
     1539     7952    1         2 * BIT(1) UNAL,
     1540     7953    1         2 HI8 UBIN(8) UNAL ,
     1541     7954    1         2 * BIT(1) UNAL ,
     1542     7955    1         2 LO8 UBIN(8) UNAL ;
     1543     7956    1   DCL TP$ PTR;
     1544     7957        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:271  
     1545     7958    1           IF NK$LDCT.LKFLG.NOWAIT
     1546     7959    1             THEN K$RWPARM.KEYTYPE = NK$LDCT.NOWAIT.KEYTYP;
     1547     7960    1           CALL KIA$MSG (K$RWPARM)
     1548     7961    2             WHENALTRETURN DO;
     1549     7962    2               KL_FEPST.FEP = K$RWPARM.FEX;
     1550     7963    2               KL_FEPST.FCN = IGA_CRASHFEP_BF; /*request GJA-166-3 dump from fep*/
     1551     7964    3               CALL KUB$WRITE (KL_FEPST,LENGTHC(KL_FEPST),'HLPADMIN') WHENALTRETURN DO;
     1552     7965    3                   CALL SC_BDRCDI;
     1553     7966    3                   END;
     1554     7967    2               K$RWPARM.ERR = %K$WAIT_READ;
     1555     7968    2               ALTRETURN;
     1556     7969        /*N*
     1557     7970                  CALL KIA$TERM(NK$LDCT) ALTRET(GETOUT);
     1558     7971         */
     1559     7972    2               END;
     1560     7973    2           DO CASE (KV$VDO.FNC);
     1561     7974
     1562     7975        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:272  
     1563     7976    2             CASE(%KV_VDO_FNC_RQSMRK);
     1564     7977    2               CALL KIA$FCNO (NK$LDCT,%KV_VDO_FNC_MRK,K$RWPARM) ALTRET (GETOUT);
     1565     7978
     1566     7979        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:273  
     1567     7980    2             CASE(%KV_VDO_FNC_RQSDAT);
     1568     7981    2               KV$VDO_RQSDAT = VDO ;
     1569     7982
     1570     7983                    %LOCK(G=NK$LDCT.LOCK);
     1571     7986
     1572     7987        /* IF EOF_NONE BIT SET SEND ERROR NODAT */
     1573     7988    2               IF KV$VDO_RQSDAT.EOFNO_DAT AND NOT NK$LDCT.LKFLG.OBLK
     1574     7989    3                 THEN DO;
     1575     7990    3                   K$RWPARM.MSG_ERRCODE = KIA_NODAT;
     1576     7991    4                   CALL KIA$FCNO (NK$LDCT,%KV_VDO_FNC_DAT,K$RWPARM) WHENALTRETURN DO;
     1577     7992                            %UNLOCK (G=NK$LDCT.LOCK);
     1578     7995    4                       GOTO GETOUT;
     1579     7996    4                       END;
     1580     7997    3                   END;
     1581     7998    3                 ELSE DO;
     1582     7999    3                   IF KV$VDO_RQSDAT.STR ~= LDCT.TH.STR
     1583     8000    3                     THEN
     1584     8001    3                       LDCT.TH = '0'B;
     1585     8002    3                   NK$LDCT.TH.STR = KV$VDO_RQSDAT.STR;
     1586     8003
     1587     8004                       /* If we are blocked and this is an increment throw it away    */
     1588     8005    3                   TP$ = ADDR(KV$VDO_RQSDAT.MAXNMBBYT);
     1589     8006    3                   IF KV$VDO_RQSDAT.INCMAXNMBBYT THEN
     1590     8007    3                       IF LDCT.LKFLG.OBLK
     1591     8008    4                         THEN DO;
     1592     8009                                %UNLOCK (G=LDCT.LOCK);
     1593     8012    4                           RETURN;
     1594     8013    4                           END;
     1595     8014        /* Check to see if we are incrementing throttling */
     1596     8015    3                         ELSE
     1597     8016    3                           LDCT.TH.MAXNMBBYT = LDCT.TH.MAXNMBBYT + TP$->SPREAD.HI8*256
              8016                                    + TP$->SPREAD.LO8;
     1598     8017    3                     ELSE
     1599     8018    3                       LDCT.TH.MAXNMBBYT = TP$->SPREAD.HI8*256 + TP$->SPREAD.LO8;
     1600     8019        /* Check to see if we are incrementing throttling */
     1601     8020    3                   TP$ = ADDR(KV$VDO_RQSDAT.MAXNMBRCR);
     1602     8021    3                   IF KV$VDO_RQSDAT.INCMAXNMBRCR
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:274  
     1603     8022    3                     THEN
     1604     8023    3                       LDCT.TH.MAXNMBRCR = LDCT.TH.MAXNMBRCR + TP$->SPREAD.HI8*256 +
              8023                                TP$->SPREAD.LO8;
     1605     8024    3                     ELSE
     1606     8025    3                       LDCT.TH.MAXNMBRCR = TP$->SPREAD.HI8*256 + TP$->SPREAD.LO8;
     1607     8026    3                   TP$ = ADDR(KV$VDO_RQSDAT.MAXRCRBYTSIZ);
     1608     8027    3                   LDCT.TH.MAXRCRBYTSIZ = TP$->SPREAD.HI8*256 + TP$->SPREAD.LO8;
     1609     8028    3                   IF LDCT.LKFLG.OBLK      /* User is blocked for output         */
     1610     8029    3                     THEN
     1611     8030    3                       IF LDCT.TH.MAXNMBBYT ~= 0 AND LDCT.TH.MAXNMBRCR ~= 0
     1612     8031    4                         THEN DO;
     1613     8032    4                           LDCT.LKFLG.OBLK = '0'B;
     1614     8033                                %UNLOCK (G=NK$LDCT.LOCK);
     1615     8036    4                           GOTO CALLOUT;
     1616     8037    4                           END;
     1617     8038    3                         ELSE
     1618     8039    3                           GOTO L1 ;
     1619     8040    3                   IF LDCT.TH.MAXNMBBYT = 0 OR LDCT.TH.MAXNMBRCR = 0
     1620     8041    4                     THEN DO;
     1621     8042    4   L1:
     1622     8043                            %UNLOCK(G=NK$LDCT.LOCK);
     1623     8046    4                       GOTO CALLOUT;
     1624     8047    4                       END;
     1625     8048    3                   END;
     1626     8049                    %UNLOCK (G=NK$LDCT.LOCK);
     1627     8052
     1628     8053        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:275  
     1629     8054    2             CASE (%KV_VDO_FNC_DSC_RQS);
     1630     8055    2               IF NK$LDCT.ACCTNG THEN
     1631     8056    2                   CALL KIA$ACUP (NK$LDCT,K$RWPARM) ALTRET (GETOUT);
     1632     8057    2               IF NOT NK$LDCT.DFLG.SYMBIONT
     1633     8058    2                 THEN
     1634     8059    2                   NK$LDCT.ERR = K$RWPARM.MSG_ERRCODE;
     1635     8060    2               GOTO CALLOUT;
     1636     8061
     1637     8062        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:276  
     1638     8063        /*        CASE (%KV_VDO_FNC_DAT,%KV_VDO_FNC_PRM_RSP);
     1639     8064                    GOTO CALLOUT; */            /* CALLOUT IS CASE (ELSE)             */
     1640     8065
     1641     8066        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:277  
     1642     8067    2             CASE(ELSE);
     1643     8068        /* The message must be handled further. Call the appropiate routine
     1644     8069        determined by the resource code.
     1645     8070         */
     1646     8071    2   CALLOUT:    IF NK$LDCT.DFLG.RLSE='0'B
     1647     8072    3                 THEN DO;
     1648     8073    4                   DO CASE (NK$LDCT.RESCOD);
     1649     8074    4                     CASE(NK_TSTRM);
     1650     8075    4                       CALL KIA$UCIN (NK$LDCT,K$RWPARM) ALTRET (ARET);
     1651     8076    4                     CASE(NK_CGTRM);
     1652     8077    4                       CALL KCF$FEIN (NK$LDCT,K$RWPARM) ALTRET (ARET);
     1653     8078    4                     CASE(NK_NOCG,NK_TRMPTH);
     1654     8079    4                       CALL KCF$NOCG (NK$LDCT,K$RWPARM) ALTRET (ARET);
     1655     8080    4                     CASE (NK_TSFPRG,NK_CGFPRG);
     1656     8081    4                       CALL KIA$FPRGIN (NK$LDCT,K$RWPARM) ALTRET (ARET);
     1657     8082    4                     CASE (NK_RES);
     1658     8083    4                       CALL FRF$IN(NK$LDCT,K$RWPARM) ALTRET (ARET);
     1659     8084    4                     CASE (NK_OPCTL);
     1660     8085    4                       CALL FPA$ODIN (NK$LDCT,K$RWPARM) ALTRET (ARET);
     1661     8086    4                     CASE(ELSE);
     1662     8087    4                       CALL SC_BDRCDI;
     1663     8088        /*S*  SCREECH_CODE:  KIN-S$BADRCD
     1664     8089              TYPE:          Screech
     1665     8090              MESSAGE:       Bad resource code in remote LDCT (at message input)
     1666     8091              REMARKS:       This screech occurs when the LDCT for a remote
     1667     8092                             device has an impossible RESCOD for remote devices.
     1668     8093                             Either we have dual LDCT allocation or the LDCT has
     1669     8094                             been clobbered.  This code is also reported by
     1670     8095                             KIQ$FEINIT (KIS-S$BADRCD) when this condition is
     1671     8096                             discovered on an FEP crash.                             */
     1672     8097    4                     END;
     1673     8098    3                   END;
     1674     8099    2             END;
     1675     8100    1           RETURN;
     1676     8101        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:278  
     1677     8102        /* GETOUT will set the error telling the lower layers that the message
     1678     8103           can not be handled right now. KIS$SEND will call back at a later
     1679     8104           time with the same message.
     1680     8105         */
     1681     8106    1   GETOUT: ;
     1682     8107    1           K$RWPARM.ERR = %K$DEFER_IO;
     1683     8108    1   ARET:   ;
     1684     8109    1           ALTRETURN;
     1685     8110
     1686     8111
     1687     8112
     1688     8113
     1689     8114    1   KIA$TERM: ENTRY (NK$LDCT) ALTRET;
     1690     8115
     1691     8116
     1692     8117    1           IF NOT NK$LDCT.DFLG.SYMBIONT
     1693     8118    1             THEN
     1694     8119    1               NK$LDCT.ERR = ERR_TERM;
     1695     8120             /*E* ERROR: KIA-%E$TERM-7
     1696     8121                  MESSAGE: Your connection %thru %DC %has been terminated.
     1697     8122                  MESSAGE1: The session connection has been terminated.
     1698     8123                   */
     1699     8124    1           CALL KIA$ACUP(NK$LDCT)
     1700     8125    2             WHENALTRETURN DO;
     1701     8126    2               ALTRETURN;
     1702     8127    2               END;
     1703     8128    1           OPARM = K_RWPARM_CON;
     1704     8129    1           IF NOT NK$LDCT.DFLG.FEDN
     1705     8130    1             THEN
     1706     8131    1               CALL KIA$DSC (NK$LDCT,%KV_VDO_FNC_DSC_RSP,OPARM)
     1707     8132    2                 WHENALTRETURN DO;
     1708     8133    2                   IF OPARM.ERR = %K$QFULL
     1709     8134    2                     THEN
     1710     8135    2                       ALTRETURN;
     1711     8136    2                   END;
     1712     8137    1           IF B$USRT$->B$USER.FLG(NK$LDCT.USER) & %U_SCIO
     1713     8138    1             AND B$USRT$->B$USER.MISC$(NK$LDCT.USER) = ADDR(NK$LDCT)
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:279  
     1714     8139    1             THEN
     1715     8140    1               CALL SSR$RUE (%SS_FC,NK$LDCT.USER);
     1716     8141    2           DO INHIBIT;
     1717     8142    2             NK$LDCT.DFLG.FEDN='1'B;
     1718     8143    2             NK$LDCT.DFLG.PRLS='1'B;
     1719     8144    2             END;
     1720     8145    1           IF NK$LDCT.DFLG.RLSE
     1721     8146    1             THEN
     1722     8147    1               CALL NKL$RELDCT (ADDR(NK$LDCT));
     1723     8148    1             ELSE IF NOT NK$LDCT.QFL.RLS
     1724     8149    2                 THEN DO CASE (NK$LDCT.RESCOD);
     1725     8150    2                   CASE(NK_TSTRM,NK_TSFPRG);
     1726     8151    2                     CALL KIA$DSCTS (NK$LDCT,OPARM);
     1727     8152    2                   CASE(NK_CGTRM,NK_CGFPRG);
     1728     8153    2                     CALL KCD$DSCTRM (NK$LDCT,OPARM);
     1729     8154    2                   CASE(NK_NOCG,NK_TRMPTH);
     1730     8155    2                     CALL KCF$RLNCG (NK$LDCT);
     1731     8156    2                   CASE (NK_LOGON);
     1732     8157    2                     CALL NKL$RELDCT (ADDR(NK$LDCT));
     1733     8158    2                   CASE (NK_RES);
     1734     8159    2                     CALL FRF$DISC (NK$LDCT);
     1735     8160    2                   CASE (NK_OPCTL);
     1736     8161    2                     CALL FPA$ODDN (NK$LDCT);
     1737     8162
     1738     8163
     1739     8164    2                   CASE (ELSE);
     1740     8165    2                     CALL SC_BADRCD;
     1741     8166        /*S*  SCREECH_CODE:  KIS-S$BADRCD
     1742     8167              TYPE:          Screech
     1743     8168              MESSAGE:       Bad resource code in remote LDCT (at FEP down)
     1744     8169                    */                /*
     1745     8170              REMARKS:       When an FEP goes down the entire list of LDCTs is
     1746     8171                             run to find and disconnect those of the lost FEP.
     1747     8172                             This presents an opportunity to check their validity.
     1748     8173                             This screech occurs when a remote LDCT has an
     1749     8174                             impossible resource code (RESCOD).  The same code
     1750     8175                             is also reported by KIN$ISCAN (KIN-S$BADRCD) when
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:280  
     1751     8176                             it finds this condition in a recieving LDCT.            */
     1752     8177    2                   END;
     1753     8178
     1754     8179    1           IF NK$LDCT.LKFLG.QFL
     1755     8180    1             THEN
     1756     8181    1               CALL KCF$QNF(NK$LDCT);
     1757     8182
     1758     8183
     1759     8184    1           RETURN;
     1760     8185    1   END KIA$ISCAN;
     1761     8186
     1762     8187
     1763     8188        %EOD;

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:281  
--  Include file information  --

   KL_MACRO_C.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KL_SUBS_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$ISCAN.

   Procedure KIA$ISCAN requires 498 words for executable code.
   Procedure KIA$ISCAN requires 60 words of local(AUTO) storage.

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:282  

 Object Unit name= KIA$ISCAN                                  File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:34:43.60 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      4      4  KIA$ISCAN
    1   Proc  even  none   498    762  KIA$ISCAN
    2  RoData even  none    13     15  KIA$ISCAN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KIA$ISCAN
     1    534          yes     yes      Std        1  KIA$TERM
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:283  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KIA$MSG
 yes     yes           Std       3 KUB$WRITE
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       2 KCF$NOCG
         yes           Std       1 KCF$RLNCG
 yes     yes           Std       2 KIA$ACUP
 yes     yes           Std       2 FPA$ODIN
 yes     yes           Std       1 FRF$DISC
         yes           Std       1 KCF$QNF
 yes     yes           Std       2 FRF$IN
         yes           Std       4 SSR$RUE
 yes     yes           Std       1 FPA$ODDN
 yes     yes           Std       3 KIA$FCNO
 yes     yes           Std       2 KCF$FEIN
         yes           Std       2 KCD$DSCTRM
 yes     yes           Std       3 KIA$DSC
 yes     yes           Std       2 KIA$FPRGIN
 yes     yes           Std       1 NKL$RELDCT
 yes     yes           Std       2 KIA$DSCTS
 yes     yes           Std       2 KIA$UCIN
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:284  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BADRCD                             SC_BDRCDI                             N$DCT$$
     KI_FEI$$                         r    K_RWPARM_CON                          KIA_NODAT
     B$USRT$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:285  


     1448        1        /*T***********************************************************/
     1449        2        /*T*                                                         */
     1450        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1451        4        /*T*                                                         */
     1452        5        /*T***********************************************************/
     1453        6        /*X* DTI=2,DCI=4,THI=2,CSI=2,ECI=2,STI=2,IND=2,ENI=2 */
     1454        7
     1455        8
     1456        9        KIA$ISCAN: PROC (NK$LDCT,K$RWPARM) ALTRET;

      9  1 000000   000000 700200 xent  KIA$ISCAN    TSX0  ! X66_AUTO_2
         1 000001   000074 000002                    ZERO    60,2

     1457       10
     1458       11        /*F*
     1459       12             NAME: KIA$ISCAN
     1460       13             PURPOSE:
     1461       14                  KIA$ISCAN does the initial scanning for all messages from the
     1462       15                  front end.
     1463       16             DESCRIPTION:
     1464       17                  Messages received from the front end are initially scanned
     1465       18                  here to determine what function needs to be performed.
     1466       19                  KIA$ISCAN performs all functions that are common to all front
     1467       20                  end connected devices. If the messages needs to be handles
     1468       21                  further the resource code in the LDCT determines what routine
     1469       22                  to be called for further processing.
     1470       23        */
     1471       24
     1472       25        %PLIST;
     1473       26        %INCLUDE B$USER;
     1474      242        %INCLUDE KV$VDO;
     1475     1257        %INCLUDE HF_LOCK_C;
     1476     1271        %INCLUDE NK$LDCT;
     1477     1373        %INCLUDE NK_LDCT_R;
     1478     1382        %INCLUDE KI_DATA_R;
     1479     1408        %INCLUDE KC_SUBS_C;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:286  
     1480     1424        %INCLUDE NK_SUBS;
     1481     1449        %INCLUDE SS_SCHED_C;
     1482     1682        %INCLUDE KL_AFCN_C;
     1483     1783        %INCLUDE KL_SUBS_C;
     1484     1837        %INCLUDE K_DATA_R;
     1485     2548        %INCLUDE K_SUBS_C;
     1486     2581        %INCLUDE KI_ERRORS_C;
     1487     2666        %INCLUDE UM_CP6;
     1488     3518        %INCLUDE KL_MACRO_C;
     1489     6870
     1490     6871        %NK$LDCT (STCLASS="");
     1491     6917        %K$RWPARM (NAME=K$RWPARM);
     1492     7233        %K$RWPARM (NAME=OPARM);
     1493     7549        %KL_FEPST(STCLASS="");
     1494     7584        %KV_VDO_ALL_E;
     1495     7663        %KV$VDO (STCLASS="BASED(K$RWPARM.UHDR$)");
     1496     7690        %KV$VDO_PRM (STCLASS="BASED(K$RWPARM.UHDR$)");
     1497     7731        %KV$VDO_RQSDAT (STCLASS="BASED(K$RWPARM.UHDR$)",NAME=VDO);
     1498     7779        %KV$VDO_RQSDAT (STCLASS=AUTO);
     1499     7827        %KV$VDO_DSC (STCLASS="BASED(K$RWPARM.UHDR$)");
     1500     7869
     1501     7870    1   DCL KIA_NODAT BIT(36) SYMREF ALIGNED;
     1502     7871        %VLP_ERRCODE (FPTN=ERR_TERM,FCG=KI,MID=A,MON='1'B,ERR#=%E$TERM,SEV=7,STCLASS=
              7871            CONSTANT);
     1503     7916
     1504     7917    1   DCL MSIZC SBIN WORD;
     1505     7918    1   DCL 1 MZC REDEF MSIZC,
     1506     7919    1         2 TOP UBIN(28) UNAL,
     1507     7920    1         2 BOT UBIN(8) UNAL;
     1508     7921    1   DCL MSIZW UBIN(36);
     1509     7922    1   DCL FPA$ODIN ENTRY(2) ALTRET;
     1510     7923    1   DCL FPA$ODDN ENTRY(1) ALTRET;
     1511     7924    1   DCL FRF$DISC ENTRY(1) ALTRET;
     1512     7925    1   DCL FRF$IN ENTRY(2) ALTRET;
     1513     7926    1   DCL KIA$DSC ENTRY(3) ALTRET;
     1514     7927    1   DCL KIA$FCNO ENTRY(3) ALTRET;
     1515     7928    1   DCL KIA$UCIN ENTRY(2) ALTRET;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:287  
     1516     7929    1   DCL KIA$FPRGIN ENTRY(2) ALTRET;
     1517     7930    1   DCL KCF$FEIN ENTRY(2) ALTRET;
     1518     7931    1   DCL KCF$QNF ENTRY(1);
     1519     7932    1   DCL SSR$RUE ENTRY(4);
     1520     7933    1   DCL KQP$EVNT ENTRY(2) ALTRET;
     1521     7934    1   DCL KCF$NOCG ENTRY(2) ALTRET;
     1522     7935    1   DCL MMS$VREL ENTRY(2) ALTRET;
     1523     7936    1   DCL KIA$ACUP ENTRY(2) ALTRET;
     1524     7937    1   DCL KIA$MSG ENTRY(1) ALTRET;
     1525     7938    1   DCL NKL$RELDCTP ENTRY(1) ALTRET;
     1526     7939    1   DCL SC_BADRCD ENTRY CONV(2,0);
     1527     7940    1   DCL KCD$DSCTRM ENTRY(2);
     1528     7941    1   DCL KCF$RLNCG ENTRY(1);
     1529     7942    1   DCL KIA$DSCTS ENTRY(2) ALTRET;
     1530     7943    1   DCL KIS$SEND ENTRY(1) ALTRET;
     1531     7944    1   DCL NKL$RELDCT ENTRY(1) ALTRET;
     1532     7945
     1533     7946    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1534     7947    1   DCL SC_BDRCDI ENTRY CONV(2,0);
     1535     7948    1   DCL B$USRT$ PTR SYMREF;
     1536     7949
     1537     7950
     1538     7951    1   DCL 1 SPREAD BASED UNAL ,
     1539     7952    1         2 * BIT(1) UNAL,
     1540     7953    1         2 HI8 UBIN(8) UNAL ,
     1541     7954    1         2 * BIT(1) UNAL ,
     1542     7955    1         2 LO8 UBIN(8) UNAL ;
     1543     7956    1   DCL TP$ PTR;
     1544     7957        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:288  
     1545     7958    1           IF NK$LDCT.LKFLG.NOWAIT

   7958  1 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000003   000011 236100                    LDQ     9,,PR0
         1 000004   000001 316003                    CANQ    1,DU
         1 000005   000013 600000 1                  TZE     s:7960

     1546     7959    1             THEN K$RWPARM.KEYTYPE = NK$LDCT.NOWAIT.KEYTYP;

   7959  1 000006   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 000007   000010 236100                    LDQ     8,,PR0
         1 000010   770000 376003                    ANQ     -4096,DU
         1 000011   000025 772000                    QRL     21
         1 000012   100046 552110                    STBQ    38,'10'O,PR1

     1547     7960    1           CALL KIA$MSG (K$RWPARM)

   7960  1 000013   200004 630500                    EPPR0   @K$RWPARM,,AUTO
         1 000014   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000015   000000 701000 xent               TSX1    KIA$MSG
         1 000016   000020 702000 1                  TSX2    s:7962
         1 000017   000047 710000 1                  TRA     s:7973

     1548     7961    2             WHENALTRETURN DO;

     1549     7962    2               KL_FEPST.FEP = K$RWPARM.FEX;

   7962  1 000020   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000021   000021 236100                    LDQ     17,,PR0
         1 000022   000022 736000                    QLS     18
         1 000023   200056 552120                    STBQ    KL_FEPST,'20'O,AUTO

     1550     7963    2               KL_FEPST.FCN = IGA_CRASHFEP_BF; /*request GJA-166-3 dump from fep*/

   7963  1 000024   120000 236003                    LDQ     40960,DU
         1 000025   200056 552140                    STBQ    KL_FEPST,'40'O,AUTO

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:289  
     1551     7964    3              CALL KUB$WRITE (KL_FEPST,LENGTHC(KL_FEPST),'HLPADMIN') WHENALTRETURN DO;

   7964  1 000026   000001 236000 2                  LDQ     1
         1 000027   200072 756100                    STQ     TP$+3,,AUTO
         1 000030   000002 236000 2                  LDQ     2
         1 000031   200071 756100                    STQ     TP$+2,,AUTO
         1 000032   200056 631500                    EPPR1   KL_FEPST,,AUTO
         1 000033   200070 451500                    STP1    TP$+1,,AUTO
         1 000034   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000035   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000036   000000 701000 xent               TSX1    KUB$WRITE
         1 000037   000041 702000 1                  TSX2    s:7965
         1 000040   000043 710000 1                  TRA     s:7967

     1552     7965    3                   CALL SC_BDRCDI;

   7965  1 000041   000000 713400 xsym               CLIMB   SC_BDRCDI
         1 000042   000000 600000 xsid               climb   nvectors=         0

     1553     7966    3                   END;

     1554     7967    2               K$RWPARM.ERR = %K$WAIT_READ;

   7967  1 000043   000006 235007                    LDA     6,DL
         1 000044   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000045   000013 755100                    STA     11,,PR0

     1555     7968    2               ALTRETURN;

   7968  1 000046   000000 702200 xent               TSX2  ! X66_AALT

     1556     7969        /*N*
     1557     7970                  CALL KIA$TERM(NK$LDCT) ALTRET(GETOUT);
     1558     7971         */
     1559     7972    2               END;
     1560     7973    2           DO CASE (KV$VDO.FNC);

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:290  
   7973  1 000047   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000050   000014 471500                    LDP1    12,,PR0
         1 000051   000100 101500                    MRL     fill='000'O
         1 000052   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000053   200070 000004                    ADSC9   TP$+1,,AUTO              cn=0,n=4
         1 000054   200070 236100                    LDQ     TP$+1,,AUTO
         1 000055   000012 136007                    SBLQ    10,DL
         1 000056   000027 116007                    CMPQ    23,DL
         1 000057   000061 602006 1                  TNC     s:7973+10,QL
         1 000060   000437 710000 1                  TRA     CALLOUT
         1 000061   000420 710000 1                  TRA     s:8055
         1 000062   000437 710000 1                  TRA     CALLOUT
         1 000063   000437 710000 1                  TRA     CALLOUT
         1 000064   000437 710000 1                  TRA     CALLOUT
         1 000065   000437 710000 1                  TRA     CALLOUT
         1 000066   000437 710000 1                  TRA     CALLOUT
         1 000067   000437 710000 1                  TRA     CALLOUT
         1 000070   000437 710000 1                  TRA     CALLOUT
         1 000071   000437 710000 1                  TRA     CALLOUT
         1 000072   000437 710000 1                  TRA     CALLOUT
         1 000073   000437 710000 1                  TRA     CALLOUT
         1 000074   000437 710000 1                  TRA     CALLOUT
         1 000075   000122 710000 1                  TRA     s:7981
         1 000076   000437 710000 1                  TRA     CALLOUT
         1 000077   000437 710000 1                  TRA     CALLOUT
         1 000100   000437 710000 1                  TRA     CALLOUT
         1 000101   000437 710000 1                  TRA     CALLOUT
         1 000102   000437 710000 1                  TRA     CALLOUT
         1 000103   000437 710000 1                  TRA     CALLOUT
         1 000104   000437 710000 1                  TRA     CALLOUT
         1 000105   000437 710000 1                  TRA     CALLOUT
         1 000106   000437 710000 1                  TRA     CALLOUT
         1 000107   000110 710000 1                  TRA     s:7977

     1561     7974
     1562     7975        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:291  
     1563     7976    2             CASE(%KV_VDO_FNC_RQSMRK);

     1564     7977    2               CALL KIA$FCNO (NK$LDCT,%KV_VDO_FNC_MRK,K$RWPARM) ALTRET (GETOUT);

   7977  1 000110   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 000111   200072 756100                    STQ     TP$+3,,AUTO
         1 000112   000004 236000 2                  LDQ     4
         1 000113   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000114   200070 757100                    STAQ    TP$+1,,AUTO
         1 000115   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000116   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000117   000000 701000 xent               TSX1    KIA$FCNO
         1 000120   000530 702000 1                  TSX2    GETOUT
         1 000121   000527 710000 1                  TRA     s:8100

     1565     7978
     1566     7979        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:292  
     1567     7980    2             CASE(%KV_VDO_FNC_RQSDAT);

     1568     7981    2               KV$VDO_RQSDAT = VDO ;

   7981  1 000122   000014 471500                    LDP1    12,,PR0
         1 000123   000100 100500                    MLR     fill='000'O
         1 000124   100000 000012                    ADSC9   0,,PR1                   cn=0,n=10
         1 000125   200062 000012                    ADSC9   KV$VDO_RQSDAT,,AUTO      cn=0,n=10

     1569     7982
     1570     7983                    %LOCK(G=NK$LDCT.LOCK);

   7984  1 000126   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000127   000020 036003                    ADLQ    16,DU
         1 000130   200070 756100                    STQ     TP$+1,,AUTO
         1 000131   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000132   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000133   000000 701000 xent               TSX1    HFC$LOCK
         1 000134   000000 011000                    NOP     0

     1571     7986
     1572     7987        /* IF EOF_NONE BIT SET SEND ERROR NODAT */
     1573     7988    2               IF KV$VDO_RQSDAT.EOFNO_DAT AND NOT NK$LDCT.LKFLG.OBLK

   7988  1 000135   200064 236100                    LDQ     KV$VDO_RQSDAT+2,,AUTO
         1 000136   004000 316003                    CANQ    2048,DU
         1 000137   000172 600000 1                  TZE     s:7999
         1 000140   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000141   000011 236100                    LDQ     9,,PR0
         1 000142   200000 316003                    CANQ    65536,DU
         1 000143   000172 601000 1                  TNZ     s:7999

     1574     7989    3                 THEN DO;

     1575     7990    3                   K$RWPARM.MSG_ERRCODE = KIA_NODAT;

   7990  1 000144   000000 236000 xsym               LDQ     KIA_NODAT
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:293  
         1 000145   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 000146   100037 756100                    STQ     31,,PR1

     1576     7991    4                   CALL KIA$FCNO (NK$LDCT,%KV_VDO_FNC_DAT,K$RWPARM) WHENALTRETURN DO;

   7991  1 000147   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 000150   200072 756100                    STQ     TP$+3,,AUTO
         1 000151   000005 236000 2                  LDQ     5
         1 000152   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000153   200070 757100                    STAQ    TP$+1,,AUTO
         1 000154   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000155   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000156   000000 701000 xent               TSX1    KIA$FCNO
         1 000157   000161 702000 1                  TSX2    s:7993
         1 000160   000171 710000 1                  TRA     s:7997

     1577     7992                            %UNLOCK (G=NK$LDCT.LOCK);

   7993  1 000161   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000162   000020 036003                    ADLQ    16,DU
         1 000163   200070 756100                    STQ     TP$+1,,AUTO
         1 000164   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000165   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000166   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000167   000000 011000                    NOP     0

     1578     7995    4                       GOTO GETOUT;

   7995  1 000170   000530 710000 1                  TRA     GETOUT

     1579     7996    4                       END;
     1580     7997    3                   END;

   7997  1 000171   000410 710000 1                  TRA     s:8050

     1581     7998    3                 ELSE DO;

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:294  
     1582     7999    3                   IF KV$VDO_RQSDAT.STR ~= LDCT.TH.STR

   7999  1 000172   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000173   000016 236100                    LDQ     14,,PR0
         1 000174   000022 772000                    QRL     18
         1 000175   000777 376007                    ANQ     511,DL
         1 000176   200070 756100                    STQ     TP$+1,,AUTO
         1 000177   200062 236100                    LDQ     KV$VDO_RQSDAT,,AUTO
         1 000200   000022 772000                    QRL     18
         1 000201   000177 376007                    ANQ     127,DL
         1 000202   200070 116100                    CMPQ    TP$+1,,AUTO
         1 000203   000207 600000 1                  TZE     s:8002

     1583     8000    3                     THEN
     1584     8001    3                       LDCT.TH = '0'B;

   8001  1 000204   000100 100400                    MLR     fill='000'O
         1 000205   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000206   000016 200007                    ADSC9   14,,PR0                  cn=1,n=7

     1585     8002    3                   NK$LDCT.TH.STR = KV$VDO_RQSDAT.STR;

   8002  1 000207   200062 236100                    LDQ     KV$VDO_RQSDAT,,AUTO
         1 000210   000177 376003                    ANQ     127,DU
         1 000211   000016 552120                    STBQ    14,'20'O,PR0

     1586     8003
     1587     8004                       /* If we are blocked and this is an increment throw it away    */
     1588     8005    3                   TP$ = ADDR(KV$VDO_RQSDAT.MAXNMBBYT);

   8005  1 000212   200070 452500                    STP2    TP$+1,,AUTO
         1 000213   200070 236100                    LDQ     TP$+1,,AUTO
         1 000214   000006 036000 2                  ADLQ    6
         1 000215   200067 756100                    STQ     TP$,,AUTO

     1589     8006    3                   IF KV$VDO_RQSDAT.INCMAXNMBBYT THEN

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:295  
   8006  1 000216   200064 236100                    LDQ     KV$VDO_RQSDAT+2,,AUTO
         1 000217   100000 316003                    CANQ    32768,DU
         1 000220   000256 600000 1                  TZE     s:8018

     1590     8007    3                       IF LDCT.LKFLG.OBLK

   8007  1 000221   000011 236100                    LDQ     9,,PR0
         1 000222   200000 316003                    CANQ    65536,DU
         1 000223   000234 600000 1                  TZE     s:8016

     1591     8008    4                         THEN DO;

     1592     8009                                %UNLOCK (G=LDCT.LOCK);

   8010  1 000224   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000225   000020 036003                    ADLQ    16,DU
         1 000226   200070 756100                    STQ     TP$+1,,AUTO
         1 000227   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000230   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000231   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000232   000000 011000                    NOP     0

     1593     8012    4                           RETURN;

   8012  1 000233   000000 702200 xent               TSX2  ! X66_ARET

     1594     8013    4                           END;
     1595     8014        /* Check to see if we are incrementing throttling */
     1596     8015    3                         ELSE
     1597     8016    3                           LDCT.TH.MAXNMBBYT = LDCT.TH.MAXNMBBYT + TP$->SPREAD.HI8*256
              8016                                    + TP$->SPREAD.LO8;

   8016  1 000234   000017 236100                    LDQ     15,,PR0
         1 000235   000022 736000                    QLS     18
         1 000236   000022 732000                    QRS     18
         1 000237   200070 756100                    STQ     TP$+1,,AUTO
         1 000240   200067 471500                    LDP1    TP$,,AUTO
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:296  
         1 000241   003100 061500                    CSR     bolr='003'O
         1 000242   100000 010010                    BDSC    0,,PR1                   by=0,bit=1,n=8
         1 000243   200071 000044                    BDSC    TP$+2,,AUTO              by=0,bit=0,n=36
         1 000244   200071 236100                    LDQ     TP$+2,,AUTO
         1 000245   000010 736000                    QLS     8
         1 000246   200070 036100                    ADLQ    TP$+1,,AUTO
         1 000247   003100 061500                    CSR     bolr='003'O
         1 000250   100000 210010                    BDSC    0,,PR1                   by=1,bit=1,n=8
         1 000251   200072 000044                    BDSC    TP$+3,,AUTO              by=0,bit=0,n=36
         1 000252   200072 036100                    ADLQ    TP$+3,,AUTO
         1 000253   000000 620006                    EAX0    0,QL
         1 000254   000017 440100                    SXL0    15,,PR0
         1 000255   000272 710000 1                  TRA     s:8020

     1598     8017    3                     ELSE
     1599     8018    3                       LDCT.TH.MAXNMBBYT = TP$->SPREAD.HI8*256 + TP$->SPREAD.LO8;

   8018  1 000256   200067 471500                    LDP1    TP$,,AUTO
         1 000257   003100 061500                    CSR     bolr='003'O
         1 000260   100000 210010                    BDSC    0,,PR1                   by=1,bit=1,n=8
         1 000261   200070 000044                    BDSC    TP$+1,,AUTO              by=0,bit=0,n=36
         1 000262   003100 061500                    CSR     bolr='003'O
         1 000263   100000 010010                    BDSC    0,,PR1                   by=0,bit=1,n=8
         1 000264   200071 000044                    BDSC    TP$+2,,AUTO              by=0,bit=0,n=36
         1 000265   200071 236100                    LDQ     TP$+2,,AUTO
         1 000266   000010 736000                    QLS     8
         1 000267   200070 036100                    ADLQ    TP$+1,,AUTO
         1 000270   000000 620006                    EAX0    0,QL
         1 000271   000017 440100                    SXL0    15,,PR0

     1600     8019        /* Check to see if we are incrementing throttling */
     1601     8020    3                   TP$ = ADDR(KV$VDO_RQSDAT.MAXNMBRCR);

   8020  1 000272   200063 633500                    EPPR3   KV$VDO_RQSDAT+1,,AUTO
         1 000273   200067 453500                    STP3    TP$,,AUTO

     1602     8021    3                   IF KV$VDO_RQSDAT.INCMAXNMBRCR
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:297  

   8021  1 000274   200064 236100                    LDQ     KV$VDO_RQSDAT+2,,AUTO
         1 000275   200000 316003                    CANQ    65536,DU
         1 000276   000320 600000 1                  TZE     s:8025

     1603     8022    3                     THEN
     1604     8023    3                       LDCT.TH.MAXNMBRCR = LDCT.TH.MAXNMBRCR + TP$->SPREAD.HI8*256 +
              8023                                TP$->SPREAD.LO8;

   8023  1 000277   000016 236100                    LDQ     14,,PR0
         1 000300   000022 736000                    QLS     18
         1 000301   000022 732000                    QRS     18
         1 000302   200070 756100                    STQ     TP$+1,,AUTO
         1 000303   003100 061500                    CSR     bolr='003'O
         1 000304   300000 010010                    BDSC    0,,PR3                   by=0,bit=1,n=8
         1 000305   200071 000044                    BDSC    TP$+2,,AUTO              by=0,bit=0,n=36
         1 000306   200071 236100                    LDQ     TP$+2,,AUTO
         1 000307   000010 736000                    QLS     8
         1 000310   200070 036100                    ADLQ    TP$+1,,AUTO
         1 000311   003100 061500                    CSR     bolr='003'O
         1 000312   300000 210010                    BDSC    0,,PR3                   by=1,bit=1,n=8
         1 000313   200072 000044                    BDSC    TP$+3,,AUTO              by=0,bit=0,n=36
         1 000314   200072 036100                    ADLQ    TP$+3,,AUTO
         1 000315   000000 620006                    EAX0    0,QL
         1 000316   000016 440100                    SXL0    14,,PR0
         1 000317   000333 710000 1                  TRA     s:8026

     1605     8024    3                     ELSE
     1606     8025    3                       LDCT.TH.MAXNMBRCR = TP$->SPREAD.HI8*256 + TP$->SPREAD.LO8;

   8025  1 000320   003100 061500                    CSR     bolr='003'O
         1 000321   300000 210010                    BDSC    0,,PR3                   by=1,bit=1,n=8
         1 000322   200070 000044                    BDSC    TP$+1,,AUTO              by=0,bit=0,n=36
         1 000323   003100 061500                    CSR     bolr='003'O
         1 000324   300000 010010                    BDSC    0,,PR3                   by=0,bit=1,n=8
         1 000325   200071 000044                    BDSC    TP$+2,,AUTO              by=0,bit=0,n=36
         1 000326   200071 236100                    LDQ     TP$+2,,AUTO
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:298  
         1 000327   000010 736000                    QLS     8
         1 000330   200070 036100                    ADLQ    TP$+1,,AUTO
         1 000331   000000 620006                    EAX0    0,QL
         1 000332   000016 440100                    SXL0    14,,PR0

     1607     8026    3                   TP$ = ADDR(KV$VDO_RQSDAT.MAXRCRBYTSIZ);

   8026  1 000333   200070 452500                    STP2    TP$+1,,AUTO
         1 000334   200070 236100                    LDQ     TP$+1,,AUTO
         1 000335   000007 036000 2                  ADLQ    7
         1 000336   200067 756100                    STQ     TP$,,AUTO

     1608     8027    3                   LDCT.TH.MAXRCRBYTSIZ = TP$->SPREAD.HI8*256 + TP$->SPREAD.LO8;

   8027  1 000337   200067 471500                    LDP1    TP$,,AUTO
         1 000340   003100 061500                    CSR     bolr='003'O
         1 000341   100000 210010                    BDSC    0,,PR1                   by=1,bit=1,n=8
         1 000342   200070 000044                    BDSC    TP$+1,,AUTO              by=0,bit=0,n=36
         1 000343   003100 061500                    CSR     bolr='003'O
         1 000344   100000 010010                    BDSC    0,,PR1                   by=0,bit=1,n=8
         1 000345   200071 000044                    BDSC    TP$+2,,AUTO              by=0,bit=0,n=36
         1 000346   200071 236100                    LDQ     TP$+2,,AUTO
         1 000347   000010 736000                    QLS     8
         1 000350   200070 036100                    ADLQ    TP$+1,,AUTO
         1 000351   000000 620006                    EAX0    0,QL
         1 000352   000017 740100                    STX0    15,,PR0

     1609     8028    3                   IF LDCT.LKFLG.OBLK      /* User is blocked for output         */

   8028  1 000353   000011 236100                    LDQ     9,,PR0
         1 000354   200000 316003                    CANQ    65536,DU
         1 000355   000374 600000 1                  TZE     s:8040

     1610     8029    3                     THEN
     1611     8030    3                       IF LDCT.TH.MAXNMBBYT ~= 0 AND LDCT.TH.MAXNMBRCR ~= 0

   8030  1 000356   000017 721100                    LXL1    15,,PR0
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:299  
         1 000357   000400 600000 1                  TZE     L1
         1 000360   000016 722100                    LXL2    14,,PR0
         1 000361   000400 600000 1                  TZE     L1

     1612     8031    4                         THEN DO;

     1613     8032    4                           LDCT.LKFLG.OBLK = '0'B;

   8032  1 000362   000010 236000 2                  LDQ     8
         1 000363   000011 356100                    ANSQ    9,,PR0

     1614     8033                                %UNLOCK (G=NK$LDCT.LOCK);

   8034  1 000364   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000365   000020 036003                    ADLQ    16,DU
         1 000366   200070 756100                    STQ     TP$+1,,AUTO
         1 000367   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000370   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000371   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000372   000000 011000                    NOP     0

     1615     8036    4                           GOTO CALLOUT;

   8036  1 000373   000437 710000 1                  TRA     CALLOUT

     1616     8037    4                           END;
     1617     8038    3                         ELSE
     1618     8039    3                           GOTO L1 ;
     1619     8040    3                   IF LDCT.TH.MAXNMBBYT = 0 OR LDCT.TH.MAXNMBRCR = 0

   8040  1 000374   000017 721100                    LXL1    15,,PR0
         1 000375   000400 600000 1                  TZE     L1
         1 000376   000016 722100                    LXL2    14,,PR0
         1 000377   000410 601000 1                  TNZ     s:8050

     1620     8041    4                     THEN DO;

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:300  
     1621     8042    4   L1:
     1622     8043                            %UNLOCK(G=NK$LDCT.LOCK);

   8044  1 000400   200003 236100       L1           LDQ     @NK$LDCT,,AUTO
         1 000401   000020 036003                    ADLQ    16,DU
         1 000402   200070 756100                    STQ     TP$+1,,AUTO
         1 000403   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000404   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000405   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000406   000000 011000                    NOP     0

     1623     8046    4                       GOTO CALLOUT;

   8046  1 000407   000437 710000 1                  TRA     CALLOUT

     1624     8047    4                       END;
     1625     8048    3                   END;
     1626     8049                    %UNLOCK (G=NK$LDCT.LOCK);

   8050  1 000410   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000411   000020 036003                    ADLQ    16,DU
         1 000412   200070 756100                    STQ     TP$+1,,AUTO
         1 000413   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000414   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000415   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000416   000000 011000                    NOP     0
         1 000417   000527 710000 1                  TRA     s:8100

     1627     8052
     1628     8053        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:301  
     1629     8054    2             CASE (%KV_VDO_FNC_DSC_RQS);

     1630     8055    2               IF NK$LDCT.ACCTNG THEN

   8055  1 000420   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000421   100007 430100                    FSZN    7,,PR1
         1 000422   000427 605000 1                  TPL     s:8057

     1631     8056    2                   CALL KIA$ACUP (NK$LDCT,K$RWPARM) ALTRET (GETOUT);

   8056  1 000423   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000424   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000425   000000 701000 xent               TSX1    KIA$ACUP
         1 000426   000530 702000 1                  TSX2    GETOUT

     1632     8057    2               IF NOT NK$LDCT.DFLG.SYMBIONT

   8057  1 000427   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000430   000006 236100                    LDQ     6,,PR0
         1 000431   020000 316007                    CANQ    8192,DL
         1 000432   000436 601000 1                  TNZ     s:8060

     1633     8058    2                 THEN
     1634     8059    2                   NK$LDCT.ERR = K$RWPARM.MSG_ERRCODE;

   8059  1 000433   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 000434   100037 236100                    LDQ     31,,PR1
         1 000435   000000 756100                    STQ     0,,PR0

     1635     8060    2               GOTO CALLOUT;

   8060  1 000436   000437 710000 1                  TRA     CALLOUT

     1636     8061
     1637     8062        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:302  
     1638     8063        /*        CASE (%KV_VDO_FNC_DAT,%KV_VDO_FNC_PRM_RSP);
     1639     8064                    GOTO CALLOUT; */            /* CALLOUT IS CASE (ELSE)             */
     1640     8065
     1641     8066        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:303  
     1642     8067    2             CASE(ELSE);

     1643     8068        /* The message must be handled further. Call the appropiate routine
     1644     8069        determined by the resource code.
     1645     8070         */
     1646     8071    2   CALLOUT:    IF NK$LDCT.DFLG.RLSE='0'B

   8071  1 000437   200003 470500       CALLOUT      LDP0    @NK$LDCT,,AUTO
         1 000440   000006 236100                    LDQ     6,,PR0
         1 000441   000400 316007                    CANQ    256,DL
         1 000442   000527 601000 1                  TNZ     s:8100

     1647     8072    3                 THEN DO;

     1648     8073    4                   DO CASE (NK$LDCT.RESCOD);

   8073  1 000443   000006 720100                    LXL0    6,,PR0
         1 000444   000017 360003                    ANX0    15,DU
         1 000445   000017 100003                    CMPX0   15,DU
         1 000446   000450 602010 1                  TNC     s:8073+5,X0
         1 000447   000525 710000 1                  TRA     s:8087
         1 000450   000525 710000 1                  TRA     s:8087
         1 000451   000467 710000 1                  TRA     s:8075
         1 000452   000474 710000 1                  TRA     s:8077
         1 000453   000525 710000 1                  TRA     s:8087
         1 000454   000525 710000 1                  TRA     s:8087
         1 000455   000501 710000 1                  TRA     s:8079
         1 000456   000501 710000 1                  TRA     s:8079
         1 000457   000525 710000 1                  TRA     s:8087
         1 000460   000506 710000 1                  TRA     s:8081
         1 000461   000506 710000 1                  TRA     s:8081
         1 000462   000525 710000 1                  TRA     s:8087
         1 000463   000513 710000 1                  TRA     s:8083
         1 000464   000525 710000 1                  TRA     s:8087
         1 000465   000525 710000 1                  TRA     s:8087
         1 000466   000520 710000 1                  TRA     s:8085

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:304  
     1649     8074    4                     CASE(NK_TSTRM);

     1650     8075    4                       CALL KIA$UCIN (NK$LDCT,K$RWPARM) ALTRET (ARET);

   8075  1 000467   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000470   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000471   000000 701000 xent               TSX1    KIA$UCIN
         1 000472   000533 702000 1                  TSX2    ARET
         1 000473   000527 710000 1                  TRA     s:8100

     1651     8076    4                     CASE(NK_CGTRM);

     1652     8077    4                       CALL KCF$FEIN (NK$LDCT,K$RWPARM) ALTRET (ARET);

   8077  1 000474   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000475   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000476   000000 701000 xent               TSX1    KCF$FEIN
         1 000477   000533 702000 1                  TSX2    ARET
         1 000500   000527 710000 1                  TRA     s:8100

     1653     8078    4                     CASE(NK_NOCG,NK_TRMPTH);

     1654     8079    4                       CALL KCF$NOCG (NK$LDCT,K$RWPARM) ALTRET (ARET);

   8079  1 000501   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000502   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000503   000000 701000 xent               TSX1    KCF$NOCG
         1 000504   000533 702000 1                  TSX2    ARET
         1 000505   000527 710000 1                  TRA     s:8100

     1655     8080    4                     CASE (NK_TSFPRG,NK_CGFPRG);

     1656     8081    4                       CALL KIA$FPRGIN (NK$LDCT,K$RWPARM) ALTRET (ARET);

   8081  1 000506   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000507   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000510   000000 701000 xent               TSX1    KIA$FPRGIN
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:305  
         1 000511   000533 702000 1                  TSX2    ARET
         1 000512   000527 710000 1                  TRA     s:8100

     1657     8082    4                     CASE (NK_RES);

     1658     8083    4                       CALL FRF$IN(NK$LDCT,K$RWPARM) ALTRET (ARET);

   8083  1 000513   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000514   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000515   000000 701000 xent               TSX1    FRF$IN
         1 000516   000533 702000 1                  TSX2    ARET
         1 000517   000527 710000 1                  TRA     s:8100

     1659     8084    4                     CASE (NK_OPCTL);

     1660     8085    4                       CALL FPA$ODIN (NK$LDCT,K$RWPARM) ALTRET (ARET);

   8085  1 000520   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000521   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000522   000000 701000 xent               TSX1    FPA$ODIN
         1 000523   000533 702000 1                  TSX2    ARET
         1 000524   000527 710000 1                  TRA     s:8100

     1661     8086    4                     CASE(ELSE);

     1662     8087    4                       CALL SC_BDRCDI;

   8087  1 000525   000000 713400 xsym               CLIMB   SC_BDRCDI
         1 000526   000000 600000 xsid               climb   nvectors=         0

     1663     8088        /*S*  SCREECH_CODE:  KIN-S$BADRCD
     1664     8089              TYPE:          Screech
     1665     8090              MESSAGE:       Bad resource code in remote LDCT (at message input)
     1666     8091              REMARKS:       This screech occurs when the LDCT for a remote
     1667     8092                             device has an impossible RESCOD for remote devices.
     1668     8093                             Either we have dual LDCT allocation or the LDCT has
     1669     8094                             been clobbered.  This code is also reported by
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:306  
     1670     8095                             KIQ$FEINIT (KIS-S$BADRCD) when this condition is
     1671     8096                             discovered on an FEP crash.                             */
     1672     8097    4                     END;

     1673     8098    3                   END;

     1674     8099    2             END;

     1675     8100    1           RETURN;

   8100  1 000527   000000 702200 xent               TSX2  ! X66_ARET

   8086  1 000530                       GETOUT       null
     1676     8101        %EJECT;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:307  
     1677     8102        /* GETOUT will set the error telling the lower layers that the message
     1678     8103           can not be handled right now. KIS$SEND will call back at a later
     1679     8104           time with the same message.
     1680     8105         */
     1681     8106    1   GETOUT: ;
     1682     8107    1           K$RWPARM.ERR = %K$DEFER_IO;

   8107  1 000530   000003 235007                    LDA     3,DL
         1 000531   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000532   000013 755100                    STA     11,,PR0

   8107  1 000533                       ARET         null
     1683     8108    1   ARET:   ;
     1684     8109    1           ALTRETURN;

   8109  1 000533   000000 702200 xent               TSX2  ! X66_AALT

     1685     8110
     1686     8111
     1687     8112
     1688     8113
     1689     8114    1   KIA$TERM: ENTRY (NK$LDCT) ALTRET;

   8114  1 000534   000000 700200 xent  KIA$TERM     TSX0  ! X66_AUTO_2
         1 000535   000074 000002                    ZERO    60,2

     1690     8115
     1691     8116
     1692     8117    1           IF NOT NK$LDCT.DFLG.SYMBIONT

   8117  1 000536   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000537   000006 236100                    LDQ     6,,PR0
         1 000540   020000 316007                    CANQ    8192,DL
         1 000541   000544 601000 1                  TNZ     s:8124

     1693     8118    1             THEN
     1694     8119    1               NK$LDCT.ERR = ERR_TERM;
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:308  

   8119  1 000542   000000 236000 0                  LDQ     ERR_TERM
         1 000543   000000 756100                    STQ     0,,PR0

     1695     8120             /*E* ERROR: KIA-%E$TERM-7
     1696     8121                  MESSAGE: Your connection %thru %DC %has been terminated.
     1697     8122                  MESSAGE1: The session connection has been terminated.
     1698     8123                   */
     1699     8124    1           CALL KIA$ACUP(NK$LDCT)

   8124  1 000544   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000545   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000546   000000 701000 xent               TSX1    KIA$ACUP
         1 000547   000551 702000 1                  TSX2    s:8126
         1 000550   000552 710000 1                  TRA     s:8128

     1700     8125    2             WHENALTRETURN DO;

     1701     8126    2               ALTRETURN;

   8126  1 000551   000000 702200 xent               TSX2  ! X66_AALT

     1702     8127    2               END;
     1703     8128    1           OPARM = K_RWPARM_CON;

   8128  1 000552   000100 100400                    MLR     fill='000'O
         1 000553   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000554   200006 000234                    ADSC9   OPARM,,AUTO              cn=0,n=156

     1704     8129    1           IF NOT NK$LDCT.DFLG.FEDN

   8129  1 000555   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000556   000006 236100                    LDQ     6,,PR0
         1 000557   000020 316007                    CANQ    16,DL
         1 000560   000577 601000 1                  TNZ     s:8137

     1705     8130    1             THEN
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:309  
     1706     8131    1               CALL KIA$DSC (NK$LDCT,%KV_VDO_FNC_DSC_RSP,OPARM)

   8131  1 000561   200006 631500                    EPPR1   OPARM,,AUTO
         1 000562   200072 451500                    STP1    TP$+3,,AUTO
         1 000563   000011 236000 2                  LDQ     9
         1 000564   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000565   200070 757100                    STAQ    TP$+1,,AUTO
         1 000566   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000567   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000570   000000 701000 xent               TSX1    KIA$DSC
         1 000571   000573 702000 1                  TSX2    s:8133
         1 000572   000577 710000 1                  TRA     s:8137

     1707     8132    2                 WHENALTRETURN DO;

     1708     8133    2                   IF OPARM.ERR = %K$QFULL

   8133  1 000573   200021 235100                    LDA     OPARM+11,,AUTO
         1 000574   000001 115007                    CMPA    1,DL
         1 000575   000577 601000 1                  TNZ     s:8137

     1709     8134    2                     THEN
     1710     8135    2                       ALTRETURN;

   8135  1 000576   000000 702200 xent               TSX2  ! X66_AALT

     1711     8136    2                   END;
     1712     8137    1           IF B$USRT$->B$USER.FLG(NK$LDCT.USER) & %U_SCIO

   8137  1 000577   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000600   000007 236100                    LDQ     7,,PR0
         1 000601   000016 772000                    QRL     14
         1 000602   017760 376007                    ANQ     8176,DL
         1 000603   000000 471400 xsym               LDP1    B$USRT$
         1 000604   100000 236106                    LDQ     0,QL,PR1
         1 000605   000003 376000 0                  ANQ     ERR_TERM+3
         1 000606   000625 600000 1                  TZE     s:8142
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:310  
         1 000607   000007 236100                    LDQ     7,,PR0
         1 000610   000016 772000                    QRL     14
         1 000611   017760 376007                    ANQ     8176,DL
         1 000612   100017 236106                    LDQ     15,QL,PR1
         1 000613   200003 116100                    CMPQ    @NK$LDCT,,AUTO
         1 000614   000625 601000 1                  TNZ     s:8142

     1713     8138    1             AND B$USRT$->B$USER.MISC$(NK$LDCT.USER) = ADDR(NK$LDCT)
     1714     8139    1             THEN
     1715     8140    1               CALL SSR$RUE (%SS_FC,NK$LDCT.USER);

   8140  1 000615   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000616   000013 036000 2                  ADLQ    11
         1 000617   000014 235000 2                  LDA     12
         1 000620   200070 757100                    STAQ    TP$+1,,AUTO
         1 000621   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000622   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000623   000000 701000 xent               TSX1    SSR$RUE
         1 000624   000000 011000                    NOP     0

     1716     8141    2           DO INHIBIT;

     1717     8142    2             NK$LDCT.DFLG.FEDN='1'B;

   8142  1 000625   200003 470700                    LDP0  ! @NK$LDCT,,AUTO
         1 000626   000020 236207                    LDQ   ! 16,DL
         1 000627   000006 256300                    ORSQ  ! 6,,PR0

     1718     8143    2             NK$LDCT.DFLG.PRLS='1'B;

   8143  1 000630   000200 236207                    LDQ   ! 128,DL
         1 000631   000006 256300                    ORSQ  ! 6,,PR0

     1719     8144    2             END;

     1720     8145    1           IF NK$LDCT.DFLG.RLSE

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:311  
   8145  1 000632   000006 236100                    LDQ     6,,PR0
         1 000633   000400 316007                    CANQ    256,DL
         1 000634   000646 600000 1                  TZE     s:8148

     1721     8146    1             THEN
     1722     8147    1               CALL NKL$RELDCT (ADDR(NK$LDCT));

   8147  1 000635   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000636   200070 756100                    STQ     TP$+1,,AUTO
         1 000637   200070 631500                    EPPR1   TP$+1,,AUTO
         1 000640   200071 451500                    STP1    TP$+2,,AUTO
         1 000641   200071 630500                    EPPR0   TP$+2,,AUTO
         1 000642   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000643   000000 701000 xent               TSX1    NKL$RELDCT
         1 000644   000000 011000                    NOP     0
         1 000645   000751 710000 1                  TRA     s:8179

     1723     8148    1             ELSE IF NOT NK$LDCT.QFL.RLS

   8148  1 000646   000010 236100                    LDQ     8,,PR0
         1 000647   000040 316007                    CANQ    32,DL
         1 000650   000751 601000 1                  TNZ     s:8179

     1724     8149    2                 THEN DO CASE (NK$LDCT.RESCOD);

   8149  1 000651   000006 720100                    LXL0    6,,PR0
         1 000652   000017 360003                    ANX0    15,DU
         1 000653   000017 100003                    CMPX0   15,DU
         1 000654   000656 602010 1                  TNC     s:8149+5,X0
         1 000655   000747 710000 1                  TRA     s:8165
         1 000656   000747 710000 1                  TRA     s:8165
         1 000657   000675 710000 1                  TRA     s:8151
         1 000660   000706 710000 1                  TRA     s:8153
         1 000661   000747 710000 1                  TRA     s:8165
         1 000662   000747 710000 1                  TRA     s:8165
         1 000663   000717 710000 1                  TRA     s:8155
         1 000664   000717 710000 1                  TRA     s:8155
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:312  
         1 000665   000747 710000 1                  TRA     s:8165
         1 000666   000675 710000 1                  TRA     s:8151
         1 000667   000706 710000 1                  TRA     s:8153
         1 000670   000724 710000 1                  TRA     s:8157
         1 000671   000735 710000 1                  TRA     s:8159
         1 000672   000747 710000 1                  TRA     s:8165
         1 000673   000747 710000 1                  TRA     s:8165
         1 000674   000742 710000 1                  TRA     s:8161

     1725     8150    2                   CASE(NK_TSTRM,NK_TSFPRG);

     1726     8151    2                     CALL KIA$DSCTS (NK$LDCT,OPARM);

   8151  1 000675   200006 631500                    EPPR1   OPARM,,AUTO
         1 000676   200071 451500                    STP1    TP$+2,,AUTO
         1 000677   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000700   200070 756100                    STQ     TP$+1,,AUTO
         1 000701   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000702   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000703   000000 701000 xent               TSX1    KIA$DSCTS
         1 000704   000000 011000                    NOP     0
         1 000705   000751 710000 1                  TRA     s:8179

     1727     8152    2                   CASE(NK_CGTRM,NK_CGFPRG);

     1728     8153    2                     CALL KCD$DSCTRM (NK$LDCT,OPARM);

   8153  1 000706   200006 631500                    EPPR1   OPARM,,AUTO
         1 000707   200071 451500                    STP1    TP$+2,,AUTO
         1 000710   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000711   200070 756100                    STQ     TP$+1,,AUTO
         1 000712   200070 630500                    EPPR0   TP$+1,,AUTO
         1 000713   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000714   000000 701000 xent               TSX1    KCD$DSCTRM
         1 000715   000000 011000                    NOP     0
         1 000716   000751 710000 1                  TRA     s:8179

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:313  
     1729     8154    2                   CASE(NK_NOCG,NK_TRMPTH);

     1730     8155    2                     CALL KCF$RLNCG (NK$LDCT);

   8155  1 000717   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000720   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000721   000000 701000 xent               TSX1    KCF$RLNCG
         1 000722   000000 011000                    NOP     0
         1 000723   000751 710000 1                  TRA     s:8179

     1731     8156    2                   CASE (NK_LOGON);

     1732     8157    2                     CALL NKL$RELDCT (ADDR(NK$LDCT));

   8157  1 000724   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000725   200070 756100                    STQ     TP$+1,,AUTO
         1 000726   200070 631500                    EPPR1   TP$+1,,AUTO
         1 000727   200071 451500                    STP1    TP$+2,,AUTO
         1 000730   200071 630500                    EPPR0   TP$+2,,AUTO
         1 000731   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000732   000000 701000 xent               TSX1    NKL$RELDCT
         1 000733   000000 011000                    NOP     0
         1 000734   000751 710000 1                  TRA     s:8179

     1733     8158    2                   CASE (NK_RES);

     1734     8159    2                     CALL FRF$DISC (NK$LDCT);

   8159  1 000735   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000736   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000737   000000 701000 xent               TSX1    FRF$DISC
         1 000740   000000 011000                    NOP     0
         1 000741   000751 710000 1                  TRA     s:8179

     1735     8160    2                   CASE (NK_OPCTL);

     1736     8161    2                     CALL FPA$ODDN (NK$LDCT);
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:314  

   8161  1 000742   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000743   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000744   000000 701000 xent               TSX1    FPA$ODDN
         1 000745   000000 011000                    NOP     0
         1 000746   000751 710000 1                  TRA     s:8179

     1737     8162
     1738     8163
     1739     8164    2                   CASE (ELSE);

     1740     8165    2                     CALL SC_BADRCD;

   8165  1 000747   000000 713400 xsym               CLIMB   SC_BADRCD
         1 000750   000000 600000 xsid               climb   nvectors=         0

     1741     8166        /*S*  SCREECH_CODE:  KIS-S$BADRCD
     1742     8167              TYPE:          Screech
     1743     8168              MESSAGE:       Bad resource code in remote LDCT (at FEP down)
     1744     8169                    */                /*
     1745     8170              REMARKS:       When an FEP goes down the entire list of LDCTs is
     1746     8171                             run to find and disconnect those of the lost FEP.
     1747     8172                             This presents an opportunity to check their validity.
     1748     8173                             This screech occurs when a remote LDCT has an
     1749     8174                             impossible resource code (RESCOD).  The same code
     1750     8175                             is also reported by KIN$ISCAN (KIN-S$BADRCD) when
     1751     8176                             it finds this condition in a recieving LDCT.            */
     1752     8177    2                   END;

     1753     8178
     1754     8179    1           IF NK$LDCT.LKFLG.QFL

   8179  1 000751   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000752   000011 236100                    LDQ     9,,PR0
         1 000753   000100 316003                    CANQ    64,DU
         1 000754   000761 600000 1                  TZE     s:8184

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:315  
     1755     8180    1             THEN
     1756     8181    1               CALL KCF$QNF(NK$LDCT);

   8181  1 000755   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000756   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000757   000000 701000 xent               TSX1    KCF$QNF
         1 000760   000000 011000                    NOP     0

     1757     8182
     1758     8183
     1759     8184    1           RETURN;

   8184  1 000761   000000 702200 xent               TSX2  ! X66_ARET

ERR_TERM
 Sect OctLoc
   0     000   131101 421107                                                    YA.G

(unnamed)
 Sect OctLoc
   0     001   110114 120101   104115 111116   000000 002000                    HLPADMIN....

(unnamed)
 Sect OctLoc
   2     000   000000 000016   000001 006000   000000 006000   000000 000037    ................
   2     004   000003 006000   000007 006000   000063 400000   000062 400000    .........3...2..
   2     010   577777 777777   000015 006000   000000 000050   000007 200000    ...........(....
   2     014   000012 006000                                                    ....
     1760     8185    1   END KIA$ISCAN;
     1761     8186
     1762     8187
     1763     8188        %EOD;

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:316  
--  Include file information  --

   KL_MACRO_C.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KL_SUBS_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KC_SUBS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$ISCAN.
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:317  

 **** Variables and constants ****

  ****  Section 000 RoData KIA$ISCAN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 ERR_TERM

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                  56-0-0/w STRC(126)   r     1 KL_FEPST
    62-0-0/h STRC(90)    r     1 KV$VDO_RQSDAT             *0-0-0/d STRC(864)   r     1 NK$LDCT
     6-0-0/d STRC(1404)  r     1 OPARM                     67-0-0/w PTR         r     1 TP$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/w BIT         r     1 KIA_NODAT
     0-0-0/w PTR         r     1 KI_FEI$$                   0-0-0/d STRC(1404)  r     1 K_RWPARM_CON
     0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/h STRC(18)    r     1 KV$VDO
     0-0-0/b STRC(18)    r     1 SPREAD                     0-0-0/h STRC(90)    r     1 VDO

PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:318  

   Procedure KIA$ISCAN requires 498 words for executable code.
   Procedure KIA$ISCAN requires 60 words of local(AUTO) storage.
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:319  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:320  
          MINI XREF LISTING

ARET
      8107**LABEL    8075--CALLALT  8077--CALLALT  8079--CALLALT  8081--CALLALT  8083--CALLALT  8085--CALLALT
B$DO.ECCINFO
       177**DCL       178--REDEF
B$U.MISC
       156**DCL       157--REDEF
B$USER.FLG
       202**DCL      8137>>IF
B$USER.MISC
       232**DCL       233--REDEF
B$USER.MISC$
       233**DCL      8137>>IF
B$USRT$
      7948**DCL      8137>>IF       8137>>IF
CALLOUT
      8071**LABEL    8036--GOTO     8046--GOTO     8060--GOTO
ERR_TERM
      7883**DCL      8119>>ASSIGN
FPA$ODDN
      7923**DCL-ENT  8161--CALL
FPA$ODIN
      7922**DCL-ENT  8085--CALL
FRF$DISC
      7924**DCL-ENT  8159--CALL
FRF$IN
      7925**DCL-ENT  8083--CALL
GETOUT
      8086**LABEL    7977--CALLALT  7995--GOTO     8056--CALLALT
HFC$LOCK
      1270**DCL-ENT  7984--CALL
HFC$UNLOCK
      1270**DCL-ENT  7993--CALL     8010--CALL     8034--CALL     8044--CALL     8050--CALL
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:321  
K$RWPARM
      6938**DCL         9--PROC     7960<>CALL     7977<>CALL     7991<>CALL     8056<>CALL     8075<>CALL
      8077<>CALL     8079<>CALL     8081<>CALL     8083<>CALL     8085<>CALL
K$RWPARM.BLKREC
      6964**DCL      6989--REDEF
K$RWPARM.BLKREC.BLKU#
      6965**DCL      6967--REDEF
K$RWPARM.BLKREC.RECU#
      6977**DCL      6979--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      7004**DCL      7005--REDEF
K$RWPARM.DVE.EOMCHAR
      7012**DCL      7016--REDEF
K$RWPARM.ERR
      7076**DCL      7081--REDEF    7967<<ASSIGN   8107<<ASSIGN
K$RWPARM.FC
      7040**DCL      7041--REDEF
K$RWPARM.FEX
      7122**DCL      7962>>ASSIGN
K$RWPARM.FLDID
      7222**DCL      7223--REDEF
K$RWPARM.FPT$
      7103**DCL      7110--REDEF
K$RWPARM.KEYTYPE
      7229**DCL      7230--REDEF    7959<<ASSIGN
K$RWPARM.MSG$
      6939**DCL      6945--REDEF
K$RWPARM.MSGID
      7051**DCL      7056--REDEF
K$RWPARM.MSGIDXT
      7064**DCL      7068--REDEF
K$RWPARM.MSG_ERRCODE
      7199**DCL      7990<<ASSIGN   8059>>ASSIGN
K$RWPARM.ORG
      7200**DCL      7201--REDEF
K$RWPARM.THDRSZ
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:322  
      7144**DCL      7148--REDEF
K$RWPARM.UHDR$
      7089**DCL      7683--IMP-PTR  7723--IMP-PTR  7764--IMP-PTR  7860--IMP-PTR  7973>>DOCASE   7981>>ASSIGN
K$RWPARM.VDOFLGS
      7202**DCL      7213--REDEF
KCD$DSCTRM
      7940**DCL-ENT  8153--CALL
KCF$FEIN
      7930**DCL-ENT  8077--CALL
KCF$NOCG
      7934**DCL-ENT  8079--CALL
KCF$QNF
      7931**DCL-ENT  8181--CALL
KCF$RLNCG
      7941**DCL-ENT  8155--CALL
KIA$ACUP
      7936**DCL-ENT  8056--CALL     8124--CALL
KIA$DSC
      7926**DCL-ENT  8131--CALL
KIA$DSCTS
      7942**DCL-ENT  8151--CALL
KIA$FCNO
      7927**DCL-ENT  7977--CALL     7991--CALL
KIA$FPRGIN
      7929**DCL-ENT  8081--CALL
KIA$MSG
      7937**DCL-ENT  7960--CALL
KIA$UCIN
      7928**DCL-ENT  8075--CALL
KIA_NODAT
      7870**DCL      7990>>ASSIGN
KI_FEI$$
      1393**DCL      1394--IMP-PTR
KL_FEPST
      7562**DCL      7964<>CALL     7964--CALL
KL_FEPST.FCN
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:323  
      7563**DCL      7963<<ASSIGN
KL_FEPST.FEP
      7565**DCL      7962<<ASSIGN
KUB$WRITE
      7946**DCL-ENT  7964--CALL
KV$VDO.FNC
      7687**DCL      7973>>DOCASE
KV$VDO_RQSDAT
      7812**DCL      7981<<ASSIGN
KV$VDO_RQSDAT.EOFNO_DAT
      7823**DCL      7988>>IF
KV$VDO_RQSDAT.INCMAXNMBBYT
      7821**DCL      8006>>IF
KV$VDO_RQSDAT.INCMAXNMBRCR
      7821**DCL      8021>>IF
KV$VDO_RQSDAT.MAXNMBBYT
      7820**DCL      8005--ASSIGN
KV$VDO_RQSDAT.MAXNMBRCR
      7819**DCL      8020--ASSIGN
KV$VDO_RQSDAT.MAXRCRBYTSIZ
      7819**DCL      8026--ASSIGN
KV$VDO_RQSDAT.STR
      7816**DCL      7999>>IF       8002>>ASSIGN
K_RWPARM_CON
      2252**DCL      8128>>ASSIGN
K_RWPARM_CON.BLKREC
      2278**DCL      2303--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      2279**DCL      2281--REDEF
K_RWPARM_CON.BLKREC.RECU#
      2291**DCL      2293--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      2318**DCL      2319--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      2326**DCL      2330--REDEF
K_RWPARM_CON.ERR
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:324  
      2390**DCL      2395--REDEF
K_RWPARM_CON.FC
      2354**DCL      2355--REDEF
K_RWPARM_CON.FLDID
      2536**DCL      2537--REDEF
K_RWPARM_CON.FPT$
      2417**DCL      2424--REDEF
K_RWPARM_CON.KEYTYPE
      2543**DCL      2544--REDEF
K_RWPARM_CON.MSG$
      2253**DCL      2259--REDEF
K_RWPARM_CON.MSGID
      2365**DCL      2370--REDEF
K_RWPARM_CON.MSGIDXT
      2378**DCL      2382--REDEF
K_RWPARM_CON.ORG
      2514**DCL      2515--REDEF
K_RWPARM_CON.THDRSZ
      2458**DCL      2462--REDEF
K_RWPARM_CON.VDOFLGS
      2516**DCL      2527--REDEF
L1
      8044**LABEL    8039--GOTO
MSIZC
      7917**DCL      7918--REDEF
N$DCT$$
      1380**DCL      1380--IMP-PTR
NK$LDCT
      6884**DCL         9--PROC     7977<>CALL     7991<>CALL     8056<>CALL     8075<>CALL     8077<>CALL
      8079<>CALL     8081<>CALL     8083<>CALL     8085<>CALL     8114--ENTRY    8124<>CALL     8131<>CALL
      8137--IF       8147--CALL     8151<>CALL     8153<>CALL     8155<>CALL     8157--CALL     8159<>CALL
      8161<>CALL     8181<>CALL
NK$LDCT.ACCTNG
      6894**DCL      8055>>IF
NK$LDCT.DDT$
      6886**DCL      6886--REDEF
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:325  
NK$LDCT.DFLG.FEDN
      6892**DCL      8129>>IF       8142<<ASSIGN
NK$LDCT.DFLG.PRLS
      6891**DCL      8143<<ASSIGN
NK$LDCT.DFLG.RLSE
      6891**DCL      8071>>IF       8145>>IF
NK$LDCT.DFLG.SYMBIONT
      6889**DCL      8057>>IF       8117>>IF
NK$LDCT.ERR
      6885**DCL      8059<<ASSIGN   8119<<ASSIGN
NK$LDCT.IOQ$
      6885**DCL      6886--REDEF
NK$LDCT.LDCTX
      6887**DCL      6887--REDEF
NK$LDCT.LKFLG.ABORTED
      6899**DCL      6900--REDEF
NK$LDCT.LKFLG.NOWAIT
      6905**DCL      7958>>IF
NK$LDCT.LKFLG.OBLK
      6899**DCL      7988>>IF       8007>>IF       8028>>IF       8032<<ASSIGN
NK$LDCT.LKFLG.QFL
      6903**DCL      8179>>IF
NK$LDCT.LOCK
      6912**DCL      7984<>CALL     7993<>CALL     8010<>CALL     8034<>CALL     8044<>CALL     8050<>CALL
NK$LDCT.NOWAIT.KEYTYP
      6895**DCL      7959>>ASSIGN
NK$LDCT.QFL.RLS
      6897**DCL      8148>>IF
NK$LDCT.RESCOD
      6892**DCL      8073>>DOCASE   8149>>DOCASE
NK$LDCT.RLCID.LDCTX
      6909**DCL      6909--REDEF
NK$LDCT.STA$
      6905**DCL      6906--REDEF
NK$LDCT.SYMB$
      6884**DCL      6884--REDEF    6884--REDEF    6885--REDEF
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:326  
NK$LDCT.TH
      6910**DCL      8001<<ASSIGN
NK$LDCT.TH.MAXNMBBYT
      6911**DCL      8016<<ASSIGN   8016>>ASSIGN   8018<<ASSIGN   8030>>IF       8040>>IF
NK$LDCT.TH.MAXNMBRCR
      6910**DCL      8023<<ASSIGN   8023>>ASSIGN   8025<<ASSIGN   8030>>IF       8040>>IF
NK$LDCT.TH.MAXRCRBYTSIZ
      6911**DCL      8027<<ASSIGN
NK$LDCT.TH.STR
      6910**DCL      7999>>IF       8002<<ASSIGN
NK$LDCT.USER
      6894**DCL      8137>>IF       8137>>IF       8140<>CALL
NKL$RELDCT
      7944**DCL-ENT  8147--CALL     8157--CALL
OPARM
      7254**DCL      8128<<ASSIGN   8131<>CALL     8151<>CALL     8153<>CALL
OPARM.BLKREC
      7280**DCL      7305--REDEF
OPARM.BLKREC.BLKU#
      7281**DCL      7283--REDEF
OPARM.BLKREC.RECU#
      7293**DCL      7295--REDEF
OPARM.DVE.DVBYTE.VFC
      7320**DCL      7321--REDEF
OPARM.DVE.EOMCHAR
      7328**DCL      7332--REDEF
OPARM.ERR
      7392**DCL      7397--REDEF    8133>>IF
OPARM.FC
      7356**DCL      7357--REDEF
OPARM.FLDID
      7538**DCL      7539--REDEF
OPARM.FPT$
      7419**DCL      7426--REDEF
OPARM.KEYTYPE
      7545**DCL      7546--REDEF
PL6.E3A0      #004=KIA$ISCAN File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:34 Page:327  
OPARM.MSG$
      7255**DCL      7261--REDEF
OPARM.MSGID
      7367**DCL      7372--REDEF
OPARM.MSGIDXT
      7380**DCL      7384--REDEF
OPARM.ORG
      7516**DCL      7517--REDEF
OPARM.THDRSZ
      7460**DCL      7464--REDEF
OPARM.VDOFLGS
      7518**DCL      7529--REDEF
SC_BADRCD
      7939**DCL-ENT  8165--CALL
SC_BDRCDI
      7947**DCL-ENT  7965--CALL     8087--CALL
SPREAD.HI8
      7953**DCL      8016>>ASSIGN   8018>>ASSIGN   8023>>ASSIGN   8025>>ASSIGN   8027>>ASSIGN
SPREAD.LO8
      7955**DCL      8016>>ASSIGN   8018>>ASSIGN   8023>>ASSIGN   8025>>ASSIGN   8027>>ASSIGN
SSR$RUE
      7932**DCL-ENT  8140--CALL
TP$
      7956**DCL      8005<<ASSIGN   8016>>ASSIGN   8016>>ASSIGN   8018>>ASSIGN   8018>>ASSIGN   8020<<ASSIGN
      8023>>ASSIGN   8023>>ASSIGN   8025>>ASSIGN   8025>>ASSIGN   8026<<ASSIGN   8027>>ASSIGN   8027>>ASSIGN
VDO
      7764**DCL      7981>>ASSIGN

PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:328  
     1764        1        /*T***********************************************************/
     1765        2        /*T*                                                         */
     1766        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1767        4        /*T*                                                         */
     1768        5        /*T***********************************************************/
     1769        6
     1770        7
     1771        8        KIA$ACUP: PROC (NK$LDCT,K$RWPARM) ALTRET;
     1772        9
     1773       10        /*F*
     1774       11             NAME: KIA$ACUP
     1775       12             PURPOSE:
     1776       13                  Updated the accounting information for a LDCT.
     1777       14             DESCRIPTION:
     1778       15                  None.
     1779       16        */
     1780       17
     1781       18        %INCLUDE EL_SUBS_C;
     1782      102        %INCLUDE ES_TABLES_M;
     1783      496        %INCLUDE K$RWPARM;
     1784      882        %INCLUDE KI_DATA_R;
     1785      908        %INCLUDE KL_MACRO_C;
     1786     4260        %INCLUDE KL_SUBS_C;
     1787     4314        %INCLUDE NK$LDCT;
     1788     4416        %INCLUDE NK_LDCT_R;
     1789     4425        %INCLUDE NK_SUBS;
     1790     4450
     1791     4451        %NK$LDCT (STCLASS="");
     1792     4497        %KL_ACCTNG (STCLASS="");
     1793     4511        %K$RWPARM (NAME=K$RWPARM);
     1794     4827        %ES$SYS_EXIT (STCLASS=);
     1795     4841    1   DCL BUBIN BASED ALIGNED UBIN;
     1796     4842    1   DCL TEMP UBIN WORD;
     1797     4843    1   DCL KIA$8TO9 ENTRY(3);
     1798     4844    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
     1799     4845
     1800     4846
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:329  
     1801     4847    1           IF NOT NK$LDCT.ACCTNG
     1802     4848    1             THEN
     1803     4849    1               RETURN;
     1804     4850    1           KL_ACCTNG='0'B;
     1805     4851    1           KL_ACCTNG.REASON=%KLDR_OFF;
     1806     4852    2           IF ADDR(K$RWPARM)=ADDR(NIL) THEN DO;
     1807     4853    2               IF NK$LDCT.DFLG.RLSE OR NOT NK$LDCT.DFLG.FEDN THEN EXIT;
     1808     4854    2               KL_ACCTNG.REASON=%KLDR_FCRSH;
     1809     4855    2               END;
     1810     4856    2             ELSE DO;
     1811     4857    2               IF K$RWPARM.MSG$=ADDR(NIL) THEN EXIT;
     1812     4858    3               DO TEMP=0 TO 3;
     1813     4859    3                 CALL KIA$8TO9 (PINCRW(K$RWPARM.MSG$,TEMP)->BUBIN,
     1814     4860    3                   PINCRW(ADDR(KL_ACCTNG.CHARIN),TEMP)->BUBIN, 4);
     1815     4861    3                 END;
     1816     4862    2               END;
     1817     4863    1           TEMP = LDCT.RLCID.NODE;
     1818     4864    1           KL_ACCTNG.FEX = TEMP;
     1819     4865    1           KL_ACCTNG.DEVNM=LDCT.DEVNM;
     1820     4866    1           KL_ACCTNG.LDCTX=LDCT.LDCTX;
     1821     4867    1           CALL ELA$SYSLOG (EL_DISC,KL_ACCTNG,SIZEW(KL_ACCTNG),'0'B,2,TEMP) ALTRET (
              4867                    ALTRT);
     1822     4868    2           IF NK$LDCT.RESCOD=NK_CGTRM AND NK$LDCT.TERMID.LEV~=2 THEN DO;
     1823     4869        /* LOG SYSEXITS FOR NON-STATION CG TRMS. */
     1824     4870    2               ES$SYS_EXIT = '0'B;
     1825     4871    2               ES$SYS_EXIT.JIT$ = ADDR(NK$LDCT);
     1826     4872    2               CALL ELA$SYSLOG (EL_SYS_EXIT, ES$SYS_EXIT, 2, 0, EL_SEC, TEMP);
     1827     4873    2               END;
     1828     4874    1           NK$LDCT.ACCTNG = '0'B;
     1829     4875    1           RETURN;
     1830     4876    1   ALTRT:  ;
     1831     4877    1           ALTRETURN;
     1832     4878
     1833     4879    1   END KIA$ACUP;
     1834     4880
     1835     4881
     1836     4882        %EOD;
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:330  

PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:331  
--  Include file information  --

   NK_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KL_SUBS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   ES_TABLES_M.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$ACUP.

   Procedure KIA$ACUP requires 102 words for executable code.
   Procedure KIA$ACUP requires 22 words of local(AUTO) storage.

PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:332  

 Object Unit name= KIA$ACUP                                   File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:35:34.88 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   102    146  KIA$ACUP
    1  RoData even  none    10     12  KIA$ACUP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        2  KIA$ACUP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       3 KIA$8TO9
 yes     yes           Std       6 ELA$SYSLOG
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KI_FEI$$                              N$DCT$$                               B_VECTNIL
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:333  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:334  


     1764        1        /*T***********************************************************/
     1765        2        /*T*                                                         */
     1766        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1767        4        /*T*                                                         */
     1768        5        /*T***********************************************************/
     1769        6
     1770        7
     1771        8        KIA$ACUP: PROC (NK$LDCT,K$RWPARM) ALTRET;

      8  0 000000   000000 700200 xent  KIA$ACUP     TSX0  ! X66_AUTO_2
         0 000001   000026 000002                    ZERO    22,2

     1772        9
     1773       10        /*F*
     1774       11             NAME: KIA$ACUP
     1775       12             PURPOSE:
     1776       13                  Updated the accounting information for a LDCT.
     1777       14             DESCRIPTION:
     1778       15                  None.
     1779       16        */
     1780       17
     1781       18        %INCLUDE EL_SUBS_C;
     1782      102        %INCLUDE ES_TABLES_M;
     1783      496        %INCLUDE K$RWPARM;
     1784      882        %INCLUDE KI_DATA_R;
     1785      908        %INCLUDE KL_MACRO_C;
     1786     4260        %INCLUDE KL_SUBS_C;
     1787     4314        %INCLUDE NK$LDCT;
     1788     4416        %INCLUDE NK_LDCT_R;
     1789     4425        %INCLUDE NK_SUBS;
     1790     4450
     1791     4451        %NK$LDCT (STCLASS="");
     1792     4497        %KL_ACCTNG (STCLASS="");
     1793     4511        %K$RWPARM (NAME=K$RWPARM);
     1794     4827        %ES$SYS_EXIT (STCLASS=);
     1795     4841    1   DCL BUBIN BASED ALIGNED UBIN;
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:335  
     1796     4842    1   DCL TEMP UBIN WORD;
     1797     4843    1   DCL KIA$8TO9 ENTRY(3);
     1798     4844    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
     1799     4845
     1800     4846
     1801     4847    1           IF NOT NK$LDCT.ACCTNG

   4847  0 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000003   000007 430100                    FSZN    7,,PR0
         0 000004   000006 604000 0                  TMI     s:4850

     1802     4848    1             THEN
     1803     4849    1               RETURN;

   4849  0 000005   000000 702200 xent               TSX2  ! X66_ARET

     1804     4850    1           KL_ACCTNG='0'B;

   4850  0 000006   000100 100400                    MLR     fill='000'O
         0 000007   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         0 000010   200005 000034                    ADSC9   KL_ACCTNG,,AUTO          cn=0,n=28

     1805     4851    1           KL_ACCTNG.REASON=%KLDR_OFF;

   4851  0 000011   000002 236003                    LDQ     2,DU
         0 000012   200005 552120                    STBQ    KL_ACCTNG,'20'O,AUTO

     1806     4852    2           IF ADDR(K$RWPARM)=ADDR(NIL) THEN DO;

   4852  0 000013   200004 236100                    LDQ     @K$RWPARM,,AUTO
         0 000014   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000015   000026 601000 0                  TNZ     s:4857

     1807     4853    2               IF NK$LDCT.DFLG.RLSE OR NOT NK$LDCT.DFLG.FEDN THEN EXIT;

   4853  0 000016   000006 236100                    LDQ     6,,PR0
         0 000017   000400 316007                    CANQ    256,DL
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:336  
         0 000020   000025 601000 0                  TNZ     s:4855
         0 000021   000020 316007                    CANQ    16,DL
         0 000022   000025 600000 0                  TZE     s:4855

     1808     4854    2               KL_ACCTNG.REASON=%KLDR_FCRSH;

   4854  0 000023   000004 236003                    LDQ     4,DU
         0 000024   200005 552120                    STBQ    KL_ACCTNG,'20'O,AUTO

     1809     4855    2               END;

   4855  0 000025   000055 710000 0                  TRA     s:4863

     1810     4856    2             ELSE DO;

     1811     4857    2               IF K$RWPARM.MSG$=ADDR(NIL) THEN EXIT;

   4857  0 000026   200004 471500                    LDP1    @K$RWPARM,,AUTO
         0 000027   100000 236100                    LDQ     0,,PR1
         0 000030   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000031   000055 600000 0                  TZE     s:4863

     1812     4858    3               DO TEMP=0 TO 3;

   4858  0 000032   200016 450100                    STZ     TEMP,,AUTO

     1813     4859    3                 CALL KIA$8TO9 (PINCRW(K$RWPARM.MSG$,TEMP)->BUBIN,

   4859  0 000033   200004 470500                    LDP0    @K$RWPARM,,AUTO
         0 000034   000000 471500                    LDP1    0,,PR0
         0 000035   000000 236000 1                  LDQ     0
         0 000036   200022 756100                    STQ     TEMP+4,,AUTO
         0 000037   200016 720100                    LXL0    TEMP,,AUTO
         0 000040   200010 633510                    EPPR3   KL_ACCTNG+3,X0,AUTO
         0 000041   200021 453500                    STP3    TEMP+3,,AUTO
         0 000042   100000 634510                    EPPR4   0,X0,PR1
         0 000043   200020 454500                    STP4    TEMP+2,,AUTO
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:337  
         0 000044   200020 630500                    EPPR0   TEMP+2,,AUTO
         0 000045   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000046   000000 701000 xent               TSX1    KIA$8TO9
         0 000047   000000 011000                    NOP     0

     1814     4860    3                   PINCRW(ADDR(KL_ACCTNG.CHARIN),TEMP)->BUBIN, 4);
     1815     4861    3                 END;

   4861  0 000050   200016 235100                    LDA     TEMP,,AUTO
         0 000051   000001 035007                    ADLA    1,DL
         0 000052   200016 755100                    STA     TEMP,,AUTO
         0 000053   000004 115007                    CMPA    4,DL
         0 000054   000033 602000 0                  TNC     s:4859

     1816     4862    2               END;

     1817     4863    1           TEMP = LDCT.RLCID.NODE;

   4863  0 000055   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000056   000015 236100                    LDQ     13,,PR0
         0 000057   000033 772000                    QRL     27
         0 000060   200016 756100                    STQ     TEMP,,AUTO

     1818     4864    1           KL_ACCTNG.FEX = TEMP;

   4864  0 000061   000033 736000                    QLS     27
         0 000062   200005 552140                    STBQ    KL_ACCTNG,'40'O,AUTO

     1819     4865    1           KL_ACCTNG.DEVNM=LDCT.DEVNM;

   4865  0 000063   000002 237100                    LDAQ    2,,PR0
         0 000064   200006 757100                    STAQ    KL_ACCTNG+1,,AUTO

     1820     4866    1           KL_ACCTNG.LDCTX=LDCT.LDCTX;

   4866  0 000065   000006 220100                    LDX0    6,,PR0
         0 000066   200005 440100                    SXL0    KL_ACCTNG,,AUTO
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:338  

     1821     4867    1           CALL ELA$SYSLOG (EL_DISC,KL_ACCTNG,SIZEW(KL_ACCTNG),'0'B,2,TEMP) ALTRET (
              4867                    ALTRT);

   4867  0 000067   200016 631500                    EPPR1   TEMP,,AUTO
         0 000070   200025 451500                    STP1    TEMP+7,,AUTO
         0 000071   000001 236000 1                  LDQ     1
         0 000072   200024 756100                    STQ     TEMP+6,,AUTO
         0 000073   000002 237000 1                  LDAQ    2
         0 000074   200022 757100                    STAQ    TEMP+4,,AUTO
         0 000075   200005 633500                    EPPR3   KL_ACCTNG,,AUTO
         0 000076   200021 453500                    STP3    TEMP+3,,AUTO
         0 000077   000001 236000 1                  LDQ     1
         0 000100   200020 756100                    STQ     TEMP+2,,AUTO
         0 000101   200020 630500                    EPPR0   TEMP+2,,AUTO
         0 000102   000024 631400 xsym               EPPR1   B_VECTNIL+20
         0 000103   000000 701000 xent               TSX1    ELA$SYSLOG
         0 000104   000145 702000 0                  TSX2    ALTRT

     1822     4868    2           IF NK$LDCT.RESCOD=NK_CGTRM AND NK$LDCT.TERMID.LEV~=2 THEN DO;

   4868  0 000105   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000106   000006 236100                    LDQ     6,,PR0
         0 000107   000017 376007                    ANQ     15,DL
         0 000110   000002 116007                    CMPQ    2,DL
         0 000111   000141 601000 0                  TNZ     s:4874
         0 000112   000022 236100                    LDQ     18,,PR0
         0 000113   777000 376003                    ANQ     -512,DU
         0 000114   002000 116003                    CMPQ    1024,DU
         0 000115   000141 600000 0                  TZE     s:4874

     1823     4869        /* LOG SYSEXITS FOR NON-STATION CG TRMS. */
     1824     4870    2               ES$SYS_EXIT = '0'B;

   4870  0 000116   000000 235003                    LDA     0,DU
         0 000117   000000 236003                    LDQ     0,DU
         0 000120   200014 757100                    STAQ    ES$SYS_EXIT,,AUTO
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:339  

     1825     4871    2               ES$SYS_EXIT.JIT$ = ADDR(NK$LDCT);

   4871  0 000121   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000122   200015 756100                    STQ     ES$SYS_EXIT+1,,AUTO

     1826     4872    2               CALL ELA$SYSLOG (EL_SYS_EXIT, ES$SYS_EXIT, 2, 0, EL_SEC, TEMP);

   4872  0 000123   200016 631500                    EPPR1   TEMP,,AUTO
         0 000124   200025 451500                    STP1    TEMP+7,,AUTO
         0 000125   000005 236000 1                  LDQ     5
         0 000126   200024 756100                    STQ     TEMP+6,,AUTO
         0 000127   000006 237000 1                  LDAQ    6
         0 000130   200022 757100                    STAQ    TEMP+4,,AUTO
         0 000131   200014 633500                    EPPR3   ES$SYS_EXIT,,AUTO
         0 000132   200021 453500                    STP3    TEMP+3,,AUTO
         0 000133   000010 236000 1                  LDQ     8
         0 000134   200020 756100                    STQ     TEMP+2,,AUTO
         0 000135   200020 630500                    EPPR0   TEMP+2,,AUTO
         0 000136   000024 631400 xsym               EPPR1   B_VECTNIL+20
         0 000137   000000 701000 xent               TSX1    ELA$SYSLOG
         0 000140   000000 011000                    NOP     0

     1827     4873    2               END;

     1828     4874    1           NK$LDCT.ACCTNG = '0'B;

   4874  0 000141   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000142   000011 236000 1                  LDQ     9
         0 000143   000007 356100                    ANSQ    7,,PR0

     1829     4875    1           RETURN;

   4875  0 000144   000000 702200 xent               TSX2  ! X66_ARET

   4874  0 000145                       ALTRT        null
     1830     4876    1   ALTRT:  ;
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:340  
     1831     4877    1           ALTRETURN;

   4877  0 000145   000000 702200 xent               TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
   1     000   000006 006000   000004 006000   000011 006000   000002 006000    ................
   1     004   000000 000771   000005 006000   000004 006000   000002 006000    ................
   1     010   000004 006000   776777 777777                                    ........
     1832     4878
     1833     4879    1   END KIA$ACUP;
     1834     4880
     1835     4881
     1836     4882        %EOD;

PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:341  
--  Include file information  --

   NK_SUBS.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KL_SUBS_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   K$RWPARM.:E05TOU  is referenced.
   ES_TABLES_M.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$ACUP.
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:342  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
    14-0-0/w STRC(72)    r     1 ES$SYS_EXIT               *0-0-0/d STRC(1404)  r     1 K$RWPARM
     5-0-0/w STRC(252)   r     1 KL_ACCTNG                 *0-0-0/d STRC(864)   r     1 NK$LDCT
    16-0-0/w UBIN        r     1 TEMP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KI_FEI$$                   0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 BUBIN


   Procedure KIA$ACUP requires 102 words for executable code.
   Procedure KIA$ACUP requires 22 words of local(AUTO) storage.
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:343  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:344  
          MINI XREF LISTING

ALTRT
      4874**LABEL    4867--CALLALT
BUBIN
      4841**DCL      4859<>CALL     4859<>CALL
ELA$SYSLOG
      4844**DCL-ENT  4867--CALL     4872--CALL
ES$SYS_EXIT
      4838**DCL      4870<<ASSIGN   4872<>CALL
ES$SYS_EXIT.JIT$
      4838**DCL      4871<<ASSIGN
K$RWPARM
      4532**DCL         8--PROC     4852--IF
K$RWPARM.BLKREC
      4558**DCL      4583--REDEF
K$RWPARM.BLKREC.BLKU#
      4559**DCL      4561--REDEF
K$RWPARM.BLKREC.RECU#
      4571**DCL      4573--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      4598**DCL      4599--REDEF
K$RWPARM.DVE.EOMCHAR
      4606**DCL      4610--REDEF
K$RWPARM.ERR
      4670**DCL      4675--REDEF
K$RWPARM.FC
      4634**DCL      4635--REDEF
K$RWPARM.FLDID
      4816**DCL      4817--REDEF
K$RWPARM.FPT$
      4697**DCL      4704--REDEF
K$RWPARM.KEYTYPE
      4823**DCL      4824--REDEF
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:345  
K$RWPARM.MSG$
      4533**DCL      4539--REDEF    4857>>IF       4859>>CALL
K$RWPARM.MSGID
      4645**DCL      4650--REDEF
K$RWPARM.MSGIDXT
      4658**DCL      4662--REDEF
K$RWPARM.ORG
      4794**DCL      4795--REDEF
K$RWPARM.THDRSZ
      4738**DCL      4742--REDEF
K$RWPARM.VDOFLGS
      4796**DCL      4807--REDEF
KIA$8TO9
      4843**DCL-ENT  4859--CALL
KI_FEI$$
       893**DCL       894--IMP-PTR
KL_ACCTNG
      4498**DCL      4850<<ASSIGN   4867<>CALL     4867--CALL
KL_ACCTNG.CHARIN
      4506**DCL      4859--CALL
KL_ACCTNG.DEVNM
      4502**DCL      4503--REDEF    4865<<ASSIGN
KL_ACCTNG.FEX
      4499**DCL      4864<<ASSIGN
KL_ACCTNG.LDCTX
      4501**DCL      4866<<ASSIGN
KL_ACCTNG.REASON
      4500**DCL      4851<<ASSIGN   4854<<ASSIGN
N$DCT$$
      4423**DCL      4423--IMP-PTR
NK$LDCT
      4464**DCL         8--PROC     4871--ASSIGN
NK$LDCT.ACCTNG
      4474**DCL      4847>>IF       4874<<ASSIGN
NK$LDCT.DDT$
      4466**DCL      4466--REDEF
PL6.E3A0      #005=KIA$ACUP File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:346  
NK$LDCT.DEVNM
      4466**DCL      4865>>ASSIGN
NK$LDCT.DFLG.FEDN
      4472**DCL      4853>>IF
NK$LDCT.DFLG.RLSE
      4471**DCL      4853>>IF
NK$LDCT.IOQ$
      4465**DCL      4466--REDEF
NK$LDCT.LDCTX
      4467**DCL      4467--REDEF    4866>>ASSIGN
NK$LDCT.LKFLG.ABORTED
      4479**DCL      4480--REDEF
NK$LDCT.RESCOD
      4472**DCL      4868>>IF
NK$LDCT.RLCID.LDCTX
      4489**DCL      4489--REDEF
NK$LDCT.RLCID.NODE
      4488**DCL      4863>>ASSIGN
NK$LDCT.STA$
      4485**DCL      4486--REDEF
NK$LDCT.SYMB$
      4464**DCL      4464--REDEF    4464--REDEF    4465--REDEF
NK$LDCT.TERMID.LEV
      4492**DCL      4868>>IF
TEMP
      4842**DCL      4858<<DOINDEX  4859>>CALL     4859>>CALL     4863<<ASSIGN   4864>>ASSIGN   4867<>CALL
      4872<>CALL

PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:347  
     1837        1        /*T***********************************************************/
     1838        2        /*T*                                                         */
     1839        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1840        4        /*T*                                                         */
     1841        5        /*T***********************************************************/
     1842        6
     1843        7
     1844        8
     1845        9
     1846       10        KIA$FCNO: PROC (NK$LDCT,FCN,K$RWPARM) ALTRET;
     1847       11
     1848       12        /*F*
     1849       13             NAME: KIA$FCNO
     1850       14             PURPOSE:
     1851       15                  To output a message with a specific function code.
     1852       16             DESCRIPTION:
     1853       17                  None.
     1854       18        */
     1855       19
     1856       20        %INCLUDE NK$LDCT;
     1857      122        %INCLUDE KV$VDO;
     1858     1137        %INCLUDE KI_DATA_R;
     1859     1163        %INCLUDE NK_SUBS;
     1860     1188        %INCLUDE K_DATA_R;
     1861     1899        %INCLUDE K_SUBS_C;
     1862     1932
     1863     1933        %NK$LDCT (STCLASS="");
     1864     1979        %KV_VDO_E;
     1865     2015        %KV_VDOVLP_E;
     1866     2029        %KV_VDOMRKTYP_E;
     1867     2035        %KV_DATMOD_E;
     1868     2041        %KV_DATCTRCHRTYP_E;
     1869     2047    1   DCL HDR CHAR(100);
     1870     2048        %K$RWPARM (NAME=K$RWPARM);
     1871     2364
     1872     2365    1   DCL FCN UBIN(36);
     1873     2366    1   DCL NFCN UBIN;
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:348  
     1874     2367    1   DCL U UBIN(36);
     1875     2368    1   DCL KIA$OQFL ENTRY(1) ALTRET;
     1876     2369    1   DCL KIS$SEND ENTRY(1) ALTRET;
     1877     2370    1   DCL KIA$VDO ENTRY(3) ALTRET;
     1878     2371
     1879     2372
     1880     2373    1           U=0;
     1881     2374    1           NFCN = %K_WRITE;
     1882     2375    1           GOTO FCNO;
     1883     2376
     1884     2377    1   KIA$FCNOU: ENTRY (LDCT,FCN,K$RWPARM) ALTRET;
     1885     2378
     1886     2379    1           U=1;
     1887     2380    1           NFCN = %K_WRITE;
     1888     2381    1   FCNO:   ;
     1889     2382    1           CALL KIA$VDO (FCN,K$RWPARM,HDR) ALTRET (FCNA);
     1890     2383
     1891     2384    1           K$RWPARM.LDCT$ = ADDR(NK$LDCT);
     1892     2385    1           K$RWPARM.FUNCTION = NFCN;
     1893     2386    1           CALL KIS$SEND (K$RWPARM) ALTRET (FCNA);
     1894     2387    1           RETURN;
     1895     2388
     1896     2389    1   FCNA:   ;
     1897     2390    1           IF U = 0 OR K$RWPARM.ERR ~= %K$QFULL
     1898     2391    1             THEN
     1899     2392    1               ALTRETURN;
     1900     2393    1           CALL KIA$OQFL (LDCT) ALTRET (ALTRT);
     1901     2394    1           GOTO FCNO;
     1902     2395
     1903     2396
     1904     2397    1   ALTRT:  ;
     1905     2398    1           ALTRETURN;
     1906     2399
     1907     2400        %EJECT;
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:349  
     1908     2401    1   KIA$DSC: ENTRY (LDCT,FCN,K$RWPARM) ALTRET;
     1909     2402
     1910     2403    1           U=0;
     1911     2404    1           NFCN = %K_DISCONNECT;
     1912     2405    1           GOTO FCNO;
     1913     2406
     1914     2407    1   KIA$DSCU: ENTRY (LDCT,FCN,K$RWPARM) ALTRET;
     1915     2408
     1916     2409    1           U = 1;
     1917     2410    1           NFCN = %K_DISCONNECT;
     1918     2411    1           GOTO FCNO;
     1919     2412
     1920     2413    1   END KIA$FCNO;
     1921     2414
     1922     2415
     1923     2416        %EOD;

PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:350  
--  Include file information  --

   K_SUBS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$FCNO.

   Procedure KIA$FCNO requires 55 words for executable code.
   Procedure KIA$FCNO requires 38 words of local(AUTO) storage.

PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:351  

 Object Unit name= KIA$FCNO                                   File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:35:55.52 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    55     67  KIA$FCNO

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        3  KIA$FCNO
     0      6          yes     yes      Std        3  KIA$FCNOU
     0     52          yes     yes      Std        3  KIA$DSC
     0     60          yes     yes      Std        3  KIA$DSCU

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KIA$VDO
 yes     yes           Std       1 KIS$SEND
 yes     yes           Std       1 KIA$OQFL
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:352  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KI_FEI$$                              B_VECTNIL
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:353  


     1837        1        /*T***********************************************************/
     1838        2        /*T*                                                         */
     1839        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1840        4        /*T*                                                         */
     1841        5        /*T***********************************************************/
     1842        6
     1843        7
     1844        8
     1845        9
     1846       10        KIA$FCNO: PROC (NK$LDCT,FCN,K$RWPARM) ALTRET;

     10  0 000000   000000 700200 xent  KIA$FCNO     TSX0  ! X66_AUTO_3
         0 000001   000046 000003                    ZERO    38,3

     1847       11
     1848       12        /*F*
     1849       13             NAME: KIA$FCNO
     1850       14             PURPOSE:
     1851       15                  To output a message with a specific function code.
     1852       16             DESCRIPTION:
     1853       17                  None.
     1854       18        */
     1855       19
     1856       20        %INCLUDE NK$LDCT;
     1857      122        %INCLUDE KV$VDO;
     1858     1137        %INCLUDE KI_DATA_R;
     1859     1163        %INCLUDE NK_SUBS;
     1860     1188        %INCLUDE K_DATA_R;
     1861     1899        %INCLUDE K_SUBS_C;
     1862     1932
     1863     1933        %NK$LDCT (STCLASS="");
     1864     1979        %KV_VDO_E;
     1865     2015        %KV_VDOVLP_E;
     1866     2029        %KV_VDOMRKTYP_E;
     1867     2035        %KV_DATMOD_E;
     1868     2041        %KV_DATCTRCHRTYP_E;
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:354  
     1869     2047    1   DCL HDR CHAR(100);
     1870     2048        %K$RWPARM (NAME=K$RWPARM);
     1871     2364
     1872     2365    1   DCL FCN UBIN(36);
     1873     2366    1   DCL NFCN UBIN;
     1874     2367    1   DCL U UBIN(36);
     1875     2368    1   DCL KIA$OQFL ENTRY(1) ALTRET;
     1876     2369    1   DCL KIS$SEND ENTRY(1) ALTRET;
     1877     2370    1   DCL KIA$VDO ENTRY(3) ALTRET;
     1878     2371
     1879     2372
     1880     2373    1           U=0;

   2373  0 000002   200040 450100                    STZ     U,,AUTO

     1881     2374    1           NFCN = %K_WRITE;

   2374  0 000003   000001 235007                    LDA     1,DL
         0 000004   200037 755100                    STA     NFCN,,AUTO

     1882     2375    1           GOTO FCNO;

   2375  0 000005   000013 710000 0                  TRA     FCNO

     1883     2376
     1884     2377    1   KIA$FCNOU: ENTRY (LDCT,FCN,K$RWPARM) ALTRET;

   2377  0 000006   000000 700200 xent  KIA$FCNOU    TSX0  ! X66_AUTO_3
         0 000007   000046 000003                    ZERO    38,3

     1885     2378
     1886     2379    1           U=1;

   2379  0 000010   000001 235007                    LDA     1,DL
         0 000011   200040 755100                    STA     U,,AUTO

     1887     2380    1           NFCN = %K_WRITE;
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:355  

   2380  0 000012   200037 755100                    STA     NFCN,,AUTO

   2380  0 000013                       FCNO         null
     1888     2381    1   FCNO:   ;
     1889     2382    1           CALL KIA$VDO (FCN,K$RWPARM,HDR) ALTRET (FCNA);

   2382  0 000013   200006 630500                    EPPR0   HDR,,AUTO
         0 000014   200044 450500                    STP0    U+4,,AUTO
         0 000015   200004 237100                    LDAQ    @FCN,,AUTO
         0 000016   200042 757100                    STAQ    U+2,,AUTO
         0 000017   200042 630500                    EPPR0   U+2,,AUTO
         0 000020   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000021   000000 701000 xent               TSX1    KIA$VDO
         0 000022   000035 702000 0                  TSX2    FCNA

     1890     2383
     1891     2384    1           K$RWPARM.LDCT$ = ADDR(NK$LDCT);

   2384  0 000023   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000024   200005 470500                    LDP0    @K$RWPARM,,AUTO
         0 000025   000016 756100                    STQ     14,,PR0

     1892     2385    1           K$RWPARM.FUNCTION = NFCN;

   2385  0 000026   200037 235100                    LDA     NFCN,,AUTO
         0 000027   000020 755100                    STA     16,,PR0

     1893     2386    1           CALL KIS$SEND (K$RWPARM) ALTRET (FCNA);

   2386  0 000030   200005 630500                    EPPR0   @K$RWPARM,,AUTO
         0 000031   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000032   000000 701000 xent               TSX1    KIS$SEND
         0 000033   000035 702000 0                  TSX2    FCNA

     1894     2387    1           RETURN;

PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:356  
   2387  0 000034   000000 702200 xent               TSX2  ! X66_ARET

   2385  0 000035                       FCNA         null
     1895     2388
     1896     2389    1   FCNA:   ;
     1897     2390    1           IF U = 0 OR K$RWPARM.ERR ~= %K$QFULL

   2390  0 000035   200040 235100                    LDA     U,,AUTO
         0 000036   000043 600000 0                  TZE     s:2392
         0 000037   200005 470500                    LDP0    @K$RWPARM,,AUTO
         0 000040   000013 235100                    LDA     11,,PR0
         0 000041   000001 115007                    CMPA    1,DL
         0 000042   000044 600000 0                  TZE     s:2393

     1898     2391    1             THEN
     1899     2392    1               ALTRETURN;

   2392  0 000043   000000 702200 xent               TSX2  ! X66_AALT

     1900     2393    1           CALL KIA$OQFL (LDCT) ALTRET (ALTRT);

   2393  0 000044   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         0 000045   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000046   000000 701000 xent               TSX1    KIA$OQFL
         0 000047   000051 702000 0                  TSX2    ALTRT

     1901     2394    1           GOTO FCNO;

   2394  0 000050   000013 710000 0                  TRA     FCNO

   2390  0 000051                       ALTRT        null
     1902     2395
     1903     2396
     1904     2397    1   ALTRT:  ;
     1905     2398    1           ALTRETURN;

   2398  0 000051   000000 702200 xent               TSX2  ! X66_AALT
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:357  

     1906     2399
     1907     2400        %EJECT;
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:358  
     1908     2401    1   KIA$DSC: ENTRY (LDCT,FCN,K$RWPARM) ALTRET;

   2401  0 000052   000000 700200 xent  KIA$DSC      TSX0  ! X66_AUTO_3
         0 000053   000046 000003                    ZERO    38,3

     1909     2402
     1910     2403    1           U=0;

   2403  0 000054   200040 450100                    STZ     U,,AUTO

     1911     2404    1           NFCN = %K_DISCONNECT;

   2404  0 000055   000004 235007                    LDA     4,DL
         0 000056   200037 755100                    STA     NFCN,,AUTO

     1912     2405    1           GOTO FCNO;

   2405  0 000057   000013 710000 0                  TRA     FCNO

     1913     2406
     1914     2407    1   KIA$DSCU: ENTRY (LDCT,FCN,K$RWPARM) ALTRET;

   2407  0 000060   000000 700200 xent  KIA$DSCU     TSX0  ! X66_AUTO_3
         0 000061   000046 000003                    ZERO    38,3

     1915     2408
     1916     2409    1           U = 1;

   2409  0 000062   000001 235007                    LDA     1,DL
         0 000063   200040 755100                    STA     U,,AUTO

     1917     2410    1           NFCN = %K_DISCONNECT;

   2410  0 000064   000004 236007                    LDQ     4,DL
         0 000065   200037 756100                    STQ     NFCN,,AUTO

     1918     2411    1           GOTO FCNO;
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:359  

   2411  0 000066   000013 710000 0                  TRA     FCNO
     1919     2412
     1920     2413    1   END KIA$FCNO;
     1921     2414
     1922     2415
     1923     2416        %EOD;

PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:360  
--  Include file information  --

   K_SUBS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$FCNO.
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:361  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @FCN                       5-0-0/w PTR         r     1 @K$RWPARM
     3-0-0/w PTR         r     1 @NK$LDCT                  *0-0-0/w UBIN        r     1 FCN
     6-0-0/c CHAR(100)   r     1 HDR                       *0-0-0/d STRC(1404)  r     1 K$RWPARM
    37-0-0/w UBIN        r     1 NFCN                      *0-0-0/d STRC(864)   r     1 NK$LDCT
    40-0-0/w UBIN        r     1 U

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KI_FEI$$


   Procedure KIA$FCNO requires 55 words for executable code.
   Procedure KIA$FCNO requires 38 words of local(AUTO) storage.
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:362  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:363  
          MINI XREF LISTING

ALTRT
      2390**LABEL    2393--CALLALT
FCN
      2365**DCL        10--PROC     2377--ENTRY    2382<>CALL     2401--ENTRY    2407--ENTRY
FCNA
      2385**LABEL    2382--CALLALT  2386--CALLALT
FCNO
      2380**LABEL    2375--GOTO     2394--GOTO     2405--GOTO     2411--GOTO
HDR
      2047**DCL      2382<>CALL
K$RWPARM
      2069**DCL        10--PROC     2377--ENTRY    2382<>CALL     2386<>CALL     2401--ENTRY    2407--ENTRY
K$RWPARM.BLKREC
      2095**DCL      2120--REDEF
K$RWPARM.BLKREC.BLKU#
      2096**DCL      2098--REDEF
K$RWPARM.BLKREC.RECU#
      2108**DCL      2110--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      2135**DCL      2136--REDEF
K$RWPARM.DVE.EOMCHAR
      2143**DCL      2147--REDEF
K$RWPARM.ERR
      2207**DCL      2212--REDEF    2390>>IF
K$RWPARM.FC
      2171**DCL      2172--REDEF
K$RWPARM.FLDID
      2353**DCL      2354--REDEF
K$RWPARM.FPT$
      2234**DCL      2241--REDEF
K$RWPARM.FUNCTION
      2248**DCL      2385<<ASSIGN
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:364  
K$RWPARM.KEYTYPE
      2360**DCL      2361--REDEF
K$RWPARM.LDCT$
      2230**DCL      2384<<ASSIGN
K$RWPARM.MSG$
      2070**DCL      2076--REDEF
K$RWPARM.MSGID
      2182**DCL      2187--REDEF
K$RWPARM.MSGIDXT
      2195**DCL      2199--REDEF
K$RWPARM.ORG
      2331**DCL      2332--REDEF
K$RWPARM.THDRSZ
      2275**DCL      2279--REDEF
K$RWPARM.VDOFLGS
      2333**DCL      2344--REDEF
KIA$OQFL
      2368**DCL-ENT  2393--CALL
KIA$VDO
      2370**DCL-ENT  2382--CALL
KIS$SEND
      2369**DCL-ENT  2386--CALL
KI_FEI$$
      1148**DCL      1149--IMP-PTR
K_RWPARM_CON.BLKREC
      1629**DCL      1654--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      1630**DCL      1632--REDEF
K_RWPARM_CON.BLKREC.RECU#
      1642**DCL      1644--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      1669**DCL      1670--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      1677**DCL      1681--REDEF
K_RWPARM_CON.ERR
      1741**DCL      1746--REDEF
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:365  
K_RWPARM_CON.FC
      1705**DCL      1706--REDEF
K_RWPARM_CON.FLDID
      1887**DCL      1888--REDEF
K_RWPARM_CON.FPT$
      1768**DCL      1775--REDEF
K_RWPARM_CON.KEYTYPE
      1894**DCL      1895--REDEF
K_RWPARM_CON.MSG$
      1604**DCL      1610--REDEF
K_RWPARM_CON.MSGID
      1716**DCL      1721--REDEF
K_RWPARM_CON.MSGIDXT
      1729**DCL      1733--REDEF
K_RWPARM_CON.ORG
      1865**DCL      1866--REDEF
K_RWPARM_CON.THDRSZ
      1809**DCL      1813--REDEF
K_RWPARM_CON.VDOFLGS
      1867**DCL      1878--REDEF
NFCN
      2366**DCL      2374<<ASSIGN   2380<<ASSIGN   2385>>ASSIGN   2404<<ASSIGN   2410<<ASSIGN
NK$LDCT
      1946**DCL        10--PROC     2377--ENTRY    2384--ASSIGN   2393<>CALL     2401--ENTRY    2407--ENTRY
NK$LDCT.DDT$
      1948**DCL      1948--REDEF
NK$LDCT.IOQ$
      1947**DCL      1948--REDEF
NK$LDCT.LDCTX
      1949**DCL      1949--REDEF
NK$LDCT.LKFLG.ABORTED
      1961**DCL      1962--REDEF
NK$LDCT.RLCID.LDCTX
      1971**DCL      1971--REDEF
NK$LDCT.STA$
      1967**DCL      1968--REDEF
PL6.E3A0      #006=KIA$FCNO File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:35 Page:366  
NK$LDCT.SYMB$
      1946**DCL      1946--REDEF    1946--REDEF    1947--REDEF
U
      2367**DCL      2373<<ASSIGN   2379<<ASSIGN   2390>>IF       2403<<ASSIGN   2409<<ASSIGN

PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:367  
     1924        1        /*T***********************************************************/
     1925        2        /*T*                                                         */
     1926        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1927        4        /*T*                                                         */
     1928        5        /*T***********************************************************/
     1929        6
     1930        7
     1931        8        KIA$OQFL: PROC (NK$LDCT) ALTRET;
     1932        9
     1933       10        /*F*
     1934       11             NAME: KIA$OQFL
     1935       12             PURPOSE:
     1936       13                  The routine will reg the user pending space in the output circular
     1937       14                  queue.
     1938       15             DESCRIPTION:
     1939       16                  None.
     1940       17        */
     1941       18
     1942       19        %INCLUDE NK$LDCT;
     1943      121        %INCLUDE HF_LOCK_C;
     1944      135        %INCLUDE KI_DATA_R;
     1945      161        %INCLUDE SS_SCHED_C;
     1946      394        %INCLUDE NK_SUBS;
     1947      419        %INCLUDE K_DATA_R;
     1948     1130
     1949     1131        %NK$LDCT (STCLASS="");
     1950     1177    1   DCL S_CUN UBIN SYMREF;
     1951     1178
     1952     1179
     1953     1180    1   DCL SSR$REG ENTRY(3) ALTRET;
     1954     1181
     1955     1182
     1956     1183    1           IF LDCT.LKFLG.QNFL
     1957     1184    2             THEN DO;
     1958     1185    2               LDCT.LKFLG.QNFL = '0'B;
     1959     1186    2               RETURN;
     1960     1187    2               END;
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:368  
     1961     1188    2           IF LDCT.DFLG.FEDN THEN DO;
     1962     1189    2               ALTRETURN;
     1963     1190    2               END;
     1964     1191        /* SS WILL UNLOCK NK$LDCT.LOCK */
     1965     1192    1           IF NK$LDCT.USER = S_CUN
     1966     1193    1             THEN
     1967     1194    1               CALL SSR$REG (%SS_CBL,ADDR(LDCT))
     1968     1195    2                 WHENALTRETURN DO;
     1969     1196                        %LOCK (G=NK$LDCT.LOCK);
     1970     1199    2                   ALTRETURN;
     1971     1200    2                   END;
     1972     1201    2             ELSE DO;
     1973     1202                    %UNLOCK (G=NK$LDCT.LOCK);
     1974     1205    2               CALL SSR$REG (%SS_CBF,ADDR(LDCT))
     1975     1206    3                 WHENALTRETURN DO;
     1976     1207                        %LOCK (G=NK$LDCT.LOCK);
     1977     1210    3                   ALTRETURN;
     1978     1211    3                   END;
     1979     1212    2               IF LDCT.DFLG.FEDN
     1980     1213    3                 THEN DO;
     1981     1214                        %LOCK (G=NK$LDCT.LOCK);
     1982     1217    3                   ALTRETURN;
     1983     1218    3                   END;
     1984     1219    2               END;
     1985     1220                %LOCK (G=NK$LDCT.LOCK);
     1986     1223    1           RETURN;
     1987     1224
     1988     1225    1   END KIA$OQFL;
     1989     1226
     1990     1227
     1991     1228        %EOD;

PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:369  
--  Include file information  --

   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$OQFL.

   Procedure KIA$OQFL requires 84 words for executable code.
   Procedure KIA$OQFL requires 8 words of local(AUTO) storage.

PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:370  

 Object Unit name= KIA$OQFL                                   File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:36:12.48 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    84    124  KIA$OQFL
    1  RoData even  none     4      4  KIA$OQFL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  KIA$OQFL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 SSR$REG
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KI_FEI$$                              S_CUN                                 B_VECTNIL
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:371  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:372  


     1924        1        /*T***********************************************************/
     1925        2        /*T*                                                         */
     1926        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1927        4        /*T*                                                         */
     1928        5        /*T***********************************************************/
     1929        6
     1930        7
     1931        8        KIA$OQFL: PROC (NK$LDCT) ALTRET;

      8  0 000000   000000 700200 xent  KIA$OQFL     TSX0  ! X66_AUTO_1
         0 000001   000010 000001                    ZERO    8,1

     1932        9
     1933       10        /*F*
     1934       11             NAME: KIA$OQFL
     1935       12             PURPOSE:
     1936       13                  The routine will reg the user pending space in the output circular
     1937       14                  queue.
     1938       15             DESCRIPTION:
     1939       16                  None.
     1940       17        */
     1941       18
     1942       19        %INCLUDE NK$LDCT;
     1943      121        %INCLUDE HF_LOCK_C;
     1944      135        %INCLUDE KI_DATA_R;
     1945      161        %INCLUDE SS_SCHED_C;
     1946      394        %INCLUDE NK_SUBS;
     1947      419        %INCLUDE K_DATA_R;
     1948     1130
     1949     1131        %NK$LDCT (STCLASS="");
     1950     1177    1   DCL S_CUN UBIN SYMREF;
     1951     1178
     1952     1179
     1953     1180    1   DCL SSR$REG ENTRY(3) ALTRET;
     1954     1181
     1955     1182
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:373  
     1956     1183    1           IF LDCT.LKFLG.QNFL

   1183  0 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000003   000011 236100                    LDQ     9,,PR0
         0 000004   040000 316003                    CANQ    16384,DU
         0 000005   000011 600000 0                  TZE     s:1188

     1957     1184    2             THEN DO;

     1958     1185    2               LDCT.LKFLG.QNFL = '0'B;

   1185  0 000006   000000 236000 1                  LDQ     0
         0 000007   000011 356100                    ANSQ    9,,PR0

     1959     1186    2               RETURN;

   1186  0 000010   000000 702200 xent               TSX2  ! X66_ARET

     1960     1187    2               END;
     1961     1188    2           IF LDCT.DFLG.FEDN THEN DO;

   1188  0 000011   000006 236100                    LDQ     6,,PR0
         0 000012   000020 316007                    CANQ    16,DL
         0 000013   000015 600000 0                  TZE     s:1192

     1962     1189    2               ALTRETURN;

   1189  0 000014   000000 702200 xent               TSX2  ! X66_AALT

     1963     1190    2               END;
     1964     1191        /* SS WILL UNLOCK NK$LDCT.LOCK */
     1965     1192    1           IF NK$LDCT.USER = S_CUN

   1192  0 000015   000007 236100                    LDQ     7,,PR0
         0 000016   000022 772000                    QRL     18
         0 000017   000777 376007                    ANQ     511,DL
         0 000020   000000 116000 xsym               CMPQ    S_CUN
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:374  
         0 000021   000046 601000 0                  TNZ     s:1203

     1966     1193    1             THEN
     1967     1194    1               CALL SSR$REG (%SS_CBL,ADDR(LDCT))

   1194  0 000022   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000023   200004 756100                    STQ     @NK$LDCT+1,,AUTO
         0 000024   200004 631500                    EPPR1   @NK$LDCT+1,,AUTO
         0 000025   200007 451500                    STP1    @NK$LDCT+4,,AUTO
         0 000026   000001 236000 1                  LDQ     1
         0 000027   200006 756100                    STQ     @NK$LDCT+3,,AUTO
         0 000030   200006 630500                    EPPR0   @NK$LDCT+3,,AUTO
         0 000031   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000032   000000 701000 xent               TSX1    SSR$REG
         0 000033   000035 702000 0                  TSX2    s:1197
         0 000034   000045 710000 0                  TRA     s:1199+1

     1968     1195    2                 WHENALTRETURN DO;

     1969     1196                        %LOCK (G=NK$LDCT.LOCK);

   1197  0 000035   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000036   000020 036003                    ADLQ    16,DU
         0 000037   200004 756100                    STQ     @NK$LDCT+1,,AUTO
         0 000040   200004 630500                    EPPR0   @NK$LDCT+1,,AUTO
         0 000041   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000042   000000 701000 xent               TSX1    HFC$LOCK
         0 000043   000000 011000                    NOP     0

     1970     1199    2                   ALTRETURN;

   1199  0 000044   000000 702200 xent               TSX2  ! X66_AALT
         0 000045   000114 710000 0                  TRA     s:1221

     1971     1200    2                   END;
     1972     1201    2             ELSE DO;

PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:375  
     1973     1202                    %UNLOCK (G=NK$LDCT.LOCK);

   1203  0 000046   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000047   000020 036003                    ADLQ    16,DU
         0 000050   200004 756100                    STQ     @NK$LDCT+1,,AUTO
         0 000051   200004 630500                    EPPR0   @NK$LDCT+1,,AUTO
         0 000052   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000053   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000054   000000 011000                    NOP     0

     1974     1205    2               CALL SSR$REG (%SS_CBF,ADDR(LDCT))

   1205  0 000055   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000056   200004 756100                    STQ     @NK$LDCT+1,,AUTO
         0 000057   200004 630500                    EPPR0   @NK$LDCT+1,,AUTO
         0 000060   200007 450500                    STP0    @NK$LDCT+4,,AUTO
         0 000061   000003 236000 1                  LDQ     3
         0 000062   200006 756100                    STQ     @NK$LDCT+3,,AUTO
         0 000063   200006 630500                    EPPR0   @NK$LDCT+3,,AUTO
         0 000064   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000065   000000 701000 xent               TSX1    SSR$REG
         0 000066   000070 702000 0                  TSX2    s:1208
         0 000067   000100 710000 0                  TRA     s:1212

     1975     1206    3                 WHENALTRETURN DO;

     1976     1207                        %LOCK (G=NK$LDCT.LOCK);

   1208  0 000070   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000071   000020 036003                    ADLQ    16,DU
         0 000072   200004 756100                    STQ     @NK$LDCT+1,,AUTO
         0 000073   200004 630500                    EPPR0   @NK$LDCT+1,,AUTO
         0 000074   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000075   000000 701000 xent               TSX1    HFC$LOCK
         0 000076   000000 011000                    NOP     0

     1977     1210    3                   ALTRETURN;
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:376  

   1210  0 000077   000000 702200 xent               TSX2  ! X66_AALT

     1978     1211    3                   END;
     1979     1212    2               IF LDCT.DFLG.FEDN

   1212  0 000100   200003 470500                    LDP0    @NK$LDCT,,AUTO
         0 000101   000006 236100                    LDQ     6,,PR0
         0 000102   000020 316007                    CANQ    16,DL
         0 000103   000114 600000 0                  TZE     s:1221

     1980     1213    3                 THEN DO;

     1981     1214                        %LOCK (G=NK$LDCT.LOCK);

   1215  0 000104   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000105   000020 036003                    ADLQ    16,DU
         0 000106   200004 756100                    STQ     @NK$LDCT+1,,AUTO
         0 000107   200004 630500                    EPPR0   @NK$LDCT+1,,AUTO
         0 000110   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000111   000000 701000 xent               TSX1    HFC$LOCK
         0 000112   000000 011000                    NOP     0

     1982     1217    3                   ALTRETURN;

   1217  0 000113   000000 702200 xent               TSX2  ! X66_AALT

     1983     1218    3                   END;
     1984     1219    2               END;
     1985     1220                %LOCK (G=NK$LDCT.LOCK);

   1221  0 000114   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000115   000020 036003                    ADLQ    16,DU
         0 000116   200004 756100                    STQ     @NK$LDCT+1,,AUTO
         0 000117   200004 630500                    EPPR0   @NK$LDCT+1,,AUTO
         0 000120   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000121   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:377  
         0 000122   000000 011000                    NOP     0

     1986     1223    1           RETURN;

   1223  0 000123   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   737777 777777   000011 006000   000000 000076   000002 006000    ...........>....
     1987     1224
     1988     1225    1   END KIA$OQFL;
     1989     1226
     1990     1227
     1991     1228        %EOD;

PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:378  
--  Include file information  --

   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$OQFL.
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:379  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NK$LDCT                  *0-0-0/d STRC(864)   r     1 NK$LDCT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KI_FEI$$                   0-0-0/w UBIN        r     1 S_CUN


   Procedure KIA$OQFL requires 84 words for executable code.
   Procedure KIA$OQFL requires 8 words of local(AUTO) storage.
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:380  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:381  
          MINI XREF LISTING

HFC$LOCK
       134**DCL-ENT  1197--CALL     1208--CALL     1215--CALL     1221--CALL
HFC$UNLOCK
       134**DCL-ENT  1203--CALL
KI_FEI$$
       146**DCL       147--IMP-PTR
K_RWPARM_CON.BLKREC
       860**DCL       885--REDEF
K_RWPARM_CON.BLKREC.BLKU#
       861**DCL       863--REDEF
K_RWPARM_CON.BLKREC.RECU#
       873**DCL       875--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
       900**DCL       901--REDEF
K_RWPARM_CON.DVE.EOMCHAR
       908**DCL       912--REDEF
K_RWPARM_CON.ERR
       972**DCL       977--REDEF
K_RWPARM_CON.FC
       936**DCL       937--REDEF
K_RWPARM_CON.FLDID
      1118**DCL      1119--REDEF
K_RWPARM_CON.FPT$
       999**DCL      1006--REDEF
K_RWPARM_CON.KEYTYPE
      1125**DCL      1126--REDEF
K_RWPARM_CON.MSG$
       835**DCL       841--REDEF
K_RWPARM_CON.MSGID
       947**DCL       952--REDEF
K_RWPARM_CON.MSGIDXT
       960**DCL       964--REDEF
PL6.E3A0      #007=KIA$OQFL File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:36 Page:382  
K_RWPARM_CON.ORG
      1096**DCL      1097--REDEF
K_RWPARM_CON.THDRSZ
      1040**DCL      1044--REDEF
K_RWPARM_CON.VDOFLGS
      1098**DCL      1109--REDEF
NK$LDCT
      1144**DCL         8--PROC     1194--CALL     1205--CALL
NK$LDCT.DDT$
      1146**DCL      1146--REDEF
NK$LDCT.DFLG.FEDN
      1152**DCL      1188>>IF       1212>>IF
NK$LDCT.IOQ$
      1145**DCL      1146--REDEF
NK$LDCT.LDCTX
      1147**DCL      1147--REDEF
NK$LDCT.LKFLG.ABORTED
      1159**DCL      1160--REDEF
NK$LDCT.LKFLG.QNFL
      1160**DCL      1183>>IF       1185<<ASSIGN
NK$LDCT.LOCK
      1172**DCL      1197<>CALL     1203<>CALL     1208<>CALL     1215<>CALL     1221<>CALL
NK$LDCT.RLCID.LDCTX
      1169**DCL      1169--REDEF
NK$LDCT.STA$
      1165**DCL      1166--REDEF
NK$LDCT.SYMB$
      1144**DCL      1144--REDEF    1144--REDEF    1145--REDEF
NK$LDCT.USER
      1154**DCL      1192>>IF
SSR$REG
      1180**DCL-ENT  1194--CALL     1205--CALL
S_CUN
      1177**DCL      1192>>IF

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:383  
     1992        1        /*T***********************************************************/
     1993        2        /*T*                                                         */
     1994        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1995        4        /*T*                                                         */
     1996        5        /*T***********************************************************/
     1997        6
     1998        7
     1999        8        KIA$MSG: PROC (K$RWPARM) ALTRET;
     2000        9
     2001       10        /*F*
     2002       11             NAME: KIA$MSG
     2003       12             PURPOSE:
     2004       13                  This routine decodes an read response and merges the information
     2005       14                  into K$RWPARM.
     2006       15             DESCRIPTION:
     2007       16                  None.
     2008       17        */
     2009       18
     2010       19        %INCLUDE CP_6_SUBS;
     2011      559        %INCLUDE KV$VDO;
     2012     1574        %INCLUDE K$RWPARM;
     2013     1960        %INCLUDE KI$CP6V_C;
     2014     2399        %INCLUDE KV_PRMID_E;
     2015     2573        %KV_PRMID_E;
     2016     2729        %INCLUDE KI_DATA_R;
     2017     2755        %INCLUDE UM_CP6;
     2018     3607
     2019     3608        %VLP$EDTCTL_V (FPTN=VLP$EDTCTL, FILCHRS=0, ALGN=CALIGNED);
     2020     3628        %VLP$WINDOW_V (FPTN=VLP$WINDOW, FILCHRS=0, ALGN=CALIGNED);
     2021     3650        %K$RWPARM (NAME=K$RWPARM);
     2022     3966        %KV_VDO_E;
     2023     4002        %KV_VDOVLP_E;
     2024     4016        %KV_VDOMRKTYP_E;
     2025     4022        %KV_DATMOD_E;
     2026     4028        %KV_DATCTRCHRTYP_E;
     2027     4034        %VLP_ERRCODE (FPTN=VLP$ERRCODE,STCLASS=BASED);
     2028     4079
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:384  
     2029     4080        /* Table size of all vdos */
     2030     4081        %KV_VDOBYTSIZ (NAME=KI_VDOBYTSIZ,STCLASS=SYMREF);
     2031     4101        %KV$VDO_DAT (NAME=KV$CQVDO_DAT, STCLASS="BASED(K$RWPARM.UHDR$)");
     2032     4146        %KV$VDOVLP;
     2033     4182        %KV$VDOVLP_ACTPOS (STCLASS="BASED(MSG$)");
     2034     4233        %KV$VDOVLP_CG_MSGID (STCLASS="BASED(MSG$)");
     2035     4285        %KV$VDOVLP_CG_MSGTYP (STCLASS="BASED(MSG$)");
     2036     4337        %KV$VDOVLP_CG_STA (STCLASS="BASED(MSG$)");
     2037     4388        %KV$VDOVLP_DAT1 (STCLASS="BASED(MSG$)",LAST=",");
     2038     4438    1         2 MSG CHAR(K$RWPARM.MSGSZ);
     2039     4439        %KV$VDOVLP_DAT2 (STCLASS="BASED(MSG$)",LAST=",");
     2040     4489    1         2 MSG CHAR(K$RWPARM.MSGSZ);
     2041     4490        %KV$VDOVLP_ERR (STCLASS="BASED(MSG$)");
     2042     4586        %KV$VDOVLP_FLDID (STCLASS="BASED(MSG$)");
     2043     4637        %KV$VDOVLP_KEY (STCLASS="BASED(MSG$)",LAST=",");
     2044     4687    1         2 KEY CHAR(K$RWPARM.KEYSZ);
     2045     4688    1   DCL 1 CNT CALIGNED BASED,
     2046     4689    1         2 * BIT(1),
     2047     4690    1         2 N SBIN(8) UNAL;
     2048     4691        %KV$VDOVLP_MRK (STCLASS="BASED(MSG$)");
     2049     4744        %KV$VDOVLP_ENTSRD(STCLASS="BASED(MSG$)",LAST=",");
     2050     4794    1         2 MSG CHAR(KV$VDOVLP_ENTSRD.BYTSIZ);
     2051     4795
     2052     4796
     2053     4797    1   DCL MSG$ PTR;
     2054     4798    1   DCL B$HWORD UBIN(18) BASED HALIGNED;
     2055     4799    1   DCL TMP_SZ UBIN/*(18) til PL6 does it right */;
     2056     4800    1   DCL END_VDO UBIN/*(18) til PL6 does it right */;
     2057     4801    1   DCL 1 CVT BASED HALIGNED,
     2058     4802    1         2 HOST,
     2059     4803    1           3 * BIT(1),
     2060     4804    1           3 HI BIT(9),
     2061     4805    1           3 LO BIT(8),
     2062     4806    1         2 FEP REDEF HOST,
     2063     4807    1           3 HI BIT(9),
     2064     4808    1           3 LO BIT(9),
     2065     4809    1         2 HOSTL,
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:385  
     2066     4810    1           3 * BIT(1),
     2067     4811    1           3 HI BIT(9),
     2068     4812    1           3 LO BIT(8),
     2069     4813    1         2 FEPL REDEF HOSTL,
     2070     4814    1           3 HI BIT(9),
     2071     4815    1           3 LO BIT(9);
     2072     4816        %KV$VDO_DAT (STCLASS="");
     2073     4861        %KV$VDO_DAT (NAME=KV$VDO, STCLASS=REDEF KV$VDO_DAT);
     2074     4906    1   DCL ERR BIT(36);
     2075     4907    1   DCL 1 TYC,
     2076     4908    1         2 TYCBIT(0:35) BIT(1) UNAL;
     2077     4909
     2078     4910        /* Entries */
     2079     4911    1   DCL EMR$FEP2HOST ENTRY(2);
     2080     4912    1   DCL KIA$8TO9 ENTRY(3);
     2081     4913
     2082     4914
     2083     4915    1           KV$VDO_DAT = KV$CQVDO_DAT;
     2084     4916    1           TMP_SZ = KI_VDOBYTSIZ(KV$VDO_DAT.FNC);
     2085     4917    1           END_VDO = K$RWPARM.UHDRSZ;
     2086     4918    1           END_VDO = END_VDO+MOD(END_VDO,2);
     2087     4919    1           IF KV$VDO.FNC = 0 OR KV$VDO.FNC > %KV_VDO_FNC_HI OR END_VDO < TMP_SZ
     2088     4920    2             THEN DO;
     2089     4921    2               CALL PROTOCOL_ERR;
     2090     4922    2               ALTRETURN;
     2091     4923    2               END;
     2092     4924    1           K$RWPARM.STR = KV$VDO.STR;
     2093     4925
     2094     4926    2           IF KV$VDO.FNC = %KV_VDO_FNC_DAT THEN DO;
     2095     4927    2               IF KV$VDO_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_ACT
     2096     4928    2                 THEN
     2097     4929    2                   K$RWPARM.DVE.EOMCHAR = KV$VDO_DAT.DATCTRCHR;
     2098     4930    2                 ELSE
     2099     4931    2                   IF KV$VDO_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_VFC
     2100     4932    3                     THEN DO;
     2101     4933    3                       K$RWPARM.DVE.VFC = KV$VDO_DAT.DATCTRCHR;
     2102     4934    3                       K$RWPARM.DVE.DVBYTE.VFC = '1'B;
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:386  
     2103     4935    3                       END;
     2104     4936    3                     ELSE DO;
     2105     4937    3                       K$RWPARM.DVE.EOMCHAR = %EOM_EOR#;
     2106     4938    3                       IF KV$VDO_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_CNT
     2107     4939    3                         THEN
     2108     4940    3                           K$RWPARM.MSGSZ = ADDR(KV$VDO_DAT.DATCTRCHR)->CNT.N;
     2109     4941    3                       END;
     2110     4942    2               IF KV$VDO_DAT.DATMOD = %KV_DATMOD_TRN
     2111     4943    2                 THEN
     2112     4944    2                   K$RWPARM.DVE.DVBYTE.TRANS = '1'B;
     2113     4945
     2114     4946    2               END;
     2115     4947
     2116     4948
     2117     4949    1           IF KV$VDO_DAT.VLP
     2118     4950    1             THEN
     2119     4951    2             DO WHILE '1'B;
     2120     4952
     2121     4953    2               MSG$ = PINCRC(K$RWPARM.UHDR$,TMP_SZ);
     2122     4954
     2123     4955    3               DO CASE (MSG$->KV$VDOVLP.TYP);
     2124     4956
     2125     4957    3                 CASE (%KV_VDOVLP_TYP_ACTPOS);
     2126     4958    3                   K$RWPARM.ACTPOS = KV$VDOVLP_ACTPOS.ACTPOS;
     2127     4959    3                   ADDR(K$RWPARM.ACTPOS)->CVT.HOST.HI =
     2128     4960    3                     ADDR(K$RWPARM.ACTPOS)->CVT.FEP.HI;
     2129     4961    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_ACTPOS);
     2130     4962
     2131     4963    3                 CASE (%KV_VDOVLP_TYP_CG_MSGID);
     2132     4964                  /* Even though the MSGIDXT is present, don't put it in K$RWPARM     */
     2133     4965                                      /* KCF doesn't need it and it wipes out IP$     */
     2134     4966    3                   CALL KIA$8TO9 (MSG$->KV$VDOVLP_CG_MSGID.CG_MSGID,K$RWPARM.MSGID,4);
     2135     4967    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_CG_MSGID);
     2136     4968
     2137     4969    3                 CASE (%KV_VDOVLP_TYP_CG_MSGTYP);
     2138     4970    3                   K$RWPARM.MSGTYP = MSG$->KV$VDOVLP_CG_MSGTYP.CG_MSGTYP;
     2139     4971    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_CG_MSGTYP);
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:387  
     2140     4972
     2141     4973    3                 CASE (%KV_VDOVLP_TYP_CG_STA);
     2142     4974    3                   K$RWPARM.STATION = MSG$->KV$VDOVLP_CG_STA.CG_STA;
     2143     4975    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_CG_STA);
     2144     4976
     2145     4977    3                 CASE (%KV_VDOVLP_TYP_DAT1);
     2146     4978    3                   K$RWPARM.MSGSZ = MSG$->KV$VDOVLP_DAT1.BYTSIZ;
     2147     4979    3                   K$RWPARM.MSG$ = ADDR(KV$VDOVLP_DAT1.MSG);
     2148     4980    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_DAT1);
     2149     4981
     2150     4982    3                 CASE (%KV_VDOVLP_TYP_DAT2);
     2151     4983    3                   K$RWPARM.MSGSZ = KV$VDOVLP_DAT2.BYTSIZ;
     2152     4984    3                   ADDR(K$RWPARM.MSGSZ)->CVT.HOSTL.HI =
     2153     4985    3                     ADDR(K$RWPARM.MSGSZ)->CVT.FEPL.HI;
     2154     4986    3                   K$RWPARM.MSG$ = ADDR(KV$VDOVLP_DAT2.MSG);
     2155     4987    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_DAT2);
     2156     4988
     2157     4989    3                 CASE (%KV_VDOVLP_TYP_ERR);
     2158     4990
     2159     4991    3                   ERR = KV$VDOVLP_ERR.ERRCODE;
     2160     4992    3                   CALL EMR$FEP2HOST(ERR,K$RWPARM.MSG_ERRCODE);
     2161     4993    3                   TYC = '1'B;
     2162     4994    3                   IF ADDR(K$RWPARM.MSG_ERRCODE)->VLP$ERRCODE.ERR# < 36
     2163     4995    3                     THEN
     2164     4996    3                       TYC.TYCBIT(ADDR(K$RWPARM.MSG_ERRCODE)->VLP$ERRCODE.ERR#) = '1'B;
     2165     4997    3                   K$RWPARM.TYC = K$RWPARM.TYC | TYC;
     2166     4998    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_ERR);
     2167     4999
     2168     5000    3                 CASE (%KV_VDOVLP_TYP_FLDID);
     2169     5001    3                   IF K$RWPARM.KEYTYPE = %KEYTYPE_FLDID#
     2170     5002    4                     THEN DO;
     2171     5003    4                       K$RWPARM.KEYSZ = KV$VDOVLP_FLDID.BYTSIZ;
     2172     5004    4                       K$RWPARM.KEY$ = ADDR(K$RWPARM.FLDID);
     2173     5005    4                       END;
     2174     5006    3                   K$RWPARM.FLDID = KV$VDOVLP_FLDID.FLDID;
     2175     5007    3                   ADDR(K$RWPARM.FLDID)->CVT.HOST.HI =
     2176     5008    3                     ADDR(K$RWPARM.FLDID)->CVT.FEP.HI;
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:388  
     2177     5009    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_FLDID);
     2178     5010
     2179     5011    3                 CASE (%KV_VDOVLP_TYP_KEY);
     2180     5012    3                   IF K$RWPARM.KEYTYPE ~= %KEYTYPE_FLDID#
     2181     5013    4                     THEN DO;
     2182     5014    4                       K$RWPARM.KEYSZ = KV$VDOVLP_KEY.BYTSIZ;
     2183     5015    4                       K$RWPARM.KEY$ = ADDR(KV$VDOVLP_KEY.KEY);
     2184     5016    4                       IF K$RWPARM.KEYTYPE = %KEYTYPE_BIN10#
     2185     5017    4                         OR K$RWPARM.KEYTYPE = %KEYTYPE_BINHLF#
     2186     5018    4                         OR K$RWPARM.KEYTYPE = %KEYTYPE_BIN521#
     2187     5019    5                         THEN DO;
     2188     5020    5                           CALL KIA$8TO9 (KV$VDOVLP_KEY.KEY, KV$VDOVLP_KEY.KEY,
     2189     5021    5                             SIZEC (KV$VDOVLP_KEY.KEY));
     2190     5022    5                           END;
     2191     5023    4                       END;
     2192     5024    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_KEY);
     2193     5025
     2194     5026    3                 CASE (%KV_VDOVLP_TYP_MRK);
     2195     5027    3                   K$RWPARM.MARKER = KV$VDOVLP_MRK.ID;
     2196     5028    3                   K$RWPARM.MRKTYP = KV$VDOVLP_MRK.MRKTYP;
     2197     5029    3                   IF K$RWPARM.MRKTYP = %KV_VDOMRKTYP_LSTRCRID
     2198     5030    4                     THEN DO;
     2199     5031    4                       ADDR(K$RWPARM.BLKREC.BLKU#)->CVT.HOST.HI =
     2200     5032    4                         ADDR(K$RWPARM.BLKREC.BLKU#)->CVT.FEP.HI;
     2201     5033    4                       ADDR(K$RWPARM.BLKREC.RECU#)->CVT.HOST.HI =
     2202     5034    4                         ADDR(K$RWPARM.BLKREC.RECU#)->CVT.FEP.HI;
     2203     5035    4                       END;
     2204     5036    3                   K$RWPARM.DVE.DVBYTE.RRR = '1'B;
     2205     5037    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_MRK);
     2206     5038
     2207     5039    3                 CASE (%KV_VDOVLP_TYP_ENTSRD);
     2208     5040    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_ENTSRD);
     2209     5041
     2210     5042    3                 CASE (ELSE);
     2211     5043    3                   CALL PROTOCOL_ERR;
     2212     5044    3                   ALTRETURN;
     2213     5045
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:389  
     2214     5046    3                 END;                      /* End cases                          */
     2215     5047
     2216     5048    2               TMP_SZ = TMP_SZ+MOD(TMP_SZ,2);
     2217     5049    2               IF MSG$->KV$VDOVLP.LST
     2218     5050    2                 THEN
     2219     5051    2                   EXIT;
     2220     5052    2               IF TMP_SZ>=END_VDO
     2221     5053    3                 THEN DO;
     2222     5054    3                   CALL PROTOCOL_ERR;
     2223     5055    3                   ALTRETURN;
     2224     5056    3                   END;
     2225     5057    2               END;
     2226     5058
     2227     5059    1           IF TMP_SZ~=END_VDO
     2228     5060    2             THEN DO;
     2229     5061    2               CALL PROTOCOL_ERR;
     2230     5062    2               ALTRETURN;
     2231     5063    2               END;
     2232     5064    1           IF KV$VDO.FNC=%KV_VDO_FNC_PRM_RSP
     2233     5065    2             THEN DO SELECT K$RWPARM.PRMID;
     2234     5066    2               SELECT %KV_PRMID_EDTCTL;
     2235     5067    2               IF K$RWPARM.MSGSZ>=LENGTHC(VLP$EDTCTL)
     2236     5068    2                 THEN CALL KIA$8TO9(K$RWPARM.MSG$->VLP$EDTCTL.KEYINCR,
     2237     5069    2                     K$RWPARM.MSG$->VLP$EDTCTL.KEYINCR,2);
     2238     5070    2               SELECT %KV_PRMID_WINDOW;
     2239     5071    2               IF K$RWPARM.MSGSZ<LENGTHC(VLP$WINDOW) THEN EXIT;
     2240     5072    2               CALL KIA$8TO9(K$RWPARM.MSG$->VLP$WINDOW.LENGTH,
     2241     5073    2                 K$RWPARM.MSG$->VLP$WINDOW.LENGTH,2);
     2242     5074    2               CALL KIA$8TO9(K$RWPARM.MSG$->VLP$WINDOW.WIDTH,
     2243     5075    2                 K$RWPARM.MSG$->VLP$WINDOW.WIDTH,2);
     2244     5076    2               CALL KIA$8TO9(K$RWPARM.MSG$->VLP$WINDOW.ORG_PST.COLUMN,
     2245     5077    2                 K$RWPARM.MSG$->VLP$WINDOW.ORG_PST.COLUMN,2);
     2246     5078    2               END;
     2247     5079
     2248     5080    1           RETURN;
     2249     5081
     2250     5082    1   PROTOCOL_ERR: PROC;
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:390  
     2251     5083
     2252     5084                  /*N* Error log */
     2253     5085    2           RETURN;
     2254     5086    2   END PROTOCOL_ERR;
     2255     5087
     2256     5088
     2257     5089    1   END KIA$MSG;
     2258     5090        %EOD;

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:391  
--  Include file information  --

   UM_CP6.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$MSG.

   Procedure KIA$MSG requires 425 words for executable code.
   Procedure KIA$MSG requires 18 words of local(AUTO) storage.

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:392  

 Object Unit name= KIA$MSG                                    File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:36:25.80 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   425    651  KIA$MSG
    1  RoData even  none     5      5  KIA$MSG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  KIA$MSG

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       3 KIA$8TO9
         yes           Std       2 EMR$FEP2HOST
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KI_FEI$$                              KI_VDOBYTSIZ                          B_VECTNIL
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:393  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:394  


     1992        1        /*T***********************************************************/
     1993        2        /*T*                                                         */
     1994        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1995        4        /*T*                                                         */
     1996        5        /*T***********************************************************/
     1997        6
     1998        7
     1999        8        KIA$MSG: PROC (K$RWPARM) ALTRET;

      8  0 000000   000000 700200 xent  KIA$MSG      TSX0  ! X66_AUTO_1
         0 000001   000022 000001                    ZERO    18,1

     2000        9
     2001       10        /*F*
     2002       11             NAME: KIA$MSG
     2003       12             PURPOSE:
     2004       13                  This routine decodes an read response and merges the information
     2005       14                  into K$RWPARM.
     2006       15             DESCRIPTION:
     2007       16                  None.
     2008       17        */
     2009       18
     2010       19        %INCLUDE CP_6_SUBS;
     2011      559        %INCLUDE KV$VDO;
     2012     1574        %INCLUDE K$RWPARM;
     2013     1960        %INCLUDE KI$CP6V_C;
     2014     2399        %INCLUDE KV_PRMID_E;
     2015     2573        %KV_PRMID_E;
     2016     2729        %INCLUDE KI_DATA_R;
     2017     2755        %INCLUDE UM_CP6;
     2018     3607
     2019     3608        %VLP$EDTCTL_V (FPTN=VLP$EDTCTL, FILCHRS=0, ALGN=CALIGNED);
     2020     3628        %VLP$WINDOW_V (FPTN=VLP$WINDOW, FILCHRS=0, ALGN=CALIGNED);
     2021     3650        %K$RWPARM (NAME=K$RWPARM);
     2022     3966        %KV_VDO_E;
     2023     4002        %KV_VDOVLP_E;
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:395  
     2024     4016        %KV_VDOMRKTYP_E;
     2025     4022        %KV_DATMOD_E;
     2026     4028        %KV_DATCTRCHRTYP_E;
     2027     4034        %VLP_ERRCODE (FPTN=VLP$ERRCODE,STCLASS=BASED);
     2028     4079
     2029     4080        /* Table size of all vdos */
     2030     4081        %KV_VDOBYTSIZ (NAME=KI_VDOBYTSIZ,STCLASS=SYMREF);
     2031     4101        %KV$VDO_DAT (NAME=KV$CQVDO_DAT, STCLASS="BASED(K$RWPARM.UHDR$)");
     2032     4146        %KV$VDOVLP;
     2033     4182        %KV$VDOVLP_ACTPOS (STCLASS="BASED(MSG$)");
     2034     4233        %KV$VDOVLP_CG_MSGID (STCLASS="BASED(MSG$)");
     2035     4285        %KV$VDOVLP_CG_MSGTYP (STCLASS="BASED(MSG$)");
     2036     4337        %KV$VDOVLP_CG_STA (STCLASS="BASED(MSG$)");
     2037     4388        %KV$VDOVLP_DAT1 (STCLASS="BASED(MSG$)",LAST=",");
     2038     4438    1         2 MSG CHAR(K$RWPARM.MSGSZ);
     2039     4439        %KV$VDOVLP_DAT2 (STCLASS="BASED(MSG$)",LAST=",");
     2040     4489    1         2 MSG CHAR(K$RWPARM.MSGSZ);
     2041     4490        %KV$VDOVLP_ERR (STCLASS="BASED(MSG$)");
     2042     4586        %KV$VDOVLP_FLDID (STCLASS="BASED(MSG$)");
     2043     4637        %KV$VDOVLP_KEY (STCLASS="BASED(MSG$)",LAST=",");
     2044     4687    1         2 KEY CHAR(K$RWPARM.KEYSZ);
     2045     4688    1   DCL 1 CNT CALIGNED BASED,
     2046     4689    1         2 * BIT(1),
     2047     4690    1         2 N SBIN(8) UNAL;
     2048     4691        %KV$VDOVLP_MRK (STCLASS="BASED(MSG$)");
     2049     4744        %KV$VDOVLP_ENTSRD(STCLASS="BASED(MSG$)",LAST=",");
     2050     4794    1         2 MSG CHAR(KV$VDOVLP_ENTSRD.BYTSIZ);
     2051     4795
     2052     4796
     2053     4797    1   DCL MSG$ PTR;
     2054     4798    1   DCL B$HWORD UBIN(18) BASED HALIGNED;
     2055     4799    1   DCL TMP_SZ UBIN/*(18) til PL6 does it right */;
     2056     4800    1   DCL END_VDO UBIN/*(18) til PL6 does it right */;
     2057     4801    1   DCL 1 CVT BASED HALIGNED,
     2058     4802    1         2 HOST,
     2059     4803    1           3 * BIT(1),
     2060     4804    1           3 HI BIT(9),
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:396  
     2061     4805    1           3 LO BIT(8),
     2062     4806    1         2 FEP REDEF HOST,
     2063     4807    1           3 HI BIT(9),
     2064     4808    1           3 LO BIT(9),
     2065     4809    1         2 HOSTL,
     2066     4810    1           3 * BIT(1),
     2067     4811    1           3 HI BIT(9),
     2068     4812    1           3 LO BIT(8),
     2069     4813    1         2 FEPL REDEF HOSTL,
     2070     4814    1           3 HI BIT(9),
     2071     4815    1           3 LO BIT(9);
     2072     4816        %KV$VDO_DAT (STCLASS="");
     2073     4861        %KV$VDO_DAT (NAME=KV$VDO, STCLASS=REDEF KV$VDO_DAT);
     2074     4906    1   DCL ERR BIT(36);
     2075     4907    1   DCL 1 TYC,
     2076     4908    1         2 TYCBIT(0:35) BIT(1) UNAL;
     2077     4909
     2078     4910        /* Entries */
     2079     4911    1   DCL EMR$FEP2HOST ENTRY(2);
     2080     4912    1   DCL KIA$8TO9 ENTRY(3);
     2081     4913
     2082     4914
     2083     4915    1           KV$VDO_DAT = KV$CQVDO_DAT;

   4915  0 000002   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000003   000014 471500                    LDP1    12,,PR0
         0 000004   000100 100500                    MLR     fill='000'O
         0 000005   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         0 000006   200007 000004                    ADSC9   KV$VDO_DAT,,AUTO         cn=0,n=4

     2084     4916    1           TMP_SZ = KI_VDOBYTSIZ(KV$VDO_DAT.FNC);

   4916  0 000007   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000010   000033 772000                    QRL     27
         0 000011   000100 101406                    MRL     fill='000'O
         0 000012   000000 000001 xsym               ADSC9   KI_VDOBYTSIZ,Q           cn=0,n=1
         0 000013   200005 000004                    ADSC9   TMP_SZ,,AUTO             cn=0,n=4
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:397  

     2085     4917    1           END_VDO = K$RWPARM.UHDRSZ;

   4917  0 000014   000015 235100                    LDA     13,,PR0
         0 000015   200006 755100                    STA     END_VDO,,AUTO

     2086     4918    1           END_VDO = END_VDO+MOD(END_VDO,2);

   4918  0 000016   200006 236100                    LDQ     END_VDO,,AUTO
         0 000017   000001 376007                    ANQ     1,DL
         0 000020   200006 036100                    ADLQ    END_VDO,,AUTO
         0 000021   200006 756100                    STQ     END_VDO,,AUTO

     2087     4919    1           IF KV$VDO.FNC = 0 OR KV$VDO.FNC > %KV_VDO_FNC_HI OR END_VDO < TMP_SZ

   4919  0 000022   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000023   777000 316003                    CANQ    -512,DU
         0 000024   000034 600000 0                  TZE     s:4921
         0 000025   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000026   777000 376003                    ANQ     -512,DU
         0 000027   043000 116003                    CMPQ    17920,DU
         0 000030   000034 603000 0                  TRC     s:4921
         0 000031   200006 236100                    LDQ     END_VDO,,AUTO
         0 000032   200005 116100                    CMPQ    TMP_SZ,,AUTO
         0 000033   000037 603000 0                  TRC     s:4924

     2088     4920    2             THEN DO;

     2089     4921    2               CALL PROTOCOL_ERR;

   4921  0 000034   000647 701000 0                  TSX1    PROTOCOL_ERR
         0 000035   000000 011000                    NOP     0

     2090     4922    2               ALTRETURN;

   4922  0 000036   000000 702200 xent               TSX2  ! X66_AALT

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:398  
     2091     4923    2               END;
     2092     4924    1           K$RWPARM.STR = KV$VDO.STR;

   4924  0 000037   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000040   000177 376003                    ANQ     127,DU
         0 000041   000022 772000                    QRL     18
         0 000042   000040 552104                    STBQ    32,'04'O,PR0

     2093     4925
     2094     4926    2           IF KV$VDO.FNC = %KV_VDO_FNC_DAT THEN DO;

   4926  0 000043   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000044   777000 376003                    ANQ     -512,DU
         0 000045   005000 116003                    CMPQ    2560,DU
         0 000046   000107 601000 0                  TNZ     s:4949

     2095     4927    2               IF KV$VDO_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_ACT

   4927  0 000047   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000050   014000 376007                    ANQ     6144,DL
         0 000051   004000 116007                    CMPQ    2048,DL
         0 000052   000057 601000 0                  TNZ     s:4931

     2096     4928    2                 THEN
     2097     4929    2                   K$RWPARM.DVE.EOMCHAR = KV$VDO_DAT.DATCTRCHR;

   4929  0 000053   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000054   000022 736000                    QLS     18
         0 000055   000010 552120                    STBQ    8,'20'O,PR0
         0 000056   000101 710000 0                  TRA     s:4942

     2098     4930    2                 ELSE
     2099     4931    2                   IF KV$VDO_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_VFC

   4931  0 000057   010000 116007                    CMPQ    4096,DL
         0 000060   000067 601000 0                  TNZ     s:4937

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:399  
     2100     4932    3                     THEN DO;

     2101     4933    3                       K$RWPARM.DVE.VFC = KV$VDO_DAT.DATCTRCHR;

   4933  0 000061   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000062   000022 736000                    QLS     18
         0 000063   000010 552120                    STBQ    8,'20'O,PR0

     2102     4934    3                       K$RWPARM.DVE.DVBYTE.VFC = '1'B;

   4934  0 000064   100000 236003                    LDQ     32768,DU
         0 000065   000010 256100                    ORSQ    8,,PR0

     2103     4935    3                       END;

   4935  0 000066   000101 710000 0                  TRA     s:4942

     2104     4936    3                     ELSE DO;

     2105     4937    3                       K$RWPARM.DVE.EOMCHAR = %EOM_EOR#;

   4937  0 000067   000501 236003                    LDQ     321,DU
         0 000070   000010 552120                    STBQ    8,'20'O,PR0

     2106     4938    3                       IF KV$VDO_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_CNT

   4938  0 000071   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000072   014000 376007                    ANQ     6144,DL
         0 000073   014000 116007                    CMPQ    6144,DL
         0 000074   000101 601000 0                  TNZ     s:4942

     2107     4939    3                         THEN
     2108     4940    3                           K$RWPARM.MSGSZ = ADDR(KV$VDO_DAT.DATCTRCHR)->CNT.N;

   4940  0 000075   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000076   000034 736000                    QLS     28
         0 000077   000034 732000                    QRS     28
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:400  
         0 000100   000001 756100                    STQ     1,,PR0

     2109     4941    3                       END;

     2110     4942    2               IF KV$VDO_DAT.DATMOD = %KV_DATMOD_TRN

   4942  0 000101   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000102   003000 376007                    ANQ     1536,DL
         0 000103   001000 116007                    CMPQ    512,DL
         0 000104   000107 601000 0                  TNZ     s:4949

     2111     4943    2                 THEN
     2112     4944    2                   K$RWPARM.DVE.DVBYTE.TRANS = '1'B;

   4944  0 000105   020000 236003                    LDQ     8192,DU
         0 000106   000010 256100                    ORSQ    8,,PR0

     2113     4945
     2114     4946    2               END;

     2115     4947
     2116     4948
     2117     4949    1           IF KV$VDO_DAT.VLP

   4949  0 000107   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000110   000200 316003                    CANQ    128,DU
         0 000111   000521 600000 0                  TZE     s:5059

     2118     4950    1             THEN
     2119     4951    2             DO WHILE '1'B;

     2120     4952
     2121     4953    2               MSG$ = PINCRC(K$RWPARM.UHDR$,TMP_SZ);

   4953  0 000112   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000113   000014 471500                    LDP1    12,,PR0
         0 000114   200005 236100                    LDQ     TMP_SZ,,AUTO
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:401  
         0 000115   000011 402007                    MPY     9,DL
         0 000116   100000 503506                    ABD     0,QL,PR1
         0 000117   200004 451500                    STP1    MSG$,,AUTO

     2122     4954
     2123     4955    3               DO CASE (MSG$->KV$VDOVLP.TYP);

   4955  0 000120   003100 061500                    CSR     bolr='003'O
         0 000121   100000 020007                    BDSC    0,,PR1                   by=0,bit=2,n=7
         0 000122   200014 000022                    BDSC    TYC+3,,AUTO              by=0,bit=0,n=18
         0 000123   200014 220100                    LDX0    TYC+3,,AUTO
         0 000124   000014 100003                    CMPX0   12,DU
         0 000125   000127 602010 0                  TNC     s:4955+7,X0
         0 000126   000500 710000 0                  TRA     s:5043
         0 000127   000500 710000 0                  TRA     s:5043
         0 000130   000157 710000 0                  TRA     s:4966
         0 000131   000177 710000 0                  TRA     s:4970
         0 000132   000206 710000 0                  TRA     s:4974
         0 000133   000215 710000 0                  TRA     s:4978
         0 000134   000236 710000 0                  TRA     s:4983
         0 000135   000264 710000 0                  TRA     s:4991
         0 000136   000324 710000 0                  TRA     s:5001
         0 000137   000352 710000 0                  TRA     s:5012
         0 000140   000430 710000 0                  TRA     s:5027
         0 000141   000462 710000 0                  TRA     s:5040
         0 000142   000143 710000 0                  TRA     s:4958

     2124     4956
     2125     4957    3                 CASE (%KV_VDOVLP_TYP_ACTPOS);

     2126     4958    3                   K$RWPARM.ACTPOS = KV$VDOVLP_ACTPOS.ACTPOS;

   4958  0 000143   000100 100500                    MLR     fill='000'O
         0 000144   100000 400002                    ADSC9   0,,PR1                   cn=2,n=2
         0 000145   000046 000002                    ADSC9   38,,PR0                  cn=0,n=2

     2127     4959    3                   ADDR(K$RWPARM.ACTPOS)->CVT.HOST.HI =
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:402  

   4959  0 000146   000046 236100                    LDQ     38,,PR0
         0 000147   000001 772000                    QRL     1
         0 000150   000046 676100                    ERQ     38,,PR0
         0 000151   377400 376003                    ANQ     130816,DU
         0 000152   000046 656100                    ERSQ    38,,PR0

     2128     4960    3                     ADDR(K$RWPARM.ACTPOS)->CVT.FEP.HI;
     2129     4961    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_ACTPOS);

   4961  0 000153   200005 235100                    LDA     TMP_SZ,,AUTO
         0 000154   000004 035007                    ADLA    4,DL
         0 000155   200005 755100                    STA     TMP_SZ,,AUTO
         0 000156   000503 710000 0                  TRA     s:5048

     2130     4962
     2131     4963    3                 CASE (%KV_VDOVLP_TYP_CG_MSGID);

     2132     4964                  /* Even though the MSGIDXT is present, don't put it in K$RWPARM     */
     2133     4965                                      /* KCF doesn't need it and it wipes out IP$     */
     2134     4966    3                   CALL KIA$8TO9 (MSG$->KV$VDOVLP_CG_MSGID.CG_MSGID,K$RWPARM.MSGID,4);

   4966  0 000157   000000 236000 1                  LDQ     0
         0 000160   200016 756100                    STQ     TYC+5,,AUTO
         0 000161   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000162   000011 036003                    ADLQ    9,DU
         0 000163   200015 756100                    STQ     TYC+4,,AUTO
         0 000164   200004 236100                    LDQ     MSG$,,AUTO
         0 000165   000001 036003                    ADLQ    1,DU
         0 000166   200014 756100                    STQ     TYC+3,,AUTO
         0 000167   200014 630500                    EPPR0   TYC+3,,AUTO
         0 000170   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000171   000000 701000 xent               TSX1    KIA$8TO9
         0 000172   000000 011000                    NOP     0

     2135     4967    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_CG_MSGID);

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:403  
   4967  0 000173   200005 235100                    LDA     TMP_SZ,,AUTO
         0 000174   000014 035007                    ADLA    12,DL
         0 000175   200005 755100                    STA     TMP_SZ,,AUTO
         0 000176   000503 710000 0                  TRA     s:5048

     2136     4968
     2137     4969    3                 CASE (%KV_VDOVLP_TYP_CG_MSGTYP);

     2138     4970    3                   K$RWPARM.MSGTYP = MSG$->KV$VDOVLP_CG_MSGTYP.CG_MSGTYP;

   4970  0 000177   040100 100500                    MLR     fill='040'O
         0 000200   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         0 000201   000004 000010                    ADSC9   4,,PR0                   cn=0,n=8

     2139     4971    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_CG_MSGTYP);

   4971  0 000202   200005 235100                    LDA     TMP_SZ,,AUTO
         0 000203   000014 035007                    ADLA    12,DL
         0 000204   200005 755100                    STA     TMP_SZ,,AUTO
         0 000205   000503 710000 0                  TRA     s:5048

     2140     4972
     2141     4973    3                 CASE (%KV_VDOVLP_TYP_CG_STA);

     2142     4974    3                   K$RWPARM.STATION = MSG$->KV$VDOVLP_CG_STA.CG_STA;

   4974  0 000206   040100 100500                    MLR     fill='040'O
         0 000207   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         0 000210   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8

     2143     4975    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_CG_STA);

   4975  0 000211   200005 235100                    LDA     TMP_SZ,,AUTO
         0 000212   000014 035007                    ADLA    12,DL
         0 000213   200005 755100                    STA     TMP_SZ,,AUTO
         0 000214   000503 710000 0                  TRA     s:5048

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:404  
     2144     4976
     2145     4977    3                 CASE (%KV_VDOVLP_TYP_DAT1);

     2146     4978    3                   K$RWPARM.MSGSZ = MSG$->KV$VDOVLP_DAT1.BYTSIZ;

   4978  0 000215   000100 101500                    MRL     fill='000'O
         0 000216   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         0 000217   000001 000004                    ADSC9   1,,PR0                   cn=0,n=4

     2147     4979    3                   K$RWPARM.MSG$ = ADDR(KV$VDOVLP_DAT1.MSG);

   4979  0 000220   200004 236100                    LDQ     MSG$,,AUTO
         0 000221   400000 036007                    ADLQ    -131072,DL
         0 000222   000000 756100                    STQ     0,,PR0

     2148     4980    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_DAT1);

   4980  0 000223   000001 721100                    LXL1    1,,PR0
         0 000224   000002 622011                    EAX2    2,X1
         0 000225   000000 636012                    EAQ     0,X2
         0 000226   000022 732000                    QRS     18
         0 000227   000011 402007                    MPY     9,DL
         0 000230   000021 036007                    ADLQ    17,DL
         0 000231   000022 506007                    DIV     18,DL
         0 000232   000001 736000                    QLS     1
         0 000233   200005 036100                    ADLQ    TMP_SZ,,AUTO
         0 000234   200005 756100                    STQ     TMP_SZ,,AUTO
         0 000235   000503 710000 0                  TRA     s:5048

     2149     4981
     2150     4982    3                 CASE (%KV_VDOVLP_TYP_DAT2);

     2151     4983    3                   K$RWPARM.MSGSZ = KV$VDOVLP_DAT2.BYTSIZ;

   4983  0 000236   000100 101500                    MRL     fill='000'O
         0 000237   100000 400002                    ADSC9   0,,PR1                   cn=2,n=2
         0 000240   000001 000004                    ADSC9   1,,PR0                   cn=0,n=4
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:405  

     2152     4984    3                   ADDR(K$RWPARM.MSGSZ)->CVT.HOSTL.HI =

   4984  0 000241   000001 236100                    LDQ     1,,PR0
         0 000242   000001 772000                    QRL     1
         0 000243   000001 676100                    ERQ     1,,PR0
         0 000244   377400 376007                    ANQ     130816,DL
         0 000245   000001 656100                    ERSQ    1,,PR0

     2153     4985    3                     ADDR(K$RWPARM.MSGSZ)->CVT.FEPL.HI;
     2154     4986    3                   K$RWPARM.MSG$ = ADDR(KV$VDOVLP_DAT2.MSG);

   4986  0 000246   200004 236100                    LDQ     MSG$,,AUTO
         0 000247   000001 036003                    ADLQ    1,DU
         0 000250   000000 756100                    STQ     0,,PR0

     2155     4987    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_DAT2);

   4987  0 000251   000001 721100                    LXL1    1,,PR0
         0 000252   000004 622011                    EAX2    4,X1
         0 000253   000000 636012                    EAQ     0,X2
         0 000254   000022 732000                    QRS     18
         0 000255   000011 402007                    MPY     9,DL
         0 000256   000021 036007                    ADLQ    17,DL
         0 000257   000022 506007                    DIV     18,DL
         0 000260   000001 736000                    QLS     1
         0 000261   200005 036100                    ADLQ    TMP_SZ,,AUTO
         0 000262   200005 756100                    STQ     TMP_SZ,,AUTO
         0 000263   000503 710000 0                  TRA     s:5048

     2156     4988
     2157     4989    3                 CASE (%KV_VDOVLP_TYP_ERR);

     2158     4990
     2159     4991    3                   ERR = KV$VDOVLP_ERR.ERRCODE;

   4991  0 000264   000100 100500                    MLR     fill='000'O
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:406  
         0 000265   100000 400004                    ADSC9   0,,PR1                   cn=2,n=4
         0 000266   200010 000004                    ADSC9   ERR,,AUTO                cn=0,n=4

     2160     4992    3                   CALL EMR$FEP2HOST(ERR,K$RWPARM.MSG_ERRCODE);

   4992  0 000267   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000270   000037 036003                    ADLQ    31,DU
         0 000271   200015 756100                    STQ     TYC+4,,AUTO
         0 000272   200010 633500                    EPPR3   ERR,,AUTO
         0 000273   200014 453500                    STP3    TYC+3,,AUTO
         0 000274   200014 630500                    EPPR0   TYC+3,,AUTO
         0 000275   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000276   000000 701000 xent               TSX1    EMR$FEP2HOST
         0 000277   000000 011000                    NOP     0

     2161     4993    3                   TYC = '1'B;

   4993  0 000300   400000 236003                    LDQ     -131072,DU
         0 000301   200011 756100                    STQ     TYC,,AUTO

     2162     4994    3                   IF ADDR(K$RWPARM.MSG_ERRCODE)->VLP$ERRCODE.ERR# < 36

   4994  0 000302   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000303   000037 236100                    LDQ     31,,PR0
         0 000304   377770 376007                    ANQ     131064,DL
         0 000305   000440 116007                    CMPQ    288,DL
         0 000306   000315 603000 0                  TRC     s:4997

     2163     4995    3                     THEN
     2164     4996    3                      TYC.TYCBIT(ADDR(K$RWPARM.MSG_ERRCODE)->VLP$ERRCODE.ERR#) = '1'B;

   4996  0 000307   000037 236100                    LDQ     31,,PR0
         0 000310   000003 772000                    QRL     3
         0 000311   037777 376007                    ANQ     16383,DL
         0 000312   003106 060400                    CSL     bolr='003'O
         0 000313   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         0 000314   200011 000001                    BDSC    TYC,Q,AUTO               by=0,bit=0,n=1
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:407  

     2165     4997    3                   K$RWPARM.TYC = K$RWPARM.TYC | TYC;

   4997  0 000315   000006 236100                    LDQ     6,,PR0
         0 000316   200011 276100                    ORQ     TYC,,AUTO
         0 000317   000006 756100                    STQ     6,,PR0

     2166     4998    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_ERR);

   4998  0 000320   200005 235100                    LDA     TMP_SZ,,AUTO
         0 000321   000006 035007                    ADLA    6,DL
         0 000322   200005 755100                    STA     TMP_SZ,,AUTO
         0 000323   000503 710000 0                  TRA     s:5048

     2167     4999
     2168     5000    3                 CASE (%KV_VDOVLP_TYP_FLDID);

     2169     5001    3                   IF K$RWPARM.KEYTYPE = %KEYTYPE_FLDID#

   5001  0 000324   000046 236100                    LDQ     38,,PR0
         0 000325   777000 376007                    ANQ     -512,DL
         0 000326   001000 116007                    CMPQ    512,DL
         0 000327   000336 601000 0                  TNZ     s:5006

     2170     5002    4                     THEN DO;

     2171     5003    4                       K$RWPARM.KEYSZ = KV$VDOVLP_FLDID.BYTSIZ;

   5003  0 000330   000100 100500                    MLR     fill='000'O
         0 000331   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         0 000332   000046 600001                    ADSC9   38,,PR0                  cn=3,n=1

     2172     5004    4                       K$RWPARM.KEY$ = ADDR(K$RWPARM.FLDID);

   5004  0 000333   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000334   000001 036000 1                  ADLQ    1
         0 000335   000044 756100                    STQ     36,,PR0
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:408  

     2173     5005    4                       END;

     2174     5006    3                   K$RWPARM.FLDID = KV$VDOVLP_FLDID.FLDID;

   5006  0 000336   000100 100500                    MLR     fill='000'O
         0 000337   100000 400002                    ADSC9   0,,PR1                   cn=2,n=2
         0 000340   000045 400002                    ADSC9   37,,PR0                  cn=2,n=2

     2175     5007    3                   ADDR(K$RWPARM.FLDID)->CVT.HOST.HI =

   5007  0 000341   000045 236100                    LDQ     37,,PR0
         0 000342   000001 772000                    QRL     1
         0 000343   000045 676100                    ERQ     37,,PR0
         0 000344   377400 376007                    ANQ     130816,DL
         0 000345   000045 656100                    ERSQ    37,,PR0

     2176     5008    3                     ADDR(K$RWPARM.FLDID)->CVT.FEP.HI;
     2177     5009    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_FLDID);

   5009  0 000346   200005 235100                    LDA     TMP_SZ,,AUTO
         0 000347   000004 035007                    ADLA    4,DL
         0 000350   200005 755100                    STA     TMP_SZ,,AUTO
         0 000351   000503 710000 0                  TRA     s:5048

     2178     5010
     2179     5011    3                 CASE (%KV_VDOVLP_TYP_KEY);

     2180     5012    3                   IF K$RWPARM.KEYTYPE ~= %KEYTYPE_FLDID#

   5012  0 000352   000046 236100                    LDQ     38,,PR0
         0 000353   777000 376007                    ANQ     -512,DL
         0 000354   001000 116007                    CMPQ    512,DL
         0 000355   000413 600000 0                  TZE     s:5024

     2181     5013    4                     THEN DO;

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:409  
     2182     5014    4                       K$RWPARM.KEYSZ = KV$VDOVLP_KEY.BYTSIZ;

   5014  0 000356   000100 100500                    MLR     fill='000'O
         0 000357   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         0 000360   000046 600001                    ADSC9   38,,PR0                  cn=3,n=1

     2183     5015    4                       K$RWPARM.KEY$ = ADDR(KV$VDOVLP_KEY.KEY);

   5015  0 000361   200004 236100                    LDQ     MSG$,,AUTO
         0 000362   400000 036007                    ADLQ    -131072,DL
         0 000363   000044 756100                    STQ     36,,PR0

     2184     5016    4                       IF K$RWPARM.KEYTYPE = %KEYTYPE_BIN10#

   5016  0 000364   000046 236100                    LDQ     38,,PR0
         0 000365   777000 376007                    ANQ     -512,DL
         0 000366   004000 116007                    CMPQ    2048,DL
         0 000367   000374 600000 0                  TZE     s:5020
         0 000370   005000 116007                    CMPQ    2560,DL
         0 000371   000374 600000 0                  TZE     s:5020
         0 000372   006000 116007                    CMPQ    3072,DL
         0 000373   000413 601000 0                  TNZ     s:5024

     2185     5017    4                         OR K$RWPARM.KEYTYPE = %KEYTYPE_BINHLF#
     2186     5018    4                         OR K$RWPARM.KEYTYPE = %KEYTYPE_BIN521#
     2187     5019    5                         THEN DO;

     2188     5020    5                           CALL KIA$8TO9 (KV$VDOVLP_KEY.KEY, KV$VDOVLP_KEY.KEY,

   5020  0 000374   000046 721100                    LXL1    38,,PR0
         0 000375   000777 361003                    ANX1    511,DU
         0 000376   000000 635011                    EAA     0,X1
         0 000377   000022 771000                    ARL     18
         0 000400   200014 755100                    STA     TYC+3,,AUTO
         0 000401   200014 633500                    EPPR3   TYC+3,,AUTO
         0 000402   200017 453500                    STP3    TYC+6,,AUTO
         0 000403   200004 236100                    LDQ     MSG$,,AUTO
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:410  
         0 000404   400000 036007                    ADLQ    -131072,DL
         0 000405   200016 756100                    STQ     TYC+5,,AUTO
         0 000406   200015 756100                    STQ     TYC+4,,AUTO
         0 000407   200015 630500                    EPPR0   TYC+4,,AUTO
         0 000410   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000411   000000 701000 xent               TSX1    KIA$8TO9
         0 000412   000000 011000                    NOP     0

     2189     5021    5                             SIZEC (KV$VDOVLP_KEY.KEY));
     2190     5022    5                           END;

     2191     5023    4                       END;

     2192     5024    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_KEY);

   5024  0 000413   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000414   000046 720100                    LXL0    38,,PR0
         0 000415   000777 360003                    ANX0    511,DU
         0 000416   000002 621010                    EAX1    2,X0
         0 000417   000000 636011                    EAQ     0,X1
         0 000420   000022 772000                    QRL     18
         0 000421   000011 402007                    MPY     9,DL
         0 000422   000021 036007                    ADLQ    17,DL
         0 000423   000022 506007                    DIV     18,DL
         0 000424   000001 736000                    QLS     1
         0 000425   200005 036100                    ADLQ    TMP_SZ,,AUTO
         0 000426   200005 756100                    STQ     TMP_SZ,,AUTO
         0 000427   000503 710000 0                  TRA     s:5048

     2193     5025
     2194     5026    3                 CASE (%KV_VDOVLP_TYP_MRK);

     2195     5027    3                   K$RWPARM.MARKER = KV$VDOVLP_MRK.ID;

   5027  0 000430   000100 100500                    MLR     fill='000'O
         0 000431   100001 000004                    ADSC9   1,,PR1                   cn=0,n=4
         0 000432   000007 000004                    ADSC9   7,,PR0                   cn=0,n=4
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:411  

     2196     5028    3                   K$RWPARM.MRKTYP = KV$VDOVLP_MRK.MRKTYP;

   5028  0 000433   000100 100500                    MLR     fill='000'O
         0 000434   100000 600001                    ADSC9   0,,PR1                   cn=3,n=1
         0 000435   000040 400001                    ADSC9   32,,PR0                  cn=2,n=1

     2197     5029    3                   IF K$RWPARM.MRKTYP = %KV_VDOMRKTYP_LSTRCRID

   5029  0 000436   000040 236100                    LDQ     32,,PR0
         0 000437   777000 376007                    ANQ     -512,DL
         0 000440   002000 116007                    CMPQ    1024,DL
         0 000441   000454 601000 0                  TNZ     s:5036

     2198     5030    4                     THEN DO;

     2199     5031    4                       ADDR(K$RWPARM.BLKREC.BLKU#)->CVT.HOST.HI =

   5031  0 000442   000007 236100                    LDQ     7,,PR0
         0 000443   000001 772000                    QRL     1
         0 000444   000007 676100                    ERQ     7,,PR0
         0 000445   377400 376003                    ANQ     130816,DU
         0 000446   000007 656100                    ERSQ    7,,PR0

     2200     5032    4                         ADDR(K$RWPARM.BLKREC.BLKU#)->CVT.FEP.HI;
     2201     5033    4                       ADDR(K$RWPARM.BLKREC.RECU#)->CVT.HOST.HI =

   5033  0 000447   000007 236100                    LDQ     7,,PR0
         0 000450   000001 772000                    QRL     1
         0 000451   000007 676100                    ERQ     7,,PR0
         0 000452   377400 376007                    ANQ     130816,DL
         0 000453   000007 656100                    ERSQ    7,,PR0

     2202     5034    4                         ADDR(K$RWPARM.BLKREC.RECU#)->CVT.FEP.HI;
     2203     5035    4                       END;

     2204     5036    3                   K$RWPARM.DVE.DVBYTE.RRR = '1'B;
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:412  

   5036  0 000454   010000 236003                    LDQ     4096,DU
         0 000455   000010 256100                    ORSQ    8,,PR0

     2205     5037    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_MRK);

   5037  0 000456   200005 235100                    LDA     TMP_SZ,,AUTO
         0 000457   000010 035007                    ADLA    8,DL
         0 000460   200005 755100                    STA     TMP_SZ,,AUTO
         0 000461   000503 710000 0                  TRA     s:5048

     2206     5038
     2207     5039    3                 CASE (%KV_VDOVLP_TYP_ENTSRD);

     2208     5040    3                   TMP_SZ = TMP_SZ + SIZEC(KV$VDOVLP_ENTSRD);

   5040  0 000462   000100 101500                    MRL     fill='000'O
         0 000463   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         0 000464   200014 000002                    ADSC9   TYC+3,,AUTO              cn=0,n=2
         0 000465   200014 220100                    LDX0    TYC+3,,AUTO
         0 000466   000002 621010                    EAX1    2,X0
         0 000467   000000 636011                    EAQ     0,X1
         0 000470   000022 772000                    QRL     18
         0 000471   000011 402007                    MPY     9,DL
         0 000472   000021 036007                    ADLQ    17,DL
         0 000473   000022 506007                    DIV     18,DL
         0 000474   000001 736000                    QLS     1
         0 000475   200005 036100                    ADLQ    TMP_SZ,,AUTO
         0 000476   200005 756100                    STQ     TMP_SZ,,AUTO
         0 000477   000503 710000 0                  TRA     s:5048

     2209     5041
     2210     5042    3                 CASE (ELSE);

     2211     5043    3                   CALL PROTOCOL_ERR;

   5043  0 000500   000647 701000 0                  TSX1    PROTOCOL_ERR
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:413  
         0 000501   000000 011000                    NOP     0

     2212     5044    3                   ALTRETURN;

   5044  0 000502   000000 702200 xent               TSX2  ! X66_AALT

     2213     5045
     2214     5046    3                 END;                      /* End cases                          */

     2215     5047
     2216     5048    2               TMP_SZ = TMP_SZ+MOD(TMP_SZ,2);

   5048  0 000503   200005 236100                    LDQ     TMP_SZ,,AUTO
         0 000504   000001 376007                    ANQ     1,DL
         0 000505   200005 036100                    ADLQ    TMP_SZ,,AUTO
         0 000506   200005 756100                    STQ     TMP_SZ,,AUTO

     2217     5049    2               IF MSG$->KV$VDOVLP.LST

   5049  0 000507   200004 470500                    LDP0    MSG$,,AUTO
         0 000510   000000 066500                    CMPB    filb='0'B
         0 000511   000000 010001                    BDSC    0,,PR0                   by=0,bit=1,n=1
         0 000512   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         0 000513   000521 601000 0                  TNZ     s:5059

     2218     5050    2                 THEN
     2219     5051    2                   EXIT;
     2220     5052    2               IF TMP_SZ>=END_VDO

   5052  0 000514   200006 116100                    CMPQ    END_VDO,,AUTO
         0 000515   000112 602000 0                  TNC     s:4953

     2221     5053    3                 THEN DO;

     2222     5054    3                   CALL PROTOCOL_ERR;

   5054  0 000516   000647 701000 0                  TSX1    PROTOCOL_ERR
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:414  
         0 000517   000000 011000                    NOP     0

     2223     5055    3                   ALTRETURN;

   5055  0 000520   000000 702200 xent               TSX2  ! X66_AALT

     2224     5056    3                   END;
     2225     5057    2               END;

     2226     5058
     2227     5059    1           IF TMP_SZ~=END_VDO

   5059  0 000521   200005 236100                    LDQ     TMP_SZ,,AUTO
         0 000522   200006 116100                    CMPQ    END_VDO,,AUTO
         0 000523   000527 600000 0                  TZE     s:5064

     2228     5060    2             THEN DO;

     2229     5061    2               CALL PROTOCOL_ERR;

   5061  0 000524   000647 701000 0                  TSX1    PROTOCOL_ERR
         0 000525   000000 011000                    NOP     0

     2230     5062    2               ALTRETURN;

   5062  0 000526   000000 702200 xent               TSX2  ! X66_AALT

     2231     5063    2               END;
     2232     5064    1           IF KV$VDO.FNC=%KV_VDO_FNC_PRM_RSP

   5064  0 000527   200007 236100                    LDQ     KV$VDO_DAT,,AUTO
         0 000530   777000 376003                    ANQ     -512,DU
         0 000531   022000 116003                    CMPQ    9216,DU
         0 000532   000646 601000 0                  TNZ     s:5080

     2233     5065    2             THEN DO SELECT K$RWPARM.PRMID;

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:415  
   5065  0 000533   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000534   000045 236100                    LDQ     37,,PR0
         0 000535   777777 376007                    ANQ     -1,DL
         0 000536   000014 116007                    CMPQ    12,DL
         0 000537   000646 602000 0                  TNC     s:5080
         0 000540   000545 600000 0                  TZE     s:5067
         0 000541   000045 720100                    LXL0    37,,PR0
         0 000542   000020 100003                    CMPX0   16,DU
         0 000543   000646 601000 0                  TNZ     s:5080
         0 000544   000570 710000 0                  TRA     s:5071

     2234     5066    2               SELECT %KV_PRMID_EDTCTL;

     2235     5067    2               IF K$RWPARM.MSGSZ>=LENGTHC(VLP$EDTCTL)

   5067  0 000545   000001 235100                    LDA     1,,PR0
         0 000546   000011 115007                    CMPA    9,DL
         0 000547   000646 604000 0                  TMI     s:5080

     2236     5068    2                 THEN CALL KIA$8TO9(K$RWPARM.MSG$->VLP$EDTCTL.KEYINCR,

   5068  0 000550   000000 471500                    LDP1    0,,PR0
         0 000551   000002 236000 1                  LDQ     2
         0 000552   200016 756100                    STQ     TYC+5,,AUTO
         0 000553   200017 451500                    STP1    TYC+6,,AUTO
         0 000554   200017 236100                    LDQ     TYC+6,,AUTO
         0 000555   000003 036000 1                  ADLQ    3
         0 000556   200015 756100                    STQ     TYC+4,,AUTO
         0 000557   200020 451500                    STP1    TYC+7,,AUTO
         0 000560   200020 236100                    LDQ     TYC+7,,AUTO
         0 000561   000003 036000 1                  ADLQ    3
         0 000562   200014 756100                    STQ     TYC+3,,AUTO
         0 000563   200014 630500                    EPPR0   TYC+3,,AUTO
         0 000564   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000565   000000 701000 xent               TSX1    KIA$8TO9
         0 000566   000000 011000                    NOP     0
         0 000567   000646 710000 0                  TRA     s:5080
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:416  

     2237     5069    2                     K$RWPARM.MSG$->VLP$EDTCTL.KEYINCR,2);
     2238     5070    2               SELECT %KV_PRMID_WINDOW;

     2239     5071    2               IF K$RWPARM.MSGSZ<LENGTHC(VLP$WINDOW) THEN EXIT;

   5071  0 000570   000001 235100                    LDA     1,,PR0
         0 000571   000023 115007                    CMPA    19,DL
         0 000572   000646 604000 0                  TMI     s:5080

     2240     5072    2               CALL KIA$8TO9(K$RWPARM.MSG$->VLP$WINDOW.LENGTH,

   5072  0 000573   000000 471500                    LDP1    0,,PR0
         0 000574   000002 236000 1                  LDQ     2
         0 000575   200016 756100                    STQ     TYC+5,,AUTO
         0 000576   100001 633500                    EPPR3   1,,PR1
         0 000577   200015 453500                    STP3    TYC+4,,AUTO
         0 000600   100001 634500                    EPPR4   1,,PR1
         0 000601   200014 454500                    STP4    TYC+3,,AUTO
         0 000602   200014 630500                    EPPR0   TYC+3,,AUTO
         0 000603   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000604   000000 701000 xent               TSX1    KIA$8TO9
         0 000605   000000 011000                    NOP     0

     2241     5073    2                 K$RWPARM.MSG$->VLP$WINDOW.LENGTH,2);
     2242     5074    2               CALL KIA$8TO9(K$RWPARM.MSG$->VLP$WINDOW.WIDTH,

   5074  0 000606   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000607   000000 471500                    LDP1    0,,PR0
         0 000610   000002 236000 1                  LDQ     2
         0 000611   200016 756100                    STQ     TYC+5,,AUTO
         0 000612   200017 451500                    STP1    TYC+6,,AUTO
         0 000613   200017 236100                    LDQ     TYC+6,,AUTO
         0 000614   000003 036000 1                  ADLQ    3
         0 000615   200015 756100                    STQ     TYC+4,,AUTO
         0 000616   200020 451500                    STP1    TYC+7,,AUTO
         0 000617   200020 236100                    LDQ     TYC+7,,AUTO
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:417  
         0 000620   000003 036000 1                  ADLQ    3
         0 000621   200014 756100                    STQ     TYC+3,,AUTO
         0 000622   200014 630500                    EPPR0   TYC+3,,AUTO
         0 000623   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000624   000000 701000 xent               TSX1    KIA$8TO9
         0 000625   000000 011000                    NOP     0

     2243     5075    2                 K$RWPARM.MSG$->VLP$WINDOW.WIDTH,2);
     2244     5076    2               CALL KIA$8TO9(K$RWPARM.MSG$->VLP$WINDOW.ORG_PST.COLUMN,

   5076  0 000626   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000627   000000 471500                    LDP1    0,,PR0
         0 000630   000002 236000 1                  LDQ     2
         0 000631   200016 756100                    STQ     TYC+5,,AUTO
         0 000632   200017 451500                    STP1    TYC+6,,AUTO
         0 000633   200017 236100                    LDQ     TYC+6,,AUTO
         0 000634   000004 036000 1                  ADLQ    4
         0 000635   200015 756100                    STQ     TYC+4,,AUTO
         0 000636   200020 451500                    STP1    TYC+7,,AUTO
         0 000637   200020 236100                    LDQ     TYC+7,,AUTO
         0 000640   000004 036000 1                  ADLQ    4
         0 000641   200014 756100                    STQ     TYC+3,,AUTO
         0 000642   200014 630500                    EPPR0   TYC+3,,AUTO
         0 000643   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000644   000000 701000 xent               TSX1    KIA$8TO9
         0 000645   000000 011000                    NOP     0

     2245     5077    2                 K$RWPARM.MSG$->VLP$WINDOW.ORG_PST.COLUMN,2);
     2246     5078    2               END;

     2247     5079
     2248     5080    1           RETURN;

   5080  0 000646   000000 702200 xent               TSX2  ! X66_ARET

     2249     5081
     2250     5082    1   PROTOCOL_ERR: PROC;
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:418  

   5082  0 000647   200012 741300       PROTOCOL_ERR STX1  ! TYC+1,,AUTO

     2251     5083
     2252     5084                  /*N* Error log */
     2253     5085    2           RETURN;

   5085  0 000650   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   1     000   000006 006000   000045 400000   000004 006000   000001 400000    .....%..........
   1     004   000002 400000                                                    ....
     2254     5086    2   END PROTOCOL_ERR;
     2255     5087
     2256     5088
     2257     5089    1   END KIA$MSG;
     2258     5090        %EOD;

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:419  
--  Include file information  --

   UM_CP6.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$MSG.
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:420  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @K$RWPARM                  6-0-0/w UBIN        r     1 END_VDO
    10-0-0/b BIT         r     1 ERR                       *0-0-0/d STRC(1404)  r     1 K$RWPARM
     7-0-0/h STRC        r     1 KV$VDO                     7-0-0/h STRC        r     1 KV$VDO_DAT
     4-0-0/w PTR         r     1 MSG$                       5-0-0/w UBIN        r     1 TMP_SZ
    11-0-0/b STRC        r     1 TYC

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KI_FEI$$
     0-0-0/c UBIN(9)     r     1 KI_VDOBYTSIZ(0:34)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(9)     r     1 CNT                        0-0-0/h STRC        r     1 CVT
     0-0-0/h STRC        r     1 KV$CQVDO_DAT               0-0-0/h STRC(18)    r     1 KV$VDOVLP
     0-0-0/h STRC        r     1 KV$VDOVLP_ACTPOS           0-0-0/h STRC(108)   r     1 KV$VDOVLP_CG_MSGID
     0-0-0/h STRC(108)   r     1 KV$VDOVLP_CG_MSGTYP        0-0-0/h STRC(108)   r     1 KV$VDOVLP_CG_STA
     0-0-0/h ASTR(18)    r     1 KV$VDOVLP_DAT1             0-0-0/h ASTR        r     1 KV$VDOVLP_DAT2
     0-0-0/h ASTR(18)    r     1 KV$VDOVLP_ENTSRD           0-0-0/h STRC(54)    r     1 KV$VDOVLP_ERR
     0-0-0/h STRC        r     1 KV$VDOVLP_FLDID            0-0-0/h ASTR(18)    r     1 KV$VDOVLP_KEY
     0-0-0/h STRC(72)    r     1 KV$VDOVLP_MRK              0-0-0/c STRC(81)    r     1 VLP$EDTCTL
     0-0-0/w STRC        r     1 VLP$ERRCODE                0-0-0/w STRC(171)   r     1 VLP$WINDOW

PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:421  

   Procedure KIA$MSG requires 425 words for executable code.
   Procedure KIA$MSG requires 18 words of local(AUTO) storage.
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:422  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:423  
          MINI XREF LISTING

CNT.N
      4690**DCL      4940>>ASSIGN
CVT.FEP.HI
      4807**DCL      4959>>ASSIGN   5007>>ASSIGN   5031>>ASSIGN   5033>>ASSIGN
CVT.FEPL.HI
      4814**DCL      4984>>ASSIGN
CVT.HOST
      4802**DCL      4806--REDEF
CVT.HOST.HI
      4804**DCL      4959<<ASSIGN   5007<<ASSIGN   5031<<ASSIGN   5033<<ASSIGN
CVT.HOSTL
      4809**DCL      4813--REDEF
CVT.HOSTL.HI
      4811**DCL      4984<<ASSIGN
EMR$FEP2HOST
      4911**DCL-ENT  4992--CALL
END_VDO
      4800**DCL      4917<<ASSIGN   4918<<ASSIGN   4918>>ASSIGN   4918>>ASSIGN   4919>>IF       5052>>IF
      5059>>IF
ERR
      4906**DCL      4991<<ASSIGN   4992<>CALL
K$RWPARM
      3671**DCL         8--PROC
K$RWPARM.ACTPOS
      3957**DCL      4958<<ASSIGN   4959--ASSIGN   4959--ASSIGN
K$RWPARM.BLKREC
      3697**DCL      3722--REDEF
K$RWPARM.BLKREC.BLKU#
      3698**DCL      3700--REDEF    5031--ASSIGN   5031--ASSIGN
K$RWPARM.BLKREC.RECU#
      3710**DCL      3712--REDEF    5033--ASSIGN   5033--ASSIGN
K$RWPARM.DVE.DVBYTE.RRR
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:424  
      3741**DCL      5036<<ASSIGN
K$RWPARM.DVE.DVBYTE.TRANS
      3740**DCL      4944<<ASSIGN
K$RWPARM.DVE.DVBYTE.VFC
      3737**DCL      3738--REDEF    4934<<ASSIGN
K$RWPARM.DVE.EOMCHAR
      3745**DCL      3749--REDEF    4929<<ASSIGN   4937<<ASSIGN
K$RWPARM.DVE.VFC
      3749**DCL      4933<<ASSIGN
K$RWPARM.ERR
      3809**DCL      3814--REDEF
K$RWPARM.FC
      3773**DCL      3774--REDEF
K$RWPARM.FLDID
      3955**DCL      3956--REDEF    5004--ASSIGN   5006<<ASSIGN   5007--ASSIGN   5007--ASSIGN
K$RWPARM.FPT$
      3836**DCL      3843--REDEF
K$RWPARM.KEY$
      3953**DCL      5004<<ASSIGN   5015<<ASSIGN
K$RWPARM.KEYSZ
      3964**DCL      4687--IMP-SIZ  5003<<ASSIGN   5014<<ASSIGN   5020>>CALL     5020>>CALL     5020>>CALL
      5024>>ASSIGN
K$RWPARM.KEYTYPE
      3962**DCL      3963--REDEF    5001>>IF       5012>>IF       5016>>IF       5016>>IF       5016>>IF
K$RWPARM.MARKER
      3722**DCL      5027<<ASSIGN
K$RWPARM.MRKTYP
      3947**DCL      5028<<ASSIGN   5029>>IF
K$RWPARM.MSG$
      3672**DCL      3678--REDEF    4979<<ASSIGN   4986<<ASSIGN   5068>>CALL     5068>>CALL     5072>>CALL
      5072>>CALL     5074>>CALL     5074>>CALL     5076>>CALL     5076>>CALL
K$RWPARM.MSGID
      3784**DCL      3789--REDEF    4966<>CALL
K$RWPARM.MSGIDXT
      3797**DCL      3801--REDEF
K$RWPARM.MSGSZ
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:425  
      3679**DCL      4438--IMP-SIZ  4489--IMP-SIZ  4940<<ASSIGN   4978<<ASSIGN   4980>>ASSIGN   4983<<ASSIGN
      4984--ASSIGN   4984--ASSIGN   4987>>ASSIGN   5067>>IF       5071>>IF
K$RWPARM.MSGTYP
      3688**DCL      4970<<ASSIGN
K$RWPARM.MSG_ERRCODE
      3932**DCL      4992<>CALL     4994--IF       4996--ASSIGN
K$RWPARM.ORG
      3933**DCL      3934--REDEF
K$RWPARM.PRMID
      3956**DCL      5065>>DOSELCT
K$RWPARM.STATION
      3683**DCL      4974<<ASSIGN
K$RWPARM.STR
      3948**DCL      4924<<ASSIGN
K$RWPARM.THDRSZ
      3877**DCL      3881--REDEF
K$RWPARM.TYC
      3693**DCL      4997<<ASSIGN   4997>>ASSIGN
K$RWPARM.UHDR$
      3822**DCL      4134--IMP-PTR  4915>>ASSIGN   4953>>ASSIGN
K$RWPARM.UHDRSZ
      3827**DCL      4917>>ASSIGN
K$RWPARM.VDOFLGS
      3935**DCL      3946--REDEF
KIA$8TO9
      4912**DCL-ENT  4966--CALL     5020--CALL     5068--CALL     5072--CALL     5074--CALL     5076--CALL
KI_FEI$$
      2740**DCL      2741--IMP-PTR
KI_VDOBYTSIZ
      4094**DCL      4916>>ASSIGN
KV$CQVDO_DAT
      4134**DCL      4915>>ASSIGN
KV$VDO.FNC
      4898**DCL      4919>>IF       4919>>IF       4926>>IF       5064>>IF
KV$VDO.STR
      4898**DCL      4924>>ASSIGN
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:426  
KV$VDOVLP.LST
      4172**DCL      5049>>IF
KV$VDOVLP.TYP
      4172**DCL      4955>>DOCASE
KV$VDOVLP_ACTPOS
      4217**DCL      4961--ASSIGN
KV$VDOVLP_ACTPOS.ACTPOS
      4231**DCL      4958>>ASSIGN
KV$VDOVLP_CG_MSGID
      4268**DCL      4967--ASSIGN
KV$VDOVLP_CG_MSGID.CG_MSGID
      4282**DCL      4966<>CALL
KV$VDOVLP_CG_MSGTYP
      4320**DCL      4971--ASSIGN
KV$VDOVLP_CG_MSGTYP.CG_MSGTYP
      4334**DCL      4970>>ASSIGN
KV$VDOVLP_CG_STA
      4372**DCL      4975--ASSIGN
KV$VDOVLP_CG_STA.CG_STA
      4386**DCL      4974>>ASSIGN
KV$VDOVLP_DAT1
      4423**DCL      4980--ASSIGN
KV$VDOVLP_DAT1.BYTSIZ
      4429**DCL      4978>>ASSIGN
KV$VDOVLP_DAT1.MSG
      4438**DCL      4979--ASSIGN
KV$VDOVLP_DAT2
      4474**DCL      4987--ASSIGN
KV$VDOVLP_DAT2.BYTSIZ
      4482**DCL      4983>>ASSIGN
KV$VDOVLP_DAT2.MSG
      4489**DCL      4986--ASSIGN
KV$VDOVLP_ENTSRD
      4779**DCL      5040--ASSIGN
KV$VDOVLP_ENTSRD.BYTSIZ
      4785**DCL      4794--IMP-SIZ  5040>>ASSIGN
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:427  
KV$VDOVLP_ERR
      4525**DCL      4998--ASSIGN
KV$VDOVLP_ERR.ERRCODE
      4554**DCL      4991>>ASSIGN
KV$VDOVLP_FLDID
      4621**DCL      5009--ASSIGN
KV$VDOVLP_FLDID.BYTSIZ
      4627**DCL      5003>>ASSIGN
KV$VDOVLP_FLDID.FLDID
      4635**DCL      5006>>ASSIGN
KV$VDOVLP_KEY
      4672**DCL      5024--ASSIGN
KV$VDOVLP_KEY.BYTSIZ
      4678**DCL      5014>>ASSIGN
KV$VDOVLP_KEY.KEY
      4687**DCL      5015--ASSIGN   5020<>CALL     5020<>CALL     5020--CALL
KV$VDOVLP_MRK
      4726**DCL      5037--ASSIGN
KV$VDOVLP_MRK.ID
      4741**DCL      5027>>ASSIGN
KV$VDOVLP_MRK.MRKTYP
      4740**DCL      5028>>ASSIGN
KV$VDO_DAT
      4849**DCL      4894--REDEF    4915<<ASSIGN
KV$VDO_DAT.DATCTRCHR
      4858**DCL      4929>>ASSIGN   4933>>ASSIGN   4940--ASSIGN
KV$VDO_DAT.DATCTRCHRTYP
      4857**DCL      4927>>IF       4931>>IF       4938>>IF
KV$VDO_DAT.DATMOD
      4858**DCL      4942>>IF
KV$VDO_DAT.FNC
      4853**DCL      4916>>ASSIGN
KV$VDO_DAT.VLP
      4853**DCL      4949>>IF
MSG$
      4797**DCL      4217--IMP-PTR  4268--IMP-PTR  4320--IMP-PTR  4372--IMP-PTR  4423--IMP-PTR  4474--IMP-PTR
PL6.E3A0      #008=KIA$MSG File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:36 Page:428  
      4525--IMP-PTR  4621--IMP-PTR  4672--IMP-PTR  4726--IMP-PTR  4779--IMP-PTR  4953<<ASSIGN   4955>>DOCASE
      4958>>ASSIGN   4966>>CALL     4970>>ASSIGN   4974>>ASSIGN   4978>>ASSIGN   4979>>ASSIGN   4983>>ASSIGN
      4986>>ASSIGN   4991>>ASSIGN   5003>>ASSIGN   5006>>ASSIGN   5014>>ASSIGN   5015>>ASSIGN   5020>>CALL
      5020>>CALL     5027>>ASSIGN   5028>>ASSIGN   5040>>ASSIGN   5040>>ASSIGN   5049>>IF
PROTOCOL_ERR
      5082**PROC     4921--CALL     5043--CALL     5054--CALL     5061--CALL
TMP_SZ
      4799**DCL      4916<<ASSIGN   4919>>IF       4953>>ASSIGN   4961<<ASSIGN   4961>>ASSIGN   4967<<ASSIGN
      4967>>ASSIGN   4971<<ASSIGN   4971>>ASSIGN   4975<<ASSIGN   4975>>ASSIGN   4980<<ASSIGN   4980>>ASSIGN
      4987<<ASSIGN   4987>>ASSIGN   4998<<ASSIGN   4998>>ASSIGN   5009<<ASSIGN   5009>>ASSIGN   5024<<ASSIGN
      5024>>ASSIGN   5037<<ASSIGN   5037>>ASSIGN   5040<<ASSIGN   5040>>ASSIGN   5048<<ASSIGN   5048>>ASSIGN
      5048>>ASSIGN   5052>>IF       5059>>IF
TYC
      4907**DCL      4993<<ASSIGN   4997>>ASSIGN
TYC.TYCBIT
      4908**DCL      4996<<ASSIGN
VLP$EDTCTL
      3621**DCL      5067--IF
VLP$EDTCTL.KEYINCR
      3622**DCL      5068<>CALL     5068<>CALL
VLP$ERRCODE.ERR#
      4076**DCL      4994>>IF       4996>>ASSIGN
VLP$WINDOW
      3641**DCL      5071--IF
VLP$WINDOW.FWINDOW
      3641**DCL      3641--REDEF    3641--REDEF
VLP$WINDOW.LENGTH
      3642**DCL      5072<>CALL     5072<>CALL
VLP$WINDOW.ORG_PST.COLUMN
      3642**DCL      5076<>CALL     5076<>CALL
VLP$WINDOW.WIDTH
      3642**DCL      5074<>CALL     5074<>CALL

PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:429  
     2259        1        /*T***********************************************************/
     2260        2        /*T*                                                         */
     2261        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2262        4        /*T*                                                         */
     2263        5        /*T***********************************************************/
     2264        6        KIA$FPRGIN: PROC (NK$LDCT,K$RWPARM) ALTRET;
     2265        7
     2266        8        /*F*
     2267        9             NAME: KIA$FPRGIN
     2268       10             PURPOSE: To handle incoming messages for FPRG connections.
     2269       11             DESCRIPTION:
     2270       12                  This routine handle any special handling of messages for
     2271       13                  FPRG connections.
     2272       14         */
     2273       15
     2274       16        /* Include files */
     2275       17        %INCLUDE B$USER;
     2276      233        %INCLUDE GJ_MSG_M;
     2277      546        %INCLUDE HF_LOCK_C;
     2278      560        %INCLUDE KC$CP6V_C;
     2279      680        %INCLUDE KC_CP6;
     2280     1240        %INCLUDE KV$VDO;
     2281     2255        %INCLUDE NK$LDCT;
     2282     2357        %INCLUDE NK_SUBS;
     2283     2382        %INCLUDE K_DATA_R;
     2284     3093        %INCLUDE SS_SCHED_C;
     2285     3326
     2286     3327        /* Parameters */
     2287     3328        %NK$LDCT (STCLASS="");
     2288     3374        %K$RWPARM (NAME=K$RWPARM,STCLASS="");
     2289     3690
     2290     3691        /* Entry points */
     2291     3692    1   DCL KCF$FEIN ENTRY(2) ALTRET;
     2292     3693    1   DCL KIA$UCIN ENTRY(2) ALTRET;
     2293     3694    1   DCL KIA$MSG ENTRY(1) ALTRET;
     2294     3695    1   DCL KIF$FPRGEVNT ENTRY(3);
     2295     3696    1   DCL KIF$LDTRC ENTRY(1) ALTRET;
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:430  
     2296     3697    1   DCL SSR$RUE ENTRY(4);
     2297     3698    1   DCL EMR$FEP2HOST ENTRY(2);
     2298     3699
     2299     3700        /* Auto */
     2300     3701    1   DCL ERR BIT(36);
     2301     3702    1   DCL EVNT UBIN;
     2302     3703    1   DCL NEWERR BIT(36);
     2303     3704
     2304     3705        /* Symref */
     2305     3706    1   DCL B$USRT$ PTR SYMREF;
     2306     3707
     2307     3708        %GJ_FCN#;
     2308     3734        %GJ_FCN_MSG (STCLASS="BASED(K$RWPARM.MSG$)",ALGN=CALIGNED);
     2309     3759        %KV_VDO_E;
     2310     3795        %KV_VDOVLP_E;
     2311     3809        %KV_VDOMRKTYP_E;
     2312     3815        %KV_DATMOD_E;
     2313     3821        %KV_DATCTRCHRTYP_E;
     2314     3827        %KV$VDO_DAT (STCLASS="BASED(K$RWPARM.UHDR$)");
     2315     3872        %EJECT;
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:431  
     2316     3873
     2317     3874    2           DO CASE (KV$VDO_DAT.FNC);
     2318     3875
     2319     3876    2             CASE (%KV_VDO_FNC_DAT_IMD);   /* Front end telling of an event      */
     2320     3877    2               CALL KIA$MSG(K$RWPARM);
     2321     3878
     2322     3879        /* Now do the appropiate function for the message coming in from
     2323     3880             the monitor on th L6.
     2324     3881         */
     2325     3882    3               DO CASE (GJ_FCN_MSG.FCN);
     2326     3883
     2327     3884
     2328     3885    3                 CASE (%GJ_PROG_ABRT#,%GJ_PROG_EXIT#);
     2329     3886                        %LOCK (G=NK$LDCT.LOCK);
     2330     3889    3                   IF NK$LDCT.LKFLG.WAITINGEXIT AND
     2331     3890    3                     (B$USRT$->B$USER.FLG(NK$LDCT.USER)&%U_SCIO) AND
     2332     3891    3                     B$USRT$->B$USER.MISC$(NK$LDCT.USER) = ADDR(NK$LDCT)
     2333     3892    4                     THEN DO;
     2334     3893    4                       NK$LDCT.LKFLG.WAITINGEXIT = '0'B;
     2335     3894    4                       CALL SSR$RUE(%SS_CIC,NK$LDCT.USER);
     2336     3895    4                       END;
     2337     3896    3                   NK$LDCT.LKFLG.FPSTEP='1'B;
     2338     3897    3                   NK$LDCT.LKFLG.ABORTED='1'B;
     2339     3898    3                   ERR = GJ_FCN_MSG.ERR;
     2340     3899    3                   CALL EMR$FEP2HOST(ERR,NEWERR);
     2341     3900    3                   IF (NOT NK$LDCT.DFLG.SYMBIONT)
     2342     3901    3                     THEN
     2343     3902    3                       NK$LDCT.ERR = NEWERR;
     2344     3903                        %UNLOCK (G=NK$LDCT.LOCK);
     2345     3906    3                   EVNT = GJ_FCN_MSG.FCN;
     2346     3907    3                   CALL KIF$FPRGEVNT(NK$LDCT,EVNT,NEWERR);
     2347     3908    3                   IF NK$LDCT.RESCOD = NK_TSFPRG
     2348     3909    3                     THEN
     2349     3910    3                       CALL SSR$RUE(%SS_FPEVNT,NK$LDCT.USER);
     2350     3911
     2351     3912    3                 CASE (%GJ_PROG_LDTRC#);
     2352     3913                        %LOCK (G=NK$LDCT.LOCK);
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:432  
     2353     3916    3                   NK$LDCT.LKFLG.FPPM='1'B;
     2354     3917                        %UNLOCK (G=NK$LDCT.LOCK);
     2355     3920    3                   CALL SSR$RUE (%SS_FPLDTRC,NK$LDCT.USER,ADDR(NK$LDCT));
     2356     3921
     2357     3922    3                 CASE (ELSE);
     2358     3923                                                /* Should snap                        */
     2359     3924
     2360     3925    3                 END/*case gj_fcn_msg.fcn*/;
     2361     3926
     2362     3927    2             CASE (%KV_VDO_FNC_EVT);
     2363     3928
     2364     3929    2             CASE (%KV_VDO_FNC_DAT,%KV_VDO_FNC_RQSDAT,%KV_VDO_FNC_PRM_RSP,%
              3929                      KV_VDO_FNC_BLKDAT);
     2365     3930    2               IF NK$LDCT.LKFLG.FPPM OR NK$LDCT.LKFLG.FPSTEP
     2366     3931    2                 THEN GOTO UCIN;
     2367     3932    2                 ELSE GOTO CELSE;
     2368     3933    2             CASE(ELSE);
     2369     3934    3   CELSE:      DO CASE (NK$LDCT.RESCOD);
     2370     3935
     2371     3936    3                 CASE (NK_TSFPRG);
     2372     3937    4   UCIN:           CALL KIA$UCIN (NK$LDCT,K$RWPARM) WHENALTRETURN DO;
     2373     3938    4                       ALTRETURN;
     2374     3939    4                       END;
     2375     3940
     2376     3941    3                 CASE (NK_CGFPRG);
     2377     3942    4                   CALL KCF$FEIN(NK$LDCT,K$RWPARM) WHENALTRETURN DO;
     2378     3943    4                       ALTRETURN;
     2379     3944    4                       END;
     2380     3945    3                 END/*case rescod*/;
     2381     3946    2             END/*case vdo_dat.fcn*/;
     2382     3947
     2383     3948    1           RETURN;
     2384     3949
     2385     3950    1   END KIA$FPRGIN;
     2386     3951        %EOD;

PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:433  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$FPRGIN.

   Procedure KIA$FPRGIN requires 205 words for executable code.
   Procedure KIA$FPRGIN requires 12 words of local(AUTO) storage.

PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:434  

 Object Unit name= KIA$FPRGIN                                 File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:37:07.00 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  KIA$FPRGIN
    1   Proc  even  none   205    315  KIA$FPRGIN
    2  RoData even  none     7      7  KIA$FPRGIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KIA$FPRGIN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KIA$MSG
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
         yes           Std       3 KIF$FPRGEVNT
         yes           Std       4 SSR$RUE
         yes           Std       2 EMR$FEP2HOST
 yes     yes           Std       2 KCF$FEIN
 yes     yes           Std       2 KIA$UCIN
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:435  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$USRT$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:436  


     2259        1        /*T***********************************************************/
     2260        2        /*T*                                                         */
     2261        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2262        4        /*T*                                                         */
     2263        5        /*T***********************************************************/
     2264        6        KIA$FPRGIN: PROC (NK$LDCT,K$RWPARM) ALTRET;

      6  1 000000   000000 700200 xent  KIA$FPRGIN   TSX0  ! X66_AUTO_2
         1 000001   000014 000002                    ZERO    12,2

     2265        7
     2266        8        /*F*
     2267        9             NAME: KIA$FPRGIN
     2268       10             PURPOSE: To handle incoming messages for FPRG connections.
     2269       11             DESCRIPTION:
     2270       12                  This routine handle any special handling of messages for
     2271       13                  FPRG connections.
     2272       14         */
     2273       15
     2274       16        /* Include files */
     2275       17        %INCLUDE B$USER;
     2276      233        %INCLUDE GJ_MSG_M;
     2277      546        %INCLUDE HF_LOCK_C;
     2278      560        %INCLUDE KC$CP6V_C;
     2279      680        %INCLUDE KC_CP6;
     2280     1240        %INCLUDE KV$VDO;
     2281     2255        %INCLUDE NK$LDCT;
     2282     2357        %INCLUDE NK_SUBS;
     2283     2382        %INCLUDE K_DATA_R;
     2284     3093        %INCLUDE SS_SCHED_C;
     2285     3326
     2286     3327        /* Parameters */
     2287     3328        %NK$LDCT (STCLASS="");
     2288     3374        %K$RWPARM (NAME=K$RWPARM,STCLASS="");
     2289     3690
     2290     3691        /* Entry points */
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:437  
     2291     3692    1   DCL KCF$FEIN ENTRY(2) ALTRET;
     2292     3693    1   DCL KIA$UCIN ENTRY(2) ALTRET;
     2293     3694    1   DCL KIA$MSG ENTRY(1) ALTRET;
     2294     3695    1   DCL KIF$FPRGEVNT ENTRY(3);
     2295     3696    1   DCL KIF$LDTRC ENTRY(1) ALTRET;
     2296     3697    1   DCL SSR$RUE ENTRY(4);
     2297     3698    1   DCL EMR$FEP2HOST ENTRY(2);
     2298     3699
     2299     3700        /* Auto */
     2300     3701    1   DCL ERR BIT(36);
     2301     3702    1   DCL EVNT UBIN;
     2302     3703    1   DCL NEWERR BIT(36);
     2303     3704
     2304     3705        /* Symref */
     2305     3706    1   DCL B$USRT$ PTR SYMREF;
     2306     3707
     2307     3708        %GJ_FCN#;
     2308     3734        %GJ_FCN_MSG (STCLASS="BASED(K$RWPARM.MSG$)",ALGN=CALIGNED);
     2309     3759        %KV_VDO_E;
     2310     3795        %KV_VDOVLP_E;
     2311     3809        %KV_VDOMRKTYP_E;
     2312     3815        %KV_DATMOD_E;
     2313     3821        %KV_DATCTRCHRTYP_E;
     2314     3827        %KV$VDO_DAT (STCLASS="BASED(K$RWPARM.UHDR$)");
     2315     3872        %EJECT;
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:438  
     2316     3873
     2317     3874    2           DO CASE (KV$VDO_DAT.FNC);

   3874  1 000002   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000003   000014 471500                    LDP1    12,,PR0
         1 000004   000100 101500                    MRL     fill='000'O
         1 000005   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000006   200010 000002                    ADSC9   NEWERR+1,,AUTO           cn=0,n=2
         1 000007   200010 220100                    LDX0    NEWERR+1,,AUTO
         1 000010   000027 100003                    CMPX0   23,DU
         1 000011   000013 602010 1                  TNC     s:3874+9,X0
         1 000012   000266 710000 1                  TRA     CELSE
         1 000013   000266 710000 1                  TRA     CELSE
         1 000014   000266 710000 1                  TRA     CELSE
         1 000015   000257 710000 1                  TRA     s:3930
         1 000016   000266 710000 1                  TRA     CELSE
         1 000017   000266 710000 1                  TRA     CELSE
         1 000020   000257 710000 1                  TRA     s:3930
         1 000021   000042 710000 1                  TRA     s:3877
         1 000022   000266 710000 1                  TRA     CELSE
         1 000023   000266 710000 1                  TRA     CELSE
         1 000024   000266 710000 1                  TRA     CELSE
         1 000025   000266 710000 1                  TRA     CELSE
         1 000026   000266 710000 1                  TRA     CELSE
         1 000027   000266 710000 1                  TRA     CELSE
         1 000030   000314 710000 1                  TRA     s:3948
         1 000031   000266 710000 1                  TRA     CELSE
         1 000032   000266 710000 1                  TRA     CELSE
         1 000033   000266 710000 1                  TRA     CELSE
         1 000034   000266 710000 1                  TRA     CELSE
         1 000035   000257 710000 1                  TRA     s:3930
         1 000036   000266 710000 1                  TRA     CELSE
         1 000037   000266 710000 1                  TRA     CELSE
         1 000040   000266 710000 1                  TRA     CELSE
         1 000041   000257 710000 1                  TRA     s:3930

     2318     3875
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:439  
     2319     3876    2             CASE (%KV_VDO_FNC_DAT_IMD);   /* Front end telling of an event      */

     2320     3877    2               CALL KIA$MSG(K$RWPARM);

   3877  1 000042   200004 630500                    EPPR0   @K$RWPARM,,AUTO
         1 000043   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000044   000000 701000 xent               TSX1    KIA$MSG
         1 000045   000000 011000                    NOP     0

     2321     3878
     2322     3879        /* Now do the appropiate function for the message coming in from
     2323     3880             the monitor on th L6.
     2324     3881         */
     2325     3882    3               DO CASE (GJ_FCN_MSG.FCN);

   3882  1 000046   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000047   000000 471500                    LDP1    0,,PR0
         1 000050   000100 101500                    MRL     fill='000'O
         1 000051   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000052   200010 000004                    ADSC9   NEWERR+1,,AUTO           cn=0,n=4
         1 000053   200010 236100                    LDQ     NEWERR+1,,AUTO
         1 000054   000006 136007                    SBLQ    6,DL
         1 000055   000003 116007                    CMPQ    3,DL
         1 000056   000060 602006 1                  TNC     s:3882+10,QL
         1 000057   000314 710000 1                  TRA     s:3948
         1 000060   000063 710000 1                  TRA     s:3887
         1 000061   000063 710000 1                  TRA     s:3887
         1 000062   000221 710000 1                  TRA     s:3914

     2326     3883
     2327     3884
     2328     3885    3                 CASE (%GJ_PROG_ABRT#,%GJ_PROG_EXIT#);

     2329     3886                        %LOCK (G=NK$LDCT.LOCK);

   3887  1 000063   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000064   000020 036003                    ADLQ    16,DU
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:440  
         1 000065   200010 756100                    STQ     NEWERR+1,,AUTO
         1 000066   200010 630500                    EPPR0   NEWERR+1,,AUTO
         1 000067   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000070   000000 701000 xent               TSX1    HFC$LOCK
         1 000071   000000 011000                    NOP     0

     2330     3889    3                   IF NK$LDCT.LKFLG.WAITINGEXIT AND

   3889  1 000072   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000073   000011 236100                    LDQ     9,,PR0
         1 000074   010000 316003                    CANQ    4096,DU
         1 000075   000125 600000 1                  TZE     s:3896
         1 000076   000007 236100                    LDQ     7,,PR0
         1 000077   000016 772000                    QRL     14
         1 000100   017760 376007                    ANQ     8176,DL
         1 000101   000000 471400 xsym               LDP1    B$USRT$
         1 000102   100000 236106                    LDQ     0,QL,PR1
         1 000103   000000 376000 0                  ANQ     0
         1 000104   000125 600000 1                  TZE     s:3896
         1 000105   000007 236100                    LDQ     7,,PR0
         1 000106   000016 772000                    QRL     14
         1 000107   017760 376007                    ANQ     8176,DL
         1 000110   100017 236106                    LDQ     15,QL,PR1
         1 000111   200003 116100                    CMPQ    @NK$LDCT,,AUTO
         1 000112   000125 601000 1                  TNZ     s:3896

     2331     3890    3                     (B$USRT$->B$USER.FLG(NK$LDCT.USER)&%U_SCIO) AND
     2332     3891    3                     B$USRT$->B$USER.MISC$(NK$LDCT.USER) = ADDR(NK$LDCT)
     2333     3892    4                     THEN DO;

     2334     3893    4                       NK$LDCT.LKFLG.WAITINGEXIT = '0'B;

   3893  1 000113   000000 236000 2                  LDQ     0
         1 000114   000011 356100                    ANSQ    9,,PR0

     2335     3894    4                       CALL SSR$RUE(%SS_CIC,NK$LDCT.USER);

PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:441  
   3894  1 000115   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000116   000001 036000 2                  ADLQ    1
         1 000117   000002 235000 2                  LDA     2
         1 000120   200010 757100                    STAQ    NEWERR+1,,AUTO
         1 000121   200010 630500                    EPPR0   NEWERR+1,,AUTO
         1 000122   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000123   000000 701000 xent               TSX1    SSR$RUE
         1 000124   000000 011000                    NOP     0

     2336     3895    4                       END;

     2337     3896    3                   NK$LDCT.LKFLG.FPSTEP='1'B;

   3896  1 000125   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000126   000010 236003                    LDQ     8,DU
         1 000127   000011 256100                    ORSQ    9,,PR0

     2338     3897    3                   NK$LDCT.LKFLG.ABORTED='1'B;

   3897  1 000130   100000 236003                    LDQ     32768,DU
         1 000131   000011 256100                    ORSQ    9,,PR0

     2339     3898    3                   ERR = GJ_FCN_MSG.ERR;

   3898  1 000132   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 000133   100000 473500                    LDP3    0,,PR1
         1 000134   000100 100500                    MLR     fill='000'O
         1 000135   300000 400004                    ADSC9   0,,PR3                   cn=2,n=4
         1 000136   200005 000004                    ADSC9   ERR,,AUTO                cn=0,n=4

     2340     3899    3                   CALL EMR$FEP2HOST(ERR,NEWERR);

   3899  1 000137   200007 633500                    EPPR3   NEWERR,,AUTO
         1 000140   200011 453500                    STP3    NEWERR+2,,AUTO
         1 000141   200005 634500                    EPPR4   ERR,,AUTO
         1 000142   200010 454500                    STP4    NEWERR+1,,AUTO
         1 000143   200010 630500                    EPPR0   NEWERR+1,,AUTO
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:442  
         1 000144   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000145   000000 701000 xent               TSX1    EMR$FEP2HOST
         1 000146   000000 011000                    NOP     0

     2341     3900    3                   IF (NOT NK$LDCT.DFLG.SYMBIONT)

   3900  1 000147   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000150   000006 236100                    LDQ     6,,PR0
         1 000151   020000 316007                    CANQ    8192,DL
         1 000152   000155 601000 1                  TNZ     s:3904

     2342     3901    3                     THEN
     2343     3902    3                       NK$LDCT.ERR = NEWERR;

   3902  1 000153   200007 236100                    LDQ     NEWERR,,AUTO
         1 000154   000000 756100                    STQ     0,,PR0

     2344     3903                        %UNLOCK (G=NK$LDCT.LOCK);

   3904  1 000155   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000156   000020 036003                    ADLQ    16,DU
         1 000157   200010 756100                    STQ     NEWERR+1,,AUTO
         1 000160   200010 630500                    EPPR0   NEWERR+1,,AUTO
         1 000161   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000162   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000163   000000 011000                    NOP     0

     2345     3906    3                   EVNT = GJ_FCN_MSG.FCN;

   3906  1 000164   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000165   000000 471500                    LDP1    0,,PR0
         1 000166   000100 101500                    MRL     fill='000'O
         1 000167   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000170   200006 000004                    ADSC9   EVNT,,AUTO               cn=0,n=4

     2346     3907    3                   CALL KIF$FPRGEVNT(NK$LDCT,EVNT,NEWERR);

PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:443  
   3907  1 000171   200007 631500                    EPPR1   NEWERR,,AUTO
         1 000172   200012 451500                    STP1    NEWERR+3,,AUTO
         1 000173   200006 633500                    EPPR3   EVNT,,AUTO
         1 000174   200011 453500                    STP3    NEWERR+2,,AUTO
         1 000175   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000176   200010 756100                    STQ     NEWERR+1,,AUTO
         1 000177   200010 630500                    EPPR0   NEWERR+1,,AUTO
         1 000200   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000201   000000 701000 xent               TSX1    KIF$FPRGEVNT
         1 000202   000000 011000                    NOP     0

     2347     3908    3                   IF NK$LDCT.RESCOD = NK_TSFPRG

   3908  1 000203   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000204   000006 236100                    LDQ     6,,PR0
         1 000205   000017 376007                    ANQ     15,DL
         1 000206   000010 116007                    CMPQ    8,DL
         1 000207   000314 601000 1                  TNZ     s:3948

     2348     3909    3                     THEN
     2349     3910    3                       CALL SSR$RUE(%SS_FPEVNT,NK$LDCT.USER);

   3910  1 000210   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000211   000001 036000 2                  ADLQ    1
         1 000212   000004 235000 2                  LDA     4
         1 000213   200010 757100                    STAQ    NEWERR+1,,AUTO
         1 000214   200010 630500                    EPPR0   NEWERR+1,,AUTO
         1 000215   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000216   000000 701000 xent               TSX1    SSR$RUE
         1 000217   000000 011000                    NOP     0
         1 000220   000314 710000 1                  TRA     s:3948

     2350     3911
     2351     3912    3                 CASE (%GJ_PROG_LDTRC#);

     2352     3913                        %LOCK (G=NK$LDCT.LOCK);

PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:444  
   3914  1 000221   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000222   000020 036003                    ADLQ    16,DU
         1 000223   200010 756100                    STQ     NEWERR+1,,AUTO
         1 000224   200010 630500                    EPPR0   NEWERR+1,,AUTO
         1 000225   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000226   000000 701000 xent               TSX1    HFC$LOCK
         1 000227   000000 011000                    NOP     0

     2353     3916    3                   NK$LDCT.LKFLG.FPPM='1'B;

   3916  1 000230   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000231   000004 236003                    LDQ     4,DU
         1 000232   000011 256100                    ORSQ    9,,PR0

     2354     3917                        %UNLOCK (G=NK$LDCT.LOCK);

   3918  1 000233   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000234   000020 036003                    ADLQ    16,DU
         1 000235   200010 756100                    STQ     NEWERR+1,,AUTO
         1 000236   200010 630500                    EPPR0   NEWERR+1,,AUTO
         1 000237   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000240   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000241   000000 011000                    NOP     0

     2355     3920    3                   CALL SSR$RUE (%SS_FPLDTRC,NK$LDCT.USER,ADDR(NK$LDCT));

   3920  1 000242   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000243   200010 756100                    STQ     NEWERR+1,,AUTO
         1 000244   200010 630500                    EPPR0   NEWERR+1,,AUTO
         1 000245   200013 450500                    STP0    NEWERR+4,,AUTO
         1 000246   000001 036000 2                  ADLQ    1
         1 000247   200012 756100                    STQ     NEWERR+3,,AUTO
         1 000250   000006 236000 2                  LDQ     6
         1 000251   200011 756100                    STQ     NEWERR+2,,AUTO
         1 000252   200011 630500                    EPPR0   NEWERR+2,,AUTO
         1 000253   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000254   000000 701000 xent               TSX1    SSR$RUE
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:445  
         1 000255   000000 011000                    NOP     0
         1 000256   000314 710000 1                  TRA     s:3948

     2356     3921
     2357     3922    3                 CASE (ELSE);

     2358     3923                                                /* Should snap                        */
     2359     3924
     2360     3925    3                 END/*case gj_fcn_msg.fcn*/;

     2361     3926
     2362     3927    2             CASE (%KV_VDO_FNC_EVT);

     2363     3928
     2364     3929    2             CASE (%KV_VDO_FNC_DAT,%KV_VDO_FNC_RQSDAT,%KV_VDO_FNC_PRM_RSP,%
              3929                      KV_VDO_FNC_BLKDAT);

     2365     3930    2               IF NK$LDCT.LKFLG.FPPM OR NK$LDCT.LKFLG.FPSTEP

   3930  1 000257   200003 473500                    LDP3    @NK$LDCT,,AUTO
         1 000260   300011 236100                    LDQ     9,,PR3
         1 000261   000004 316003                    CANQ    4,DU
         1 000262   000277 601000 1                  TNZ     UCIN
         1 000263   000010 316003                    CANQ    8,DU
         1 000264   000277 601000 1                  TNZ     UCIN

     2366     3931    2                 THEN GOTO UCIN;
     2367     3932    2                 ELSE GOTO CELSE;

   3932  1 000265   000266 710000 1                  TRA     CELSE

     2368     3933    2             CASE(ELSE);

     2369     3934    3   CELSE:      DO CASE (NK$LDCT.RESCOD);

   3934  1 000266   200003 473500       CELSE        LDP3    @NK$LDCT,,AUTO
         1 000267   300006 236100                    LDQ     6,,PR3
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:446  
         1 000270   000017 376007                    ANQ     15,DL
         1 000271   000010 136007                    SBLQ    8,DL
         1 000272   000002 116007                    CMPQ    2,DL
         1 000273   000275 602006 1                  TNC     CELSE+7,QL
         1 000274   000314 710000 1                  TRA     s:3948
         1 000275   000277 710000 1                  TRA     UCIN
         1 000276   000306 710000 1                  TRA     s:3942

     2370     3935
     2371     3936    3                 CASE (NK_TSFPRG);

     2372     3937    4   UCIN:           CALL KIA$UCIN (NK$LDCT,K$RWPARM) WHENALTRETURN DO;

   3937  1 000277   200003 630500       UCIN         EPPR0   @NK$LDCT,,AUTO
         1 000300   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000301   000000 701000 xent               TSX1    KIA$UCIN
         1 000302   000304 702000 1                  TSX2    s:3938
         1 000303   000305 710000 1                  TRA     s:3938+1

     2373     3938    4                       ALTRETURN;

   3938  1 000304   000000 702200 xent               TSX2  ! X66_AALT
         1 000305   000314 710000 1                  TRA     s:3948

     2374     3939    4                       END;
     2375     3940
     2376     3941    3                 CASE (NK_CGFPRG);

     2377     3942    4                   CALL KCF$FEIN(NK$LDCT,K$RWPARM) WHENALTRETURN DO;

   3942  1 000306   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000307   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000310   000000 701000 xent               TSX1    KCF$FEIN
         1 000311   000313 702000 1                  TSX2    s:3943
         1 000312   000314 710000 1                  TRA     s:3948

     2378     3943    4                       ALTRETURN;
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:447  

   3943  1 000313   000000 702200 xent               TSX2  ! X66_AALT

     2379     3944    4                       END;
     2380     3945    3                 END/*case rescod*/;

     2381     3946    2             END/*case vdo_dat.fcn*/;

     2382     3947
     2383     3948    1           RETURN;

   3948  1 000314   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   0     000   000000 002000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   767777 777777   000007 200000   000007 006000   000000 000053    ...............+
   2     004   000003 006000   000000 000051   000005 006000                    .......)....
     2384     3949
     2385     3950    1   END KIA$FPRGIN;
     2386     3951        %EOD;

PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:448  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$FPRGIN.
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:449  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
     5-0-0/b BIT         r     1 ERR                        6-0-0/w UBIN        r     1 EVNT
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                   7-0-0/b BIT         r     1 NEWERR
    *0-0-0/d STRC(864)   r     1 NK$LDCT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/c STRC(54)    r     1 GJ_FCN_MSG
     0-0-0/h STRC        r     1 KV$VDO_DAT


   Procedure KIA$FPRGIN requires 205 words for executable code.
   Procedure KIA$FPRGIN requires 12 words of local(AUTO) storage.
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:450  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:451  
          MINI XREF LISTING

B$DO.ECCINFO
       168**DCL       169--REDEF
B$U.MISC
       147**DCL       148--REDEF
B$USER.FLG
       193**DCL      3889>>IF
B$USER.MISC
       223**DCL       224--REDEF
B$USER.MISC$
       224**DCL      3889>>IF
B$USRT$
      3706**DCL      3889>>IF       3889>>IF
CELSE
      3934**LABEL    3932--GOTO
EMR$FEP2HOST
      3698**DCL-ENT  3899--CALL
ERR
      3701**DCL      3898<<ASSIGN   3899<>CALL
EVNT
      3702**DCL      3906<<ASSIGN   3907<>CALL
GJ_FCN_MSG.ERR
      3754**DCL      3898>>ASSIGN
GJ_FCN_MSG.FCN
      3747**DCL      3882>>DOCASE   3906>>ASSIGN
HFC$LOCK
       559**DCL-ENT  3887--CALL     3914--CALL
HFC$UNLOCK
       559**DCL-ENT  3904--CALL     3918--CALL
K$RWPARM
      3395**DCL         6--PROC     3877<>CALL     3937<>CALL     3942<>CALL
K$RWPARM.BLKREC
      3421**DCL      3446--REDEF
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:452  
K$RWPARM.BLKREC.BLKU#
      3422**DCL      3424--REDEF
K$RWPARM.BLKREC.RECU#
      3434**DCL      3436--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      3461**DCL      3462--REDEF
K$RWPARM.DVE.EOMCHAR
      3469**DCL      3473--REDEF
K$RWPARM.ERR
      3533**DCL      3538--REDEF
K$RWPARM.FC
      3497**DCL      3498--REDEF
K$RWPARM.FLDID
      3679**DCL      3680--REDEF
K$RWPARM.FPT$
      3560**DCL      3567--REDEF
K$RWPARM.KEYTYPE
      3686**DCL      3687--REDEF
K$RWPARM.MSG$
      3396**DCL      3402--REDEF    3747--IMP-PTR  3882>>DOCASE   3898>>ASSIGN   3906>>ASSIGN
K$RWPARM.MSGID
      3508**DCL      3513--REDEF
K$RWPARM.MSGIDXT
      3521**DCL      3525--REDEF
K$RWPARM.ORG
      3657**DCL      3658--REDEF
K$RWPARM.THDRSZ
      3601**DCL      3605--REDEF
K$RWPARM.UHDR$
      3546**DCL      3860--IMP-PTR  3874>>DOCASE
K$RWPARM.VDOFLGS
      3659**DCL      3670--REDEF
KCF$FEIN
      3692**DCL-ENT  3942--CALL
KIA$MSG
      3694**DCL-ENT  3877--CALL
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:453  
KIA$UCIN
      3693**DCL-ENT  3937--CALL
KIF$FPRGEVNT
      3695**DCL-ENT  3907--CALL
KV$VDO_DAT.FNC
      3864**DCL      3874>>DOCASE
K_RWPARM_CON.BLKREC
      2823**DCL      2848--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      2824**DCL      2826--REDEF
K_RWPARM_CON.BLKREC.RECU#
      2836**DCL      2838--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      2863**DCL      2864--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      2871**DCL      2875--REDEF
K_RWPARM_CON.ERR
      2935**DCL      2940--REDEF
K_RWPARM_CON.FC
      2899**DCL      2900--REDEF
K_RWPARM_CON.FLDID
      3081**DCL      3082--REDEF
K_RWPARM_CON.FPT$
      2962**DCL      2969--REDEF
K_RWPARM_CON.KEYTYPE
      3088**DCL      3089--REDEF
K_RWPARM_CON.MSG$
      2798**DCL      2804--REDEF
K_RWPARM_CON.MSGID
      2910**DCL      2915--REDEF
K_RWPARM_CON.MSGIDXT
      2923**DCL      2927--REDEF
K_RWPARM_CON.ORG
      3059**DCL      3060--REDEF
K_RWPARM_CON.THDRSZ
      3003**DCL      3007--REDEF
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:454  
K_RWPARM_CON.VDOFLGS
      3061**DCL      3072--REDEF
NEWERR
      3703**DCL      3899<>CALL     3902>>ASSIGN   3907<>CALL
NK$LDCT
      3341**DCL         6--PROC     3889--IF       3907<>CALL     3920--CALL     3937<>CALL     3942<>CALL
NK$LDCT.DDT$
      3343**DCL      3343--REDEF
NK$LDCT.DFLG.SYMBIONT
      3346**DCL      3900>>IF
NK$LDCT.ERR
      3342**DCL      3902<<ASSIGN
NK$LDCT.IOQ$
      3342**DCL      3343--REDEF
NK$LDCT.LDCTX
      3344**DCL      3344--REDEF
NK$LDCT.LKFLG.ABORTED
      3356**DCL      3357--REDEF    3897<<ASSIGN
NK$LDCT.LKFLG.FPPM
      3361**DCL      3916<<ASSIGN   3930>>IF
NK$LDCT.LKFLG.FPSTEP
      3361**DCL      3896<<ASSIGN   3930>>IF
NK$LDCT.LKFLG.WAITINGEXIT
      3358**DCL      3889>>IF       3893<<ASSIGN
NK$LDCT.LOCK
      3369**DCL      3887<>CALL     3904<>CALL     3914<>CALL     3918<>CALL
NK$LDCT.RESCOD
      3349**DCL      3908>>IF       3934>>DOCASE
NK$LDCT.RLCID.LDCTX
      3366**DCL      3366--REDEF
NK$LDCT.STA$
      3362**DCL      3363--REDEF
NK$LDCT.SYMB$
      3341**DCL      3341--REDEF    3341--REDEF    3342--REDEF
NK$LDCT.USER
      3351**DCL      3889>>IF       3889>>IF       3894<>CALL     3910<>CALL     3920<>CALL
PL6.E3A0      #009=KIA$FPRGIN File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:455  
SSR$RUE
      3697**DCL-ENT  3894--CALL     3910--CALL     3920--CALL
UCIN
      3937**LABEL    3931--GOTO

PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:456  
     2387        1        /*T***********************************************************/
     2388        2        /*T*                                                         */
     2389        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2390        4        /*T*                                                         */
     2391        5        /*T***********************************************************/
     2392        6        /*D* NAME:        KIA$FPCNCT
     2393        7             PURPOSE:     To complete the path connection process for FPRG connects
     2394        8             CALL:        CALL KIA$FPCNCT (NK$LDCT);
     2395        9             INPUT:       NK$LDCT - The LDCT that is completing connection
     2396       10                          NK$LDCT.LOCK - Locked on entry
     2397       11             OUTPUT:      NK$LDCT.LOCK - Unlocked on exit
     2398       12                          NK$LDCT - Possibly released
     2399       13                          NK$LDCT.LKFLG.FPSTEP - Set
     2400       14             DESCRIPTION: KIA$FPCNCT is called to complete the path connection
     2401       15                          process for NK$LDCT.RESCOD=NK_TSFPRG or NK_CGFPRG
     2402       16                          type connects. It is called with NK$LDCT.LOCK locked
     2403       17                          since **BEFORE** NK$LDCT.RLCID was set non-zero
     2404       18                          so that we can be sure that no other comgroup
     2405       19                          deactivate process has sent KX_DREQ down the path.
     2406       20                          KIA$FPCNCT sets NK$LDCT.LKFLG.FPSTEP indicating that the
     2407       21                          FPRG at the other end is at jobstep awaiting M$SETFP.
     2408       22                          If a user is waiting, that user is RUEed. Finally,
     2409       23                          if this is a CGFPRG connection and the LDCT is still
     2410       24                          marked ACTIVE, we start reads for the terminal.
     2411       25        */
     2412       26
     2413       27        KIA$FPCNCT: PROC(NK$LDCT) ALTRET;
     2414       28        %INCLUDE B_ERRORS_C;
     2415     1155        %INCLUDE FM$MACROS;
     2416     1530        %INCLUDE GJ_MSG_M;
     2417     1843        %INCLUDE HF_LOCK_C;
     2418     1857        %INCLUDE K_DATA_R;
     2419     2568        %INCLUDE K_SUBS_C;
     2420     2601        %INCLUDE NK$LDCT;
     2421     2703        %INCLUDE NK_SUBS;
     2422     2728        %INCLUDE SS_SCHED_C;
     2423     2961        %GJ_FCN#;
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:457  
     2424     2987        %NK$LDCT (STCLASS="");
     2425     3033        %K$RWPARM (NAME=K$RWPARM,STCLASS="");
     2426     3349        %SUB FCG#='1311'O;
     2427     3350        %SUB MID#='01'O;
     2428     3351        %ERRCODE (NAME=E_LDSC,COD#=%E$LDSC);
     2429     3355    1   DCL KCF$FERDS  ENTRY(1) ALTRET;
     2430     3356    1   DCL SSR$RUE    ENTRY(4);
     2431     3357    1   DCL KIS$SEND ENTRY(1) ALTRET;
     2432     3358
     2433     3359    1           K$RWPARM = K_RWPARM_CON;
     2434     3360    1           K$RWPARM.LDCT$ = ADDR(NK$LDCT);
     2435     3361    1           K$RWPARM.FUNCTION = %K_CONNECT_ACK;
     2436     3362    2           CALL KIS$SEND (K$RWPARM) WHENALTRETURN DO;
     2437     3363    2               ALTRETURN;
     2438     3364    2               END;
     2439     3365    1           IF NK$LDCT.LKFLG.REGGED
     2440     3366    1             THEN CALL SSR$RUE(%SS_CIC,NK$LDCT.USER);
     2441     3367    1           NK$LDCT.LKFLG.FPSTEP='1'B;
     2442     3368    1           NK$LDCT.LKFLG.REGGED='0'B;
     2443     3369    1           NK$LDCT.ERR = '0'B;
     2444     3370                %UNLOCK (G=NK$LDCT.LOCK);
     2445     3373    1           IF NK$LDCT.RESCOD=NK_CGFPRG AND NK$LDCT.LKFLG.REGGED='1'B
     2446     3374    1             AND NK$LDCT.DFLG.INPUT='1'B
     2447     3375    1             THEN CALL KCF$FERDS(NK$LDCT);
     2448     3376    1           RETURN;
     2449     3377    1   END KIA$FPCNCT;
     2450     3378        %EOD;

PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:458  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$FPCNCT.

   Procedure KIA$FPCNCT requires 58 words for executable code.
   Procedure KIA$FPCNCT requires 46 words of local(AUTO) storage.

PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:459  

 Object Unit name= KIA$FPCNCT                                 File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:37:32.84 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  KIA$FPCNCT
    1   Proc  even  none    58     72  KIA$FPCNCT
    2  RoData even  none     3      3  KIA$FPCNCT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KIA$FPCNCT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KIS$SEND
         yes           Std       1 HFC$UNLOCK
         yes           Std       4 SSR$RUE
 yes     yes           Std       1 KCF$FERDS
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:460  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    K_RWPARM_CON                          B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:461  


     2387        1        /*T***********************************************************/
     2388        2        /*T*                                                         */
     2389        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2390        4        /*T*                                                         */
     2391        5        /*T***********************************************************/
     2392        6        /*D* NAME:        KIA$FPCNCT
     2393        7             PURPOSE:     To complete the path connection process for FPRG connects
     2394        8             CALL:        CALL KIA$FPCNCT (NK$LDCT);
     2395        9             INPUT:       NK$LDCT - The LDCT that is completing connection
     2396       10                          NK$LDCT.LOCK - Locked on entry
     2397       11             OUTPUT:      NK$LDCT.LOCK - Unlocked on exit
     2398       12                          NK$LDCT - Possibly released
     2399       13                          NK$LDCT.LKFLG.FPSTEP - Set
     2400       14             DESCRIPTION: KIA$FPCNCT is called to complete the path connection
     2401       15                          process for NK$LDCT.RESCOD=NK_TSFPRG or NK_CGFPRG
     2402       16                          type connects. It is called with NK$LDCT.LOCK locked
     2403       17                          since **BEFORE** NK$LDCT.RLCID was set non-zero
     2404       18                          so that we can be sure that no other comgroup
     2405       19                          deactivate process has sent KX_DREQ down the path.
     2406       20                          KIA$FPCNCT sets NK$LDCT.LKFLG.FPSTEP indicating that the
     2407       21                          FPRG at the other end is at jobstep awaiting M$SETFP.
     2408       22                          If a user is waiting, that user is RUEed. Finally,
     2409       23                          if this is a CGFPRG connection and the LDCT is still
     2410       24                          marked ACTIVE, we start reads for the terminal.
     2411       25        */
     2412       26
     2413       27        KIA$FPCNCT: PROC(NK$LDCT) ALTRET;

     27  1 000000   000000 700200 xent  KIA$FPCNCT   TSX0  ! X66_AUTO_1
         1 000001   000056 000001                    ZERO    46,1

     2414       28        %INCLUDE B_ERRORS_C;
     2415     1155        %INCLUDE FM$MACROS;
     2416     1530        %INCLUDE GJ_MSG_M;
     2417     1843        %INCLUDE HF_LOCK_C;
     2418     1857        %INCLUDE K_DATA_R;
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:462  
     2419     2568        %INCLUDE K_SUBS_C;
     2420     2601        %INCLUDE NK$LDCT;
     2421     2703        %INCLUDE NK_SUBS;
     2422     2728        %INCLUDE SS_SCHED_C;
     2423     2961        %GJ_FCN#;
     2424     2987        %NK$LDCT (STCLASS="");
     2425     3033        %K$RWPARM (NAME=K$RWPARM,STCLASS="");
     2426     3349        %SUB FCG#='1311'O;
     2427     3350        %SUB MID#='01'O;
     2428     3351        %ERRCODE (NAME=E_LDSC,COD#=%E$LDSC);
     2429     3355    1   DCL KCF$FERDS  ENTRY(1) ALTRET;
     2430     3356    1   DCL SSR$RUE    ENTRY(4);
     2431     3357    1   DCL KIS$SEND ENTRY(1) ALTRET;
     2432     3358
     2433     3359    1           K$RWPARM = K_RWPARM_CON;

   3359  1 000002   000100 100400                    MLR     fill='000'O
         1 000003   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000004   200004 000234                    ADSC9   K$RWPARM,,AUTO           cn=0,n=156

     2434     3360    1           K$RWPARM.LDCT$ = ADDR(NK$LDCT);

   3360  1 000005   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000006   200022 756100                    STQ     K$RWPARM+14,,AUTO

     2435     3361    1           K$RWPARM.FUNCTION = %K_CONNECT_ACK;

   3361  1 000007   000012 235007                    LDA     10,DL
         1 000010   200024 755100                    STA     K$RWPARM+16,,AUTO

     2436     3362    2           CALL KIS$SEND (K$RWPARM) WHENALTRETURN DO;

   3362  1 000011   200004 630500                    EPPR0   K$RWPARM,,AUTO
         1 000012   200054 450500                    STP0    K$RWPARM+40,,AUTO
         1 000013   200054 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000014   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000015   000000 701000 xent               TSX1    KIS$SEND
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:463  
         1 000016   000020 702000 1                  TSX2    s:3363
         1 000017   000021 710000 1                  TRA     s:3365

     2437     3363    2               ALTRETURN;

   3363  1 000020   000000 702200 xent               TSX2  ! X66_AALT

     2438     3364    2               END;
     2439     3365    1           IF NK$LDCT.LKFLG.REGGED

   3365  1 000021   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000022   000011 236100                    LDQ     9,,PR0
         1 000023   100000 316003                    CANQ    32768,DU
         1 000024   000035 600000 1                  TZE     s:3367

     2440     3366    1             THEN CALL SSR$RUE(%SS_CIC,NK$LDCT.USER);

   3366  1 000025   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000026   000000 036000 2                  ADLQ    0
         1 000027   000001 235000 2                  LDA     1
         1 000030   200054 757100                    STAQ    K$RWPARM+40,,AUTO
         1 000031   200054 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000032   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000033   000000 701000 xent               TSX1    SSR$RUE
         1 000034   000000 011000                    NOP     0

     2441     3367    1           NK$LDCT.LKFLG.FPSTEP='1'B;

   3367  1 000035   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000036   000010 236003                    LDQ     8,DU
         1 000037   000011 256100                    ORSQ    9,,PR0

     2442     3368    1           NK$LDCT.LKFLG.REGGED='0'B;

   3368  1 000040   000002 236000 2                  LDQ     2
         1 000041   000011 356100                    ANSQ    9,,PR0

PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:464  
     2443     3369    1           NK$LDCT.ERR = '0'B;

   3369  1 000042   000000 450100                    STZ     0,,PR0

     2444     3370                %UNLOCK (G=NK$LDCT.LOCK);

   3371  1 000043   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000044   000020 036003                    ADLQ    16,DU
         1 000045   200054 756100                    STQ     K$RWPARM+40,,AUTO
         1 000046   200054 630500                    EPPR0   K$RWPARM+40,,AUTO
         1 000047   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000050   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000051   000000 011000                    NOP     0

     2445     3373    1           IF NK$LDCT.RESCOD=NK_CGFPRG AND NK$LDCT.LKFLG.REGGED='1'B

   3373  1 000052   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000053   000006 236100                    LDQ     6,,PR0
         1 000054   000017 376007                    ANQ     15,DL
         1 000055   000011 116007                    CMPQ    9,DL
         1 000056   000071 601000 1                  TNZ     s:3376
         1 000057   000011 236100                    LDQ     9,,PR0
         1 000060   100000 316003                    CANQ    32768,DU
         1 000061   000071 600000 1                  TZE     s:3376
         1 000062   000006 236100                    LDQ     6,,PR0
         1 000063   400000 316007                    CANQ    -131072,DL
         1 000064   000071 600000 1                  TZE     s:3376

     2446     3374    1             AND NK$LDCT.DFLG.INPUT='1'B
     2447     3375    1             THEN CALL KCF$FERDS(NK$LDCT);

   3375  1 000065   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000066   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000067   000000 701000 xent               TSX1    KCF$FERDS
         1 000070   000000 011000                    NOP     0

     2448     3376    1           RETURN;
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:465  

   3376  1 000071   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   0     000   131101 000142                                                    YA.b

(unnamed)
 Sect OctLoc
   2     000   000007 200000   000007 006000   677777 777777                    ............
     2449     3377    1   END KIA$FPCNCT;
     2450     3378        %EOD;

PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:466  
--  Include file information  --

   SS_SCHED_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$FPCNCT.
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:467  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NK$LDCT                   4-0-0/d STRC(1404)  r     1 K$RWPARM
    *0-0-0/d STRC(864)   r     1 NK$LDCT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1404)  r     1 K_RWPARM_CON


   Procedure KIA$FPCNCT requires 58 words for executable code.
   Procedure KIA$FPCNCT requires 46 words of local(AUTO) storage.
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:468  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:469  
          MINI XREF LISTING

HFC$UNLOCK
      1856**DCL-ENT  3371--CALL
K$RWPARM
      3054**DCL      3359<<ASSIGN   3362<>CALL
K$RWPARM.BLKREC
      3080**DCL      3105--REDEF
K$RWPARM.BLKREC.BLKU#
      3081**DCL      3083--REDEF
K$RWPARM.BLKREC.RECU#
      3093**DCL      3095--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      3120**DCL      3121--REDEF
K$RWPARM.DVE.EOMCHAR
      3128**DCL      3132--REDEF
K$RWPARM.ERR
      3192**DCL      3197--REDEF
K$RWPARM.FC
      3156**DCL      3157--REDEF
K$RWPARM.FLDID
      3338**DCL      3339--REDEF
K$RWPARM.FPT$
      3219**DCL      3226--REDEF
K$RWPARM.FUNCTION
      3233**DCL      3361<<ASSIGN
K$RWPARM.KEYTYPE
      3345**DCL      3346--REDEF
K$RWPARM.LDCT$
      3215**DCL      3360<<ASSIGN
K$RWPARM.MSG$
      3055**DCL      3061--REDEF
K$RWPARM.MSGID
      3167**DCL      3172--REDEF
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:470  
K$RWPARM.MSGIDXT
      3180**DCL      3184--REDEF
K$RWPARM.ORG
      3316**DCL      3317--REDEF
K$RWPARM.THDRSZ
      3260**DCL      3264--REDEF
K$RWPARM.VDOFLGS
      3318**DCL      3329--REDEF
KCF$FERDS
      3355**DCL-ENT  3375--CALL
KIS$SEND
      3357**DCL-ENT  3362--CALL
K_RWPARM_CON
      2272**DCL      3359>>ASSIGN
K_RWPARM_CON.BLKREC
      2298**DCL      2323--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      2299**DCL      2301--REDEF
K_RWPARM_CON.BLKREC.RECU#
      2311**DCL      2313--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      2338**DCL      2339--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      2346**DCL      2350--REDEF
K_RWPARM_CON.ERR
      2410**DCL      2415--REDEF
K_RWPARM_CON.FC
      2374**DCL      2375--REDEF
K_RWPARM_CON.FLDID
      2556**DCL      2557--REDEF
K_RWPARM_CON.FPT$
      2437**DCL      2444--REDEF
K_RWPARM_CON.KEYTYPE
      2563**DCL      2564--REDEF
K_RWPARM_CON.MSG$
      2273**DCL      2279--REDEF
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:471  
K_RWPARM_CON.MSGID
      2385**DCL      2390--REDEF
K_RWPARM_CON.MSGIDXT
      2398**DCL      2402--REDEF
K_RWPARM_CON.ORG
      2534**DCL      2535--REDEF
K_RWPARM_CON.THDRSZ
      2478**DCL      2482--REDEF
K_RWPARM_CON.VDOFLGS
      2536**DCL      2547--REDEF
NK$LDCT
      3000**DCL        27--PROC     3360--ASSIGN   3375<>CALL
NK$LDCT.DDT$
      3002**DCL      3002--REDEF
NK$LDCT.DFLG.INPUT
      3004**DCL      3373>>IF
NK$LDCT.ERR
      3001**DCL      3369<<ASSIGN
NK$LDCT.IOQ$
      3001**DCL      3002--REDEF
NK$LDCT.LDCTX
      3003**DCL      3003--REDEF
NK$LDCT.LKFLG.ABORTED
      3015**DCL      3016--REDEF
NK$LDCT.LKFLG.FPSTEP
      3020**DCL      3367<<ASSIGN
NK$LDCT.LKFLG.REGGED
      3016**DCL      3365>>IF       3368<<ASSIGN   3373>>IF
NK$LDCT.LOCK
      3028**DCL      3371<>CALL
NK$LDCT.RESCOD
      3008**DCL      3373>>IF
NK$LDCT.RLCID.LDCTX
      3025**DCL      3025--REDEF
NK$LDCT.STA$
      3021**DCL      3022--REDEF
PL6.E3A0      #010=KIA$FPCNCT File=KIA$APPLC.:E05TSI                             WED 07/30/97 00:37 Page:472  
NK$LDCT.SYMB$
      3000**DCL      3000--REDEF    3000--REDEF    3001--REDEF
NK$LDCT.USER
      3010**DCL      3366<>CALL
SSR$RUE
      3356**DCL-ENT  3366--CALL

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:473  
     2451        1        /*T***********************************************************/
     2452        2        /*T*                                                         */
     2453        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2454        4        /*T*                                                         */
     2455        5        /*T***********************************************************/
     2456        6        KIA$VDO: PROC(FUNCTION,K$RWPARM,HDR) ALTRET;
     2457        7
     2458        8        %INCLUDE CP_6_SUBS;
     2459      548        %INCLUDE KI$CP6V_C;
     2460      987        %INCLUDE KV$VDO;
     2461     2002        %INCLUDE K_DATA_R;
     2462     2713        %INCLUDE K_SUBS_C;
     2463     2746        %INCLUDE KI_DATA_R;
     2464     2772        %INCLUDE NK$LDCT;
     2465     2874        %INCLUDE NK_VFC_C;
     2466     2948        %INCLUDE KV_PRMID_E;
     2467     3122        %KV_PRMID_E;
     2468     3278        %INCLUDE UM_CP6;
     2469     4130        %INCLUDE K_CP6_M;
     2470     4326
     2471     4327        /* Parameters */
     2472     4328    1   DCL FUNCTION UBIN;
     2473     4329        %NK$LDCT (STCLASS="");
     2474     4375        %K$RWPARM (NAME=K$RWPARM);
     2475     4691    1   DCL HDR CHAR(100);
     2476     4692
     2477     4693        /* Based structures */
     2478     4694    1   DCL B$UHDR CHAR(K$RWPARM.UHDRSZ) BASED;
     2479     4695    1   DCL 1 TL BASED(HDR$) CALIGNED,
     2480     4696    1         2 PRMID UBIN BYTE UNAL,
     2481     4697    1         2 LENGTH UBIN BYTE UNAL;
     2482     4698    1   DCL 1 SIN BASED(HDR$) CALIGNED,
     2483     4699    1         2 STR UBIN BYTE CALIGNED,
     2484     4700    1         2 FIL,
     2485     4701    1           3 CLM BIT(18),
     2486     4702    1           3 * BIT(9);
     2487     4703        %NK$VFC;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:474  
     2488     4721        %KV_VDO_ALL;
     2489     6863        %KV$VDOVLP_MRK (NAME=VDOVLP_MRK,STCLASS=BASED,LAST=",");
     2490     6916    1         2 BMRK REDEF ID,
     2491     6917    1           3 BLK# UBIN (18) UNAL,
     2492     6918    1           3 REC# UBIN (18) UNAL;
     2493     6919    1   DCL 1 VDO BASED,
     2494     6920    1         2 * CHAR(VDOSZ);
     2495     6921    1   DCL B$FLDID CHAR(2) UNAL BASED;
     2496     6922    1   DCL KEY CHAR(K$RWPARM.KEYSZ) BASED;
     2497     6923        %FPT$DCLFLD_V(BASED="BASED(K$RWPARM.V$)");
     2498     6943        %FPT$ERASE_V(BASED="BASED(K$RWPARM.V$)");
     2499     6959        %FPT$MDFFLD_V(BASED="BASED(K$RWPARM.V$)");
     2500     6975        %FPT$TRMPRG_V(BASED="BASED(K$RWPARM.V$)");
     2501     6987        %VLP$FLDATR_V(FPTN=VLP$FLDATR,BASED="BASED(K$RWPARM.VLP$)");
     2502     7004        /* Auto */
     2503     7005    1   DCL HDR$ PTR;
     2504     7006    1   DCL 1 HDRA REDEF HDR$,
     2505     7007    1         2 * BIT(18) UNAL,
     2506     7008    1         2 NHWA BIT(1) UNAL ,
     2507     7009    1         2 * BIT(17) UNAL;
     2508     7010
     2509     7011    1   DCL LHDR$ PTR;
     2510     7012    1   DCL TEMP1 REDEF LHDR$ UBIN WORD ;
     2511     7013    1   DCL TEMP1S REDEF LHDR$ SBIN WORD ;
     2512     7014    1   DCL VDOSZ UBIN;
     2513     7015    1   DCL 1 GLOM ,
     2514     7016    1         2 FLDID,
     2515     7017    1           3 FILLER UBIN HALF HALIGNED,
     2516     7018    1           3 ID UBIN HALF HALIGNED,
     2517     7019    1           3 IDC REDEF ID CHAR(2),
     2518     7020    1         2 OP6$ REDEF FLDID PTR ,
     2519     7021    1         2 ERR BIT(36) ALIGNED,
     2520     7022    1         2 TEMP0 REDEF ERR UBIN WORD ,
     2521     7023    1         2 TEMP0S REDEF ERR SBIN WORD ,
     2522     7024    1         2 TEMP2 REDEF ERR,
     2523     7025    1           3 * BIT(4) UNAL,
     2524     7026    1           3 B1 UBIN(8) UNAL,
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:475  
     2525     7027    1           3 B2 UBIN(8) UNAL ,
     2526     7028    1           3 B3 UBIN(8) UNAL ,
     2527     7029    1           3 B4 UBIN(8) UNAL ,
     2528     7030    1         2 TEMP3 REDEF ERR,
     2529     7031    1           3 BY1 UBIN(9) UNAL ,
     2530     7032    1           3 BY2 UBIN(9) UNAL ,
     2531     7033    1           3 BY3 UBIN(9) UNAL ,
     2532     7034    1           3 BY4 UBIN(9) UNAL ,
     2533     7035    1         2 OP$ PTR,
     2534     7036    1         2 TEMP5 REDEF OP$ UBIN,
     2535     7037    1         2 TEMP5S REDEF OP$ SBIN,
     2536     7038    1         2 TEMP4 REDEF OP$ BIT(36) ;
     2537     7039    1   DCL MSGSZ UBIN;
     2538     7040    1   DCL B$CHAR CHAR(1) BASED(GLOM.OP$) UNAL;
     2539     7041    1   DCL 1 SPREAD BASED UNAL ,
     2540     7042    1         2 HI UBIN(10) UNAL ,
     2541     7043    1         2 LO8 UBIN(8) UNAL ;
     2542     7044
     2543     7045        /* Refs */
     2544     7046    1   DCL NK_BLNKSUPTBL CHAR(512) DALIGNED SYMREF; /* Can NOT be B$SR_xxx
     2545     7047                                              because this runs at interrupt
     2546     7048                                              and there might not be a user mapped */
     2547     7049        %KV$VDOVLP_CG_MSGID (NAME=KI_VDOVLP_CG_MSGID,STCLASS=SYMREF);
     2548     7101        %KV$VDOVLP_CG_MSGTYP (NAME=KI_VDOVLP_CG_MSGTYP,STCLASS=SYMREF);
     2549     7153        %KV$VDOVLP_CG_STA (NAME=KI_VDOVLP_CG_STA,STCLASS=SYMREF);
     2550     7204        %KV$VDOVLP_DAT1 (NAME=KI_VDOVLP_DAT1,STCLASS=SYMREF);
     2551     7254        %KV$VDOVLP_DAT2 (NAME=KI_VDOVLP_DAT2,STCLASS=SYMREF);
     2552     7304        %KV$VDOVLP_ERR (NAME=KI_VDOVLP_ERR,STCLASS=SYMREF);
     2553     7400        %KV$VDOVLP_FLDID (NAME=KI_VDOVLP_FLDID,STCLASS=SYMREF);
     2554     7451        %KV$VDOVLP_KEY (NAME=KI_VDOVLP_KEY,STCLASS=SYMREF);
     2555     7501        %KV$VDOVLP_MRK (NAME=KI_VDOVLP_MRK,STCLASS=SYMREF);
     2556     7554        %KV_VDOBYTSIZ (NAME=KI_VDOBYTSIZ,STCLASS=SYMREF);
     2557     7574    1   DCL 1 WAVDO BASED(HDR$) ALIGNED ,
     2558     7575                 %KV$VDO (LVL=2) ;
     2559     7602    1   DCL 1 WACLSSTR BASED(HDR$) ALIGNED ,
     2560     7603                  %KV$VDO_CLSSTR (LVL=2) ;
     2561     7646    1   DCL 1 WABLKDAT BASED(HDR$) ALIGNED ,
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:476  
     2562     7647                  %KV$VDO_BLKDAT (LVL=2) ;
     2563     7690    1   DCL BIT2BSD BIT(2) BASED UNAL ;
     2564     7691    1   DCL UBN3BSD UBIN(3) BASED UNAL;
     2565     7692    1   DCL CHR12BSD CHAR(12) CALIGNED BASED;
     2566     7693    1   DCL BT36 BIT(36) BASED UNAL    ;
     2567     7694    1   DCL CHR4BSD CHAR(4) BASED CALIGNED;
     2568     7695    1   DCL 1 SOURCE BASED(GLOM.OP6$) UNAL ,
     2569     7696    1         2 BY1 UBIN(8) UNAL,
     2570     7697    1         2 BY2 UBIN(8) UNAL,
     2571     7698    1         2 BY3 UBIN(8) UNAL,
     2572     7699    1         2 BY4 UBIN(8) UNAL;
     2573     7700    1   DCL 1 DEST BASED(HDR$) CALIGNED ,
     2574     7701    1         2 * BIT(1) UNAL , 2 BY1 UBIN(8) UNAL ,
     2575     7702    1         2 * BIT(1) UNAL , 2 BY2 UBIN(8) UNAL ,
     2576     7703    1         2 * BIT(1) UNAL , 2 BY3 UBIN(8) UNAL ,
     2577     7704    1         2 * BIT(1) UNAL , 2 BY4 UBIN(8) UNAL ;
     2578     7705
     2579     7706    1   DCL CHRMSG CHAR(GLOM.TEMP5) BASED ;
     2580     7707    1   DCL 1 WADAT BASED(HDR$) ALIGNED,
     2581     7708                  %KV$VDO_DAT (LVL=2) ;
     2582     7753    1   DCL 1 WADCLFLD BASED(HDR$) ALIGNED ,
     2583     7754                  %KV$VDO_DCLFLD (LVL=2) ;
     2584     7880    1   DCL 1 WADCLSTR BASED(HDR$) ALIGNED ,
     2585     7881                  %KV$VDO_DCLSTR (LVL=2) ;
     2586     7924    1   DCL 1 WADLT BASED(HDR$) ALIGNED ,
     2587     7925                  %KV$VDO_DLT (LVL=2) ;
     2588     7970    1   DCL 1 WAERS BASED(HDR$) ALIGNED ,
     2589     7971                  %KV$VDO_ERS (LVL=2) ;
     2590     8014    1   DCL 1 WAOPNSTR BASED(HDR$) ALIGNED ,
     2591     8015                  %KV$VDO_OPNSTR (LVL=2) ;
     2592     8058    1   DCL 1 WARQSDAT BASED(HDR$) ALIGNED ,
     2593     8059                  %KV$VDO_RQSDAT (LVL=2) ;
     2594     8107    1   DCL 1 WARQSPRM BASED(HDR$) ALIGNED ,
     2595     8108                  %KV$VDO_RQSPRM (LVL=2) ;
     2596     8151    1   DCL 1 WASLCGRPRND BASED(HDR$) ALIGNED ,
     2597     8152                  %KV$VDO_SLCGRPRND (LVL=2) ;
     2598     8234    1   DCL 1 WASLCQLF BASED(HDR$) ALIGNED ,
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:477  
     2599     8235                  %KV$VDO_SLCQLF (LVL=2) ;
     2600     8320    1   DCL KIA$9TO8 ENTRY(3);
     2601     8321    1   DCL EMR$HOST2FEP ENTRY(2);
     2602     8322    1   DCL HFF$TRAPALT ENTRY ALTRET;
     2603     8323    1   DCL SC_BADVDOFNC ENTRY CONV(2,0);
     2604     8324
     2605     8325
     2606     8326        /* Constant */
     2607     8327        /* This table translates VFC to the proper PRMID for VDH */
     2608     8328    1   DCL 1 TRAN_PRMID(0:15) UBIN BYTE CONSTANT UNAL INIT(0,
     2609     8329    1                         %KV_PRMID_OTPTAB, /* VFCS_OTAB                          */
     2610     8330    1                                      0,   /* VFCS_SEQN                          */
     2611     8331    1                         %KV_PRMID_INPTAB, /* VFCS_ITAB                          */
     2612     8332    1                                      0,   /* VFCS_SPRM                          */
     2613     8333    1                                      0,   /* VFCS_SPRO                          */
     2614     8334    1                      %KV_PRMID_EDTBFR,    /* %VFC_SLLN                          */
     2615     8335    1                      %KV_PRMID_REREADCLM, /* VFCS_SLLP                          */
     2616     8336    1                         %KV_PRMID_DCBHDR, /* VFCS_SHDR                          */
     2617     8337    1                                      0,   /* VFCS_SLPP                          */
     2618     8338    1                                      0,   /* VFCS_SPND                          */
     2619     8339    1                            0,             /* VFCS_SVFU                          */
     2620     8340    1                                      0,   /* VFCS_SLCHN                         */
     2621     8341    1                                      0,   /* VFCS_CLRWND                        */
     2622     8342    1                                      0,   /* VFCS_TRS0                          */
     2623     8343    1                                      0);  /* VFCS_TRS1                          */
     2624     8344        %EJECT;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:478  
     2625     8345
     2626     8346
     2627     8347
     2628     8348    1           HDR$ = ADDR(HDR);
     2629     8349    1           IF FUNCTION > %KV_VDO_FNC_HI
     2630     8350    2             THEN DO;
     2631     8351    2               CALL SC_BADVDOFNC;
     2632     8352    2               RETURN;
     2633     8353    2               END;
     2634     8354    1           VDOSZ = KI_VDOBYTSIZ(FUNCTION);
     2635     8355    1           HDR$->VDO = '0'B;
     2636     8356    1           WAVDO.KV$VDO.FNC = FUNCTION;
     2637     8357
     2638     8358    1           WAVDO.KV$VDO.STR = K$RWPARM.STR;
     2639     8359    1           IF K$RWPARM.MSG$ = ADDR(NIL)
     2640     8360    1             THEN
     2641     8361    1               MSGSZ = 0;
     2642     8362    2             ELSE DO;
     2643     8363    2               IF K$RWPARM.DVE.DVBYTE.BIN
     2644     8364    2                 THEN
     2645     8365    2                   K$RWPARM.MSGSZ = (K$RWPARM.MSGSZ * 9 + 7) / 8;
     2646     8366    2               MSGSZ = K$RWPARM.MSGSZ;
     2647     8367    2               END;
     2648     8368
     2649     8369    2           DO CASE (FUNCTION);
     2650     8370
     2651     8371    2             CASE (%KV_VDO_FNC_BLKDAT);
     2652     8372    2               GLOM.TEMP0 = K$RWPARM.MAXRCRBYTSIZ ;
     2653     8373    2               WABLKDAT.KV$VDO_BLKDAT.RCRBYTSIZ = GLOM.TEMP0+GLOM.TEMP0/256*256;
     2654     8374    2               WABLKDAT.KV$VDO_BLKDAT.RSN = K$RWPARM.RSN;
     2655     8375
     2656     8376    2             CASE (%KV_VDO_FNC_CLSSTR);
     2657     8377    2               ADDR(WACLSSTR.KV$VDO_CLSSTR.DLT)->BIT2BSD = ADDR(K$RWPARM.VDOFLGS.DLTSTR
              8377                        )->BIT2BSD;
     2658     8378
     2659     8379    2             CASE (%KV_VDO_FNC_DCLFLD);
     2660     8380    2               LHDR$ = K$RWPARM.V$ ;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:479  
     2661     8381    2               WADCLFLD.KV$VDO_DCLFLD.LIN = LHDR$->FPT$DCLFLD_V.LIN;
     2662     8382    2               WADCLFLD.KV$VDO_DCLFLD.CLM = LHDR$->FPT$DCLFLD_V.CLM;
     2663     8383    2               WADCLFLD.KV$VDO_DCLFLD.WDT = LHDR$->FPT$DCLFLD_V.WDT;
     2664     8384    2               TEMP1 = LHDR$->FPT$DCLFLD_V.ID;
     2665     8385    2               WADCLFLD.KV$VDO_DCLFLD.ID = TEMP1+TEMP1/256*256;
     2666     8386    2               IF VLP$FLDATR.ABSGRPRND ~= 0
     2667     8387    3                 THEN DO;
     2668     8388    3                   WADCLFLD.KV$VDO_DCLFLD.GRPRND = BINBIT(VLP$FLDATR.ABSGRPRND,SIZEB(
              8388                            KV$VDO_DCLFLD.GRPRND));
     2669     8389    3                   WADCLFLD.KV$VDO_DCLFLD.GRPRND.ABS = '1'B;
     2670     8390    3                   END;
     2671     8391    2                 ELSE
     2672     8392    2                   WADCLFLD.KV$VDO_DCLFLD.GRPRND = VLP$FLDATR.GRPRND;
     2673     8393    2               WADCLFLD.KV$VDO_DCLFLD.QLF = VLP$FLDATR.QLF;
     2674     8394
     2675     8395    2             CASE (%KV_VDO_FNC_DCLSTR);
     2676     8396    2               WADCLSTR.KV$VDO_DCLSTR.STRID = K$RWPARM.STRID;
     2677     8397    2               WADCLSTR.KV$VDO_DCLSTR.RE_STR = K$RWPARM.VDOFLGS.REDSTR;
     2678     8398
     2679     8399    2             CASE (%KV_VDO_FNC_DAT,%KV_VDO_FNC_DAT_IMD);
     2680     8400    2               WADAT.KV$VDO_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_VFC;
     2681     8401    2               WADAT.KV$VDO_DAT.DATCTRCHR = K$RWPARM.DVE.VFC;
     2682     8402    2               WADAT.KV$VDO_DAT.DCBHDR = K$RWPARM.DVE.DVBYTE.DCBHDR;
     2683     8403    2               IF K$RWPARM.DVE.DVBYTE.TRANS
     2684     8404    2                 THEN
     2685     8405    2                   WADAT.KV$VDO_DAT.DATMOD = %KV_DATMOD_TRN;
     2686     8406
     2687     8407    2             CASE (%KV_VDO_FNC_DLT);
     2688     8408    2               WADLT.KV$VDO_DLT.CTLFLG = FPT$TRMPRG_V.CTLFLG;
     2689     8409
     2690     8410    2             CASE (%KV_VDO_FNC_ERS);
     2691     8411    2               ADDR(WAERS.KV$VDO_ERS.PRT)->BIT2BSD =
     2692     8412    2                 ADDR(FPT$ERASE_V.PRT)->BIT2BSD;
     2693     8413
     2694     8414    2             CASE (%KV_VDO_FNC_OPNSTR);
     2695     8415    2               WAOPNSTR.KV$VDO_OPNSTR.ORG = K$RWPARM.ORG;
     2696     8416    2               WAOPNSTR.KV$VDO_OPNSTR.NRECS = K$RWPARM.NRECS;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:480  
     2697     8417    2               WAOPNSTR.KV$VDO_OPNSTR.KEYL = K$RWPARM.KEYSZ;
     2698     8418    2               WAOPNSTR.KV$VDO_OPNSTR.SPARE = K$RWPARM.SPARE;
     2699     8419
     2700     8420    2             CASE (%KV_VDO_FNC_PRM_SET);
     2701     8421    2               IF K$RWPARM.V$~=ADDR(NIL)
     2702     8422    2                 THEN
     2703     8423    2                   MSGSZ = MSGSZ+K$RWPARM.VSZ;
     2704     8424    2               IF K$RWPARM.PRMID=0 AND K$RWPARM.DVE.DVBYTE.VFC
     2705     8425    2                 AND ADDR(K$RWPARM.DVE.VFC)->NK$VFC.FCN = %VFCF_SPC
     2706     8426    2                 THEN
     2707     8427    2                   K$RWPARM.PRMID = TRAN_PRMID(ADDR(K$RWPARM.DVE.VFC)->NK$VFC.COUNT);
     2708     8428    2               IF K$RWPARM.PRMID ~= 0
     2709     8429    3                 THEN DO;
     2710     8430    3                   IF K$RWPARM.PRMID = %KV_PRMID_EDTBFR
     2711     8431    3                     THEN
     2712     8432    3                       MSGSZ = MSGSZ + LENGTHC(SIN);
     2713     8433    3                   IF K$RWPARM.PRMID = %KV_PRMID_REREADCLM
     2714     8434    3                     THEN
     2715     8435    3                       MSGSZ = MSGSZ + LENGTHV(SIN);
     2716     8436    3                   IF MSGSZ>255 THEN MSGSZ = MSGSZ+2;
     2717     8437    3                   MSGSZ = MSGSZ + 2;
     2718     8438    3                   END;
     2719     8439
     2720     8440    2             CASE (%KV_VDO_FNC_RQSDAT);
     2721     8441    2               WARQSDAT.KV$VDO_RQSDAT.WAT = K$RWPARM.VDOFLGS.WAIT;
     2722     8442    2               WARQSDAT.KV$VDO_RQSDAT.INCMAXNMBRCR = K$RWPARM.VDOFLGS.INCNMBRCR;
     2723     8443    2               WARQSDAT.KV$VDO_RQSDAT.RE_RED = K$RWPARM.DVE.DVBYTE.REREAD;
     2724     8444    2               WARQSDAT.KV$VDO_RQSDAT.EOFNO_DAT = K$RWPARM.DVE.DVBYTE.NODAT;
     2725     8445    2               WARQSDAT.KV$VDO_RQSDAT.BP = K$RWPARM.DVE.DVBYTE.BP;
     2726     8446    2               IF K$RWPARM.DVE.DVBYTE.TRANS
     2727     8447    2                 THEN
     2728     8448    2                   WARQSDAT.KV$VDO_RQSDAT.DATMOD = %KV_DATMOD_TRN;
     2729     8449    2               WARQSDAT.KV$VDO_RQSDAT.MAXNMBRCR = K$RWPARM.MAXNMBRCR;
     2730     8450    2               GLOM.TEMP0 = K$RWPARM.MAXNMBBYT ;
     2731     8451    2               WARQSDAT.KV$VDO_RQSDAT.MAXNMBBYT = GLOM.TEMP0+GLOM.TEMP0/256*256;
     2732     8452    2               GLOM.TEMP0 = K$RWPARM.MAXRCRBYTSIZ ;
     2733     8453    2               WARQSDAT.KV$VDO_RQSDAT.MAXRCRBYTSIZ = GLOM.TEMP0+GLOM.TEMP0/256*256;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:481  
     2734     8454
     2735     8455    2             CASE (%KV_VDO_FNC_RQSPRM);
     2736     8456    2               WARQSPRM.KV$VDO_RQSPRM.PRMID = K$RWPARM.PRMID;
     2737     8457    2               GLOM.TEMP0 = K$RWPARM.MAXRCRBYTSIZ ;
     2738     8458    2               WARQSPRM.KV$VDO_RQSPRM.MAXNMBBYT = GLOM.TEMP0+GLOM.TEMP0/256*256;
     2739     8459
     2740     8460    2             CASE (%KV_VDO_FNC_SLCGRPRND);
     2741     8461    2               IF VLP$FLDATR.ABSGRPRND ~= 0
     2742     8462    3                 THEN DO;
     2743     8463    3                   WASLCGRPRND.KV$VDO_SLCGRPRND.GRPRND = BINBIT(VLP$FLDATR.ABSGRPRND,
              8463                            SIZEB(KV$VDO_SLCGRPRND.GRPRND));
     2744     8464    3                   WASLCGRPRND.KV$VDO_SLCGRPRND.GRPRND.ABS = '1'B;
     2745     8465    3                   END;
     2746     8466    2                 ELSE
     2747     8467    2                   WASLCGRPRND.KV$VDO_SLCGRPRND.GRPRND = VLP$FLDATR.GRPRND;
     2748     8468
     2749     8469    2             CASE (%KV_VDO_FNC_SLCQLF);
     2750     8470    2               WASLCQLF.KV$VDO_SLCQLF.QLF = VLP$FLDATR.QLF;
     2751     8471
     2752     8472    2             END /* CASES */;
     2753     8473
     2754     8474    1           LHDR$ = HDR$;
     2755     8475    1           HDR$ = PINCRC(HDR$,VDOSZ);
     2756     8476    1           IF K$RWPARM.MSGID ~= 0
     2757     8477    2             THEN DO;
     2758     8478    2               GLOM.TEMP0 = K$RWPARM.MSGID ;
     2759     8479    2               GLOM.FLDID = ADDR(KI_VDOVLP_CG_MSGID)->BT36;
     2760     8480    2               GLOM.TEMP4 = K$RWPARM.MSGIDXT;
     2761     8481    2               GLOM.TEMP3.BY1 = GLOM.TEMP2.B1;
     2762     8482    2               GLOM.TEMP3.BY2 = GLOM.TEMP2.B2 ;
     2763     8483    2               GLOM.TEMP3.BY3 = GLOM.TEMP2.B3 ;
     2764     8484    2               GLOM.TEMP3.BY4 = GLOM.TEMP2.B4 ;
     2765     8485    2               ADDR(HDR$->KV$VDOVLP_CG_MSGID)->CHR12BSD = ADDR(GLOM)->CHR12BSD ;
     2766     8486
     2767     8487    2               LHDR$ = HDR$;
     2768     8488    2               HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_CG_MSGID));
     2769     8489    2               END;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:482  
     2770     8490        /* CG message type */
     2771     8491    1           IF K$RWPARM.MSGTYP ~= ' '
     2772     8492    2             THEN DO;
     2773     8493    2               ADDR(HDR$->KV$VDOVLP_CG_MSGTYP)->CHR4BSD = ADDR(KI_VDOVLP_CG_MSGTYP)->
              8493                        CHR4BSD;
     2774     8494    2               HDR$->KV$VDOVLP_CG_MSGTYP.CG_MSGTYP = K$RWPARM.MSGTYP;
     2775     8495    2               LHDR$ = HDR$;
     2776     8496    2               HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_CG_MSGTYP));
     2777     8497    2               IF K$RWPARM.STATION ~= ' '
     2778     8498    3                 THEN DO;
     2779     8499    3                   ADDR(HDR$->KV$VDOVLP_CG_STA)->CHR4BSD = ADDR(KI_VDOVLP_CG_STA)->
              8499                            CHR4BSD;
     2780     8500    3                   HDR$->KV$VDOVLP_CG_STA.CG_STA = K$RWPARM.STATION;
     2781     8501    3                   LHDR$ = HDR$;
     2782     8502    3                   HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_CG_STA));
     2783     8503    3                   END;
     2784     8504    2               END;
     2785     8505    1           IF K$RWPARM.MSG_ERRCODE
     2786     8506    2             THEN DO;
     2787     8507    2               CALL EMR$HOST2FEP (GLOM.ERR,K$RWPARM.MSG_ERRCODE);
     2788     8508    2               HDR$->KV$VDOVLP_ERR = KI_VDOVLP_ERR;
     2789     8509    2               HDR$->KV$VDOVLP_ERR.ERRCODE = GLOM.ERR;
     2790     8510    2               LHDR$ = HDR$;
     2791     8511    2               HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_ERR));
     2792     8512    2               END;
     2793     8513    1           IF K$RWPARM.KEY$ ~= ADDR(NIL) AND K$RWPARM.KEYSZ ~= 0
     2794     8514    1             THEN
     2795     8515    1               IF K$RWPARM.KEYTYPE ~= %KEYTYPE_FLDID#
     2796     8516    2                 THEN DO;
     2797     8517    2                   IF K$RWPARM.KEYSZ>32 THEN EXIT;
     2798     8518    2                   HDR$->KV$VDOVLP_KEY = KI_VDOVLP_KEY;
     2799     8519    2                   HDR$->KV$VDOVLP_KEY.BYTSIZ = K$RWPARM.KEYSZ;
     2800     8520    2                   LHDR$ = HDR$;
     2801     8521    2                   HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_KEY));
     2802     8522    2                   GLOM.TEMP0 = K$RWPARM.KEYSZ ;
     2803     8523    2                   HDR$->KEY = K$RWPARM.KEY$->KEY;
     2804     8524    2                   IF GLOM.TEMP0 < 5 AND
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:483  
     2805     8525    2                     (K$RWPARM.KEYTYPE=%KEYTYPE_BIN10#
     2806     8526    2                     OR K$RWPARM.KEYTYPE=%KEYTYPE_BINHLF#
     2807     8527    2                     OR K$RWPARM.KEYTYPE=%KEYTYPE_BIN521#)
     2808     8528    3                     THEN DO;
     2809     8529    3                       GLOM.OP6$ = PINCRB(HDR$,GLOM.TEMP0);
     2810     8530        /*     HDR$->KEY = ' ' ;    Hi order bits of each byte to '0'B */
     2811     8531    3                       DEST.BY1 = SOURCE.BY1 ;
     2812     8532    3                       IF GLOM.TEMP0 =1 THEN EXIT;
     2813     8533    3                       DEST.BY2 = SOURCE.BY2 ;
     2814     8534    3                       IF GLOM.TEMP0 =2 THEN EXIT;
     2815     8535    3                       DEST.BY3 = SOURCE.BY3 ;
     2816     8536    3                       IF GLOM.TEMP0 =3 THEN EXIT;
     2817     8537    3                       DEST.BY4 = SOURCE.BY4 ;
     2818     8538    3                       END;
     2819     8539    3                     ELSE DO;
     2820     8540    3                       K$RWPARM.CVTDAT = '0'B;
     2821     8541    3                       IF K$RWPARM.KEYTYPE=%KEYTYPE_ENTSRD#
     2822     8542    3                         THEN
     2823     8543    3                           LHDR$->KV$VDOVLP_KEY.TYP = %KV_VDOVLP_TYP_ENTSRD;
     2824     8544    3                       END;
     2825     8545    2   L1:
     2826     8546    2                   HDR$ = PINCRC(HDR$,((K$RWPARM.KEYSZ+1)/2)*2);
     2827     8547    2                   END;
     2828     8548    1                 ELSE
     2829     8549    1                   IF K$RWPARM.KEYSZ >= 2
     2830     8550    2                     THEN DO;
     2831     8551    2                       HDR$->KV$VDOVLP_FLDID = KI_VDOVLP_FLDID;
     2832     8552    2                       HDR$->KV$VDOVLP_FLDID.BYTSIZ = 2;
     2833     8553    2                       LHDR$ = HDR$;
     2834     8554    2                       GLOM.FLDID.IDC = K$RWPARM.KEY$->B$FLDID;
     2835     8555    2                       HDR$->KV$VDOVLP_FLDID.FLDID = GLOM.FLDID.ID+GLOM.FLDID.ID/256*
              8555                                256;
     2836     8556    2                       HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_FLDID));
     2837     8557    2                       END;
     2838     8558    1           IF K$RWPARM.MRKTYP ~= 0
     2839     8559    2             THEN DO;
     2840     8560    2               HDR$->VDOVLP_MRK = KI_VDOVLP_MRK;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:484  
     2841     8561    2               IF FUNCTION = %KV_VDO_FNC_MRK
     2842     8562    2                 THEN
     2843     8563    2                   HDR$->VDOVLP_MRK.RSP = '1'B;
     2844     8564    2               HDR$->VDOVLP_MRK.MRKTYP = K$RWPARM.MRKTYP;
     2845     8565    2               IF K$RWPARM.MRKTYP = %KV_VDOMRKTYP_SNDLSTRCRID
     2846     8566    3                 THEN DO;
     2847     8567    3                   GLOM.TEMP0 = K$RWPARM.BLKREC.BLKU# ;
     2848     8568    3                   HDR$->VDOVLP_MRK.BMRK.BLK# = GLOM.TEMP0+GLOM.TEMP0/256*256;
     2849     8569    3                   GLOM.TEMP0 = K$RWPARM.BLKREC.RECU# ;
     2850     8570    3                   HDR$->VDOVLP_MRK.BMRK.REC# = GLOM.TEMP0+GLOM.TEMP0/256*256;
     2851     8571    3                   HDR$->VDOVLP_MRK.BYTSIZ = SIZEC(K$RWPARM.BLKREC);
     2852     8572    3                   END;
     2853     8573    3                 ELSE DO;
     2854     8574    3                   HDR$->VDOVLP_MRK.ID = K$RWPARM.MARKER;
     2855     8575    3                   HDR$->VDOVLP_MRK.BYTSIZ = SIZEC(HDR$->VDOVLP_MRK.ID);
     2856     8576    3                   END;
     2857     8577    2               LHDR$ = HDR$;
     2858     8578    2               HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_MRK));
     2859     8579    2               END;
     2860     8580        %EJECT;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:485  
     2861     8581    1           IF (FUNCTION = %KV_VDO_FNC_DAT OR FUNCTION = %KV_VDO_FNC_DAT_IMD
     2862     8582    1             OR FUNCTION = %KV_VDO_FNC_STT)
     2863     8583    1             AND NOT K$RWPARM.DVE.DVBYTE.BP AND NOT K$RWPARM.DVE.DVBYTE.TRANS
     2864     8584    1             AND NOT K$RWPARM.DVE.DVBYTE.BIN
     2865     8585    1             AND K$RWPARM.MSG$ ~= ADDR(NIL)
     2866     8586    2             THEN DO;
     2867     8587    2               IF MSGSZ = 0 THEN GOTO BPEND2;
     2868     8588    2               CALL HFF$TRAPALT ALTRET( BAD_BUFFER);
     2869     8589    2               IF MSGSZ > 7
     2870     8590    3                 THEN DO;
     2871     8591        /*
     2872     8592                         This strange code is due to a problem with the
     2873     8593                         implementation of the TCTR instruction which faults
     2874     8594                         when accessing the first doubleword of a segment
     2875     8595                         which is not doubleword aligned. The TCTR instruction
     2876     8596                         is used for all of the data back to the first seven
     2877     8597                         bytes.  If a non-blank has not been found, the first
     2878     8598                         seven bytes are examined one byte at a time.
     2879     8599        */
     2880     8600    3                   GLOM.TEMP5 = MSGSZ - 7;
     2881     8601    3                   CALL SEARCHR (MSGSZ , GLOM.TEMP5 , NK_BLNKSUPTBL ,
     2882     8602    3                     PINCRC(K$RWPARM.MSG$,7)->CHRMSG) ALTRET(BPALLBLANK);
     2883     8603    3                   MSGSZ = MSGSZ + 8;
     2884     8604    3                   GOTO BPEND;
     2885     8605    3   BPALLBLANK:     MSGSZ = 7;
     2886     8606    3                   END;
     2887     8607    2   BPLOOPER:   IF PINCRC (K$RWPARM.MSG$ , MSGSZ-1) -> B$CHAR = ' '
     2888     8608    3                 THEN DO;
     2889     8609    3                   MSGSZ = MSGSZ - 1;
     2890     8610    3                   IF MSGSZ ~= 0 THEN GOTO BPLOOPER;
     2891     8611    3                   END;
     2892     8612    2   BPEND:
     2893     8613    2               CALL HFF$TRAPALT;           /* Don't trap bad buffer anymore      */
     2894     8614    2   BPEND2:
     2895     8615    2               K$RWPARM.MSGSZ = MSGSZ;
     2896     8616    2               END;
     2897     8617        %EJECT;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:486  
     2898     8618
     2899     8619    1           IF MSGSZ > 0
     2900     8620    2             THEN DO;
     2901     8621    2               LHDR$ = HDR$;
     2902     8622    2               IF MSGSZ > 255
     2903     8623    3                 THEN DO;
     2904     8624    3                   HDR$->KV$VDOVLP_DAT2 = KI_VDOVLP_DAT2;
     2905     8625    3                   HDR$->KV$VDOVLP_DAT2.BYTSIZ = MSGSZ+MSGSZ/256*256;
     2906     8626    3                   HDR$ = PINCRC (HDR$,SIZEC(KI_VDOVLP_DAT2));
     2907     8627    3                   END;
     2908     8628    3                 ELSE DO;
     2909     8629    3                   HDR$->KV$VDOVLP_DAT1 = KI_VDOVLP_DAT1;
     2910     8630    3                   HDR$->KV$VDOVLP_DAT1.BYTSIZ = MSGSZ;
     2911     8631    3                   HDR$ = PINCRC (HDR$,SIZEC(KI_VDOVLP_DAT1));
     2912     8632    3                   IF K$RWPARM.CVTDAT AND MSGSZ=K$RWPARM.KEYSZ
     2913     8633    4                     THEN DO;
     2914     8634    4                       SUBSTR(ADDR(K$RWPARM.VLP$)->B$CHAR,0,MSGSZ)
     2915     8635    4                         = SUBSTR(K$RWPARM.MSG$->B$CHAR,0,MSGSZ);
     2916     8636    4                       K$RWPARM.MSG$ = ADDR(K$RWPARM.VLP$);
     2917     8637    4                       K$RWPARM.CVTDAT = '0'B;
     2918     8638    4                       CALL KIA$9TO8 (K$RWPARM.VLP$, K$RWPARM.VLP$, MSGSZ);
     2919     8639    4                       END;
     2920     8640    3                   END;
     2921     8641    2               END;
     2922     8642    1           IF LHDR$ ~= ADDR(HDR)           /* vlps                               */
     2923     8643    2             THEN DO;
     2924     8644    2               ADDR(HDR)->KV$VDO.VLP = '1'B;
     2925     8645    2               LHDR$->KV$VDOVLP.LST = '1'B;
     2926     8646    2               END;
     2927     8647
     2928     8648        /* If this is a PRM_SET then create the TL structure if needed */
     2929     8649    1           IF FUNCTION = %KV_VDO_FNC_PRM_SET
     2930     8650    2             THEN DO;
     2931     8651    2               IF K$RWPARM.PRMID ~= 0
     2932     8652    3                 THEN DO;
     2933     8653    3                   TL.PRMID = K$RWPARM.PRMID;
     2934     8654    3                   IF K$RWPARM.PRMID = %KV_PRMID_EDTBFR OR K$RWPARM.PRMID = %
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:487  
              8654                            KV_PRMID_REREADCLM
     2935     8655    4                     THEN DO;
     2936     8656    4                       VDOSZ = 0;          /* Flag to remember by                */
     2937     8657    4                       TL.PRMID = %KV_PRMID_SINPUT;
     2938     8658    4                       END;
     2939     8659    3                   MSGSZ = MSGSZ-2;
     2940     8660    3                   IF MSGSZ < 256
     2941     8661    4                     THEN DO;
     2942     8662    4                       TL.LENGTH = MSGSZ;
     2943     8663    4                       HDR$ = PINCRC(HDR$,LENGTHC(TL));
     2944     8664    4                       END;
     2945     8665    4                     ELSE DO;
     2946     8666    4                       MSGSZ = MSGSZ-2;
     2947     8667    4                       TL.LENGTH = TL.PRMID;
     2948     8668    4                       TL.PRMID = %KV_PRMID_BIGTL;
     2949     8669    4                       PINCRC(HDR$,LENGTHC(TL))->TL.PRMID = MSGSZ/256;
     2950     8670    4                       PINCRC(HDR$,LENGTHC(TL))->TL.LENGTH = MOD(MSGSZ,256);
     2951     8671    4                       HDR$ = PINCRC(HDR$,LENGTHC(TL)*2);
     2952     8672    4                       END;
     2953     8673    3                   IF VDOSZ = 0
     2954     8674    4                     THEN DO;
     2955     8675    4                       SIN.STR = K$RWPARM.STR;
     2956     8676    4                       SIN.FIL = '0'B;
     2957     8677    4                       HDR$ = PINCRC(HDR$,LENGTHV(SIN));
     2958     8678    4                       IF K$RWPARM.PRMID = %KV_PRMID_EDTBFR
     2959     8679    4                         THEN
     2960     8680    4                           HDR$ = PINCRC(HDR$,1);
     2961     8681    4                       END;
     2962     8682    3                   END;
     2963     8683    2               IF K$RWPARM.V$~=ADDR(NIL)
     2964     8684    3                 THEN DO;
     2965     8685    3                   SUBSTR(HDR$->B$CHAR,0,K$RWPARM.VSZ) =
     2966     8686    3                     SUBSTR(K$RWPARM.V$->B$CHAR,0,K$RWPARM.VSZ);
     2967     8687    3                   HDR$ = PINCRC(HDR$,K$RWPARM.VSZ);
     2968     8688    3                   END;
     2969     8689
     2970     8690    2               END;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:488  
     2971     8691
     2972     8692    1           K$RWPARM.UHDR$ = ADDR(HDR);
     2973     8693    1           K$RWPARM.UHDRSZ = POFFC(HDR$,ADDR(HDR));
     2974     8694    1           RETURN;
     2975     8695    1   BAD_BUFFER:
     2976     8696    1           CALL HFF$TRAPALT;               /* Don't trap bad buffer anymore      */
     2977     8697    1           K$RWPARM.ERR = %K$BAD_BUFFER;
     2978     8698    1           ALTRETURN;
     2979     8699
     2980     8700    1   END KIA$VDO;
     2981     8701        %EOD;

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:489  
--  Include file information  --

   K_CP6_M.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$VDO.

   Procedure KIA$VDO requires 831 words for executable code.
   Procedure KIA$VDO requires 42 words of local(AUTO) storage.

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:490  

 Object Unit name= KIA$VDO                                    File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:37:53.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      4      4  KIA$VDO
    1   Proc  even  none   831   1477  KIA$VDO
    2  RoData even  none     9     11  KIA$VDO

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  KIA$VDO

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 HFF$TRAPALT
         yes           Std       3 KIA$9TO8
         yes           Std       2 EMR$HOST2FEP
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:491  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_BADVDOFNC                          KI_FEI$$                              NK_BLNKSUPTBL
     KI_VDOVLP_CG_MSGID                    KI_VDOVLP_CG_MSGTYP                   KI_VDOVLP_CG_STA
     KI_VDOVLP_DAT1                        KI_VDOVLP_DAT2                        KI_VDOVLP_ERR
     KI_VDOVLP_FLDID                       KI_VDOVLP_KEY                         KI_VDOVLP_MRK
     KI_VDOBYTSIZ                          B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:492  


     2451        1        /*T***********************************************************/
     2452        2        /*T*                                                         */
     2453        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2454        4        /*T*                                                         */
     2455        5        /*T***********************************************************/
     2456        6        KIA$VDO: PROC(FUNCTION,K$RWPARM,HDR) ALTRET;

      6  1 000000   000000 700200 xent  KIA$VDO      TSX0  ! X66_AUTO_3
         1 000001   000052 000003                    ZERO    42,3

     2457        7
     2458        8        %INCLUDE CP_6_SUBS;
     2459      548        %INCLUDE KI$CP6V_C;
     2460      987        %INCLUDE KV$VDO;
     2461     2002        %INCLUDE K_DATA_R;
     2462     2713        %INCLUDE K_SUBS_C;
     2463     2746        %INCLUDE KI_DATA_R;
     2464     2772        %INCLUDE NK$LDCT;
     2465     2874        %INCLUDE NK_VFC_C;
     2466     2948        %INCLUDE KV_PRMID_E;
     2467     3122        %KV_PRMID_E;
     2468     3278        %INCLUDE UM_CP6;
     2469     4130        %INCLUDE K_CP6_M;
     2470     4326
     2471     4327        /* Parameters */
     2472     4328    1   DCL FUNCTION UBIN;
     2473     4329        %NK$LDCT (STCLASS="");
     2474     4375        %K$RWPARM (NAME=K$RWPARM);
     2475     4691    1   DCL HDR CHAR(100);
     2476     4692
     2477     4693        /* Based structures */
     2478     4694    1   DCL B$UHDR CHAR(K$RWPARM.UHDRSZ) BASED;
     2479     4695    1   DCL 1 TL BASED(HDR$) CALIGNED,
     2480     4696    1         2 PRMID UBIN BYTE UNAL,
     2481     4697    1         2 LENGTH UBIN BYTE UNAL;
     2482     4698    1   DCL 1 SIN BASED(HDR$) CALIGNED,
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:493  
     2483     4699    1         2 STR UBIN BYTE CALIGNED,
     2484     4700    1         2 FIL,
     2485     4701    1           3 CLM BIT(18),
     2486     4702    1           3 * BIT(9);
     2487     4703        %NK$VFC;
     2488     4721        %KV_VDO_ALL;
     2489     6863        %KV$VDOVLP_MRK (NAME=VDOVLP_MRK,STCLASS=BASED,LAST=",");
     2490     6916    1         2 BMRK REDEF ID,
     2491     6917    1           3 BLK# UBIN (18) UNAL,
     2492     6918    1           3 REC# UBIN (18) UNAL;
     2493     6919    1   DCL 1 VDO BASED,
     2494     6920    1         2 * CHAR(VDOSZ);
     2495     6921    1   DCL B$FLDID CHAR(2) UNAL BASED;
     2496     6922    1   DCL KEY CHAR(K$RWPARM.KEYSZ) BASED;
     2497     6923        %FPT$DCLFLD_V(BASED="BASED(K$RWPARM.V$)");
     2498     6943        %FPT$ERASE_V(BASED="BASED(K$RWPARM.V$)");
     2499     6959        %FPT$MDFFLD_V(BASED="BASED(K$RWPARM.V$)");
     2500     6975        %FPT$TRMPRG_V(BASED="BASED(K$RWPARM.V$)");
     2501     6987        %VLP$FLDATR_V(FPTN=VLP$FLDATR,BASED="BASED(K$RWPARM.VLP$)");
     2502     7004        /* Auto */
     2503     7005    1   DCL HDR$ PTR;
     2504     7006    1   DCL 1 HDRA REDEF HDR$,
     2505     7007    1         2 * BIT(18) UNAL,
     2506     7008    1         2 NHWA BIT(1) UNAL ,
     2507     7009    1         2 * BIT(17) UNAL;
     2508     7010
     2509     7011    1   DCL LHDR$ PTR;
     2510     7012    1   DCL TEMP1 REDEF LHDR$ UBIN WORD ;
     2511     7013    1   DCL TEMP1S REDEF LHDR$ SBIN WORD ;
     2512     7014    1   DCL VDOSZ UBIN;
     2513     7015    1   DCL 1 GLOM ,
     2514     7016    1         2 FLDID,
     2515     7017    1           3 FILLER UBIN HALF HALIGNED,
     2516     7018    1           3 ID UBIN HALF HALIGNED,
     2517     7019    1           3 IDC REDEF ID CHAR(2),
     2518     7020    1         2 OP6$ REDEF FLDID PTR ,
     2519     7021    1         2 ERR BIT(36) ALIGNED,
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:494  
     2520     7022    1         2 TEMP0 REDEF ERR UBIN WORD ,
     2521     7023    1         2 TEMP0S REDEF ERR SBIN WORD ,
     2522     7024    1         2 TEMP2 REDEF ERR,
     2523     7025    1           3 * BIT(4) UNAL,
     2524     7026    1           3 B1 UBIN(8) UNAL,
     2525     7027    1           3 B2 UBIN(8) UNAL ,
     2526     7028    1           3 B3 UBIN(8) UNAL ,
     2527     7029    1           3 B4 UBIN(8) UNAL ,
     2528     7030    1         2 TEMP3 REDEF ERR,
     2529     7031    1           3 BY1 UBIN(9) UNAL ,
     2530     7032    1           3 BY2 UBIN(9) UNAL ,
     2531     7033    1           3 BY3 UBIN(9) UNAL ,
     2532     7034    1           3 BY4 UBIN(9) UNAL ,
     2533     7035    1         2 OP$ PTR,
     2534     7036    1         2 TEMP5 REDEF OP$ UBIN,
     2535     7037    1         2 TEMP5S REDEF OP$ SBIN,
     2536     7038    1         2 TEMP4 REDEF OP$ BIT(36) ;
     2537     7039    1   DCL MSGSZ UBIN;
     2538     7040    1   DCL B$CHAR CHAR(1) BASED(GLOM.OP$) UNAL;
     2539     7041    1   DCL 1 SPREAD BASED UNAL ,
     2540     7042    1         2 HI UBIN(10) UNAL ,
     2541     7043    1         2 LO8 UBIN(8) UNAL ;
     2542     7044
     2543     7045        /* Refs */
     2544     7046    1   DCL NK_BLNKSUPTBL CHAR(512) DALIGNED SYMREF; /* Can NOT be B$SR_xxx
     2545     7047                                              because this runs at interrupt
     2546     7048                                              and there might not be a user mapped */
     2547     7049        %KV$VDOVLP_CG_MSGID (NAME=KI_VDOVLP_CG_MSGID,STCLASS=SYMREF);
     2548     7101        %KV$VDOVLP_CG_MSGTYP (NAME=KI_VDOVLP_CG_MSGTYP,STCLASS=SYMREF);
     2549     7153        %KV$VDOVLP_CG_STA (NAME=KI_VDOVLP_CG_STA,STCLASS=SYMREF);
     2550     7204        %KV$VDOVLP_DAT1 (NAME=KI_VDOVLP_DAT1,STCLASS=SYMREF);
     2551     7254        %KV$VDOVLP_DAT2 (NAME=KI_VDOVLP_DAT2,STCLASS=SYMREF);
     2552     7304        %KV$VDOVLP_ERR (NAME=KI_VDOVLP_ERR,STCLASS=SYMREF);
     2553     7400        %KV$VDOVLP_FLDID (NAME=KI_VDOVLP_FLDID,STCLASS=SYMREF);
     2554     7451        %KV$VDOVLP_KEY (NAME=KI_VDOVLP_KEY,STCLASS=SYMREF);
     2555     7501        %KV$VDOVLP_MRK (NAME=KI_VDOVLP_MRK,STCLASS=SYMREF);
     2556     7554        %KV_VDOBYTSIZ (NAME=KI_VDOBYTSIZ,STCLASS=SYMREF);
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:495  
     2557     7574    1   DCL 1 WAVDO BASED(HDR$) ALIGNED ,
     2558     7575                 %KV$VDO (LVL=2) ;
     2559     7602    1   DCL 1 WACLSSTR BASED(HDR$) ALIGNED ,
     2560     7603                  %KV$VDO_CLSSTR (LVL=2) ;
     2561     7646    1   DCL 1 WABLKDAT BASED(HDR$) ALIGNED ,
     2562     7647                  %KV$VDO_BLKDAT (LVL=2) ;
     2563     7690    1   DCL BIT2BSD BIT(2) BASED UNAL ;
     2564     7691    1   DCL UBN3BSD UBIN(3) BASED UNAL;
     2565     7692    1   DCL CHR12BSD CHAR(12) CALIGNED BASED;
     2566     7693    1   DCL BT36 BIT(36) BASED UNAL    ;
     2567     7694    1   DCL CHR4BSD CHAR(4) BASED CALIGNED;
     2568     7695    1   DCL 1 SOURCE BASED(GLOM.OP6$) UNAL ,
     2569     7696    1         2 BY1 UBIN(8) UNAL,
     2570     7697    1         2 BY2 UBIN(8) UNAL,
     2571     7698    1         2 BY3 UBIN(8) UNAL,
     2572     7699    1         2 BY4 UBIN(8) UNAL;
     2573     7700    1   DCL 1 DEST BASED(HDR$) CALIGNED ,
     2574     7701    1         2 * BIT(1) UNAL , 2 BY1 UBIN(8) UNAL ,
     2575     7702    1         2 * BIT(1) UNAL , 2 BY2 UBIN(8) UNAL ,
     2576     7703    1         2 * BIT(1) UNAL , 2 BY3 UBIN(8) UNAL ,
     2577     7704    1         2 * BIT(1) UNAL , 2 BY4 UBIN(8) UNAL ;
     2578     7705
     2579     7706    1   DCL CHRMSG CHAR(GLOM.TEMP5) BASED ;
     2580     7707    1   DCL 1 WADAT BASED(HDR$) ALIGNED,
     2581     7708                  %KV$VDO_DAT (LVL=2) ;
     2582     7753    1   DCL 1 WADCLFLD BASED(HDR$) ALIGNED ,
     2583     7754                  %KV$VDO_DCLFLD (LVL=2) ;
     2584     7880    1   DCL 1 WADCLSTR BASED(HDR$) ALIGNED ,
     2585     7881                  %KV$VDO_DCLSTR (LVL=2) ;
     2586     7924    1   DCL 1 WADLT BASED(HDR$) ALIGNED ,
     2587     7925                  %KV$VDO_DLT (LVL=2) ;
     2588     7970    1   DCL 1 WAERS BASED(HDR$) ALIGNED ,
     2589     7971                  %KV$VDO_ERS (LVL=2) ;
     2590     8014    1   DCL 1 WAOPNSTR BASED(HDR$) ALIGNED ,
     2591     8015                  %KV$VDO_OPNSTR (LVL=2) ;
     2592     8058    1   DCL 1 WARQSDAT BASED(HDR$) ALIGNED ,
     2593     8059                  %KV$VDO_RQSDAT (LVL=2) ;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:496  
     2594     8107    1   DCL 1 WARQSPRM BASED(HDR$) ALIGNED ,
     2595     8108                  %KV$VDO_RQSPRM (LVL=2) ;
     2596     8151    1   DCL 1 WASLCGRPRND BASED(HDR$) ALIGNED ,
     2597     8152                  %KV$VDO_SLCGRPRND (LVL=2) ;
     2598     8234    1   DCL 1 WASLCQLF BASED(HDR$) ALIGNED ,
     2599     8235                  %KV$VDO_SLCQLF (LVL=2) ;
     2600     8320    1   DCL KIA$9TO8 ENTRY(3);
     2601     8321    1   DCL EMR$HOST2FEP ENTRY(2);
     2602     8322    1   DCL HFF$TRAPALT ENTRY ALTRET;
     2603     8323    1   DCL SC_BADVDOFNC ENTRY CONV(2,0);
     2604     8324
     2605     8325
     2606     8326        /* Constant */
     2607     8327        /* This table translates VFC to the proper PRMID for VDH */
     2608     8328    1   DCL 1 TRAN_PRMID(0:15) UBIN BYTE CONSTANT UNAL INIT(0,
     2609     8329    1                         %KV_PRMID_OTPTAB, /* VFCS_OTAB                          */
     2610     8330    1                                      0,   /* VFCS_SEQN                          */
     2611     8331    1                         %KV_PRMID_INPTAB, /* VFCS_ITAB                          */
     2612     8332    1                                      0,   /* VFCS_SPRM                          */
     2613     8333    1                                      0,   /* VFCS_SPRO                          */
     2614     8334    1                      %KV_PRMID_EDTBFR,    /* %VFC_SLLN                          */
     2615     8335    1                      %KV_PRMID_REREADCLM, /* VFCS_SLLP                          */
     2616     8336    1                         %KV_PRMID_DCBHDR, /* VFCS_SHDR                          */
     2617     8337    1                                      0,   /* VFCS_SLPP                          */
     2618     8338    1                                      0,   /* VFCS_SPND                          */
     2619     8339    1                            0,             /* VFCS_SVFU                          */
     2620     8340    1                                      0,   /* VFCS_SLCHN                         */
     2621     8341    1                                      0,   /* VFCS_CLRWND                        */
     2622     8342    1                                      0,   /* VFCS_TRS0                          */
     2623     8343    1                                      0);  /* VFCS_TRS1                          */
     2624     8344        %EJECT;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:497  
     2625     8345
     2626     8346
     2627     8347
     2628     8348    1           HDR$ = ADDR(HDR);

   8348  1 000002   200005 236100                    LDQ     @HDR,,AUTO
         1 000003   200036 756100                    STQ     HDR$,,AUTO

     2629     8349    1           IF FUNCTION > %KV_VDO_FNC_HI

   8349  1 000004   200003 470500                    LDP0    @FUNCTION,,AUTO
         1 000005   000000 235100                    LDA     0,,PR0
         1 000006   000043 115007                    CMPA    35,DL
         1 000007   000013 602000 1                  TNC     s:8354

     2630     8350    2             THEN DO;

     2631     8351    2               CALL SC_BADVDOFNC;

   8351  1 000010   000000 713400 xsym               CLIMB   SC_BADVDOFNC
         1 000011   000000 600000 xsid               climb   nvectors=         0

     2632     8352    2               RETURN;

   8352  1 000012   000000 702200 xent               TSX2  ! X66_ARET

     2633     8353    2               END;
     2634     8354    1           VDOSZ = KI_VDOBYTSIZ(FUNCTION);

   8354  1 000013   000100 101405                    MRL     fill='000'O
         1 000014   000000 000001 xsym               ADSC9   KI_VDOBYTSIZ,A           cn=0,n=1
         1 000015   200040 000004                    ADSC9   VDOSZ,,AUTO              cn=0,n=4

     2635     8355    1           HDR$->VDO = '0'B;

   8355  1 000016   200036 471500                    LDP1    HDR$,,AUTO
         1 000017   200040 720100                    LXL0    VDOSZ,,AUTO
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:498  
         1 000020   000140 100400                    MLR     fill='000'O
         1 000021   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000022   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

     2636     8356    1           WAVDO.KV$VDO.FNC = FUNCTION;

   8356  1 000023   000000 236100                    LDQ     0,,PR0
         1 000024   000033 736000                    QLS     27
         1 000025   100000 552140                    STBQ    0,'40'O,PR1

     2637     8357
     2638     8358    1           WAVDO.KV$VDO.STR = K$RWPARM.STR;

   8358  1 000026   200004 473500                    LDP3    @K$RWPARM,,AUTO
         1 000027   300040 236100                    LDQ     32,,PR3
         1 000030   000022 736000                    QLS     18
         1 000031   100000 676100                    ERQ     0,,PR1
         1 000032   000177 376003                    ANQ     127,DU
         1 000033   100000 656100                    ERSQ    0,,PR1

     2639     8359    1           IF K$RWPARM.MSG$ = ADDR(NIL)

   8359  1 000034   300000 236100                    LDQ     0,,PR3
         1 000035   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000036   000041 601000 1                  TNZ     s:8363

     2640     8360    1             THEN
     2641     8361    1               MSGSZ = 0;

   8361  1 000037   200044 450100                    STZ     MSGSZ,,AUTO
         1 000040   000053 710000 1                  TRA     s:8369

     2642     8362    2             ELSE DO;

     2643     8363    2               IF K$RWPARM.DVE.DVBYTE.BIN

   8363  1 000041   300010 236100                    LDQ     8,,PR3
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:499  
         1 000042   040000 316003                    CANQ    16384,DU
         1 000043   000051 600000 1                  TZE     s:8366

     2644     8364    2                 THEN
     2645     8365    2                   K$RWPARM.MSGSZ = (K$RWPARM.MSGSZ * 9 + 7) / 8;

   8365  1 000044   300001 236100                    LDQ     1,,PR3
         1 000045   000011 402007                    MPY     9,DL
         1 000046   000007 036007                    ADLQ    7,DL
         1 000047   000010 506007                    DIV     8,DL
         1 000050   300001 756100                    STQ     1,,PR3

     2646     8366    2               MSGSZ = K$RWPARM.MSGSZ;

   8366  1 000051   300001 235100                    LDA     1,,PR3
         1 000052   200044 755100                    STA     MSGSZ,,AUTO

     2647     8367    2               END;

     2648     8368
     2649     8369    2           DO CASE (FUNCTION);

   8369  1 000053   000000 235100                    LDA     0,,PR0
         1 000054   000043 115007                    CMPA    35,DL
         1 000055   000057 602005 1                  TNC     s:8369+4,AL
         1 000056   000506 710000 1                  TRA     s:8474
         1 000057   000506 710000 1                  TRA     s:8474
         1 000060   000506 710000 1                  TRA     s:8474
         1 000061   000122 710000 1                  TRA     s:8372
         1 000062   000506 710000 1                  TRA     s:8474
         1 000063   000506 710000 1                  TRA     s:8474
         1 000064   000230 710000 1                  TRA     s:8400
         1 000065   000230 710000 1                  TRA     s:8400
         1 000066   000144 710000 1                  TRA     s:8380
         1 000067   000217 710000 1                  TRA     s:8396
         1 000070   000254 710000 1                  TRA     s:8408
         1 000071   000506 710000 1                  TRA     s:8474
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:500  
         1 000072   000506 710000 1                  TRA     s:8474
         1 000073   000261 710000 1                  TRA     s:8411
         1 000074   000506 710000 1                  TRA     s:8474
         1 000075   000506 710000 1                  TRA     s:8474
         1 000076   000506 710000 1                  TRA     s:8474
         1 000077   000506 710000 1                  TRA     s:8474
         1 000100   000506 710000 1                  TRA     s:8474
         1 000101   000506 710000 1                  TRA     s:8474
         1 000102   000304 710000 1                  TRA     s:8421
         1 000103   000506 710000 1                  TRA     s:8474
         1 000104   000506 710000 1                  TRA     s:8474
         1 000105   000356 710000 1                  TRA     s:8441
         1 000106   000440 710000 1                  TRA     s:8456
         1 000107   000506 710000 1                  TRA     s:8474
         1 000110   000506 710000 1                  TRA     s:8474
         1 000111   000454 710000 1                  TRA     s:8461
         1 000112   000500 710000 1                  TRA     s:8470
         1 000113   000506 710000 1                  TRA     s:8474
         1 000114   000506 710000 1                  TRA     s:8474
         1 000115   000506 710000 1                  TRA     s:8474
         1 000116   000506 710000 1                  TRA     s:8474
         1 000117   000506 710000 1                  TRA     s:8474
         1 000120   000270 710000 1                  TRA     s:8415
         1 000121   000136 710000 1                  TRA     s:8377

     2650     8370
     2651     8371    2             CASE (%KV_VDO_FNC_BLKDAT);

     2652     8372    2               GLOM.TEMP0 = K$RWPARM.MAXRCRBYTSIZ ;

   8372  1 000122   300042 236100                    LDQ     34,,PR3
         1 000123   000022 772000                    QRL     18
         1 000124   200042 756100                    STQ     GLOM+1,,AUTO

     2653     8373    2               WABLKDAT.KV$VDO_BLKDAT.RCRBYTSIZ = GLOM.TEMP0+GLOM.TEMP0/256*256;

   8373  1 000125   000010 772000                    QRL     8
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:501  
         1 000126   000010 736000                    QLS     8
         1 000127   200042 036100                    ADLQ    GLOM+1,,AUTO
         1 000130   000000 621006                    EAX1    0,QL
         1 000131   100000 441100                    SXL1    0,,PR1

     2654     8374    2               WABLKDAT.KV$VDO_BLKDAT.RSN = K$RWPARM.RSN;

   8374  1 000132   300010 236100                    LDQ     8,,PR3
         1 000133   000033 736000                    QLS     27
         1 000134   100001 552140                    STBQ    1,'40'O,PR1
         1 000135   000506 710000 1                  TRA     s:8474

     2655     8375
     2656     8376    2             CASE (%KV_VDO_FNC_CLSSTR);

     2657     8377    2              ADDR(WACLSSTR.KV$VDO_CLSSTR.DLT)->BIT2BSD = ADDR(K$RWPARM.VDOFLGS.DLTSTR
              8377                        )->BIT2BSD;

   8377  1 000136   300040 236100                    LDQ     32,,PR3
         1 000137   000011 772000                    QRL     9
         1 000140   100000 676100                    ERQ     0,,PR1
         1 000141   300000 376007                    ANQ     98304,DL
         1 000142   100000 656100                    ERSQ    0,,PR1
         1 000143   000506 710000 1                  TRA     s:8474

     2658     8378
     2659     8379    2             CASE (%KV_VDO_FNC_DCLFLD);

     2660     8380    2               LHDR$ = K$RWPARM.V$ ;

   8380  1 000144   300043 236100                    LDQ     35,,PR3
         1 000145   200037 756100                    STQ     LHDR$,,AUTO

     2661     8381    2               WADCLFLD.KV$VDO_DCLFLD.LIN = LHDR$->FPT$DCLFLD_V.LIN;

   8381  1 000146   200037 474500                    LDP4    LHDR$,,AUTO
         1 000147   400001 221100                    LDX1    1,,PR4
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:502  
         1 000150   100000 441100                    SXL1    0,,PR1

     2662     8382    2               WADCLFLD.KV$VDO_DCLFLD.CLM = LHDR$->FPT$DCLFLD_V.CLM;

   8382  1 000151   400001 722100                    LXL2    1,,PR4
         1 000152   100001 742100                    STX2    1,,PR1

     2663     8383    2               WADCLFLD.KV$VDO_DCLFLD.WDT = LHDR$->FPT$DCLFLD_V.WDT;

   8383  1 000153   400002 723100                    LXL3    2,,PR4
         1 000154   100001 443100                    SXL3    1,,PR1

     2664     8384    2               TEMP1 = LHDR$->FPT$DCLFLD_V.ID;

   8384  1 000155   400002 236100                    LDQ     2,,PR4
         1 000156   000022 772000                    QRL     18
         1 000157   200037 756100                    STQ     LHDR$,,AUTO

     2665     8385    2               WADCLFLD.KV$VDO_DCLFLD.ID = TEMP1+TEMP1/256*256;

   8385  1 000160   000010 772000                    QRL     8
         1 000161   000010 736000                    QLS     8
         1 000162   200037 036100                    ADLQ    LHDR$,,AUTO
         1 000163   000000 624006                    EAX4    0,QL
         1 000164   100002 444100                    SXL4    2,,PR1

     2666     8386    2               IF VLP$FLDATR.ABSGRPRND ~= 0

   8386  1 000165   300036 474500                    LDP4    30,,PR3
         1 000166   400001 236100                    LDQ     1,,PR4
         1 000167   777000 316003                    CANQ    -512,DU
         1 000170   000203 600000 1                  TZE     s:8392

     2667     8387    3                 THEN DO;

     2668     8388    3                   WADCLFLD.KV$VDO_DCLFLD.GRPRND = BINBIT(VLP$FLDATR.ABSGRPRND,SIZEB(
              8388                            KV$VDO_DCLFLD.GRPRND));
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:503  

   8388  1 000171   400001 236100                    LDQ     1,,PR4
         1 000172   000033 772000                    QRL     27
         1 000173   000034 736000                    QLS     28
         1 000174   000012 772000                    QRL     10
         1 000175   100002 676100                    ERQ     2,,PR1
         1 000176   000377 376003                    ANQ     255,DU
         1 000177   100002 656100                    ERSQ    2,,PR1

     2669     8389    3                   WADCLFLD.KV$VDO_DCLFLD.GRPRND.ABS = '1'B;

   8389  1 000200   000200 236003                    LDQ     128,DU
         1 000201   100002 256100                    ORSQ    2,,PR1

     2670     8390    3                   END;

   8390  1 000202   000210 710000 1                  TRA     s:8393

     2671     8391    2                 ELSE
     2672     8392    2                   WADCLFLD.KV$VDO_DCLFLD.GRPRND = VLP$FLDATR.GRPRND;

   8392  1 000203   400000 236100                    LDQ     0,,PR4
         1 000204   000012 772000                    QRL     10
         1 000205   100002 676100                    ERQ     2,,PR1
         1 000206   000377 376003                    ANQ     255,DU
         1 000207   100002 656100                    ERSQ    2,,PR1

     2673     8393    2               WADCLFLD.KV$VDO_DCLFLD.QLF = VLP$FLDATR.QLF;

   8393  1 000210   300036 474500                    LDP4    30,,PR3
         1 000211   400000 236100                    LDQ     0,,PR4
         1 000212   000021 736000                    QLS     17
         1 000213   100002 676100                    ERQ     2,,PR1
         1 000214   377000 376003                    ANQ     130560,DU
         1 000215   100002 656100                    ERSQ    2,,PR1
         1 000216   000506 710000 1                  TRA     s:8474

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:504  
     2674     8394
     2675     8395    2             CASE (%KV_VDO_FNC_DCLSTR);

     2676     8396    2               WADCLSTR.KV$VDO_DCLSTR.STRID = K$RWPARM.STRID;

   8396  1 000217   300040 236100                    LDQ     32,,PR3
         1 000220   000022 772000                    QRL     18
         1 000221   100000 552110                    STBQ    0,'10'O,PR1

     2677     8397    2               WADCLSTR.KV$VDO_DCLSTR.RE_STR = K$RWPARM.VDOFLGS.REDSTR;

   8397  1 000222   300040 236100                    LDQ     32,,PR3
         1 000223   000020 772000                    QRL     16
         1 000224   100000 676100                    ERQ     0,,PR1
         1 000225   000200 376007                    ANQ     128,DL
         1 000226   100000 656100                    ERSQ    0,,PR1
         1 000227   000506 710000 1                  TRA     s:8474

     2678     8398
     2679     8399    2             CASE (%KV_VDO_FNC_DAT,%KV_VDO_FNC_DAT_IMD);

     2680     8400    2               WADAT.KV$VDO_DAT.DATCTRCHRTYP = %KV_DATCTRCHRTYP_VFC;

   8400  1 000230   100000 236100                    LDQ     0,,PR1
         1 000231   000000 376000 2                  ANQ     0
         1 000232   010000 276007                    ORQ     4096,DL
         1 000233   100000 756100                    STQ     0,,PR1

     2681     8401    2               WADAT.KV$VDO_DAT.DATCTRCHR = K$RWPARM.DVE.VFC;

   8401  1 000234   300010 236100                    LDQ     8,,PR3
         1 000235   000022 772000                    QRL     18
         1 000236   100000 552104                    STBQ    0,'04'O,PR1

     2682     8402    2               WADAT.KV$VDO_DAT.DCBHDR = K$RWPARM.DVE.DVBYTE.DCBHDR;

   8402  1 000237   300010 236100                    LDQ     8,,PR3
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:505  
         1 000240   000016 772000                    QRL     14
         1 000241   100000 676100                    ERQ     0,,PR1
         1 000242   040000 376007                    ANQ     16384,DL
         1 000243   100000 656100                    ERSQ    0,,PR1

     2683     8403    2               IF K$RWPARM.DVE.DVBYTE.TRANS

   8403  1 000244   300010 236100                    LDQ     8,,PR3
         1 000245   020000 316003                    CANQ    8192,DU
         1 000246   000506 600000 1                  TZE     s:8474

     2684     8404    2                 THEN
     2685     8405    2                   WADAT.KV$VDO_DAT.DATMOD = %KV_DATMOD_TRN;

   8405  1 000247   100000 236100                    LDQ     0,,PR1
         1 000250   000001 376000 2                  ANQ     1
         1 000251   001000 276007                    ORQ     512,DL
         1 000252   100000 756100                    STQ     0,,PR1
         1 000253   000506 710000 1                  TRA     s:8474

     2686     8406
     2687     8407    2             CASE (%KV_VDO_FNC_DLT);

     2688     8408    2               WADLT.KV$VDO_DLT.CTLFLG = FPT$TRMPRG_V.CTLFLG;

   8408  1 000254   300043 474500                    LDP4    35,,PR3
         1 000255   400002 236100                    LDQ     2,,PR4
         1 000256   000022 772000                    QRL     18
         1 000257   100000 552110                    STBQ    0,'10'O,PR1
         1 000260   000506 710000 1                  TRA     s:8474

     2689     8409
     2690     8410    2             CASE (%KV_VDO_FNC_ERS);

     2691     8411    2               ADDR(WAERS.KV$VDO_ERS.PRT)->BIT2BSD =

   8411  1 000261   300043 474500                    LDP4    35,,PR3
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:506  
         1 000262   400001 236100                    LDQ     1,,PR4
         1 000263   000001 772000                    QRL     1
         1 000264   100000 676100                    ERQ     0,,PR1
         1 000265   300000 376007                    ANQ     98304,DL
         1 000266   100000 656100                    ERSQ    0,,PR1
         1 000267   000506 710000 1                  TRA     s:8474

     2692     8412    2                 ADDR(FPT$ERASE_V.PRT)->BIT2BSD;
     2693     8413
     2694     8414    2             CASE (%KV_VDO_FNC_OPNSTR);

     2695     8415    2               WAOPNSTR.KV$VDO_OPNSTR.ORG = K$RWPARM.ORG;

   8415  1 000270   300040 236100                    LDQ     32,,PR3
         1 000271   000022 772000                    QRL     18
         1 000272   100000 552110                    STBQ    0,'10'O,PR1

     2696     8416    2               WAOPNSTR.KV$VDO_OPNSTR.NRECS = K$RWPARM.NRECS;

   8416  1 000273   300046 236100                    LDQ     38,,PR3
         1 000274   000011 772000                    QRL     9
         1 000275   100000 552104                    STBQ    0,'04'O,PR1

     2697     8417    2               WAOPNSTR.KV$VDO_OPNSTR.KEYL = K$RWPARM.KEYSZ;

   8417  1 000276   300046 236100                    LDQ     38,,PR3
         1 000277   000033 736000                    QLS     27
         1 000300   100001 552140                    STBQ    1,'40'O,PR1

     2698     8418    2               WAOPNSTR.KV$VDO_OPNSTR.SPARE = K$RWPARM.SPARE;

   8418  1 000301   300040 236100                    LDQ     32,,PR3
         1 000302   100001 552120                    STBQ    1,'20'O,PR1
         1 000303   000506 710000 1                  TRA     s:8474

     2699     8419
     2700     8420    2             CASE (%KV_VDO_FNC_PRM_SET);
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:507  

     2701     8421    2               IF K$RWPARM.V$~=ADDR(NIL)

   8421  1 000304   300043 236100                    LDQ     35,,PR3
         1 000305   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000306   000313 600000 1                  TZE     s:8424

     2702     8422    2                 THEN
     2703     8423    2                   MSGSZ = MSGSZ+K$RWPARM.VSZ;

   8423  1 000307   300045 236100                    LDQ     37,,PR3
         1 000310   000022 772000                    QRL     18
         1 000311   200044 036100                    ADLQ    MSGSZ,,AUTO
         1 000312   200044 756100                    STQ     MSGSZ,,AUTO

     2704     8424    2               IF K$RWPARM.PRMID=0 AND K$RWPARM.DVE.DVBYTE.VFC

   8424  1 000313   300045 721100                    LXL1    37,,PR3
         1 000314   000332 601000 1                  TNZ     s:8428
         1 000315   300010 236100                    LDQ     8,,PR3
         1 000316   100000 316003                    CANQ    32768,DU
         1 000317   000332 600000 1                  TZE     s:8428
         1 000320   300010 236100                    LDQ     8,,PR3
         1 000321   000160 376003                    ANQ     112,DU
         1 000322   000020 116003                    CMPQ    16,DU
         1 000323   000332 601000 1                  TNZ     s:8428

     2705     8425    2                 AND ADDR(K$RWPARM.DVE.VFC)->NK$VFC.FCN = %VFCF_SPC
     2706     8426    2                 THEN
     2707     8427    2                   K$RWPARM.PRMID = TRAN_PRMID(ADDR(K$RWPARM.DVE.VFC)->NK$VFC.COUNT);

   8427  1 000324   300010 236100                    LDQ     8,,PR3
         1 000325   000022 772000                    QRL     18
         1 000326   000017 376007                    ANQ     15,DL
         1 000327   000100 101406                    MRL     fill='000'O
         1 000330   000000 000001 0                  ADSC9   TRAN_PRMID,Q             cn=0,n=1
         1 000331   300045 400002                    ADSC9   37,,PR3                  cn=2,n=2
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:508  

     2708     8428    2               IF K$RWPARM.PRMID ~= 0

   8428  1 000332   300045 721100                    LXL1    37,,PR3
         1 000333   000506 600000 1                  TZE     s:8474

     2709     8429    3                 THEN DO;

     2710     8430    3                   IF K$RWPARM.PRMID = %KV_PRMID_EDTBFR

   8430  1 000334   000203 101003                    CMPX1   131,DU
         1 000335   000341 601000 1                  TNZ     s:8433

     2711     8431    3                     THEN
     2712     8432    3                       MSGSZ = MSGSZ + LENGTHC(SIN);

   8432  1 000336   200044 235100                    LDA     MSGSZ,,AUTO
         1 000337   000004 035007                    ADLA    4,DL
         1 000340   200044 755100                    STA     MSGSZ,,AUTO

     2713     8433    3                   IF K$RWPARM.PRMID = %KV_PRMID_REREADCLM

   8433  1 000341   000212 101003                    CMPX1   138,DU
         1 000342   000346 601000 1                  TNZ     s:8436

     2714     8434    3                     THEN
     2715     8435    3                       MSGSZ = MSGSZ + LENGTHV(SIN);

   8435  1 000343   200044 235100                    LDA     MSGSZ,,AUTO
         1 000344   000003 035007                    ADLA    3,DL
         1 000345   200044 755100                    STA     MSGSZ,,AUTO

     2716     8436    3                   IF MSGSZ>255 THEN MSGSZ = MSGSZ+2;

   8436  1 000346   200044 235100                    LDA     MSGSZ,,AUTO
         1 000347   000400 115007                    CMPA    256,DL
         1 000350   000353 602000 1                  TNC     s:8437
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:509  

   8436  1 000351   000002 035007                    ADLA    2,DL
         1 000352   200044 755100                    STA     MSGSZ,,AUTO

     2717     8437    3                   MSGSZ = MSGSZ + 2;

   8437  1 000353   000002 035007                    ADLA    2,DL
         1 000354   200044 755100                    STA     MSGSZ,,AUTO

     2718     8438    3                   END;

   8438  1 000355   000506 710000 1                  TRA     s:8474

     2719     8439
     2720     8440    2             CASE (%KV_VDO_FNC_RQSDAT);

     2721     8441    2               WARQSDAT.KV$VDO_RQSDAT.WAT = K$RWPARM.VDOFLGS.WAIT;

   8441  1 000356   300040 236100                    LDQ     32,,PR3
         1 000357   000006 736000                    QLS     6
         1 000360   100002 676100                    ERQ     2,,PR1
         1 000361   002000 376003                    ANQ     1024,DU
         1 000362   100002 656100                    ERSQ    2,,PR1

     2722     8442    2               WARQSDAT.KV$VDO_RQSDAT.INCMAXNMBRCR = K$RWPARM.VDOFLGS.INCNMBRCR;

   8442  1 000363   300040 236100                    LDQ     32,,PR3
         1 000364   000016 736000                    QLS     14
         1 000365   100002 676100                    ERQ     2,,PR1
         1 000366   200000 376003                    ANQ     65536,DU
         1 000367   100002 656100                    ERSQ    2,,PR1

     2723     8443    2               WARQSDAT.KV$VDO_RQSDAT.RE_RED = K$RWPARM.DVE.DVBYTE.REREAD;

   8443  1 000370   300010 236100                    LDQ     8,,PR3
         1 000371   000001 772000                    QRL     1
         1 000372   100002 676100                    ERQ     2,,PR1
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:510  
         1 000373   040000 376003                    ANQ     16384,DU
         1 000374   100002 656100                    ERSQ    2,,PR1

     2724     8444    2               WARQSDAT.KV$VDO_RQSDAT.EOFNO_DAT = K$RWPARM.DVE.DVBYTE.NODAT;

   8444  1 000375   300010 236100                    LDQ     8,,PR3
         1 000376   100002 676100                    ERQ     2,,PR1
         1 000377   004000 376003                    ANQ     2048,DU
         1 000400   100002 656100                    ERSQ    2,,PR1

     2725     8445    2               WARQSDAT.KV$VDO_RQSDAT.BP = K$RWPARM.DVE.DVBYTE.BP;

   8445  1 000401   300010 236100                    LDQ     8,,PR3
         1 000402   000007 772000                    QRL     7
         1 000403   100002 676100                    ERQ     2,,PR1
         1 000404   001000 376003                    ANQ     512,DU
         1 000405   100002 656100                    ERSQ    2,,PR1

     2726     8446    2               IF K$RWPARM.DVE.DVBYTE.TRANS

   8446  1 000406   300010 236100                    LDQ     8,,PR3
         1 000407   020000 316003                    CANQ    8192,DU
         1 000410   000415 600000 1                  TZE     s:8449

     2727     8447    2                 THEN
     2728     8448    2                   WARQSDAT.KV$VDO_RQSDAT.DATMOD = %KV_DATMOD_TRN;

   8448  1 000411   100002 236100                    LDQ     2,,PR1
         1 000412   000002 376000 2                  ANQ     2
         1 000413   010000 276003                    ORQ     4096,DU
         1 000414   100002 756100                    STQ     2,,PR1

     2729     8449    2               WARQSDAT.KV$VDO_RQSDAT.MAXNMBRCR = K$RWPARM.MAXNMBRCR;

   8449  1 000415   300041 221100                    LDX1    33,,PR3
         1 000416   100001 741100                    STX1    1,,PR1

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:511  
     2730     8450    2               GLOM.TEMP0 = K$RWPARM.MAXNMBBYT ;

   8450  1 000417   300041 236100                    LDQ     33,,PR3
         1 000420   777777 376007                    ANQ     -1,DL
         1 000421   200042 756100                    STQ     GLOM+1,,AUTO

     2731     8451    2               WARQSDAT.KV$VDO_RQSDAT.MAXNMBBYT = GLOM.TEMP0+GLOM.TEMP0/256*256;

   8451  1 000422   000010 772000                    QRL     8
         1 000423   000010 736000                    QLS     8
         1 000424   200042 036100                    ADLQ    GLOM+1,,AUTO
         1 000425   000000 621006                    EAX1    0,QL
         1 000426   100001 441100                    SXL1    1,,PR1

     2732     8452    2               GLOM.TEMP0 = K$RWPARM.MAXRCRBYTSIZ ;

   8452  1 000427   300042 236100                    LDQ     34,,PR3
         1 000430   000022 772000                    QRL     18
         1 000431   200042 756100                    STQ     GLOM+1,,AUTO

     2733     8453    2               WARQSDAT.KV$VDO_RQSDAT.MAXRCRBYTSIZ = GLOM.TEMP0+GLOM.TEMP0/256*256;

   8453  1 000432   000010 772000                    QRL     8
         1 000433   000010 736000                    QLS     8
         1 000434   200042 036100                    ADLQ    GLOM+1,,AUTO
         1 000435   000000 621006                    EAX1    0,QL
         1 000436   100000 441100                    SXL1    0,,PR1
         1 000437   000506 710000 1                  TRA     s:8474

     2734     8454
     2735     8455    2             CASE (%KV_VDO_FNC_RQSPRM);

     2736     8456    2               WARQSPRM.KV$VDO_RQSPRM.PRMID = K$RWPARM.PRMID;

   8456  1 000440   300045 236100                    LDQ     37,,PR3
         1 000441   000011 736000                    QLS     9
         1 000442   100000 552110                    STBQ    0,'10'O,PR1
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:512  

     2737     8457    2               GLOM.TEMP0 = K$RWPARM.MAXRCRBYTSIZ ;

   8457  1 000443   300042 236100                    LDQ     34,,PR3
         1 000444   000022 772000                    QRL     18
         1 000445   200042 756100                    STQ     GLOM+1,,AUTO

     2738     8458    2               WARQSPRM.KV$VDO_RQSPRM.MAXNMBBYT = GLOM.TEMP0+GLOM.TEMP0/256*256;

   8458  1 000446   000010 772000                    QRL     8
         1 000447   000010 736000                    QLS     8
         1 000450   200042 036100                    ADLQ    GLOM+1,,AUTO
         1 000451   000000 621006                    EAX1    0,QL
         1 000452   100001 741100                    STX1    1,,PR1
         1 000453   000506 710000 1                  TRA     s:8474

     2739     8459
     2740     8460    2             CASE (%KV_VDO_FNC_SLCGRPRND);

     2741     8461    2               IF VLP$FLDATR.ABSGRPRND ~= 0

   8461  1 000454   300036 474500                    LDP4    30,,PR3
         1 000455   400001 236100                    LDQ     1,,PR4
         1 000456   777000 316003                    CANQ    -512,DU
         1 000457   000472 600000 1                  TZE     s:8467

     2742     8462    3                 THEN DO;

     2743     8463    3                   WASLCGRPRND.KV$VDO_SLCGRPRND.GRPRND = BINBIT(VLP$FLDATR.ABSGRPRND,
              8463                            SIZEB(KV$VDO_SLCGRPRND.GRPRND));

   8463  1 000460   400001 236100                    LDQ     1,,PR4
         1 000461   000033 772000                    QRL     27
         1 000462   000034 736000                    QLS     28
         1 000463   000023 772000                    QRL     19
         1 000464   100000 676100                    ERQ     0,,PR1
         1 000465   377000 376007                    ANQ     130560,DL
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:513  
         1 000466   100000 656100                    ERSQ    0,,PR1

     2744     8464    3                   WASLCGRPRND.KV$VDO_SLCGRPRND.GRPRND.ABS = '1'B;

   8464  1 000467   200000 236007                    LDQ     65536,DL
         1 000470   100000 256100                    ORSQ    0,,PR1

     2745     8465    3                   END;

   8465  1 000471   000506 710000 1                  TRA     s:8474

     2746     8466    2                 ELSE
     2747     8467    2                   WASLCGRPRND.KV$VDO_SLCGRPRND.GRPRND = VLP$FLDATR.GRPRND;

   8467  1 000472   400000 236100                    LDQ     0,,PR4
         1 000473   000023 772000                    QRL     19
         1 000474   100000 676100                    ERQ     0,,PR1
         1 000475   377000 376007                    ANQ     130560,DL
         1 000476   100000 656100                    ERSQ    0,,PR1
         1 000477   000506 710000 1                  TRA     s:8474

     2748     8468
     2749     8469    2             CASE (%KV_VDO_FNC_SLCQLF);

     2750     8470    2               WASLCQLF.KV$VDO_SLCQLF.QLF = VLP$FLDATR.QLF;

   8470  1 000500   300036 474500                    LDP4    30,,PR3
         1 000501   400000 236100                    LDQ     0,,PR4
         1 000502   000001 772000                    QRL     1
         1 000503   100000 676100                    ERQ     0,,PR1
         1 000504   377000 376007                    ANQ     130560,DL
         1 000505   100000 656100                    ERSQ    0,,PR1

     2751     8471
     2752     8472    2             END /* CASES */;

     2753     8473
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:514  
     2754     8474    1           LHDR$ = HDR$;

   8474  1 000506   200036 236100                    LDQ     HDR$,,AUTO
         1 000507   200037 756100                    STQ     LHDR$,,AUTO

     2755     8475    1           HDR$ = PINCRC(HDR$,VDOSZ);

   8475  1 000510   200040 236100                    LDQ     VDOSZ,,AUTO
         1 000511   000020 736000                    QLS     16
         1 000512   200036 036100                    ADLQ    HDR$,,AUTO
         1 000513   200036 756100                    STQ     HDR$,,AUTO

     2756     8476    1           IF K$RWPARM.MSGID ~= 0

   8476  1 000514   300011 235100                    LDA     9,,PR3
         1 000515   000552 600000 1                  TZE     s:8491

     2757     8477    2             THEN DO;

     2758     8478    2               GLOM.TEMP0 = K$RWPARM.MSGID ;

   8478  1 000516   200042 755100                    STA     GLOM+1,,AUTO

     2759     8479    2               GLOM.FLDID = ADDR(KI_VDOVLP_CG_MSGID)->BT36;

   8479  1 000517   000000 236000 xsym               LDQ     KI_VDOVLP_CG_MSGID
         1 000520   200041 756100                    STQ     GLOM,,AUTO

     2760     8480    2               GLOM.TEMP4 = K$RWPARM.MSGIDXT;

   8480  1 000521   300012 236100                    LDQ     10,,PR3
         1 000522   200043 756100                    STQ     GLOM+2,,AUTO

     2761     8481    2               GLOM.TEMP3.BY1 = GLOM.TEMP2.B1;

   8481  1 000523   200042 236100                    LDQ     GLOM+1,,AUTO
         1 000524   037700 376003                    ANQ     16320,DU
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:515  
         1 000525   000003 736000                    QLS     3
         1 000526   200042 552140                    STBQ    GLOM+1,'40'O,AUTO

     2762     8482    2               GLOM.TEMP3.BY2 = GLOM.TEMP2.B2 ;

   8482  1 000527   200042 236100                    LDQ     GLOM+1,,AUTO
         1 000530   000003 376000 2                  ANQ     3
         1 000531   000002 736000                    QLS     2
         1 000532   200042 552120                    STBQ    GLOM+1,'20'O,AUTO

     2763     8483    2               GLOM.TEMP3.BY3 = GLOM.TEMP2.B3 ;

   8483  1 000533   200042 236100                    LDQ     GLOM+1,,AUTO
         1 000534   177400 376007                    ANQ     65280,DL
         1 000535   000001 736000                    QLS     1
         1 000536   200042 552110                    STBQ    GLOM+1,'10'O,AUTO

     2764     8484    2               GLOM.TEMP3.BY4 = GLOM.TEMP2.B4 ;

   8484  1 000537   200042 236100                    LDQ     GLOM+1,,AUTO
         1 000540   000377 376007                    ANQ     255,DL
         1 000541   200042 552104                    STBQ    GLOM+1,'04'O,AUTO

     2765     8485    2               ADDR(HDR$->KV$VDOVLP_CG_MSGID)->CHR12BSD = ADDR(GLOM)->CHR12BSD ;

   8485  1 000542   200036 471500                    LDP1    HDR$,,AUTO
         1 000543   040100 100500                    MLR     fill='040'O
         1 000544   200041 000014                    ADSC9   GLOM,,AUTO               cn=0,n=12
         1 000545   100000 000014                    ADSC9   0,,PR1                   cn=0,n=12

     2766     8486
     2767     8487    2               LHDR$ = HDR$;

   8487  1 000546   200036 236100                    LDQ     HDR$,,AUTO
         1 000547   200037 756100                    STQ     LHDR$,,AUTO

     2768     8488    2               HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_CG_MSGID));
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:516  

   8488  1 000550   000003 036003                    ADLQ    3,DU
         1 000551   200036 756100                    STQ     HDR$,,AUTO

     2769     8489    2               END;

     2770     8490        /* CG message type */
     2771     8491    1           IF K$RWPARM.MSGTYP ~= ' '

   8491  1 000552   300004 237100                    LDAQ    4,,PR3
         1 000553   000004 117000 2                  CMPAQ   4
         1 000554   000606 600000 1                  TZE     s:8505

     2772     8492    2             THEN DO;

     2773     8493    2               ADDR(HDR$->KV$VDOVLP_CG_MSGTYP)->CHR4BSD = ADDR(KI_VDOVLP_CG_MSGTYP)->
              8493                        CHR4BSD;

   8493  1 000555   200036 471500                    LDP1    HDR$,,AUTO
         1 000556   040100 100400                    MLR     fill='040'O
         1 000557   000000 000004 xsym               ADSC9   KI_VDOVLP_CG_MSGTYP      cn=0,n=4
         1 000560   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4

     2774     8494    2               HDR$->KV$VDOVLP_CG_MSGTYP.CG_MSGTYP = K$RWPARM.MSGTYP;

   8494  1 000561   040100 100500                    MLR     fill='040'O
         1 000562   300004 000010                    ADSC9   4,,PR3                   cn=0,n=8
         1 000563   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8

     2775     8495    2               LHDR$ = HDR$;

   8495  1 000564   200036 236100                    LDQ     HDR$,,AUTO
         1 000565   200037 756100                    STQ     LHDR$,,AUTO

     2776     8496    2               HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_CG_MSGTYP));

   8496  1 000566   000003 036003                    ADLQ    3,DU
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:517  
         1 000567   200036 756100                    STQ     HDR$,,AUTO

     2777     8497    2               IF K$RWPARM.STATION ~= ' '

   8497  1 000570   300002 237100                    LDAQ    2,,PR3
         1 000571   000004 117000 2                  CMPAQ   4
         1 000572   000606 600000 1                  TZE     s:8505

     2778     8498    3                 THEN DO;

     2779     8499    3                   ADDR(HDR$->KV$VDOVLP_CG_STA)->CHR4BSD = ADDR(KI_VDOVLP_CG_STA)->
              8499                            CHR4BSD;

   8499  1 000573   200036 471500                    LDP1    HDR$,,AUTO
         1 000574   040100 100400                    MLR     fill='040'O
         1 000575   000000 000004 xsym               ADSC9   KI_VDOVLP_CG_STA         cn=0,n=4
         1 000576   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4

     2780     8500    3                   HDR$->KV$VDOVLP_CG_STA.CG_STA = K$RWPARM.STATION;

   8500  1 000577   040100 100500                    MLR     fill='040'O
         1 000600   300002 000010                    ADSC9   2,,PR3                   cn=0,n=8
         1 000601   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8

     2781     8501    3                   LHDR$ = HDR$;

   8501  1 000602   200036 236100                    LDQ     HDR$,,AUTO
         1 000603   200037 756100                    STQ     LHDR$,,AUTO

     2782     8502    3                   HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_CG_STA));

   8502  1 000604   000003 036003                    ADLQ    3,DU
         1 000605   200036 756100                    STQ     HDR$,,AUTO

     2783     8503    3                   END;

     2784     8504    2               END;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:518  

     2785     8505    1           IF K$RWPARM.MSG_ERRCODE

   8505  1 000606   300037 235100                    LDA     31,,PR3
         1 000607   000634 600000 1                  TZE     s:8513

     2786     8506    2             THEN DO;

     2787     8507    2               CALL EMR$HOST2FEP (GLOM.ERR,K$RWPARM.MSG_ERRCODE);

   8507  1 000610   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 000611   000037 036003                    ADLQ    31,DU
         1 000612   200047 756100                    STQ     MSGSZ+3,,AUTO
         1 000613   200042 631500                    EPPR1   GLOM+1,,AUTO
         1 000614   200046 451500                    STP1    MSGSZ+2,,AUTO
         1 000615   200046 630500                    EPPR0   MSGSZ+2,,AUTO
         1 000616   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000617   000000 701000 xent               TSX1    EMR$HOST2FEP
         1 000620   000000 011000                    NOP     0

     2788     8508    2               HDR$->KV$VDOVLP_ERR = KI_VDOVLP_ERR;

   8508  1 000621   200036 470500                    LDP0    HDR$,,AUTO
         1 000622   000100 100400                    MLR     fill='000'O
         1 000623   000000 000006 xsym               ADSC9   KI_VDOVLP_ERR            cn=0,n=6
         1 000624   000000 000006                    ADSC9   0,,PR0                   cn=0,n=6

     2789     8509    2               HDR$->KV$VDOVLP_ERR.ERRCODE = GLOM.ERR;

   8509  1 000625   000100 100500                    MLR     fill='000'O
         1 000626   200042 000004                    ADSC9   GLOM+1,,AUTO             cn=0,n=4
         1 000627   000000 400004                    ADSC9   0,,PR0                   cn=2,n=4

     2790     8510    2               LHDR$ = HDR$;

   8510  1 000630   200036 236100                    LDQ     HDR$,,AUTO
         1 000631   200037 756100                    STQ     LHDR$,,AUTO
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:519  

     2791     8511    2               HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_ERR));

   8511  1 000632   000006 036000 2                  ADLQ    6
         1 000633   200036 756100                    STQ     HDR$,,AUTO

     2792     8512    2               END;

     2793     8513    1           IF K$RWPARM.KEY$ ~= ADDR(NIL) AND K$RWPARM.KEYSZ ~= 0

   8513  1 000634   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000635   000044 236100                    LDQ     36,,PR0
         1 000636   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000637   001033 600000 1                  TZE     s:8558
         1 000640   000046 236100                    LDQ     38,,PR0
         1 000641   000777 316007                    CANQ    511,DL
         1 000642   001033 600000 1                  TZE     s:8558

     2794     8514    1             THEN
     2795     8515    1               IF K$RWPARM.KEYTYPE ~= %KEYTYPE_FLDID#

   8515  1 000643   000046 236100                    LDQ     38,,PR0
         1 000644   777000 376007                    ANQ     -512,DL
         1 000645   001000 116007                    CMPQ    512,DL
         1 000646   000771 600000 1                  TZE     s:8549

     2796     8516    2                 THEN DO;

     2797     8517    2                   IF K$RWPARM.KEYSZ>32 THEN EXIT;

   8517  1 000647   000046 236100                    LDQ     38,,PR0
         1 000650   000777 376007                    ANQ     511,DL
         1 000651   000041 116007                    CMPQ    33,DL
         1 000652   000770 603000 1                  TRC     s:8547

     2798     8518    2                   HDR$->KV$VDOVLP_KEY = KI_VDOVLP_KEY;

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:520  
   8518  1 000653   200036 471500                    LDP1    HDR$,,AUTO
         1 000654   000100 100400                    MLR     fill='000'O
         1 000655   000000 000002 xsym               ADSC9   KI_VDOVLP_KEY            cn=0,n=2
         1 000656   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

     2799     8519    2                   HDR$->KV$VDOVLP_KEY.BYTSIZ = K$RWPARM.KEYSZ;

   8519  1 000657   000100 100500                    MLR     fill='000'O
         1 000660   000046 600001                    ADSC9   38,,PR0                  cn=3,n=1
         1 000661   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1

     2800     8520    2                   LHDR$ = HDR$;

   8520  1 000662   200036 236100                    LDQ     HDR$,,AUTO
         1 000663   200037 756100                    STQ     LHDR$,,AUTO

     2801     8521    2                   HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_KEY));

   8521  1 000664   400000 036007                    ADLQ    -131072,DL
         1 000665   200036 756100                    STQ     HDR$,,AUTO

     2802     8522    2                   GLOM.TEMP0 = K$RWPARM.KEYSZ ;

   8522  1 000666   000046 236100                    LDQ     38,,PR0
         1 000667   000777 376007                    ANQ     511,DL
         1 000670   200042 756100                    STQ     GLOM+1,,AUTO

     2803     8523    2                   HDR$->KEY = K$RWPARM.KEY$->KEY;

   8523  1 000671   000046 720100                    LXL0    38,,PR0
         1 000672   000777 360003                    ANX0    511,DU
         1 000673   000044 471500                    LDP1    36,,PR0
         1 000674   200036 473500                    LDP3    HDR$,,AUTO
         1 000675   040140 100540                    MLR     fill='040'O
         1 000676   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 000677   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:521  
     2804     8524    2                   IF GLOM.TEMP0 < 5 AND

   8524  1 000700   200042 235100                    LDA     GLOM+1,,AUTO
         1 000701   000005 115007                    CMPA    5,DL
         1 000702   000747 603000 1                  TRC     s:8540
         1 000703   000046 236100                    LDQ     38,,PR0
         1 000704   777000 376007                    ANQ     -512,DL
         1 000705   004000 116007                    CMPQ    2048,DL
         1 000706   000713 600000 1                  TZE     s:8529
         1 000707   005000 116007                    CMPQ    2560,DL
         1 000710   000713 600000 1                  TZE     s:8529
         1 000711   006000 116007                    CMPQ    3072,DL
         1 000712   000747 601000 1                  TNZ     s:8540

     2805     8525    2                     (K$RWPARM.KEYTYPE=%KEYTYPE_BIN10#
     2806     8526    2                     OR K$RWPARM.KEYTYPE=%KEYTYPE_BINHLF#
     2807     8527    2                     OR K$RWPARM.KEYTYPE=%KEYTYPE_BIN521#)
     2808     8528    3                     THEN DO;

     2809     8529    3                       GLOM.OP6$ = PINCRB(HDR$,GLOM.TEMP0);

   8529  1 000713   300000 503505                    ABD     0,AL,PR3
         1 000714   200041 453500                    STP3    GLOM,,AUTO

     2810     8530        /*     HDR$->KEY = ' ' ;    Hi order bits of each byte to '0'B */
     2811     8531    3                       DEST.BY1 = SOURCE.BY1 ;

   8531  1 000715   200036 471500                    LDP1    HDR$,,AUTO
         1 000716   003100 060500                    CSL     bolr='003'O
         1 000717   300000 000010                    BDSC    0,,PR3                   by=0,bit=0,n=8
         1 000720   100000 010010                    BDSC    0,,PR1                   by=0,bit=1,n=8

     2812     8532    3                       IF GLOM.TEMP0 =1 THEN EXIT;

   8532  1 000721   200042 235100                    LDA     GLOM+1,,AUTO
         1 000722   000001 115007                    CMPA    1,DL
         1 000723   000746 600000 1                  TZE     s:8538
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:522  

     2813     8533    3                       DEST.BY2 = SOURCE.BY2 ;

   8533  1 000724   200041 473500                    LDP3    GLOM,,AUTO
         1 000725   003100 060500                    CSL     bolr='003'O
         1 000726   300000 100010                    BDSC    0,,PR3                   by=0,bit=8,n=8
         1 000727   100000 210010                    BDSC    0,,PR1                   by=1,bit=1,n=8

     2814     8534    3                       IF GLOM.TEMP0 =2 THEN EXIT;

   8534  1 000730   200042 235100                    LDA     GLOM+1,,AUTO
         1 000731   000002 115007                    CMPA    2,DL
         1 000732   000746 600000 1                  TZE     s:8538

     2815     8535    3                       DEST.BY3 = SOURCE.BY3 ;

   8535  1 000733   200041 473500                    LDP3    GLOM,,AUTO
         1 000734   003100 060500                    CSL     bolr='003'O
         1 000735   300000 270010                    BDSC    0,,PR3                   by=1,bit=7,n=8
         1 000736   100000 410010                    BDSC    0,,PR1                   by=2,bit=1,n=8

     2816     8536    3                       IF GLOM.TEMP0 =3 THEN EXIT;

   8536  1 000737   200042 235100                    LDA     GLOM+1,,AUTO
         1 000740   000003 115007                    CMPA    3,DL
         1 000741   000746 600000 1                  TZE     s:8538

     2817     8537    3                       DEST.BY4 = SOURCE.BY4 ;

   8537  1 000742   200041 473500                    LDP3    GLOM,,AUTO
         1 000743   003100 060500                    CSL     bolr='003'O
         1 000744   300000 460010                    BDSC    0,,PR3                   by=2,bit=6,n=8
         1 000745   100000 610010                    BDSC    0,,PR1                   by=3,bit=1,n=8

     2818     8538    3                       END;

   8538  1 000746   000761 710000 1                  TRA     L1
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:523  

     2819     8539    3                     ELSE DO;

     2820     8540    3                       K$RWPARM.CVTDAT = '0'B;

   8540  1 000747   000007 236000 2                  LDQ     7
         1 000750   000010 356100                    ANSQ    8,,PR0

     2821     8541    3                       IF K$RWPARM.KEYTYPE=%KEYTYPE_ENTSRD#

   8541  1 000751   000046 236100                    LDQ     38,,PR0
         1 000752   777000 376007                    ANQ     -512,DL
         1 000753   003000 116007                    CMPQ    1536,DL
         1 000754   000761 601000 1                  TNZ     L1

     2822     8542    3                         THEN
     2823     8543    3                           LHDR$->KV$VDOVLP_KEY.TYP = %KV_VDOVLP_TYP_ENTSRD;

   8543  1 000755   200037 471500                    LDP1    LHDR$,,AUTO
         1 000756   003100 061400                    CSR     bolr='003'O
         1 000757   000014 000044 xsym               BDSC    B_VECTNIL+12             by=0,bit=0,n=36
         1 000760   100000 020007                    BDSC    0,,PR1                   by=0,bit=2,n=7

     2824     8544    3                       END;

     2825     8545    2   L1:
     2826     8546    2                   HDR$ = PINCRC(HDR$,((K$RWPARM.KEYSZ+1)/2)*2);

   8546  1 000761   000046 236100       L1           LDQ     38,,PR0
         1 000762   000777 376007                    ANQ     511,DL
         1 000763   000001 036007                    ADLQ    1,DL
         1 000764   000001 772000                    QRL     1
         1 000765   000021 736000                    QLS     17
         1 000766   200036 036100                    ADLQ    HDR$,,AUTO
         1 000767   200036 756100                    STQ     HDR$,,AUTO

     2827     8547    2                   END;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:524  

   8547  1 000770   001033 710000 1                  TRA     s:8558

     2828     8548    1                 ELSE
     2829     8549    1                   IF K$RWPARM.KEYSZ >= 2

   8549  1 000771   000046 236100                    LDQ     38,,PR0
         1 000772   000777 376007                    ANQ     511,DL
         1 000773   000002 116007                    CMPQ    2,DL
         1 000774   001033 602000 1                  TNC     s:8558

     2830     8550    2                     THEN DO;

     2831     8551    2                       HDR$->KV$VDOVLP_FLDID = KI_VDOVLP_FLDID;

   8551  1 000775   200036 471500                    LDP1    HDR$,,AUTO
         1 000776   000100 100400                    MLR     fill='000'O
         1 000777   000000 000004 xsym               ADSC9   KI_VDOVLP_FLDID          cn=0,n=4
         1 001000   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4

     2832     8552    2                       HDR$->KV$VDOVLP_FLDID.BYTSIZ = 2;

   8552  1 001001   000100 101400                    MRL     fill='000'O
         1 001002   000004 000004 xsym               ADSC9   B_VECTNIL+4              cn=0,n=4
         1 001003   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1

     2833     8553    2                       LHDR$ = HDR$;

   8553  1 001004   200036 236100                    LDQ     HDR$,,AUTO
         1 001005   200037 756100                    STQ     LHDR$,,AUTO

     2834     8554    2                       GLOM.FLDID.IDC = K$RWPARM.KEY$->B$FLDID;

   8554  1 001006   000044 473500                    LDP3    36,,PR0
         1 001007   040100 100500                    MLR     fill='040'O
         1 001010   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2
         1 001011   200041 400002                    ADSC9   GLOM,,AUTO               cn=2,n=2
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:525  

     2835     8555    2                       HDR$->KV$VDOVLP_FLDID.FLDID = GLOM.FLDID.ID+GLOM.FLDID.ID/256*
              8555                                256;

   8555  1 001012   200041 236100                    LDQ     GLOM,,AUTO
         1 001013   777777 376007                    ANQ     -1,DL
         1 001014   000010 772000                    QRL     8
         1 001015   200046 756100                    STQ     MSGSZ+2,,AUTO
         1 001016   200041 236100                    LDQ     GLOM,,AUTO
         1 001017   777777 376007                    ANQ     -1,DL
         1 001020   200047 756100                    STQ     MSGSZ+3,,AUTO
         1 001021   200046 236100                    LDQ     MSGSZ+2,,AUTO
         1 001022   000010 736000                    QLS     8
         1 001023   200047 036100                    ADLQ    MSGSZ+3,,AUTO
         1 001024   200050 756100                    STQ     MSGSZ+4,,AUTO
         1 001025   000100 101500                    MRL     fill='000'O
         1 001026   200050 000004                    ADSC9   MSGSZ+4,,AUTO            cn=0,n=4
         1 001027   100000 400002                    ADSC9   0,,PR1                   cn=2,n=2

     2836     8556    2                       HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_FLDID));

   8556  1 001030   200036 236100                    LDQ     HDR$,,AUTO
         1 001031   000001 036003                    ADLQ    1,DU
         1 001032   200036 756100                    STQ     HDR$,,AUTO

     2837     8557    2                       END;

     2838     8558    1           IF K$RWPARM.MRKTYP ~= 0

   8558  1 001033   000040 236100                    LDQ     32,,PR0
         1 001034   777000 316007                    CANQ    -512,DL
         1 001035   001122 600000 1                  TZE     s:8581

     2839     8559    2             THEN DO;

     2840     8560    2               HDR$->VDOVLP_MRK = KI_VDOVLP_MRK;

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:526  
   8560  1 001036   200036 471500                    LDP1    HDR$,,AUTO
         1 001037   000100 100400                    MLR     fill='000'O
         1 001040   000000 000010 xsym               ADSC9   KI_VDOVLP_MRK            cn=0,n=8
         1 001041   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8

     2841     8561    2               IF FUNCTION = %KV_VDO_FNC_MRK

   8561  1 001042   200003 473500                    LDP3    @FUNCTION,,AUTO
         1 001043   300000 235100                    LDA     0,,PR3
         1 001044   000037 115007                    CMPA    31,DL
         1 001045   001051 601000 1                  TNZ     s:8564

     2842     8562    2                 THEN
     2843     8563    2                   HDR$->VDOVLP_MRK.RSP = '1'B;

   8563  1 001046   003100 060400                    CSL     bolr='003'O
         1 001047   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 001050   100000 410001                    BDSC    0,,PR1                   by=2,bit=1,n=1

     2844     8564    2               HDR$->VDOVLP_MRK.MRKTYP = K$RWPARM.MRKTYP;

   8564  1 001051   000100 100500                    MLR     fill='000'O
         1 001052   000040 400001                    ADSC9   32,,PR0                  cn=2,n=1
         1 001053   100000 600001                    ADSC9   0,,PR1                   cn=3,n=1

     2845     8565    2               IF K$RWPARM.MRKTYP = %KV_VDOMRKTYP_SNDLSTRCRID

   8565  1 001054   000040 236100                    LDQ     32,,PR0
         1 001055   777000 376007                    ANQ     -512,DL
         1 001056   004000 116007                    CMPQ    2048,DL
         1 001057   001110 601000 1                  TNZ     s:8574

     2846     8566    3                 THEN DO;

     2847     8567    3                   GLOM.TEMP0 = K$RWPARM.BLKREC.BLKU# ;

   8567  1 001060   000007 236100                    LDQ     7,,PR0
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:527  
         1 001061   000022 772000                    QRL     18
         1 001062   200042 756100                    STQ     GLOM+1,,AUTO

     2848     8568    3                   HDR$->VDOVLP_MRK.BMRK.BLK# = GLOM.TEMP0+GLOM.TEMP0/256*256;

   8568  1 001063   000010 772000                    QRL     8
         1 001064   000010 736000                    QLS     8
         1 001065   200042 036100                    ADLQ    GLOM+1,,AUTO
         1 001066   200046 756100                    STQ     MSGSZ+2,,AUTO
         1 001067   000100 101500                    MRL     fill='000'O
         1 001070   200046 000004                    ADSC9   MSGSZ+2,,AUTO            cn=0,n=4
         1 001071   100001 000002                    ADSC9   1,,PR1                   cn=0,n=2

     2849     8569    3                   GLOM.TEMP0 = K$RWPARM.BLKREC.RECU# ;

   8569  1 001072   000007 236100                    LDQ     7,,PR0
         1 001073   777777 376007                    ANQ     -1,DL
         1 001074   200042 756100                    STQ     GLOM+1,,AUTO

     2850     8570    3                   HDR$->VDOVLP_MRK.BMRK.REC# = GLOM.TEMP0+GLOM.TEMP0/256*256;

   8570  1 001075   000010 772000                    QRL     8
         1 001076   000010 736000                    QLS     8
         1 001077   200042 036100                    ADLQ    GLOM+1,,AUTO
         1 001100   200046 756100                    STQ     MSGSZ+2,,AUTO
         1 001101   000100 101500                    MRL     fill='000'O
         1 001102   200046 000004                    ADSC9   MSGSZ+2,,AUTO            cn=0,n=4
         1 001103   100001 400002                    ADSC9   1,,PR1                   cn=2,n=2

     2851     8571    3                   HDR$->VDOVLP_MRK.BYTSIZ = SIZEC(K$RWPARM.BLKREC);

   8571  1 001104   000100 101400                    MRL     fill='000'O
         1 001105   000006 000004 xsym               ADSC9   B_VECTNIL+6              cn=0,n=4
         1 001106   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1

     2852     8572    3                   END;

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:528  
   8572  1 001107   001116 710000 1                  TRA     s:8577

     2853     8573    3                 ELSE DO;

     2854     8574    3                   HDR$->VDOVLP_MRK.ID = K$RWPARM.MARKER;

   8574  1 001110   000100 100500                    MLR     fill='000'O
         1 001111   000007 000004                    ADSC9   7,,PR0                   cn=0,n=4
         1 001112   100001 000004                    ADSC9   1,,PR1                   cn=0,n=4

     2855     8575    3                   HDR$->VDOVLP_MRK.BYTSIZ = SIZEC(HDR$->VDOVLP_MRK.ID);

   8575  1 001113   000100 101400                    MRL     fill='000'O
         1 001114   000006 000004 xsym               ADSC9   B_VECTNIL+6              cn=0,n=4
         1 001115   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1

     2856     8576    3                   END;

     2857     8577    2               LHDR$ = HDR$;

   8577  1 001116   200036 236100                    LDQ     HDR$,,AUTO
         1 001117   200037 756100                    STQ     LHDR$,,AUTO

     2858     8578    2               HDR$ = PINCRC(HDR$,SIZEC(KI_VDOVLP_MRK));

   8578  1 001120   000002 036003                    ADLQ    2,DU
         1 001121   200036 756100                    STQ     HDR$,,AUTO

     2859     8579    2               END;

     2860     8580        %EJECT;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:529  
     2861     8581    1           IF (FUNCTION = %KV_VDO_FNC_DAT OR FUNCTION = %KV_VDO_FNC_DAT_IMD

   8581  1 001122   200003 471500                    LDP1    @FUNCTION,,AUTO
         1 001123   100000 235100                    LDA     0,,PR1
         1 001124   000005 115007                    CMPA    5,DL
         1 001125   001132 600000 1                  TZE     s:8581+8
         1 001126   000006 115007                    CMPA    6,DL
         1 001127   001132 600000 1                  TZE     s:8581+8
         1 001130   000035 115007                    CMPA    29,DL
         1 001131   001223 601000 1                  TNZ     s:8619
         1 001132   000010 236100                    LDQ     8,,PR0
         1 001133   200000 316003                    CANQ    65536,DU
         1 001134   001223 601000 1                  TNZ     s:8619
         1 001135   020000 316003                    CANQ    8192,DU
         1 001136   001223 601000 1                  TNZ     s:8619
         1 001137   040000 316003                    CANQ    16384,DU
         1 001140   001223 601000 1                  TNZ     s:8619
         1 001141   000000 236100                    LDQ     0,,PR0
         1 001142   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001143   001223 600000 1                  TZE     s:8619

     2862     8582    1             OR FUNCTION = %KV_VDO_FNC_STT)
     2863     8583    1             AND NOT K$RWPARM.DVE.DVBYTE.BP AND NOT K$RWPARM.DVE.DVBYTE.TRANS
     2864     8584    1             AND NOT K$RWPARM.DVE.DVBYTE.BIN
     2865     8585    1             AND K$RWPARM.MSG$ ~= ADDR(NIL)
     2866     8586    2             THEN DO;

     2867     8587    2               IF MSGSZ = 0 THEN GOTO BPEND2;

   8587  1 001144   200044 235100                    LDA     MSGSZ,,AUTO
         1 001145   001220 600000 1                  TZE     BPEND2

     2868     8588    2               CALL HFF$TRAPALT ALTRET( BAD_BUFFER);

   8588  1 001146   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001147   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001150   001470 702000 1                  TSX2    BAD_BUFFER
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:530  

     2869     8589    2               IF MSGSZ > 7

   8589  1 001151   200044 235100                    LDA     MSGSZ,,AUTO
         1 001152   000010 115007                    CMPA    8,DL
         1 001153   001203 602000 1                  TNC     BPLOOPER

     2870     8590    3                 THEN DO;

     2871     8591        /*
     2872     8592                         This strange code is due to a problem with the
     2873     8593                         implementation of the TCTR instruction which faults
     2874     8594                         when accessing the first doubleword of a segment
     2875     8595                         which is not doubleword aligned. The TCTR instruction
     2876     8596                         is used for all of the data back to the first seven
     2877     8597                         bytes.  If a non-blank has not been found, the first
     2878     8598                         seven bytes are examined one byte at a time.
     2879     8599        */
     2880     8600    3                   GLOM.TEMP5 = MSGSZ - 7;

   8600  1 001154   000007 135007                    SBLA    7,DL
         1 001155   200043 755100                    STA     GLOM+2,,AUTO

     2881     8601    3                   CALL SEARCHR (MSGSZ , GLOM.TEMP5 , NK_BLNKSUPTBL ,

   8601  1 001156   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 001157   000000 471500                    LDP1    0,,PR0
         1 001160   200043 236100                    LDQ     GLOM+2,,AUTO
         1 001161   000000 620006                    EAX0    0,QL
         1 001162   000000 165540                    TCTR
         1 001163   100001 600010                    ADSC9   1,,PR1                   cn=3,n=*X0
         1 001164   000000 000000 xsym               ARG     NK_BLNKSUPTBL
         1 001165   200044 000100                    ARG     MSGSZ,,AUTO
         1 001166   200044 235100                    LDA     MSGSZ,,AUTO
         1 001167   000033 771000                    ARL     27
         1 001170   200043 755100                    STA     GLOM+2,,AUTO
         1 001171   200044 551140                    STBA    MSGSZ,'40'O,AUTO
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:531  
         1 001172   001201 606400 1                  TTN     BPALLBLANK
         1 001173   200044 054100                    AOS     MSGSZ,,AUTO
         1 001174   200044 156100                    SSQ     MSGSZ,,AUTO

     2882     8602    3                     PINCRC(K$RWPARM.MSG$,7)->CHRMSG) ALTRET(BPALLBLANK);
     2883     8603    3                   MSGSZ = MSGSZ + 8;

   8603  1 001175   200044 236100                    LDQ     MSGSZ,,AUTO
         1 001176   000010 036007                    ADLQ    8,DL
         1 001177   200044 756100                    STQ     MSGSZ,,AUTO

     2884     8604    3                   GOTO BPEND;

   8604  1 001200   001215 710000 1                  TRA     BPEND

     2885     8605    3   BPALLBLANK:     MSGSZ = 7;

   8605  1 001201   000007 235007       BPALLBLANK   LDA     7,DL
         1 001202   200044 755100                    STA     MSGSZ,,AUTO

     2886     8606    3                   END;

     2887     8607    2   BPLOOPER:   IF PINCRC (K$RWPARM.MSG$ , MSGSZ-1) -> B$CHAR = ' '

   8607  1 001203   200004 470500       BPLOOPER     LDP0    @K$RWPARM,,AUTO
         1 001204   000000 471500                    LDP1    0,,PR0
         1 001205   200044 235100                    LDA     MSGSZ,,AUTO
         1 001206   040000 106505                    CMPC    fill='040'O
         1 001207   177777 600001                    ADSC9   -1,A,PR1                 cn=3,n=1
         1 001210   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 001211   001215 601000 1                  TNZ     BPEND

     2888     8608    3                 THEN DO;

     2889     8609    3                   MSGSZ = MSGSZ - 1;

   8609  1 001212   000001 135007                    SBLA    1,DL
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:532  
         1 001213   200044 755100                    STA     MSGSZ,,AUTO

     2890     8610    3                   IF MSGSZ ~= 0 THEN GOTO BPLOOPER;

   8610  1 001214   001203 601000 1                  TNZ     BPLOOPER

     2891     8611    3                   END;

     2892     8612    2   BPEND:
     2893     8613    2               CALL HFF$TRAPALT;           /* Don't trap bad buffer anymore      */

   8613  1 001215   000002 631400 xsym  BPEND        EPPR1   B_VECTNIL+2
         1 001216   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001217   000000 011000                    NOP     0

     2894     8614    2   BPEND2:
     2895     8615    2               K$RWPARM.MSGSZ = MSGSZ;

   8615  1 001220   200044 235100       BPEND2       LDA     MSGSZ,,AUTO
         1 001221   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 001222   000001 755100                    STA     1,,PR0

     2896     8616    2               END;

     2897     8617        %EJECT;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:533  
     2898     8618
     2899     8619    1           IF MSGSZ > 0

   8619  1 001223   200044 235100                    LDA     MSGSZ,,AUTO
         1 001224   001315 600000 1                  TZE     s:8642

     2900     8620    2             THEN DO;

     2901     8621    2               LHDR$ = HDR$;

   8621  1 001225   200036 236100                    LDQ     HDR$,,AUTO
         1 001226   200037 756100                    STQ     LHDR$,,AUTO

     2902     8622    2               IF MSGSZ > 255

   8622  1 001227   000400 115007                    CMPA    256,DL
         1 001230   001251 602000 1                  TNC     s:8629

     2903     8623    3                 THEN DO;

     2904     8624    3                   HDR$->KV$VDOVLP_DAT2 = KI_VDOVLP_DAT2;

   8624  1 001231   200036 471500                    LDP1    HDR$,,AUTO
         1 001232   000100 100400                    MLR     fill='000'O
         1 001233   000000 000004 xsym               ADSC9   KI_VDOVLP_DAT2           cn=0,n=4
         1 001234   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4

     2905     8625    3                   HDR$->KV$VDOVLP_DAT2.BYTSIZ = MSGSZ+MSGSZ/256*256;

   8625  1 001235   200044 236100                    LDQ     MSGSZ,,AUTO
         1 001236   000010 772000                    QRL     8
         1 001237   000010 736000                    QLS     8
         1 001240   200044 036100                    ADLQ    MSGSZ,,AUTO
         1 001241   200046 756100                    STQ     MSGSZ+2,,AUTO
         1 001242   000100 101500                    MRL     fill='000'O
         1 001243   200046 000004                    ADSC9   MSGSZ+2,,AUTO            cn=0,n=4
         1 001244   100000 400002                    ADSC9   0,,PR1                   cn=2,n=2
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:534  

     2906     8626    3                   HDR$ = PINCRC (HDR$,SIZEC(KI_VDOVLP_DAT2));

   8626  1 001245   200036 236100                    LDQ     HDR$,,AUTO
         1 001246   000001 036003                    ADLQ    1,DU
         1 001247   200036 756100                    STQ     HDR$,,AUTO

     2907     8627    3                   END;

   8627  1 001250   001315 710000 1                  TRA     s:8642

     2908     8628    3                 ELSE DO;

     2909     8629    3                   HDR$->KV$VDOVLP_DAT1 = KI_VDOVLP_DAT1;

   8629  1 001251   200036 471500                    LDP1    HDR$,,AUTO
         1 001252   000100 100400                    MLR     fill='000'O
         1 001253   000000 000002 xsym               ADSC9   KI_VDOVLP_DAT1           cn=0,n=2
         1 001254   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

     2910     8630    3                   HDR$->KV$VDOVLP_DAT1.BYTSIZ = MSGSZ;

   8630  1 001255   000100 101500                    MRL     fill='000'O
         1 001256   200044 000004                    ADSC9   MSGSZ,,AUTO              cn=0,n=4
         1 001257   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1

     2911     8631    3                   HDR$ = PINCRC (HDR$,SIZEC(KI_VDOVLP_DAT1));

   8631  1 001260   400000 036007                    ADLQ    -131072,DL
         1 001261   200036 756100                    STQ     HDR$,,AUTO

     2912     8632    3                   IF K$RWPARM.CVTDAT AND MSGSZ=K$RWPARM.KEYSZ

   8632  1 001262   000010 236100                    LDQ     8,,PR0
         1 001263   100000 316007                    CANQ    32768,DL
         1 001264   001315 600000 1                  TZE     s:8642
         1 001265   000046 236100                    LDQ     38,,PR0
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:535  
         1 001266   000777 376007                    ANQ     511,DL
         1 001267   200044 116100                    CMPQ    MSGSZ,,AUTO
         1 001270   001315 601000 1                  TNZ     s:8642

     2913     8633    4                     THEN DO;

     2914     8634    4                       SUBSTR(ADDR(K$RWPARM.VLP$)->B$CHAR,0,MSGSZ)

   8634  1 001271   000000 471500                    LDP1    0,,PR0
         1 001272   200044 720100                    LXL0    MSGSZ,,AUTO
         1 001273   040140 100540                    MLR     fill='040'O
         1 001274   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 001275   000036 000010                    ADSC9   30,,PR0                  cn=0,n=*X0

     2915     8635    4                         = SUBSTR(K$RWPARM.MSG$->B$CHAR,0,MSGSZ);
     2916     8636    4                       K$RWPARM.MSG$ = ADDR(K$RWPARM.VLP$);

   8636  1 001276   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 001277   000036 036003                    ADLQ    30,DU
         1 001300   000000 756100                    STQ     0,,PR0

     2917     8637    4                       K$RWPARM.CVTDAT = '0'B;

   8637  1 001301   000007 236000 2                  LDQ     7
         1 001302   000010 356100                    ANSQ    8,,PR0

     2918     8638    4                       CALL KIA$9TO8 (K$RWPARM.VLP$, K$RWPARM.VLP$, MSGSZ);

   8638  1 001303   200044 631500                    EPPR1   MSGSZ,,AUTO
         1 001304   200050 451500                    STP1    MSGSZ+4,,AUTO
         1 001305   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 001306   000036 036003                    ADLQ    30,DU
         1 001307   200047 756100                    STQ     MSGSZ+3,,AUTO
         1 001310   200046 756100                    STQ     MSGSZ+2,,AUTO
         1 001311   200046 630500                    EPPR0   MSGSZ+2,,AUTO
         1 001312   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001313   000000 701000 xent               TSX1    KIA$9TO8
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:536  
         1 001314   000000 011000                    NOP     0

     2919     8639    4                       END;

     2920     8640    3                   END;

     2921     8641    2               END;

     2922     8642    1           IF LHDR$ ~= ADDR(HDR)           /* vlps                               */

   8642  1 001315   200037 236100                    LDQ     LHDR$,,AUTO
         1 001316   200005 116100                    CMPQ    @HDR,,AUTO
         1 001317   001330 600000 1                  TZE     s:8649

     2923     8643    2             THEN DO;

     2924     8644    2               ADDR(HDR)->KV$VDO.VLP = '1'B;

   8644  1 001320   200005 470500                    LDP0    @HDR,,AUTO
         1 001321   003100 060400                    CSL     bolr='003'O
         1 001322   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 001323   000000 210001                    BDSC    0,,PR0                   by=1,bit=1,n=1

     2925     8645    2               LHDR$->KV$VDOVLP.LST = '1'B;

   8645  1 001324   200037 471500                    LDP1    LHDR$,,AUTO
         1 001325   003100 060400                    CSL     bolr='003'O
         1 001326   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 001327   100000 010001                    BDSC    0,,PR1                   by=0,bit=1,n=1

     2926     8646    2               END;

     2927     8647
     2928     8648        /* If this is a PRM_SET then create the TL structure if needed */
     2929     8649    1           IF FUNCTION = %KV_VDO_FNC_PRM_SET

   8649  1 001330   200003 470500                    LDP0    @FUNCTION,,AUTO
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:537  
         1 001331   000000 235100                    LDA     0,,PR0
         1 001332   000023 115007                    CMPA    19,DL
         1 001333   001456 601000 1                  TNZ     s:8692

     2930     8650    2             THEN DO;

     2931     8651    2               IF K$RWPARM.PRMID ~= 0

   8651  1 001334   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 001335   100045 720100                    LXL0    37,,PR1
         1 001336   001437 600000 1                  TZE     s:8683

     2932     8652    3                 THEN DO;

     2933     8653    3                   TL.PRMID = K$RWPARM.PRMID;

   8653  1 001337   200036 473500                    LDP3    HDR$,,AUTO
         1 001340   000100 101500                    MRL     fill='000'O
         1 001341   100045 400002                    ADSC9   37,,PR1                  cn=2,n=2
         1 001342   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

     2934     8654    3                   IF K$RWPARM.PRMID = %KV_PRMID_EDTBFR OR K$RWPARM.PRMID = %
              8654                            KV_PRMID_REREADCLM

   8654  1 001343   100045 720100                    LXL0    37,,PR1
         1 001344   000203 100003                    CMPX0   131,DU
         1 001345   001350 600000 1                  TZE     s:8656
         1 001346   000212 100003                    CMPX0   138,DU
         1 001347   001354 601000 1                  TNZ     s:8659

     2935     8655    4                     THEN DO;

     2936     8656    4                       VDOSZ = 0;          /* Flag to remember by                */

   8656  1 001350   200040 450100                    STZ     VDOSZ,,AUTO

     2937     8657    4                       TL.PRMID = %KV_PRMID_SINPUT;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:538  

   8657  1 001351   000100 101400                    MRL     fill='000'O
         1 001352   000015 000004 xsym               ADSC9   B_VECTNIL+13             cn=0,n=4
         1 001353   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

     2938     8658    4                       END;

     2939     8659    3                   MSGSZ = MSGSZ-2;

   8659  1 001354   200044 235100                    LDA     MSGSZ,,AUTO
         1 001355   000002 135007                    SBLA    2,DL
         1 001356   200044 755100                    STA     MSGSZ,,AUTO

     2940     8660    3                   IF MSGSZ < 256

   8660  1 001357   000400 115007                    CMPA    256,DL
         1 001360   001370 603000 1                  TRC     s:8666

     2941     8661    4                     THEN DO;

     2942     8662    4                       TL.LENGTH = MSGSZ;

   8662  1 001361   000100 101500                    MRL     fill='000'O
         1 001362   200044 000004                    ADSC9   MSGSZ,,AUTO              cn=0,n=4
         1 001363   300000 200001                    ADSC9   0,,PR3                   cn=1,n=1

     2943     8663    4                       HDR$ = PINCRC(HDR$,LENGTHC(TL));

   8663  1 001364   200036 236100                    LDQ     HDR$,,AUTO
         1 001365   400000 036007                    ADLQ    -131072,DL
         1 001366   200036 756100                    STQ     HDR$,,AUTO

     2944     8664    4                       END;

   8664  1 001367   001417 710000 1                  TRA     s:8673

     2945     8665    4                     ELSE DO;
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:539  

     2946     8666    4                       MSGSZ = MSGSZ-2;

   8666  1 001370   000002 135007                    SBLA    2,DL
         1 001371   200044 755100                    STA     MSGSZ,,AUTO

     2947     8667    4                       TL.LENGTH = TL.PRMID;

   8667  1 001372   000100 100500                    MLR     fill='000'O
         1 001373   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 001374   300000 200001                    ADSC9   0,,PR3                   cn=1,n=1

     2948     8668    4                       TL.PRMID = %KV_PRMID_BIGTL;

   8668  1 001375   000100 101400                    MRL     fill='000'O
         1 001376   000010 000004 2                  ADSC9   8                        cn=0,n=4
         1 001377   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

     2949     8669    4                       PINCRC(HDR$,LENGTHC(TL))->TL.PRMID = MSGSZ/256;

   8669  1 001400   200044 236100                    LDQ     MSGSZ,,AUTO
         1 001401   000010 772000                    QRL     8
         1 001402   200046 756100                    STQ     MSGSZ+2,,AUTO
         1 001403   000100 101500                    MRL     fill='000'O
         1 001404   200046 000004                    ADSC9   MSGSZ+2,,AUTO            cn=0,n=4
         1 001405   300000 400001                    ADSC9   0,,PR3                   cn=2,n=1

     2950     8670    4                       PINCRC(HDR$,LENGTHC(TL))->TL.LENGTH = MOD(MSGSZ,256);

   8670  1 001406   200044 236100                    LDQ     MSGSZ,,AUTO
         1 001407   000377 376007                    ANQ     255,DL
         1 001410   200046 756100                    STQ     MSGSZ+2,,AUTO
         1 001411   000100 101500                    MRL     fill='000'O
         1 001412   200046 000004                    ADSC9   MSGSZ+2,,AUTO            cn=0,n=4
         1 001413   300000 600001                    ADSC9   0,,PR3                   cn=3,n=1

     2951     8671    4                       HDR$ = PINCRC(HDR$,LENGTHC(TL)*2);
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:540  

   8671  1 001414   200036 236100                    LDQ     HDR$,,AUTO
         1 001415   000001 036003                    ADLQ    1,DU
         1 001416   200036 756100                    STQ     HDR$,,AUTO

     2952     8672    4                       END;

     2953     8673    3                   IF VDOSZ = 0

   8673  1 001417   200040 235100                    LDA     VDOSZ,,AUTO
         1 001420   001437 601000 1                  TNZ     s:8683

     2954     8674    4                     THEN DO;

     2955     8675    4                       SIN.STR = K$RWPARM.STR;

   8675  1 001421   200036 473500                    LDP3    HDR$,,AUTO
         1 001422   000100 100500                    MLR     fill='000'O
         1 001423   100040 600001                    ADSC9   32,,PR1                  cn=3,n=1
         1 001424   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

     2956     8676    4                       SIN.FIL = '0'B;

   8676  1 001425   000100 100400                    MLR     fill='000'O
         1 001426   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 001427   300000 200003                    ADSC9   0,,PR3                   cn=1,n=3

     2957     8677    4                       HDR$ = PINCRC(HDR$,LENGTHV(SIN));

   8677  1 001430   600000 036007                    ADLQ    -65536,DL
         1 001431   200036 756100                    STQ     HDR$,,AUTO

     2958     8678    4                       IF K$RWPARM.PRMID = %KV_PRMID_EDTBFR

   8678  1 001432   100045 720100                    LXL0    37,,PR1
         1 001433   000203 100003                    CMPX0   131,DU
         1 001434   001437 601000 1                  TNZ     s:8683
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:541  

     2959     8679    4                         THEN
     2960     8680    4                           HDR$ = PINCRC(HDR$,1);

   8680  1 001435   200000 036007                    ADLQ    65536,DL
         1 001436   200036 756100                    STQ     HDR$,,AUTO

     2961     8681    4                       END;

     2962     8682    3                   END;

     2963     8683    2               IF K$RWPARM.V$~=ADDR(NIL)

   8683  1 001437   100043 236100                    LDQ     35,,PR1
         1 001440   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001441   001456 600000 1                  TZE     s:8692

     2964     8684    3                 THEN DO;

     2965     8685    3                   SUBSTR(HDR$->B$CHAR,0,K$RWPARM.VSZ) =

   8685  1 001442   100045 220100                    LDX0    37,,PR1
         1 001443   100043 473500                    LDP3    35,,PR1
         1 001444   100045 221100                    LDX1    37,,PR1
         1 001445   200036 474500                    LDP4    HDR$,,AUTO
         1 001446   040140 100540                    MLR     fill='040'O
         1 001447   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1
         1 001450   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0

     2966     8686    3                     SUBSTR(K$RWPARM.V$->B$CHAR,0,K$RWPARM.VSZ);
     2967     8687    3                   HDR$ = PINCRC(HDR$,K$RWPARM.VSZ);

   8687  1 001451   100045 236100                    LDQ     37,,PR1
         1 001452   000022 772000                    QRL     18
         1 001453   000020 736000                    QLS     16
         1 001454   200036 036100                    ADLQ    HDR$,,AUTO
         1 001455   200036 756100                    STQ     HDR$,,AUTO
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:542  

     2968     8688    3                   END;

     2969     8689
     2970     8690    2               END;

     2971     8691
     2972     8692    1           K$RWPARM.UHDR$ = ADDR(HDR);

   8692  1 001456   200005 236100                    LDQ     @HDR,,AUTO
         1 001457   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 001460   100014 756100                    STQ     12,,PR1

     2973     8693    1           K$RWPARM.UHDRSZ = POFFC(HDR$,ADDR(HDR));

   8693  1 001461   000020 772000                    QRL     16
         1 001462   200046 756100                    STQ     MSGSZ+2,,AUTO
         1 001463   200036 236100                    LDQ     HDR$,,AUTO
         1 001464   000020 772000                    QRL     16
         1 001465   200046 136100                    SBLQ    MSGSZ+2,,AUTO
         1 001466   100015 756100                    STQ     13,,PR1

     2974     8694    1           RETURN;

   8694  1 001467   000000 702200 xent               TSX2  ! X66_ARET

     2975     8695    1   BAD_BUFFER:
     2976     8696    1           CALL HFF$TRAPALT;               /* Don't trap bad buffer anymore      */

   8696  1 001470   000002 631400 xsym  BAD_BUFFER   EPPR1   B_VECTNIL+2
         1 001471   000000 701000 xent               TSX1    HFF$TRAPALT
         1 001472   000000 011000                    NOP     0

     2977     8697    1           K$RWPARM.ERR = %K$BAD_BUFFER;

   8697  1 001473   000002 235007                    LDA     2,DL
         1 001474   200004 470500                    LDP0    @K$RWPARM,,AUTO
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:543  
         1 001475   000013 755100                    STA     11,,PR0

     2978     8698    1           ALTRETURN;

   8698  1 001476   000000 702200 xent               TSX2  ! X66_AALT

TRAN_PRMID
 Sect OctLoc
   0     000   000026 000025   000000 203212   024000 000000   000000 000000    ................

(unnamed)
 Sect OctLoc
   2     000   777777 763777   777777 774777   747777 777777   000077 600000    .............?..
   2     004   040040 040040   040040 040040   000001 400000   777777 677777            ........
   2     010   000000 000377                                                    ....
     2979     8699
     2980     8700    1   END KIA$VDO;
     2981     8701        %EOD;

PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:544  
--  Include file information  --

   K_CP6_M.:E05TOU  is referenced.
   UM_CP6.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   NK_VFC_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$VDO.
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:545  

 **** Variables and constants ****

  ****  Section 000 RoData KIA$VDO

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b UBIN(9)     r     1 TRAN_PRMID(0:15)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FUNCTION                  5-0-0/w PTR         r     1 @HDR
     4-0-0/w PTR         r     1 @K$RWPARM                 *0-0-0/w UBIN        r     1 FUNCTION
    41-0-0/w STRC(108)   r     1 GLOM                      *0-0-0/c CHAR(100)   r     1 HDR
    36-0-0/w PTR         r     1 HDR$                      *0-0-0/d STRC(1404)  r     1 K$RWPARM
    37-0-0/w PTR         r     1 LHDR$                     44-0-0/w UBIN        r     1 MSGSZ
    37-0-0/w UBIN        r     1 TEMP1                     40-0-0/w UBIN        r     1 VDOSZ

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KI_FEI$$
     0-0-0/c UBIN(9)     r     1 KI_VDOBYTSIZ(0:34)
     0-0-0/h STRC(108)   r     1 KI_VDOVLP_CG_MSGID         0-0-0/h STRC(108)   r     1 KI_VDOVLP_CG_MSGTYP
     0-0-0/h STRC(108)   r     1 KI_VDOVLP_CG_STA           0-0-0/h STRC(18)    r     1 KI_VDOVLP_DAT1
     0-0-0/h STRC        r     1 KI_VDOVLP_DAT2             0-0-0/h STRC(54)    r     1 KI_VDOVLP_ERR
     0-0-0/h STRC        r     1 KI_VDOVLP_FLDID            0-0-0/h STRC(18)    r     1 KI_VDOVLP_KEY
     0-0-0/h STRC(72)    r     1 KI_VDOVLP_MRK              0-0-0/d CHAR(512)   r     1 NK_BLNKSUPTBL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:546  
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR        r     1 B$CHAR                     0-0-0/c CHAR(2)     r     1 B$FLDID
     0-0-0/b BIT (2)     r     1 BIT2BSD                    0-0-0/b BIT         r     1 BT36
     0-0-0/c CHAR(12)    r     1 CHR12BSD                   0-0-0/c CHAR(4)     r     1 CHR4BSD
     0-0-0/c ACHR        r     1 CHRMSG                     0-0-0/c STRC        r     1 DEST
     0-0-0/d STRC(144)   r     1 FPT$DCLFLD_V               0-0-0/d STRC(72)    r     1 FPT$ERASE_V
     0-0-0/d STRC(144)   r     1 FPT$TRMPRG_V               0-0-0/c ACHR        r     1 KEY
     0-0-0/h STRC(18)    r     1 KV$VDO                     0-0-0/h STRC(18)    r     1 KV$VDOVLP
     0-0-0/h STRC(108)   r     1 KV$VDOVLP_CG_MSGID         0-0-0/h STRC(108)   r     1 KV$VDOVLP_CG_MSGTYP
     0-0-0/h STRC(108)   r     1 KV$VDOVLP_CG_STA           0-0-0/h STRC(18)    r     1 KV$VDOVLP_DAT1
     0-0-0/h STRC        r     1 KV$VDOVLP_DAT2             0-0-0/h STRC(54)    r     1 KV$VDOVLP_ERR
     0-0-0/h STRC        r     1 KV$VDOVLP_FLDID            0-0-0/h STRC(18)    r     1 KV$VDOVLP_KEY
     0-0-0/h STRC(108)   r     1 KV$VDO_DCLFLD              0-0-0/h STRC        r     1 KV$VDO_SLCGRPRND
     0-0-0/c STRC(9)     r     1 NK$VFC                     0-0-0/c STRC        r     1 SIN
     0-0-0/b STRC(32)    r     1 SOURCE                     0-0-0/c STRC(18)    r     1 TL
     0-0-0/c ASTR(0)     r     1 VDO                        0-0-0/h STRC(72)    r     1 VDOVLP_MRK
     0-0-0/d STRC(72)    r     1 VLP$FLDATR                 0-0-0/w STRC(54)    r     1 WABLKDAT
     0-0-0/w STRC        r     1 WACLSSTR                   0-0-0/w STRC        r     1 WADAT
     0-0-0/w STRC(108)   r     1 WADCLFLD                   0-0-0/w STRC        r     1 WADCLSTR
     0-0-0/w STRC        r     1 WADLT                      0-0-0/w STRC        r     1 WAERS
     0-0-0/w STRC(54)    r     1 WAOPNSTR                   0-0-0/w STRC(90)    r     1 WARQSDAT
     0-0-0/w STRC(54)    r     1 WARQSPRM                   0-0-0/w STRC        r     1 WASLCGRPRND
     0-0-0/w STRC        r     1 WASLCQLF                   0-0-0/w STRC(18)    r     1 WAVDO


   Procedure KIA$VDO requires 831 words for executable code.
   Procedure KIA$VDO requires 42 words of local(AUTO) storage.
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:547  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:548  
          MINI XREF LISTING

B$CHAR
      7040**DCL      8607>>IF       8634<<ASSIGN   8634>>ASSIGN   8685<<ASSIGN   8685>>ASSIGN
B$FLDID
      6921**DCL      8554>>ASSIGN
BAD_BUFFER
      8696**LABEL    8588--CALLALT
BIT2BSD
      7690**DCL      8377<<ASSIGN   8377>>ASSIGN   8411<<ASSIGN   8411>>ASSIGN
BPALLBLANK
      8605**LABEL    8601--CALLALT
BPEND
      8613**LABEL    8604--GOTO
BPEND2
      8615**LABEL    8587--GOTO
BPLOOPER
      8607**LABEL    8610--GOTO
BT36
      7693**DCL      8479>>ASSIGN
CHR12BSD
      7692**DCL      8485<<ASSIGN   8485>>ASSIGN
CHR4BSD
      7694**DCL      8493<<ASSIGN   8493>>ASSIGN   8499<<ASSIGN   8499>>ASSIGN
CHRMSG
      7706**DCL      8601>>CALLBLT
DEST.BY1
      7701**DCL      8531<<ASSIGN
DEST.BY2
      7702**DCL      8533<<ASSIGN
DEST.BY3
      7703**DCL      8535<<ASSIGN
DEST.BY4
      7704**DCL      8537<<ASSIGN
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:549  
EMR$HOST2FEP
      8321**DCL-ENT  8507--CALL
FPT$DCLFLD_V.CLM
      6941**DCL      8382>>ASSIGN
FPT$DCLFLD_V.ID
      6941**DCL      8384>>ASSIGN
FPT$DCLFLD_V.LIN
      6940**DCL      8381>>ASSIGN
FPT$DCLFLD_V.WDT
      6941**DCL      8383>>ASSIGN
FPT$ERASE_V.PRT
      6957**DCL      8411--ASSIGN
FPT$TRMPRG_V.CTLFLG
      6984**DCL      8408>>ASSIGN
FPT$TRMPRG_V.CTLFLG.RSTBRK
      6985**DCL      6985--REDEF
FUNCTION
      4328**DCL         6--PROC     8349>>IF       8354>>ASSIGN   8356>>ASSIGN   8369>>DOCASE   8561>>IF
      8581>>IF       8581>>IF       8581>>IF       8649>>IF
GLOM
      7015**DCL      8485--ASSIGN
GLOM.ERR
      7021**DCL      7022--REDEF    7023--REDEF    7024--REDEF    7030--REDEF    8507<>CALL     8509>>ASSIGN
GLOM.FLDID
      7016**DCL      7020--REDEF    8479<<ASSIGN
GLOM.FLDID.ID
      7018**DCL      7019--REDEF    8555>>ASSIGN   8555>>ASSIGN
GLOM.FLDID.IDC
      7019**DCL      8554<<ASSIGN
GLOM.OP$
      7035**DCL      7036--REDEF    7037--REDEF    7038--REDEF    7040--IMP-PTR
GLOM.OP6$
      7020**DCL      7695--IMP-PTR  8529<<ASSIGN   8531>>ASSIGN   8533>>ASSIGN   8535>>ASSIGN   8537>>ASSIGN
GLOM.TEMP0
      7022**DCL      8372<<ASSIGN   8373>>ASSIGN   8373>>ASSIGN   8450<<ASSIGN   8451>>ASSIGN   8451>>ASSIGN
      8452<<ASSIGN   8453>>ASSIGN   8453>>ASSIGN   8457<<ASSIGN   8458>>ASSIGN   8458>>ASSIGN   8478<<ASSIGN
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:550  
      8522<<ASSIGN   8524>>IF       8529>>ASSIGN   8532>>IF       8534>>IF       8536>>IF       8567<<ASSIGN
      8568>>ASSIGN   8568>>ASSIGN   8569<<ASSIGN   8570>>ASSIGN   8570>>ASSIGN
GLOM.TEMP2.B1
      7026**DCL      8481>>ASSIGN
GLOM.TEMP2.B2
      7027**DCL      8482>>ASSIGN
GLOM.TEMP2.B3
      7028**DCL      8483>>ASSIGN
GLOM.TEMP2.B4
      7029**DCL      8484>>ASSIGN
GLOM.TEMP3.BY1
      7031**DCL      8481<<ASSIGN
GLOM.TEMP3.BY2
      7032**DCL      8482<<ASSIGN
GLOM.TEMP3.BY3
      7033**DCL      8483<<ASSIGN
GLOM.TEMP3.BY4
      7034**DCL      8484<<ASSIGN
GLOM.TEMP4
      7038**DCL      8480<<ASSIGN
GLOM.TEMP5
      7036**DCL      7706--IMP-SIZ  8600<<ASSIGN   8601<<CALLBLT  8601>>CALLBLT
HDR
      4691**DCL         6--PROC     8348--ASSIGN   8642--IF       8644--ASSIGN   8692--ASSIGN   8693--ASSIGN
HDR$
      7005**DCL      4695--IMP-PTR  4698--IMP-PTR  7006--REDEF    7574--IMP-PTR  7602--IMP-PTR  7646--IMP-PTR
      7700--IMP-PTR  7707--IMP-PTR  7753--IMP-PTR  7880--IMP-PTR  7924--IMP-PTR  7970--IMP-PTR  8014--IMP-PTR
      8058--IMP-PTR  8107--IMP-PTR  8151--IMP-PTR  8234--IMP-PTR  8348<<ASSIGN   8355>>ASSIGN   8356>>ASSIGN
      8358>>ASSIGN   8373>>ASSIGN   8374>>ASSIGN   8377>>ASSIGN   8381>>ASSIGN   8382>>ASSIGN   8383>>ASSIGN
      8385>>ASSIGN   8388>>ASSIGN   8389>>ASSIGN   8392>>ASSIGN   8393>>ASSIGN   8396>>ASSIGN   8397>>ASSIGN
      8400>>ASSIGN   8401>>ASSIGN   8402>>ASSIGN   8405>>ASSIGN   8408>>ASSIGN   8411>>ASSIGN   8415>>ASSIGN
      8416>>ASSIGN   8417>>ASSIGN   8418>>ASSIGN   8441>>ASSIGN   8442>>ASSIGN   8443>>ASSIGN   8444>>ASSIGN
      8445>>ASSIGN   8448>>ASSIGN   8449>>ASSIGN   8451>>ASSIGN   8453>>ASSIGN   8456>>ASSIGN   8458>>ASSIGN
      8463>>ASSIGN   8464>>ASSIGN   8467>>ASSIGN   8470>>ASSIGN   8474>>ASSIGN   8475<<ASSIGN   8475>>ASSIGN
      8485>>ASSIGN   8487>>ASSIGN   8488<<ASSIGN   8488>>ASSIGN   8493>>ASSIGN   8494>>ASSIGN   8495>>ASSIGN
      8496<<ASSIGN   8496>>ASSIGN   8499>>ASSIGN   8500>>ASSIGN   8501>>ASSIGN   8502<<ASSIGN   8502>>ASSIGN
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:551  
      8508>>ASSIGN   8509>>ASSIGN   8510>>ASSIGN   8511<<ASSIGN   8511>>ASSIGN   8518>>ASSIGN   8519>>ASSIGN
      8520>>ASSIGN   8521<<ASSIGN   8521>>ASSIGN   8523>>ASSIGN   8529>>ASSIGN   8531>>ASSIGN   8533>>ASSIGN
      8535>>ASSIGN   8537>>ASSIGN   8546<<ASSIGN   8546>>ASSIGN   8551>>ASSIGN   8552>>ASSIGN   8553>>ASSIGN
      8555>>ASSIGN   8556<<ASSIGN   8556>>ASSIGN   8560>>ASSIGN   8563>>ASSIGN   8564>>ASSIGN   8568>>ASSIGN
      8570>>ASSIGN   8571>>ASSIGN   8574>>ASSIGN   8575>>ASSIGN   8575>>ASSIGN   8577>>ASSIGN   8578<<ASSIGN
      8578>>ASSIGN   8621>>ASSIGN   8624>>ASSIGN   8625>>ASSIGN   8626<<ASSIGN   8626>>ASSIGN   8629>>ASSIGN
      8630>>ASSIGN   8631<<ASSIGN   8631>>ASSIGN   8653>>ASSIGN   8657>>ASSIGN   8662>>ASSIGN   8663<<ASSIGN
      8663>>ASSIGN   8667>>ASSIGN   8667>>ASSIGN   8668>>ASSIGN   8669>>ASSIGN   8670>>ASSIGN   8671<<ASSIGN
      8671>>ASSIGN   8675>>ASSIGN   8676>>ASSIGN   8677<<ASSIGN   8677>>ASSIGN   8680<<ASSIGN   8680>>ASSIGN
      8685>>ASSIGN   8687<<ASSIGN   8687>>ASSIGN   8693>>ASSIGN
HFF$TRAPALT
      8322**DCL-ENT  8588--CALL     8613--CALL     8696--CALL
K$RWPARM
      4396**DCL         6--PROC
K$RWPARM.BLKREC
      4422**DCL      4447--REDEF    8571--ASSIGN
K$RWPARM.BLKREC.BLKU#
      4423**DCL      4425--REDEF    8567>>ASSIGN
K$RWPARM.BLKREC.RECU#
      4435**DCL      4437--REDEF    8569>>ASSIGN
K$RWPARM.CVTDAT
      4488**DCL      8540<<ASSIGN   8632>>IF       8637<<ASSIGN
K$RWPARM.DVE.DVBYTE.BIN
      4464**DCL      8363>>IF       8581>>IF
K$RWPARM.DVE.DVBYTE.BP
      4461**DCL      8445>>ASSIGN   8581>>IF
K$RWPARM.DVE.DVBYTE.DCBHDR
      4468**DCL      8402>>ASSIGN
K$RWPARM.DVE.DVBYTE.NODAT
      4467**DCL      8444>>ASSIGN
K$RWPARM.DVE.DVBYTE.REREAD
      4463**DCL      8443>>ASSIGN
K$RWPARM.DVE.DVBYTE.TRANS
      4465**DCL      8403>>IF       8446>>IF       8581>>IF
K$RWPARM.DVE.DVBYTE.VFC
      4462**DCL      4463--REDEF    8424>>IF
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:552  
K$RWPARM.DVE.EOMCHAR
      4470**DCL      4474--REDEF
K$RWPARM.DVE.VFC
      4474**DCL      8401>>ASSIGN   8424--IF       8427--ASSIGN
K$RWPARM.ERR
      4534**DCL      4539--REDEF    8697<<ASSIGN
K$RWPARM.FC
      4498**DCL      4499--REDEF
K$RWPARM.FLDID
      4680**DCL      4681--REDEF
K$RWPARM.FPT$
      4561**DCL      4568--REDEF
K$RWPARM.KEY$
      4678**DCL      8513>>IF       8523>>ASSIGN   8554>>ASSIGN
K$RWPARM.KEYSZ
      4689**DCL      6922--IMP-SIZ  8417>>ASSIGN   8513>>IF       8517>>IF       8519>>ASSIGN   8522>>ASSIGN
      8523>>ASSIGN   8523>>ASSIGN   8546>>ASSIGN   8549>>IF       8632>>IF
K$RWPARM.KEYTYPE
      4687**DCL      4688--REDEF    8515>>IF       8524>>IF       8524>>IF       8524>>IF       8541>>IF
K$RWPARM.MARKER
      4447**DCL      8574>>ASSIGN
K$RWPARM.MAXNMBBYT
      4675**DCL      8450>>ASSIGN
K$RWPARM.MAXNMBRCR
      4674**DCL      8449>>ASSIGN
K$RWPARM.MAXRCRBYTSIZ
      4676**DCL      8372>>ASSIGN   8452>>ASSIGN   8457>>ASSIGN
K$RWPARM.MRKTYP
      4672**DCL      8558>>IF       8564>>ASSIGN   8565>>IF
K$RWPARM.MSG$
      4397**DCL      4403--REDEF    8359>>IF       8581>>IF       8601>>CALLBLT  8607>>IF       8634>>ASSIGN
      8636<<ASSIGN
K$RWPARM.MSGID
      4509**DCL      4514--REDEF    8476>>IF       8478>>ASSIGN
K$RWPARM.MSGIDXT
      4522**DCL      4526--REDEF    8480>>ASSIGN
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:553  
K$RWPARM.MSGSZ
      4404**DCL      8365<<ASSIGN   8365>>ASSIGN   8366>>ASSIGN   8615<<ASSIGN
K$RWPARM.MSGTYP
      4413**DCL      8491>>IF       8494>>ASSIGN
K$RWPARM.MSG_ERRCODE
      4657**DCL      8505>>IF       8507<>CALL
K$RWPARM.NRECS
      4688**DCL      8416>>ASSIGN
K$RWPARM.ORG
      4658**DCL      4659--REDEF    8415>>ASSIGN
K$RWPARM.PRMID
      4681**DCL      8424>>IF       8427<<ASSIGN   8428>>IF       8430>>IF       8433>>IF       8456>>ASSIGN
      8651>>IF       8653>>ASSIGN   8654>>IF       8654>>IF       8678>>IF
K$RWPARM.RSN
      4499**DCL      8374>>ASSIGN
K$RWPARM.SPARE
      4671**DCL      8418>>ASSIGN
K$RWPARM.STATION
      4408**DCL      8497>>IF       8500>>ASSIGN
K$RWPARM.STR
      4673**DCL      8358>>ASSIGN   8675>>ASSIGN
K$RWPARM.STRID
      4659**DCL      8396>>ASSIGN
K$RWPARM.THDRSZ
      4602**DCL      4606--REDEF
K$RWPARM.UHDR$
      4547**DCL      8692<<ASSIGN
K$RWPARM.UHDRSZ
      4552**DCL      4694--IMP-SIZ  8693<<ASSIGN
K$RWPARM.V$
      4677**DCL      6932--IMP-PTR  6952--IMP-PTR  6968--IMP-PTR  6984--IMP-PTR  8380>>ASSIGN   8408>>ASSIGN
      8411>>ASSIGN   8421>>IF       8683>>IF       8685>>ASSIGN
K$RWPARM.VDOFLGS
      4660**DCL      4671--REDEF
K$RWPARM.VDOFLGS.DLTSTR
      4664**DCL      8377--ASSIGN
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:554  
K$RWPARM.VDOFLGS.INCNMBRCR
      4669**DCL      8442>>ASSIGN
K$RWPARM.VDOFLGS.REDSTR
      4666**DCL      8397>>ASSIGN
K$RWPARM.VDOFLGS.WAIT
      4667**DCL      8441>>ASSIGN
K$RWPARM.VLP$
      4652**DCL      7000--IMP-PTR  8386>>IF       8388>>ASSIGN   8392>>ASSIGN   8393>>ASSIGN   8461>>IF
      8463>>ASSIGN   8467>>ASSIGN   8470>>ASSIGN   8634--ASSIGN   8636--ASSIGN   8638<>CALL     8638<>CALL
K$RWPARM.VSZ
      4679**DCL      8423>>ASSIGN   8685>>ASSIGN   8685>>ASSIGN   8687>>ASSIGN
KEY
      6922**DCL      8523<<ASSIGN   8523>>ASSIGN
KIA$9TO8
      8320**DCL-ENT  8638--CALL
KI_FEI$$
      2757**DCL      2758--IMP-PTR
KI_VDOBYTSIZ
      7567**DCL      8354>>ASSIGN
KI_VDOVLP_CG_MSGID
      7084**DCL      8479--ASSIGN   8488--ASSIGN
KI_VDOVLP_CG_MSGTYP
      7136**DCL      8493--ASSIGN   8496--ASSIGN
KI_VDOVLP_CG_STA
      7188**DCL      8499--ASSIGN   8502--ASSIGN
KI_VDOVLP_DAT1
      7239**DCL      8629>>ASSIGN   8631--ASSIGN
KI_VDOVLP_DAT2
      7289**DCL      8624>>ASSIGN   8626--ASSIGN
KI_VDOVLP_ERR
      7339**DCL      8508>>ASSIGN   8511--ASSIGN
KI_VDOVLP_FLDID
      7435**DCL      8551>>ASSIGN   8556--ASSIGN
KI_VDOVLP_KEY
      7486**DCL      8518>>ASSIGN   8521--ASSIGN
KI_VDOVLP_MRK
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:555  
      7536**DCL      8560>>ASSIGN   8578--ASSIGN
KV$VDO.VLP
      4826**DCL      8644<<ASSIGN
KV$VDOVLP.LST
      6235**DCL      8645<<ASSIGN
KV$VDOVLP_CG_MSGID
      6333**DCL      8485--ASSIGN
KV$VDOVLP_CG_MSGTYP
      6386**DCL      8493--ASSIGN
KV$VDOVLP_CG_MSGTYP.CG_MSGTYP
      6400**DCL      8494<<ASSIGN
KV$VDOVLP_CG_STA
      6439**DCL      8499--ASSIGN
KV$VDOVLP_CG_STA.CG_STA
      6453**DCL      8500<<ASSIGN
KV$VDOVLP_DAT1
      6491**DCL      8629<<ASSIGN
KV$VDOVLP_DAT1.BYTSIZ
      6497**DCL      8630<<ASSIGN
KV$VDOVLP_DAT2
      6542**DCL      8624<<ASSIGN
KV$VDOVLP_DAT2.BYTSIZ
      6550**DCL      8625<<ASSIGN
KV$VDOVLP_ERR
      6644**DCL      8508<<ASSIGN
KV$VDOVLP_ERR.ERRCODE
      6673**DCL      8509<<ASSIGN
KV$VDOVLP_FLDID
      6741**DCL      8551<<ASSIGN
KV$VDOVLP_FLDID.BYTSIZ
      6747**DCL      8552<<ASSIGN
KV$VDOVLP_FLDID.FLDID
      6755**DCL      8555<<ASSIGN
KV$VDOVLP_KEY
      6793**DCL      8518<<ASSIGN
KV$VDOVLP_KEY.BYTSIZ
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:556  
      6799**DCL      8519<<ASSIGN
KV$VDOVLP_KEY.TYP
      6797**DCL      8543<<ASSIGN
KV$VDO_DCLFLD.GRPRND
      5109**DCL      8388--ASSIGN
KV$VDO_SLCGRPRND.GRPRND
      5971**DCL      8463--ASSIGN
K_RWPARM_CON.BLKREC
      2443**DCL      2468--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      2444**DCL      2446--REDEF
K_RWPARM_CON.BLKREC.RECU#
      2456**DCL      2458--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      2483**DCL      2484--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      2491**DCL      2495--REDEF
K_RWPARM_CON.ERR
      2555**DCL      2560--REDEF
K_RWPARM_CON.FC
      2519**DCL      2520--REDEF
K_RWPARM_CON.FLDID
      2701**DCL      2702--REDEF
K_RWPARM_CON.FPT$
      2582**DCL      2589--REDEF
K_RWPARM_CON.KEYTYPE
      2708**DCL      2709--REDEF
K_RWPARM_CON.MSG$
      2418**DCL      2424--REDEF
K_RWPARM_CON.MSGID
      2530**DCL      2535--REDEF
K_RWPARM_CON.MSGIDXT
      2543**DCL      2547--REDEF
K_RWPARM_CON.ORG
      2679**DCL      2680--REDEF
K_RWPARM_CON.THDRSZ
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:557  
      2623**DCL      2627--REDEF
K_RWPARM_CON.VDOFLGS
      2681**DCL      2692--REDEF
LHDR$
      7011**DCL      7012--REDEF    7013--REDEF    8380<<ASSIGN   8381>>ASSIGN   8382>>ASSIGN   8383>>ASSIGN
      8384>>ASSIGN   8474<<ASSIGN   8487<<ASSIGN   8495<<ASSIGN   8501<<ASSIGN   8510<<ASSIGN   8520<<ASSIGN
      8543>>ASSIGN   8553<<ASSIGN   8577<<ASSIGN   8621<<ASSIGN   8642>>IF       8645>>ASSIGN
MSGSZ
      7039**DCL      8361<<ASSIGN   8366<<ASSIGN   8423<<ASSIGN   8423>>ASSIGN   8432<<ASSIGN   8432>>ASSIGN
      8435<<ASSIGN   8435>>ASSIGN   8436>>IF       8436<<ASSIGN   8436>>ASSIGN   8437<<ASSIGN   8437>>ASSIGN
      8587>>IF       8589>>IF       8600>>ASSIGN   8601<<CALLBLT  8603<<ASSIGN   8603>>ASSIGN   8605<<ASSIGN
      8607>>IF       8609<<ASSIGN   8609>>ASSIGN   8610>>IF       8615>>ASSIGN   8619>>IF       8622>>IF
      8625>>ASSIGN   8625>>ASSIGN   8630>>ASSIGN   8632>>IF       8634>>ASSIGN   8634>>ASSIGN   8638<>CALL
      8659<<ASSIGN   8659>>ASSIGN   8660>>IF       8662>>ASSIGN   8666<<ASSIGN   8666>>ASSIGN   8669>>ASSIGN
      8670>>ASSIGN
NK$LDCT.DDT$
      4344**DCL      4344--REDEF
NK$LDCT.IOQ$
      4343**DCL      4344--REDEF
NK$LDCT.LDCTX
      4345**DCL      4345--REDEF
NK$LDCT.LKFLG.ABORTED
      4357**DCL      4358--REDEF
NK$LDCT.RLCID.LDCTX
      4367**DCL      4367--REDEF
NK$LDCT.STA$
      4363**DCL      4364--REDEF
NK$LDCT.SYMB$
      4342**DCL      4342--REDEF    4342--REDEF    4343--REDEF
NK$VFC.COUNT
      4718**DCL      8427>>ASSIGN
NK$VFC.FCN
      4718**DCL      8424>>IF
NK_BLNKSUPTBL
      7046**DCL      8601>>CALLBLT
SC_BADVDOFNC
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:558  
      8323**DCL-ENT  8351--CALL
SIN
      4698**DCL      8432--ASSIGN   8435--ASSIGN   8677--ASSIGN
SIN.FIL
      4700**DCL      8676<<ASSIGN
SIN.STR
      4699**DCL      8675<<ASSIGN
SOURCE.BY1
      7696**DCL      8531>>ASSIGN
SOURCE.BY2
      7697**DCL      8533>>ASSIGN
SOURCE.BY3
      7698**DCL      8535>>ASSIGN
SOURCE.BY4
      7699**DCL      8537>>ASSIGN
TEMP1
      7012**DCL      8384<<ASSIGN   8385>>ASSIGN   8385>>ASSIGN
TL
      4695**DCL      8663--ASSIGN   8669--ASSIGN   8670--ASSIGN   8671--ASSIGN
TL.LENGTH
      4697**DCL      8662<<ASSIGN   8667<<ASSIGN   8670<<ASSIGN
TL.PRMID
      4696**DCL      8653<<ASSIGN   8657<<ASSIGN   8667>>ASSIGN   8668<<ASSIGN   8669<<ASSIGN
TRAN_PRMID
      8328**DCL      8427>>ASSIGN
VDO
      6919**DCL      8355<<ASSIGN
VDOSZ
      7014**DCL      6920--IMP-SIZ  8354<<ASSIGN   8355>>ASSIGN   8475>>ASSIGN   8656<<ASSIGN   8673>>IF
VDOVLP_MRK
      6898**DCL      8560<<ASSIGN
VDOVLP_MRK.BMRK.BLK#
      6917**DCL      8568<<ASSIGN
VDOVLP_MRK.BMRK.REC#
      6918**DCL      8570<<ASSIGN
VDOVLP_MRK.BYTSIZ
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:559  
      6904**DCL      8571<<ASSIGN   8575<<ASSIGN
VDOVLP_MRK.ID
      6913**DCL      6916--REDEF    8574<<ASSIGN   8575--ASSIGN
VDOVLP_MRK.MRKTYP
      6912**DCL      8564<<ASSIGN
VDOVLP_MRK.RSP
      6912**DCL      8563<<ASSIGN
VLP$FLDATR.ABSGRPRND
      7002**DCL      8386>>IF       8388>>ASSIGN   8461>>IF       8463>>ASSIGN
VLP$FLDATR.GRPRND
      7000**DCL      8392>>ASSIGN   8467>>ASSIGN
VLP$FLDATR.QLF
      7001**DCL      8393>>ASSIGN   8470>>ASSIGN
WABLKDAT.KV$VDO_BLKDAT.RCRBYTSIZ
      7687**DCL      8373<<ASSIGN
WABLKDAT.KV$VDO_BLKDAT.RSN
      7687**DCL      8374<<ASSIGN
WACLSSTR.KV$VDO_CLSSTR.DLT
      7643**DCL      8377--ASSIGN
WADAT.KV$VDO_DAT.DATCTRCHR
      7750**DCL      8401<<ASSIGN
WADAT.KV$VDO_DAT.DATCTRCHRTYP
      7749**DCL      8400<<ASSIGN
WADAT.KV$VDO_DAT.DATMOD
      7750**DCL      8405<<ASSIGN
WADAT.KV$VDO_DAT.DCBHDR
      7749**DCL      8402<<ASSIGN
WADCLFLD.KV$VDO_DCLFLD.CLM
      7794**DCL      8382<<ASSIGN
WADCLFLD.KV$VDO_DCLFLD.GRPRND
      7856**DCL      8388<<ASSIGN   8392<<ASSIGN
WADCLFLD.KV$VDO_DCLFLD.GRPRND.ABS
      7862**DCL      8389<<ASSIGN
WADCLFLD.KV$VDO_DCLFLD.ID
      7878**DCL      8385<<ASSIGN
WADCLFLD.KV$VDO_DCLFLD.LIN
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:560  
      7794**DCL      8381<<ASSIGN
WADCLFLD.KV$VDO_DCLFLD.QLF
      7813**DCL      8393<<ASSIGN
WADCLFLD.KV$VDO_DCLFLD.WDT
      7795**DCL      8383<<ASSIGN
WADCLSTR.KV$VDO_DCLSTR.RE_STR
      7921**DCL      8397<<ASSIGN
WADCLSTR.KV$VDO_DCLSTR.STRID
      7921**DCL      8396<<ASSIGN
WADLT.KV$VDO_DLT.CTLFLG
      7965**DCL      8408<<ASSIGN
WAERS.KV$VDO_ERS.PRT
      8011**DCL      8411--ASSIGN
WAOPNSTR.KV$VDO_OPNSTR.KEYL
      8056**DCL      8417<<ASSIGN
WAOPNSTR.KV$VDO_OPNSTR.NRECS
      8055**DCL      8416<<ASSIGN
WAOPNSTR.KV$VDO_OPNSTR.ORG
      8055**DCL      8415<<ASSIGN
WAOPNSTR.KV$VDO_OPNSTR.SPARE
      8056**DCL      8418<<ASSIGN
WARQSDAT.KV$VDO_RQSDAT.BP
      8103**DCL      8445<<ASSIGN
WARQSDAT.KV$VDO_RQSDAT.DATMOD
      8102**DCL      8448<<ASSIGN
WARQSDAT.KV$VDO_RQSDAT.EOFNO_DAT
      8103**DCL      8444<<ASSIGN
WARQSDAT.KV$VDO_RQSDAT.INCMAXNMBRCR
      8101**DCL      8442<<ASSIGN
WARQSDAT.KV$VDO_RQSDAT.MAXNMBBYT
      8100**DCL      8451<<ASSIGN
WARQSDAT.KV$VDO_RQSDAT.MAXNMBRCR
      8099**DCL      8449<<ASSIGN
WARQSDAT.KV$VDO_RQSDAT.MAXRCRBYTSIZ
      8099**DCL      8453<<ASSIGN
WARQSDAT.KV$VDO_RQSDAT.RE_RED
PL6.E3A0      #011=KIA$VDO File=KIA$APPLC.:E05TSI                                WED 07/30/97 00:37 Page:561  
      8102**DCL      8443<<ASSIGN
WARQSDAT.KV$VDO_RQSDAT.WAT
      8103**DCL      8441<<ASSIGN
WARQSPRM.KV$VDO_RQSPRM.MAXNMBBYT
      8148**DCL      8458<<ASSIGN
WARQSPRM.KV$VDO_RQSPRM.PRMID
      8148**DCL      8456<<ASSIGN
WASLCGRPRND.KV$VDO_SLCGRPRND.GRPRND
      8210**DCL      8463<<ASSIGN   8467<<ASSIGN
WASLCGRPRND.KV$VDO_SLCGRPRND.GRPRND.ABS
      8216**DCL      8464<<ASSIGN
WASLCQLF.KV$VDO_SLCQLF.QLF
      8293**DCL      8470<<ASSIGN
WAVDO.KV$VDO.FNC
      7599**DCL      8356<<ASSIGN
WAVDO.KV$VDO.STR
      7599**DCL      8358<<ASSIGN

PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:562  
     2982        1        /*T***********************************************************/
     2983        2        /*T*                                                         */
     2984        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2985        4        /*T*                                                         */
     2986        5        /*T***********************************************************/
     2987        6        KIA$WRITE: PROC (NK$LDCT,K$RWPARM) ALTRET;
     2988        7
     2989        8        /* Includes */
     2990        9        %INCLUDE B_ERRORS_C;
     2991     1136        %INCLUDE KI_SUBS_C;
     2992     1272        %INCLUDE UD_SEV_C;
     2993     1286        %INCLUDE K_DATA_R;
     2994     1997        %INCLUDE NK$LDCT;
     2995     2099        %INCLUDE HF_LOCK_C;
     2996     2113        %INCLUDE K_SUBS_C;
     2997     2146        %INCLUDE KV$VDO;
     2998     3161        %INCLUDE CP_6_SUBS;
     2999     3701        %INCLUDE NK_VFC_C;
     3000     3775
     3001     3776        /* Vdo refs */
     3002     3777        %KV_VDO_ALL_E;
     3003     3856        %KV$VDO_BLKDAT;
     3004     3899        %KV$VDO_DAT;
     3005     3944
     3006     3945        /* Other refs */
     3007     3946    1   DCL KIA_TCTLMAX SBIN SYMREF;
     3008     3947
     3009     3948        /* Parameters */
     3010     3949        %NK$LDCT (STCLASS="");
     3011     3995        %K$RWPARM (NAME=K$RWPARM,STCLASS="");
     3012     4311
     3013     4312        /* Based stuctures */
     3014     4313        %NK$VFC;
     3015     4331
     3016     4332        /* Auto */
     3017     4333    1   DCL SVMSG$ PTR;
     3018     4334    1   DCL SVMSGSZ UBIN;
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:563  
     3019     4335    1   DCL USER BIT(1);
     3020     4336    1   DCL FNC UBIN;
     3021     4337    1   DCL THRT BIT(1);
     3022     4338
     3023     4339        %K$RWPARM (NAME=S_RWPARM,STCLASS=SYMREF);
     3024     4655    1   DCL 1 LD CONSTANT ALIGNED,
     3025     4656    1         2 FCG BIT(18) UNAL INIT('131101'O),
     3026     4657    1         2 ERR UBIN(15) UNAL INIT (%E$LD),
     3027     4658    1         2 SEV UBIN(3) UNAL INIT (SEV_CONT#);
     3028     4659
     3029     4660        /* Entry refs */
     3030     4661    1   DCL KIA$FCNO ENTRY(3) ALTRET;
     3031     4662    1   DCL KIA$FCNOU ENTRY(3) ALTRET;
     3032     4663    1   DCL KIA$OQFL ENTRY(1) ALTRET;
     3033     4664        %EJECT;
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:564  
     3034     4665    1           USER = '0'B;
     3035     4666    1           GOTO MAIN_PROC;
     3036     4667
     3037     4668    1   KIA$WRITE_USER: ENTRY (NK$LDCT,K$RWPARM) ALTRET;
     3038     4669
     3039     4670    1           USER = '1'B;
     3040     4671
     3041     4672    1   MAIN_PROC: ;
     3042     4673    1           IF K$RWPARM.DVE.DVBYTE.VFC AND ADDR(K$RWPARM.DVE.VFC)->NK$VFC.FCN = %
              4673                    VFCF_SPC
     3043     4674    1             AND ADDR(K$RWPARM.DVE.VFC)->NK$VFC.COUNT < %VFCS_CLRWND
     3044     4675    1             AND ADDR(K$RWPARM.DVE.VFC)->NK$VFC.COUNT ~= %VFCS_PGND
     3045     4676    2             THEN DO;
     3046     4677    2               IF ADDR(K$RWPARM.DVE.VFC)->NK$VFC.COUNT ~= %VFCS_SLPP /* aka IMP  */
     3047     4678    2                 THEN
     3048     4679    2                   FNC = %KV_VDO_FNC_PRM_SET;
     3049     4680    2                 ELSE
     3050     4681    2                   FNC = %KV_VDO_FNC_DAT;
     3051     4682    2               THRT = '0'B;
     3052     4683    2               IF NOT USER THEN EXIT;      /* Won't work if there's no blockee   */
     3053     4684    2               NK$LDCT.TCTLCNT = NK$LDCT.TCTLCNT + 1;
     3054     4685    2               IF NK$LDCT.TCTLCNT >= KIA_TCTLMAX THEN
     3055     4686    2                   K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
     3056     4687    2               END;
     3057     4688    2             ELSE DO;
     3058     4689    2               FNC = %KV_VDO_FNC_DAT;
     3059     4690    2               THRT = '1'B;
     3060     4691    2               END;
     3061     4692    1           IF NK$LDCT.TH.MAXNMBRCR = 0 OR K$RWPARM.MSGSZ > NK$LDCT.TH.MAXNMBBYT
     3062     4693    1             OR ((K$RWPARM.STR = KIDM_MON | NK$LDCT.TH.STR = KIDM_MON)
     3063     4694    1             AND K$RWPARM.STR ~= NK$LDCT.TH.STR) AND THRT
     3064     4695    2             THEN DO;
     3065     4696    2               NK$LDCT.LKFLG.OBLK = '1'B;
     3066     4697    2   TRY_BLK_AGAIN: ;
     3067     4698    2               S_RWPARM = K_RWPARM_CON;
     3068     4699    2               S_RWPARM.MAXRCRBYTSIZ = K$RWPARM.MSGSZ;
     3069     4700    2               S_RWPARM.STR = K$RWPARM.STR;
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:565  
     3070     4701    2               IF NK$LDCT.TH.MAXNMBRCR = 0
     3071     4702    2                 THEN
     3072     4703    2                   S_RWPARM.RSN = %KV_BLKRSN_MAXNMBRCR;
     3073     4704    2                 ELSE
     3074     4705    2                   S_RWPARM.RSN = %KV_BLKRSN_MAXNMBBYT;
     3075     4706    2               CALL KIA$FCNO (NK$LDCT,%KV_VDO_FNC_BLKDAT,S_RWPARM)
     3076     4707    3                 WHENALTRETURN DO;
     3077     4708    3                   IF USER
     3078     4709    3                     THEN
     3079     4710    3                       CALL KIA$OQFL(NK$LDCT)
     3080     4711    4                         WHENRETURN DO;
     3081     4712    4                           GOTO TRY_BLK_AGAIN;
     3082     4713    4                           END;
     3083     4714    3                   K$RWPARM.ERR = S_RWPARM.ERR;
     3084     4715    3                   ALTRETURN;
     3085     4716    3                   END;
     3086     4717    2               K$RWPARM.ERR = %K$NO_THROT;
     3087     4718    2               ALTRETURN;
     3088     4719    2               END;
     3089     4720
     3090     4721        /*
     3091     4722             Get pointers to the DCBs in the IOENDROS
     3092     4723         */
     3093     4724
     3094     4725        /* Throttling is available lets send it */
     3095     4726    1           IF THRT
     3096     4727    2             THEN DO;
     3097     4728    2               IF K$RWPARM.MSGSZ > NK$LDCT.TH.MAXRCRBYTSIZ
     3098     4729    3                 THEN DO;
     3099     4730    3                   IF NK$LDCT.TH.MAXRCRBYTSIZ = 0
     3100     4731    4                     THEN DO;
     3101     4732        /* OUTPUTDISCARD is probably on - don't send anything,
     3102     4733           but don't wait for a marker response, either. */
     3103     4734    4                       K$RWPARM.MRKTYP = 0;
     3104     4735    4                       RETURN;
     3105     4736    4                       END;
     3106     4737    3                   K$RWPARM.MSGSZ = NK$LDCT.TH.MAXRCRBYTSIZ;
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:566  
     3107     4738    3   RETRY:
     3108     4739    3                   K$RWPARM.MSG_ERRCODE = LD;
     3109     4740    3                   K$RWPARM.TYC = K$RWPARM.TYC|%TYC_LD;
     3110     4741                       /*E* ERROR: KIA-E$LD-0
     3111     4742                            MESSAGE: Lost data %on %DC%.
     3112     4743                            MESSAGE1: The buffer on the receiving end was less
     3113     4744                                      than the amount of data that needed to be
     3114     4745                                      sent.
     3115     4746         */
     3116     4747    3                   END;
     3117     4748    2               NK$LDCT.TH.MAXNMBBYT = NK$LDCT.TH.MAXNMBBYT - K$RWPARM.MSGSZ;
     3118     4749    2               NK$LDCT.TH.MAXNMBRCR = NK$LDCT.TH.MAXNMBRCR - 1;
     3119     4750    2               END;
     3120     4751    1           IF USER
     3121     4752    1             THEN
     3122     4753    1               CALL KIA$FCNOU(NK$LDCT,FNC,K$RWPARM) ALTRET(DISC);
     3123     4754    1             ELSE
     3124     4755    1               CALL KIA$FCNO(NK$LDCT,FNC,K$RWPARM)
     3125     4756    2                 WHENALTRETURN DO;
     3126     4757    2   DISC:           ;
     3127     4758    2                   IF THRT
     3128     4759    3                     THEN DO;
     3129     4760    3                       NK$LDCT.TH.MAXNMBBYT = NK$LDCT.TH.MAXNMBBYT + K$RWPARM.MSGSZ;
     3130     4761    3                       NK$LDCT.TH.MAXNMBRCR = NK$LDCT.TH.MAXNMBRCR + 1;
     3131     4762    3                       END;
     3132     4763    3                   IF K$RWPARM.ERR = %K$Q2SMALL THEN DO;
     3133     4764    3                       K$RWPARM.MSGSZ = K$RWPARM.MSGSZ-BITBIN(K$RWPARM.MSG_ERRCODE);
     3134     4765    3                       GOTO RETRY;
     3135     4766    3                       END;
     3136     4767    2                   ALTRETURN;
     3137     4768    2                   END;
     3138     4769
     3139     4770    1           RETURN;
     3140     4771
     3141     4772    1   END KIA$WRITE;
     3142     4773        %EOD;

PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:567  
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$WRITE.

   Procedure KIA$WRITE requires 201 words for executable code.
   Procedure KIA$WRITE requires 14 words of local(AUTO) storage.

PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:568  

 Object Unit name= KIA$WRITE                                  File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:39:14.40 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  KIA$WRITE
    1   Proc  even  none   201    311  KIA$WRITE
    2  RoData even  none     2      2  KIA$WRITE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  KIA$WRITE
     1      4          yes     yes      Std        2  KIA$WRITE_USER

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KIA$FCNO
 yes     yes           Std       1 KIA$OQFL
 yes     yes           Std       3 KIA$FCNOU
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:569  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    K_RWPARM_CON                          KIA_TCTLMAX                           S_RWPARM
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:570  


     2982        1        /*T***********************************************************/
     2983        2        /*T*                                                         */
     2984        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     2985        4        /*T*                                                         */
     2986        5        /*T***********************************************************/
     2987        6        KIA$WRITE: PROC (NK$LDCT,K$RWPARM) ALTRET;

      6  1 000000   000000 700200 xent  KIA$WRITE    TSX0  ! X66_AUTO_2
         1 000001   000016 000002                    ZERO    14,2

     2988        7
     2989        8        /* Includes */
     2990        9        %INCLUDE B_ERRORS_C;
     2991     1136        %INCLUDE KI_SUBS_C;
     2992     1272        %INCLUDE UD_SEV_C;
     2993     1286        %INCLUDE K_DATA_R;
     2994     1997        %INCLUDE NK$LDCT;
     2995     2099        %INCLUDE HF_LOCK_C;
     2996     2113        %INCLUDE K_SUBS_C;
     2997     2146        %INCLUDE KV$VDO;
     2998     3161        %INCLUDE CP_6_SUBS;
     2999     3701        %INCLUDE NK_VFC_C;
     3000     3775
     3001     3776        /* Vdo refs */
     3002     3777        %KV_VDO_ALL_E;
     3003     3856        %KV$VDO_BLKDAT;
     3004     3899        %KV$VDO_DAT;
     3005     3944
     3006     3945        /* Other refs */
     3007     3946    1   DCL KIA_TCTLMAX SBIN SYMREF;
     3008     3947
     3009     3948        /* Parameters */
     3010     3949        %NK$LDCT (STCLASS="");
     3011     3995        %K$RWPARM (NAME=K$RWPARM,STCLASS="");
     3012     4311
     3013     4312        /* Based stuctures */
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:571  
     3014     4313        %NK$VFC;
     3015     4331
     3016     4332        /* Auto */
     3017     4333    1   DCL SVMSG$ PTR;
     3018     4334    1   DCL SVMSGSZ UBIN;
     3019     4335    1   DCL USER BIT(1);
     3020     4336    1   DCL FNC UBIN;
     3021     4337    1   DCL THRT BIT(1);
     3022     4338
     3023     4339        %K$RWPARM (NAME=S_RWPARM,STCLASS=SYMREF);
     3024     4655    1   DCL 1 LD CONSTANT ALIGNED,
     3025     4656    1         2 FCG BIT(18) UNAL INIT('131101'O),
     3026     4657    1         2 ERR UBIN(15) UNAL INIT (%E$LD),
     3027     4658    1         2 SEV UBIN(3) UNAL INIT (SEV_CONT#);
     3028     4659
     3029     4660        /* Entry refs */
     3030     4661    1   DCL KIA$FCNO ENTRY(3) ALTRET;
     3031     4662    1   DCL KIA$FCNOU ENTRY(3) ALTRET;
     3032     4663    1   DCL KIA$OQFL ENTRY(1) ALTRET;
     3033     4664        %EJECT;
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:572  
     3034     4665    1           USER = '0'B;

   4665  1 000002   200007 450100                    STZ     USER,,AUTO

     3035     4666    1           GOTO MAIN_PROC;

   4666  1 000003   000010 710000 1                  TRA     MAIN_PROC

     3036     4667
     3037     4668    1   KIA$WRITE_USER: ENTRY (NK$LDCT,K$RWPARM) ALTRET;

   4668  1 000004   000000 700200 xent  KIA$WRITE_U* TSX0  ! X66_AUTO_2
         1 000005   000016 000002                    ZERO    14,2

     3038     4669
     3039     4670    1           USER = '1'B;

   4670  1 000006   400000 236003                    LDQ     -131072,DU
         1 000007   200007 756100                    STQ     USER,,AUTO

   4670  1 000010                       MAIN_PROC    null
     3040     4671
     3041     4672    1   MAIN_PROC: ;
     3042     4673    1           IF K$RWPARM.DVE.DVBYTE.VFC AND ADDR(K$RWPARM.DVE.VFC)->NK$VFC.FCN = %
              4673                    VFCF_SPC

   4673  1 000010   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000011   000010 236100                    LDQ     8,,PR0
         1 000012   100000 316003                    CANQ    32768,DU
         1 000013   000054 600000 1                  TZE     s:4689
         1 000014   000010 236100                    LDQ     8,,PR0
         1 000015   000160 376003                    ANQ     112,DU
         1 000016   000020 116003                    CMPQ    16,DU
         1 000017   000054 601000 1                  TNZ     s:4689
         1 000020   000010 236100                    LDQ     8,,PR0
         1 000021   000017 376003                    ANQ     15,DU
         1 000022   000015 116003                    CMPQ    13,DU
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:573  
         1 000023   000054 603000 1                  TRC     s:4689
         1 000024   000012 116003                    CMPQ    10,DU
         1 000025   000054 600000 1                  TZE     s:4689

     3043     4674    1             AND ADDR(K$RWPARM.DVE.VFC)->NK$VFC.COUNT < %VFCS_CLRWND
     3044     4675    1             AND ADDR(K$RWPARM.DVE.VFC)->NK$VFC.COUNT ~= %VFCS_PGND
     3045     4676    2             THEN DO;

     3046     4677    2               IF ADDR(K$RWPARM.DVE.VFC)->NK$VFC.COUNT ~= %VFCS_SLPP /* aka IMP  */

   4677  1 000026   000011 116003                    CMPQ    9,DU
         1 000027   000033 600000 1                  TZE     s:4681

     3047     4678    2                 THEN
     3048     4679    2                   FNC = %KV_VDO_FNC_PRM_SET;

   4679  1 000030   000023 235007                    LDA     19,DL
         1 000031   200010 755100                    STA     FNC,,AUTO
         1 000032   000035 710000 1                  TRA     s:4682

     3049     4680    2                 ELSE
     3050     4681    2                   FNC = %KV_VDO_FNC_DAT;

   4681  1 000033   000005 235007                    LDA     5,DL
         1 000034   200010 755100                    STA     FNC,,AUTO

     3051     4682    2               THRT = '0'B;

   4682  1 000035   200011 450100                    STZ     THRT,,AUTO

     3052     4683    2               IF NOT USER THEN EXIT;      /* Won't work if there's no blockee   */

   4683  1 000036   200007 234100                    SZN     USER,,AUTO
         1 000037   000053 605000 1                  TPL     s:4687

     3053     4684    2               NK$LDCT.TCTLCNT = NK$LDCT.TCTLCNT + 1;

PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:574  
   4684  1 000040   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000041   100026 236100                    LDQ     22,,PR1
         1 000042   001000 036007                    ADLQ    512,DL
         1 000043   100026 552110                    STBQ    22,'10'O,PR1

     3054     4685    2               IF NK$LDCT.TCTLCNT >= KIA_TCTLMAX THEN

   4685  1 000044   100026 236100                    LDQ     22,,PR1
         1 000045   000011 772000                    QRL     9
         1 000046   000777 376007                    ANQ     511,DL
         1 000047   000000 116000 xsym               CMPQ    KIA_TCTLMAX
         1 000050   000060 604000 1                  TMI     s:4692

     3055     4686    2                   K$RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

   4686  1 000051   001000 236007                    LDQ     512,DL
         1 000052   000040 552110                    STBQ    32,'10'O,PR0

     3056     4687    2               END;

   4687  1 000053   000060 710000 1                  TRA     s:4692

     3057     4688    2             ELSE DO;

     3058     4689    2               FNC = %KV_VDO_FNC_DAT;

   4689  1 000054   000005 235007                    LDA     5,DL
         1 000055   200010 755100                    STA     FNC,,AUTO

     3059     4690    2               THRT = '1'B;

   4690  1 000056   400000 236003                    LDQ     -131072,DU
         1 000057   200011 756100                    STQ     THRT,,AUTO

     3060     4691    2               END;

     3061     4692    1           IF NK$LDCT.TH.MAXNMBRCR = 0 OR K$RWPARM.MSGSZ > NK$LDCT.TH.MAXNMBBYT
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:575  

   4692  1 000060   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000061   100016 720100                    LXL0    14,,PR1
         1 000062   000123 600000 1                  TZE     s:4696
         1 000063   100017 236100                    LDQ     15,,PR1
         1 000064   000022 736000                    QLS     18
         1 000065   000022 732000                    QRS     18
         1 000066   000001 116100                    CMPQ    1,,PR0
         1 000067   000123 604000 1                  TMI     s:4696
         1 000070   400000 221003                    LDX1    -131072,DU
         1 000071   000040 236100                    LDQ     32,,PR0
         1 000072   000777 376007                    ANQ     511,DL
         1 000073   000177 116007                    CMPQ    127,DL
         1 000074   000076 600000 1                  TZE     s:4692+14
         1 000075   000000 221003                    LDX1    0,DU
         1 000076   400000 222003                    LDX2    -131072,DU
         1 000077   100016 236100                    LDQ     14,,PR1
         1 000100   000777 376003                    ANQ     511,DU
         1 000101   000177 116003                    CMPQ    127,DU
         1 000102   000104 600000 1                  TZE     s:4692+20
         1 000103   000000 222003                    LDX2    0,DU
         1 000104   000000 636012                    EAQ     0,X2
         1 000105   200012 756100                    STQ     THRT+1,,AUTO
         1 000106   000000 636011                    EAQ     0,X1
         1 000107   200012 276100                    ORQ     THRT+1,,AUTO
         1 000110   000176 600000 1                  TZE     s:4726
         1 000111   100016 236100                    LDQ     14,,PR1
         1 000112   000022 772000                    QRL     18
         1 000113   000777 376007                    ANQ     511,DL
         1 000114   200013 756100                    STQ     THRT+2,,AUTO
         1 000115   000040 236100                    LDQ     32,,PR0
         1 000116   000777 376007                    ANQ     511,DL
         1 000117   200013 116100                    CMPQ    THRT+2,,AUTO
         1 000120   000176 600000 1                  TZE     s:4726
         1 000121   200011 234100                    SZN     THRT,,AUTO
         1 000122   000176 605000 1                  TPL     s:4726

PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:576  
     3062     4693    1             OR ((K$RWPARM.STR = KIDM_MON | NK$LDCT.TH.STR = KIDM_MON)
     3063     4694    1             AND K$RWPARM.STR ~= NK$LDCT.TH.STR) AND THRT
     3064     4695    2             THEN DO;

     3065     4696    2               NK$LDCT.LKFLG.OBLK = '1'B;

   4696  1 000123   200000 236003                    LDQ     65536,DU
         1 000124   100011 256100                    ORSQ    9,,PR1

   4696  1 000125                       TRY_BLK_AGA* null
     3066     4697    2   TRY_BLK_AGAIN: ;
     3067     4698    2               S_RWPARM = K_RWPARM_CON;

   4698  1 000125   000000 100400                    MLR     fill='000'O
         1 000126   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000127   000000 000234 xsym               ADSC9   S_RWPARM                 cn=0,n=156

     3068     4699    2               S_RWPARM.MAXRCRBYTSIZ = K$RWPARM.MSGSZ;

   4699  1 000130   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000131   000001 720100                    LXL0    1,,PR0
         1 000132   000042 740000 xsym               STX0    S_RWPARM+34

     3069     4700    2               S_RWPARM.STR = K$RWPARM.STR;

   4700  1 000133   000040 236100                    LDQ     32,,PR0
         1 000134   000040 552004 xsym               STBQ    S_RWPARM+32,'04'O

     3070     4701    2               IF NK$LDCT.TH.MAXNMBRCR = 0

   4701  1 000135   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000136   100016 721100                    LXL1    14,,PR1
         1 000137   000143 601000 1                  TNZ     s:4705

     3071     4702    2                 THEN
     3072     4703    2                   S_RWPARM.RSN = %KV_BLKRSN_MAXNMBRCR;

PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:577  
   4703  1 000140   000002 236007                    LDQ     2,DL
         1 000141   000010 552004 xsym               STBQ    S_RWPARM+8,'04'O
         1 000142   000145 710000 1                  TRA     s:4706

     3073     4704    2                 ELSE
     3074     4705    2                   S_RWPARM.RSN = %KV_BLKRSN_MAXNMBBYT;

   4705  1 000143   000001 236007                    LDQ     1,DL
         1 000144   000010 552004 xsym               STBQ    S_RWPARM+8,'04'O

     3075     4706    2               CALL KIA$FCNO (NK$LDCT,%KV_VDO_FNC_BLKDAT,S_RWPARM)

   4706  1 000145   000000 236000 2                  LDQ     0
         1 000146   200014 756100                    STQ     THRT+3,,AUTO
         1 000147   000001 236000 2                  LDQ     1
         1 000150   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000151   200012 757100                    STAQ    THRT+1,,AUTO
         1 000152   200012 630500                    EPPR0   THRT+1,,AUTO
         1 000153   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000154   000000 701000 xent               TSX1    KIA$FCNO
         1 000155   000157 702000 1                  TSX2    s:4708
         1 000156   000172 710000 1                  TRA     s:4717

     3076     4707    3                 WHENALTRETURN DO;

     3077     4708    3                   IF USER

   4708  1 000157   200007 234100                    SZN     USER,,AUTO
         1 000160   000166 605000 1                  TPL     s:4714

     3078     4709    3                     THEN
     3079     4710    3                       CALL KIA$OQFL(NK$LDCT)

   4710  1 000161   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000162   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000163   000000 701000 xent               TSX1    KIA$OQFL
         1 000164   000166 702000 1                  TSX2    s:4714
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:578  

     3080     4711    4                         WHENRETURN DO;

     3081     4712    4                           GOTO TRY_BLK_AGAIN;

   4712  1 000165   000125 710000 1                  TRA     TRY_BLK_AGAIN

     3082     4713    4                           END;
     3083     4714    3                   K$RWPARM.ERR = S_RWPARM.ERR;

   4714  1 000166   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000167   000013 235000 xsym               LDA     S_RWPARM+11
         1 000170   000013 755100                    STA     11,,PR0

     3084     4715    3                   ALTRETURN;

   4715  1 000171   000000 702200 xent               TSX2  ! X66_AALT

     3085     4716    3                   END;
     3086     4717    2               K$RWPARM.ERR = %K$NO_THROT;

   4717  1 000172   000004 235007                    LDA     4,DL
         1 000173   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000174   000013 755100                    STA     11,,PR0

     3087     4718    2               ALTRETURN;

   4718  1 000175   000000 702200 xent               TSX2  ! X66_AALT

     3088     4719    2               END;
     3089     4720
     3090     4721        /*
     3091     4722             Get pointers to the DCBs in the IOENDROS
     3092     4723         */
     3093     4724
     3094     4725        /* Throttling is available lets send it */
     3095     4726    1           IF THRT
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:579  

   4726  1 000176   200011 234100                    SZN     THRT,,AUTO
         1 000177   000232 605000 1                  TPL     s:4751

     3096     4727    2             THEN DO;

     3097     4728    2               IF K$RWPARM.MSGSZ > NK$LDCT.TH.MAXRCRBYTSIZ

   4728  1 000200   100017 236100                    LDQ     15,,PR1
         1 000201   000022 732000                    QRS     18
         1 000202   000001 116100                    CMPQ    1,,PR0
         1 000203   000220 605000 1                  TPL     s:4748

     3098     4729    3                 THEN DO;

     3099     4730    3                   IF NK$LDCT.TH.MAXRCRBYTSIZ = 0

   4730  1 000204   100017 221100                    LDX1    15,,PR1
         1 000205   000211 601000 1                  TNZ     s:4737

     3100     4731    4                     THEN DO;

     3101     4732        /* OUTPUTDISCARD is probably on - don't send anything,
     3102     4733           but don't wait for a marker response, either. */
     3103     4734    4                       K$RWPARM.MRKTYP = 0;

   4734  1 000206   000000 236003                    LDQ     0,DU
         1 000207   000040 552110                    STBQ    32,'10'O,PR0

     3104     4735    4                       RETURN;

   4735  1 000210   000000 702200 xent               TSX2  ! X66_ARET

     3105     4736    4                       END;
     3106     4737    3                   K$RWPARM.MSGSZ = NK$LDCT.TH.MAXRCRBYTSIZ;

   4737  1 000211   000001 756100                    STQ     1,,PR0
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:580  

     3107     4738    3   RETRY:
     3108     4739    3                   K$RWPARM.MSG_ERRCODE = LD;

   4739  1 000212   000000 236000 0     RETRY        LDQ     LD
         1 000213   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000214   000037 756100                    STQ     31,,PR0

     3109     4740    3                   K$RWPARM.TYC = K$RWPARM.TYC|%TYC_LD;

   4740  1 000215   000006 236100                    LDQ     6,,PR0
         1 000216   000001 276000 0                  ORQ     LD+1
         1 000217   000006 756100                    STQ     6,,PR0

     3110     4741                       /*E* ERROR: KIA-E$LD-0
     3111     4742                            MESSAGE: Lost data %on %DC%.
     3112     4743                            MESSAGE1: The buffer on the receiving end was less
     3113     4744                                      than the amount of data that needed to be
     3114     4745                                      sent.
     3115     4746         */
     3116     4747    3                   END;

     3117     4748    2               NK$LDCT.TH.MAXNMBBYT = NK$LDCT.TH.MAXNMBBYT - K$RWPARM.MSGSZ;

   4748  1 000220   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000221   100017 236100                    LDQ     15,,PR1
         1 000222   000022 736000                    QLS     18
         1 000223   000022 732000                    QRS     18
         1 000224   000001 136100                    SBLQ    1,,PR0
         1 000225   000000 620006                    EAX0    0,QL
         1 000226   100017 440100                    SXL0    15,,PR1

     3118     4749    2               NK$LDCT.TH.MAXNMBRCR = NK$LDCT.TH.MAXNMBRCR - 1;

   4749  1 000227   100016 721100                    LXL1    14,,PR1
         1 000230   777777 622011                    EAX2    -1,X1
         1 000231   100016 442100                    SXL2    14,,PR1
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:581  

     3119     4750    2               END;

     3120     4751    1           IF USER

   4751  1 000232   200007 234100                    SZN     USER,,AUTO
         1 000233   000247 605000 1                  TPL     s:4755

     3121     4752    1             THEN
     3122     4753    1               CALL KIA$FCNOU(NK$LDCT,FNC,K$RWPARM) ALTRET(DISC);

   4753  1 000234   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 000235   200014 756100                    STQ     THRT+3,,AUTO
         1 000236   200010 633500                    EPPR3   FNC,,AUTO
         1 000237   200013 453500                    STP3    THRT+2,,AUTO
         1 000240   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000241   200012 756100                    STQ     THRT+1,,AUTO
         1 000242   200012 630500                    EPPR0   THRT+1,,AUTO
         1 000243   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000244   000000 701000 xent               TSX1    KIA$FCNOU
         1 000245   000262 702000 1                  TSX2    DISC
         1 000246   000310 710000 1                  TRA     s:4770

     3123     4754    1             ELSE
     3124     4755    1               CALL KIA$FCNO(NK$LDCT,FNC,K$RWPARM)

   4755  1 000247   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 000250   200014 756100                    STQ     THRT+3,,AUTO
         1 000251   200010 633500                    EPPR3   FNC,,AUTO
         1 000252   200013 453500                    STP3    THRT+2,,AUTO
         1 000253   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000254   200012 756100                    STQ     THRT+1,,AUTO
         1 000255   200012 630500                    EPPR0   THRT+1,,AUTO
         1 000256   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000257   000000 701000 xent               TSX1    KIA$FCNO
         1 000260   000262 702000 1                  TSX2    DISC
         1 000261   000310 710000 1                  TRA     s:4770
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:582  

     3125     4756    2                 WHENALTRETURN DO;

   4753  1 000262                       DISC         null
     3126     4757    2   DISC:           ;
     3127     4758    2                   IF THRT

   4758  1 000262   200011 234100                    SZN     THRT,,AUTO
         1 000263   000277 605000 1                  TPL     s:4763

     3128     4759    3                     THEN DO;

     3129     4760    3                       NK$LDCT.TH.MAXNMBBYT = NK$LDCT.TH.MAXNMBBYT + K$RWPARM.MSGSZ;

   4760  1 000264   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000265   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000266   100017 236100                    LDQ     15,,PR1
         1 000267   000022 736000                    QLS     18
         1 000270   000022 732000                    QRS     18
         1 000271   000001 036100                    ADLQ    1,,PR0
         1 000272   000000 620006                    EAX0    0,QL
         1 000273   100017 440100                    SXL0    15,,PR1

     3130     4761    3                       NK$LDCT.TH.MAXNMBRCR = NK$LDCT.TH.MAXNMBRCR + 1;

   4761  1 000274   100016 721100                    LXL1    14,,PR1
         1 000275   000001 622011                    EAX2    1,X1
         1 000276   100016 442100                    SXL2    14,,PR1

     3131     4762    3                       END;

     3132     4763    3                   IF K$RWPARM.ERR = %K$Q2SMALL THEN DO;

   4763  1 000277   200004 470500                    LDP0    @K$RWPARM,,AUTO
         1 000300   000013 235100                    LDA     11,,PR0
         1 000301   000007 115007                    CMPA    7,DL
         1 000302   000307 601000 1                  TNZ     s:4767
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:583  

     3133     4764    3                       K$RWPARM.MSGSZ = K$RWPARM.MSGSZ-BITBIN(K$RWPARM.MSG_ERRCODE);

   4764  1 000303   000001 236100                    LDQ     1,,PR0
         1 000304   000037 136100                    SBLQ    31,,PR0
         1 000305   000001 756100                    STQ     1,,PR0

     3134     4765    3                       GOTO RETRY;

   4765  1 000306   000212 710000 1                  TRA     RETRY

     3135     4766    3                       END;
     3136     4767    2                   ALTRETURN;

   4767  1 000307   000000 702200 xent               TSX2  ! X66_AALT

     3137     4768    2                   END;
     3138     4769
     3139     4770    1           RETURN;

   4770  1 000310   000000 702200 xent               TSX2  ! X66_ARET

LD
 Sect OctLoc
   0     000   131101 000070                                                    YA.8

(unnamed)
 Sect OctLoc
   0     001   002000 000000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000000 006000   000004 006000                                    ........
     3140     4771
     3141     4772    1   END KIA$WRITE;
     3142     4773        %EOD;

PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:584  
--  Include file information  --

   NK_VFC_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$WRITE.
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:585  

 **** Variables and constants ****

  ****  Section 000 RoData KIA$WRITE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 LD

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
    10-0-0/w UBIN        r     1 FNC                       *0-0-0/d STRC(1404)  r     1 K$RWPARM
    *0-0-0/d STRC(864)   r     1 NK$LDCT                   11-0-0/b BIT         r     1 THRT
     7-0-0/b BIT         r     1 USER

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 KIA_TCTLMAX                0-0-0/d STRC(1404)  r     1 K_RWPARM_CON
     0-0-0/d STRC(1404)  r     1 S_RWPARM

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(9)     r     1 NK$VFC


   Procedure KIA$WRITE requires 201 words for executable code.
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:586  
   Procedure KIA$WRITE requires 14 words of local(AUTO) storage.
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:587  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:588  
          MINI XREF LISTING

DISC
      4753**LABEL    4753--CALLALT
FNC
      4336**DCL      4679<<ASSIGN   4681<<ASSIGN   4689<<ASSIGN   4753<>CALL     4755<>CALL
K$RWPARM
      4016**DCL         6--PROC     4668--ENTRY    4753<>CALL     4755<>CALL
K$RWPARM.BLKREC
      4042**DCL      4067--REDEF
K$RWPARM.BLKREC.BLKU#
      4043**DCL      4045--REDEF
K$RWPARM.BLKREC.RECU#
      4055**DCL      4057--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      4082**DCL      4083--REDEF    4673>>IF
K$RWPARM.DVE.EOMCHAR
      4090**DCL      4094--REDEF
K$RWPARM.DVE.VFC
      4094**DCL      4673--IF       4673--IF       4673--IF       4677--IF
K$RWPARM.ERR
      4154**DCL      4159--REDEF    4714<<ASSIGN   4717<<ASSIGN   4763>>IF
K$RWPARM.FC
      4118**DCL      4119--REDEF
K$RWPARM.FLDID
      4300**DCL      4301--REDEF
K$RWPARM.FPT$
      4181**DCL      4188--REDEF
K$RWPARM.KEYTYPE
      4307**DCL      4308--REDEF
K$RWPARM.MRKTYP
      4292**DCL      4686<<ASSIGN   4734<<ASSIGN
K$RWPARM.MSG$
      4017**DCL      4023--REDEF
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:589  
K$RWPARM.MSGID
      4129**DCL      4134--REDEF
K$RWPARM.MSGIDXT
      4142**DCL      4146--REDEF
K$RWPARM.MSGSZ
      4024**DCL      4692>>IF       4699>>ASSIGN   4728>>IF       4737<<ASSIGN   4748>>ASSIGN   4760>>ASSIGN
      4764<<ASSIGN   4764>>ASSIGN
K$RWPARM.MSG_ERRCODE
      4277**DCL      4739<<ASSIGN   4764>>ASSIGN
K$RWPARM.ORG
      4278**DCL      4279--REDEF
K$RWPARM.STR
      4293**DCL      4692>>IF       4692>>IF       4700>>ASSIGN
K$RWPARM.THDRSZ
      4222**DCL      4226--REDEF
K$RWPARM.TYC
      4038**DCL      4740<<ASSIGN   4740>>ASSIGN
K$RWPARM.VDOFLGS
      4280**DCL      4291--REDEF
KIA$FCNO
      4661**DCL-ENT  4706--CALL     4755--CALL
KIA$FCNOU
      4662**DCL-ENT  4753--CALL
KIA$OQFL
      4663**DCL-ENT  4710--CALL
KIA_TCTLMAX
      3946**DCL      4685>>IF
K_RWPARM_CON
      1701**DCL      4698>>ASSIGN
K_RWPARM_CON.BLKREC
      1727**DCL      1752--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      1728**DCL      1730--REDEF
K_RWPARM_CON.BLKREC.RECU#
      1740**DCL      1742--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:590  
      1767**DCL      1768--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      1775**DCL      1779--REDEF
K_RWPARM_CON.ERR
      1839**DCL      1844--REDEF
K_RWPARM_CON.FC
      1803**DCL      1804--REDEF
K_RWPARM_CON.FLDID
      1985**DCL      1986--REDEF
K_RWPARM_CON.FPT$
      1866**DCL      1873--REDEF
K_RWPARM_CON.KEYTYPE
      1992**DCL      1993--REDEF
K_RWPARM_CON.MSG$
      1702**DCL      1708--REDEF
K_RWPARM_CON.MSGID
      1814**DCL      1819--REDEF
K_RWPARM_CON.MSGIDXT
      1827**DCL      1831--REDEF
K_RWPARM_CON.ORG
      1963**DCL      1964--REDEF
K_RWPARM_CON.THDRSZ
      1907**DCL      1911--REDEF
K_RWPARM_CON.VDOFLGS
      1965**DCL      1976--REDEF
LD
      4655**DCL      4739>>ASSIGN
MAIN_PROC
      4670**LABEL    4666--GOTO
NK$LDCT
      3962**DCL         6--PROC     4668--ENTRY    4706<>CALL     4710<>CALL     4753<>CALL     4755<>CALL
NK$LDCT.DDT$
      3964**DCL      3964--REDEF
NK$LDCT.IOQ$
      3963**DCL      3964--REDEF
NK$LDCT.LDCTX
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:591  
      3965**DCL      3965--REDEF
NK$LDCT.LKFLG.ABORTED
      3977**DCL      3978--REDEF
NK$LDCT.LKFLG.OBLK
      3977**DCL      4696<<ASSIGN
NK$LDCT.RLCID.LDCTX
      3987**DCL      3987--REDEF
NK$LDCT.STA$
      3983**DCL      3984--REDEF
NK$LDCT.SYMB$
      3962**DCL      3962--REDEF    3962--REDEF    3963--REDEF
NK$LDCT.TCTLCNT
      3992**DCL      4684<<ASSIGN   4684>>ASSIGN   4685>>IF
NK$LDCT.TH.MAXNMBBYT
      3989**DCL      4692>>IF       4748<<ASSIGN   4748>>ASSIGN   4760<<ASSIGN   4760>>ASSIGN
NK$LDCT.TH.MAXNMBRCR
      3988**DCL      4692>>IF       4701>>IF       4749<<ASSIGN   4749>>ASSIGN   4761<<ASSIGN   4761>>ASSIGN
NK$LDCT.TH.MAXRCRBYTSIZ
      3989**DCL      4728>>IF       4730>>IF       4737>>ASSIGN
NK$LDCT.TH.STR
      3988**DCL      4692>>IF       4692>>IF
NK$VFC.COUNT
      4328**DCL      4673>>IF       4673>>IF       4677>>IF
NK$VFC.FCN
      4328**DCL      4673>>IF
RETRY
      4739**LABEL    4765--GOTO
S_RWPARM
      4360**DCL      4698<<ASSIGN   4706<>CALL
S_RWPARM.BLKREC
      4386**DCL      4411--REDEF
S_RWPARM.BLKREC.BLKU#
      4387**DCL      4389--REDEF
S_RWPARM.BLKREC.RECU#
      4399**DCL      4401--REDEF
S_RWPARM.DVE.DVBYTE.VFC
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:592  
      4426**DCL      4427--REDEF
S_RWPARM.DVE.EOMCHAR
      4434**DCL      4438--REDEF
S_RWPARM.ERR
      4498**DCL      4503--REDEF    4714>>ASSIGN
S_RWPARM.FC
      4462**DCL      4463--REDEF
S_RWPARM.FLDID
      4644**DCL      4645--REDEF
S_RWPARM.FPT$
      4525**DCL      4532--REDEF
S_RWPARM.KEYTYPE
      4651**DCL      4652--REDEF
S_RWPARM.MAXRCRBYTSIZ
      4640**DCL      4699<<ASSIGN
S_RWPARM.MSG$
      4361**DCL      4367--REDEF
S_RWPARM.MSGID
      4473**DCL      4478--REDEF
S_RWPARM.MSGIDXT
      4486**DCL      4490--REDEF
S_RWPARM.ORG
      4622**DCL      4623--REDEF
S_RWPARM.RSN
      4463**DCL      4703<<ASSIGN   4705<<ASSIGN
S_RWPARM.STR
      4637**DCL      4700<<ASSIGN
S_RWPARM.THDRSZ
      4566**DCL      4570--REDEF
S_RWPARM.VDOFLGS
      4624**DCL      4635--REDEF
THRT
      4337**DCL      4682<<ASSIGN   4690<<ASSIGN   4692>>IF       4726>>IF       4758>>IF
TRY_BLK_AGAIN
      4696**LABEL    4712--GOTO
USER
PL6.E3A0      #012=KIA$WRITE File=KIA$APPLC.:E05TSI                              WED 07/30/97 00:39 Page:593  
      4335**DCL      4665<<ASSIGN   4670<<ASSIGN   4683>>IF       4708>>IF       4751>>IF

PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:594  
     3143        1        /*T***********************************************************/
     3144        2        /*T*                                                         */
     3145        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3146        4        /*T*                                                         */
     3147        5        /*T***********************************************************/
     3148        6        /*D* NAME:        KIA$9TO8
     3149        7             PURPOSE:     To ready strings to be sent to the FEP over the coupler
     3150        8             CALL:        CALL KIA$9TO8(SOURCE,DESTINATION,BYTES);
     3151        9             INPUT:       SOURCE - The source string
     3152       10                          BYTES  - Number of bytes in SOURCE and DESTINATION
     3153       11             OUTPUT:      DESTINATION - The destination string
     3154       12             DESCRIPTION: KIA$9TO8 takes the BYTES bytes long SOURCE string and
     3155       13                          strips off the first BYTES bits and then places the
     3156       14                          remaining BYTES 8-bit chunks into DESTINATION adding
     3157       15                          slack bits as it goes along.
     3158       16
     3159       17                          As the conversion takes place left to right,
     3160       18                          SOURCE and DESTINATION should not overlap unless
     3161       19                          ADDR(SOURCE) >= ADDR(DESTINATION).
     3162       20        */
     3163       21
     3164       22        KIA$9TO8: PROC(SOURCE,DEST,BYTES);
     3165       23        /**/
     3166       24        /**/
     3167       25    1   DCL SOURCE(0:0) UBIN BYTE UNAL;
     3168       26    1   DCL DEST(0:0) UBIN BYTE UNAL;
     3169       27    1   DCL BYTES UBIN;
     3170       28    1   DCL TEMP SBIN;
     3171       29    1   DCL TEMPU REDEF TEMP UBIN;
     3172       30    1   DCL TEMPC REDEF TEMP CHAR(4);
     3173       31    1   DCL TEMPB REDEF TEMP BIT(36);
     3174       32    1   DCL SRC$ PTR;
     3175       33    1   DCL DST$ PTR;
     3176       34    1   DCL TEMPU1 REDEF DST$ UBIN;
     3177       35    1   DCL 1 DPTR REDEF DST$,
     3178       36    1         2 * BIT(18),                      /* WORD OFFSET                        */
     3179       37    1         2 HW BIT(1),                      /* RIGHT HALFWORD FLAG                */
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:595  
     3180       38    1         2 BYT BIT(1),                     /* ODD BYTE FLAG                      */
     3181       39    1         2 BT BIT(4),                      /* NON-BYTE-ALIGNED FLAG              */
     3182       40    1         2 * BIT(12);                      /* SEGID                              */
     3183       41    1   DCL CHRS CALIGNED BASED(DST$) CHAR(BYTES);
     3184       42    1   DCL TEMPU9 UBIN;
     3185       43    1   DCL BYT$8(0:0) UBIN(8) UNAL BASED;
     3186       44    1   DCL BIT$S BIT(TEMPU9) UNAL BASED;
     3187       45    1   DCL SRCEBYT UBIN(8) UNAL BASED(SRC$);
     3188       46    1   DCL 1 DESTBYT CALIGNED BASED(DST$) ,
     3189       47    1         2 BIT1 BIT(1) UNAL,
     3190       48    1         2 BYT UBIN(8) UNAL;
     3191       49
     3192       50    1           TEMPU = BYTES ;
     3193       51    1           SRC$=PINCRB(ADDR(SOURCE),TEMPU);
     3194       52    1           DST$ = ADDR(DEST) ;
     3195       53        /*           DESTBYT.BIT1 = '0'B ;               */
     3196       54    1           DESTBYT.BYT = SRCEBYT ;
     3197       55    1           TEMP = -TEMP;
     3198       56    1           GOTO L2 ;
     3199       57    1   L1:
     3200       58    1           DST$ = PINCRC(DST$,1) ;
     3201       59    1           SRC$ = PINCRB(SRC$,8) ;
     3202       60        /*           DESTBYT.BIT1 = '0'B ;               */
     3203       61    1           DESTBYT.BYT = SRCEBYT ;
     3204       62    1   L2:
     3205       63    1           TEMP = TEMP + 1 ;
     3206       64    1           IF TEMP < 0 THEN
     3207       65    1               GOTO L1 ;
     3208       66
     3209       67    1           RETURN;
     3210       68
     3211       69        /**/
     3212       70        /**/
     3213       71        /*D* NAME:        KIA$8TO9
     3214       72            PURPOSE:     To remove slack bits from data read from the FEP across the coupler
     3215       73             CALL:        CALL KIA$8TO9(SOURCE,DESTINATION,BYTES);
     3216       74             DESCRIPTION: This is the reverse of KIA$9TO8, including the direction
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:596  
     3217       75                          of conversion, implying that overlap requires that
     3218       76                          ADDR(SOURCE) <= ADDR(DESTINATION).
     3219       77        */
     3220       78    1   KIA$8TO9: ENTRY(SOURCE,DEST,BYTES);
     3221       79        /**/
     3222       80        /**/
     3223       81    2           IF ADDR(SOURCE) = ADDR(DEST) THEN DO;
     3224       82        /* If converting in place, try not to use EIS instructions.
     3225       83           Since it's probably in the ICQ, and they'll bleed results into the next
     3226       84           word, sometimes clobbering something important (like the message-free
     3227       85           flag) in a multiprocessing environment. */
     3228       86    2               DST$ = ADDR(SOURCE);
     3229       87    2               IF DPTR.BT THEN EXIT;
     3230       88    2               IF BYTES = 1 THEN RETURN;
     3231       89    2               IF BYTES > 4 THEN EXIT;
     3232       90    2               TEMPC = CHRS;
     3233       91    2               TEMPU = TEMPU + BITBIN(TEMPB&'007FC01FF'X);
     3234       92    2               TEMPU = TEMPU + MOD(TEMPU,262144);
     3235       93    2               TEMPU = TEMPU + MOD(TEMPU,262144);
     3236       94    2               IF BYTES < 3 THEN TEMPU = TEMPU/2;
     3237       95    2                 ELSE IF BYTES > 3 THEN TEMPU = TEMPU/8;
     3238       96    2                     ELSE TEMPU = TEMPU/4;
     3239       97    2               CHRS = TEMPC;
     3240       98    2               RETURN;
     3241       99    2               END;
     3242      100    1           TEMPU = BYTES ; TEMPU9 = TEMPU ;
     3243      101    1           TEMPU1 = 8*TEMPU + TEMPU - 9 ;
     3244      102    1           SRC$ = PINCRB(ADDR(SOURCE),TEMPU1) ;
     3245      103    1           DST$=PINCRB(ADDR(DEST),TEMPU1+1);
     3246      104    1           TEMP = -TEMP;
     3247      105    1           DST$->SRCEBYT = SRC$->DESTBYT.BYT ;
     3248      106    1           GOTO L4 ;
     3249      107    1   L3:
     3250      108    1           SRC$ = PINCRC(SRC$,-1) ;
     3251      109    1           DST$ = PINCRB(DST$,-8) ;
     3252      110    1           DST$->SRCEBYT = SRC$->DESTBYT.BYT ;
     3253      111    1   L4:
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:597  
     3254      112    1           TEMP = TEMP + 1 ;
     3255      113    1           IF TEMP < 0 THEN
     3256      114    1               GOTO L3 ;
     3257      115    1           ADDR(DEST)->BIT$S='0'B;
     3258      116    1           RETURN;
     3259      117    1   END KIA$9TO8;
     3260      118        %EOD;

PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:598  
      No diagnostics issued in procedure KIA$9TO8.

   Procedure KIA$9TO8 requires 120 words for executable code.
   Procedure KIA$9TO8 requires 10 words of local(AUTO) storage.

PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:599  

 Object Unit name= KIA$9TO8                                   File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:39:45.32 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  KIA$9TO8
    1   Proc  even  none   120    170  KIA$9TO8

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        3  KIA$9TO8
     1     37                  yes      Std        3  KIA$8TO9

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B_VECTNIL
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:600  


     3143        1        /*T***********************************************************/
     3144        2        /*T*                                                         */
     3145        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3146        4        /*T*                                                         */
     3147        5        /*T***********************************************************/
     3148        6        /*D* NAME:        KIA$9TO8
     3149        7             PURPOSE:     To ready strings to be sent to the FEP over the coupler
     3150        8             CALL:        CALL KIA$9TO8(SOURCE,DESTINATION,BYTES);
     3151        9             INPUT:       SOURCE - The source string
     3152       10                          BYTES  - Number of bytes in SOURCE and DESTINATION
     3153       11             OUTPUT:      DESTINATION - The destination string
     3154       12             DESCRIPTION: KIA$9TO8 takes the BYTES bytes long SOURCE string and
     3155       13                          strips off the first BYTES bits and then places the
     3156       14                          remaining BYTES 8-bit chunks into DESTINATION adding
     3157       15                          slack bits as it goes along.
     3158       16
     3159       17                          As the conversion takes place left to right,
     3160       18                          SOURCE and DESTINATION should not overlap unless
     3161       19                          ADDR(SOURCE) >= ADDR(DESTINATION).
     3162       20        */
     3163       21
     3164       22        KIA$9TO8: PROC(SOURCE,DEST,BYTES);

     22  1 000000   000000 700200 xent  KIA$9TO8     TSX0  ! X66_AUTO_3
         1 000001   000012 000003                    ZERO    10,3

     3165       23        /**/
     3166       24        /**/
     3167       25    1   DCL SOURCE(0:0) UBIN BYTE UNAL;
     3168       26    1   DCL DEST(0:0) UBIN BYTE UNAL;
     3169       27    1   DCL BYTES UBIN;
     3170       28    1   DCL TEMP SBIN;
     3171       29    1   DCL TEMPU REDEF TEMP UBIN;
     3172       30    1   DCL TEMPC REDEF TEMP CHAR(4);
     3173       31    1   DCL TEMPB REDEF TEMP BIT(36);
     3174       32    1   DCL SRC$ PTR;
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:601  
     3175       33    1   DCL DST$ PTR;
     3176       34    1   DCL TEMPU1 REDEF DST$ UBIN;
     3177       35    1   DCL 1 DPTR REDEF DST$,
     3178       36    1         2 * BIT(18),                      /* WORD OFFSET                        */
     3179       37    1         2 HW BIT(1),                      /* RIGHT HALFWORD FLAG                */
     3180       38    1         2 BYT BIT(1),                     /* ODD BYTE FLAG                      */
     3181       39    1         2 BT BIT(4),                      /* NON-BYTE-ALIGNED FLAG              */
     3182       40    1         2 * BIT(12);                      /* SEGID                              */
     3183       41    1   DCL CHRS CALIGNED BASED(DST$) CHAR(BYTES);
     3184       42    1   DCL TEMPU9 UBIN;
     3185       43    1   DCL BYT$8(0:0) UBIN(8) UNAL BASED;
     3186       44    1   DCL BIT$S BIT(TEMPU9) UNAL BASED;
     3187       45    1   DCL SRCEBYT UBIN(8) UNAL BASED(SRC$);
     3188       46    1   DCL 1 DESTBYT CALIGNED BASED(DST$) ,
     3189       47    1         2 BIT1 BIT(1) UNAL,
     3190       48    1         2 BYT UBIN(8) UNAL;
     3191       49
     3192       50    1           TEMPU = BYTES ;

     50  1 000002   200005 470500                    LDP0    @BYTES,,AUTO
         1 000003   000000 235100                    LDA     0,,PR0
         1 000004   200006 755100                    STA     TEMP,,AUTO

     3193       51    1           SRC$=PINCRB(ADDR(SOURCE),TEMPU);

     51  1 000005   200003 471500                    LDP1    @SOURCE,,AUTO
         1 000006   100000 503505                    ABD     0,AL,PR1
         1 000007   200007 451500                    STP1    SRC$,,AUTO

     3194       52    1           DST$ = ADDR(DEST) ;

     52  1 000010   200004 236100                    LDQ     @DEST,,AUTO
         1 000011   200010 756100                    STQ     DST$,,AUTO

     3195       53        /*           DESTBYT.BIT1 = '0'B ;               */
     3196       54    1           DESTBYT.BYT = SRCEBYT ;

PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:602  
     54  1 000012   200010 473500                    LDP3    DST$,,AUTO
         1 000013   003100 060500                    CSL     bolr='003'O
         1 000014   100000 000010                    BDSC    0,,PR1                   by=0,bit=0,n=8
         1 000015   300000 010010                    BDSC    0,,PR3                   by=0,bit=1,n=8

     3197       55    1           TEMP = -TEMP;

     55  1 000016   200006 335100                    LCA     TEMP,,AUTO
         1 000017   200006 755100                    STA     TEMP,,AUTO

     3198       56    1           GOTO L2 ;

     56  1 000020   000034 710000 1                  TRA     L2

     3199       57    1   L1:
     3200       58    1           DST$ = PINCRC(DST$,1) ;

     58  1 000021   200010 236100       L1           LDQ     DST$,,AUTO
         1 000022   200000 036007                    ADLQ    65536,DL
         1 000023   200010 756100                    STQ     DST$,,AUTO

     3201       59    1           SRC$ = PINCRB(SRC$,8) ;

     59  1 000024   200007 470500                    LDP0    SRC$,,AUTO
         1 000025   000010 220003                    LDX0    8,DU
         1 000026   000000 503510                    ABD     0,X0,PR0
         1 000027   200007 450500                    STP0    SRC$,,AUTO

     3202       60        /*           DESTBYT.BIT1 = '0'B ;               */
     3203       61    1           DESTBYT.BYT = SRCEBYT ;

     61  1 000030   200010 471500                    LDP1    DST$,,AUTO
         1 000031   003100 060500                    CSL     bolr='003'O
         1 000032   000000 000010                    BDSC    0,,PR0                   by=0,bit=0,n=8
         1 000033   100000 010010                    BDSC    0,,PR1                   by=0,bit=1,n=8

     3204       62    1   L2:
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:603  
     3205       63    1           TEMP = TEMP + 1 ;

     63  1 000034   200006 054100       L2           AOS     TEMP,,AUTO

     3206       64    1           IF TEMP < 0 THEN

     64  1 000035   000021 604000 1                  TMI     L1

     3207       65    1               GOTO L1 ;
     3208       66
     3209       67    1           RETURN;

     67  1 000036   000000 702200 xent               TSX2  ! X66_ARET

     3210       68
     3211       69        /**/
     3212       70        /**/
     3213       71        /*D* NAME:        KIA$8TO9
     3214       72            PURPOSE:    To remove slack bits from data read from the FEP across the coupler
     3215       73             CALL:        CALL KIA$8TO9(SOURCE,DESTINATION,BYTES);
     3216       74             DESCRIPTION: This is the reverse of KIA$9TO8, including the direction
     3217       75                          of conversion, implying that overlap requires that
     3218       76                          ADDR(SOURCE) <= ADDR(DESTINATION).
     3219       77        */
     3220       78    1   KIA$8TO9: ENTRY(SOURCE,DEST,BYTES);

     78  1 000037   000000 700200 xent  KIA$8TO9     TSX0  ! X66_AUTO_3
         1 000040   000012 000003                    ZERO    10,3

     3221       79        /**/
     3222       80        /**/
     3223       81    2           IF ADDR(SOURCE) = ADDR(DEST) THEN DO;

     81  1 000041   200003 236100                    LDQ     @SOURCE,,AUTO
         1 000042   200004 116100                    CMPQ    @DEST,,AUTO
         1 000043   000116 601000 1                  TNZ     s:100

PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:604  
     3224       82        /* If converting in place, try not to use EIS instructions.
     3225       83           Since it's probably in the ICQ, and they'll bleed results into the next
     3226       84           word, sometimes clobbering something important (like the message-free
     3227       85           flag) in a multiprocessing environment. */
     3228       86    2               DST$ = ADDR(SOURCE);

     86  1 000044   200010 756100                    STQ     DST$,,AUTO

     3229       87    2               IF DPTR.BT THEN EXIT;

     87  1 000045   200010 236100                    LDQ     DST$,,AUTO
         1 000046   170000 316007                    CANQ    61440,DL
         1 000047   000116 601000 1                  TNZ     s:100

     3230       88    2               IF BYTES = 1 THEN RETURN;

     88  1 000050   200005 470500                    LDP0    @BYTES,,AUTO
         1 000051   000000 235100                    LDA     0,,PR0
         1 000052   000001 115007                    CMPA    1,DL
         1 000053   000055 601000 1                  TNZ     s:89

     88  1 000054   000000 702200 xent               TSX2  ! X66_ARET

     3231       89    2               IF BYTES > 4 THEN EXIT;

     89  1 000055   000005 115007                    CMPA    5,DL
         1 000056   000116 603000 1                  TRC     s:100

     3232       90    2               TEMPC = CHRS;

     90  1 000057   000000 720100                    LXL0    0,,PR0
         1 000060   200010 471500                    LDP1    DST$,,AUTO
         1 000061   040100 100540                    MLR     fill='040'O
         1 000062   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 000063   200006 000004                    ADSC9   TEMP,,AUTO               cn=0,n=4

     3233       91    2               TEMPU = TEMPU + BITBIN(TEMPB&'007FC01FF'X);
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:605  

     91  1 000064   200006 236100                    LDQ     TEMP,,AUTO
         1 000065   000000 376000 0                  ANQ     0
         1 000066   200006 036100                    ADLQ    TEMP,,AUTO
         1 000067   200006 756100                    STQ     TEMP,,AUTO

     3234       92    2               TEMPU = TEMPU + MOD(TEMPU,262144);

     92  1 000070   777777 376007                    ANQ     -1,DL
         1 000071   200006 036100                    ADLQ    TEMP,,AUTO
         1 000072   200006 756100                    STQ     TEMP,,AUTO

     3235       93    2               TEMPU = TEMPU + MOD(TEMPU,262144);

     93  1 000073   777777 376007                    ANQ     -1,DL
         1 000074   200006 036100                    ADLQ    TEMP,,AUTO
         1 000075   200006 756100                    STQ     TEMP,,AUTO

     3236       94    2               IF BYTES < 3 THEN TEMPU = TEMPU/2;

     94  1 000076   000003 115007                    CMPA    3,DL
         1 000077   000103 603000 1                  TRC     s:95

     94  1 000100   000001 772000                    QRL     1
         1 000101   200006 756100                    STQ     TEMP,,AUTO
         1 000102   000112 710000 1                  TRA     s:97

     3237       95    2                 ELSE IF BYTES > 3 THEN TEMPU = TEMPU/8;

     95  1 000103   000004 115007                    CMPA    4,DL
         1 000104   000110 602000 1                  TNC     s:96

     95  1 000105   000003 772000                    QRL     3
         1 000106   200006 756100                    STQ     TEMP,,AUTO
         1 000107   000112 710000 1                  TRA     s:97

     3238       96    2                     ELSE TEMPU = TEMPU/4;
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:606  

     96  1 000110   000002 772000                    QRL     2
         1 000111   200006 756100                    STQ     TEMP,,AUTO

     3239       97    2               CHRS = TEMPC;

     97  1 000112   040140 100500                    MLR     fill='040'O
         1 000113   200006 000004                    ADSC9   TEMP,,AUTO               cn=0,n=4
         1 000114   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

     3240       98    2               RETURN;

     98  1 000115   000000 702200 xent               TSX2  ! X66_ARET

     3241       99    2               END;
     3242      100    1           TEMPU = BYTES ; TEMPU9 = TEMPU ;

    100  1 000116   200005 470500                    LDP0    @BYTES,,AUTO
         1 000117   000000 235100                    LDA     0,,PR0
         1 000120   200006 755100                    STA     TEMP,,AUTO

    100  1 000121   200011 755100                    STA     TEMPU9,,AUTO

     3243      101    1           TEMPU1 = 8*TEMPU + TEMPU - 9 ;

    101  1 000122   200006 236100                    LDQ     TEMP,,AUTO
         1 000123   000003 736000                    QLS     3
         1 000124   200006 036100                    ADLQ    TEMP,,AUTO
         1 000125   000011 136007                    SBLQ    9,DL
         1 000126   200010 756100                    STQ     DST$,,AUTO

     3244      102    1           SRC$ = PINCRB(ADDR(SOURCE),TEMPU1) ;

    102  1 000127   200003 471500                    LDP1    @SOURCE,,AUTO
         1 000130   100000 503506                    ABD     0,QL,PR1
         1 000131   200007 451500                    STP1    SRC$,,AUTO

PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:607  
     3245      103    1           DST$=PINCRB(ADDR(DEST),TEMPU1+1);

    103  1 000132   200004 473500                    LDP3    @DEST,,AUTO
         1 000133   200010 235100                    LDA     DST$,,AUTO
         1 000134   000001 035007                    ADLA    1,DL
         1 000135   300000 503505                    ABD     0,AL,PR3
         1 000136   200010 453500                    STP3    DST$,,AUTO

     3246      104    1           TEMP = -TEMP;

    104  1 000137   200006 335100                    LCA     TEMP,,AUTO
         1 000140   200006 755100                    STA     TEMP,,AUTO

     3247      105    1           DST$->SRCEBYT = SRC$->DESTBYT.BYT ;

    105  1 000141   003100 060500                    CSL     bolr='003'O
         1 000142   100000 010010                    BDSC    0,,PR1                   by=0,bit=1,n=8
         1 000143   300000 000010                    BDSC    0,,PR3                   by=0,bit=0,n=8

     3248      106    1           GOTO L4 ;

    106  1 000144   000160 710000 1                  TRA     L4

     3249      107    1   L3:
     3250      108    1           SRC$ = PINCRC(SRC$,-1) ;

    108  1 000145   200007 236100       L3           LDQ     SRC$,,AUTO
         1 000146   000034 036000 xsym               ADLQ    B_VECTNIL+28
         1 000147   200007 756100                    STQ     SRC$,,AUTO

     3251      109    1           DST$ = PINCRB(DST$,-8) ;

    109  1 000150   200010 470500                    LDP0    DST$,,AUTO
         1 000151   000010 220003                    LDX0    8,DU
         1 000152   000000 523510                    SBD     0,X0,PR0
         1 000153   200010 450500                    STP0    DST$,,AUTO

PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:608  
     3252      110    1           DST$->SRCEBYT = SRC$->DESTBYT.BYT ;

    110  1 000154   200007 471500                    LDP1    SRC$,,AUTO
         1 000155   003100 060500                    CSL     bolr='003'O
         1 000156   100000 010010                    BDSC    0,,PR1                   by=0,bit=1,n=8
         1 000157   000000 000010                    BDSC    0,,PR0                   by=0,bit=0,n=8

     3253      111    1   L4:
     3254      112    1           TEMP = TEMP + 1 ;

    112  1 000160   200006 054100       L4           AOS     TEMP,,AUTO

     3255      113    1           IF TEMP < 0 THEN

    113  1 000161   000145 604000 1                  TMI     L3

     3256      114    1               GOTO L3 ;
     3257      115    1           ADDR(DEST)->BIT$S='0'B;

    115  1 000162   200004 470500                    LDP0    @DEST,,AUTO
         1 000163   200011 720100                    LXL0    TEMPU9,,AUTO
         1 000164   003140 060400                    CSL     bolr='003'O
         1 000165   000002 000001 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=1
         1 000166   000000 000010                    BDSC    0,,PR0                   by=0,bit=0,n=*X0

     3258      116    1           RETURN;

    116  1 000167   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   0     000   000777 000777                                                    ....
     3259      117    1   END KIA$9TO8;
     3260      118        %EOD;

PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:609  
      No diagnostics issued in procedure KIA$9TO8.
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:610  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @BYTES                     4-0-0/w PTR         r     1 @DEST
     3-0-0/w PTR         r     1 @SOURCE                   *0-0-0/w UBIN        r     1 BYTES
    *0-0-0/b UBIN(9)     r     1 DEST(0:0)                 10-0-0/w STRC        r     1 DPTR
    10-0-0/w PTR         r     1 DST$                      *0-0-0/b UBIN(9)     r     1 SOURCE(0:0)
     7-0-0/w PTR         r     1 SRC$                       6-0-0/w SBIN        r     1 TEMP
     6-0-0/w BIT         r     1 TEMPB                      6-0-0/w CHAR(4)     r     1 TEMPC
     6-0-0/w UBIN        r     1 TEMPU                     10-0-0/w UBIN        r     1 TEMPU1
    11-0-0/w UBIN        r     1 TEMPU9

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b ABIT        r     1 BIT$S                      0-0-0/c ACHR        r     1 CHRS
     0-0-0/c STRC(9)     r     1 DESTBYT                    0-0-0/b UBIN(8)     r     1 SRCEBYT


   Procedure KIA$9TO8 requires 120 words for executable code.
   Procedure KIA$9TO8 requires 10 words of local(AUTO) storage.
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:611  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:612  
          MINI XREF LISTING

BIT$S
        44**DCL       115<<ASSIGN
BYTES
        27**DCL        22--PROC       41--IMP-SIZ    50>>ASSIGN     78--ENTRY      88>>IF         89>>IF
        90>>ASSIGN     94>>IF         95>>IF         97>>ASSIGN    100>>ASSIGN
CHRS
        41**DCL        90>>ASSIGN     97<<ASSIGN
DEST
        26**DCL        22--PROC       52--ASSIGN     78--ENTRY      81--IF        103--ASSIGN    115--ASSIGN
DESTBYT.BYT
        48**DCL        54<<ASSIGN     61<<ASSIGN    105>>ASSIGN    110>>ASSIGN
DPTR.BT
        39**DCL        87>>IF
DST$
        33**DCL        34--REDEF      35--REDEF      41--IMP-PTR    46--IMP-PTR    52<<ASSIGN     54>>ASSIGN
        58<<ASSIGN     58>>ASSIGN     61>>ASSIGN     86<<ASSIGN     90>>ASSIGN     97>>ASSIGN    103<<ASSIGN
       105>>ASSIGN    109<<ASSIGN    109>>ASSIGN    110>>ASSIGN
L1
        58**LABEL      65--GOTO
L2
        63**LABEL      56--GOTO
L3
       108**LABEL     114--GOTO
L4
       112**LABEL     106--GOTO
SOURCE
        25**DCL        22--PROC       51--ASSIGN     78--ENTRY      81--IF         86--ASSIGN    102--ASSIGN
SRC$
        32**DCL        45--IMP-PTR    51<<ASSIGN     54>>ASSIGN     59<<ASSIGN     59>>ASSIGN     61>>ASSIGN
       102<<ASSIGN    105>>ASSIGN    108<<ASSIGN    108>>ASSIGN    110>>ASSIGN
SRCEBYT
        45**DCL        54>>ASSIGN     61>>ASSIGN    105<<ASSIGN    110<<ASSIGN
PL6.E3A0      #013=KIA$9TO8 File=KIA$APPLC.:E05TSI                               WED 07/30/97 00:39 Page:613  
TEMP
        28**DCL        29--REDEF      30--REDEF      31--REDEF      55<<ASSIGN     55>>ASSIGN     63<<ASSIGN
        63>>ASSIGN     64>>IF        104<<ASSIGN    104>>ASSIGN    112<<ASSIGN    112>>ASSIGN    113>>IF
TEMPB
        31**DCL        91>>ASSIGN
TEMPC
        30**DCL        90<<ASSIGN     97>>ASSIGN
TEMPU
        29**DCL        50<<ASSIGN     51>>ASSIGN     91<<ASSIGN     91>>ASSIGN     92<<ASSIGN     92>>ASSIGN
        92>>ASSIGN     93<<ASSIGN     93>>ASSIGN     93>>ASSIGN     94<<ASSIGN     94>>ASSIGN     95<<ASSIGN
        95>>ASSIGN     96<<ASSIGN     96>>ASSIGN    100<<ASSIGN    100>>ASSIGN    101>>ASSIGN    101>>ASSIGN
TEMPU1
        34**DCL       101<<ASSIGN    102>>ASSIGN    103>>ASSIGN
TEMPU9
        42**DCL        44--IMP-SIZ   100<<ASSIGN    115>>ASSIGN

PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:614  
     3261        1        /*T***********************************************************/
     3262        2        /*T*                                                         */
     3263        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3264        4        /*T*                                                         */
     3265        5        /*T***********************************************************/
     3266        6        /*D* NAME:        KIA$GETEVNT
     3267        7             PURPOSE:     To obtain the EVENT value from this LDCT's DCB
     3268        8             CALL:        CALL KIA$GETEVNT (NK$LDCT,EVNT);
     3269        9             INPUT:       NK$LDCT - The LDCT
     3270       10             OUTPUT:      EVNT - The DCB's event value or zero if no DCB or no
     3271       11                                 user in the LDCT.
     3272       12             DESCRIPTION: KIA$GETEVNT maps onto this LDCT's user's ROSEG and
     3273       13                          obtains the event from this LDCT's DCB. EVNT is returned
     3274       14                          as zero if no event is to be found.
     3275       15        */
     3276       16
     3277       17        KIA$GETEVNT: PROC(NK$LDCT,PRM2,DMN);
     3278       18        %INCLUDE B$ROSEG;
     3279       81        %INCLUDE B$USER;
     3280      297        %INCLUDE B_SEGIDS_C;
     3281      836        %INCLUDE B_STRINGS_C;
     3282      965        %INCLUDE CP_6;
     3283     6524        %INCLUDE CP_6_SUBS;
     3284     7064        %INCLUDE F$DCB;
     3285     7113        %INCLUDE FM$MACROS;
     3286     7488        %INCLUDE HF_LOCK_C;
     3287     7502        %INCLUDE K$RWPARM;
     3288     7888        %INCLUDE NK$LDCT;
     3289     7990        %INCLUDE SS_SCHED_C;
     3290     8223        %INCLUDE S_WSPTD_R;
     3291     8239        %INCLUDE HF_DATA_R;
     3292     8282        /**/
     3293     8283
     3294     8284        /* Equates */
     3295     8285        %SUB_EXC;
     3296     8332
     3297     8333        /* Parameters */
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:615  
     3298     8334        /**/
     3299     8335        %NK$LDCT(STCLASS="");
     3300     8381    1   DCL PRM2 CHAR(EVNT) ALIGNED;
     3301     8382    1   DCL EVNT REDEF PRM2 UBIN ALIGNED;
     3302     8383        %K$RWPARM (NAME=K$RWPARM,STCLASS=REDEF PRM2);
     3303     8699    1   DCL DMN UBIN;
     3304     8700        /**/
     3305     8701        /* AUTO variables */
     3306     8702        /**/
     3307     8703    1   DCL P$ PTR;
     3308     8704    1   DCL 1 P REDEF P$,
     3309     8705    1         2 * BIT(24) UNAL,
     3310     8706    1         2 SEGID BIT(12) UNAL;
     3311     8707    1   DCL USRT$ PTR;
     3312     8708    1   DCL MEDDCB$ PTR;
     3313     8709    1   DCL DCBPTR$ PTR;
     3314     8710    1   DCL MSGSIZE UBIN;
     3315     8711    1   DCL BUFSIZE UBIN;
     3316     8712    1   DCL EVID REDEF BUFSIZE UBIN;
     3317     8713    1   DCL XDMN UBIN;
     3318     8714    1   DCL WAIT BIT(1);
     3319     8715        %B$NWIO (NAME=NWIO,STCLASS=AUTO,PARONLY=1);
     3320     8796
     3321     8797        /* Based */
     3322     8798    1   DCL 1 B$$XFPTW BASED,
     3323     8799    1         2 PP(0:1) BIT(18) ALIGNED;
     3324     8800    1   DCL BUFFER CHAR(BUFSIZE) BASED;
     3325     8801    1   DCL MESSAGE CHAR(MSGSIZE) BASED;
     3326     8802    1   DCL 1 BFEPIO BASED,
     3327     8803    1         2 *(0:1) UBIN ALIGNED,
     3328     8804    1         2 BPPWORD UBIN ALIGNED;
     3329     8805        /**/
     3330     8806        /* CONSTANT */
     3331     8807        /**/
     3332     8808    1   DCL TWOPTWS(0:1) UBIN INIT(48*2) CONSTANT; /* 48= PRESENT AND WRITABLE        */
     3333     8809        /**/
     3334     8810        /* SYMREF variables */
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:616  
     3335     8811        /**/
     3336     8812    1   DCL B$ROSEG8$ PTR SYMREF;
     3337     8813    1   DCL B$USRT$ PTR SYMREF;
     3338     8814    1   DCL F_DCBLOCK BIT(72) SYMREF;
     3339     8815    1   DCL KQ_XFGATE BIT(72) DALIGNED SYMREF;
     3340     8816    1   DCL NI_MFGATE BIT(72) SYMREF;
     3341     8817    1   DCL B$CGPT$ PTR SYMREF;
     3342     8818    1   DCL B$CGCTXT$ PTR SYMREF;
     3343     8819        /**/
     3344     8820        /* External procedures */
     3345     8821        /**/
     3346     8822    1   DCL HFC$ASSOCCLR ENTRY (3);
     3347     8823    1   DCL HFF$TRAPALT ENTRY ALTRET;
     3348     8824    1   DCL KIA$MSG ENTRY(1) ALTRET;
     3349     8825    1   DCL SSR$RUE ENTRY(4);
     3350     8826    1   DCL SSV$EVENT ENTRY(7);
     3351     8827
     3352     8828    2           IF NK$LDCT.DCBNO=0 OR NK$LDCT.USER=0 THEN DO;
     3353     8829    2               EVNT=0;
     3354     8830    2               RETURN;
     3355     8831    2               END;
     3356     8832    2           DO INHIBIT;                     /* I/O interrupt could clobber        */
     3357     8833                                                /* WSQ 8 while we are using it.       */
     3358     8834    2             S_WSPTD.BLKNO(%IOENDWSQ)=B$USRT$->B$USER.PT(NK$LDCT.USER);
     3359     8835                                                /* Map onto the user in order to see  */
     3360     8836                                                /* his ROSEG.                         */
     3361     8837    2             CALL HFC$ASSOCCLR(%IOENDWSQ,0,16384); /*MAX Dense PT*/
     3362     8838    3             IF NK$LDCT.DCBNO > B$ROSEG8$->B$ROSEG.NUMDCBS THEN DO;
     3363     8839    3                 EVNT = 0;
     3364     8840    3                 RETURN;
     3365     8841    3                 END;
     3366     8842    2             P$=B$ROSEG8$->B$ROSEG.DCBPTR$;
     3367     8843    2             P.SEGID=%ROSEG8SID;
     3368     8844    2             P$=P$->B$RODCB$(NK$LDCT.DCBNO);
     3369     8845    2             P.SEGID=%ROSEG8SID;
     3370     8846    2             EVNT=P$->F$DCB.EVENT;
     3371     8847    2             IF ADDR(DMN) ~= ADDR(NIL) THEN
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:617  
     3372     8848    3               DO;
     3373     8849    3                 DMN = P$->F$DCB.WSR;
     3374     8850    3                 END;
     3375     8851    2             END;
     3376     8852    1           RETURN;
     3377     8853        %EJECT;
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:618  
     3378     8854    1   KIA$COMP: ENTRY(NK$LDCT,PRM2);
     3379     8855
     3380     8856    1           USRT$ = ADDR(B$USRT$->B$USER(NK$LDCT.USER));
     3381     8857
     3382     8858        /*
     3383     8859             Map in the user into the input output end action WSQ
     3384     8860         */
     3385     8861                %LOCK (G=F_DCBLOCK);
     3386     8864    1           S_WSPTD.BLKNO(%IOENDWSQ) = USRT$->B$USER.PT(0);
     3387     8865    1           CALL HFC$ASSOCCLR (%IOENDWSQ,0,16384); /*MAX Dense PT*/
     3388     8866
     3389     8867        /*
     3390     8868             Get pointers to the DCBs in the IOENDROS
     3391     8869         */
     3392     8870    1           P$ = B$ROSEG8$->B$ROSEG.DCBPTR$;
     3393     8871    1           P.SEGID = %ROSEG8SID;
     3394     8872    1           DCBPTR$ = P$;
     3395     8873    1           P$ = DCBPTR$->B$RODCB$(NK$LDCT.DCBNO);
     3396     8874    1           P.SEGID = %ROSEG8SID;
     3397     8875    1           MEDDCB$ = P$;
     3398     8876
     3399     8877        /*
     3400     8878             Decrement the count in the DCB
     3401     8879         */
     3402     8880    1           WAIT = MEDDCB$->F$DCB.FCN.F(0);
     3403     8881    1           MEDDCB$->F$DCB.FCN(0) = BINBIT(MEDDCB$->F$DCB.FCN.CNT(0) - 1, 9);
     3404     8882
     3405     8883        /*
     3406     8884             Check to see if there is a streamed DCB that the function
     3407     8885             count must be decremented in
     3408     8886         */
     3409     8887    1           IF NK$LDCT.NOWAIT.DCB# ~= NK$LDCT.DCBNO
     3410     8888    1             AND DCBPTR$->B$RODCB$(NK$LDCT.NOWAIT.DCB#) ~= ADDR(NIL)
     3411     8889    2             THEN DO;
     3412     8890    2               P$ = DCBPTR$->B$RODCB$(NK$LDCT.NOWAIT.DCB#);
     3413     8891    2               P.SEGID = %ROSEG8SID;
     3414     8892    2               WAIT = WAIT | P$->F$DCB.FCN.F(0);
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:619  
     3415     8893    2               P$->F$DCB.FCN(0) = BINBIT(P$->F$DCB.FCN.CNT(0) - 1, 9);
     3416     8894    2               END;
     3417     8895        /*
     3418     8896             Decrement the master function count in the user table
     3419     8897         */
     3420     8898                %LOCK (G=NI_MFGATE);
     3421     8901    1           USRT$->B$USER.CMF(0) = USRT$->B$USER.CMF(0) - 1;
     3422     8902    1           IF NOT WAIT THEN
     3423     8903    1               USRT$->B$USER.MF(0) = USRT$->B$USER.MF(0) - 1;
     3424     8904                %UNLOCK (G=NI_MFGATE);
     3425     8907
     3426     8908        /*
     3427     8909             Get ready for the transfer.  We map the user's buffer and key
     3428     8910             buffer by placing his PTWs for the buffer and key into the
     3429     8911             page table slots for $LS116.
     3430     8912         */
     3431     8913                %LOCK (G=KQ_XFGATE);
     3432     8916    1           CALL HFF$TRAPALT ALTRET(BADBUF);
     3433     8917    1           IF MEDDCB$->F$DCB.FEPSIZ.BUF~=0 AND K$RWPARM.MSG$~=ADDR(NIL)
     3434     8918    2             THEN DO;
     3435     8919    2               B$CGPT$->B$$XFPTW = TWOPTWS;
     3436     8920    2               B$CGPT$->B$$XFPTW.PP(0) = MEDDCB$->F$DCB.FEPIO.BPP(0);
     3437     8921    2               B$CGPT$->B$$XFPTW.PP(1) = MEDDCB$->F$DCB.FEPIO.BPP(1);
     3438     8922    2               CALL HFC$ASSOCCLR (%IOENDWSQ,0,2);
     3439     8923    2               MSGSIZE = MINIMUM (K$RWPARM.MSGSZ, MEDDCB$->F$DCB.FEPSIZ.BUF);
     3440     8924    2               PINCRC(B$CGCTXT$,MEDDCB$->F$DCB.FEPIO.BUFX)->MESSAGE =
     3441     8925    2                 K$RWPARM.MSG$->MESSAGE;
     3442     8926    2               END;
     3443     8927
     3444     8928        /*
     3445     8929             Now move the key if necessary
     3446     8930         */
     3447     8931    1           IF MEDDCB$->F$DCB.FEPSIZ.KEY~=0 AND K$RWPARM.KEY$~=ADDR(NIL)
     3448     8932    2             THEN DO;
     3449     8933    2               B$CGPT$->B$$XFPTW = TWOPTWS;
     3450     8934    2               B$CGPT$->B$$XFPTW.PP(0) = MEDDCB$->F$DCB.FEPIO.KPP(0);
     3451     8935    2               B$CGPT$->B$$XFPTW.PP(1) = MEDDCB$->F$DCB.FEPIO.KPP(1);
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:620  
     3452     8936    2               CALL HFC$ASSOCCLR (%IOENDWSQ,0,2);
     3453     8937    2               MSGSIZE = MINIMUM (K$RWPARM.KEYSZ, MEDDCB$->F$DCB.FEPSIZ.KEY);
     3454     8938    2               PINCRC(B$CGCTXT$,MEDDCB$->F$DCB.FEPIO.KEYX)->MESSAGE =
     3455     8939    2                 K$RWPARM.KEY$->MESSAGE;
     3456     8940    2               END;
     3457     8941    2           DO WHILE('0'B);
     3458     8942    2   BADBUF:   K$RWPARM.TYC = K$RWPARM.TYC | %TYC_MTRAP;
     3459     8943    2             END;
     3460     8944                %UNLOCK (G=KQ_XFGATE);
     3461     8947
     3462     8948        /*
     3463     8949             Report an I/O complete event on the user
     3464     8950         */
     3465     8951    1           NWIO = '0'B;
     3466     8952    1           NWIO.P# = SIZEW(NWIO) - SIZEW(NWIO.P#);
     3467     8953    1           NWIO.TYC = K$RWPARM.TYC;
     3468     8954    1           NWIO.ARS = K$RWPARM.MSGSZ;
     3469     8955    1           NWIO.DVE.DVBYTE = K$RWPARM.DVE.DVBYTE;
     3470     8956    1           NWIO.DVE.EOMCHAR = K$RWPARM.DVE.EOMCHAR;
     3471     8957    1           NWIO.IOERRCODE = K$RWPARM.MSG_ERRCODE;
     3472     8958    1           XDMN = NK$LDCT.NOWAIT.DMN;
     3473     8959    1           EVID = MEDDCB$->F$DCB.FEPIO.EVENT;
     3474     8960
     3475     8961        /*
     3476     8962             Move the results into the DCBs
     3477     8963         */
     3478     8964    1           P$->F$DCB.DVBYTE = K$RWPARM.DVE.DVBYTE;
     3479     8965    1           P$->F$DCB.EOMCHAR = K$RWPARM.DVE.EOMCHAR;
     3480     8966    1           P$->F$DCB.ARS = K$RWPARM.MSGSZ;
     3481     8967    1           MEDDCB$->F$DCB.DVBYTE = K$RWPARM.DVE.DVBYTE;
     3482     8968    1           MEDDCB$->F$DCB.EOMCHAR = K$RWPARM.DVE.EOMCHAR;
     3483     8969    1           MEDDCB$->F$DCB.ARS = K$RWPARM.MSGSZ;
     3484     8970
     3485     8971        /*
     3486     8972             Reset the no wait pending flag in the LDCT if it's the last one.
     3487     8973         */
     3488     8974    1           IF ADDR( MEDDCB$->F$DCB.FEPIO2)->BFEPIO.BPPWORD = 0
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:621  
     3489     8975    1             THEN NK$LDCT.LKFLG.NOWAIT = '0'B;
     3490     8976    1           MEDDCB$->F$DCB.FEPIO = MEDDCB$->F$DCB.FEPIO2;
     3491     8977    1           MEDDCB$->F$DCB.FEPIO2 = MEDDCB$->F$DCB.FEPIO3;
     3492     8978    1           ADDR( MEDDCB$->F$DCB.FEPIO3)->BFEPIO.BPPWORD = 0;
     3493     8979                %UNLOCK (G=F_DCBLOCK);
     3494     8982    1           IF WAIT THEN
     3495     8983    1               CALL SSR$RUE (%SS_IOCU,NK$LDCT.USER);
     3496     8984    1           CALL SSV$EVENT(NK$LDCT.USER,XDMN,%SUBC_IO#,EVID,K$RWPARM.MSG_ERRCODE,ADDR(
              8984                    NWIO));
     3497     8985    1           CALL SSR$RUE (%SS_FPEVNT,NK$LDCT.USER);
     3498     8986    1           RETURN;
     3499     8987
     3500     8988    1   END KIA$GETEVNT;
     3501     8989        %EOD;

PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:622  
--  Include file information  --

   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   S_WSPTD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$GETEVNT.

   Procedure KIA$GETEVNT requires 351 words for executable code.
   Procedure KIA$GETEVNT requires 36 words of local(AUTO) storage.

PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:623  

 Object Unit name= KIA$GETEVNT                                File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:39:53.52 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS      3      3  KIA$GETEVNT
    2   Proc  even  none   351    537  KIA$GETEVNT
    3  RoData even  none    17     21  KIA$GETEVNT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        3  KIA$GETEVNT
     2     74                  yes      Std        2  KIA$COMP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       3 HFC$ASSOCCLR
         yes           Std       1 HFC$UNLOCK
         yes           Std       1 HFC$LOCK
 yes     yes           Std       0 HFF$TRAPALT
         yes           Std       7 SSV$EVENT
         yes           Std       4 SSR$RUE
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:624  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  S_WSPTD                               B$ROSEG8$
     B$USRT$                               F_DCBLOCK                             KQ_XFGATE
     NI_MFGATE                             B$CGPT$                               B$CGCTXT$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:625  


     3261        1        /*T***********************************************************/
     3262        2        /*T*                                                         */
     3263        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3264        4        /*T*                                                         */
     3265        5        /*T***********************************************************/
     3266        6        /*D* NAME:        KIA$GETEVNT
     3267        7             PURPOSE:     To obtain the EVENT value from this LDCT's DCB
     3268        8             CALL:        CALL KIA$GETEVNT (NK$LDCT,EVNT);
     3269        9             INPUT:       NK$LDCT - The LDCT
     3270       10             OUTPUT:      EVNT - The DCB's event value or zero if no DCB or no
     3271       11                                 user in the LDCT.
     3272       12             DESCRIPTION: KIA$GETEVNT maps onto this LDCT's user's ROSEG and
     3273       13                          obtains the event from this LDCT's DCB. EVNT is returned
     3274       14                          as zero if no event is to be found.
     3275       15        */
     3276       16
     3277       17        KIA$GETEVNT: PROC(NK$LDCT,PRM2,DMN);

     17  2 000000   000000 700200 xent  KIA$GETEVNT  TSX0  ! X66_AUTO_3
         2 000001   000044 000003                    ZERO    36,3

     3278       18        %INCLUDE B$ROSEG;
     3279       81        %INCLUDE B$USER;
     3280      297        %INCLUDE B_SEGIDS_C;
     3281      836        %INCLUDE B_STRINGS_C;
     3282      965        %INCLUDE CP_6;
     3283     6524        %INCLUDE CP_6_SUBS;
     3284     7064        %INCLUDE F$DCB;
     3285     7113        %INCLUDE FM$MACROS;
     3286     7488        %INCLUDE HF_LOCK_C;
     3287     7502        %INCLUDE K$RWPARM;
     3288     7888        %INCLUDE NK$LDCT;
     3289     7990        %INCLUDE SS_SCHED_C;
     3290     8223        %INCLUDE S_WSPTD_R;
     3291     8239        %INCLUDE HF_DATA_R;
     3292     8282        /**/
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:626  
     3293     8283
     3294     8284        /* Equates */
     3295     8285        %SUB_EXC;
     3296     8332
     3297     8333        /* Parameters */
     3298     8334        /**/
     3299     8335        %NK$LDCT(STCLASS="");
     3300     8381    1   DCL PRM2 CHAR(EVNT) ALIGNED;
     3301     8382    1   DCL EVNT REDEF PRM2 UBIN ALIGNED;
     3302     8383        %K$RWPARM (NAME=K$RWPARM,STCLASS=REDEF PRM2);
     3303     8699    1   DCL DMN UBIN;
     3304     8700        /**/
     3305     8701        /* AUTO variables */
     3306     8702        /**/
     3307     8703    1   DCL P$ PTR;
     3308     8704    1   DCL 1 P REDEF P$,
     3309     8705    1         2 * BIT(24) UNAL,
     3310     8706    1         2 SEGID BIT(12) UNAL;
     3311     8707    1   DCL USRT$ PTR;
     3312     8708    1   DCL MEDDCB$ PTR;
     3313     8709    1   DCL DCBPTR$ PTR;
     3314     8710    1   DCL MSGSIZE UBIN;
     3315     8711    1   DCL BUFSIZE UBIN;
     3316     8712    1   DCL EVID REDEF BUFSIZE UBIN;
     3317     8713    1   DCL XDMN UBIN;
     3318     8714    1   DCL WAIT BIT(1);
     3319     8715        %B$NWIO (NAME=NWIO,STCLASS=AUTO,PARONLY=1);
     3320     8796
     3321     8797        /* Based */
     3322     8798    1   DCL 1 B$$XFPTW BASED,
     3323     8799    1         2 PP(0:1) BIT(18) ALIGNED;
     3324     8800    1   DCL BUFFER CHAR(BUFSIZE) BASED;
     3325     8801    1   DCL MESSAGE CHAR(MSGSIZE) BASED;
     3326     8802    1   DCL 1 BFEPIO BASED,
     3327     8803    1         2 *(0:1) UBIN ALIGNED,
     3328     8804    1         2 BPPWORD UBIN ALIGNED;
     3329     8805        /**/
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:627  
     3330     8806        /* CONSTANT */
     3331     8807        /**/
     3332     8808    1   DCL TWOPTWS(0:1) UBIN INIT(48*2) CONSTANT; /* 48= PRESENT AND WRITABLE        */
     3333     8809        /**/
     3334     8810        /* SYMREF variables */
     3335     8811        /**/
     3336     8812    1   DCL B$ROSEG8$ PTR SYMREF;
     3337     8813    1   DCL B$USRT$ PTR SYMREF;
     3338     8814    1   DCL F_DCBLOCK BIT(72) SYMREF;
     3339     8815    1   DCL KQ_XFGATE BIT(72) DALIGNED SYMREF;
     3340     8816    1   DCL NI_MFGATE BIT(72) SYMREF;
     3341     8817    1   DCL B$CGPT$ PTR SYMREF;
     3342     8818    1   DCL B$CGCTXT$ PTR SYMREF;
     3343     8819        /**/
     3344     8820        /* External procedures */
     3345     8821        /**/
     3346     8822    1   DCL HFC$ASSOCCLR ENTRY (3);
     3347     8823    1   DCL HFF$TRAPALT ENTRY ALTRET;
     3348     8824    1   DCL KIA$MSG ENTRY(1) ALTRET;
     3349     8825    1   DCL SSR$RUE ENTRY(4);
     3350     8826    1   DCL SSV$EVENT ENTRY(7);
     3351     8827
     3352     8828    2           IF NK$LDCT.DCBNO=0 OR NK$LDCT.USER=0 THEN DO;

   8828  2 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000003   000014 236100                    LDQ     12,,PR0
         2 000004   000777 316007                    CANQ    511,DL
         2 000005   000011 600000 2                  TZE     s:8829
         2 000006   000007 236100                    LDQ     7,,PR0
         2 000007   000777 316003                    CANQ    511,DU
         2 000010   000014 601000 2                  TNZ     s:8834

     3353     8829    2               EVNT=0;

   8829  2 000011   200004 471500                    LDP1    @PRM2,,AUTO
         2 000012   100000 450100                    STZ     0,,PR1

PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:628  
     3354     8830    2               RETURN;

   8830  2 000013   000000 702200 xent               TSX2  ! X66_ARET

     3355     8831    2               END;
     3356     8832    2           DO INHIBIT;                     /* I/O interrupt could clobber        */

     3357     8833                                                /* WSQ 8 while we are using it.       */
     3358     8834    2             S_WSPTD.BLKNO(%IOENDWSQ)=B$USRT$->B$USER.PT(NK$LDCT.USER);

   8834  2 000014   000007 236300                    LDQ   ! 7,,PR0
         2 000015   000016 772200                    QRL   ! 14
         2 000016   017760 376207                    ANQ   ! 8176,DL
         2 000017   000000 471600 xsym               LDP1  ! B$USRT$
         2 000020   100014 220306                    LDX0  ! 12,QL,PR1
         2 000021   000007 740200 xsym               STX0  ! S_WSPTD+7

     3359     8835                                                /* Map onto the user in order to see  */
     3360     8836                                                /* his ROSEG.                         */
     3361     8837    2             CALL HFC$ASSOCCLR(%IOENDWSQ,0,16384); /*MAX Dense PT*/

   8837  2 000022   000001 630600 3                  EPPR0 ! 1
         2 000023   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         2 000024   000000 701200 xent               TSX1  ! HFC$ASSOCCLR
         2 000025   000000 011200                    NOP   ! 0

     3362     8838    3             IF NK$LDCT.DCBNO > B$ROSEG8$->B$ROSEG.NUMDCBS THEN DO;

   8838  2 000026   200003 470700                    LDP0  ! @NK$LDCT,,AUTO
         2 000027   000014 236300                    LDQ   ! 12,,PR0
         2 000030   000033 736200                    QLS   ! 27
         2 000031   000033 732200                    QRS   ! 27
         2 000032   200034 756300                    STQ   ! NWIO+14,,AUTO
         2 000033   000000 471600 xsym               LDP1  ! B$ROSEG8$
         2 000034   100002 236300                    LDQ   ! 2,,PR1
         2 000035   000022 772200                    QRL   ! 18
         2 000036   200034 116300                    CMPQ  ! NWIO+14,,AUTO
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:629  
         2 000037   000043 605200 2                  TPL   ! s:8842

     3363     8839    3                 EVNT = 0;

   8839  2 000040   200004 473700                    LDP3  ! @PRM2,,AUTO
         2 000041   300000 450300                    STZ   ! 0,,PR3

     3364     8840    3                 RETURN;

   8840  2 000042   000000 702200 xent               TSX2  ! X66_ARET

     3365     8841    3                 END;
     3366     8842    2             P$=B$ROSEG8$->B$ROSEG.DCBPTR$;

   8842  2 000043   100000 236300                    LDQ   ! 0,,PR1
         2 000044   200006 756300                    STQ   ! P$,,AUTO

     3367     8843    2             P.SEGID=%ROSEG8SID;

   8843  2 000045   006125 236207                    LDQ   ! 3157,DL
         2 000046   200006 752303                    STCQ  ! P$,'03'O,AUTO

     3368     8844    2             P$=P$->B$RODCB$(NK$LDCT.DCBNO);

   8844  2 000047   000014 236300                    LDQ   ! 12,,PR0
         2 000050   000033 736200                    QLS   ! 27
         2 000051   000033 732200                    QRS   ! 27
         2 000052   200006 473700                    LDP3  ! P$,,AUTO
         2 000053   300000 236306                    LDQ   ! 0,QL,PR3
         2 000054   200006 756300                    STQ   ! P$,,AUTO

     3369     8845    2             P.SEGID=%ROSEG8SID;

   8845  2 000055   006125 236207                    LDQ   ! 3157,DL
         2 000056   200006 752303                    STCQ  ! P$,'03'O,AUTO

     3370     8846    2             EVNT=P$->F$DCB.EVENT;
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:630  

   8846  2 000057   200006 473700                    LDP3  ! P$,,AUTO
         2 000060   300055 235300                    LDA   ! 45,,PR3
         2 000061   200004 474700                    LDP4  ! @PRM2,,AUTO
         2 000062   400000 755300                    STA   ! 0,,PR4

     3371     8847    2             IF ADDR(DMN) ~= ADDR(NIL) THEN

   8847  2 000063   200005 236300                    LDQ   ! @DMN,,AUTO
         2 000064   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         2 000065   000073 600200 2                  TZE   ! s:8852

     3372     8848    3               DO;

     3373     8849    3                 DMN = P$->F$DCB.WSR;

   8849  2 000066   200005 471700                    LDP1  ! @DMN,,AUTO
         2 000067   300040 236300                    LDQ   ! 32,,PR3
         2 000070   000022 772200                    QRL   ! 18
         2 000071   000777 376207                    ANQ   ! 511,DL
         2 000072   100000 756300                    STQ   ! 0,,PR1

     3374     8850    3                 END;

     3375     8851    2             END;

     3376     8852    1           RETURN;

   8852  2 000073   000000 702200 xent               TSX2  ! X66_ARET

     3377     8853        %EJECT;
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:631  
     3378     8854    1   KIA$COMP: ENTRY(NK$LDCT,PRM2);

   8854  2 000074   000000 700200 xent  KIA$COMP     TSX0  ! X66_AUTO_3
         2 000075   000044 000003                    ZERO    36,3

     3379     8855
     3380     8856    1           USRT$ = ADDR(B$USRT$->B$USER(NK$LDCT.USER));

   8856  2 000076   200003 470500                    LDP0    @NK$LDCT,,AUTO
         2 000077   000007 236100                    LDQ     7,,PR0
         2 000100   000016 772000                    QRL     14
         2 000101   017760 376007                    ANQ     8176,DL
         2 000102   000022 736000                    QLS     18
         2 000103   000000 036000 xsym               ADLQ    B$USRT$
         2 000104   200007 756100                    STQ     USRT$,,AUTO

     3381     8857
     3382     8858        /*
     3383     8859             Map in the user into the input output end action WSQ
     3384     8860         */
     3385     8861                %LOCK (G=F_DCBLOCK);

   8862  2 000105   000004 630400 3                  EPPR0   4
         2 000106   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000107   000000 701000 xent               TSX1    HFC$LOCK
         2 000110   000000 011000                    NOP     0

     3386     8864    1           S_WSPTD.BLKNO(%IOENDWSQ) = USRT$->B$USER.PT(0);

   8864  2 000111   200007 470500                    LDP0    USRT$,,AUTO
         2 000112   000014 220100                    LDX0    12,,PR0
         2 000113   000007 740000 xsym               STX0    S_WSPTD+7

     3387     8865    1           CALL HFC$ASSOCCLR (%IOENDWSQ,0,16384); /*MAX Dense PT*/

   8865  2 000114   000001 630400 3                  EPPR0   1
         2 000115   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:632  
         2 000116   000000 701000 xent               TSX1    HFC$ASSOCCLR
         2 000117   000000 011000                    NOP     0

     3388     8866
     3389     8867        /*
     3390     8868             Get pointers to the DCBs in the IOENDROS
     3391     8869         */
     3392     8870    1           P$ = B$ROSEG8$->B$ROSEG.DCBPTR$;

   8870  2 000120   000000 470400 xsym               LDP0    B$ROSEG8$
         2 000121   000000 236100                    LDQ     0,,PR0
         2 000122   200006 756100                    STQ     P$,,AUTO

     3393     8871    1           P.SEGID = %ROSEG8SID;

   8871  2 000123   006125 236007                    LDQ     3157,DL
         2 000124   200006 752103                    STCQ    P$,'03'O,AUTO

     3394     8872    1           DCBPTR$ = P$;

   8872  2 000125   200006 236100                    LDQ     P$,,AUTO
         2 000126   200011 756100                    STQ     DCBPTR$,,AUTO

     3395     8873    1           P$ = DCBPTR$->B$RODCB$(NK$LDCT.DCBNO);

   8873  2 000127   200003 471500                    LDP1    @NK$LDCT,,AUTO
         2 000130   100014 236100                    LDQ     12,,PR1
         2 000131   000033 736000                    QLS     27
         2 000132   000033 732000                    QRS     27
         2 000133   200011 473500                    LDP3    DCBPTR$,,AUTO
         2 000134   300000 236106                    LDQ     0,QL,PR3
         2 000135   200006 756100                    STQ     P$,,AUTO

     3396     8874    1           P.SEGID = %ROSEG8SID;

   8874  2 000136   006125 236007                    LDQ     3157,DL
         2 000137   200006 752103                    STCQ    P$,'03'O,AUTO
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:633  

     3397     8875    1           MEDDCB$ = P$;

   8875  2 000140   200006 236100                    LDQ     P$,,AUTO
         2 000141   200010 756100                    STQ     MEDDCB$,,AUTO

     3398     8876
     3399     8877        /*
     3400     8878             Decrement the count in the DCB
     3401     8879         */
     3402     8880    1           WAIT = MEDDCB$->F$DCB.FCN.F(0);

   8880  2 000142   200010 474500                    LDP4    MEDDCB$,,AUTO
         2 000143   400074 236100                    LDQ     60,,PR4
         2 000144   400000 376003                    ANQ     -131072,DU
         2 000145   200015 756100                    STQ     WAIT,,AUTO

     3403     8881    1           MEDDCB$->F$DCB.FCN(0) = BINBIT(MEDDCB$->F$DCB.FCN.CNT(0) - 1, 9);

   8881  2 000146   400074 236100                    LDQ     60,,PR4
         2 000147   000033 772000                    QRL     27
         2 000150   000377 376007                    ANQ     255,DL
         2 000151   000001 136007                    SBLQ    1,DL
         2 000152   000033 736000                    QLS     27
         2 000153   400074 552140                    STBQ    60,'40'O,PR4

     3404     8882
     3405     8883        /*
     3406     8884             Check to see if there is a streamed DCB that the function
     3407     8885             count must be decremented in
     3408     8886         */
     3409     8887    1           IF NK$LDCT.NOWAIT.DCB# ~= NK$LDCT.DCBNO

   8887  2 000154   100014 236100                    LDQ     12,,PR1
         2 000155   000033 736000                    QLS     27
         2 000156   000033 732000                    QRS     27
         2 000157   200034 756100                    STQ     NWIO+14,,AUTO
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:634  
         2 000160   100010 236100                    LDQ     8,,PR1
         2 000161   000011 772000                    QRL     9
         2 000162   000777 376007                    ANQ     511,DL
         2 000163   200034 116100                    CMPQ    NWIO+14,,AUTO
         2 000164   000215 600000 2                  TZE     s:8899
         2 000165   300000 236106                    LDQ     0,QL,PR3
         2 000166   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000167   000215 600000 2                  TZE     s:8899

     3410     8888    1             AND DCBPTR$->B$RODCB$(NK$LDCT.NOWAIT.DCB#) ~= ADDR(NIL)
     3411     8889    2             THEN DO;

     3412     8890    2               P$ = DCBPTR$->B$RODCB$(NK$LDCT.NOWAIT.DCB#);

   8890  2 000170   100010 236100                    LDQ     8,,PR1
         2 000171   000011 772000                    QRL     9
         2 000172   000777 376007                    ANQ     511,DL
         2 000173   300000 236106                    LDQ     0,QL,PR3
         2 000174   200006 756100                    STQ     P$,,AUTO

     3413     8891    2               P.SEGID = %ROSEG8SID;

   8891  2 000175   006125 236007                    LDQ     3157,DL
         2 000176   200006 752103                    STCQ    P$,'03'O,AUTO

     3414     8892    2               WAIT = WAIT | P$->F$DCB.FCN.F(0);

   8892  2 000177   200006 475500                    LDP5    P$,,AUTO
         2 000200   500074 236100                    LDQ     60,,PR5
         2 000201   400000 376003                    ANQ     -131072,DU
         2 000202   200034 756100                    STQ     NWIO+14,,AUTO
         2 000203   200015 236100                    LDQ     WAIT,,AUTO
         2 000204   400000 376003                    ANQ     -131072,DU
         2 000205   200034 276100                    ORQ     NWIO+14,,AUTO
         2 000206   200015 756100                    STQ     WAIT,,AUTO

     3415     8893    2               P$->F$DCB.FCN(0) = BINBIT(P$->F$DCB.FCN.CNT(0) - 1, 9);
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:635  

   8893  2 000207   500074 236100                    LDQ     60,,PR5
         2 000210   000033 772000                    QRL     27
         2 000211   000377 376007                    ANQ     255,DL
         2 000212   000001 136007                    SBLQ    1,DL
         2 000213   000033 736000                    QLS     27
         2 000214   500074 552140                    STBQ    60,'40'O,PR5

     3416     8894    2               END;

     3417     8895        /*
     3418     8896             Decrement the master function count in the user table
     3419     8897         */
     3420     8898                %LOCK (G=NI_MFGATE);

   8899  2 000215   000005 630400 3                  EPPR0   5
         2 000216   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000217   000000 701000 xent               TSX1    HFC$LOCK
         2 000220   000000 011000                    NOP     0

     3421     8901    1           USRT$->B$USER.CMF(0) = USRT$->B$USER.CMF(0) - 1;

   8901  2 000221   200007 470500                    LDP0    USRT$,,AUTO
         2 000222   000007 236100                    LDQ     7,,PR0
         2 000223   000077 036007                    ADLQ    63,DL
         2 000224   000007 752101                    STCQ    7,'01'O,PR0

     3422     8902    1           IF NOT WAIT THEN

   8902  2 000225   200015 234100                    SZN     WAIT,,AUTO
         2 000226   000232 604000 2                  TMI     s:8905

     3423     8903    1               USRT$->B$USER.MF(0) = USRT$->B$USER.MF(0) - 1;

   8903  2 000227   000006 236100                    LDQ     6,,PR0
         2 000230   777000 036003                    ADLQ    -512,DU
         2 000231   000006 552140                    STBQ    6,'40'O,PR0
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:636  

     3424     8904                %UNLOCK (G=NI_MFGATE);

   8905  2 000232   000005 630400 3                  EPPR0   5
         2 000233   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000234   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000235   000000 011000                    NOP     0

     3425     8907
     3426     8908        /*
     3427     8909             Get ready for the transfer.  We map the user's buffer and key
     3428     8910             buffer by placing his PTWs for the buffer and key into the
     3429     8911             page table slots for $LS116.
     3430     8912         */
     3431     8913                %LOCK (G=KQ_XFGATE);

   8914  2 000236   000006 630400 3                  EPPR0   6
         2 000237   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000240   000000 701000 xent               TSX1    HFC$LOCK
         2 000241   000000 011000                    NOP     0

     3432     8916    1           CALL HFF$TRAPALT ALTRET(BADBUF);

   8916  2 000242   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000243   000000 701000 xent               TSX1    HFF$TRAPALT
         2 000244   000364 702000 2                  TSX2    BADBUF

     3433     8917    1           IF MEDDCB$->F$DCB.FEPSIZ.BUF~=0 AND K$RWPARM.MSG$~=ADDR(NIL)

   8917  2 000245   200010 470500                    LDP0    MEDDCB$,,AUTO
         2 000246   000106 220100                    LDX0    70,,PR0
         2 000247   000313 600000 2                  TZE     s:8931
         2 000250   200004 471500                    LDP1    @PRM2,,AUTO
         2 000251   100000 236100                    LDQ     0,,PR1
         2 000252   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000253   000313 600000 2                  TZE     s:8931

PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:637  
     3434     8918    2             THEN DO;

     3435     8919    2               B$CGPT$->B$$XFPTW = TWOPTWS;

   8919  2 000254   000000 473400 xsym               LDP3    B$CGPT$
         2 000255   000000 237000 1                  LDAQ    TWOPTWS
         2 000256   300000 755100                    STA     0,,PR3
         2 000257   300001 756100                    STQ     1,,PR3

     3436     8920    2               B$CGPT$->B$$XFPTW.PP(0) = MEDDCB$->F$DCB.FEPIO.BPP(0);

   8920  2 000260   000112 220100                    LDX0    74,,PR0
         2 000261   000000 473400 xsym               LDP3    B$CGPT$
         2 000262   300000 740100                    STX0    0,,PR3

     3437     8921    2               B$CGPT$->B$$XFPTW.PP(1) = MEDDCB$->F$DCB.FEPIO.BPP(1);

   8921  2 000263   000112 720100                    LXL0    74,,PR0
         2 000264   000000 473400 xsym               LDP3    B$CGPT$
         2 000265   300001 740100                    STX0    1,,PR3

     3438     8922    2               CALL HFC$ASSOCCLR (%IOENDWSQ,0,2);

   8922  2 000266   000007 630400 3                  EPPR0   7
         2 000267   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000270   000000 701000 xent               TSX1    HFC$ASSOCCLR
         2 000271   000000 011000                    NOP     0

     3439     8923    2               MSGSIZE = MINIMUM (K$RWPARM.MSGSZ, MEDDCB$->F$DCB.FEPSIZ.BUF);

   8923  2 000272   200010 470500                    LDP0    MEDDCB$,,AUTO
         2 000273   000106 236100                    LDQ     70,,PR0
         2 000274   000022 772000                    QRL     18
         2 000275   200004 471500                    LDP1    @PRM2,,AUTO
         2 000276   000301 604000 2                  TMI     s:8923+7
         2 000277   100001 116100                    CMPQ    1,,PR1
         2 000300   000302 604400 2                  TMOZ    s:8923+8
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:638  
         2 000301   100001 236100                    LDQ     1,,PR1
         2 000302   200012 756100                    STQ     MSGSIZE,,AUTO

     3440     8924    2               PINCRC(B$CGCTXT$,MEDDCB$->F$DCB.FEPIO.BUFX)->MESSAGE =

   8924  2 000303   000111 236100                    LDQ     73,,PR0
         2 000304   777777 376007                    ANQ     -1,DL
         2 000305   100000 473500                    LDP3    0,,PR1
         2 000306   200012 720100                    LXL0    MSGSIZE,,AUTO
         2 000307   000000 474400 xsym               LDP4    B$CGCTXT$
         2 000310   040146 100540                    MLR     fill='040'O
         2 000311   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         2 000312   400000 000010                    ADSC9   0,Q,PR4                  cn=0,n=*X0

     3441     8925    2                 K$RWPARM.MSG$->MESSAGE;
     3442     8926    2               END;

     3443     8927
     3444     8928        /*
     3445     8929             Now move the key if necessary
     3446     8930         */
     3447     8931    1           IF MEDDCB$->F$DCB.FEPSIZ.KEY~=0 AND K$RWPARM.KEY$~=ADDR(NIL)

   8931  2 000313   000106 720100                    LXL0    70,,PR0
         2 000314   000363 600000 2                  TZE     s:8941
         2 000315   200004 471500                    LDP1    @PRM2,,AUTO
         2 000316   100044 236100                    LDQ     36,,PR1
         2 000317   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000320   000363 600000 2                  TZE     s:8941

     3448     8932    2             THEN DO;

     3449     8933    2               B$CGPT$->B$$XFPTW = TWOPTWS;

   8933  2 000321   000000 473400 xsym               LDP3    B$CGPT$
         2 000322   000000 237000 1                  LDAQ    TWOPTWS
         2 000323   300000 755100                    STA     0,,PR3
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:639  
         2 000324   300001 756100                    STQ     1,,PR3

     3450     8934    2               B$CGPT$->B$$XFPTW.PP(0) = MEDDCB$->F$DCB.FEPIO.KPP(0);

   8934  2 000325   000113 220100                    LDX0    75,,PR0
         2 000326   000000 473400 xsym               LDP3    B$CGPT$
         2 000327   300000 740100                    STX0    0,,PR3

     3451     8935    2               B$CGPT$->B$$XFPTW.PP(1) = MEDDCB$->F$DCB.FEPIO.KPP(1);

   8935  2 000330   000113 720100                    LXL0    75,,PR0
         2 000331   000000 473400 xsym               LDP3    B$CGPT$
         2 000332   300001 740100                    STX0    1,,PR3

     3452     8936    2               CALL HFC$ASSOCCLR (%IOENDWSQ,0,2);

   8936  2 000333   000007 630400 3                  EPPR0   7
         2 000334   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000335   000000 701000 xent               TSX1    HFC$ASSOCCLR
         2 000336   000000 011000                    NOP     0

     3453     8937    2               MSGSIZE = MINIMUM (K$RWPARM.KEYSZ, MEDDCB$->F$DCB.FEPSIZ.KEY);

   8937  2 000337   200010 470500                    LDP0    MEDDCB$,,AUTO
         2 000340   000106 236100                    LDQ     70,,PR0
         2 000341   777777 376007                    ANQ     -1,DL
         2 000342   200004 471500                    LDP1    @PRM2,,AUTO
         2 000343   200034 756100                    STQ     NWIO+14,,AUTO
         2 000344   100046 236100                    LDQ     38,,PR1
         2 000345   000777 376007                    ANQ     511,DL
         2 000346   200034 116100                    CMPQ    NWIO+14,,AUTO
         2 000347   000352 602000 2                  TNC     s:8937+11
         2 000350   000352 600000 2                  TZE     s:8937+11
         2 000351   200034 236100                    LDQ     NWIO+14,,AUTO
         2 000352   200012 756100                    STQ     MSGSIZE,,AUTO

     3454     8938    2               PINCRC(B$CGCTXT$,MEDDCB$->F$DCB.FEPIO.KEYX)->MESSAGE =
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:640  

   8938  2 000353   000111 236100                    LDQ     73,,PR0
         2 000354   000022 772000                    QRL     18
         2 000355   100044 473500                    LDP3    36,,PR1
         2 000356   200012 720100                    LXL0    MSGSIZE,,AUTO
         2 000357   000000 474400 xsym               LDP4    B$CGCTXT$
         2 000360   040146 100540                    MLR     fill='040'O
         2 000361   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         2 000362   400000 000010                    ADSC9   0,Q,PR4                  cn=0,n=*X0

     3455     8939    2                 K$RWPARM.KEY$->MESSAGE;
     3456     8940    2               END;

     3457     8941    2           DO WHILE('0'B);

   8941  2 000363   000370 710000 2                  TRA     s:8945

     3458     8942    2   BADBUF:   K$RWPARM.TYC = K$RWPARM.TYC | %TYC_MTRAP;

   8942  2 000364   200004 470500       BADBUF       LDP0    @PRM2,,AUTO
         2 000365   000006 236100                    LDQ     6,,PR0
         2 000366   000002 276000 1                  ORQ     TWOPTWS+2
         2 000367   000006 756100                    STQ     6,,PR0

     3459     8943    2             END;

     3460     8944                %UNLOCK (G=KQ_XFGATE);

   8945  2 000370   000006 630400 3                  EPPR0   6
         2 000371   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000372   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000373   000000 011000                    NOP     0

     3461     8947
     3462     8948        /*
     3463     8949             Report an I/O complete event on the user
     3464     8950         */
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:641  
     3465     8951    1           NWIO = '0'B;

   8951  2 000374   000100 100400                    MLR     fill='000'O
         2 000375   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000376   200016 000064                    ADSC9   NWIO,,AUTO               cn=0,n=52

     3466     8952    1           NWIO.P# = SIZEW(NWIO) - SIZEW(NWIO.P#);

   8952  2 000377   000014 235007                    LDA     12,DL
         2 000400   200016 755100                    STA     NWIO,,AUTO

     3467     8953    1           NWIO.TYC = K$RWPARM.TYC;

   8953  2 000401   200004 470500                    LDP0    @PRM2,,AUTO
         2 000402   000006 236100                    LDQ     6,,PR0
         2 000403   200017 756100                    STQ     NWIO+1,,AUTO

     3468     8954    1           NWIO.ARS = K$RWPARM.MSGSZ;

   8954  2 000404   000001 235100                    LDA     1,,PR0
         2 000405   200020 755100                    STA     NWIO+2,,AUTO

     3469     8955    1           NWIO.DVE.DVBYTE = K$RWPARM.DVE.DVBYTE;

   8955  2 000406   000010 236100                    LDQ     8,,PR0
         2 000407   200021 676100                    ERQ     NWIO+3,,AUTO
         2 000410   776000 376003                    ANQ     -1024,DU
         2 000411   200021 656100                    ERSQ    NWIO+3,,AUTO

     3470     8956    1           NWIO.DVE.EOMCHAR = K$RWPARM.DVE.EOMCHAR;

   8956  2 000412   000010 236100                    LDQ     8,,PR0
         2 000413   200021 552120                    STBQ    NWIO+3,'20'O,AUTO

     3471     8957    1           NWIO.IOERRCODE = K$RWPARM.MSG_ERRCODE;

   8957  2 000414   000037 236100                    LDQ     31,,PR0
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:642  
         2 000415   200032 756100                    STQ     NWIO+12,,AUTO

     3472     8958    1           XDMN = NK$LDCT.NOWAIT.DMN;

   8958  2 000416   200003 471500                    LDP1    @NK$LDCT,,AUTO
         2 000417   100010 236100                    LDQ     8,,PR1
         2 000420   000033 772000                    QRL     27
         2 000421   000007 376007                    ANQ     7,DL
         2 000422   200014 756100                    STQ     XDMN,,AUTO

     3473     8959    1           EVID = MEDDCB$->F$DCB.FEPIO.EVENT;

   8959  2 000423   200010 473500                    LDP3    MEDDCB$,,AUTO
         2 000424   300110 235100                    LDA     72,,PR3
         2 000425   200013 755100                    STA     BUFSIZE,,AUTO

     3474     8960
     3475     8961        /*
     3476     8962             Move the results into the DCBs
     3477     8963         */
     3478     8964    1           P$->F$DCB.DVBYTE = K$RWPARM.DVE.DVBYTE;

   8964  2 000426   200006 474500                    LDP4    P$,,AUTO
         2 000427   000010 236100                    LDQ     8,,PR0
         2 000430   400003 676100                    ERQ     3,,PR4
         2 000431   776000 376003                    ANQ     -1024,DU
         2 000432   400003 656100                    ERSQ    3,,PR4

     3479     8965    1           P$->F$DCB.EOMCHAR = K$RWPARM.DVE.EOMCHAR;

   8965  2 000433   000010 236100                    LDQ     8,,PR0
         2 000434   000022 772000                    QRL     18
         2 000435   400003 552104                    STBQ    3,'04'O,PR4

     3480     8966    1           P$->F$DCB.ARS = K$RWPARM.MSGSZ;

   8966  2 000436   000001 235100                    LDA     1,,PR0
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:643  
         2 000437   400000 755100                    STA     0,,PR4

     3481     8967    1           MEDDCB$->F$DCB.DVBYTE = K$RWPARM.DVE.DVBYTE;

   8967  2 000440   000010 236100                    LDQ     8,,PR0
         2 000441   300003 676100                    ERQ     3,,PR3
         2 000442   776000 376003                    ANQ     -1024,DU
         2 000443   300003 656100                    ERSQ    3,,PR3

     3482     8968    1           MEDDCB$->F$DCB.EOMCHAR = K$RWPARM.DVE.EOMCHAR;

   8968  2 000444   000010 236100                    LDQ     8,,PR0
         2 000445   000022 772000                    QRL     18
         2 000446   300003 552104                    STBQ    3,'04'O,PR3

     3483     8969    1           MEDDCB$->F$DCB.ARS = K$RWPARM.MSGSZ;

   8969  2 000447   000001 235100                    LDA     1,,PR0
         2 000450   300000 755100                    STA     0,,PR3

     3484     8970
     3485     8971        /*
     3486     8972             Reset the no wait pending flag in the LDCT if it's the last one.
     3487     8973         */
     3488     8974    1           IF ADDR( MEDDCB$->F$DCB.FEPIO2)->BFEPIO.BPPWORD = 0

   8974  2 000451   300131 235100                    LDA     89,,PR3
         2 000452   000455 601000 2                  TNZ     s:8976

     3489     8975    1             THEN NK$LDCT.LKFLG.NOWAIT = '0'B;

   8975  2 000453   000012 236000 3                  LDQ     10
         2 000454   100011 356100                    ANSQ    9,,PR1

     3490     8976    1           MEDDCB$->F$DCB.FEPIO = MEDDCB$->F$DCB.FEPIO2;

   8976  2 000455   000100 100500                    MLR     fill='000'O
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:644  
         2 000456   300127 000020                    ADSC9   87,,PR3                  cn=0,n=16
         2 000457   300110 000020                    ADSC9   72,,PR3                  cn=0,n=16

     3491     8977    1           MEDDCB$->F$DCB.FEPIO2 = MEDDCB$->F$DCB.FEPIO3;

   8977  2 000460   000100 100500                    MLR     fill='000'O
         2 000461   300133 000020                    ADSC9   91,,PR3                  cn=0,n=16
         2 000462   300127 000020                    ADSC9   87,,PR3                  cn=0,n=16

     3492     8978    1           ADDR( MEDDCB$->F$DCB.FEPIO3)->BFEPIO.BPPWORD = 0;

   8978  2 000463   300135 450100                    STZ     93,,PR3

     3493     8979                %UNLOCK (G=F_DCBLOCK);

   8980  2 000464   000004 630400 3                  EPPR0   4
         2 000465   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000466   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000467   000000 011000                    NOP     0

     3494     8982    1           IF WAIT THEN

   8982  2 000470   200015 234100                    SZN     WAIT,,AUTO
         2 000471   000502 605000 2                  TPL     s:8984

     3495     8983    1               CALL SSR$RUE (%SS_IOCU,NK$LDCT.USER);

   8983  2 000472   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000473   000014 036000 3                  ADLQ    12
         2 000474   000015 235000 3                  LDA     13
         2 000475   200034 757100                    STAQ    NWIO+14,,AUTO
         2 000476   200034 630500                    EPPR0   NWIO+14,,AUTO
         2 000477   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000500   000000 701000 xent               TSX1    SSR$RUE
         2 000501   000000 011000                    NOP     0

     3496     8984    1           CALL SSV$EVENT(NK$LDCT.USER,XDMN,%SUBC_IO#,EVID,K$RWPARM.MSG_ERRCODE,ADDR(
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:645  
              8984                    NWIO));

   8984  2 000502   200016 630500                    EPPR0   NWIO,,AUTO
         2 000503   200034 450500                    STP0    NWIO+14,,AUTO
         2 000504   200034 631500                    EPPR1   NWIO+14,,AUTO
         2 000505   200043 451500                    STP1    NWIO+21,,AUTO
         2 000506   200004 236100                    LDQ     @PRM2,,AUTO
         2 000507   000037 036003                    ADLQ    31,DU
         2 000510   200042 756100                    STQ     NWIO+20,,AUTO
         2 000511   200013 633500                    EPPR3   BUFSIZE,,AUTO
         2 000512   200041 453500                    STP3    NWIO+19,,AUTO
         2 000513   000016 236000 3                  LDQ     14
         2 000514   200040 756100                    STQ     NWIO+18,,AUTO
         2 000515   200014 634500                    EPPR4   XDMN,,AUTO
         2 000516   200037 454500                    STP4    NWIO+17,,AUTO
         2 000517   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000520   000014 036000 3                  ADLQ    12
         2 000521   200036 756100                    STQ     NWIO+16,,AUTO
         2 000522   200036 630500                    EPPR0   NWIO+16,,AUTO
         2 000523   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 000524   000000 701000 xent               TSX1    SSV$EVENT
         2 000525   000000 011000                    NOP     0

     3497     8985    1           CALL SSR$RUE (%SS_FPEVNT,NK$LDCT.USER);

   8985  2 000526   200003 236100                    LDQ     @NK$LDCT,,AUTO
         2 000527   000014 036000 3                  ADLQ    12
         2 000530   000020 235000 3                  LDA     16
         2 000531   200034 757100                    STAQ    NWIO+14,,AUTO
         2 000532   200034 630500                    EPPR0   NWIO+14,,AUTO
         2 000533   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000534   000000 701000 xent               TSX1    SSR$RUE
         2 000535   000000 011000                    NOP     0

     3498     8986    1           RETURN;

   8986  2 000536   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:646  

TWOPTWS
 Sect OctLoc
   1     000   000000 000060   000000 000060                                    ...0...0

(unnamed)
 Sect OctLoc
   1     002   000100 000000                                                    .@..

(unnamed)
 Sect OctLoc
   3     000   000000 040000   000011 006000   000002 006000   000000 006000    .. .............
   3     004   000000 006000   000000 006000   000000 006000   000011 006000    ................
   3     010   000002 006000   000004 006000   777776 777777   000000 000037    ................
   3     014   000007 200000   000013 006000   000003 006000   000000 000053    ...............+
   3     020   000017 006000                                                    ....
     3499     8987
     3500     8988    1   END KIA$GETEVNT;
     3501     8989        %EOD;

PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:647  
--  Include file information  --

   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   S_WSPTD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KIA$GETEVNT.
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:648  

 **** Variables and constants ****

  ****  Section 001 RoData KIA$GETEVNT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 TWOPTWS(0:1)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @DMN                       3-0-0/w PTR         r     1 @NK$LDCT
     4-0-0/w PTR         r     1 @PRM2                     13-0-0/w UBIN        r     1 BUFSIZE
    11-0-0/w PTR         r     1 DCBPTR$                   *0-0-0/w UBIN        r     1 DMN
    13-0-0/w UBIN        r     1 EVID                      *0-0-0/w UBIN        r     1 EVNT
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                  10-0-0/w PTR         r     1 MEDDCB$
    12-0-0/w UBIN        r     1 MSGSIZE                   *0-0-0/d STRC(864)   r     1 NK$LDCT
    16-0-0/w STRC(468)   r     1 NWIO                       6-0-0/w STRC        r     1 P
     6-0-0/w PTR         r     1 P$                        *0-0-0/d ACHR        r     1 PRM2
     7-0-0/w PTR         r     1 USRT$                     15-0-0/b BIT         r     1 WAIT
    14-0-0/w UBIN        r     1 XDMN

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$CGCTXT$                  0-0-0/w PTR         r     1 B$CGPT$
     0-0-0/w PTR         r     1 B$ROSEG8$                  0-0-0/w PTR         r     1 B$USRT$
     0-0-0/b BIT (72)    r     1 F_DCBLOCK                  0-0-0/d BIT (72)    r     1 KQ_XFGATE
     0-0-0/b BIT (72)    r     1 NI_MFGATE                  0-0-0/w STRC        r     1 S_WSPTD(0:28)

  ****  BASED and DCB variables  ****

PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:649  
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 B$$XFPTW
     0-0-0/w PTR         r     1 B$RODCB$(0:0)
     0-0-0/d STRC(3024)  r     1 B$ROSEG                    0-0-0/w STRC(576)   r     1 B$USER(0:0)
     0-0-0/w STRC(108)   r     1 BFEPIO                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/c ACHR        r     1 MESSAGE


   Procedure KIA$GETEVNT requires 351 words for executable code.
   Procedure KIA$GETEVNT requires 36 words of local(AUTO) storage.
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:650  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:651  
          MINI XREF LISTING

B$$XFPTW
      8798**DCL      8919<<ASSIGN   8933<<ASSIGN
B$$XFPTW.PP
      8799**DCL      8920<<ASSIGN   8921<<ASSIGN   8934<<ASSIGN   8935<<ASSIGN
B$CGCTXT$
      8818**DCL      8924>>ASSIGN   8938>>ASSIGN
B$CGPT$
      8817**DCL      8919>>ASSIGN   8920>>ASSIGN   8921>>ASSIGN   8933>>ASSIGN   8934>>ASSIGN   8935>>ASSIGN
B$DO.ECCINFO
       232**DCL       233--REDEF
B$RODCB$
        65**DCL      8844>>ASSIGN   8873>>ASSIGN   8887>>IF       8890>>ASSIGN
B$ROSEG.DCBPTR$
        29**DCL      8842>>ASSIGN   8870>>ASSIGN
B$ROSEG.NUMDCBS
        31**DCL      8838>>IF
B$ROSEG8$
      8812**DCL      8838>>IF       8842>>ASSIGN   8870>>ASSIGN
B$U.MISC
       211**DCL       212--REDEF
B$USER
       256**DCL      8856--ASSIGN
B$USER.CMF
       270**DCL      8901<<ASSIGN   8901>>ASSIGN
B$USER.MF
       263**DCL      8903<<ASSIGN   8903>>ASSIGN
B$USER.MISC
       287**DCL       288--REDEF
B$USER.PT
       281**DCL      8834>>ASSIGN   8864>>ASSIGN
B$USRT$
      8813**DCL      8834>>ASSIGN   8856>>ASSIGN
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:652  
BADBUF
      8942**LABEL    8916--CALLALT
BFEPIO.BPPWORD
      8804**DCL      8974>>IF       8978<<ASSIGN
BUFSIZE
      8711**DCL      8712--REDEF    8800--IMP-SIZ
DCBPTR$
      8709**DCL      8872<<ASSIGN   8873>>ASSIGN   8887>>IF       8890>>ASSIGN
DMN
      8699**DCL        17--PROC     8847--IF       8849<<ASSIGN
EVID
      8712**DCL      8959<<ASSIGN   8984<>CALL
EVNT
      8382**DCL      8381--IMP-SIZ  8829<<ASSIGN   8839<<ASSIGN   8846<<ASSIGN
F$DCB.ACTPOS
      7090**DCL      7090--REDEF
F$DCB.ARS
      7065**DCL      7065--REDEF    8966<<ASSIGN   8969<<ASSIGN
F$DCB.ATTR
      7083**DCL      7084--REDEF
F$DCB.BORROW
      7098**DCL      7098--REDEF    7098--REDEF    7098--REDEF
F$DCB.DCBNAME.L
      7112**DCL      7112--IMP-SIZ
F$DCB.DVBYTE
      7068**DCL      8964<<ASSIGN   8967<<ASSIGN
F$DCB.EOMCHAR
      7069**DCL      7069--REDEF    8965<<ASSIGN   8968<<ASSIGN
F$DCB.EVENT
      7089**DCL      8846>>ASSIGN
F$DCB.FCN
      7102**DCL      8881<<ASSIGN   8893<<ASSIGN
F$DCB.FCN.CNT
      7102**DCL      8881>>ASSIGN   8893>>ASSIGN
F$DCB.FCN.F
      7102**DCL      8880>>ASSIGN   8892>>ASSIGN
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:653  
F$DCB.FEPIO
      7108**DCL      8976<<ASSIGN
F$DCB.FEPIO.BPP
      7109**DCL      8920>>ASSIGN   8921>>ASSIGN
F$DCB.FEPIO.BUFX
      7109**DCL      8924>>ASSIGN
F$DCB.FEPIO.EVENT
      7108**DCL      8959>>ASSIGN
F$DCB.FEPIO.KEYX
      7108**DCL      8938>>ASSIGN
F$DCB.FEPIO.KPP
      7109**DCL      8934>>ASSIGN   8935>>ASSIGN
F$DCB.FEPIO2
      7111**DCL      8974--IF       8976>>ASSIGN   8977<<ASSIGN
F$DCB.FEPIO3
      7111**DCL      8977>>ASSIGN   8978--ASSIGN
F$DCB.FEPSIZ.BUF
      7108**DCL      8917>>IF       8923>>ASSIGN
F$DCB.FEPSIZ.KEY
      7108**DCL      8931>>IF       8937>>ASSIGN
F$DCB.FLDID
      7093**DCL      7093--REDEF
F$DCB.FORM$
      7087**DCL      7087--REDEF
F$DCB.FSECT
      7103**DCL      7103--REDEF
F$DCB.FSN
      7080**DCL      7080--REDEF    7080--REDEF    7081--REDEF
F$DCB.HEADER$
      7086**DCL      7086--REDEF
F$DCB.IXTNSIZE
      7084**DCL      7084--REDEF
F$DCB.LASTSTA$
      7074**DCL      7074--REDEF
F$DCB.LVL
      7099**DCL      7099--REDEF
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:654  
F$DCB.NAME.C
      7074**DCL      7074--REDEF
F$DCB.NOEOF
      7095**DCL      7095--REDEF
F$DCB.NRECS
      7085**DCL      7085--REDEF
F$DCB.NRECX
      7104**DCL      7104--REDEF
F$DCB.OHDR
      7096**DCL      7096--REDEF
F$DCB.ORG
      7079**DCL      7079--REDEF
F$DCB.PRECNO
      7102**DCL      7102--REDEF
F$DCB.RCSZ
      7107**DCL      7107--REDEF
F$DCB.RES
      7075**DCL      7075--REDEF
F$DCB.SETX
      7087**DCL      7087--REDEF
F$DCB.TAB$
      7086**DCL      7087--REDEF
F$DCB.TDA
      7101**DCL      7101--REDEF
F$DCB.WSN
      7076**DCL      7076--REDEF
F$DCB.WSR
      7082**DCL      8849>>ASSIGN
F_DCBLOCK
      8814**DCL      8862<>CALL     8980<>CALL
HFC$ASSOCCLR
      8822**DCL-ENT  8837--CALL     8865--CALL     8922--CALL     8936--CALL
HFC$LOCK
      7501**DCL-ENT  8862--CALL     8899--CALL     8914--CALL
HFC$UNLOCK
      7501**DCL-ENT  8905--CALL     8945--CALL     8980--CALL
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:655  
HFF$TRAPALT
      8823**DCL-ENT  8916--CALL
K$RWPARM.BLKREC
      8430**DCL      8455--REDEF
K$RWPARM.BLKREC.BLKU#
      8431**DCL      8433--REDEF
K$RWPARM.BLKREC.RECU#
      8443**DCL      8445--REDEF
K$RWPARM.DVE.DVBYTE
      8462**DCL      8955>>ASSIGN   8964>>ASSIGN   8967>>ASSIGN
K$RWPARM.DVE.DVBYTE.VFC
      8470**DCL      8471--REDEF
K$RWPARM.DVE.EOMCHAR
      8478**DCL      8482--REDEF    8956>>ASSIGN   8965>>ASSIGN   8968>>ASSIGN
K$RWPARM.ERR
      8542**DCL      8547--REDEF
K$RWPARM.FC
      8506**DCL      8507--REDEF
K$RWPARM.FLDID
      8688**DCL      8689--REDEF
K$RWPARM.FPT$
      8569**DCL      8576--REDEF
K$RWPARM.KEY$
      8686**DCL      8931>>IF       8938>>ASSIGN
K$RWPARM.KEYSZ
      8697**DCL      8937>>ASSIGN
K$RWPARM.KEYTYPE
      8695**DCL      8696--REDEF
K$RWPARM.MSG$
      8405**DCL      8411--REDEF    8917>>IF       8924>>ASSIGN
K$RWPARM.MSGID
      8517**DCL      8522--REDEF
K$RWPARM.MSGIDXT
      8530**DCL      8534--REDEF
K$RWPARM.MSGSZ
      8412**DCL      8923>>ASSIGN   8954>>ASSIGN   8966>>ASSIGN   8969>>ASSIGN
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:656  
K$RWPARM.MSG_ERRCODE
      8665**DCL      8957>>ASSIGN   8984<>CALL
K$RWPARM.ORG
      8666**DCL      8667--REDEF
K$RWPARM.THDRSZ
      8610**DCL      8614--REDEF
K$RWPARM.TYC
      8426**DCL      8942<<ASSIGN   8942>>ASSIGN   8953>>ASSIGN
K$RWPARM.VDOFLGS
      8668**DCL      8679--REDEF
KQ_XFGATE
      8815**DCL      8914<>CALL     8945<>CALL
MEDDCB$
      8708**DCL      8875<<ASSIGN   8880>>ASSIGN   8881>>ASSIGN   8881>>ASSIGN   8917>>IF       8920>>ASSIGN
      8921>>ASSIGN   8923>>ASSIGN   8924>>ASSIGN   8931>>IF       8934>>ASSIGN   8935>>ASSIGN   8937>>ASSIGN
      8938>>ASSIGN   8959>>ASSIGN   8967>>ASSIGN   8968>>ASSIGN   8969>>ASSIGN   8974>>IF       8976>>ASSIGN
      8976>>ASSIGN   8977>>ASSIGN   8977>>ASSIGN   8978>>ASSIGN
MESSAGE
      8801**DCL      8924<<ASSIGN   8924>>ASSIGN   8938<<ASSIGN   8938>>ASSIGN
MSGSIZE
      8710**DCL      8801--IMP-SIZ  8923<<ASSIGN   8924>>ASSIGN   8924>>ASSIGN   8937<<ASSIGN   8938>>ASSIGN
      8938>>ASSIGN
NI_MFGATE
      8816**DCL      8899<>CALL     8905<>CALL
NK$LDCT
      8348**DCL        17--PROC     8854--ENTRY
NK$LDCT.DCBNO
      8372**DCL      8828>>IF       8838>>IF       8844>>ASSIGN   8873>>ASSIGN   8887>>IF
NK$LDCT.DDT$
      8350**DCL      8350--REDEF
NK$LDCT.IOQ$
      8349**DCL      8350--REDEF
NK$LDCT.LDCTX
      8351**DCL      8351--REDEF
NK$LDCT.LKFLG.ABORTED
      8363**DCL      8364--REDEF
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:657  
NK$LDCT.LKFLG.NOWAIT
      8369**DCL      8975<<ASSIGN
NK$LDCT.NOWAIT.DCB#
      8360**DCL      8887>>IF       8887>>IF       8890>>ASSIGN
NK$LDCT.NOWAIT.DMN
      8359**DCL      8958>>ASSIGN
NK$LDCT.RLCID.LDCTX
      8373**DCL      8373--REDEF
NK$LDCT.STA$
      8369**DCL      8370--REDEF
NK$LDCT.SYMB$
      8348**DCL      8348--REDEF    8348--REDEF    8349--REDEF
NK$LDCT.USER
      8358**DCL      8828>>IF       8834>>ASSIGN   8856>>ASSIGN   8983<>CALL     8984<>CALL     8985<>CALL
NWIO
      8719**DCL      8951<<ASSIGN   8952--ASSIGN   8984--CALL
NWIO.ARS
      8721**DCL      8954<<ASSIGN
NWIO.CGPARM.MSGIDXT
      8745**DCL      8748--REDEF
NWIO.DVE.DVBYTE
      8721**DCL      8955<<ASSIGN
NWIO.DVE.EOMCHAR
      8721**DCL      8956<<ASSIGN
NWIO.IOERRCODE
      8764**DCL      8957<<ASSIGN
NWIO.P#
      8721**DCL      8952<<ASSIGN   8952--ASSIGN
NWIO.TYC
      8721**DCL      8953<<ASSIGN
P.SEGID
      8706**DCL      8843<<ASSIGN   8845<<ASSIGN   8871<<ASSIGN   8874<<ASSIGN   8891<<ASSIGN
P$
      8703**DCL      8704--REDEF    8842<<ASSIGN   8844<<ASSIGN   8844>>ASSIGN   8846>>ASSIGN   8849>>ASSIGN
      8870<<ASSIGN   8872>>ASSIGN   8873<<ASSIGN   8875>>ASSIGN   8890<<ASSIGN   8892>>ASSIGN   8893>>ASSIGN
      8893>>ASSIGN   8964>>ASSIGN   8965>>ASSIGN   8966>>ASSIGN
PL6.E3A0      #014=KIA$GETEVNT File=KIA$APPLC.:E05TSI                            WED 07/30/97 00:39 Page:658  
PRM2
      8381**DCL        17--PROC     8382--REDEF    8404--REDEF    8854--ENTRY
SSR$RUE
      8825**DCL-ENT  8983--CALL     8985--CALL
SSV$EVENT
      8826**DCL-ENT  8984--CALL
S_WSPTD.BLKNO
      8231**DCL      8834<<ASSIGN   8864<<ASSIGN
TWOPTWS
      8808**DCL      8919>>ASSIGN   8933>>ASSIGN
USRT$
      8707**DCL      8856<<ASSIGN   8864>>ASSIGN   8901>>ASSIGN   8901>>ASSIGN   8903>>ASSIGN   8903>>ASSIGN
WAIT
      8714**DCL      8880<<ASSIGN   8892<<ASSIGN   8892>>ASSIGN   8902>>IF       8982>>IF
XDMN
      8713**DCL      8958<<ASSIGN   8984<>CALL

PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:659  
     3502        1        /*T***********************************************************/
     3503        2        /*T*                                                         */
     3504        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3505        4        /*T*                                                         */
     3506        5        /*T***********************************************************/
     3507        6        KIA$NETERR2ERR: PROC(NETERR,ERR);
     3508        7        /*D* NAME:        KIA$NETERR2ERR
     3509        8             PURPOSE:     To convert a network error code to a host error code
     3510        9             CALL:        CALL KIA$NETERR2ERR(NETERR,ERR);
     3511       10             INPUT:       NETERR - A KL_NETERR structure defining a network
     3512       11                                   error code.
     3513       12             OUTPUT:      ERR - A host error code suitable for stuffing into
     3514       13                                B$JIT.ERR.
     3515       14             DESCRIPTION: KIA$NETERR2ERR accepts a KL_NETERR structure
     3516       15                          describing a network error code and converts it to
     3517       16                          a host error code. All conversion necessary including
     3518       17                          removal of coupler slack bits and HOST-originated
     3519       18                          versus FEP-originated detection is performed.
     3520       19        */
     3521       20
     3522       21        %INCLUDE KL_MACRO_C;
     3523     3373        %KL_NETERR(FPTN=NETERR,ALGN=CALIGNED,STCLASS=PARAM,LAST=";");
     3524     3410    1   DCL ERR BIT(36) CALIGNED;
     3525     3411    1   DCL 1 TERR,
     3526     3412    1         2 * UBIN BYTE UNAL,
     3527     3413    1         2 SIGNIF BIT(36) UNAL;
     3528     3414    1   DCL EMR$FEP2HOST ENTRY(2);
     3529     3415    1   DCL KIA$8TO9 ENTRY(3);
     3530     3416
     3531     3417    1           IF NETERR.HOSTERR
     3532     3418    2             THEN DO;
     3533     3419    2               TERR='0'B;
     3534     3420    2               CALL KIA$8TO9(NETERR.ERR,TERR,5);
     3535     3421    2               ERR=TERR.SIGNIF;
     3536     3422    2               END;
     3537     3423    2             ELSE DO;
     3538     3424    2               CALL EMR$FEP2HOST(NETERR.ERR.L6,ERR);
PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:660  
     3539     3425    2               END;
     3540     3426    1           RETURN;
     3541     3427    1   END KIA$NETERR2ERR;

PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:661  
--  Include file information  --

   KL_MACRO_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$NETERR2ERR.

   Procedure KIA$NETERR2ERR requires 35 words for executable code.
   Procedure KIA$NETERR2ERR requires 12 words of local(AUTO) storage.

    No errors detected in file KIA$APPLC.:E05TSI    .

PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:662  

 Object Unit name= KIA$NETERR2ERR                             File name= KIA$APPLC.:E05TOU
 UTS= JUL 30 '97 00:40:52.96 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    35     43  KIA$NETERR2ERR
    1  RoData even  none     1      1  KIA$NETERR2ERR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        2  KIA$NETERR2ERR

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       3 KIA$8TO9
         yes           Std       2 EMR$FEP2HOST
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B_VECTNIL
PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:663  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:664  


     3502        1        /*T***********************************************************/
     3503        2        /*T*                                                         */
     3504        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     3505        4        /*T*                                                         */
     3506        5        /*T***********************************************************/
     3507        6        KIA$NETERR2ERR: PROC(NETERR,ERR);

      6  0 000000   000000 700200 xent  KIA$NETERR2* TSX0  ! X66_AUTO_2
         0 000001   000014 000002                    ZERO    12,2

     3508        7        /*D* NAME:        KIA$NETERR2ERR
     3509        8             PURPOSE:     To convert a network error code to a host error code
     3510        9             CALL:        CALL KIA$NETERR2ERR(NETERR,ERR);
     3511       10             INPUT:       NETERR - A KL_NETERR structure defining a network
     3512       11                                   error code.
     3513       12             OUTPUT:      ERR - A host error code suitable for stuffing into
     3514       13                                B$JIT.ERR.
     3515       14             DESCRIPTION: KIA$NETERR2ERR accepts a KL_NETERR structure
     3516       15                          describing a network error code and converts it to
     3517       16                          a host error code. All conversion necessary including
     3518       17                          removal of coupler slack bits and HOST-originated
     3519       18                          versus FEP-originated detection is performed.
     3520       19        */
     3521       20
     3522       21        %INCLUDE KL_MACRO_C;
     3523     3373        %KL_NETERR(FPTN=NETERR,ALGN=CALIGNED,STCLASS=PARAM,LAST=";");
     3524     3410    1   DCL ERR BIT(36) CALIGNED;
     3525     3411    1   DCL 1 TERR,
     3526     3412    1         2 * UBIN BYTE UNAL,
     3527     3413    1         2 SIGNIF BIT(36) UNAL;
     3528     3414    1   DCL EMR$FEP2HOST ENTRY(2);
     3529     3415    1   DCL KIA$8TO9 ENTRY(3);
     3530     3416
     3531     3417    1           IF NETERR.HOSTERR

   3417  0 000002   200003 470500                    LDP0    @NETERR,,AUTO
PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:665  
         0 000003   000000 066500                    CMPB    filb='0'B
         0 000004   000000 010001                    BDSC    0,,PR0                   by=0,bit=1,n=1
         0 000005   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         0 000006   000031 600000 0                  TZE     s:3424

     3532     3418    2             THEN DO;

     3533     3419    2               TERR='0'B;

   3419  0 000007   200005 450100                    STZ     TERR,,AUTO
         0 000010   200006 450100                    STZ     TERR+1,,AUTO

     3534     3420    2               CALL KIA$8TO9(NETERR.ERR,TERR,5);

   3420  0 000011   000000 236000 1                  LDQ     0
         0 000012   200012 756100                    STQ     TERR+5,,AUTO
         0 000013   200005 631500                    EPPR1   TERR,,AUTO
         0 000014   200011 451500                    STP1    TERR+4,,AUTO
         0 000015   200003 236100                    LDQ     @NETERR,,AUTO
         0 000016   200000 036007                    ADLQ    65536,DL
         0 000017   200010 756100                    STQ     TERR+3,,AUTO
         0 000020   200010 630500                    EPPR0   TERR+3,,AUTO
         0 000021   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000022   000000 701000 xent               TSX1    KIA$8TO9
         0 000023   000000 011000                    NOP     0

     3535     3421    2               ERR=TERR.SIGNIF;

   3421  0 000024   200004 470500                    LDP0    @ERR,,AUTO
         0 000025   000100 100500                    MLR     fill='000'O
         0 000026   200005 200004                    ADSC9   TERR,,AUTO               cn=1,n=4
         0 000027   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4

     3536     3422    2               END;

   3422  0 000030   000042 710000 0                  TRA     s:3426

PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:666  
     3537     3423    2             ELSE DO;

     3538     3424    2               CALL EMR$FEP2HOST(NETERR.ERR.L6,ERR);

   3424  0 000031   200004 236100                    LDQ     @ERR,,AUTO
         0 000032   200011 756100                    STQ     TERR+4,,AUTO
         0 000033   200003 236100                    LDQ     @NETERR,,AUTO
         0 000034   400000 036007                    ADLQ    -131072,DL
         0 000035   200010 756100                    STQ     TERR+3,,AUTO
         0 000036   200010 630500                    EPPR0   TERR+3,,AUTO
         0 000037   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000040   000000 701000 xent               TSX1    EMR$FEP2HOST
         0 000041   000000 011000                    NOP     0

     3539     3425    2               END;

     3540     3426    1           RETURN;

   3426  0 000042   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000007 006000                                                    ....
     3541     3427    1   END KIA$NETERR2ERR;

PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:667  
--  Include file information  --

   KL_MACRO_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIA$NETERR2ERR.
PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:668  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ERR                       3-0-0/w PTR         r     1 @NETERR
    *0-0-0/c BIT         r     1 ERR                       *0-0-0/c STRC(54)    r     1 NETERR
     5-0-0/b STRC(45)    r     1 TERR


   Procedure KIA$NETERR2ERR requires 35 words for executable code.
   Procedure KIA$NETERR2ERR requires 12 words of local(AUTO) storage.

    No errors detected in file KIA$APPLC.:E05TSI    .
PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:669  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #015=KIA$NETERR2ERR File=KIA$APPLC.:E05TSI                         WED 07/30/97 00:40 Page:670  
          MINI XREF LISTING

EMR$FEP2HOST
      3414**DCL-ENT  3424--CALL
ERR
      3410**DCL         6--PROC     3421<<ASSIGN   3424<>CALL
KIA$8TO9
      3415**DCL-ENT  3420--CALL
NETERR
      3387**DCL         6--PROC
NETERR.ERR
      3399**DCL      3420<>CALL
NETERR.ERR.L6
      3402**DCL      3424<>CALL
NETERR.HOSTERR
      3394**DCL      3417>>IF
TERR
      3411**DCL      3419<<ASSIGN   3420<>CALL
TERR.SIGNIF
      3413**DCL      3421>>ASSIGN
