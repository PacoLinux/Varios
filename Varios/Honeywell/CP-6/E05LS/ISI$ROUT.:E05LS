VERSION E05

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:1    
        1        1        /*M* PL6 ROUTINES FOR AARDVARK                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=8,IND=2,THI=2,ENU=2,CSU=2,DTI=4,DCI=4,ECU=4,AND */
        8        8        /**/
        9        9        /**/
       10       10        GTFWR:  PROC(INDX,READ_FLG,TAPE_FLG) ALTRET;
       11       11        /* This program loads firmware from PO or FW tape in memory */
       12       12        /* When read error -> ALTRETURN .
       13       13           When no more firmware -> LABEL=' ' .
       14       14           Else, firmware name ->LABEL .        */
       15       15        %INCLUDE IS$MACROS;
       16     1290        /**/
       17     1291    1   DCL INDX UBIN WORD;                     /* Firmware tape's index in DEVINFO   */
       18     1292    1   DCL TAPE_FLG BIT(1) ALIGNED; /* '0'B-> PO tape.
       19     1293                                '1'B-> FW tape. */
       20     1294    1   DCL READ_FLG BIT(1) ALIGNED; /* '0'B-> PO tape.
       21     1295                                '1'B-> FW tape. */
       22     1296        /**/
       23     1297    1   DCL RD_FW_FLG BIT(1) SYMREF;
       24     1298    1   DCL SILENT BIT(1) SYMREF;               /* If ='1'B don't write names of FW   */
       25     1299    1   DCL FW$ PTR SYMREF;                     /* Memory location for this firmware  */
       26     1300        %PTR_STRUCT(NAME=FW_PTR,STCLASS="REDEF FW$");
       27     1318    1   DCL POBUF(0:1023) BIT(36) SYMREF;       /* Reading buffer                     */
       28     1319        %DEVINFO(STCLASS="SYMREF");
       29     1388    1   DCL LABEL CHAR(4) SYMREF;               /* Firmware's name or ' '             */
       30     1389    1   DCL ORDBFLG BIT(2) SYMREF;
       31     1390    1   DCL 1 ANSBUF SYMREF,
       32     1391    1         2 CNT UBIN WORD,
       33     1392    1         2 TXT CHAR(80);
       34     1393        /**/
       35     1394    1   DCL MINIQC_PL6 ENTRY(5) ALTRET;
       36     1395    1   DCL DOIOX ENTRY(4);
       37     1396    1   DCL TYPEC ENTRY(1);
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:2    
       38     1397    1   DCL KEYIN ENTRY(2) ALTRET;
       39     1398    1   DCL UPPER_CASE ENTRY(2);
       40     1399        /**/
       41     1400    1   DCL FWR_FLG BIT(1) STATIC INIT('0'B);   /* Firmware found flag                */
       42     1401    1   DCL EOF_FLG BIT(1) STATIC INIT('0'B);   /* EOF flag                           */
       43     1402    1   DCL DKIDF_FLG BIT(1) STATIC INIT('0'B); /* DECK ID flag                       */
       44     1403    1   DCL FWFPO_FLG BIT(1) STATIC INIT('0'B);
       45     1404    1   DCL BCD2ASC CHAR(64)CONSTANT INIT
       46     1405    1   ('0123456789[#@:>? ABCDEFGHI&.](<\^JKLMNOPQR-$*);''+/STUVWXYZ_,%="!');
       47     1406    1   DCL POBUF$ PTR CONSTANT INIT(ADDR(POBUF));
       48     1407        %PTR_STRUCT(NAME=POBUF_PTR,STCLASS="REDEF POBUF$");
       49     1425    1   DCL TPBTC BIT(36) ALIGNED CONSTANT INIT('05'O); /* Tape boot command          */
       50     1426    1   DCL MPCINF BIT(36) ALIGNED STATIC SYMDEF;
       51     1427    1   DCL MPCINF1 BIT(36) ALIGNED STATIC SYMDEF;
       52     1428        %DCW_STRUCT(NAME=PODCW);                /* firmware read DCW                  */
       53     1446    1   DCL IMAGE$ PTR STATIC INIT(ADDR(POBUF));
       54     1447        %PTR_STRUCT(NAME=IMAGE_PTR,STCLASS="REDEF IMAGE$");
       55     1465        %PTR_STRUCT(NAME=CURR_PTR);
       56     1483    1   DCL CURR$ REDEF CURR_PTR PTR;
       57     1484        %DOIO_COMZONE(NAME=RFW_ZONE);
       58     1517        /**/
       59     1518    1   DCL FWREV CHAR(2);
       60     1519    1   DCL FWBASE$ PTR;
       61     1520    1   DCL MESSAGE$ PTR;
       62     1521    1   DCL ACT_BUF_LEN UBIN HALF;
       63     1522    1   DCL SAVE_DEV UBIN(6);
       64     1523    1   DCL I UBIN WORD;
       65     1524    1   DCL ASCSTRING CHAR(6);                  /* Result of XLATE                    */
       66     1525    1   DCL BLK_LEN UBIN(18);                   /* Actual block length                */
       67     1526    1   DCL WRDCNT UBIN WORD;                   /* Nr of words in a record            */
       68     1527        /* Info description */
       69     1528        /* Block control word */
       70     1529    1   DCL 1 BCW BASED(IMAGE$) ALIGNED,
       71     1530    1         2 BLK# UBIN HALF UNAL,
       72     1531    1         2 SZ UBIN HALF UNAL;
       73     1532        /* Record control word */
       74     1533    1   DCL 1 RCW BASED(IMAGE$) ALIGNED,
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:3    
       75     1534    1         2 SZ UBIN HALF UNAL,
       76     1535    1         2 * BIT(8),
       77     1536    1         2 MEDIA UBIN(4) UNAL,
       78     1537    1         2 BMED REDEF MEDIA,
       79     1538    1           3 * BIT(2),
       80     1539    1           3 BH BIT(1),
       81     1540    1           3 * BIT(1),
       82     1541    1         2 RC BIT(6);
       83     1542        /* Current info word */
       84     1543    1   DCL 1 WRD BASED(CURR$) ALIGNED,
       85     1544    1         2 H1,
       86     1545    1           3 B1 BIT(6),
       87     1546    1           3 B2 BIT(6),
       88     1547    1           3 B3 BIT(6),
       89     1548    1         2 H2,
       90     1549    1           3 B1 BIT(6),
       91     1550    1           3 B2_3 BIT(12);
       92     1551    1   DCL FWINFO CHAR(FWINFO_LGTH) BASED;
       93     1552    1   DCL FWINFO_LGTH UBIN WORD;
       94     1553        /**/
       95     1554        /* Messages */
       96     1555        %TEXTC(N#=FWQ,M#="' Do you want REV.XX of firmware XXXX (Y/N) ?'");
       97     1560        %TEXTC(N#=FWF,M#="' The following firmware modules were found.'");
       98     1565        %TEXTC(N#=FWF1,M#="' Rev.XX of XXXX.'");
       99     1570    1   DCL 1 TEXTM BASED(MESSAGE$),
      100     1571    1         2 CNT UBIN WORD,
      101     1572    1         2 TXT CHAR(TEXTM.CNT);
      102     1573        /**/
      103     1574    1           SAVE_DEV=DEVINFO.DEV#(INDX);    /* PO tape DEV# must be set to 0      */
      104     1575    1           FWR_FLG='0'B;                   /* Flags = 0 before searching         */
      105     1576    1           EOF_FLG='0'B;
      106     1577    1           FWBASE$=FW$;
      107     1578    1           IMAGE$=ADDR(POBUF);
      108     1579        /* Build PODCW */
      109     1580    1           PODCW.AD=IMAGE_PTR.WOFFS;
      110     1581    1           PODCW.TALLY=320;
      111     1582        /**/
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:4    
      112     1583    1   READFW:
      113     1584        /* Clear the input buffer */
      114     1585    1           POBUF='0'B;
      115     1586        /**/
      116     1587    1           IF READ_FLG='0'B THEN GOTO READFW0; /* PO tape (Primitive)            */
      117     1588    1             ELSE;
      118     1589        /* FW tape , read binary */
      119     1590    1           CALL MINIQC_PL6(INDX,ADDR(PODCW),0,%FCNRTB) ALTRET(RFWERRET);
      120     1591        /* Check if EOF */
      121     1592    1           IF (DEVINFO.BSTAT.W1.H1(INDX)&'77'O)~='44'O THEN GOTO PROCESS;/* No EOF */
      122     1593    1             ELSE;                         /* Two EOFs in a row ?                */
      123     1594    1           IF EOF_FLG='1'B THEN GOTO RFWRET; /* Yes,no more firmware             */
      124     1595    2             ELSE DO;
      125     1596    2                 EOF_FLG='1'B;
      126     1597    2                 GOTO READFW;
      127     1598    2               END;                        /* ELSE                               */
      128     1599    1   READFW0:
      129     1600    1           RFW_ZONE.IDCW$=ADDR(TPBTC);     /* Read primitive                     */
      130     1601    1           RFW_ZONE.DCW=PODCW;
      131     1602    1           DEVINFO.DEV#(INDX)=0;           /* Set DEV#=0 for PO tape             */
      132     1603    1           RD_FW_FLG='1'B;
      133     1604    1           CALL DOIOX(INDX,ADDR(RFW_ZONE));
      134     1605    1           RD_FW_FLG='0'B;
      135     1606    1   PROCESS:
      136     1607        /* Check status */
      137     1608    2           IF (DEVINFO.BSTAT.W1(INDX)&%STSMSK)~='0'B THEN DO;
      138     1609    2   RFWERRET:
      139     1610    2                 DEVINFO.DEV#(INDX)=SAVE_DEV;
      140     1611    2                 ALTRETURN;                /* Bad news ..                        */
      141     1612    2               END;                        /* THEN                               */
      142     1613    1             ELSE;
      143     1614    1           EOF_FLG='0'B;
      144     1615    1           IMAGE$=ADDR(POBUF);
      145     1616    1           CURR$=IMAGE$;
      146     1617                                                /* Test if 'CP-6'                     */
      147     1618    1           IF BCW=%BINCP6 THEN GOTO RFWRET; /* No more firmware                  */
      148     1619    1             ELSE;
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:5    
      149     1620    1           ACT_BUF_LEN=BCW.SZ;             /* Actual buffer length               */
      150     1621    1           IMAGE_PTR.WOFFS=IMAGE_PTR.WOFFS+1; /* Skip block control word         */
      151     1622    1   PRCW:
      152     1623        /* Process record control word */
      153     1624    1           IF (IMAGE_PTR.WOFFS-POBUF_PTR.WOFFS)>=ACT_BUF_LEN THEN GOTO READFW;
              1624                    /* No more records in this block */
      154     1625    1             ELSE;
      155     1626        /* Check record size */
      156     1627    1           IF RCW.SZ=0 THEN GOTO READFW;   /* Size =0                            */
      157     1628    1             ELSE;
      158     1629    1           IF RCW.BMED.BH='1'B THEN GOTO HOLL; /* BCD image                      */
      159     1630    1             ELSE;
      160     1631    1           IF FWR_FLG='0'B THEN GOTO READFW;
              1631                    /* Skip binary cards, until file has been found */
      161     1632    1             ELSE;
      162     1633    1   BINARY:
      163     1634    1           CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+1; /* Card word#1                      */
      164     1635    2           IF WRD.H1='405505'O THEN DO;    /* Preface card, skip it              */
      165     1636    2   BNEWREC:
      166     1637    2                 IMAGE_PTR.WOFFS=IMAGE_PTR.WOFFS+28; /* 27 words on binary card  */
      167     1638    2                 GOTO PRCW;                /* Process new record                 */
      168     1639    2               END;                        /* THEN                               */
      169     1640    1             ELSE;
      170     1641    1   DATA:
      171     1642    1           WRDCNT=BITBIN(WRD.H1.B3);       /* Nr of words on this card           */
      172     1643        /* Look for MPCBOT */
      173     1644    2           DO CURR_PTR.WOFFS=CURR_PTR.WOFFS+1 TO IMAGE_PTR.WOFFS+27;
              1644                    /* Begin with word#2, until the end of the card */
      174     1645    2             CALL XLATE_6_TO_9(ASCSTRING,BCD2ASC,WRD);
      175     1646    2             IF ASCSTRING='MPCBOT' THEN GOTO FOUND;
      176     1647    2               ELSE;
      177     1648    2           END;                            /* DO                                 */
      178     1649        /* Not MPCBOT, skip to word#6 */
      179     1650    1   PDATA:
      180     1651    1           CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+6;
      181     1652    1   DLOOP:
      182     1653        /* Move data */
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:6    
      183     1654    1           FWINFO_LGTH=WRDCNT*4;
      184     1655    1           FW$->FWINFO=CURR$->FWINFO;
      185     1656    1           FW_PTR.WOFFS=FW_PTR.WOFFS+WRDCNT;
      186     1657    1           GOTO BNEWREC;
      187     1658    1   FOUND:
      188     1659    1           IF IMAGE_PTR.WOFFS+6+WRDCNT<CURR_PTR.WOFFS THEN DKIDF_FLG='1'B;
              1659                    /* Must process some data on MPCBOT card */
      189     1660    1             ELSE DKIDF_FLG='0'B;
      190     1661    1   DECKID:
      191     1662    1           CURR_PTR.WOFFS=CURR_PTR.WOFFS-5; /* Back up 5 words before MPCBOT     */
      192     1663    1           MPCINF=WRD;
      193     1664    1           CURR_PTR.WOFFS=CURR_PTR.WOFFS+1;
      194     1665    1           MPCINF1=WRD;
      195     1666    1           IF DKIDF_FLG='0'B THEN GOTO BNEWREC;
      196     1667    1             ELSE GOTO PDATA;
      197     1668        /**/
      198     1669    1   HOLL:
      199     1670    1           CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+2; /* Card word#2                      */
      200     1671    1           CALL XLATE_6_TO_9(ASCSTRING,BCD2ASC,WRD);
      201     1672        /* Look for $ OBJECT or $ DKEND */
      202     1673    2           DO SELECT(ASCSTRING);
      203     1674    2             SELECT(' OBJEC');
      204     1675        /* Move to word#13 */
      205     1676    2             CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+13;
      206     1677    2             IF LABEL~=' ' THEN GOTO OBJECT2; /* firmware specified              */
      207     1678    2               ELSE;
      208     1679    2             CALL XLATE_6_TO_9(LABEL,BCD2ASC,WRD);
      209     1680    2             IF READ_FLG='0'B THEN GOTO OBJECT22;
              1680                      /* Reading PO tape, this one will do */
      210     1681    2               ELSE;
      211     1682        /* Reading FW tape */
      212     1683    2             CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+4; /* Card word#4                    */
      213     1684    2             CALL XLATE_6_TO_9(ASCSTRING,BCD2ASC,WRD);
      214     1685    3             DO SELECT(SUBSTR(ASCSTRING,4,1)); /*Interested in char#23           */
      215     1686    3               SELECT('F');                /* Firmware                           */
      216     1687    3               CURR_PTR.WOFFS=CURR_PTR.WOFFS+1; /* See if applicable for CP-6    */
      217     1688    3               CALL XLATE_6_TO_9(ASCSTRING,BCD2ASC,WRD);
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:7    
      218     1689    3               IF SUBSTR(ASCSTRING,0,1)~='C' THEN GOTO ASKEM; /* Char#25         */
      219     1690    3                 ELSE;                     /* Not applicable for CP-6            */
      220     1691    3   OBJECT0:
      221     1692    3               LABEL=' ';
      222     1693    3               GOTO READFW;
      223     1694    3               SELECT('I');
      224     1695        /* Test firmware here */
      225     1696    3               GOTO OBJECT0;
      226     1697    3               SELECT(ELSE);
      227     1698        /* No more firmware */
      228     1699    3             GOTO RFWRET;
      229     1700    3             END;                          /* DO CASE                            */
      230     1701    2           SELECT(' DKEND');
      231     1702    2           CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+12; /* Card word#12                    */
      232     1703    2           CALL XLATE_6_TO_9(FWREV,BCD2ASC,WRD.H2.B2_3); /* Firmware's revision  */
      233     1704    2           IF FWR_FLG='0'B THEN GOTO READFW; /* No previous $ OBJECT card        */
      234     1705    2             ELSE;
      235     1706    2           MESSAGE$=ADDR(FWQ);
      236     1707    2           SUBSTR(TEXTM.TXT,17,2)=FWREV;
      237     1708    2           IF TAPE_FLG='1'B THEN GOTO OBJECT1; /* FW tape                        */
      238     1709    2           IF ORDBFLG~='0'B THEN GOTO RFWRETX; /* OR or DB                       */
      239     1710    2             ELSE;
      240     1711    2           IF FWFPO_FLG='1'B THEN GOTO HOLL1;
      241     1712    2             ELSE;
      242     1713    2           FWFPO_FLG='1'B;
      243     1714    2           IF SILENT='0'B THEN CALL TYPEC(FWF);
      244     1715    2   HOLL1:
      245     1716    2           MESSAGE$=ADDR(FWF1);
      246     1717    2           SUBSTR(TEXTM.TXT,5,2)=FWREV;
      247     1718    2           SUBSTR(TEXTM.TXT,11,4)=LABEL;
      248     1719    2           IF SILENT='0'B THEN CALL TYPEC(FWF1);
      249     1720    2           GOTO RFWRETX;
      250     1721    2           SELECT(ELSE);
      251     1722    2   HNEWREC:
      252     1723    2           IMAGE_PTR.WOFFS=IMAGE_PTR.WOFFS+15; /* 14 words on hollerith cards    */
      253     1724    2           GOTO PRCW;
      254     1725    2           END;                            /* DO CASE                            */
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:8    
      255     1726    1   ASKEM:
      256     1727    1           MESSAGE$=ADDR(FWQ);
      257     1728    1           SUBSTR(TEXTM.TXT,32,4)=LABEL;
      258     1729    1           GOTO OBJECT22;
      259     1730    1   OBJECT1:
      260     1731    1           CALL KEYIN(FWQ,ANSBUF);
      261     1732    1           CALL UPPER_CASE(ANSBUF.TXT,1);
      262     1733    1           IF SUBSTR(ANSBUF.TXT,0,1)='Y' THEN GOTO RFWRETX; /* Give it to him    */
      263     1734    1           IF SUBSTR(ANSBUF.TXT,0,1)~='N' THEN GOTO OBJECT1; /* Ask again        */
      264     1735    1             ELSE;
      265     1736    1           LABEL=' ';
      266     1737    1           FW$=FWBASE$;
      267     1738    1           FWR_FLG='0'B;                   /* File not found                     */
      268     1739    1           GOTO READFW;
      269     1740    1   OBJECT2:
      270     1741    1           IF SUBSTR(ASCSTRING,0,4)~=LABEL THEN GOTO READFW;
              1741                    /* This is not the requested one */
      271     1742    1   OBJECT22:
      272     1743    1           FWR_FLG='1'B;
      273     1744    1           GOTO HNEWREC;
      274     1745        /**/
      275     1746    1   RFWRET:
      276     1747    1           LABEL=' ';
      277     1748    1   RFWRETX:
      278     1749    1           DEVINFO.DEV#(INDX)=SAVE_DEV;
      279     1750    1           RETURN;
      280     1751    1   END GTFWR;
      281     1752        %EOD;

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:9    
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure GTFWR.

   Procedure GTFWR requires 374 words for executable code.
   Procedure GTFWR requires 24 words of local(AUTO) storage.

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:10   

 Object Unit name= GTFWR                                      File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:56:53.68 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none    40     50  GTFWR
    1  RoData even  UTS     26     32  GTFWR
    2   Proc  even  none   374    566  GTFWR
    3  RoData even  none    14     16  GTFWR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        3  GTFWR

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      4  MPCINF                             0      5  MPCINF1
    0      6  PODCW                              0     10  CURR_PTR
    0     11  RFW_ZONE                           0     13  FWQ
    0     27  FWF                                0     43  FWF1
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:11   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       5 MINIQC_PL6
         yes           Std       4 DOIOX
         yes           Std       1 TYPEC
 yes     yes           Std       2 KEYIN
         yes           Std       2 UPPER_CASE
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     RD_FW_FLG                             SILENT                                FW$
     POBUF                                 DEVINFO                               LABEL
     ORDBFLG                               ANSBUF                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:12   


        1        1        /*M* PL6 ROUTINES FOR AARDVARK                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=8,IND=2,THI=2,ENU=2,CSU=2,DTI=4,DCI=4,ECU=4,AND */
        8        8        /**/
        9        9        /**/
       10       10        GTFWR:  PROC(INDX,READ_FLG,TAPE_FLG) ALTRET;

     10  2 000000   000000 700200 xent  GTFWR        TSX0  ! X66_AUTO_3
         2 000001   000030 000003                    ZERO    24,3

       11       11        /* This program loads firmware from PO or FW tape in memory */
       12       12        /* When read error -> ALTRETURN .
       13       13           When no more firmware -> LABEL=' ' .
       14       14           Else, firmware name ->LABEL .        */
       15       15        %INCLUDE IS$MACROS;
       16     1290        /**/
       17     1291    1   DCL INDX UBIN WORD;                     /* Firmware tape's index in DEVINFO   */
       18     1292    1   DCL TAPE_FLG BIT(1) ALIGNED; /* '0'B-> PO tape.
       19     1293                                '1'B-> FW tape. */
       20     1294    1   DCL READ_FLG BIT(1) ALIGNED; /* '0'B-> PO tape.
       21     1295                                '1'B-> FW tape. */
       22     1296        /**/
       23     1297    1   DCL RD_FW_FLG BIT(1) SYMREF;
       24     1298    1   DCL SILENT BIT(1) SYMREF;               /* If ='1'B don't write names of FW   */
       25     1299    1   DCL FW$ PTR SYMREF;                     /* Memory location for this firmware  */
       26     1300        %PTR_STRUCT(NAME=FW_PTR,STCLASS="REDEF FW$");
       27     1318    1   DCL POBUF(0:1023) BIT(36) SYMREF;       /* Reading buffer                     */
       28     1319        %DEVINFO(STCLASS="SYMREF");
       29     1388    1   DCL LABEL CHAR(4) SYMREF;               /* Firmware's name or ' '             */
       30     1389    1   DCL ORDBFLG BIT(2) SYMREF;
       31     1390    1   DCL 1 ANSBUF SYMREF,
       32     1391    1         2 CNT UBIN WORD,
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:13   
       33     1392    1         2 TXT CHAR(80);
       34     1393        /**/
       35     1394    1   DCL MINIQC_PL6 ENTRY(5) ALTRET;
       36     1395    1   DCL DOIOX ENTRY(4);
       37     1396    1   DCL TYPEC ENTRY(1);
       38     1397    1   DCL KEYIN ENTRY(2) ALTRET;
       39     1398    1   DCL UPPER_CASE ENTRY(2);
       40     1399        /**/
       41     1400    1   DCL FWR_FLG BIT(1) STATIC INIT('0'B);   /* Firmware found flag                */
       42     1401    1   DCL EOF_FLG BIT(1) STATIC INIT('0'B);   /* EOF flag                           */
       43     1402    1   DCL DKIDF_FLG BIT(1) STATIC INIT('0'B); /* DECK ID flag                       */
       44     1403    1   DCL FWFPO_FLG BIT(1) STATIC INIT('0'B);
       45     1404    1   DCL BCD2ASC CHAR(64)CONSTANT INIT
       46     1405    1   ('0123456789[#@:>? ABCDEFGHI&.](<\^JKLMNOPQR-$*);''+/STUVWXYZ_,%="!');
       47     1406    1   DCL POBUF$ PTR CONSTANT INIT(ADDR(POBUF));
       48     1407        %PTR_STRUCT(NAME=POBUF_PTR,STCLASS="REDEF POBUF$");
       49     1425    1   DCL TPBTC BIT(36) ALIGNED CONSTANT INIT('05'O); /* Tape boot command          */
       50     1426    1   DCL MPCINF BIT(36) ALIGNED STATIC SYMDEF;
       51     1427    1   DCL MPCINF1 BIT(36) ALIGNED STATIC SYMDEF;
       52     1428        %DCW_STRUCT(NAME=PODCW);                /* firmware read DCW                  */
       53     1446    1   DCL IMAGE$ PTR STATIC INIT(ADDR(POBUF));
       54     1447        %PTR_STRUCT(NAME=IMAGE_PTR,STCLASS="REDEF IMAGE$");
       55     1465        %PTR_STRUCT(NAME=CURR_PTR);
       56     1483    1   DCL CURR$ REDEF CURR_PTR PTR;
       57     1484        %DOIO_COMZONE(NAME=RFW_ZONE);
       58     1517        /**/
       59     1518    1   DCL FWREV CHAR(2);
       60     1519    1   DCL FWBASE$ PTR;
       61     1520    1   DCL MESSAGE$ PTR;
       62     1521    1   DCL ACT_BUF_LEN UBIN HALF;
       63     1522    1   DCL SAVE_DEV UBIN(6);
       64     1523    1   DCL I UBIN WORD;
       65     1524    1   DCL ASCSTRING CHAR(6);                  /* Result of XLATE                    */
       66     1525    1   DCL BLK_LEN UBIN(18);                   /* Actual block length                */
       67     1526    1   DCL WRDCNT UBIN WORD;                   /* Nr of words in a record            */
       68     1527        /* Info description */
       69     1528        /* Block control word */
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:14   
       70     1529    1   DCL 1 BCW BASED(IMAGE$) ALIGNED,
       71     1530    1         2 BLK# UBIN HALF UNAL,
       72     1531    1         2 SZ UBIN HALF UNAL;
       73     1532        /* Record control word */
       74     1533    1   DCL 1 RCW BASED(IMAGE$) ALIGNED,
       75     1534    1         2 SZ UBIN HALF UNAL,
       76     1535    1         2 * BIT(8),
       77     1536    1         2 MEDIA UBIN(4) UNAL,
       78     1537    1         2 BMED REDEF MEDIA,
       79     1538    1           3 * BIT(2),
       80     1539    1           3 BH BIT(1),
       81     1540    1           3 * BIT(1),
       82     1541    1         2 RC BIT(6);
       83     1542        /* Current info word */
       84     1543    1   DCL 1 WRD BASED(CURR$) ALIGNED,
       85     1544    1         2 H1,
       86     1545    1           3 B1 BIT(6),
       87     1546    1           3 B2 BIT(6),
       88     1547    1           3 B3 BIT(6),
       89     1548    1         2 H2,
       90     1549    1           3 B1 BIT(6),
       91     1550    1           3 B2_3 BIT(12);
       92     1551    1   DCL FWINFO CHAR(FWINFO_LGTH) BASED;
       93     1552    1   DCL FWINFO_LGTH UBIN WORD;
       94     1553        /**/
       95     1554        /* Messages */
       96     1555        %TEXTC(N#=FWQ,M#="' Do you want REV.XX of firmware XXXX (Y/N) ?'");
       97     1560        %TEXTC(N#=FWF,M#="' The following firmware modules were found.'");
       98     1565        %TEXTC(N#=FWF1,M#="' Rev.XX of XXXX.'");
       99     1570    1   DCL 1 TEXTM BASED(MESSAGE$),
      100     1571    1         2 CNT UBIN WORD,
      101     1572    1         2 TXT CHAR(TEXTM.CNT);
      102     1573        /**/
      103     1574    1           SAVE_DEV=DEVINFO.DEV#(INDX);    /* PO tape DEV# must be set to 0      */

   1574  2 000002   200003 470500                    LDP0    @INDX,,AUTO
         2 000003   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:15   
         2 000004   000006 402007                    MPY     6,DL
         2 000005   000001 736000                    QLS     1
         2 000006   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000007   000025 772000                    QRL     21
         2 000010   000077 376007                    ANQ     63,DL
         2 000011   000036 736000                    QLS     30
         2 000012   200012 756100                    STQ     SAVE_DEV,,AUTO

      104     1575    1           FWR_FLG='0'B;                   /* Flags = 0 before searching         */

   1575  2 000013   000000 450000 0                  STZ     FWR_FLG

      105     1576    1           EOF_FLG='0'B;

   1576  2 000014   000001 450000 0                  STZ     EOF_FLG

      106     1577    1           FWBASE$=FW$;

   1577  2 000015   000000 236000 xsym               LDQ     FW$
         2 000016   200007 756100                    STQ     FWBASE$,,AUTO

      107     1578    1           IMAGE$=ADDR(POBUF);

   1578  2 000017   000000 236000 3                  LDQ     0
         2 000020   000007 756000 0                  STQ     IMAGE$

      108     1579        /* Build PODCW */
      109     1580    1           PODCW.AD=IMAGE_PTR.WOFFS;

   1580  2 000021   000007 220000 0                  LDX0    IMAGE$
         2 000022   000006 740000 0                  STX0    PODCW

      110     1581    1           PODCW.TALLY=320;

   1581  2 000023   000500 236007                    LDQ     320,DL
         2 000024   000006 752003 0                  STCQ    PODCW,'03'O

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:16   
      111     1582        /**/
      112     1583    1   READFW:
      113     1584        /* Clear the input buffer */
      114     1585    1           POBUF='0'B;

   1585  2 000025   010000 220003       READFW       LDX0    4096,DU
         2 000026   000040 100400                    MLR     fill='000'O
         2 000027   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000030   000000 000010 xsym               ADSC9   POBUF                    cn=0,n=*X0

      115     1586        /**/
      116     1587    1           IF READ_FLG='0'B THEN GOTO READFW0; /* PO tape (Primitive)            */

   1587  2 000031   200004 470500                    LDP0    @READ_FLG,,AUTO
         2 000032   000000 234100                    SZN     0,,PR0
         2 000033   000065 605000 2                  TPL     READFW0

      117     1588    1             ELSE;
      118     1589        /* FW tape , read binary */
      119     1590    1           CALL MINIQC_PL6(INDX,ADDR(PODCW),0,%FCNRTB) ALTRET(RFWERRET);

   1590  2 000034   000001 236000 3                  LDQ     1
         2 000035   200022 756100                    STQ     FWINFO_LGTH+2,,AUTO
         2 000036   000002 237000 3                  LDAQ    2
         2 000037   200026 757100                    STAQ    FWINFO_LGTH+6,,AUTO
         2 000040   200022 631500                    EPPR1   FWINFO_LGTH+2,,AUTO
         2 000041   200025 451500                    STP1    FWINFO_LGTH+5,,AUTO
         2 000042   200003 236100                    LDQ     @INDX,,AUTO
         2 000043   200024 756100                    STQ     FWINFO_LGTH+4,,AUTO
         2 000044   200024 630500                    EPPR0   FWINFO_LGTH+4,,AUTO
         2 000045   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000046   000000 701000 xent               TSX1    MINIQC_PL6
         2 000047   000124 702000 2                  TSX2    RFWERRET

      120     1591        /* Check if EOF */
      121     1592    1           IF (DEVINFO.BSTAT.W1.H1(INDX)&'77'O)~='44'O THEN GOTO PROCESS;/* No EOF */

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:17   
   1592  2 000050   200003 470500                    LDP0    @INDX,,AUTO
         2 000051   000000 236100                    LDQ     0,,PR0
         2 000052   000006 402007                    MPY     6,DL
         2 000053   000001 736000                    QLS     1
         2 000054   000004 220006 xsym               LDX0    DEVINFO+4,QL
         2 000055   770000 360003                    ANX0    -4096,DU
         2 000056   440000 100003                    CMPX0   -114688,DU
         2 000057   000115 601000 2                  TNZ     PROCESS

      122     1593    1             ELSE;                         /* Two EOFs in a row ?                */
      123     1594    1           IF EOF_FLG='1'B THEN GOTO RFWRET; /* Yes,no more firmware             */

   1594  2 000060   000001 234000 0                  SZN     EOF_FLG
         2 000061   000551 604000 2                  TMI     RFWRET

      124     1595    2             ELSE DO;

      125     1596    2                 EOF_FLG='1'B;

   1596  2 000062   400000 236003                    LDQ     -131072,DU
         2 000063   000001 756000 0                  STQ     EOF_FLG

      126     1597    2                 GOTO READFW;

   1597  2 000064   000025 710000 2                  TRA     READFW

      127     1598    2               END;                        /* ELSE                               */
      128     1599    1   READFW0:
      129     1600    1           RFW_ZONE.IDCW$=ADDR(TPBTC);     /* Read primitive                     */

   1600  2 000065   000004 236000 3     READFW0      LDQ     4
         2 000066   000011 756000 0                  STQ     RFW_ZONE

      130     1601    1           RFW_ZONE.DCW=PODCW;

   1601  2 000067   000006 236000 0                  LDQ     PODCW
         2 000070   000012 756000 0                  STQ     RFW_ZONE+1
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:18   

      131     1602    1           DEVINFO.DEV#(INDX)=0;           /* Set DEV#=0 for PO tape             */

   1602  2 000071   200003 471500                    LDP1    @INDX,,AUTO
         2 000072   100000 236100                    LDQ     0,,PR1
         2 000073   000006 402007                    MPY     6,DL
         2 000074   000001 736000                    QLS     1
         2 000075   000000 621006                    EAX1    0,QL
         2 000076   000005 236000 3                  LDQ     5
         2 000077   000000 356011 xsym               ANSQ    DEVINFO,X1

      132     1603    1           RD_FW_FLG='1'B;

   1603  2 000100   400000 236003                    LDQ     -131072,DU
         2 000101   000000 756000 xsym               STQ     RD_FW_FLG

      133     1604    1           CALL DOIOX(INDX,ADDR(RFW_ZONE));

   1604  2 000102   000006 236000 3                  LDQ     6
         2 000103   200022 756100                    STQ     FWINFO_LGTH+2,,AUTO
         2 000104   200022 633500                    EPPR3   FWINFO_LGTH+2,,AUTO
         2 000105   200025 453500                    STP3    FWINFO_LGTH+5,,AUTO
         2 000106   200003 236100                    LDQ     @INDX,,AUTO
         2 000107   200024 756100                    STQ     FWINFO_LGTH+4,,AUTO
         2 000110   200024 630500                    EPPR0   FWINFO_LGTH+4,,AUTO
         2 000111   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000112   000000 701000 xent               TSX1    DOIOX
         2 000113   000000 011000                    NOP     0

      134     1605    1           RD_FW_FLG='0'B;

   1605  2 000114   000000 450000 xsym               STZ     RD_FW_FLG

      135     1606    1   PROCESS:
      136     1607        /* Check status */
      137     1608    2           IF (DEVINFO.BSTAT.W1(INDX)&%STSMSK)~='0'B THEN DO;

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:19   
   1608  2 000115   200003 470500       PROCESS      LDP0    @INDX,,AUTO
         2 000116   000000 236100                    LDQ     0,,PR0
         2 000117   000006 402007                    MPY     6,DL
         2 000120   000001 736000                    QLS     1
         2 000121   000004 236006 xsym               LDQ     DEVINFO+4,QL
         2 000122   000022 376000 1                  ANQ     TPBTC+1
         2 000123   000137 600000 2                  TZE     s:1614

      138     1609    2   RFWERRET:
      139     1610    2                 DEVINFO.DEV#(INDX)=SAVE_DEV;

   1610  2 000124   200003 470500       RFWERRET     LDP0    @INDX,,AUTO
         2 000125   000000 236100                    LDQ     0,,PR0
         2 000126   000006 402007                    MPY     6,DL
         2 000127   000001 736000                    QLS     1
         2 000130   000000 620006                    EAX0    0,QL
         2 000131   200012 236100                    LDQ     SAVE_DEV,,AUTO
         2 000132   000011 772000                    QRL     9
         2 000133   000000 676010 xsym               ERQ     DEVINFO,X0
         2 000134   000770 376003                    ANQ     504,DU
         2 000135   000000 656010 xsym               ERSQ    DEVINFO,X0

      140     1611    2                 ALTRETURN;                /* Bad news ..                        */

   1611  2 000136   000000 702200 xent               TSX2  ! X66_AALT

      141     1612    2               END;                        /* THEN                               */
      142     1613    1             ELSE;
      143     1614    1           EOF_FLG='0'B;

   1614  2 000137   000001 450000 0                  STZ     EOF_FLG

      144     1615    1           IMAGE$=ADDR(POBUF);

   1615  2 000140   000000 236000 3                  LDQ     0
         2 000141   000007 756000 0                  STQ     IMAGE$

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:20   
      145     1616    1           CURR$=IMAGE$;

   1616  2 000142   000010 756000 0                  STQ     CURR_PTR

      146     1617                                                /* Test if 'CP-6'                     */
      147     1618    1           IF BCW=%BINCP6 THEN GOTO RFWRET; /* No more firmware                  */

   1618  2 000143   000007 471400 0                  LDP1    IMAGE$
         2 000144   100000 236100                    LDQ     0,,PR1
         2 000145   000023 116000 1                  CMPQ    TPBTC+2
         2 000146   000551 600000 2                  TZE     RFWRET

      148     1619    1             ELSE;
      149     1620    1           ACT_BUF_LEN=BCW.SZ;             /* Actual buffer length               */

   1620  2 000147   100000 720100                    LXL0    0,,PR1
         2 000150   200011 740100                    STX0    ACT_BUF_LEN,,AUTO

      150     1621    1           IMAGE_PTR.WOFFS=IMAGE_PTR.WOFFS+1; /* Skip block control word         */

   1621  2 000151   000007 221000 0                  LDX1    IMAGE$
         2 000152   000001 622011                    EAX2    1,X1
         2 000153   000007 742000 0                  STX2    IMAGE$

      151     1622    1   PRCW:
      152     1623        /* Process record control word */
      153     1624    1           IF (IMAGE_PTR.WOFFS-POBUF_PTR.WOFFS)>=ACT_BUF_LEN THEN GOTO READFW;
              1624                    /* No more records in this block */

   1624  2 000154   000020 235000 1     PRCW         LDA     POBUF$
         2 000155   000022 771000                    ARL     18
         2 000156   200022 755100                    STA     FWINFO_LGTH+2,,AUTO
         2 000157   000007 236000 0                  LDQ     IMAGE$
         2 000160   000022 772000                    QRL     18
         2 000161   200022 136100                    SBLQ    FWINFO_LGTH+2,,AUTO
         2 000162   200011 235100                    LDA     ACT_BUF_LEN,,AUTO
         2 000163   000022 771000                    ARL     18
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:21   
         2 000164   200023 755100                    STA     FWINFO_LGTH+3,,AUTO
         2 000165   200023 116100                    CMPQ    FWINFO_LGTH+3,,AUTO
         2 000166   000025 605000 2                  TPL     READFW

      154     1625    1             ELSE;
      155     1626        /* Check record size */
      156     1627    1           IF RCW.SZ=0 THEN GOTO READFW;   /* Size =0                            */

   1627  2 000167   000007 470400 0                  LDP0    IMAGE$
         2 000170   000000 220100                    LDX0    0,,PR0
         2 000171   000025 600000 2                  TZE     READFW

      157     1628    1             ELSE;
      158     1629    1           IF RCW.BMED.BH='1'B THEN GOTO HOLL; /* BCD image                      */

   1629  2 000172   000000 236100                    LDQ     0,,PR0
         2 000173   000200 316007                    CANQ    128,DL
         2 000174   000316 601000 2                  TNZ     HOLL

      159     1630    1             ELSE;
      160     1631    1           IF FWR_FLG='0'B THEN GOTO READFW;
              1631                    /* Skip binary cards, until file has been found */

   1631  2 000175   000000 234000 0                  SZN     FWR_FLG
         2 000176   000025 605000 2                  TPL     READFW

      161     1632    1             ELSE;
      162     1633    1   BINARY:
      163     1634    1           CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+1; /* Card word#1                      */

   1634  2 000177   000007 221000 0     BINARY       LDX1    IMAGE$
         2 000200   000001 622011                    EAX2    1,X1
         2 000201   000010 742000 0                  STX2    CURR_PTR

      164     1635    2           IF WRD.H1='405505'O THEN DO;    /* Preface card, skip it              */

   1635  2 000202   000010 471400 0                  LDP1    CURR_PTR
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:22   
         2 000203   100000 220100                    LDX0    0,,PR1
         2 000204   405505 100003                    CMPX0   -128187,DU
         2 000205   000212 601000 2                  TNZ     DATA

      165     1636    2   BNEWREC:
      166     1637    2                 IMAGE_PTR.WOFFS=IMAGE_PTR.WOFFS+28; /* 27 words on binary card  */

   1637  2 000206   000007 220000 0     BNEWREC      LDX0    IMAGE$
         2 000207   000034 621010                    EAX1    28,X0
         2 000210   000007 741000 0                  STX1    IMAGE$

      167     1638    2                 GOTO PRCW;                /* Process new record                 */

   1638  2 000211   000154 710000 2                  TRA     PRCW

      168     1639    2               END;                        /* THEN                               */
      169     1640    1             ELSE;
      170     1641    1   DATA:
      171     1642    1           WRDCNT=BITBIN(WRD.H1.B3);       /* Nr of words on this card           */

   1642  2 000212   100000 236100       DATA         LDQ     0,,PR1
         2 000213   000022 772000                    QRL     18
         2 000214   000077 376007                    ANQ     63,DL
         2 000215   200017 756100                    STQ     WRDCNT,,AUTO

      172     1643        /* Look for MPCBOT */
      173     1644    2           DO CURR_PTR.WOFFS=CURR_PTR.WOFFS+1 TO IMAGE_PTR.WOFFS+27;
              1644                    /* Begin with word#2, until the end of the card */

   1644  2 000216   000001 623012                    EAX3    1,X2
         2 000217   000010 743000 0                  STX3    CURR_PTR
         2 000220   000235 710000 2                  TRA     s:1648+3

      174     1645    2             CALL XLATE_6_TO_9(ASCSTRING,BCD2ASC,WRD);

   1645  2 000221   000010 470400 0                  LDP0    CURR_PTR
         2 000222   020100 160500                    MVT     fill='020'O
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:23   
         2 000223   000000 020006                    ADSC6   0,,PR0                   cn=0,n=6
         2 000224   200014 000006                    ADSC9   ASCSTRING,,AUTO          cn=0,n=6
         2 000225   000000 000000 1                  ARG     BCD2ASC

      175     1646    2             IF ASCSTRING='MPCBOT' THEN GOTO FOUND;

   1646  2 000226   040000 106500                    CMPC    fill='040'O
         2 000227   200014 000006                    ADSC9   ASCSTRING,,AUTO          cn=0,n=6
         2 000230   000024 000006 1                  ADSC9   TPBTC+3                  cn=0,n=6
         2 000231   000264 600000 2                  TZE     FOUND

      176     1647    2               ELSE;
      177     1648    2           END;                            /* DO                                 */

   1648  2 000232   000010 220000 0                  LDX0    CURR_PTR
         2 000233   000001 621010                    EAX1    1,X0
         2 000234   000010 741000 0                  STX1    CURR_PTR
         2 000235   000007 220000 0                  LDX0    IMAGE$
         2 000236   000033 621010                    EAX1    27,X0
         2 000237   000010 101000 0                  CMPX1   CURR_PTR
         2 000240   000221 603000 2                  TRC     s:1645

      178     1649        /* Not MPCBOT, skip to word#6 */
      179     1650    1   PDATA:
      180     1651    1           CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+6;

   1651  2 000241   000007 220000 0     PDATA        LDX0    IMAGE$
         2 000242   000006 621010                    EAX1    6,X0
         2 000243   000010 741000 0                  STX1    CURR_PTR

      181     1652    1   DLOOP:
      182     1653        /* Move data */
      183     1654    1           FWINFO_LGTH=WRDCNT*4;

   1654  2 000244   200017 235100       DLOOP        LDA     WRDCNT,,AUTO
         2 000245   000002 735000                    ALS     2
         2 000246   200020 755100                    STA     FWINFO_LGTH,,AUTO
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:24   

      184     1655    1           FW$->FWINFO=CURR$->FWINFO;

   1655  2 000247   000010 470400 0                  LDP0    CURR_PTR
         2 000250   000000 622005                    EAX2    0,AL
         2 000251   000000 471400 xsym               LDP1    FW$
         2 000252   200020 723100                    LXL3    FWINFO_LGTH,,AUTO
         2 000253   040140 100540                    MLR     fill='040'O
         2 000254   000000 000012                    ADSC9   0,,PR0                   cn=0,n=*X2
         2 000255   100000 000013                    ADSC9   0,,PR1                   cn=0,n=*X3

      185     1656    1           FW_PTR.WOFFS=FW_PTR.WOFFS+WRDCNT;

   1656  2 000256   000000 236000 xsym               LDQ     FW$
         2 000257   000022 772000                    QRL     18
         2 000260   200017 036100                    ADLQ    WRDCNT,,AUTO
         2 000261   000000 622006                    EAX2    0,QL
         2 000262   000000 742000 xsym               STX2    FW$

      186     1657    1           GOTO BNEWREC;

   1657  2 000263   000206 710000 2                  TRA     BNEWREC

      187     1658    1   FOUND:
      188     1659    1           IF IMAGE_PTR.WOFFS+6+WRDCNT<CURR_PTR.WOFFS THEN DKIDF_FLG='1'B;
              1659                    /* Must process some data on MPCBOT card */

   1659  2 000264   000007 236000 0     FOUND        LDQ     IMAGE$
         2 000265   000022 772000                    QRL     18
         2 000266   200017 036100                    ADLQ    WRDCNT,,AUTO
         2 000267   000010 235000 0                  LDA     CURR_PTR
         2 000270   000022 771000                    ARL     18
         2 000271   200022 755100                    STA     FWINFO_LGTH+2,,AUTO
         2 000272   000006 036007                    ADLQ    6,DL
         2 000273   200022 116100                    CMPQ    FWINFO_LGTH+2,,AUTO
         2 000274   000300 603000 2                  TRC     s:1660

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:25   
   1659  2 000275   400000 236003                    LDQ     -131072,DU
         2 000276   000002 756000 0                  STQ     DKIDF_FLG
         2 000277   000301 710000 2                  TRA     DECKID

      189     1660    1             ELSE DKIDF_FLG='0'B;

   1660  2 000300   000002 450000 0                  STZ     DKIDF_FLG

      190     1661    1   DECKID:
      191     1662    1           CURR_PTR.WOFFS=CURR_PTR.WOFFS-5; /* Back up 5 words before MPCBOT     */

   1662  2 000301   777773 620005       DECKID       EAX0    -5,AL
         2 000302   000010 740000 0                  STX0    CURR_PTR

      192     1663    1           MPCINF=WRD;

   1663  2 000303   000010 470400 0                  LDP0    CURR_PTR
         2 000304   000000 236100                    LDQ     0,,PR0
         2 000305   000004 756000 0                  STQ     MPCINF

      193     1664    1           CURR_PTR.WOFFS=CURR_PTR.WOFFS+1;

   1664  2 000306   000001 621010                    EAX1    1,X0
         2 000307   000010 741000 0                  STX1    CURR_PTR

      194     1665    1           MPCINF1=WRD;

   1665  2 000310   000010 470400 0                  LDP0    CURR_PTR
         2 000311   000000 236100                    LDQ     0,,PR0
         2 000312   000005 756000 0                  STQ     MPCINF1

      195     1666    1           IF DKIDF_FLG='0'B THEN GOTO BNEWREC;

   1666  2 000313   000002 234000 0                  SZN     DKIDF_FLG
         2 000314   000206 605000 2                  TPL     BNEWREC

      196     1667    1             ELSE GOTO PDATA;
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:26   

   1667  2 000315   000241 710000 2                  TRA     PDATA

      197     1668        /**/
      198     1669    1   HOLL:
      199     1670    1           CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+2; /* Card word#2                      */

   1670  2 000316   000007 221000 0     HOLL         LDX1    IMAGE$
         2 000317   000002 622011                    EAX2    2,X1
         2 000320   000010 742000 0                  STX2    CURR_PTR

      200     1671    1           CALL XLATE_6_TO_9(ASCSTRING,BCD2ASC,WRD);

   1671  2 000321   000010 471400 0                  LDP1    CURR_PTR
         2 000322   020100 160500                    MVT     fill='020'O
         2 000323   100000 020006                    ADSC6   0,,PR1                   cn=0,n=6
         2 000324   200014 000006                    ADSC9   ASCSTRING,,AUTO          cn=0,n=6
         2 000325   000000 000000 1                  ARG     BCD2ASC

      201     1672        /* Look for $ OBJECT or $ DKEND */
      202     1673    2           DO SELECT(ASCSTRING);

   1673  2 000326   040000 106500                    CMPC    fill='040'O
         2 000327   200014 000006                    ADSC9   ASCSTRING,,AUTO          cn=0,n=6
         2 000330   000026 000006 1                  ADSC9   TPBTC+5                  cn=0,n=6
         2 000331   000334 602000 2                  TNC     s:1673+6
         2 000332   000341 600000 2                  TZE     s:1676
         2 000333   000503 710000 2                  TRA     HNEWREC
         2 000334   040000 106500                    CMPC    fill='040'O
         2 000335   200014 000006                    ADSC9   ASCSTRING,,AUTO          cn=0,n=6
         2 000336   000030 000006 1                  ADSC9   TPBTC+7                  cn=0,n=6
         2 000337   000503 601000 2                  TNZ     HNEWREC
         2 000340   000422 710000 2                  TRA     s:1702

      203     1674    2             SELECT(' OBJEC');

      204     1675        /* Move to word#13 */
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:27   
      205     1676    2             CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+13;

   1676  2 000341   000015 620011                    EAX0    13,X1
         2 000342   000010 740000 0                  STX0    CURR_PTR

      206     1677    2             IF LABEL~=' ' THEN GOTO OBJECT2; /* firmware specified              */

   1677  2 000343   000000 236000 xsym               LDQ     LABEL
         2 000344   000035 116000 xsym               CMPQ    B_VECTNIL+29
         2 000345   000544 601000 2                  TNZ     OBJECT2

      207     1678    2               ELSE;
      208     1679    2             CALL XLATE_6_TO_9(LABEL,BCD2ASC,WRD);

   1679  2 000346   000010 471400 0                  LDP1    CURR_PTR
         2 000347   020000 160500                    MVT     fill='020'O
         2 000350   100000 020006                    ADSC6   0,,PR1                   cn=0,n=6
         2 000351   000000 000004 xsym               ADSC9   LABEL                    cn=0,n=4
         2 000352   000000 000000 1                  ARG     BCD2ASC

      209     1680    2             IF READ_FLG='0'B THEN GOTO OBJECT22;
              1680                      /* Reading PO tape, this one will do */

   1680  2 000353   200004 473500                    LDP3    @READ_FLG,,AUTO
         2 000354   300000 234100                    SZN     0,,PR3
         2 000355   000546 605000 2                  TPL     OBJECT22

      210     1681    2               ELSE;
      211     1682        /* Reading FW tape */
      212     1683    2             CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+4; /* Card word#4                    */

   1683  2 000356   000004 623011                    EAX3    4,X1
         2 000357   000010 743000 0                  STX3    CURR_PTR

      213     1684    2             CALL XLATE_6_TO_9(ASCSTRING,BCD2ASC,WRD);

   1684  2 000360   000010 471400 0                  LDP1    CURR_PTR
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:28   
         2 000361   020100 160500                    MVT     fill='020'O
         2 000362   100000 020006                    ADSC6   0,,PR1                   cn=0,n=6
         2 000363   200014 000006                    ADSC9   ASCSTRING,,AUTO          cn=0,n=6
         2 000364   000000 000000 1                  ARG     BCD2ASC

      214     1685    3             DO SELECT(SUBSTR(ASCSTRING,4,1)); /*Interested in char#23           */

   1685  2 000365   200015 236100                    LDQ     ASCSTRING+1,,AUTO
         2 000366   777000 376003                    ANQ     -512,DU
         2 000367   106000 116003                    CMPQ    35840,DU
         2 000370   000421 602000 2                  TNC     s:1699
         2 000371   200015 236100                    LDQ     ASCSTRING+1,,AUTO
         2 000372   777000 376003                    ANQ     -512,DU
         2 000373   106000 116003                    CMPQ    35840,DU
         2 000374   000402 600000 2                  TZE     s:1687
         2 000375   200015 236100                    LDQ     ASCSTRING+1,,AUTO
         2 000376   777000 376003                    ANQ     -512,DU
         2 000377   111000 116003                    CMPQ    37376,DU
         2 000400   000421 601000 2                  TNZ     s:1699
         2 000401   000420 710000 2                  TRA     s:1696

      215     1686    3               SELECT('F');                /* Firmware                           */

      216     1687    3               CURR_PTR.WOFFS=CURR_PTR.WOFFS+1; /* See if applicable for CP-6    */

   1687  2 000402   000001 624013                    EAX4    1,X3
         2 000403   000010 744000 0                  STX4    CURR_PTR

      217     1688    3               CALL XLATE_6_TO_9(ASCSTRING,BCD2ASC,WRD);

   1688  2 000404   000010 471400 0                  LDP1    CURR_PTR
         2 000405   020100 160500                    MVT     fill='020'O
         2 000406   100000 020006                    ADSC6   0,,PR1                   cn=0,n=6
         2 000407   200014 000006                    ADSC9   ASCSTRING,,AUTO          cn=0,n=6
         2 000410   000000 000000 1                  ARG     BCD2ASC

      218     1689    3               IF SUBSTR(ASCSTRING,0,1)~='C' THEN GOTO ASKEM; /* Char#25         */
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:29   

   1689  2 000411   200014 236100                    LDQ     ASCSTRING,,AUTO
         2 000412   777000 376003                    ANQ     -512,DU
         2 000413   103000 116003                    CMPQ    34304,DU
         2 000414   000507 601000 2                  TNZ     ASKEM

      219     1690    3                 ELSE;                     /* Not applicable for CP-6            */
      220     1691    3   OBJECT0:
      221     1692    3               LABEL=' ';

   1692  2 000415   000035 236000 xsym  OBJECT0      LDQ     B_VECTNIL+29
         2 000416   000000 756000 xsym               STQ     LABEL

      222     1693    3               GOTO READFW;

   1693  2 000417   000025 710000 2                  TRA     READFW

      223     1694    3               SELECT('I');

      224     1695        /* Test firmware here */
      225     1696    3               GOTO OBJECT0;

   1696  2 000420   000415 710000 2                  TRA     OBJECT0

      226     1697    3               SELECT(ELSE);

      227     1698        /* No more firmware */
      228     1699    3             GOTO RFWRET;

   1699  2 000421   000551 710000 2                  TRA     RFWRET

      229     1700    3             END;                          /* DO CASE                            */

      230     1701    2           SELECT(' DKEND');

      231     1702    2           CURR_PTR.WOFFS=IMAGE_PTR.WOFFS+12; /* Card word#12                    */

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:30   
   1702  2 000422   000014 620011                    EAX0    12,X1
         2 000423   000010 740000 0                  STX0    CURR_PTR

      232     1703    2           CALL XLATE_6_TO_9(FWREV,BCD2ASC,WRD.H2.B2_3); /* Firmware's revision  */

   1703  2 000424   000010 471400 0                  LDP1    CURR_PTR
         2 000425   020100 160500                    MVT     fill='020'O
         2 000426   100000 420002                    ADSC6   0,,PR1                   cn=4,n=2
         2 000427   200006 000002                    ADSC9   FWREV,,AUTO              cn=0,n=2
         2 000430   000000 000000 1                  ARG     BCD2ASC

      233     1704    2           IF FWR_FLG='0'B THEN GOTO READFW; /* No previous $ OBJECT card        */

   1704  2 000431   000000 234000 0                  SZN     FWR_FLG
         2 000432   000025 605000 2                  TPL     READFW

      234     1705    2             ELSE;
      235     1706    2           MESSAGE$=ADDR(FWQ);

   1706  2 000433   000007 236000 3                  LDQ     7
         2 000434   200010 756100                    STQ     MESSAGE$,,AUTO

      236     1707    2           SUBSTR(TEXTM.TXT,17,2)=FWREV;

   1707  2 000435   200010 473500                    LDP3    MESSAGE$,,AUTO
         2 000436   300000 723100                    LXL3    0,,PR3
         2 000437   200006 236100                    LDQ     FWREV,,AUTO
         2 000440   000011 772000                    QRL     9
         2 000441   300005 552130                    STBQ    5,'30'O,PR3

      237     1708    2           IF TAPE_FLG='1'B THEN GOTO OBJECT1; /* FW tape                        */

   1708  2 000442   200005 471500                    LDP1    @TAPE_FLG,,AUTO
         2 000443   100000 234100                    SZN     0,,PR1
         2 000444   000516 604000 2                  TMI     OBJECT1

      238     1709    2           IF ORDBFLG~='0'B THEN GOTO RFWRETX; /* OR or DB                       */
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:31   

   1709  2 000445   000000 236000 xsym               LDQ     ORDBFLG
         2 000446   600000 316003                    CANQ    -65536,DU
         2 000447   000553 601000 2                  TNZ     RFWRETX

      239     1710    2             ELSE;
      240     1711    2           IF FWFPO_FLG='1'B THEN GOTO HOLL1;

   1711  2 000450   000003 234000 0                  SZN     FWFPO_FLG
         2 000451   000462 604000 2                  TMI     HOLL1

      241     1712    2             ELSE;
      242     1713    2           FWFPO_FLG='1'B;

   1713  2 000452   400000 236003                    LDQ     -131072,DU
         2 000453   000003 756000 0                  STQ     FWFPO_FLG

      243     1714    2           IF SILENT='0'B THEN CALL TYPEC(FWF);

   1714  2 000454   000000 234000 xsym               SZN     SILENT
         2 000455   000462 604000 2                  TMI     HOLL1

   1714  2 000456   000010 630400 3                  EPPR0   8
         2 000457   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000460   000000 701000 xent               TSX1    TYPEC
         2 000461   000000 011000                    NOP     0

      244     1715    2   HOLL1:
      245     1716    2           MESSAGE$=ADDR(FWF1);

   1716  2 000462   000011 236000 3     HOLL1        LDQ     9
         2 000463   200010 756100                    STQ     MESSAGE$,,AUTO

      246     1717    2           SUBSTR(TEXTM.TXT,5,2)=FWREV;

   1717  2 000464   200010 470500                    LDP0    MESSAGE$,,AUTO
         2 000465   000000 720100                    LXL0    0,,PR0
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:32   
         2 000466   200006 236100                    LDQ     FWREV,,AUTO
         2 000467   000011 772000                    QRL     9
         2 000470   000002 552130                    STBQ    2,'30'O,PR0

      247     1718    2           SUBSTR(TEXTM.TXT,11,4)=LABEL;

   1718  2 000471   040100 100400                    MLR     fill='040'O
         2 000472   000000 000004 xsym               ADSC9   LABEL                    cn=0,n=4
         2 000473   000003 600004                    ADSC9   3,,PR0                   cn=3,n=4

      248     1719    2           IF SILENT='0'B THEN CALL TYPEC(FWF1);

   1719  2 000474   000000 234000 xsym               SZN     SILENT
         2 000475   000502 604000 2                  TMI     s:1720

   1719  2 000476   000011 630400 3                  EPPR0   9
         2 000477   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000500   000000 701000 xent               TSX1    TYPEC
         2 000501   000000 011000                    NOP     0

      249     1720    2           GOTO RFWRETX;

   1720  2 000502   000553 710000 2                  TRA     RFWRETX

      250     1721    2           SELECT(ELSE);

      251     1722    2   HNEWREC:
      252     1723    2           IMAGE_PTR.WOFFS=IMAGE_PTR.WOFFS+15; /* 14 words on hollerith cards    */

   1723  2 000503   000007 220000 0     HNEWREC      LDX0    IMAGE$
         2 000504   000017 621010                    EAX1    15,X0
         2 000505   000007 741000 0                  STX1    IMAGE$

      253     1724    2           GOTO PRCW;

   1724  2 000506   000154 710000 2                  TRA     PRCW

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:33   
      254     1725    2           END;                            /* DO CASE                            */

      255     1726    1   ASKEM:
      256     1727    1           MESSAGE$=ADDR(FWQ);

   1727  2 000507   000007 236000 3     ASKEM        LDQ     7
         2 000510   200010 756100                    STQ     MESSAGE$,,AUTO

      257     1728    1           SUBSTR(TEXTM.TXT,32,4)=LABEL;

   1728  2 000511   200010 474500                    LDP4    MESSAGE$,,AUTO
         2 000512   400000 725100                    LXL5    0,,PR4
         2 000513   000000 236000 xsym               LDQ     LABEL
         2 000514   400011 756100                    STQ     9,,PR4

      258     1729    1           GOTO OBJECT22;

   1729  2 000515   000546 710000 2                  TRA     OBJECT22

      259     1730    1   OBJECT1:
      260     1731    1           CALL KEYIN(FWQ,ANSBUF);

   1731  2 000516   000012 630400 3     OBJECT1      EPPR0   10
         2 000517   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000520   000000 701000 xent               TSX1    KEYIN
         2 000521   000000 011000                    NOP     0

      261     1732    1           CALL UPPER_CASE(ANSBUF.TXT,1);

   1732  2 000522   000014 630400 3                  EPPR0   12
         2 000523   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000524   000000 701000 xent               TSX1    UPPER_CASE
         2 000525   000000 011000                    NOP     0

      262     1733    1           IF SUBSTR(ANSBUF.TXT,0,1)='Y' THEN GOTO RFWRETX; /* Give it to him    */

   1733  2 000526   000001 236000 xsym               LDQ     ANSBUF+1
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:34   
         2 000527   777000 376003                    ANQ     -512,DU
         2 000530   131000 116003                    CMPQ    45568,DU
         2 000531   000553 600000 2                  TZE     RFWRETX

      263     1734    1           IF SUBSTR(ANSBUF.TXT,0,1)~='N' THEN GOTO OBJECT1; /* Ask again        */

   1734  2 000532   000001 236000 xsym               LDQ     ANSBUF+1
         2 000533   777000 376003                    ANQ     -512,DU
         2 000534   116000 116003                    CMPQ    39936,DU
         2 000535   000516 601000 2                  TNZ     OBJECT1

      264     1735    1             ELSE;
      265     1736    1           LABEL=' ';

   1736  2 000536   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 000537   000000 756000 xsym               STQ     LABEL

      266     1737    1           FW$=FWBASE$;

   1737  2 000540   200007 236100                    LDQ     FWBASE$,,AUTO
         2 000541   000000 756000 xsym               STQ     FW$

      267     1738    1           FWR_FLG='0'B;                   /* File not found                     */

   1738  2 000542   000000 450000 0                  STZ     FWR_FLG

      268     1739    1           GOTO READFW;

   1739  2 000543   000025 710000 2                  TRA     READFW

      269     1740    1   OBJECT2:
      270     1741    1           IF SUBSTR(ASCSTRING,0,4)~=LABEL THEN GOTO READFW;
              1741                    /* This is not the requested one */

   1741  2 000544   200014 116100       OBJECT2      CMPQ    ASCSTRING,,AUTO
         2 000545   000025 601000 2                  TNZ     READFW

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:35   
      271     1742    1   OBJECT22:
      272     1743    1           FWR_FLG='1'B;

   1743  2 000546   400000 236003       OBJECT22     LDQ     -131072,DU
         2 000547   000000 756000 0                  STQ     FWR_FLG

      273     1744    1           GOTO HNEWREC;

   1744  2 000550   000503 710000 2                  TRA     HNEWREC

      274     1745        /**/
      275     1746    1   RFWRET:
      276     1747    1           LABEL=' ';

   1747  2 000551   000035 236000 xsym  RFWRET       LDQ     B_VECTNIL+29
         2 000552   000000 756000 xsym               STQ     LABEL

      277     1748    1   RFWRETX:
      278     1749    1           DEVINFO.DEV#(INDX)=SAVE_DEV;

   1749  2 000553   200003 470500       RFWRETX      LDP0    @INDX,,AUTO
         2 000554   000000 236100                    LDQ     0,,PR0
         2 000555   000006 402007                    MPY     6,DL
         2 000556   000001 736000                    QLS     1
         2 000557   000000 620006                    EAX0    0,QL
         2 000560   200012 236100                    LDQ     SAVE_DEV,,AUTO
         2 000561   000011 772000                    QRL     9
         2 000562   000000 676010 xsym               ERQ     DEVINFO,X0
         2 000563   000770 376003                    ANQ     504,DU
         2 000564   000000 656010 xsym               ERSQ    DEVINFO,X0

      279     1750    1           RETURN;

   1750  2 000565   000000 702200 xent               TSX2  ! X66_ARET
      280     1751    1   END GTFWR;
      281     1752        %EOD;

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:36   
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure GTFWR.
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:37   

 **** Variables and constants ****

  ****  Section 000  Data  GTFWR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    10-0-0/w PTR         r     1 CURR$                     10-0-0/w STRC        r     1 CURR_PTR
     2-0-0/b BIT         r     1 DKIDF_FLG                  1-0-0/b BIT         r     1 EOF_FLG
    27-0-0/w STRC(423)   r     1 FWF                       43-0-0/w STRC(180)   r     1 FWF1
     3-0-0/b BIT         r     1 FWFPO_FLG                 13-0-0/w STRC(432)   r     1 FWQ
     0-0-0/b BIT         r     1 FWR_FLG                    7-0-0/w PTR         r     1 IMAGE$
     7-0-0/w STRC        r     1 IMAGE_PTR                  4-0-0/w BIT         r     1 MPCINF
     5-0-0/w BIT         r     1 MPCINF1                    6-0-0/w STRC        r     1 PODCW
    11-0-0/w STRC(72)    r     1 RFW_ZONE

  ****  Section 001 RoData GTFWR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(64)    r     1 BCD2ASC                   20-0-0/w PTR         r     1 POBUF$
    20-0-0/w STRC        r     1 POBUF_PTR                 21-0-0/w BIT         r     1 TPBTC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @INDX                      4-0-0/w PTR         r     1 @READ_FLG
     5-0-0/w PTR         r     1 @TAPE_FLG                 11-0-0/w UBIN(18)    r     1 ACT_BUF_LEN
    14-0-0/c CHAR(6)     r     1 ASCSTRING                  7-0-0/w PTR         r     1 FWBASE$
    20-0-0/w UBIN        r     1 FWINFO_LGTH                6-0-0/c CHAR(2)     r     1 FWREV
    *0-0-0/w UBIN        r     1 INDX                      10-0-0/w PTR         r     1 MESSAGE$
    *0-0-0/w BIT         r     1 READ_FLG                  12-0-0/w UBIN(6)     r     1 SAVE_DEV
    *0-0-0/w BIT         r     1 TAPE_FLG                  17-0-0/w UBIN        r     1 WRDCNT

PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:38   
  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(756)   r     1 ANSBUF                     0-0-0/d STRC(396)   r     1 DEVINFO(0:21)
     0-0-0/w PTR         r     1 FW$                        0-0-0/w STRC        r     1 FW_PTR
     0-0-0/c CHAR(4)     r     1 LABEL                      0-0-0/b BIT (2)     r     1 ORDBFLG
     0-0-0/b BIT         r     1 POBUF(0:1023)              0-0-0/b BIT         r     1 RD_FW_FLG
     0-0-0/b BIT         r     1 SILENT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 BCW                        0-0-0/c ACHR        r     1 FWINFO
     0-0-0/w STRC        r     1 RCW                        0-0-0/w ASTR        r     1 TEXTM
     0-0-0/w STRC        r     1 WRD


   Procedure GTFWR requires 374 words for executable code.
   Procedure GTFWR requires 24 words of local(AUTO) storage.
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:39   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:40   
          MINI XREF LISTING

ACT_BUF_LEN
      1521**DCL      1620<<ASSIGN   1624>>IF
ANSBUF
      1390**DCL      1731<>CALL
ANSBUF.TXT
      1392**DCL      1732<>CALL     1733>>IF       1734>>IF
ASCSTRING
      1524**DCL      1645<<CALLBLT  1646>>IF       1671<<CALLBLT  1673>>DOSELCT  1684<<CALLBLT  1685>>DOSELCT
      1688<<CALLBLT  1689>>IF       1741>>IF
ASKEM
      1727**LABEL    1689--GOTO
BCD2ASC
      1404**DCL      1645>>CALLBLT  1671>>CALLBLT  1679>>CALLBLT  1684>>CALLBLT  1688>>CALLBLT  1703>>CALLBLT
BCW
      1529**DCL      1618>>IF
BCW.SZ
      1531**DCL      1620>>ASSIGN
BNEWREC
      1637**LABEL    1657--GOTO     1666--GOTO
CURR$
      1483**DCL      1543--IMP-PTR  1616<<ASSIGN   1635>>IF       1642>>ASSIGN   1645>>CALLBLT  1655>>ASSIGN
      1663>>ASSIGN   1665>>ASSIGN   1671>>CALLBLT  1679>>CALLBLT  1684>>CALLBLT  1688>>CALLBLT  1703>>CALLBLT
CURR_PTR
      1476**DCL      1483--REDEF
CURR_PTR.WOFFS
      1477**DCL      1634<<ASSIGN   1644<<DOINDEX  1644>>DOINDEX  1651<<ASSIGN   1659>>IF       1662<<ASSIGN
      1662>>ASSIGN   1664<<ASSIGN   1664>>ASSIGN   1670<<ASSIGN   1676<<ASSIGN   1683<<ASSIGN   1687<<ASSIGN
      1687>>ASSIGN   1702<<ASSIGN
DEVINFO.BSTAT.W1
      1372**DCL      1608>>IF
DEVINFO.BSTAT.W1.H1
      1373**DCL      1592>>IF
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:41   
DEVINFO.DEV#
      1332**DCL      1574>>ASSIGN   1602<<ASSIGN   1610<<ASSIGN   1749<<ASSIGN
DEVINFO.PCWS
      1335**DCL      1346--REDEF
DEVINFO.RPM_PTRS.EF_DCWS$
      1348**DCL      1349--REDEF
DEVINFO.STATUS
      1352**DCL      1371--REDEF
DKIDF_FLG
      1402**DCL      1659<<ASSIGN   1660<<ASSIGN   1666>>IF
DOIOX
      1395**DCL-ENT  1604--CALL
EOF_FLG
      1401**DCL      1576<<ASSIGN   1594>>IF       1596<<ASSIGN   1614<<ASSIGN
FOUND
      1659**LABEL    1646--GOTO
FW$
      1299**DCL      1311--REDEF    1577>>ASSIGN   1655>>ASSIGN   1737<<ASSIGN
FWBASE$
      1519**DCL      1577<<ASSIGN   1737>>ASSIGN
FWF
      1561**DCL      1714<>CALL
FWF1
      1566**DCL      1716--ASSIGN   1719<>CALL
FWFPO_FLG
      1403**DCL      1711>>IF       1713<<ASSIGN
FWINFO
      1551**DCL      1655<<ASSIGN   1655>>ASSIGN
FWINFO_LGTH
      1552**DCL      1551--IMP-SIZ  1654<<ASSIGN   1655>>ASSIGN   1655>>ASSIGN
FWQ
      1556**DCL      1706--ASSIGN   1727--ASSIGN   1731<>CALL
FWREV
      1518**DCL      1703<<CALLBLT  1707>>ASSIGN   1717>>ASSIGN
FWR_FLG
      1400**DCL      1575<<ASSIGN   1631>>IF       1704>>IF       1738<<ASSIGN   1743<<ASSIGN
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:42   
FW_PTR.WOFFS
      1312**DCL      1656<<ASSIGN   1656>>ASSIGN
HNEWREC
      1723**LABEL    1744--GOTO
HOLL
      1670**LABEL    1629--GOTO
HOLL1
      1716**LABEL    1711--GOTO
IMAGE$
      1446**DCL      1458--REDEF    1529--IMP-PTR  1533--IMP-PTR  1578<<ASSIGN   1615<<ASSIGN   1616>>ASSIGN
      1618>>IF       1620>>ASSIGN   1627>>IF       1629>>IF
IMAGE_PTR.WOFFS
      1459**DCL      1580>>ASSIGN   1621<<ASSIGN   1621>>ASSIGN   1624>>IF       1634>>ASSIGN   1637<<ASSIGN
      1637>>ASSIGN   1644>>DOINDEX  1651>>ASSIGN   1659>>IF       1670>>ASSIGN   1676>>ASSIGN   1683>>ASSIGN
      1702>>ASSIGN   1723<<ASSIGN   1723>>ASSIGN
INDX
      1291**DCL        10--PROC     1574>>ASSIGN   1590<>CALL     1592>>IF       1602>>ASSIGN   1604<>CALL
      1608>>IF       1610>>ASSIGN   1749>>ASSIGN
KEYIN
      1397**DCL-ENT  1731--CALL
LABEL
      1388**DCL      1677>>IF       1679<<CALLBLT  1692<<ASSIGN   1718>>ASSIGN   1728>>ASSIGN   1736<<ASSIGN
      1741>>IF       1747<<ASSIGN
MESSAGE$
      1520**DCL      1570--IMP-PTR  1706<<ASSIGN   1707>>ASSIGN   1707>>ASSIGN   1716<<ASSIGN   1717>>ASSIGN
      1717>>ASSIGN   1718>>ASSIGN   1718>>ASSIGN   1727<<ASSIGN   1728>>ASSIGN   1728>>ASSIGN
MINIQC_PL6
      1394**DCL-ENT  1590--CALL
MPCINF
      1426**DCL      1663<<ASSIGN
MPCINF1
      1427**DCL      1665<<ASSIGN
OBJECT0
      1692**LABEL    1696--GOTO
OBJECT1
      1731**LABEL    1708--GOTO     1734--GOTO
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:43   
OBJECT2
      1741**LABEL    1677--GOTO
OBJECT22
      1743**LABEL    1680--GOTO     1729--GOTO
ORDBFLG
      1389**DCL      1709>>IF
PDATA
      1651**LABEL    1667--GOTO
POBUF
      1318**DCL      1406--DCLINIT  1446--DCLINIT  1578--ASSIGN   1585<<ASSIGN   1615--ASSIGN
POBUF$
      1406**DCL      1418--REDEF
POBUF_PTR.WOFFS
      1419**DCL      1624>>IF
PODCW
      1438**DCL      1590--CALL     1601>>ASSIGN
PODCW.AD
      1439**DCL      1580<<ASSIGN
PODCW.TALLY
      1443**DCL      1581<<ASSIGN
PRCW
      1624**LABEL    1638--GOTO     1724--GOTO
PROCESS
      1608**LABEL    1592--GOTO
RCW.BMED.BH
      1539**DCL      1629>>IF
RCW.MEDIA
      1536**DCL      1537--REDEF
RCW.SZ
      1534**DCL      1627>>IF
RD_FW_FLG
      1297**DCL      1603<<ASSIGN   1605<<ASSIGN
READFW
      1585**LABEL    1597--GOTO     1624--GOTO     1627--GOTO     1631--GOTO     1693--GOTO     1704--GOTO
      1739--GOTO     1741--GOTO
READFW0
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:44   
      1600**LABEL    1587--GOTO
READ_FLG
      1294**DCL        10--PROC     1587>>IF       1680>>IF
RFWERRET
      1610**LABEL    1590--CALLALT
RFWRET
      1747**LABEL    1594--GOTO     1618--GOTO     1699--GOTO
RFWRETX
      1749**LABEL    1709--GOTO     1720--GOTO     1733--GOTO
RFW_ZONE
      1495**DCL      1604--CALL
RFW_ZONE.DCW
      1502**DCL      1506--REDEF    1509--REDEF    1510--REDEF    1601<<ASSIGN
RFW_ZONE.IDCW$
      1501**DCL      1600<<ASSIGN
RFW_ZONE.W1
      1496**DCL      1501--REDEF
SAVE_DEV
      1522**DCL      1574<<ASSIGN   1610>>ASSIGN   1749>>ASSIGN
SILENT
      1298**DCL      1714>>IF       1719>>IF
TAPE_FLG
      1292**DCL        10--PROC     1708>>IF
TEXTM.CNT
      1571**DCL      1572--IMP-SIZ  1707>>ASSIGN   1717>>ASSIGN   1718>>ASSIGN   1728>>ASSIGN
TEXTM.TXT
      1572**DCL      1707<<ASSIGN   1717<<ASSIGN   1718<<ASSIGN   1728<<ASSIGN
TPBTC
      1425**DCL      1600--ASSIGN
TYPEC
      1396**DCL-ENT  1714--CALL     1719--CALL
UPPER_CASE
      1398**DCL-ENT  1732--CALL
WRD
      1543**DCL      1645>>CALLBLT  1663>>ASSIGN   1665>>ASSIGN   1671>>CALLBLT  1679>>CALLBLT  1684>>CALLBLT
      1688>>CALLBLT
PL6.E3A0      #001=GTFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:56 Page:45   
WRD.H1
      1544**DCL      1635>>IF
WRD.H1.B3
      1547**DCL      1642>>ASSIGN
WRD.H2.B2_3
      1550**DCL      1703>>CALLBLT
WRDCNT
      1526**DCL      1642<<ASSIGN   1654>>ASSIGN   1656>>ASSIGN   1659>>IF

PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:46   
      282        1        /*T***********************************************************/
      283        2        /*T*                                                         */
      284        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      285        4        /*T*                                                         */
      286        5        /*T***********************************************************/
      287        6        IPCW_PL6:PROC(INDX);
      288        7        /* This program initializes a MPC controller */
      289        8        %INCLUDE IS$MACROS;
      290     1283    1   DCL INDX UBIN WORD;
      291     1284    1   DCL START_IO ENTRY(1);
      292     1285        %DEVINFO(STCLASS="SYMREF");
      293     1354        %CHANMBOX(NAME=CMBOX);
      294     1379        %IOM_TAB(NAME=IOMTAB,STCLASS="SYMREF");
      295     1396        %PTR_STRUCT(NAME=CON_PTR,STCLASS="STATIC");
      296     1414    1   DCL CON$ REDEF CON_PTR PTR;
      297     1415        /**/
      298     1416    1   DCL CHAN$ PTR;
      299     1417    1   DCL I UBIN WORD;
      300     1418    1   DCL PORT# UBIN WORD;
      301     1419        /**/
      302     1420    1   DCL RPM_FLG BIT(1) ALIGNED SYMREF;
      303     1421    1   DCL INIT_CHN_RPM ENTRY(2);
      304     1422    1   DCL WT_TIME ENTRY(1);
      305     1423    1   DCL MAILBOX$ PTR;
      306     1424        %IMX_MBX(NAME=MBX,STCLASS="BASED(MAILBOX$)");
      307     1481    1   DCL LOGIC_CHN UBIN WORD;
      308     1482
      309     1483        /**/
      310     1484    2           IF RPM_FLG THEN DO;
      311     1485    2                 MAILBOX$ = DEVINFO.RPM_PTRS.MBX$(INDX);
      312     1486    2                 MBX.CHN_LINK.SYNC = '0'B;
      313     1487    2                 MBX.LPW = '0'B;
      314     1488    2                 MBX.STATUS = '0'B;
      315     1489    2                 LOGIC_CHN = 128*DEVINFO.IOM#(INDX)+DEVINFO.CHN#(INDX)+8;
      316     1490    2                 CALL INIT_CHN_RPM(LOGIC_CHN,MAILBOX$);
      317     1491    2               END;
      318     1492    2             ELSE DO;
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:47   
      319     1493        /* Find connect channel mailbox */
      320     1494    2                 CON_PTR.WOFFS=IOMTAB.MAILBAD(DEVINFO.IOM#(INDX))+2*4;
      321     1495        /* Wait for connect channel to free up */
      322     1496    2                 CHAN$=CON$;
      323     1497    3                 DO UNTIL CMBOX.W1.H2.TALLY=0;
      324     1498    3                 END;                      /* DO                                 */
      325     1499    2                 CMBOX.LPW$=ADDR(DEVINFO.PCWS.PCW1(INDX)); /* Pointer to PCW     */
      326     1500    2                 CMBOX.W1.H2.TAL='1'B;     /* Tally                              */
      327     1501    2                 CMBOX.W1.H2.TALLY=1;      /* Count 1                            */
      328     1502    2                 CMBOX.W2='0'B;            /* LPWX                               */
      329     1503        /* Build the PCWs */
      330     1504    2                 DEVINFO.PCWS.PCW2.CHN#(INDX)=DEVINFO.CHN#(INDX); /* PCW2        */
      331     1505    2                 DEVINFO.PCWS.PCW1(INDX)='00000077'O; /* PCW1                    */
      332     1506    2                 PORT#=IOMTAB.PORT#(DEVINFO.IOM#(INDX));
      333     1507    2                 CALL START_IO(PORT#);
      334     1508        /* Wait for connect channel to free up */
      335     1509    3                 DO UNTIL CMBOX.W1.H2.TALLY=0;
      336     1510    3                 END;
      337     1511    2               END;                        /* DO UNTIL                           */
      338     1512        /* Wait a while */
      339     1513    1           IF RPM_FLG THEN CALL WT_TIME(6000000); /* Wait for 6 million microseconds */
      340     1514    1             ELSE CALL WT_TIME(500000);    /* Wait for .5 seconds                */
      341     1515    1           RETURN;
      342     1516    1   END IPCW_PL6;
      343     1517        %EOD;

PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:48   
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure IPCW_PL6.

   Procedure IPCW_PL6 requires 118 words for executable code.
   Procedure IPCW_PL6 requires 12 words of local(AUTO) storage.

PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:49   

 Object Unit name= IPCW_PL6                                   File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:03.20 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     1      1  IPCW_PL6
    1  RoData even  UTS      1      1  IPCW_PL6
    2   Proc  even  none   118    166  IPCW_PL6
    3  RoData even  none     6      6  IPCW_PL6

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        1  IPCW_PL6

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 INIT_CHN_RPM
         yes           Std       1 START_IO
         yes           Std       1 WT_TIME
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:50   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     DEVINFO                               IOMTAB                                RPM_FLG
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:51   


      282        1        /*T***********************************************************/
      283        2        /*T*                                                         */
      284        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      285        4        /*T*                                                         */
      286        5        /*T***********************************************************/
      287        6        IPCW_PL6:PROC(INDX);

      6  2 000000   000000 700200 xent  IPCW_PL6     TSX0  ! X66_AUTO_1
         2 000001   000014 000001                    ZERO    12,1

      288        7        /* This program initializes a MPC controller */
      289        8        %INCLUDE IS$MACROS;
      290     1283    1   DCL INDX UBIN WORD;
      291     1284    1   DCL START_IO ENTRY(1);
      292     1285        %DEVINFO(STCLASS="SYMREF");
      293     1354        %CHANMBOX(NAME=CMBOX);
      294     1379        %IOM_TAB(NAME=IOMTAB,STCLASS="SYMREF");
      295     1396        %PTR_STRUCT(NAME=CON_PTR,STCLASS="STATIC");
      296     1414    1   DCL CON$ REDEF CON_PTR PTR;
      297     1415        /**/
      298     1416    1   DCL CHAN$ PTR;
      299     1417    1   DCL I UBIN WORD;
      300     1418    1   DCL PORT# UBIN WORD;
      301     1419        /**/
      302     1420    1   DCL RPM_FLG BIT(1) ALIGNED SYMREF;
      303     1421    1   DCL INIT_CHN_RPM ENTRY(2);
      304     1422    1   DCL WT_TIME ENTRY(1);
      305     1423    1   DCL MAILBOX$ PTR;
      306     1424        %IMX_MBX(NAME=MBX,STCLASS="BASED(MAILBOX$)");
      307     1481    1   DCL LOGIC_CHN UBIN WORD;
      308     1482
      309     1483        /**/
      310     1484    2           IF RPM_FLG THEN DO;

   1484  2 000002   000000 234000 xsym               SZN     RPM_FLG
         2 000003   000053 605000 2                  TPL     s:1494
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:52   

      311     1485    2                 MAILBOX$ = DEVINFO.RPM_PTRS.MBX$(INDX);

   1485  2 000004   200003 470500                    LDP0    @INDX,,AUTO
         2 000005   000000 236100                    LDQ     0,,PR0
         2 000006   000006 402007                    MPY     6,DL
         2 000007   000001 736000                    QLS     1
         2 000010   000002 236006 xsym               LDQ     DEVINFO+2,QL
         2 000011   200007 756100                    STQ     MAILBOX$,,AUTO

      312     1486    2                 MBX.CHN_LINK.SYNC = '0'B;

   1486  2 000012   200007 471500                    LDP1    MAILBOX$,,AUTO
         2 000013   000000 236000 3                  LDQ     0
         2 000014   100006 356100                    ANSQ    6,,PR1

      313     1487    2                 MBX.LPW = '0'B;

   1487  2 000015   200007 471500                    LDP1    MAILBOX$,,AUTO
         2 000016   100007 450100                    STZ     7,,PR1

      314     1488    2                 MBX.STATUS = '0'B;

   1488  2 000017   200007 471500                    LDP1    MAILBOX$,,AUTO
         2 000020   000100 100400                    MLR     fill='000'O
         2 000021   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000022   100010 000040                    ADSC9   8,,PR1                   cn=0,n=32

      315     1489    2                 LOGIC_CHN = 128*DEVINFO.IOM#(INDX)+DEVINFO.CHN#(INDX)+8;

   1489  2 000023   000000 236100                    LDQ     0,,PR0
         2 000024   000006 402007                    MPY     6,DL
         2 000025   000000 620006                    EAX0    0,QL
         2 000026   000001 736000                    QLS     1
         2 000027   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000030   000033 772000                    QRL     27
         2 000031   200012 756100                    STQ     LOGIC_CHN+2,,AUTO
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:53   
         2 000032   000000 635010                    EAA     0,X0
         2 000033   000021 771000                    ARL     17
         2 000034   000000 236005 xsym               LDQ     DEVINFO,AL
         2 000035   000014 772000                    QRL     12
         2 000036   000600 376007                    ANQ     384,DL
         2 000037   200012 036100                    ADLQ    LOGIC_CHN+2,,AUTO
         2 000040   000010 036007                    ADLQ    8,DL
         2 000041   200010 756100                    STQ     LOGIC_CHN,,AUTO

      316     1490    2                 CALL INIT_CHN_RPM(LOGIC_CHN,MAILBOX$);

   1490  2 000042   200007 633500                    EPPR3   MAILBOX$,,AUTO
         2 000043   200013 453500                    STP3    LOGIC_CHN+3,,AUTO
         2 000044   200010 634500                    EPPR4   LOGIC_CHN,,AUTO
         2 000045   200012 454500                    STP4    LOGIC_CHN+2,,AUTO
         2 000046   200012 630500                    EPPR0   LOGIC_CHN+2,,AUTO
         2 000047   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000050   000000 701000 xent               TSX1    INIT_CHN_RPM
         2 000051   000000 011000                    NOP     0

      317     1491    2               END;

   1491  2 000052   000152 710000 2                  TRA     s:1513

      318     1492    2             ELSE DO;

      319     1493        /* Find connect channel mailbox */
      320     1494    2                 CON_PTR.WOFFS=IOMTAB.MAILBAD(DEVINFO.IOM#(INDX))+2*4;

   1494  2 000053   200003 470500                    LDP0    @INDX,,AUTO
         2 000054   000000 236100                    LDQ     0,,PR0
         2 000055   000006 402007                    MPY     6,DL
         2 000056   000001 736000                    QLS     1
         2 000057   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000060   000023 772000                    QRL     19
         2 000061   000003 376007                    ANQ     3,DL
         2 000062   000000 220006 xsym               LDX0    IOMTAB,QL
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:54   
         2 000063   000010 621010                    EAX1    8,X0
         2 000064   000000 741000 0                  STX1    CON_PTR

      321     1495        /* Wait for connect channel to free up */
      322     1496    2                 CHAN$=CON$;

   1496  2 000065   000000 236000 0                  LDQ     CON_PTR
         2 000066   200004 756100                    STQ     CHAN$,,AUTO

      323     1497    3                 DO UNTIL CMBOX.W1.H2.TALLY=0;

      324     1498    3                 END;                      /* DO                                 */

   1498  2 000067   200004 470500                    LDP0    CHAN$,,AUTO
         2 000070   000000 236100                    LDQ     0,,PR0
         2 000071   007777 316007                    CANQ    4095,DL
         2 000072   000067 601000 2                  TNZ     s:1498

      325     1499    2                 CMBOX.LPW$=ADDR(DEVINFO.PCWS.PCW1(INDX)); /* Pointer to PCW     */

   1499  2 000073   200003 471500                    LDP1    @INDX,,AUTO
         2 000074   100000 236100                    LDQ     0,,PR1
         2 000075   000006 402007                    MPY     6,DL
         2 000076   000023 736000                    QLS     19
         2 000077   000001 036000 3                  ADLQ    1
         2 000100   000000 756100                    STQ     0,,PR0

      326     1500    2                 CMBOX.W1.H2.TAL='1'B;     /* Tally                              */

   1500  2 000101   020000 236007                    LDQ     8192,DL
         2 000102   000000 256100                    ORSQ    0,,PR0

      327     1501    2                 CMBOX.W1.H2.TALLY=1;      /* Count 1                            */

   1501  2 000103   000001 236007                    LDQ     1,DL
         2 000104   000000 752103                    STCQ    0,'03'O,PR0

PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:55   
      328     1502    2                 CMBOX.W2='0'B;            /* LPWX                               */

   1502  2 000105   000001 450100                    STZ     1,,PR0

      329     1503        /* Build the PCWs */
      330     1504    2                 DEVINFO.PCWS.PCW2.CHN#(INDX)=DEVINFO.CHN#(INDX); /* PCW2        */

   1504  2 000106   100000 236100                    LDQ     0,,PR1
         2 000107   000006 402007                    MPY     6,DL
         2 000110   000001 736000                    QLS     1
         2 000111   000000 620006                    EAX0    0,QL
         2 000112   100000 236100                    LDQ     0,,PR1
         2 000113   000006 402007                    MPY     6,DL
         2 000114   000001 736000                    QLS     1
         2 000115   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000116   000003 676010 xsym               ERQ     DEVINFO+3,X0
         2 000117   777000 376003                    ANQ     -512,DU
         2 000120   000003 656010 xsym               ERSQ    DEVINFO+3,X0

      331     1505    2                 DEVINFO.PCWS.PCW1(INDX)='00000077'O; /* PCW1                    */

   1505  2 000121   100000 236100                    LDQ     0,,PR1
         2 000122   000006 402007                    MPY     6,DL
         2 000123   000001 736000                    QLS     1
         2 000124   000000 620006                    EAX0    0,QL
         2 000125   000000 236000 1                  LDQ     0
         2 000126   000002 756010 xsym               STQ     DEVINFO+2,X0

      332     1506    2                 PORT#=IOMTAB.PORT#(DEVINFO.IOM#(INDX));

   1506  2 000127   100000 236100                    LDQ     0,,PR1
         2 000130   000006 402007                    MPY     6,DL
         2 000131   000001 736000                    QLS     1
         2 000132   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000133   000023 772000                    QRL     19
         2 000134   000003 376007                    ANQ     3,DL
         2 000135   000000 236006 xsym               LDQ     IOMTAB,QL
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:56   
         2 000136   000007 376007                    ANQ     7,DL
         2 000137   200006 756100                    STQ     PORT#,,AUTO

      333     1507    2                 CALL START_IO(PORT#);

   1507  2 000140   200006 633500                    EPPR3   PORT#,,AUTO
         2 000141   200012 453500                    STP3    LOGIC_CHN+2,,AUTO
         2 000142   200012 630500                    EPPR0   LOGIC_CHN+2,,AUTO
         2 000143   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000144   000000 701000 xent               TSX1    START_IO
         2 000145   000000 011000                    NOP     0

      334     1508        /* Wait for connect channel to free up */
      335     1509    3                 DO UNTIL CMBOX.W1.H2.TALLY=0;

      336     1510    3                 END;

   1510  2 000146   200004 470500                    LDP0    CHAN$,,AUTO
         2 000147   000000 236100                    LDQ     0,,PR0
         2 000150   007777 316007                    CANQ    4095,DL
         2 000151   000146 601000 2                  TNZ     s:1510

      337     1511    2               END;                        /* DO UNTIL                           */

      338     1512        /* Wait a while */
      339     1513    1          IF RPM_FLG THEN CALL WT_TIME(6000000); /* Wait for 6 million microseconds */

   1513  2 000152   000000 234000 xsym               SZN     RPM_FLG
         2 000153   000161 605000 2                  TPL     s:1514

   1513  2 000154   000003 630400 3                  EPPR0   3
         2 000155   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000156   000000 701000 xent               TSX1    WT_TIME
         2 000157   000000 011000                    NOP     0
         2 000160   000165 710000 2                  TRA     s:1515

      340     1514    1             ELSE CALL WT_TIME(500000);    /* Wait for .5 seconds                */
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:57   

   1514  2 000161   000005 630400 3                  EPPR0   5
         2 000162   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000163   000000 701000 xent               TSX1    WT_TIME
         2 000164   000000 011000                    NOP     0

      341     1515    1           RETURN;

   1515  2 000165   000000 702200 xent               TSX2  ! X66_ARET
      342     1516    1   END IPCW_PL6;
      343     1517        %EOD;

PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:58   
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure IPCW_PL6.
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:59   

 **** Variables and constants ****

  ****  Section 000  Data  IPCW_PL6

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 CON$                       0-0-0/w STRC        r     1 CON_PTR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @INDX                      4-0-0/w PTR         r     1 CHAN$
    *0-0-0/w UBIN        r     1 INDX                      10-0-0/w UBIN        r     1 LOGIC_CHN
     7-0-0/w PTR         r     1 MAILBOX$                   6-0-0/w UBIN        r     1 PORT#

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(396)   r     1 DEVINFO(0:21)              0-0-0/w STRC        r     1 IOMTAB(0:3)
     0-0-0/w BIT         r     1 RPM_FLG

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(144)   r     1 CMBOX                      0-0-0/w STRC(864)   r     1 MBX


   Procedure IPCW_PL6 requires 118 words for executable code.
   Procedure IPCW_PL6 requires 12 words of local(AUTO) storage.
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:60   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:61   
          MINI XREF LISTING

CHAN$
      1416**DCL      1355--IMP-PTR  1496<<ASSIGN   1497>>DOUNTIL  1499>>ASSIGN   1500>>ASSIGN   1501>>ASSIGN
      1502>>ASSIGN   1509>>DOUNTIL
CMBOX.LPW$
      1366**DCL      1499<<ASSIGN
CMBOX.W1
      1356**DCL      1366--REDEF
CMBOX.W1.H2.TAL
      1363**DCL      1500<<ASSIGN
CMBOX.W1.H2.TALLY
      1365**DCL      1497>>DOUNTIL  1501<<ASSIGN   1509>>DOUNTIL
CMBOX.W2
      1367**DCL      1502<<ASSIGN
CMBOX.W3
      1370**DCL      1373--REDEF
CMBOX.W4
      1374**DCL      1377--REDEF
CON$
      1414**DCL      1496>>ASSIGN
CON_PTR
      1407**DCL      1414--REDEF
CON_PTR.WOFFS
      1408**DCL      1494<<ASSIGN
DEVINFO.CHN#
      1297**DCL      1489>>ASSIGN   1504>>ASSIGN
DEVINFO.IOM#
      1299**DCL      1489>>ASSIGN   1494>>ASSIGN   1506>>ASSIGN
DEVINFO.PCWS
      1301**DCL      1312--REDEF
DEVINFO.PCWS.PCW1
      1302**DCL      1499--ASSIGN   1505<<ASSIGN
DEVINFO.PCWS.PCW2.CHN#
PL6.E3A0      #002=IPCW_PL6 File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:62   
      1310**DCL      1504<<ASSIGN
DEVINFO.RPM_PTRS.EF_DCWS$
      1314**DCL      1315--REDEF
DEVINFO.RPM_PTRS.MBX$
      1313**DCL      1485>>ASSIGN
DEVINFO.STATUS
      1318**DCL      1337--REDEF
INDX
      1283**DCL         6--PROC     1485>>ASSIGN   1489>>ASSIGN   1489>>ASSIGN   1494>>ASSIGN   1499>>ASSIGN
      1504>>ASSIGN   1504>>ASSIGN   1505>>ASSIGN   1506>>ASSIGN
INIT_CHN_RPM
      1421**DCL-ENT  1490--CALL
IOMTAB.MAILBAD
      1391**DCL      1494>>ASSIGN
IOMTAB.PORT#
      1393**DCL      1506>>ASSIGN
LOGIC_CHN
      1481**DCL      1489<<ASSIGN   1490<>CALL
MAILBOX$
      1423**DCL      1435--IMP-PTR  1485<<ASSIGN   1486>>ASSIGN   1487>>ASSIGN   1488>>ASSIGN   1490<>CALL
MBX.CHN_LINK.SYNC
      1448**DCL      1486<<ASSIGN
MBX.LPW
      1454**DCL      1487<<ASSIGN
MBX.STATUS
      1464**DCL      1488<<ASSIGN
MBX.STATUS.W8
      1465**DCL      1468--REDEF
PORT#
      1418**DCL      1506<<ASSIGN   1507<>CALL
RPM_FLG
      1420**DCL      1484>>IF       1513>>IF
START_IO
      1284**DCL-ENT  1507--CALL
WT_TIME
      1422**DCL-ENT  1513--CALL     1514--CALL

PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:63   
      344        1        /*T***********************************************************/
      345        2        /*T*                                                         */
      346        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      347        4        /*T*                                                         */
      348        5        /*T***********************************************************/
      349        6        INIT_FEP:PROC(IOM#,CHN#);
      350        7        /* This program initializes the FEPs */
      351        8        %INCLUDE IS$MACROS;
      352     1283    1   DCL IOM# UBIN WORD;
      353     1284    1   DCL CHN# UBIN WORD;
      354     1285    1   DCL START_IO ENTRY(1);
      355     1286        %CHANMBOX(NAME=CMBOX);
      356     1311        %IOM_TAB(NAME=IOMTAB,STCLASS="SYMREF");
      357     1328        %PTR_STRUCT(NAME=CON_PTR,STCLASS="STATIC");
      358     1346    1   DCL CON$ REDEF CON_PTR PTR;
      359     1347    1   DCL 1 PCWS STATIC DALIGNED,
      360     1348    1         2 * BIT (36) ALIGNED INIT ( '0'B ) ,
      361     1349    1         2 * BIT (36) ALIGNED INIT ( '0'B ) ,
      362     1350    1         2 PCW1 ,
      363     1351    1           3 * BIT (21) UNAL INIT ( '0000007'O ) ,
      364     1352    1           3 MASK BIT (1) UNAL ,
      365     1353    1           3 * BIT (14) UNAL INIT ( '0'B ) ,
      366     1354    1         2 PCW2,
      367     1355    1           3 CHN# UBIN(9) UNAL,
      368     1356    1           3 * BIT(27) INIT('0'B);
      369     1357        /**/
      370     1358    1   DCL CHAN$ PTR;
      371     1359    1   DCL I UBIN WORD;
      372     1360    1   DCL WD0 BIT (36) STATIC ALIGNED ;
      373     1361        %PTR_STRUCT ( NAME = WD0_PTR , STCLASS = CONSTANT ) ;
      374     1379    1   DCL WD0$ REDEF WD0_PTR PTR;
      375     1380    1   DCL COUPLER_CMD BIT (36) ALIGNED CONSTANT INIT ( '000000001071'O ) ;
      376     1381    1   DCL BWD0 BIT (36) BASED ALIGNED ;
      377     1382    1   DCL PORT# UBIN WORD;
      378     1383        /**/
      379     1384        /**/
      380     1385    1   DCL RPM_FLG BIT(1) ALIGNED SYMREF;
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:64   
      381     1386    1   DCL INIT_FEP_RPM ENTRY(2);
      382     1387    1   DCL WT_TIME ENTRY(1);
      383     1388    1   DCL MAILBOX$ PTR;
      384     1389        %IMX_MBX(NAME=MBX,STCLASS="BASED(MAILBOX$)");
      385     1446    1   DCL SH_MBX BIT(1) SYMREF;
      386     1447    1   DCL LOGIC_CHN UBIN WORD;
      387     1448
      388     1449        /**/
      389     1450    2           IF RPM_FLG THEN DO;
      390     1451    2                 MAILBOX$ =ADDR(SH_MBX);
      391     1452    2                 MBX.CHN_LINK.SYNC = '0'B;
      392     1453    2                 MBX.LPW = '0'B;
      393     1454    2                 MBX.STATUS = '0'B;
      394     1455    2                 LOGIC_CHN = 128*IOM#+CHN#+8;
      395     1456    2                 CALL INIT_FEP_RPM(LOGIC_CHN,MAILBOX$);
      396     1457    2                 CALL WT_TIME(6000000);
      397     1458    2                 RETURN;
      398     1459    2               END;
      399     1460        /* Find connect channel mailbox */
      400     1461    1           CON_PTR.WOFFS=IOMTAB.MAILBAD(IOM#)+2*4;
      401     1462        /* Wait for connect channel to free up */
      402     1463    1           CHAN$=CON$;
      403     1464    2           DO UNTIL CMBOX.W1.H2.TALLY=0;
      404     1465    2           END;                            /* DO                                 */
      405     1466    1           CMBOX.LPW$=ADDR(PCWS.PCW1);     /* Pointer to PCW                     */
      406     1467    1           CMBOX.W1.H2.TAL='1'B;           /* Tally                              */
      407     1468    1           CMBOX.W1.H2.TALLY=1;            /* Count 1                            */
      408     1469    1           CMBOX.W2='0'B;                  /* LPWX                               */
      409     1470    1           WD0 = WD0$->BWD0 ;              /* Save away real word 0              */
      410     1471    1           WD0$->BWD0 = COUPLER_CMD ;
      411     1472        /* Turn off the mask bit in PCW1 */
      412     1473    1           PCWS.PCW1.MASK = '0'B ;
      413     1474        /* Build the PCW2 */
      414     1475    1           PCWS.PCW2.CHN#=CHN#;            /* PCW2                               */
      415     1476    1           PORT#=IOMTAB.PORT#(IOM#);
      416     1477    1           CALL START_IO(PORT#);
      417     1478        /* Wait for connect channel to free up */
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:65   
      418     1479    2           DO UNTIL CMBOX.W1.H2.TALLY=0;
      419     1480    2           END;                            /* DO UNTIL                           */
      420     1481        /* Wait a while */
      421     1482    2           DO I=0 TO 128*1024;
      422     1483    2           END;                            /* DO I=                              */
      423     1484    1           CMBOX.LPW$=ADDR(PCWS.PCW1);     /* Pointer to PCW                     */
      424     1485    1           CMBOX.W1.H2.TAL='1'B;           /* Tally                              */
      425     1486    1           CMBOX.W1.H2.TALLY=1;            /* Count 1                            */
      426     1487    1           PCWS.PCW1.MASK = '1'B ;
      427     1488    1           CALL START_IO(PORT#);
      428     1489        /* Wait for connect channel to free up */
      429     1490    2           DO UNTIL CMBOX.W1.H2.TALLY=0;
      430     1491    2           END;                            /* DO UNTIL                           */
      431     1492        /* Wait a while */
      432     1493    2           DO I=0 TO 128*1024;
      433     1494    2           END;                            /* DO I=                              */
      434     1495    1           WD0$->BWD0 = WD0 ;              /* Restore real word 0                */
      435     1496    1           RETURN;
      436     1497    1   END INIT_FEP;
      437     1498        %EOD;

PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:66   
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure INIT_FEP.

   Procedure INIT_FEP requires 118 words for executable code.
   Procedure INIT_FEP requires 12 words of local(AUTO) storage.

PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:67   

 Object Unit name= INIT_FEP                                   File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:07.84 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     7      7  INIT_FEP
    1  RoData even  UTS      2      2  INIT_FEP
    2   Proc  even  none   118    166  INIT_FEP
    3  RoData even  none     6      6  INIT_FEP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        2  INIT_FEP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 INIT_FEP_RPM
         yes           Std       1 WT_TIME
         yes           Std       1 START_IO
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:68   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     IOMTAB                                RPM_FLG                               SH_MBX
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:69   


      344        1        /*T***********************************************************/
      345        2        /*T*                                                         */
      346        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      347        4        /*T*                                                         */
      348        5        /*T***********************************************************/
      349        6        INIT_FEP:PROC(IOM#,CHN#);

      6  2 000000   000000 700200 xent  INIT_FEP     TSX0  ! X66_AUTO_2
         2 000001   000014 000002                    ZERO    12,2

      350        7        /* This program initializes the FEPs */
      351        8        %INCLUDE IS$MACROS;
      352     1283    1   DCL IOM# UBIN WORD;
      353     1284    1   DCL CHN# UBIN WORD;
      354     1285    1   DCL START_IO ENTRY(1);
      355     1286        %CHANMBOX(NAME=CMBOX);
      356     1311        %IOM_TAB(NAME=IOMTAB,STCLASS="SYMREF");
      357     1328        %PTR_STRUCT(NAME=CON_PTR,STCLASS="STATIC");
      358     1346    1   DCL CON$ REDEF CON_PTR PTR;
      359     1347    1   DCL 1 PCWS STATIC DALIGNED,
      360     1348    1         2 * BIT (36) ALIGNED INIT ( '0'B ) ,
      361     1349    1         2 * BIT (36) ALIGNED INIT ( '0'B ) ,
      362     1350    1         2 PCW1 ,
      363     1351    1           3 * BIT (21) UNAL INIT ( '0000007'O ) ,
      364     1352    1           3 MASK BIT (1) UNAL ,
      365     1353    1           3 * BIT (14) UNAL INIT ( '0'B ) ,
      366     1354    1         2 PCW2,
      367     1355    1           3 CHN# UBIN(9) UNAL,
      368     1356    1           3 * BIT(27) INIT('0'B);
      369     1357        /**/
      370     1358    1   DCL CHAN$ PTR;
      371     1359    1   DCL I UBIN WORD;
      372     1360    1   DCL WD0 BIT (36) STATIC ALIGNED ;
      373     1361        %PTR_STRUCT ( NAME = WD0_PTR , STCLASS = CONSTANT ) ;
      374     1379    1   DCL WD0$ REDEF WD0_PTR PTR;
      375     1380    1   DCL COUPLER_CMD BIT (36) ALIGNED CONSTANT INIT ( '000000001071'O ) ;
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:70   
      376     1381    1   DCL BWD0 BIT (36) BASED ALIGNED ;
      377     1382    1   DCL PORT# UBIN WORD;
      378     1383        /**/
      379     1384        /**/
      380     1385    1   DCL RPM_FLG BIT(1) ALIGNED SYMREF;
      381     1386    1   DCL INIT_FEP_RPM ENTRY(2);
      382     1387    1   DCL WT_TIME ENTRY(1);
      383     1388    1   DCL MAILBOX$ PTR;
      384     1389        %IMX_MBX(NAME=MBX,STCLASS="BASED(MAILBOX$)");
      385     1446    1   DCL SH_MBX BIT(1) SYMREF;
      386     1447    1   DCL LOGIC_CHN UBIN WORD;
      387     1448
      388     1449        /**/
      389     1450    2           IF RPM_FLG THEN DO;

   1450  2 000002   000000 234000 xsym               SZN     RPM_FLG
         2 000003   000043 605000 2                  TPL     s:1461

      390     1451    2                 MAILBOX$ =ADDR(SH_MBX);

   1451  2 000004   000000 236000 3                  LDQ     0
         2 000005   200010 756100                    STQ     MAILBOX$,,AUTO

      391     1452    2                 MBX.CHN_LINK.SYNC = '0'B;

   1452  2 000006   200010 470500                    LDP0    MAILBOX$,,AUTO
         2 000007   000001 236000 3                  LDQ     1
         2 000010   000006 356100                    ANSQ    6,,PR0

      392     1453    2                 MBX.LPW = '0'B;

   1453  2 000011   200010 470500                    LDP0    MAILBOX$,,AUTO
         2 000012   000007 450100                    STZ     7,,PR0

      393     1454    2                 MBX.STATUS = '0'B;

   1454  2 000013   200010 470500                    LDP0    MAILBOX$,,AUTO
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:71   
         2 000014   000100 100400                    MLR     fill='000'O
         2 000015   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000016   000010 000040                    ADSC9   8,,PR0                   cn=0,n=32

      394     1455    2                 LOGIC_CHN = 128*IOM#+CHN#+8;

   1455  2 000017   200004 470500                    LDP0    @CHN#,,AUTO
         2 000020   200003 471500                    LDP1    @IOM#,,AUTO
         2 000021   100000 236100                    LDQ     0,,PR1
         2 000022   000007 736000                    QLS     7
         2 000023   000000 036100                    ADLQ    0,,PR0
         2 000024   000010 036007                    ADLQ    8,DL
         2 000025   200011 756100                    STQ     LOGIC_CHN,,AUTO

      395     1456    2                 CALL INIT_FEP_RPM(LOGIC_CHN,MAILBOX$);

   1456  2 000026   200010 633500                    EPPR3   MAILBOX$,,AUTO
         2 000027   200013 453500                    STP3    LOGIC_CHN+2,,AUTO
         2 000030   200011 634500                    EPPR4   LOGIC_CHN,,AUTO
         2 000031   200012 454500                    STP4    LOGIC_CHN+1,,AUTO
         2 000032   200012 630500                    EPPR0   LOGIC_CHN+1,,AUTO
         2 000033   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000034   000000 701000 xent               TSX1    INIT_FEP_RPM
         2 000035   000000 011000                    NOP     0

      396     1457    2                 CALL WT_TIME(6000000);

   1457  2 000036   000003 630400 3                  EPPR0   3
         2 000037   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000040   000000 701000 xent               TSX1    WT_TIME
         2 000041   000000 011000                    NOP     0

      397     1458    2                 RETURN;

   1458  2 000042   000000 702200 xent               TSX2  ! X66_ARET

      398     1459    2               END;
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:72   
      399     1460        /* Find connect channel mailbox */
      400     1461    1           CON_PTR.WOFFS=IOMTAB.MAILBAD(IOM#)+2*4;

   1461  2 000043   200003 470500                    LDP0    @IOM#,,AUTO
         2 000044   000000 720100                    LXL0    0,,PR0
         2 000045   000000 221010 xsym               LDX1    IOMTAB,X0
         2 000046   000010 622011                    EAX2    8,X1
         2 000047   000000 742000 0                  STX2    CON_PTR

      401     1462        /* Wait for connect channel to free up */
      402     1463    1           CHAN$=CON$;

   1463  2 000050   000000 236000 0                  LDQ     CON_PTR
         2 000051   200005 756100                    STQ     CHAN$,,AUTO

      403     1464    2           DO UNTIL CMBOX.W1.H2.TALLY=0;

      404     1465    2           END;                            /* DO                                 */

   1465  2 000052   200005 470500                    LDP0    CHAN$,,AUTO
         2 000053   000000 236100                    LDQ     0,,PR0
         2 000054   007777 316007                    CANQ    4095,DL
         2 000055   000052 601000 2                  TNZ     s:1465

      405     1466    1           CMBOX.LPW$=ADDR(PCWS.PCW1);     /* Pointer to PCW                     */

   1466  2 000056   000004 236000 3                  LDQ     4
         2 000057   000000 756100                    STQ     0,,PR0

      406     1467    1           CMBOX.W1.H2.TAL='1'B;           /* Tally                              */

   1467  2 000060   020000 236007                    LDQ     8192,DL
         2 000061   000000 256100                    ORSQ    0,,PR0

      407     1468    1           CMBOX.W1.H2.TALLY=1;            /* Count 1                            */

   1468  2 000062   000001 236007                    LDQ     1,DL
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:73   
         2 000063   000000 752103                    STCQ    0,'03'O,PR0

      408     1469    1           CMBOX.W2='0'B;                  /* LPWX                               */

   1469  2 000064   000001 450100                    STZ     1,,PR0

      409     1470    1           WD0 = WD0$->BWD0 ;              /* Save away real word 0              */

   1470  2 000065   000000 471400 1                  LDP1    WD0_PTR
         2 000066   100000 236100                    LDQ     0,,PR1
         2 000067   000006 756000 0                  STQ     WD0

      410     1471    1           WD0$->BWD0 = COUPLER_CMD ;

   1471  2 000070   000001 236000 1                  LDQ     COUPLER_CMD
         2 000071   100000 756100                    STQ     0,,PR1

      411     1472        /* Turn off the mask bit in PCW1 */
      412     1473    1           PCWS.PCW1.MASK = '0'B ;

   1473  2 000072   000005 236000 3                  LDQ     5
         2 000073   000004 356000 0                  ANSQ    PCWS+2

      413     1474        /* Build the PCW2 */
      414     1475    1           PCWS.PCW2.CHN#=CHN#;            /* PCW2                               */

   1475  2 000074   200004 473500                    LDP3    @CHN#,,AUTO
         2 000075   300000 236100                    LDQ     0,,PR3
         2 000076   000033 736000                    QLS     27
         2 000077   000005 552040 0                  STBQ    PCWS+3,'40'O

      415     1476    1           PORT#=IOMTAB.PORT#(IOM#);

   1476  2 000100   200003 474500                    LDP4    @IOM#,,AUTO
         2 000101   400000 720100                    LXL0    0,,PR4
         2 000102   000000 236010 xsym               LDQ     IOMTAB,X0
         2 000103   000007 376007                    ANQ     7,DL
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:74   
         2 000104   200007 756100                    STQ     PORT#,,AUTO

      416     1477    1           CALL START_IO(PORT#);

   1477  2 000105   200007 635500                    EPPR5   PORT#,,AUTO
         2 000106   200012 455500                    STP5    LOGIC_CHN+1,,AUTO
         2 000107   200012 630500                    EPPR0   LOGIC_CHN+1,,AUTO
         2 000110   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000111   000000 701000 xent               TSX1    START_IO
         2 000112   000000 011000                    NOP     0

      417     1478        /* Wait for connect channel to free up */
      418     1479    2           DO UNTIL CMBOX.W1.H2.TALLY=0;

      419     1480    2           END;                            /* DO UNTIL                           */

   1480  2 000113   200005 470500                    LDP0    CHAN$,,AUTO
         2 000114   000000 236100                    LDQ     0,,PR0
         2 000115   007777 316007                    CANQ    4095,DL
         2 000116   000113 601000 2                  TNZ     s:1480

      420     1481        /* Wait a while */
      421     1482    2           DO I=0 TO 128*1024;

   1482  2 000117   200006 450100                    STZ     I,,AUTO
         2 000120   000124 710000 2                  TRA     s:1483+3

      422     1483    2           END;                            /* DO I=                              */

   1483  2 000121   200006 235100                    LDA     I,,AUTO
         2 000122   000001 035007                    ADLA    1,DL
         2 000123   200006 755100                    STA     I,,AUTO
         2 000124   200006 235100                    LDA     I,,AUTO
         2 000125   400001 115007                    CMPA    -131071,DL
         2 000126   000121 602000 2                  TNC     s:1483

      423     1484    1           CMBOX.LPW$=ADDR(PCWS.PCW1);     /* Pointer to PCW                     */
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:75   

   1484  2 000127   000004 236000 3                  LDQ     4
         2 000130   200005 470500                    LDP0    CHAN$,,AUTO
         2 000131   000000 756100                    STQ     0,,PR0

      424     1485    1           CMBOX.W1.H2.TAL='1'B;           /* Tally                              */

   1485  2 000132   020000 236007                    LDQ     8192,DL
         2 000133   000000 256100                    ORSQ    0,,PR0

      425     1486    1           CMBOX.W1.H2.TALLY=1;            /* Count 1                            */

   1486  2 000134   000001 236007                    LDQ     1,DL
         2 000135   000000 752103                    STCQ    0,'03'O,PR0

      426     1487    1           PCWS.PCW1.MASK = '1'B ;

   1487  2 000136   040000 236007                    LDQ     16384,DL
         2 000137   000004 256000 0                  ORSQ    PCWS+2

      427     1488    1           CALL START_IO(PORT#);

   1488  2 000140   200007 631500                    EPPR1   PORT#,,AUTO
         2 000141   200012 451500                    STP1    LOGIC_CHN+1,,AUTO
         2 000142   200012 630500                    EPPR0   LOGIC_CHN+1,,AUTO
         2 000143   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000144   000000 701000 xent               TSX1    START_IO
         2 000145   000000 011000                    NOP     0

      428     1489        /* Wait for connect channel to free up */
      429     1490    2           DO UNTIL CMBOX.W1.H2.TALLY=0;

      430     1491    2           END;                            /* DO UNTIL                           */

   1491  2 000146   200005 470500                    LDP0    CHAN$,,AUTO
         2 000147   000000 236100                    LDQ     0,,PR0
         2 000150   007777 316007                    CANQ    4095,DL
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:76   
         2 000151   000146 601000 2                  TNZ     s:1491

      431     1492        /* Wait a while */
      432     1493    2           DO I=0 TO 128*1024;

   1493  2 000152   200006 450100                    STZ     I,,AUTO
         2 000153   000157 710000 2                  TRA     s:1494+3

      433     1494    2           END;                            /* DO I=                              */

   1494  2 000154   200006 235100                    LDA     I,,AUTO
         2 000155   000001 035007                    ADLA    1,DL
         2 000156   200006 755100                    STA     I,,AUTO
         2 000157   200006 235100                    LDA     I,,AUTO
         2 000160   400001 115007                    CMPA    -131071,DL
         2 000161   000154 602000 2                  TNC     s:1494

      434     1495    1           WD0$->BWD0 = WD0 ;              /* Restore real word 0                */

   1495  2 000162   000006 236000 0                  LDQ     WD0
         2 000163   000000 470400 1                  LDP0    WD0_PTR
         2 000164   000000 756100                    STQ     0,,PR0

      435     1496    1           RETURN;

   1496  2 000165   000000 702200 xent               TSX2  ! X66_ARET
      436     1497    1   END INIT_FEP;
      437     1498        %EOD;

PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:77   
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure INIT_FEP.
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:78   

 **** Variables and constants ****

  ****  Section 000  Data  INIT_FEP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 CON$                       0-0-0/w STRC        r     1 CON_PTR
     2-0-0/d STRC(144)   r     1 PCWS                       6-0-0/w BIT         r     1 WD0

  ****  Section 001 RoData INIT_FEP

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/w BIT         r     1 COUPLER_CMD                0-0-0/w PTR         r     1 WD0$
     0-0-0/w STRC        r     1 WD0_PTR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @CHN#                      3-0-0/w PTR         r     1 @IOM#
     5-0-0/w PTR         r     1 CHAN$                     *0-0-0/w UBIN        r     1 CHN#
     6-0-0/w UBIN        r     1 I                         *0-0-0/w UBIN        r     1 IOM#
    11-0-0/w UBIN        r     1 LOGIC_CHN                 10-0-0/w PTR         r     1 MAILBOX$
     7-0-0/w UBIN        r     1 PORT#

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 IOMTAB(0:3)                0-0-0/w BIT         r     1 RPM_FLG
     0-0-0/b BIT         r     1 SH_MBX

PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:79   
  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w BIT         r     1 BWD0                       0-0-0/w STRC(144)   r     1 CMBOX
     0-0-0/w STRC(864)   r     1 MBX


   Procedure INIT_FEP requires 118 words for executable code.
   Procedure INIT_FEP requires 12 words of local(AUTO) storage.
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:80   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:81   
          MINI XREF LISTING

BWD0
      1381**DCL      1470>>ASSIGN   1471<<ASSIGN   1495<<ASSIGN
CHAN$
      1358**DCL      1287--IMP-PTR  1463<<ASSIGN   1464>>DOUNTIL  1466>>ASSIGN   1467>>ASSIGN   1468>>ASSIGN
      1469>>ASSIGN   1479>>DOUNTIL  1484>>ASSIGN   1485>>ASSIGN   1486>>ASSIGN   1490>>DOUNTIL
CHN#
      1284**DCL         6--PROC     1455>>ASSIGN   1475>>ASSIGN
CMBOX.LPW$
      1298**DCL      1466<<ASSIGN   1484<<ASSIGN
CMBOX.W1
      1288**DCL      1298--REDEF
CMBOX.W1.H2.TAL
      1295**DCL      1467<<ASSIGN   1485<<ASSIGN
CMBOX.W1.H2.TALLY
      1297**DCL      1464>>DOUNTIL  1468<<ASSIGN   1479>>DOUNTIL  1486<<ASSIGN   1490>>DOUNTIL
CMBOX.W2
      1299**DCL      1469<<ASSIGN
CMBOX.W3
      1302**DCL      1305--REDEF
CMBOX.W4
      1306**DCL      1309--REDEF
CON$
      1346**DCL      1463>>ASSIGN
CON_PTR
      1339**DCL      1346--REDEF
CON_PTR.WOFFS
      1340**DCL      1461<<ASSIGN
COUPLER_CMD
      1380**DCL      1471>>ASSIGN
I
      1359**DCL      1482<<DOINDEX  1493<<DOINDEX
INIT_FEP_RPM
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:82   
      1386**DCL-ENT  1456--CALL
IOM#
      1283**DCL         6--PROC     1455>>ASSIGN   1461>>ASSIGN   1476>>ASSIGN
IOMTAB.MAILBAD
      1323**DCL      1461>>ASSIGN
IOMTAB.PORT#
      1325**DCL      1476>>ASSIGN
LOGIC_CHN
      1447**DCL      1455<<ASSIGN   1456<>CALL
MAILBOX$
      1388**DCL      1400--IMP-PTR  1451<<ASSIGN   1452>>ASSIGN   1453>>ASSIGN   1454>>ASSIGN   1456<>CALL
MBX.CHN_LINK.SYNC
      1413**DCL      1452<<ASSIGN
MBX.LPW
      1419**DCL      1453<<ASSIGN
MBX.STATUS
      1429**DCL      1454<<ASSIGN
MBX.STATUS.W8
      1430**DCL      1433--REDEF
PCWS.PCW1
      1350**DCL      1466--ASSIGN   1484--ASSIGN
PCWS.PCW1.MASK
      1352**DCL      1473<<ASSIGN   1487<<ASSIGN
PCWS.PCW2.CHN#
      1355**DCL      1475<<ASSIGN
PORT#
      1382**DCL      1476<<ASSIGN   1477<>CALL     1488<>CALL
RPM_FLG
      1385**DCL      1450>>IF
SH_MBX
      1446**DCL      1451--ASSIGN
START_IO
      1285**DCL-ENT  1477--CALL     1488--CALL
WD0
      1360**DCL      1470<<ASSIGN   1495>>ASSIGN
WD0$
PL6.E3A0      #003=INIT_FEP File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:83   
      1379**DCL      1470>>ASSIGN   1471>>ASSIGN   1495>>ASSIGN
WD0_PTR
      1372**DCL      1379--REDEF
WT_TIME
      1387**DCL-ENT  1457--CALL

PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:84   
      438        1        /*T***********************************************************/
      439        2        /*T*                                                         */
      440        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      441        4        /*T*                                                         */
      442        5        /*T***********************************************************/
      443        6        FWRXX:  PROC(NAME) ALTRET;
      444        7        /* This program looks for a firmware module
      445        8           with the name NAME in the header list,
      446        9           ALTRETURNs when it doesn't find it       */
      447       10    1   DCL NAME CHAR(4);
      448       11        %INCLUDE IS$MACROS;
      449     1286    1   DCL FWHDR$ PTR SYMREF;
      450     1287        %PTR_STRUCT(NAME=FWHDR_PTR,STCLASS="REDEF FWHDR$");
      451     1305    1   DCL NAVHDR$ PTR SYMREF;
      452     1306        %PTR_STRUCT(NAME=NAVHDR_PTR,STCLASS="REDEF NAVHDR$");
      453     1324        %FWHDR;                                 /* Header description                 */
      454     1333        %DISKDIR(NAME=ADIR,STCLASS="SYMREF");
      455     1589        /**/
      456     1590    1           FWHDR$=ADDR(ADIR.FW(0));
      457     1591    1   LOOP:
      458     1592    1           IF FWHDR.FWNAME=NAME THEN RETURN; /* Firmware found                   */
      459     1593    1             ELSE;
      460     1594    1           FWHDR_PTR.WOFFS=FWHDR_PTR.WOFFS+4;
      461     1595    1           IF FWHDR_PTR.WOFFS>=NAVHDR_PTR.WOFFS THEN ALTRETURN;
              1595                    /* Firmware not found */
      462     1596    1             ELSE GOTO LOOP;
      463     1597    1   END FWRXX;
      464     1598        %EOD;

PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:85   
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FWRXX.

   Procedure FWRXX requires 17 words for executable code.
   Procedure FWRXX requires 4 words of local(AUTO) storage.

PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:86   

 Object Unit name= FWRXX                                      File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:12.60 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    17     21  FWRXX
    1  RoData even  none     1      1  FWRXX

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  FWRXX

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     FWHDR$                                NAVHDR$                               ADIR
PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:87   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:88   


      438        1        /*T***********************************************************/
      439        2        /*T*                                                         */
      440        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      441        4        /*T*                                                         */
      442        5        /*T***********************************************************/
      443        6        FWRXX:  PROC(NAME) ALTRET;

      6  0 000000   000000 700200 xent  FWRXX        TSX0  ! X66_AUTO_1
         0 000001   000004 000001                    ZERO    4,1

      444        7        /* This program looks for a firmware module
      445        8           with the name NAME in the header list,
      446        9           ALTRETURNs when it doesn't find it       */
      447       10    1   DCL NAME CHAR(4);
      448       11        %INCLUDE IS$MACROS;
      449     1286    1   DCL FWHDR$ PTR SYMREF;
      450     1287        %PTR_STRUCT(NAME=FWHDR_PTR,STCLASS="REDEF FWHDR$");
      451     1305    1   DCL NAVHDR$ PTR SYMREF;
      452     1306        %PTR_STRUCT(NAME=NAVHDR_PTR,STCLASS="REDEF NAVHDR$");
      453     1324        %FWHDR;                                 /* Header description                 */
      454     1333        %DISKDIR(NAME=ADIR,STCLASS="SYMREF");
      455     1589        /**/
      456     1590    1           FWHDR$=ADDR(ADIR.FW(0));

   1590  0 000002   000000 236000 1                  LDQ     0
         0 000003   000000 756000 xsym               STQ     FWHDR$

      457     1591    1   LOOP:
      458     1592    1           IF FWHDR.FWNAME=NAME THEN RETURN; /* Firmware found                   */

   1592  0 000004   000000 470400 xsym  LOOP         LDP0    FWHDR$
         0 000005   200003 471500                    LDP1    @NAME,,AUTO
         0 000006   040100 106500                    CMPC    fill='040'O
         0 000007   000003 000004                    ADSC9   3,,PR0                   cn=0,n=4
         0 000010   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         0 000011   000013 601000 0                  TNZ     s:1594
PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:89   

   1592  0 000012   000000 702200 xent               TSX2  ! X66_ARET

      459     1593    1             ELSE;
      460     1594    1           FWHDR_PTR.WOFFS=FWHDR_PTR.WOFFS+4;

   1594  0 000013   000000 220000 xsym               LDX0    FWHDR$
         0 000014   000004 621010                    EAX1    4,X0
         0 000015   000000 741000 xsym               STX1    FWHDR$

      461     1595    1           IF FWHDR_PTR.WOFFS>=NAVHDR_PTR.WOFFS THEN ALTRETURN;
              1595                    /* Firmware not found */

   1595  0 000016   000000 101000 xsym               CMPX1   NAVHDR$
         0 000017   000004 602000 0                  TNC     LOOP

   1595  0 000020   000000 702200 xent               TSX2  ! X66_AALT
      462     1596    1             ELSE GOTO LOOP;
      463     1597    1   END FWRXX;
      464     1598        %EOD;

PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:90   
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FWRXX.
PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:91   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NAME                     *0-0-0/c CHAR(4)     r     1 NAME

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(8640)  r     1 ADIR                       0-0-0/w PTR         r     1 FWHDR$
     0-0-0/w STRC        r     1 FWHDR_PTR                  0-0-0/w PTR         r     1 NAVHDR$
     0-0-0/w STRC        r     1 NAVHDR_PTR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(144)   r     1 FWHDR


   Procedure FWRXX requires 17 words for executable code.
   Procedure FWRXX requires 4 words of local(AUTO) storage.
PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:92   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FWRXX File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:93   
          MINI XREF LISTING

ADIR.FW
      1580**DCL      1590--ASSIGN
ADIR.FW.ADIR
      1586**DCL      1587--REDEF
ADIR.MONID.M
      1546**DCL      1549--REDEF
FWHDR.FWNAME
      1331**DCL      1592>>IF
FWHDR$
      1286**DCL      1298--REDEF    1325--IMP-PTR  1590<<ASSIGN   1592>>IF
FWHDR_PTR.WOFFS
      1299**DCL      1594<<ASSIGN   1594>>ASSIGN   1595>>IF
LOOP
      1592**LABEL    1596--GOTO
NAME
        10**DCL         6--PROC     1592>>IF
NAVHDR$
      1305**DCL      1317--REDEF
NAVHDR_PTR.WOFFS
      1318**DCL      1595>>IF

PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:94   
      465        1        /*T***********************************************************/
      466        2        /*T*                                                         */
      467        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      468        4        /*T*                                                         */
      469        5        /*T***********************************************************/
      470        6        BUILDFW_DCWS:PROC(DCW1,DCW2);
      471        7        /* This program builds the DCWs for firmware writing */
      472        8        %INCLUDE IS$MACROS;
      473     1283    1   DCL 1 DCW1 ALIGNED,
      474     1284    1         2 W1 BIT(36),
      475     1285    1         2 W2 BIT(36);
      476     1286    1   DCL 1 DCW2 ALIGNED,
      477     1287    1         2 W1 BIT(36),
      478     1288    1         2 W2 BIT(36);
      479     1289    1   DCL FWHDR$ PTR SYMREF;
      480     1290        %FWHDR;
      481     1299    1   DCL CSOD1$ PTR;
      482     1300    1   DCL CSOD2$ PTR;
      483     1301    1   DCL MMOD1$ PTR;
      484     1302    1   DCL MMOD2$ PTR;
      485     1303        %DCW_STRUCT(NAME=CSOD1,STCLASS="BASED(CSOD1$)");
      486     1321        %DCW_STRUCT(NAME=CSOD2,STCLASS="BASED(CSOD2$)");
      487     1339        %DCW_STRUCT(NAME=MMOD1,STCLASS="BASED(MMOD1$)");
      488     1357        %DCW_STRUCT(NAME=MMOD2,STCLASS="BASED(MMOD2$)");
      489     1375        /**/
      490     1376    1           CSOD1$=ADDR(DCW1.W1);
      491     1377    1           CSOD2$=ADDR(DCW1.W2);
      492     1378    1           MMOD1$=ADDR(DCW2.W1);
      493     1379    1           MMOD2$=ADDR(DCW2.W2);
      494     1380    1           CSOD1='0'B;
      495     1381    1           CSOD2='0'B;
      496     1382    1           MMOD1='0'B;
      497     1383    1           MMOD2='0'B;
      498     1384        /**/
      499     1385        /* Build CSO DCWs */
      500     1386    1           CSOD1.AD=FWHDR.BUFAD;
      501     1387    2           IF FWHDR.CSOSIZE>4096 THEN DO;  /* Need two DCWs                      */
PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:95   
      502     1388    2                 CSOD1.TYPE='01'B;         /* Make it an IOTP                    */
      503     1389    2                 CSOD2.AD=CSOD1.AD+4096;
      504     1390    2                 CSOD2.TALLY=FWHDR.CSOSIZE-4096;
      505     1391    2               END;                        /* THEN                               */
      506     1392    1             ELSE;
      507     1393    1           IF FWHDR.CSOSIZE<4096 THEN CSOD1.TALLY=FWHDR.CSOSIZE;
      508     1394    1             ELSE;
      509     1395        /* Build MMO DCWs */
      510     1396    1           MMOD1.AD=FWHDR.BUFAD+FWHDR.CSOSIZE;
      511     1397    2           IF FWHDR.MMOSIZE>4096 THEN DO;  /* Need two DCWs                      */
      512     1398    2                 MMOD1.TYPE='01'B;         /* Make it an IOTP                    */
      513     1399    2                 MMOD2.AD=MMOD1.AD+4096;
      514     1400    2                 MMOD2.TALLY=FWHDR.MMOSIZE-4096;
      515     1401    2               END;                        /* THEN                               */
      516     1402    1             ELSE;
      517     1403    1           IF FWHDR.MMOSIZE<4096 THEN MMOD1.TALLY=FWHDR.MMOSIZE;
      518     1404    1             ELSE;
      519     1405    1           RETURN;
      520     1406    1   END BUILDFW_DCWS;
      521     1407        %EOD;

PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:96   
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure BUILDFW_DCWS.

   Procedure BUILDFW_DCWS requires 74 words for executable code.
   Procedure BUILDFW_DCWS requires 12 words of local(AUTO) storage.

PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:97   

 Object Unit name= BUILDFW_DCWS                               File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:16.64 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    74    112  BUILDFW_DCWS
    1  RoData even  none     1      1  BUILDFW_DCWS

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        2  BUILDFW_DCWS

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     FWHDR$
PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:98   


      465        1        /*T***********************************************************/
      466        2        /*T*                                                         */
      467        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      468        4        /*T*                                                         */
      469        5        /*T***********************************************************/
      470        6        BUILDFW_DCWS:PROC(DCW1,DCW2);

      6  0 000000   000000 700200 xent  BUILDFW_DCWS TSX0  ! X66_AUTO_2
         0 000001   000014 000002                    ZERO    12,2

      471        7        /* This program builds the DCWs for firmware writing */
      472        8        %INCLUDE IS$MACROS;
      473     1283    1   DCL 1 DCW1 ALIGNED,
      474     1284    1         2 W1 BIT(36),
      475     1285    1         2 W2 BIT(36);
      476     1286    1   DCL 1 DCW2 ALIGNED,
      477     1287    1         2 W1 BIT(36),
      478     1288    1         2 W2 BIT(36);
      479     1289    1   DCL FWHDR$ PTR SYMREF;
      480     1290        %FWHDR;
      481     1299    1   DCL CSOD1$ PTR;
      482     1300    1   DCL CSOD2$ PTR;
      483     1301    1   DCL MMOD1$ PTR;
      484     1302    1   DCL MMOD2$ PTR;
      485     1303        %DCW_STRUCT(NAME=CSOD1,STCLASS="BASED(CSOD1$)");
      486     1321        %DCW_STRUCT(NAME=CSOD2,STCLASS="BASED(CSOD2$)");
      487     1339        %DCW_STRUCT(NAME=MMOD1,STCLASS="BASED(MMOD1$)");
      488     1357        %DCW_STRUCT(NAME=MMOD2,STCLASS="BASED(MMOD2$)");
      489     1375        /**/
      490     1376    1           CSOD1$=ADDR(DCW1.W1);

   1376  0 000002   200003 236100                    LDQ     @DCW1,,AUTO
         0 000003   200005 756100                    STQ     CSOD1$,,AUTO

      491     1377    1           CSOD2$=ADDR(DCW1.W2);

PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:99   
   1377  0 000004   000001 036003                    ADLQ    1,DU
         0 000005   200006 756100                    STQ     CSOD2$,,AUTO

      492     1378    1           MMOD1$=ADDR(DCW2.W1);

   1378  0 000006   200004 236100                    LDQ     @DCW2,,AUTO
         0 000007   200007 756100                    STQ     MMOD1$,,AUTO

      493     1379    1           MMOD2$=ADDR(DCW2.W2);

   1379  0 000010   000001 036003                    ADLQ    1,DU
         0 000011   200010 756100                    STQ     MMOD2$,,AUTO

      494     1380    1           CSOD1='0'B;

   1380  0 000012   200005 470500                    LDP0    CSOD1$,,AUTO
         0 000013   000000 450100                    STZ     0,,PR0

      495     1381    1           CSOD2='0'B;

   1381  0 000014   200006 471500                    LDP1    CSOD2$,,AUTO
         0 000015   100000 450100                    STZ     0,,PR1

      496     1382    1           MMOD1='0'B;

   1382  0 000016   200007 473500                    LDP3    MMOD1$,,AUTO
         0 000017   300000 450100                    STZ     0,,PR3

      497     1383    1           MMOD2='0'B;

   1383  0 000020   200010 474500                    LDP4    MMOD2$,,AUTO
         0 000021   400000 450100                    STZ     0,,PR4

      498     1384        /**/
      499     1385        /* Build CSO DCWs */
      500     1386    1           CSOD1.AD=FWHDR.BUFAD;

PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:100  
   1386  0 000022   000000 475400 xsym               LDP5    FWHDR$
         0 000023   500000 720100                    LXL0    0,,PR5
         0 000024   000000 740100                    STX0    0,,PR0

      501     1387    2           IF FWHDR.CSOSIZE>4096 THEN DO;  /* Need two DCWs                      */

   1387  0 000025   000000 475400 xsym               LDP5    FWHDR$
         0 000026   500002 221100                    LDX1    2,,PR5
         0 000027   010001 101003                    CMPX1   4097,DU
         0 000030   000044 602000 0                  TNC     s:1393

      502     1388    2                 CSOD1.TYPE='01'B;         /* Make it an IOTP                    */

   1388  0 000031   000000 236100                    LDQ     0,,PR0
         0 000032   000000 376000 1                  ANQ     0
         0 000033   010000 276007                    ORQ     4096,DL
         0 000034   000000 756100                    STQ     0,,PR0

      503     1389    2                 CSOD2.AD=CSOD1.AD+4096;

   1389  0 000035   010000 621010                    EAX1    4096,X0
         0 000036   100000 741100                    STX1    0,,PR1

      504     1390    2                 CSOD2.TALLY=FWHDR.CSOSIZE-4096;

   1390  0 000037   000000 475400 xsym               LDP5    FWHDR$
         0 000040   500002 236100                    LDQ     2,,PR5
         0 000041   000022 772000                    QRL     18
         0 000042   010000 136007                    SBLQ    4096,DL
         0 000043   100000 752103                    STCQ    0,'03'O,PR1

      505     1391    2               END;                        /* THEN                               */

      506     1392    1             ELSE;
      507     1393    1           IF FWHDR.CSOSIZE<4096 THEN CSOD1.TALLY=FWHDR.CSOSIZE;

   1393  0 000044   000000 475400 xsym               LDP5    FWHDR$
PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:101  
         0 000045   500002 220100                    LDX0    2,,PR5
         0 000046   010000 100003                    CMPX0   4096,DU
         0 000047   000053 603000 0                  TRC     s:1396

   1393  0 000050   500002 236100                    LDQ     2,,PR5
         0 000051   000022 772000                    QRL     18
         0 000052   000000 752103                    STCQ    0,'03'O,PR0

      508     1394    1             ELSE;
      509     1395        /* Build MMO DCWs */
      510     1396    1           MMOD1.AD=FWHDR.BUFAD+FWHDR.CSOSIZE;

   1396  0 000053   000000 475400 xsym               LDP5    FWHDR$
         0 000054   500002 236100                    LDQ     2,,PR5
         0 000055   000022 772000                    QRL     18
         0 000056   200012 756100                    STQ     MMOD2$+2,,AUTO
         0 000057   500000 236100                    LDQ     0,,PR5
         0 000060   777777 376007                    ANQ     -1,DL
         0 000061   200012 036100                    ADLQ    MMOD2$+2,,AUTO
         0 000062   000000 620006                    EAX0    0,QL
         0 000063   300000 740100                    STX0    0,,PR3

      511     1397    2           IF FWHDR.MMOSIZE>4096 THEN DO;  /* Need two DCWs                      */

   1397  0 000064   000000 475400 xsym               LDP5    FWHDR$
         0 000065   500002 721100                    LXL1    2,,PR5
         0 000066   010001 101003                    CMPX1   4097,DU
         0 000067   000103 602000 0                  TNC     s:1403

      512     1398    2                 MMOD1.TYPE='01'B;         /* Make it an IOTP                    */

   1398  0 000070   300000 236100                    LDQ     0,,PR3
         0 000071   000000 376000 1                  ANQ     0
         0 000072   010000 276007                    ORQ     4096,DL
         0 000073   300000 756100                    STQ     0,,PR3

      513     1399    2                 MMOD2.AD=MMOD1.AD+4096;
PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:102  

   1399  0 000074   010000 621010                    EAX1    4096,X0
         0 000075   400000 741100                    STX1    0,,PR4

      514     1400    2                 MMOD2.TALLY=FWHDR.MMOSIZE-4096;

   1400  0 000076   000000 475400 xsym               LDP5    FWHDR$
         0 000077   500002 236100                    LDQ     2,,PR5
         0 000100   777777 376007                    ANQ     -1,DL
         0 000101   010000 136007                    SBLQ    4096,DL
         0 000102   400000 752103                    STCQ    0,'03'O,PR4

      515     1401    2               END;                        /* THEN                               */

      516     1402    1             ELSE;
      517     1403    1           IF FWHDR.MMOSIZE<4096 THEN MMOD1.TALLY=FWHDR.MMOSIZE;

   1403  0 000103   000000 475400 xsym               LDP5    FWHDR$
         0 000104   500002 720100                    LXL0    2,,PR5
         0 000105   010000 100003                    CMPX0   4096,DU
         0 000106   000111 603000 0                  TRC     s:1405

   1403  0 000107   500002 236100                    LDQ     2,,PR5
         0 000110   300000 752103                    STCQ    0,'03'O,PR3

      518     1404    1             ELSE;
      519     1405    1           RETURN;

   1405  0 000111   000000 702200 xent               TSX2  ! X66_ARET
      520     1406    1   END BUILDFW_DCWS;
      521     1407        %EOD;

PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:103  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure BUILDFW_DCWS.
PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:104  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DCW1                      4-0-0/w PTR         r     1 @DCW2
     5-0-0/w PTR         r     1 CSOD1$                     6-0-0/w PTR         r     1 CSOD2$
    *0-0-0/w STRC(72)    r     1 DCW1                      *0-0-0/w STRC(72)    r     1 DCW2
     7-0-0/w PTR         r     1 MMOD1$                    10-0-0/w PTR         r     1 MMOD2$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 FWHDR$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 CSOD1                      0-0-0/w STRC        r     1 CSOD2
     0-0-0/w STRC(144)   r     1 FWHDR                      0-0-0/w STRC        r     1 MMOD1
     0-0-0/w STRC        r     1 MMOD2


   Procedure BUILDFW_DCWS requires 74 words for executable code.
   Procedure BUILDFW_DCWS requires 12 words of local(AUTO) storage.
PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:105  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:106  
          MINI XREF LISTING

CSOD1
      1313**DCL      1380<<ASSIGN
CSOD1.AD
      1314**DCL      1386<<ASSIGN   1389>>ASSIGN
CSOD1.TALLY
      1318**DCL      1393<<ASSIGN
CSOD1.TYPE
      1317**DCL      1388<<ASSIGN
CSOD1$
      1299**DCL      1313--IMP-PTR  1376<<ASSIGN   1380>>ASSIGN   1386>>ASSIGN   1388>>ASSIGN   1389>>ASSIGN
      1393>>ASSIGN
CSOD2
      1331**DCL      1381<<ASSIGN
CSOD2.AD
      1332**DCL      1389<<ASSIGN
CSOD2.TALLY
      1336**DCL      1390<<ASSIGN
CSOD2$
      1300**DCL      1331--IMP-PTR  1377<<ASSIGN   1381>>ASSIGN   1389>>ASSIGN   1390>>ASSIGN
DCW1
      1283**DCL         6--PROC
DCW1.W1
      1284**DCL      1376--ASSIGN
DCW1.W2
      1285**DCL      1377--ASSIGN
DCW2
      1286**DCL         6--PROC
DCW2.W1
      1287**DCL      1378--ASSIGN
DCW2.W2
      1288**DCL      1379--ASSIGN
FWHDR.BUFAD
PL6.E3A0      #005=BUILDFW_DCWS File=ISI$ROUT.:E05TSI                            TUE 07/29/97 22:57 Page:107  
      1293**DCL      1386>>ASSIGN   1396>>ASSIGN
FWHDR.CSOSIZE
      1295**DCL      1387>>IF       1390>>ASSIGN   1393>>IF       1393>>ASSIGN   1396>>ASSIGN
FWHDR.MMOSIZE
      1296**DCL      1397>>IF       1400>>ASSIGN   1403>>IF       1403>>ASSIGN
FWHDR$
      1289**DCL      1291--IMP-PTR  1386>>ASSIGN   1387>>IF       1390>>ASSIGN   1393>>IF       1393>>ASSIGN
      1396>>ASSIGN   1396>>ASSIGN   1397>>IF       1400>>ASSIGN   1403>>IF       1403>>ASSIGN
MMOD1
      1349**DCL      1382<<ASSIGN
MMOD1.AD
      1350**DCL      1396<<ASSIGN   1399>>ASSIGN
MMOD1.TALLY
      1354**DCL      1403<<ASSIGN
MMOD1.TYPE
      1353**DCL      1398<<ASSIGN
MMOD1$
      1301**DCL      1349--IMP-PTR  1378<<ASSIGN   1382>>ASSIGN   1396>>ASSIGN   1398>>ASSIGN   1399>>ASSIGN
      1403>>ASSIGN
MMOD2
      1367**DCL      1383<<ASSIGN
MMOD2.AD
      1368**DCL      1399<<ASSIGN
MMOD2.TALLY
      1372**DCL      1400<<ASSIGN
MMOD2$
      1302**DCL      1367--IMP-PTR  1379<<ASSIGN   1383>>ASSIGN   1399>>ASSIGN   1400>>ASSIGN

PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:108  
      522        1        /*T***********************************************************/
      523        2        /*T*                                                         */
      524        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      525        4        /*T*                                                         */
      526        5        /*T***********************************************************/
      527        6        MTINIT: PROC ALTRET;
      528        7        /* Initializes the MT MPC */
      529        8        %INCLUDE IS$MACROS;
      530     1283        %DEVINFO(STCLASS="SYMREF");
      531     1352    1   DCL BOOTTAPE UBIN WORD SYMREF;
      532     1353    1   DCL RCV_FLG BIT(4) SYMREF;
      533     1354    1   DCL CSOC BIT(36) SYMREF;
      534     1355    1   DCL MMOC BIT(36) SYMREF;
      535     1356    1   DCL MTCSOD1 BIT(1) SYMREF;
      536     1357    1   DCL MTMMOD1 BIT(1) SYMREF;
      537     1358        %DOIO_COMZONE(NAME=MTI_ZONE);
      538     1391        /**/
      539     1392    1   DCL IPCW_PL6 ENTRY(1);
      540     1393    1   DCL DOIOX ENTRY(4);
      541     1394        /**/
      542     1395    1   DCL MTCNT UBIN WORD;
      543     1396    1   DCL SAVE_DEV UBIN(6);
      544     1397        /**/
      545     1398    1           IF RCV_FLG~='0'B THEN RETURN;
      546     1399    1             ELSE;
      547     1400    1           SAVE_DEV=DEVINFO.DEV#(BOOTTAPE);
      548     1401    1           DEVINFO.DEV#(BOOTTAPE)=0;
      549     1402    1           MTCNT=0;                        /* Retry number                       */
      550     1403    1   MTINIT0:
      551     1404    1           CALL IPCW_PL6(BOOTTAPE);
      552     1405        /* Build DOIO comzone */
      553     1406    1           MTI_ZONE.IDCW$=ADDR(CSOC);
      554     1407    1           MTI_ZONE.DCW$=ADDR(MTCSOD1);
      555     1408    1           MTI_ZONE.BDCW.H2='0'B;
      556     1409    1           MTI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */
      557     1410    1           CALL DOIOX(BOOTTAPE,ADDR(MTI_ZONE));
      558     1411        /* Check status after DOIO */
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:109  
      559     1412    1           IF (DEVINFO.BSTAT.W1(BOOTTAPE)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO MTINIT1
              1412                    ; /* Error */
      560     1413    1             ELSE;
      561     1414        /* Build DOIO comzone */
      562     1415    1           MTI_ZONE.IDCW$=ADDR(MMOC);
      563     1416    1           MTI_ZONE.DCW$=ADDR(MTMMOD1);
      564     1417    1           MTI_ZONE.BDCW.H2='0'B;
      565     1418    1           MTI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */
      566     1419    1           CALL DOIOX(BOOTTAPE,ADDR(MTI_ZONE));
      567     1420        /* Check status after DOIO */
      568     1421    1           IF (DEVINFO.BSTAT.W1(BOOTTAPE)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO MTINIT1
              1421                    ; /* Error */
      569     1422    1             ELSE;
      570     1423        /* Normal return */
      571     1424    1           DEVINFO.DEV#(BOOTTAPE)=SAVE_DEV;
      572     1425    1           RETURN;
      573     1426    1   MTINIT1:
      574     1427    1           MTCNT=MTCNT+1;
      575     1428    1           IF MTCNT<4 THEN GOTO MTINIT0;   /* Retry                              */
      576     1429    1             ELSE;
      577     1430        /* Error return */
      578     1431    1           DEVINFO.DEV#(BOOTTAPE)=SAVE_DEV;
      579     1432    1           ALTRETURN;
      580     1433    1   END MTINIT;
      581     1434        %EOD;

PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:110  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure MTINIT.

   Procedure MTINIT requires 94 words for executable code.
   Procedure MTINIT requires 10 words of local(AUTO) storage.

PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:111  

 Object Unit name= MTINIT                                     File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:20.28 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     2      2  MTINIT
    1  RoData even  UTS      1      1  MTINIT
    2   Proc  even  none    94    136  MTINIT
    3  RoData even  none     8     10  MTINIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        0  MTINIT

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  MTI_ZONE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 IPCW_PL6
         yes           Std       4 DOIOX
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:112  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     DEVINFO                               BOOTTAPE                              RCV_FLG
     CSOC                                  MMOC                                  MTCSOD1
     MTMMOD1                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:113  


      522        1        /*T***********************************************************/
      523        2        /*T*                                                         */
      524        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      525        4        /*T*                                                         */
      526        5        /*T***********************************************************/
      527        6        MTINIT: PROC ALTRET;

      6  2 000000   000000 700200 xent  MTINIT       TSX0  ! X66_AUTO_0
         2 000001   000012 000000                    ZERO    10,0

      528        7        /* Initializes the MT MPC */
      529        8        %INCLUDE IS$MACROS;
      530     1283        %DEVINFO(STCLASS="SYMREF");
      531     1352    1   DCL BOOTTAPE UBIN WORD SYMREF;
      532     1353    1   DCL RCV_FLG BIT(4) SYMREF;
      533     1354    1   DCL CSOC BIT(36) SYMREF;
      534     1355    1   DCL MMOC BIT(36) SYMREF;
      535     1356    1   DCL MTCSOD1 BIT(1) SYMREF;
      536     1357    1   DCL MTMMOD1 BIT(1) SYMREF;
      537     1358        %DOIO_COMZONE(NAME=MTI_ZONE);
      538     1391        /**/
      539     1392    1   DCL IPCW_PL6 ENTRY(1);
      540     1393    1   DCL DOIOX ENTRY(4);
      541     1394        /**/
      542     1395    1   DCL MTCNT UBIN WORD;
      543     1396    1   DCL SAVE_DEV UBIN(6);
      544     1397        /**/
      545     1398    1           IF RCV_FLG~='0'B THEN RETURN;

   1398  2 000002   000000 236000 xsym               LDQ     RCV_FLG
         2 000003   740000 316003                    CANQ    -16384,DU
         2 000004   000006 600000 2                  TZE     s:1400

   1398  2 000005   000000 702200 xent               TSX2  ! X66_ARET

      546     1399    1             ELSE;
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:114  
      547     1400    1           SAVE_DEV=DEVINFO.DEV#(BOOTTAPE);

   1400  2 000006   000000 236000 xsym               LDQ     BOOTTAPE
         2 000007   000014 402007                    MPY     12,DL
         2 000010   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000011   000025 772000                    QRL     21
         2 000012   000077 376007                    ANQ     63,DL
         2 000013   000036 736000                    QLS     30
         2 000014   200004 756100                    STQ     SAVE_DEV,,AUTO

      548     1401    1           DEVINFO.DEV#(BOOTTAPE)=0;

   1401  2 000015   000000 236000 xsym               LDQ     BOOTTAPE
         2 000016   000014 402007                    MPY     12,DL
         2 000017   000000 620006                    EAX0    0,QL
         2 000020   000000 236000 3                  LDQ     0
         2 000021   000000 356010 xsym               ANSQ    DEVINFO,X0

      549     1402    1           MTCNT=0;                        /* Retry number                       */

   1402  2 000022   200003 450100                    STZ     MTCNT,,AUTO

      550     1403    1   MTINIT0:
      551     1404    1           CALL IPCW_PL6(BOOTTAPE);

   1404  2 000023   000001 630400 3     MTINIT0      EPPR0   1
         2 000024   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000025   000000 701000 xent               TSX1    IPCW_PL6
         2 000026   000000 011000                    NOP     0

      552     1405        /* Build DOIO comzone */
      553     1406    1           MTI_ZONE.IDCW$=ADDR(CSOC);

   1406  2 000027   000002 236000 3                  LDQ     2
         2 000030   000000 756000 0                  STQ     MTI_ZONE

      554     1407    1           MTI_ZONE.DCW$=ADDR(MTCSOD1);
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:115  

   1407  2 000031   000003 236000 3                  LDQ     3
         2 000032   000001 756000 0                  STQ     MTI_ZONE+1

      555     1408    1           MTI_ZONE.BDCW.H2='0'B;

   1408  2 000033   000000 220003                    LDX0    0,DU
         2 000034   000001 440000 0                  SXL0    MTI_ZONE+1

      556     1409    1           MTI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */

   1409  2 000035   000001 236000 0                  LDQ     MTI_ZONE+1
         2 000036   000004 376000 3                  ANQ     4
         2 000037   020000 276007                    ORQ     8192,DL
         2 000040   000001 756000 0                  STQ     MTI_ZONE+1

      557     1410    1           CALL DOIOX(BOOTTAPE,ADDR(MTI_ZONE));

   1410  2 000041   000005 236000 3                  LDQ     5
         2 000042   200006 756100                    STQ     SAVE_DEV+2,,AUTO
         2 000043   200006 630500                    EPPR0   SAVE_DEV+2,,AUTO
         2 000044   200011 450500                    STP0    SAVE_DEV+5,,AUTO
         2 000045   000001 236000 3                  LDQ     1
         2 000046   200010 756100                    STQ     SAVE_DEV+4,,AUTO
         2 000047   200010 630500                    EPPR0   SAVE_DEV+4,,AUTO
         2 000050   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000051   000000 701000 xent               TSX1    DOIOX
         2 000052   000000 011000                    NOP     0

      558     1411        /* Check status after DOIO */
      559     1412    1          IF (DEVINFO.BSTAT.W1(BOOTTAPE)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO MTINIT1
              1412                    ; /* Error */

   1412  2 000053   000000 236000 xsym               LDQ     BOOTTAPE
         2 000054   000014 402007                    MPY     12,DL
         2 000055   000000 620006                    EAX0    0,QL
         2 000056   000000 236000 1                  LDQ     0
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:116  
         2 000057   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000060   400000 116003                    CMPQ    -131072,DU
         2 000061   000123 601000 2                  TNZ     MTINIT1

      560     1413    1             ELSE;
      561     1414        /* Build DOIO comzone */
      562     1415    1           MTI_ZONE.IDCW$=ADDR(MMOC);

   1415  2 000062   000006 236000 3                  LDQ     6
         2 000063   000000 756000 0                  STQ     MTI_ZONE

      563     1416    1           MTI_ZONE.DCW$=ADDR(MTMMOD1);

   1416  2 000064   000007 236000 3                  LDQ     7
         2 000065   000001 756000 0                  STQ     MTI_ZONE+1

      564     1417    1           MTI_ZONE.BDCW.H2='0'B;

   1417  2 000066   000000 221003                    LDX1    0,DU
         2 000067   000001 441000 0                  SXL1    MTI_ZONE+1

      565     1418    1           MTI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */

   1418  2 000070   000001 236000 0                  LDQ     MTI_ZONE+1
         2 000071   000004 376000 3                  ANQ     4
         2 000072   020000 276007                    ORQ     8192,DL
         2 000073   000001 756000 0                  STQ     MTI_ZONE+1

      566     1419    1           CALL DOIOX(BOOTTAPE,ADDR(MTI_ZONE));

   1419  2 000074   000005 236000 3                  LDQ     5
         2 000075   200006 756100                    STQ     SAVE_DEV+2,,AUTO
         2 000076   200006 630500                    EPPR0   SAVE_DEV+2,,AUTO
         2 000077   200011 450500                    STP0    SAVE_DEV+5,,AUTO
         2 000100   000001 236000 3                  LDQ     1
         2 000101   200010 756100                    STQ     SAVE_DEV+4,,AUTO
         2 000102   200010 630500                    EPPR0   SAVE_DEV+4,,AUTO
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:117  
         2 000103   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000104   000000 701000 xent               TSX1    DOIOX
         2 000105   000000 011000                    NOP     0

      567     1420        /* Check status after DOIO */
      568     1421    1          IF (DEVINFO.BSTAT.W1(BOOTTAPE)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO MTINIT1
              1421                    ; /* Error */

   1421  2 000106   000000 236000 xsym               LDQ     BOOTTAPE
         2 000107   000014 402007                    MPY     12,DL
         2 000110   000000 620006                    EAX0    0,QL
         2 000111   000000 236000 1                  LDQ     0
         2 000112   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000113   400000 116003                    CMPQ    -131072,DU
         2 000114   000123 601000 2                  TNZ     MTINIT1

      569     1422    1             ELSE;
      570     1423        /* Normal return */
      571     1424    1           DEVINFO.DEV#(BOOTTAPE)=SAVE_DEV;

   1424  2 000115   200004 236100                    LDQ     SAVE_DEV,,AUTO
         2 000116   000011 772000                    QRL     9
         2 000117   000000 676010 xsym               ERQ     DEVINFO,X0
         2 000120   000770 376003                    ANQ     504,DU
         2 000121   000000 656010 xsym               ERSQ    DEVINFO,X0

      572     1425    1           RETURN;

   1425  2 000122   000000 702200 xent               TSX2  ! X66_ARET

      573     1426    1   MTINIT1:
      574     1427    1           MTCNT=MTCNT+1;

   1427  2 000123   200003 235100       MTINIT1      LDA     MTCNT,,AUTO
         2 000124   000001 035007                    ADLA    1,DL
         2 000125   200003 755100                    STA     MTCNT,,AUTO

PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:118  
      575     1428    1           IF MTCNT<4 THEN GOTO MTINIT0;   /* Retry                              */

   1428  2 000126   000004 115007                    CMPA    4,DL
         2 000127   000023 602000 2                  TNC     MTINIT0

      576     1429    1             ELSE;
      577     1430        /* Error return */
      578     1431    1           DEVINFO.DEV#(BOOTTAPE)=SAVE_DEV;

   1431  2 000130   200004 236100                    LDQ     SAVE_DEV,,AUTO
         2 000131   000011 772000                    QRL     9
         2 000132   000000 676010 xsym               ERQ     DEVINFO,X0
         2 000133   000770 376003                    ANQ     504,DU
         2 000134   000000 656010 xsym               ERSQ    DEVINFO,X0

      579     1432    1           ALTRETURN;

   1432  2 000135   000000 702200 xent               TSX2  ! X66_AALT
      580     1433    1   END MTINIT;
      581     1434        %EOD;

PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:119  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure MTINIT.
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:120  

 **** Variables and constants ****

  ****  Section 000  Data  MTINIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 MTI_ZONE

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w UBIN        r     1 MTCNT                      4-0-0/w UBIN(6)     r     1 SAVE_DEV

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 BOOTTAPE                   0-0-0/b BIT         r     1 CSOC
     0-0-0/d STRC(396)   r     1 DEVINFO(0:21)              0-0-0/b BIT         r     1 MMOC
     0-0-0/b BIT         r     1 MTCSOD1                    0-0-0/b BIT         r     1 MTMMOD1
     0-0-0/b BIT (4)     r     1 RCV_FLG


   Procedure MTINIT requires 94 words for executable code.
   Procedure MTINIT requires 10 words of local(AUTO) storage.
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:121  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:122  
          MINI XREF LISTING

BOOTTAPE
      1352**DCL      1400>>ASSIGN   1401>>ASSIGN   1404<>CALL     1410<>CALL     1412>>IF       1419<>CALL
      1421>>IF       1424>>ASSIGN   1431>>ASSIGN
CSOC
      1354**DCL      1406--ASSIGN
DEVINFO.BSTAT.W1
      1336**DCL      1412>>IF       1421>>IF
DEVINFO.DEV#
      1296**DCL      1400>>ASSIGN   1401<<ASSIGN   1424<<ASSIGN   1431<<ASSIGN
DEVINFO.PCWS
      1299**DCL      1310--REDEF
DEVINFO.RPM_PTRS.EF_DCWS$
      1312**DCL      1313--REDEF
DEVINFO.STATUS
      1316**DCL      1335--REDEF
DOIOX
      1393**DCL-ENT  1410--CALL     1419--CALL
IPCW_PL6
      1392**DCL-ENT  1404--CALL
MMOC
      1355**DCL      1415--ASSIGN
MTCNT
      1395**DCL      1402<<ASSIGN   1427<<ASSIGN   1427>>ASSIGN   1428>>IF
MTCSOD1
      1356**DCL      1407--ASSIGN
MTINIT0
      1404**LABEL    1428--GOTO
MTINIT1
      1427**LABEL    1412--GOTO     1421--GOTO
MTI_ZONE
      1369**DCL      1410--CALL     1419--CALL
MTI_ZONE.BDCW.H2
PL6.E3A0      #006=MTINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:123  
      1382**DCL      1408<<ASSIGN   1417<<ASSIGN
MTI_ZONE.DCW
      1376**DCL      1380--REDEF    1383--REDEF    1384--REDEF
MTI_ZONE.DCW$
      1383**DCL      1407<<ASSIGN   1416<<ASSIGN
MTI_ZONE.IDCW$
      1375**DCL      1406<<ASSIGN   1415<<ASSIGN
MTI_ZONE.TDCW.TYPE
      1387**DCL      1409<<ASSIGN   1418<<ASSIGN
MTI_ZONE.W1
      1370**DCL      1375--REDEF
MTMMOD1
      1357**DCL      1416--ASSIGN
RCV_FLG
      1353**DCL      1398>>IF
SAVE_DEV
      1396**DCL      1400<<ASSIGN   1424>>ASSIGN   1431>>ASSIGN

PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:124  
      582        1        /*T***********************************************************/
      583        2        /*T*                                                         */
      584        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      585        4        /*T*                                                         */
      586        5        /*T***********************************************************/
      587        6        DCINIT: PROC ALTRET;
      588        7        /* Initializes the Disk MPC */
      589        8        %INCLUDE IS$MACROS;
      590     1283        %DEVINFO(STCLASS="SYMREF");
      591     1352        %FWHDR;
      592     1361    1   DCL FWHDR$ PTR SYMREF;
      593     1362    1   DCL 1 ORDBFLG SYMREF,
      594     1363    1         2 RC BIT(1),
      595     1364    1         2 DB BIT(1);
      596     1365    1   DCL CSOC BIT(36) SYMREF;
      597     1366    1   DCL MMOC BIT(36) SYMREF;
      598     1367    1   DCL DCCSOD1 BIT(1) SYMREF;
      599     1368    1   DCL DCMMOD1 BIT(1) SYMREF;
      600     1369    1   DCL SYS_DPX UBIN SYMREF;                /* Index in DEVINFO for System disk   */
      601     1370        %DOIO_COMZONE(NAME=DCI_ZONE);
      602     1403        /**/
      603     1404    1   DCL IPCW_PL6 ENTRY(1);
      604     1405    1   DCL DOIOX ENTRY(4);
      605     1406    1   DCL WT_TIME ENTRY(1);
      606     1407        /**/
      607     1408    1   DCL DCCNT UBIN WORD;
      608     1409    1   DCL SAVE_DEV UBIN(6);
      609     1410    1   DCL I UBIN WORD;
      610     1411        /**/
      611     1412    1           IF ORDBFLG.RC='1'B THEN RETURN;
      612     1413    1             ELSE;
      613     1414    1           SAVE_DEV=DEVINFO.DEV#(SYS_DPX);
      614     1415    1           DEVINFO.DEV#(SYS_DPX)=0;
      615     1416    1           DCCNT=0;                        /* Retry number                       */
      616     1417    1   DCINIT0:
      617     1418    1           CALL IPCW_PL6(SYS_DPX);
      618     1419    1           IF FWHDR.FWNAME='MSP8' THEN CALL WT_TIME(20000000); /* For PPU wait   */
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:125  
      619     1420        /* Build DOIO comzone */
      620     1421    1           DCI_ZONE.IDCW$=ADDR(CSOC);
      621     1422    1           DCI_ZONE.DCW$=ADDR(DCCSOD1);
      622     1423    1           DCI_ZONE.BDCW.H2='0'B;
      623     1424    1           DCI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */
      624     1425    1           CALL DOIOX(SYS_DPX,ADDR(DCI_ZONE));
      625     1426    1           IF FWHDR.FWNAME='MSP8' THEN CALL WT_TIME(60000); /* For PPU wait      */
      626     1427        /* Check status after DOIO */
      627     1428    1           IF (DEVINFO.BSTAT.W1(SYS_DPX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO DCINIT1;
              1428                    /* Error */
      628     1429    1             ELSE;
      629     1430        /* Build DOIO comzone */
      630     1431    1           DCI_ZONE.IDCW$=ADDR(MMOC);
      631     1432    1           DCI_ZONE.DCW$=ADDR(DCMMOD1);
      632     1433    1           DCI_ZONE.BDCW.H2='0'B;
      633     1434    1           DCI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */
      634     1435    1           CALL DOIOX(SYS_DPX,ADDR(DCI_ZONE));
      635     1436    1           IF FWHDR.FWNAME='MSP8' THEN CALL WT_TIME(400000); /* For PPU wait     */
      636     1437        /* Check status after DOIO */
      637     1438    1           IF (DEVINFO.BSTAT.W1(SYS_DPX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO DCINIT1;
              1438                    /* Error */
      638     1439    1             ELSE;
      639     1440        /* Normal return */
      640     1441    1           DEVINFO.DEV#(SYS_DPX)=SAVE_DEV;
      641     1442    2           DO I=0 TO 300000;          /* Whait a while after loading firmware    */
      642     1443    2           END;                            /* DO I=                              */
      643     1444    1           RETURN;
      644     1445    1   DCINIT1:
      645     1446    1           DCCNT=DCCNT+1;
      646     1447    1           IF DCCNT<4 THEN GOTO DCINIT0;   /* Retry                              */
      647     1448    1             ELSE;
      648     1449        /* Error return */
      649     1450    1           DEVINFO.DEV#(SYS_DPX)=SAVE_DEV;
      650     1451    1           ALTRETURN;
      651     1452    1   END DCINIT;
      652     1453        %EOD;

PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:126  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure DCINIT.

   Procedure DCINIT requires 123 words for executable code.
   Procedure DCINIT requires 10 words of local(AUTO) storage.

PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:127  

 Object Unit name= DCINIT                                     File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:24.36 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     2      2  DCINIT
    1  RoData even  UTS      2      2  DCINIT
    2   Proc  even  none   123    173  DCINIT
    3  RoData even  none    15     17  DCINIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        0  DCINIT

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  DCI_ZONE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 IPCW_PL6
         yes           Std       1 WT_TIME
         yes           Std       4 DOIOX
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:128  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     DEVINFO                               FWHDR$                                ORDBFLG
     CSOC                                  MMOC                                  DCCSOD1
     DCMMOD1                               SYS_DPX                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:129  


      582        1        /*T***********************************************************/
      583        2        /*T*                                                         */
      584        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      585        4        /*T*                                                         */
      586        5        /*T***********************************************************/
      587        6        DCINIT: PROC ALTRET;

      6  2 000000   000000 700200 xent  DCINIT       TSX0  ! X66_AUTO_0
         2 000001   000012 000000                    ZERO    10,0

      588        7        /* Initializes the Disk MPC */
      589        8        %INCLUDE IS$MACROS;
      590     1283        %DEVINFO(STCLASS="SYMREF");
      591     1352        %FWHDR;
      592     1361    1   DCL FWHDR$ PTR SYMREF;
      593     1362    1   DCL 1 ORDBFLG SYMREF,
      594     1363    1         2 RC BIT(1),
      595     1364    1         2 DB BIT(1);
      596     1365    1   DCL CSOC BIT(36) SYMREF;
      597     1366    1   DCL MMOC BIT(36) SYMREF;
      598     1367    1   DCL DCCSOD1 BIT(1) SYMREF;
      599     1368    1   DCL DCMMOD1 BIT(1) SYMREF;
      600     1369    1   DCL SYS_DPX UBIN SYMREF;                /* Index in DEVINFO for System disk   */
      601     1370        %DOIO_COMZONE(NAME=DCI_ZONE);
      602     1403        /**/
      603     1404    1   DCL IPCW_PL6 ENTRY(1);
      604     1405    1   DCL DOIOX ENTRY(4);
      605     1406    1   DCL WT_TIME ENTRY(1);
      606     1407        /**/
      607     1408    1   DCL DCCNT UBIN WORD;
      608     1409    1   DCL SAVE_DEV UBIN(6);
      609     1410    1   DCL I UBIN WORD;
      610     1411        /**/
      611     1412    1           IF ORDBFLG.RC='1'B THEN RETURN;

   1412  2 000002   000000 234000 xsym               SZN     ORDBFLG
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:130  
         2 000003   000005 605000 2                  TPL     s:1414

   1412  2 000004   000000 702200 xent               TSX2  ! X66_ARET

      612     1413    1             ELSE;
      613     1414    1           SAVE_DEV=DEVINFO.DEV#(SYS_DPX);

   1414  2 000005   000000 236000 xsym               LDQ     SYS_DPX
         2 000006   000014 402007                    MPY     12,DL
         2 000007   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000010   000025 772000                    QRL     21
         2 000011   000077 376007                    ANQ     63,DL
         2 000012   000036 736000                    QLS     30
         2 000013   200004 756100                    STQ     SAVE_DEV,,AUTO

      614     1415    1           DEVINFO.DEV#(SYS_DPX)=0;

   1415  2 000014   000000 236000 xsym               LDQ     SYS_DPX
         2 000015   000014 402007                    MPY     12,DL
         2 000016   000000 620006                    EAX0    0,QL
         2 000017   000000 236000 3                  LDQ     0
         2 000020   000000 356010 xsym               ANSQ    DEVINFO,X0

      615     1416    1           DCCNT=0;                        /* Retry number                       */

   1416  2 000021   200003 450100                    STZ     DCCNT,,AUTO

      616     1417    1   DCINIT0:
      617     1418    1           CALL IPCW_PL6(SYS_DPX);

   1418  2 000022   000001 630400 3     DCINIT0      EPPR0   1
         2 000023   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000024   000000 701000 xent               TSX1    IPCW_PL6
         2 000025   000000 011000                    NOP     0

      618     1419    1           IF FWHDR.FWNAME='MSP8' THEN CALL WT_TIME(20000000); /* For PPU wait   */

PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:131  
   1419  2 000026   000000 470400 xsym               LDP0    FWHDR$
         2 000027   000003 236100                    LDQ     3,,PR0
         2 000030   000000 116000 1                  CMPQ    0
         2 000031   000036 601000 2                  TNZ     s:1421

   1419  2 000032   000003 630400 3                  EPPR0   3
         2 000033   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000034   000000 701000 xent               TSX1    WT_TIME
         2 000035   000000 011000                    NOP     0

      619     1420        /* Build DOIO comzone */
      620     1421    1           DCI_ZONE.IDCW$=ADDR(CSOC);

   1421  2 000036   000004 236000 3                  LDQ     4
         2 000037   000000 756000 0                  STQ     DCI_ZONE

      621     1422    1           DCI_ZONE.DCW$=ADDR(DCCSOD1);

   1422  2 000040   000005 236000 3                  LDQ     5
         2 000041   000001 756000 0                  STQ     DCI_ZONE+1

      622     1423    1           DCI_ZONE.BDCW.H2='0'B;

   1423  2 000042   000000 220003                    LDX0    0,DU
         2 000043   000001 440000 0                  SXL0    DCI_ZONE+1

      623     1424    1           DCI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */

   1424  2 000044   000001 236000 0                  LDQ     DCI_ZONE+1
         2 000045   000006 376000 3                  ANQ     6
         2 000046   020000 276007                    ORQ     8192,DL
         2 000047   000001 756000 0                  STQ     DCI_ZONE+1

      624     1425    1           CALL DOIOX(SYS_DPX,ADDR(DCI_ZONE));

   1425  2 000050   000007 236000 3                  LDQ     7
         2 000051   200006 756100                    STQ     I+1,,AUTO
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:132  
         2 000052   200006 630500                    EPPR0   I+1,,AUTO
         2 000053   200011 450500                    STP0    I+4,,AUTO
         2 000054   000001 236000 3                  LDQ     1
         2 000055   200010 756100                    STQ     I+3,,AUTO
         2 000056   200010 630500                    EPPR0   I+3,,AUTO
         2 000057   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000060   000000 701000 xent               TSX1    DOIOX
         2 000061   000000 011000                    NOP     0

      625     1426    1           IF FWHDR.FWNAME='MSP8' THEN CALL WT_TIME(60000); /* For PPU wait      */

   1426  2 000062   000000 470400 xsym               LDP0    FWHDR$
         2 000063   000003 236100                    LDQ     3,,PR0
         2 000064   000000 116000 1                  CMPQ    0
         2 000065   000072 601000 2                  TNZ     s:1428

   1426  2 000066   000011 630400 3                  EPPR0   9
         2 000067   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000070   000000 701000 xent               TSX1    WT_TIME
         2 000071   000000 011000                    NOP     0

      626     1427        /* Check status after DOIO */
      627     1428    1          IF (DEVINFO.BSTAT.W1(SYS_DPX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO DCINIT1;
              1428                    /* Error */

   1428  2 000072   000000 236000 xsym               LDQ     SYS_DPX
         2 000073   000014 402007                    MPY     12,DL
         2 000074   000000 620006                    EAX0    0,QL
         2 000075   000001 236000 1                  LDQ     1
         2 000076   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000077   400000 116003                    CMPQ    -131072,DU
         2 000100   000160 601000 2                  TNZ     DCINIT1

      628     1429    1             ELSE;
      629     1430        /* Build DOIO comzone */
      630     1431    1           DCI_ZONE.IDCW$=ADDR(MMOC);

PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:133  
   1431  2 000101   000012 236000 3                  LDQ     10
         2 000102   000000 756000 0                  STQ     DCI_ZONE

      631     1432    1           DCI_ZONE.DCW$=ADDR(DCMMOD1);

   1432  2 000103   000013 236000 3                  LDQ     11
         2 000104   000001 756000 0                  STQ     DCI_ZONE+1

      632     1433    1           DCI_ZONE.BDCW.H2='0'B;

   1433  2 000105   000000 221003                    LDX1    0,DU
         2 000106   000001 441000 0                  SXL1    DCI_ZONE+1

      633     1434    1           DCI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */

   1434  2 000107   000001 236000 0                  LDQ     DCI_ZONE+1
         2 000110   000006 376000 3                  ANQ     6
         2 000111   020000 276007                    ORQ     8192,DL
         2 000112   000001 756000 0                  STQ     DCI_ZONE+1

      634     1435    1           CALL DOIOX(SYS_DPX,ADDR(DCI_ZONE));

   1435  2 000113   000007 236000 3                  LDQ     7
         2 000114   200006 756100                    STQ     I+1,,AUTO
         2 000115   200006 630500                    EPPR0   I+1,,AUTO
         2 000116   200011 450500                    STP0    I+4,,AUTO
         2 000117   000001 236000 3                  LDQ     1
         2 000120   200010 756100                    STQ     I+3,,AUTO
         2 000121   200010 630500                    EPPR0   I+3,,AUTO
         2 000122   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000123   000000 701000 xent               TSX1    DOIOX
         2 000124   000000 011000                    NOP     0

      635     1436    1           IF FWHDR.FWNAME='MSP8' THEN CALL WT_TIME(400000); /* For PPU wait     */

   1436  2 000125   000000 470400 xsym               LDP0    FWHDR$
         2 000126   000003 236100                    LDQ     3,,PR0
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:134  
         2 000127   000000 116000 1                  CMPQ    0
         2 000130   000135 601000 2                  TNZ     s:1438

   1436  2 000131   000015 630400 3                  EPPR0   13
         2 000132   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000133   000000 701000 xent               TSX1    WT_TIME
         2 000134   000000 011000                    NOP     0

      636     1437        /* Check status after DOIO */
      637     1438    1          IF (DEVINFO.BSTAT.W1(SYS_DPX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO DCINIT1;
              1438                    /* Error */

   1438  2 000135   000000 236000 xsym               LDQ     SYS_DPX
         2 000136   000014 402007                    MPY     12,DL
         2 000137   000000 620006                    EAX0    0,QL
         2 000140   000001 236000 1                  LDQ     1
         2 000141   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000142   400000 116003                    CMPQ    -131072,DU
         2 000143   000160 601000 2                  TNZ     DCINIT1

      638     1439    1             ELSE;
      639     1440        /* Normal return */
      640     1441    1           DEVINFO.DEV#(SYS_DPX)=SAVE_DEV;

   1441  2 000144   200004 236100                    LDQ     SAVE_DEV,,AUTO
         2 000145   000011 772000                    QRL     9
         2 000146   000000 676010 xsym               ERQ     DEVINFO,X0
         2 000147   000770 376003                    ANQ     504,DU
         2 000150   000000 656010 xsym               ERSQ    DEVINFO,X0

      641     1442    2           DO I=0 TO 300000;          /* Whait a while after loading firmware    */

   1442  2 000151   200005 450100                    STZ     I,,AUTO

      642     1443    2           END;                            /* DO I=                              */

   1443  2 000152   200005 235100                    LDA     I,,AUTO
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:135  
         2 000153   000001 035007                    ADLA    1,DL
         2 000154   200005 755100                    STA     I,,AUTO
         2 000155   000016 115000 3                  CMPA    14
         2 000156   000152 602000 2                  TNC     s:1443

      643     1444    1           RETURN;

   1444  2 000157   000000 702200 xent               TSX2  ! X66_ARET

      644     1445    1   DCINIT1:
      645     1446    1           DCCNT=DCCNT+1;

   1446  2 000160   200003 235100       DCINIT1      LDA     DCCNT,,AUTO
         2 000161   000001 035007                    ADLA    1,DL
         2 000162   200003 755100                    STA     DCCNT,,AUTO

      646     1447    1           IF DCCNT<4 THEN GOTO DCINIT0;   /* Retry                              */

   1447  2 000163   000004 115007                    CMPA    4,DL
         2 000164   000022 602000 2                  TNC     DCINIT0

      647     1448    1             ELSE;
      648     1449        /* Error return */
      649     1450    1           DEVINFO.DEV#(SYS_DPX)=SAVE_DEV;

   1450  2 000165   200004 236100                    LDQ     SAVE_DEV,,AUTO
         2 000166   000011 772000                    QRL     9
         2 000167   000000 676010 xsym               ERQ     DEVINFO,X0
         2 000170   000770 376003                    ANQ     504,DU
         2 000171   000000 656010 xsym               ERSQ    DEVINFO,X0

      650     1451    1           ALTRETURN;

   1451  2 000172   000000 702200 xent               TSX2  ! X66_AALT
      651     1452    1   END DCINIT;
      652     1453        %EOD;

PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:136  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure DCINIT.
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:137  

 **** Variables and constants ****

  ****  Section 000  Data  DCINIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 DCI_ZONE

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w UBIN        r     1 DCCNT                      5-0-0/w UBIN        r     1 I
     4-0-0/w UBIN(6)     r     1 SAVE_DEV

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT         r     1 CSOC                       0-0-0/b BIT         r     1 DCCSOD1
     0-0-0/b BIT         r     1 DCMMOD1                    0-0-0/d STRC(396)   r     1 DEVINFO(0:21)
     0-0-0/w PTR         r     1 FWHDR$                     0-0-0/b BIT         r     1 MMOC
     0-0-0/b STRC(2)     r     1 ORDBFLG                    0-0-0/w UBIN        r     1 SYS_DPX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(144)   r     1 FWHDR


   Procedure DCINIT requires 123 words for executable code.
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:138  
   Procedure DCINIT requires 10 words of local(AUTO) storage.
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:139  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:140  
          MINI XREF LISTING

CSOC
      1365**DCL      1421--ASSIGN
DCCNT
      1408**DCL      1416<<ASSIGN   1446<<ASSIGN   1446>>ASSIGN   1447>>IF
DCCSOD1
      1367**DCL      1422--ASSIGN
DCINIT0
      1418**LABEL    1447--GOTO
DCINIT1
      1446**LABEL    1428--GOTO     1438--GOTO
DCI_ZONE
      1381**DCL      1425--CALL     1435--CALL
DCI_ZONE.BDCW.H2
      1394**DCL      1423<<ASSIGN   1433<<ASSIGN
DCI_ZONE.DCW
      1388**DCL      1392--REDEF    1395--REDEF    1396--REDEF
DCI_ZONE.DCW$
      1395**DCL      1422<<ASSIGN   1432<<ASSIGN
DCI_ZONE.IDCW$
      1387**DCL      1421<<ASSIGN   1431<<ASSIGN
DCI_ZONE.TDCW.TYPE
      1399**DCL      1424<<ASSIGN   1434<<ASSIGN
DCI_ZONE.W1
      1382**DCL      1387--REDEF
DCMMOD1
      1368**DCL      1432--ASSIGN
DEVINFO.BSTAT.W1
      1336**DCL      1428>>IF       1438>>IF
DEVINFO.DEV#
      1296**DCL      1414>>ASSIGN   1415<<ASSIGN   1441<<ASSIGN   1450<<ASSIGN
DEVINFO.PCWS
      1299**DCL      1310--REDEF
PL6.E3A0      #007=DCINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:141  
DEVINFO.RPM_PTRS.EF_DCWS$
      1312**DCL      1313--REDEF
DEVINFO.STATUS
      1316**DCL      1335--REDEF
DOIOX
      1405**DCL-ENT  1425--CALL     1435--CALL
FWHDR.FWNAME
      1359**DCL      1419>>IF       1426>>IF       1436>>IF
FWHDR$
      1361**DCL      1353--IMP-PTR  1419>>IF       1426>>IF       1436>>IF
I
      1410**DCL      1442<<DOINDEX
IPCW_PL6
      1404**DCL-ENT  1418--CALL
MMOC
      1366**DCL      1431--ASSIGN
ORDBFLG.RC
      1363**DCL      1412>>IF
SAVE_DEV
      1409**DCL      1414<<ASSIGN   1441>>ASSIGN   1450>>ASSIGN
SYS_DPX
      1369**DCL      1414>>ASSIGN   1415>>ASSIGN   1418<>CALL     1425<>CALL     1428>>IF       1435<>CALL
      1438>>IF       1441>>ASSIGN   1450>>ASSIGN
WT_TIME
      1406**DCL-ENT  1419--CALL     1426--CALL     1436--CALL

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:142  
      653        1        /*T***********************************************************/
      654        2        /*T*                                                         */
      655        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      656        4        /*T*                                                         */
      657        5        /*T***********************************************************/
      658        6        URINIT: PROC(INDX) ALTRET;
      659        7    1   DCL INDX UBIN WORD;
      660        8        %INCLUDE IS$MACROS;
      661     1283        %DEVINFO(STCLASS="SYMREF");
      662     1352        %FWHDR;
      663     1361    1   DCL FWHDR$ PTR SYMREF;
      664     1362        %DOIO_COMZONE(NAME=URI_ZONE);
      665     1395    1   DCL RCV_FLG BIT(4) SYMREF;
      666     1396    1   DCL S1000_FLG BIT(1) SYMREF;
      667     1397    1   DCL RPM_FLG BIT(1) SYMREF;
      668     1398    1   DCL EURC_FLG BIT(1) SYMREF;
      669     1399    1   DCL CSOC BIT(36) SYMREF;
      670     1400    1   DCL MMOC BIT(36) SYMREF;
      671     1401    1   DCL URCSOD1 BIT(36) SYMREF;
      672     1402    1   DCL URMMOD1 BIT(36) SYMREF;
      673     1403    1   DCL LDFWC BIT(36) SYMREF;
      674     1404    1   DCL LDFWD UBIN(18) SYMREF;
      675     1405    1   DCL CDFWD UBIN(18) SYMREF;
      676     1406    1   DCL EFMC BIT(36) SYMREF;
      677     1407    1   DCL TPUR_FLG BIT(1) SYMREF;
      678     1408    1   DCL URCHN UBIN WORD SYMREF;
      679     1409    1   DCL RELDEV BIT(36) SYMREF;
      680     1410        /**/
      681     1411    1   DCL DOIOX ENTRY(4);
      682     1412    1   DCL IPCW_PL6 ENTRY(1);
      683     1413        /**/
      684     1414    1   DCL DEVA(0:35) BIT(1) BASED(APFW$) UNAL; /* Device assignment in control word */
      685     1415        %PTR_STRUCT(NAME=APFW_PTR);
      686     1433    1   DCL APFW$ REDEF APFW_PTR PTR;
      687     1434    1   DCL I UBIN WORD;
      688     1435    1   DCL SAVE_DEV UBIN(6);
      689     1436        /**/
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:143  
      690     1437    1           IF RCV_FLG~='0'B THEN RETURN;   /* Recovery,UR-MPC is already running */
      691     1438    1           IF S1000_FLG THEN RETURN;       /* S1000 or RPM                       */
      692     1439    1             ELSE;
      693     1440    1           SAVE_DEV=DEVINFO.DEV#(INDX);
      694     1441    1           DEVINFO.DEV#(INDX)=0;
      695     1442    1           CALL IPCW_PL6(INDX);
      696     1443    1           IF EURC_FLG='1'B THEN GOTO URINITB1; /* Check if EURC by trying RELDEV */
      697     1444    1             ELSE;
      698     1445        /* Build DOIO comzone */
      699     1446    1           URI_ZONE.IDCW$=ADDR(CSOC);
      700     1447    1           URI_ZONE.DCW$=ADDR(URCSOD1);
      701     1448    1           URI_ZONE.BDCW.H2='0'B;
      702     1449    1           URI_ZONE.TDCW.TYPE='10'B;
      703     1450    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);
      704     1451    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;
      705     1452    1             ELSE;
      706     1453    1           URI_ZONE.IDCW$=ADDR(MMOC);
      707     1454    1           URI_ZONE.DCW$=ADDR(URMMOD1);
      708     1455    1           URI_ZONE.BDCW.H2='0'B;
      709     1456    1           URI_ZONE.TDCW.TYPE='10'B;
      710     1457    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);
      711     1458    2           DO I=0 TO 36000;                /* Wait                               */
      712     1459    2           END;                            /* DO I=                              */
      713     1460    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;
      714     1461    1             ELSE;
      715     1462    1   URINITL:
      716     1463        /* Build device assignment */
      717     1464    1           APFW_PTR.WOFFS=LDFWD;           /* Address of printer firmware        */
      718     1465    1           DEVA='0'B;
      719     1466    1           IF TPUR_FLG='0'B THEN DEVA(DEVINFO.CHN#(%FRSTLP)-URCHN+1)='1'B;
              1466                    /* Use ports 1-8 */
      720     1467    1             ELSE DEVA(DEVINFO.CHN#(%FRSTLP)-URCHN+5)='1'B; /* Use ports 5-8     */
      721     1468        /* Write LP firmware */
      722     1469    1           URI_ZONE.IDCW$=ADDR(LDFWC);
      723     1470    1           URI_ZONE.DCW$=ADDR(LDFWD);
      724     1471    1           URI_ZONE.BDCW.H2='0'B;
      725     1472    1           URI_ZONE.TDCW.TYPE='10'B;
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:144  
      726     1473    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);
      727     1474    2           DO I=0 TO 30000;                /* Wait                               */
      728     1475    2           END;                            /* DO                                 */
      729     1476    1           IF DEVINFO.STATUS.TBIT(INDX)='0'B THEN GOTO URINITC; /* Time_out      */
      730     1477    1             ELSE;
      731     1478    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;
      732     1479    1             ELSE;
      733     1480    2           DO I=%FRSTLP TO %(FRSTCR-1);    /* Mark printers working              */
      734     1481    2             DEVINFO.BITS(I)='0'B;
      735     1482    2           END;                            /* DO I=                              */
      736     1483        /* Build card reader device assignment */
      737     1484    1           APFW_PTR.WOFFS=CDFWD;           /* Address of card reader firmware    */
      738     1485    1           DEVA='0'B;
      739     1486    1           IF TPUR_FLG='0'B THEN DEVA(DEVINFO.CHN#(%FRSTCR)-URCHN+1)='1'B;
              1486                    /* Use ports 1-8 */
      740     1487    1             ELSE DEVA(DEVINFO.CHN#(%FRSTCR)-URCHN+5)='1'B; /* Use ports 5-8     */
      741     1488        /* Write CR firmware */
      742     1489    1           URI_ZONE.IDCW$=ADDR(LDFWC);
      743     1490    1           URI_ZONE.DCW$=ADDR(CDFWD);
      744     1491    1           URI_ZONE.BDCW.H2='0'B;
      745     1492    1           URI_ZONE.TDCW.TYPE='10'B;
      746     1493    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);
      747     1494    2           DO I=0 TO 30000;                /* Wait                               */
      748     1495    2           END;                            /* DO                                 */
      749     1496    1           IF DEVINFO.STATUS.TBIT(INDX)='0'B THEN GOTO URINITD; /* Time_out      */
      750     1497    1             ELSE;
      751     1498    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;
      752     1499    1             ELSE;
      753     1500    2           DO I=%FRSTCR TO %(FRSTMT-1);    /* Mark card readers working          */
      754     1501    2             DEVINFO.BITS(I)='0'B;
      755     1502    2           END;                            /* DO I=                              */
      756     1503    1   URINITE:
      757     1504    1           URI_ZONE.IDCW$=ADDR(EFMC);      /* Enter firmware command             */
      758     1505    1           URI_ZONE.DCW='0'B;              /* No DCW                             */
      759     1506    1           CALL DOIOX(INDX,ADDR(URI_ZONE));
      760     1507    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)='450002'O THEN GOTO ALRUNN;
              1507                    /* Already running */
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:145  
      761     1508    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;
      762     1509    1             ELSE;
      763     1510    1   ALRUNN:
      764     1511    1           DEVINFO.DEV#(INDX)=SAVE_DEV;
      765     1512    1           RETURN;
      766     1513    1   URINITB1:
      767     1514        /* Try release device with timeout */
      768     1515    1           URI_ZONE.IDCW$=ADDR(RELDEV);
      769     1516    1           URI_ZONE.DCW='0'B;
      770     1517    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);
      771     1518    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)='450002'O THEN GOTO ALRUNN;
              1518                    /* Command reject-> EURC */
      772     1519    1             ELSE;
      773     1520    1   URINIT1:
      774     1521    1           DEVINFO.DEV#(INDX)=SAVE_DEV;
      775     1522    1           ALTRETURN;                      /* Couldn't initialize                */
      776     1523    1   URINITC:
      777     1524    2           DO I=%FRSTLP TO %(FRSTCR-1);
      778     1525    2             DEVINFO.BITS(I)='1'B;
      779     1526    2           END;                            /* DO I=                              */
      780     1527    1           GOTO URINITL;
      781     1528    1   URINITD:
      782     1529    2           DO I=%FRSTCR TO %(FRSTMT-1);
      783     1530    2             DEVINFO.BITS(I)='1'B;
      784     1531    2           END;                            /* DO I=                              */
      785     1532    1           GOTO URINITE;
      786     1533    1   END URINIT;
      787     1534        %EOD;

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:146  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure URINIT.

   Procedure URINIT requires 357 words for executable code.
   Procedure URINIT requires 10 words of local(AUTO) storage.

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:147  

 Object Unit name= URINIT                                     File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:28.92 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     3      3  URINIT
    1  RoData even  UTS      1      1  URINIT
    2   Proc  even  none   357    545  URINIT
    3  RoData even  none    14     16  URINIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  URINIT

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  URI_ZONE                           0      2  APFW_PTR

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 IPCW_PL6
         yes           Std       4 DOIOX
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:148  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     DEVINFO                               FWHDR$                                RCV_FLG
     S1000_FLG                             EURC_FLG                              CSOC
     MMOC                                  URCSOD1                               URMMOD1
     LDFWC                                 LDFWD                                 CDFWD
     EFMC                                  TPUR_FLG                              URCHN
     RELDEV                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:149  


      653        1        /*T***********************************************************/
      654        2        /*T*                                                         */
      655        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      656        4        /*T*                                                         */
      657        5        /*T***********************************************************/
      658        6        URINIT: PROC(INDX) ALTRET;

      6  2 000000   000000 700200 xent  URINIT       TSX0  ! X66_AUTO_1
         2 000001   000012 000001                    ZERO    10,1

      659        7    1   DCL INDX UBIN WORD;
      660        8        %INCLUDE IS$MACROS;
      661     1283        %DEVINFO(STCLASS="SYMREF");
      662     1352        %FWHDR;
      663     1361    1   DCL FWHDR$ PTR SYMREF;
      664     1362        %DOIO_COMZONE(NAME=URI_ZONE);
      665     1395    1   DCL RCV_FLG BIT(4) SYMREF;
      666     1396    1   DCL S1000_FLG BIT(1) SYMREF;
      667     1397    1   DCL RPM_FLG BIT(1) SYMREF;
      668     1398    1   DCL EURC_FLG BIT(1) SYMREF;
      669     1399    1   DCL CSOC BIT(36) SYMREF;
      670     1400    1   DCL MMOC BIT(36) SYMREF;
      671     1401    1   DCL URCSOD1 BIT(36) SYMREF;
      672     1402    1   DCL URMMOD1 BIT(36) SYMREF;
      673     1403    1   DCL LDFWC BIT(36) SYMREF;
      674     1404    1   DCL LDFWD UBIN(18) SYMREF;
      675     1405    1   DCL CDFWD UBIN(18) SYMREF;
      676     1406    1   DCL EFMC BIT(36) SYMREF;
      677     1407    1   DCL TPUR_FLG BIT(1) SYMREF;
      678     1408    1   DCL URCHN UBIN WORD SYMREF;
      679     1409    1   DCL RELDEV BIT(36) SYMREF;
      680     1410        /**/
      681     1411    1   DCL DOIOX ENTRY(4);
      682     1412    1   DCL IPCW_PL6 ENTRY(1);
      683     1413        /**/
      684     1414    1   DCL DEVA(0:35) BIT(1) BASED(APFW$) UNAL; /* Device assignment in control word */
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:150  
      685     1415        %PTR_STRUCT(NAME=APFW_PTR);
      686     1433    1   DCL APFW$ REDEF APFW_PTR PTR;
      687     1434    1   DCL I UBIN WORD;
      688     1435    1   DCL SAVE_DEV UBIN(6);
      689     1436        /**/
      690     1437    1           IF RCV_FLG~='0'B THEN RETURN;   /* Recovery,UR-MPC is already running */

   1437  2 000002   000000 236000 xsym               LDQ     RCV_FLG
         2 000003   740000 316003                    CANQ    -16384,DU
         2 000004   000006 600000 2                  TZE     s:1438

   1437  2 000005   000000 702200 xent               TSX2  ! X66_ARET

      691     1438    1           IF S1000_FLG THEN RETURN;       /* S1000 or RPM                       */

   1438  2 000006   000000 234000 xsym               SZN     S1000_FLG
         2 000007   000011 605000 2                  TPL     s:1440

   1438  2 000010   000000 702200 xent               TSX2  ! X66_ARET

      692     1439    1             ELSE;
      693     1440    1           SAVE_DEV=DEVINFO.DEV#(INDX);

   1440  2 000011   200003 470500                    LDP0    @INDX,,AUTO
         2 000012   000000 236100                    LDQ     0,,PR0
         2 000013   000006 402007                    MPY     6,DL
         2 000014   000001 736000                    QLS     1
         2 000015   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000016   000025 772000                    QRL     21
         2 000017   000077 376007                    ANQ     63,DL
         2 000020   000036 736000                    QLS     30
         2 000021   200005 756100                    STQ     SAVE_DEV,,AUTO

      694     1441    1           DEVINFO.DEV#(INDX)=0;

   1441  2 000022   000000 236100                    LDQ     0,,PR0
         2 000023   000006 402007                    MPY     6,DL
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:151  
         2 000024   000001 736000                    QLS     1
         2 000025   000000 620006                    EAX0    0,QL
         2 000026   000000 236000 3                  LDQ     0
         2 000027   000000 356010 xsym               ANSQ    DEVINFO,X0

      695     1442    1           CALL IPCW_PL6(INDX);

   1442  2 000030   200003 630500                    EPPR0   @INDX,,AUTO
         2 000031   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000032   000000 701000 xent               TSX1    IPCW_PL6
         2 000033   000000 011000                    NOP     0

      696     1443    1           IF EURC_FLG='1'B THEN GOTO URINITB1; /* Check if EURC by trying RELDEV */

   1443  2 000034   000000 234000 xsym               SZN     EURC_FLG
         2 000035   000451 604000 2                  TMI     URINITB1

      697     1444    1             ELSE;
      698     1445        /* Build DOIO comzone */
      699     1446    1           URI_ZONE.IDCW$=ADDR(CSOC);

   1446  2 000036   000001 236000 3                  LDQ     1
         2 000037   000000 756000 0                  STQ     URI_ZONE

      700     1447    1           URI_ZONE.DCW$=ADDR(URCSOD1);

   1447  2 000040   000002 236000 3                  LDQ     2
         2 000041   000001 756000 0                  STQ     URI_ZONE+1

      701     1448    1           URI_ZONE.BDCW.H2='0'B;

   1448  2 000042   000000 220003                    LDX0    0,DU
         2 000043   000001 440000 0                  SXL0    URI_ZONE+1

      702     1449    1           URI_ZONE.TDCW.TYPE='10'B;

   1449  2 000044   000001 236000 0                  LDQ     URI_ZONE+1
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:152  
         2 000045   000003 376000 3                  ANQ     3
         2 000046   020000 276007                    ORQ     8192,DL
         2 000047   000001 756000 0                  STQ     URI_ZONE+1

      703     1450    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);

   1450  2 000050   000004 236000 3                  LDQ     4
         2 000051   200006 756100                    STQ     SAVE_DEV+1,,AUTO
         2 000052   000006 236000 3                  LDQ     6
         2 000053   200011 756100                    STQ     SAVE_DEV+4,,AUTO
         2 000054   200006 630500                    EPPR0   SAVE_DEV+1,,AUTO
         2 000055   200010 450500                    STP0    SAVE_DEV+3,,AUTO
         2 000056   200003 236100                    LDQ     @INDX,,AUTO
         2 000057   200007 756100                    STQ     SAVE_DEV+2,,AUTO
         2 000060   200007 630500                    EPPR0   SAVE_DEV+2,,AUTO
         2 000061   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000062   000000 701000 xent               TSX1    DOIOX
         2 000063   000000 011000                    NOP     0

      704     1451    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;

   1451  2 000064   200003 470500                    LDP0    @INDX,,AUTO
         2 000065   000000 236100                    LDQ     0,,PR0
         2 000066   000006 402007                    MPY     6,DL
         2 000067   000001 736000                    QLS     1
         2 000070   000000 620006                    EAX0    0,QL
         2 000071   000000 236000 1                  LDQ     0
         2 000072   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000073   400000 116003                    CMPQ    -131072,DU
         2 000074   000501 601000 2                  TNZ     URINIT1

      705     1452    1             ELSE;
      706     1453    1           URI_ZONE.IDCW$=ADDR(MMOC);

   1453  2 000075   000007 236000 3                  LDQ     7
         2 000076   000000 756000 0                  STQ     URI_ZONE

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:153  
      707     1454    1           URI_ZONE.DCW$=ADDR(URMMOD1);

   1454  2 000077   000010 236000 3                  LDQ     8
         2 000100   000001 756000 0                  STQ     URI_ZONE+1

      708     1455    1           URI_ZONE.BDCW.H2='0'B;

   1455  2 000101   000000 220003                    LDX0    0,DU
         2 000102   000001 440000 0                  SXL0    URI_ZONE+1

      709     1456    1           URI_ZONE.TDCW.TYPE='10'B;

   1456  2 000103   000001 236000 0                  LDQ     URI_ZONE+1
         2 000104   000003 376000 3                  ANQ     3
         2 000105   020000 276007                    ORQ     8192,DL
         2 000106   000001 756000 0                  STQ     URI_ZONE+1

      710     1457    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);

   1457  2 000107   000004 236000 3                  LDQ     4
         2 000110   200006 756100                    STQ     SAVE_DEV+1,,AUTO
         2 000111   000006 236000 3                  LDQ     6
         2 000112   200011 756100                    STQ     SAVE_DEV+4,,AUTO
         2 000113   200006 631500                    EPPR1   SAVE_DEV+1,,AUTO
         2 000114   200010 451500                    STP1    SAVE_DEV+3,,AUTO
         2 000115   200003 236100                    LDQ     @INDX,,AUTO
         2 000116   200007 756100                    STQ     SAVE_DEV+2,,AUTO
         2 000117   200007 630500                    EPPR0   SAVE_DEV+2,,AUTO
         2 000120   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000121   000000 701000 xent               TSX1    DOIOX
         2 000122   000000 011000                    NOP     0

      711     1458    2           DO I=0 TO 36000;                /* Wait                               */

   1458  2 000123   200004 450100                    STZ     I,,AUTO

      712     1459    2           END;                            /* DO I=                              */
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:154  

   1459  2 000124   200004 235100                    LDA     I,,AUTO
         2 000125   000001 035007                    ADLA    1,DL
         2 000126   200004 755100                    STA     I,,AUTO
         2 000127   106241 115007                    CMPA    36001,DL
         2 000130   000124 602000 2                  TNC     s:1459

      713     1460    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;

   1460  2 000131   200003 470500                    LDP0    @INDX,,AUTO
         2 000132   000000 236100                    LDQ     0,,PR0
         2 000133   000006 402007                    MPY     6,DL
         2 000134   000001 736000                    QLS     1
         2 000135   000000 620006                    EAX0    0,QL
         2 000136   000000 236000 1                  LDQ     0
         2 000137   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000140   400000 116003                    CMPQ    -131072,DU
         2 000141   000501 601000 2                  TNZ     URINIT1

      714     1461    1             ELSE;
      715     1462    1   URINITL:
      716     1463        /* Build device assignment */
      717     1464    1           APFW_PTR.WOFFS=LDFWD;           /* Address of printer firmware        */

   1464  2 000142   000000 220000 xsym  URINITL      LDX0    LDFWD
         2 000143   000002 740000 0                  STX0    APFW_PTR

      718     1465    1           DEVA='0'B;

   1465  2 000144   000002 470400 0                  LDP0    APFW_PTR
         2 000145   003100 060400                    CSL     bolr='003'O
         2 000146   000002 000011 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=9
         2 000147   000000 000044                    BDSC    0,,PR0                   by=0,bit=0,n=36

      719     1466    1           IF TPUR_FLG='0'B THEN DEVA(DEVINFO.CHN#(%FRSTLP)-URCHN+1)='1'B;
              1466                    /* Use ports 1-8 */

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:155  
   1466  2 000150   000000 234000 xsym               SZN     TPUR_FLG
         2 000151   000164 604000 2                  TMI     s:1467

   1466  2 000152   000014 236000 xsym               LDQ     DEVINFO+12
         2 000153   000033 772000                    QRL     27
         2 000154   000000 136000 xsym               SBLQ    URCHN
         2 000155   000157 605000 2                  TPL     s:1466+7
         2 000156   000044 036003                    ADLQ    36,DU
         2 000157   000002 470400 0                  LDP0    APFW_PTR
         2 000160   003106 060400                    CSL     bolr='003'O
         2 000161   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         2 000162   000000 010001                    BDSC    0,Q,PR0                  by=0,bit=1,n=1
         2 000163   000175 710000 2                  TRA     s:1469

      720     1467    1             ELSE DEVA(DEVINFO.CHN#(%FRSTLP)-URCHN+5)='1'B; /* Use ports 5-8     */

   1467  2 000164   000014 236000 xsym               LDQ     DEVINFO+12
         2 000165   000033 772000                    QRL     27
         2 000166   000000 136000 xsym               SBLQ    URCHN
         2 000167   000171 605000 2                  TPL     s:1467+5
         2 000170   000044 036003                    ADLQ    36,DU
         2 000171   000002 470400 0                  LDP0    APFW_PTR
         2 000172   003106 060400                    CSL     bolr='003'O
         2 000173   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         2 000174   000000 050001                    BDSC    0,Q,PR0                  by=0,bit=5,n=1

      721     1468        /* Write LP firmware */
      722     1469    1           URI_ZONE.IDCW$=ADDR(LDFWC);

   1469  2 000175   000011 236000 3                  LDQ     9
         2 000176   000000 756000 0                  STQ     URI_ZONE

      723     1470    1           URI_ZONE.DCW$=ADDR(LDFWD);

   1470  2 000177   000012 236000 3                  LDQ     10
         2 000200   000001 756000 0                  STQ     URI_ZONE+1

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:156  
      724     1471    1           URI_ZONE.BDCW.H2='0'B;

   1471  2 000201   000000 220003                    LDX0    0,DU
         2 000202   000001 440000 0                  SXL0    URI_ZONE+1

      725     1472    1           URI_ZONE.TDCW.TYPE='10'B;

   1472  2 000203   000001 236000 0                  LDQ     URI_ZONE+1
         2 000204   000003 376000 3                  ANQ     3
         2 000205   020000 276007                    ORQ     8192,DL
         2 000206   000001 756000 0                  STQ     URI_ZONE+1

      726     1473    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);

   1473  2 000207   000004 236000 3                  LDQ     4
         2 000210   200006 756100                    STQ     SAVE_DEV+1,,AUTO
         2 000211   000006 236000 3                  LDQ     6
         2 000212   200011 756100                    STQ     SAVE_DEV+4,,AUTO
         2 000213   200006 630500                    EPPR0   SAVE_DEV+1,,AUTO
         2 000214   200010 450500                    STP0    SAVE_DEV+3,,AUTO
         2 000215   200003 236100                    LDQ     @INDX,,AUTO
         2 000216   200007 756100                    STQ     SAVE_DEV+2,,AUTO
         2 000217   200007 630500                    EPPR0   SAVE_DEV+2,,AUTO
         2 000220   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000221   000000 701000 xent               TSX1    DOIOX
         2 000222   000000 011000                    NOP     0

      727     1474    2           DO I=0 TO 30000;                /* Wait                               */

   1474  2 000223   200004 450100                    STZ     I,,AUTO

      728     1475    2           END;                            /* DO                                 */

   1475  2 000224   200004 235100                    LDA     I,,AUTO
         2 000225   000001 035007                    ADLA    1,DL
         2 000226   200004 755100                    STA     I,,AUTO
         2 000227   072461 115007                    CMPA    30001,DL
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:157  
         2 000230   000224 602000 2                  TNC     s:1475

      729     1476    1           IF DEVINFO.STATUS.TBIT(INDX)='0'B THEN GOTO URINITC; /* Time_out      */

   1476  2 000231   200003 470500                    LDP0    @INDX,,AUTO
         2 000232   000000 236100                    LDQ     0,,PR0
         2 000233   000006 402007                    MPY     6,DL
         2 000234   000001 736000                    QLS     1
         2 000235   000004 234006 xsym               SZN     DEVINFO+4,QL
         2 000236   000513 605000 2                  TPL     URINITC

      730     1477    1             ELSE;
      731     1478    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;

   1478  2 000237   000000 236100                    LDQ     0,,PR0
         2 000240   000006 402007                    MPY     6,DL
         2 000241   000001 736000                    QLS     1
         2 000242   000000 620006                    EAX0    0,QL
         2 000243   000000 236000 1                  LDQ     0
         2 000244   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000245   400000 116003                    CMPQ    -131072,DU
         2 000246   000501 601000 2                  TNZ     URINIT1

      732     1479    1             ELSE;
      733     1480    2           DO I=%FRSTLP TO %(FRSTCR-1);    /* Mark printers working              */

   1480  2 000247   000001 235007                    LDA     1,DL
         2 000250   200004 755100                    STA     I,,AUTO

      734     1481    2             DEVINFO.BITS(I)='0'B;

   1481  2 000251   200004 236100                    LDQ     I,,AUTO
         2 000252   000014 402007                    MPY     12,DL
         2 000253   000001 450006 xsym               STZ     DEVINFO+1,QL

      735     1482    2           END;                            /* DO I=                              */

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:158  
   1482  2 000254   200004 235100                    LDA     I,,AUTO
         2 000255   000001 035007                    ADLA    1,DL
         2 000256   200004 755100                    STA     I,,AUTO
         2 000257   000002 115007                    CMPA    2,DL
         2 000260   000251 602000 2                  TNC     s:1481

      736     1483        /* Build card reader device assignment */
      737     1484    1           APFW_PTR.WOFFS=CDFWD;           /* Address of card reader firmware    */

   1484  2 000261   000000 220000 xsym               LDX0    CDFWD
         2 000262   000002 740000 0                  STX0    APFW_PTR

      738     1485    1           DEVA='0'B;

   1485  2 000263   000002 470400 0                  LDP0    APFW_PTR
         2 000264   003100 060400                    CSL     bolr='003'O
         2 000265   000002 000011 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=9
         2 000266   000000 000044                    BDSC    0,,PR0                   by=0,bit=0,n=36

      739     1486    1           IF TPUR_FLG='0'B THEN DEVA(DEVINFO.CHN#(%FRSTCR)-URCHN+1)='1'B;
              1486                    /* Use ports 1-8 */

   1486  2 000267   000000 234000 xsym               SZN     TPUR_FLG
         2 000270   000303 604000 2                  TMI     s:1487

   1486  2 000271   000030 236000 xsym               LDQ     DEVINFO+24
         2 000272   000033 772000                    QRL     27
         2 000273   000000 136000 xsym               SBLQ    URCHN
         2 000274   000276 605000 2                  TPL     s:1486+7
         2 000275   000044 036003                    ADLQ    36,DU
         2 000276   000002 470400 0                  LDP0    APFW_PTR
         2 000277   003106 060400                    CSL     bolr='003'O
         2 000300   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         2 000301   000000 010001                    BDSC    0,Q,PR0                  by=0,bit=1,n=1
         2 000302   000314 710000 2                  TRA     s:1489

      740     1487    1             ELSE DEVA(DEVINFO.CHN#(%FRSTCR)-URCHN+5)='1'B; /* Use ports 5-8     */
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:159  

   1487  2 000303   000030 236000 xsym               LDQ     DEVINFO+24
         2 000304   000033 772000                    QRL     27
         2 000305   000000 136000 xsym               SBLQ    URCHN
         2 000306   000310 605000 2                  TPL     s:1487+5
         2 000307   000044 036003                    ADLQ    36,DU
         2 000310   000002 470400 0                  LDP0    APFW_PTR
         2 000311   003106 060400                    CSL     bolr='003'O
         2 000312   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         2 000313   000000 050001                    BDSC    0,Q,PR0                  by=0,bit=5,n=1

      741     1488        /* Write CR firmware */
      742     1489    1           URI_ZONE.IDCW$=ADDR(LDFWC);

   1489  2 000314   000011 236000 3                  LDQ     9
         2 000315   000000 756000 0                  STQ     URI_ZONE

      743     1490    1           URI_ZONE.DCW$=ADDR(CDFWD);

   1490  2 000316   000013 236000 3                  LDQ     11
         2 000317   000001 756000 0                  STQ     URI_ZONE+1

      744     1491    1           URI_ZONE.BDCW.H2='0'B;

   1491  2 000320   000000 220003                    LDX0    0,DU
         2 000321   000001 440000 0                  SXL0    URI_ZONE+1

      745     1492    1           URI_ZONE.TDCW.TYPE='10'B;

   1492  2 000322   000001 236000 0                  LDQ     URI_ZONE+1
         2 000323   000003 376000 3                  ANQ     3
         2 000324   020000 276007                    ORQ     8192,DL
         2 000325   000001 756000 0                  STQ     URI_ZONE+1

      746     1493    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);

   1493  2 000326   000004 236000 3                  LDQ     4
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:160  
         2 000327   200006 756100                    STQ     SAVE_DEV+1,,AUTO
         2 000330   000006 236000 3                  LDQ     6
         2 000331   200011 756100                    STQ     SAVE_DEV+4,,AUTO
         2 000332   200006 630500                    EPPR0   SAVE_DEV+1,,AUTO
         2 000333   200010 450500                    STP0    SAVE_DEV+3,,AUTO
         2 000334   200003 236100                    LDQ     @INDX,,AUTO
         2 000335   200007 756100                    STQ     SAVE_DEV+2,,AUTO
         2 000336   200007 630500                    EPPR0   SAVE_DEV+2,,AUTO
         2 000337   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000340   000000 701000 xent               TSX1    DOIOX
         2 000341   000000 011000                    NOP     0

      747     1494    2           DO I=0 TO 30000;                /* Wait                               */

   1494  2 000342   200004 450100                    STZ     I,,AUTO

      748     1495    2           END;                            /* DO                                 */

   1495  2 000343   200004 235100                    LDA     I,,AUTO
         2 000344   000001 035007                    ADLA    1,DL
         2 000345   200004 755100                    STA     I,,AUTO
         2 000346   072461 115007                    CMPA    30001,DL
         2 000347   000343 602000 2                  TNC     s:1495

      749     1496    1           IF DEVINFO.STATUS.TBIT(INDX)='0'B THEN GOTO URINITD; /* Time_out      */

   1496  2 000350   200003 470500                    LDP0    @INDX,,AUTO
         2 000351   000000 236100                    LDQ     0,,PR0
         2 000352   000006 402007                    MPY     6,DL
         2 000353   000001 736000                    QLS     1
         2 000354   000004 234006 xsym               SZN     DEVINFO+4,QL
         2 000355   000530 605000 2                  TPL     URINITD

      750     1497    1             ELSE;
      751     1498    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;

   1498  2 000356   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:161  
         2 000357   000006 402007                    MPY     6,DL
         2 000360   000001 736000                    QLS     1
         2 000361   000000 620006                    EAX0    0,QL
         2 000362   000000 236000 1                  LDQ     0
         2 000363   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000364   400000 116003                    CMPQ    -131072,DU
         2 000365   000501 601000 2                  TNZ     URINIT1

      752     1499    1             ELSE;
      753     1500    2           DO I=%FRSTCR TO %(FRSTMT-1);    /* Mark card readers working          */

   1500  2 000366   000002 235007                    LDA     2,DL
         2 000367   200004 755100                    STA     I,,AUTO

      754     1501    2             DEVINFO.BITS(I)='0'B;

   1501  2 000370   200004 236100                    LDQ     I,,AUTO
         2 000371   000014 402007                    MPY     12,DL
         2 000372   000001 450006 xsym               STZ     DEVINFO+1,QL

      755     1502    2           END;                            /* DO I=                              */

   1502  2 000373   200004 235100                    LDA     I,,AUTO
         2 000374   000001 035007                    ADLA    1,DL
         2 000375   200004 755100                    STA     I,,AUTO
         2 000376   000003 115007                    CMPA    3,DL
         2 000377   000370 602000 2                  TNC     s:1501

      756     1503    1   URINITE:
      757     1504    1           URI_ZONE.IDCW$=ADDR(EFMC);      /* Enter firmware command             */

   1504  2 000400   000014 236000 3     URINITE      LDQ     12
         2 000401   000000 756000 0                  STQ     URI_ZONE

      758     1505    1           URI_ZONE.DCW='0'B;              /* No DCW                             */

   1505  2 000402   000001 450000 0                  STZ     URI_ZONE+1
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:162  

      759     1506    1           CALL DOIOX(INDX,ADDR(URI_ZONE));

   1506  2 000403   000004 236000 3                  LDQ     4
         2 000404   200006 756100                    STQ     SAVE_DEV+1,,AUTO
         2 000405   200006 630500                    EPPR0   SAVE_DEV+1,,AUTO
         2 000406   200011 450500                    STP0    SAVE_DEV+4,,AUTO
         2 000407   200003 236100                    LDQ     @INDX,,AUTO
         2 000410   200010 756100                    STQ     SAVE_DEV+3,,AUTO
         2 000411   200010 630500                    EPPR0   SAVE_DEV+3,,AUTO
         2 000412   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000413   000000 701000 xent               TSX1    DOIOX
         2 000414   000000 011000                    NOP     0

      760     1507    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)='450002'O THEN GOTO ALRUNN;
              1507                    /* Already running */

   1507  2 000415   200003 470500                    LDP0    @INDX,,AUTO
         2 000416   000000 236100                    LDQ     0,,PR0
         2 000417   000006 402007                    MPY     6,DL
         2 000420   000001 736000                    QLS     1
         2 000421   000000 620006                    EAX0    0,QL
         2 000422   000000 236000 1                  LDQ     0
         2 000423   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000424   450002 116003                    CMPQ    -110590,DU
         2 000425   000436 600000 2                  TZE     ALRUNN

      761     1508    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)~=%TERM_STATUS THEN GOTO URINIT1;

   1508  2 000426   000000 236100                    LDQ     0,,PR0
         2 000427   000006 402007                    MPY     6,DL
         2 000430   000001 736000                    QLS     1
         2 000431   000000 620006                    EAX0    0,QL
         2 000432   000000 236000 1                  LDQ     0
         2 000433   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000434   400000 116003                    CMPQ    -131072,DU
         2 000435   000501 601000 2                  TNZ     URINIT1
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:163  

      762     1509    1             ELSE;
      763     1510    1   ALRUNN:
      764     1511    1           DEVINFO.DEV#(INDX)=SAVE_DEV;

   1511  2 000436   200003 470500       ALRUNN       LDP0    @INDX,,AUTO
         2 000437   000000 236100                    LDQ     0,,PR0
         2 000440   000006 402007                    MPY     6,DL
         2 000441   000001 736000                    QLS     1
         2 000442   000000 620006                    EAX0    0,QL
         2 000443   200005 236100                    LDQ     SAVE_DEV,,AUTO
         2 000444   000011 772000                    QRL     9
         2 000445   000000 676010 xsym               ERQ     DEVINFO,X0
         2 000446   000770 376003                    ANQ     504,DU
         2 000447   000000 656010 xsym               ERSQ    DEVINFO,X0

      765     1512    1           RETURN;

   1512  2 000450   000000 702200 xent               TSX2  ! X66_ARET

      766     1513    1   URINITB1:
      767     1514        /* Try release device with timeout */
      768     1515    1           URI_ZONE.IDCW$=ADDR(RELDEV);

   1515  2 000451   000015 236000 3     URINITB1     LDQ     13
         2 000452   000000 756000 0                  STQ     URI_ZONE

      769     1516    1           URI_ZONE.DCW='0'B;

   1516  2 000453   000001 450000 0                  STZ     URI_ZONE+1

      770     1517    1           CALL DOIOX(INDX,ADDR(URI_ZONE),70000);

   1517  2 000454   000004 236000 3                  LDQ     4
         2 000455   200006 756100                    STQ     SAVE_DEV+1,,AUTO
         2 000456   000006 236000 3                  LDQ     6
         2 000457   200011 756100                    STQ     SAVE_DEV+4,,AUTO
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:164  
         2 000460   200006 630500                    EPPR0   SAVE_DEV+1,,AUTO
         2 000461   200010 450500                    STP0    SAVE_DEV+3,,AUTO
         2 000462   200003 236100                    LDQ     @INDX,,AUTO
         2 000463   200007 756100                    STQ     SAVE_DEV+2,,AUTO
         2 000464   200007 630500                    EPPR0   SAVE_DEV+2,,AUTO
         2 000465   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000466   000000 701000 xent               TSX1    DOIOX
         2 000467   000000 011000                    NOP     0

      771     1518    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)='450002'O THEN GOTO ALRUNN;
              1518                    /* Command reject-> EURC */

   1518  2 000470   200003 470500                    LDP0    @INDX,,AUTO
         2 000471   000000 236100                    LDQ     0,,PR0
         2 000472   000006 402007                    MPY     6,DL
         2 000473   000001 736000                    QLS     1
         2 000474   000000 620006                    EAX0    0,QL
         2 000475   000000 236000 1                  LDQ     0
         2 000476   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000477   450002 116003                    CMPQ    -110590,DU
         2 000500   000436 600000 2                  TZE     ALRUNN

      772     1519    1             ELSE;
      773     1520    1   URINIT1:
      774     1521    1           DEVINFO.DEV#(INDX)=SAVE_DEV;

   1521  2 000501   000000 236100       URINIT1      LDQ     0,,PR0
         2 000502   000006 402007                    MPY     6,DL
         2 000503   000001 736000                    QLS     1
         2 000504   000000 620006                    EAX0    0,QL
         2 000505   200005 236100                    LDQ     SAVE_DEV,,AUTO
         2 000506   000011 772000                    QRL     9
         2 000507   000000 676010 xsym               ERQ     DEVINFO,X0
         2 000510   000770 376003                    ANQ     504,DU
         2 000511   000000 656010 xsym               ERSQ    DEVINFO,X0

      775     1522    1           ALTRETURN;                      /* Couldn't initialize                */
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:165  

   1522  2 000512   000000 702200 xent               TSX2  ! X66_AALT

      776     1523    1   URINITC:
      777     1524    2           DO I=%FRSTLP TO %(FRSTCR-1);

   1524  2 000513   000001 235007       URINITC      LDA     1,DL
         2 000514   200004 755100                    STA     I,,AUTO

      778     1525    2             DEVINFO.BITS(I)='1'B;

   1525  2 000515   200004 236100                    LDQ     I,,AUTO
         2 000516   000014 402007                    MPY     12,DL
         2 000517   000000 620006                    EAX0    0,QL
         2 000520   400000 236003                    LDQ     -131072,DU
         2 000521   000001 756010 xsym               STQ     DEVINFO+1,X0

      779     1526    2           END;                            /* DO I=                              */

   1526  2 000522   200004 235100                    LDA     I,,AUTO
         2 000523   000001 035007                    ADLA    1,DL
         2 000524   200004 755100                    STA     I,,AUTO
         2 000525   000002 115007                    CMPA    2,DL
         2 000526   000515 602000 2                  TNC     s:1525

      780     1527    1           GOTO URINITL;

   1527  2 000527   000142 710000 2                  TRA     URINITL

      781     1528    1   URINITD:
      782     1529    2           DO I=%FRSTCR TO %(FRSTMT-1);

   1529  2 000530   000002 235007       URINITD      LDA     2,DL
         2 000531   200004 755100                    STA     I,,AUTO

      783     1530    2             DEVINFO.BITS(I)='1'B;

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:166  
   1530  2 000532   200004 236100                    LDQ     I,,AUTO
         2 000533   000014 402007                    MPY     12,DL
         2 000534   000000 620006                    EAX0    0,QL
         2 000535   400000 236003                    LDQ     -131072,DU
         2 000536   000001 756010 xsym               STQ     DEVINFO+1,X0

      784     1531    2           END;                            /* DO I=                              */

   1531  2 000537   200004 235100                    LDA     I,,AUTO
         2 000540   000001 035007                    ADLA    1,DL
         2 000541   200004 755100                    STA     I,,AUTO
         2 000542   000003 115007                    CMPA    3,DL
         2 000543   000532 602000 2                  TNC     s:1530

      785     1532    1           GOTO URINITE;

   1532  2 000544   000400 710000 2                  TRA     URINITE
      786     1533    1   END URINIT;
      787     1534        %EOD;

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:167  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure URINIT.
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:168  

 **** Variables and constants ****

  ****  Section 000  Data  URINIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/w PTR         r     1 APFW$                      2-0-0/w STRC        r     1 APFW_PTR
     0-0-0/w STRC(72)    r     1 URI_ZONE

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @INDX                      4-0-0/w UBIN        r     1 I
    *0-0-0/w UBIN        r     1 INDX                       5-0-0/w UBIN(6)     r     1 SAVE_DEV

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(18)    r     1 CDFWD                      0-0-0/b BIT         r     1 CSOC
     0-0-0/d STRC(396)   r     1 DEVINFO(0:21)              0-0-0/b BIT         r     1 EFMC
     0-0-0/b BIT         r     1 EURC_FLG                   0-0-0/w PTR         r     1 FWHDR$
     0-0-0/b BIT         r     1 LDFWC                      0-0-0/w UBIN(18)    r     1 LDFWD
     0-0-0/b BIT         r     1 MMOC                       0-0-0/b BIT (4)     r     1 RCV_FLG
     0-0-0/b BIT         r     1 RELDEV                     0-0-0/b BIT         r     1 S1000_FLG
     0-0-0/b BIT         r     1 TPUR_FLG                   0-0-0/w UBIN        r     1 URCHN
     0-0-0/b BIT         r     1 URCSOD1                    0-0-0/b BIT         r     1 URMMOD1

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:169  
     0-0-0/b BIT         r     1 DEVA(0:35)


   Procedure URINIT requires 357 words for executable code.
   Procedure URINIT requires 10 words of local(AUTO) storage.
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:170  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:171  
          MINI XREF LISTING

ALRUNN
      1511**LABEL    1507--GOTO     1518--GOTO
APFW$
      1433**DCL      1414--IMP-PTR  1465>>ASSIGN   1466>>ASSIGN   1467>>ASSIGN   1485>>ASSIGN   1486>>ASSIGN
      1487>>ASSIGN
APFW_PTR
      1426**DCL      1433--REDEF
APFW_PTR.WOFFS
      1427**DCL      1464<<ASSIGN   1484<<ASSIGN
CDFWD
      1405**DCL      1484>>ASSIGN   1490--ASSIGN
CSOC
      1399**DCL      1446--ASSIGN
DEVA
      1414**DCL      1465<<ASSIGN   1466<<ASSIGN   1467<<ASSIGN   1485<<ASSIGN   1486<<ASSIGN   1487<<ASSIGN
DEVINFO.BITS
      1298**DCL      1481<<ASSIGN   1501<<ASSIGN   1525<<ASSIGN   1530<<ASSIGN
DEVINFO.BSTAT.W1
      1336**DCL      1451>>IF       1460>>IF       1478>>IF       1498>>IF       1507>>IF       1508>>IF
      1518>>IF
DEVINFO.CHN#
      1295**DCL      1466>>ASSIGN   1467>>ASSIGN   1486>>ASSIGN   1487>>ASSIGN
DEVINFO.DEV#
      1296**DCL      1440>>ASSIGN   1441<<ASSIGN   1511<<ASSIGN   1521<<ASSIGN
DEVINFO.PCWS
      1299**DCL      1310--REDEF
DEVINFO.RPM_PTRS.EF_DCWS$
      1312**DCL      1313--REDEF
DEVINFO.STATUS
      1316**DCL      1335--REDEF
DEVINFO.STATUS.TBIT
      1317**DCL      1476>>IF       1496>>IF
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:172  
DOIOX
      1411**DCL-ENT  1450--CALL     1457--CALL     1473--CALL     1493--CALL     1506--CALL     1517--CALL
EFMC
      1406**DCL      1504--ASSIGN
EURC_FLG
      1398**DCL      1443>>IF
FWHDR$
      1361**DCL      1353--IMP-PTR
I
      1434**DCL      1458<<DOINDEX  1474<<DOINDEX  1480<<DOINDEX  1481>>ASSIGN   1494<<DOINDEX  1500<<DOINDEX
      1501>>ASSIGN   1524<<DOINDEX  1525>>ASSIGN   1529<<DOINDEX  1530>>ASSIGN
INDX
         7**DCL         6--PROC     1440>>ASSIGN   1441>>ASSIGN   1442<>CALL     1450<>CALL     1451>>IF
      1457<>CALL     1460>>IF       1473<>CALL     1476>>IF       1478>>IF       1493<>CALL     1496>>IF
      1498>>IF       1506<>CALL     1507>>IF       1508>>IF       1511>>ASSIGN   1517<>CALL     1518>>IF
      1521>>ASSIGN
IPCW_PL6
      1412**DCL-ENT  1442--CALL
LDFWC
      1403**DCL      1469--ASSIGN   1489--ASSIGN
LDFWD
      1404**DCL      1464>>ASSIGN   1470--ASSIGN
MMOC
      1400**DCL      1453--ASSIGN
RCV_FLG
      1395**DCL      1437>>IF
RELDEV
      1409**DCL      1515--ASSIGN
S1000_FLG
      1396**DCL      1438>>IF
SAVE_DEV
      1435**DCL      1440<<ASSIGN   1511>>ASSIGN   1521>>ASSIGN
TPUR_FLG
      1407**DCL      1466>>IF       1486>>IF
URCHN
      1408**DCL      1466>>ASSIGN   1467>>ASSIGN   1486>>ASSIGN   1487>>ASSIGN
PL6.E3A0      #008=URINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:173  
URCSOD1
      1401**DCL      1447--ASSIGN
URINIT1
      1521**LABEL    1451--GOTO     1460--GOTO     1478--GOTO     1498--GOTO     1508--GOTO
URINITB1
      1515**LABEL    1443--GOTO
URINITC
      1524**LABEL    1476--GOTO
URINITD
      1529**LABEL    1496--GOTO
URINITE
      1504**LABEL    1532--GOTO
URINITL
      1464**LABEL    1527--GOTO
URI_ZONE
      1373**DCL      1450--CALL     1457--CALL     1473--CALL     1493--CALL     1506--CALL     1517--CALL
URI_ZONE.BDCW.H2
      1386**DCL      1448<<ASSIGN   1455<<ASSIGN   1471<<ASSIGN   1491<<ASSIGN
URI_ZONE.DCW
      1380**DCL      1384--REDEF    1387--REDEF    1388--REDEF    1505<<ASSIGN   1516<<ASSIGN
URI_ZONE.DCW$
      1387**DCL      1447<<ASSIGN   1454<<ASSIGN   1470<<ASSIGN   1490<<ASSIGN
URI_ZONE.IDCW$
      1379**DCL      1446<<ASSIGN   1453<<ASSIGN   1469<<ASSIGN   1489<<ASSIGN   1504<<ASSIGN   1515<<ASSIGN
URI_ZONE.TDCW.TYPE
      1391**DCL      1449<<ASSIGN   1456<<ASSIGN   1472<<ASSIGN   1492<<ASSIGN
URI_ZONE.W1
      1374**DCL      1379--REDEF
URMMOD1
      1402**DCL      1454--ASSIGN

PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:174  
      788        1        /*T***********************************************************/
      789        2        /*T*                                                         */
      790        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      791        4        /*T*                                                         */
      792        5        /*T***********************************************************/
      793        6        LPINIT: PROC(INDX) ALTRET;
      794        7        /* This program loads Vertical Format and
      795        8           train immage buffer for a printer    */
      796        9        %INCLUDE IS$MACROS;
      797     1284    1   DCL INDX UBIN WORD;
      798     1285        %DEVINFO(STCLASS="SYMREF");
      799     1354        %DOIO_COMZONE(NAME=LPI_ZONE);
      800     1387    1   DCL PTRAIN(0:%(FRSTCR-FRSTLP-1)) PTR STATIC INIT(ADDR(PTRAIN6)*0);
              1387            /* Train image IOTDs */
      801     1388    1   DCL PTRAIN$ PTR;
      802     1389        %DCW_STRUCT(NAME=IOTD,STCLASS="BASED(PTRAIN$)");
      803     1407    1   DCL DCTLINES(0:%(FRSTCR-FRSTLP-1)) SBIN(18) SYMREF; /* Nr of actual lines/page */
      804     1408    1   DCL CURR_LINES(0:%(FRSTCR-FRSTLP-1)) SBIN(18) SYMREF; /* Nr of current lines/page */
      805     1409    1   DCL LTRNC BIT(36) ALIGNED STATIC INIT('01'O); /* Load train buffer image command */
      806     1410    1   DCL LVFCC BIT(36) ALIGNED STATIC INIT('05'O); /* Load VFC image command       */
      807     1411        %TEXTC(N#=LPHM,M#="'XXXXXXXX help (6/5/G/S) ? '");
      808     1416        %TEXTC(N#=SK,M#="'S'");
      809     1421    1   DCL MESSAGE$ PTR;
      810     1422    1   DCL 1 TEXTM BASED(MESSAGE$),
      811     1423    1         2 CNT UBIN WORD,
      812     1424    1         2 TXT CHAR(TEXTM.CNT);
      813     1425    1   DCL 1 ANSBUF SYMREF,
      814     1426    1         2 CNT UBIN WORD,
      815     1427    1         2 TXT CHAR(ANSBUF.CNT);
      816     1428    1   DCL PTRAIN5 BIT(1) SYMREF;              /* 500 TRAIN                          */
      817     1429    1   DCL PTRAIN6 BIT(1) SYMREF;              /* 600 TRAIN                          */
      818     1430    1   DCL VFCL BIT(1) SYMREF;                 /* VFC IMAGE                          */
      819     1431    1   DCL TR5SZ UBIN WORD SYMREF;             /* Sz of 500 train                    */
      820     1432    1   DCL TR6SZ UBIN WORD SYMREF;             /* Sz of 600 train                    */
      821     1433    1   DCL VFCSZ UBIN WORD SYMREF;             /* Sz of VFC image                    */
      822     1434    1   DCL I UBIN WORD;
      823     1435        /**/
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:175  
      824     1436    1   DCL DOIOX ENTRY(4);
      825     1437    1   DCL KEYINX ENTRY(3);
      826     1438        /**/
      827     1439    1           IF DEVINFO.BITS(INDX)~='0'B THEN ALTRETURN; /* Altreturn if printer down */
      828     1440    1             ELSE;
      829     1441    1           PTRAIN$=ADDR(PTRAIN(INDX-%FRSTLP));
      830     1442    1           IOTD.TALLY=TR6SZ;               /* Try first with PTRAIN6             */
      831     1443    1   TRYAG:
      832     1444        /* Load VFC */
      833     1445    1           PTRAIN$=ADDR(PTRAIN(INDX-%FRSTLP));
      834     1446    1           LPI_ZONE.IDCW$=ADDR(LVFCC);
      835     1447    1           LPI_ZONE.DCW$=ADDR(VFCL);
      836     1448    1           LPI_ZONE.DCW.TALLY=VFCSZ;
      837     1449    1           CALL DOIOX(INDX,ADDR(LPI_ZONE));
      838     1450    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)=%TERM_STATUS THEN GOTO VFCOK;
              1450                    /* Ready ? */
      839     1451    1             ELSE;                         /* No, tell and get answer            */
      840     1452    1   VFCNG:
      841     1453    1           MESSAGE$=ADDR(LPHM);
      842     1454    1           SUBSTR(TEXTM.TXT,0,8)=DEVINFO.DEVNAME(INDX);
      843     1455    1   VFCNG1:
      844     1456    1           CALL KEYINX(LPHM,ANSBUF,SK);    /* Implicit answer is Skip            */
      845     1457    2           DO SELECT(SUBSTR(ANSBUF.TXT,0,1));
      846     1458    2             SELECT('6');
      847     1459    2   STTR6:
      848     1460    2             PTRAIN(INDX-%FRSTLP)=ADDR(PTRAIN6);
      849     1461    2             IOTD.TALLY=TR6SZ;
      850     1462    2             GOTO TRYAG;
      851     1463    2             SELECT('5');
      852     1464    2   STTR5:
      853     1465    2             PTRAIN(INDX-%FRSTLP)=ADDR(PTRAIN5);
      854     1466    2             IOTD.TALLY=TR5SZ;
      855     1467    2             GOTO TRYAG;
      856     1468    2             SELECT('S','s');
      857     1469    2             DEVINFO.BITS(INDX)='1'B;      /* Mark printer down                  */
      858     1470    2             ALTRETURN;
      859     1471    2             SELECT('G','g');
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:176  
      860     1472    2             GOTO TRYAG;
      861     1473    2             SELECT(ELSE);
      862     1474    2           GOTO VFCNG1;
      863     1475    2           END;                            /* DO SELECT                          */
      864     1476    1   VFCOK:
      865     1477    1           CURR_LINES(INDX-%FRSTLP)=-DCTLINES(INDX-%FRSTLP); /* Reset line count */
      866     1478    2           DO I=0 TO 30000;                /* Wait a second                      */
      867     1479    2           END;                            /* DO I=                              */
      868     1480        /* Load train image buffer */
      869     1481    1           LPI_ZONE.IDCW$=ADDR(LTRNC);
      870     1482    1           LPI_ZONE.DCW$=PTRAIN$;
      871     1483    1           LPI_ZONE.BDCW.H2='0'B;
      872     1484    1           LPI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */
      873     1485    1           CALL DOIOX(INDX,ADDR(LPI_ZONE));
      874     1486    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)=%TERM_STATUS THEN RETURN;
      875     1487    1             ELSE GOTO VFCNG;
      876     1488    1   SET_TRAIN6:ENTRY(INDX) ALTRET;
      877     1489    1           GOTO STTR6;
      878     1490    1   SET_TRAIN5:ENTRY(INDX) ALTRET;
      879     1491    1           GOTO STTR5;
      880     1492    1   END LPINIT;
      881     1493        %EOD;

PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:177  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure LPINIT.

   Procedure LPINIT requires 170 words for executable code.
   Procedure LPINIT requires 12 words of local(AUTO) storage.

PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:178  

 Object Unit name= LPINIT                                     File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:36.16 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none    15     17  LPINIT
    1  RoData even  UTS      1      1  LPINIT
    2   Proc  even  none   170    252  LPINIT
    3  RoData even  none    11     13  LPINIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  LPINIT
     2    244          yes     yes      Std        1  SET_TRAIN6
     2    247          yes     yes      Std        1  SET_TRAIN5

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  LPI_ZONE                           0      5  LPHM
    0     15  SK
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:179  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       4 DOIOX
         yes           Std       3 KEYINX
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     DEVINFO                               DCTLINES                              CURR_LINES
     ANSBUF                                PTRAIN5                               PTRAIN6
     VFCL                                  TR5SZ                                 TR6SZ
     VFCSZ                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:180  


      788        1        /*T***********************************************************/
      789        2        /*T*                                                         */
      790        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      791        4        /*T*                                                         */
      792        5        /*T***********************************************************/
      793        6        LPINIT: PROC(INDX) ALTRET;

      6  2 000000   000000 700200 xent  LPINIT       TSX0  ! X66_AUTO_1
         2 000001   000014 000001                    ZERO    12,1

      794        7        /* This program loads Vertical Format and
      795        8           train immage buffer for a printer    */
      796        9        %INCLUDE IS$MACROS;
      797     1284    1   DCL INDX UBIN WORD;
      798     1285        %DEVINFO(STCLASS="SYMREF");
      799     1354        %DOIO_COMZONE(NAME=LPI_ZONE);
      800     1387    1   DCL PTRAIN(0:%(FRSTCR-FRSTLP-1)) PTR STATIC INIT(ADDR(PTRAIN6)*0);
              1387            /* Train image IOTDs */
      801     1388    1   DCL PTRAIN$ PTR;
      802     1389        %DCW_STRUCT(NAME=IOTD,STCLASS="BASED(PTRAIN$)");
      803     1407    1   DCL DCTLINES(0:%(FRSTCR-FRSTLP-1)) SBIN(18) SYMREF; /* Nr of actual lines/page */
      804     1408    1  DCL CURR_LINES(0:%(FRSTCR-FRSTLP-1)) SBIN(18) SYMREF; /* Nr of current lines/page */
      805     1409    1   DCL LTRNC BIT(36) ALIGNED STATIC INIT('01'O); /* Load train buffer image command */
      806     1410    1   DCL LVFCC BIT(36) ALIGNED STATIC INIT('05'O); /* Load VFC image command       */
      807     1411        %TEXTC(N#=LPHM,M#="'XXXXXXXX help (6/5/G/S) ? '");
      808     1416        %TEXTC(N#=SK,M#="'S'");
      809     1421    1   DCL MESSAGE$ PTR;
      810     1422    1   DCL 1 TEXTM BASED(MESSAGE$),
      811     1423    1         2 CNT UBIN WORD,
      812     1424    1         2 TXT CHAR(TEXTM.CNT);
      813     1425    1   DCL 1 ANSBUF SYMREF,
      814     1426    1         2 CNT UBIN WORD,
      815     1427    1         2 TXT CHAR(ANSBUF.CNT);
      816     1428    1   DCL PTRAIN5 BIT(1) SYMREF;              /* 500 TRAIN                          */
      817     1429    1   DCL PTRAIN6 BIT(1) SYMREF;              /* 600 TRAIN                          */
      818     1430    1   DCL VFCL BIT(1) SYMREF;                 /* VFC IMAGE                          */
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:181  
      819     1431    1   DCL TR5SZ UBIN WORD SYMREF;             /* Sz of 500 train                    */
      820     1432    1   DCL TR6SZ UBIN WORD SYMREF;             /* Sz of 600 train                    */
      821     1433    1   DCL VFCSZ UBIN WORD SYMREF;             /* Sz of VFC image                    */
      822     1434    1   DCL I UBIN WORD;
      823     1435        /**/
      824     1436    1   DCL DOIOX ENTRY(4);
      825     1437    1   DCL KEYINX ENTRY(3);
      826     1438        /**/
      827     1439    1           IF DEVINFO.BITS(INDX)~='0'B THEN ALTRETURN; /* Altreturn if printer down */

   1439  2 000002   200003 470500                    LDP0    @INDX,,AUTO
         2 000003   000000 236100                    LDQ     0,,PR0
         2 000004   000006 402007                    MPY     6,DL
         2 000005   000001 736000                    QLS     1
         2 000006   000001 235006 xsym               LDA     DEVINFO+1,QL
         2 000007   000011 600000 2                  TZE     s:1441

   1439  2 000010   000000 702200 xent               TSX2  ! X66_AALT

      828     1440    1             ELSE;
      829     1441    1           PTRAIN$=ADDR(PTRAIN(INDX-%FRSTLP));

   1441  2 000011   000000 720100                    LXL0    0,,PR0
         2 000012   000001 631410 0                  EPPR1   LPI_ZONE+1,X0
         2 000013   200004 451500                    STP1    PTRAIN$,,AUTO

      830     1442    1           IOTD.TALLY=TR6SZ;               /* Try first with PTRAIN6             */

   1442  2 000014   000000 236000 xsym               LDQ     TR6SZ
         2 000015   100000 752103                    STCQ    0,'03'O,PR1

      831     1443    1   TRYAG:
      832     1444        /* Load VFC */
      833     1445    1           PTRAIN$=ADDR(PTRAIN(INDX-%FRSTLP));

   1445  2 000016   200003 470500       TRYAG        LDP0    @INDX,,AUTO
         2 000017   000000 720100                    LXL0    0,,PR0
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:182  
         2 000020   000001 631410 0                  EPPR1   LPI_ZONE+1,X0
         2 000021   200004 451500                    STP1    PTRAIN$,,AUTO

      834     1446    1           LPI_ZONE.IDCW$=ADDR(LVFCC);

   1446  2 000022   000000 236000 3                  LDQ     0
         2 000023   000000 756000 0                  STQ     LPI_ZONE

      835     1447    1           LPI_ZONE.DCW$=ADDR(VFCL);

   1447  2 000024   000001 236000 3                  LDQ     1
         2 000025   000001 756000 0                  STQ     LPI_ZONE+1

      836     1448    1           LPI_ZONE.DCW.TALLY=VFCSZ;

   1448  2 000026   000000 236000 xsym               LDQ     VFCSZ
         2 000027   000001 752003 0                  STCQ    LPI_ZONE+1,'03'O

      837     1449    1           CALL DOIOX(INDX,ADDR(LPI_ZONE));

   1449  2 000030   000002 236000 3                  LDQ     2
         2 000031   200010 756100                    STQ     I+2,,AUTO
         2 000032   200010 633500                    EPPR3   I+2,,AUTO
         2 000033   200013 453500                    STP3    I+5,,AUTO
         2 000034   200003 236100                    LDQ     @INDX,,AUTO
         2 000035   200012 756100                    STQ     I+4,,AUTO
         2 000036   200012 630500                    EPPR0   I+4,,AUTO
         2 000037   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000040   000000 701000 xent               TSX1    DOIOX
         2 000041   000000 011000                    NOP     0

      838     1450    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)=%TERM_STATUS THEN GOTO VFCOK;
              1450                    /* Ready ? */

   1450  2 000042   200003 470500                    LDP0    @INDX,,AUTO
         2 000043   000000 236100                    LDQ     0,,PR0
         2 000044   000006 402007                    MPY     6,DL
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:183  
         2 000045   000001 736000                    QLS     1
         2 000046   000000 620006                    EAX0    0,QL
         2 000047   000000 236000 1                  LDQ     0
         2 000050   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000051   400000 116003                    CMPQ    -131072,DU
         2 000052   000174 600000 2                  TZE     VFCOK

      839     1451    1             ELSE;                         /* No, tell and get answer            */
      840     1452    1   VFCNG:
      841     1453    1           MESSAGE$=ADDR(LPHM);

   1453  2 000053   000003 236000 3     VFCNG        LDQ     3
         2 000054   200005 756100                    STQ     MESSAGE$,,AUTO

      842     1454    1           SUBSTR(TEXTM.TXT,0,8)=DEVINFO.DEVNAME(INDX);

   1454  2 000055   200005 470500                    LDP0    MESSAGE$,,AUTO
         2 000056   000000 720100                    LXL0    0,,PR0
         2 000057   200003 471500                    LDP1    @INDX,,AUTO
         2 000060   100000 236100                    LDQ     0,,PR1
         2 000061   000006 402007                    MPY     6,DL
         2 000062   000001 736000                    QLS     1
         2 000063   000006 237006 xsym               LDAQ    DEVINFO+6,QL
         2 000064   000001 755100                    STA     1,,PR0
         2 000065   000002 756100                    STQ     2,,PR0

      843     1455    1   VFCNG1:
      844     1456    1           CALL KEYINX(LPHM,ANSBUF,SK);    /* Implicit answer is Skip            */

   1456  2 000066   000004 630400 3     VFCNG1       EPPR0   4
         2 000067   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000070   000000 701000 xent               TSX1    KEYINX
         2 000071   000000 011000                    NOP     0

      845     1457    2           DO SELECT(SUBSTR(ANSBUF.TXT,0,1));

   1457  2 000072   000001 236000 xsym               LDQ     ANSBUF+1
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:184  
         2 000073   777000 376003                    ANQ     -512,DU
         2 000074   123000 116003                    CMPQ    42496,DU
         2 000075   000120 602000 2                  TNC     s:1457+22
         2 000076   000001 236000 xsym               LDQ     ANSBUF+1
         2 000077   777000 376003                    ANQ     -512,DU
         2 000100   123000 116003                    CMPQ    42496,DU
         2 000101   000162 600000 2                  TZE     s:1469
         2 000102   000001 236000 xsym               LDQ     ANSBUF+1
         2 000103   777000 376003                    ANQ     -512,DU
         2 000104   163000 116003                    CMPQ    58880,DU
         2 000105   000113 602000 2                  TNC     s:1457+17
         2 000106   000001 236000 xsym               LDQ     ANSBUF+1
         2 000107   777000 376003                    ANQ     -512,DU
         2 000110   163000 116003                    CMPQ    58880,DU
         2 000111   000162 600000 2                  TZE     s:1469
         2 000112   000173 710000 2                  TRA     s:1474
         2 000113   000001 236000 xsym               LDQ     ANSBUF+1
         2 000114   777000 376003                    ANQ     -512,DU
         2 000115   147000 116003                    CMPQ    52736,DU
         2 000116   000173 601000 2                  TNZ     s:1474
         2 000117   000172 710000 2                  TRA     s:1472
         2 000120   000001 236000 xsym               LDQ     ANSBUF+1
         2 000121   777000 376003                    ANQ     -512,DU
         2 000122   066000 116003                    CMPQ    27648,DU
         2 000123   000135 602000 2                  TNC     s:1457+35
         2 000124   000001 236000 xsym               LDQ     ANSBUF+1
         2 000125   777000 376003                    ANQ     -512,DU
         2 000126   066000 116003                    CMPQ    27648,DU
         2 000127   000142 600000 2                  TZE     STTR6
         2 000130   000001 236000 xsym               LDQ     ANSBUF+1
         2 000131   777000 376003                    ANQ     -512,DU
         2 000132   107000 116003                    CMPQ    36352,DU
         2 000133   000173 601000 2                  TNZ     s:1474
         2 000134   000172 710000 2                  TRA     s:1472
         2 000135   000001 236000 xsym               LDQ     ANSBUF+1
         2 000136   777000 376003                    ANQ     -512,DU
         2 000137   065000 116003                    CMPQ    27136,DU
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:185  
         2 000140   000173 601000 2                  TNZ     s:1474
         2 000141   000152 710000 2                  TRA     STTR5

      846     1458    2             SELECT('6');

      847     1459    2   STTR6:
      848     1460    2             PTRAIN(INDX-%FRSTLP)=ADDR(PTRAIN6);

   1460  2 000142   200003 470500       STTR6        LDP0    @INDX,,AUTO
         2 000143   000000 720100                    LXL0    0,,PR0
         2 000144   000007 236000 3                  LDQ     7
         2 000145   000001 756010 0                  STQ     LPI_ZONE+1,X0

      849     1461    2             IOTD.TALLY=TR6SZ;

   1461  2 000146   200004 471500                    LDP1    PTRAIN$,,AUTO
         2 000147   000000 236000 xsym               LDQ     TR6SZ
         2 000150   100000 752103                    STCQ    0,'03'O,PR1

      850     1462    2             GOTO TRYAG;

   1462  2 000151   000016 710000 2                  TRA     TRYAG

      851     1463    2             SELECT('5');

      852     1464    2   STTR5:
      853     1465    2             PTRAIN(INDX-%FRSTLP)=ADDR(PTRAIN5);

   1465  2 000152   200003 470500       STTR5        LDP0    @INDX,,AUTO
         2 000153   000000 720100                    LXL0    0,,PR0
         2 000154   000010 236000 3                  LDQ     8
         2 000155   000001 756010 0                  STQ     LPI_ZONE+1,X0

      854     1466    2             IOTD.TALLY=TR5SZ;

   1466  2 000156   200004 471500                    LDP1    PTRAIN$,,AUTO
         2 000157   000000 236000 xsym               LDQ     TR5SZ
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:186  
         2 000160   100000 752103                    STCQ    0,'03'O,PR1

      855     1467    2             GOTO TRYAG;

   1467  2 000161   000016 710000 2                  TRA     TRYAG

      856     1468    2             SELECT('S','s');

      857     1469    2             DEVINFO.BITS(INDX)='1'B;      /* Mark printer down                  */

   1469  2 000162   200003 470500                    LDP0    @INDX,,AUTO
         2 000163   000000 236100                    LDQ     0,,PR0
         2 000164   000006 402007                    MPY     6,DL
         2 000165   000001 736000                    QLS     1
         2 000166   000000 620006                    EAX0    0,QL
         2 000167   400000 236003                    LDQ     -131072,DU
         2 000170   000001 756010 xsym               STQ     DEVINFO+1,X0

      858     1470    2             ALTRETURN;

   1470  2 000171   000000 702200 xent               TSX2  ! X66_AALT

      859     1471    2             SELECT('G','g');

      860     1472    2             GOTO TRYAG;

   1472  2 000172   000016 710000 2                  TRA     TRYAG

      861     1473    2             SELECT(ELSE);

      862     1474    2           GOTO VFCNG1;

   1474  2 000173   000066 710000 2                  TRA     VFCNG1

      863     1475    2           END;                            /* DO SELECT                          */

      864     1476    1   VFCOK:
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:187  
      865     1477    1           CURR_LINES(INDX-%FRSTLP)=-DCTLINES(INDX-%FRSTLP); /* Reset line count */

   1477  2 000174   000000 720100       VFCOK        LXL0    0,,PR0
         2 000175   000000 221003                    LDX1    0,DU
         2 000176   777777 121010 xsym               SBLX1   DCTLINES-1,X0
         2 000177   777777 741010 xsym               STX1    CURR_LINES-1,X0

      866     1478    2           DO I=0 TO 30000;                /* Wait a second                      */

   1478  2 000200   200006 450100                    STZ     I,,AUTO

      867     1479    2           END;                            /* DO I=                              */

   1479  2 000201   200006 235100                    LDA     I,,AUTO
         2 000202   000001 035007                    ADLA    1,DL
         2 000203   200006 755100                    STA     I,,AUTO
         2 000204   072461 115007                    CMPA    30001,DL
         2 000205   000201 602000 2                  TNC     s:1479

      868     1480        /* Load train image buffer */
      869     1481    1           LPI_ZONE.IDCW$=ADDR(LTRNC);

   1481  2 000206   000011 236000 3                  LDQ     9
         2 000207   000000 756000 0                  STQ     LPI_ZONE

      870     1482    1           LPI_ZONE.DCW$=PTRAIN$;

   1482  2 000210   200004 236100                    LDQ     PTRAIN$,,AUTO
         2 000211   000001 756000 0                  STQ     LPI_ZONE+1

      871     1483    1           LPI_ZONE.BDCW.H2='0'B;

   1483  2 000212   000000 220003                    LDX0    0,DU
         2 000213   000001 440000 0                  SXL0    LPI_ZONE+1

      872     1484    1           LPI_ZONE.TDCW.TYPE='10'B;       /* Make it a TDCW                     */

PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:188  
   1484  2 000214   000001 236000 0                  LDQ     LPI_ZONE+1
         2 000215   000012 376000 3                  ANQ     10
         2 000216   020000 276007                    ORQ     8192,DL
         2 000217   000001 756000 0                  STQ     LPI_ZONE+1

      873     1485    1           CALL DOIOX(INDX,ADDR(LPI_ZONE));

   1485  2 000220   000002 236000 3                  LDQ     2
         2 000221   200010 756100                    STQ     I+2,,AUTO
         2 000222   200010 630500                    EPPR0   I+2,,AUTO
         2 000223   200013 450500                    STP0    I+5,,AUTO
         2 000224   200003 236100                    LDQ     @INDX,,AUTO
         2 000225   200012 756100                    STQ     I+4,,AUTO
         2 000226   200012 630500                    EPPR0   I+4,,AUTO
         2 000227   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000230   000000 701000 xent               TSX1    DOIOX
         2 000231   000000 011000                    NOP     0

      874     1486    1           IF(DEVINFO.BSTAT.W1(INDX)&%STATUS_MASK)=%TERM_STATUS THEN RETURN;

   1486  2 000232   200003 470500                    LDP0    @INDX,,AUTO
         2 000233   000000 236100                    LDQ     0,,PR0
         2 000234   000006 402007                    MPY     6,DL
         2 000235   000001 736000                    QLS     1
         2 000236   000000 620006                    EAX0    0,QL
         2 000237   000000 236000 1                  LDQ     0
         2 000240   000004 376010 xsym               ANQ     DEVINFO+4,X0
         2 000241   400000 116003                    CMPQ    -131072,DU
         2 000242   000053 601000 2                  TNZ     VFCNG

   1486  2 000243   000000 702200 xent               TSX2  ! X66_ARET

      875     1487    1             ELSE GOTO VFCNG;
      876     1488    1   SET_TRAIN6:ENTRY(INDX) ALTRET;

   1488  2 000244   000000 700200 xent  SET_TRAIN6   TSX0  ! X66_AUTO_1
         2 000245   000014 000001                    ZERO    12,1
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:189  

      877     1489    1           GOTO STTR6;

   1489  2 000246   000142 710000 2                  TRA     STTR6

      878     1490    1   SET_TRAIN5:ENTRY(INDX) ALTRET;

   1490  2 000247   000000 700200 xent  SET_TRAIN5   TSX0  ! X66_AUTO_1
         2 000250   000014 000001                    ZERO    12,1

      879     1491    1           GOTO STTR5;

   1491  2 000251   000152 710000 2                  TRA     STTR5
      880     1492    1   END LPINIT;
      881     1493        %EOD;

PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:190  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure LPINIT.
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:191  

 **** Variables and constants ****

  ****  Section 000  Data  LPINIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w STRC(270)   r     1 LPHM                       0-0-0/w STRC(72)    r     1 LPI_ZONE
     3-0-0/w BIT         r     1 LTRNC                      4-0-0/w BIT         r     1 LVFCC
     2-0-0/w PTR         r     1 PTRAIN(0:0)               15-0-0/w STRC(45)    r     1 SK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @INDX                      6-0-0/w UBIN        r     1 I
    *0-0-0/w UBIN        r     1 INDX                       5-0-0/w PTR         r     1 MESSAGE$
     4-0-0/w PTR         r     1 PTRAIN$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w ASTR        r     1 ANSBUF
     0-0-0/w SBIN(18)    r     1 CURR_LINES(0:0)
     0-0-0/w SBIN(18)    r     1 DCTLINES(0:0)
     0-0-0/d STRC(396)   r     1 DEVINFO(0:21)              0-0-0/b BIT         r     1 PTRAIN5
     0-0-0/b BIT         r     1 PTRAIN6                    0-0-0/w UBIN        r     1 TR5SZ
     0-0-0/w UBIN        r     1 TR6SZ                      0-0-0/b BIT         r     1 VFCL
     0-0-0/w UBIN        r     1 VFCSZ

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:192  

     0-0-0/w STRC        r     1 IOTD                       0-0-0/w ASTR        r     1 TEXTM


   Procedure LPINIT requires 170 words for executable code.
   Procedure LPINIT requires 12 words of local(AUTO) storage.
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:193  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:194  
          MINI XREF LISTING

ANSBUF
      1425**DCL      1456<>CALL
ANSBUF.CNT
      1426**DCL      1427--IMP-SIZ  1456>>CALL     1457>>DOSELCT
ANSBUF.TXT
      1427**DCL      1457>>DOSELCT
CURR_LINES
      1408**DCL      1477<<ASSIGN
DCTLINES
      1407**DCL      1477>>ASSIGN
DEVINFO.BITS
      1300**DCL      1439>>IF       1469<<ASSIGN
DEVINFO.BSTAT.W1
      1338**DCL      1450>>IF       1486>>IF
DEVINFO.DEVNAME
      1344**DCL      1454>>ASSIGN
DEVINFO.PCWS
      1301**DCL      1312--REDEF
DEVINFO.RPM_PTRS.EF_DCWS$
      1314**DCL      1315--REDEF
DEVINFO.STATUS
      1318**DCL      1337--REDEF
DOIOX
      1436**DCL-ENT  1449--CALL     1485--CALL
I
      1434**DCL      1478<<DOINDEX
INDX
      1284**DCL         6--PROC     1439>>IF       1441>>ASSIGN   1445>>ASSIGN   1449<>CALL     1450>>IF
      1454>>ASSIGN   1460>>ASSIGN   1465>>ASSIGN   1469>>ASSIGN   1477>>ASSIGN   1477>>ASSIGN   1485<>CALL
      1486>>IF       1488--ENTRY    1490--ENTRY
IOTD.TALLY
      1404**DCL      1442<<ASSIGN   1461<<ASSIGN   1466<<ASSIGN
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:195  
KEYINX
      1437**DCL-ENT  1456--CALL
LPHM
      1412**DCL      1453--ASSIGN   1456<>CALL
LPI_ZONE
      1365**DCL      1449--CALL     1485--CALL
LPI_ZONE.BDCW.H2
      1378**DCL      1483<<ASSIGN
LPI_ZONE.DCW
      1372**DCL      1376--REDEF    1379--REDEF    1380--REDEF
LPI_ZONE.DCW.TALLY
      1375**DCL      1448<<ASSIGN
LPI_ZONE.DCW$
      1379**DCL      1447<<ASSIGN   1482<<ASSIGN
LPI_ZONE.IDCW$
      1371**DCL      1446<<ASSIGN   1481<<ASSIGN
LPI_ZONE.TDCW.TYPE
      1383**DCL      1484<<ASSIGN
LPI_ZONE.W1
      1366**DCL      1371--REDEF
LTRNC
      1409**DCL      1481--ASSIGN
LVFCC
      1410**DCL      1446--ASSIGN
MESSAGE$
      1421**DCL      1422--IMP-PTR  1453<<ASSIGN   1454>>ASSIGN   1454>>ASSIGN
PTRAIN
      1387**DCL      1441--ASSIGN   1445--ASSIGN   1460<<ASSIGN   1465<<ASSIGN
PTRAIN$
      1388**DCL      1399--IMP-PTR  1441<<ASSIGN   1442>>ASSIGN   1445<<ASSIGN   1461>>ASSIGN   1466>>ASSIGN
      1482>>ASSIGN
PTRAIN5
      1428**DCL      1465--ASSIGN
PTRAIN6
      1429**DCL      1387--DCLINIT  1460--ASSIGN
SK
PL6.E3A0      #009=LPINIT File=ISI$ROUT.:E05TSI                                  TUE 07/29/97 22:57 Page:196  
      1417**DCL      1456<>CALL
STTR5
      1465**LABEL    1491--GOTO
STTR6
      1460**LABEL    1489--GOTO
TEXTM.CNT
      1423**DCL      1424--IMP-SIZ  1454>>ASSIGN
TEXTM.TXT
      1424**DCL      1454<<ASSIGN
TR5SZ
      1431**DCL      1466>>ASSIGN
TR6SZ
      1432**DCL      1442>>ASSIGN   1461>>ASSIGN
TRYAG
      1445**LABEL    1462--GOTO     1467--GOTO     1472--GOTO
VFCL
      1430**DCL      1447--ASSIGN
VFCNG
      1453**LABEL    1487--GOTO
VFCNG1
      1456**LABEL    1474--GOTO
VFCOK
      1477**LABEL    1450--GOTO
VFCSZ
      1433**DCL      1448>>ASSIGN

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:197  
      882        1        /*T***********************************************************/
      883        2        /*T*                                                         */
      884        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      885        4        /*T*                                                         */
      886        5        /*T***********************************************************/
      887        6        FIX_FIRM:PROC;
      888        7        %INCLUDE IS$MACROS;
      889     1282    1   DCL IPCW_PL6 ENTRY(1);
      890     1283    1   DCL FWRXX ENTRY(1) ALTRET;
      891     1284    1   DCL BUILDFW_DCWS ENTRY(2);
      892     1285    1   DCL POFWR ENTRY(3) ALTRET;
      893     1286    1   DCL TYPEC ENTRY(1);
      894     1287    1   DCL KEYIN ENTRY(2) ALTRET;
      895     1288    1   DCL GETFD ENTRY(2) ALTRET;
      896     1289    1   DCL HANG ENTRY;
      897     1290    1   DCL MTINIT ENTRY ALTRET;
      898     1291    1   DCL DCINIT ENTRY ALTRET;
      899     1292    1   DCL URINIT ENTRY(1) ALTRET;
      900     1293    1   DCL LPINIT ENTRY(1) ALTRET;
      901     1294    1   DCL MINIQ_PL6 ENTRY(5) ALTRET;
      902     1295    1   DCL GT_SYSPACKAD ENTRY(1);
      903     1296    1   DCL   CLEAR_CACHE ENTRY;
      904     1297    1   DCL   START_IO_RPM ENTRY(2);
      905     1298        /**/
      906     1299        %DISKDIR(NAME=ADIR,STCLASS="SYMREF");
      907     1555    1   DCL NAVHDR$ STATIC SYMDEF PTR;          /* Next available firmware header     */
      908     1556    1   DCL NEWNAVHDR$ PTR;
      909     1557    1   DCL FW$ STATIC SYMDEF PTR INIT(ADDR(CP6UL)); /* Pointer to the firmware buffer */
      910     1558        %PTR_STRUCT(NAME=FW_PTR,STCLASS="REDEF FW$");
      911     1576    1   DCL FWHDR$ PTR STATIC SYMDEF INIT(ADDR(ADIR.FW(0))); /* Pointer to firm header */
      912     1577        %PTR_STRUCT(NAME=FWHDR_PTR,STCLASS="REDEF FWHDR$");
      913     1595    1   DCL NEWFWHDR$ PTR STATIC;
      914     1596        %PTR_STRUCT(NAME=NEWFWHDR_PTR,STCLASS="REDEF NEWFWHDR$");
      915     1614        %PTR_STRUCT(NAME=DCFWSTART_PTR);        /* Pointer to disk firmware           */
      916     1632    1   DCL DCFWSTART$ REDEF DCFWSTART_PTR PTR;
      917     1633        %PTR_STRUCT(NAME=FWSTART_PTR);          /* Pointer to firmware start          */
      918     1651    1   DCL FWSTART$ REDEF FWSTART_PTR PTR;
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:198  
      919     1652    1   DCL DCFWHDR$ PTR STATIC SYMDEF;
      920     1653        %FWHDR;                                 /* Description of firmware header     */
      921     1662        %DEVINFO(STCLASS="SYMREF");
      922     1731        /**/
      923     1732        /* Firmware tables */
      924     1733        %FW_TAB(NAME=TAPE_FW,ENT#=3);
      925     1750        %FW_TAB(NAME=DISK_FW,ENT#=3);
      926     1767        %FW_TAB(NAME=UR_FW,ENT#=3);
      927     1784        %FW_TAB(NAME=LP_FW,ENT#=1);
      928     1801        %FW_TAB(NAME=CRP_FW,ENT#=1);
      929     1818        /**/
      930     1819    1   DCL   BOOTTAPE UBIN WORD SYMREF;
      931     1820    1   DCL   FW_LOAD(0:511) BIT(1) UNAL SYMREF;
      932     1821    1   DCL   CHN_CFG(0:511) BIT(1) UNAL SYMREF;
      933     1822    1   DCL 1 HW_LD_FLAG SYMREF,
      934     1823    1         2 CR_FW BIT(1) UNAL,
      935     1824    1         2 DISK_FW BIT(1) UNAL,
      936     1825    1         2 LP_FW BIT(1) UNAL,
      937     1826    1         2 TAPE_FW BIT(1) UNAL,
      938     1827    1         2 * BIT(5) UNAL;
      939     1828    1   DCL   RPM_FLG BIT(1) SYMREF;
      940     1829    1   DCL   DO_RPM_CFG ENTRY(1) ALTRET;
      941     1830    1   DCL 1 RPM_BOOTIN SYMREF,
      942     1831    1         2 * BIT(9),
      943     1832    1         2 CHN# UBIN(9) UNAL,
      944     1833    1         2 * BIT(7),
      945     1834    1         2 IMX# UBIN(2) UNAL,
      946     1835    1         2 * BIT(9);
      947     1836    1   DCL   TEMP_IMX SBIN WORD;
      948     1837    1   DCL CP6UL BIT(1) SYMREF;                /* Top of already used memory         */
      949     1838    1   DCL URCHN UBIN WORD SYMREF;
      950     1839    1   DCL SYS_DPX UBIN WORD SYMREF;           /* System disk index in DEVINFO       */
      951     1840    1   DCL S1000_FLG BIT(1) SYMREF;
      952     1841    1   DCL 1 ANSBUF SYMREF,
      953     1842    1         2 CNT UBIN WORD,
      954     1843    1         2 TXT UBIN(16);
      955     1844    1   DCL MTIDCW(0:14) BIT(36) ALIGNED SYMREF;
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:199  
      956     1845    1   DCL FIELD$ PTR SYMREF;
      957     1846    1   DCL FIELD_LEN UBIN WORD SYMREF;
      958     1847    1   DCL FWANS CHAR(2) BASED(FIELD$);
      959     1848    1   DCL DECIM_FLG BIT(1) SYMREF;
      960     1849    1   DCL ORDBFLG BIT(2) SYMREF;
      961     1850    1   DCL RCV_FLG BIT(4) SYMREF;
      962     1851    1   DCL 1 ADPXF SYMREF,
      963     1852    1         2 A BIT(1),
      964     1853    1         2 D BIT(1),
      965     1854    1         2 P BIT(1),
      966     1855    1         2 X BIT(1),
      967     1856    1         2 F BIT(1);
      968     1857        /**/
      969     1858        /* DCWs for firmware writing */
      970     1859        %DCW_STRUCT(NAME=MTCSOD1);              /* MT-MPC CSO DCWs                    */
      971     1877        %DCW_STRUCT(NAME=MTCSOD2);
      972     1895        %DCW_STRUCT(NAME=DCCSOD1);              /* DC-MPC CSO DCWs                    */
      973     1913        %DCW_STRUCT(NAME=DCCSOD2);
      974     1931        %DCW_STRUCT(NAME=URCSOD1);              /* UR-MPC CSO DCWs                    */
      975     1949        %DCW_STRUCT(NAME=URCSOD2);
      976     1967        %DCW_STRUCT(NAME=MTMMOD1);              /* MT-MPC MMO DCWs                    */
      977     1985        %DCW_STRUCT(NAME=MTMMOD2);
      978     2003        %DCW_STRUCT(NAME=DCMMOD1);              /* DC-MPC MMO DCWs                    */
      979     2021        %DCW_STRUCT(NAME=DCMMOD2);
      980     2039        %DCW_STRUCT(NAME=URMMOD1);              /* UR-MPC MMO DCWs                    */
      981     2057        %DCW_STRUCT(NAME=URMMOD2);
      982     2075        %DCW_STRUCT(NAME=LDFWD);                /* PTR400 DCW                         */
      983     2093        %DCW_STRUCT(NAME=CDFWD);                /* CR/CP DCW                          */
      984     2111        /**/
      985     2112    1   DCL ACTFWHD# STATIC SYMDEF UBIN WORD INIT(0); /*Nr of used firmware headers   */
      986     2113    1   DCL EURC_FLG BIT(1) STATIC SYMDEF INIT('0'B);
      987     2114    1   DCL TPUR_FLG BIT(1) STATIC SYMDEF INIT('0'B);
      988     2115    1   DCL POFWHD# UBIN WORD;                  /* Nr of headers read from PO tape    */
      989     2116    1   DCL I UBIN WORD;
      990     2117    1   DCL FWTINDX UBIN WORD STATIC SYMDEF INIT(0); /* Index in DEVINFO of FW tape   */
      991     2118        /* Texts */
      992     2119        %TEXTC(N#=FWERR,M#="' Tape error reading firmware.'");
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:200  
      993     2124        %TEXTC(N#=NOFWRM,M#="' Cannot initialize MPC or cannot find firmware XXXX '");
      994     2129        %TEXTC(N#=POEM,M#="'PO boot aborted...'");
      995     2134        %TEXTC(N#=FWTQ2,M#="' FW Tape = X-XXX-'");
      996     2139    1   DCL MESSAGE$ PTR;
      997     2140    1   DCL 1 TEXTM BASED(MESSAGE$),
      998     2141    1         2 CNT UBIN WORD,
      999     2142    1         2 TXT CHAR(TEXTM.CNT);
     1000     2143        /**/
     1001     2144    1           ADIR.FW='0'B;                   /* Zap FW headers                     */
     1002     2145    2           IF S1000_FLG='1'B THEN DO; /* On S1000 the firmware is already loaded */
     1003     2146        /* Load VFC and train image to printers */
     1004     2147    3                 DO I=%FRSTLP TO %(FRSTCR-1);
     1005     2148    3                   CALL LPINIT(I);
     1006     2149    3                 END;                      /* DO I=                              */
     1007     2150    2   DCIS:
     1008     2151    2                 IF SYS_DPX~=0 THEN GOTO DCIS1; /* We already know system disk addr */
     1009     2152    2                   ELSE;
     1010     2153    2                 IF ADPXF.D='1'B THEN CALL GT_SYSPACKAD(%FRSTDP);
              2153                          /* Get sys pack addr */
     1011     2154    2                   ELSE;
     1012     2155    2                 SYS_DPX=%FRSTDP;
     1013     2156    2   DCIS1:
     1014     2157        /* Over top of already used memory , allow 1 page for PTCHBF,
     1015     2158           next page,page boundary */
     1016     2159    2                 FW$=ADDR(CP6UL);
     1017     2160    2                 FW_PTR.WOFFS=(FW_PTR.WOFFS+2048)/1024*1024;
     1018     2161    2                 FWSTART$=FW$;
     1019     2162    2                 RETURN;
     1020     2163    2               END;                        /* THEN                               */
     1021     2164    1             ELSE;
     1022     2165        /**/
     1023     2166        /* build CP6-RPM config tables from RPM - MCA config data */
     1024     2167    2           IF RPM_FLG THEN DO;
     1025     2168    2                 TEMP_IMX = RPM_BOOTIN.IMX#;
     1026     2169    3                 CALL DO_RPM_CFG(TEMP_IMX) WHENRETURN DO;
     1027     2170    3                       HW_LD_FLAG.CR_FW = '0'B;
     1028     2171    3                       HW_LD_FLAG.LP_FW = '0'B;
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:201  
     1029     2172    3                       HW_LD_FLAG.TAPE_FW = FW_LOAD(DEVINFO.IOM#(BOOTTAPE)*128 +DEVINFO
              2172                                .CHN#(BOOTTAPE));
     1030     2173    3                       HW_LD_FLAG.DISK_FW = FW_LOAD(DEVINFO.IOM#(%FRSTDP)*128 +DEVINFO.
              2173                                CHN#(%FRSTDP));
     1031     2174    3                     END;
     1032     2175    2               END;
     1033     2176        /* Initialize firmware tables */
     1034     2177    1           TAPE_FW.MODN(0)=%TPFWNM;
     1035     2178    1           TAPE_FW.MODN(1)=%TPFWN2;
     1036     2179    1           TAPE_FW.MODN(2)=%TPFWN3;
     1037     2180        /**/
     1038     2181    1           DISK_FW.MODN(0)=%DCFWNM;
     1039     2182    1           DISK_FW.MODN(1)=%DCFWN2;
     1040     2183    1           DISK_FW.MODN(2)=%DCFWN3;
     1041     2184        /**/
     1042     2185    1           UR_FW.MODN(0)=%URFWN3;
     1043     2186    1           UR_FW.MODN(1)=%URFWNM;
     1044     2187    1           UR_FW.MODN(2)=%URFWN2;
     1045     2188        /**/
     1046     2189    1           LP_FW.MODN(0)=%LPFWNM;
     1047     2190        /**/
     1048     2191    1           CRP_FW.MODN(0)=%CRPFWNM;
     1049     2192        /**/
     1050     2193    1           IF HW_LD_FLAG.TAPE_FW THEN
     1051     2194    1             CALL IPCW_PL6(%FRSTMT);  /* Initialize MT-MPC for primitive read    */
     1052     2195        /* Over top of already used memory , allow 1 page for PTCHBF,
     1053     2196           next page,page boundary, and allow space for NI$FW header */
     1054     2197    1           DCFWSTART$=ADDR(CP6UL);
     1055     2198    1           DCFWSTART_PTR.WOFFS=(DCFWSTART_PTR.WOFFS+2048)/1024*1024+%NIFWHDR;
     1056     2199        /* Make room for system disk firmware */
     1057     2200    1           FWSTART_PTR.WOFFS=(DCFWSTART_PTR.WOFFS+%(MAXDCFW-NIFWHDR+1023))/1024*1024;
     1058     2201    1           FW$=FWSTART$;
     1059     2202        /* Read firmware from PO tape */
     1060     2203    1           IF HW_LD_FLAG.TAPE_FW THEN
     1061     2204    1             CALL POFWR(BOOTTAPE,'0'B,'0'B) ALTRET(ERPO);
     1062     2205    1             ELSE
     1063     2206    1             CALL POFWR(BOOTTAPE,'1'B,'0'B) ALTRET(ERPO);
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:202  
     1064     2207    1           NAVHDR$=FWHDR$;                 /* Save next available header address */
     1065     2208    1           POFWHD#=ACTFWHD#;               /* And nr of headers from PO tape     */
     1066     2209    1           NEWNAVHDR$=NAVHDR$;
     1067     2210        /* Build tape firmware table and initialize MT controller */
     1068     2211    1           IF ~HW_LD_FLAG.TAPE_FW THEN
     1069     2212    1             GOTO SKIP_FW_TAPE_LOAD;
     1070     2213    2           DO I=0 TO TAPE_FW.FWM#-1;
     1071     2214    3             CALL FWRXX(TAPE_FW.MODN(I)) WHENRETURN DO; /* Look for this firmware */
     1072     2215    3                   CALL BUILDFW_DCWS(MTCSOD1,MTMMOD1);
     1073     2216    3                   CALL MTINIT ALTRET(NXT_TFW);
     1074     2217    3                   GOTO MTDONE;
              2217                            /* Found one firmware module that initialized the controller */
     1075     2218    3                 END;                      /* WHENRETURN                         */
     1076     2219    2   NXT_TFW:
     1077     2220    2           END;                            /* DO I =                             */
     1078     2221    1   NOMT:
     1079     2222        /* Couldn't initialize MT ; tell them and hang */
     1080     2223    1           MESSAGE$=ADDR(NOFWRM);
     1081     2224    1           SUBSTR(TEXTM.TXT,47,4)='TAPE';
     1082     2225    1           CALL TYPEC(NOFWRM);
     1083     2226    1           GOTO ERPO1;
     1084     2227    1   MTDONE:
     1085     2228    1           IF TAPE_FW.MODN(I)=%TPFWN2 OR TAPE_FW.MODN(I)=%TPFWN3 THEN
     1086     2229    1             MTIDCW(6)=MTIDCW(7);          /* Set density to 1600                */
     1087     2230        /* See if FW tape requested */
     1088     2231    1   SKIP_FW_TAPE_LOAD:
     1089     2232    1           IF ADPXF.F='0'B THEN
     1090     2233    1             IF HW_LD_FLAG.TAPE_FW THEN
     1091     2234    1               GOTO NOFWT;
     1092     2235    1               ELSE
     1093     2236    1               GOTO DO_LP_FW;
     1094     2237    1             ELSE;
     1095     2238        /* Firmware tape requested,ask for address */
     1096     2239    1           MESSAGE$=ADDR(FWTQ2);
     1097     2240    1           SUBSTR(TEXTM.TXT,11,6)=SUBSTR(DEVINFO.DEVNAME(%FRSTMT),0,6);
     1098     2241    1   ASKFWT1:
     1099     2242    1           CALL KEYIN(FWTQ2,ANSBUF);
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:203  
     1100     2243    1           CALL GETFD(ANSBUF.TXT,16) ALTRET(NOFWT);
     1101     2244    1           IF FIELD_LEN>2 OR DECIM_FLG='0'B THEN GOTO ASKFWT1; /* Ask again      */
     1102     2245    1             ELSE;
     1103     2246    2           IF FIELD_LEN=1 THEN DO;         /* Make it a 2 digit field            */
     1104     2247    2                 SUBSTR(FWANS,1,1)=SUBSTR(FWANS,0,1);
     1105     2248    2                 SUBSTR(FWANS,0,1)='0';
     1106     2249    2               END;                        /* THEN                               */
     1107     2250    1             ELSE;
     1108     2251    2           DO I=%FRSTMT TO %FRSTDP-1;
     1109     2252    2             IF SUBSTR(DEVINFO.DEVNAME(I),6,2)=FWANS THEN GOTO DOFWT;
     1110     2253    2               ELSE;
     1111     2254    2           END;                            /* ELSE DO I=                         */
     1112     2255    1           GOTO ASKFWT1;                   /* Device not found                   */
     1113     2256    1   DOFWT:
     1114     2257    1           FWTINDX=I;                      /* Index of FW tape in DEVINFO        */
     1115     2258        /* Wait a second */
     1116     2259    2           DO I=0 TO 32000;
     1117     2260    2           END;                            /* DO I=                              */
     1118     2261    1           FWHDR$=NAVHDR$;
     1119     2262    1           CALL POFWR(FWTINDX,'1'B,'1'B);
     1120     2263    1           CALL MINIQ_PL6(FWTINDX,0,0,%FCNUNL); /* Unload the FW tape            */
     1121     2264    1           NEWFWHDR$=NAVHDR$;
     1122     2265    1           NEWNAVHDR$=FWHDR$;
     1123     2266        /* See if duplicate modules ; if YES replace the old ones */
     1124     2267    1           IF ACTFWHD#=POFWHD# THEN GOTO NOFWT; /* No modules read from FW tape  */
     1125     2268    2             ELSE DO I=POFWHD#+1 TO ACTFWHD#;
     1126     2269    2                 CALL FWRXX(NEWFWHDR$->FWHDR.FWNAME) ALTRET(NDUP);
              2269                          /* See if module exists in firmware read from PO tape */
     1127     2270    2                 FWHDR=NEWFWHDR$->FWHDR; /* Yes, replace old header with new one */
     1128     2271    2                 NEWFWHDR$->FWHDR.FWNAME='XXXX'; /* and invalidate new header    */
     1129     2272    2   NDUP:
     1130     2273    2                 NEWFWHDR_PTR.WOFFS=NEWFWHDR_PTR.WOFFS+4; /* Next header         */
     1131     2274    2               END;                        /* ELSE DO I=                         */
     1132     2275        /* All firmware in memory */
     1133     2276        /* Initialize controllers */
     1134     2277    1   NOFWT:
     1135     2278    1           IF ~HW_LD_FLAG.TAPE_FW THEN
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:204  
     1136     2279    1             GOTO DO_LP_FW;
     1137     2280    1           NAVHDR$=NEWNAVHDR$;
     1138     2281        /* Reinitialize MT controller */
     1139     2282    2           DO I=0 TO TAPE_FW.FWM#-1;
     1140     2283    3             CALL FWRXX(TAPE_FW.MODN(I)) WHENRETURN DO; /* Look for this firmware */
     1141     2284    3                   CALL BUILDFW_DCWS(MTCSOD1,MTMMOD1);
     1142     2285    3                   CALL MTINIT ALTRET(NXT_TFW1);
     1143     2286    3                   GOTO MTDONE1;
              2286                            /* Found one firmware module that initialized the controller */
     1144     2287    3                 END;                      /* WHENRETURN                         */
     1145     2288    2   NXT_TFW1:
     1146     2289    2           END;                            /* DO I =                             */
     1147     2290    1           GOTO NOMT;
     1148     2291    1   MTDONE1:
     1149     2292    1           TAPE_FW.FW_INDX=I;
     1150     2293    1           IF TAPE_FW.MODN(I)='TPUR' THEN TPUR_FLG='1'B;
     1151     2294    1             ELSE;
     1152     2295        /* Initialize UR controller */
     1153     2296    1   DO_LP_FW:
     1154     2297    1           IF ~HW_LD_FLAG.LP_FW THEN
     1155     2298    1             IF ~HW_LD_FLAG.CR_FW THEN
     1156     2299    1               GOTO DP_NEXT;
     1157     2300    1               ELSE GOTO LPDONE1;
     1158     2301    2           DO I=0 TO LP_FW.FWM#-1;         /* Look for LP application firmware   */
     1159     2302    3             CALL FWRXX(LP_FW.MODN(I)) WHENRETURN DO;
     1160     2303    3                   LDFWD.AD=FWHDR.BUFAD;
     1161     2304    3                   LDFWD.TALLY=FWHDR.CSOSIZE;
     1162     2305    3                   GOTO LPDONE;
     1163     2306    3                 END;                      /* WHENRETURN                         */
     1164     2307    2           END;                            /* DO I=                              */
     1165     2308    1   LPDONE:
     1166     2309    1           LP_FW.FW_INDX=I;
     1167     2310    2           IF ~HW_LD_FLAG.CR_FW THEN DO;
     1168     2311    2                 I = 0;
     1169     2312    2                 EURC_FLG = '1'B;
     1170     2313    2                 GOTO TRY_LP1;
     1171     2314    2               END;
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:205  
     1172     2315    1   LPDONE1:
     1173     2316    2           DO I=0 TO CRP_FW.FWM#-1;   /* Look for CR CP application firmware     */
     1174     2317    3             CALL FWRXX(CRP_FW.MODN(I)) WHENRETURN DO;
     1175     2318    3                   CDFWD.AD=FWHDR.BUFAD;
     1176     2319    3                   CDFWD.TALLY=FWHDR.CSOSIZE;
     1177     2320    3                   GOTO CRDONE;
     1178     2321    3                 END;                      /* WHENRETURN                         */
     1179     2322    2           END;                            /* DO I=                              */
     1180     2323    1   CRDONE:
     1181     2324    1           CRP_FW.FW_INDX=I;
     1182     2325        /* Try EURC first */
     1183     2326    1           I=0;
     1184     2327    1           EURC_FLG='1'B;
     1185     2328    1           CALL URINIT(%FRSTCR) ALTRET(TRY_LP1);
     1186     2329    1           GOTO URDONE;
     1187     2330    1   TRY_LP1:
     1188     2331    1           CALL URINIT(%FRSTLP) ALTRET(OTH_URFW);
     1189     2332    1           IF ~HW_LD_FLAG.LP_FW THEN
     1190     2333    1             GOTO OTH_URFW;
     1191     2334    1           GOTO URDONE;
     1192     2335    1   OTH_URFW:
     1193     2336    1           EURC_FLG='0'B;                  /* No EURC , try other firmware       */
     1194     2337    2           DO I=1 TO UR_FW.FWM#-1;
     1195     2338    3             CALL FWRXX(UR_FW.MODN(I)) WHENRETURN DO;
     1196     2339    3                   CALL BUILDFW_DCWS(URCSOD1,URMMOD1);
     1197     2340    4                   IF HW_LD_FLAG.CR_FW THEN DO;
     1198     2341    4                         CALL URINIT(%FRSTCR) ALTRET(TRY_LP2);
     1199     2342    4                         GOTO URDONE;
     1200     2343    4                       END;
     1201     2344    3   TRY_LP2:
     1202     2345    4                   IF HW_LD_FLAG.LP_FW THEN DO;
     1203     2346    4                         CALL URINIT(%FRSTLP) ALTRET(NXT_UFW);
     1204     2347    4                         GOTO URDONE;
     1205     2348    4                       END;
     1206     2349    3                 END;                      /* WHENRETURN                         */
     1207     2350    2   NXT_UFW:
     1208     2351    2           END;                            /* DO I=                              */
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:206  
     1209     2352        /* Couldn't initialize UR controller */
     1210     2353    2           DO I=%FRSTLP TO %(FRSTMT-1);    /* Mark UR devices down               */
     1211     2354    2             DEVINFO.BITS(I)='1'B;
     1212     2355    2           END;                            /* DO I=                              */
     1213     2356    1           URCHN=0;                        /*For TIGR                            */
     1214     2357    1           MESSAGE$=ADDR(NOFWRM);
     1215     2358    1           SUBSTR(TEXTM.TXT,47,4)=' UR ';
     1216     2359    1           CALL TYPEC(NOFWRM);
     1217     2360        /* Make sure MT is running */
     1218     2361    1           IF TPUR_FLG='1'B THEN CALL MTINIT ALTRET(NOMT);
     1219     2362    1             ELSE;
     1220     2363    1           GOTO DCI;
     1221     2364    1   URDONE:
     1222     2365    1           UR_FW.FW_INDX=I;
     1223     2366    1   DP_NEXT:
     1224     2367    1           RCV_FLG=ORDBFLG;
     1225     2368    1           IF ORDBFLG~='0'B THEN GOTO DCI;
     1226     2369    1             ELSE;
     1227     2370        /* Load VFC and train image to printers */
     1228     2371    2           DO I=%FRSTLP TO %(FRSTCR-1);
     1229     2372    2             IF NOT RPM_FLG OR CHN_CFG( DEVINFO.IOM#(I) *128 + DEVINFO.CHN#(I)) THEN
     1230     2373    2               CALL LPINIT(I);
     1231     2374    2               ELSE
     1232     2375    2               DEVINFO.BITS(I) = '1'B;
     1233     2376    2           END;                            /* DO I=                              */
     1234     2377    1   DCI:
     1235     2378    1           IF SYS_DPX~=0 THEN GOTO DCI1;   /* We already know system disk addr   */
     1236     2379    1             ELSE;
     1237     2380    1           IF ADPXF.D='1'B THEN CALL GT_SYSPACKAD(%FRSTDP); /* Get sys pack addr */
     1238     2381    1             ELSE;
     1239     2382    1           SYS_DPX=%FRSTDP;
     1240     2383    1   DCI1:
     1241     2384    2           IF RPM_FLG THEN DO;
     1242     2385    2                 TEMP_IMX = DEVINFO.IOM#(SYS_DPX);
     1243     2386    3                 CALL DO_RPM_CFG(TEMP_IMX) WHENRETURN DO;
     1244     2387    3                       HW_LD_FLAG.DISK_FW = FW_LOAD(DEVINFO.IOM#(SYS_DPX)*128 +DEVINFO.
              2387                                CHN#(SYS_DPX));
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:207  
     1245     2388    3                     END;
     1246     2389    2               END;
     1247     2390    1           IF ~HW_LD_FLAG.DISK_FW THEN
     1248     2391    1             GOTO DCDONE1;
     1249     2392    2           DO I=0 TO DISK_FW.FWM#-1;
     1250     2393    3             CALL FWRXX(DISK_FW.MODN(I)) WHENRETURN DO; /* Look for this firmware */
     1251     2394    3                   CALL BUILDFW_DCWS(DCCSOD1,DCMMOD1);
     1252     2395    3                   CALL DCINIT ALTRET(NXT_DCFW);
     1253     2396    3                   GOTO DCDONE;
     1254     2397    3                 END;                      /* WHENRETURN                         */
     1255     2398    2   NXT_DCFW:
     1256     2399    2           END;                            /* DO I=                              */
     1257     2400    1   NODCFW:
     1258     2401    1           MESSAGE$=ADDR(NOFWRM);
     1259     2402    1           SUBSTR(TEXTM.TXT,47,4)='DISK';
     1260     2403    1           CALL TYPEC(NOFWRM);
     1261     2404    1           GOTO ERPO1;
     1262     2405    1   DCDONE:
     1263     2406    1           DISK_FW.FW_INDX=I;
     1264     2407    1   DCDONE1:
     1265     2408    1           DCFWHDR$=FWHDR$;
     1266     2409    1           RETURN;
     1267     2410    1   ERPO:
     1268     2411    1           CALL TYPEC(FWERR);
     1269     2412    1   ERPO1:
     1270     2413    1           CALL TYPEC(POEM);
     1271     2414    1           CALL HANG;
     1272     2415    1           RETURN;
     1273     2416    1   INIT_DISK:ENTRY;
     1274     2417    1           IF S1000_FLG='1'B THEN RETURN;
     1275     2418    1             ELSE GOTO DCI1;
     1276     2419    1   END FIX_FIRM;
     1277     2420        %EOD;

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:208  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FIX_FIRM.

   Procedure FIX_FIRM requires 633 words for executable code.
   Procedure FIX_FIRM requires 10 words of local(AUTO) storage.

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:209  

 Object Unit name= FIX_FIRM                                   File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:41.40 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none    81    121  FIX_FIRM
    1  RoData even  UTS     15     17  FIX_FIRM
    2   Proc  even  none   633   1171  FIX_FIRM
    3  RoData even  none    36     44  FIX_FIRM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        0  FIX_FIRM
     2   1164                  yes      Std        0  INIT_DISK
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:210  

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  NAVHDR$                            0      1  FW$
    0      2  FWHDR$                             0      4  DCFWSTART_PTR
    0      5  FWSTART_PTR                        0      6  DCFWHDR$
    0      7  TAPE_FW                            0     14  DISK_FW
    0     21  UR_FW                              0     26  LP_FW
    0     31  CRP_FW                             0     34  MTCSOD1
    0     35  MTCSOD2                            0     36  DCCSOD1
    0     37  DCCSOD2                            0     40  URCSOD1
    0     41  URCSOD2                            0     42  MTMMOD1
    0     43  MTMMOD2                            0     44  DCMMOD1
    0     45  DCMMOD2                            0     46  URMMOD1
    0     47  URMMOD2                            0     50  LDFWD
    0     51  CDFWD                              0     52  ACTFWHD#
    0     53  EURC_FLG                           0     54  TPUR_FLG
    0     55  FWTINDX                            0     56  FWERR
    0     67  NOFWRM                             0    105  POEM
    0    113  FWTQ2
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:211  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 LPINIT
         yes           Std       1 GT_SYSPACKAD
 yes     yes           Std       3 POFWR
         yes           Std       1 TYPEC
 yes     yes           Std       1 FWRXX
 yes     yes           Std       2 KEYIN
 yes     yes           Std       2 GETFD
 yes     yes           Std       0 DCINIT
 yes     yes           Std       1 DO_RPM_CFG
         yes           Std       1 IPCW_PL6
         yes           Std       2 BUILDFW_DCWS
 yes     yes           Std       0 MTINIT
         yes           Std       0 HANG
 yes     yes           Std       5 MINIQ_PL6
 yes     yes           Std       1 URINIT
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ADIR                                  DEVINFO                               BOOTTAPE
     FW_LOAD                               CHN_CFG                               HW_LD_FLAG
     RPM_FLG                               RPM_BOOTIN                            CP6UL
     URCHN                                 SYS_DPX                               S1000_FLG
     ANSBUF                                MTIDCW                                FIELD$
     FIELD_LEN                             DECIM_FLG                             ORDBFLG
     RCV_FLG                               ADPXF                                 B_VECTNIL
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:212  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:213  


      882        1        /*T***********************************************************/
      883        2        /*T*                                                         */
      884        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      885        4        /*T*                                                         */
      886        5        /*T***********************************************************/
      887        6        FIX_FIRM:PROC;

      6  2 000000   000000 700200 xent  FIX_FIRM     TSX0  ! X66_AUTO_0
         2 000001   000012 000000                    ZERO    10,0

      888        7        %INCLUDE IS$MACROS;
      889     1282    1   DCL IPCW_PL6 ENTRY(1);
      890     1283    1   DCL FWRXX ENTRY(1) ALTRET;
      891     1284    1   DCL BUILDFW_DCWS ENTRY(2);
      892     1285    1   DCL POFWR ENTRY(3) ALTRET;
      893     1286    1   DCL TYPEC ENTRY(1);
      894     1287    1   DCL KEYIN ENTRY(2) ALTRET;
      895     1288    1   DCL GETFD ENTRY(2) ALTRET;
      896     1289    1   DCL HANG ENTRY;
      897     1290    1   DCL MTINIT ENTRY ALTRET;
      898     1291    1   DCL DCINIT ENTRY ALTRET;
      899     1292    1   DCL URINIT ENTRY(1) ALTRET;
      900     1293    1   DCL LPINIT ENTRY(1) ALTRET;
      901     1294    1   DCL MINIQ_PL6 ENTRY(5) ALTRET;
      902     1295    1   DCL GT_SYSPACKAD ENTRY(1);
      903     1296    1   DCL   CLEAR_CACHE ENTRY;
      904     1297    1   DCL   START_IO_RPM ENTRY(2);
      905     1298        /**/
      906     1299        %DISKDIR(NAME=ADIR,STCLASS="SYMREF");
      907     1555    1   DCL NAVHDR$ STATIC SYMDEF PTR;          /* Next available firmware header     */
      908     1556    1   DCL NEWNAVHDR$ PTR;
      909     1557    1   DCL FW$ STATIC SYMDEF PTR INIT(ADDR(CP6UL)); /* Pointer to the firmware buffer */
      910     1558        %PTR_STRUCT(NAME=FW_PTR,STCLASS="REDEF FW$");
      911     1576    1   DCL FWHDR$ PTR STATIC SYMDEF INIT(ADDR(ADIR.FW(0))); /* Pointer to firm header */
      912     1577        %PTR_STRUCT(NAME=FWHDR_PTR,STCLASS="REDEF FWHDR$");
      913     1595    1   DCL NEWFWHDR$ PTR STATIC;
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:214  
      914     1596        %PTR_STRUCT(NAME=NEWFWHDR_PTR,STCLASS="REDEF NEWFWHDR$");
      915     1614        %PTR_STRUCT(NAME=DCFWSTART_PTR);        /* Pointer to disk firmware           */
      916     1632    1   DCL DCFWSTART$ REDEF DCFWSTART_PTR PTR;
      917     1633        %PTR_STRUCT(NAME=FWSTART_PTR);          /* Pointer to firmware start          */
      918     1651    1   DCL FWSTART$ REDEF FWSTART_PTR PTR;
      919     1652    1   DCL DCFWHDR$ PTR STATIC SYMDEF;
      920     1653        %FWHDR;                                 /* Description of firmware header     */
      921     1662        %DEVINFO(STCLASS="SYMREF");
      922     1731        /**/
      923     1732        /* Firmware tables */
      924     1733        %FW_TAB(NAME=TAPE_FW,ENT#=3);
      925     1750        %FW_TAB(NAME=DISK_FW,ENT#=3);
      926     1767        %FW_TAB(NAME=UR_FW,ENT#=3);
      927     1784        %FW_TAB(NAME=LP_FW,ENT#=1);
      928     1801        %FW_TAB(NAME=CRP_FW,ENT#=1);
      929     1818        /**/
      930     1819    1   DCL   BOOTTAPE UBIN WORD SYMREF;
      931     1820    1   DCL   FW_LOAD(0:511) BIT(1) UNAL SYMREF;
      932     1821    1   DCL   CHN_CFG(0:511) BIT(1) UNAL SYMREF;
      933     1822    1   DCL 1 HW_LD_FLAG SYMREF,
      934     1823    1         2 CR_FW BIT(1) UNAL,
      935     1824    1         2 DISK_FW BIT(1) UNAL,
      936     1825    1         2 LP_FW BIT(1) UNAL,
      937     1826    1         2 TAPE_FW BIT(1) UNAL,
      938     1827    1         2 * BIT(5) UNAL;
      939     1828    1   DCL   RPM_FLG BIT(1) SYMREF;
      940     1829    1   DCL   DO_RPM_CFG ENTRY(1) ALTRET;
      941     1830    1   DCL 1 RPM_BOOTIN SYMREF,
      942     1831    1         2 * BIT(9),
      943     1832    1         2 CHN# UBIN(9) UNAL,
      944     1833    1         2 * BIT(7),
      945     1834    1         2 IMX# UBIN(2) UNAL,
      946     1835    1         2 * BIT(9);
      947     1836    1   DCL   TEMP_IMX SBIN WORD;
      948     1837    1   DCL CP6UL BIT(1) SYMREF;                /* Top of already used memory         */
      949     1838    1   DCL URCHN UBIN WORD SYMREF;
      950     1839    1   DCL SYS_DPX UBIN WORD SYMREF;           /* System disk index in DEVINFO       */
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:215  
      951     1840    1   DCL S1000_FLG BIT(1) SYMREF;
      952     1841    1   DCL 1 ANSBUF SYMREF,
      953     1842    1         2 CNT UBIN WORD,
      954     1843    1         2 TXT UBIN(16);
      955     1844    1   DCL MTIDCW(0:14) BIT(36) ALIGNED SYMREF;
      956     1845    1   DCL FIELD$ PTR SYMREF;
      957     1846    1   DCL FIELD_LEN UBIN WORD SYMREF;
      958     1847    1   DCL FWANS CHAR(2) BASED(FIELD$);
      959     1848    1   DCL DECIM_FLG BIT(1) SYMREF;
      960     1849    1   DCL ORDBFLG BIT(2) SYMREF;
      961     1850    1   DCL RCV_FLG BIT(4) SYMREF;
      962     1851    1   DCL 1 ADPXF SYMREF,
      963     1852    1         2 A BIT(1),
      964     1853    1         2 D BIT(1),
      965     1854    1         2 P BIT(1),
      966     1855    1         2 X BIT(1),
      967     1856    1         2 F BIT(1);
      968     1857        /**/
      969     1858        /* DCWs for firmware writing */
      970     1859        %DCW_STRUCT(NAME=MTCSOD1);              /* MT-MPC CSO DCWs                    */
      971     1877        %DCW_STRUCT(NAME=MTCSOD2);
      972     1895        %DCW_STRUCT(NAME=DCCSOD1);              /* DC-MPC CSO DCWs                    */
      973     1913        %DCW_STRUCT(NAME=DCCSOD2);
      974     1931        %DCW_STRUCT(NAME=URCSOD1);              /* UR-MPC CSO DCWs                    */
      975     1949        %DCW_STRUCT(NAME=URCSOD2);
      976     1967        %DCW_STRUCT(NAME=MTMMOD1);              /* MT-MPC MMO DCWs                    */
      977     1985        %DCW_STRUCT(NAME=MTMMOD2);
      978     2003        %DCW_STRUCT(NAME=DCMMOD1);              /* DC-MPC MMO DCWs                    */
      979     2021        %DCW_STRUCT(NAME=DCMMOD2);
      980     2039        %DCW_STRUCT(NAME=URMMOD1);              /* UR-MPC MMO DCWs                    */
      981     2057        %DCW_STRUCT(NAME=URMMOD2);
      982     2075        %DCW_STRUCT(NAME=LDFWD);                /* PTR400 DCW                         */
      983     2093        %DCW_STRUCT(NAME=CDFWD);                /* CR/CP DCW                          */
      984     2111        /**/
      985     2112    1   DCL ACTFWHD# STATIC SYMDEF UBIN WORD INIT(0); /*Nr of used firmware headers   */
      986     2113    1   DCL EURC_FLG BIT(1) STATIC SYMDEF INIT('0'B);
      987     2114    1   DCL TPUR_FLG BIT(1) STATIC SYMDEF INIT('0'B);
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:216  
      988     2115    1   DCL POFWHD# UBIN WORD;                  /* Nr of headers read from PO tape    */
      989     2116    1   DCL I UBIN WORD;
      990     2117    1   DCL FWTINDX UBIN WORD STATIC SYMDEF INIT(0); /* Index in DEVINFO of FW tape   */
      991     2118        /* Texts */
      992     2119        %TEXTC(N#=FWERR,M#="' Tape error reading firmware.'");
      993     2124        %TEXTC(N#=NOFWRM,M#="' Cannot initialize MPC or cannot find firmware XXXX '");
      994     2129        %TEXTC(N#=POEM,M#="'PO boot aborted...'");
      995     2134        %TEXTC(N#=FWTQ2,M#="' FW Tape = X-XXX-'");
      996     2139    1   DCL MESSAGE$ PTR;
      997     2140    1   DCL 1 TEXTM BASED(MESSAGE$),
      998     2141    1         2 CNT UBIN WORD,
      999     2142    1         2 TXT CHAR(TEXTM.CNT);
     1000     2143        /**/
     1001     2144    1           ADIR.FW='0'B;                   /* Zap FW headers                     */

   2144  2 000002   000000 100400                    MLR     fill='000'O
         2 000003   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000004   000240 000500 xsym               ADSC9   ADIR+160                 cn=0,n=320

     1002     2145    2           IF S1000_FLG='1'B THEN DO; /* On S1000 the firmware is already loaded */

   2145  2 000005   000000 234000 xsym               SZN     S1000_FLG
         2 000006   000053 605000 2                  TPL     s:2167

     1003     2146        /* Load VFC and train image to printers */
     1004     2147    3                 DO I=%FRSTLP TO %(FRSTCR-1);

   2147  2 000007   000001 235007                    LDA     1,DL
         2 000010   200006 755100                    STA     I,,AUTO

     1005     2148    3                   CALL LPINIT(I);

   2148  2 000011   200006 630500                    EPPR0   I,,AUTO
         2 000012   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 000013   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 000014   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000015   000000 701000 xent               TSX1    LPINIT
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:217  
         2 000016   000000 011000                    NOP     0

     1006     2149    3                 END;                      /* DO I=                              */

   2149  2 000017   200006 235100                    LDA     I,,AUTO
         2 000020   000001 035007                    ADLA    1,DL
         2 000021   200006 755100                    STA     I,,AUTO
         2 000022   000002 115007                    CMPA    2,DL
         2 000023   000011 602000 2                  TNC     s:2148

     1007     2150    2   DCIS:
     1008     2151    2                 IF SYS_DPX~=0 THEN GOTO DCIS1; /* We already know system disk addr */

   2151  2 000024   000000 236000 xsym  DCIS         LDQ     SYS_DPX
         2 000025   000037 601000 2                  TNZ     DCIS1

     1009     2152    2                   ELSE;
     1010     2153    2                 IF ADPXF.D='1'B THEN CALL GT_SYSPACKAD(%FRSTDP);
              2153                          /* Get sys pack addr */

   2153  2 000026   000000 236000 xsym               LDQ     ADPXF
         2 000027   200000 316003                    CANQ    65536,DU
         2 000030   000035 600000 2                  TZE     s:2155

   2153  2 000031   000001 630400 3                  EPPR0   1
         2 000032   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000033   000000 701000 xent               TSX1    GT_SYSPACKAD
         2 000034   000000 011000                    NOP     0

     1011     2154    2                   ELSE;
     1012     2155    2                 SYS_DPX=%FRSTDP;

   2155  2 000035   000024 235007                    LDA     20,DL
         2 000036   000000 755000 xsym               STA     SYS_DPX

     1013     2156    2   DCIS1:
     1014     2157        /* Over top of already used memory , allow 1 page for PTCHBF,
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:218  
     1015     2158           next page,page boundary */
     1016     2159    2                 FW$=ADDR(CP6UL);

   2159  2 000037   000002 236000 3     DCIS1        LDQ     2
         2 000040   000001 756000 0                  STQ     FW$

     1017     2160    2                 FW_PTR.WOFFS=(FW_PTR.WOFFS+2048)/1024*1024;

   2160  2 000041   000001 236000 0                  LDQ     FW$
         2 000042   000022 772000                    QRL     18
         2 000043   004000 036007                    ADLQ    2048,DL
         2 000044   000012 772000                    QRL     10
         2 000045   000012 736000                    QLS     10
         2 000046   000000 620006                    EAX0    0,QL
         2 000047   000001 740000 0                  STX0    FW$

     1018     2161    2                 FWSTART$=FW$;

   2161  2 000050   000001 236000 0                  LDQ     FW$
         2 000051   000005 756000 0                  STQ     FWSTART_PTR

     1019     2162    2                 RETURN;

   2162  2 000052   000000 702200 xent               TSX2  ! X66_ARET

     1020     2163    2               END;                        /* THEN                               */
     1021     2164    1             ELSE;
     1022     2165        /**/
     1023     2166        /* build CP6-RPM config tables from RPM - MCA config data */
     1024     2167    2           IF RPM_FLG THEN DO;

   2167  2 000053   000000 234000 xsym               SZN     RPM_FLG
         2 000054   000123 605000 2                  TPL     s:2177

     1025     2168    2                 TEMP_IMX = RPM_BOOTIN.IMX#;

   2168  2 000055   000000 236000 xsym               LDQ     RPM_BOOTIN
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:219  
         2 000056   000011 772000                    QRL     9
         2 000057   000003 376007                    ANQ     3,DL
         2 000060   200004 756100                    STQ     TEMP_IMX,,AUTO

     1026     2169    3                 CALL DO_RPM_CFG(TEMP_IMX) WHENRETURN DO;

   2169  2 000061   200004 630500                    EPPR0   TEMP_IMX,,AUTO
         2 000062   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 000063   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 000064   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000065   000000 701000 xent               TSX1    DO_RPM_CFG
         2 000066   000123 702000 2                  TSX2    s:2177

     1027     2170    3                       HW_LD_FLAG.CR_FW = '0'B;

   2170  2 000067   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 000070   000000 356000 xsym               ANSQ    HW_LD_FLAG

     1028     2171    3                       HW_LD_FLAG.LP_FW = '0'B;

   2171  2 000071   000003 236000 3                  LDQ     3
         2 000072   000000 356000 xsym               ANSQ    HW_LD_FLAG

     1029     2172    3                      HW_LD_FLAG.TAPE_FW = FW_LOAD(DEVINFO.IOM#(BOOTTAPE)*128 +DEVINFO
              2172                                .CHN#(BOOTTAPE));

   2172  2 000073   000000 236000 xsym               LDQ     BOOTTAPE
         2 000074   000014 402007                    MPY     12,DL
         2 000075   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000076   000033 772000                    QRL     27
         2 000077   200010 756100                    STQ     MESSAGE$+1,,AUTO
         2 000100   000000 236000 xsym               LDQ     BOOTTAPE
         2 000101   000014 402007                    MPY     12,DL
         2 000102   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000103   000014 772000                    QRL     12
         2 000104   000600 376007                    ANQ     384,DL
         2 000105   200010 036100                    ADLQ    MESSAGE$+1,,AUTO
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:220  
         2 000106   003000 060406                    CSL     bolr='003'O
         2 000107   000000 000001 xsym               BDSC    FW_LOAD,Q                by=0,bit=0,n=1
         2 000110   000000 030001 xsym               BDSC    HW_LD_FLAG               by=0,bit=3,n=1

     1030     2173    3                      HW_LD_FLAG.DISK_FW = FW_LOAD(DEVINFO.IOM#(%FRSTDP)*128 +DEVINFO.
              2173                                CHN#(%FRSTDP));

   2173  2 000111   000360 236000 xsym               LDQ     DEVINFO+240
         2 000112   000033 772000                    QRL     27
         2 000113   200010 756100                    STQ     MESSAGE$+1,,AUTO
         2 000114   000360 236000 xsym               LDQ     DEVINFO+240
         2 000115   000014 772000                    QRL     12
         2 000116   000600 376007                    ANQ     384,DL
         2 000117   200010 036100                    ADLQ    MESSAGE$+1,,AUTO
         2 000120   003000 060406                    CSL     bolr='003'O
         2 000121   000000 000001 xsym               BDSC    FW_LOAD,Q                by=0,bit=0,n=1
         2 000122   000000 010001 xsym               BDSC    HW_LD_FLAG               by=0,bit=1,n=1

     1031     2174    3                     END;

     1032     2175    2               END;

     1033     2176        /* Initialize firmware tables */
     1034     2177    1           TAPE_FW.MODN(0)=%TPFWNM;

   2177  2 000123   000000 236000 1                  LDQ     0
         2 000124   000011 756000 0                  STQ     TAPE_FW+2

     1035     2178    1           TAPE_FW.MODN(1)=%TPFWN2;

   2178  2 000125   000001 236000 1                  LDQ     1
         2 000126   000012 756000 0                  STQ     TAPE_FW+3

     1036     2179    1           TAPE_FW.MODN(2)=%TPFWN3;

   2179  2 000127   000002 236000 1                  LDQ     2
         2 000130   000013 756000 0                  STQ     TAPE_FW+4
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:221  

     1037     2180        /**/
     1038     2181    1           DISK_FW.MODN(0)=%DCFWNM;

   2181  2 000131   000003 236000 1                  LDQ     3
         2 000132   000016 756000 0                  STQ     DISK_FW+2

     1039     2182    1           DISK_FW.MODN(1)=%DCFWN2;

   2182  2 000133   000004 236000 1                  LDQ     4
         2 000134   000017 756000 0                  STQ     DISK_FW+3

     1040     2183    1           DISK_FW.MODN(2)=%DCFWN3;

   2183  2 000135   000005 236000 1                  LDQ     5
         2 000136   000020 756000 0                  STQ     DISK_FW+4

     1041     2184        /**/
     1042     2185    1           UR_FW.MODN(0)=%URFWN3;

   2185  2 000137   000006 236000 1                  LDQ     6
         2 000140   000023 756000 0                  STQ     UR_FW+2

     1043     2186    1           UR_FW.MODN(1)=%URFWNM;

   2186  2 000141   000007 236000 1                  LDQ     7
         2 000142   000024 756000 0                  STQ     UR_FW+3

     1044     2187    1           UR_FW.MODN(2)=%URFWN2;

   2187  2 000143   000010 236000 1                  LDQ     8
         2 000144   000025 756000 0                  STQ     UR_FW+4

     1045     2188        /**/
     1046     2189    1           LP_FW.MODN(0)=%LPFWNM;

   2189  2 000145   000011 236000 1                  LDQ     9
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:222  
         2 000146   000030 756000 0                  STQ     LP_FW+2

     1047     2190        /**/
     1048     2191    1           CRP_FW.MODN(0)=%CRPFWNM;

   2191  2 000147   000012 236000 1                  LDQ     10
         2 000150   000033 756000 0                  STQ     CRP_FW+2

     1049     2192        /**/
     1050     2193    1           IF HW_LD_FLAG.TAPE_FW THEN

   2193  2 000151   000000 236000 xsym               LDQ     HW_LD_FLAG
         2 000152   040000 316003                    CANQ    16384,DU
         2 000153   000160 600000 2                  TZE     s:2197

     1051     2194    1             CALL IPCW_PL6(%FRSTMT);  /* Initialize MT-MPC for primitive read    */

   2194  2 000154   000004 630400 3                  EPPR0   4
         2 000155   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000156   000000 701000 xent               TSX1    IPCW_PL6
         2 000157   000000 011000                    NOP     0

     1052     2195        /* Over top of already used memory , allow 1 page for PTCHBF,
     1053     2196           next page,page boundary, and allow space for NI$FW header */
     1054     2197    1           DCFWSTART$=ADDR(CP6UL);

   2197  2 000160   000002 236000 3                  LDQ     2
         2 000161   000004 756000 0                  STQ     DCFWSTART_PTR

     1055     2198    1           DCFWSTART_PTR.WOFFS=(DCFWSTART_PTR.WOFFS+2048)/1024*1024+%NIFWHDR;

   2198  2 000162   000004 236000 0                  LDQ     DCFWSTART_PTR
         2 000163   000022 772000                    QRL     18
         2 000164   004000 036007                    ADLQ    2048,DL
         2 000165   000012 772000                    QRL     10
         2 000166   000012 736000                    QLS     10
         2 000167   000013 620006                    EAX0    11,QL
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:223  
         2 000170   000004 740000 0                  STX0    DCFWSTART_PTR

     1056     2199        /* Make room for system disk firmware */
     1057     2200    1           FWSTART_PTR.WOFFS=(DCFWSTART_PTR.WOFFS+%(MAXDCFW-NIFWHDR+1023))/1024*1024;

   2200  2 000171   000004 236000 0                  LDQ     DCFWSTART_PTR
         2 000172   000022 772000                    QRL     18
         2 000173   025764 036007                    ADLQ    11252,DL
         2 000174   000012 772000                    QRL     10
         2 000175   000012 736000                    QLS     10
         2 000176   000000 621006                    EAX1    0,QL
         2 000177   000005 741000 0                  STX1    FWSTART_PTR

     1058     2201    1           FW$=FWSTART$;

   2201  2 000200   000005 236000 0                  LDQ     FWSTART_PTR
         2 000201   000001 756000 0                  STQ     FW$

     1059     2202        /* Read firmware from PO tape */
     1060     2203    1           IF HW_LD_FLAG.TAPE_FW THEN

   2203  2 000202   000000 236000 xsym               LDQ     HW_LD_FLAG
         2 000203   040000 316003                    CANQ    16384,DU
         2 000204   000212 600000 2                  TZE     s:2206

     1061     2204    1             CALL POFWR(BOOTTAPE,'0'B,'0'B) ALTRET(ERPO);

   2204  2 000205   000005 630400 3                  EPPR0   5
         2 000206   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000207   000000 701000 xent               TSX1    POFWR
         2 000210   001150 702000 2                  TSX2    ERPO
         2 000211   000216 710000 2                  TRA     s:2207

     1062     2205    1             ELSE
     1063     2206    1             CALL POFWR(BOOTTAPE,'1'B,'0'B) ALTRET(ERPO);

   2206  2 000212   000010 630400 3                  EPPR0   8
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:224  
         2 000213   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000214   000000 701000 xent               TSX1    POFWR
         2 000215   001150 702000 2                  TSX2    ERPO

     1064     2207    1           NAVHDR$=FWHDR$;                 /* Save next available header address */

   2207  2 000216   000002 236000 0                  LDQ     FWHDR$
         2 000217   000000 756000 0                  STQ     NAVHDR$

     1065     2208    1           POFWHD#=ACTFWHD#;               /* And nr of headers from PO tape     */

   2208  2 000220   000052 235000 0                  LDA     ACTFWHD#
         2 000221   200005 755100                    STA     POFWHD#,,AUTO

     1066     2209    1           NEWNAVHDR$=NAVHDR$;

   2209  2 000222   200003 756100                    STQ     NEWNAVHDR$,,AUTO

     1067     2210        /* Build tape firmware table and initialize MT controller */
     1068     2211    1           IF ~HW_LD_FLAG.TAPE_FW THEN

   2211  2 000223   000000 236000 xsym               LDQ     HW_LD_FLAG
         2 000224   000003 736000                    QLS     3
         2 000225   400000 376003                    ANQ     -131072,DU
         2 000226   400000 676003                    ERQ     -131072,DU
         2 000227   000303 601000 2                  TNZ     SKIP_FW_TAPE_LOAD

     1069     2212    1             GOTO SKIP_FW_TAPE_LOAD;
     1070     2213    2           DO I=0 TO TAPE_FW.FWM#-1;

   2213  2 000230   200006 450100                    STZ     I,,AUTO
         2 000231   000254 710000 2                  TRA     NXT_TFW+3

     1071     2214    3             CALL FWRXX(TAPE_FW.MODN(I)) WHENRETURN DO; /* Look for this firmware */

   2214  2 000232   200006 720100                    LXL0    I,,AUTO
         2 000233   000011 630410 0                  EPPR0   TAPE_FW+2,X0
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:225  
         2 000234   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 000235   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 000236   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000237   000000 701000 xent               TSX1    FWRXX
         2 000240   000251 702000 2                  TSX2    NXT_TFW

     1072     2215    3                   CALL BUILDFW_DCWS(MTCSOD1,MTMMOD1);

   2215  2 000241   000013 630400 3                  EPPR0   11
         2 000242   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000243   000000 701000 xent               TSX1    BUILDFW_DCWS
         2 000244   000000 011000                    NOP     0

     1073     2216    3                   CALL MTINIT ALTRET(NXT_TFW);

   2216  2 000245   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000246   000000 701000 xent               TSX1    MTINIT
         2 000247   000251 702000 2                  TSX2    NXT_TFW

     1074     2217    3                   GOTO MTDONE;
              2217                            /* Found one firmware module that initialized the controller */

   2217  2 000250   000273 710000 2                  TRA     MTDONE

     1075     2218    3                 END;                      /* WHENRETURN                         */
     1076     2219    2   NXT_TFW:
     1077     2220    2           END;                            /* DO I =                             */

   2220  2 000251   200006 235100       NXT_TFW      LDA     I,,AUTO
         2 000252   000001 035007                    ADLA    1,DL
         2 000253   200006 755100                    STA     I,,AUTO
         2 000254   200006 236100                    LDQ     I,,AUTO
         2 000255   000007 116000 0                  CMPQ    TAPE_FW
         2 000256   000232 602000 2                  TNC     s:2214

     1078     2221    1   NOMT:
     1079     2222        /* Couldn't initialize MT ; tell them and hang */
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:226  
     1080     2223    1           MESSAGE$=ADDR(NOFWRM);

   2223  2 000257   000015 236000 3     NOMT         LDQ     13
         2 000260   200007 756100                    STQ     MESSAGE$,,AUTO

     1081     2224    1           SUBSTR(TEXTM.TXT,47,4)='TAPE';

   2224  2 000261   200007 470500                    LDP0    MESSAGE$,,AUTO
         2 000262   000000 720100                    LXL0    0,,PR0
         2 000263   040100 100400                    MLR     fill='040'O
         2 000264   000013 000004 1                  ADSC9   11                       cn=0,n=4
         2 000265   000014 600004                    ADSC9   12,,PR0                  cn=3,n=4

     1082     2225    1           CALL TYPEC(NOFWRM);

   2225  2 000266   000015 630400 3                  EPPR0   13
         2 000267   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000270   000000 701000 xent               TSX1    TYPEC
         2 000271   000000 011000                    NOP     0

     1083     2226    1           GOTO ERPO1;

   2226  2 000272   001154 710000 2                  TRA     ERPO1

     1084     2227    1   MTDONE:
     1085     2228    1           IF TAPE_FW.MODN(I)=%TPFWN2 OR TAPE_FW.MODN(I)=%TPFWN3 THEN

   2228  2 000273   200006 720100       MTDONE       LXL0    I,,AUTO
         2 000274   000011 236010 0                  LDQ     TAPE_FW+2,X0
         2 000275   000001 116000 1                  CMPQ    1
         2 000276   000301 600000 2                  TZE     s:2229
         2 000277   000002 116000 1                  CMPQ    2
         2 000300   000303 601000 2                  TNZ     SKIP_FW_TAPE_LOAD

     1086     2229    1             MTIDCW(6)=MTIDCW(7);          /* Set density to 1600                */

   2229  2 000301   000007 236000 xsym               LDQ     MTIDCW+7
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:227  
         2 000302   000006 756000 xsym               STQ     MTIDCW+6

     1087     2230        /* See if FW tape requested */
     1088     2231    1   SKIP_FW_TAPE_LOAD:
     1089     2232    1           IF ADPXF.F='0'B THEN

   2232  2 000303   000000 236000 xsym  SKIP_FW_TAP* LDQ     ADPXF
         2 000304   020000 316003                    CANQ    8192,DU
         2 000305   000312 601000 2                  TNZ     s:2239

     1090     2233    1             IF HW_LD_FLAG.TAPE_FW THEN

   2233  2 000306   000000 236000 xsym               LDQ     HW_LD_FLAG
         2 000307   040000 316003                    CANQ    16384,DU
         2 000310   000454 601000 2                  TNZ     NOFWT

     1091     2234    1               GOTO NOFWT;
     1092     2235    1               ELSE
     1093     2236    1               GOTO DO_LP_FW;

   2236  2 000311   000522 710000 2                  TRA     DO_LP_FW

     1094     2237    1             ELSE;
     1095     2238        /* Firmware tape requested,ask for address */
     1096     2239    1           MESSAGE$=ADDR(FWTQ2);

   2239  2 000312   000016 236000 3                  LDQ     14
         2 000313   200007 756100                    STQ     MESSAGE$,,AUTO

     1097     2240    1           SUBSTR(TEXTM.TXT,11,6)=SUBSTR(DEVINFO.DEVNAME(%FRSTMT),0,6);

   2240  2 000314   200007 470500                    LDP0    MESSAGE$,,AUTO
         2 000315   000000 720100                    LXL0    0,,PR0
         2 000316   040100 100400                    MLR     fill='040'O
         2 000317   000052 000006 xsym               ADSC9   DEVINFO+42               cn=0,n=6
         2 000320   000003 600006                    ADSC9   3,,PR0                   cn=3,n=6

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:228  
     1098     2241    1   ASKFWT1:
     1099     2242    1           CALL KEYIN(FWTQ2,ANSBUF);

   2242  2 000321   000017 630400 3     ASKFWT1      EPPR0   15
         2 000322   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000323   000000 701000 xent               TSX1    KEYIN
         2 000324   000000 011000                    NOP     0

     1100     2243    1           CALL GETFD(ANSBUF.TXT,16) ALTRET(NOFWT);

   2243  2 000325   000022 630400 3                  EPPR0   18
         2 000326   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000327   000000 701000 xent               TSX1    GETFD
         2 000330   000454 702000 2                  TSX2    NOFWT

     1101     2244    1           IF FIELD_LEN>2 OR DECIM_FLG='0'B THEN GOTO ASKFWT1; /* Ask again      */

   2244  2 000331   000000 235000 xsym               LDA     FIELD_LEN
         2 000332   000003 115007                    CMPA    3,DL
         2 000333   000321 603000 2                  TRC     ASKFWT1
         2 000334   000000 234000 xsym               SZN     DECIM_FLG
         2 000335   000321 605000 2                  TPL     ASKFWT1

     1102     2245    1             ELSE;
     1103     2246    2           IF FIELD_LEN=1 THEN DO;         /* Make it a 2 digit field            */

   2246  2 000336   000001 115007                    CMPA    1,DL
         2 000337   000350 601000 2                  TNZ     s:2251

     1104     2247    2                 SUBSTR(FWANS,1,1)=SUBSTR(FWANS,0,1);

   2247  2 000340   000000 470400 xsym               LDP0    FIELD$
         2 000341   040100 100500                    MLR     fill='040'O
         2 000342   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         2 000343   000000 200001                    ADSC9   0,,PR0                   cn=1,n=1

     1105     2248    2                 SUBSTR(FWANS,0,1)='0';
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:229  

   2248  2 000344   000000 470400 xsym               LDP0    FIELD$
         2 000345   040100 100400                    MLR     fill='040'O
         2 000346   000024 000001 3                  ADSC9   20                       cn=0,n=1
         2 000347   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

     1106     2249    2               END;                        /* THEN                               */

     1107     2250    1             ELSE;
     1108     2251    2           DO I=%FRSTMT TO %FRSTDP-1;

   2251  2 000350   000003 235007                    LDA     3,DL
         2 000351   200006 755100                    STA     I,,AUTO
         2 000352   000365 710000 2                  TRA     s:2254+3

     1109     2252    2             IF SUBSTR(DEVINFO.DEVNAME(I),6,2)=FWANS THEN GOTO DOFWT;

   2252  2 000353   200006 236100                    LDQ     I,,AUTO
         2 000354   000060 402007                    MPY     48,DL
         2 000355   000000 470400 xsym               LDP0    FIELD$
         2 000356   040100 106406                    CMPC    fill='040'O
         2 000357   000007 400002 xsym               ADSC9   DEVINFO+7,Q              cn=2,n=2
         2 000360   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         2 000361   000370 600000 2                  TZE     DOFWT

     1110     2253    2               ELSE;
     1111     2254    2           END;                            /* ELSE DO I=                         */

   2254  2 000362   200006 235100                    LDA     I,,AUTO
         2 000363   000001 035007                    ADLA    1,DL
         2 000364   200006 755100                    STA     I,,AUTO
         2 000365   000024 115007                    CMPA    20,DL
         2 000366   000353 602000 2                  TNC     s:2252

     1112     2255    1           GOTO ASKFWT1;                   /* Device not found                   */

   2255  2 000367   000321 710000 2                  TRA     ASKFWT1
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:230  

     1113     2256    1   DOFWT:
     1114     2257    1           FWTINDX=I;                      /* Index of FW tape in DEVINFO        */

   2257  2 000370   200006 235100       DOFWT        LDA     I,,AUTO
         2 000371   000055 755000 0                  STA     FWTINDX

     1115     2258        /* Wait a second */
     1116     2259    2           DO I=0 TO 32000;

   2259  2 000372   200006 450100                    STZ     I,,AUTO

     1117     2260    2           END;                            /* DO I=                              */

   2260  2 000373   200006 235100                    LDA     I,,AUTO
         2 000374   000001 035007                    ADLA    1,DL
         2 000375   200006 755100                    STA     I,,AUTO
         2 000376   076401 115007                    CMPA    32001,DL
         2 000377   000373 602000 2                  TNC     s:2260

     1118     2261    1           FWHDR$=NAVHDR$;

   2261  2 000400   000000 236000 0                  LDQ     NAVHDR$
         2 000401   000002 756000 0                  STQ     FWHDR$

     1119     2262    1           CALL POFWR(FWTINDX,'1'B,'1'B);

   2262  2 000402   000025 630400 3                  EPPR0   21
         2 000403   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000404   000000 701000 xent               TSX1    POFWR
         2 000405   000000 011000                    NOP     0

     1120     2263    1           CALL MINIQ_PL6(FWTINDX,0,0,%FCNUNL); /* Unload the FW tape            */

   2263  2 000406   000030 630400 3                  EPPR0   24
         2 000407   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 000410   000000 701000 xent               TSX1    MINIQ_PL6
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:231  
         2 000411   000000 011000                    NOP     0

     1121     2264    1           NEWFWHDR$=NAVHDR$;

   2264  2 000412   000000 236000 0                  LDQ     NAVHDR$
         2 000413   000003 756000 0                  STQ     NEWFWHDR$

     1122     2265    1           NEWNAVHDR$=FWHDR$;

   2265  2 000414   000002 236000 0                  LDQ     FWHDR$
         2 000415   200003 756100                    STQ     NEWNAVHDR$,,AUTO

     1123     2266        /* See if duplicate modules ; if YES replace the old ones */
     1124     2267    1           IF ACTFWHD#=POFWHD# THEN GOTO NOFWT; /* No modules read from FW tape  */

   2267  2 000416   000052 236000 0                  LDQ     ACTFWHD#
         2 000417   200005 116100                    CMPQ    POFWHD#,,AUTO
         2 000420   000454 600000 2                  TZE     NOFWT

     1125     2268    2             ELSE DO I=POFWHD#+1 TO ACTFWHD#;

   2268  2 000421   200005 235100                    LDA     POFWHD#,,AUTO
         2 000422   000001 035007                    ADLA    1,DL
         2 000423   200006 755100                    STA     I,,AUTO
         2 000424   000451 710000 2                  TRA     s:2274+3

     1126     2269    2                 CALL FWRXX(NEWFWHDR$->FWHDR.FWNAME) ALTRET(NDUP);
              2269                          /* See if module exists in firmware read from PO tape */

   2269  2 000425   000003 236000 0                  LDQ     NEWFWHDR$
         2 000426   000003 036003                    ADLQ    3,DU
         2 000427   200010 756100                    STQ     MESSAGE$+1,,AUTO
         2 000430   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 000431   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000432   000000 701000 xent               TSX1    FWRXX
         2 000433   000443 702000 2                  TSX2    NDUP

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:232  
     1127     2270    2                 FWHDR=NEWFWHDR$->FWHDR; /* Yes, replace old header with new one */

   2270  2 000434   000003 470400 0                  LDP0    NEWFWHDR$
         2 000435   000002 471400 0                  LDP1    FWHDR$
         2 000436   000100 100500                    MLR     fill='000'O
         2 000437   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16
         2 000440   100000 000020                    ADSC9   0,,PR1                   cn=0,n=16

     1128     2271    2                 NEWFWHDR$->FWHDR.FWNAME='XXXX'; /* and invalidate new header    */

   2271  2 000441   000014 236000 1                  LDQ     12
         2 000442   000003 756100                    STQ     3,,PR0

     1129     2272    2   NDUP:
     1130     2273    2                 NEWFWHDR_PTR.WOFFS=NEWFWHDR_PTR.WOFFS+4; /* Next header         */

   2273  2 000443   000003 220000 0     NDUP         LDX0    NEWFWHDR$
         2 000444   000004 621010                    EAX1    4,X0
         2 000445   000003 741000 0                  STX1    NEWFWHDR$

     1131     2274    2               END;                        /* ELSE DO I=                         */

   2274  2 000446   200006 235100                    LDA     I,,AUTO
         2 000447   000001 035007                    ADLA    1,DL
         2 000450   200006 755100                    STA     I,,AUTO
         2 000451   000052 236000 0                  LDQ     ACTFWHD#
         2 000452   200006 116100                    CMPQ    I,,AUTO
         2 000453   000425 603000 2                  TRC     s:2269

     1132     2275        /* All firmware in memory */
     1133     2276        /* Initialize controllers */
     1134     2277    1   NOFWT:
     1135     2278    1           IF ~HW_LD_FLAG.TAPE_FW THEN

   2278  2 000454   000000 236000 xsym  NOFWT        LDQ     HW_LD_FLAG
         2 000455   000003 736000                    QLS     3
         2 000456   400000 376003                    ANQ     -131072,DU
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:233  
         2 000457   400000 676003                    ERQ     -131072,DU
         2 000460   000522 601000 2                  TNZ     DO_LP_FW

     1136     2279    1             GOTO DO_LP_FW;
     1137     2280    1           NAVHDR$=NEWNAVHDR$;

   2280  2 000461   200003 236100                    LDQ     NEWNAVHDR$,,AUTO
         2 000462   000000 756000 0                  STQ     NAVHDR$

     1138     2281        /* Reinitialize MT controller */
     1139     2282    2           DO I=0 TO TAPE_FW.FWM#-1;

   2282  2 000463   200006 450100                    STZ     I,,AUTO
         2 000464   000507 710000 2                  TRA     NXT_TFW1+3

     1140     2283    3             CALL FWRXX(TAPE_FW.MODN(I)) WHENRETURN DO; /* Look for this firmware */

   2283  2 000465   200006 720100                    LXL0    I,,AUTO
         2 000466   000011 630410 0                  EPPR0   TAPE_FW+2,X0
         2 000467   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 000470   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 000471   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000472   000000 701000 xent               TSX1    FWRXX
         2 000473   000504 702000 2                  TSX2    NXT_TFW1

     1141     2284    3                   CALL BUILDFW_DCWS(MTCSOD1,MTMMOD1);

   2284  2 000474   000013 630400 3                  EPPR0   11
         2 000475   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000476   000000 701000 xent               TSX1    BUILDFW_DCWS
         2 000477   000000 011000                    NOP     0

     1142     2285    3                   CALL MTINIT ALTRET(NXT_TFW1);

   2285  2 000500   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000501   000000 701000 xent               TSX1    MTINIT
         2 000502   000504 702000 2                  TSX2    NXT_TFW1
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:234  

     1143     2286    3                   GOTO MTDONE1;
              2286                            /* Found one firmware module that initialized the controller */

   2286  2 000503   000513 710000 2                  TRA     MTDONE1

     1144     2287    3                 END;                      /* WHENRETURN                         */
     1145     2288    2   NXT_TFW1:
     1146     2289    2           END;                            /* DO I =                             */

   2289  2 000504   200006 235100       NXT_TFW1     LDA     I,,AUTO
         2 000505   000001 035007                    ADLA    1,DL
         2 000506   200006 755100                    STA     I,,AUTO
         2 000507   200006 236100                    LDQ     I,,AUTO
         2 000510   000007 116000 0                  CMPQ    TAPE_FW
         2 000511   000465 602000 2                  TNC     s:2283

     1147     2290    1           GOTO NOMT;

   2290  2 000512   000257 710000 2                  TRA     NOMT

     1148     2291    1   MTDONE1:
     1149     2292    1           TAPE_FW.FW_INDX=I;

   2292  2 000513   200006 235100       MTDONE1      LDA     I,,AUTO
         2 000514   000010 755000 0                  STA     TAPE_FW+1

     1150     2293    1           IF TAPE_FW.MODN(I)='TPUR' THEN TPUR_FLG='1'B;

   2293  2 000515   000011 236005 0                  LDQ     TAPE_FW+2,AL
         2 000516   000002 116000 1                  CMPQ    2
         2 000517   000522 601000 2                  TNZ     DO_LP_FW

   2293  2 000520   400000 236003                    LDQ     -131072,DU
         2 000521   000054 756000 0                  STQ     TPUR_FLG

     1151     2294    1             ELSE;
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:235  
     1152     2295        /* Initialize UR controller */
     1153     2296    1   DO_LP_FW:
     1154     2297    1           IF ~HW_LD_FLAG.LP_FW THEN

   2297  2 000522   000000 236000 xsym  DO_LP_FW     LDQ     HW_LD_FLAG
         2 000523   000002 736000                    QLS     2
         2 000524   400000 376003                    ANQ     -131072,DU
         2 000525   400000 676003                    ERQ     -131072,DU
         2 000526   000534 600000 2                  TZE     s:2301

     1155     2298    1             IF ~HW_LD_FLAG.CR_FW THEN

   2298  2 000527   000000 236000 xsym               LDQ     HW_LD_FLAG
         2 000530   400000 376003                    ANQ     -131072,DU
         2 000531   400000 676003                    ERQ     -131072,DU
         2 000532   000752 601000 2                  TNZ     DP_NEXT

     1156     2299    1               GOTO DP_NEXT;
     1157     2300    1               ELSE GOTO LPDONE1;

   2300  2 000533   000574 710000 2                  TRA     LPDONE1

     1158     2301    2           DO I=0 TO LP_FW.FWM#-1;         /* Look for LP application firmware   */

   2301  2 000534   200006 450100                    STZ     I,,AUTO
         2 000535   000557 710000 2                  TRA     s:2307+3

     1159     2302    3             CALL FWRXX(LP_FW.MODN(I)) WHENRETURN DO;

   2302  2 000536   200006 720100                    LXL0    I,,AUTO
         2 000537   000030 630410 0                  EPPR0   LP_FW+2,X0
         2 000540   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 000541   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 000542   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000543   000000 701000 xent               TSX1    FWRXX
         2 000544   000554 702000 2                  TSX2    s:2307

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:236  
     1160     2303    3                   LDFWD.AD=FWHDR.BUFAD;

   2303  2 000545   000002 470400 0                  LDP0    FWHDR$
         2 000546   000000 720100                    LXL0    0,,PR0
         2 000547   000050 740000 0                  STX0    LDFWD

     1161     2304    3                   LDFWD.TALLY=FWHDR.CSOSIZE;

   2304  2 000550   000002 236100                    LDQ     2,,PR0
         2 000551   000022 772000                    QRL     18
         2 000552   000050 752003 0                  STCQ    LDFWD,'03'O

     1162     2305    3                   GOTO LPDONE;

   2305  2 000553   000562 710000 2                  TRA     LPDONE

     1163     2306    3                 END;                      /* WHENRETURN                         */
     1164     2307    2           END;                            /* DO I=                              */

   2307  2 000554   200006 235100                    LDA     I,,AUTO
         2 000555   000001 035007                    ADLA    1,DL
         2 000556   200006 755100                    STA     I,,AUTO
         2 000557   200006 236100                    LDQ     I,,AUTO
         2 000560   000026 116000 0                  CMPQ    LP_FW
         2 000561   000536 602000 2                  TNC     s:2302

     1165     2308    1   LPDONE:
     1166     2309    1           LP_FW.FW_INDX=I;

   2309  2 000562   200006 235100       LPDONE       LDA     I,,AUTO
         2 000563   000027 755000 0                  STA     LP_FW+1

     1167     2310    2           IF ~HW_LD_FLAG.CR_FW THEN DO;

   2310  2 000564   000000 236000 xsym               LDQ     HW_LD_FLAG
         2 000565   400000 376003                    ANQ     -131072,DU
         2 000566   400000 676003                    ERQ     -131072,DU
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:237  
         2 000567   000574 600000 2                  TZE     LPDONE1

     1168     2311    2                 I = 0;

   2311  2 000570   200006 450100                    STZ     I,,AUTO

     1169     2312    2                 EURC_FLG = '1'B;

   2312  2 000571   400000 236003                    LDQ     -131072,DU
         2 000572   000053 756000 0                  STQ     EURC_FLG

     1170     2313    2                 GOTO TRY_LP1;

   2313  2 000573   000634 710000 2                  TRA     TRY_LP1

     1171     2314    2               END;
     1172     2315    1   LPDONE1:
     1173     2316    2           DO I=0 TO CRP_FW.FWM#-1;   /* Look for CR CP application firmware     */

   2316  2 000574   200006 450100       LPDONE1      STZ     I,,AUTO
         2 000575   000617 710000 2                  TRA     s:2322+3

     1174     2317    3             CALL FWRXX(CRP_FW.MODN(I)) WHENRETURN DO;

   2317  2 000576   200006 720100                    LXL0    I,,AUTO
         2 000577   000033 630410 0                  EPPR0   CRP_FW+2,X0
         2 000600   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 000601   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 000602   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000603   000000 701000 xent               TSX1    FWRXX
         2 000604   000614 702000 2                  TSX2    s:2322

     1175     2318    3                   CDFWD.AD=FWHDR.BUFAD;

   2318  2 000605   000002 470400 0                  LDP0    FWHDR$
         2 000606   000000 720100                    LXL0    0,,PR0
         2 000607   000051 740000 0                  STX0    CDFWD
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:238  

     1176     2319    3                   CDFWD.TALLY=FWHDR.CSOSIZE;

   2319  2 000610   000002 236100                    LDQ     2,,PR0
         2 000611   000022 772000                    QRL     18
         2 000612   000051 752003 0                  STCQ    CDFWD,'03'O

     1177     2320    3                   GOTO CRDONE;

   2320  2 000613   000622 710000 2                  TRA     CRDONE

     1178     2321    3                 END;                      /* WHENRETURN                         */
     1179     2322    2           END;                            /* DO I=                              */

   2322  2 000614   200006 235100                    LDA     I,,AUTO
         2 000615   000001 035007                    ADLA    1,DL
         2 000616   200006 755100                    STA     I,,AUTO
         2 000617   200006 236100                    LDQ     I,,AUTO
         2 000620   000031 116000 0                  CMPQ    CRP_FW
         2 000621   000576 602000 2                  TNC     s:2317

     1180     2323    1   CRDONE:
     1181     2324    1           CRP_FW.FW_INDX=I;

   2324  2 000622   200006 235100       CRDONE       LDA     I,,AUTO
         2 000623   000032 755000 0                  STA     CRP_FW+1

     1182     2325        /* Try EURC first */
     1183     2326    1           I=0;

   2326  2 000624   200006 450100                    STZ     I,,AUTO

     1184     2327    1           EURC_FLG='1'B;

   2327  2 000625   400000 236003                    LDQ     -131072,DU
         2 000626   000053 756000 0                  STQ     EURC_FLG

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:239  
     1185     2328    1           CALL URINIT(%FRSTCR) ALTRET(TRY_LP1);

   2328  2 000627   000034 630400 3                  EPPR0   28
         2 000630   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000631   000000 701000 xent               TSX1    URINIT
         2 000632   000634 702000 2                  TSX2    TRY_LP1

     1186     2329    1           GOTO URDONE;

   2329  2 000633   000750 710000 2                  TRA     URDONE

     1187     2330    1   TRY_LP1:
     1188     2331    1           CALL URINIT(%FRSTLP) ALTRET(OTH_URFW);

   2331  2 000634   000035 630400 3     TRY_LP1      EPPR0   29
         2 000635   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000636   000000 701000 xent               TSX1    URINIT
         2 000637   000646 702000 2                  TSX2    OTH_URFW

     1189     2332    1           IF ~HW_LD_FLAG.LP_FW THEN

   2332  2 000640   000000 236000 xsym               LDQ     HW_LD_FLAG
         2 000641   000002 736000                    QLS     2
         2 000642   400000 376003                    ANQ     -131072,DU
         2 000643   400000 676003                    ERQ     -131072,DU
         2 000644   000646 601000 2                  TNZ     OTH_URFW

     1190     2333    1             GOTO OTH_URFW;
     1191     2334    1           GOTO URDONE;

   2334  2 000645   000750 710000 2                  TRA     URDONE

     1192     2335    1   OTH_URFW:
     1193     2336    1           EURC_FLG='0'B;                  /* No EURC , try other firmware       */

   2336  2 000646   000053 450000 0     OTH_URFW     STZ     EURC_FLG

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:240  
     1194     2337    2           DO I=1 TO UR_FW.FWM#-1;

   2337  2 000647   000001 235007                    LDA     1,DL
         2 000650   200006 755100                    STA     I,,AUTO
         2 000651   000707 710000 2                  TRA     NXT_UFW+3

     1195     2338    3             CALL FWRXX(UR_FW.MODN(I)) WHENRETURN DO;

   2338  2 000652   200006 720100                    LXL0    I,,AUTO
         2 000653   000023 630410 0                  EPPR0   UR_FW+2,X0
         2 000654   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 000655   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 000656   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000657   000000 701000 xent               TSX1    FWRXX
         2 000660   000704 702000 2                  TSX2    NXT_UFW

     1196     2339    3                   CALL BUILDFW_DCWS(URCSOD1,URMMOD1);

   2339  2 000661   000036 630400 3                  EPPR0   30
         2 000662   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000663   000000 701000 xent               TSX1    BUILDFW_DCWS
         2 000664   000000 011000                    NOP     0

     1197     2340    4                   IF HW_LD_FLAG.CR_FW THEN DO;

   2340  2 000665   000000 234000 xsym               SZN     HW_LD_FLAG
         2 000666   000674 605000 2                  TPL     TRY_LP2

     1198     2341    4                         CALL URINIT(%FRSTCR) ALTRET(TRY_LP2);

   2341  2 000667   000034 630400 3                  EPPR0   28
         2 000670   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000671   000000 701000 xent               TSX1    URINIT
         2 000672   000674 702000 2                  TSX2    TRY_LP2

     1199     2342    4                         GOTO URDONE;

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:241  
   2342  2 000673   000750 710000 2                  TRA     URDONE

     1200     2343    4                       END;
     1201     2344    3   TRY_LP2:
     1202     2345    4                   IF HW_LD_FLAG.LP_FW THEN DO;

   2345  2 000674   000000 236000 xsym  TRY_LP2      LDQ     HW_LD_FLAG
         2 000675   100000 316003                    CANQ    32768,DU
         2 000676   000704 600000 2                  TZE     NXT_UFW

     1203     2346    4                         CALL URINIT(%FRSTLP) ALTRET(NXT_UFW);

   2346  2 000677   000035 630400 3                  EPPR0   29
         2 000700   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000701   000000 701000 xent               TSX1    URINIT
         2 000702   000704 702000 2                  TSX2    NXT_UFW

     1204     2347    4                         GOTO URDONE;

   2347  2 000703   000750 710000 2                  TRA     URDONE

     1205     2348    4                       END;
     1206     2349    3                 END;                      /* WHENRETURN                         */
     1207     2350    2   NXT_UFW:
     1208     2351    2           END;                            /* DO I=                              */

   2351  2 000704   200006 235100       NXT_UFW      LDA     I,,AUTO
         2 000705   000001 035007                    ADLA    1,DL
         2 000706   200006 755100                    STA     I,,AUTO
         2 000707   200006 236100                    LDQ     I,,AUTO
         2 000710   000021 116000 0                  CMPQ    UR_FW
         2 000711   000652 602000 2                  TNC     s:2338

     1209     2352        /* Couldn't initialize UR controller */
     1210     2353    2           DO I=%FRSTLP TO %(FRSTMT-1);    /* Mark UR devices down               */

   2353  2 000712   000001 235007                    LDA     1,DL
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:242  
         2 000713   200006 755100                    STA     I,,AUTO

     1211     2354    2             DEVINFO.BITS(I)='1'B;

   2354  2 000714   200006 236100                    LDQ     I,,AUTO
         2 000715   000014 402007                    MPY     12,DL
         2 000716   000000 620006                    EAX0    0,QL
         2 000717   400000 236003                    LDQ     -131072,DU
         2 000720   000001 756010 xsym               STQ     DEVINFO+1,X0

     1212     2355    2           END;                            /* DO I=                              */

   2355  2 000721   200006 235100                    LDA     I,,AUTO
         2 000722   000001 035007                    ADLA    1,DL
         2 000723   200006 755100                    STA     I,,AUTO
         2 000724   000003 115007                    CMPA    3,DL
         2 000725   000714 602000 2                  TNC     s:2354

     1213     2356    1           URCHN=0;                        /*For TIGR                            */

   2356  2 000726   000000 450000 xsym               STZ     URCHN

     1214     2357    1           MESSAGE$=ADDR(NOFWRM);

   2357  2 000727   000015 236000 3                  LDQ     13
         2 000730   200007 756100                    STQ     MESSAGE$,,AUTO

     1215     2358    1           SUBSTR(TEXTM.TXT,47,4)=' UR ';

   2358  2 000731   200007 470500                    LDP0    MESSAGE$,,AUTO
         2 000732   000000 720100                    LXL0    0,,PR0
         2 000733   040100 100400                    MLR     fill='040'O
         2 000734   000015 000004 1                  ADSC9   13                       cn=0,n=4
         2 000735   000014 600004                    ADSC9   12,,PR0                  cn=3,n=4

     1216     2359    1           CALL TYPEC(NOFWRM);

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:243  
   2359  2 000736   000015 630400 3                  EPPR0   13
         2 000737   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000740   000000 701000 xent               TSX1    TYPEC
         2 000741   000000 011000                    NOP     0

     1217     2360        /* Make sure MT is running */
     1218     2361    1           IF TPUR_FLG='1'B THEN CALL MTINIT ALTRET(NOMT);

   2361  2 000742   000054 234000 0                  SZN     TPUR_FLG
         2 000743   000747 605000 2                  TPL     s:2363

   2361  2 000744   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000745   000000 701000 xent               TSX1    MTINIT
         2 000746   000257 702000 2                  TSX2    NOMT

     1219     2362    1             ELSE;
     1220     2363    1           GOTO DCI;

   2363  2 000747   001024 710000 2                  TRA     DCI

     1221     2364    1   URDONE:
     1222     2365    1           UR_FW.FW_INDX=I;

   2365  2 000750   200006 235100       URDONE       LDA     I,,AUTO
         2 000751   000022 755000 0                  STA     UR_FW+1

     1223     2366    1   DP_NEXT:
     1224     2367    1           RCV_FLG=ORDBFLG;

   2367  2 000752   000000 236000 xsym  DP_NEXT      LDQ     ORDBFLG
         2 000753   600000 376003                    ANQ     -65536,DU
         2 000754   000000 756000 xsym               STQ     RCV_FLG

     1225     2368    1           IF ORDBFLG~='0'B THEN GOTO DCI;

   2368  2 000755   000000 236000 xsym               LDQ     ORDBFLG
         2 000756   600000 316003                    CANQ    -65536,DU
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:244  
         2 000757   001024 601000 2                  TNZ     DCI

     1226     2369    1             ELSE;
     1227     2370        /* Load VFC and train image to printers */
     1228     2371    2           DO I=%FRSTLP TO %(FRSTCR-1);

   2371  2 000760   000001 235007                    LDA     1,DL
         2 000761   200006 755100                    STA     I,,AUTO

     1229     2372    2             IF NOT RPM_FLG OR CHN_CFG( DEVINFO.IOM#(I) *128 + DEVINFO.CHN#(I)) THEN

   2372  2 000762   000000 234000 xsym               SZN     RPM_FLG
         2 000763   001003 605000 2                  TPL     s:2373
         2 000764   200006 236100                    LDQ     I,,AUTO
         2 000765   000014 402007                    MPY     12,DL
         2 000766   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000767   000033 772000                    QRL     27
         2 000770   200010 756100                    STQ     MESSAGE$+1,,AUTO
         2 000771   200006 236100                    LDQ     I,,AUTO
         2 000772   000014 402007                    MPY     12,DL
         2 000773   000000 236006 xsym               LDQ     DEVINFO,QL
         2 000774   000014 772000                    QRL     12
         2 000775   000600 376007                    ANQ     384,DL
         2 000776   200010 036100                    ADLQ    MESSAGE$+1,,AUTO
         2 000777   000000 066406                    CMPB    filb='0'B
         2 001000   000000 000001 xsym               BDSC    CHN_CFG,Q                by=0,bit=0,n=1
         2 001001   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         2 001002   001012 600000 2                  TZE     s:2375

     1230     2373    2               CALL LPINIT(I);

   2373  2 001003   200006 630500                    EPPR0   I,,AUTO
         2 001004   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 001005   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 001006   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001007   000000 701000 xent               TSX1    LPINIT
         2 001010   000000 011000                    NOP     0
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:245  
         2 001011   001017 710000 2                  TRA     s:2376

     1231     2374    2               ELSE
     1232     2375    2               DEVINFO.BITS(I) = '1'B;

   2375  2 001012   200006 236100                    LDQ     I,,AUTO
         2 001013   000014 402007                    MPY     12,DL
         2 001014   000000 620006                    EAX0    0,QL
         2 001015   400000 236003                    LDQ     -131072,DU
         2 001016   000001 756010 xsym               STQ     DEVINFO+1,X0

     1233     2376    2           END;                            /* DO I=                              */

   2376  2 001017   200006 235100                    LDA     I,,AUTO
         2 001020   000001 035007                    ADLA    1,DL
         2 001021   200006 755100                    STA     I,,AUTO
         2 001022   000002 115007                    CMPA    2,DL
         2 001023   000762 602000 2                  TNC     s:2372

     1234     2377    1   DCI:
     1235     2378    1           IF SYS_DPX~=0 THEN GOTO DCI1;   /* We already know system disk addr   */

   2378  2 001024   000000 235000 xsym  DCI          LDA     SYS_DPX
         2 001025   001037 601000 2                  TNZ     DCI1

     1236     2379    1             ELSE;
     1237     2380    1           IF ADPXF.D='1'B THEN CALL GT_SYSPACKAD(%FRSTDP); /* Get sys pack addr */

   2380  2 001026   000000 236000 xsym               LDQ     ADPXF
         2 001027   200000 316003                    CANQ    65536,DU
         2 001030   001035 600000 2                  TZE     s:2382

   2380  2 001031   000001 630400 3                  EPPR0   1
         2 001032   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001033   000000 701000 xent               TSX1    GT_SYSPACKAD
         2 001034   000000 011000                    NOP     0

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:246  
     1238     2381    1             ELSE;
     1239     2382    1           SYS_DPX=%FRSTDP;

   2382  2 001035   000024 235007                    LDA     20,DL
         2 001036   000000 755000 xsym               STA     SYS_DPX

     1240     2383    1   DCI1:
     1241     2384    2           IF RPM_FLG THEN DO;

   2384  2 001037   000000 234000 xsym  DCI1         SZN     RPM_FLG
         2 001040   001073 605000 2                  TPL     s:2390

     1242     2385    2                 TEMP_IMX = DEVINFO.IOM#(SYS_DPX);

   2385  2 001041   000000 236000 xsym               LDQ     SYS_DPX
         2 001042   000014 402007                    MPY     12,DL
         2 001043   000000 236006 xsym               LDQ     DEVINFO,QL
         2 001044   000023 772000                    QRL     19
         2 001045   000003 376007                    ANQ     3,DL
         2 001046   200004 756100                    STQ     TEMP_IMX,,AUTO

     1243     2386    3                 CALL DO_RPM_CFG(TEMP_IMX) WHENRETURN DO;

   2386  2 001047   200004 630500                    EPPR0   TEMP_IMX,,AUTO
         2 001050   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 001051   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 001052   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001053   000000 701000 xent               TSX1    DO_RPM_CFG
         2 001054   001073 702000 2                  TSX2    s:2390

     1244     2387    3                      HW_LD_FLAG.DISK_FW = FW_LOAD(DEVINFO.IOM#(SYS_DPX)*128 +DEVINFO.
              2387                                CHN#(SYS_DPX));

   2387  2 001055   000000 236000 xsym               LDQ     SYS_DPX
         2 001056   000014 402007                    MPY     12,DL
         2 001057   000000 236006 xsym               LDQ     DEVINFO,QL
         2 001060   000033 772000                    QRL     27
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:247  
         2 001061   200010 756100                    STQ     MESSAGE$+1,,AUTO
         2 001062   000000 236000 xsym               LDQ     SYS_DPX
         2 001063   000014 402007                    MPY     12,DL
         2 001064   000000 236006 xsym               LDQ     DEVINFO,QL
         2 001065   000014 772000                    QRL     12
         2 001066   000600 376007                    ANQ     384,DL
         2 001067   200010 036100                    ADLQ    MESSAGE$+1,,AUTO
         2 001070   003000 060406                    CSL     bolr='003'O
         2 001071   000000 000001 xsym               BDSC    FW_LOAD,Q                by=0,bit=0,n=1
         2 001072   000000 010001 xsym               BDSC    HW_LD_FLAG               by=0,bit=1,n=1

     1245     2388    3                     END;

     1246     2389    2               END;

     1247     2390    1           IF ~HW_LD_FLAG.DISK_FW THEN

   2390  2 001073   000000 236000 xsym               LDQ     HW_LD_FLAG
         2 001074   000001 736000                    QLS     1
         2 001075   400000 376003                    ANQ     -131072,DU
         2 001076   400000 676003                    ERQ     -131072,DU
         2 001077   001145 601000 2                  TNZ     DCDONE1

     1248     2391    1             GOTO DCDONE1;
     1249     2392    2           DO I=0 TO DISK_FW.FWM#-1;

   2392  2 001100   200006 450100                    STZ     I,,AUTO
         2 001101   001124 710000 2                  TRA     NXT_DCFW+3

     1250     2393    3             CALL FWRXX(DISK_FW.MODN(I)) WHENRETURN DO; /* Look for this firmware */

   2393  2 001102   200006 720100                    LXL0    I,,AUTO
         2 001103   000016 630410 0                  EPPR0   DISK_FW+2,X0
         2 001104   200010 450500                    STP0    MESSAGE$+1,,AUTO
         2 001105   200010 630500                    EPPR0   MESSAGE$+1,,AUTO
         2 001106   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001107   000000 701000 xent               TSX1    FWRXX
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:248  
         2 001110   001121 702000 2                  TSX2    NXT_DCFW

     1251     2394    3                   CALL BUILDFW_DCWS(DCCSOD1,DCMMOD1);

   2394  2 001111   000040 630400 3                  EPPR0   32
         2 001112   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001113   000000 701000 xent               TSX1    BUILDFW_DCWS
         2 001114   000000 011000                    NOP     0

     1252     2395    3                   CALL DCINIT ALTRET(NXT_DCFW);

   2395  2 001115   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001116   000000 701000 xent               TSX1    DCINIT
         2 001117   001121 702000 2                  TSX2    NXT_DCFW

     1253     2396    3                   GOTO DCDONE;

   2396  2 001120   001143 710000 2                  TRA     DCDONE

     1254     2397    3                 END;                      /* WHENRETURN                         */
     1255     2398    2   NXT_DCFW:
     1256     2399    2           END;                            /* DO I=                              */

   2399  2 001121   200006 235100       NXT_DCFW     LDA     I,,AUTO
         2 001122   000001 035007                    ADLA    1,DL
         2 001123   200006 755100                    STA     I,,AUTO
         2 001124   200006 236100                    LDQ     I,,AUTO
         2 001125   000014 116000 0                  CMPQ    DISK_FW
         2 001126   001102 602000 2                  TNC     s:2393

     1257     2400    1   NODCFW:
     1258     2401    1           MESSAGE$=ADDR(NOFWRM);

   2401  2 001127   000015 236000 3     NODCFW       LDQ     13
         2 001130   200007 756100                    STQ     MESSAGE$,,AUTO

     1259     2402    1           SUBSTR(TEXTM.TXT,47,4)='DISK';
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:249  

   2402  2 001131   200007 470500                    LDP0    MESSAGE$,,AUTO
         2 001132   000000 720100                    LXL0    0,,PR0
         2 001133   040100 100400                    MLR     fill='040'O
         2 001134   000016 000004 1                  ADSC9   14                       cn=0,n=4
         2 001135   000014 600004                    ADSC9   12,,PR0                  cn=3,n=4

     1260     2403    1           CALL TYPEC(NOFWRM);

   2403  2 001136   000015 630400 3                  EPPR0   13
         2 001137   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001140   000000 701000 xent               TSX1    TYPEC
         2 001141   000000 011000                    NOP     0

     1261     2404    1           GOTO ERPO1;

   2404  2 001142   001154 710000 2                  TRA     ERPO1

     1262     2405    1   DCDONE:
     1263     2406    1           DISK_FW.FW_INDX=I;

   2406  2 001143   200006 235100       DCDONE       LDA     I,,AUTO
         2 001144   000015 755000 0                  STA     DISK_FW+1

     1264     2407    1   DCDONE1:
     1265     2408    1           DCFWHDR$=FWHDR$;

   2408  2 001145   000002 236000 0     DCDONE1      LDQ     FWHDR$
         2 001146   000006 756000 0                  STQ     DCFWHDR$

     1266     2409    1           RETURN;

   2409  2 001147   000000 702200 xent               TSX2  ! X66_ARET

     1267     2410    1   ERPO:
     1268     2411    1           CALL TYPEC(FWERR);

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:250  
   2411  2 001150   000042 630400 3     ERPO         EPPR0   34
         2 001151   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001152   000000 701000 xent               TSX1    TYPEC
         2 001153   000000 011000                    NOP     0

     1269     2412    1   ERPO1:
     1270     2413    1           CALL TYPEC(POEM);

   2413  2 001154   000043 630400 3     ERPO1        EPPR0   35
         2 001155   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001156   000000 701000 xent               TSX1    TYPEC
         2 001157   000000 011000                    NOP     0

     1271     2414    1           CALL HANG;

   2414  2 001160   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001161   000000 701000 xent               TSX1    HANG
         2 001162   000000 011000                    NOP     0

     1272     2415    1           RETURN;

   2415  2 001163   000000 702200 xent               TSX2  ! X66_ARET

     1273     2416    1   INIT_DISK:ENTRY;

   2416  2 001164   000000 700200 xent  INIT_DISK    TSX0  ! X66_AUTO_0
         2 001165   000012 000000                    ZERO    10,0

     1274     2417    1           IF S1000_FLG='1'B THEN RETURN;

   2417  2 001166   000000 234000 xsym               SZN     S1000_FLG
         2 001167   001037 605000 2                  TPL     DCI1

   2417  2 001170   000000 702200 xent               TSX2  ! X66_ARET
     1275     2418    1             ELSE GOTO DCI1;
     1276     2419    1   END FIX_FIRM;
     1277     2420        %EOD;
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:251  

PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:252  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FIX_FIRM.
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:253  

 **** Variables and constants ****

  ****  Section 000  Data  FIX_FIRM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    52-0-0/w UBIN        r     1 ACTFWHD#                  51-0-0/w STRC        r     1 CDFWD
    31-0-0/w STRC(108)   r     1 CRP_FW                    36-0-0/w STRC        r     1 DCCSOD1
     6-0-0/w PTR         r     1 DCFWHDR$                   4-0-0/w PTR         r     1 DCFWSTART$
     4-0-0/w STRC        r     1 DCFWSTART_PTR             44-0-0/w STRC        r     1 DCMMOD1
    14-0-0/w STRC(180)   r     1 DISK_FW                   53-0-0/b BIT         r     1 EURC_FLG
     1-0-0/w PTR         r     1 FW$                       56-0-0/w STRC(297)   r     1 FWERR
     2-0-0/w PTR         r     1 FWHDR$                     5-0-0/w PTR         r     1 FWSTART$
     5-0-0/w STRC        r     1 FWSTART_PTR               55-0-0/w UBIN        r     1 FWTINDX
   113-0-0/w STRC(189)   r     1 FWTQ2                      1-0-0/w STRC        r     1 FW_PTR
    50-0-0/w STRC        r     1 LDFWD                     26-0-0/w STRC(108)   r     1 LP_FW
    34-0-0/w STRC        r     1 MTCSOD1                   42-0-0/w STRC        r     1 MTMMOD1
     0-0-0/w PTR         r     1 NAVHDR$                    3-0-0/w PTR         r     1 NEWFWHDR$
     3-0-0/w STRC        r     1 NEWFWHDR_PTR              67-0-0/w STRC(504)   r     1 NOFWRM
   105-0-0/w STRC(198)   r     1 POEM                       7-0-0/w STRC(180)   r     1 TAPE_FW
    54-0-0/b BIT         r     1 TPUR_FLG                  40-0-0/w STRC        r     1 URCSOD1
    46-0-0/w STRC        r     1 URMMOD1                   21-0-0/w STRC(180)   r     1 UR_FW

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w UBIN        r     1 I                          7-0-0/w PTR         r     1 MESSAGE$
     3-0-0/w PTR         r     1 NEWNAVHDR$                 5-0-0/w UBIN        r     1 POFWHD#
     4-0-0/w SBIN        r     1 TEMP_IMX

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:254  

     0-0-0/w STRC(8640)  r     1 ADIR                       0-0-0/b STRC(5)     r     1 ADPXF
     0-0-0/w STRC(72)    r     1 ANSBUF                     0-0-0/w UBIN        r     1 BOOTTAPE
     0-0-0/b BIT         r     1 CHN_CFG(0:511)             0-0-0/b BIT         r     1 CP6UL
     0-0-0/b BIT         r     1 DECIM_FLG                  0-0-0/d STRC(396)   r     1 DEVINFO(0:21)
     0-0-0/w PTR         r     1 FIELD$                     0-0-0/w UBIN        r     1 FIELD_LEN
     0-0-0/b BIT         r     1 FW_LOAD(0:511)             0-0-0/b STRC(9)     r     1 HW_LD_FLAG
     0-0-0/w BIT         r     1 MTIDCW(0:14)               0-0-0/b BIT (2)     r     1 ORDBFLG
     0-0-0/b BIT (4)     r     1 RCV_FLG                    0-0-0/b STRC        r     1 RPM_BOOTIN
     0-0-0/b BIT         r     1 RPM_FLG                    0-0-0/b BIT         r     1 S1000_FLG
     0-0-0/w UBIN        r     1 SYS_DPX                    0-0-0/w UBIN        r     1 URCHN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(2)     r     1 FWANS                      0-0-0/w STRC(144)   r     1 FWHDR
     0-0-0/w ASTR        r     1 TEXTM


   Procedure FIX_FIRM requires 633 words for executable code.
   Procedure FIX_FIRM requires 10 words of local(AUTO) storage.
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:255  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:256  
          MINI XREF LISTING

ACTFWHD#
      2112**DCL      2208>>ASSIGN   2267>>IF       2268>>DOINDEX
ADIR.FW
      1546**DCL      1576--DCLINIT  2144<<ASSIGN
ADIR.FW.ADIR
      1552**DCL      1553--REDEF
ADIR.MONID.M
      1512**DCL      1515--REDEF
ADPXF.D
      1853**DCL      2153>>IF       2380>>IF
ADPXF.F
      1856**DCL      2232>>IF
ANSBUF
      1841**DCL      2242<>CALL
ANSBUF.TXT
      1843**DCL      2243<>CALL
ASKFWT1
      2242**LABEL    2244--GOTO     2255--GOTO
BOOTTAPE
      1819**DCL      2172>>ASSIGN   2172>>ASSIGN   2204<>CALL     2206<>CALL
BUILDFW_DCWS
      1284**DCL-ENT  2215--CALL     2284--CALL     2339--CALL     2394--CALL
CDFWD.AD
      2104**DCL      2318<<ASSIGN
CDFWD.TALLY
      2108**DCL      2319<<ASSIGN
CHN_CFG
      1821**DCL      2372>>IF
CP6UL
      1837**DCL      1557--DCLINIT  2159--ASSIGN   2197--ASSIGN
CRDONE
      2324**LABEL    2320--GOTO
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:257  
CRP_FW.FWM#
      1813**DCL      2316>>DOINDEX
CRP_FW.FW_INDX
      1814**DCL      2324<<ASSIGN
CRP_FW.MODN
      1815**DCL      2191<<ASSIGN   2317<>CALL
DCCSOD1
      1905**DCL      2394<>CALL
DCDONE
      2406**LABEL    2396--GOTO
DCDONE1
      2408**LABEL    2391--GOTO
DCFWHDR$
      1652**DCL      2408<<ASSIGN
DCFWSTART$
      1632**DCL      2197<<ASSIGN
DCFWSTART_PTR
      1625**DCL      1632--REDEF
DCFWSTART_PTR.WOFFS
      1626**DCL      2198<<ASSIGN   2198>>ASSIGN   2200>>ASSIGN
DCI
      2378**LABEL    2363--GOTO     2368--GOTO
DCI1
      2384**LABEL    2378--GOTO     2418--GOTO
DCINIT
      1291**DCL-ENT  2395--CALL
DCIS1
      2159**LABEL    2151--GOTO
DCMMOD1
      2013**DCL      2394<>CALL
DECIM_FLG
      1848**DCL      2244>>IF
DEVINFO.BITS
      1677**DCL      2354<<ASSIGN   2375<<ASSIGN
DEVINFO.CHN#
      1674**DCL      2172>>ASSIGN   2173>>ASSIGN   2372>>IF       2387>>ASSIGN
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:258  
DEVINFO.DEVNAME
      1721**DCL      2240>>ASSIGN   2252>>IF
DEVINFO.IOM#
      1676**DCL      2172>>ASSIGN   2173>>ASSIGN   2372>>IF       2385>>ASSIGN   2387>>ASSIGN
DEVINFO.PCWS
      1678**DCL      1689--REDEF
DEVINFO.RPM_PTRS.EF_DCWS$
      1691**DCL      1692--REDEF
DEVINFO.STATUS
      1695**DCL      1714--REDEF
DISK_FW.FWM#
      1762**DCL      2392>>DOINDEX
DISK_FW.FW_INDX
      1763**DCL      2406<<ASSIGN
DISK_FW.MODN
      1764**DCL      2181<<ASSIGN   2182<<ASSIGN   2183<<ASSIGN   2393<>CALL
DOFWT
      2257**LABEL    2252--GOTO
DO_LP_FW
      2297**LABEL    2236--GOTO     2279--GOTO
DO_RPM_CFG
      1829**DCL-ENT  2169--CALL     2386--CALL
DP_NEXT
      2367**LABEL    2299--GOTO
ERPO
      2411**LABEL    2204--CALLALT  2206--CALLALT
ERPO1
      2413**LABEL    2226--GOTO     2404--GOTO
EURC_FLG
      2113**DCL      2312<<ASSIGN   2327<<ASSIGN   2336<<ASSIGN
FIELD$
      1845**DCL      1847--IMP-PTR  2247>>ASSIGN   2247>>ASSIGN   2248>>ASSIGN   2252>>IF
FIELD_LEN
      1846**DCL      2244>>IF       2246>>IF
FW$
      1557**DCL      1569--REDEF    2159<<ASSIGN   2161>>ASSIGN   2201<<ASSIGN
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:259  
FWANS
      1847**DCL      2247<<ASSIGN   2247>>ASSIGN   2248<<ASSIGN   2252>>IF
FWERR
      2120**DCL      2411<>CALL
FWHDR
      1654**DCL      2270<<ASSIGN   2270>>ASSIGN
FWHDR.BUFAD
      1656**DCL      2303>>ASSIGN   2318>>ASSIGN
FWHDR.CSOSIZE
      1658**DCL      2304>>ASSIGN   2319>>ASSIGN
FWHDR.FWNAME
      1660**DCL      2269<>CALL     2271<<ASSIGN
FWHDR$
      1576**DCL      1588--REDEF    1654--IMP-PTR  2207>>ASSIGN   2261<<ASSIGN   2265>>ASSIGN   2270>>ASSIGN
      2303>>ASSIGN   2304>>ASSIGN   2318>>ASSIGN   2319>>ASSIGN   2408>>ASSIGN
FWRXX
      1283**DCL-ENT  2214--CALL     2269--CALL     2283--CALL     2302--CALL     2317--CALL     2338--CALL
      2393--CALL
FWSTART$
      1651**DCL      2161<<ASSIGN   2201>>ASSIGN
FWSTART_PTR
      1644**DCL      1651--REDEF
FWSTART_PTR.WOFFS
      1645**DCL      2200<<ASSIGN
FWTINDX
      2117**DCL      2257<<ASSIGN   2262<>CALL     2263<>CALL
FWTQ2
      2135**DCL      2239--ASSIGN   2242<>CALL
FW_LOAD
      1820**DCL      2172>>ASSIGN   2173>>ASSIGN   2387>>ASSIGN
FW_PTR.WOFFS
      1570**DCL      2160<<ASSIGN   2160>>ASSIGN
GETFD
      1288**DCL-ENT  2243--CALL
GT_SYSPACKAD
      1295**DCL-ENT  2153--CALL     2380--CALL
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:260  
HANG
      1289**DCL-ENT  2414--CALL
HW_LD_FLAG.CR_FW
      1823**DCL      2170<<ASSIGN   2298>>IF       2310>>IF       2340>>IF
HW_LD_FLAG.DISK_FW
      1824**DCL      2173<<ASSIGN   2387<<ASSIGN   2390>>IF
HW_LD_FLAG.LP_FW
      1825**DCL      2171<<ASSIGN   2297>>IF       2332>>IF       2345>>IF
HW_LD_FLAG.TAPE_FW
      1826**DCL      2172<<ASSIGN   2193>>IF       2203>>IF       2211>>IF       2233>>IF       2278>>IF
I
      2116**DCL      2147<<DOINDEX  2148<>CALL     2213<<DOINDEX  2214>>CALL     2228>>IF       2228>>IF
      2251<<DOINDEX  2252>>IF       2257>>ASSIGN   2259<<DOINDEX  2268<<DOINDEX  2282<<DOINDEX  2283>>CALL
      2292>>ASSIGN   2293>>IF       2301<<DOINDEX  2302>>CALL     2309>>ASSIGN   2311<<ASSIGN   2316<<DOINDEX
      2317>>CALL     2324>>ASSIGN   2326<<ASSIGN   2337<<DOINDEX  2338>>CALL     2353<<DOINDEX  2354>>ASSIGN
      2365>>ASSIGN   2371<<DOINDEX  2372>>IF       2372>>IF       2373<>CALL     2375>>ASSIGN   2392<<DOINDEX
      2393>>CALL     2406>>ASSIGN
IPCW_PL6
      1282**DCL-ENT  2194--CALL
KEYIN
      1287**DCL-ENT  2242--CALL
LDFWD.AD
      2086**DCL      2303<<ASSIGN
LDFWD.TALLY
      2090**DCL      2304<<ASSIGN
LPDONE
      2309**LABEL    2305--GOTO
LPDONE1
      2316**LABEL    2300--GOTO
LPINIT
      1293**DCL-ENT  2148--CALL     2373--CALL
LP_FW.FWM#
      1796**DCL      2301>>DOINDEX
LP_FW.FW_INDX
      1797**DCL      2309<<ASSIGN
LP_FW.MODN
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:261  
      1798**DCL      2189<<ASSIGN   2302<>CALL
MESSAGE$
      2139**DCL      2140--IMP-PTR  2223<<ASSIGN   2224>>ASSIGN   2224>>ASSIGN   2239<<ASSIGN   2240>>ASSIGN
      2240>>ASSIGN   2357<<ASSIGN   2358>>ASSIGN   2358>>ASSIGN   2401<<ASSIGN   2402>>ASSIGN   2402>>ASSIGN
MINIQ_PL6
      1294**DCL-ENT  2263--CALL
MTCSOD1
      1869**DCL      2215<>CALL     2284<>CALL
MTDONE
      2228**LABEL    2217--GOTO
MTDONE1
      2292**LABEL    2286--GOTO
MTIDCW
      1844**DCL      2229<<ASSIGN   2229>>ASSIGN
MTINIT
      1290**DCL-ENT  2216--CALL     2285--CALL     2361--CALL
MTMMOD1
      1977**DCL      2215<>CALL     2284<>CALL
NAVHDR$
      1555**DCL      2207<<ASSIGN   2209>>ASSIGN   2261>>ASSIGN   2264>>ASSIGN   2280<<ASSIGN
NDUP
      2273**LABEL    2269--CALLALT
NEWFWHDR$
      1595**DCL      1607--REDEF    2264<<ASSIGN   2269>>CALL     2270>>ASSIGN   2271>>ASSIGN
NEWFWHDR_PTR.WOFFS
      1608**DCL      2273<<ASSIGN   2273>>ASSIGN
NEWNAVHDR$
      1556**DCL      2209<<ASSIGN   2265<<ASSIGN   2280>>ASSIGN
NOFWRM
      2125**DCL      2223--ASSIGN   2225<>CALL     2357--ASSIGN   2359<>CALL     2401--ASSIGN   2403<>CALL
NOFWT
      2278**LABEL    2234--GOTO     2243--CALLALT  2267--GOTO
NOMT
      2223**LABEL    2290--GOTO     2361--CALLALT
NXT_DCFW
      2399**LABEL    2395--CALLALT
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:262  
NXT_TFW
      2220**LABEL    2216--CALLALT
NXT_TFW1
      2289**LABEL    2285--CALLALT
NXT_UFW
      2351**LABEL    2346--CALLALT
ORDBFLG
      1849**DCL      2367>>ASSIGN   2368>>IF
OTH_URFW
      2336**LABEL    2331--CALLALT  2333--GOTO
POEM
      2130**DCL      2413<>CALL
POFWHD#
      2115**DCL      2208<<ASSIGN   2267>>IF       2268>>DOINDEX
POFWR
      1285**DCL-ENT  2204--CALL     2206--CALL     2262--CALL
RCV_FLG
      1850**DCL      2367<<ASSIGN
RPM_BOOTIN.IMX#
      1834**DCL      2168>>ASSIGN
RPM_FLG
      1828**DCL      2167>>IF       2372>>IF       2384>>IF
S1000_FLG
      1840**DCL      2145>>IF       2417>>IF
SKIP_FW_TAPE_LOAD
      2232**LABEL    2212--GOTO
SYS_DPX
      1839**DCL      2151>>IF       2155<<ASSIGN   2378>>IF       2382<<ASSIGN   2385>>ASSIGN   2387>>ASSIGN
      2387>>ASSIGN
TAPE_FW.FWM#
      1745**DCL      2213>>DOINDEX  2282>>DOINDEX
TAPE_FW.FW_INDX
      1746**DCL      2292<<ASSIGN
TAPE_FW.MODN
      1747**DCL      2177<<ASSIGN   2178<<ASSIGN   2179<<ASSIGN   2214<>CALL     2228>>IF       2228>>IF
      2283<>CALL     2293>>IF
PL6.E3A0      #010=FIX_FIRM File=ISI$ROUT.:E05TSI                                TUE 07/29/97 22:57 Page:263  
TEMP_IMX
      1836**DCL      2168<<ASSIGN   2169<>CALL     2385<<ASSIGN   2386<>CALL
TEXTM.CNT
      2141**DCL      2142--IMP-SIZ  2224>>ASSIGN   2240>>ASSIGN   2358>>ASSIGN   2402>>ASSIGN
TEXTM.TXT
      2142**DCL      2224<<ASSIGN   2240<<ASSIGN   2358<<ASSIGN   2402<<ASSIGN
TPUR_FLG
      2114**DCL      2293<<ASSIGN   2361>>IF
TRY_LP1
      2331**LABEL    2313--GOTO     2328--CALLALT
TRY_LP2
      2345**LABEL    2341--CALLALT
TYPEC
      1286**DCL-ENT  2225--CALL     2359--CALL     2403--CALL     2411--CALL     2413--CALL
URCHN
      1838**DCL      2356<<ASSIGN
URCSOD1
      1941**DCL      2339<>CALL
URDONE
      2365**LABEL    2329--GOTO     2334--GOTO     2342--GOTO     2347--GOTO
URINIT
      1292**DCL-ENT  2328--CALL     2331--CALL     2341--CALL     2346--CALL
URMMOD1
      2049**DCL      2339<>CALL
UR_FW.FWM#
      1779**DCL      2337>>DOINDEX
UR_FW.FW_INDX
      1780**DCL      2365<<ASSIGN
UR_FW.MODN
      1781**DCL      2185<<ASSIGN   2186<<ASSIGN   2187<<ASSIGN   2338<>CALL

PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:264  
     1278        1        /*T***********************************************************/
     1279        2        /*T*                                                         */
     1280        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1281        4        /*T*                                                         */
     1282        5        /*T***********************************************************/
     1283        6        POFWR:  PROC(INDX,READ_FLG,TAPE_FLG) ALTRET;
     1284        7        /* This program reads firmware from PO or FW tape */
     1285        8        /* Altreturns on error reading tape */
     1286        9        %INCLUDE IS$MACROS;
     1287     1284    1   DCL INDX UBIN WORD;                     /* Tape index in DEVINFO              */
     1288     1285    1   DCL TAPE_FLG BIT(1) ALIGNED;            /* '0'B-> PO tape; '1'B-> FW tape     */
     1289     1286    1   DCL READ_FLG BIT(1) ALIGNED;  /* '0'B-> PRIMITIVE READ; '1'B->  NON-PRIMITIVE */
     1290     1287        /**/
     1291     1288    1   DCL GTFWR ENTRY(3) ALTRET;
     1292     1289        /**/
     1293     1290    1   DCL LABEL CHAR(4)STATIC SYMDEF ALIGNED INIT(' ');
     1294     1291    1   DCL MPCINF UBIN HALF SYMREF;            /* Firmware CSO size                  */
     1295     1292        %FWHDR;
     1296     1301    1   DCL ACTFWHD# UBIN WORD SYMREF;          /* Nr of FW headers used              */
     1297     1302    1   DCL FW$ SYMREF PTR;                     /* Pointer to the firmware buffer     */
     1298     1303        %PTR_STRUCT(NAME=FW_PTR,STCLASS="REDEF FW$");
     1299     1321    1   DCL FWHDR$ PTR SYMREF;                  /* Pointer to firm header             */
     1300     1322        %PTR_STRUCT(NAME=FWHDR_PTR,STCLASS="REDEF FWHDR$");
     1301     1340    2           DO UNTIL ACTFWHD#=%FWHDR#;
     1302     1341    2             FW_PTR.WOFFS=FW_PTR.WOFFS+1; /* Allow one word just in case (for U400) */
     1303     1342    2             FWHDR.H11='0'B;
     1304     1343    2             FWHDR.BUFAD=FW_PTR.WOFFS;
     1305     1344    2             LABEL=' ';
     1306     1345    2             CALL GTFWR(INDX,READ_FLG,TAPE_FLG) ALTRET(NOFWRA);
              1345                      /* Get one module,when reading error-> NOFWRA */
     1307     1346    2             IF LABEL=' ' THEN GOTO POFWR2; /* No more firmware found            */
     1308     1347    2               ELSE;
     1309     1348        /* Process the firmware */
     1310     1349    2             FWHDR.FWNAME=LABEL;           /* Name of firmware                   */
     1311     1350    2             FWHDR.CSOSIZE=MPCINF;
     1312     1351    2             FWHDR.MMOSIZE=0;
     1313     1352    2             IF FWHDR.CSOSIZE=0 THEN FWHDR.CSOSIZE=FW_PTR.WOFFS-FWHDR.BUFAD;
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:265  
              1352                      /* Only one size */
     1314     1353    2               ELSE FWHDR.MMOSIZE=FW_PTR.WOFFS-FWHDR.BUFAD-FWHDR.CSOSIZE;
     1315     1354    2   POFWR1A:
     1316     1355    3             IF FWHDR.FWNAME=%LPFWNM OR FWHDR.FWNAME=%CRPFWNM THEN DO;
              1355                      /* LP or CR/CP firmware */
     1317     1356        /* Allow room for device control word */
     1318     1357    3                   FWHDR.BUFAD=FWHDR.BUFAD-1;
     1319     1358    3                   FWHDR.CSOSIZE=FWHDR.CSOSIZE+1;
     1320     1359    3                 END;                      /*THEN                                */
     1321     1360    2               ELSE;
     1322     1361        /* Use next header */
     1323     1362    2   POFWR1B:
     1324     1363    2             ACTFWHD#=ACTFWHD#+1;
     1325     1364    2             FWHDR_PTR.WOFFS=FWHDR_PTR.WOFFS+4;
     1326     1365    2           END;                            /* DO UNTIL                           */
     1327     1366    1   POFWR2:
     1328     1367    1           RETURN;
     1329     1368    1   NOFWRA:
     1330     1369    1           ALTRETURN;
     1331     1370    1   END POFWR;

PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:266  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure POFWR.

   Procedure POFWR requires 73 words for executable code.
   Procedure POFWR requires 10 words of local(AUTO) storage.

    No errors detected in file ISI$ROUT.:E05TSI    .

PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:267  

 Object Unit name= POFWR                                      File name= ISI$ROUT.:E05TOU
 UTS= JUL 29 '97 22:57:57.04 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     1      1  POFWR
    1  RoData even  UTS      2      2  POFWR
    2   Proc  even  none    73    111  POFWR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        3  POFWR

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  LABEL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 GTFWR
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:268  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     MPCINF                                ACTFWHD#                              FW$
     FWHDR$                                B_VECTNIL
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:269  


     1278        1        /*T***********************************************************/
     1279        2        /*T*                                                         */
     1280        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1281        4        /*T*                                                         */
     1282        5        /*T***********************************************************/
     1283        6        POFWR:  PROC(INDX,READ_FLG,TAPE_FLG) ALTRET;

      6  2 000000   000000 700200 xent  POFWR        TSX0  ! X66_AUTO_3
         2 000001   000012 000003                    ZERO    10,3

     1284        7        /* This program reads firmware from PO or FW tape */
     1285        8        /* Altreturns on error reading tape */
     1286        9        %INCLUDE IS$MACROS;
     1287     1284    1   DCL INDX UBIN WORD;                     /* Tape index in DEVINFO              */
     1288     1285    1   DCL TAPE_FLG BIT(1) ALIGNED;            /* '0'B-> PO tape; '1'B-> FW tape     */
     1289     1286    1   DCL READ_FLG BIT(1) ALIGNED;  /* '0'B-> PRIMITIVE READ; '1'B->  NON-PRIMITIVE */
     1290     1287        /**/
     1291     1288    1   DCL GTFWR ENTRY(3) ALTRET;
     1292     1289        /**/
     1293     1290    1   DCL LABEL CHAR(4)STATIC SYMDEF ALIGNED INIT(' ');
     1294     1291    1   DCL MPCINF UBIN HALF SYMREF;            /* Firmware CSO size                  */
     1295     1292        %FWHDR;
     1296     1301    1   DCL ACTFWHD# UBIN WORD SYMREF;          /* Nr of FW headers used              */
     1297     1302    1   DCL FW$ SYMREF PTR;                     /* Pointer to the firmware buffer     */
     1298     1303        %PTR_STRUCT(NAME=FW_PTR,STCLASS="REDEF FW$");
     1299     1321    1   DCL FWHDR$ PTR SYMREF;                  /* Pointer to firm header             */
     1300     1322        %PTR_STRUCT(NAME=FWHDR_PTR,STCLASS="REDEF FWHDR$");
     1301     1340    2           DO UNTIL ACTFWHD#=%FWHDR#;

     1302     1341    2             FW_PTR.WOFFS=FW_PTR.WOFFS+1; /* Allow one word just in case (for U400) */

   1341  2 000002   000000 220000 xsym               LDX0    FW$
         2 000003   000001 621010                    EAX1    1,X0
         2 000004   000000 741000 xsym               STX1    FW$

     1303     1342    2             FWHDR.H11='0'B;
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:270  

   1342  2 000005   000000 220003                    LDX0    0,DU
         2 000006   000000 470400 xsym               LDP0    FWHDR$
         2 000007   000000 740100                    STX0    0,,PR0

     1304     1343    2             FWHDR.BUFAD=FW_PTR.WOFFS;

   1343  2 000010   000000 221000 xsym               LDX1    FW$
         2 000011   000000 470400 xsym               LDP0    FWHDR$
         2 000012   000000 441100                    SXL1    0,,PR0

     1305     1344    2             LABEL=' ';

   1344  2 000013   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 000014   000000 756000 0                  STQ     LABEL

     1306     1345    2             CALL GTFWR(INDX,READ_FLG,TAPE_FLG) ALTRET(NOFWRA);
              1345                      /* Get one module,when reading error-> NOFWRA */

   1345  2 000015   200003 630500                    EPPR0   @INDX,,AUTO
         2 000016   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000017   000000 701000 xent               TSX1    GTFWR
         2 000020   000110 702000 2                  TSX2    NOFWRA

     1307     1346    2             IF LABEL=' ' THEN GOTO POFWR2; /* No more firmware found            */

   1346  2 000021   000000 236000 0                  LDQ     LABEL
         2 000022   000035 116000 xsym               CMPQ    B_VECTNIL+29
         2 000023   000107 600000 2                  TZE     POFWR2

     1308     1347    2               ELSE;
     1309     1348        /* Process the firmware */
     1310     1349    2             FWHDR.FWNAME=LABEL;           /* Name of firmware                   */

   1349  2 000024   000000 470400 xsym               LDP0    FWHDR$
         2 000025   000003 756100                    STQ     3,,PR0

PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:271  
     1311     1350    2             FWHDR.CSOSIZE=MPCINF;

   1350  2 000026   000000 220000 xsym               LDX0    MPCINF
         2 000027   000002 740100                    STX0    2,,PR0

     1312     1351    2             FWHDR.MMOSIZE=0;

   1351  2 000030   000000 221003                    LDX1    0,DU
         2 000031   000002 441100                    SXL1    2,,PR0

     1313     1352    2             IF FWHDR.CSOSIZE=0 THEN FWHDR.CSOSIZE=FW_PTR.WOFFS-FWHDR.BUFAD;
              1352                      /* Only one size */

   1352  2 000032   000000 100003                    CMPX0   0,DU
         2 000033   000045 601000 2                  TNZ     s:1353

   1352  2 000034   000000 236100                    LDQ     0,,PR0
         2 000035   777777 376007                    ANQ     -1,DL
         2 000036   200006 756100                    STQ     @TAPE_FLG+1,,AUTO
         2 000037   000000 236000 xsym               LDQ     FW$
         2 000040   000022 772000                    QRL     18
         2 000041   200006 136100                    SBLQ    @TAPE_FLG+1,,AUTO
         2 000042   000000 622006                    EAX2    0,QL
         2 000043   000002 742100                    STX2    2,,PR0
         2 000044   000063 710000 2                  TRA     POFWR1A

     1314     1353    2               ELSE FWHDR.MMOSIZE=FW_PTR.WOFFS-FWHDR.BUFAD-FWHDR.CSOSIZE;

   1353  2 000045   000000 236100                    LDQ     0,,PR0
         2 000046   777777 376007                    ANQ     -1,DL
         2 000047   200006 756100                    STQ     @TAPE_FLG+1,,AUTO
         2 000050   000000 236000 xsym               LDQ     FW$
         2 000051   000022 772000                    QRL     18
         2 000052   200006 136100                    SBLQ    @TAPE_FLG+1,,AUTO
         2 000053   200007 756100                    STQ     @TAPE_FLG+2,,AUTO
         2 000054   000002 236100                    LDQ     2,,PR0
         2 000055   000022 772000                    QRL     18
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:272  
         2 000056   200010 756100                    STQ     @TAPE_FLG+3,,AUTO
         2 000057   200007 236100                    LDQ     @TAPE_FLG+2,,AUTO
         2 000060   200010 136100                    SBLQ    @TAPE_FLG+3,,AUTO
         2 000061   000000 622006                    EAX2    0,QL
         2 000062   000002 442100                    SXL2    2,,PR0

     1315     1354    2   POFWR1A:
     1316     1355    3             IF FWHDR.FWNAME=%LPFWNM OR FWHDR.FWNAME=%CRPFWNM THEN DO;
              1355                      /* LP or CR/CP firmware */

   1355  2 000063   000003 236100       POFWR1A      LDQ     3,,PR0
         2 000064   000000 116000 1                  CMPQ    0
         2 000065   000070 600000 2                  TZE     s:1357
         2 000066   000001 116000 1                  CMPQ    1
         2 000067   000077 601000 2                  TNZ     POFWR1B

     1317     1356        /* Allow room for device control word */
     1318     1357    3                   FWHDR.BUFAD=FWHDR.BUFAD-1;

   1357  2 000070   000000 722100                    LXL2    0,,PR0
         2 000071   777777 623012                    EAX3    -1,X2
         2 000072   000000 443100                    SXL3    0,,PR0

     1319     1358    3                   FWHDR.CSOSIZE=FWHDR.CSOSIZE+1;

   1358  2 000073   000000 470400 xsym               LDP0    FWHDR$
         2 000074   000002 222100                    LDX2    2,,PR0
         2 000075   000001 623012                    EAX3    1,X2
         2 000076   000002 743100                    STX3    2,,PR0

     1320     1359    3                 END;                      /*THEN                                */

     1321     1360    2               ELSE;
     1322     1361        /* Use next header */
     1323     1362    2   POFWR1B:
     1324     1363    2             ACTFWHD#=ACTFWHD#+1;

PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:273  
   1363  2 000077   000000 235000 xsym  POFWR1B      LDA     ACTFWHD#
         2 000100   000001 035007                    ADLA    1,DL
         2 000101   000000 755000 xsym               STA     ACTFWHD#

     1325     1364    2             FWHDR_PTR.WOFFS=FWHDR_PTR.WOFFS+4;

   1364  2 000102   000000 222000 xsym               LDX2    FWHDR$
         2 000103   000004 623012                    EAX3    4,X2
         2 000104   000000 743000 xsym               STX3    FWHDR$

     1326     1365    2           END;                            /* DO UNTIL                           */

   1365  2 000105   000024 115007                    CMPA    20,DL
         2 000106   000002 601000 2                  TNZ     s:1341

     1327     1366    1   POFWR2:
     1328     1367    1           RETURN;

   1367  2 000107   000000 702200 xent  POFWR2       TSX2  ! X66_ARET

     1329     1368    1   NOFWRA:
     1330     1369    1           ALTRETURN;

   1369  2 000110   000000 702200 xent  NOFWRA       TSX2  ! X66_AALT
     1331     1370    1   END POFWR;

PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:274  
--  Include file information  --

   IS$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure POFWR.
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:275  

 **** Variables and constants ****

  ****  Section 000  Data  POFWR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w CHAR(4)     r     1 LABEL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @INDX                      4-0-0/w PTR         r     1 @READ_FLG
     5-0-0/w PTR         r     1 @TAPE_FLG                 *0-0-0/w UBIN        r     1 INDX
    *0-0-0/w BIT         r     1 READ_FLG                  *0-0-0/w BIT         r     1 TAPE_FLG

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 ACTFWHD#                   0-0-0/w PTR         r     1 FW$
     0-0-0/w PTR         r     1 FWHDR$                     0-0-0/w STRC        r     1 FWHDR_PTR
     0-0-0/w STRC        r     1 FW_PTR                     0-0-0/w UBIN(18)    r     1 MPCINF

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(144)   r     1 FWHDR


   Procedure POFWR requires 73 words for executable code.
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:276  
   Procedure POFWR requires 10 words of local(AUTO) storage.

    No errors detected in file ISI$ROUT.:E05TSI    .
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:277  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:278  
          MINI XREF LISTING

ACTFWHD#
      1301**DCL      1340>>DOUNTIL  1363<<ASSIGN   1363>>ASSIGN
FW$
      1302**DCL      1314--REDEF
FWHDR.BUFAD
      1295**DCL      1343<<ASSIGN   1352>>ASSIGN   1353>>ASSIGN   1357<<ASSIGN   1357>>ASSIGN
FWHDR.CSOSIZE
      1297**DCL      1350<<ASSIGN   1352>>IF       1352<<ASSIGN   1353>>ASSIGN   1358<<ASSIGN   1358>>ASSIGN
FWHDR.FWNAME
      1299**DCL      1349<<ASSIGN   1355>>IF       1355>>IF
FWHDR.H11
      1294**DCL      1342<<ASSIGN
FWHDR.MMOSIZE
      1298**DCL      1351<<ASSIGN   1353<<ASSIGN
FWHDR$
      1321**DCL      1293--IMP-PTR  1333--REDEF    1342>>ASSIGN   1343>>ASSIGN   1349>>ASSIGN   1350>>ASSIGN
      1351>>ASSIGN   1352>>IF       1352>>ASSIGN   1352>>ASSIGN   1353>>ASSIGN   1353>>ASSIGN   1353>>ASSIGN
      1355>>IF       1355>>IF       1357>>ASSIGN   1357>>ASSIGN   1358>>ASSIGN   1358>>ASSIGN
FWHDR_PTR.WOFFS
      1334**DCL      1364<<ASSIGN   1364>>ASSIGN
FW_PTR.WOFFS
      1315**DCL      1341<<ASSIGN   1341>>ASSIGN   1343>>ASSIGN   1352>>ASSIGN   1353>>ASSIGN
GTFWR
      1288**DCL-ENT  1345--CALL
INDX
      1284**DCL         6--PROC     1345<>CALL
LABEL
      1290**DCL      1344<<ASSIGN   1346>>IF       1349>>ASSIGN
MPCINF
      1291**DCL      1350>>ASSIGN
NOFWRA
      1369**LABEL    1345--CALLALT
PL6.E3A0      #011=POFWR File=ISI$ROUT.:E05TSI                                   TUE 07/29/97 22:57 Page:279  
POFWR2
      1367**LABEL    1346--GOTO
READ_FLG
      1286**DCL         6--PROC     1345<>CALL
TAPE_FLG
      1285**DCL         6--PROC     1345<>CALL
