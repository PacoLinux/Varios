VERSION E05

PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:1    
        1        1        /*M* KPP$PRIMAL_BOOT contains special data to be written to a boot disk.      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,DFC */
        8        8        KPP$PRIMAL_BOOT: PROC;
        9        9        /*F*     NAME:          KPP$PRIMAL_BOOT
       10       10                 PURPOSE:       All the special data written to a boot disk.
       11       11                 DESCRIPTION:   During a cold boot of the L6 (or after being
       12       12               nuked), the firmware reads in the primal boot image.
       13       13               This code is in charge of bringing in the rest of the
       14       14               boot image and starting it up.
       15       15
       16       16               This module contains the PRIMAL BOOT and RELOADER
       17       17               code in the form of binary constants to be written
       18       18               by PIGETTE on the appropriate part of the diskette.
       19       19
       20       20               To make the hex initialization constants, the following
       21       21               JCL may be used:
       22       22                 !CALF RELOADER OVER RELOADER_OU,ME
       23       23                 !C RELOADER_OU(O'777'-) OVER RELOADER_HEX(X(NOTEXT,DUP),WIDTH=27,LN)
       24       24                 !E RELOADER_HEX
       25       25                 IF NOT /0/?5/  /?9/ /,1,27;DE
       26       26                 9L8
       27       27                 END
       28       28                 !C RELOADER_HEX OVER RELOADER_HEX(LN,WRAP,WIDTH=10)
       29       29                 !E RELOADER_HEX
       30       30                 DE 1-3
       31       31                 SE
       32       32                 5E/ /
       33       33                 4F/'X,/;2F/'X,'/;1P/     '/
       34       34                 SE 999
       35       35                 ^
       36       36                 /,  /S/);/
       37       37                 Q
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:2    
       38       38               After execution, merge the _HEX file in as the INIT constants.
       39       39               AFTER MAKING SURE tha there are 128 records.  More or less
       40       40               means trouble!
       41       41        */
       42       42        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:3    
       43       43        /**/
       44       44        /* Hex declaration for the boot strap that goes on track 0                    */
       45       45        /* sector 0.                                                                  */
       46       46        /**/
       47       47    1   DCL 1 PRIMAL_BOOT (0:255) UNAL STATIC SYMDEF,
       48       48    1         2 * BIT(1) UNAL INIT('0'B*0),
       49       49    1         2 * BIT(8) UNAL INIT(
       50       50    1        'BC'X,'F0'X,
       51       51    1        '00'X,'00'X,
       52       52    1        '01'X,'80'X,
       53       53    1        'FC'X,'F0'X,
       54       54    1        '00'X,'00'X,
       55       55    1        '01'X,'2E'X,
       56       56    1        'A8'X,'70'X,
       57       57    1        '01'X,'01'X,
       58       58    1        'B8'X,'70'X,
       59       59    1        '00'X,'00'X,
       60       60    1        'C8'X,'51'X,
       61       61    1        'C4'X,'70'X,
       62       62    1        '00'X,'11'X,
       63       63    1        'E8'X,'53'X,
       64       64    1        'E3'X,'87'X,
       65       65    1        'C4'X,'70'X,
       66       66    1        '00'X,'13'X,
       67       67    1        'E8'X,'52'X,
       68       68    1        'E3'X,'87'X,
       69       69    1        'C6'X,'70'X,
       70       70    1        '00'X,'14'X,
       71       71    1        'E8'X,'70'X,
       72       72    1        '01'X,'00'X,
       73       73    1        'E3'X,'87'X,
       74       74    1        'C6'X,'70'X,
       75       75    1        '00'X,'0E'X,
       76       76    1        'E8'X,'70'X,
       77       77    1        '01'X,'00'X,
       78       78    1        '81'X,'83'X,
       79       79    1        '00'X,'54'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:4    
       80       80    1        '00'X,'56'X,
       81       81    1        '07'X,'FD'X,
       82       82    1        'C6'X,'70'X,
       83       83    1        '00'X,'0E'X,
       84       84    1        'E8'X,'70'X,
       85       85    1        '81'X,'00'X,
       86       86    1        'E3'X,'87'X,
       87       87    1        'C6'X,'70'X,
       88       88    1        '00'X,'1F'X,
       89       89    1        'E3'X,'87'X,
       90       90    1        'E5'X,'70'X,
       91       91    1        '3F'X,'27'X,
       92       92    1        '69'X,'E0'X,
       93       93    1        '83'X,'80'X,
       94       94    1        '00'X,'00'X,
       95       95    1        '01'X,'80'X,
       96       96    1        '80'X,'56'X,
       97       97    1        '00'X,'54'X,
       98       98    1        '07'X,'FE'X,
       99       99    1        'E3'X,'86'X,
      100      100    1        '00'X,'00'X,
      101      101    1        '00'X,'00'X,
      102      102    1        '00'X,'00'X,
      103      103    1        '00'X,'00'X,
      104      104    1        '00'X,'00'X,
      105      105    1        '00'X,'00'X,
      106      106    1        '00'X,'00'X,
      107      107    1        '00'X,'00'X,
      108      108    1        '00'X,'00'X,
      109      109    1        '00'X,'00'X,
      110      110    1        '00'X,'00'X,
      111      111    1        '00'X,'00'X,
      112      112    1        '00'X,'00'X,
      113      113    1        '00'X,'00'X,
      114      114    1        '00'X,'00'X,
      115      115    1        '00'X,'00'X,
      116      116    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:5    
      117      117    1        '00'X,'00'X,
      118      118    1        '00'X,'00'X,
      119      119    1        '00'X,'00'X,
      120      120    1        '00'X,'00'X,
      121      121    1        '00'X,'00'X,
      122      122    1        '00'X,'00'X,
      123      123    1        '00'X,'00'X,
      124      124    1        '00'X,'00'X,
      125      125    1        '00'X,'00'X,
      126      126    1        '00'X,'00'X,
      127      127    1        '00'X,'00'X,
      128      128    1        '00'X,'00'X,
      129      129    1        '00'X,'00'X,
      130      130    1        '00'X,'00'X,
      131      131    1        '00'X,'00'X,
      132      132    1        '00'X,'00'X,
      133      133    1        '00'X,'00'X,
      134      134    1        '00'X,'00'X,
      135      135    1        '00'X,'00'X,
      136      136    1        '00'X,'00'X,
      137      137    1        '00'X,'00'X,
      138      138    1        '00'X,'00'X,
      139      139    1        '00'X,'00'X,
      140      140    1        '00'X,'00'X,
      141      141    1        '00'X,'00'X,
      142      142    1        '00'X,'00'X,
      143      143    1        '00'X,'00'X,
      144      144    1        '00'X,'00'X,
      145      145    1        '00'X,'00'X,
      146      146    1        '00'X,'00'X,
      147      147    1        '00'X,'00'X,
      148      148    1        '00'X,'00'X,
      149      149    1        '00'X,'00'X,
      150      150    1        '00'X,'00'X,
      151      151    1        '00'X,'00'X,
      152      152    1        '00'X,'00'X,
      153      153    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:6    
      154      154    1        '00'X,'00'X,
      155      155    1        '00'X,'00'X,
      156      156    1        '00'X,'00'X,
      157      157    1        '00'X,'00'X,
      158      158    1        '00'X,'00'X,
      159      159    1        '00'X,'00'X,
      160      160    1        '00'X,'00'X,
      161      161    1        '00'X,'00'X,
      162      162    1        '00'X,'00'X,
      163      163    1        '00'X,'00'X,
      164      164    1        '00'X,'00'X,
      165      165    1        '00'X,'00'X,
      166      166    1        '00'X,'00'X,
      167      167    1        '00'X,'00'X,
      168      168    1        '00'X,'00'X,
      169      169    1        '00'X,'00'X,
      170      170    1        '00'X,'00'X,
      171      171    1        '00'X,'00'X,
      172      172    1        '00'X,'00'X,
      173      173    1        '00'X,'00'X,
      174      174    1        '00'X,'00'X,
      175      175    1        '00'X,'00'X,
      176      176    1        '00'X,'00'X,
      177      177    1        '00'X,'00'X);
      178      178        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:7    
      179      179
      180      180        /* The following is the CALF source used to generate the
      181      181             above initialization constants.
      182      182        *
      183      183        * This is the PRIMAL_BOOT routine.
      184      184        *
      185      185        * The sequence of events is as follows:
      186      186        *    o Firmware reads in 128 bytes of PRIMAL BOOT.
      187      187        *    o PRIMAL BOOT reads in 256 bytes of SECONDARY BOOT.
      188      188        *    o SECONDARY BOOT reads in first 8K words of BIGFOOT and RELOADER.
      189      189        *    o RELOADER shuffles BIGFOOT down to run memory and starts him.
      190      190        *    o BIGFOOT reads in remainder of boot image.
      191      191        *
      192      192        * PRIMAL_BOOT facts:
      193      193        *    length = EXACTLY 256D bytes = 128D words
      194      194        *             of these, only HALF (128 bytes) are loaded by firmware!
      195      195        *    track location = 0
      196      196        *    sector location = 0
      197      197        *    loaded into memory at word = 256D = 100H
      198      198        *    boot device address passed by firmware in R1
      199      199        *
      200      200        * All operational parameters are hard-coded as follows:
      201      201        *     start loading memory at .180
      202      202        *     start loading from disk at track 0, sector 1
      203      203        *     load size = 1 SECTOR
      204      204        *     all sectors = 256 bytes
      205      205        *
      206      206        SECONDARY EQU       '180'X                START LOADING MEMORY
      207      207                  ORG       '100'X                FIRMWARE WILL PUT US HERE
      208      208        START     LDB,B3    =SECONDARY            POINT TO MEMORY TO FILL
      209      209                  LDB,B7    =IOLOP                LOCATE I/O SUBROUTINE
      210      210                  LDR,R2    ='0101'X              SECTOR = 1, SECTOR SIZE = 256
      211      211                  LDR,R3    ='0000'X              TRACK = 0, SIDE = 0
      212      212        TRY_AGAIN LDR,R4    R1                    PUT DEVICE ADD. IN R4
      213      213        *
      214      214        * Set up CONFIGURATION WORD A (track and side).
      215      215        *
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:8    
      216      216                  OR,R4     ='11'X                COMMAND TO OUTPUT CONFIG A
      217      217                  LDR,R6    R3                    ARGUMENT TO AGREED REGISTER
      218      218                  LNJ,B6    ,B7                   OUTPUT CONFIG A (TRACK)
      219      219        *
      220      220        * Set up CONFIGURATION WORD B (sector and sector size).
      221      221        *
      222      222                  OR,R4     ='13'X                COMMAND TO OUTPUT CONFIG B
      223      223                  LDR,R6    R2                    ARGUMENT TO AGREED REGISTER
      224      224                  LNJ,B6    ,B7                   OUTPUT CONFIG B
      225      225        *
      226      226        * Seek the track we want.
      227      227        *
      228      228                  XOR,R4    ='14'X                CONVERT ='13'X TO '07'X
      229      229                  LDR,R6    ='0100'X              TASK = SEEK
      230      230                  LNJ,B6    ,B7                   DO THE SEEK
      231      231        *
      232      232        * Set up ADDRESS and RANGE.
      233      233        *
      234      234                  XOR,R4    ='0E'X                CONVERT ='07'X TO '09'X
      235      235                  LDR,R6    =256                  A FULL SECTOR AT A TIME
      236      236        IO4       IOLD      (,B3),(R4),(R6)       OUTPUT ADDRESS AND RANGE
      237      237                  BIOF      IO4,SPREL
      238      238        *
      239      239        * Read the sector.
      240      240        *
      241      241                  XOR,R4    ='0E'X                CONVERT ='09'X TO '07'X
      242      242                  LDR,R6    ='8100'X              TASK = DATA READ
      243      243                  LNJ,B6    ,B7                   OUTPUT TASK
      244      244        *
      245      245        * Find out how we did.
      246      246        *
      247      247                  XOR,R4    ='1F'X                CONVERT ='07'X TO '18'X
      248      248                  LNJ,B6    ,B7                   INPUT STATUS
      249      249                  AND,R6    ='3F27'X              AND IMPORTANT STATUS BITS
      250      250                  BNEZ,R6   TRY_AGAIN,SPREL
      251      251        *
      252      252        * We're done loading SECONDARY BOOT.
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:9    
      253      253        *
      254      254                  JMP       SECONDARY             START THE SECONDARY BOOT
      255      255        *
      256      256        * Subroutine to perform I/O
      257      257        *
      258      258        IOLOP     IO        (R6),(R4)             PERFORM I/O
      259      259                  BIOF      IOLOP,SPREL           UNTIL IT TAKES
      260      260                  LNJ,B6    ,B6                   RETURN
      261      261        *
      262      262        * Spare space
      263      263        *
      264      264                  HLT
      265      265                  HLT
      266      266                  HLT
      267      267                  HLT
      268      268                  HLT
      269      269                  HLT
      270      270                  HLT
      271      271                  HLT
      272      272                  HLT
      273      273                  HLT
      274      274                  HLT
      275      275                  HLT
      276      276                  HLT
      277      277                  HLT
      278      278                  HLT
      279      279                  HLT
      280      280                  HLT
      281      281                  HLT
      282      282                  HLT
      283      283                  HLT
      284      284                  HLT
      285      285                  HLT
      286      286                  HLT
      287      287                  HLT
      288      288                  HLT
      289      289                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:10   
      290      290                  HLT
      291      291                  HLT
      292      292                  HLT
      293      293                  HLT
      294      294                  HLT
      295      295                  HLT
      296      296                  HLT
      297      297                  HLT
      298      298                  HLT
      299      299                  HLT
      300      300                  HLT
      301      301                  HLT
      302      302                  HLT
      303      303                  HLT
      304      304                  HLT
      305      305                  HLT
      306      306                  HLT
      307      307                  HLT
      308      308                  HLT
      309      309                  HLT
      310      310                  HLT
      311      311                  HLT
      312      312                  HLT
      313      313                  HLT
      314      314                  HLT
      315      315                  HLT
      316      316                  HLT
      317      317                  HLT
      318      318                  HLT
      319      319                  HLT
      320      320                  HLT
      321      321                  HLT
      322      322                  HLT
      323      323                  HLT
      324      324                  HLT
      325      325                  HLT
      326      326                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:11   
      327      327                  HLT
      328      328                  HLT
      329      329                  HLT
      330      330                  HLT
      331      331                  HLT
      332      332                  HLT
      333      333                  HLT
      334      334                  HLT
      335      335                  HLT
      336      336                  HLT
      337      337                  HLT
      338      338                  HLT
      339      339                  HLT
      340      340                  HLT
      341      341                  HLT
      342      342                  END
      343      343        */
      344      344        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:12   
      345      345        /**/
      346      346        /* Hex declaration for the secondary boot strap that goes on track 0          */
      347      347        /* sector 1.                                                                  */
      348      348        /**/
      349      349    1   DCL 1 SECONDARY_BOOT (0:255) UNAL STATIC SYMDEF,
      350      350    1         2 * BIT(1) UNAL INIT('0'B*0),
      351      351    1         2 * BIT(8) UNAL INIT(
      352      352    1        'BC'X,'F0'X,
      353      353    1        '00'X,'00'X,
      354      354    1        '02'X,'00'X,
      355      355    1        'FC'X,'F0'X,
      356      356    1        '00'X,'00'X,
      357      357    1        '01'X,'C2'X,
      358      358    1        'A8'X,'70'X,
      359      359    1        '0A'X,'01'X,
      360      360    1        'B8'X,'70'X,
      361      361    1        '00'X,'00'X,
      362      362    1        '87'X,'55'X,
      363      363    1        'C8'X,'51'X,
      364      364    1        'C4'X,'70'X,
      365      365    1        '00'X,'11'X,
      366      366    1        'E8'X,'53'X,
      367      367    1        'E3'X,'87'X,
      368      368    1        'C4'X,'70'X,
      369      369    1        '00'X,'13'X,
      370      370    1        'E8'X,'52'X,
      371      371    1        'E3'X,'87'X,
      372      372    1        'C6'X,'70'X,
      373      373    1        '00'X,'14'X,
      374      374    1        'E8'X,'70'X,
      375      375    1        '01'X,'00'X,
      376      376    1        'E3'X,'87'X,
      377      377    1        'C6'X,'70'X,
      378      378    1        '00'X,'0E'X,
      379      379    1        'E8'X,'70'X,
      380      380    1        '01'X,'00'X,
      381      381    1        '81'X,'83'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:13   
      382      382    1        '00'X,'54'X,
      383      383    1        '00'X,'56'X,
      384      384    1        '07'X,'FD'X,
      385      385    1        'C6'X,'70'X,
      386      386    1        '00'X,'0E'X,
      387      387    1        'E8'X,'70'X,
      388      388    1        '81'X,'00'X,
      389      389    1        'E3'X,'87'X,
      390      390    1        'C6'X,'70'X,
      391      391    1        '00'X,'1F'X,
      392      392    1        'E3'X,'87'X,
      393      393    1        'E5'X,'70'X,
      394      394    1        '3F'X,'27'X,
      395      395    1        '69'X,'E0'X,
      396      396    1        'AA'X,'70'X,
      397      397    1        '01'X,'00'X,
      398      398    1        '5E'X,'01'X,
      399      399    1        'BB'X,'C3'X,
      400      400    1        '00'X,'80'X,
      401      401    1        'A9'X,'70'X,
      402      402    1        '10'X,'01'X,
      403      403    1        '02'X,'0A'X,
      404      404    1        'B6'X,'70'X,
      405      405    1        '00'X,'01'X,
      406      406    1        'A8'X,'70'X,
      407      407    1        '00'X,'01'X,
      408      408    1        '82'X,'D3'X,
      409      409    1        '00'X,'01'X,
      410      410    1        '05'X,'03'X,
      411      411    1        'BA'X,'70'X,
      412      412    1        '01'X,'00'X,
      413      413    1        'D9'X,'70'X,
      414      414    1        '00'X,'41'X,
      415      415    1        '02'X,'4C'X,
      416      416    1        '83'X,'C3'X,
      417      417    1        'FF'X,'80'X,
      418      418    1        '80'X,'56'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:14   
      419      419    1        '00'X,'54'X,
      420      420    1        '07'X,'FE'X,
      421      421    1        'E3'X,'86'X,
      422      422    1        '00'X,'00'X,
      423      423    1        '00'X,'00'X,
      424      424    1        '00'X,'00'X,
      425      425    1        '00'X,'00'X,
      426      426    1        '00'X,'00'X,
      427      427    1        '00'X,'00'X,
      428      428    1        '00'X,'00'X,
      429      429    1        '00'X,'00'X,
      430      430    1        '00'X,'00'X,
      431      431    1        '00'X,'00'X,
      432      432    1        '00'X,'00'X,
      433      433    1        '00'X,'00'X,
      434      434    1        '00'X,'00'X,
      435      435    1        '00'X,'00'X,
      436      436    1        '00'X,'00'X,
      437      437    1        '00'X,'00'X,
      438      438    1        '00'X,'00'X,
      439      439    1        '00'X,'00'X,
      440      440    1        '00'X,'00'X,
      441      441    1        '00'X,'00'X,
      442      442    1        '00'X,'00'X,
      443      443    1        '00'X,'00'X,
      444      444    1        '00'X,'00'X,
      445      445    1        '00'X,'00'X,
      446      446    1        '00'X,'00'X,
      447      447    1        '00'X,'00'X,
      448      448    1        '00'X,'00'X,
      449      449    1        '00'X,'00'X,
      450      450    1        '00'X,'00'X,
      451      451    1        '00'X,'00'X,
      452      452    1        '00'X,'00'X,
      453      453    1        '00'X,'00'X,
      454      454    1        '00'X,'00'X,
      455      455    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:15   
      456      456    1        '00'X,'00'X,
      457      457    1        '00'X,'00'X,
      458      458    1        '00'X,'00'X,
      459      459    1        '00'X,'00'X,
      460      460    1        '00'X,'00'X,
      461      461    1        '00'X,'00'X,
      462      462    1        '00'X,'00'X,
      463      463    1        '00'X,'00'X,
      464      464    1        '00'X,'00'X,
      465      465    1        '00'X,'00'X,
      466      466    1        '00'X,'00'X,
      467      467    1        '00'X,'00'X,
      468      468    1        '00'X,'00'X,
      469      469    1        '00'X,'00'X,
      470      470    1        '00'X,'00'X,
      471      471    1        '00'X,'00'X,
      472      472    1        '00'X,'00'X,
      473      473    1        '00'X,'00'X,
      474      474    1        '00'X,'00'X,
      475      475    1        '00'X,'00'X,
      476      476    1        '00'X,'00'X,
      477      477    1        '00'X,'00'X,
      478      478    1        '00'X,'00'X,
      479      479    1        '00'X,'00'X);
      480      480        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:16   
      481      481
      482      482        /* The following is the CALF source used to generate the
      483      483             above initialization constants.
      484      484        *
      485      485        * This is the SECONDARY_BOOT routine.
      486      486        *
      487      487        * SECONDARY_BOOT facts:
      488      488        *    length = EXACTLY 256D bytes = 128D words
      489      489        *    track location = 0
      490      490        *    sector location = 0
      491      491        *    loaded into memory at word = 256D = 100H
      492      492        *    boot device address passed by firmware in R1
      493      493        *
      494      494        * All operational parameters are hard-coded as follows:
      495      495        *     start loading memory at .200
      496      496        *     start loading from disk at track 0, sector 10
      497      497        *     load size = 8K words = 64 sectors (plus one for RELOADER)
      498      498        *     all sectors = 256 bytes
      499      499        *     sectors numbered 0-15, then go to other side
      500      500        *
      501      501        LOADMEM   EQU       '200'X                START LOADING MEMORY
      502      502        NUMSEC    EQU       65                    NUMBER OF SECTORS TO LOAD
      503      503                  ORG       '0180'X               PRIMAL WILL PUT US HERE
      504      504        START     LDB,B3    =LOADMEM              POINT TO MEMORY TO FILL
      505      505                  LDB,B7    =IOLOP                LOCATE I/O SUBROUTINE
      506      506                  LDR,R2    ='0A01'X              SECTOR = 10, SECTOR SIZE = 256
      507      507                  LDR,R3    ='0000'X              TRACK = 0, SIDE = 0
      508      508                  CL        R5                    CLEAR SECTOR COUNT
      509      509        TRY_AGAIN LDR,R4    R1                    PUT DEVICE ADD. IN R4
      510      510        *
      511      511        * Set up CONFIGURATION WORD A (track and side).
      512      512        *
      513      513                  OR,R4     ='11'X                COMMAND TO OUTPUT CONFIG A
      514      514                  LDR,R6    R3                    ARGUMENT TO AGREED REGISTER
      515      515                  LNJ,B6    ,B7                   OUTPUT CONFIG A (TRACK)
      516      516        *
      517      517        * Set up CONFIGURATION WORD B (sector and sector size).
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:17   
      518      518        *
      519      519                  OR,R4     ='13'X                COMMAND TO OUTPUT CONFIG B
      520      520                  LDR,R6    R2                    ARGUMENT TO AGREED REGISTER
      521      521                  LNJ,B6    ,B7                   OUTPUT CONFIG B
      522      522        *
      523      523        * Seek the track we want.
      524      524        *
      525      525                  XOR,R4    ='14'X                CONVERT ='13'X TO '07'X
      526      526                  LDR,R6    ='0100'X              TASK = SEEK
      527      527                  LNJ,B6    ,B7                   DO THE SEEK
      528      528        *
      529      529        * Set up ADDRESS and RANGE.
      530      530        *
      531      531                  XOR,R4    ='0E'X                CONVERT ='07'X TO '09'X
      532      532                  LDR,R6    =256                  A FULL SECTOR AT A TIME
      533      533        IO4       IOLD      (,B3),(R4),(R6)       OUTPUT ADDRESS AND RANGE
      534      534                  BIOF      IO4,SPREL
      535      535        *
      536      536        * Read the sector.
      537      537        *
      538      538                  XOR,R4    ='0E'X                CONVERT ='09'X TO '07'X
      539      539                  LDR,R6    ='8100'X              TASK = DATA READ
      540      540                  LNJ,B6    ,B7                   OUTPUT TASK
      541      541        *
      542      542        * Find out how we did.
      543      543        *
      544      544                  XOR,R4    ='1F'X                CONVERT ='07'X TO '18'X
      545      545                  LNJ,B6    ,B7                   INPUT STATUS
      546      546                  AND,R6    ='3F27'X              AND IMPORTANT STATUS BITS
      547      547                  BNEZ,R6   TRY_AGAIN,SPREL
      548      548        *
      549      549        * We're done with this sector.
      550      550        *
      551      551                  ADD,R2    ='100'X               INCREMENT SECTOR BY 1
      552      552                  ADV,R5    1                     INCREMENT SECTOR COUNT
      553      553                  LAB,B3    128,B3                INCREMENT ADDRESS BY 256D BYTES
      554      554                  CMR,R2    ='1001'X              TEST END SECTOR IN TRACK
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:18   
      555      555                  BL        NOT_YET,SPREL         NOT END SECTOR NUMBER
      556      556        *
      557      557        * Last sector in a track encountered.  Bump to the next side.
      558      558        *
      559      559                  XOR,R3    ='0001'X              FLIP SIDE
      560      560                  LDR,R2    ='0001'X              SECTOR = 0, SECTOR SIZE = 256
      561      561        *
      562      562        * If side wrapped, bump to next track.
      563      563        *
      564      564                  LB,'0001'X R3
      565      565                  BBT       NOT_YET,SPREL
      566      566                  ADD,R3    ='0100'X              INCREMENT TRACK
      567      567        *
      568      568        * Next sector number computed.  Are we done?
      569      569        *
      570      570        NOT_YET   CMR,R5    =NUMSEC               CHECK FOR LAST SECTOR
      571      571                  BL        TRY_AGAIN,SPREL
      572      572                  JMP       -128,B3               START RELOADER, PAST FIRST BIGFOOT
      573      573        *
      574      574        * Subroutine to perform I/O
      575      575        *
      576      576        IOLOP     IO        (R6),(R4)             PERFORM I/O
      577      577                  BIOF      IOLOP,SPREL           UNTIL IT TAKES
      578      578                  LNJ,B6    ,B6                   RETURN
      579      579        *
      580      580        * Spare space
      581      581        *
      582      582                  HLT
      583      583                  HLT
      584      584                  HLT
      585      585                  HLT
      586      586                  HLT
      587      587                  HLT
      588      588                  HLT
      589      589                  HLT
      590      590                  HLT
      591      591                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:19   
      592      592                  HLT
      593      593                  HLT
      594      594                  HLT
      595      595                  HLT
      596      596                  HLT
      597      597                  HLT
      598      598                  HLT
      599      599                  HLT
      600      600                  HLT
      601      601                  HLT
      602      602                  HLT
      603      603                  HLT
      604      604                  HLT
      605      605                  HLT
      606      606                  HLT
      607      607                  HLT
      608      608                  HLT
      609      609                  HLT
      610      610                  HLT
      611      611                  HLT
      612      612                  HLT
      613      613                  HLT
      614      614                  HLT
      615      615                  HLT
      616      616                  HLT
      617      617                  HLT
      618      618                  HLT
      619      619                  HLT
      620      620                  HLT
      621      621                  HLT
      622      622                  HLT
      623      623                  HLT
      624      624                  HLT
      625      625                  HLT
      626      626                  HLT
      627      627                  HLT
      628      628                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:20   
      629      629                  HLT
      630      630                  HLT
      631      631                  HLT
      632      632                  HLT
      633      633                  HLT
      634      634                  HLT
      635      635                  HLT
      636      636                  HLT
      637      637                  HLT
      638      638                  HLT
      639      639                  HLT
      640      640                  END
      641      641        */
      642      642        /**/
      643      643        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:21   
      644      644    1   DCL 1 RELOADER (0:255) STATIC SYMDEF UNAL,
      645      645    1         2 * BIT(1) UNAL INIT('0'B*0),
      646      646    1         2 * BIT(8) UNAL INIT(
      647      647    1        'F4'X,'57'X,
      648      648    1        'CC'X,'F0'X,
      649      649    1        '00'X,'00'X,
      650      650    1        '02'X,'00'X,
      651      651    1        'F8'X,'00'X,
      652      652    1        '00'X,'00'X,
      653      653    1        '00'X,'18'X,
      654      654    1        'FF'X,'44'X,
      655      655    1        '00'X,'18'X,
      656      656    1        'F8'X,'00'X,
      657      657    1        '00'X,'00'X,
      658      658    1        '00'X,'19'X,
      659      659    1        'FF'X,'44'X,
      660      660    1        '00'X,'19'X,
      661      661    1        'F8'X,'00'X,
      662      662    1        '00'X,'00'X,
      663      663    1        '00'X,'1A'X,
      664      664    1        'FF'X,'44'X,
      665      665    1        '00'X,'1A'X,
      666      666    1        'AC'X,'F0'X,
      667      667    1        '00'X,'00'X,
      668      668    1        '02'X,'00'X,
      669      669    1        'BC'X,'F0'X,
      670      670    1        '00'X,'00'X,
      671      671    1        '00'X,'00'X,
      672      672    1        '87'X,'52'X,
      673      673    1        '87'X,'53'X,
      674      674    1        'E8'X,'70'X,
      675      675    1        '01'X,'00'X,
      676      676    1        '00'X,'08'X,
      677      677    1        'AB'X,'C2'X,
      678      678    1        '00'X,'80'X,
      679      679    1        'BB'X,'C3'X,
      680      680    1        '00'X,'80'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:22   
      681      681    1        '57'X,'77'X,
      682      682    1        'C8'X,'51'X,
      683      683    1        'C4'X,'00'X,
      684      684    1        '00'X,'00'X,
      685      685    1        '00'X,'01'X,
      686      686    1        'B8'X,'70'X,
      687      687    1        '40'X,'00'X,
      688      688    1        '80'X,'53'X,
      689      689    1        '00'X,'54'X,
      690      690    1        '07'X,'FE'X,
      691      691    1        '0F'X,'80'X,
      692      692    1        '00'X,'00'X,
      693      693    1        '01'X,'00'X,
      694      694    1        '00'X,'00'X,
      695      695    1        '00'X,'00'X,
      696      696    1        '00'X,'00'X,
      697      697    1        '00'X,'00'X,
      698      698    1        '00'X,'00'X,
      699      699    1        '00'X,'00'X,
      700      700    1        '00'X,'00'X,
      701      701    1        '00'X,'00'X,
      702      702    1        '00'X,'00'X,
      703      703    1        '00'X,'00'X,
      704      704    1        '00'X,'00'X,
      705      705    1        '00'X,'00'X,
      706      706    1        '00'X,'00'X,
      707      707    1        '00'X,'00'X,
      708      708    1        '00'X,'00'X,
      709      709    1        '00'X,'00'X,
      710      710    1        '00'X,'00'X,
      711      711    1        '00'X,'00'X,
      712      712    1        '00'X,'00'X,
      713      713    1        '00'X,'00'X,
      714      714    1        '00'X,'00'X,
      715      715    1        '00'X,'00'X,
      716      716    1        '00'X,'00'X,
      717      717    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:23   
      718      718    1        '00'X,'00'X,
      719      719    1        '00'X,'00'X,
      720      720    1        '00'X,'00'X,
      721      721    1        '00'X,'00'X,
      722      722    1        '00'X,'00'X,
      723      723    1        '00'X,'00'X,
      724      724    1        '00'X,'00'X,
      725      725    1        '00'X,'00'X,
      726      726    1        '00'X,'00'X,
      727      727    1        '00'X,'00'X,
      728      728    1        '00'X,'00'X,
      729      729    1        '00'X,'00'X,
      730      730    1        '00'X,'00'X,
      731      731    1        '00'X,'00'X,
      732      732    1        '00'X,'00'X,
      733      733    1        '00'X,'00'X,
      734      734    1        '00'X,'00'X,
      735      735    1        '00'X,'00'X,
      736      736    1        '00'X,'00'X,
      737      737    1        '00'X,'00'X,
      738      738    1        '00'X,'00'X,
      739      739    1        '00'X,'00'X,
      740      740    1        '00'X,'00'X,
      741      741    1        '00'X,'00'X,
      742      742    1        '00'X,'00'X,
      743      743    1        '00'X,'00'X,
      744      744    1        '00'X,'00'X,
      745      745    1        '00'X,'00'X,
      746      746    1        '00'X,'00'X,
      747      747    1        '00'X,'00'X,
      748      748    1        '00'X,'00'X,
      749      749    1        '00'X,'00'X,
      750      750    1        '00'X,'00'X,
      751      751    1        '00'X,'00'X,
      752      752    1        '00'X,'00'X,
      753      753    1        '00'X,'00'X,
      754      754    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:24   
      755      755    1        '00'X,'00'X,
      756      756    1        '00'X,'00'X,
      757      757    1        '00'X,'00'X,
      758      758    1        '00'X,'00'X,
      759      759    1        '00'X,'00'X,
      760      760    1        '00'X,'00'X,
      761      761    1        '00'X,'00'X,
      762      762    1        '00'X,'00'X,
      763      763    1        '00'X,'00'X,
      764      764    1        '00'X,'00'X,
      765      765    1        '00'X,'00'X,
      766      766    1        '00'X,'00'X,
      767      767    1        '00'X,'00'X,
      768      768    1        '00'X,'00'X,
      769      769    1        '00'X,'00'X,
      770      770    1        '00'X,'00'X,
      771      771    1        '00'X,'00'X,
      772      772    1        '00'X,'00'X,
      773      773    1        '00'X,'00'X,
      774      774    1        '00'X,'00'X);
      775      775        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:25   
      776      776        /* The following is the CALF source used to generate the
      777      777           above constants.
      778      778        *
      779      779        * This is the RELOADER code.  It's purpose is to shuffle the
      780      780        * boot image from it's physical load location down to the
      781      781        * memory from which it will execute.
      782      782        *
      783      783        * Since this code affects low memory, it must execute out of high
      784      784        * memory.  This is simplified by tacking it onto the end of the
      785      785        * boot image.  As a result, the reloader must be written to
      786      786        * execute from any location it happens to load into.
      787      787        *
      788      788        * Notes:
      789      789        *  o Upon entry, R5 is the count of sectors loaded.
      790      790        *  o Shuffle BIGFOOT from .200 to .000.
      791      791        *  o After moving BIGFOOT, start him as .100.
      792      792        *  o Address of boot device passed in R1.
      793      793        *
      794      794        LOADMEM   EQU       '200'X                PLACE WHERE MEMORY WAS LOADED
      795      795                  ORG       '000'X                WRITTEN TO LOAD ANYWHERE
      796      796                  OR,R7     R7                    ONE-WORD NO-OP
      797      797        *
      798      798        * Move some juicy words up to boot image so that they will
      799      799        * be moved back down again.  The net effect is that the contents
      800      800        * of these locations will be preserved.
      801      801        *
      802      802                  LDB,B4    =LOADMEM
      803      803                  LDR,R7    '18'X
      804      804                  STR,R7    '18'X,B4
      805      805                  LDR,R7    '19'X
      806      806                  STR,R7    '19'X,B4
      807      807                  LDR,R7    '1A'X
      808      808                  STR,R7    '1A'X,B4
      809      809        *
      810      810        * Set up for the move operation.
      811      811        *
      812      812                  LDB,B2    =LOADMEM              INITIAL SOURCE LOCATION
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:26   
      813      813                  LDB,B3    ='00000'X             INITIAL DESTINATION LOCATION
      814      814        *
      815      815        * Move a sector-sized chunk of memory
      816      816        *
      817      817        MOVLOP    CL        R2
      818      818                  CL        R3
      819      819                  LDR,R6    =256                  SIZE = 1 SECTOR
      820      820                  MMM
      821      821        *
      822      822        * Increment source and destination pointers by a sector-sized
      823      823        * number of bytes.
      824      824        *
      825      825                  LAB,B2    '80'X,B2
      826      826                  LAB,B3    '80'X,B3
      827      827        *
      828      828        * Count this sector as moved.  Move another chunk if there is one left.
      829      829        *
      830      830                  BDEC,R5   MOVLOP,SPREL
      831      831        *
      832      832        * Tweak the boot device.
      833      833        *
      834      834                  LDR,R4    R1
      835      835                  OR,R4     1
      836      836                  LDR,R3    ='4000'X
      837      837        IOLP      IO        (R3),(R4)
      838      838                  BIOF      IOLP,SPREL
      839      839        *
      840      840        * Start up reloaded code.
      841      841        *
      842      842                  B         '0100'X
      843      843        *
      844      844        * SPARE space
      845      845        *
      846      846                  HLT
      847      847                  HLT
      848      848                  HLT
      849      849                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:27   
      850      850                  HLT
      851      851                  HLT
      852      852                  HLT
      853      853                  HLT
      854      854                  HLT
      855      855                  HLT
      856      856                  HLT
      857      857                  HLT
      858      858                  HLT
      859      859                  HLT
      860      860                  HLT
      861      861                  HLT
      862      862                  HLT
      863      863                  HLT
      864      864                  HLT
      865      865                  HLT
      866      866                  HLT
      867      867                  HLT
      868      868                  HLT
      869      869                  HLT
      870      870                  HLT
      871      871                  HLT
      872      872                  HLT
      873      873                  HLT
      874      874                  HLT
      875      875                  HLT
      876      876                  HLT
      877      877                  HLT
      878      878                  HLT
      879      879                  HLT
      880      880                  HLT
      881      881                  HLT
      882      882                  HLT
      883      883                  HLT
      884      884                  HLT
      885      885                  HLT
      886      886                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:28   
      887      887                  HLT
      888      888                  HLT
      889      889                  HLT
      890      890                  HLT
      891      891                  HLT
      892      892                  HLT
      893      893                  HLT
      894      894                  HLT
      895      895                  HLT
      896      896                  HLT
      897      897                  HLT
      898      898                  HLT
      899      899                  HLT
      900      900                  HLT
      901      901                  HLT
      902      902                  HLT
      903      903                  HLT
      904      904                  HLT
      905      905                  HLT
      906      906                  HLT
      907      907                  HLT
      908      908                  HLT
      909      909                  HLT
      910      910                  HLT
      911      911                  HLT
      912      912                  HLT
      913      913                  HLT
      914      914                  HLT
      915      915                  HLT
      916      916                  HLT
      917      917                  HLT
      918      918                  HLT
      919      919                  HLT
      920      920                  HLT
      921      921                  HLT
      922      922                  HLT
      923      923                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:29   
      924      924                  HLT
      925      925                  HLT
      926      926                  HLT
      927      927                  END
      928      928        */
      929      929    1   END KPP$PRIMAL_BOOT;

PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:30   
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KPP$PRIMAL_BOOT.

   No code generated for procedure KPP$PRIMAL_BOOT .
   Procedure KPP$PRIMAL_BOOT requires 4 words of local(AUTO) storage.

    No errors detected in file KPP$PRIMAL_BOOT.:E05TSI    .

PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:31   

 Object Unit name= KPP$PRIMAL_BOOT                            File name= KPP$PRIMAL_BOOT.:E05TOU
 UTS= JUL 30 '97 01:21:13.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none   192    300  KPP$PRIMAL_BOOT
    1   Proc  even  none     0      0  KPP$PRIMAL_BOOT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes     ~proc       0  KPP$PRIMAL_BOOT

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  PRIMAL_BOOT                        0    100  SECONDARY_BOOT
    0    200  RELOADER
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:32   

        1        1        /*M* KPP$PRIMAL_BOOT contains special data to be written to a boot disk.      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,DFC */
        8        8        KPP$PRIMAL_BOOT: PROC;
        9        9        /*F*     NAME:          KPP$PRIMAL_BOOT
       10       10                 PURPOSE:       All the special data written to a boot disk.
       11       11                 DESCRIPTION:   During a cold boot of the L6 (or after being
       12       12               nuked), the firmware reads in the primal boot image.
       13       13               This code is in charge of bringing in the rest of the
       14       14               boot image and starting it up.
       15       15
       16       16               This module contains the PRIMAL BOOT and RELOADER
       17       17               code in the form of binary constants to be written
       18       18               by PIGETTE on the appropriate part of the diskette.
       19       19
       20       20               To make the hex initialization constants, the following
       21       21               JCL may be used:
       22       22                 !CALF RELOADER OVER RELOADER_OU,ME
       23       23                 !C RELOADER_OU(O'777'-) OVER RELOADER_HEX(X(NOTEXT,DUP),WIDTH=27,LN)
       24       24                 !E RELOADER_HEX
       25       25                 IF NOT /0/?5/  /?9/ /,1,27;DE
       26       26                 9L8
       27       27                 END
       28       28                 !C RELOADER_HEX OVER RELOADER_HEX(LN,WRAP,WIDTH=10)
       29       29                 !E RELOADER_HEX
       30       30                 DE 1-3
       31       31                 SE
       32       32                 5E/ /
       33       33                 4F/'X,/;2F/'X,'/;1P/     '/
       34       34                 SE 999
       35       35                 ^
       36       36                 /,  /S/);/
       37       37                 Q
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:33   
       38       38               After execution, merge the _HEX file in as the INIT constants.
       39       39               AFTER MAKING SURE tha there are 128 records.  More or less
       40       40               means trouble!
       41       41        */
       42       42        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:34   
       43       43        /**/
       44       44        /* Hex declaration for the boot strap that goes on track 0                    */
       45       45        /* sector 0.                                                                  */
       46       46        /**/
       47       47    1   DCL 1 PRIMAL_BOOT (0:255) UNAL STATIC SYMDEF,
       48       48    1         2 * BIT(1) UNAL INIT('0'B*0),
       49       49    1         2 * BIT(8) UNAL INIT(
       50       50    1        'BC'X,'F0'X,
       51       51    1        '00'X,'00'X,
       52       52    1        '01'X,'80'X,
       53       53    1        'FC'X,'F0'X,
       54       54    1        '00'X,'00'X,
       55       55    1        '01'X,'2E'X,
       56       56    1        'A8'X,'70'X,
       57       57    1        '01'X,'01'X,
       58       58    1        'B8'X,'70'X,
       59       59    1        '00'X,'00'X,
       60       60    1        'C8'X,'51'X,
       61       61    1        'C4'X,'70'X,
       62       62    1        '00'X,'11'X,
       63       63    1        'E8'X,'53'X,
       64       64    1        'E3'X,'87'X,
       65       65    1        'C4'X,'70'X,
       66       66    1        '00'X,'13'X,
       67       67    1        'E8'X,'52'X,
       68       68    1        'E3'X,'87'X,
       69       69    1        'C6'X,'70'X,
       70       70    1        '00'X,'14'X,
       71       71    1        'E8'X,'70'X,
       72       72    1        '01'X,'00'X,
       73       73    1        'E3'X,'87'X,
       74       74    1        'C6'X,'70'X,
       75       75    1        '00'X,'0E'X,
       76       76    1        'E8'X,'70'X,
       77       77    1        '01'X,'00'X,
       78       78    1        '81'X,'83'X,
       79       79    1        '00'X,'54'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:35   
       80       80    1        '00'X,'56'X,
       81       81    1        '07'X,'FD'X,
       82       82    1        'C6'X,'70'X,
       83       83    1        '00'X,'0E'X,
       84       84    1        'E8'X,'70'X,
       85       85    1        '81'X,'00'X,
       86       86    1        'E3'X,'87'X,
       87       87    1        'C6'X,'70'X,
       88       88    1        '00'X,'1F'X,
       89       89    1        'E3'X,'87'X,
       90       90    1        'E5'X,'70'X,
       91       91    1        '3F'X,'27'X,
       92       92    1        '69'X,'E0'X,
       93       93    1        '83'X,'80'X,
       94       94    1        '00'X,'00'X,
       95       95    1        '01'X,'80'X,
       96       96    1        '80'X,'56'X,
       97       97    1        '00'X,'54'X,
       98       98    1        '07'X,'FE'X,
       99       99    1        'E3'X,'86'X,
      100      100    1        '00'X,'00'X,
      101      101    1        '00'X,'00'X,
      102      102    1        '00'X,'00'X,
      103      103    1        '00'X,'00'X,
      104      104    1        '00'X,'00'X,
      105      105    1        '00'X,'00'X,
      106      106    1        '00'X,'00'X,
      107      107    1        '00'X,'00'X,
      108      108    1        '00'X,'00'X,
      109      109    1        '00'X,'00'X,
      110      110    1        '00'X,'00'X,
      111      111    1        '00'X,'00'X,
      112      112    1        '00'X,'00'X,
      113      113    1        '00'X,'00'X,
      114      114    1        '00'X,'00'X,
      115      115    1        '00'X,'00'X,
      116      116    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:36   
      117      117    1        '00'X,'00'X,
      118      118    1        '00'X,'00'X,
      119      119    1        '00'X,'00'X,
      120      120    1        '00'X,'00'X,
      121      121    1        '00'X,'00'X,
      122      122    1        '00'X,'00'X,
      123      123    1        '00'X,'00'X,
      124      124    1        '00'X,'00'X,
      125      125    1        '00'X,'00'X,
      126      126    1        '00'X,'00'X,
      127      127    1        '00'X,'00'X,
      128      128    1        '00'X,'00'X,
      129      129    1        '00'X,'00'X,
      130      130    1        '00'X,'00'X,
      131      131    1        '00'X,'00'X,
      132      132    1        '00'X,'00'X,
      133      133    1        '00'X,'00'X,
      134      134    1        '00'X,'00'X,
      135      135    1        '00'X,'00'X,
      136      136    1        '00'X,'00'X,
      137      137    1        '00'X,'00'X,
      138      138    1        '00'X,'00'X,
      139      139    1        '00'X,'00'X,
      140      140    1        '00'X,'00'X,
      141      141    1        '00'X,'00'X,
      142      142    1        '00'X,'00'X,
      143      143    1        '00'X,'00'X,
      144      144    1        '00'X,'00'X,
      145      145    1        '00'X,'00'X,
      146      146    1        '00'X,'00'X,
      147      147    1        '00'X,'00'X,
      148      148    1        '00'X,'00'X,
      149      149    1        '00'X,'00'X,
      150      150    1        '00'X,'00'X,
      151      151    1        '00'X,'00'X,
      152      152    1        '00'X,'00'X,
      153      153    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:37   
      154      154    1        '00'X,'00'X,
      155      155    1        '00'X,'00'X,
      156      156    1        '00'X,'00'X,
      157      157    1        '00'X,'00'X,
      158      158    1        '00'X,'00'X,
      159      159    1        '00'X,'00'X,
      160      160    1        '00'X,'00'X,
      161      161    1        '00'X,'00'X,
      162      162    1        '00'X,'00'X,
      163      163    1        '00'X,'00'X,
      164      164    1        '00'X,'00'X,
      165      165    1        '00'X,'00'X,
      166      166    1        '00'X,'00'X,
      167      167    1        '00'X,'00'X,
      168      168    1        '00'X,'00'X,
      169      169    1        '00'X,'00'X,
      170      170    1        '00'X,'00'X,
      171      171    1        '00'X,'00'X,
      172      172    1        '00'X,'00'X,
      173      173    1        '00'X,'00'X,
      174      174    1        '00'X,'00'X,
      175      175    1        '00'X,'00'X,
      176      176    1        '00'X,'00'X,
      177      177    1        '00'X,'00'X);
      178      178        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:38   
      179      179
      180      180        /* The following is the CALF source used to generate the
      181      181             above initialization constants.
      182      182        *
      183      183        * This is the PRIMAL_BOOT routine.
      184      184        *
      185      185        * The sequence of events is as follows:
      186      186        *    o Firmware reads in 128 bytes of PRIMAL BOOT.
      187      187        *    o PRIMAL BOOT reads in 256 bytes of SECONDARY BOOT.
      188      188        *    o SECONDARY BOOT reads in first 8K words of BIGFOOT and RELOADER.
      189      189        *    o RELOADER shuffles BIGFOOT down to run memory and starts him.
      190      190        *    o BIGFOOT reads in remainder of boot image.
      191      191        *
      192      192        * PRIMAL_BOOT facts:
      193      193        *    length = EXACTLY 256D bytes = 128D words
      194      194        *             of these, only HALF (128 bytes) are loaded by firmware!
      195      195        *    track location = 0
      196      196        *    sector location = 0
      197      197        *    loaded into memory at word = 256D = 100H
      198      198        *    boot device address passed by firmware in R1
      199      199        *
      200      200        * All operational parameters are hard-coded as follows:
      201      201        *     start loading memory at .180
      202      202        *     start loading from disk at track 0, sector 1
      203      203        *     load size = 1 SECTOR
      204      204        *     all sectors = 256 bytes
      205      205        *
      206      206        SECONDARY EQU       '180'X                START LOADING MEMORY
      207      207                  ORG       '100'X                FIRMWARE WILL PUT US HERE
      208      208        START     LDB,B3    =SECONDARY            POINT TO MEMORY TO FILL
      209      209                  LDB,B7    =IOLOP                LOCATE I/O SUBROUTINE
      210      210                  LDR,R2    ='0101'X              SECTOR = 1, SECTOR SIZE = 256
      211      211                  LDR,R3    ='0000'X              TRACK = 0, SIDE = 0
      212      212        TRY_AGAIN LDR,R4    R1                    PUT DEVICE ADD. IN R4
      213      213        *
      214      214        * Set up CONFIGURATION WORD A (track and side).
      215      215        *
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:39   
      216      216                  OR,R4     ='11'X                COMMAND TO OUTPUT CONFIG A
      217      217                  LDR,R6    R3                    ARGUMENT TO AGREED REGISTER
      218      218                  LNJ,B6    ,B7                   OUTPUT CONFIG A (TRACK)
      219      219        *
      220      220        * Set up CONFIGURATION WORD B (sector and sector size).
      221      221        *
      222      222                  OR,R4     ='13'X                COMMAND TO OUTPUT CONFIG B
      223      223                  LDR,R6    R2                    ARGUMENT TO AGREED REGISTER
      224      224                  LNJ,B6    ,B7                   OUTPUT CONFIG B
      225      225        *
      226      226        * Seek the track we want.
      227      227        *
      228      228                  XOR,R4    ='14'X                CONVERT ='13'X TO '07'X
      229      229                  LDR,R6    ='0100'X              TASK = SEEK
      230      230                  LNJ,B6    ,B7                   DO THE SEEK
      231      231        *
      232      232        * Set up ADDRESS and RANGE.
      233      233        *
      234      234                  XOR,R4    ='0E'X                CONVERT ='07'X TO '09'X
      235      235                  LDR,R6    =256                  A FULL SECTOR AT A TIME
      236      236        IO4       IOLD      (,B3),(R4),(R6)       OUTPUT ADDRESS AND RANGE
      237      237                  BIOF      IO4,SPREL
      238      238        *
      239      239        * Read the sector.
      240      240        *
      241      241                  XOR,R4    ='0E'X                CONVERT ='09'X TO '07'X
      242      242                  LDR,R6    ='8100'X              TASK = DATA READ
      243      243                  LNJ,B6    ,B7                   OUTPUT TASK
      244      244        *
      245      245        * Find out how we did.
      246      246        *
      247      247                  XOR,R4    ='1F'X                CONVERT ='07'X TO '18'X
      248      248                  LNJ,B6    ,B7                   INPUT STATUS
      249      249                  AND,R6    ='3F27'X              AND IMPORTANT STATUS BITS
      250      250                  BNEZ,R6   TRY_AGAIN,SPREL
      251      251        *
      252      252        * We're done loading SECONDARY BOOT.
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:40   
      253      253        *
      254      254                  JMP       SECONDARY             START THE SECONDARY BOOT
      255      255        *
      256      256        * Subroutine to perform I/O
      257      257        *
      258      258        IOLOP     IO        (R6),(R4)             PERFORM I/O
      259      259                  BIOF      IOLOP,SPREL           UNTIL IT TAKES
      260      260                  LNJ,B6    ,B6                   RETURN
      261      261        *
      262      262        * Spare space
      263      263        *
      264      264                  HLT
      265      265                  HLT
      266      266                  HLT
      267      267                  HLT
      268      268                  HLT
      269      269                  HLT
      270      270                  HLT
      271      271                  HLT
      272      272                  HLT
      273      273                  HLT
      274      274                  HLT
      275      275                  HLT
      276      276                  HLT
      277      277                  HLT
      278      278                  HLT
      279      279                  HLT
      280      280                  HLT
      281      281                  HLT
      282      282                  HLT
      283      283                  HLT
      284      284                  HLT
      285      285                  HLT
      286      286                  HLT
      287      287                  HLT
      288      288                  HLT
      289      289                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:41   
      290      290                  HLT
      291      291                  HLT
      292      292                  HLT
      293      293                  HLT
      294      294                  HLT
      295      295                  HLT
      296      296                  HLT
      297      297                  HLT
      298      298                  HLT
      299      299                  HLT
      300      300                  HLT
      301      301                  HLT
      302      302                  HLT
      303      303                  HLT
      304      304                  HLT
      305      305                  HLT
      306      306                  HLT
      307      307                  HLT
      308      308                  HLT
      309      309                  HLT
      310      310                  HLT
      311      311                  HLT
      312      312                  HLT
      313      313                  HLT
      314      314                  HLT
      315      315                  HLT
      316      316                  HLT
      317      317                  HLT
      318      318                  HLT
      319      319                  HLT
      320      320                  HLT
      321      321                  HLT
      322      322                  HLT
      323      323                  HLT
      324      324                  HLT
      325      325                  HLT
      326      326                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:42   
      327      327                  HLT
      328      328                  HLT
      329      329                  HLT
      330      330                  HLT
      331      331                  HLT
      332      332                  HLT
      333      333                  HLT
      334      334                  HLT
      335      335                  HLT
      336      336                  HLT
      337      337                  HLT
      338      338                  HLT
      339      339                  HLT
      340      340                  HLT
      341      341                  HLT
      342      342                  END
      343      343        */
      344      344        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:43   
      345      345        /**/
      346      346        /* Hex declaration for the secondary boot strap that goes on track 0          */
      347      347        /* sector 1.                                                                  */
      348      348        /**/
      349      349    1   DCL 1 SECONDARY_BOOT (0:255) UNAL STATIC SYMDEF,
      350      350    1         2 * BIT(1) UNAL INIT('0'B*0),
      351      351    1         2 * BIT(8) UNAL INIT(
      352      352    1        'BC'X,'F0'X,
      353      353    1        '00'X,'00'X,
      354      354    1        '02'X,'00'X,
      355      355    1        'FC'X,'F0'X,
      356      356    1        '00'X,'00'X,
      357      357    1        '01'X,'C2'X,
      358      358    1        'A8'X,'70'X,
      359      359    1        '0A'X,'01'X,
      360      360    1        'B8'X,'70'X,
      361      361    1        '00'X,'00'X,
      362      362    1        '87'X,'55'X,
      363      363    1        'C8'X,'51'X,
      364      364    1        'C4'X,'70'X,
      365      365    1        '00'X,'11'X,
      366      366    1        'E8'X,'53'X,
      367      367    1        'E3'X,'87'X,
      368      368    1        'C4'X,'70'X,
      369      369    1        '00'X,'13'X,
      370      370    1        'E8'X,'52'X,
      371      371    1        'E3'X,'87'X,
      372      372    1        'C6'X,'70'X,
      373      373    1        '00'X,'14'X,
      374      374    1        'E8'X,'70'X,
      375      375    1        '01'X,'00'X,
      376      376    1        'E3'X,'87'X,
      377      377    1        'C6'X,'70'X,
      378      378    1        '00'X,'0E'X,
      379      379    1        'E8'X,'70'X,
      380      380    1        '01'X,'00'X,
      381      381    1        '81'X,'83'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:44   
      382      382    1        '00'X,'54'X,
      383      383    1        '00'X,'56'X,
      384      384    1        '07'X,'FD'X,
      385      385    1        'C6'X,'70'X,
      386      386    1        '00'X,'0E'X,
      387      387    1        'E8'X,'70'X,
      388      388    1        '81'X,'00'X,
      389      389    1        'E3'X,'87'X,
      390      390    1        'C6'X,'70'X,
      391      391    1        '00'X,'1F'X,
      392      392    1        'E3'X,'87'X,
      393      393    1        'E5'X,'70'X,
      394      394    1        '3F'X,'27'X,
      395      395    1        '69'X,'E0'X,
      396      396    1        'AA'X,'70'X,
      397      397    1        '01'X,'00'X,
      398      398    1        '5E'X,'01'X,
      399      399    1        'BB'X,'C3'X,
      400      400    1        '00'X,'80'X,
      401      401    1        'A9'X,'70'X,
      402      402    1        '10'X,'01'X,
      403      403    1        '02'X,'0A'X,
      404      404    1        'B6'X,'70'X,
      405      405    1        '00'X,'01'X,
      406      406    1        'A8'X,'70'X,
      407      407    1        '00'X,'01'X,
      408      408    1        '82'X,'D3'X,
      409      409    1        '00'X,'01'X,
      410      410    1        '05'X,'03'X,
      411      411    1        'BA'X,'70'X,
      412      412    1        '01'X,'00'X,
      413      413    1        'D9'X,'70'X,
      414      414    1        '00'X,'41'X,
      415      415    1        '02'X,'4C'X,
      416      416    1        '83'X,'C3'X,
      417      417    1        'FF'X,'80'X,
      418      418    1        '80'X,'56'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:45   
      419      419    1        '00'X,'54'X,
      420      420    1        '07'X,'FE'X,
      421      421    1        'E3'X,'86'X,
      422      422    1        '00'X,'00'X,
      423      423    1        '00'X,'00'X,
      424      424    1        '00'X,'00'X,
      425      425    1        '00'X,'00'X,
      426      426    1        '00'X,'00'X,
      427      427    1        '00'X,'00'X,
      428      428    1        '00'X,'00'X,
      429      429    1        '00'X,'00'X,
      430      430    1        '00'X,'00'X,
      431      431    1        '00'X,'00'X,
      432      432    1        '00'X,'00'X,
      433      433    1        '00'X,'00'X,
      434      434    1        '00'X,'00'X,
      435      435    1        '00'X,'00'X,
      436      436    1        '00'X,'00'X,
      437      437    1        '00'X,'00'X,
      438      438    1        '00'X,'00'X,
      439      439    1        '00'X,'00'X,
      440      440    1        '00'X,'00'X,
      441      441    1        '00'X,'00'X,
      442      442    1        '00'X,'00'X,
      443      443    1        '00'X,'00'X,
      444      444    1        '00'X,'00'X,
      445      445    1        '00'X,'00'X,
      446      446    1        '00'X,'00'X,
      447      447    1        '00'X,'00'X,
      448      448    1        '00'X,'00'X,
      449      449    1        '00'X,'00'X,
      450      450    1        '00'X,'00'X,
      451      451    1        '00'X,'00'X,
      452      452    1        '00'X,'00'X,
      453      453    1        '00'X,'00'X,
      454      454    1        '00'X,'00'X,
      455      455    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:46   
      456      456    1        '00'X,'00'X,
      457      457    1        '00'X,'00'X,
      458      458    1        '00'X,'00'X,
      459      459    1        '00'X,'00'X,
      460      460    1        '00'X,'00'X,
      461      461    1        '00'X,'00'X,
      462      462    1        '00'X,'00'X,
      463      463    1        '00'X,'00'X,
      464      464    1        '00'X,'00'X,
      465      465    1        '00'X,'00'X,
      466      466    1        '00'X,'00'X,
      467      467    1        '00'X,'00'X,
      468      468    1        '00'X,'00'X,
      469      469    1        '00'X,'00'X,
      470      470    1        '00'X,'00'X,
      471      471    1        '00'X,'00'X,
      472      472    1        '00'X,'00'X,
      473      473    1        '00'X,'00'X,
      474      474    1        '00'X,'00'X,
      475      475    1        '00'X,'00'X,
      476      476    1        '00'X,'00'X,
      477      477    1        '00'X,'00'X,
      478      478    1        '00'X,'00'X,
      479      479    1        '00'X,'00'X);
      480      480        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:47   
      481      481
      482      482        /* The following is the CALF source used to generate the
      483      483             above initialization constants.
      484      484        *
      485      485        * This is the SECONDARY_BOOT routine.
      486      486        *
      487      487        * SECONDARY_BOOT facts:
      488      488        *    length = EXACTLY 256D bytes = 128D words
      489      489        *    track location = 0
      490      490        *    sector location = 0
      491      491        *    loaded into memory at word = 256D = 100H
      492      492        *    boot device address passed by firmware in R1
      493      493        *
      494      494        * All operational parameters are hard-coded as follows:
      495      495        *     start loading memory at .200
      496      496        *     start loading from disk at track 0, sector 10
      497      497        *     load size = 8K words = 64 sectors (plus one for RELOADER)
      498      498        *     all sectors = 256 bytes
      499      499        *     sectors numbered 0-15, then go to other side
      500      500        *
      501      501        LOADMEM   EQU       '200'X                START LOADING MEMORY
      502      502        NUMSEC    EQU       65                    NUMBER OF SECTORS TO LOAD
      503      503                  ORG       '0180'X               PRIMAL WILL PUT US HERE
      504      504        START     LDB,B3    =LOADMEM              POINT TO MEMORY TO FILL
      505      505                  LDB,B7    =IOLOP                LOCATE I/O SUBROUTINE
      506      506                  LDR,R2    ='0A01'X              SECTOR = 10, SECTOR SIZE = 256
      507      507                  LDR,R3    ='0000'X              TRACK = 0, SIDE = 0
      508      508                  CL        R5                    CLEAR SECTOR COUNT
      509      509        TRY_AGAIN LDR,R4    R1                    PUT DEVICE ADD. IN R4
      510      510        *
      511      511        * Set up CONFIGURATION WORD A (track and side).
      512      512        *
      513      513                  OR,R4     ='11'X                COMMAND TO OUTPUT CONFIG A
      514      514                  LDR,R6    R3                    ARGUMENT TO AGREED REGISTER
      515      515                  LNJ,B6    ,B7                   OUTPUT CONFIG A (TRACK)
      516      516        *
      517      517        * Set up CONFIGURATION WORD B (sector and sector size).
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:48   
      518      518        *
      519      519                  OR,R4     ='13'X                COMMAND TO OUTPUT CONFIG B
      520      520                  LDR,R6    R2                    ARGUMENT TO AGREED REGISTER
      521      521                  LNJ,B6    ,B7                   OUTPUT CONFIG B
      522      522        *
      523      523        * Seek the track we want.
      524      524        *
      525      525                  XOR,R4    ='14'X                CONVERT ='13'X TO '07'X
      526      526                  LDR,R6    ='0100'X              TASK = SEEK
      527      527                  LNJ,B6    ,B7                   DO THE SEEK
      528      528        *
      529      529        * Set up ADDRESS and RANGE.
      530      530        *
      531      531                  XOR,R4    ='0E'X                CONVERT ='07'X TO '09'X
      532      532                  LDR,R6    =256                  A FULL SECTOR AT A TIME
      533      533        IO4       IOLD      (,B3),(R4),(R6)       OUTPUT ADDRESS AND RANGE
      534      534                  BIOF      IO4,SPREL
      535      535        *
      536      536        * Read the sector.
      537      537        *
      538      538                  XOR,R4    ='0E'X                CONVERT ='09'X TO '07'X
      539      539                  LDR,R6    ='8100'X              TASK = DATA READ
      540      540                  LNJ,B6    ,B7                   OUTPUT TASK
      541      541        *
      542      542        * Find out how we did.
      543      543        *
      544      544                  XOR,R4    ='1F'X                CONVERT ='07'X TO '18'X
      545      545                  LNJ,B6    ,B7                   INPUT STATUS
      546      546                  AND,R6    ='3F27'X              AND IMPORTANT STATUS BITS
      547      547                  BNEZ,R6   TRY_AGAIN,SPREL
      548      548        *
      549      549        * We're done with this sector.
      550      550        *
      551      551                  ADD,R2    ='100'X               INCREMENT SECTOR BY 1
      552      552                  ADV,R5    1                     INCREMENT SECTOR COUNT
      553      553                  LAB,B3    128,B3                INCREMENT ADDRESS BY 256D BYTES
      554      554                  CMR,R2    ='1001'X              TEST END SECTOR IN TRACK
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:49   
      555      555                  BL        NOT_YET,SPREL         NOT END SECTOR NUMBER
      556      556        *
      557      557        * Last sector in a track encountered.  Bump to the next side.
      558      558        *
      559      559                  XOR,R3    ='0001'X              FLIP SIDE
      560      560                  LDR,R2    ='0001'X              SECTOR = 0, SECTOR SIZE = 256
      561      561        *
      562      562        * If side wrapped, bump to next track.
      563      563        *
      564      564                  LB,'0001'X R3
      565      565                  BBT       NOT_YET,SPREL
      566      566                  ADD,R3    ='0100'X              INCREMENT TRACK
      567      567        *
      568      568        * Next sector number computed.  Are we done?
      569      569        *
      570      570        NOT_YET   CMR,R5    =NUMSEC               CHECK FOR LAST SECTOR
      571      571                  BL        TRY_AGAIN,SPREL
      572      572                  JMP       -128,B3               START RELOADER, PAST FIRST BIGFOOT
      573      573        *
      574      574        * Subroutine to perform I/O
      575      575        *
      576      576        IOLOP     IO        (R6),(R4)             PERFORM I/O
      577      577                  BIOF      IOLOP,SPREL           UNTIL IT TAKES
      578      578                  LNJ,B6    ,B6                   RETURN
      579      579        *
      580      580        * Spare space
      581      581        *
      582      582                  HLT
      583      583                  HLT
      584      584                  HLT
      585      585                  HLT
      586      586                  HLT
      587      587                  HLT
      588      588                  HLT
      589      589                  HLT
      590      590                  HLT
      591      591                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:50   
      592      592                  HLT
      593      593                  HLT
      594      594                  HLT
      595      595                  HLT
      596      596                  HLT
      597      597                  HLT
      598      598                  HLT
      599      599                  HLT
      600      600                  HLT
      601      601                  HLT
      602      602                  HLT
      603      603                  HLT
      604      604                  HLT
      605      605                  HLT
      606      606                  HLT
      607      607                  HLT
      608      608                  HLT
      609      609                  HLT
      610      610                  HLT
      611      611                  HLT
      612      612                  HLT
      613      613                  HLT
      614      614                  HLT
      615      615                  HLT
      616      616                  HLT
      617      617                  HLT
      618      618                  HLT
      619      619                  HLT
      620      620                  HLT
      621      621                  HLT
      622      622                  HLT
      623      623                  HLT
      624      624                  HLT
      625      625                  HLT
      626      626                  HLT
      627      627                  HLT
      628      628                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:51   
      629      629                  HLT
      630      630                  HLT
      631      631                  HLT
      632      632                  HLT
      633      633                  HLT
      634      634                  HLT
      635      635                  HLT
      636      636                  HLT
      637      637                  HLT
      638      638                  HLT
      639      639                  HLT
      640      640                  END
      641      641        */
      642      642        /**/
      643      643        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:52   
      644      644    1   DCL 1 RELOADER (0:255) STATIC SYMDEF UNAL,
      645      645    1         2 * BIT(1) UNAL INIT('0'B*0),
      646      646    1         2 * BIT(8) UNAL INIT(
      647      647    1        'F4'X,'57'X,
      648      648    1        'CC'X,'F0'X,
      649      649    1        '00'X,'00'X,
      650      650    1        '02'X,'00'X,
      651      651    1        'F8'X,'00'X,
      652      652    1        '00'X,'00'X,
      653      653    1        '00'X,'18'X,
      654      654    1        'FF'X,'44'X,
      655      655    1        '00'X,'18'X,
      656      656    1        'F8'X,'00'X,
      657      657    1        '00'X,'00'X,
      658      658    1        '00'X,'19'X,
      659      659    1        'FF'X,'44'X,
      660      660    1        '00'X,'19'X,
      661      661    1        'F8'X,'00'X,
      662      662    1        '00'X,'00'X,
      663      663    1        '00'X,'1A'X,
      664      664    1        'FF'X,'44'X,
      665      665    1        '00'X,'1A'X,
      666      666    1        'AC'X,'F0'X,
      667      667    1        '00'X,'00'X,
      668      668    1        '02'X,'00'X,
      669      669    1        'BC'X,'F0'X,
      670      670    1        '00'X,'00'X,
      671      671    1        '00'X,'00'X,
      672      672    1        '87'X,'52'X,
      673      673    1        '87'X,'53'X,
      674      674    1        'E8'X,'70'X,
      675      675    1        '01'X,'00'X,
      676      676    1        '00'X,'08'X,
      677      677    1        'AB'X,'C2'X,
      678      678    1        '00'X,'80'X,
      679      679    1        'BB'X,'C3'X,
      680      680    1        '00'X,'80'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:53   
      681      681    1        '57'X,'77'X,
      682      682    1        'C8'X,'51'X,
      683      683    1        'C4'X,'00'X,
      684      684    1        '00'X,'00'X,
      685      685    1        '00'X,'01'X,
      686      686    1        'B8'X,'70'X,
      687      687    1        '40'X,'00'X,
      688      688    1        '80'X,'53'X,
      689      689    1        '00'X,'54'X,
      690      690    1        '07'X,'FE'X,
      691      691    1        '0F'X,'80'X,
      692      692    1        '00'X,'00'X,
      693      693    1        '01'X,'00'X,
      694      694    1        '00'X,'00'X,
      695      695    1        '00'X,'00'X,
      696      696    1        '00'X,'00'X,
      697      697    1        '00'X,'00'X,
      698      698    1        '00'X,'00'X,
      699      699    1        '00'X,'00'X,
      700      700    1        '00'X,'00'X,
      701      701    1        '00'X,'00'X,
      702      702    1        '00'X,'00'X,
      703      703    1        '00'X,'00'X,
      704      704    1        '00'X,'00'X,
      705      705    1        '00'X,'00'X,
      706      706    1        '00'X,'00'X,
      707      707    1        '00'X,'00'X,
      708      708    1        '00'X,'00'X,
      709      709    1        '00'X,'00'X,
      710      710    1        '00'X,'00'X,
      711      711    1        '00'X,'00'X,
      712      712    1        '00'X,'00'X,
      713      713    1        '00'X,'00'X,
      714      714    1        '00'X,'00'X,
      715      715    1        '00'X,'00'X,
      716      716    1        '00'X,'00'X,
      717      717    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:54   
      718      718    1        '00'X,'00'X,
      719      719    1        '00'X,'00'X,
      720      720    1        '00'X,'00'X,
      721      721    1        '00'X,'00'X,
      722      722    1        '00'X,'00'X,
      723      723    1        '00'X,'00'X,
      724      724    1        '00'X,'00'X,
      725      725    1        '00'X,'00'X,
      726      726    1        '00'X,'00'X,
      727      727    1        '00'X,'00'X,
      728      728    1        '00'X,'00'X,
      729      729    1        '00'X,'00'X,
      730      730    1        '00'X,'00'X,
      731      731    1        '00'X,'00'X,
      732      732    1        '00'X,'00'X,
      733      733    1        '00'X,'00'X,
      734      734    1        '00'X,'00'X,
      735      735    1        '00'X,'00'X,
      736      736    1        '00'X,'00'X,
      737      737    1        '00'X,'00'X,
      738      738    1        '00'X,'00'X,
      739      739    1        '00'X,'00'X,
      740      740    1        '00'X,'00'X,
      741      741    1        '00'X,'00'X,
      742      742    1        '00'X,'00'X,
      743      743    1        '00'X,'00'X,
      744      744    1        '00'X,'00'X,
      745      745    1        '00'X,'00'X,
      746      746    1        '00'X,'00'X,
      747      747    1        '00'X,'00'X,
      748      748    1        '00'X,'00'X,
      749      749    1        '00'X,'00'X,
      750      750    1        '00'X,'00'X,
      751      751    1        '00'X,'00'X,
      752      752    1        '00'X,'00'X,
      753      753    1        '00'X,'00'X,
      754      754    1        '00'X,'00'X,
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:55   
      755      755    1        '00'X,'00'X,
      756      756    1        '00'X,'00'X,
      757      757    1        '00'X,'00'X,
      758      758    1        '00'X,'00'X,
      759      759    1        '00'X,'00'X,
      760      760    1        '00'X,'00'X,
      761      761    1        '00'X,'00'X,
      762      762    1        '00'X,'00'X,
      763      763    1        '00'X,'00'X,
      764      764    1        '00'X,'00'X,
      765      765    1        '00'X,'00'X,
      766      766    1        '00'X,'00'X,
      767      767    1        '00'X,'00'X,
      768      768    1        '00'X,'00'X,
      769      769    1        '00'X,'00'X,
      770      770    1        '00'X,'00'X,
      771      771    1        '00'X,'00'X,
      772      772    1        '00'X,'00'X,
      773      773    1        '00'X,'00'X,
      774      774    1        '00'X,'00'X);
      775      775        %EJECT;
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:56   
      776      776        /* The following is the CALF source used to generate the
      777      777           above constants.
      778      778        *
      779      779        * This is the RELOADER code.  It's purpose is to shuffle the
      780      780        * boot image from it's physical load location down to the
      781      781        * memory from which it will execute.
      782      782        *
      783      783        * Since this code affects low memory, it must execute out of high
      784      784        * memory.  This is simplified by tacking it onto the end of the
      785      785        * boot image.  As a result, the reloader must be written to
      786      786        * execute from any location it happens to load into.
      787      787        *
      788      788        * Notes:
      789      789        *  o Upon entry, R5 is the count of sectors loaded.
      790      790        *  o Shuffle BIGFOOT from .200 to .000.
      791      791        *  o After moving BIGFOOT, start him as .100.
      792      792        *  o Address of boot device passed in R1.
      793      793        *
      794      794        LOADMEM   EQU       '200'X                PLACE WHERE MEMORY WAS LOADED
      795      795                  ORG       '000'X                WRITTEN TO LOAD ANYWHERE
      796      796                  OR,R7     R7                    ONE-WORD NO-OP
      797      797        *
      798      798        * Move some juicy words up to boot image so that they will
      799      799        * be moved back down again.  The net effect is that the contents
      800      800        * of these locations will be preserved.
      801      801        *
      802      802                  LDB,B4    =LOADMEM
      803      803                  LDR,R7    '18'X
      804      804                  STR,R7    '18'X,B4
      805      805                  LDR,R7    '19'X
      806      806                  STR,R7    '19'X,B4
      807      807                  LDR,R7    '1A'X
      808      808                  STR,R7    '1A'X,B4
      809      809        *
      810      810        * Set up for the move operation.
      811      811        *
      812      812                  LDB,B2    =LOADMEM              INITIAL SOURCE LOCATION
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:57   
      813      813                  LDB,B3    ='00000'X             INITIAL DESTINATION LOCATION
      814      814        *
      815      815        * Move a sector-sized chunk of memory
      816      816        *
      817      817        MOVLOP    CL        R2
      818      818                  CL        R3
      819      819                  LDR,R6    =256                  SIZE = 1 SECTOR
      820      820                  MMM
      821      821        *
      822      822        * Increment source and destination pointers by a sector-sized
      823      823        * number of bytes.
      824      824        *
      825      825                  LAB,B2    '80'X,B2
      826      826                  LAB,B3    '80'X,B3
      827      827        *
      828      828        * Count this sector as moved.  Move another chunk if there is one left.
      829      829        *
      830      830                  BDEC,R5   MOVLOP,SPREL
      831      831        *
      832      832        * Tweak the boot device.
      833      833        *
      834      834                  LDR,R4    R1
      835      835                  OR,R4     1
      836      836                  LDR,R3    ='4000'X
      837      837        IOLP      IO        (R3),(R4)
      838      838                  BIOF      IOLP,SPREL
      839      839        *
      840      840        * Start up reloaded code.
      841      841        *
      842      842                  B         '0100'X
      843      843        *
      844      844        * SPARE space
      845      845        *
      846      846                  HLT
      847      847                  HLT
      848      848                  HLT
      849      849                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:58   
      850      850                  HLT
      851      851                  HLT
      852      852                  HLT
      853      853                  HLT
      854      854                  HLT
      855      855                  HLT
      856      856                  HLT
      857      857                  HLT
      858      858                  HLT
      859      859                  HLT
      860      860                  HLT
      861      861                  HLT
      862      862                  HLT
      863      863                  HLT
      864      864                  HLT
      865      865                  HLT
      866      866                  HLT
      867      867                  HLT
      868      868                  HLT
      869      869                  HLT
      870      870                  HLT
      871      871                  HLT
      872      872                  HLT
      873      873                  HLT
      874      874                  HLT
      875      875                  HLT
      876      876                  HLT
      877      877                  HLT
      878      878                  HLT
      879      879                  HLT
      880      880                  HLT
      881      881                  HLT
      882      882                  HLT
      883      883                  HLT
      884      884                  HLT
      885      885                  HLT
      886      886                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:59   
      887      887                  HLT
      888      888                  HLT
      889      889                  HLT
      890      890                  HLT
      891      891                  HLT
      892      892                  HLT
      893      893                  HLT
      894      894                  HLT
      895      895                  HLT
      896      896                  HLT
      897      897                  HLT
      898      898                  HLT
      899      899                  HLT
      900      900                  HLT
      901      901                  HLT
      902      902                  HLT
      903      903                  HLT
      904      904                  HLT
      905      905                  HLT
      906      906                  HLT
      907      907                  HLT
      908      908                  HLT
      909      909                  HLT
      910      910                  HLT
      911      911                  HLT
      912      912                  HLT
      913      913                  HLT
      914      914                  HLT
      915      915                  HLT
      916      916                  HLT
      917      917                  HLT
      918      918                  HLT
      919      919                  HLT
      920      920                  HLT
      921      921                  HLT
      922      922                  HLT
      923      923                  HLT
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:60   
      924      924                  HLT
      925      925                  HLT
      926      926                  HLT
      927      927                  END
      928      928        */
      929      929    1   END KPP$PRIMAL_BOOT;

PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:61   
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KPP$PRIMAL_BOOT.
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:62   

 **** Variables and constants ****


   No code generated for procedure KPP$PRIMAL_BOOT .
   Procedure KPP$PRIMAL_BOOT requires 4 words of local(AUTO) storage.

    No errors detected in file KPP$PRIMAL_BOOT.:E05TSI    .
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:63   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KPP$PRIMAL_BOOT File=KPP$PRIMAL_BOOT.:E05TSI                  WED 07/30/97 01:21 Page:64   
          MINI XREF LISTING

