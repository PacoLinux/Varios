VERSION E05

PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:1    
        1        1        /*M* MPC Handler */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR */
        8        8        /*
        9        9           MPC SCHEDULER
       10       10        */
       11       11        /* SCHEDULE MPC DEVICE
       12       12        */
       13       13        NIW$DEVSCHED: PROC (PAR, NEWSTATE);
       14       14        /*
       15       15                Includes
       16       16        */
       17       17        %INCLUDE                HF_LOCK_C ;
       18       31        %INCLUDE                NI_DATA_C ;
       19      144        %INCLUDE                NI_DATA_R ;
       20      581        %INCLUDE                NI_MACROS_C ;
       21      848        /*
       22      849                Parameters
       23      850        */
       24      851    1   DCL 1 NEWSTATE          SBIN PARAM ;
       25      852    1   DCL 1 PAR               UBIN PARAM ;
       26      853        /*
       27      854                Entries
       28      855        */
       29      856    1   DCL 1 NID$DEVSCHED      ENTRY(2) ;
       30      857    1   DCL 1 NID$DEVSCHEDL     ENTRY(2) ;
       31      858    1   DCL 1 NID$SCANAQ        ENTRY(1) ;
       32      859    1   DCL 1 NIT$DEVSCHED      ENTRY(2) ;
       33      860    1   DCL 1 NIT$REQSCHED      ENTRY(1) ;
       34      861    1   DCL 1 NIT$SCANAQ        ENTRY(1) ;
       35      862    1   DCL 1 NIU$DEVSCHED      ENTRY(2) ;
       36      863    1   DCL 1 NIU$REQSCHED      ENTRY(1) ;
       37      864    1   DCL 1 NIU$SCANAQ        ENTRY(1) ;
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:2    
       38      865    1   DCL 1 NIW$MPCDQH        ENTRY(2) ALTRET ;
       39      866    1   DCL 1 SC_NIWBADSTATE    ENTRY CONV(2,0) ;
       40      867        /*
       41      868                Auto
       42      869        */
       43      870    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
       44      871    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
       45      872    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
       46      873    1   DCL 1 TEMP              UBIN ALIGNED AUTO ;
       47      874        /*
       48      875                Based
       49      876        */
       50      877        %NI$CHT ;
       51      880        %NI$DCT                 ( NAME=DCT, STCLASS="BASED(DCT$)" ) ;
       52      928        %N$REQ                  ( NAME=REQ, STCLASS="BASED(REQ$)" ) ;
       53      986        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
       54      999        %EJECT;
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:3    
       55     1000    1           DCT$=ADDR(PAR);
       56     1001    1   SCHED:
       57     1002    2           DO CASE(DCT.MPC.TYPE);
       58     1003    2            CASE(%DV_LP,%DV_CP,%DV_CR);
       59     1004    2              CALL NIU$DEVSCHED(DCT,NEWSTATE);
       60     1005    2            CASE(%DV_MT);
       61     1006    2              CALL NIT$DEVSCHED(DCT,NEWSTATE);
       62     1007    2            CASE(%DV_DP);
       63     1008    2              CALL NID$DEVSCHED(DCT,NEWSTATE);
       64     1009    2            CASE(ELSE);
       65     1010    2              CALL SC_NIWBADSTATE;
       66     1011    2            END;
       67     1012    1           RETURN;
       68     1013        %EJECT;
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:4    
       69     1014    1   NIW$REQSCHED: ENTRY(PAR);
       70     1015    1           REQ$=ADDR(PAR);
       71     1016    1           DCT$=REQ.DCT$;
       72     1017    1           IF  REQ.DQH$ = ADDR(NIL)
       73     1018    2           THEN DO ;
       74     1019    2              CALL NIW$MPCDQH ( DCT, REQ.DQH$ )
       75     1020    3              WHENALTRETURN DO ;
       76     1021    3                 CALL SC_NIWBADSTATE ;
       77     1022    3                 END ;
       78     1023    2              END ;
       79     1024    2           DO CASE(DCT.MPC.TYPE);
       80     1025    2            CASE(%DV_LP,%DV_CP,%DV_CR);
       81     1026    2              CALL NIU$REQSCHED(PAR);
       82     1027    2            CASE(%DV_MT);
       83     1028    2              CALL NIT$REQSCHED(PAR);
       84     1029    2            CASE(%DV_DP);
       85     1030    2              SQH$=DCT.SQH$;
       86     1031                   %LOCK (G#=SQH.GATE);
       87     1034                   %ENQUEUE (P#=REQ,Q#=DCT.SQ$);
       88     1037    2              TEMP=DCT.STATE;
       89     1038    2              CALL NID$DEVSCHEDL(DCT,TEMP);
       90     1039    2            CASE(ELSE);
       91     1040    2              CALL SC_NIWBADSTATE;
       92     1041        /*S* SCREECH_CODE: NIW-S$BADSTATE-7
       93     1042             TYPE: SCREECH
       94     1043             MESSAGE:      Inconsistency in MPC I/O tables
       95     1044        */
       96     1045    2            END;
       97     1046    1           RETURN;
       98     1047        %EJECT;
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:5    
       99     1048    1   NIW$SCANAQ: ENTRY(PAR);
      100     1049    1           SQH$=ADDR(PAR);
      101     1050    2           DO CASE(SQH.MPC$(0)->DCT.MPC.TYPE);
      102     1051    2            CASE(%DV_LP,%DV_CP,%DV_CR);
      103     1052    2              CALL NIU$SCANAQ(SQH);
      104     1053    2            CASE(%DV_MT);
      105     1054    2              CALL NIT$SCANAQ(SQH);
      106     1055    2            CASE(%DV_DP);
      107     1056    2              CALL NID$SCANAQ(SQH);
      108     1057    2            CASE(ELSE);
      109     1058    2              CALL SC_NIWBADSTATE;
      110     1059    2            END;
      111     1060    1           RETURN;
      112     1061    1   END NIW$DEVSCHED ;
      113     1062        %EOD;

PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:6    
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIW$DEVSCHED.

   Procedure NIW$DEVSCHED requires 154 words for executable code.
   Procedure NIW$DEVSCHED requires 12 words of local(AUTO) storage.

PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:7    

 Object Unit name= NIW$DEVSCHED                               File name= NIW$MPC.:E05TOU
 UTS= JUL 30 '97 03:39:38.20 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   154    232  NIW$DEVSCHED

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        2  NIW$DEVSCHED
     0     54                  yes      Std        1  NIW$REQSCHED
     0    166                  yes      Std        1  NIW$SCANAQ
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:8    

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 NIU$DEVSCHED
         yes           Std       2 NID$DEVSCHED
         yes           Std       2 NID$DEVSCHEDL
         yes           Std       1 NID$SCANAQ
         yes           Std       2 NIT$DEVSCHED
 yes     yes           Std       2 NIW$MPCDQH
         yes           Std       1 NIT$REQSCHED
         yes           Std       1 NIU$REQSCHED
         yes           Std       1 HFC$LOCK
         yes           Std       1 NIT$SCANAQ
         yes           Std       2 NIM$ENQUEUE
         yes           Std       1 NIU$SCANAQ
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_NIWBADSTATE                        N$DCT$$                               N$FQ$
     NI$CHT$                               NI$FQ$                                NI$IBUF$
     NI$RP$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:9    


        1        1        /*M* MPC Handler */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMR */
        8        8        /*
        9        9           MPC SCHEDULER
       10       10        */
       11       11        /* SCHEDULE MPC DEVICE
       12       12        */
       13       13        NIW$DEVSCHED: PROC (PAR, NEWSTATE);

     13  0 000000   000000 700200 xent  NIW$DEVSCHED TSX0  ! X66_AUTO_2
         0 000001   000014 000002                    ZERO    12,2

       14       14        /*
       15       15                Includes
       16       16        */
       17       17        %INCLUDE                HF_LOCK_C ;
       18       31        %INCLUDE                NI_DATA_C ;
       19      144        %INCLUDE                NI_DATA_R ;
       20      581        %INCLUDE                NI_MACROS_C ;
       21      848        /*
       22      849                Parameters
       23      850        */
       24      851    1   DCL 1 NEWSTATE          SBIN PARAM ;
       25      852    1   DCL 1 PAR               UBIN PARAM ;
       26      853        /*
       27      854                Entries
       28      855        */
       29      856    1   DCL 1 NID$DEVSCHED      ENTRY(2) ;
       30      857    1   DCL 1 NID$DEVSCHEDL     ENTRY(2) ;
       31      858    1   DCL 1 NID$SCANAQ        ENTRY(1) ;
       32      859    1   DCL 1 NIT$DEVSCHED      ENTRY(2) ;
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:10   
       33      860    1   DCL 1 NIT$REQSCHED      ENTRY(1) ;
       34      861    1   DCL 1 NIT$SCANAQ        ENTRY(1) ;
       35      862    1   DCL 1 NIU$DEVSCHED      ENTRY(2) ;
       36      863    1   DCL 1 NIU$REQSCHED      ENTRY(1) ;
       37      864    1   DCL 1 NIU$SCANAQ        ENTRY(1) ;
       38      865    1   DCL 1 NIW$MPCDQH        ENTRY(2) ALTRET ;
       39      866    1   DCL 1 SC_NIWBADSTATE    ENTRY CONV(2,0) ;
       40      867        /*
       41      868                Auto
       42      869        */
       43      870    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
       44      871    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
       45      872    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
       46      873    1   DCL 1 TEMP              UBIN ALIGNED AUTO ;
       47      874        /*
       48      875                Based
       49      876        */
       50      877        %NI$CHT ;
       51      880        %NI$DCT                 ( NAME=DCT, STCLASS="BASED(DCT$)" ) ;
       52      928        %N$REQ                  ( NAME=REQ, STCLASS="BASED(REQ$)" ) ;
       53      986        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
       54      999        %EJECT;
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:11   
       55     1000    1           DCT$=ADDR(PAR);

   1000  0 000002   200003 236100                    LDQ     @PAR,,AUTO
         0 000003   200005 756100                    STQ     DCT$,,AUTO

       56     1001    1   SCHED:
       57     1002    2           DO CASE(DCT.MPC.TYPE);

   1002  0 000004   200005 470500       SCHED        LDP0    DCT$,,AUTO
         0 000005   000035 236100                    LDQ     29,,PR0
         0 000006   000033 772000                    QRL     27
         0 000007   000007 116007                    CMPQ    7,DL
         0 000010   000012 602006 0                  TNC     SCHED+6,QL
         0 000011   000051 710000 0                  TRA     s:1010
         0 000012   000051 710000 0                  TRA     s:1010
         0 000013   000021 710000 0                  TRA     s:1004
         0 000014   000021 710000 0                  TRA     s:1004
         0 000015   000021 710000 0                  TRA     s:1004
         0 000016   000031 710000 0                  TRA     s:1006
         0 000017   000051 710000 0                  TRA     s:1010
         0 000020   000041 710000 0                  TRA     s:1008

       58     1003    2            CASE(%DV_LP,%DV_CP,%DV_CR);

       59     1004    2              CALL NIU$DEVSCHED(DCT,NEWSTATE);

   1004  0 000021   200004 236100                    LDQ     @NEWSTATE,,AUTO
         0 000022   200005 235100                    LDA     DCT$,,AUTO
         0 000023   200012 757100                    STAQ    TEMP+2,,AUTO
         0 000024   200012 630500                    EPPR0   TEMP+2,,AUTO
         0 000025   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000026   000000 701000 xent               TSX1    NIU$DEVSCHED
         0 000027   000000 011000                    NOP     0
         0 000030   000053 710000 0                  TRA     s:1012

       60     1005    2            CASE(%DV_MT);

PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:12   
       61     1006    2              CALL NIT$DEVSCHED(DCT,NEWSTATE);

   1006  0 000031   200004 236100                    LDQ     @NEWSTATE,,AUTO
         0 000032   200005 235100                    LDA     DCT$,,AUTO
         0 000033   200012 757100                    STAQ    TEMP+2,,AUTO
         0 000034   200012 630500                    EPPR0   TEMP+2,,AUTO
         0 000035   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000036   000000 701000 xent               TSX1    NIT$DEVSCHED
         0 000037   000000 011000                    NOP     0
         0 000040   000053 710000 0                  TRA     s:1012

       62     1007    2            CASE(%DV_DP);

       63     1008    2              CALL NID$DEVSCHED(DCT,NEWSTATE);

   1008  0 000041   200004 236100                    LDQ     @NEWSTATE,,AUTO
         0 000042   200005 235100                    LDA     DCT$,,AUTO
         0 000043   200012 757100                    STAQ    TEMP+2,,AUTO
         0 000044   200012 630500                    EPPR0   TEMP+2,,AUTO
         0 000045   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000046   000000 701000 xent               TSX1    NID$DEVSCHED
         0 000047   000000 011000                    NOP     0
         0 000050   000053 710000 0                  TRA     s:1012

       64     1009    2            CASE(ELSE);

       65     1010    2              CALL SC_NIWBADSTATE;

   1010  0 000051   000000 713400 xsym               CLIMB   SC_NIWBADSTATE
         0 000052   000000 600000 xsid               climb   nvectors=         0

       66     1011    2            END;

       67     1012    1           RETURN;

   1012  0 000053   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:13   
       68     1013        %EJECT;
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:14   
       69     1014    1   NIW$REQSCHED: ENTRY(PAR);

   1014  0 000054   000000 700200 xent  NIW$REQSCHED TSX0  ! X66_AUTO_2
         0 000055   000014 000002                    ZERO    12,2

       70     1015    1           REQ$=ADDR(PAR);

   1015  0 000056   200003 236100                    LDQ     @PAR,,AUTO
         0 000057   200006 756100                    STQ     REQ$,,AUTO

       71     1016    1           DCT$=REQ.DCT$;

   1016  0 000060   200006 470500                    LDP0    REQ$,,AUTO
         0 000061   000002 236100                    LDQ     2,,PR0
         0 000062   200005 756100                    STQ     DCT$,,AUTO

       72     1017    1           IF  REQ.DQH$ = ADDR(NIL)

   1017  0 000063   000020 236100                    LDQ     16,,PR0
         0 000064   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000065   000101 601000 0                  TNZ     s:1024

       73     1018    2           THEN DO ;

       74     1019    2              CALL NIW$MPCDQH ( DCT, REQ.DQH$ )

   1019  0 000066   200006 236100                    LDQ     REQ$,,AUTO
         0 000067   000020 036003                    ADLQ    16,DU
         0 000070   200005 235100                    LDA     DCT$,,AUTO
         0 000071   200012 757100                    STAQ    TEMP+2,,AUTO
         0 000072   200012 630500                    EPPR0   TEMP+2,,AUTO
         0 000073   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000074   000000 701000 xent               TSX1    NIW$MPCDQH
         0 000075   000077 702000 0                  TSX2    s:1021
         0 000076   000101 710000 0                  TRA     s:1024

       75     1020    3              WHENALTRETURN DO ;
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:15   

       76     1021    3                 CALL SC_NIWBADSTATE ;

   1021  0 000077   000000 713400 xsym               CLIMB   SC_NIWBADSTATE
         0 000100   000000 600000 xsid               climb   nvectors=         0

       77     1022    3                 END ;

       78     1023    2              END ;

       79     1024    2           DO CASE(DCT.MPC.TYPE);

   1024  0 000101   200005 470500                    LDP0    DCT$,,AUTO
         0 000102   000035 236100                    LDQ     29,,PR0
         0 000103   000033 772000                    QRL     27
         0 000104   000007 116007                    CMPQ    7,DL
         0 000105   000107 602006 0                  TNC     s:1024+6,QL
         0 000106   000163 710000 0                  TRA     s:1040
         0 000107   000163 710000 0                  TRA     s:1040
         0 000110   000116 710000 0                  TRA     s:1026
         0 000111   000116 710000 0                  TRA     s:1026
         0 000112   000116 710000 0                  TRA     s:1026
         0 000113   000123 710000 0                  TRA     s:1028
         0 000114   000163 710000 0                  TRA     s:1040
         0 000115   000130 710000 0                  TRA     s:1030

       80     1025    2            CASE(%DV_LP,%DV_CP,%DV_CR);

       81     1026    2              CALL NIU$REQSCHED(PAR);

   1026  0 000116   200003 630500                    EPPR0   @PAR,,AUTO
         0 000117   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000120   000000 701000 xent               TSX1    NIU$REQSCHED
         0 000121   000000 011000                    NOP     0
         0 000122   000165 710000 0                  TRA     s:1046

       82     1027    2            CASE(%DV_MT);
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:16   

       83     1028    2              CALL NIT$REQSCHED(PAR);

   1028  0 000123   200003 630500                    EPPR0   @PAR,,AUTO
         0 000124   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000125   000000 701000 xent               TSX1    NIT$REQSCHED
         0 000126   000000 011000                    NOP     0
         0 000127   000165 710000 0                  TRA     s:1046

       84     1029    2            CASE(%DV_DP);

       85     1030    2              SQH$=DCT.SQH$;

   1030  0 000130   000022 236100                    LDQ     18,,PR0
         0 000131   200007 756100                    STQ     SQH$,,AUTO

       86     1031                   %LOCK (G#=SQH.GATE);

   1032  0 000132   200007 630500                    EPPR0   SQH$,,AUTO
         0 000133   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000134   000000 701000 xent               TSX1    HFC$LOCK
         0 000135   000000 011000                    NOP     0

       87     1034                   %ENQUEUE (P#=REQ,Q#=DCT.SQ$);

   1035  0 000136   200005 236100                    LDQ     DCT$,,AUTO
         0 000137   000001 036003                    ADLQ    1,DU
         0 000140   200006 235100                    LDA     REQ$,,AUTO
         0 000141   200012 757100                    STAQ    TEMP+2,,AUTO
         0 000142   200012 630500                    EPPR0   TEMP+2,,AUTO
         0 000143   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000144   000000 701000 xent               TSX1    NIM$ENQUEUE
         0 000145   000000 011000                    NOP     0

       88     1037    2              TEMP=DCT.STATE;

   1037  0 000146   200005 470500                    LDP0    DCT$,,AUTO
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:17   
         0 000147   000007 236100                    LDQ     7,,PR0
         0 000150   000077 376007                    ANQ     63,DL
         0 000151   200010 756100                    STQ     TEMP,,AUTO

       89     1038    2              CALL NID$DEVSCHEDL(DCT,TEMP);

   1038  0 000152   200010 631500                    EPPR1   TEMP,,AUTO
         0 000153   200013 451500                    STP1    TEMP+3,,AUTO
         0 000154   200005 236100                    LDQ     DCT$,,AUTO
         0 000155   200012 756100                    STQ     TEMP+2,,AUTO
         0 000156   200012 630500                    EPPR0   TEMP+2,,AUTO
         0 000157   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000160   000000 701000 xent               TSX1    NID$DEVSCHEDL
         0 000161   000000 011000                    NOP     0
         0 000162   000165 710000 0                  TRA     s:1046

       90     1039    2            CASE(ELSE);

       91     1040    2              CALL SC_NIWBADSTATE;

   1040  0 000163   000000 713400 xsym               CLIMB   SC_NIWBADSTATE
         0 000164   000000 600000 xsid               climb   nvectors=         0

       92     1041        /*S* SCREECH_CODE: NIW-S$BADSTATE-7
       93     1042             TYPE: SCREECH
       94     1043             MESSAGE:      Inconsistency in MPC I/O tables
       95     1044        */
       96     1045    2            END;

       97     1046    1           RETURN;

   1046  0 000165   000000 702200 xent               TSX2  ! X66_ARET

       98     1047        %EJECT;
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:18   
       99     1048    1   NIW$SCANAQ: ENTRY(PAR);

   1048  0 000166   000000 700200 xent  NIW$SCANAQ   TSX0  ! X66_AUTO_2
         0 000167   000014 000002                    ZERO    12,2

      100     1049    1           SQH$=ADDR(PAR);

   1049  0 000170   200003 236100                    LDQ     @PAR,,AUTO
         0 000171   200007 756100                    STQ     SQH$,,AUTO

      101     1050    2           DO CASE(SQH.MPC$(0)->DCT.MPC.TYPE);

   1050  0 000172   200007 470500                    LDP0    SQH$,,AUTO
         0 000173   000005 471500                    LDP1    5,,PR0
         0 000174   100035 236100                    LDQ     29,,PR1
         0 000175   000033 772000                    QRL     27
         0 000176   000007 116007                    CMPQ    7,DL
         0 000177   000201 602006 0                  TNC     s:1050+7,QL
         0 000200   000227 710000 0                  TRA     s:1058
         0 000201   000227 710000 0                  TRA     s:1058
         0 000202   000210 710000 0                  TRA     s:1052
         0 000203   000210 710000 0                  TRA     s:1052
         0 000204   000210 710000 0                  TRA     s:1052
         0 000205   000215 710000 0                  TRA     s:1054
         0 000206   000227 710000 0                  TRA     s:1058
         0 000207   000222 710000 0                  TRA     s:1056

      102     1051    2            CASE(%DV_LP,%DV_CP,%DV_CR);

      103     1052    2              CALL NIU$SCANAQ(SQH);

   1052  0 000210   200007 630500                    EPPR0   SQH$,,AUTO
         0 000211   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000212   000000 701000 xent               TSX1    NIU$SCANAQ
         0 000213   000000 011000                    NOP     0
         0 000214   000231 710000 0                  TRA     s:1060

PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:19   
      104     1053    2            CASE(%DV_MT);

      105     1054    2              CALL NIT$SCANAQ(SQH);

   1054  0 000215   200007 630500                    EPPR0   SQH$,,AUTO
         0 000216   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000217   000000 701000 xent               TSX1    NIT$SCANAQ
         0 000220   000000 011000                    NOP     0
         0 000221   000231 710000 0                  TRA     s:1060

      106     1055    2            CASE(%DV_DP);

      107     1056    2              CALL NID$SCANAQ(SQH);

   1056  0 000222   200007 630500                    EPPR0   SQH$,,AUTO
         0 000223   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000224   000000 701000 xent               TSX1    NID$SCANAQ
         0 000225   000000 011000                    NOP     0
         0 000226   000231 710000 0                  TRA     s:1060

      108     1057    2            CASE(ELSE);

      109     1058    2              CALL SC_NIWBADSTATE;

   1058  0 000227   000000 713400 xsym               CLIMB   SC_NIWBADSTATE
         0 000230   000000 600000 xsid               climb   nvectors=         0

      110     1059    2            END;

      111     1060    1           RETURN;

   1060  0 000231   000000 702200 xent               TSX2  ! X66_ARET
      112     1061    1   END NIW$DEVSCHED ;
      113     1062        %EOD;

PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:20   
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIW$DEVSCHED.
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:21   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @NEWSTATE                  3-0-0/w PTR         r     1 @PAR
     5-0-0/w PTR         r     1 DCT$                      *0-0-0/w SBIN        r     1 NEWSTATE
    *0-0-0/w UBIN        r     1 PAR                        6-0-0/w PTR         r     1 REQ$
     7-0-0/w PTR         r     1 SQH$                      10-0-0/w UBIN        r     1 TEMP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$CHT$                    0-0-0/w PTR         r     1 NI$FQ$
     0-0-0/w PTR         r     1 NI$IBUF$                   0-0-0/w PTR         r     1 NI$RP$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/d STRC(1080)  r     1 REQ
     0-0-0/w STRC(252)   r     1 SQH


   Procedure NIW$DEVSCHED requires 154 words for executable code.
   Procedure NIW$DEVSCHED requires 12 words of local(AUTO) storage.
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:22   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:23   
          MINI XREF LISTING

DCT
       889**DCL      1004<>CALL     1006<>CALL     1008<>CALL     1019<>CALL     1038<>CALL
DCT.DP
       909**DCL       916--REDEF     919--REDEF     920--REDEF     922--REDEF     922--REDEF     923--REDEF
       924--REDEF     924--REDEF
DCT.MPC.IOCHANX
       917**DCL       917--REDEF
DCT.MPC.TYPE
       917**DCL      1002>>DOCASE   1024>>DOCASE   1050>>DOCASE
DCT.SQ$
       889**DCL      1035<>CALL
DCT.SQH$
       904**DCL      1030>>ASSIGN
DCT.STATE
       899**DCL      1037>>ASSIGN
DCT$
       870**DCL       889--IMP-PTR  1000<<ASSIGN   1002>>DOCASE   1004>>CALL     1006>>CALL     1008>>CALL
      1016<<ASSIGN   1019>>CALL     1024>>DOCASE   1030>>ASSIGN   1035>>CALL     1037>>ASSIGN   1038>>CALL
HFC$LOCK
        30**DCL-ENT  1032--CALL
N$DCT$$
       442**DCL       576--IMP-PTR
N$FQ$
       442**DCL       577--IMP-PTR
N$REQ_INIT.BUFADDR
       461**DCL       462--REDEF     462--REDEF
N$REQ_INIT.DLA.DRELADDR
       453**DCL       453--REDEF
N$REQ_INIT.DVE.EOMCHAR
       490**DCL       491--REDEF
N$REQ_INIT.EAINFO
       484**DCL       484--REDEF
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:24   
N$REQ_INIT.EAINFOX
       484**DCL       485--REDEF
N$REQ_INIT.EVNTINFO
       485**DCL       485--REDEF
N$REQ_INIT.STATUS
       466**DCL       472--REDEF
NEWSTATE
       851**DCL        13--PROC     1004<>CALL     1006<>CALL     1008<>CALL
NI$CHT$
       501**DCL       878--IMP-PTR
NI$FQ$
       502**DCL       578--IMP-PTR
NI$IBUF$
       502**DCL       578--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       512**DCL       513--REDEF     513--REDEF
NI$IMXMBX_INIT.SIZE
       514**DCL       514--REDEF
NI$REQ_INIT.DCW
       536**DCL       539--REDEF
NI$REQ_INIT.DCW.TALLY
       537**DCL       537--REDEF
NI$REQ_INIT.IDCW.EXTA
       539**DCL       539--REDEF
NI$REQ_INIT.PCW
       541**DCL       545--REDEF
NI$REQ_INIT.SEEK
       546**DCL       547--REDEF     548--REDEF
NI$RP$
       550**DCL       580--IMP-PTR
NID$DEVSCHED
       856**DCL-ENT  1008--CALL
NID$DEVSCHEDL
       857**DCL-ENT  1038--CALL
NID$SCANAQ
       858**DCL-ENT  1056--CALL
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:25   
NIM$ENQUEUE
       606**DCL-ENT  1035--CALL
NIT$DEVSCHED
       859**DCL-ENT  1006--CALL
NIT$REQSCHED
       860**DCL-ENT  1028--CALL
NIT$SCANAQ
       861**DCL-ENT  1054--CALL
NIU$DEVSCHED
       862**DCL-ENT  1004--CALL
NIU$REQSCHED
       863**DCL-ENT  1026--CALL
NIU$SCANAQ
       864**DCL-ENT  1052--CALL
NIW$MPCDQH
       865**DCL-ENT  1019--CALL
NI_MBX_INIT.DCW.CONTROL.AE
       572**DCL       572--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       568**DCL       568--REDEF
PAR
       852**DCL        13--PROC     1000--ASSIGN   1014--ENTRY    1015--ASSIGN   1026<>CALL     1028<>CALL
      1048--ENTRY    1049--ASSIGN
REQ
       937**DCL      1035<>CALL
REQ.BUFADDR
       946**DCL       947--REDEF     947--REDEF
REQ.DCT$
       938**DCL      1016>>ASSIGN
REQ.DLA.DRELADDR
       938**DCL       938--REDEF
REQ.DQH$
       959**DCL      1017>>IF       1019<>CALL
REQ.DVE.EOMCHAR
       975**DCL       976--REDEF
REQ.EAINFO
PL6.E3A0      #001=NIW$DEVSCHED File=NIW$MPC.:E05TSI                             WED 07/30/97 03:39 Page:26   
       969**DCL       969--REDEF
REQ.EAINFOX
       969**DCL       970--REDEF
REQ.EVNTINFO
       970**DCL       970--REDEF
REQ.STATUS
       951**DCL       957--REDEF
REQ$
       871**DCL       937--IMP-PTR  1015<<ASSIGN   1016>>ASSIGN   1017>>IF       1019>>CALL     1035>>CALL
SC_NIWBADSTATE
       866**DCL-ENT  1010--CALL     1021--CALL     1040--CALL     1058--CALL
SQH
       995**DCL      1052<>CALL     1054<>CALL     1056<>CALL
SQH.DOOR
       995**DCL       995--REDEF
SQH.GATE
       995**DCL      1032<>CALL
SQH.MPC$
       997**DCL      1050>>DOCASE
SQH$
       872**DCL       995--IMP-PTR  1030<<ASSIGN   1032>>CALL     1049<<ASSIGN   1050>>DOCASE   1052>>CALL
      1054>>CALL     1056>>CALL
TEMP
       873**DCL      1037<<ASSIGN   1038<>CALL

PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:27   
      114        1        /*T***********************************************************/
      115        2        /*T*                                                         */
      116        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      117        4        /*T*                                                         */
      118        5        /*T***********************************************************/
      119        6        /*
      120        7           MPC POSTER
      121        8        */
      122        9        NIW$POSTER: PROC (PAR,INTLVL,STATUS);
      123       10        /*
      124       11                Includes
      125       12        */
      126       13        %INCLUDE                CP_6_SUBS ;
      127      553        %INCLUDE                EL_SUBS_C ;
      128      637        %INCLUDE                HF_DATA_R ;
      129      680        %INCLUDE                HF_LOCK_C ;
      130      694        %INCLUDE                NI_DATA_C ;
      131      807        %INCLUDE                NI_DATA_R ;
      132     1244        %INCLUDE                NI_MACROS_C ;
      133     1511        %INCLUDE                N_FC_C ;
      134     1548        %INCLUDE                OC_SUBS_C ;
      135     2279        %INCLUDE                PM$NI ;
      136     2303        /*
      137     2304                Parameters
      138     2305        */
      139     2306    1   DCL 1 INTLVL            UBIN(18) PARAM ;
      140     2307    1   DCL 1 PAR               PTR PARAM ;
      141     2308        %STATUS                 ( NAME=STATUS, STCLASS=PARAM ) ;
      142     2375        /*
      143     2376                Entries
      144     2377        */
      145     2378    1   DCL 1 NIA$LOGERR        ENTRY(4) ;
      146     2379    1   DCL 1 NIA$SPURINT       ENTRY(4) ;
      147     2380    1   DCL 1 NIF$ANFAULT       ENTRY(3) ALTRET ;
      148     2381    1   DCL 1 NIF$ANIOM         ENTRY(2) ALTRET ;
      149     2382    1   DCL 1 NIK$OPMSG         ENTRY(5) ;
      150     2383    1   DCL 1 NIO$COMP          ENTRY(2) ;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:28   
      151     2384    1   DCL 1 NIO$SPCOMP        ENTRY(1) ;
      152     2385    1   DCL 1 NIQ$RELS          ENTRY(1) ALTRET ;
      153     2386    1   DCL 1 NIQ$SPURINT       ENTRY(4) ;
      154     2387    1   DCL 1 NIS$DRIVER        ENTRY(1) ;
      155     2388    1   DCL 1 NIW$DEVSCHED      ENTRY(2) ;
      156     2389    1   DCL 1 NIW$MPCSTOP       ENTRY(1) ;
      157     2390    1   DCL 1 PMN$COLLECT       ENTRY(3) ;
      158     2391    1   DCL 1 SC_NIWBADINTLVL   ENTRY CONV(2,0) ;
      159     2392    1   DCL 1 TDC$COMP          ENTRY(1) ALTRET ;
      160     2393        /*
      161     2394                Symrefs
      162     2395        */
      163     2396    1   DCL 1 B_SCDCTX          SBIN SYMREF ;
      164     2397    1   DCL 1 OCI_BOOT          BIT(1) SYMREF ALIGNED ;
      165     2398        /*
      166     2399                Auto
      167     2400        */
      168     2401    1   DCL 1 CHANTIME          SBIN ALIGNED AUTO ;
      169     2402    1   DCL 1 CODE              SBIN ALIGNED AUTO ;
      170     2403    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      171     2404    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
      172     2405    1   DCL 1 IDCW              BIT(36) ALIGNED AUTO ;
      173     2406    1   DCL 1 MINOR             SBIN ALIGNED AUTO ;
      174     2407        %NI$EXTST               ( NAME=NI$EXTST, STCLASS=AUTO ) ;
      175     2441    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
      176     2442    1   DCL 1 REQSTATF          BIT(1) ALIGNED AUTO ;
      177     2443    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      178     2444        /*
      179     2445                Based
      180     2446        */
      181     2447        %NI$DCT                 ( NAME=DCT, STCLASS="BASED(DCT$)" ) ;
      182     2495        %NI$DQH                 ( NAME=DQH, STCLASS="BASED(DQH$)" ) ;
      183     2518        %NI$IOM                 ( NAME=IOM ) ;
      184     2523        %NI$REQ                 ( NAME=IOS, STCLASS=BASED ) ;
      185     2548        %NI$IOSTAT              ( NAME=IOSTAT ) ;
      186     2557        %NI$MBX                 ( NAME=MBX, STCLASS=BASED ) ;
      187     2576        %N$REQ                  ( NAME=REQ, STCLASS="BASED(REQ$)" ) ;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:29   
      188     2634        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
      189     2647        /*
      190     2648                Constants
      191     2649        */
      192     2650    1   DCL COMREJTYC(0:4) BIT(36) CONSTANT INIT(%TYC_IOERR,%TYC_IOERR*2,%TYC_IOERR*2);
      193     2651        /**/
      194     2652        %SUB NEVER="WHILE('0'B)";
      195     2653        %SUB FOREVER="WHILE('1'B)";
      196     2654        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:30   
      197     2655    2           DO INHIBIT;
      198     2656    3              DO CASE (INTLVL);
      199     2657    3               CASE(%OVERHEAD,%TERMINATE,%LOST);
      200     2658    3                 DQH$=ADDR(PAR);
      201     2659    3                 SQH$=DQH.SQH$;
      202     2660                      %LOCK (G#=SQH.GATE);
      203     2663    3                 IF  DQH.STATE ~= %BUSY
      204     2664    4                 THEN DO ;
      205     2665    4                    IF  ADDR(STATUS) ~= ADDR(NIL)
      206     2666    4                    THEN
      207     2667    4                       CALL NIA$SPURINT ( DQH, EL_SPURINT, INTLVL, STATUS ) ;
      208     2668    4                    ELSE IF  INTLVL = %TERMINATE
      209     2669    4                         AND DQH.IOSTATUS$ ~= ADDR(NIL)
      210     2670    4                       THEN
      211     2671    4                          CALL NIA$SPURINT ( DQH, EL_SPURINT, INTLVL, DQH.IOSTATUS$->
              2671                                   IOSTAT.STATUS ) ;
      212     2672    4                       ELSE
      213     2673    4                          CALL NIA$SPURINT ( DQH, EL_SPURINT, INTLVL, NI_DBLZERO ) ;
      214     2674                         %UNLOCK ( G#=SQH.GATE ) ;
      215     2677    4                    RETURN ;
      216     2678    4                    END ;
      217     2679    3                 REQ$=DQH.IO$;
      218     2680    3                 DCT$=REQ.DCT$;
      219     2681    3                 IF HW_IMX THEN
      220     2682    3                    REQ.FLPW=DQH.IOSTATUS$->IOSTAT.LPW_RESIDUE;
      221     2683    3                 ELSE
      222     2684    3                    REQ.FLPW=DQH.MBX$->MBX.LPW;
      223     2685    4                 IF INTLVL=%TERMINATE THEN DO;
      224     2686    4                    REQ.STATUS=DQH.IOSTATUS$->IOSTAT.STATUS;
      225     2687    4                    IF HW_IOP THEN    /* ignore IOP generated lost interrupt */
      226     2688    4                       IF REQ.STATUS.MAJOR = %READY AND
      227     2689    5                         REQ.STATUS.IOM.CHANNEL = %LOSTINT THEN DO;
      228     2690                               %UNLOCK (G#=SQH.GATE);
      229     2693    5                          RETURN;
      230     2694    5                          END;
      231     2695    4                    END;
      232     2696    3                 ELSE
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:31   
      233     2697    3                    REQ.STATUS=STATUS;
      234     2698             /* Don't mask channel on lost interrupt - T&D expects lost ints on RSOs */
      235     2699    3                 DQH.STATE=%IDLE;
      236     2700    3                 CALL PMN$COLLECT(DQH.PM,%PM_IDLE,CHANTIME);
      237     2701    4                 IF DQH.CHANSTATE THEN DO;
      238     2702                         %UNLOCK (G#=SQH.GATE) ;
      239     2705    5                    IF DQH.CHANSTATE.STOP THEN DO;
      240     2706    5                       CALL NIW$MPCSTOP(DCT) ;
      241     2707    5                       END ;
      242     2708    4                    END ;
      243     2709    4                 ELSE DO ;
      244     2710    5                    IF NOT DQH.STATUS.DOWN THEN DO ;
      245     2711                            %ENQUEUE ( P#=DQH, Q#=SQH.CQ$ ) ;
      246     2714    5                       END ;
      247     2715                         %UNLOCK (G#=SQH.GATE) ;
      248     2718    4                    END ;
      249     2719    3               CASE(%MARKER);
      250     2720    3                 DQH$=ADDR(PAR);
      251     2721    3                 CALL NIA$SPURINT(DQH,EL_SPURINT,INTLVL,NI_DBLZERO);
      252     2722    3                 RETURN;
      253     2723    3               CASE(%SPECIAL);
      254     2724    3                 DQH$=ADDR(PAR);
      255     2725    3                 SQH$=DQH.SQH$;
      256     2726    3                 DCT$=DQH.MPC$;
      257     2727                      %LOCK (G#=SQH.GATE);
      258     2730    4                 IF DCT.SPSTAT.PRESENCE THEN DO;
      259     2731                         %UNLOCK (G#=SQH.GATE);
      260     2734    4                    END;
      261     2735    4                 ELSE DO;
      262     2736    4                    DCT.SPSTAT=STATUS;
      263     2737                         %UNLOCK (G#=SQH.GATE);
      264     2740    4                    CALL NIO$SPCOMP(DCT);
      265     2741    4                    DCT.SPSTAT.PRESENCE='0'B;
      266     2742    4                    END;
      267     2743    3                 RETURN;
      268     2744    3               CASE(%REPOST);
      269     2745    3                 REQ$=ADDR(PAR);
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:32   
      270     2746    3                 DCT$=REQ.DCT$;
      271     2747    3                 SQH$=DCT.SQH$;
      272     2748    3                 DQH$=DCT.DQH$;
      273     2749    3               CASE(ELSE);
      274     2750    3                 CALL SC_NIWBADINTLVL;
      275     2751        /*S* SCREECH_CODE: NIW-S$BADINTLVL-7
      276     2752             TYPE: SCREECH
      277     2753             MESSAGE:      The interrupt level is invalid.
      278     2754        */
      279     2755    3               END/* CASE INTLVL */;
      280     2756    2              END;
      281     2757        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:33   
      282     2758    1           IF DCT.SQ$=ADDR(NIL) THEN
      283     2759    1              CALL PMN$COLLECT(DCT.PM,%PM_IDLE);
      284     2760    1           ELSE
      285     2761    1              CALL PMN$COLLECT(DCT.PM,%PM_WAIT);
      286     2762    2           IF REQ.COMP=%COMP_TD THEN DO;
      287     2763    2              REQ.EAINFO=CHANTIME;
      288     2764    2              END;
      289     2765    2           IF REQ.COMP=%COMP_REG AND REQ.FC~=%N_RQSTAT THEN DO;
      290     2766    2              REQ.TYC='0'B;
      291     2767    2              CODE=0;
      292     2768    3              IF REQ.STATUS.MAJOR<%SPECIAL_INTERRUPT THEN DO;
      293     2769    3                 REQSTATF=REQ.FC=%N_RQSTAT;
      294     2770    3                 END;
      295     2771    3              IF REQ.STATUS.POWEROFF THEN DO;
      296     2772    3                 REQ.TYC.IOERR='1'B;
      297     2773    3                 IF DCT.DFLG.RELOAD OR REQSTATF THEN GOTO COMP;
      298     2774    3                 CALL REQUE ALTRET(COMP);
      299     2775    3                 RETURN;
      300     2776    3                 END;
      301     2777    3              IF REQ.STATUS.IOM THEN DO;
      302     2778    3                 CALL NIF$ANIOM(REQ,CODE) ALTRET(IOM_ALT);
      303     2779    3                 IF CODE<0 THEN CODE=1;
      304     2780    4                 DO NEVER;
      305     2781    4   IOM_ALT:         CODE=3;
      306     2782    4                    END;
      307     2783    3                 END;
      308     2784    2              MINOR=BITBIN(REQ.STATUS.MINOR);
      309     2785    3              DO CASE(REQ.STATUS.MAJOR);
      310     2786    3               CASE(%READY);
      311     2787    3                 IF MINOR>0 THEN GOTO ILLSTAT;
      312     2788    3               CASE(%COMMAND_REJECT);
      313     2789    3                 IF MINOR>4 THEN GOTO ILLSTAT;
      314     2790    3                 REQ.TYC=REQ.TYC|COMREJTYC(MINOR);
      315     2791    4                 IF MINOR~=2 THEN DO;
      316     2792    4                    CALL RETRY ALTRET(COMP);
      317     2793    4                    RETURN;
      318     2794    4                    END;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:34   
      319     2795    3               CASE(%LOST_INTERRUPT);
      320     2796    3                 REQ.TYC.TIMO='1'B;
      321     2797    3                 CALL RETRY ALTRET(COMP);
      322     2798    3                 RETURN;
      323     2799    3               CASE(%SYSTEM_FAULT);
      324     2800    3                 CALL NIF$ANFAULT(REQ,CODE) ALTRET(FLT_ALT);
      325     2801    3                 IF CODE<0 THEN CODE=1;
      326     2802    4                 DO NEVER;
      327     2803    4   FLT_ALT:         CODE=3;
      328     2804    4                    END;
      329     2805    3               CASE(ELSE);
      330     2806    3   ILLSTAT:
      331     2807    3                 REQ.TYC.IOERR='1'B;
      332     2808    3                 CALL RETRY ALTRET(COMP);
      333     2809    3                 RETURN;
      334     2810    3               END/* CASE REQ.STATUS.MAJOR */;
      335     2811    3              DO CASE(CODE);
      336     2812    3               CASE(1,2);                  /* RETRY */
      337     2813    3                 CALL RETRY ALTRET(COMP);
      338     2814    3                 RETURN;
      339     2815    3               CASE(3);                    /* WAIT FOR KEYIN */
      340     2816    3                 CALL REQUE ALTRET(COMP);
      341     2817    3                 RETURN;
      342     2818    3               END/* CASE CODE */;
      343     2819    2              END/* IF NOT REQ.T@D */;
      344     2820    1   COMP:
      345     2821    1           IF REQ.IOFLG.REL THEN DCT.DFLG.MPCSUSPENDED='0'B;
      346     2822    1           CALL NIW$DEVSCHED(DCT,%IDLE);
      347     2823    1           NI$EXTST.EXTST='0'B;
      348     2824    1           CALL NIO$COMP(REQ,NI$EXTST);
      349     2825    1           RETURN;
      350     2826        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:35   
      351     2827        /* REQUE REQUEST FOR OPERATOR RESPONSE
      352     2828        */
      353     2829    1   REQUE:  PROC ALTRET;
      354     2830        /**/
      355     2831    2           CALL NIA$LOGERR(REQ,EL_IOERR);
      356     2832    2           REQ.ERRCT=REQ.ERRCT+1;
      357     2833    2   REQUERETRY: ENTRY ALTRET;
      358     2834    2           IF REQ.ERRCT>6 THEN ALTRETURN;
      359     2835    2           IF OCI_BOOT THEN ALTRETURN;
      360     2836    2           CALL NIK$OPMSG(DCT,MPC_MSG#,M_DISK,%KIWAIT,REQ);
      361     2837                %LOCK (G#=SQH.GATE);
      362     2840                %REQUEUE (P#=REQ,Q#=DCT.SQ$);
      363     2843                %UNLOCK (G#=SQH.GATE);
      364     2846    2           CALL NIW$DEVSCHED(DCT,%KIWAIT);
      365     2847    2           RETURN;
      366     2848    2   END REQUE;
      367     2849        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:36   
      368     2850        /* RETRY ERRORS
      369     2851        */
      370     2852    1   RETRY:  PROC ALTRET;
      371     2853    2           CALL NIA$LOGERR(REQ,EL_IOERR);
      372     2854    2           REQ.ERRCT=REQ.ERRCT+1;
      373     2855    3           IF REQ.ERRCT>=3 THEN DO;
      374     2856    3              CALL REQUERETRY ALTRET(ALT);
      375     2857    3              END;
      376     2858    3           ELSE DO;
      377     2859                   %LOCK (G#=SQH.GATE);
      378     2862                   %REQUEUE (P#=REQ,Q#=DCT.SQ$);
      379     2865                   %UNLOCK (G#=SQH.GATE);
      380     2868    3              CALL NIW$DEVSCHED(DCT,%IDLE);
      381     2869    3              END;
      382     2870    2           RETURN;
      383     2871    2   ALT:    ALTRETURN;
      384     2872    2   END RETRY;
      385     2873        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:37   
      386     2874    1   END NIW$POSTER;
      387     2875        %EOD;

PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:38   
--  Include file information  --

   PM$NI.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure NIW$POSTER.

   Procedure NIW$POSTER requires 514 words for executable code.
   Procedure NIW$POSTER requires 34 words of local(AUTO) storage.

PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:39   

 Object Unit name= NIW$POSTER                                 File name= NIW$MPC.:E05TOU
 UTS= JUL 30 '97 03:40:06.64 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      5      5  NIW$POSTER
    1   Proc  even  none   514   1002  NIW$POSTER
    2  RoData even  none    13     15  NIW$POSTER

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        3  NIW$POSTER
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:40   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       4 NIA$SPURINT
         yes           Std       1 HFC$UNLOCK
         yes           Std       3 PMN$COLLECT
         yes           Std       1 NIW$MPCSTOP
         yes           Std       1 NIO$SPCOMP
 yes     yes           Std       2 NIF$ANIOM
 yes     yes           Std       3 NIF$ANFAULT
         yes           Std       2 NIO$COMP
         yes           Std       2 NIM$ENQUEUE
         yes           Std       2 NIW$DEVSCHED
         yes           Std       4 NIA$LOGERR
         yes           Std       2 NIM$REQUEUE
         yes           Std       5 NIK$OPMSG
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_NIWBADINTLVL                       HW_IOP                                HW_IMX
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                NI_DBLZERO
     OCI_BOOT                              B_VECTNIL
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:41   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:42   


      114        1        /*T***********************************************************/
      115        2        /*T*                                                         */
      116        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      117        4        /*T*                                                         */
      118        5        /*T***********************************************************/
      119        6        /*
      120        7           MPC POSTER
      121        8        */
      122        9        NIW$POSTER: PROC (PAR,INTLVL,STATUS);

      9  1 000000   000000 700200 xent  NIW$POSTER   TSX0  ! X66_AUTO_3
         1 000001   000042 000003                    ZERO    34,3

      123       10        /*
      124       11                Includes
      125       12        */
      126       13        %INCLUDE                CP_6_SUBS ;
      127      553        %INCLUDE                EL_SUBS_C ;
      128      637        %INCLUDE                HF_DATA_R ;
      129      680        %INCLUDE                HF_LOCK_C ;
      130      694        %INCLUDE                NI_DATA_C ;
      131      807        %INCLUDE                NI_DATA_R ;
      132     1244        %INCLUDE                NI_MACROS_C ;
      133     1511        %INCLUDE                N_FC_C ;
      134     1548        %INCLUDE                OC_SUBS_C ;
      135     2279        %INCLUDE                PM$NI ;
      136     2303        /*
      137     2304                Parameters
      138     2305        */
      139     2306    1   DCL 1 INTLVL            UBIN(18) PARAM ;
      140     2307    1   DCL 1 PAR               PTR PARAM ;
      141     2308        %STATUS                 ( NAME=STATUS, STCLASS=PARAM ) ;
      142     2375        /*
      143     2376                Entries
      144     2377        */
      145     2378    1   DCL 1 NIA$LOGERR        ENTRY(4) ;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:43   
      146     2379    1   DCL 1 NIA$SPURINT       ENTRY(4) ;
      147     2380    1   DCL 1 NIF$ANFAULT       ENTRY(3) ALTRET ;
      148     2381    1   DCL 1 NIF$ANIOM         ENTRY(2) ALTRET ;
      149     2382    1   DCL 1 NIK$OPMSG         ENTRY(5) ;
      150     2383    1   DCL 1 NIO$COMP          ENTRY(2) ;
      151     2384    1   DCL 1 NIO$SPCOMP        ENTRY(1) ;
      152     2385    1   DCL 1 NIQ$RELS          ENTRY(1) ALTRET ;
      153     2386    1   DCL 1 NIQ$SPURINT       ENTRY(4) ;
      154     2387    1   DCL 1 NIS$DRIVER        ENTRY(1) ;
      155     2388    1   DCL 1 NIW$DEVSCHED      ENTRY(2) ;
      156     2389    1   DCL 1 NIW$MPCSTOP       ENTRY(1) ;
      157     2390    1   DCL 1 PMN$COLLECT       ENTRY(3) ;
      158     2391    1   DCL 1 SC_NIWBADINTLVL   ENTRY CONV(2,0) ;
      159     2392    1   DCL 1 TDC$COMP          ENTRY(1) ALTRET ;
      160     2393        /*
      161     2394                Symrefs
      162     2395        */
      163     2396    1   DCL 1 B_SCDCTX          SBIN SYMREF ;
      164     2397    1   DCL 1 OCI_BOOT          BIT(1) SYMREF ALIGNED ;
      165     2398        /*
      166     2399                Auto
      167     2400        */
      168     2401    1   DCL 1 CHANTIME          SBIN ALIGNED AUTO ;
      169     2402    1   DCL 1 CODE              SBIN ALIGNED AUTO ;
      170     2403    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      171     2404    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
      172     2405    1   DCL 1 IDCW              BIT(36) ALIGNED AUTO ;
      173     2406    1   DCL 1 MINOR             SBIN ALIGNED AUTO ;
      174     2407        %NI$EXTST               ( NAME=NI$EXTST, STCLASS=AUTO ) ;
      175     2441    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
      176     2442    1   DCL 1 REQSTATF          BIT(1) ALIGNED AUTO ;
      177     2443    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      178     2444        /*
      179     2445                Based
      180     2446        */
      181     2447        %NI$DCT                 ( NAME=DCT, STCLASS="BASED(DCT$)" ) ;
      182     2495        %NI$DQH                 ( NAME=DQH, STCLASS="BASED(DQH$)" ) ;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:44   
      183     2518        %NI$IOM                 ( NAME=IOM ) ;
      184     2523        %NI$REQ                 ( NAME=IOS, STCLASS=BASED ) ;
      185     2548        %NI$IOSTAT              ( NAME=IOSTAT ) ;
      186     2557        %NI$MBX                 ( NAME=MBX, STCLASS=BASED ) ;
      187     2576        %N$REQ                  ( NAME=REQ, STCLASS="BASED(REQ$)" ) ;
      188     2634        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
      189     2647        /*
      190     2648                Constants
      191     2649        */
      192     2650    1   DCL COMREJTYC(0:4) BIT(36) CONSTANT INIT(%TYC_IOERR,%TYC_IOERR*2,%TYC_IOERR*2);
      193     2651        /**/
      194     2652        %SUB NEVER="WHILE('0'B)";
      195     2653        %SUB FOREVER="WHILE('1'B)";
      196     2654        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:45   
      197     2655    2           DO INHIBIT;

      198     2656    3              DO CASE (INTLVL);

   2656  1 000002   200004 470700                    LDP0  ! @INTLVL,,AUTO
         1 000003   000000 220300                    LDX0  ! 0,,PR0
         1 000004   000006 100203                    CMPX0 ! 6,DU
         1 000005   000007 602210 1                  TNC   ! s:2656+5,X0
         1 000006   000327 710200 1                  TRA   ! s:2750
         1 000007   000015 710200 1                  TRA   ! s:2658
         1 000010   000015 710200 1                  TRA   ! s:2658
         1 000011   000235 710200 1                  TRA   ! s:2720
         1 000012   000252 710200 1                  TRA   ! s:2724
         1 000013   000015 710200 1                  TRA   ! s:2658
         1 000014   000314 710200 1                  TRA   ! s:2745

      199     2657    3               CASE(%OVERHEAD,%TERMINATE,%LOST);

      200     2658    3                 DQH$=ADDR(PAR);

   2658  1 000015   200003 236300                    LDQ   ! @PAR,,AUTO
         1 000016   200011 756300                    STQ   ! DQH$,,AUTO

      201     2659    3                 SQH$=DQH.SQH$;

   2659  1 000017   200011 471700                    LDP1  ! DQH$,,AUTO
         1 000020   100013 236300                    LDQ   ! 11,,PR1
         1 000021   200026 756300                    STQ   ! SQH$,,AUTO

      202     2660                      %LOCK (G#=SQH.GATE);

   2661  1 000022   200026 630700                    EPPR0 ! SQH$,,AUTO
         1 000023   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000024   000000 701200 xent               TSX1  ! HFC$LOCK
         1 000025   000000 011200                    NOP   ! 0

      203     2663    3                 IF  DQH.STATE ~= %BUSY
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:46   

   2663  1 000026   200011 470700                    LDP0  ! DQH$,,AUTO
         1 000027   000001 236300                    LDQ   ! 1,,PR0
         1 000030   000077 376207                    ANQ   ! 63,DL
         1 000031   000005 116207                    CMPQ  ! 5,DL
         1 000032   000112 600200 1                  TZE   ! s:2679

      204     2664    4                 THEN DO ;

      205     2665    4                    IF  ADDR(STATUS) ~= ADDR(NIL)

   2665  1 000033   200005 236300                    LDQ   ! @STATUS,,AUTO
         1 000034   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 000035   000050 600200 1                  TZE   ! s:2668

      206     2666    4                    THEN
      207     2667    4                       CALL NIA$SPURINT ( DQH, EL_SPURINT, INTLVL, STATUS ) ;

   2667  1 000036   200004 237300                    LDAQ  ! @INTLVL,,AUTO
         1 000037   200036 757300                    STAQ  ! SQH$+8,,AUTO
         1 000040   000001 236200 2                  LDQ   ! 1
         1 000041   200011 235300                    LDA   ! DQH$,,AUTO
         1 000042   200034 757300                    STAQ  ! SQH$+6,,AUTO
         1 000043   200034 630700                    EPPR0 ! SQH$+6,,AUTO
         1 000044   000022 631600 xsym               EPPR1 ! B_VECTNIL+18
         1 000045   000000 701200 xent               TSX1  ! NIA$SPURINT
         1 000046   000000 011200                    NOP   ! 0
         1 000047   000105 710200 1                  TRA   ! s:2675

      208     2668    4                    ELSE IF  INTLVL = %TERMINATE

   2668  1 000050   200004 471700                    LDP1  ! @INTLVL,,AUTO
         1 000051   100000 220300                    LDX0  ! 0,,PR1
         1 000052   000001 100203                    CMPX0 ! 1,DU
         1 000053   000073 601200 1                  TNZ   ! s:2673
         1 000054   000016 236300                    LDQ   ! 14,,PR0
         1 000055   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:47   
         1 000056   000073 600200 1                  TZE   ! s:2673

      209     2669    4                         AND DQH.IOSTATUS$ ~= ADDR(NIL)
      210     2670    4                       THEN
      211     2671    4                          CALL NIA$SPURINT ( DQH, EL_SPURINT, INTLVL, DQH.IOSTATUS$->
              2671                                   IOSTAT.STATUS ) ;

   2671  1 000057   000016 473700                    LDP3  ! 14,,PR0
         1 000060   200037 453700                    STP3  ! SQH$+9,,AUTO
         1 000061   200004 236300                    LDQ   ! @INTLVL,,AUTO
         1 000062   200036 756300                    STQ   ! SQH$+8,,AUTO
         1 000063   000001 236200 2                  LDQ   ! 1
         1 000064   200011 235300                    LDA   ! DQH$,,AUTO
         1 000065   200034 757300                    STAQ  ! SQH$+6,,AUTO
         1 000066   200034 630700                    EPPR0 ! SQH$+6,,AUTO
         1 000067   000022 631600 xsym               EPPR1 ! B_VECTNIL+18
         1 000070   000000 701200 xent               TSX1  ! NIA$SPURINT
         1 000071   000000 011200                    NOP   ! 0
         1 000072   000105 710200 1                  TRA   ! s:2675

      212     2672    4                       ELSE
      213     2673    4                          CALL NIA$SPURINT ( DQH, EL_SPURINT, INTLVL, NI_DBLZERO ) ;

   2673  1 000073   000002 236200 2                  LDQ   ! 2
         1 000074   200004 235300                    LDA   ! @INTLVL,,AUTO
         1 000075   200036 757300                    STAQ  ! SQH$+8,,AUTO
         1 000076   000001 236200 2                  LDQ   ! 1
         1 000077   200011 235300                    LDA   ! DQH$,,AUTO
         1 000100   200034 757300                    STAQ  ! SQH$+6,,AUTO
         1 000101   200034 630700                    EPPR0 ! SQH$+6,,AUTO
         1 000102   000022 631600 xsym               EPPR1 ! B_VECTNIL+18
         1 000103   000000 701200 xent               TSX1  ! NIA$SPURINT
         1 000104   000000 011200                    NOP   ! 0

      214     2674                         %UNLOCK ( G#=SQH.GATE ) ;

   2675  1 000105   200026 630700                    EPPR0 ! SQH$,,AUTO
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:48   
         1 000106   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000107   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 000110   000000 011200                    NOP   ! 0

      215     2677    4                    RETURN ;

   2677  1 000111   000000 702200 xent               TSX2  ! X66_ARET

      216     2678    4                    END ;
      217     2679    3                 REQ$=DQH.IO$;

   2679  1 000112   000014 236300                    LDQ   ! 12,,PR0
         1 000113   200024 756300                    STQ   ! REQ$,,AUTO

      218     2680    3                 DCT$=REQ.DCT$;

   2680  1 000114   200024 471700                    LDP1  ! REQ$,,AUTO
         1 000115   100002 236300                    LDQ   ! 2,,PR1
         1 000116   200010 756300                    STQ   ! DCT$,,AUTO

      219     2681    3                 IF HW_IMX THEN

   2681  1 000117   000000 234200 xsym               SZN   ! HW_IMX
         1 000120   000125 605200 1                  TPL   ! s:2684

      220     2682    3                    REQ.FLPW=DQH.IOSTATUS$->IOSTAT.LPW_RESIDUE;

   2682  1 000121   000016 473700                    LDP3  ! 14,,PR0
         1 000122   300003 236300                    LDQ   ! 3,,PR3
         1 000123   100016 756300                    STQ   ! 14,,PR1
         1 000124   000130 710200 1                  TRA   ! s:2685

      221     2683    3                 ELSE
      222     2684    3                    REQ.FLPW=DQH.MBX$->MBX.LPW;

   2684  1 000125   000021 473700                    LDP3  ! 17,,PR0
         1 000126   300000 236300                    LDQ   ! 0,,PR3
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:49   
         1 000127   100016 756300                    STQ   ! 14,,PR1

      223     2685    4                 IF INTLVL=%TERMINATE THEN DO;

   2685  1 000130   200004 473700                    LDP3  ! @INTLVL,,AUTO
         1 000131   300000 220300                    LDX0  ! 0,,PR3
         1 000132   000001 100203                    CMPX0 ! 1,DU
         1 000133   000155 601200 1                  TNZ   ! s:2697

      224     2686    4                    REQ.STATUS=DQH.IOSTATUS$->IOSTAT.STATUS;

   2686  1 000134   000016 474700                    LDP4  ! 14,,PR0
         1 000135   400000 237300                    LDAQ  ! 0,,PR4
         1 000136   100014 757300                    STAQ  ! 12,,PR1

      225     2687    4                    IF HW_IOP THEN    /* ignore IOP generated lost interrupt */

   2687  1 000137   000000 234200 xsym               SZN   ! HW_IOP
         1 000140   000160 605200 1                  TPL   ! s:2699

      226     2688    4                       IF REQ.STATUS.MAJOR = %READY AND

   2688  1 000141   100014 236300                    LDQ   ! 12,,PR1
         1 000142   170000 316203                    CANQ  ! 61440,DU
         1 000143   000160 601200 1                  TNZ   ! s:2699
         1 000144   100014 236300                    LDQ   ! 12,,PR1
         1 000145   700000 376207                    ANQ   ! -32768,DL
         1 000146   400000 116207                    CMPQ  ! -131072,DL
         1 000147   000160 601200 1                  TNZ   ! s:2699

      227     2689    5                         REQ.STATUS.IOM.CHANNEL = %LOSTINT THEN DO;

      228     2690                               %UNLOCK (G#=SQH.GATE);

   2691  1 000150   200026 630700                    EPPR0 ! SQH$,,AUTO
         1 000151   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000152   000000 701200 xent               TSX1  ! HFC$UNLOCK
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:50   
         1 000153   000000 011200                    NOP   ! 0

      229     2693    5                          RETURN;

   2693  1 000154   000000 702200 xent               TSX2  ! X66_ARET

      230     2694    5                          END;
      231     2695    4                    END;
      232     2696    3                 ELSE
      233     2697    3                    REQ.STATUS=STATUS;

   2697  1 000155   200005 474700                    LDP4  ! @STATUS,,AUTO
         1 000156   400000 237300                    LDAQ  ! 0,,PR4
         1 000157   100014 757300                    STAQ  ! 12,,PR1

      234     2698             /* Don't mask channel on lost interrupt - T&D expects lost ints on RSOs */
      235     2699    3                 DQH.STATE=%IDLE;

   2699  1 000160   000000 236203                    LDQ   ! 0,DU
         1 000161   000001 752301                    STCQ  ! 1,'01'O,PR0

      236     2700    3                 CALL PMN$COLLECT(DQH.PM,%PM_IDLE,CHANTIME);

   2700  1 000162   200006 634700                    EPPR4 ! CHANTIME,,AUTO
         1 000163   200036 454700                    STP4  ! SQH$+8,,AUTO
         1 000164   000003 236200 2                  LDQ   ! 3
         1 000165   200035 756300                    STQ   ! SQH$+7,,AUTO
         1 000166   200011 236300                    LDQ   ! DQH$,,AUTO
         1 000167   000002 036203                    ADLQ  ! 2,DU
         1 000170   200034 756300                    STQ   ! SQH$+6,,AUTO
         1 000171   200034 630700                    EPPR0 ! SQH$+6,,AUTO
         1 000172   000021 631600 xsym               EPPR1 ! B_VECTNIL+17
         1 000173   000000 701200 xent               TSX1  ! PMN$COLLECT
         1 000174   000000 011200                    NOP   ! 0

      237     2701    4                 IF DQH.CHANSTATE THEN DO;

PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:51   
   2701  1 000175   200011 470700                    LDP0  ! DQH$,,AUTO
         1 000176   000020 236300                    LDQ   ! 16,,PR0
         1 000177   740000 316203                    CANQ  ! -16384,DU
         1 000200   000215 600200 1                  TZE   ! s:2710

      238     2702                         %UNLOCK (G#=SQH.GATE) ;

   2703  1 000201   200026 630700                    EPPR0 ! SQH$,,AUTO
         1 000202   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000203   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 000204   000000 011200                    NOP   ! 0

      239     2705    5                    IF DQH.CHANSTATE.STOP THEN DO;

   2705  1 000205   200011 470700                    LDP0  ! DQH$,,AUTO
         1 000206   000020 234300                    SZN   ! 16,,PR0
         1 000207   000331 605200 1                  TPL   ! s:2758

      240     2706    5                       CALL NIW$MPCSTOP(DCT) ;

   2706  1 000210   200010 630700                    EPPR0 ! DCT$,,AUTO
         1 000211   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000212   000000 701200 xent               TSX1  ! NIW$MPCSTOP
         1 000213   000000 011200                    NOP   ! 0

      241     2707    5                       END ;

      242     2708    4                    END ;

   2708  1 000214   000331 710200 1                  TRA   ! s:2758

      243     2709    4                 ELSE DO ;

      244     2710    5                    IF NOT DQH.STATUS.DOWN THEN DO ;

   2710  1 000215   000001 236300                    LDQ   ! 1,,PR0
         1 000216   200000 316203                    CANQ  ! 65536,DU
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:52   
         1 000217   000230 601200 1                  TNZ   ! s:2716

      245     2711                            %ENQUEUE ( P#=DQH, Q#=SQH.CQ$ ) ;

   2712  1 000220   200026 236300                    LDQ   ! SQH$,,AUTO
         1 000221   000004 036203                    ADLQ  ! 4,DU
         1 000222   200011 235300                    LDA   ! DQH$,,AUTO
         1 000223   200034 757300                    STAQ  ! SQH$+6,,AUTO
         1 000224   200034 630700                    EPPR0 ! SQH$+6,,AUTO
         1 000225   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 000226   000000 701200 xent               TSX1  ! NIM$ENQUEUE
         1 000227   000000 011200                    NOP   ! 0

      246     2714    5                       END ;

      247     2715                         %UNLOCK (G#=SQH.GATE) ;

   2716  1 000230   200026 630700                    EPPR0 ! SQH$,,AUTO
         1 000231   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000232   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 000233   000000 011200                    NOP   ! 0

      248     2718    4                    END ;

   2718  1 000234   000331 710200 1                  TRA   ! s:2758

      249     2719    3               CASE(%MARKER);

      250     2720    3                 DQH$=ADDR(PAR);

   2720  1 000235   200003 236300                    LDQ   ! @PAR,,AUTO
         1 000236   200011 756300                    STQ   ! DQH$,,AUTO

      251     2721    3                 CALL NIA$SPURINT(DQH,EL_SPURINT,INTLVL,NI_DBLZERO);

   2721  1 000237   000002 236200 2                  LDQ   ! 2
         1 000240   200004 235300                    LDA   ! @INTLVL,,AUTO
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:53   
         1 000241   200036 757300                    STAQ  ! SQH$+8,,AUTO
         1 000242   000001 236200 2                  LDQ   ! 1
         1 000243   200011 235300                    LDA   ! DQH$,,AUTO
         1 000244   200034 757300                    STAQ  ! SQH$+6,,AUTO
         1 000245   200034 630700                    EPPR0 ! SQH$+6,,AUTO
         1 000246   000022 631600 xsym               EPPR1 ! B_VECTNIL+18
         1 000247   000000 701200 xent               TSX1  ! NIA$SPURINT
         1 000250   000000 011200                    NOP   ! 0

      252     2722    3                 RETURN;

   2722  1 000251   000000 702200 xent               TSX2  ! X66_ARET

      253     2723    3               CASE(%SPECIAL);

      254     2724    3                 DQH$=ADDR(PAR);

   2724  1 000252   200003 236300                    LDQ   ! @PAR,,AUTO
         1 000253   200011 756300                    STQ   ! DQH$,,AUTO

      255     2725    3                 SQH$=DQH.SQH$;

   2725  1 000254   200011 471700                    LDP1  ! DQH$,,AUTO
         1 000255   100013 236300                    LDQ   ! 11,,PR1
         1 000256   200026 756300                    STQ   ! SQH$,,AUTO

      256     2726    3                 DCT$=DQH.MPC$;

   2726  1 000257   100015 236300                    LDQ   ! 13,,PR1
         1 000260   200010 756300                    STQ   ! DCT$,,AUTO

      257     2727                      %LOCK (G#=SQH.GATE);

   2728  1 000261   200026 630700                    EPPR0 ! SQH$,,AUTO
         1 000262   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000263   000000 701200 xent               TSX1  ! HFC$LOCK
         1 000264   000000 011200                    NOP   ! 0
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:54   

      258     2730    4                 IF DCT.SPSTAT.PRESENCE THEN DO;

   2730  1 000265   200010 470700                    LDP0  ! DCT$,,AUTO
         1 000266   000017 234300                    SZN   ! 15,,PR0
         1 000267   000275 605200 1                  TPL   ! s:2736

      259     2731                         %UNLOCK (G#=SQH.GATE);

   2732  1 000270   200026 630700                    EPPR0 ! SQH$,,AUTO
         1 000271   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000272   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 000273   000000 011200                    NOP   ! 0

      260     2734    4                    END;

   2734  1 000274   000313 710200 1                  TRA   ! s:2743

      261     2735    4                 ELSE DO;

      262     2736    4                    DCT.SPSTAT=STATUS;

   2736  1 000275   200005 471700                    LDP1  ! @STATUS,,AUTO
         1 000276   100000 236300                    LDQ   ! 0,,PR1
         1 000277   000017 756300                    STQ   ! 15,,PR0

      263     2737                         %UNLOCK (G#=SQH.GATE);

   2738  1 000300   200026 630700                    EPPR0 ! SQH$,,AUTO
         1 000301   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         1 000302   000000 701200 xent               TSX1  ! HFC$UNLOCK
         1 000303   000000 011200                    NOP   ! 0

      264     2740    4                    CALL NIO$SPCOMP(DCT);

   2740  1 000304   200010 630700                    EPPR0 ! DCT$,,AUTO
         1 000305   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:55   
         1 000306   000000 701200 xent               TSX1  ! NIO$SPCOMP
         1 000307   000000 011200                    NOP   ! 0

      265     2741    4                    DCT.SPSTAT.PRESENCE='0'B;

   2741  1 000310   200010 470700                    LDP0  ! DCT$,,AUTO
         1 000311   000031 236200 xsym               LDQ   ! B_VECTNIL+25
         1 000312   000017 356300                    ANSQ  ! 15,,PR0

      266     2742    4                    END;

      267     2743    3                 RETURN;

   2743  1 000313   000000 702200 xent               TSX2  ! X66_ARET

      268     2744    3               CASE(%REPOST);

      269     2745    3                 REQ$=ADDR(PAR);

   2745  1 000314   200003 236300                    LDQ   ! @PAR,,AUTO
         1 000315   200024 756300                    STQ   ! REQ$,,AUTO

      270     2746    3                 DCT$=REQ.DCT$;

   2746  1 000316   200024 471700                    LDP1  ! REQ$,,AUTO
         1 000317   100002 236300                    LDQ   ! 2,,PR1
         1 000320   200010 756300                    STQ   ! DCT$,,AUTO

      271     2747    3                 SQH$=DCT.SQH$;

   2747  1 000321   200010 473700                    LDP3  ! DCT$,,AUTO
         1 000322   300022 236300                    LDQ   ! 18,,PR3
         1 000323   200026 756300                    STQ   ! SQH$,,AUTO

      272     2748    3                 DQH$=DCT.DQH$;

   2748  1 000324   300023 236300                    LDQ   ! 19,,PR3
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:56   
         1 000325   200011 756300                    STQ   ! DQH$,,AUTO
         1 000326   000331 710200 1                  TRA   ! s:2758

      273     2749    3               CASE(ELSE);

      274     2750    3                 CALL SC_NIWBADINTLVL;

   2750  1 000327   000000 713600 xsym               CLIMB ! SC_NIWBADINTLVL
         1 000330   000000 600000 xsid               climb   nvectors=         0

      275     2751        /*S* SCREECH_CODE: NIW-S$BADINTLVL-7
      276     2752             TYPE: SCREECH
      277     2753             MESSAGE:      The interrupt level is invalid.
      278     2754        */
      279     2755    3               END/* CASE INTLVL */;

      280     2756    2              END;

      281     2757        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:57   
      282     2758    1           IF DCT.SQ$=ADDR(NIL) THEN

   2758  1 000331   200010 470500                    LDP0    DCT$,,AUTO
         1 000332   000001 236100                    LDQ     1,,PR0
         1 000333   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000334   000347 601000 1                  TNZ     s:2761

      283     2759    1              CALL PMN$COLLECT(DCT.PM,%PM_IDLE);

   2759  1 000335   000003 236000 2                  LDQ     3
         1 000336   200035 756100                    STQ     SQH$+7,,AUTO
         1 000337   200010 236100                    LDQ     DCT$,,AUTO
         1 000340   000010 036003                    ADLQ    8,DU
         1 000341   200034 756100                    STQ     SQH$+6,,AUTO
         1 000342   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000343   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000344   000000 701000 xent               TSX1    PMN$COLLECT
         1 000345   000000 011000                    NOP     0
         1 000346   000360 710000 1                  TRA     s:2762

      284     2760    1           ELSE
      285     2761    1              CALL PMN$COLLECT(DCT.PM,%PM_WAIT);

   2761  1 000347   000004 236000 2                  LDQ     4
         1 000350   200035 756100                    STQ     SQH$+7,,AUTO
         1 000351   200010 236100                    LDQ     DCT$,,AUTO
         1 000352   000010 036003                    ADLQ    8,DU
         1 000353   200034 756100                    STQ     SQH$+6,,AUTO
         1 000354   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000355   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000356   000000 701000 xent               TSX1    PMN$COLLECT
         1 000357   000000 011000                    NOP     0

      286     2762    2           IF REQ.COMP=%COMP_TD THEN DO;

   2762  1 000360   200024 470500                    LDP0    REQ$,,AUTO
         1 000361   000027 236100                    LDQ     23,,PR0
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:58   
         1 000362   177000 376007                    ANQ     65024,DL
         1 000363   004000 116007                    CMPQ    2048,DL
         1 000364   000367 601000 1                  TNZ     s:2765

      287     2763    2              REQ.EAINFO=CHANTIME;

   2763  1 000365   200006 235100                    LDA     CHANTIME,,AUTO
         1 000366   000024 755100                    STA     20,,PR0

      288     2764    2              END;

      289     2765    2           IF REQ.COMP=%COMP_REG AND REQ.FC~=%N_RQSTAT THEN DO;

   2765  1 000367   000027 236100                    LDQ     23,,PR0
         1 000370   177000 316007                    CANQ    65024,DL
         1 000371   000575 601000 1                  TNZ     COMP
         1 000372   000003 236100                    LDQ     3,,PR0
         1 000373   000777 376007                    ANQ     511,DL
         1 000374   000001 116007                    CMPQ    1,DL
         1 000375   000575 600000 1                  TZE     COMP

      290     2766    2              REQ.TYC='0'B;

   2766  1 000376   000021 450100                    STZ     17,,PR0

      291     2767    2              CODE=0;

   2767  1 000377   200007 450100                    STZ     CODE,,AUTO

      292     2768    3              IF REQ.STATUS.MAJOR<%SPECIAL_INTERRUPT THEN DO;

   2768  1 000400   000014 236100                    LDQ     12,,PR0
         1 000401   170000 376003                    ANQ     61440,DU
         1 000402   160000 116003                    CMPQ    57344,DU
         1 000403   000414 603000 1                  TRC     s:2771

      293     2769    3                 REQSTATF=REQ.FC=%N_RQSTAT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:59   

   2769  1 000404   400000 220003                    LDX0    -131072,DU
         1 000405   000003 236100                    LDQ     3,,PR0
         1 000406   000777 376007                    ANQ     511,DL
         1 000407   000001 116007                    CMPQ    1,DL
         1 000410   000412 600000 1                  TZE     s:2769+6
         1 000411   000000 220003                    LDX0    0,DU
         1 000412   000000 636010                    EAQ     0,X0
         1 000413   200025 756100                    STQ     REQSTATF,,AUTO

      294     2770    3                 END;

      295     2771    3              IF REQ.STATUS.POWEROFF THEN DO;

   2771  1 000414   000014 236100                    LDQ     12,,PR0
         1 000415   200000 316003                    CANQ    65536,DU
         1 000416   000432 600000 1                  TZE     s:2777

      296     2772    3                 REQ.TYC.IOERR='1'B;

   2772  1 000417   001000 236003                    LDQ     512,DU
         1 000420   000021 256100                    ORSQ    17,,PR0

      297     2773    3                 IF DCT.DFLG.RELOAD OR REQSTATF THEN GOTO COMP;

   2773  1 000421   200010 471500                    LDP1    DCT$,,AUTO
         1 000422   100006 236100                    LDQ     6,,PR1
         1 000423   004000 316007                    CANQ    2048,DL
         1 000424   000575 601000 1                  TNZ     COMP
         1 000425   200025 234100                    SZN     REQSTATF,,AUTO
         1 000426   000575 604000 1                  TMI     COMP

      298     2774    3                 CALL REQUE ALTRET(COMP);

   2774  1 000427   000627 701000 1                  TSX1    REQUE
         1 000430   000575 702000 1                  TSX2    COMP

PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:60   
      299     2775    3                 RETURN;

   2775  1 000431   000000 702200 xent               TSX2  ! X66_ARET

      300     2776    3                 END;
      301     2777    3              IF REQ.STATUS.IOM THEN DO;

   2777  1 000432   770000 316007                    CANQ    -4096,DL
         1 000433   000453 600000 1                  TZE     s:2784

      302     2778    3                 CALL NIF$ANIOM(REQ,CODE) ALTRET(IOM_ALT);

   2778  1 000434   200007 631500                    EPPR1   CODE,,AUTO
         1 000435   200035 451500                    STP1    SQH$+7,,AUTO
         1 000436   200024 236100                    LDQ     REQ$,,AUTO
         1 000437   200034 756100                    STQ     SQH$+6,,AUTO
         1 000440   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000441   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000442   000000 701000 xent               TSX1    NIF$ANIOM
         1 000443   000451 702000 1                  TSX2    IOM_ALT

      303     2779    3                 IF CODE<0 THEN CODE=1;

   2779  1 000444   200007 235100                    LDA     CODE,,AUTO
         1 000445   000450 605000 1                  TPL     s:2780

   2779  1 000446   000001 236007                    LDQ     1,DL
         1 000447   200007 756100                    STQ     CODE,,AUTO

      304     2780    4                 DO NEVER;

   2780  1 000450   000453 710000 1                  TRA     s:2784

      305     2781    4   IOM_ALT:         CODE=3;

   2781  1 000451   000003 235007       IOM_ALT      LDA     3,DL
         1 000452   200007 755100                    STA     CODE,,AUTO
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:61   

      306     2782    4                    END;

      307     2783    3                 END;

      308     2784    2              MINOR=BITBIN(REQ.STATUS.MINOR);

   2784  1 000453   200024 470500                    LDP0    REQ$,,AUTO
         1 000454   000014 236100                    LDQ     12,,PR0
         1 000455   000030 772000                    QRL     24
         1 000456   000077 376007                    ANQ     63,DL
         1 000457   200013 756100                    STQ     MINOR,,AUTO

      309     2785    3              DO CASE(REQ.STATUS.MAJOR);

   2785  1 000460   000014 236100                    LDQ     12,,PR0
         1 000461   000036 772000                    QRL     30
         1 000462   000017 376007                    ANQ     15,DL
         1 000463   000020 116007                    CMPQ    16,DL
         1 000464   000466 602006 1                  TNC     s:2785+6,QL
         1 000465   000552 710000 1                  TRA     ILLSTAT
         1 000466   000506 710000 1                  TRA     s:2787
         1 000467   000552 710000 1                  TRA     ILLSTAT
         1 000470   000552 710000 1                  TRA     ILLSTAT
         1 000471   000552 710000 1                  TRA     ILLSTAT
         1 000472   000552 710000 1                  TRA     ILLSTAT
         1 000473   000511 710000 1                  TRA     s:2789
         1 000474   000552 710000 1                  TRA     ILLSTAT
         1 000475   000552 710000 1                  TRA     ILLSTAT
         1 000476   000525 710000 1                  TRA     s:2796
         1 000477   000552 710000 1                  TRA     ILLSTAT
         1 000500   000552 710000 1                  TRA     ILLSTAT
         1 000501   000552 710000 1                  TRA     ILLSTAT
         1 000502   000552 710000 1                  TRA     ILLSTAT
         1 000503   000552 710000 1                  TRA     ILLSTAT
         1 000504   000552 710000 1                  TRA     ILLSTAT
         1 000505   000532 710000 1                  TRA     s:2800
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:62   

      310     2786    3               CASE(%READY);

      311     2787    3                 IF MINOR>0 THEN GOTO ILLSTAT;

   2787  1 000506   200013 235100                    LDA     MINOR,,AUTO
         1 000507   000552 605400 1                  TPNZ    ILLSTAT
         1 000510   000557 710000 1                  TRA     s:2811

      312     2788    3               CASE(%COMMAND_REJECT);

      313     2789    3                 IF MINOR>4 THEN GOTO ILLSTAT;

   2789  1 000511   200013 235100                    LDA     MINOR,,AUTO
         1 000512   000004 115007                    CMPA    4,DL
         1 000513   000552 605400 1                  TPNZ    ILLSTAT

      314     2790    3                 REQ.TYC=REQ.TYC|COMREJTYC(MINOR);

   2790  1 000514   000021 236100                    LDQ     17,,PR0
         1 000515   000000 276005 0                  ORQ     COMREJTYC,AL
         1 000516   000021 756100                    STQ     17,,PR0

      315     2791    4                 IF MINOR~=2 THEN DO;

   2791  1 000517   200013 235100                    LDA     MINOR,,AUTO
         1 000520   000002 115007                    CMPA    2,DL
         1 000521   000557 600000 1                  TZE     s:2811

      316     2792    4                    CALL RETRY ALTRET(COMP);

   2792  1 000522   000724 701000 1                  TSX1    RETRY
         1 000523   000575 702000 1                  TSX2    COMP

      317     2793    4                    RETURN;

   2793  1 000524   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:63   

      318     2794    4                    END;
      319     2795    3               CASE(%LOST_INTERRUPT);

      320     2796    3                 REQ.TYC.TIMO='1'B;

   2796  1 000525   000010 236003                    LDQ     8,DU
         1 000526   000021 256100                    ORSQ    17,,PR0

      321     2797    3                 CALL RETRY ALTRET(COMP);

   2797  1 000527   000724 701000 1                  TSX1    RETRY
         1 000530   000575 702000 1                  TSX2    COMP

      322     2798    3                 RETURN;

   2798  1 000531   000000 702200 xent               TSX2  ! X66_ARET

      323     2799    3               CASE(%SYSTEM_FAULT);

      324     2800    3                 CALL NIF$ANFAULT(REQ,CODE) ALTRET(FLT_ALT);

   2800  1 000532   200007 631500                    EPPR1   CODE,,AUTO
         1 000533   200035 451500                    STP1    SQH$+7,,AUTO
         1 000534   200024 236100                    LDQ     REQ$,,AUTO
         1 000535   200034 756100                    STQ     SQH$+6,,AUTO
         1 000536   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000537   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000540   000000 701000 xent               TSX1    NIF$ANFAULT
         1 000541   000547 702000 1                  TSX2    FLT_ALT

      325     2801    3                 IF CODE<0 THEN CODE=1;

   2801  1 000542   200007 235100                    LDA     CODE,,AUTO
         1 000543   000546 605000 1                  TPL     s:2802

   2801  1 000544   000001 236007                    LDQ     1,DL
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:64   
         1 000545   200007 756100                    STQ     CODE,,AUTO

      326     2802    4                 DO NEVER;

   2802  1 000546   000557 710000 1                  TRA     s:2811

      327     2803    4   FLT_ALT:         CODE=3;

   2803  1 000547   000003 235007       FLT_ALT      LDA     3,DL
         1 000550   200007 755100                    STA     CODE,,AUTO

      328     2804    4                    END;

   2804  1 000551   000557 710000 1                  TRA     s:2811

      329     2805    3               CASE(ELSE);

      330     2806    3   ILLSTAT:
      331     2807    3                 REQ.TYC.IOERR='1'B;

   2807  1 000552   001000 236003       ILLSTAT      LDQ     512,DU
         1 000553   000021 256100                    ORSQ    17,,PR0

      332     2808    3                 CALL RETRY ALTRET(COMP);

   2808  1 000554   000724 701000 1                  TSX1    RETRY
         1 000555   000575 702000 1                  TSX2    COMP

      333     2809    3                 RETURN;

   2809  1 000556   000000 702200 xent               TSX2  ! X66_ARET

      334     2810    3               END/* CASE REQ.STATUS.MAJOR */;

      335     2811    3              DO CASE(CODE);

   2811  1 000557   200007 235100                    LDA     CODE,,AUTO
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:65   
         1 000560   000004 115007                    CMPA    4,DL
         1 000561   000563 602005 1                  TNC     s:2811+4,AL
         1 000562   000575 710000 1                  TRA     COMP
         1 000563   000575 710000 1                  TRA     COMP
         1 000564   000567 710000 1                  TRA     s:2813
         1 000565   000567 710000 1                  TRA     s:2813
         1 000566   000572 710000 1                  TRA     s:2816

      336     2812    3               CASE(1,2);                  /* RETRY */

      337     2813    3                 CALL RETRY ALTRET(COMP);

   2813  1 000567   000724 701000 1                  TSX1    RETRY
         1 000570   000575 702000 1                  TSX2    COMP

      338     2814    3                 RETURN;

   2814  1 000571   000000 702200 xent               TSX2  ! X66_ARET

      339     2815    3               CASE(3);                    /* WAIT FOR KEYIN */

      340     2816    3                 CALL REQUE ALTRET(COMP);

   2816  1 000572   000627 701000 1                  TSX1    REQUE
         1 000573   000575 702000 1                  TSX2    COMP

      341     2817    3                 RETURN;

   2817  1 000574   000000 702200 xent               TSX2  ! X66_ARET

      342     2818    3               END/* CASE CODE */;

      343     2819    2              END/* IF NOT REQ.T@D */;

      344     2820    1   COMP:
      345     2821    1           IF REQ.IOFLG.REL THEN DCT.DFLG.MPCSUSPENDED='0'B;

PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:66   
   2821  1 000575   200024 470500       COMP         LDP0    REQ$,,AUTO
         1 000576   000004 236100                    LDQ     4,,PR0
         1 000577   002000 316007                    CANQ    1024,DL
         1 000600   000604 600000 1                  TZE     s:2822

   2821  1 000601   200010 471500                    LDP1    DCT$,,AUTO
         1 000602   000005 236000 2                  LDQ     5
         1 000603   100006 356100                    ANSQ    6,,PR1

      346     2822    1           CALL NIW$DEVSCHED(DCT,%IDLE);

   2822  1 000604   000003 236000 2                  LDQ     3
         1 000605   200010 235100                    LDA     DCT$,,AUTO
         1 000606   200034 757100                    STAQ    SQH$+6,,AUTO
         1 000607   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000610   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000611   000000 701000 xent               TSX1    NIW$DEVSCHED
         1 000612   000000 011000                    NOP     0

      347     2823    1           NI$EXTST.EXTST='0'B;

   2823  1 000613   000100 100400                    MLR     fill='000'O
         1 000614   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000615   200014 000040                    ADSC9   NI$EXTST,,AUTO           cn=0,n=32

      348     2824    1           CALL NIO$COMP(REQ,NI$EXTST);

   2824  1 000616   200014 630500                    EPPR0   NI$EXTST,,AUTO
         1 000617   200035 450500                    STP0    SQH$+7,,AUTO
         1 000620   200024 236100                    LDQ     REQ$,,AUTO
         1 000621   200034 756100                    STQ     SQH$+6,,AUTO
         1 000622   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000623   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000624   000000 701000 xent               TSX1    NIO$COMP
         1 000625   000000 011000                    NOP     0

      349     2825    1           RETURN;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:67   

   2825  1 000626   000000 702200 xent               TSX2  ! X66_ARET

      350     2826        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:68   
      351     2827        /* REQUE REQUEST FOR OPERATOR RESPONSE
      352     2828        */
      353     2829    1   REQUE:  PROC ALTRET;

   2829  1 000627   200032 741300       REQUE        STX1  ! SQH$+4,,AUTO

      354     2830        /**/
      355     2831    2           CALL NIA$LOGERR(REQ,EL_IOERR);

   2831  1 000630   000007 236000 2                  LDQ     7
         1 000631   200024 235100                    LDA     REQ$,,AUTO
         1 000632   200034 757100                    STAQ    SQH$+6,,AUTO
         1 000633   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000634   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000635   000000 701000 xent               TSX1    NIA$LOGERR
         1 000636   000000 011000                    NOP     0

      356     2832    2           REQ.ERRCT=REQ.ERRCT+1;

   2832  1 000637   200024 470500                    LDP0    REQ$,,AUTO
         1 000640   000003 236100                    LDQ     3,,PR0
         1 000641   001000 036003                    ADLQ    512,DU
         1 000642   000003 552140                    STBQ    3,'40'O,PR0
         1 000643   000645 710000 1                  TRA     s:2834

      357     2833    2   REQUERETRY: ENTRY ALTRET;

   2833  1 000644   200032 741300       REQUERETRY   STX1  ! SQH$+4,,AUTO

      358     2834    2           IF REQ.ERRCT>6 THEN ALTRETURN;

   2834  1 000645   200024 470500                    LDP0    REQ$,,AUTO
         1 000646   000003 236100                    LDQ     3,,PR0
         1 000647   777000 376003                    ANQ     -512,DU
         1 000650   007000 116003                    CMPQ    3584,DU
         1 000651   000654 602000 1                  TNC     s:2835

PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:69   
   2834  1 000652   200032 221300                    LDX1  ! SQH$+4,,AUTO
         1 000653   000000 702211                    TSX2  ! 0,X1

      359     2835    2           IF OCI_BOOT THEN ALTRETURN;

   2835  1 000654   000000 234000 xsym               SZN     OCI_BOOT
         1 000655   000660 605000 1                  TPL     s:2836

   2835  1 000656   200032 221300                    LDX1  ! SQH$+4,,AUTO
         1 000657   000000 702211                    TSX2  ! 0,X1

      360     2836    2           CALL NIK$OPMSG(DCT,MPC_MSG#,M_DISK,%KIWAIT,REQ);

   2836  1 000660   200024 236100                    LDQ     REQ$,,AUTO
         1 000661   200040 756100                    STQ     SQH$+10,,AUTO
         1 000662   000012 237000 2                  LDAQ    10
         1 000663   200036 757100                    STAQ    SQH$+8,,AUTO
         1 000664   000014 236000 2                  LDQ     12
         1 000665   200010 235100                    LDA     DCT$,,AUTO
         1 000666   200034 757100                    STAQ    SQH$+6,,AUTO
         1 000667   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000670   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000671   000000 701000 xent               TSX1    NIK$OPMSG
         1 000672   000000 011000                    NOP     0

      361     2837                %LOCK (G#=SQH.GATE);

   2838  1 000673   200026 630500                    EPPR0   SQH$,,AUTO
         1 000674   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000675   000000 701000 xent               TSX1    HFC$LOCK
         1 000676   000000 011000                    NOP     0

      362     2840                %REQUEUE (P#=REQ,Q#=DCT.SQ$);

   2841  1 000677   200010 236100                    LDQ     DCT$,,AUTO
         1 000700   000001 036003                    ADLQ    1,DU
         1 000701   200024 235100                    LDA     REQ$,,AUTO
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:70   
         1 000702   200034 757100                    STAQ    SQH$+6,,AUTO
         1 000703   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000704   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000705   000000 701000 xent               TSX1    NIM$REQUEUE
         1 000706   000000 011000                    NOP     0

      363     2843                %UNLOCK (G#=SQH.GATE);

   2844  1 000707   200026 630500                    EPPR0   SQH$,,AUTO
         1 000710   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000711   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000712   000000 011000                    NOP     0

      364     2846    2           CALL NIW$DEVSCHED(DCT,%KIWAIT);

   2846  1 000713   000013 236000 2                  LDQ     11
         1 000714   200010 235100                    LDA     DCT$,,AUTO
         1 000715   200034 757100                    STAQ    SQH$+6,,AUTO
         1 000716   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000717   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000720   000000 701000 xent               TSX1    NIW$DEVSCHED
         1 000721   000000 011000                    NOP     0

      365     2847    2           RETURN;

   2847  1 000722   200032 221300                    LDX1  ! SQH$+4,,AUTO
         1 000723   000001 702211                    TSX2  ! 1,X1

      366     2848    2   END REQUE;
      367     2849        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:71   
      368     2850        /* RETRY ERRORS
      369     2851        */
      370     2852    1   RETRY:  PROC ALTRET;

   2852  1 000724   200030 741300       RETRY        STX1  ! SQH$+2,,AUTO

      371     2853    2           CALL NIA$LOGERR(REQ,EL_IOERR);

   2853  1 000725   000007 236000 2                  LDQ     7
         1 000726   200024 235100                    LDA     REQ$,,AUTO
         1 000727   200034 757100                    STAQ    SQH$+6,,AUTO
         1 000730   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000731   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000732   000000 701000 xent               TSX1    NIA$LOGERR
         1 000733   000000 011000                    NOP     0

      372     2854    2           REQ.ERRCT=REQ.ERRCT+1;

   2854  1 000734   200024 470500                    LDP0    REQ$,,AUTO
         1 000735   000003 236100                    LDQ     3,,PR0
         1 000736   001000 036003                    ADLQ    512,DU
         1 000737   000003 552140                    STBQ    3,'40'O,PR0

      373     2855    3           IF REQ.ERRCT>=3 THEN DO;

   2855  1 000740   000003 236100                    LDQ     3,,PR0
         1 000741   777000 376003                    ANQ     -512,DU
         1 000742   003000 116003                    CMPQ    1536,DU
         1 000743   000747 602000 1                  TNC     s:2860

      374     2856    3              CALL REQUERETRY ALTRET(ALT);

   2856  1 000744   000644 701000 1                  TSX1    REQUERETRY
         1 000745   001000 702000 1                  TSX2    ALT

      375     2857    3              END;

PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:72   
   2857  1 000746   000776 710000 1                  TRA     s:2870

      376     2858    3           ELSE DO;

      377     2859                   %LOCK (G#=SQH.GATE);

   2860  1 000747   200026 630500                    EPPR0   SQH$,,AUTO
         1 000750   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000751   000000 701000 xent               TSX1    HFC$LOCK
         1 000752   000000 011000                    NOP     0

      378     2862                   %REQUEUE (P#=REQ,Q#=DCT.SQ$);

   2863  1 000753   200010 236100                    LDQ     DCT$,,AUTO
         1 000754   000001 036003                    ADLQ    1,DU
         1 000755   200024 235100                    LDA     REQ$,,AUTO
         1 000756   200034 757100                    STAQ    SQH$+6,,AUTO
         1 000757   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000760   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000761   000000 701000 xent               TSX1    NIM$REQUEUE
         1 000762   000000 011000                    NOP     0

      379     2865                   %UNLOCK (G#=SQH.GATE);

   2866  1 000763   200026 630500                    EPPR0   SQH$,,AUTO
         1 000764   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000765   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000766   000000 011000                    NOP     0

      380     2868    3              CALL NIW$DEVSCHED(DCT,%IDLE);

   2868  1 000767   000003 236000 2                  LDQ     3
         1 000770   200010 235100                    LDA     DCT$,,AUTO
         1 000771   200034 757100                    STAQ    SQH$+6,,AUTO
         1 000772   200034 630500                    EPPR0   SQH$+6,,AUTO
         1 000773   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000774   000000 701000 xent               TSX1    NIW$DEVSCHED
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:73   
         1 000775   000000 011000                    NOP     0

      381     2869    3              END;

      382     2870    2           RETURN;

   2870  1 000776   200030 221300                    LDX1  ! SQH$+2,,AUTO
         1 000777   000001 702211                    TSX2  ! 1,X1

      383     2871    2   ALT:    ALTRETURN;

   2871  1 001000   200030 221300       ALT          LDX1  ! SQH$+2,,AUTO
         1 001001   000000 702211                    TSX2  ! 0,X1

COMREJTYC
 Sect OctLoc
   0     000   001000 000000   001000 000000   001000 000000   001000 000000    ................
   0     004   001000 000000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000000 000315   000000 006000   000000 006000   000002 006000    ................
   2     004   000003 006000   777777 775777   000000 000311   000006 006000    ................
   2     010   000000 000222   100000 000000   000011 006000   000006 006000    ....@...........
   2     014   000010 006000                                                    ....
      384     2872    2   END RETRY;
      385     2873        %EJECT;
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:74   
      386     2874    1   END NIW$POSTER;
      387     2875        %EOD;

PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:75   
--  Include file information  --

   PM$NI.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure NIW$POSTER.
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:76   

 **** Variables and constants ****

  ****  Section 000 RoData NIW$POSTER

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT         r     1 COMREJTYC(0:4)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @INTLVL                    3-0-0/w PTR         r     1 @PAR
     5-0-0/w PTR         r     1 @STATUS                    6-0-0/w SBIN        r     1 CHANTIME
     7-0-0/w SBIN        r     1 CODE                      10-0-0/w PTR         r     1 DCT$
    11-0-0/w PTR         r     1 DQH$                      *0-0-0/w UBIN(18)    r     1 INTLVL
    13-0-0/w SBIN        r     1 MINOR                     14-0-0/w STRC(288)   r     1 NI$EXTST
    *0-0-0/w PTR         r     1 PAR                       24-0-0/w PTR         r     1 REQ$
    25-0-0/w BIT         r     1 REQSTATF                  26-0-0/w PTR         r     1 SQH$
    *0-0-0/d STRC(72)    r     1 STATUS

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w BIT         r     1 HW_IMX                     0-0-0/w BIT         r     1 HW_IOP
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/d BIT (72)    r     1 NI_DBLZERO
     0-0-0/w BIT         r     1 OCI_BOOT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:77   
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w STRC(648)   r     1 DQH
     0-0-0/d STRC(576)   r     1 IOSTAT                     0-0-0/d STRC(144)   r     1 MBX
     0-0-0/d STRC(1080)  r     1 REQ                        0-0-0/w STRC(252)   r     1 SQH


   Procedure NIW$POSTER requires 514 words for executable code.
   Procedure NIW$POSTER requires 34 words of local(AUTO) storage.
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:78   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:79   
          MINI XREF LISTING

ALT IN PROCEDURE RETRY
      2871**LABEL    2856--CALLALT
CHANTIME
      2401**DCL      2700<>CALL     2763>>ASSIGN
CODE
      2402**DCL      2767<<ASSIGN   2778<>CALL     2779>>IF       2779<<ASSIGN   2781<<ASSIGN   2800<>CALL
      2801>>IF       2801<<ASSIGN   2803<<ASSIGN   2811>>DOCASE
COMP
      2821**LABEL    2773--GOTO     2774--CALLALT  2792--CALLALT  2797--CALLALT  2808--CALLALT  2813--CALLALT
      2816--CALLALT
COMREJTYC
      2650**DCL      2790>>ASSIGN
DCT
      2456**DCL      2706<>CALL     2740<>CALL     2822<>CALL     2836<>CALL     2846<>CALL     2868<>CALL
DCT.DFLG.MPCSUSPENDED
      2461**DCL      2821<<ASSIGN
DCT.DFLG.RELOAD
      2460**DCL      2773>>IF
DCT.DP
      2476**DCL      2483--REDEF    2486--REDEF    2487--REDEF    2489--REDEF    2489--REDEF    2490--REDEF
      2491--REDEF    2491--REDEF
DCT.DQH$
      2472**DCL      2748>>ASSIGN
DCT.MPC.IOCHANX
      2484**DCL      2484--REDEF
DCT.PM
      2467**DCL      2759<>CALL     2761<>CALL
DCT.SPSTAT
      2468**DCL      2736<<ASSIGN
DCT.SPSTAT.PRESENCE
      2468**DCL      2730>>IF       2741<<ASSIGN
DCT.SQ$
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:80   
      2456**DCL      2758>>IF       2841<>CALL     2863<>CALL
DCT.SQH$
      2471**DCL      2747>>ASSIGN
DCT$
      2403**DCL      2456--IMP-PTR  2680<<ASSIGN   2706>>CALL     2726<<ASSIGN   2730>>IF       2736>>ASSIGN
      2740>>CALL     2741>>ASSIGN   2746<<ASSIGN   2747>>ASSIGN   2748>>ASSIGN   2758>>IF       2759>>CALL
      2761>>CALL     2773>>IF       2821>>ASSIGN   2822>>CALL     2836>>CALL     2841>>CALL     2846>>CALL
      2863>>CALL     2868>>CALL
DQH
      2504**DCL      2667<>CALL     2671<>CALL     2673<>CALL     2712<>CALL     2721<>CALL
DQH.CHANSTATE
      2512**DCL      2701>>IF
DQH.CHANSTATE.STOP
      2512**DCL      2705>>IF
DQH.IO$
      2511**DCL      2679>>ASSIGN
DQH.IOCHANX
      2506**DCL      2507--REDEF
DQH.IOSTATUS$
      2511**DCL      2668>>IF       2671>>CALL     2682>>ASSIGN   2686>>ASSIGN
DQH.MBX$
      2515**DCL      2516--REDEF    2684>>ASSIGN
DQH.MPC$
      2511**DCL      2726>>ASSIGN
DQH.PM
      2508**DCL      2700<>CALL
DQH.SQH$
      2510**DCL      2659>>ASSIGN   2725>>ASSIGN
DQH.STATE
      2508**DCL      2663>>IF       2699<<ASSIGN
DQH.STATUS.DOWN
      2504**DCL      2710>>IF
DQH$
      2404**DCL      2504--IMP-PTR  2658<<ASSIGN   2659>>ASSIGN   2663>>IF       2667>>CALL     2668>>IF
      2671>>CALL     2671>>CALL     2673>>CALL     2679>>ASSIGN   2682>>ASSIGN   2684>>ASSIGN   2686>>ASSIGN
      2699>>ASSIGN   2700>>CALL     2701>>IF       2705>>IF       2710>>IF       2712>>CALL     2720<<ASSIGN
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:81   
      2721>>CALL     2724<<ASSIGN   2725>>ASSIGN   2726>>ASSIGN   2748<<ASSIGN
FLT_ALT
      2803**LABEL    2800--CALLALT
HFC$LOCK
       693**DCL-ENT  2661--CALL     2728--CALL     2838--CALL     2860--CALL
HFC$UNLOCK
       693**DCL-ENT  2675--CALL     2691--CALL     2703--CALL     2716--CALL     2732--CALL     2738--CALL
      2844--CALL     2866--CALL
HW_IMX
       679**DCL      2681>>IF
HW_IOP
       676**DCL      2687>>IF
ILLSTAT
      2807**LABEL    2787--GOTO     2789--GOTO
INTLVL
      2306**DCL         9--PROC     2656>>DOCASE   2667<>CALL     2668>>IF       2671<>CALL     2673<>CALL
      2685>>IF       2721<>CALL
IOM_ALT
      2781**LABEL    2778--CALLALT
IOS.DCW
      2534**DCL      2537--REDEF
IOS.DCW.TALLY
      2535**DCL      2535--REDEF
IOS.IDCW.EXTA
      2537**DCL      2537--REDEF
IOS.PCW
      2539**DCL      2543--REDEF
IOS.SEEK
      2544**DCL      2545--REDEF    2546--REDEF
IOSTAT.AESDCW
      2554**DCL      2554--REDEF
IOSTAT.LPW_RESIDUE
      2552**DCL      2682>>ASSIGN
IOSTAT.STATUS
      2549**DCL      2671<>CALL     2686>>ASSIGN
MBX.DCW.CONTROL.AE
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:82   
      2573**DCL      2573--REDEF
MBX.LPW
      2568**DCL      2684>>ASSIGN
MBX.LPW.CONTROL.AE
      2569**DCL      2569--REDEF
MINOR
      2406**DCL      2784<<ASSIGN   2787>>IF       2789>>IF       2790>>ASSIGN   2791>>IF
N$DCT$$
      1105**DCL      1239--IMP-PTR
N$FQ$
      1105**DCL      1240--IMP-PTR
N$REQ_INIT.BUFADDR
      1124**DCL      1125--REDEF    1125--REDEF
N$REQ_INIT.DLA.DRELADDR
      1116**DCL      1116--REDEF
N$REQ_INIT.DVE.EOMCHAR
      1153**DCL      1154--REDEF
N$REQ_INIT.EAINFO
      1147**DCL      1147--REDEF
N$REQ_INIT.EAINFOX
      1147**DCL      1148--REDEF
N$REQ_INIT.EVNTINFO
      1148**DCL      1148--REDEF
N$REQ_INIT.STATUS
      1129**DCL      1135--REDEF
NI$EXTST
      2412**DCL      2824<>CALL
NI$EXTST.EXTST
      2416**DCL      2418--REDEF    2420--REDEF    2823<<ASSIGN
NI$FQ$
      1165**DCL      1241--IMP-PTR
NI$IBUF$
      1165**DCL      1241--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      1175**DCL      1176--REDEF    1176--REDEF
NI$IMXMBX_INIT.SIZE
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:83   
      1177**DCL      1177--REDEF
NI$REQ_INIT.DCW
      1199**DCL      1202--REDEF
NI$REQ_INIT.DCW.TALLY
      1200**DCL      1200--REDEF
NI$REQ_INIT.IDCW.EXTA
      1202**DCL      1202--REDEF
NI$REQ_INIT.PCW
      1204**DCL      1208--REDEF
NI$REQ_INIT.SEEK
      1209**DCL      1210--REDEF    1211--REDEF
NI$RP$
      1213**DCL      1243--IMP-PTR
NIA$LOGERR
      2378**DCL-ENT  2831--CALL     2853--CALL
NIA$SPURINT
      2379**DCL-ENT  2667--CALL     2671--CALL     2673--CALL     2721--CALL
NIF$ANFAULT
      2380**DCL-ENT  2800--CALL
NIF$ANIOM
      2381**DCL-ENT  2778--CALL
NIK$OPMSG
      2382**DCL-ENT  2836--CALL
NIM$ENQUEUE
      1269**DCL-ENT  2712--CALL
NIM$REQUEUE
      1270**DCL-ENT  2841--CALL     2863--CALL
NIO$COMP
      2383**DCL-ENT  2824--CALL
NIO$SPCOMP
      2384**DCL-ENT  2740--CALL
NIW$DEVSCHED
      2388**DCL-ENT  2822--CALL     2846--CALL     2868--CALL
NIW$MPCSTOP
      2389**DCL-ENT  2706--CALL
NI_DBLZERO
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:84   
      1214**DCL      2673<>CALL     2721<>CALL
NI_MBX_INIT.DCW.CONTROL.AE
      1235**DCL      1235--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      1231**DCL      1231--REDEF
OCI_BOOT
      2397**DCL      2835>>IF
PAR
      2307**DCL         9--PROC     2658--ASSIGN   2720--ASSIGN   2724--ASSIGN   2745--ASSIGN
PMN$COLLECT
      2390**DCL-ENT  2700--CALL     2759--CALL     2761--CALL
REQ
      2585**DCL      2778<>CALL     2800<>CALL     2824<>CALL     2831<>CALL     2836<>CALL     2841<>CALL
      2853<>CALL     2863<>CALL
REQ.BUFADDR
      2594**DCL      2595--REDEF    2595--REDEF
REQ.COMP
      2619**DCL      2762>>IF       2765>>IF
REQ.DCT$
      2586**DCL      2680>>ASSIGN   2746>>ASSIGN
REQ.DLA.DRELADDR
      2586**DCL      2586--REDEF
REQ.DVE.EOMCHAR
      2623**DCL      2624--REDEF
REQ.EAINFO
      2617**DCL      2617--REDEF    2763<<ASSIGN
REQ.EAINFOX
      2617**DCL      2618--REDEF
REQ.ERRCT
      2587**DCL      2832<<ASSIGN   2832>>ASSIGN   2834>>IF       2854<<ASSIGN   2854>>ASSIGN   2855>>IF
REQ.EVNTINFO
      2618**DCL      2618--REDEF
REQ.FC
      2588**DCL      2765>>IF       2769>>ASSIGN
REQ.FLPW
      2606**DCL      2682<<ASSIGN   2684<<ASSIGN
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:85   
REQ.IOFLG.REL
      2590**DCL      2821>>IF
REQ.STATUS
      2599**DCL      2605--REDEF    2686<<ASSIGN   2697<<ASSIGN
REQ.STATUS.IOM
      2602**DCL      2777>>IF
REQ.STATUS.IOM.CHANNEL
      2602**DCL      2688>>IF
REQ.STATUS.MAJOR
      2599**DCL      2688>>IF       2768>>IF       2785>>DOCASE
REQ.STATUS.MINOR
      2600**DCL      2784>>ASSIGN
REQ.STATUS.POWEROFF
      2599**DCL      2771>>IF
REQ.TYC
      2607**DCL      2766<<ASSIGN   2790<<ASSIGN   2790>>ASSIGN
REQ.TYC.IOERR
      2610**DCL      2772<<ASSIGN   2807<<ASSIGN
REQ.TYC.TIMO
      2612**DCL      2796<<ASSIGN
REQ$
      2441**DCL      2585--IMP-PTR  2679<<ASSIGN   2680>>ASSIGN   2682>>ASSIGN   2684>>ASSIGN   2686>>ASSIGN
      2688>>IF       2688>>IF       2697>>ASSIGN   2745<<ASSIGN   2746>>ASSIGN   2762>>IF       2763>>ASSIGN
      2765>>IF       2765>>IF       2766>>ASSIGN   2768>>IF       2769>>ASSIGN   2771>>IF       2772>>ASSIGN
      2777>>IF       2778>>CALL     2784>>ASSIGN   2785>>DOCASE   2790>>ASSIGN   2790>>ASSIGN   2796>>ASSIGN
      2800>>CALL     2807>>ASSIGN   2821>>IF       2824>>CALL     2831>>CALL     2832>>ASSIGN   2832>>ASSIGN
      2834>>IF       2836>>CALL     2841>>CALL     2853>>CALL     2854>>ASSIGN   2854>>ASSIGN   2855>>IF
      2863>>CALL
REQSTATF
      2442**DCL      2769<<ASSIGN   2773>>IF
REQUE
      2829**PROC     2774--CALL     2816--CALL
REQUERETRY IN PROCEDURE REQUE
      2833**ENTRY    2856--CALL
RETRY
      2852**PROC     2792--CALL     2797--CALL     2808--CALL     2813--CALL
PL6.E3A0      #002=NIW$POSTER File=NIW$MPC.:E05TSI                               WED 07/30/97 03:40 Page:86   
SC_NIWBADINTLVL
      2391**DCL-ENT  2750--CALL
SQH.CQ$
      2644**DCL      2712<>CALL
SQH.DOOR
      2643**DCL      2643--REDEF
SQH.GATE
      2643**DCL      2661<>CALL     2675<>CALL     2691<>CALL     2703<>CALL     2716<>CALL     2728<>CALL
      2732<>CALL     2738<>CALL     2838<>CALL     2844<>CALL     2860<>CALL     2866<>CALL
SQH$
      2443**DCL      2643--IMP-PTR  2659<<ASSIGN   2661>>CALL     2675>>CALL     2691>>CALL     2703>>CALL
      2712>>CALL     2716>>CALL     2725<<ASSIGN   2728>>CALL     2732>>CALL     2738>>CALL     2747<<ASSIGN
      2838>>CALL     2844>>CALL     2860>>CALL     2866>>CALL
STATUS
      2313**DCL         9--PROC     2338--REDEF    2354--REDEF    2665--IF       2667<>CALL     2697>>ASSIGN
      2736>>ASSIGN

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:87   
      388        1        /*T***********************************************************/
      389        2        /*T*                                                         */
      390        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      391        4        /*T*                                                         */
      392        5        /*T***********************************************************/
      393        6        /*
      394        7           MPC FIRMWARE LOADER
      395        8        */
      396        9        NIW$LDFW: PROC (PAR,WAIT) ALTRET;
      397       10        /*
      398       11                Includes
      399       12        */
      400       13        %INCLUDE                CP_6_SUBS ;
      401      553        %INCLUDE                B$MAP ;
      402      652        %INCLUDE                B_MLSMAC_C ;
      403     1594        %INCLUDE                B_SEGIDS_C ;
      404     2133        %INCLUDE                B_STRINGS_C ;
      405     2262        %INCLUDE                EL_SUBS_C ;
      406     2346        %INCLUDE                HF_DATA_R ;
      407     2389        %INCLUDE                HF_LOCK_C ;
      408     2403        %INCLUDE                I$DISK ;
      409     2655        %INCLUDE                M_INFO_C ;
      410     2795        %INCLUDE                NI_DATA_C ;
      411     2908        %INCLUDE                NI_DATA_R ;
      412     3345        %INCLUDE                NI_MACROS_C ;
      413     3612        %INCLUDE                N_FC_C ;
      414     3649        %INCLUDE                OC_SUBS_C ;
      415     4380        %INCLUDE                TM_DATA_M ;
      416     4482        /*
      417     4483                Parameters
      418     4484        */
      419     4485    1   DCL 1 PAR               SBIN PARAM ;
      420     4486    1   DCL 1 WAIT              BIT(1) ALIGNED PARAM ;
      421     4487        /*
      422     4488                Entries
      423     4489        */
      424     4490    1   DCL 1 MMB$FPP           ENTRY(1) ALTRET ;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:88   
      425     4491    1   DCL 1 MMB$GPP           ENTRY(2) ALTRET ;
      426     4492    1   DCL 1 MME$CVM           ENTRY(4) ALTRET ;
      427     4493    1   DCL 1 NIA$FWLOAD        ENTRY(2) ;
      428     4494    1   DCL 1 NIO$QUE           ENTRY(1) ALTRET ;
      429     4495    1   DCL 1 NIQ$GET           ENTRY(1) ALTRET ;
      430     4496    1   DCL 1 NIQ$GETS          ENTRY(1) ALTRET ;
      431     4497    1   DCL 1 NIQ$REL           ENTRY(1) ALTRET ;
      432     4498    1   DCL 1 NIQ$RELS          ENTRY(1) ALTRET ;
      433     4499    1   DCL 1 NIS$MASK          ENTRY(2) ;
      434     4500    1   DCL 1 NIW$MPCSTART      ENTRY(1) ;
      435     4501    1   DCL 1 NIW$MPCSTOP       ENTRY(1) ;
      436     4502    1   DCL 1 NIW$LDFWEA        ENTRY(1) ;
      437     4503    1   DCL 1 OCI$MK_STTM       ENTRY(1) ;
      438     4504    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
      439     4505    1   DCL 1 OCI$MK_WRTM       ENTRY(8) ;
      440     4506    1   DCL 1 SSS$BLOCKM        ENTRY ;
      441     4507    1   DCL 1 TMB$BUF_ALLOC     ENTRY(3) ALTRET ;
      442     4508    1   DCL 1 TMB$MCA           ENTRY(4) ALTRET ;
      443     4509    1   DCL 1 TMB$BUF_DEALLOC   ENTRY(2) ALTRET ;
      444     4510        /*
      445     4511                Symrefs
      446     4512        */
      447     4513    1   DCL 1 B$FIRM$           PTR SYMREF ;
      448     4514    1   DCL 1 B$LS$             PTR SYMREF ;
      449     4515    1   DCL 1 B$MPT$            PTR SYMREF ;
      450     4516    1   DCL 1 IT_CP6UP          UBIN WORD SYMREF ;
      451     4517        %NI$PARTITION           ( NAME=IT_PARTITION, STCLASS=SYMREF ) ;
      452     4525    1   DCL 1 IT_SYSDIR$        PTR SYMREF ;
      453     4526    1   DCL 1 IT_SYSDISK        SBIN SYMREF ;
      454     4527        /*
      455     4528                Auto
      456     4529        */
      457     4530    1   DCL 1 BUFX              SBIN ALIGNED AUTO ;
      458     4531    1   DCL 1 CRPX              SBIN ALIGNED AUTO ;
      459     4532    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      460     4533    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
      461     4534    1   DCL 1 ERRWD             SBIN ALIGNED AUTO ;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:89   
      462     4535    1   DCL 1 FW$               PTR ALIGNED AUTO ;
      463     4536    1   DCL 1 FWX               SBIN ALIGNED AUTO ;
      464     4537    1   DCL 1 I                 SBIN ALIGNED AUTO ;
      465     4538    1   DCL 1 IOS$              PTR ALIGNED AUTO ;
      466     4539    1   DCL 1 IPC_TBL(0:3)      ALIGNED AUTO,
      467     4540    1         2 DQH$            PTR ALIGNED;
      468     4541    1   DCL 1 J                 SBIN ALIGNED AUTO ;
      469     4542    1   DCL 1 LPX               SBIN ALIGNED AUTO ;
      470     4543    1   DCL 1 OCI$MSG           EPTR ALIGNED AUTO ;
      471     4544    1   DCL 1 PPNO              SBIN ALIGNED AUTO ;
      472     4545    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
      473     4546    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      474     4547    1   DCL 1 VPNO              SBIN ALIGNED AUTO ;
      475     4548    1   DCL 1 WAITTIME          SBIN ALIGNED AUTO ;
      476     4549        /*
      477     4550                Based
      478     4551        */
      479     4552        %B_MLS                  ( FPTN=B$MLNK, STCLASS=BASED ) ;
      480     5367        %NI$CHT ;
      481     5370        %NI$DCT                 ( NAME=DCT,    STCLASS="BASED(DCT$)" ) ;
      482     5418        %NI$DQH                 ( NAME=DQH,    STCLASS="BASED(DQH$)" ) ;
      483     5441        %NI$FW                  ( NAME=FW,     STCLASS="BASED(FW$)" ) ;
      484     5447    1   DCL 1 LDFW              BASED ALIGNED,  /* REQ.EAINFO AND REQ.EAINFOX */
      485     5448    1         2 STATE           UBIN(18) UNAL, /* STATE OF F/W LOADING:
      486     5449                                                    0 READING SYSVOL VID
      487     5450                                                    1 READING SYSDIR
      488     5451                                                    2 READING F/W
      489     5452                                                    3 READING LP F/W
      490     5453                                                    4 READING CRP F/W
      491     5454                                                    5 WRITING CSO
      492     5455                                                    6 WRITING MMO
      493     5456                                                    7 WRITING LP F/W
      494     5457                                                    8 WRITING CRP F/W
      495     5458                                                    9 ENTERING F/W (UR ONLY) */
      496     5459    1         2 SEGSIZE         UBIN(18) UNAL,  /* SIZE OF FIRM */
      497     5460    1         2 CALLIOQ         BIT(1),    /* CALL IOQ AFTER SETTING UP THE WRITE CSO */
      498     5461    1         2 * BIT(2),
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:90   
      499     5462    1         2 DCTX            UBIN(15) UNAL,  /* MPC DCTX */
      500     5463    1         2 OLSIZE          UBIN(18) UNAL;  /* (REMAINING) SIZE OF F/W OVERLAY */
      501     5464        %NI$SQH                 ( NAME=SQH,    STCLASS="BASED(SQH$)" ) ;
      502     5477        %N$REQ                  ( NAME=REQ,    STCLASS="BASED(REQ$)" ) ;
      503     5535        /*
      504     5536                Constants
      505     5537        */
      506     5538        %SUB LDFW="ADDR(REQ.EAINFO)->LDFW";
      507     5539        /**/
      508     5540        %EQU FWPGS=16;
      509     5541        %SUB NEVER="WHILE('0'B)";
      510     5542        %SUB FOREVER="WHILE('1'B)";
      511     5543        /**/
      512     5544        %EJECT;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:91   
      513     5545        /* START OF PROCEDURE
      514     5546        */
      515     5547    1           DCT$=ADDR(PAR);
      516     5548                /*  Don't load firmware for the IOP or EURC controllers.
      517     5549                */
      518     5550    2           IF NOT HW_LOAD_FW OR DCT.MPC.FWNAME='NONE' THEN DO;
      519     5551    2              CALL NIW$MPCSTART (DCT);
      520     5552    2              RETURN;
      521     5553    2              END;
      522     5554                                                /**/
      523     5555    1           IF DCT.TYPE~=%DV_MPC THEN RETURN ;
      524     5556    1           IF DCT.MPC.ALTMPCX~=0 THEN
      525     5557    1              IF NOT N$DCT$(DCT.MPC.ALTMPCX)->DCT.STATUS.DOWN AND DCT.MPC.TYPE~=%DV_LP
              5557                       THEN
      526     5558    1                 DCT$=N$DCT$(DCT.MPC.ALTMPCX);
      527     5559    1           SQH$=DCT.SQH$;
      528     5560                %LOCK(G#=SQH.GATE);
      529     5563    2           IF DCT.DFLG.MPCBUSY THEN DO;
      530     5564                   %UNLOCK(G#=SQH.GATE);
      531     5567    2              ALTRETURN;
      532     5568    2              END;
      533     5569    1           IF DCT.STATUS.TND ~= 0 THEN GOTO T@DHASMPC ;
      534     5570    2   PATH:   DO FOREVER ;
      535     5571    3              DO I = 0 TO %N_CHANSPERMPC-1 ;
      536     5572    3                 DQH$ = NI$CHT.DQH$(DCT.MPC.IOCHANX(I)) ;
      537     5573    3                 IF DQH$ ~= ADDR(NIL) THEN
      538     5574    3                    IF NOT DQH.STATUS.DOWN AND
      539     5575    3                      ( IT_CP6UP ~= 0 OR
      540     5576    4                      NOT IT_PARTITION.IOCHAN(DQH.IOCHANX) ) THEN DO ;
      541     5577    4                       DCT.DQH$ = DQH$ ;
      542     5578    4                       EXIT PATH ;
      543     5579    4                       END ;
      544     5580    3                 END ;
      545     5581    2              GOTO T@DHASMPC ;
      546     5582    2              END ;
      547     5583    1           DCT.DFLG.MPCBUSY='1'B;
      548     5584                %UNLOCK(G#=SQH.GATE);
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:92   
      549     5587    1           CALL SSS$BLOCKM;
      550     5588    2           IF HW_IMX AND (DCT.CTYP=%C_IPC) THEN DO;
      551     5589    2              DCT.DFLG.MPCSTOP = '0'B;
      552     5590    2              DCT.DFLG.RELOAD = '1'B;
      553     5591    2              DCT.MPC.REQ$ = ADDR(NIL);
      554     5592    2              END;
      555     5593    2           ELSE DO;
      556     5594    2              CALL NIQ$GET(REQ$) ALTRET(NOQPKT);
      557     5595    2              REQ.OPFLG=OP_EA;
      558     5596    2              REQ.OPFLG.HOLD=WAIT;
      559     5597    2              REQ.EAENTRY=ENTADDR(NIW$LDFWEA);
      560     5598    2              DCT.MPC.REQ$=REQ$;
      561     5599    2              LDFW.DCTX=DCT.DCTX;
      562     5600    2              DCT.DFLG.RELOAD='0'B;
      563     5601    2              END;
      564     5602    1           CALL NIW$MPCSTOP(DCT);          /* DON'T USE THIS MPC UNTIL DONE */
      565     5603    1           IF HW_IMX AND (DCT.CTYP=%C_IPC) THEN
      566     5604    1              RETURN;
      567     5605    2           IF DCT.MPC.ALTMPCX~=0 THEN DO;
      568     5606    2              CALL NIW$MPCSTOP(N$DCT$(DCT.MPC.ALTMPCX)->DCT);
      569     5607    3              DO WHILE(NOT N$DCT$(DCT.MPC.ALTMPCX)->DCT.DFLG.MPCSTOP);
      570     5608    3                 END;
      571     5609    2              END;
      572     5610    2           IF DCT.MPC.FW$=ADDR(NIL) THEN DO;
      573     5611    2              DCT.MPC.FW$=B$FIRM$;
      574     5612    2              FW$=B$FIRM$;
      575     5613    2              CALL GETFWX(0,FWX,DCT.MPC.FWNAME) ALTRET(NOFW);
      576     5614                   %LOCK(G#=NI_FWGATE);
      577     5617    2              IF B$LS$->B$MLNK.FIRM.FLGS&%DSNULL THEN GOTO MEMBUSY;
      578     5618    2              B$LS$->B$MLNK.FIRM.BOUND=%(%FWPGS*1024*4-1);
      579     5619    2              B$LS$->B$MLNK.FIRM.FLGS=B$LS$->B$MLNK.FIRM.FLGS|%DSNULL;
      580     5620                   %UNLOCK(G#=NI_FWGATE);
      581     5623    3              IF NOT IT_SYSDIR$->I$DISKDIR.FW.INMEM(FWX) THEN DO;
      582     5624                                                /* INMEM='0'B IF FW IN MEMORY */
      583     5625    3                 PPNO=IT_SYSDIR$->I$DISKDIR.FW.BASE(FWX)/1024;
      584     5626    4                 DO VPNO=%FIRMWREPG TO %FIRMWREPG+%(%FWPGS-1);
      585     5627    4                    CALL MME$CVM(%MONWSQ,VPNO,PPNO,ERRWD) ALTRET(NOMEM);
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:93   
      586     5628    4                    PPNO=PPNO+1;
      587     5629    4                    END;
      588     5630    3                 FW.FWOL(0)=IT_SYSDIR$->I$DISKDIR.FW.CS0SIZE(FWX);
      589     5631    3                 FW.FWOL(1)=IT_SYSDIR$->I$DISKDIR.FW.MM0SIZE(FWX);
      590     5632    3                 FW.FWOL(2)=0;
      591     5633    3                 FW.FWOL(3)=0;
      592     5634    3                 LDFW.SEGSIZE=0;           /* INDICATE FIRMWARE FROM MEMORY */
      593     5635    3                 END;
      594     5636    3              ELSE DO;
      595     5637    3                 LDFW.SEGSIZE=%FWPGS*1024;
      596     5638    4                 DO VPNO=%FIRMWREPG TO %FIRMWREPG+%(%FWPGS-1);
      597     5639    4                    CALL MMB$GPP(PPNO,%MONWSQ);
      598     5640    4                    IF PPNO~=0 THEN
      599     5641    4                       CALL MME$CVM(%MONWSQ,VPNO,PPNO,ERRWD) ALTRET(CVMERR);
      600     5642    4                    ELSE GOTO NOMEM;
      601     5643    4                    END;
      602     5644    3                 FW='0'B;
      603     5645    3                 FW.FWDA=IT_SYSDIR$->I$DISKDIR.FW.DA(FWX);
      604     5646    3                 FW.FWOL(0)=IT_SYSDIR$->I$DISKDIR.FW.CS0SIZE(FWX);
      605     5647    3                 FW.FWOL(1)=IT_SYSDIR$->I$DISKDIR.FW.MM0SIZE(FWX);
      606     5648    4                 IF DCT.MPC.LPCHANS THEN DO;
      607     5649    4                    CALL GETFWX(0,LPX,DCT.MPC.LPNAME) ALTRET(NOMEM);
      608     5650    4                    FW.LPDA=IT_SYSDIR$->I$DISKDIR.FW.DA(LPX);
      609     5651    4                    FW.FWOL(2)=IT_SYSDIR$->I$DISKDIR.FW.CS0SIZE(LPX);
      610     5652    4                    END;
      611     5653    4                 IF DCT.MPC.CRPCHANS THEN DO;
      612     5654    4                    CALL GETFWX(0,CRPX,DCT.MPC.CRPNAME) ALTRET(NOMEM);
      613     5655    4                    FW.CRPDA=IT_SYSDIR$->I$DISKDIR.FW.DA(CRPX);
      614     5656    4                    FW.FWOL(3)=IT_SYSDIR$->I$DISKDIR.FW.CS0SIZE(CRPX);
      615     5657    4                    END;
      616     5658    3                 REQ.FC=%N_RDBIN;
      617     5659    3                 REQ.DLA.DCTX=IT_SYSDISK;
      618     5660    3                 REQ.DLA.DRELADDR=FW.FWDA;
      619     5661    3                 REQ.BUF$=ADDR(FW.FW);
      620     5662    3                 REQ.OPFLG.BPF='1'B;
      621     5663    3                 REQ.BUFSIZE=(FW.FWOL(0)+FW.FWOL(1))*4;
      622     5664    3                 LDFW.STATE=2;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:94   
      623     5665    3                 GOTO CALLIOQ;
      624     5666    3                 END;
      625     5667    2              END;
      626     5668    1           LDFW.STATE=5;
      627     5669    1           LDFW.CALLIOQ='1'B;
      628     5670    1           GOTO LDFW1;
      629     5671        /*
      630     5672           ENTER HERE AFTER F/W IS IN MEMORY (WAIT='0'B)
      631     5673        */
      632     5674    1   NIW$LDFWS: ENTRY(PAR,WAIT) ALTRET;
      633     5675    1           DCT$=ADDR(PAR);
      634     5676    1           REQ$=DCT.MPC.REQ$;
      635     5677    1           LDFW.CALLIOQ='0'B;
      636     5678    1   LDFW1:
      637     5679    1           REQ.DLA.DCTX=DCT.DCTX;
      638     5680    1           FW$=DCT.MPC.FW$;
      639     5681    1           REQ.BUFSIZE=%(%FWPGS*4096)-POFFC(ADDR(FW.IDCW),FW$);
      640     5682    1           REQ.FC=%N_DCWLIST;
      641     5683    1           REQ.BUF$=ADDR(FW.IDCW);
      642     5684    1           REQ.OPFLG.BPF='1'B;
      643     5685    1           DCT.DFLG.RELOAD='1'B;
      644     5686    1           DCT.DFLG.MPCSTOP='0'B;          /* MAKE SURE MPCSTOP DOES SOMETHING */
      645     5687    1           CALL NIW$MPCSTOP(DCT);
      646     5688    1           GOTO LDFW2;
      647     5689        /**/
      648     5690        /* ENTER HERE FROM NIW$MPCSTOP WHEN MPC IS STOPPED AND RELOAD BIT SET */
      649     5691        /**/
      650     5692    1   NIW$LDFWR: ENTRY(PAR,WAIT) ALTRET;
      651     5693    1           DCT$=ADDR(PAR);
      652     5694    1           REQ$=DCT.MPC.REQ$;
      653     5695    1           IF REQ$~=ADDR(NIL) THEN /* IMX (CTYP = IPC) WON'T HAVE A REQ PACKET */
      654     5696    1              REQ.DQH$=DCT.DQH$;
      655     5697    1           FW$=DCT.MPC.FW$;
      656     5698    1           SQH$=DCT.SQH$;
      657     5699    2           IF DCT.DFLG.MPCSTOP THEN DO;
      658     5700    2              IF HW_IMX THEN
      659     5701    3                 IF DCT.CTYP=%C_IPC THEN DO; /* FW LOADED BY MCA */
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:95   
      660     5702    4                    IF IT_CP6UP~=0 THEN DO;
      661     5703    5                       DO I = 0 TO 3;
      662     5704    5                          IPC_TBL.DQH$(I) = ADDR(NIL);
      663     5705    5                          END;
      664     5706    5                       CALL TMB$BUF_ALLOC (IOS$,BUFX) WHENRETURN DO;
      665     5707    6   RLOADIPC:              DO I = 0 TO %N_CHANSPERMPC-1;
      666     5708    6                             DQH$ = NI$CHT.DQH$(DCT.MPC.IOCHANX(I));
      667     5709    7                             IF DQH$~=ADDR(NIL) THEN DO;
      668     5710    7                                IF NOT DQH.STATUS.DOWN AND
      669     5711    8                                  IPC_TBL.DQH$(DQH.LA)=ADDR(NIL) THEN DO;
      670     5712    8                                   IPC_TBL.DQH$(DQH.LA) = DQH$;
      671     5713    8                                   CALL TMB$MCA (DQH, TM_OC_LOADFW#,BUFX)
      672     5714    9                                   WHENRETURN DO ;
      673     5715    9                                      DCT.DFLG.RELOAD = '0'B ;
      674     5716         /*N* This is a 10sec wait on DPS 8000/81.  But IPC-IPI need 1-2 minute wait. */
      675     5717    9                                      WAITTIME = 13000000 ;
      676     5718   10                                      DO  J = 0 TO WAITTIME ;
      677     5719   10                                         END ;
      678     5720    9                                      END ;
      679     5721    9                                   WHENALTRETURN DO ;
      680     5722    9                                      DCT.DFLG.RELOAD = '1'B ;
      681     5723    9                                      EXIT RLOADIPC ;
      682     5724    9                                      END ;
      683     5725    8                                   END;
      684     5726    7                                END;
      685     5727    6                             END;
      686     5728    5                          CALL TMB$BUF_DEALLOC (IOS$,BUFX);
      687     5729    5                          END;
      688     5730    4                       IF DCT.MSG# ~= 0 THEN
      689     5731    4                          CALL OCI$MK_STTM ( DCT.MSG# ) ;
      690     5732    4                       IF DCT.DFLG.RELOAD THEN
      691     5733    4                          OCI$MSG = ENTADDR ( OCI$MK_WRTM ) ;
      692     5734    4                       ELSE
      693     5735    4                          OCI$MSG = ENTADDR ( OCI$MK_WR ) ;
      694     5736    4                       CALL OCI$MSG ( M_DEVC, FWL_MSG#, 1, '001'O,
      695     5737    4                         BINBIT(BITBIN(DCT.DFLG.RELOAD),9),
      696     5738    4                         BINBIT(DCT.DCTX,36), /* WSN */,
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:96   
      697     5739    4                         DCT.MSG# ) ;
      698     5740    4                       CALL NIA$FWLOAD(DCT,EL_FWLOAD);
      699     5741    4                       END;
      700     5742    4                    ELSE DO;               /* still booting - don't load IPCs */
      701     5743    4                       DCT.DFLG.RELOAD = '0'B;
      702     5744    4                       END;
      703     5745    3                    IF NOT DCT.DFLG.RELOAD THEN
      704     5746    3                       CALL NIW$MPCSTART (DCT);
      705     5747    3                    DCT.DFLG.RELOAD = '0'B;
      706     5748    3                    DCT.DFLG.MPCBUSY = '0'B;
      707     5749    3                    DCT.DFLG.MPCSUSPENDED = '0'B;
      708     5750    3                    RETURN;
      709     5751    3                    END;
      710     5752    3                 ELSE DO;
      711     5753    3                    CALL NIQ$GETS(IOS$) ALTRET(NOFW);
      712     5754    3                    DCT.DQH$->DQH.MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);
      713     5755    3                    CALL NIS$MASK(DCT.DQH$->DQH,%IMX_CCW_RSO);
      714     5756    3                    CALL NIQ$RELS(IOS$);
      715     5757    3                    END;
      716     5758    3              ELSE DO;
      717     5759    4                 IF NOT REQ.IOFLG.IOS THEN DO;
      718     5760    4                    CALL NIQ$GETS(REQ.IOS$) ALTRET (NOFW);
      719     5761    4                    REQ.IOFLG.IOS = '1'B;
      720     5762    4                    END;
      721     5763    3                 DCT.DQH$->DQH.IO$ = REQ$;
      722     5764    3                 CALL NIS$MASK(DCT.DQH$->DQH,%IMX_CCW_RSO);
      723     5765    3                 END;
      724     5766    2              IF HW_IMX THEN
      725     5767    2                 WAITTIME=13000000;   /* This is approx 10 seconds on the 8000 */
      726     5768    2              ELSE IF DCT.MPC.FWNAME = 'MSP8' THEN
      727     5769    2                    WAITTIME=4000000;
      728     5770    2                 ELSE
      729     5771    2                    WAITTIME=10000;
      730     5772    3              DO I=1 TO WAITTIME;          /* WAIT A WHILE */
      731     5773    3                 END;
      732     5774    2              FW.IDCW='100000700000'O;     /* "CONTROL STORE OVERLAY" IDCW */
      733     5775    2              FW.DCW='0'B;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:97   
      734     5776    2              I=0;
      735     5777    3              DO WHILE(FW.FWOL(0)>I);
      736     5778    3                 FW.DCW.FWA(I/%DCWTALLYMAX)=POFFW(ADDR(FW.FW),REQ.BUF$)+I;
      737     5779    4                 IF FW.FWOL(0)-I<=%DCWTALLYMAX THEN DO;
      738     5780    4                    FW.DCW.TYPE(I/%DCWTALLYMAX)=%DCW_IOTD;
      739     5781    4                    FW.DCW.TALLY(I/%DCWTALLYMAX)=FW.FWOL(0)-I;
      740     5782    4                    END;
      741     5783    4                 ELSE DO;
      742     5784    4                    FW.DCW.TYPE(I/%DCWTALLYMAX)=%DCW_IOTP;
      743     5785    4                    FW.DCW.TALLY(I/%DCWTALLYMAX)=0;
      744     5786    4                    END;
      745     5787    3                 I=I+%DCWTALLYMAX;
      746     5788    3                 END;
      747     5789    3              IF LDFW.CALLIOQ THEN DO;
      748     5790    3   CALLIOQ:
      749     5791    3                 CALL NIO$QUE(REQ) ALTRET(NOQPKTS);
      750     5792    3                 END;
      751     5793    2              END/* IF STOPPED */;
      752     5794    2           ELSE IF NOT LDFW.CALLIOQ THEN DO;
      753     5795    2                 LDFW.CALLIOQ='1'B;
      754     5796    2                 ALTRETURN;
      755     5797    2                 END;
      756     5798    2   LDFW2:  IF WAIT THEN DO;
      757     5799    3              DO WHILE (DCT.DFLG.MPCBUSY);
      758     5800    3                 I=1;
      759     5801    3                 END;
      760     5802    3              IF REQ.TYC~=%TYC_EGV THEN DO;
      761     5803    3                 REQ.IOQFLG.IOQUED = '0'B ;
      762     5804    3                 CALL NIQ$REL(REQ$);
      763     5805    3                 ALTRETURN;
      764     5806    3                 END/* IF REQ.TYC */;
      765     5807    2              REQ.IOQFLG.IOQUED = '0'B ;
      766     5808    2              CALL NIQ$REL(REQ$);
      767     5809    2              END/* IF WAIT */;
      768     5810    1           RETURN;
      769     5811        /**/
      770     5812    1   NOQPKTS: ;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:98   
      771     5813    2           IF DCT.MPC.FW$=B$FIRM$ THEN DO;
      772     5814    2              VPNO=%FIRMWREPG+8;
      773     5815    3              DO NEVER;
      774     5816    3   CVMERR:
      775     5817    3                 CALL MMB$FPP(PPNO);
      776     5818    3                 END/* WHILE '0'B */;
      777     5819    2   NOMEM:
      778     5820    3              DO I=%FIRMWREPG TO VPNO-1;
      779     5821    3                 PPNO=B$MPT$->B$MAP.RPN(I);
      780     5822    3                 CALL MME$CVM(%MONWSQ,I,-1,ERRWD);
      781     5823    3                 IF LDFW.SEGSIZE~=0 THEN CALL MMB$FPP(PPNO);
      782     5824    3                 END;
      783     5825                   %LOCK(G#=NI_FWGATE);
      784     5828    2              B$LS$->B$MLNK.FIRM.FLGS=B$LS$->B$MLNK.FIRM.FLGS&~%DSNULL;
      785     5829    2   MEMBUSY:
      786     5830                   %UNLOCK(G#=NI_FWGATE);
      787     5833    2              DCT.MPC.FW$=ADDR(NIL);
      788     5834    2              END/* IF LDFW.SEGSIZE */;
      789     5835    1   NOFW:
      790     5836    1           REQ.IOQFLG.IOQUED = '0'B ;
      791     5837    1           CALL NIQ$REL(REQ$);
      792     5838    1   NOQPKT:
      793     5839    1           SQH$=DCT.SQH$;
      794     5840                %LOCK(G#=SQH.GATE);
      795     5843    1           DCT.DFLG.MPCBUSY='0'B;
      796     5844    1   T@DHASMPC:
      797     5845                %UNLOCK(G#=SQH.GATE);
      798     5848    1           CALL OCI$MK_WR(M_DEVC,FWL_MSG#,1,'001'O,'001'O,BINBIT(DCT.DCTX,36));
      799     5849    1           ALTRETURN;
      800     5850        %EJECT;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:99   
      801     5851    1   GETFWX: PROC(START,FX,FNAME) ALTRET;
      802     5852    2   DCL START UBIN;
      803     5853    2   DCL FX UBIN;
      804     5854    2   DCL FNAME CHAR(4);
      805     5855    2   DCL I UBIN;
      806     5856        /**/
      807     5857    3           DO I=START TO 19;
      808     5858    4              IF FNAME=IT_SYSDIR$->I$DISKDIR.FW.NAME(I) THEN DO;
      809     5859    4                 FX=I;
      810     5860    4                 RETURN;
      811     5861    4                 END;
      812     5862    3              END;
      813     5863    2           ALTRETURN;
      814     5864    2   END GETFWX;
      815     5865    1   END NIW$LDFW;
      816     5866        %EOD;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:100  
--  Include file information  --

   TM_DATA_M.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   I$DISK.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure NIW$LDFW.

   Procedure NIW$LDFW requires 962 words for executable code.
   Procedure NIW$LDFW requires 48 words of local(AUTO) storage.

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:101  

 Object Unit name= NIW$LDFW                                   File name= NIW$MPC.:E05TOU
 UTS= JUL 30 '97 03:41:32.24 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      4      4  NIW$LDFW
    1   Proc  even  none   962   1702  NIW$LDFW
    2  RoData even  none    26     32  NIW$LDFW

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  NIW$LDFW
     1    624          yes     yes      Std        2  NIW$LDFWS
     1    710          yes     yes      Std        2  NIW$LDFWR
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:102  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 NIW$MPCSTART
         yes           Std       1 HFC$UNLOCK
         yes           Std       8 OCI$MK_WRTM
 yes     yes           Std       1 NIO$QUE
         yes           Std       2 NIS$MASK
 yes     yes           Std       1 NIQ$GET
         yes           Std       1 NIW$LDFWEA
 yes     yes           Std       1 NIQ$RELS
         yes           Std       1 NIW$MPCSTOP
 yes     yes           Std       4 MME$CVM
 yes     yes           Std       4 TMB$MCA
         yes           Std       2 NIA$FWLOAD
 yes     yes           Std       1 NIQ$REL
 yes     yes           Std       2 MMB$GPP
 yes     yes           Std       2 TMB$BUF_DEALLOC
         yes           Std       1 OCI$MK_STTM
         yes           Std       7 OCI$MK_WR
         yes           Std       1 HFC$LOCK
         yes           Std       0 SSS$BLOCKM
 yes     yes           Std       3 TMB$BUF_ALLOC
 yes     yes           Std       1 NIQ$GETS
 yes     yes           Std       1 MMB$FPP
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:103  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     HW_LOAD_FW                            HW_IMX                                N$DCT$$
     N$FQ$                                 NI$CHT$                               NI$FQ$
     NI$IBUF$                              NI$RP$                                NI_FWGATE
     B$FIRM$                               B$LS$                                 B$MPT$
     IT_CP6UP                              IT_PARTITION                          IT_SYSDIR$
     IT_SYSDISK                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:104  


      388        1        /*T***********************************************************/
      389        2        /*T*                                                         */
      390        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      391        4        /*T*                                                         */
      392        5        /*T***********************************************************/
      393        6        /*
      394        7           MPC FIRMWARE LOADER
      395        8        */
      396        9        NIW$LDFW: PROC (PAR,WAIT) ALTRET;

      9  1 000000   000000 700200 xent  NIW$LDFW     TSX0  ! X66_AUTO_2
         1 000001   000060 000002                    ZERO    48,2

      397       10        /*
      398       11                Includes
      399       12        */
      400       13        %INCLUDE                CP_6_SUBS ;
      401      553        %INCLUDE                B$MAP ;
      402      652        %INCLUDE                B_MLSMAC_C ;
      403     1594        %INCLUDE                B_SEGIDS_C ;
      404     2133        %INCLUDE                B_STRINGS_C ;
      405     2262        %INCLUDE                EL_SUBS_C ;
      406     2346        %INCLUDE                HF_DATA_R ;
      407     2389        %INCLUDE                HF_LOCK_C ;
      408     2403        %INCLUDE                I$DISK ;
      409     2655        %INCLUDE                M_INFO_C ;
      410     2795        %INCLUDE                NI_DATA_C ;
      411     2908        %INCLUDE                NI_DATA_R ;
      412     3345        %INCLUDE                NI_MACROS_C ;
      413     3612        %INCLUDE                N_FC_C ;
      414     3649        %INCLUDE                OC_SUBS_C ;
      415     4380        %INCLUDE                TM_DATA_M ;
      416     4482        /*
      417     4483                Parameters
      418     4484        */
      419     4485    1   DCL 1 PAR               SBIN PARAM ;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:105  
      420     4486    1   DCL 1 WAIT              BIT(1) ALIGNED PARAM ;
      421     4487        /*
      422     4488                Entries
      423     4489        */
      424     4490    1   DCL 1 MMB$FPP           ENTRY(1) ALTRET ;
      425     4491    1   DCL 1 MMB$GPP           ENTRY(2) ALTRET ;
      426     4492    1   DCL 1 MME$CVM           ENTRY(4) ALTRET ;
      427     4493    1   DCL 1 NIA$FWLOAD        ENTRY(2) ;
      428     4494    1   DCL 1 NIO$QUE           ENTRY(1) ALTRET ;
      429     4495    1   DCL 1 NIQ$GET           ENTRY(1) ALTRET ;
      430     4496    1   DCL 1 NIQ$GETS          ENTRY(1) ALTRET ;
      431     4497    1   DCL 1 NIQ$REL           ENTRY(1) ALTRET ;
      432     4498    1   DCL 1 NIQ$RELS          ENTRY(1) ALTRET ;
      433     4499    1   DCL 1 NIS$MASK          ENTRY(2) ;
      434     4500    1   DCL 1 NIW$MPCSTART      ENTRY(1) ;
      435     4501    1   DCL 1 NIW$MPCSTOP       ENTRY(1) ;
      436     4502    1   DCL 1 NIW$LDFWEA        ENTRY(1) ;
      437     4503    1   DCL 1 OCI$MK_STTM       ENTRY(1) ;
      438     4504    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
      439     4505    1   DCL 1 OCI$MK_WRTM       ENTRY(8) ;
      440     4506    1   DCL 1 SSS$BLOCKM        ENTRY ;
      441     4507    1   DCL 1 TMB$BUF_ALLOC     ENTRY(3) ALTRET ;
      442     4508    1   DCL 1 TMB$MCA           ENTRY(4) ALTRET ;
      443     4509    1   DCL 1 TMB$BUF_DEALLOC   ENTRY(2) ALTRET ;
      444     4510        /*
      445     4511                Symrefs
      446     4512        */
      447     4513    1   DCL 1 B$FIRM$           PTR SYMREF ;
      448     4514    1   DCL 1 B$LS$             PTR SYMREF ;
      449     4515    1   DCL 1 B$MPT$            PTR SYMREF ;
      450     4516    1   DCL 1 IT_CP6UP          UBIN WORD SYMREF ;
      451     4517        %NI$PARTITION           ( NAME=IT_PARTITION, STCLASS=SYMREF ) ;
      452     4525    1   DCL 1 IT_SYSDIR$        PTR SYMREF ;
      453     4526    1   DCL 1 IT_SYSDISK        SBIN SYMREF ;
      454     4527        /*
      455     4528                Auto
      456     4529        */
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:106  
      457     4530    1   DCL 1 BUFX              SBIN ALIGNED AUTO ;
      458     4531    1   DCL 1 CRPX              SBIN ALIGNED AUTO ;
      459     4532    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      460     4533    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
      461     4534    1   DCL 1 ERRWD             SBIN ALIGNED AUTO ;
      462     4535    1   DCL 1 FW$               PTR ALIGNED AUTO ;
      463     4536    1   DCL 1 FWX               SBIN ALIGNED AUTO ;
      464     4537    1   DCL 1 I                 SBIN ALIGNED AUTO ;
      465     4538    1   DCL 1 IOS$              PTR ALIGNED AUTO ;
      466     4539    1   DCL 1 IPC_TBL(0:3)      ALIGNED AUTO,
      467     4540    1         2 DQH$            PTR ALIGNED;
      468     4541    1   DCL 1 J                 SBIN ALIGNED AUTO ;
      469     4542    1   DCL 1 LPX               SBIN ALIGNED AUTO ;
      470     4543    1   DCL 1 OCI$MSG           EPTR ALIGNED AUTO ;
      471     4544    1   DCL 1 PPNO              SBIN ALIGNED AUTO ;
      472     4545    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
      473     4546    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      474     4547    1   DCL 1 VPNO              SBIN ALIGNED AUTO ;
      475     4548    1   DCL 1 WAITTIME          SBIN ALIGNED AUTO ;
      476     4549        /*
      477     4550                Based
      478     4551        */
      479     4552        %B_MLS                  ( FPTN=B$MLNK, STCLASS=BASED ) ;
      480     5367        %NI$CHT ;
      481     5370        %NI$DCT                 ( NAME=DCT,    STCLASS="BASED(DCT$)" ) ;
      482     5418        %NI$DQH                 ( NAME=DQH,    STCLASS="BASED(DQH$)" ) ;
      483     5441        %NI$FW                  ( NAME=FW,     STCLASS="BASED(FW$)" ) ;
      484     5447    1   DCL 1 LDFW              BASED ALIGNED,  /* REQ.EAINFO AND REQ.EAINFOX */
      485     5448    1         2 STATE           UBIN(18) UNAL, /* STATE OF F/W LOADING:
      486     5449                                                    0 READING SYSVOL VID
      487     5450                                                    1 READING SYSDIR
      488     5451                                                    2 READING F/W
      489     5452                                                    3 READING LP F/W
      490     5453                                                    4 READING CRP F/W
      491     5454                                                    5 WRITING CSO
      492     5455                                                    6 WRITING MMO
      493     5456                                                    7 WRITING LP F/W
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:107  
      494     5457                                                    8 WRITING CRP F/W
      495     5458                                                    9 ENTERING F/W (UR ONLY) */
      496     5459    1         2 SEGSIZE         UBIN(18) UNAL,  /* SIZE OF FIRM */
      497     5460    1         2 CALLIOQ         BIT(1),    /* CALL IOQ AFTER SETTING UP THE WRITE CSO */
      498     5461    1         2 * BIT(2),
      499     5462    1         2 DCTX            UBIN(15) UNAL,  /* MPC DCTX */
      500     5463    1         2 OLSIZE          UBIN(18) UNAL;  /* (REMAINING) SIZE OF F/W OVERLAY */
      501     5464        %NI$SQH                 ( NAME=SQH,    STCLASS="BASED(SQH$)" ) ;
      502     5477        %N$REQ                  ( NAME=REQ,    STCLASS="BASED(REQ$)" ) ;
      503     5535        /*
      504     5536                Constants
      505     5537        */
      506     5538        %SUB LDFW="ADDR(REQ.EAINFO)->LDFW";
      507     5539        /**/
      508     5540        %EQU FWPGS=16;
      509     5541        %SUB NEVER="WHILE('0'B)";
      510     5542        %SUB FOREVER="WHILE('1'B)";
      511     5543        /**/
      512     5544        %EJECT;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:108  
      513     5545        /* START OF PROCEDURE
      514     5546        */
      515     5547    1           DCT$=ADDR(PAR);

   5547  1 000002   200003 236100                    LDQ     @PAR,,AUTO
         1 000003   200007 756100                    STQ     DCT$,,AUTO

      516     5548                /*  Don't load firmware for the IOP or EURC controllers.
      517     5549                */
      518     5550    2           IF NOT HW_LOAD_FW OR DCT.MPC.FWNAME='NONE' THEN DO;

   5550  1 000004   000000 234000 xsym               SZN     HW_LOAD_FW
         1 000005   000012 605000 1                  TPL     s:5551
         1 000006   200007 470500                    LDP0    DCT$,,AUTO
         1 000007   000041 236100                    LDQ     33,,PR0
         1 000010   000000 116000 0                  CMPQ    0
         1 000011   000017 601000 1                  TNZ     s:5555

      519     5551    2              CALL NIW$MPCSTART (DCT);

   5551  1 000012   200007 630500                    EPPR0   DCT$,,AUTO
         1 000013   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000014   000000 701000 xent               TSX1    NIW$MPCSTART
         1 000015   000000 011000                    NOP     0

      520     5552    2              RETURN;

   5552  1 000016   000000 702200 xent               TSX2  ! X66_ARET

      521     5553    2              END;
      522     5554                                                /**/
      523     5555    1           IF DCT.TYPE~=%DV_MPC THEN RETURN ;

   5555  1 000017   000007 236100                    LDQ     7,,PR0
         1 000020   007700 376007                    ANQ     4032,DL
         1 000021   000700 116007                    CMPQ    448,DL
         1 000022   000024 600000 1                  TZE     s:5556
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:109  

   5555  1 000023   000000 702200 xent               TSX2  ! X66_ARET

      524     5556    1           IF DCT.MPC.ALTMPCX~=0 THEN

   5556  1 000024   000035 236100                    LDQ     29,,PR0
         1 000025   000777 316007                    CANQ    511,DL
         1 000026   000043 600000 1                  TZE     s:5559

      525     5557    1              IF NOT N$DCT$(DCT.MPC.ALTMPCX)->DCT.STATUS.DOWN AND DCT.MPC.TYPE~=%DV_LP
              5557                       THEN

   5557  1 000027   000035 720100                    LXL0    29,,PR0
         1 000030   000777 360003                    ANX0    511,DU
         1 000031   000000 471400 xsym               LDP1    N$DCT$$
         1 000032   100000 473510                    LDP3    0,X0,PR1
         1 000033   300027 234100                    SZN     23,,PR3
         1 000034   000043 604000 1                  TMI     s:5559
         1 000035   000035 236100                    LDQ     29,,PR0
         1 000036   777000 376003                    ANQ     -512,DU
         1 000037   003000 116003                    CMPQ    1536,DU
         1 000040   000043 600000 1                  TZE     s:5559

      526     5558    1                 DCT$=N$DCT$(DCT.MPC.ALTMPCX);

   5558  1 000041   100000 236110                    LDQ     0,X0,PR1
         1 000042   200007 756100                    STQ     DCT$,,AUTO

      527     5559    1           SQH$=DCT.SQH$;

   5559  1 000043   200007 470500                    LDP0    DCT$,,AUTO
         1 000044   000022 236100                    LDQ     18,,PR0
         1 000045   200027 756100                    STQ     SQH$,,AUTO

      528     5560                %LOCK(G#=SQH.GATE);

   5561  1 000046   200027 630500                    EPPR0   SQH$,,AUTO
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:110  
         1 000047   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000050   000000 701000 xent               TSX1    HFC$LOCK
         1 000051   000000 011000                    NOP     0

      529     5563    2           IF DCT.DFLG.MPCBUSY THEN DO;

   5563  1 000052   200007 470500                    LDP0    DCT$,,AUTO
         1 000053   000006 236100                    LDQ     6,,PR0
         1 000054   000400 316007                    CANQ    256,DL
         1 000055   000063 600000 1                  TZE     s:5569

      530     5564                   %UNLOCK(G#=SQH.GATE);

   5565  1 000056   200027 630500                    EPPR0   SQH$,,AUTO
         1 000057   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000060   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000061   000000 011000                    NOP     0

      531     5567    2              ALTRETURN;

   5567  1 000062   000000 702200 xent               TSX2  ! X66_AALT

      532     5568    2              END;
      533     5569    1           IF DCT.STATUS.TND ~= 0 THEN GOTO T@DHASMPC ;

   5569  1 000063   000027 236100                    LDQ     23,,PR0
         1 000064   170000 316003                    CANQ    61440,DU
         1 000065   001623 601000 1                  TNZ     T@DHASMPC

      534     5570    2   PATH:   DO FOREVER ;

   5570  1 000066                       PATH         null
      535     5571    3              DO I = 0 TO %N_CHANSPERMPC-1 ;

   5571  1 000066   200014 450100                    STZ     I,,AUTO
         1 000067   000125 710000 1                  TRA     s:5580+1

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:111  
      536     5572    3                 DQH$ = NI$CHT.DQH$(DCT.MPC.IOCHANX(I)) ;

   5572  1 000070   200007 470500                    LDP0    DCT$,,AUTO
         1 000071   200014 235100                    LDA     I,,AUTO
         1 000072   000100 101505                    MRL     fill='000'O
         1 000073   000031 000001                    ADSC9   25,A,PR0                 cn=0,n=1
         1 000074   200040 000002                    ADSC9   I+2,,AUTO                cn=0,n=2
         1 000075   200040 220100                    LDX0    I+2,,AUTO
         1 000076   200040 020100                    ADLX0   I+2,,AUTO
         1 000077   000000 471400 xsym               LDP1    NI$CHT$
         1 000100   100000 236110                    LDQ     0,X0,PR1
         1 000101   200010 756100                    STQ     DQH$,,AUTO

      537     5573    3                 IF DQH$ ~= ADDR(NIL) THEN

   5573  1 000102   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000103   000124 600000 1                  TZE     s:5580

      538     5574    3                    IF NOT DQH.STATUS.DOWN AND

   5574  1 000104   200010 473500                    LDP3    DQH$,,AUTO
         1 000105   300001 236100                    LDQ     1,,PR3
         1 000106   200000 316003                    CANQ    65536,DU
         1 000107   000124 601000 1                  TNZ     s:5580
         1 000110   000000 235000 xsym               LDA     IT_CP6UP
         1 000111   000121 601000 1                  TNZ     s:5577
         1 000112   300001 236100                    LDQ     1,,PR3
         1 000113   000022 772000                    QRL     18
         1 000114   000777 376007                    ANQ     511,DL
         1 000115   000000 066406                    CMPB    filb='0'B
         1 000116   000012 000001 xsym               BDSC    IT_PARTITION+10,Q        by=0,bit=0,n=1
         1 000117   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000120   000124 601000 1                  TNZ     s:5580

      539     5575    3                      ( IT_CP6UP ~= 0 OR
      540     5576    4                      NOT IT_PARTITION.IOCHAN(DQH.IOCHANX) ) THEN DO ;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:112  
      541     5577    4                       DCT.DQH$ = DQH$ ;

   5577  1 000121   200010 236100                    LDQ     DQH$,,AUTO
         1 000122   000023 756100                    STQ     19,,PR0

      542     5578    4                       EXIT PATH ;

   5578  1 000123   000131 710000 1                  TRA     s:5583

      543     5579    4                       END ;
      544     5580    3                 END ;

   5580  1 000124   200014 054100                    AOS     I,,AUTO
         1 000125   200014 235100                    LDA     I,,AUTO
         1 000126   000017 115007                    CMPA    15,DL
         1 000127   000070 604400 1                  TMOZ    s:5572

      545     5581    2              GOTO T@DHASMPC ;

   5581  1 000130   001623 710000 1                  TRA     T@DHASMPC

      546     5582    2              END ;

      547     5583    1           DCT.DFLG.MPCBUSY='1'B;

   5583  1 000131   000400 236007                    LDQ     256,DL
         1 000132   000006 256100                    ORSQ    6,,PR0

      548     5584                %UNLOCK(G#=SQH.GATE);

   5585  1 000133   200027 630500                    EPPR0   SQH$,,AUTO
         1 000134   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000135   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000136   000000 011000                    NOP     0

      549     5587    1           CALL SSS$BLOCKM;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:113  
   5587  1 000137   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000140   000000 701000 xent               TSX1    SSS$BLOCKM
         1 000141   000000 011000                    NOP     0

      550     5588    2           IF HW_IMX AND (DCT.CTYP=%C_IPC) THEN DO;

   5588  1 000142   000000 234000 xsym               SZN     HW_IMX
         1 000143   000160 605000 1                  TPL     s:5594
         1 000144   200007 470500                    LDP0    DCT$,,AUTO
         1 000145   000007 236100                    LDQ     7,,PR0
         1 000146   070000 376003                    ANQ     28672,DU
         1 000147   020000 116003                    CMPQ    8192,DU
         1 000150   000160 601000 1                  TNZ     s:5594

      551     5589    2              DCT.DFLG.MPCSTOP = '0'B;

   5589  1 000151   000000 236000 2                  LDQ     0
         1 000152   000006 356100                    ANSQ    6,,PR0

      552     5590    2              DCT.DFLG.RELOAD = '1'B;

   5590  1 000153   004000 236007                    LDQ     2048,DL
         1 000154   000006 256100                    ORSQ    6,,PR0

      553     5591    2              DCT.MPC.REQ$ = ADDR(NIL);

   5591  1 000155   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000156   000040 756100                    STQ     32,,PR0

      554     5592    2              END;

   5592  1 000157   000216 710000 1                  TRA     s:5602

      555     5593    2           ELSE DO;

      556     5594    2              CALL NIQ$GET(REQ$) ALTRET(NOQPKT);

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:114  
   5594  1 000160   200026 630500                    EPPR0   REQ$,,AUTO
         1 000161   200040 450500                    STP0    I+2,,AUTO
         1 000162   200040 630500                    EPPR0   I+2,,AUTO
         1 000163   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000164   000000 701000 xent               TSX1    NIQ$GET
         1 000165   001611 702000 1                  TSX2    NOQPKT

      557     5595    2              REQ.OPFLG=OP_EA;

   5595  1 000166   200026 470500                    LDP0    REQ$,,AUTO
         1 000167   000040 236007                    LDQ     32,DL
         1 000170   000004 552104                    STBQ    4,'04'O,PR0

      558     5596    2              REQ.OPFLG.HOLD=WAIT;

   5596  1 000171   200026 470500                    LDP0    REQ$,,AUTO
         1 000172   200004 471500                    LDP1    @WAIT,,AUTO
         1 000173   100000 236100                    LDQ     0,,PR1
         1 000174   000041 772000                    QRL     33
         1 000175   000004 676100                    ERQ     4,,PR0
         1 000176   000004 376007                    ANQ     4,DL
         1 000177   000004 656100                    ERSQ    4,,PR0

      559     5597    2              REQ.EAENTRY=ENTADDR(NIW$LDFWEA);

   5597  1 000200   000000 636000 xent               EAQ     NIW$LDFWEA
         1 000201   200026 470500                    LDP0    REQ$,,AUTO
         1 000202   000023 756100                    STQ     19,,PR0

      560     5598    2              DCT.MPC.REQ$=REQ$;

   5598  1 000203   200026 236100                    LDQ     REQ$,,AUTO
         1 000204   200007 470500                    LDP0    DCT$,,AUTO
         1 000205   000040 756100                    STQ     32,,PR0

      561     5599    2              LDFW.DCTX=DCT.DCTX;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:115  
   5599  1 000206   200026 473500                    LDP3    REQ$,,AUTO
         1 000207   000006 236100                    LDQ     6,,PR0
         1 000210   000003 772000                    QRL     3
         1 000211   300025 676100                    ERQ     21,,PR3
         1 000212   077777 376003                    ANQ     32767,DU
         1 000213   300025 656100                    ERSQ    21,,PR3

      562     5600    2              DCT.DFLG.RELOAD='0'B;

   5600  1 000214   000001 236000 2                  LDQ     1
         1 000215   000006 356100                    ANSQ    6,,PR0

      563     5601    2              END;

      564     5602    1           CALL NIW$MPCSTOP(DCT);          /* DON'T USE THIS MPC UNTIL DONE */

   5602  1 000216   200007 630500                    EPPR0   DCT$,,AUTO
         1 000217   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000220   000000 701000 xent               TSX1    NIW$MPCSTOP
         1 000221   000000 011000                    NOP     0

      565     5603    1           IF HW_IMX AND (DCT.CTYP=%C_IPC) THEN

   5603  1 000222   000000 234000 xsym               SZN     HW_IMX
         1 000223   000232 605000 1                  TPL     s:5605
         1 000224   200007 470500                    LDP0    DCT$,,AUTO
         1 000225   000007 236100                    LDQ     7,,PR0
         1 000226   070000 376003                    ANQ     28672,DU
         1 000227   020000 116003                    CMPQ    8192,DU
         1 000230   000232 601000 1                  TNZ     s:5605

      566     5604    1              RETURN;

   5604  1 000231   000000 702200 xent               TSX2  ! X66_ARET

      567     5605    2           IF DCT.MPC.ALTMPCX~=0 THEN DO;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:116  
   5605  1 000232   200007 470500                    LDP0    DCT$,,AUTO
         1 000233   000035 236100                    LDQ     29,,PR0
         1 000234   000777 316007                    CANQ    511,DL
         1 000235   000260 600000 1                  TZE     s:5610

      568     5606    2              CALL NIW$MPCSTOP(N$DCT$(DCT.MPC.ALTMPCX)->DCT);

   5606  1 000236   000035 720100                    LXL0    29,,PR0
         1 000237   000777 360003                    ANX0    511,DU
         1 000240   000000 471400 xsym               LDP1    N$DCT$$
         1 000241   100000 473510                    LDP3    0,X0,PR1
         1 000242   200040 453500                    STP3    I+2,,AUTO
         1 000243   200040 630500                    EPPR0   I+2,,AUTO
         1 000244   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000245   000000 701000 xent               TSX1    NIW$MPCSTOP
         1 000246   000000 011000                    NOP     0

      569     5607    3              DO WHILE(NOT N$DCT$(DCT.MPC.ALTMPCX)->DCT.DFLG.MPCSTOP);

   5607  1 000247   000250 710000 1                  TRA     s:5608

      570     5608    3                 END;

   5608  1 000250   200007 470500                    LDP0    DCT$,,AUTO
         1 000251   000035 720100                    LXL0    29,,PR0
         1 000252   000777 360003                    ANX0    511,DU
         1 000253   000000 471400 xsym               LDP1    N$DCT$$
         1 000254   100000 473510                    LDP3    0,X0,PR1
         1 000255   300006 236100                    LDQ     6,,PR3
         1 000256   001000 316007                    CANQ    512,DL
         1 000257   000250 600000 1                  TZE     s:5608

      571     5609    2              END;

      572     5610    2           IF DCT.MPC.FW$=ADDR(NIL) THEN DO;

   5610  1 000260   000030 236100                    LDQ     24,,PR0
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:117  
         1 000261   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000262   000615 601000 1                  TNZ     s:5668

      573     5611    2              DCT.MPC.FW$=B$FIRM$;

   5611  1 000263   000000 236000 xsym               LDQ     B$FIRM$
         1 000264   000030 756100                    STQ     24,,PR0

      574     5612    2              FW$=B$FIRM$;

   5612  1 000265   200012 756100                    STQ     FW$,,AUTO

      575     5613    2              CALL GETFWX(0,FWX,DCT.MPC.FWNAME) ALTRET(NOFW);

   5613  1 000266   200007 236100                    LDQ     DCT$,,AUTO
         1 000267   000041 036003                    ADLQ    33,DU
         1 000270   200035 756100                    STQ     @FX+1,,AUTO
         1 000271   200013 631500                    EPPR1   FWX,,AUTO
         1 000272   200034 451500                    STP1    @START+1,,AUTO
         1 000273   000002 236000 2                  LDQ     2
         1 000274   200033 756100                    STQ     WAITTIME+2,,AUTO
         1 000275   001650 701000 1                  TSX1    GETFWX
         1 000276   001600 702000 1                  TSX2    NOFW

      576     5614                   %LOCK(G#=NI_FWGATE);

   5615  1 000277   000003 630400 2                  EPPR0   3
         1 000300   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000301   000000 701000 xent               TSX1    HFC$LOCK
         1 000302   000000 011000                    NOP     0

      577     5617    2              IF B$LS$->B$MLNK.FIRM.FLGS&%DSNULL THEN GOTO MEMBUSY;

   5617  1 000303   000000 470400 xsym               LDP0    B$LS$
         1 000304   000336 236100                    LDQ     222,,PR0
         1 000305   000024 736000                    QLS     20
         1 000306   777000 376003                    ANQ     -512,DU
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:118  
         1 000307   002000 376003                    ANQ     1024,DU
         1 000310   001571 601000 1                  TNZ     MEMBUSY

      578     5618    2              B$LS$->B$MLNK.FIRM.BOUND=%(%FWPGS*1024*4-1);

   5618  1 000311   000336 236100                    LDQ     222,,PR0
         1 000312   177777 376007                    ANQ     65535,DL
         1 000313   000004 276000 2                  ORQ     4
         1 000314   000336 756100                    STQ     222,,PR0

      579     5619    2              B$LS$->B$MLNK.FIRM.FLGS=B$LS$->B$MLNK.FIRM.FLGS|%DSNULL;

   5619  1 000315   000336 236100                    LDQ     222,,PR0
         1 000316   000024 736000                    QLS     20
         1 000317   777000 376003                    ANQ     -512,DU
         1 000320   002000 276003                    ORQ     1024,DU
         1 000321   000024 772000                    QRL     20
         1 000322   000336 676100                    ERQ     222,,PR0
         1 000323   177600 376007                    ANQ     65408,DL
         1 000324   000336 656100                    ERSQ    222,,PR0

      580     5620                   %UNLOCK(G#=NI_FWGATE);

   5621  1 000325   000003 630400 2                  EPPR0   3
         1 000326   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000327   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000330   000000 011000                    NOP     0

      581     5623    3              IF NOT IT_SYSDIR$->I$DISKDIR.FW.INMEM(FWX) THEN DO;

   5623  1 000331   200013 235100                    LDA     FWX,,AUTO
         1 000332   000002 735000                    ALS     2
         1 000333   000000 470400 xsym               LDP0    IT_SYSDIR$
         1 000334   000240 234105                    SZN     160,AL,PR0
         1 000335   000406 604000 1                  TMI     s:5637

      582     5624                                                /* INMEM='0'B IF FW IN MEMORY */
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:119  
      583     5625    3                 PPNO=IT_SYSDIR$->I$DISKDIR.FW.BASE(FWX)/1024;

   5625  1 000336   000240 236105                    LDQ     160,AL,PR0
         1 000337   000031 376000 xsym               ANQ     B_VECTNIL+25
         1 000340   000012 772000                    QRL     10
         1 000341   200025 756100                    STQ     PPNO,,AUTO

      584     5626    4                 DO VPNO=%FIRMWREPG TO %FIRMWREPG+%(%FWPGS-1);

   5626  1 000342   001010 235007                    LDA     520,DL
         1 000343   200030 755100                    STA     VPNO,,AUTO
         1 000344   000363 710000 1                  TRA     s:5629+1

      585     5627    4                    CALL MME$CVM(%MONWSQ,VPNO,PPNO,ERRWD) ALTRET(NOMEM);

   5627  1 000345   200011 630500                    EPPR0   ERRWD,,AUTO
         1 000346   200043 450500                    STP0    I+5,,AUTO
         1 000347   200025 631500                    EPPR1   PPNO,,AUTO
         1 000350   200042 451500                    STP1    I+4,,AUTO
         1 000351   200030 633500                    EPPR3   VPNO,,AUTO
         1 000352   200041 453500                    STP3    I+3,,AUTO
         1 000353   000005 236000 2                  LDQ     5
         1 000354   200040 756100                    STQ     I+2,,AUTO
         1 000355   200040 630500                    EPPR0   I+2,,AUTO
         1 000356   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000357   000000 701000 xent               TSX1    MME$CVM
         1 000360   001513 702000 1                  TSX2    NOMEM

      586     5628    4                    PPNO=PPNO+1;

   5628  1 000361   200025 054100                    AOS     PPNO,,AUTO

      587     5629    4                    END;

   5629  1 000362   200030 054100                    AOS     VPNO,,AUTO
         1 000363   200030 235100                    LDA     VPNO,,AUTO
         1 000364   001027 115007                    CMPA    535,DL
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:120  
         1 000365   000345 604400 1                  TMOZ    s:5627

      588     5630    3                 FW.FWOL(0)=IT_SYSDIR$->I$DISKDIR.FW.CS0SIZE(FWX);

   5630  1 000366   200013 236100                    LDQ     FWX,,AUTO
         1 000367   000002 736000                    QLS     2
         1 000370   000000 470400 xsym               LDP0    IT_SYSDIR$
         1 000371   000242 220106                    LDX0    162,QL,PR0
         1 000372   200012 471500                    LDP1    FW$,,AUTO
         1 000373   100003 740100                    STX0    3,,PR1

      589     5631    3                 FW.FWOL(1)=IT_SYSDIR$->I$DISKDIR.FW.MM0SIZE(FWX);

   5631  1 000374   200013 235100                    LDA     FWX,,AUTO
         1 000375   000002 735000                    ALS     2
         1 000376   000242 721105                    LXL1    162,AL,PR0
         1 000377   100003 441100                    SXL1    3,,PR1

      590     5632    3                 FW.FWOL(2)=0;

   5632  1 000400   000000 222003                    LDX2    0,DU
         1 000401   100004 742100                    STX2    4,,PR1

      591     5633    3                 FW.FWOL(3)=0;

   5633  1 000402   100004 442100                    SXL2    4,,PR1

      592     5634    3                 LDFW.SEGSIZE=0;           /* INDICATE FIRMWARE FROM MEMORY */

   5634  1 000403   200026 473500                    LDP3    REQ$,,AUTO
         1 000404   300024 442100                    SXL2    20,,PR3

      593     5635    3                 END;

   5635  1 000405   000615 710000 1                  TRA     s:5668

      594     5636    3              ELSE DO;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:121  

      595     5637    3                 LDFW.SEGSIZE=%FWPGS*1024;

   5637  1 000406   040000 220003                    LDX0    16384,DU
         1 000407   200026 471500                    LDP1    REQ$,,AUTO
         1 000410   100024 440100                    SXL0    20,,PR1

      596     5638    4                 DO VPNO=%FIRMWREPG TO %FIRMWREPG+%(%FWPGS-1);

   5638  1 000411   001010 236007                    LDQ     520,DL
         1 000412   200030 756100                    STQ     VPNO,,AUTO
         1 000413   000444 710000 1                  TRA     s:5643+1

      597     5639    4                    CALL MMB$GPP(PPNO,%MONWSQ);

   5639  1 000414   000005 236000 2                  LDQ     5
         1 000415   200041 756100                    STQ     I+3,,AUTO
         1 000416   200025 630500                    EPPR0   PPNO,,AUTO
         1 000417   200040 450500                    STP0    I+2,,AUTO
         1 000420   200040 630500                    EPPR0   I+2,,AUTO
         1 000421   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000422   000000 701000 xent               TSX1    MMB$GPP
         1 000423   000000 011000                    NOP     0

      598     5640    4                    IF PPNO~=0 THEN

   5640  1 000424   200025 235100                    LDA     PPNO,,AUTO
         1 000425   001513 600000 1                  TZE     NOMEM

      599     5641    4                       CALL MME$CVM(%MONWSQ,VPNO,PPNO,ERRWD) ALTRET(CVMERR);

   5641  1 000426   200011 630500                    EPPR0   ERRWD,,AUTO
         1 000427   200043 450500                    STP0    I+5,,AUTO
         1 000430   200025 631500                    EPPR1   PPNO,,AUTO
         1 000431   200042 451500                    STP1    I+4,,AUTO
         1 000432   200030 633500                    EPPR3   VPNO,,AUTO
         1 000433   200041 453500                    STP3    I+3,,AUTO
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:122  
         1 000434   000005 236000 2                  LDQ     5
         1 000435   200040 756100                    STQ     I+2,,AUTO
         1 000436   200040 630500                    EPPR0   I+2,,AUTO
         1 000437   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000440   000000 701000 xent               TSX1    MME$CVM
         1 000441   001505 702000 1                  TSX2    CVMERR
         1 000442   000443 710000 1                  TRA     s:5643

      600     5642    4                    ELSE GOTO NOMEM;
      601     5643    4                    END;

   5643  1 000443   200030 054100                    AOS     VPNO,,AUTO
         1 000444   200030 235100                    LDA     VPNO,,AUTO
         1 000445   001027 115007                    CMPA    535,DL
         1 000446   000414 604400 1                  TMOZ    s:5639

      602     5644    3                 FW='0'B;

   5644  1 000447   200012 470500                    LDP0    FW$,,AUTO
         1 000450   000100 100400                    MLR     fill='000'O
         1 000451   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000452   000000 000060                    ADSC9   0,,PR0                   cn=0,n=48

      603     5645    3                 FW.FWDA=IT_SYSDIR$->I$DISKDIR.FW.DA(FWX);

   5645  1 000453   200013 235100                    LDA     FWX,,AUTO
         1 000454   000002 735000                    ALS     2
         1 000455   000000 471400 xsym               LDP1    IT_SYSDIR$
         1 000456   100241 235105                    LDA     161,AL,PR1
         1 000457   000000 755100                    STA     0,,PR0

      604     5646    3                 FW.FWOL(0)=IT_SYSDIR$->I$DISKDIR.FW.CS0SIZE(FWX);

   5646  1 000460   200013 236100                    LDQ     FWX,,AUTO
         1 000461   000002 736000                    QLS     2
         1 000462   000000 471400 xsym               LDP1    IT_SYSDIR$
         1 000463   100242 220106                    LDX0    162,QL,PR1
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:123  
         1 000464   000003 740100                    STX0    3,,PR0

      605     5647    3                 FW.FWOL(1)=IT_SYSDIR$->I$DISKDIR.FW.MM0SIZE(FWX);

   5647  1 000465   200013 236100                    LDQ     FWX,,AUTO
         1 000466   000002 736000                    QLS     2
         1 000467   100242 721106                    LXL1    162,QL,PR1
         1 000470   000003 441100                    SXL1    3,,PR0

      606     5648    4                 IF DCT.MPC.LPCHANS THEN DO;

   5648  1 000471   200007 473500                    LDP3    DCT$,,AUTO
         1 000472   300035 236100                    LDQ     29,,PR3
         1 000473   000777 316003                    CANQ    511,DU
         1 000474   000520 600000 1                  TZE     s:5653

      607     5649    4                    CALL GETFWX(0,LPX,DCT.MPC.LPNAME) ALTRET(NOMEM);

   5649  1 000475   200007 236100                    LDQ     DCT$,,AUTO
         1 000476   000042 036003                    ADLQ    34,DU
         1 000477   200035 756100                    STQ     @FX+1,,AUTO
         1 000500   200023 634500                    EPPR4   LPX,,AUTO
         1 000501   200034 454500                    STP4    @START+1,,AUTO
         1 000502   000002 236000 2                  LDQ     2
         1 000503   200033 756100                    STQ     WAITTIME+2,,AUTO
         1 000504   001650 701000 1                  TSX1    GETFWX
         1 000505   001513 702000 1                  TSX2    NOMEM

      608     5650    4                    FW.LPDA=IT_SYSDIR$->I$DISKDIR.FW.DA(LPX);

   5650  1 000506   200023 235100                    LDA     LPX,,AUTO
         1 000507   000002 735000                    ALS     2
         1 000510   000000 470400 xsym               LDP0    IT_SYSDIR$
         1 000511   200012 471500                    LDP1    FW$,,AUTO
         1 000512   000241 235105                    LDA     161,AL,PR0
         1 000513   100001 755100                    STA     1,,PR1

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:124  
      609     5651    4                    FW.FWOL(2)=IT_SYSDIR$->I$DISKDIR.FW.CS0SIZE(LPX);

   5651  1 000514   200023 236100                    LDQ     LPX,,AUTO
         1 000515   000002 736000                    QLS     2
         1 000516   000242 220106                    LDX0    162,QL,PR0
         1 000517   100004 740100                    STX0    4,,PR1

      610     5652    4                    END;

      611     5653    4                 IF DCT.MPC.CRPCHANS THEN DO;

   5653  1 000520   200007 470500                    LDP0    DCT$,,AUTO
         1 000521   000035 236100                    LDQ     29,,PR0
         1 000522   777000 316007                    CANQ    -512,DL
         1 000523   000547 600000 1                  TZE     s:5658

      612     5654    4                    CALL GETFWX(0,CRPX,DCT.MPC.CRPNAME) ALTRET(NOMEM);

   5654  1 000524   200007 236100                    LDQ     DCT$,,AUTO
         1 000525   000043 036003                    ADLQ    35,DU
         1 000526   200035 756100                    STQ     @FX+1,,AUTO
         1 000527   200006 631500                    EPPR1   CRPX,,AUTO
         1 000530   200034 451500                    STP1    @START+1,,AUTO
         1 000531   000002 236000 2                  LDQ     2
         1 000532   200033 756100                    STQ     WAITTIME+2,,AUTO
         1 000533   001650 701000 1                  TSX1    GETFWX
         1 000534   001513 702000 1                  TSX2    NOMEM

      613     5655    4                    FW.CRPDA=IT_SYSDIR$->I$DISKDIR.FW.DA(CRPX);

   5655  1 000535   200006 235100                    LDA     CRPX,,AUTO
         1 000536   000002 735000                    ALS     2
         1 000537   000000 470400 xsym               LDP0    IT_SYSDIR$
         1 000540   200012 471500                    LDP1    FW$,,AUTO
         1 000541   000241 235105                    LDA     161,AL,PR0
         1 000542   100002 755100                    STA     2,,PR1

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:125  
      614     5656    4                    FW.FWOL(3)=IT_SYSDIR$->I$DISKDIR.FW.CS0SIZE(CRPX);

   5656  1 000543   200006 236100                    LDQ     CRPX,,AUTO
         1 000544   000002 736000                    QLS     2
         1 000545   000242 220106                    LDX0    162,QL,PR0
         1 000546   100004 440100                    SXL0    4,,PR1

      615     5657    4                    END;

      616     5658    3                 REQ.FC=%N_RDBIN;

   5658  1 000547   200026 470500                    LDP0    REQ$,,AUTO
         1 000550   000002 236007                    LDQ     2,DL
         1 000551   000003 552104                    STBQ    3,'04'O,PR0

      617     5659    3                 REQ.DLA.DCTX=IT_SYSDISK;

   5659  1 000552   200026 470500                    LDP0    REQ$,,AUTO
         1 000553   000000 236000 xsym               LDQ     IT_SYSDISK
         1 000554   000025 736000                    QLS     21
         1 000555   000001 676100                    ERQ     1,,PR0
         1 000556   777770 376003                    ANQ     -8,DU
         1 000557   000001 656100                    ERSQ    1,,PR0

      618     5660    3                 REQ.DLA.DRELADDR=FW.FWDA;

   5660  1 000560   200012 470500                    LDP0    FW$,,AUTO
         1 000561   200026 471500                    LDP1    REQ$,,AUTO
         1 000562   000000 236100                    LDQ     0,,PR0
         1 000563   100001 676100                    ERQ     1,,PR1
         1 000564   000006 376000 2                  ANQ     6
         1 000565   100001 656100                    ERSQ    1,,PR1

      619     5661    3                 REQ.BUF$=ADDR(FW.FW);

   5661  1 000566   200012 236100                    LDQ     FW$,,AUTO
         1 000567   000013 036003                    ADLQ    11,DU
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:126  
         1 000570   200026 471500                    LDP1    REQ$,,AUTO
         1 000571   100005 756100                    STQ     5,,PR1

      620     5662    3                 REQ.OPFLG.BPF='1'B;

   5662  1 000572   200026 471500                    LDP1    REQ$,,AUTO
         1 000573   000010 236007                    LDQ     8,DL
         1 000574   100004 256100                    ORSQ    4,,PR1

      621     5663    3                 REQ.BUFSIZE=(FW.FWOL(0)+FW.FWOL(1))*4;

   5663  1 000575   000003 236100                    LDQ     3,,PR0
         1 000576   777777 376007                    ANQ     -1,DL
         1 000577   200040 756100                    STQ     I+2,,AUTO
         1 000600   000003 236100                    LDQ     3,,PR0
         1 000601   000022 772000                    QRL     18
         1 000602   200040 036100                    ADLQ    I+2,,AUTO
         1 000603   200026 471500                    LDP1    REQ$,,AUTO
         1 000604   000002 736000                    QLS     2
         1 000605   000020 736000                    QLS     16
         1 000606   100004 676100                    ERQ     4,,PR1
         1 000607   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 000610   100004 656100                    ERSQ    4,,PR1

      622     5664    3                 LDFW.STATE=2;

   5664  1 000611   000002 220003                    LDX0    2,DU
         1 000612   200026 471500                    LDP1    REQ$,,AUTO
         1 000613   100024 740100                    STX0    20,,PR1

      623     5665    3                 GOTO CALLIOQ;

   5665  1 000614   001420 710000 1                  TRA     CALLIOQ

      624     5666    3                 END;
      625     5667    2              END;
      626     5668    1           LDFW.STATE=5;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:127  

   5668  1 000615   000005 220003                    LDX0    5,DU
         1 000616   200026 470500                    LDP0    REQ$,,AUTO
         1 000617   000024 740100                    STX0    20,,PR0

      627     5669    1           LDFW.CALLIOQ='1'B;

   5669  1 000620   200026 470500                    LDP0    REQ$,,AUTO
         1 000621   400000 236003                    LDQ     -131072,DU
         1 000622   000025 256100                    ORSQ    21,,PR0

      628     5670    1           GOTO LDFW1;

   5670  1 000623   000636 710000 1                  TRA     LDFW1

      629     5671        /*
      630     5672           ENTER HERE AFTER F/W IS IN MEMORY (WAIT='0'B)
      631     5673        */
      632     5674    1   NIW$LDFWS: ENTRY(PAR,WAIT) ALTRET;

   5674  1 000624   000000 700200 xent  NIW$LDFWS    TSX0  ! X66_AUTO_2
         1 000625   000060 000002                    ZERO    48,2

      633     5675    1           DCT$=ADDR(PAR);

   5675  1 000626   200003 236100                    LDQ     @PAR,,AUTO
         1 000627   200007 756100                    STQ     DCT$,,AUTO

      634     5676    1           REQ$=DCT.MPC.REQ$;

   5676  1 000630   200007 470500                    LDP0    DCT$,,AUTO
         1 000631   000040 236100                    LDQ     32,,PR0
         1 000632   200026 756100                    STQ     REQ$,,AUTO

      635     5677    1           LDFW.CALLIOQ='0'B;

   5677  1 000633   200026 471500                    LDP1    REQ$,,AUTO
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:128  
         1 000634   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000635   100025 356100                    ANSQ    21,,PR1

      636     5678    1   LDFW1:
      637     5679    1           REQ.DLA.DCTX=DCT.DCTX;

   5679  1 000636   200007 470500       LDFW1        LDP0    DCT$,,AUTO
         1 000637   200026 471500                    LDP1    REQ$,,AUTO
         1 000640   000006 236100                    LDQ     6,,PR0
         1 000641   100001 676100                    ERQ     1,,PR1
         1 000642   777770 376003                    ANQ     -8,DU
         1 000643   100001 656100                    ERSQ    1,,PR1

      638     5680    1           FW$=DCT.MPC.FW$;

   5680  1 000644   000030 236100                    LDQ     24,,PR0
         1 000645   200012 756100                    STQ     FW$,,AUTO

      639     5681    1           REQ.BUFSIZE=%(%FWPGS*4096)-POFFC(ADDR(FW.IDCW),FW$);

   5681  1 000646   000006 036003                    ADLQ    6,DU
         1 000647   000020 772000                    QRL     16
         1 000650   200040 756100                    STQ     I+2,,AUTO
         1 000651   200012 236100                    LDQ     FW$,,AUTO
         1 000652   000020 772000                    QRL     16
         1 000653   200041 756100                    STQ     I+3,,AUTO
         1 000654   200040 236100                    LDQ     I+2,,AUTO
         1 000655   200041 136100                    SBLQ    I+3,,AUTO
         1 000656   200026 471500                    LDP1    REQ$,,AUTO
         1 000657   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 000660   200001 036007                    ADLQ    65537,DL
         1 000661   000020 736000                    QLS     16
         1 000662   100004 676100                    ERQ     4,,PR1
         1 000663   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 000664   100004 656100                    ERSQ    4,,PR1

      640     5682    1           REQ.FC=%N_DCWLIST;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:129  

   5682  1 000665   200026 471500                    LDP1    REQ$,,AUTO
         1 000666   000000 236003                    LDQ     0,DU
         1 000667   100003 552104                    STBQ    3,'04'O,PR1

      641     5683    1           REQ.BUF$=ADDR(FW.IDCW);

   5683  1 000670   200012 236100                    LDQ     FW$,,AUTO
         1 000671   000006 036003                    ADLQ    6,DU
         1 000672   200026 471500                    LDP1    REQ$,,AUTO
         1 000673   100005 756100                    STQ     5,,PR1

      642     5684    1           REQ.OPFLG.BPF='1'B;

   5684  1 000674   200026 471500                    LDP1    REQ$,,AUTO
         1 000675   000010 236007                    LDQ     8,DL
         1 000676   100004 256100                    ORSQ    4,,PR1

      643     5685    1           DCT.DFLG.RELOAD='1'B;

   5685  1 000677   004000 236007                    LDQ     2048,DL
         1 000700   000006 256100                    ORSQ    6,,PR0

      644     5686    1           DCT.DFLG.MPCSTOP='0'B;          /* MAKE SURE MPCSTOP DOES SOMETHING */

   5686  1 000701   000000 236000 2                  LDQ     0
         1 000702   000006 356100                    ANSQ    6,,PR0

      645     5687    1           CALL NIW$MPCSTOP(DCT);

   5687  1 000703   200007 630500                    EPPR0   DCT$,,AUTO
         1 000704   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000705   000000 701000 xent               TSX1    NIW$MPCSTOP
         1 000706   000000 011000                    NOP     0

      646     5688    1           GOTO LDFW2;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:130  
   5688  1 000707   001433 710000 1                  TRA     LDFW2

      647     5689        /**/
      648     5690        /* ENTER HERE FROM NIW$MPCSTOP WHEN MPC IS STOPPED AND RELOAD BIT SET */
      649     5691        /**/
      650     5692    1   NIW$LDFWR: ENTRY(PAR,WAIT) ALTRET;

   5692  1 000710   000000 700200 xent  NIW$LDFWR    TSX0  ! X66_AUTO_2
         1 000711   000060 000002                    ZERO    48,2

      651     5693    1           DCT$=ADDR(PAR);

   5693  1 000712   200003 236100                    LDQ     @PAR,,AUTO
         1 000713   200007 756100                    STQ     DCT$,,AUTO

      652     5694    1           REQ$=DCT.MPC.REQ$;

   5694  1 000714   200007 470500                    LDP0    DCT$,,AUTO
         1 000715   000040 236100                    LDQ     32,,PR0
         1 000716   200026 756100                    STQ     REQ$,,AUTO

      653     5695    1           IF REQ$~=ADDR(NIL) THEN /* IMX (CTYP = IPC) WON'T HAVE A REQ PACKET */

   5695  1 000717   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000720   000724 600000 1                  TZE     s:5697

      654     5696    1              REQ.DQH$=DCT.DQH$;

   5696  1 000721   000023 236100                    LDQ     19,,PR0
         1 000722   200026 471500                    LDP1    REQ$,,AUTO
         1 000723   100020 756100                    STQ     16,,PR1

      655     5697    1           FW$=DCT.MPC.FW$;

   5697  1 000724   000030 236100                    LDQ     24,,PR0
         1 000725   200012 756100                    STQ     FW$,,AUTO

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:131  
      656     5698    1           SQH$=DCT.SQH$;

   5698  1 000726   000022 236100                    LDQ     18,,PR0
         1 000727   200027 756100                    STQ     SQH$,,AUTO

      657     5699    2           IF DCT.DFLG.MPCSTOP THEN DO;

   5699  1 000730   000006 236100                    LDQ     6,,PR0
         1 000731   001000 316007                    CANQ    512,DL
         1 000732   001425 600000 1                  TZE     s:5794

      658     5700    2              IF HW_IMX THEN

   5700  1 000733   000000 234000 xsym               SZN     HW_IMX
         1 000734   001232 605000 1                  TPL     s:5759

      659     5701    3                 IF DCT.CTYP=%C_IPC THEN DO; /* FW LOADED BY MCA */

   5701  1 000735   000007 236100                    LDQ     7,,PR0
         1 000736   070000 376003                    ANQ     28672,DU
         1 000737   020000 116003                    CMPQ    8192,DU
         1 000740   001200 601000 1                  TNZ     s:5753

      660     5702    4                    IF IT_CP6UP~=0 THEN DO;

   5702  1 000741   000000 235000 xsym               LDA     IT_CP6UP
         1 000742   001156 600000 1                  TZE     s:5743

      661     5703    5                       DO I = 0 TO 3;

   5703  1 000743   200014 450100                    STZ     I,,AUTO

      662     5704    5                          IPC_TBL.DQH$(I) = ADDR(NIL);

   5704  1 000744   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000745   200014 720100                    LXL0    I,,AUTO
         1 000746   200016 756110                    STQ     IPC_TBL,X0,AUTO
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:132  

      663     5705    5                          END;

   5705  1 000747   200014 054100                    AOS     I,,AUTO
         1 000750   200014 235100                    LDA     I,,AUTO
         1 000751   000003 115007                    CMPA    3,DL
         1 000752   000744 604400 1                  TMOZ    s:5704

      664     5706    5                       CALL TMB$BUF_ALLOC (IOS$,BUFX) WHENRETURN DO;

   5706  1 000753   200005 630500                    EPPR0   BUFX,,AUTO
         1 000754   200041 450500                    STP0    I+3,,AUTO
         1 000755   200015 631500                    EPPR1   IOS$,,AUTO
         1 000756   200040 451500                    STP1    I+2,,AUTO
         1 000757   200040 630500                    EPPR0   I+2,,AUTO
         1 000760   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000761   000000 701000 xent               TSX1    TMB$BUF_ALLOC
         1 000762   001066 702000 1                  TSX2    s:5730

      665     5707    6   RLOADIPC:              DO I = 0 TO %N_CHANSPERMPC-1;

   5707  1 000763   200014 450100       RLOADIPC     STZ     I,,AUTO
         1 000764   001053 710000 1                  TRA     s:5727+1

      666     5708    6                             DQH$ = NI$CHT.DQH$(DCT.MPC.IOCHANX(I));

   5708  1 000765   200007 470500                    LDP0    DCT$,,AUTO
         1 000766   200014 235100                    LDA     I,,AUTO
         1 000767   000100 101505                    MRL     fill='000'O
         1 000770   000031 000001                    ADSC9   25,A,PR0                 cn=0,n=1
         1 000771   200040 000002                    ADSC9   I+2,,AUTO                cn=0,n=2
         1 000772   200040 220100                    LDX0    I+2,,AUTO
         1 000773   200040 020100                    ADLX0   I+2,,AUTO
         1 000774   000000 471400 xsym               LDP1    NI$CHT$
         1 000775   100000 236110                    LDQ     0,X0,PR1
         1 000776   200010 756100                    STQ     DQH$,,AUTO

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:133  
      667     5709    7                             IF DQH$~=ADDR(NIL) THEN DO;

   5709  1 000777   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001000   001052 600000 1                  TZE     s:5727

      668     5710    7                                IF NOT DQH.STATUS.DOWN AND

   5710  1 001001   200010 473500                    LDP3    DQH$,,AUTO
         1 001002   300001 236100                    LDQ     1,,PR3
         1 001003   200000 316003                    CANQ    65536,DU
         1 001004   001052 601000 1                  TNZ     s:5727
         1 001005   300020 236100                    LDQ     16,,PR3
         1 001006   000033 772000                    QRL     27
         1 001007   000003 376007                    ANQ     3,DL
         1 001010   200016 236106                    LDQ     IPC_TBL,QL,AUTO
         1 001011   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001012   001052 601000 1                  TNZ     s:5727

      669     5711    8                                  IPC_TBL.DQH$(DQH.LA)=ADDR(NIL) THEN DO;

      670     5712    8                                   IPC_TBL.DQH$(DQH.LA) = DQH$;

   5712  1 001013   300020 236100                    LDQ     16,,PR3
         1 001014   000033 772000                    QRL     27
         1 001015   000003 376007                    ANQ     3,DL
         1 001016   000000 620006                    EAX0    0,QL
         1 001017   200010 236100                    LDQ     DQH$,,AUTO
         1 001020   200016 756110                    STQ     IPC_TBL,X0,AUTO

      671     5713    8                                   CALL TMB$MCA (DQH, TM_OC_LOADFW#,BUFX)

   5713  1 001021   200005 634500                    EPPR4   BUFX,,AUTO
         1 001022   200042 454500                    STP4    I+4,,AUTO
         1 001023   000007 236000 2                  LDQ     7
         1 001024   200010 235100                    LDA     DQH$,,AUTO
         1 001025   200040 757100                    STAQ    I+2,,AUTO
         1 001026   200040 630500                    EPPR0   I+2,,AUTO
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:134  
         1 001027   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001030   000000 701000 xent               TSX1    TMB$MCA
         1 001031   001046 702000 1                  TSX2    s:5722

      672     5714    9                                   WHENRETURN DO ;

      673     5715    9                                      DCT.DFLG.RELOAD = '0'B ;

   5715  1 001032   200007 470500                    LDP0    DCT$,,AUTO
         1 001033   000001 236000 2                  LDQ     1
         1 001034   000006 356100                    ANSQ    6,,PR0

      674     5716         /*N* This is a 10sec wait on DPS 8000/81.  But IPC-IPI need 1-2 minute wait. */
      675     5717    9                                      WAITTIME = 13000000 ;

   5717  1 001035   000010 235000 2                  LDA     8
         1 001036   200031 755100                    STA     WAITTIME,,AUTO

      676     5718   10                                      DO  J = 0 TO WAITTIME ;

   5718  1 001037   200022 450100                    STZ     J,,AUTO
         1 001040   001042 710000 1                  TRA     s:5719+1

      677     5719   10                                         END ;

   5719  1 001041   200022 054100                    AOS     J,,AUTO
         1 001042   200022 236100                    LDQ     J,,AUTO
         1 001043   200031 116100                    CMPQ    WAITTIME,,AUTO
         1 001044   001041 604400 1                  TMOZ    s:5719

      678     5720    9                                      END ;

   5720  1 001045   001052 710000 1                  TRA     s:5727

      679     5721    9                                   WHENALTRETURN DO ;

      680     5722    9                                      DCT.DFLG.RELOAD = '1'B ;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:135  

   5722  1 001046   200007 470500                    LDP0    DCT$,,AUTO
         1 001047   004000 236007                    LDQ     2048,DL
         1 001050   000006 256100                    ORSQ    6,,PR0

      681     5723    9                                      EXIT RLOADIPC ;

   5723  1 001051   001056 710000 1                  TRA     s:5728

      682     5724    9                                      END ;
      683     5725    8                                   END;

      684     5726    7                                END;

      685     5727    6                             END;

   5727  1 001052   200014 054100                    AOS     I,,AUTO
         1 001053   200014 235100                    LDA     I,,AUTO
         1 001054   000017 115007                    CMPA    15,DL
         1 001055   000765 604400 1                  TMOZ    s:5708

      686     5728    5                          CALL TMB$BUF_DEALLOC (IOS$,BUFX);

   5728  1 001056   200005 630500                    EPPR0   BUFX,,AUTO
         1 001057   200041 450500                    STP0    I+3,,AUTO
         1 001060   200015 631500                    EPPR1   IOS$,,AUTO
         1 001061   200040 451500                    STP1    I+2,,AUTO
         1 001062   200040 630500                    EPPR0   I+2,,AUTO
         1 001063   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001064   000000 701000 xent               TSX1    TMB$BUF_DEALLOC
         1 001065   000000 011000                    NOP     0

      687     5729    5                          END;

      688     5730    4                       IF DCT.MSG# ~= 0 THEN

   5730  1 001066   200007 470500                    LDP0    DCT$,,AUTO
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:136  
         1 001067   000027 720100                    LXL0    23,,PR0
         1 001070   001100 600000 1                  TZE     s:5732

      689     5731    4                          CALL OCI$MK_STTM ( DCT.MSG# ) ;

   5731  1 001071   200007 236100                    LDQ     DCT$,,AUTO
         1 001072   000011 036000 2                  ADLQ    9
         1 001073   200040 756100                    STQ     I+2,,AUTO
         1 001074   200040 630500                    EPPR0   I+2,,AUTO
         1 001075   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001076   000000 701000 xent               TSX1    OCI$MK_STTM
         1 001077   000000 011000                    NOP     0

      690     5732    4                       IF DCT.DFLG.RELOAD THEN

   5732  1 001100   200007 470500                    LDP0    DCT$,,AUTO
         1 001101   000006 236100                    LDQ     6,,PR0
         1 001102   004000 316007                    CANQ    2048,DL
         1 001103   001107 600000 1                  TZE     s:5735

      691     5733    4                          OCI$MSG = ENTADDR ( OCI$MK_WRTM ) ;

   5733  1 001104   000000 636000 xent               EAQ     OCI$MK_WRTM
         1 001105   200024 756100                    STQ     OCI$MSG,,AUTO
         1 001106   001111 710000 1                  TRA     s:5736

      692     5734    4                       ELSE
      693     5735    4                          OCI$MSG = ENTADDR ( OCI$MK_WR ) ;

   5735  1 001107   000000 636000 xent               EAQ     OCI$MK_WR
         1 001110   200024 756100                    STQ     OCI$MSG,,AUTO

      694     5736    4                       CALL OCI$MSG ( M_DEVC, FWL_MSG#, 1, '001'O,

   5736  1 001111   000006 236100                    LDQ     6,,PR0
         1 001112   000013 772000                    QRL     11
         1 001113   000001 376007                    ANQ     1,DL
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:137  
         1 001114   000033 736000                    QLS     27
         1 001115   200040 756100                    STQ     I+2,,AUTO
         1 001116   000006 236100                    LDQ     6,,PR0
         1 001117   000025 772000                    QRL     21
         1 001120   200044 756100                    STQ     I+6,,AUTO
         1 001121   200040 236100                    LDQ     I+2,,AUTO
         1 001122   200042 552140                    STBQ    I+4,'40'O,AUTO
         1 001123   200044 236100                    LDQ     I+6,,AUTO
         1 001124   200046 756100                    STQ     I+8,,AUTO
         1 001125   200007 236100                    LDQ     DCT$,,AUTO
         1 001126   000011 036000 2                  ADLQ    9
         1 001127   000001 235000 xsym               LDA     B_VECTNIL+1
         1 001130   200056 757100                    STAQ    I+16,,AUTO
         1 001131   200046 631500                    EPPR1   I+8,,AUTO
         1 001132   200055 451500                    STP1    I+15,,AUTO
         1 001133   200042 633500                    EPPR3   I+4,,AUTO
         1 001134   200054 453500                    STP3    I+14,,AUTO
         1 001135   000014 237000 2                  LDAQ    12
         1 001136   200052 757100                    STAQ    I+12,,AUTO
         1 001137   000016 237000 2                  LDAQ    14
         1 001140   200050 757100                    STAQ    I+10,,AUTO
         1 001141   200050 630500                    EPPR0   I+10,,AUTO
         1 001142   200024 220100                    LDX0    OCI$MSG,,AUTO
         1 001143   000026 631400 xsym               EPPR1   B_VECTNIL+22
         1 001144   000000 701010                    TSX1    0,X0
         1 001145   000000 011000                    NOP     0

      695     5737    4                         BINBIT(BITBIN(DCT.DFLG.RELOAD),9),
      696     5738    4                         BINBIT(DCT.DCTX,36), /* WSN */,
      697     5739    4                         DCT.MSG# ) ;
      698     5740    4                       CALL NIA$FWLOAD(DCT,EL_FWLOAD);

   5740  1 001146   000021 236000 2                  LDQ     17
         1 001147   200007 235100                    LDA     DCT$,,AUTO
         1 001150   200040 757100                    STAQ    I+2,,AUTO
         1 001151   200040 630500                    EPPR0   I+2,,AUTO
         1 001152   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:138  
         1 001153   000000 701000 xent               TSX1    NIA$FWLOAD
         1 001154   000000 011000                    NOP     0

      699     5741    4                       END;

   5741  1 001155   001160 710000 1                  TRA     s:5745

      700     5742    4                    ELSE DO;               /* still booting - don't load IPCs */

      701     5743    4                       DCT.DFLG.RELOAD = '0'B;

   5743  1 001156   000001 236000 2                  LDQ     1
         1 001157   000006 356100                    ANSQ    6,,PR0

      702     5744    4                       END;

      703     5745    3                    IF NOT DCT.DFLG.RELOAD THEN

   5745  1 001160   200007 470500                    LDP0    DCT$,,AUTO
         1 001161   000006 236100                    LDQ     6,,PR0
         1 001162   004000 316007                    CANQ    2048,DL
         1 001163   001170 601000 1                  TNZ     s:5747

      704     5746    3                       CALL NIW$MPCSTART (DCT);

   5746  1 001164   200007 630500                    EPPR0   DCT$,,AUTO
         1 001165   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001166   000000 701000 xent               TSX1    NIW$MPCSTART
         1 001167   000000 011000                    NOP     0

      705     5747    3                    DCT.DFLG.RELOAD = '0'B;

   5747  1 001170   200007 470500                    LDP0    DCT$,,AUTO
         1 001171   000001 236000 2                  LDQ     1
         1 001172   000006 356100                    ANSQ    6,,PR0

      706     5748    3                    DCT.DFLG.MPCBUSY = '0'B;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:139  

   5748  1 001173   000022 236000 2                  LDQ     18
         1 001174   000006 356100                    ANSQ    6,,PR0

      707     5749    3                    DCT.DFLG.MPCSUSPENDED = '0'B;

   5749  1 001175   000023 236000 2                  LDQ     19
         1 001176   000006 356100                    ANSQ    6,,PR0

      708     5750    3                    RETURN;

   5750  1 001177   000000 702200 xent               TSX2  ! X66_ARET

      709     5751    3                    END;
      710     5752    3                 ELSE DO;

      711     5753    3                    CALL NIQ$GETS(IOS$) ALTRET(NOFW);

   5753  1 001200   200015 631500                    EPPR1   IOS$,,AUTO
         1 001201   200040 451500                    STP1    I+2,,AUTO
         1 001202   200040 630500                    EPPR0   I+2,,AUTO
         1 001203   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001204   000000 701000 xent               TSX1    NIQ$GETS
         1 001205   001600 702000 1                  TSX2    NOFW

      712     5754    3                    DCT.DQH$->DQH.MBX$=PINCRW(IOS$,%IMX_MBX_OFFSET);

   5754  1 001206   200007 470500                    LDP0    DCT$,,AUTO
         1 001207   000023 471500                    LDP1    19,,PR0
         1 001210   200015 236100                    LDQ     IOS$,,AUTO
         1 001211   000010 036003                    ADLQ    8,DU
         1 001212   100021 756100                    STQ     17,,PR1

      713     5755    3                    CALL NIS$MASK(DCT.DQH$->DQH,%IMX_CCW_RSO);

   5755  1 001213   000023 471500                    LDP1    19,,PR0
         1 001214   000024 236000 2                  LDQ     20
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:140  
         1 001215   200041 756100                    STQ     I+3,,AUTO
         1 001216   200040 451500                    STP1    I+2,,AUTO
         1 001217   200040 630500                    EPPR0   I+2,,AUTO
         1 001220   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001221   000000 701000 xent               TSX1    NIS$MASK
         1 001222   000000 011000                    NOP     0

      714     5756    3                    CALL NIQ$RELS(IOS$);

   5756  1 001223   200015 630500                    EPPR0   IOS$,,AUTO
         1 001224   200040 450500                    STP0    I+2,,AUTO
         1 001225   200040 630500                    EPPR0   I+2,,AUTO
         1 001226   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001227   000000 701000 xent               TSX1    NIQ$RELS
         1 001230   000000 011000                    NOP     0

      715     5757    3                    END;

   5757  1 001231   001264 710000 1                  TRA     s:5766

      716     5758    3              ELSE DO;

      717     5759    4                 IF NOT REQ.IOFLG.IOS THEN DO;

   5759  1 001232   200026 471500                    LDP1    REQ$,,AUTO
         1 001233   100004 236100                    LDQ     4,,PR1
         1 001234   040000 316007                    CANQ    16384,DL
         1 001235   001250 601000 1                  TNZ     s:5763

      718     5760    4                    CALL NIQ$GETS(REQ.IOS$) ALTRET (NOFW);

   5760  1 001236   200026 236100                    LDQ     REQ$,,AUTO
         1 001237   000012 036003                    ADLQ    10,DU
         1 001240   200040 756100                    STQ     I+2,,AUTO
         1 001241   200040 630500                    EPPR0   I+2,,AUTO
         1 001242   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001243   000000 701000 xent               TSX1    NIQ$GETS
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:141  
         1 001244   001600 702000 1                  TSX2    NOFW

      719     5761    4                    REQ.IOFLG.IOS = '1'B;

   5761  1 001245   200026 470500                    LDP0    REQ$,,AUTO
         1 001246   040000 236007                    LDQ     16384,DL
         1 001247   000004 256100                    ORSQ    4,,PR0

      720     5762    4                    END;

      721     5763    3                 DCT.DQH$->DQH.IO$ = REQ$;

   5763  1 001250   200007 470500                    LDP0    DCT$,,AUTO
         1 001251   000023 471500                    LDP1    19,,PR0
         1 001252   200026 236100                    LDQ     REQ$,,AUTO
         1 001253   100014 756100                    STQ     12,,PR1

      722     5764    3                 CALL NIS$MASK(DCT.DQH$->DQH,%IMX_CCW_RSO);

   5764  1 001254   000023 471500                    LDP1    19,,PR0
         1 001255   000024 236000 2                  LDQ     20
         1 001256   200041 756100                    STQ     I+3,,AUTO
         1 001257   200040 451500                    STP1    I+2,,AUTO
         1 001260   200040 630500                    EPPR0   I+2,,AUTO
         1 001261   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001262   000000 701000 xent               TSX1    NIS$MASK
         1 001263   000000 011000                    NOP     0

      723     5765    3                 END;

      724     5766    2              IF HW_IMX THEN

   5766  1 001264   000000 234000 xsym               SZN     HW_IMX
         1 001265   001271 605000 1                  TPL     s:5768

      725     5767    2                 WAITTIME=13000000;   /* This is approx 10 seconds on the 8000 */

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:142  
   5767  1 001266   000010 235000 2                  LDA     8
         1 001267   200031 755100                    STA     WAITTIME,,AUTO
         1 001270   001302 710000 1                  TRA     s:5772

      726     5768    2              ELSE IF DCT.MPC.FWNAME = 'MSP8' THEN

   5768  1 001271   200007 470500                    LDP0    DCT$,,AUTO
         1 001272   000041 236100                    LDQ     33,,PR0
         1 001273   000002 116000 0                  CMPQ    2
         1 001274   001300 601000 1                  TNZ     s:5771

      727     5769    2                    WAITTIME=4000000;

   5769  1 001275   000025 235000 2                  LDA     21
         1 001276   200031 755100                    STA     WAITTIME,,AUTO
         1 001277   001302 710000 1                  TRA     s:5772

      728     5770    2                 ELSE
      729     5771    2                    WAITTIME=10000;

   5771  1 001300   023420 235007                    LDA     10000,DL
         1 001301   200031 755100                    STA     WAITTIME,,AUTO

      730     5772    3              DO I=1 TO WAITTIME;          /* WAIT A WHILE */

   5772  1 001302   000001 236007                    LDQ     1,DL
         1 001303   200014 756100                    STQ     I,,AUTO
         1 001304   001306 710000 1                  TRA     s:5773+1

      731     5773    3                 END;

   5773  1 001305   200014 054100                    AOS     I,,AUTO
         1 001306   200014 236100                    LDQ     I,,AUTO
         1 001307   200031 116100                    CMPQ    WAITTIME,,AUTO
         1 001310   001305 604400 1                  TMOZ    s:5773

      732     5774    2              FW.IDCW='100000700000'O;     /* "CONTROL STORE OVERLAY" IDCW */
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:143  

   5774  1 001311   000003 236000 0                  LDQ     3
         1 001312   200012 470500                    LDP0    FW$,,AUTO
         1 001313   000006 756100                    STQ     6,,PR0

      733     5775    2              FW.DCW='0'B;

   5775  1 001314   000100 100400                    MLR     fill='000'O
         1 001315   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 001316   000007 000020                    ADSC9   7,,PR0                   cn=0,n=16

      734     5776    2              I=0;

   5776  1 001317   200014 450100                    STZ     I,,AUTO

      735     5777    3              DO WHILE(FW.FWOL(0)>I);

   5777  1 001320   000003 236100                    LDQ     3,,PR0
         1 001321   000022 772000                    QRL     18
         1 001322   200014 116100                    CMPQ    I,,AUTO
         1 001323   001415 604400 1                  TMOZ    s:5789

      736     5778    3                 FW.DCW.FWA(I/%DCWTALLYMAX)=POFFW(ADDR(FW.FW),REQ.BUF$)+I;

   5778  1 001324   200014 236100                    LDQ     I,,AUTO
         1 001325   010000 506007                    DIV     4096,DL
         1 001326   200040 756100                    STQ     I+2,,AUTO
         1 001327   200012 236100                    LDQ     FW$,,AUTO
         1 001330   000013 036003                    ADLQ    11,DU
         1 001331   000022 772000                    QRL     18
         1 001332   200026 470500                    LDP0    REQ$,,AUTO
         1 001333   200041 756100                    STQ     I+3,,AUTO
         1 001334   000005 236100                    LDQ     5,,PR0
         1 001335   000022 772000                    QRL     18
         1 001336   200042 756100                    STQ     I+4,,AUTO
         1 001337   200041 236100                    LDQ     I+3,,AUTO
         1 001340   200042 136100                    SBLQ    I+4,,AUTO
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:144  
         1 001341   200014 036100                    ADLQ    I,,AUTO
         1 001342   000000 620006                    EAX0    0,QL
         1 001343   200012 471500                    LDP1    FW$,,AUTO
         1 001344   200040 721100                    LXL1    I+2,,AUTO
         1 001345   100007 740111                    STX0    7,X1,PR1

      737     5779    4                 IF FW.FWOL(0)-I<=%DCWTALLYMAX THEN DO;

   5779  1 001346   100003 236100                    LDQ     3,,PR1
         1 001347   000022 772000                    QRL     18
         1 001350   200014 136100                    SBLQ    I,,AUTO
         1 001351   010000 116007                    CMPQ    4096,DL
         1 001352   001373 605400 1                  TPNZ    s:5784

      738     5780    4                    FW.DCW.TYPE(I/%DCWTALLYMAX)=%DCW_IOTD;

   5780  1 001353   200014 236100                    LDQ     I,,AUTO
         1 001354   010000 506007                    DIV     4096,DL
         1 001355   000000 620006                    EAX0    0,QL
         1 001356   000026 236000 2                  LDQ     22
         1 001357   100007 356110                    ANSQ    7,X0,PR1

      739     5781    4                    FW.DCW.TALLY(I/%DCWTALLYMAX)=FW.FWOL(0)-I;

   5781  1 001360   200014 236100                    LDQ     I,,AUTO
         1 001361   010000 506007                    DIV     4096,DL
         1 001362   200040 756100                    STQ     I+2,,AUTO
         1 001363   100003 236100                    LDQ     3,,PR1
         1 001364   000022 772000                    QRL     18
         1 001365   200014 136100                    SBLQ    I,,AUTO
         1 001366   200040 720100                    LXL0    I+2,,AUTO
         1 001367   100007 676110                    ERQ     7,X0,PR1
         1 001370   007777 376007                    ANQ     4095,DL
         1 001371   100007 656110                    ERSQ    7,X0,PR1

      740     5782    4                    END;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:145  
   5782  1 001372   001407 710000 1                  TRA     s:5787

      741     5783    4                 ELSE DO;

      742     5784    4                    FW.DCW.TYPE(I/%DCWTALLYMAX)=%DCW_IOTP;

   5784  1 001373   200014 236100                    LDQ     I,,AUTO
         1 001374   010000 506007                    DIV     4096,DL
         1 001375   000000 620006                    EAX0    0,QL
         1 001376   100007 236106                    LDQ     7,QL,PR1
         1 001377   000026 376000 2                  ANQ     22
         1 001400   010000 276007                    ORQ     4096,DL
         1 001401   100007 756110                    STQ     7,X0,PR1

      743     5785    4                    FW.DCW.TALLY(I/%DCWTALLYMAX)=0;

   5785  1 001402   200014 236100                    LDQ     I,,AUTO
         1 001403   010000 506007                    DIV     4096,DL
         1 001404   000000 620006                    EAX0    0,QL
         1 001405   000027 236000 2                  LDQ     23
         1 001406   100007 356110                    ANSQ    7,X0,PR1

      744     5786    4                    END;

      745     5787    3                 I=I+%DCWTALLYMAX;

   5787  1 001407   010000 236007                    LDQ     4096,DL
         1 001410   200014 056100                    ASQ     I,,AUTO

      746     5788    3                 END;

   5788  1 001411   100003 236100                    LDQ     3,,PR1
         1 001412   000022 772000                    QRL     18
         1 001413   200014 116100                    CMPQ    I,,AUTO
         1 001414   001324 605400 1                  TPNZ    s:5778

      747     5789    3              IF LDFW.CALLIOQ THEN DO;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:146  

   5789  1 001415   200026 470500                    LDP0    REQ$,,AUTO
         1 001416   000025 234100                    SZN     21,,PR0
         1 001417   001433 605000 1                  TPL     LDFW2

      748     5790    3   CALLIOQ:
      749     5791    3                 CALL NIO$QUE(REQ) ALTRET(NOQPKTS);

   5791  1 001420   200026 630500       CALLIOQ      EPPR0   REQ$,,AUTO
         1 001421   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001422   000000 701000 xent               TSX1    NIO$QUE
         1 001423   001476 702000 1                  TSX2    NOQPKTS

      750     5792    3                 END;

      751     5793    2              END/* IF STOPPED */;

   5793  1 001424   001433 710000 1                  TRA     LDFW2

      752     5794    2           ELSE IF NOT LDFW.CALLIOQ THEN DO;

   5794  1 001425   200026 471500                    LDP1    REQ$,,AUTO
         1 001426   100025 234100                    SZN     21,,PR1
         1 001427   001433 604000 1                  TMI     LDFW2

      753     5795    2                 LDFW.CALLIOQ='1'B;

   5795  1 001430   400000 236003                    LDQ     -131072,DU
         1 001431   100025 256100                    ORSQ    21,,PR1

      754     5796    2                 ALTRETURN;

   5796  1 001432   000000 702200 xent               TSX2  ! X66_AALT

      755     5797    2                 END;
      756     5798    2   LDFW2:  IF WAIT THEN DO;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:147  
   5798  1 001433   200004 470500       LDFW2        LDP0    @WAIT,,AUTO
         1 001434   000000 234100                    SZN     0,,PR0
         1 001435   001475 605000 1                  TPL     s:5810

      757     5799    3              DO WHILE (DCT.DFLG.MPCBUSY);

   5799  1 001436   200007 471500                    LDP1    DCT$,,AUTO
         1 001437   100006 236100                    LDQ     6,,PR1
         1 001440   000400 316007                    CANQ    256,DL
         1 001441   001450 600000 1                  TZE     s:5802

      758     5800    3                 I=1;

   5800  1 001442   000001 235007                    LDA     1,DL
         1 001443   200014 755100                    STA     I,,AUTO

      759     5801    3                 END;

   5801  1 001444   200007 470500                    LDP0    DCT$,,AUTO
         1 001445   000006 236100                    LDQ     6,,PR0
         1 001446   000400 316007                    CANQ    256,DL
         1 001447   001442 601000 1                  TNZ     s:5800

      760     5802    3              IF REQ.TYC~=%TYC_EGV THEN DO;

   5802  1 001450   200026 470500                    LDP0    REQ$,,AUTO
         1 001451   000021 236100                    LDQ     17,,PR0
         1 001452   000030 116000 xsym               CMPQ    B_VECTNIL+24
         1 001453   001465 600000 1                  TZE     s:5807

      761     5803    3                 REQ.IOQFLG.IOQUED = '0'B ;

   5803  1 001454   000030 236000 2                  LDQ     24
         1 001455   000033 356100                    ANSQ    27,,PR0

      762     5804    3                 CALL NIQ$REL(REQ$);

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:148  
   5804  1 001456   200026 631500                    EPPR1   REQ$,,AUTO
         1 001457   200040 451500                    STP1    I+2,,AUTO
         1 001460   200040 630500                    EPPR0   I+2,,AUTO
         1 001461   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001462   000000 701000 xent               TSX1    NIQ$REL
         1 001463   000000 011000                    NOP     0

      763     5805    3                 ALTRETURN;

   5805  1 001464   000000 702200 xent               TSX2  ! X66_AALT

      764     5806    3                 END/* IF REQ.TYC */;
      765     5807    2              REQ.IOQFLG.IOQUED = '0'B ;

   5807  1 001465   000030 236000 2                  LDQ     24
         1 001466   000033 356100                    ANSQ    27,,PR0

      766     5808    2              CALL NIQ$REL(REQ$);

   5808  1 001467   200026 631500                    EPPR1   REQ$,,AUTO
         1 001470   200040 451500                    STP1    I+2,,AUTO
         1 001471   200040 630500                    EPPR0   I+2,,AUTO
         1 001472   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001473   000000 701000 xent               TSX1    NIQ$REL
         1 001474   000000 011000                    NOP     0

      767     5809    2              END/* IF WAIT */;

      768     5810    1           RETURN;

   5810  1 001475   000000 702200 xent               TSX2  ! X66_ARET

   5807  1 001476                       NOQPKTS      null
      769     5811        /**/
      770     5812    1   NOQPKTS: ;
      771     5813    2           IF DCT.MPC.FW$=B$FIRM$ THEN DO;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:149  
   5813  1 001476   200007 470500                    LDP0    DCT$,,AUTO
         1 001477   000030 236100                    LDQ     24,,PR0
         1 001500   000000 116000 xsym               CMPQ    B$FIRM$
         1 001501   001600 601000 1                  TNZ     NOFW

      772     5814    2              VPNO=%FIRMWREPG+8;

   5814  1 001502   001020 235007                    LDA     528,DL
         1 001503   200030 755100                    STA     VPNO,,AUTO

      773     5815    3              DO NEVER;

   5815  1 001504   001513 710000 1                  TRA     NOMEM

      774     5816    3   CVMERR:
      775     5817    3                 CALL MMB$FPP(PPNO);

   5817  1 001505   200025 630500       CVMERR       EPPR0   PPNO,,AUTO
         1 001506   200040 450500                    STP0    I+2,,AUTO
         1 001507   200040 630500                    EPPR0   I+2,,AUTO
         1 001510   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001511   000000 701000 xent               TSX1    MMB$FPP
         1 001512   000000 011000                    NOP     0

      776     5818    3                 END/* WHILE '0'B */;

      777     5819    2   NOMEM:
      778     5820    3              DO I=%FIRMWREPG TO VPNO-1;

   5820  1 001513   001010 235007       NOMEM        LDA     520,DL
         1 001514   200014 755100                    STA     I,,AUTO
         1 001515   001551 710000 1                  TRA     s:5824+1

      779     5821    3                 PPNO=B$MPT$->B$MAP.RPN(I);

   5821  1 001516   000000 470400 xsym               LDP0    B$MPT$
         1 001517   200014 720100                    LXL0    I,,AUTO
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:150  
         1 001520   000000 236110                    LDQ     0,X0,PR0
         1 001521   000022 772000                    QRL     18
         1 001522   200025 756100                    STQ     PPNO,,AUTO

      780     5822    3                 CALL MME$CVM(%MONWSQ,I,-1,ERRWD);

   5822  1 001523   200011 631500                    EPPR1   ERRWD,,AUTO
         1 001524   200043 451500                    STP1    I+5,,AUTO
         1 001525   000031 236000 2                  LDQ     25
         1 001526   200042 756100                    STQ     I+4,,AUTO
         1 001527   200014 633500                    EPPR3   I,,AUTO
         1 001530   200041 453500                    STP3    I+3,,AUTO
         1 001531   000005 236000 2                  LDQ     5
         1 001532   200040 756100                    STQ     I+2,,AUTO
         1 001533   200040 630500                    EPPR0   I+2,,AUTO
         1 001534   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 001535   000000 701000 xent               TSX1    MME$CVM
         1 001536   000000 011000                    NOP     0

      781     5823    3                 IF LDFW.SEGSIZE~=0 THEN CALL MMB$FPP(PPNO);

   5823  1 001537   200026 470500                    LDP0    REQ$,,AUTO
         1 001540   000024 720100                    LXL0    20,,PR0
         1 001541   001550 600000 1                  TZE     s:5824

   5823  1 001542   200025 631500                    EPPR1   PPNO,,AUTO
         1 001543   200040 451500                    STP1    I+2,,AUTO
         1 001544   200040 630500                    EPPR0   I+2,,AUTO
         1 001545   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001546   000000 701000 xent               TSX1    MMB$FPP
         1 001547   000000 011000                    NOP     0

      782     5824    3                 END;

   5824  1 001550   200014 054100                    AOS     I,,AUTO
         1 001551   200014 236100                    LDQ     I,,AUTO
         1 001552   200030 116100                    CMPQ    VPNO,,AUTO
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:151  
         1 001553   001516 604000 1                  TMI     s:5821

      783     5825                   %LOCK(G#=NI_FWGATE);

   5826  1 001554   000003 630400 2                  EPPR0   3
         1 001555   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001556   000000 701000 xent               TSX1    HFC$LOCK
         1 001557   000000 011000                    NOP     0

      784     5828    2              B$LS$->B$MLNK.FIRM.FLGS=B$LS$->B$MLNK.FIRM.FLGS&~%DSNULL;

   5828  1 001560   000000 470400 xsym               LDP0    B$LS$
         1 001561   000336 236100                    LDQ     222,,PR0
         1 001562   000024 736000                    QLS     20
         1 001563   777000 376003                    ANQ     -512,DU
         1 001564   775000 376003                    ANQ     -1536,DU
         1 001565   000024 772000                    QRL     20
         1 001566   000336 676100                    ERQ     222,,PR0
         1 001567   177600 376007                    ANQ     65408,DL
         1 001570   000336 656100                    ERSQ    222,,PR0

      785     5829    2   MEMBUSY:
      786     5830                   %UNLOCK(G#=NI_FWGATE);

   5831  1 001571   000003 630400 2     MEMBUSY      EPPR0   3
         1 001572   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001573   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001574   000000 011000                    NOP     0

      787     5833    2              DCT.MPC.FW$=ADDR(NIL);

   5833  1 001575   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001576   200007 470500                    LDP0    DCT$,,AUTO
         1 001577   000030 756100                    STQ     24,,PR0

      788     5834    2              END/* IF LDFW.SEGSIZE */;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:152  
      789     5835    1   NOFW:
      790     5836    1           REQ.IOQFLG.IOQUED = '0'B ;

   5836  1 001600   200026 470500       NOFW         LDP0    REQ$,,AUTO
         1 001601   000030 236000 2                  LDQ     24
         1 001602   000033 356100                    ANSQ    27,,PR0

      791     5837    1           CALL NIQ$REL(REQ$);

   5837  1 001603   200026 631500                    EPPR1   REQ$,,AUTO
         1 001604   200040 451500                    STP1    I+2,,AUTO
         1 001605   200040 630500                    EPPR0   I+2,,AUTO
         1 001606   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001607   000000 701000 xent               TSX1    NIQ$REL
         1 001610   000000 011000                    NOP     0

      792     5838    1   NOQPKT:
      793     5839    1           SQH$=DCT.SQH$;

   5839  1 001611   200007 470500       NOQPKT       LDP0    DCT$,,AUTO
         1 001612   000022 236100                    LDQ     18,,PR0
         1 001613   200027 756100                    STQ     SQH$,,AUTO

      794     5840                %LOCK(G#=SQH.GATE);

   5841  1 001614   200027 630500                    EPPR0   SQH$,,AUTO
         1 001615   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001616   000000 701000 xent               TSX1    HFC$LOCK
         1 001617   000000 011000                    NOP     0

      795     5843    1           DCT.DFLG.MPCBUSY='0'B;

   5843  1 001620   200007 470500                    LDP0    DCT$,,AUTO
         1 001621   000022 236000 2                  LDQ     18
         1 001622   000006 356100                    ANSQ    6,,PR0

      796     5844    1   T@DHASMPC:
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:153  
      797     5845                %UNLOCK(G#=SQH.GATE);

   5846  1 001623   200027 630500       T@DHASMPC    EPPR0   SQH$,,AUTO
         1 001624   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001625   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001626   000000 011000                    NOP     0

      798     5848    1           CALL OCI$MK_WR(M_DEVC,FWL_MSG#,1,'001'O,'001'O,BINBIT(DCT.DCTX,36));

   5848  1 001627   200007 470500                    LDP0    DCT$,,AUTO
         1 001630   000006 236100                    LDQ     6,,PR0
         1 001631   000025 772000                    QRL     21
         1 001632   200040 756100                    STQ     I+2,,AUTO
         1 001633   200040 631500                    EPPR1   I+2,,AUTO
         1 001634   200047 451500                    STP1    I+9,,AUTO
         1 001635   000015 236000 2                  LDQ     13
         1 001636   200046 756100                    STQ     I+8,,AUTO
         1 001637   000014 237000 2                  LDAQ    12
         1 001640   200044 757100                    STAQ    I+6,,AUTO
         1 001641   000016 237000 2                  LDAQ    14
         1 001642   200042 757100                    STAQ    I+4,,AUTO
         1 001643   200042 630500                    EPPR0   I+4,,AUTO
         1 001644   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 001645   000000 701000 xent               TSX1    OCI$MK_WR
         1 001646   000000 011000                    NOP     0

      799     5849    1           ALTRETURN;

   5849  1 001647   000000 702200 xent               TSX2  ! X66_AALT

      800     5850        %EJECT;
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:154  
      801     5851    1   GETFWX: PROC(START,FX,FNAME) ALTRET;

   5851  1 001650   200032 741300       GETFWX       STX1  ! WAITTIME+1,,AUTO

      802     5852    2   DCL START UBIN;
      803     5853    2   DCL FX UBIN;
      804     5854    2   DCL FNAME CHAR(4);
      805     5855    2   DCL I UBIN;
      806     5856        /**/
      807     5857    3           DO I=START TO 19;

   5857  1 001651   200033 470500                    LDP0    @START,,AUTO
         1 001652   000000 235100                    LDA     0,,PR0
         1 001653   200036 755100                    STA     I,,AUTO
         1 001654   001675 710000 1                  TRA     s:5862+3

      808     5858    4              IF FNAME=IT_SYSDIR$->I$DISKDIR.FW.NAME(I) THEN DO;

   5858  1 001655   200036 235100                    LDA     I,,AUTO
         1 001656   000004 735000                    ALS     4
         1 001657   200035 470500                    LDP0    @FNAME,,AUTO
         1 001660   000000 471400 xsym               LDP1    IT_SYSDIR$
         1 001661   040105 106500                    CMPC    fill='040'O
         1 001662   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 001663   100243 000004                    ADSC9   163,A,PR1                cn=0,n=4
         1 001664   001672 601000 1                  TNZ     s:5862

      809     5859    4                 FX=I;

   5859  1 001665   200034 473500                    LDP3    @FX,,AUTO
         1 001666   200036 236100                    LDQ     I,,AUTO
         1 001667   300000 756100                    STQ     0,,PR3

      810     5860    4                 RETURN;

   5860  1 001670   200032 221300                    LDX1  ! WAITTIME+1,,AUTO
         1 001671   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:155  

      811     5861    4                 END;
      812     5862    3              END;

   5862  1 001672   200036 236100                    LDQ     I,,AUTO
         1 001673   000001 036007                    ADLQ    1,DL
         1 001674   200036 756100                    STQ     I,,AUTO
         1 001675   200036 235100                    LDA     I,,AUTO
         1 001676   000024 115007                    CMPA    20,DL
         1 001677   001655 602000 1                  TNC     s:5858

      813     5863    2           ALTRETURN;

   5863  1 001700   200032 221300                    LDX1  ! WAITTIME+1,,AUTO
         1 001701   000000 702211                    TSX2  ! 0,X1

(unnamed)
 Sect OctLoc
   0     000   116117 116105   630000 000000   115123 120070   100000 700000    NONE....MSP8@...

(unnamed)
 Sect OctLoc
   2     000   777777 776777   777777 773777   000002 006000   000000 006000    ................
   2     004   037777 600000   000003 006000   000007 777777   000004 006000    ................
   2     010   000061 456500   000027 400000   100000 000000   000000 000225    .1......@.......
   2     014   000003 006000   000033 006000   000012 006000   000013 006000    ................
   2     020   000000 000155   000020 006000   777777 777377   777777 775777    ...m............
   2     024   000001 006000   000017 204400   777777 707777   777777 770000    ................
   2     030   577777 777777   000027 006000                                    ........
      814     5864    2   END GETFWX;
      815     5865    1   END NIW$LDFW;
      816     5866        %EOD;

PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:156  
--  Include file information  --

   TM_DATA_M.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   I$DISK.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure NIW$LDFW.
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:157  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    35-0-0/w PTR         r     1 @FNAME                    34-0-0/w PTR         r     1 @FX
     3-0-0/w PTR         r     1 @PAR                      33-0-0/w PTR         r     1 @START
     4-0-0/w PTR         r     1 @WAIT                      5-0-0/w SBIN        r     1 BUFX
     6-0-0/w SBIN        r     1 CRPX                       7-0-0/w PTR         r     1 DCT$
    10-0-0/w PTR         r     1 DQH$                      11-0-0/w SBIN        r     1 ERRWD
    *0-0-0/c CHAR(4)     r     1 FNAME                     12-0-0/w PTR         r     1 FW$
    13-0-0/w SBIN        r     1 FWX                       *0-0-0/w UBIN        r     1 FX
    14-0-0/w SBIN        r     1 I                         36-0-0/w UBIN        r     1 I
    15-0-0/w PTR         r     1 IOS$
    16-0-0/w STRC        r     1 IPC_TBL(0:3)
    22-0-0/w SBIN        r     1 J                         23-0-0/w SBIN        r     1 LPX
    24-0-0/w EPTR        r     1 OCI$MSG                   *0-0-0/w SBIN        r     1 PAR
    25-0-0/w SBIN        r     1 PPNO                      26-0-0/w PTR         r     1 REQ$
    27-0-0/w PTR         r     1 SQH$                      *0-0-0/w UBIN        r     1 START
    30-0-0/w SBIN        r     1 VPNO                      *0-0-0/w BIT         r     1 WAIT
    31-0-0/w SBIN        r     1 WAITTIME

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$FIRM$                    0-0-0/w PTR         r     1 B$LS$
     0-0-0/w PTR         r     1 B$MPT$                     0-0-0/w BIT         r     1 HW_IMX
     0-0-0/w BIT         r     1 HW_LOAD_FW                 0-0-0/w UBIN        r     1 IT_CP6UP
     0-0-0/w STRC(1800)  r     1 IT_PARTITION               0-0-0/w PTR         r     1 IT_SYSDIR$
     0-0-0/w SBIN        r     1 IT_SYSDISK                 0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 N$FQ$                      0-0-0/w PTR         r     1 NI$CHT$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/w BIT (72)    r     1 NI_FWGATE
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:158  

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 B$MAP(0:1023)              0-0-0/d STRC(10368) r     1 B$MLNK
     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w STRC(648)   r     1 DQH
     0-0-0/d STRC(432)   r     1 FW                         0-0-0/w STRC(8640)  r     1 I$DISKDIR
     0-0-0/w STRC(72)    r     1 LDFW                       0-0-0/w PTR         r     1 N$DCT$(0:0)
     0-0-0/w STRC(72)    r     1 NI$CHT(0:127)              0-0-0/d STRC(1080)  r     1 REQ
     0-0-0/w STRC(252)   r     1 SQH


   Procedure NIW$LDFW requires 962 words for executable code.
   Procedure NIW$LDFW requires 48 words of local(AUTO) storage.
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:159  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:160  
          MINI XREF LISTING

B$FIRM$
      4513**DCL      5611>>ASSIGN   5612>>ASSIGN   5813>>IF
B$LS$
      4514**DCL      5617>>IF       5618>>ASSIGN   5619>>ASSIGN   5619>>ASSIGN   5828>>ASSIGN   5828>>ASSIGN
B$MAP.RPN
       595**DCL      5821>>ASSIGN
B$MAP.SCTRL
       596**DCL       597--REDEF
B$MLNK.FIRM.BOUND
      5275**DCL      5618<<ASSIGN
B$MLNK.FIRM.FLGS
      5276**DCL      5617>>IF       5619<<ASSIGN   5619>>ASSIGN   5828<<ASSIGN   5828>>ASSIGN
B$MPT$
      4515**DCL      5821>>ASSIGN
BUFX
      4530**DCL      5706<>CALL     5713<>CALL     5728<>CALL
CALLIOQ
      5791**LABEL    5665--GOTO
CRPX
      4531**DCL      5654<>CALL     5655>>ASSIGN   5656>>ASSIGN
CVMERR
      5817**LABEL    5641--CALLALT
DCT
      5379**DCL      5551<>CALL     5602<>CALL     5606<>CALL     5687<>CALL     5740<>CALL     5746<>CALL
DCT.CTYP
      5387**DCL      5588>>IF       5603>>IF       5701>>IF
DCT.DCTX
      5380**DCL      5599>>ASSIGN   5679>>ASSIGN   5736>>CALL     5848>>CALL
DCT.DFLG.MPCBUSY
      5384**DCL      5563>>IF       5583<<ASSIGN   5748<<ASSIGN   5799>>DOWHILE  5843<<ASSIGN
DCT.DFLG.MPCSTOP
      5384**DCL      5589<<ASSIGN   5607>>DOWHILE  5686<<ASSIGN   5699>>IF
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:161  
DCT.DFLG.MPCSUSPENDED
      5384**DCL      5749<<ASSIGN
DCT.DFLG.RELOAD
      5383**DCL      5590<<ASSIGN   5600<<ASSIGN   5685<<ASSIGN   5715<<ASSIGN   5722<<ASSIGN   5732>>IF
      5736>>CALL     5743<<ASSIGN   5745>>IF       5747<<ASSIGN
DCT.DP
      5399**DCL      5406--REDEF    5409--REDEF    5410--REDEF    5412--REDEF    5412--REDEF    5413--REDEF
      5414--REDEF    5414--REDEF
DCT.DQH$
      5395**DCL      5577<<ASSIGN   5696>>ASSIGN   5754>>ASSIGN   5755>>CALL     5763>>ASSIGN   5764>>CALL
DCT.MPC.ALTMPCX
      5408**DCL      5556>>IF       5557>>IF       5558>>ASSIGN   5605>>IF       5606>>CALL     5607>>DOWHILE
DCT.MPC.CRPCHANS
      5408**DCL      5653>>IF
DCT.MPC.CRPNAME
      5409**DCL      5654<>CALL
DCT.MPC.FW$
      5407**DCL      5610>>IF       5611<<ASSIGN   5680>>ASSIGN   5697>>ASSIGN   5813>>IF       5833<<ASSIGN
DCT.MPC.FWNAME
      5409**DCL      5550>>IF       5613<>CALL     5768>>IF
DCT.MPC.IOCHANX
      5407**DCL      5407--REDEF    5572>>ASSIGN   5708>>ASSIGN
DCT.MPC.LPCHANS
      5408**DCL      5648>>IF
DCT.MPC.LPNAME
      5409**DCL      5649<>CALL
DCT.MPC.REQ$
      5408**DCL      5591<<ASSIGN   5598<<ASSIGN   5676>>ASSIGN   5694>>ASSIGN
DCT.MPC.TYPE
      5407**DCL      5557>>IF
DCT.MSG#
      5399**DCL      5730>>IF       5731<>CALL     5736<>CALL
DCT.SQH$
      5394**DCL      5559>>ASSIGN   5698>>ASSIGN   5839>>ASSIGN
DCT.STATUS.DOWN
      5396**DCL      5557>>IF
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:162  
DCT.STATUS.TND
      5397**DCL      5569>>IF
DCT.TYPE
      5389**DCL      5555>>IF
DCT$
      4532**DCL      5379--IMP-PTR  5547<<ASSIGN   5550>>IF       5551>>CALL     5555>>IF       5556>>IF
      5557>>IF       5557>>IF       5558<<ASSIGN   5558>>ASSIGN   5559>>ASSIGN   5563>>IF       5569>>IF
      5572>>ASSIGN   5577>>ASSIGN   5583>>ASSIGN   5588>>IF       5589>>ASSIGN   5590>>ASSIGN   5591>>ASSIGN
      5598>>ASSIGN   5599>>ASSIGN   5600>>ASSIGN   5602>>CALL     5603>>IF       5605>>IF       5606>>CALL
      5607>>DOWHILE  5610>>IF       5611>>ASSIGN   5613>>CALL     5648>>IF       5649>>CALL     5653>>IF
      5654>>CALL     5675<<ASSIGN   5676>>ASSIGN   5679>>ASSIGN   5680>>ASSIGN   5685>>ASSIGN   5686>>ASSIGN
      5687>>CALL     5693<<ASSIGN   5694>>ASSIGN   5696>>ASSIGN   5697>>ASSIGN   5698>>ASSIGN   5699>>IF
      5701>>IF       5708>>ASSIGN   5715>>ASSIGN   5722>>ASSIGN   5730>>IF       5731>>CALL     5732>>IF
      5736>>CALL     5736>>CALL     5736>>CALL     5740>>CALL     5743>>ASSIGN   5745>>IF       5746>>CALL
      5747>>ASSIGN   5748>>ASSIGN   5749>>ASSIGN   5754>>ASSIGN   5755>>CALL     5763>>ASSIGN   5764>>CALL
      5768>>IF       5799>>DOWHILE  5813>>IF       5833>>ASSIGN   5839>>ASSIGN   5843>>ASSIGN   5848>>CALL
DQH
      5427**DCL      5713<>CALL     5755<>CALL     5764<>CALL
DQH.IO$
      5434**DCL      5763<<ASSIGN
DQH.IOCHANX
      5429**DCL      5430--REDEF    5574>>IF
DQH.LA
      5437**DCL      5710>>IF       5712>>ASSIGN
DQH.MBX$
      5438**DCL      5439--REDEF    5754<<ASSIGN
DQH.STATUS.DOWN
      5427**DCL      5574>>IF       5710>>IF
DQH$
      4533**DCL      5427--IMP-PTR  5572<<ASSIGN   5573>>IF       5574>>IF       5574>>IF       5577>>ASSIGN
      5708<<ASSIGN   5709>>IF       5710>>IF       5710>>IF       5712>>ASSIGN   5712>>ASSIGN   5713>>CALL
ERRWD
      4534**DCL      5627<>CALL     5641<>CALL     5822<>CALL
FNAME IN PROCEDURE GETFWX
      5854**DCL      5851--PROC     5858>>IF
FW
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:163  
      5442**DCL      5644<<ASSIGN
FW.CRPDA
      5442**DCL      5655<<ASSIGN
FW.DCW
      5444**DCL      5775<<ASSIGN
FW.DCW.FWA
      5444**DCL      5778<<ASSIGN
FW.DCW.TALLY
      5445**DCL      5781<<ASSIGN   5785<<ASSIGN
FW.DCW.TYPE
      5445**DCL      5780<<ASSIGN   5784<<ASSIGN
FW.FW
      5445**DCL      5661--ASSIGN   5778--ASSIGN
FW.FWDA
      5442**DCL      5645<<ASSIGN   5660>>ASSIGN
FW.FWOL
      5442**DCL      5630<<ASSIGN   5631<<ASSIGN   5632<<ASSIGN   5633<<ASSIGN   5646<<ASSIGN   5647<<ASSIGN
      5651<<ASSIGN   5656<<ASSIGN   5663>>ASSIGN   5663>>ASSIGN   5777>>DOWHILE  5779>>IF       5781>>ASSIGN
FW.IDCW
      5442**DCL      5681--ASSIGN   5683--ASSIGN   5774<<ASSIGN
FW.IDCW.EXTA
      5443**DCL      5443--REDEF
FW.LPDA
      5442**DCL      5650<<ASSIGN
FW$
      4535**DCL      5442--IMP-PTR  5612<<ASSIGN   5630>>ASSIGN   5631>>ASSIGN   5632>>ASSIGN   5633>>ASSIGN
      5644>>ASSIGN   5645>>ASSIGN   5646>>ASSIGN   5647>>ASSIGN   5650>>ASSIGN   5651>>ASSIGN   5655>>ASSIGN
      5656>>ASSIGN   5660>>ASSIGN   5661>>ASSIGN   5663>>ASSIGN   5663>>ASSIGN   5680<<ASSIGN   5681>>ASSIGN
      5681>>ASSIGN   5683>>ASSIGN   5697<<ASSIGN   5774>>ASSIGN   5775>>ASSIGN   5777>>DOWHILE  5778>>ASSIGN
      5778>>ASSIGN   5779>>IF       5780>>ASSIGN   5781>>ASSIGN   5781>>ASSIGN   5784>>ASSIGN   5785>>ASSIGN
FWX
      4536**DCL      5613<>CALL     5623>>IF       5625>>ASSIGN   5630>>ASSIGN   5631>>ASSIGN   5645>>ASSIGN
      5646>>ASSIGN   5647>>ASSIGN
FX IN PROCEDURE GETFWX
      5853**DCL      5851--PROC     5859<<ASSIGN
GETFWX
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:164  
      5851**PROC     5613--CALL     5649--CALL     5654--CALL
HFC$LOCK
      2402**DCL-ENT  5561--CALL     5615--CALL     5826--CALL     5841--CALL
HFC$UNLOCK
      2402**DCL-ENT  5565--CALL     5585--CALL     5621--CALL     5831--CALL     5846--CALL
HW_IMX
      2388**DCL      5588>>IF       5603>>IF       5700>>IF       5766>>IF
HW_LOAD_FW
      2384**DCL      5550>>IF
I
      4537**DCL      5571<<DOINDEX  5572>>ASSIGN   5703<<DOINDEX  5704>>ASSIGN   5707<<DOINDEX  5708>>ASSIGN
      5772<<DOINDEX  5776<<ASSIGN   5777>>DOWHILE  5778>>ASSIGN   5778>>ASSIGN   5779>>IF       5780>>ASSIGN
      5781>>ASSIGN   5781>>ASSIGN   5784>>ASSIGN   5785>>ASSIGN   5787<<ASSIGN   5787>>ASSIGN   5800<<ASSIGN
      5820<<DOINDEX  5821>>ASSIGN   5822<>CALL
I IN PROCEDURE GETFWX
      5855**DCL      5857<<DOINDEX  5858>>IF       5859>>ASSIGN
I$DISKDIR.FW.BASE
      2649**DCL      5625>>ASSIGN
I$DISKDIR.FW.CS0SIZE
      2651**DCL      5630>>ASSIGN   5646>>ASSIGN   5651>>ASSIGN   5656>>ASSIGN
I$DISKDIR.FW.DA
      2650**DCL      5645>>ASSIGN   5650>>ASSIGN   5655>>ASSIGN
I$DISKDIR.FW.INMEM
      2648**DCL      5623>>IF
I$DISKDIR.FW.MM0SIZE
      2652**DCL      5631>>ASSIGN   5647>>ASSIGN
I$DISKDIR.FW.NAME
      2653**DCL      2654--REDEF    5858>>IF
I$DISKDIR.MONID.M
      2613**DCL      2616--REDEF
IOS$
      4538**DCL      5706<>CALL     5728<>CALL     5753<>CALL     5754>>ASSIGN   5756<>CALL
IPC_TBL.DQH$
      4540**DCL      5704<<ASSIGN   5710>>IF       5712<<ASSIGN
IT_CP6UP
      4516**DCL      5574>>IF       5702>>IF
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:165  
IT_PARTITION.IOCHAN
      4523**DCL      5574>>IF
IT_SYSDIR$
      4525**DCL      5623>>IF       5625>>ASSIGN   5630>>ASSIGN   5631>>ASSIGN   5645>>ASSIGN   5646>>ASSIGN
      5647>>ASSIGN   5650>>ASSIGN   5651>>ASSIGN   5655>>ASSIGN   5656>>ASSIGN   5858>>IF
IT_SYSDISK
      4526**DCL      5659>>ASSIGN
J
      4541**DCL      5718<<DOINDEX
LDFW.CALLIOQ
      5460**DCL      5669<<ASSIGN   5677<<ASSIGN   5789>>IF       5794>>IF       5795<<ASSIGN
LDFW.DCTX
      5462**DCL      5599<<ASSIGN
LDFW.SEGSIZE
      5459**DCL      5634<<ASSIGN   5637<<ASSIGN   5823>>IF
LDFW.STATE
      5448**DCL      5664<<ASSIGN   5668<<ASSIGN
LDFW1
      5679**LABEL    5670--GOTO
LDFW2
      5798**LABEL    5688--GOTO
LPX
      4542**DCL      5649<>CALL     5650>>ASSIGN   5651>>ASSIGN
MEMBUSY
      5831**LABEL    5617--GOTO
MMB$FPP
      4490**DCL-ENT  5817--CALL     5823--CALL
MMB$GPP
      4491**DCL-ENT  5639--CALL
MME$CVM
      4492**DCL-ENT  5627--CALL     5641--CALL     5822--CALL
N$DCT$
      3340**DCL      5557>>IF       5558>>ASSIGN   5606>>CALL     5607>>DOWHILE
N$DCT$$
      3206**DCL      3340--IMP-PTR  5557>>IF       5558>>ASSIGN   5606>>CALL     5607>>DOWHILE
N$FQ$
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:166  
      3206**DCL      3341--IMP-PTR
N$REQ_INIT.BUFADDR
      3225**DCL      3226--REDEF    3226--REDEF
N$REQ_INIT.DLA.DRELADDR
      3217**DCL      3217--REDEF
N$REQ_INIT.DVE.EOMCHAR
      3254**DCL      3255--REDEF
N$REQ_INIT.EAINFO
      3248**DCL      3248--REDEF
N$REQ_INIT.EAINFOX
      3248**DCL      3249--REDEF
N$REQ_INIT.EVNTINFO
      3249**DCL      3249--REDEF
N$REQ_INIT.STATUS
      3230**DCL      3236--REDEF
NI$CHT.DQH$
      5368**DCL      5572>>ASSIGN   5708>>ASSIGN
NI$CHT$
      3265**DCL      5368--IMP-PTR  5572>>ASSIGN   5708>>ASSIGN
NI$FQ$
      3266**DCL      3342--IMP-PTR
NI$IBUF$
      3266**DCL      3342--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      3276**DCL      3277--REDEF    3277--REDEF
NI$IMXMBX_INIT.SIZE
      3278**DCL      3278--REDEF
NI$REQ_INIT.DCW
      3300**DCL      3303--REDEF
NI$REQ_INIT.DCW.TALLY
      3301**DCL      3301--REDEF
NI$REQ_INIT.IDCW.EXTA
      3303**DCL      3303--REDEF
NI$REQ_INIT.PCW
      3305**DCL      3309--REDEF
NI$REQ_INIT.SEEK
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:167  
      3310**DCL      3311--REDEF    3312--REDEF
NI$RP$
      3314**DCL      3344--IMP-PTR
NIA$FWLOAD
      4493**DCL-ENT  5740--CALL
NIO$QUE
      4494**DCL-ENT  5791--CALL
NIQ$GET
      4495**DCL-ENT  5594--CALL
NIQ$GETS
      4496**DCL-ENT  5753--CALL     5760--CALL
NIQ$REL
      4497**DCL-ENT  5804--CALL     5808--CALL     5837--CALL
NIQ$RELS
      4498**DCL-ENT  5756--CALL
NIS$MASK
      4499**DCL-ENT  5755--CALL     5764--CALL
NIW$LDFWEA
      4502**DCL-ENT  5597--ASSIGN
NIW$MPCSTART
      4500**DCL-ENT  5551--CALL     5746--CALL
NIW$MPCSTOP
      4501**DCL-ENT  5602--CALL     5606--CALL     5687--CALL
NI_FWGATE
      3315**DCL      5615<>CALL     5621<>CALL     5826<>CALL     5831<>CALL
NI_MBX_INIT.DCW.CONTROL.AE
      3336**DCL      3336--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      3332**DCL      3332--REDEF
NOFW
      5836**LABEL    5613--CALLALT  5753--CALLALT  5760--CALLALT
NOMEM
      5820**LABEL    5627--CALLALT  5642--GOTO     5649--CALLALT  5654--CALLALT
NOQPKT
      5839**LABEL    5594--CALLALT
NOQPKTS
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:168  
      5807**LABEL    5791--CALLALT
OCI$MK_STTM
      4503**DCL-ENT  5731--CALL
OCI$MK_WR
      4504**DCL-ENT  5735--ASSIGN   5848--CALL
OCI$MK_WRTM
      4505**DCL-ENT  5733--ASSIGN
OCI$MSG
      4543**DCL      5733<<ASSIGN   5735<<ASSIGN   5736>>CALL
PAR
      4485**DCL         9--PROC     5547--ASSIGN   5674--ENTRY    5675--ASSIGN   5692--ENTRY    5693--ASSIGN
PATH
      5570**LABEL    5578--EXIT
PPNO
      4544**DCL      5625<<ASSIGN   5627<>CALL     5628<<ASSIGN   5628>>ASSIGN   5639<>CALL     5640>>IF
      5641<>CALL     5817<>CALL     5821<<ASSIGN   5823<>CALL
REQ
      5486**DCL      5791<>CALL
REQ.BUF$
      5495**DCL      5661<<ASSIGN   5683<<ASSIGN   5778>>ASSIGN
REQ.BUFADDR
      5495**DCL      5496--REDEF    5496--REDEF
REQ.BUFSIZE
      5489**DCL      5663<<ASSIGN   5681<<ASSIGN
REQ.DLA.DCTX
      5486**DCL      5659<<ASSIGN   5679<<ASSIGN
REQ.DLA.DRELADDR
      5487**DCL      5487--REDEF    5660<<ASSIGN
REQ.DQH$
      5508**DCL      5696<<ASSIGN
REQ.DVE.EOMCHAR
      5524**DCL      5525--REDEF
REQ.EAENTRY
      5517**DCL      5597<<ASSIGN
REQ.EAINFO
      5518**DCL      5518--REDEF    5599--ASSIGN   5634--ASSIGN   5637--ASSIGN   5664--ASSIGN   5668--ASSIGN
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:169  
      5669--ASSIGN   5677--ASSIGN   5789--IF       5794--IF       5795--ASSIGN   5823--IF
REQ.EAINFOX
      5518**DCL      5519--REDEF
REQ.EVNTINFO
      5519**DCL      5519--REDEF
REQ.FC
      5489**DCL      5658<<ASSIGN   5682<<ASSIGN
REQ.IOFLG.IOS
      5490**DCL      5759>>IF       5761<<ASSIGN
REQ.IOQFLG.IOQUED
      5529**DCL      5803<<ASSIGN   5807<<ASSIGN   5836<<ASSIGN
REQ.IOS$
      5499**DCL      5760<>CALL
REQ.OPFLG
      5492**DCL      5595<<ASSIGN
REQ.OPFLG.BPF
      5494**DCL      5662<<ASSIGN   5684<<ASSIGN
REQ.OPFLG.HOLD
      5494**DCL      5596<<ASSIGN
REQ.STATUS
      5500**DCL      5506--REDEF
REQ.TYC
      5508**DCL      5802>>IF
REQ$
      4545**DCL      5486--IMP-PTR  5594<>CALL     5595>>ASSIGN   5596>>ASSIGN   5597>>ASSIGN   5598>>ASSIGN
      5599>>ASSIGN   5634>>ASSIGN   5637>>ASSIGN   5658>>ASSIGN   5659>>ASSIGN   5660>>ASSIGN   5661>>ASSIGN
      5662>>ASSIGN   5663>>ASSIGN   5664>>ASSIGN   5668>>ASSIGN   5669>>ASSIGN   5676<<ASSIGN   5677>>ASSIGN
      5679>>ASSIGN   5681>>ASSIGN   5682>>ASSIGN   5683>>ASSIGN   5684>>ASSIGN   5694<<ASSIGN   5695>>IF
      5696>>ASSIGN   5759>>IF       5760>>CALL     5761>>ASSIGN   5763>>ASSIGN   5778>>ASSIGN   5789>>IF
      5791>>CALL     5794>>IF       5795>>ASSIGN   5802>>IF       5803>>ASSIGN   5804<>CALL     5807>>ASSIGN
      5808<>CALL     5823>>IF       5836>>ASSIGN   5837<>CALL
RLOADIPC
      5707**LABEL    5723--EXIT
SQH.DOOR
      5473**DCL      5473--REDEF
SQH.GATE
PL6.E3A0      #003=NIW$LDFW File=NIW$MPC.:E05TSI                                 WED 07/30/97 03:41 Page:170  
      5473**DCL      5561<>CALL     5565<>CALL     5585<>CALL     5841<>CALL     5846<>CALL
SQH$
      4546**DCL      5473--IMP-PTR  5559<<ASSIGN   5561>>CALL     5565>>CALL     5585>>CALL     5698<<ASSIGN
      5839<<ASSIGN   5841>>CALL     5846>>CALL
SSS$BLOCKM
      4506**DCL-ENT  5587--CALL
START IN PROCEDURE GETFWX
      5852**DCL      5851--PROC     5857>>DOINDEX
T@DHASMPC
      5846**LABEL    5569--GOTO     5581--GOTO
TMB$BUF_ALLOC
      4507**DCL-ENT  5706--CALL
TMB$BUF_DEALLOC
      4509**DCL-ENT  5728--CALL
TMB$MCA
      4508**DCL-ENT  5713--CALL
VPNO
      4547**DCL      5626<<DOINDEX  5627<>CALL     5638<<DOINDEX  5641<>CALL     5814<<ASSIGN   5820>>DOINDEX
WAIT
      4486**DCL         9--PROC     5596>>ASSIGN   5674--ENTRY    5692--ENTRY    5798>>IF
WAITTIME
      4548**DCL      5717<<ASSIGN   5718>>DOINDEX  5767<<ASSIGN   5769<<ASSIGN   5771<<ASSIGN   5772>>DOINDEX

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:171  
      817        1        /*T***********************************************************/
      818        2        /*T*                                                         */
      819        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      820        4        /*T*                                                         */
      821        5        /*T***********************************************************/
      822        6        /*
      823        7           MPC FIRMWARE LOADER END-ACTION ROUTINE
      824        8        */
      825        9        NIW$LDFWEA: PROC (REQ);
      826       10        /*
      827       11                Includes
      828       12        */
      829       13        %INCLUDE                B$MAP ;
      830      112        %INCLUDE                B_MLSMAC_C ;
      831     1054        %INCLUDE                B_SEGIDS_C ;
      832     1593        %INCLUDE                B_STRINGS_C ;
      833     1722        %INCLUDE                CP_6_SUBS ;
      834     2262        %INCLUDE                EL_SUBS_C ;
      835     2346        %INCLUDE                FM$GRAN ;
      836     2415        %INCLUDE                HF_DATA_R ;
      837     2458        %INCLUDE                HF_LOCK_C ;
      838     2472        %INCLUDE                I$DISK ;
      839     2724        %INCLUDE                M_INFO_C ;
      840     2864        %INCLUDE                NI_DATA_C ;
      841     2977        %INCLUDE                NI_DATA_R ;
      842     3414        %INCLUDE                NI_MACROS_C ;
      843     3681        %INCLUDE                OC_SUBS_C ;
      844     4412        /*
      845     4413                Parameters
      846     4414        */
      847     4415        %N$REQ                  ( NAME=REQ, STCLASS=PARAM ) ;
      848     4473        /*
      849     4474                Entries
      850     4475        */
      851     4476    1   DCL 1 MMB$FPP           ENTRY(1) ALTRET ;
      852     4477    1   DCL 1 MME$CVM           ENTRY(4) ALTRET ;
      853     4478    1   DCL 1 NIA$FWLOAD        ENTRY(2) ;
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:172  
      854     4479    1   DCL 1 NID$RESCHED       ENTRY(1) ALTRET ;
      855     4480    1   DCL 1 NIQ$GETS          ENTRY(1) ALTRET ;
      856     4481    1   DCL 1 NIT$DEVSCHED      ENTRY(1) ;
      857     4482    1   DCL 1 NIU$RESCHED       ENTRY(1) ;
      858     4483    1   DCL 1 NIU$SCHED         ENTRY(1) ;
      859     4484    1   DCL 1 NIW$LDFWS         ENTRY(2) ALTRET ;
      860     4485    1   DCL 1 NIW$MPCSTART      ENTRY(1) ;
      861     4486    1   DCL 1 OCI$MK_STTM       ENTRY(1) ;
      862     4487    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
      863     4488    1   DCL 1 OCI$MK_WRTM       ENTRY(8) ;
      864     4489        /*
      865     4490                Symrefs
      866     4491        */
      867     4492    1   DCL 1 B$FIRM$           PTR SYMREF ;
      868     4493    1   DCL 1 B$LS$             PTR SYMREF ;
      869     4494    1   DCL 1 B$MPT$            PTR SYMREF ;
      870     4495        /*
      871     4496                Auto
      872     4497        */
      873     4498    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      874     4499    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
      875     4500    1   DCL 1 DVT$              PTR ALIGNED AUTO ;
      876     4501    1   DCL 1 ERRWD             SBIN ALIGNED AUTO ;
      877     4502    1   DCL 1 FW$               PTR ALIGNED AUTO ;
      878     4503    1   DCL 1 I                 SBIN ALIGNED AUTO ;
      879     4504    1   DCL 1 IREQ$             PTR ALIGNED AUTO ;
      880     4505    1   DCL 1 I_FWNAME          SBIN ALIGNED AUTO ;
      881     4506    1   DCL 1 KEYINRTN          EPTR ALIGNED AUTO ;
      882     4507    1   DCL 1 OCI$MSG           EPTR  ALIGNED AUTO ;
      883     4508    1   DCL 1 OCPARAM           UBIN BYTE CALIGNED AUTO ;
      884     4509    1   DCL 1 PPNO              SBIN ALIGNED AUTO ;
      885     4510    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      886     4511    1   DCL 1 VPNO              SBIN ALIGNED AUTO ;
      887     4512    1   DCL 1 WAITTIME          SBIN ALIGNED AUTO ;
      888     4513        /*
      889     4514                Based
      890     4515        */
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:173  
      891     4516        %B_MLS                  ( FPTN=B$MLNK, STCLASS=BASED ) ;
      892     5331        %NI$DCT                 ( NAME=DCT, STCLASS="BASED(DCT$)" ) ;
      893     5379        %NI$DQH                 ( NAME=DQH, STCLASS="BASED(DQH$)" ) ;
      894     5402        %NI$DVT                 ( NAME=DVT, STCLASS="BASED(DVT$)" ) ;
      895     5409        %FM$VID;
      896     5415        %NI$FW                  ( NAME=FW, STCLASS="BASED(FW$)" ) ;
      897     5421        %NI$REQ                 ( NAME=IREQ, STCLASS="BASED(IREQ$)" ) ;
      898     5446    1   DCL 1 LDFW              BASED ALIGNED,  /* REQ.EAINFO AND REQ.EAINFOX */
      899     5447    1         2 STATE           UBIN(18) UNAL, /* STATE OF F/W LOADING:
      900     5448                                                    0 READING SYSVOL VID
      901     5449                                                    1 READING SYSDIR
      902     5450                                                    2 READING F/W
      903     5451                                                    3 READING LP F/W
      904     5452                                                    4 READING CRP F/W
      905     5453                                                    5 WRITING CSO
      906     5454                                                    6 WRITING MMO
      907     5455                                                    7 WRITING LP F/W
      908     5456                                                    8 WRITING CRP F/W
      909     5457                                                    9 ENTERING F/W (UR ONLY) */
      910     5458    1         2 SEGSIZE         UBIN(18) UNAL,  /* SIZE OF FIRM */
      911     5459    1         2 CALLIOQ         BIT(1),    /* CALL IOQ AFTER SETTING UP THE WRITE CSO */
      912     5460    1         2 * BIT(2),
      913     5461    1         2 DCTX            UBIN(15) UNAL,  /* MPC DCTX */
      914     5462    1         2 OLSIZE          UBIN(18) UNAL;  /* (REMAINING) SIZE OF F/W OVERLAY */
      915     5463        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
      916     5476        /*
      917     5477                Constants
      918     5478        */
      919     5479    1   DCL IDCW(0:3) BIT(36) CONSTANT ALIGNED INIT(
      920     5480    1              '110000700000'O,             /* MAIN MEMORY OVERLAY */
      921     5481    1              '360000704000'O*2,           /* LOAD DEVICE FIRMWARE */
      922     5482    1              '050000700200'O);            /* ENTER FIRMWARE */
      923     5483        /**/
      924     5484    1   DCL KEYIN# SBIN HALF UNAL CONSTANT INIT(1); /* RETRY */
      925     5485        /**/
      926     5486        %SUB I$DISKDIR=B$FIRM$->I$DISKDIR;
      927     5487        %SUB LDFW="ADDR(REQ.EAINFO)->LDFW";
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:174  
      928     5488        /**/
      929     5489        %EQU FWPGS=16;
      930     5490        /**/
      931     5491        %EJECT;
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:175  
      932     5492        /* START OF PROCEDURE
      933     5493        */
      934     5494    1           DCT$=N$DCT$(LDFW.DCTX);
      935     5495    1           FW$=DCT.MPC.FW$;
      936     5496    2           DO CASE(LDFW.STATE);
      937     5497    2            CASE(2,3,4);                   /* DONE READING F/W PAGE */
      938     5498    2              IF REQ.TYC~=%TYC_EGV THEN GOTO DONE;
      939     5499    3              IF FW.FWOL(LDFW.STATE)>0 THEN DO;
      940     5500    3                 REQ.BUF$=PINCRC(REQ.BUF$,REQ.BUFSIZE);
      941     5501    3                 REQ.OPFLG.BPF='1'B;
      942     5502    4                 DO CASE(LDFW.STATE);
      943     5503    4                  CASE(2);
      944     5504    4                    REQ.DLA.DRELADDR=FW.LPDA;
      945     5505    4                  CASE(3);
      946     5506    4                    REQ.DLA.DRELADDR=FW.CRPDA;
      947     5507    4                  CASE(4);
      948     5508    4                    GOTO WRITECSO;
      949     5509    4                  END;
      950     5510    3                 REQ.BUFSIZE=FW.FWOL(LDFW.STATE)*4;
      951     5511    3                 END;
      952     5512    3              ELSE DO;
      953     5513    3                 LDFW.STATE=4;
      954     5514    3   WRITECSO:
      955     5515    3                 CALL NIW$LDFWS(DCT,'0'B) ALTRET(WAIT);
      956     5516    3                 END;
      957     5517    2              GOTO CONT;
      958     5518    2            CASE(6);                       /* DONE WRITING MAIN MEMORY OVERLAY */
      959     5519    2              IF REQ.TYC~=%TYC_EGV THEN GOTO DONE;
      960     5520    2              IF DCT.MPC.TYPE~=%DV_LP THEN GOTO FWLOADED;
      961     5521    3              IF NOT DCT.MPC.LPCHANS THEN DO;
      962     5522    3                 FW.DCW.FWA(0)=FW.DCW.FWA(0)+FW.FWOL(2);
      963     5523    3                 LDFW.STATE=7;
      964     5524    3                 GOTO CHKCRPFW;
      965     5525    3                 END;
      966     5526    2              FW.FW(FW.FWOL(0)+FW.FWOL(1))=DCT.MPC.LPCHANS;
      967     5527    2            CASE(7);                       /* DONE WRITING LP F/W */
      968     5528    2   CHKCRPFW:
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:176  
      969     5529    3              IF NOT DCT.MPC.CRPCHANS THEN DO;
      970     5530    3                 LDFW.STATE=8;
      971     5531    3                 END;
      972     5532    3              ELSE DO;
      973     5533    3                 FW.FW(FW.FWOL(0)+FW.FWOL(1)+FW.FWOL(2))=DCT.MPC.CRPCHANS;
      974     5534    3                 END;
      975     5535    2            CASE(9);                       /* DONE "ENTER F/W" */
      976     5536    2   FWLOADED:
      977     5537    2              DCT.DFLG.RELOAD='0'B;        /* FIRMWARE LOADED */
      978     5538        /*N* GET RID OF THESE STUPID DO LOOPS - SHOULD CHECK STATUS FOR POWER OFF */
      979     5539    2              IF HW_IMX AND DCT.MPC.FWNAME = 'MSP8' THEN
      980     5540    2                 WAITTIME = 300000;
      981     5541    2              ELSE IF DCT.MPC.FWNAME = 'MSP8' THEN
      982     5542    2                    WAITTIME = 100000;
      983     5543    2                 ELSE
      984     5544    2                    WAITTIME = 0;
      985     5545    3              DO I=1 TO WAITTIME;          /* WAIT A WHILE (~400 MS.) */
      986     5546    3                 END;
      987     5547    2              CALL NIW$MPCSTART(DCT);
      988     5548    2              IF DCT.MPC.ALTMPCX~=0 THEN
      989     5549    2                 CALL NIW$MPCSTART(N$DCT$(DCT.MPC.ALTMPCX)->DCT);
      990     5550    2   DONE:
      991     5551    2              IF DCT.MSG# ~= 0 THEN
      992     5552    2                 CALL OCI$MK_STTM ( DCT.MSG# ) ;
      993     5553    3              IF DCT.DFLG.RELOAD THEN DO ;
      994     5554    3                 OCPARAM = 1 ;
      995     5555    3                 OCI$MSG = ENTADDR ( OCI$MK_WRTM ) ;
      996     5556    3                 END ;
      997     5557    3              ELSE DO ;
      998     5558    3                 OCPARAM = 0 ;
      999     5559    3                 OCI$MSG = ENTADDR ( OCI$MK_WR ) ;
     1000     5560    3                 END ;
     1001     5561    2              CALL OCI$MSG ( M_DEVC, %FWL_MSG#, 1, '001'O, OCPARAM,
     1002     5562    2                BINBIT(DCT.DCTX,36), /* WSN */,
     1003     5563    2                DCT.MSG# ) ;
     1004     5564    2              CALL NIA$FWLOAD(DCT,EL_FWLOAD);
     1005     5565    2              DCT.DFLG.RELOAD='0'B;
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:177  
     1006     5566    3              IF DCT.MPC.FW$=B$FIRM$ THEN DO;
     1007     5567    4                 DO VPNO=%FIRMWREPG TO %FIRMWREPG+%(%FWPGS-1);
     1008     5568    4                    PPNO=B$MPT$->B$MAP.RPN(VPNO);
     1009     5569    4                    CALL MME$CVM(%MONWSQ,VPNO,-1,ERRWD);
     1010     5570    4                    IF LDFW.SEGSIZE~=0 THEN CALL MMB$FPP(PPNO);
     1011     5571    4                    END;
     1012     5572                      %LOCK(G#=NI_FWGATE);
     1013     5575    3                 B$LS$->B$MLNK.FIRM.FLGS=B$LS$->B$MLNK.FIRM.FLGS&~%DSNULL;
     1014     5576                      %UNLOCK(G#=NI_FWGATE);
     1015     5579    3                 DCT.MPC.FW$=ADDR(NIL);
     1016     5580    3                 END/* IF LDFW.SEGSIZE */;
     1017     5581    2              DCT.DFLG.MPCSUSPENDED='0'B;
     1018     5582    2              DCT.DFLG.MPCBUSY='0'B;
     1019     5583    3              IF DCT.MPC.ALTMPCX~=0 THEN DO;
     1020     5584    3                 DCT$=N$DCT$(DCT.MPC.ALTMPCX);
     1021     5585    3                 DCT.DFLG.RELOAD='0'B;
     1022     5586    3                 DCT.DFLG.MPCSUSPENDED='0'B;
     1023     5587    3                 DCT.DFLG.MPCBUSY='0'B;
     1024     5588    3                 END;
     1025     5589    2              RETURN;
     1026     5590    2            END/* CASE LDFW.STATE */;
     1027     5591    1           IF REQ.TYC~=%TYC_EGV THEN GOTO DONE;
     1028     5592    1           IF HW_IMX OR DCT.MPC.FWNAME = 'MSP8' THEN
     1029     5593    1              WAITTIME = 100000;           /* (~400 MS.) */
     1030     5594    1           ELSE
     1031     5595    1              WAITTIME = 50000/4;          /* (~50 MS.) */
     1032     5596    2           DO I=1 TO WAITTIME;
     1033     5597    2              END;
     1034     5598    1           FW.IDCW=IDCW(LDFW.STATE-5);
     1035     5599    1           FW.DCW.FWA(0)=FW.DCW.FWA(0)+FW.FWOL(LDFW.STATE-5);
     1036     5600    1           I=0;
     1037     5601    2           DO WHILE(FW.FWOL(LDFW.STATE-4)-I>%DCWTALLYMAX);
     1038     5602    2              FW.DCW.FWA(I/%DCWTALLYMAX)=FW.DCW.FWA(0)+I;
     1039     5603    2              FW.DCW.TALLY(I/%DCWTALLYMAX)=0;
     1040     5604    2              FW.DCW.TYPE(I/%DCWTALLYMAX)=%DCW_IOTP;
     1041     5605    2              I=I+%DCWTALLYMAX;
     1042     5606    2              END;
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:178  
     1043     5607    2           IF FW.FWOL(LDFW.STATE-4)-I>0 THEN DO;
     1044     5608    2              FW.DCW.FWA(I/%DCWTALLYMAX)=FW.DCW.FWA(0)+I;
     1045     5609    2              FW.DCW.TALLY(I/%DCWTALLYMAX)=FW.FWOL(LDFW.STATE-4)-I;
     1046     5610    2              FW.DCW.TYPE(I/%DCWTALLYMAX)=%DCW_IOTD;
     1047     5611    2              END;
     1048     5612    1   CONT:
     1049     5613    1           REQ.OPFLG.REQ='1'B;
     1050     5614    1   WAIT:
     1051     5615    1           REQ.TYC.EGV='0'B;
     1052     5616    1           LDFW.STATE=LDFW.STATE+1;
     1053     5617    1           RETURN;
     1054     5618    1   END NIW$LDFWEA;
     1055     5619        %EOD;

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:179  
--  Include file information  --

   OC_SUBS_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   I$DISK.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$GRAN.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIW$LDFWEA.

   Procedure NIW$LDFWEA requires 442 words for executable code.
   Procedure NIW$LDFWEA requires 30 words of local(AUTO) storage.

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:180  

 Object Unit name= NIW$LDFWEA                                 File name= NIW$MPC.:E05TOU
 UTS= JUL 30 '97 03:43:12.56 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      6      6  NIW$LDFWEA
    1   Proc  even  none   442    672  NIW$LDFWEA
    2  RoData even  none    19     23  NIW$LDFWEA

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  NIW$LDFWEA

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 NIW$LDFWS
         yes           Std       1 OCI$MK_STTM
         yes           Std       8 OCI$MK_WRTM
         yes           Std       7 OCI$MK_WR
         yes           Std       2 NIA$FWLOAD
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       4 MME$CVM
         yes           Std       1 NIW$MPCSTART
 yes     yes           Std       1 MMB$FPP
         yes           Std       1 HFC$LOCK
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:181  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     HW_IMX                                N$DCT$$                               N$FQ$
     NI$FQ$                                NI$IBUF$                              NI$RP$
     NI_FWGATE                             B$FIRM$                               B$LS$
     B$MPT$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:182  


      817        1        /*T***********************************************************/
      818        2        /*T*                                                         */
      819        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      820        4        /*T*                                                         */
      821        5        /*T***********************************************************/
      822        6        /*
      823        7           MPC FIRMWARE LOADER END-ACTION ROUTINE
      824        8        */
      825        9        NIW$LDFWEA: PROC (REQ);

      9  1 000000   000000 700200 xent  NIW$LDFWEA   TSX0  ! X66_AUTO_1
         1 000001   000036 000001                    ZERO    30,1

      826       10        /*
      827       11                Includes
      828       12        */
      829       13        %INCLUDE                B$MAP ;
      830      112        %INCLUDE                B_MLSMAC_C ;
      831     1054        %INCLUDE                B_SEGIDS_C ;
      832     1593        %INCLUDE                B_STRINGS_C ;
      833     1722        %INCLUDE                CP_6_SUBS ;
      834     2262        %INCLUDE                EL_SUBS_C ;
      835     2346        %INCLUDE                FM$GRAN ;
      836     2415        %INCLUDE                HF_DATA_R ;
      837     2458        %INCLUDE                HF_LOCK_C ;
      838     2472        %INCLUDE                I$DISK ;
      839     2724        %INCLUDE                M_INFO_C ;
      840     2864        %INCLUDE                NI_DATA_C ;
      841     2977        %INCLUDE                NI_DATA_R ;
      842     3414        %INCLUDE                NI_MACROS_C ;
      843     3681        %INCLUDE                OC_SUBS_C ;
      844     4412        /*
      845     4413                Parameters
      846     4414        */
      847     4415        %N$REQ                  ( NAME=REQ, STCLASS=PARAM ) ;
      848     4473        /*
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:183  
      849     4474                Entries
      850     4475        */
      851     4476    1   DCL 1 MMB$FPP           ENTRY(1) ALTRET ;
      852     4477    1   DCL 1 MME$CVM           ENTRY(4) ALTRET ;
      853     4478    1   DCL 1 NIA$FWLOAD        ENTRY(2) ;
      854     4479    1   DCL 1 NID$RESCHED       ENTRY(1) ALTRET ;
      855     4480    1   DCL 1 NIQ$GETS          ENTRY(1) ALTRET ;
      856     4481    1   DCL 1 NIT$DEVSCHED      ENTRY(1) ;
      857     4482    1   DCL 1 NIU$RESCHED       ENTRY(1) ;
      858     4483    1   DCL 1 NIU$SCHED         ENTRY(1) ;
      859     4484    1   DCL 1 NIW$LDFWS         ENTRY(2) ALTRET ;
      860     4485    1   DCL 1 NIW$MPCSTART      ENTRY(1) ;
      861     4486    1   DCL 1 OCI$MK_STTM       ENTRY(1) ;
      862     4487    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
      863     4488    1   DCL 1 OCI$MK_WRTM       ENTRY(8) ;
      864     4489        /*
      865     4490                Symrefs
      866     4491        */
      867     4492    1   DCL 1 B$FIRM$           PTR SYMREF ;
      868     4493    1   DCL 1 B$LS$             PTR SYMREF ;
      869     4494    1   DCL 1 B$MPT$            PTR SYMREF ;
      870     4495        /*
      871     4496                Auto
      872     4497        */
      873     4498    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
      874     4499    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
      875     4500    1   DCL 1 DVT$              PTR ALIGNED AUTO ;
      876     4501    1   DCL 1 ERRWD             SBIN ALIGNED AUTO ;
      877     4502    1   DCL 1 FW$               PTR ALIGNED AUTO ;
      878     4503    1   DCL 1 I                 SBIN ALIGNED AUTO ;
      879     4504    1   DCL 1 IREQ$             PTR ALIGNED AUTO ;
      880     4505    1   DCL 1 I_FWNAME          SBIN ALIGNED AUTO ;
      881     4506    1   DCL 1 KEYINRTN          EPTR ALIGNED AUTO ;
      882     4507    1   DCL 1 OCI$MSG           EPTR  ALIGNED AUTO ;
      883     4508    1   DCL 1 OCPARAM           UBIN BYTE CALIGNED AUTO ;
      884     4509    1   DCL 1 PPNO              SBIN ALIGNED AUTO ;
      885     4510    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:184  
      886     4511    1   DCL 1 VPNO              SBIN ALIGNED AUTO ;
      887     4512    1   DCL 1 WAITTIME          SBIN ALIGNED AUTO ;
      888     4513        /*
      889     4514                Based
      890     4515        */
      891     4516        %B_MLS                  ( FPTN=B$MLNK, STCLASS=BASED ) ;
      892     5331        %NI$DCT                 ( NAME=DCT, STCLASS="BASED(DCT$)" ) ;
      893     5379        %NI$DQH                 ( NAME=DQH, STCLASS="BASED(DQH$)" ) ;
      894     5402        %NI$DVT                 ( NAME=DVT, STCLASS="BASED(DVT$)" ) ;
      895     5409        %FM$VID;
      896     5415        %NI$FW                  ( NAME=FW, STCLASS="BASED(FW$)" ) ;
      897     5421        %NI$REQ                 ( NAME=IREQ, STCLASS="BASED(IREQ$)" ) ;
      898     5446    1   DCL 1 LDFW              BASED ALIGNED,  /* REQ.EAINFO AND REQ.EAINFOX */
      899     5447    1         2 STATE           UBIN(18) UNAL, /* STATE OF F/W LOADING:
      900     5448                                                    0 READING SYSVOL VID
      901     5449                                                    1 READING SYSDIR
      902     5450                                                    2 READING F/W
      903     5451                                                    3 READING LP F/W
      904     5452                                                    4 READING CRP F/W
      905     5453                                                    5 WRITING CSO
      906     5454                                                    6 WRITING MMO
      907     5455                                                    7 WRITING LP F/W
      908     5456                                                    8 WRITING CRP F/W
      909     5457                                                    9 ENTERING F/W (UR ONLY) */
      910     5458    1         2 SEGSIZE         UBIN(18) UNAL,  /* SIZE OF FIRM */
      911     5459    1         2 CALLIOQ         BIT(1),    /* CALL IOQ AFTER SETTING UP THE WRITE CSO */
      912     5460    1         2 * BIT(2),
      913     5461    1         2 DCTX            UBIN(15) UNAL,  /* MPC DCTX */
      914     5462    1         2 OLSIZE          UBIN(18) UNAL;  /* (REMAINING) SIZE OF F/W OVERLAY */
      915     5463        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
      916     5476        /*
      917     5477                Constants
      918     5478        */
      919     5479    1   DCL IDCW(0:3) BIT(36) CONSTANT ALIGNED INIT(
      920     5480    1              '110000700000'O,             /* MAIN MEMORY OVERLAY */
      921     5481    1              '360000704000'O*2,           /* LOAD DEVICE FIRMWARE */
      922     5482    1              '050000700200'O);            /* ENTER FIRMWARE */
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:185  
      923     5483        /**/
      924     5484    1   DCL KEYIN# SBIN HALF UNAL CONSTANT INIT(1); /* RETRY */
      925     5485        /**/
      926     5486        %SUB I$DISKDIR=B$FIRM$->I$DISKDIR;
      927     5487        %SUB LDFW="ADDR(REQ.EAINFO)->LDFW";
      928     5488        /**/
      929     5489        %EQU FWPGS=16;
      930     5490        /**/
      931     5491        %EJECT;
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:186  
      932     5492        /* START OF PROCEDURE
      933     5493        */
      934     5494    1           DCT$=N$DCT$(LDFW.DCTX);

   5494  1 000002   200003 470500                    LDP0    @REQ,,AUTO
         1 000003   000025 220100                    LDX0    21,,PR0
         1 000004   077777 360003                    ANX0    32767,DU
         1 000005   000000 471400 xsym               LDP1    N$DCT$$
         1 000006   100000 236110                    LDQ     0,X0,PR1
         1 000007   200004 756100                    STQ     DCT$,,AUTO

      935     5495    1           FW$=DCT.MPC.FW$;

   5495  1 000010   200004 473500                    LDP3    DCT$,,AUTO
         1 000011   300030 236100                    LDQ     24,,PR3
         1 000012   200010 756100                    STQ     FW$,,AUTO

      936     5496    2           DO CASE(LDFW.STATE);

   5496  1 000013   000024 221100                    LDX1    20,,PR0
         1 000014   000012 101003                    CMPX1   10,DU
         1 000015   000017 602011 1                  TNC     s:5496+4,X1
         1 000016   000500 710000 1                  TRA     s:5591
         1 000017   000500 710000 1                  TRA     s:5591
         1 000020   000500 710000 1                  TRA     s:5591
         1 000021   000031 710000 1                  TRA     s:5498
         1 000022   000031 710000 1                  TRA     s:5498
         1 000023   000031 710000 1                  TRA     s:5498
         1 000024   000500 710000 1                  TRA     s:5591
         1 000025   000131 710000 1                  TRA     s:5519
         1 000026   000175 710000 1                  TRA     CHKCRPFW
         1 000027   000500 710000 1                  TRA     s:5591
         1 000030   000227 710000 1                  TRA     FWLOADED

      937     5497    2            CASE(2,3,4);                   /* DONE READING F/W PAGE */

      938     5498    2              IF REQ.TYC~=%TYC_EGV THEN GOTO DONE;
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:187  

   5498  1 000031   000021 236100                    LDQ     17,,PR0
         1 000032   000030 116000 xsym               CMPQ    B_VECTNIL+24
         1 000033   000300 601000 1                  TNZ     DONE

      939     5499    3              IF FW.FWOL(LDFW.STATE)>0 THEN DO;

   5499  1 000034   000024 236100                    LDQ     20,,PR0
         1 000035   000022 772000                    QRL     18
         1 000036   000001 736000                    QLS     1
         1 000037   200010 474500                    LDP4    FW$,,AUTO
         1 000040   000100 101506                    MRL     fill='000'O
         1 000041   400003 000002                    ADSC9   3,Q,PR4                  cn=0,n=2
         1 000042   200024 000004                    ADSC9   WAITTIME+2,,AUTO         cn=0,n=4
         1 000043   200024 236100                    LDQ     WAITTIME+2,,AUTO
         1 000044   000000 116003                    CMPQ    0,DU
         1 000045   000117 600000 1                  TZE     s:5513

      940     5500    3                 REQ.BUF$=PINCRC(REQ.BUF$,REQ.BUFSIZE);

   5500  1 000046   000004 236100                    LDQ     4,,PR0
         1 000047   000020 772000                    QRL     16
         1 000050   000005 475500                    LDP5    5,,PR0
         1 000051   000011 402007                    MPY     9,DL
         1 000052   500000 503506                    ABD     0,QL,PR5
         1 000053   000005 455500                    STP5    5,,PR0

      941     5501    3                 REQ.OPFLG.BPF='1'B;

   5501  1 000054   000010 236007                    LDQ     8,DL
         1 000055   000004 256100                    ORSQ    4,,PR0

      942     5502    4                 DO CASE(LDFW.STATE);

   5502  1 000056   000024 221100                    LDX1    20,,PR0
         1 000057   000005 101003                    CMPX1   5,DU
         1 000060   000062 602011 1                  TNC     s:5502+4,X1
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:188  
         1 000061   000102 710000 1                  TRA     s:5510
         1 000062   000102 710000 1                  TRA     s:5510
         1 000063   000102 710000 1                  TRA     s:5510
         1 000064   000067 710000 1                  TRA     s:5504
         1 000065   000074 710000 1                  TRA     s:5506
         1 000066   000101 710000 1                  TRA     s:5508

      943     5503    4                  CASE(2);

      944     5504    4                    REQ.DLA.DRELADDR=FW.LPDA;

   5504  1 000067   400001 236100                    LDQ     1,,PR4
         1 000070   000001 676100                    ERQ     1,,PR0
         1 000071   000000 376000 2                  ANQ     0
         1 000072   000001 656100                    ERSQ    1,,PR0
         1 000073   000102 710000 1                  TRA     s:5510

      945     5505    4                  CASE(3);

      946     5506    4                    REQ.DLA.DRELADDR=FW.CRPDA;

   5506  1 000074   400002 236100                    LDQ     2,,PR4
         1 000075   000001 676100                    ERQ     1,,PR0
         1 000076   000000 376000 2                  ANQ     0
         1 000077   000001 656100                    ERSQ    1,,PR0
         1 000100   000102 710000 1                  TRA     s:5510

      947     5507    4                  CASE(4);

      948     5508    4                    GOTO WRITECSO;

   5508  1 000101   000121 710000 1                  TRA     WRITECSO

      949     5509    4                  END;

      950     5510    3                 REQ.BUFSIZE=FW.FWOL(LDFW.STATE)*4;

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:189  
   5510  1 000102   000024 236100                    LDQ     20,,PR0
         1 000103   000022 772000                    QRL     18
         1 000104   000001 736000                    QLS     1
         1 000105   000100 101506                    MRL     fill='000'O
         1 000106   400003 000002                    ADSC9   3,Q,PR4                  cn=0,n=2
         1 000107   200024 000004                    ADSC9   WAITTIME+2,,AUTO         cn=0,n=4
         1 000110   200024 236100                    LDQ     WAITTIME+2,,AUTO
         1 000111   000002 736000                    QLS     2
         1 000112   000020 736000                    QLS     16
         1 000113   000004 676100                    ERQ     4,,PR0
         1 000114   000034 376000 xsym               ANQ     B_VECTNIL+28
         1 000115   000004 656100                    ERSQ    4,,PR0

      951     5511    3                 END;

   5511  1 000116   000130 710000 1                  TRA     s:5517

      952     5512    3              ELSE DO;

      953     5513    3                 LDFW.STATE=4;

   5513  1 000117   000004 221003                    LDX1    4,DU
         1 000120   000024 741100                    STX1    20,,PR0

      954     5514    3   WRITECSO:
      955     5515    3                 CALL NIW$LDFWS(DCT,'0'B) ALTRET(WAIT);

   5515  1 000121   000001 236000 2     WRITECSO     LDQ     1
         1 000122   200004 235100                    LDA     DCT$,,AUTO
         1 000123   200024 757100                    STAQ    WAITTIME+2,,AUTO
         1 000124   200024 630500                    EPPR0   WAITTIME+2,,AUTO
         1 000125   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000126   000000 701000 xent               TSX1    NIW$LDFWS
         1 000127   000663 702000 1                  TSX2    WAIT

      956     5516    3                 END;

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:190  
      957     5517    2              GOTO CONT;

   5517  1 000130   000660 710000 1                  TRA     CONT

      958     5518    2            CASE(6);                       /* DONE WRITING MAIN MEMORY OVERLAY */

      959     5519    2              IF REQ.TYC~=%TYC_EGV THEN GOTO DONE;

   5519  1 000131   000021 236100                    LDQ     17,,PR0
         1 000132   000030 116000 xsym               CMPQ    B_VECTNIL+24
         1 000133   000300 601000 1                  TNZ     DONE

      960     5520    2              IF DCT.MPC.TYPE~=%DV_LP THEN GOTO FWLOADED;

   5520  1 000134   300035 236100                    LDQ     29,,PR3
         1 000135   777000 376003                    ANQ     -512,DU
         1 000136   003000 116003                    CMPQ    1536,DU
         1 000137   000227 601000 1                  TNZ     FWLOADED

      961     5521    3              IF NOT DCT.MPC.LPCHANS THEN DO;

   5521  1 000140   300035 236100                    LDQ     29,,PR3
         1 000141   000777 316003                    CANQ    511,DU
         1 000142   000157 601000 1                  TNZ     s:5526

      962     5522    3                 FW.DCW.FWA(0)=FW.DCW.FWA(0)+FW.FWOL(2);

   5522  1 000143   200010 474500                    LDP4    FW$,,AUTO
         1 000144   400004 236100                    LDQ     4,,PR4
         1 000145   000022 772000                    QRL     18
         1 000146   200024 756100                    STQ     WAITTIME+2,,AUTO
         1 000147   400007 236100                    LDQ     7,,PR4
         1 000150   000022 772000                    QRL     18
         1 000151   200024 036100                    ADLQ    WAITTIME+2,,AUTO
         1 000152   000000 621006                    EAX1    0,QL
         1 000153   400007 741100                    STX1    7,,PR4

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:191  
      963     5523    3                 LDFW.STATE=7;

   5523  1 000154   000007 220003                    LDX0    7,DU
         1 000155   000024 740100                    STX0    20,,PR0

      964     5524    3                 GOTO CHKCRPFW;

   5524  1 000156   000175 710000 1                  TRA     CHKCRPFW

      965     5525    3                 END;
      966     5526    2              FW.FW(FW.FWOL(0)+FW.FWOL(1))=DCT.MPC.LPCHANS;

   5526  1 000157   200010 474500                    LDP4    FW$,,AUTO
         1 000160   400003 236100                    LDQ     3,,PR4
         1 000161   777777 376007                    ANQ     -1,DL
         1 000162   200024 756100                    STQ     WAITTIME+2,,AUTO
         1 000163   400003 236100                    LDQ     3,,PR4
         1 000164   000022 772000                    QRL     18
         1 000165   200024 036100                    ADLQ    WAITTIME+2,,AUTO
         1 000166   200025 756100                    STQ     WAITTIME+3,,AUTO
         1 000167   300035 236100                    LDQ     29,,PR3
         1 000170   000011 736000                    QLS     9
         1 000171   777000 376003                    ANQ     -512,DU
         1 000172   200025 720100                    LXL0    WAITTIME+3,,AUTO
         1 000173   400013 756110                    STQ     11,X0,PR4
         1 000174   000500 710000 1                  TRA     s:5591

      967     5527    2            CASE(7);                       /* DONE WRITING LP F/W */

      968     5528    2   CHKCRPFW:
      969     5529    3              IF NOT DCT.MPC.CRPCHANS THEN DO;

   5529  1 000175   300035 236100       CHKCRPFW     LDQ     29,,PR3
         1 000176   777000 316007                    CANQ    -512,DL
         1 000177   000203 601000 1                  TNZ     s:5533

      970     5530    3                 LDFW.STATE=8;
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:192  

   5530  1 000200   000010 220003                    LDX0    8,DU
         1 000201   000024 740100                    STX0    20,,PR0

      971     5531    3                 END;

   5531  1 000202   000500 710000 1                  TRA     s:5591

      972     5532    3              ELSE DO;

      973     5533    3                 FW.FW(FW.FWOL(0)+FW.FWOL(1)+FW.FWOL(2))=DCT.MPC.CRPCHANS;

   5533  1 000203   200010 474500                    LDP4    FW$,,AUTO
         1 000204   400003 236100                    LDQ     3,,PR4
         1 000205   777777 376007                    ANQ     -1,DL
         1 000206   200024 756100                    STQ     WAITTIME+2,,AUTO
         1 000207   400003 236100                    LDQ     3,,PR4
         1 000210   000022 772000                    QRL     18
         1 000211   200024 036100                    ADLQ    WAITTIME+2,,AUTO
         1 000212   200025 756100                    STQ     WAITTIME+3,,AUTO
         1 000213   400004 236100                    LDQ     4,,PR4
         1 000214   000022 772000                    QRL     18
         1 000215   200026 756100                    STQ     WAITTIME+4,,AUTO
         1 000216   200025 236100                    LDQ     WAITTIME+3,,AUTO
         1 000217   200026 036100                    ADLQ    WAITTIME+4,,AUTO
         1 000220   200027 756100                    STQ     WAITTIME+5,,AUTO
         1 000221   300035 236100                    LDQ     29,,PR3
         1 000222   000022 736000                    QLS     18
         1 000223   777000 376003                    ANQ     -512,DU
         1 000224   200027 720100                    LXL0    WAITTIME+5,,AUTO
         1 000225   400013 756110                    STQ     11,X0,PR4

      974     5534    3                 END;

   5534  1 000226   000500 710000 1                  TRA     s:5591

      975     5535    2            CASE(9);                       /* DONE "ENTER F/W" */
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:193  

      976     5536    2   FWLOADED:
      977     5537    2              DCT.DFLG.RELOAD='0'B;        /* FIRMWARE LOADED */

   5537  1 000227   000002 236000 2     FWLOADED     LDQ     2
         1 000230   300006 356100                    ANSQ    6,,PR3

      978     5538        /*N* GET RID OF THESE STUPID DO LOOPS - SHOULD CHECK STATUS FOR POWER OFF */
      979     5539    2              IF HW_IMX AND DCT.MPC.FWNAME = 'MSP8' THEN

   5539  1 000231   000000 234000 xsym               SZN     HW_IMX
         1 000232   000241 605000 1                  TPL     s:5541
         1 000233   300041 236100                    LDQ     33,,PR3
         1 000234   000005 116000 0                  CMPQ    IDCW+5
         1 000235   000241 601000 1                  TNZ     s:5541

      980     5540    2                 WAITTIME = 300000;

   5540  1 000236   000003 235000 2                  LDA     3
         1 000237   200022 755100                    STA     WAITTIME,,AUTO
         1 000240   000250 710000 1                  TRA     s:5545

      981     5541    2              ELSE IF DCT.MPC.FWNAME = 'MSP8' THEN

   5541  1 000241   300041 236100                    LDQ     33,,PR3
         1 000242   000005 116000 0                  CMPQ    IDCW+5
         1 000243   000247 601000 1                  TNZ     s:5544

      982     5542    2                    WAITTIME = 100000;

   5542  1 000244   303240 235007                    LDA     100000,DL
         1 000245   200022 755100                    STA     WAITTIME,,AUTO
         1 000246   000250 710000 1                  TRA     s:5545

      983     5543    2                 ELSE
      984     5544    2                    WAITTIME = 0;

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:194  
   5544  1 000247   200022 450100                    STZ     WAITTIME,,AUTO

      985     5545    3              DO I=1 TO WAITTIME;          /* WAIT A WHILE (~400 MS.) */

   5545  1 000250   000001 235007                    LDA     1,DL
         1 000251   200011 755100                    STA     I,,AUTO
         1 000252   000254 710000 1                  TRA     s:5546+1

      986     5546    3                 END;

   5546  1 000253   200011 054100                    AOS     I,,AUTO
         1 000254   200011 236100                    LDQ     I,,AUTO
         1 000255   200022 116100                    CMPQ    WAITTIME,,AUTO
         1 000256   000253 604400 1                  TMOZ    s:5546

      987     5547    2              CALL NIW$MPCSTART(DCT);

   5547  1 000257   200004 630500                    EPPR0   DCT$,,AUTO
         1 000260   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000261   000000 701000 xent               TSX1    NIW$MPCSTART
         1 000262   000000 011000                    NOP     0

      988     5548    2              IF DCT.MPC.ALTMPCX~=0 THEN

   5548  1 000263   200004 470500                    LDP0    DCT$,,AUTO
         1 000264   000035 236100                    LDQ     29,,PR0
         1 000265   000777 316007                    CANQ    511,DL
         1 000266   000300 600000 1                  TZE     DONE

      989     5549    2                 CALL NIW$MPCSTART(N$DCT$(DCT.MPC.ALTMPCX)->DCT);

   5549  1 000267   000035 720100                    LXL0    29,,PR0
         1 000270   000777 360003                    ANX0    511,DU
         1 000271   000000 471400 xsym               LDP1    N$DCT$$
         1 000272   100000 473510                    LDP3    0,X0,PR1
         1 000273   200024 453500                    STP3    WAITTIME+2,,AUTO
         1 000274   200024 630500                    EPPR0   WAITTIME+2,,AUTO
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:195  
         1 000275   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000276   000000 701000 xent               TSX1    NIW$MPCSTART
         1 000277   000000 011000                    NOP     0

      990     5550    2   DONE:
      991     5551    2              IF DCT.MSG# ~= 0 THEN

   5551  1 000300   200004 470500       DONE         LDP0    DCT$,,AUTO
         1 000301   000027 720100                    LXL0    23,,PR0
         1 000302   000312 600000 1                  TZE     s:5553

      992     5552    2                 CALL OCI$MK_STTM ( DCT.MSG# ) ;

   5552  1 000303   200004 236100                    LDQ     DCT$,,AUTO
         1 000304   000004 036000 2                  ADLQ    4
         1 000305   200024 756100                    STQ     WAITTIME+2,,AUTO
         1 000306   200024 630500                    EPPR0   WAITTIME+2,,AUTO
         1 000307   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000310   000000 701000 xent               TSX1    OCI$MK_STTM
         1 000311   000000 011000                    NOP     0

      993     5553    3              IF DCT.DFLG.RELOAD THEN DO ;

   5553  1 000312   200004 470500                    LDP0    DCT$,,AUTO
         1 000313   000006 236100                    LDQ     6,,PR0
         1 000314   004000 316007                    CANQ    2048,DL
         1 000315   000323 600000 1                  TZE     s:5558

      994     5554    3                 OCPARAM = 1 ;

   5554  1 000316   001000 236003                    LDQ     512,DU
         1 000317   200016 756100                    STQ     OCPARAM,,AUTO

      995     5555    3                 OCI$MSG = ENTADDR ( OCI$MK_WRTM ) ;

   5555  1 000320   000000 636000 xent               EAQ     OCI$MK_WRTM
         1 000321   200015 756100                    STQ     OCI$MSG,,AUTO
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:196  

      996     5556    3                 END ;

   5556  1 000322   000326 710000 1                  TRA     s:5561

      997     5557    3              ELSE DO ;

      998     5558    3                 OCPARAM = 0 ;

   5558  1 000323   200016 450100                    STZ     OCPARAM,,AUTO

      999     5559    3                 OCI$MSG = ENTADDR ( OCI$MK_WR ) ;

   5559  1 000324   000000 636000 xent               EAQ     OCI$MK_WR
         1 000325   200015 756100                    STQ     OCI$MSG,,AUTO

     1000     5560    3                 END ;

     1001     5561    2              CALL OCI$MSG ( M_DEVC, %FWL_MSG#, 1, '001'O, OCPARAM,

   5561  1 000326   000006 236100                    LDQ     6,,PR0
         1 000327   000025 772000                    QRL     21
         1 000330   200024 756100                    STQ     WAITTIME+2,,AUTO
         1 000331   200004 236100                    LDQ     DCT$,,AUTO
         1 000332   000004 036000 2                  ADLQ    4
         1 000333   000001 235000 xsym               LDA     B_VECTNIL+1
         1 000334   200034 757100                    STAQ    WAITTIME+10,,AUTO
         1 000335   200024 631500                    EPPR1   WAITTIME+2,,AUTO
         1 000336   200033 451500                    STP1    WAITTIME+9,,AUTO
         1 000337   200016 633500                    EPPR3   OCPARAM,,AUTO
         1 000340   200032 453500                    STP3    WAITTIME+8,,AUTO
         1 000341   000010 237000 2                  LDAQ    8
         1 000342   200030 757100                    STAQ    WAITTIME+6,,AUTO
         1 000343   000012 237000 2                  LDAQ    10
         1 000344   200026 757100                    STAQ    WAITTIME+4,,AUTO
         1 000345   200026 630500                    EPPR0   WAITTIME+4,,AUTO
         1 000346   200015 220100                    LDX0    OCI$MSG,,AUTO
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:197  
         1 000347   000026 631400 xsym               EPPR1   B_VECTNIL+22
         1 000350   000000 701010                    TSX1    0,X0
         1 000351   000000 011000                    NOP     0

     1002     5562    2                BINBIT(DCT.DCTX,36), /* WSN */,
     1003     5563    2                DCT.MSG# ) ;
     1004     5564    2              CALL NIA$FWLOAD(DCT,EL_FWLOAD);

   5564  1 000352   000014 236000 2                  LDQ     12
         1 000353   200004 235100                    LDA     DCT$,,AUTO
         1 000354   200024 757100                    STAQ    WAITTIME+2,,AUTO
         1 000355   200024 630500                    EPPR0   WAITTIME+2,,AUTO
         1 000356   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000357   000000 701000 xent               TSX1    NIA$FWLOAD
         1 000360   000000 011000                    NOP     0

     1005     5565    2              DCT.DFLG.RELOAD='0'B;

   5565  1 000361   200004 470500                    LDP0    DCT$,,AUTO
         1 000362   000002 236000 2                  LDQ     2
         1 000363   000006 356100                    ANSQ    6,,PR0

     1006     5566    3              IF DCT.MPC.FW$=B$FIRM$ THEN DO;

   5566  1 000364   000030 236100                    LDQ     24,,PR0
         1 000365   000000 116000 xsym               CMPQ    B$FIRM$
         1 000366   000454 601000 1                  TNZ     s:5581

     1007     5567    4                 DO VPNO=%FIRMWREPG TO %FIRMWREPG+%(%FWPGS-1);

   5567  1 000367   001010 235007                    LDA     520,DL
         1 000370   200021 755100                    STA     VPNO,,AUTO
         1 000371   000425 710000 1                  TRA     s:5571+1

     1008     5568    4                    PPNO=B$MPT$->B$MAP.RPN(VPNO);

   5568  1 000372   000000 470400 xsym               LDP0    B$MPT$
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:198  
         1 000373   200021 720100                    LXL0    VPNO,,AUTO
         1 000374   000000 236110                    LDQ     0,X0,PR0
         1 000375   000022 772000                    QRL     18
         1 000376   200017 756100                    STQ     PPNO,,AUTO

     1009     5569    4                    CALL MME$CVM(%MONWSQ,VPNO,-1,ERRWD);

   5569  1 000377   200007 631500                    EPPR1   ERRWD,,AUTO
         1 000400   200027 451500                    STP1    WAITTIME+5,,AUTO
         1 000401   000015 236000 2                  LDQ     13
         1 000402   200026 756100                    STQ     WAITTIME+4,,AUTO
         1 000403   200021 633500                    EPPR3   VPNO,,AUTO
         1 000404   200025 453500                    STP3    WAITTIME+3,,AUTO
         1 000405   000010 236000 2                  LDQ     8
         1 000406   200024 756100                    STQ     WAITTIME+2,,AUTO
         1 000407   200024 630500                    EPPR0   WAITTIME+2,,AUTO
         1 000410   000022 631400 xsym               EPPR1   B_VECTNIL+18
         1 000411   000000 701000 xent               TSX1    MME$CVM
         1 000412   000000 011000                    NOP     0

     1010     5570    4                    IF LDFW.SEGSIZE~=0 THEN CALL MMB$FPP(PPNO);

   5570  1 000413   200003 470500                    LDP0    @REQ,,AUTO
         1 000414   000024 720100                    LXL0    20,,PR0
         1 000415   000424 600000 1                  TZE     s:5571

   5570  1 000416   200017 631500                    EPPR1   PPNO,,AUTO
         1 000417   200024 451500                    STP1    WAITTIME+2,,AUTO
         1 000420   200024 630500                    EPPR0   WAITTIME+2,,AUTO
         1 000421   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000422   000000 701000 xent               TSX1    MMB$FPP
         1 000423   000000 011000                    NOP     0

     1011     5571    4                    END;

   5571  1 000424   200021 054100                    AOS     VPNO,,AUTO
         1 000425   200021 235100                    LDA     VPNO,,AUTO
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:199  
         1 000426   001027 115007                    CMPA    535,DL
         1 000427   000372 604400 1                  TMOZ    s:5568

     1012     5572                      %LOCK(G#=NI_FWGATE);

   5573  1 000430   000016 630400 2                  EPPR0   14
         1 000431   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000432   000000 701000 xent               TSX1    HFC$LOCK
         1 000433   000000 011000                    NOP     0

     1013     5575    3                 B$LS$->B$MLNK.FIRM.FLGS=B$LS$->B$MLNK.FIRM.FLGS&~%DSNULL;

   5575  1 000434   000000 470400 xsym               LDP0    B$LS$
         1 000435   000336 236100                    LDQ     222,,PR0
         1 000436   000024 736000                    QLS     20
         1 000437   777000 376003                    ANQ     -512,DU
         1 000440   775000 376003                    ANQ     -1536,DU
         1 000441   000024 772000                    QRL     20
         1 000442   000336 676100                    ERQ     222,,PR0
         1 000443   177600 376007                    ANQ     65408,DL
         1 000444   000336 656100                    ERSQ    222,,PR0

     1014     5576                      %UNLOCK(G#=NI_FWGATE);

   5577  1 000445   000016 630400 2                  EPPR0   14
         1 000446   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000447   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000450   000000 011000                    NOP     0

     1015     5579    3                 DCT.MPC.FW$=ADDR(NIL);

   5579  1 000451   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000452   200004 470500                    LDP0    DCT$,,AUTO
         1 000453   000030 756100                    STQ     24,,PR0

     1016     5580    3                 END/* IF LDFW.SEGSIZE */;

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:200  
     1017     5581    2              DCT.DFLG.MPCSUSPENDED='0'B;

   5581  1 000454   000017 236000 2                  LDQ     15
         1 000455   000006 356100                    ANSQ    6,,PR0

     1018     5582    2              DCT.DFLG.MPCBUSY='0'B;

   5582  1 000456   000020 236000 2                  LDQ     16
         1 000457   000006 356100                    ANSQ    6,,PR0

     1019     5583    3              IF DCT.MPC.ALTMPCX~=0 THEN DO;

   5583  1 000460   000035 236100                    LDQ     29,,PR0
         1 000461   000777 316007                    CANQ    511,DL
         1 000462   000477 600000 1                  TZE     s:5589

     1020     5584    3                 DCT$=N$DCT$(DCT.MPC.ALTMPCX);

   5584  1 000463   000035 720100                    LXL0    29,,PR0
         1 000464   000777 360003                    ANX0    511,DU
         1 000465   000000 471400 xsym               LDP1    N$DCT$$
         1 000466   100000 236110                    LDQ     0,X0,PR1
         1 000467   200004 756100                    STQ     DCT$,,AUTO

     1021     5585    3                 DCT.DFLG.RELOAD='0'B;

   5585  1 000470   200004 470500                    LDP0    DCT$,,AUTO
         1 000471   000002 236000 2                  LDQ     2
         1 000472   000006 356100                    ANSQ    6,,PR0

     1022     5586    3                 DCT.DFLG.MPCSUSPENDED='0'B;

   5586  1 000473   000017 236000 2                  LDQ     15
         1 000474   000006 356100                    ANSQ    6,,PR0

     1023     5587    3                 DCT.DFLG.MPCBUSY='0'B;

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:201  
   5587  1 000475   000020 236000 2                  LDQ     16
         1 000476   000006 356100                    ANSQ    6,,PR0

     1024     5588    3                 END;

     1025     5589    2              RETURN;

   5589  1 000477   000000 702200 xent               TSX2  ! X66_ARET

     1026     5590    2            END/* CASE LDFW.STATE */;

     1027     5591    1           IF REQ.TYC~=%TYC_EGV THEN GOTO DONE;

   5591  1 000500   000021 236100                    LDQ     17,,PR0
         1 000501   000030 116000 xsym               CMPQ    B_VECTNIL+24
         1 000502   000300 601000 1                  TNZ     DONE

     1028     5592    1           IF HW_IMX OR DCT.MPC.FWNAME = 'MSP8' THEN

   5592  1 000503   000000 234000 xsym               SZN     HW_IMX
         1 000504   000510 604000 1                  TMI     s:5593
         1 000505   300041 236100                    LDQ     33,,PR3
         1 000506   000005 116000 0                  CMPQ    IDCW+5
         1 000507   000513 601000 1                  TNZ     s:5595

     1029     5593    1              WAITTIME = 100000;           /* (~400 MS.) */

   5593  1 000510   303240 235007                    LDA     100000,DL
         1 000511   200022 755100                    STA     WAITTIME,,AUTO
         1 000512   000515 710000 1                  TRA     s:5596

     1030     5594    1           ELSE
     1031     5595    1              WAITTIME = 50000/4;          /* (~50 MS.) */

   5595  1 000513   030324 235007                    LDA     12500,DL
         1 000514   200022 755100                    STA     WAITTIME,,AUTO

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:202  
     1032     5596    2           DO I=1 TO WAITTIME;

   5596  1 000515   000001 236007                    LDQ     1,DL
         1 000516   200011 756100                    STQ     I,,AUTO
         1 000517   000521 710000 1                  TRA     s:5597+1

     1033     5597    2              END;

   5597  1 000520   200011 054100                    AOS     I,,AUTO
         1 000521   200011 236100                    LDQ     I,,AUTO
         1 000522   200022 116100                    CMPQ    WAITTIME,,AUTO
         1 000523   000520 604400 1                  TMOZ    s:5597

     1034     5598    1           FW.IDCW=IDCW(LDFW.STATE-5);

   5598  1 000524   200003 470500                    LDP0    @REQ,,AUTO
         1 000525   000024 220100                    LDX0    20,,PR0
         1 000526   777773 236010 0                  LDQ     IDCW-5,X0
         1 000527   200010 471500                    LDP1    FW$,,AUTO
         1 000530   100006 756100                    STQ     6,,PR1

     1035     5599    1           FW.DCW.FWA(0)=FW.DCW.FWA(0)+FW.FWOL(LDFW.STATE-5);

   5599  1 000531   000024 236100                    LDQ     20,,PR0
         1 000532   000022 772000                    QRL     18
         1 000533   000001 736000                    QLS     1
         1 000534   000100 101506                    MRL     fill='000'O
         1 000535   100000 400002                    ADSC9   0,Q,PR1                  cn=2,n=2
         1 000536   200024 000004                    ADSC9   WAITTIME+2,,AUTO         cn=0,n=4
         1 000537   100007 236100                    LDQ     7,,PR1
         1 000540   000022 772000                    QRL     18
         1 000541   200024 036100                    ADLQ    WAITTIME+2,,AUTO
         1 000542   000000 620006                    EAX0    0,QL
         1 000543   100007 740100                    STX0    7,,PR1

     1036     5600    1           I=0;

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:203  
   5600  1 000544   200011 450100                    STZ     I,,AUTO

     1037     5601    2           DO WHILE(FW.FWOL(LDFW.STATE-4)-I>%DCWTALLYMAX);

   5601  1 000545   000576 710000 1                  TRA     s:5606

     1038     5602    2              FW.DCW.FWA(I/%DCWTALLYMAX)=FW.DCW.FWA(0)+I;

   5602  1 000546   200011 236100                    LDQ     I,,AUTO
         1 000547   010000 506007                    DIV     4096,DL
         1 000550   200010 470500                    LDP0    FW$,,AUTO
         1 000551   200024 756100                    STQ     WAITTIME+2,,AUTO
         1 000552   000007 236100                    LDQ     7,,PR0
         1 000553   000022 772000                    QRL     18
         1 000554   200011 036100                    ADLQ    I,,AUTO
         1 000555   000000 620006                    EAX0    0,QL
         1 000556   200024 721100                    LXL1    WAITTIME+2,,AUTO
         1 000557   000007 740111                    STX0    7,X1,PR0

     1039     5603    2              FW.DCW.TALLY(I/%DCWTALLYMAX)=0;

   5603  1 000560   200011 236100                    LDQ     I,,AUTO
         1 000561   010000 506007                    DIV     4096,DL
         1 000562   000000 620006                    EAX0    0,QL
         1 000563   000021 236000 2                  LDQ     17
         1 000564   000007 356110                    ANSQ    7,X0,PR0

     1040     5604    2              FW.DCW.TYPE(I/%DCWTALLYMAX)=%DCW_IOTP;

   5604  1 000565   200011 236100                    LDQ     I,,AUTO
         1 000566   010000 506007                    DIV     4096,DL
         1 000567   000000 620006                    EAX0    0,QL
         1 000570   000007 236106                    LDQ     7,QL,PR0
         1 000571   000022 376000 2                  ANQ     18
         1 000572   010000 276007                    ORQ     4096,DL
         1 000573   000007 756110                    STQ     7,X0,PR0

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:204  
     1041     5605    2              I=I+%DCWTALLYMAX;

   5605  1 000574   010000 236007                    LDQ     4096,DL
         1 000575   200011 056100                    ASQ     I,,AUTO

     1042     5606    2              END;

   5606  1 000576   200003 470500                    LDP0    @REQ,,AUTO
         1 000577   000024 236100                    LDQ     20,,PR0
         1 000600   000022 772000                    QRL     18
         1 000601   000001 736000                    QLS     1
         1 000602   200010 471500                    LDP1    FW$,,AUTO
         1 000603   000100 101506                    MRL     fill='000'O
         1 000604   100001 000002                    ADSC9   1,Q,PR1                  cn=0,n=2
         1 000605   200024 000004                    ADSC9   WAITTIME+2,,AUTO         cn=0,n=4
         1 000606   200024 236100                    LDQ     WAITTIME+2,,AUTO
         1 000607   200011 136100                    SBLQ    I,,AUTO
         1 000610   010000 116007                    CMPQ    4096,DL
         1 000611   000546 605400 1                  TPNZ    s:5602

     1043     5607    2           IF FW.FWOL(LDFW.STATE-4)-I>0 THEN DO;

   5607  1 000612   000024 236100                    LDQ     20,,PR0
         1 000613   000022 772000                    QRL     18
         1 000614   000001 736000                    QLS     1
         1 000615   000100 101506                    MRL     fill='000'O
         1 000616   100001 000002                    ADSC9   1,Q,PR1                  cn=0,n=2
         1 000617   200024 000004                    ADSC9   WAITTIME+2,,AUTO         cn=0,n=4
         1 000620   200024 236100                    LDQ     WAITTIME+2,,AUTO
         1 000621   200011 136100                    SBLQ    I,,AUTO
         1 000622   000660 604400 1                  TMOZ    CONT

     1044     5608    2              FW.DCW.FWA(I/%DCWTALLYMAX)=FW.DCW.FWA(0)+I;

   5608  1 000623   200011 236100                    LDQ     I,,AUTO
         1 000624   010000 506007                    DIV     4096,DL
         1 000625   200024 756100                    STQ     WAITTIME+2,,AUTO
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:205  
         1 000626   100007 236100                    LDQ     7,,PR1
         1 000627   000022 772000                    QRL     18
         1 000630   200011 036100                    ADLQ    I,,AUTO
         1 000631   000000 620006                    EAX0    0,QL
         1 000632   200024 721100                    LXL1    WAITTIME+2,,AUTO
         1 000633   100007 740111                    STX0    7,X1,PR1

     1045     5609    2              FW.DCW.TALLY(I/%DCWTALLYMAX)=FW.FWOL(LDFW.STATE-4)-I;

   5609  1 000634   200011 236100                    LDQ     I,,AUTO
         1 000635   010000 506007                    DIV     4096,DL
         1 000636   200024 756100                    STQ     WAITTIME+2,,AUTO
         1 000637   000024 236100                    LDQ     20,,PR0
         1 000640   000022 772000                    QRL     18
         1 000641   000001 736000                    QLS     1
         1 000642   000100 101506                    MRL     fill='000'O
         1 000643   100001 000002                    ADSC9   1,Q,PR1                  cn=0,n=2
         1 000644   200025 000004                    ADSC9   WAITTIME+3,,AUTO         cn=0,n=4
         1 000645   200025 236100                    LDQ     WAITTIME+3,,AUTO
         1 000646   200011 136100                    SBLQ    I,,AUTO
         1 000647   200024 720100                    LXL0    WAITTIME+2,,AUTO
         1 000650   100007 676110                    ERQ     7,X0,PR1
         1 000651   007777 376007                    ANQ     4095,DL
         1 000652   100007 656110                    ERSQ    7,X0,PR1

     1046     5610    2              FW.DCW.TYPE(I/%DCWTALLYMAX)=%DCW_IOTD;

   5610  1 000653   200011 236100                    LDQ     I,,AUTO
         1 000654   010000 506007                    DIV     4096,DL
         1 000655   000000 620006                    EAX0    0,QL
         1 000656   000022 236000 2                  LDQ     18
         1 000657   100007 356110                    ANSQ    7,X0,PR1

     1047     5611    2              END;

     1048     5612    1   CONT:
     1049     5613    1           REQ.OPFLG.REQ='1'B;
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:206  

   5613  1 000660   200003 470500       CONT         LDP0    @REQ,,AUTO
         1 000661   000002 236007                    LDQ     2,DL
         1 000662   000004 256100                    ORSQ    4,,PR0

     1050     5614    1   WAIT:
     1051     5615    1           REQ.TYC.EGV='0'B;

   5615  1 000663   200003 470500       WAIT         LDP0    @REQ,,AUTO
         1 000664   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000665   000021 356100                    ANSQ    17,,PR0

     1052     5616    1           LDFW.STATE=LDFW.STATE+1;

   5616  1 000666   000024 220100                    LDX0    20,,PR0
         1 000667   000001 621010                    EAX1    1,X0
         1 000670   000024 741100                    STX1    20,,PR0

     1053     5617    1           RETURN;

   5617  1 000671   000000 702200 xent               TSX2  ! X66_ARET

IDCW
 Sect OctLoc
   0     000   110000 700000   360000 704000   360000 704000   050000 700200    H...........(...

(unnamed)
 Sect OctLoc
   0     004   000001 ******   115123 120070                                    ....MSP8

(unnamed)
 Sect OctLoc
   2     000   000007 777777   000002 006000   777777 773777   000001 111740    ..............I.
   2     004   000027 400000   100000 000000   000000 000225   000000 000155    ....@..........m
   2     010   000003 006000   000033 006000   000005 006000   000006 006000    ................
   2     014   000007 006000   000027 006000   000000 006000   777777 775777    ................
   2     020   777777 777377   777777 770000   777777 707777                    ............
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:207  
     1054     5618    1   END NIW$LDFWEA;
     1055     5619        %EOD;

PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:208  
--  Include file information  --

   OC_SUBS_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   I$DISK.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   HF_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$GRAN.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIW$LDFWEA.
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:209  

 **** Variables and constants ****

  ****  Section 000 RoData NIW$LDFWEA

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w BIT         r     1 IDCW(0:3)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @REQ                       4-0-0/w PTR         r     1 DCT$
     5-0-0/w PTR         r     1 DQH$                       6-0-0/w PTR         r     1 DVT$
     7-0-0/w SBIN        r     1 ERRWD                     10-0-0/w PTR         r     1 FW$
    11-0-0/w SBIN        r     1 I                         12-0-0/w PTR         r     1 IREQ$
    14-0-0/w EPTR        r     1 KEYINRTN                  15-0-0/w EPTR        r     1 OCI$MSG
    16-0-0/c UBIN(9)     r     1 OCPARAM                   17-0-0/w SBIN        r     1 PPNO
    *0-0-0/d STRC(1080)  r     1 REQ                       20-0-0/w PTR         r     1 SQH$
    21-0-0/w SBIN        r     1 VPNO                      22-0-0/w SBIN        r     1 WAITTIME

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$FIRM$                    0-0-0/w PTR         r     1 B$LS$
     0-0-0/w PTR         r     1 B$MPT$                     0-0-0/w BIT         r     1 HW_IMX
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/w BIT (72)    r     1 NI_FWGATE

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:210  
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 B$MAP(0:1023)              0-0-0/d STRC(10368) r     1 B$MLNK
     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/d STRC(432)   r     1 FW
     0-0-0/w STRC(72)    r     1 LDFW                       0-0-0/w PTR         r     1 N$DCT$(0:0)


   Procedure NIW$LDFWEA requires 442 words for executable code.
   Procedure NIW$LDFWEA requires 30 words of local(AUTO) storage.
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:211  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:212  
          MINI XREF LISTING

B$FIRM$
      4492**DCL      5566>>IF
B$LS$
      4493**DCL      5575>>ASSIGN   5575>>ASSIGN
B$MAP.RPN
        55**DCL      5568>>ASSIGN
B$MAP.SCTRL
        56**DCL        57--REDEF
B$MLNK.FIRM.FLGS
      5240**DCL      5575<<ASSIGN   5575>>ASSIGN
B$MPT$
      4494**DCL      5568>>ASSIGN
CHKCRPFW
      5529**LABEL    5524--GOTO
CONT
      5613**LABEL    5517--GOTO
DCT
      5340**DCL      5515<>CALL     5547<>CALL     5549<>CALL     5564<>CALL
DCT.DCTX
      5341**DCL      5561>>CALL
DCT.DFLG.MPCBUSY
      5345**DCL      5582<<ASSIGN   5587<<ASSIGN
DCT.DFLG.MPCSUSPENDED
      5345**DCL      5581<<ASSIGN   5586<<ASSIGN
DCT.DFLG.RELOAD
      5344**DCL      5537<<ASSIGN   5553>>IF       5565<<ASSIGN   5585<<ASSIGN
DCT.DP
      5360**DCL      5367--REDEF    5370--REDEF    5371--REDEF    5373--REDEF    5373--REDEF    5374--REDEF
      5375--REDEF    5375--REDEF
DCT.MPC.ALTMPCX
      5369**DCL      5548>>IF       5549>>CALL     5583>>IF       5584>>ASSIGN
DCT.MPC.CRPCHANS
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:213  
      5369**DCL      5529>>IF       5533>>ASSIGN
DCT.MPC.FW$
      5368**DCL      5495>>ASSIGN   5566>>IF       5579<<ASSIGN
DCT.MPC.FWNAME
      5370**DCL      5539>>IF       5541>>IF       5592>>IF
DCT.MPC.IOCHANX
      5368**DCL      5368--REDEF
DCT.MPC.LPCHANS
      5369**DCL      5521>>IF       5526>>ASSIGN
DCT.MPC.TYPE
      5368**DCL      5520>>IF
DCT.MSG#
      5360**DCL      5551>>IF       5552<>CALL     5561<>CALL
DCT$
      4498**DCL      5340--IMP-PTR  5494<<ASSIGN   5495>>ASSIGN   5515>>CALL     5520>>IF       5521>>IF
      5526>>ASSIGN   5529>>IF       5533>>ASSIGN   5537>>ASSIGN   5539>>IF       5541>>IF       5547>>CALL
      5548>>IF       5549>>CALL     5551>>IF       5552>>CALL     5553>>IF       5561>>CALL     5561>>CALL
      5564>>CALL     5565>>ASSIGN   5566>>IF       5579>>ASSIGN   5581>>ASSIGN   5582>>ASSIGN   5583>>IF
      5584<<ASSIGN   5584>>ASSIGN   5585>>ASSIGN   5586>>ASSIGN   5587>>ASSIGN   5592>>IF
DONE
      5551**LABEL    5498--GOTO     5519--GOTO     5591--GOTO
DQH.IOCHANX
      5390**DCL      5391--REDEF
DQH.MBX$
      5399**DCL      5400--REDEF
DQH$
      4499**DCL      5388--IMP-PTR
DVT.MPC
      5405**DCL      5406--REDEF
DVT$
      4500**DCL      5403--IMP-PTR
ERRWD
      4501**DCL      5569<>CALL
FM$VID.DTT
      5412**DCL      5412--REDEF
FW.CRPDA
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:214  
      5416**DCL      5506>>ASSIGN
FW.DCW.FWA
      5418**DCL      5522<<ASSIGN   5522>>ASSIGN   5599<<ASSIGN   5599>>ASSIGN   5602<<ASSIGN   5602>>ASSIGN
      5608<<ASSIGN   5608>>ASSIGN
FW.DCW.TALLY
      5419**DCL      5603<<ASSIGN   5609<<ASSIGN
FW.DCW.TYPE
      5419**DCL      5604<<ASSIGN   5610<<ASSIGN
FW.FW
      5419**DCL      5526<<ASSIGN   5533<<ASSIGN
FW.FWOL
      5416**DCL      5499>>IF       5510>>ASSIGN   5522>>ASSIGN   5526>>ASSIGN   5526>>ASSIGN   5533>>ASSIGN
      5533>>ASSIGN   5533>>ASSIGN   5599>>ASSIGN   5601>>DOWHILE  5607>>IF       5609>>ASSIGN
FW.IDCW
      5416**DCL      5598<<ASSIGN
FW.IDCW.EXTA
      5417**DCL      5417--REDEF
FW.LPDA
      5416**DCL      5504>>ASSIGN
FW$
      4502**DCL      5416--IMP-PTR  5495<<ASSIGN   5499>>IF       5504>>ASSIGN   5506>>ASSIGN   5510>>ASSIGN
      5522>>ASSIGN   5522>>ASSIGN   5522>>ASSIGN   5526>>ASSIGN   5526>>ASSIGN   5526>>ASSIGN   5533>>ASSIGN
      5533>>ASSIGN   5533>>ASSIGN   5533>>ASSIGN   5598>>ASSIGN   5599>>ASSIGN   5599>>ASSIGN   5599>>ASSIGN
      5601>>DOWHILE  5602>>ASSIGN   5602>>ASSIGN   5603>>ASSIGN   5604>>ASSIGN   5607>>IF       5608>>ASSIGN
      5608>>ASSIGN   5609>>ASSIGN   5609>>ASSIGN   5610>>ASSIGN
FWLOADED
      5537**LABEL    5520--GOTO
HFC$LOCK
      2471**DCL-ENT  5573--CALL
HFC$UNLOCK
      2471**DCL-ENT  5577--CALL
HW_IMX
      2457**DCL      5539>>IF       5592>>IF
I
      4503**DCL      5545<<DOINDEX  5596<<DOINDEX  5600<<ASSIGN   5601>>DOWHILE  5602>>ASSIGN   5602>>ASSIGN
      5603>>ASSIGN   5604>>ASSIGN   5605<<ASSIGN   5605>>ASSIGN   5607>>IF       5608>>ASSIGN   5608>>ASSIGN
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:215  
      5609>>ASSIGN   5609>>ASSIGN   5610>>ASSIGN
I$DISKDIR.FW.NAME
      2722**DCL      2723--REDEF
I$DISKDIR.MONID.M
      2682**DCL      2685--REDEF
IDCW
      5479**DCL      5598>>ASSIGN
IREQ.DCW
      5432**DCL      5435--REDEF
IREQ.DCW.TALLY
      5433**DCL      5433--REDEF
IREQ.IDCW.EXTA
      5435**DCL      5435--REDEF
IREQ.PCW
      5437**DCL      5441--REDEF
IREQ.SEEK
      5442**DCL      5443--REDEF    5444--REDEF
IREQ$
      4504**DCL      5430--IMP-PTR
LDFW.DCTX
      5461**DCL      5494>>ASSIGN
LDFW.SEGSIZE
      5458**DCL      5570>>IF
LDFW.STATE
      5447**DCL      5496>>DOCASE   5499>>IF       5502>>DOCASE   5510>>ASSIGN   5513<<ASSIGN   5523<<ASSIGN
      5530<<ASSIGN   5598>>ASSIGN   5599>>ASSIGN   5601>>DOWHILE  5607>>IF       5609>>ASSIGN   5616<<ASSIGN
      5616>>ASSIGN
MMB$FPP
      4476**DCL-ENT  5570--CALL
MME$CVM
      4477**DCL-ENT  5569--CALL
N$DCT$
      3409**DCL      5494>>ASSIGN   5549>>CALL     5584>>ASSIGN
N$DCT$$
      3275**DCL      3409--IMP-PTR  5494>>ASSIGN   5549>>CALL     5584>>ASSIGN
N$FQ$
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:216  
      3275**DCL      3410--IMP-PTR
N$REQ_INIT.BUFADDR
      3294**DCL      3295--REDEF    3295--REDEF
N$REQ_INIT.DLA.DRELADDR
      3286**DCL      3286--REDEF
N$REQ_INIT.DVE.EOMCHAR
      3323**DCL      3324--REDEF
N$REQ_INIT.EAINFO
      3317**DCL      3317--REDEF
N$REQ_INIT.EAINFOX
      3317**DCL      3318--REDEF
N$REQ_INIT.EVNTINFO
      3318**DCL      3318--REDEF
N$REQ_INIT.STATUS
      3299**DCL      3305--REDEF
NI$FQ$
      3335**DCL      3411--IMP-PTR
NI$IBUF$
      3335**DCL      3411--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      3345**DCL      3346--REDEF    3346--REDEF
NI$IMXMBX_INIT.SIZE
      3347**DCL      3347--REDEF
NI$REQ_INIT.DCW
      3369**DCL      3372--REDEF
NI$REQ_INIT.DCW.TALLY
      3370**DCL      3370--REDEF
NI$REQ_INIT.IDCW.EXTA
      3372**DCL      3372--REDEF
NI$REQ_INIT.PCW
      3374**DCL      3378--REDEF
NI$REQ_INIT.SEEK
      3379**DCL      3380--REDEF    3381--REDEF
NI$RP$
      3383**DCL      3413--IMP-PTR
NIA$FWLOAD
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:217  
      4478**DCL-ENT  5564--CALL
NIW$LDFWS
      4484**DCL-ENT  5515--CALL
NIW$MPCSTART
      4485**DCL-ENT  5547--CALL     5549--CALL
NI_FWGATE
      3384**DCL      5573<>CALL     5577<>CALL
NI_MBX_INIT.DCW.CONTROL.AE
      3405**DCL      3405--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      3401**DCL      3401--REDEF
OCI$MK_STTM
      4486**DCL-ENT  5552--CALL
OCI$MK_WR
      4487**DCL-ENT  5559--ASSIGN
OCI$MK_WRTM
      4488**DCL-ENT  5555--ASSIGN
OCI$MSG
      4507**DCL      5555<<ASSIGN   5559<<ASSIGN   5561>>CALL
OCPARAM
      4508**DCL      5554<<ASSIGN   5558<<ASSIGN   5561<>CALL
PPNO
      4509**DCL      5568<<ASSIGN   5570<>CALL
REQ
      4424**DCL         9--PROC
REQ.BUF$
      4433**DCL      5500<<ASSIGN   5500>>ASSIGN
REQ.BUFADDR
      4433**DCL      4434--REDEF    4434--REDEF
REQ.BUFSIZE
      4427**DCL      5500>>ASSIGN   5510<<ASSIGN
REQ.DLA.DRELADDR
      4425**DCL      4425--REDEF    5504<<ASSIGN   5506<<ASSIGN
REQ.DVE.EOMCHAR
      4462**DCL      4463--REDEF
REQ.EAINFO
PL6.E3A0      #004=NIW$LDFWEA File=NIW$MPC.:E05TSI                               WED 07/30/97 03:43 Page:218  
      4456**DCL      4456--REDEF    5494--ASSIGN   5496--DOCASE   5499--IF       5502--DOCASE   5510--ASSIGN
      5513--ASSIGN   5523--ASSIGN   5530--ASSIGN   5570--IF       5598--ASSIGN   5599--ASSIGN   5601--DOWHILE
      5607--IF       5609--ASSIGN   5616--ASSIGN   5616--ASSIGN
REQ.EAINFOX
      4456**DCL      4457--REDEF
REQ.EVNTINFO
      4457**DCL      4457--REDEF
REQ.OPFLG.BPF
      4432**DCL      5501<<ASSIGN
REQ.OPFLG.REQ
      4432**DCL      5613<<ASSIGN
REQ.STATUS
      4438**DCL      4444--REDEF
REQ.TYC
      4446**DCL      5498>>IF       5519>>IF       5591>>IF
REQ.TYC.EGV
      4446**DCL      5615<<ASSIGN
SQH.DOOR
      5472**DCL      5472--REDEF
SQH$
      4510**DCL      5472--IMP-PTR
VPNO
      4511**DCL      5567<<DOINDEX  5568>>ASSIGN   5569<>CALL
WAIT
      5615**LABEL    5515--CALLALT
WAITTIME
      4512**DCL      5540<<ASSIGN   5542<<ASSIGN   5544<<ASSIGN   5545>>DOINDEX  5593<<ASSIGN   5595<<ASSIGN
      5596>>DOINDEX
WRITECSO
      5515**LABEL    5508--GOTO

PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:219  
     1056        1        /*T***********************************************************/
     1057        2        /*T*                                                         */
     1058        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1059        4        /*T*                                                         */
     1060        5        /*T***********************************************************/
     1061        6        NIW$MPCSTOP: PROC(DCT);
     1062        7        /*
     1063        8                Includes
     1064        9        */
     1065       10        %INCLUDE                HF_LOCK_C ;
     1066       24        %INCLUDE                NI_DATA_R ;
     1067      461        %INCLUDE                NI_DATA_C ;
     1068      574        %INCLUDE                NI_MACROS_C ;
     1069      841        %INCLUDE                N_FC_C ;
     1070      878        /*
     1071      879                Parameters
     1072      880        */
     1073      881        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
     1074      929        /*
     1075      930                Entries
     1076      931        */
     1077      932    1   DCL 1 NIW$DQHSTART      ENTRY(1) ALTRET ;
     1078      933    1   DCL 1 NIW$LDFWR         ENTRY(2) ALTRET ;
     1079      934    1   DCL 1 NIW$SCANAQ        ENTRY(1) ;
     1080      935    1   DCL 1 OCI$MK_STTM       ENTRY(1) ;
     1081      936        /*
     1082      937                Symrefs
     1083      938        */
     1084      939    1   DCL 1 IT_CP6UP          UBIN WORD SYMREF ;
     1085      940        %NI$PARTITION           ( NAME=IT_PARTITION, STCLASS=SYMREF ) ;
     1086      948        /*
     1087      949                Auto
     1088      950        */
     1089      951    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
     1090      952    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
     1091      953    1   DCL 1 DVSCH             EPTR ALIGNED AUTO ;
     1092      954    1   DCL 1 I                 SBIN ALIGNED AUTO ;
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:220  
     1093      955    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
     1094      956    1   DCL 1 STOPPED           BIT(1) ALIGNED AUTO ;
     1095      957    1   DCL 1 SVDQH$            PTR ALIGNED AUTO ;
     1096      958        /*
     1097      959                Based
     1098      960        */
     1099      961        %NI$DQH                 ( NAME=DQH,           STCLASS="BASED(DQH$)" ) ;
     1100      984        %NI$DVT                 ( NAME=DVT,           STCLASS=BASED ) ;
     1101      991        %NI$CHT                 ( NAME="NI$CHT(0:0)", STCLASS="BASED(NI$CHT$)" ) ;
     1102      994        %NI$DCT                 ( NAME=NI$DCT,        STCLASS="BASED(DCT$)" ) ;
     1103     1042        %NI$SQH                 ( NAME=SQH,           STCLASS="BASED(SQH$)" ) ;
     1104     1055        /*
     1105     1056                Constants
     1106     1057        */
     1107     1058        %SUB NEVER="WHILE('0'B)";
     1108     1059        %SUB FOREVER="WHILE('1'B)";
     1109     1060        %EJECT;
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:221  
     1110     1061    1           IF DCT.DFLG.MPCSTOP THEN RETURN;
     1111     1062    1           DCT$=ADDR(DCT);
     1112     1063    1           SQH$=DCT.SQH$;
     1113     1064    1           SVDQH$=ADDR(NIL);
     1114     1065                %LOCK (G#=SQH.GATE);
     1115     1068    2           DO WHILE(SQH.CQ$~=ADDR(NIL));
     1116     1069                   %DEQUEUE (P#=DQH$,Q#=SQH.CQ$);
     1117     1076    3              IF DQH.MPC$~=DCT$ THEN DO;
     1118     1077                      %ENQUEUE (P#=DQH,Q#=SVDQH$);
     1119     1080    3                 END;
     1120     1081    2              END;
     1121     1082    1           SQH.CQ$=SVDQH$;
     1122     1083    1           STOPPED='1'B;
     1123     1084    2           DO I=0 TO %N_CHANSPERMPC-1;
     1124     1085    3              IF DCT.MPC.IOCHANX(I)~=0 THEN DO;
     1125     1086    3                 DQH$=NI$CHT.DQH$(DCT.MPC.IOCHANX(I));
     1126     1087    3                 DQH.CHANSTATE.STOP='1'B;
     1127     1088    3                 IF DQH.STATE~=%IDLE THEN STOPPED='0'B;
     1128     1089    3                 END;
     1129     1090    2              END;
     1130     1091                %UNLOCK (G#=SQH.GATE);
     1131     1094    2           IF STOPPED THEN DO;
     1132     1095    2              DCT.DFLG.MPCSTOP='1'B;
     1133     1096    3              IF DCT.DFLG.RELOAD THEN DO;
     1134     1097    3                 CALL NIW$LDFWR(DCT,'0'B);
     1135     1098    3                 END;
     1136     1099    2              END;
     1137     1100    1           CALL NIW$SCANAQ(SQH);
     1138     1101    1           RETURN;
     1139     1102        %EJECT;
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:222  
     1140     1103    1   NIW$MPCSTART: ENTRY(DCT);
     1141     1104    1           IF NOT DCT.DFLG.MPCSTOP THEN RETURN;
     1142     1105    1           DCT.DFLG.MPCSTOP='0'B;
     1143     1106    1           SQH$=DCT.SQH$;
     1144     1107    2           DO  I = 0 TO %N_CHANSPERMPCM1;
     1145     1108    2              IF  DCT.MPC.IOCHANX(I) ~= 0
     1146     1109    3              THEN DO ;
     1147     1110    3                 DQH$ = NI$CHT.DQH$(DCT.MPC.IOCHANX(I)) ;
     1148     1111    3                 DQH.CHANSTATE.STOP = '0'B ;
     1149     1112    3                 IF  IT_CP6UP = 0
     1150     1113    3                 THEN
     1151     1114    3                    IF  IT_PARTITION.IOCHAN(DQH.IOCHANX)
     1152     1115    3                      OR  IT_PARTITION.MSOS_IOCHAN(DQH.IOCHANX)
     1153     1116    3                    THEN
     1154     1117    3    /*  Do Nothing  */ ;
     1155     1118    3                    ELSE
     1156     1119    3                       GOTO DQHSTART ;
     1157     1120    3                 ELSE
     1158     1121    3                    IF  DQH.STATUS.DOWN
     1159     1122    3                    THEN
     1160     1123    3    /*  Do Nothing  */ ;
     1161     1124    3                    ELSE
     1162     1125    3   DQHSTART:           CALL NIW$DQHSTART ( DQH ) ;
     1163     1126    3                 END ;
     1164     1127    2              END ;
     1165     1128    2           DO I=SQH.FDCT TO SQH.NDCT+SQH.FDCT-1;
     1166     1129    2              DCT$=N$DCT$(I);
     1167     1130    3              IF NI$DCT.STATE=%MPCWAIT THEN DO;
     1168     1131    4                 IF NI$DCT.MSG#~=0 THEN DO;
     1169     1132    4                    CALL OCI$MK_STTM(NI$DCT.MSG#);
     1170     1133    4                    NI$DCT.MSG#=0;
     1171     1134    4                    END;
     1172     1135    3                 DVSCH=NI$DCT.DVT$->DVT.DVSCH;
     1173     1136    3                 CALL DVSCH(NI$DCT,%IDLE);
     1174     1137    3                 END;
     1175     1138    2              END;
     1176     1139    1           CALL NIW$SCANAQ(SQH);
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:223  
     1177     1140    1           RETURN;
     1178     1141    1   END NIW$MPCSTOP;
     1179     1142        %EOD;

PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:224  
--  Include file information  --

   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIW$MPCSTOP.

   Procedure NIW$MPCSTOP requires 210 words for executable code.
   Procedure NIW$MPCSTOP requires 14 words of local(AUTO) storage.

PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:225  

 Object Unit name= NIW$MPCSTOP                                File name= NIW$MPC.:E05TOU
 UTS= JUL 30 '97 03:44:21.52 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   210    322  NIW$MPCSTOP
    1  RoData even  none     3      3  NIW$MPCSTOP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  NIW$MPCSTOP
     0    144                  yes      Std        1  NIW$MPCSTART

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
 yes     yes           Std       2 NIM$DEQUEUE
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       2 NIW$LDFWR
 yes     yes           Std       1 NIW$DQHSTART
         yes           Std       1 OCI$MK_STTM
         yes           Std       2 NIM$ENQUEUE
         yes           Std       1 NIW$SCANAQ
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:226  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               N$FQ$                                 NI$CHT$
     NI$FQ$                                NI$IBUF$                              NI$RP$
     IT_CP6UP                              IT_PARTITION                          B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:227  


     1056        1        /*T***********************************************************/
     1057        2        /*T*                                                         */
     1058        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1059        4        /*T*                                                         */
     1060        5        /*T***********************************************************/
     1061        6        NIW$MPCSTOP: PROC(DCT);

      6  0 000000   000000 700200 xent  NIW$MPCSTOP  TSX0  ! X66_AUTO_1
         0 000001   000016 000001                    ZERO    14,1

     1062        7        /*
     1063        8                Includes
     1064        9        */
     1065       10        %INCLUDE                HF_LOCK_C ;
     1066       24        %INCLUDE                NI_DATA_R ;
     1067      461        %INCLUDE                NI_DATA_C ;
     1068      574        %INCLUDE                NI_MACROS_C ;
     1069      841        %INCLUDE                N_FC_C ;
     1070      878        /*
     1071      879                Parameters
     1072      880        */
     1073      881        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
     1074      929        /*
     1075      930                Entries
     1076      931        */
     1077      932    1   DCL 1 NIW$DQHSTART      ENTRY(1) ALTRET ;
     1078      933    1   DCL 1 NIW$LDFWR         ENTRY(2) ALTRET ;
     1079      934    1   DCL 1 NIW$SCANAQ        ENTRY(1) ;
     1080      935    1   DCL 1 OCI$MK_STTM       ENTRY(1) ;
     1081      936        /*
     1082      937                Symrefs
     1083      938        */
     1084      939    1   DCL 1 IT_CP6UP          UBIN WORD SYMREF ;
     1085      940        %NI$PARTITION           ( NAME=IT_PARTITION, STCLASS=SYMREF ) ;
     1086      948        /*
     1087      949                Auto
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:228  
     1088      950        */
     1089      951    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
     1090      952    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
     1091      953    1   DCL 1 DVSCH             EPTR ALIGNED AUTO ;
     1092      954    1   DCL 1 I                 SBIN ALIGNED AUTO ;
     1093      955    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
     1094      956    1   DCL 1 STOPPED           BIT(1) ALIGNED AUTO ;
     1095      957    1   DCL 1 SVDQH$            PTR ALIGNED AUTO ;
     1096      958        /*
     1097      959                Based
     1098      960        */
     1099      961        %NI$DQH                 ( NAME=DQH,           STCLASS="BASED(DQH$)" ) ;
     1100      984        %NI$DVT                 ( NAME=DVT,           STCLASS=BASED ) ;
     1101      991        %NI$CHT                 ( NAME="NI$CHT(0:0)", STCLASS="BASED(NI$CHT$)" ) ;
     1102      994        %NI$DCT                 ( NAME=NI$DCT,        STCLASS="BASED(DCT$)" ) ;
     1103     1042        %NI$SQH                 ( NAME=SQH,           STCLASS="BASED(SQH$)" ) ;
     1104     1055        /*
     1105     1056                Constants
     1106     1057        */
     1107     1058        %SUB NEVER="WHILE('0'B)";
     1108     1059        %SUB FOREVER="WHILE('1'B)";
     1109     1060        %EJECT;
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:229  
     1110     1061    1           IF DCT.DFLG.MPCSTOP THEN RETURN;

   1061  0 000002   200003 470500                    LDP0    @DCT,,AUTO
         0 000003   000006 236100                    LDQ     6,,PR0
         0 000004   001000 316007                    CANQ    512,DL
         0 000005   000007 600000 0                  TZE     s:1062

   1061  0 000006   000000 702200 xent               TSX2  ! X66_ARET

     1111     1062    1           DCT$=ADDR(DCT);

   1062  0 000007   200003 236100                    LDQ     @DCT,,AUTO
         0 000010   200004 756100                    STQ     DCT$,,AUTO

     1112     1063    1           SQH$=DCT.SQH$;

   1063  0 000011   000022 236100                    LDQ     18,,PR0
         0 000012   200010 756100                    STQ     SQH$,,AUTO

     1113     1064    1           SVDQH$=ADDR(NIL);

   1064  0 000013   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000014   200012 756100                    STQ     SVDQH$,,AUTO

     1114     1065                %LOCK (G#=SQH.GATE);

   1066  0 000015   200010 630500                    EPPR0   SQH$,,AUTO
         0 000016   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000017   000000 701000 xent               TSX1    HFC$LOCK
         0 000020   000000 011000                    NOP     0

     1115     1068    2           DO WHILE(SQH.CQ$~=ADDR(NIL));

   1068  0 000021   000047 710000 0                  TRA     s:1081

     1116     1069                   %DEQUEUE (P#=DQH$,Q#=SQH.CQ$);

PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:230  
   1073  0 000022   200010 236100                    LDQ     SQH$,,AUTO
         0 000023   000004 036003                    ADLQ    4,DU
         0 000024   200015 756100                    STQ     SVDQH$+3,,AUTO
         0 000025   200005 630500                    EPPR0   DQH$,,AUTO
         0 000026   200014 450500                    STP0    SVDQH$+2,,AUTO
         0 000027   200014 630500                    EPPR0   SVDQH$+2,,AUTO
         0 000030   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000031   000000 701000 xent               TSX1    NIM$DEQUEUE
         0 000032   000000 011000                    NOP     0

     1117     1076    3              IF DQH.MPC$~=DCT$ THEN DO;

   1076  0 000033   200005 470500                    LDP0    DQH$,,AUTO
         0 000034   000015 236100                    LDQ     13,,PR0
         0 000035   200004 116100                    CMPQ    DCT$,,AUTO
         0 000036   000047 600000 0                  TZE     s:1081

     1118     1077                      %ENQUEUE (P#=DQH,Q#=SVDQH$);

   1078  0 000037   200012 631500                    EPPR1   SVDQH$,,AUTO
         0 000040   200015 451500                    STP1    SVDQH$+3,,AUTO
         0 000041   200005 236100                    LDQ     DQH$,,AUTO
         0 000042   200014 756100                    STQ     SVDQH$+2,,AUTO
         0 000043   200014 630500                    EPPR0   SVDQH$+2,,AUTO
         0 000044   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000045   000000 701000 xent               TSX1    NIM$ENQUEUE
         0 000046   000000 011000                    NOP     0

     1119     1080    3                 END;

     1120     1081    2              END;

   1081  0 000047   200010 470500                    LDP0    SQH$,,AUTO
         0 000050   000004 236100                    LDQ     4,,PR0
         0 000051   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000052   000022 601000 0                  TNZ     s:1073

PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:231  
     1121     1082    1           SQH.CQ$=SVDQH$;

   1082  0 000053   200012 236100                    LDQ     SVDQH$,,AUTO
         0 000054   000004 756100                    STQ     4,,PR0

     1122     1083    1           STOPPED='1'B;

   1083  0 000055   400000 236003                    LDQ     -131072,DU
         0 000056   200011 756100                    STQ     STOPPED,,AUTO

     1123     1084    2           DO I=0 TO %N_CHANSPERMPC-1;

   1084  0 000057   200007 450100                    STZ     I,,AUTO
         0 000060   000111 710000 0                  TRA     s:1090+1

     1124     1085    3              IF DCT.MPC.IOCHANX(I)~=0 THEN DO;

   1085  0 000061   200003 470500                    LDP0    @DCT,,AUTO
         0 000062   200007 235100                    LDA     I,,AUTO
         0 000063   000100 101505                    MRL     fill='000'O
         0 000064   000031 000001                    ADSC9   25,A,PR0                 cn=0,n=1
         0 000065   200014 000004                    ADSC9   SVDQH$+2,,AUTO           cn=0,n=4
         0 000066   200014 236100                    LDQ     SVDQH$+2,,AUTO
         0 000067   000000 116003                    CMPQ    0,DU
         0 000070   000110 600000 0                  TZE     s:1090

     1125     1086    3                 DQH$=NI$CHT.DQH$(DCT.MPC.IOCHANX(I));

   1086  0 000071   000100 101505                    MRL     fill='000'O
         0 000072   000031 000001                    ADSC9   25,A,PR0                 cn=0,n=1
         0 000073   200014 000002                    ADSC9   SVDQH$+2,,AUTO           cn=0,n=2
         0 000074   200014 220100                    LDX0    SVDQH$+2,,AUTO
         0 000075   200014 020100                    ADLX0   SVDQH$+2,,AUTO
         0 000076   000000 471400 xsym               LDP1    NI$CHT$
         0 000077   100000 236110                    LDQ     0,X0,PR1
         0 000100   200005 756100                    STQ     DQH$,,AUTO

PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:232  
     1126     1087    3                 DQH.CHANSTATE.STOP='1'B;

   1087  0 000101   200005 473500                    LDP3    DQH$,,AUTO
         0 000102   400000 236003                    LDQ     -131072,DU
         0 000103   300020 256100                    ORSQ    16,,PR3

     1127     1088    3                 IF DQH.STATE~=%IDLE THEN STOPPED='0'B;

   1088  0 000104   300001 236100                    LDQ     1,,PR3
         0 000105   000077 316007                    CANQ    63,DL
         0 000106   000110 600000 0                  TZE     s:1090

   1088  0 000107   200011 450100                    STZ     STOPPED,,AUTO

     1128     1089    3                 END;

     1129     1090    2              END;

   1090  0 000110   200007 054100                    AOS     I,,AUTO
         0 000111   200007 235100                    LDA     I,,AUTO
         0 000112   000017 115007                    CMPA    15,DL
         0 000113   000061 604400 0                  TMOZ    s:1085

     1130     1091                %UNLOCK (G#=SQH.GATE);

   1092  0 000114   200010 630500                    EPPR0   SQH$,,AUTO
         0 000115   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000116   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000117   000000 011000                    NOP     0

     1131     1094    2           IF STOPPED THEN DO;

   1094  0 000120   200011 234100                    SZN     STOPPED,,AUTO
         0 000121   000137 605000 0                  TPL     s:1100

     1132     1095    2              DCT.DFLG.MPCSTOP='1'B;

PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:233  
   1095  0 000122   200003 470500                    LDP0    @DCT,,AUTO
         0 000123   001000 236007                    LDQ     512,DL
         0 000124   000006 256100                    ORSQ    6,,PR0

     1133     1096    3              IF DCT.DFLG.RELOAD THEN DO;

   1096  0 000125   000006 236100                    LDQ     6,,PR0
         0 000126   004000 316007                    CANQ    2048,DL
         0 000127   000137 600000 0                  TZE     s:1100

     1134     1097    3                 CALL NIW$LDFWR(DCT,'0'B);

   1097  0 000130   000000 236000 1                  LDQ     0
         0 000131   200003 235100                    LDA     @DCT,,AUTO
         0 000132   200014 757100                    STAQ    SVDQH$+2,,AUTO
         0 000133   200014 630500                    EPPR0   SVDQH$+2,,AUTO
         0 000134   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000135   000000 701000 xent               TSX1    NIW$LDFWR
         0 000136   000000 011000                    NOP     0

     1135     1098    3                 END;

     1136     1099    2              END;

     1137     1100    1           CALL NIW$SCANAQ(SQH);

   1100  0 000137   200010 630500                    EPPR0   SQH$,,AUTO
         0 000140   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000141   000000 701000 xent               TSX1    NIW$SCANAQ
         0 000142   000000 011000                    NOP     0

     1138     1101    1           RETURN;

   1101  0 000143   000000 702200 xent               TSX2  ! X66_ARET

     1139     1102        %EJECT;
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:234  
     1140     1103    1   NIW$MPCSTART: ENTRY(DCT);

   1103  0 000144   000000 700200 xent  NIW$MPCSTART TSX0  ! X66_AUTO_1
         0 000145   000016 000001                    ZERO    14,1

     1141     1104    1           IF NOT DCT.DFLG.MPCSTOP THEN RETURN;

   1104  0 000146   200003 470500                    LDP0    @DCT,,AUTO
         0 000147   000006 236100                    LDQ     6,,PR0
         0 000150   001000 316007                    CANQ    512,DL
         0 000151   000153 601000 0                  TNZ     s:1105

   1104  0 000152   000000 702200 xent               TSX2  ! X66_ARET

     1142     1105    1           DCT.DFLG.MPCSTOP='0'B;

   1105  0 000153   000001 236000 1                  LDQ     1
         0 000154   000006 356100                    ANSQ    6,,PR0

     1143     1106    1           SQH$=DCT.SQH$;

   1106  0 000155   000022 236100                    LDQ     18,,PR0
         0 000156   200010 756100                    STQ     SQH$,,AUTO

     1144     1107    2           DO  I = 0 TO %N_CHANSPERMPCM1;

   1107  0 000157   200007 450100                    STZ     I,,AUTO

     1145     1108    2              IF  DCT.MPC.IOCHANX(I) ~= 0

   1108  0 000160   200003 470500                    LDP0    @DCT,,AUTO
         0 000161   200007 235100                    LDA     I,,AUTO
         0 000162   000100 101505                    MRL     fill='000'O
         0 000163   000031 000001                    ADSC9   25,A,PR0                 cn=0,n=1
         0 000164   200014 000004                    ADSC9   SVDQH$+2,,AUTO           cn=0,n=4
         0 000165   200014 236100                    LDQ     SVDQH$+2,,AUTO
         0 000166   000000 116003                    CMPQ    0,DU
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:235  
         0 000167   000230 600000 0                  TZE     s:1127

     1146     1109    3              THEN DO ;

     1147     1110    3                 DQH$ = NI$CHT.DQH$(DCT.MPC.IOCHANX(I)) ;

   1110  0 000170   000100 101505                    MRL     fill='000'O
         0 000171   000031 000001                    ADSC9   25,A,PR0                 cn=0,n=1
         0 000172   200014 000002                    ADSC9   SVDQH$+2,,AUTO           cn=0,n=2
         0 000173   200014 220100                    LDX0    SVDQH$+2,,AUTO
         0 000174   200014 020100                    ADLX0   SVDQH$+2,,AUTO
         0 000175   000000 471400 xsym               LDP1    NI$CHT$
         0 000176   100000 236110                    LDQ     0,X0,PR1
         0 000177   200005 756100                    STQ     DQH$,,AUTO

     1148     1111    3                 DQH.CHANSTATE.STOP = '0'B ;

   1111  0 000200   200005 473500                    LDP3    DQH$,,AUTO
         0 000201   000031 236000 xsym               LDQ     B_VECTNIL+25
         0 000202   300020 356100                    ANSQ    16,,PR3

     1149     1112    3                 IF  IT_CP6UP = 0

   1112  0 000203   000000 235000 xsym               LDA     IT_CP6UP
         0 000204   000221 601000 0                  TNZ     s:1121

     1150     1113    3                 THEN
     1151     1114    3                    IF  IT_PARTITION.IOCHAN(DQH.IOCHANX)

   1114  0 000205   300001 236100                    LDQ     1,,PR3
         0 000206   000022 772000                    QRL     18
         0 000207   000777 376007                    ANQ     511,DL
         0 000210   000000 066406                    CMPB    filb='0'B
         0 000211   000012 000001 xsym               BDSC    IT_PARTITION+10,Q        by=0,bit=0,n=1
         0 000212   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         0 000213   000220 601000 0                  TNZ     s:1115
         0 000214   000000 066406                    CMPB    filb='0'B
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:236  
         0 000215   000043 000001 xsym               BDSC    IT_PARTITION+35,Q        by=0,bit=0,n=1
         0 000216   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         0 000217   000224 600000 0                  TZE     DQHSTART

     1152     1115    3                      OR  IT_PARTITION.MSOS_IOCHAN(DQH.IOCHANX)

   1115  0 000220   000230 710000 0                  TRA     s:1127

     1153     1116    3                    THEN
     1154     1117    3    /*  Do Nothing  */ ;
     1155     1118    3                    ELSE
     1156     1119    3                       GOTO DQHSTART ;
     1157     1120    3                 ELSE
     1158     1121    3                    IF  DQH.STATUS.DOWN

   1121  0 000221   300001 236100                    LDQ     1,,PR3
         0 000222   200000 316003                    CANQ    65536,DU
         0 000223   000230 601000 0                  TNZ     s:1127

     1159     1122    3                    THEN
     1160     1123    3    /*  Do Nothing  */ ;
     1161     1124    3                    ELSE
     1162     1125    3   DQHSTART:           CALL NIW$DQHSTART ( DQH ) ;

   1125  0 000224   200005 630500       DQHSTART     EPPR0   DQH$,,AUTO
         0 000225   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000226   000000 701000 xent               TSX1    NIW$DQHSTART
         0 000227   000000 011000                    NOP     0

     1163     1126    3                 END ;

     1164     1127    2              END ;

   1127  0 000230   200007 054100                    AOS     I,,AUTO
         0 000231   200007 235100                    LDA     I,,AUTO
         0 000232   000017 115007                    CMPA    15,DL
         0 000233   000160 604400 0                  TMOZ    s:1108
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:237  

     1165     1128    2           DO I=SQH.FDCT TO SQH.NDCT+SQH.FDCT-1;

   1128  0 000234   200010 470500                    LDP0    SQH$,,AUTO
         0 000235   000002 236100                    LDQ     2,,PR0
         0 000236   000022 772000                    QRL     18
         0 000237   200007 756100                    STQ     I,,AUTO
         0 000240   000303 710000 0                  TRA     s:1138+1

     1166     1129    2              DCT$=N$DCT$(I);

   1129  0 000241   000000 470400 xsym               LDP0    N$DCT$$
         0 000242   200007 720100                    LXL0    I,,AUTO
         0 000243   000000 236110                    LDQ     0,X0,PR0
         0 000244   200004 756100                    STQ     DCT$,,AUTO

     1167     1130    3              IF NI$DCT.STATE=%MPCWAIT THEN DO;

   1130  0 000245   200004 471500                    LDP1    DCT$,,AUTO
         0 000246   100007 236100                    LDQ     7,,PR1
         0 000247   000077 376007                    ANQ     63,DL
         0 000250   000007 116007                    CMPQ    7,DL
         0 000251   000302 601000 0                  TNZ     s:1138

     1168     1131    4                 IF NI$DCT.MSG#~=0 THEN DO;

   1131  0 000252   100027 721100                    LXL1    23,,PR1
         0 000253   000266 600000 0                  TZE     s:1135

     1169     1132    4                    CALL OCI$MK_STTM(NI$DCT.MSG#);

   1132  0 000254   200004 236100                    LDQ     DCT$,,AUTO
         0 000255   000002 036000 1                  ADLQ    2
         0 000256   200014 756100                    STQ     SVDQH$+2,,AUTO
         0 000257   200014 630500                    EPPR0   SVDQH$+2,,AUTO
         0 000260   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000261   000000 701000 xent               TSX1    OCI$MK_STTM
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:238  
         0 000262   000000 011000                    NOP     0

     1170     1133    4                    NI$DCT.MSG#=0;

   1133  0 000263   000000 220003                    LDX0    0,DU
         0 000264   200004 470500                    LDP0    DCT$,,AUTO
         0 000265   000027 440100                    SXL0    23,,PR0

     1171     1134    4                    END;

     1172     1135    3                 DVSCH=NI$DCT.DVT$->DVT.DVSCH;

   1135  0 000266   200004 470500                    LDP0    DCT$,,AUTO
         0 000267   000024 471500                    LDP1    20,,PR0
         0 000270   100002 236100                    LDQ     2,,PR1
         0 000271   200006 756100                    STQ     DVSCH,,AUTO

     1173     1136    3                 CALL DVSCH(NI$DCT,%IDLE);

   1136  0 000272   000000 236000 1                  LDQ     0
         0 000273   200004 235100                    LDA     DCT$,,AUTO
         0 000274   200014 757100                    STAQ    SVDQH$+2,,AUTO
         0 000275   200014 630500                    EPPR0   SVDQH$+2,,AUTO
         0 000276   200006 220100                    LDX0    DVSCH,,AUTO
         0 000277   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000300   000000 701010                    TSX1    0,X0
         0 000301   000000 011000                    NOP     0

     1174     1137    3                 END;

     1175     1138    2              END;

   1138  0 000302   200007 054100                    AOS     I,,AUTO
         0 000303   200010 470500                    LDP0    SQH$,,AUTO
         0 000304   000002 236100                    LDQ     2,,PR0
         0 000305   000022 772000                    QRL     18
         0 000306   200014 756100                    STQ     SVDQH$+2,,AUTO
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:239  
         0 000307   000002 236100                    LDQ     2,,PR0
         0 000310   777777 376007                    ANQ     -1,DL
         0 000311   200014 036100                    ADLQ    SVDQH$+2,,AUTO
         0 000312   000241 604000 0                  TMI     s:1129
         0 000313   200007 116100                    CMPQ    I,,AUTO
         0 000314   000241 605400 0                  TPNZ    s:1129

     1176     1139    1           CALL NIW$SCANAQ(SQH);

   1139  0 000315   200010 630500                    EPPR0   SQH$,,AUTO
         0 000316   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000317   000000 701000 xent               TSX1    NIW$SCANAQ
         0 000320   000000 011000                    NOP     0

     1177     1140    1           RETURN;

   1140  0 000321   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000002 006000   777777 776777   000027 400000                    ............
     1178     1141    1   END NIW$MPCSTOP;
     1179     1142        %EOD;

PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:240  
--  Include file information  --

   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIW$MPCSTOP.
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:241  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DCT                      *0-0-0/w STRC(1332)  r     1 DCT
     4-0-0/w PTR         r     1 DCT$                       5-0-0/w PTR         r     1 DQH$
     6-0-0/w EPTR        r     1 DVSCH                      7-0-0/w SBIN        r     1 I
    10-0-0/w PTR         r     1 SQH$                      11-0-0/w BIT         r     1 STOPPED
    12-0-0/w PTR         r     1 SVDQH$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 IT_CP6UP                   0-0-0/w STRC(1800)  r     1 IT_PARTITION
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$CHT$                    0-0-0/w PTR         r     1 NI$FQ$
     0-0-0/w PTR         r     1 NI$IBUF$                   0-0-0/w PTR         r     1 NI$RP$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(648)   r     1 DQH                        0-0-0/w STRC(2844)  r     1 DVT
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/w STRC(72)    r     1 NI$CHT(0:0)
     0-0-0/w STRC(1332)  r     1 NI$DCT                     0-0-0/w STRC(252)   r     1 SQH


   Procedure NIW$MPCSTOP requires 210 words for executable code.
   Procedure NIW$MPCSTOP requires 14 words of local(AUTO) storage.
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:242  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:243  
          MINI XREF LISTING

DCT
       890**DCL         6--PROC     1062--ASSIGN   1097<>CALL     1103--ENTRY
DCT.DFLG.MPCSTOP
       895**DCL      1061>>IF       1095<<ASSIGN   1104>>IF       1105<<ASSIGN
DCT.DFLG.RELOAD
       894**DCL      1096>>IF
DCT.DP
       910**DCL       917--REDEF     920--REDEF     921--REDEF     923--REDEF     923--REDEF     924--REDEF
       925--REDEF     925--REDEF
DCT.MPC.IOCHANX
       918**DCL       918--REDEF    1085>>IF       1086>>ASSIGN   1108>>IF       1110>>ASSIGN
DCT.SQH$
       905**DCL      1063>>ASSIGN   1106>>ASSIGN
DCT$
       951**DCL      1003--IMP-PTR  1062<<ASSIGN   1076>>IF       1129<<ASSIGN   1130>>IF       1131>>IF
      1132>>CALL     1133>>ASSIGN   1135>>ASSIGN   1136>>CALL
DQH
       970**DCL      1078<>CALL     1125<>CALL
DQH.CHANSTATE.STOP
       978**DCL      1087<<ASSIGN   1111<<ASSIGN
DQH.IOCHANX
       972**DCL       973--REDEF    1114>>IF       1114>>IF
DQH.MBX$
       981**DCL       982--REDEF
DQH.MPC$
       977**DCL      1076>>IF
DQH.STATE
       974**DCL      1088>>IF
DQH.STATUS.DOWN
       970**DCL      1121>>IF
DQH$
       952**DCL       970--IMP-PTR  1073<>CALL     1076>>IF       1078>>CALL     1086<<ASSIGN   1087>>ASSIGN
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:244  
      1088>>IF       1110<<ASSIGN   1111>>ASSIGN   1114>>IF       1114>>IF       1121>>IF       1125>>CALL
DQHSTART
      1125**LABEL    1119--GOTO
DVSCH
       953**DCL      1135<<ASSIGN   1136>>CALL
DVT.DVSCH
       985**DCL      1135>>ASSIGN
DVT.MPC
       987**DCL       988--REDEF
HFC$LOCK
        23**DCL-ENT  1066--CALL
HFC$UNLOCK
        23**DCL-ENT  1092--CALL
I
       954**DCL      1084<<DOINDEX  1085>>IF       1086>>ASSIGN   1107<<DOINDEX  1108>>IF       1110>>ASSIGN
      1128<<DOINDEX  1129>>ASSIGN
IT_CP6UP
       939**DCL      1112>>IF
IT_PARTITION.IOCHAN
       946**DCL      1114>>IF
IT_PARTITION.MSOS_IOCHAN
       946**DCL      1114>>IF
N$DCT$
       456**DCL      1129>>ASSIGN
N$DCT$$
       322**DCL       456--IMP-PTR  1129>>ASSIGN
N$FQ$
       322**DCL       457--IMP-PTR
N$REQ_INIT.BUFADDR
       341**DCL       342--REDEF     342--REDEF
N$REQ_INIT.DLA.DRELADDR
       333**DCL       333--REDEF
N$REQ_INIT.DVE.EOMCHAR
       370**DCL       371--REDEF
N$REQ_INIT.EAINFO
       364**DCL       364--REDEF
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:245  
N$REQ_INIT.EAINFOX
       364**DCL       365--REDEF
N$REQ_INIT.EVNTINFO
       365**DCL       365--REDEF
N$REQ_INIT.STATUS
       346**DCL       352--REDEF
NI$CHT.DQH$
       992**DCL      1086>>ASSIGN   1110>>ASSIGN
NI$CHT$
       381**DCL       992--IMP-PTR  1086>>ASSIGN   1110>>ASSIGN
NI$DCT
      1003**DCL      1136<>CALL
NI$DCT.DP
      1023**DCL      1030--REDEF    1033--REDEF    1034--REDEF    1036--REDEF    1036--REDEF    1037--REDEF
      1038--REDEF    1038--REDEF
NI$DCT.DVT$
      1019**DCL      1135>>ASSIGN
NI$DCT.MPC.IOCHANX
      1031**DCL      1031--REDEF
NI$DCT.MSG#
      1023**DCL      1131>>IF       1132<>CALL     1133<<ASSIGN
NI$DCT.STATE
      1013**DCL      1130>>IF
NI$FQ$
       382**DCL       458--IMP-PTR
NI$IBUF$
       382**DCL       458--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       392**DCL       393--REDEF     393--REDEF
NI$IMXMBX_INIT.SIZE
       394**DCL       394--REDEF
NI$REQ_INIT.DCW
       416**DCL       419--REDEF
NI$REQ_INIT.DCW.TALLY
       417**DCL       417--REDEF
NI$REQ_INIT.IDCW.EXTA
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:246  
       419**DCL       419--REDEF
NI$REQ_INIT.PCW
       421**DCL       425--REDEF
NI$REQ_INIT.SEEK
       426**DCL       427--REDEF     428--REDEF
NI$RP$
       430**DCL       460--IMP-PTR
NIM$DEQUEUE
       598**DCL-ENT  1073--CALL
NIM$ENQUEUE
       599**DCL-ENT  1078--CALL
NIW$DQHSTART
       932**DCL-ENT  1125--CALL
NIW$LDFWR
       933**DCL-ENT  1097--CALL
NIW$SCANAQ
       934**DCL-ENT  1100--CALL     1139--CALL
NI_MBX_INIT.DCW.CONTROL.AE
       452**DCL       452--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       448**DCL       448--REDEF
OCI$MK_STTM
       935**DCL-ENT  1132--CALL
SQH
      1051**DCL      1100<>CALL     1139<>CALL
SQH.CQ$
      1052**DCL      1068>>DOWHILE  1073<>CALL     1082<<ASSIGN
SQH.DOOR
      1051**DCL      1051--REDEF
SQH.FDCT
      1051**DCL      1128>>DOINDEX  1128>>DOINDEX
SQH.GATE
      1051**DCL      1066<>CALL     1092<>CALL
SQH.NDCT
      1052**DCL      1128>>DOINDEX
SQH$
PL6.E3A0      #005=NIW$MPCSTOP File=NIW$MPC.:E05TSI                              WED 07/30/97 03:44 Page:247  
       955**DCL      1051--IMP-PTR  1063<<ASSIGN   1066>>CALL     1068>>DOWHILE  1073>>CALL     1082>>ASSIGN
      1092>>CALL     1100>>CALL     1106<<ASSIGN   1128>>DOINDEX  1128>>DOINDEX  1128>>DOINDEX  1139>>CALL
STOPPED
       956**DCL      1083<<ASSIGN   1088<<ASSIGN   1094>>IF
SVDQH$
       957**DCL      1064<<ASSIGN   1078<>CALL     1082>>ASSIGN

PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:248  
     1180        1        /*T***********************************************************/
     1181        2        /*T*                                                         */
     1182        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1183        4        /*T*                                                         */
     1184        5        /*T***********************************************************/
     1185        6        /*T*/
     1186        7        NIW$DQHSTART: PROC ( DQH ) ALTRET ;
     1187        8        /*
     1188        9                Includes
     1189       10        */
     1190       11        %INCLUDE                HF_LOCK_C ;
     1191       25        %INCLUDE                NI_DATA_C ;
     1192      138        %INCLUDE                NI_DATA_R ;
     1193      575        %INCLUDE                NI_MACROS_C ;
     1194      842        %INCLUDE                N_FC_C ;
     1195      879        /*
     1196      880                Parameters
     1197      881        */
     1198      882        %NI$DQH                 ( NAME=DQH, STCLASS=PARAM ) ;
     1199      905        /*
     1200      906                Entries
     1201      907        */
     1202      908    1   DCL 1 NIQ$GET           ENTRY(1) ALTRET ;
     1203      909    1   DCL 1 NIO$QUE           ENTRY(1) ALTRET ;
     1204      910        /*
     1205      911                Auto
     1206      912        */
     1207      913    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
     1208      914    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
     1209      915    1   DCL 1 ONQUE             BIT(1) ALIGNED AUTO ;
     1210      916    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
     1211      917    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
     1212      918    1   DCL 1 TEMP$             PTR ALIGNED AUTO ;
     1213      919        /*
     1214      920                Based
     1215      921        */
     1216      922        %NI$DCT                 ( NAME=DCT,    STCLASS="BASED(DCT$)" ) ;
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:249  
     1217      970        %NI$DQH                 ( NAME=NI$DQH, STCLASS=BASED ) ;
     1218      993        %N$REQ                  ( NAME=REQ,    STCLASS="BASED(REQ$)" ) ;
     1219     1051        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
     1220     1064        /*
     1221     1065                Constants
     1222     1066        */
     1223     1067        %SUB NEVER="WHILE('0'B)";
     1224     1068        %EJECT;
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:250  
     1225     1069    1           DCT$=DQH.MPC$;
     1226     1070    1           SQH$=DQH.SQH$;
     1227     1071    1           CALL NIQ$GET(REQ$) ALTRET(NOPKTS);
     1228     1072    1           REQ.FC=%N_RQSTAT;
     1229     1073    1           REQ.BPMIR = '1'B ;
     1230     1074    1           REQ.DLA.DCTX=DCT.DCTX;
     1231     1075    1           REQ.DQH$=ADDR(DQH);
     1232     1076    1           REQ.NOALT='1'B;
     1233     1077    1           CALL NIO$QUE(REQ);
     1234     1078    2           DO NEVER;
     1235     1079    2   NOPKTS:
     1236     1080                   %LOCK (G#=SQH.GATE);
     1237     1083    3              IF DQH.STATE=%IDLE THEN DO;
     1238     1084                      %ENQUEUE (P#=DQH,Q#=SQH.CQ$);
     1239     1087    3                 END;
     1240     1088                   %UNLOCK (G#=SQH.GATE);
     1241     1091    2              END;
     1242     1092    1           RETURN;
     1243     1093
     1244     1094        %EJECT ;
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:251  
     1245     1095    1   NIW$DQHSTOP: ENTRY ( DQH ) ALTRET ;
     1246     1096
     1247     1097    1           DQH$ = ADDR(DQH) ;
     1248     1098    1           SQH$ = DQH.SQH$ ;
     1249     1099
     1250     1100    1           TEMP$ = SQH.CQ$ ;
     1251     1101    1           ONQUE = '1'B ;
     1252     1102
     1253     1103    1           IF TEMP$ ~= ADDR(NIL)
     1254     1104    2           THEN DO WHILE ( ONQUE AND TEMP$->NI$DQH.FL$ ~= DQH$ ) ;
     1255     1105    2              TEMP$ = TEMP$->NI$DQH.FL$ ;
     1256     1106    2              IF TEMP$ = SQH.CQ$ THEN
     1257     1107    2                 ONQUE = '0'B ;
     1258     1108    2              END ;
     1259     1109    1           ELSE
     1260     1110    1              ONQUE = '0'B ;
     1261     1111
     1262     1112    1           IF NOT ONQUE
     1263     1113    1           THEN
     1264     1114    1              ALTRETURN ;
     1265     1115    2           ELSE DO ;
     1266     1116    2              SQH.CQ$ = TEMP$ ;
     1267     1117                   %DEQUEUE ( P#=DQH$, Q#=SQH.CQ$ ) ;
     1268     1124    2              END ;
     1269     1125
     1270     1126    1           RETURN ;
     1271     1127
     1272     1128    1   END NIW$DQHSTART;
     1273     1129        %EOD;

PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:252  
--  Include file information  --

   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIW$DQHSTART.

   Procedure NIW$DQHSTART requires 102 words for executable code.
   Procedure NIW$DQHSTART requires 12 words of local(AUTO) storage.

PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:253  

 Object Unit name= NIW$DQHSTART                               File name= NIW$MPC.:E05TOU
 UTS= JUL 30 '97 03:44:46.84 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   102    146  NIW$DQHSTART

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  NIW$DQHSTART
     0     67          yes     yes      Std        1  NIW$DQHSTOP

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       1 NIO$QUE
         yes           Std       1 HFC$UNLOCK
         yes           Std       1 HFC$LOCK
 yes     yes           Std       2 NIM$DEQUEUE
         yes           Std       2 NIM$ENQUEUE
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:254  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                B_VECTNIL
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:255  


     1180        1        /*T***********************************************************/
     1181        2        /*T*                                                         */
     1182        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1183        4        /*T*                                                         */
     1184        5        /*T***********************************************************/
     1185        6        /*T*/
     1186        7        NIW$DQHSTART: PROC ( DQH ) ALTRET ;

      7  0 000000   000000 700200 xent  NIW$DQHSTART TSX0  ! X66_AUTO_1
         0 000001   000014 000001                    ZERO    12,1

     1187        8        /*
     1188        9                Includes
     1189       10        */
     1190       11        %INCLUDE                HF_LOCK_C ;
     1191       25        %INCLUDE                NI_DATA_C ;
     1192      138        %INCLUDE                NI_DATA_R ;
     1193      575        %INCLUDE                NI_MACROS_C ;
     1194      842        %INCLUDE                N_FC_C ;
     1195      879        /*
     1196      880                Parameters
     1197      881        */
     1198      882        %NI$DQH                 ( NAME=DQH, STCLASS=PARAM ) ;
     1199      905        /*
     1200      906                Entries
     1201      907        */
     1202      908    1   DCL 1 NIQ$GET           ENTRY(1) ALTRET ;
     1203      909    1   DCL 1 NIO$QUE           ENTRY(1) ALTRET ;
     1204      910        /*
     1205      911                Auto
     1206      912        */
     1207      913    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
     1208      914    1   DCL 1 DQH$              PTR ALIGNED AUTO ;
     1209      915    1   DCL 1 ONQUE             BIT(1) ALIGNED AUTO ;
     1210      916    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
     1211      917    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:256  
     1212      918    1   DCL 1 TEMP$             PTR ALIGNED AUTO ;
     1213      919        /*
     1214      920                Based
     1215      921        */
     1216      922        %NI$DCT                 ( NAME=DCT,    STCLASS="BASED(DCT$)" ) ;
     1217      970        %NI$DQH                 ( NAME=NI$DQH, STCLASS=BASED ) ;
     1218      993        %N$REQ                  ( NAME=REQ,    STCLASS="BASED(REQ$)" ) ;
     1219     1051        %NI$SQH                 ( NAME=SQH, STCLASS="BASED(SQH$)" ) ;
     1220     1064        /*
     1221     1065                Constants
     1222     1066        */
     1223     1067        %SUB NEVER="WHILE('0'B)";
     1224     1068        %EJECT;
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:257  
     1225     1069    1           DCT$=DQH.MPC$;

   1069  0 000002   200003 470500                    LDP0    @DQH,,AUTO
         0 000003   000015 236100                    LDQ     13,,PR0
         0 000004   200004 756100                    STQ     DCT$,,AUTO

     1226     1070    1           SQH$=DQH.SQH$;

   1070  0 000005   000013 236100                    LDQ     11,,PR0
         0 000006   200010 756100                    STQ     SQH$,,AUTO

     1227     1071    1           CALL NIQ$GET(REQ$) ALTRET(NOPKTS);

   1071  0 000007   200007 631500                    EPPR1   REQ$,,AUTO
         0 000010   200012 451500                    STP1    TEMP$+1,,AUTO
         0 000011   200012 630500                    EPPR0   TEMP$+1,,AUTO
         0 000012   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000013   000000 701000 xent               TSX1    NIQ$GET
         0 000014   000042 702000 0                  TSX2    NOPKTS

     1228     1072    1           REQ.FC=%N_RQSTAT;

   1072  0 000015   200007 470500                    LDP0    REQ$,,AUTO
         0 000016   000001 236007                    LDQ     1,DL
         0 000017   000003 552104                    STBQ    3,'04'O,PR0

     1229     1073    1           REQ.BPMIR = '1'B ;

   1073  0 000020   200007 470500                    LDP0    REQ$,,AUTO
         0 000021   200000 236003                    LDQ     65536,DU
         0 000022   000034 256100                    ORSQ    28,,PR0

     1230     1074    1           REQ.DLA.DCTX=DCT.DCTX;

   1074  0 000023   200004 471500                    LDP1    DCT$,,AUTO
         0 000024   100006 236100                    LDQ     6,,PR1
         0 000025   000001 676100                    ERQ     1,,PR0
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:258  
         0 000026   777770 376003                    ANQ     -8,DU
         0 000027   000001 656100                    ERSQ    1,,PR0

     1231     1075    1           REQ.DQH$=ADDR(DQH);

   1075  0 000030   200003 236100                    LDQ     @DQH,,AUTO
         0 000031   200007 470500                    LDP0    REQ$,,AUTO
         0 000032   000020 756100                    STQ     16,,PR0

     1232     1076    1           REQ.NOALT='1'B;

   1076  0 000033   100000 236007                    LDQ     32768,DL
         0 000034   000004 256100                    ORSQ    4,,PR0

     1233     1077    1           CALL NIO$QUE(REQ);

   1077  0 000035   200007 630500                    EPPR0   REQ$,,AUTO
         0 000036   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000037   000000 701000 xent               TSX1    NIO$QUE
         0 000040   000000 011000                    NOP     0

     1234     1078    2           DO NEVER;

   1078  0 000041   000066 710000 0                  TRA     s:1092

     1235     1079    2   NOPKTS:
     1236     1080                   %LOCK (G#=SQH.GATE);

   1081  0 000042   200010 630500       NOPKTS       EPPR0   SQH$,,AUTO
         0 000043   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000044   000000 701000 xent               TSX1    HFC$LOCK
         0 000045   000000 011000                    NOP     0

     1237     1083    3              IF DQH.STATE=%IDLE THEN DO;

   1083  0 000046   200003 470500                    LDP0    @DQH,,AUTO
         0 000047   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:259  
         0 000050   000077 316007                    CANQ    63,DL
         0 000051   000062 601000 0                  TNZ     s:1089

     1238     1084                      %ENQUEUE (P#=DQH,Q#=SQH.CQ$);

   1085  0 000052   200010 236100                    LDQ     SQH$,,AUTO
         0 000053   000004 036003                    ADLQ    4,DU
         0 000054   200003 235100                    LDA     @DQH,,AUTO
         0 000055   200012 757100                    STAQ    TEMP$+1,,AUTO
         0 000056   200012 630500                    EPPR0   TEMP$+1,,AUTO
         0 000057   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000060   000000 701000 xent               TSX1    NIM$ENQUEUE
         0 000061   000000 011000                    NOP     0

     1239     1087    3                 END;

     1240     1088                   %UNLOCK (G#=SQH.GATE);

   1089  0 000062   200010 630500                    EPPR0   SQH$,,AUTO
         0 000063   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000064   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000065   000000 011000                    NOP     0

     1241     1091    2              END;

     1242     1092    1           RETURN;

   1092  0 000066   000000 702200 xent               TSX2  ! X66_ARET

     1243     1093
     1244     1094        %EJECT ;
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:260  
     1245     1095    1   NIW$DQHSTOP: ENTRY ( DQH ) ALTRET ;

   1095  0 000067   000000 700200 xent  NIW$DQHSTOP  TSX0  ! X66_AUTO_1
         0 000070   000014 000001                    ZERO    12,1

     1246     1096
     1247     1097    1           DQH$ = ADDR(DQH) ;

   1097  0 000071   200003 236100                    LDQ     @DQH,,AUTO
         0 000072   200005 756100                    STQ     DQH$,,AUTO

     1248     1098    1           SQH$ = DQH.SQH$ ;

   1098  0 000073   200003 470500                    LDP0    @DQH,,AUTO
         0 000074   000013 236100                    LDQ     11,,PR0
         0 000075   200010 756100                    STQ     SQH$,,AUTO

     1249     1099
     1250     1100    1           TEMP$ = SQH.CQ$ ;

   1100  0 000076   200010 471500                    LDP1    SQH$,,AUTO
         0 000077   100004 236100                    LDQ     4,,PR1
         0 000100   200011 756100                    STQ     TEMP$,,AUTO

     1251     1101    1           ONQUE = '1'B ;

   1101  0 000101   400000 236003                    LDQ     -131072,DU
         0 000102   200006 756100                    STQ     ONQUE,,AUTO

     1252     1102
     1253     1103    1           IF TEMP$ ~= ADDR(NIL)

   1103  0 000103   200011 236100                    LDQ     TEMP$,,AUTO
         0 000104   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000105   000125 600000 0                  TZE     s:1110

     1254     1104    2           THEN DO WHILE ( ONQUE AND TEMP$->NI$DQH.FL$ ~= DQH$ ) ;
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:261  

   1104  0 000106   000116 710000 0                  TRA     s:1108

     1255     1105    2              TEMP$ = TEMP$->NI$DQH.FL$ ;

   1105  0 000107   200011 470500                    LDP0    TEMP$,,AUTO
         0 000110   000000 236100                    LDQ     0,,PR0
         0 000111   200011 756100                    STQ     TEMP$,,AUTO

     1256     1106    2              IF TEMP$ = SQH.CQ$ THEN

   1106  0 000112   200010 470500                    LDP0    SQH$,,AUTO
         0 000113   000004 116100                    CMPQ    4,,PR0
         0 000114   000116 601000 0                  TNZ     s:1108

     1257     1107    2                 ONQUE = '0'B ;

   1107  0 000115   200006 450100                    STZ     ONQUE,,AUTO

     1258     1108    2              END ;

   1108  0 000116   200006 234100                    SZN     ONQUE,,AUTO
         0 000117   000124 605000 0                  TPL     s:1108+6
         0 000120   200011 470500                    LDP0    TEMP$,,AUTO
         0 000121   000000 236100                    LDQ     0,,PR0
         0 000122   200005 116100                    CMPQ    DQH$,,AUTO
         0 000123   000107 601000 0                  TNZ     s:1105
         0 000124   000126 710000 0                  TRA     s:1112

     1259     1109    1           ELSE
     1260     1110    1              ONQUE = '0'B ;

   1110  0 000125   200006 450100                    STZ     ONQUE,,AUTO

     1261     1111
     1262     1112    1           IF NOT ONQUE

PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:262  
   1112  0 000126   200006 234100                    SZN     ONQUE,,AUTO
         0 000127   000131 604000 0                  TMI     s:1116

     1263     1113    1           THEN
     1264     1114    1              ALTRETURN ;

   1114  0 000130   000000 702200 xent               TSX2  ! X66_AALT

     1265     1115    2           ELSE DO ;

     1266     1116    2              SQH.CQ$ = TEMP$ ;

   1116  0 000131   200011 236100                    LDQ     TEMP$,,AUTO
         0 000132   200010 470500                    LDP0    SQH$,,AUTO
         0 000133   000004 756100                    STQ     4,,PR0

     1267     1117                   %DEQUEUE ( P#=DQH$, Q#=SQH.CQ$ ) ;

   1121  0 000134   200010 236100                    LDQ     SQH$,,AUTO
         0 000135   000004 036003                    ADLQ    4,DU
         0 000136   200013 756100                    STQ     TEMP$+2,,AUTO
         0 000137   200005 631500                    EPPR1   DQH$,,AUTO
         0 000140   200012 451500                    STP1    TEMP$+1,,AUTO
         0 000141   200012 630500                    EPPR0   TEMP$+1,,AUTO
         0 000142   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000143   000000 701000 xent               TSX1    NIM$DEQUEUE
         0 000144   000000 011000                    NOP     0

     1268     1124    2              END ;

     1269     1125
     1270     1126    1           RETURN ;

   1126  0 000145   000000 702200 xent               TSX2  ! X66_ARET
     1271     1127
     1272     1128    1   END NIW$DQHSTART;
     1273     1129        %EOD;
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:263  

PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:264  
--  Include file information  --

   N_FC_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure NIW$DQHSTART.
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:265  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DQH                       4-0-0/w PTR         r     1 DCT$
    *0-0-0/w STRC(648)   r     1 DQH                        5-0-0/w PTR         r     1 DQH$
     6-0-0/w BIT         r     1 ONQUE                      7-0-0/w PTR         r     1 REQ$
    10-0-0/w PTR         r     1 SQH$                      11-0-0/w PTR         r     1 TEMP$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1332)  r     1 DCT                        0-0-0/w STRC(648)   r     1 NI$DQH
     0-0-0/d STRC(1080)  r     1 REQ                        0-0-0/w STRC(252)   r     1 SQH


   Procedure NIW$DQHSTART requires 102 words for executable code.
   Procedure NIW$DQHSTART requires 12 words of local(AUTO) storage.
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:266  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:267  
          MINI XREF LISTING

DCT.DCTX
       932**DCL      1074>>ASSIGN
DCT.DP
       951**DCL       958--REDEF     961--REDEF     962--REDEF     964--REDEF     964--REDEF     965--REDEF
       966--REDEF     966--REDEF
DCT.MPC.IOCHANX
       959**DCL       959--REDEF
DCT$
       913**DCL       931--IMP-PTR  1069<<ASSIGN   1074>>ASSIGN
DQH
       891**DCL         7--PROC     1075--ASSIGN   1085<>CALL     1095--ENTRY    1097--ASSIGN
DQH.IOCHANX
       893**DCL       894--REDEF
DQH.MBX$
       902**DCL       903--REDEF
DQH.MPC$
       898**DCL      1069>>ASSIGN
DQH.SQH$
       897**DCL      1070>>ASSIGN   1098>>ASSIGN
DQH.STATE
       895**DCL      1083>>IF
DQH$
       914**DCL      1097<<ASSIGN   1104>>DOWHILE  1121<>CALL
HFC$LOCK
        24**DCL-ENT  1081--CALL
HFC$UNLOCK
        24**DCL-ENT  1089--CALL
N$DCT$$
       436**DCL       570--IMP-PTR
N$FQ$
       436**DCL       571--IMP-PTR
N$REQ_INIT.BUFADDR
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:268  
       455**DCL       456--REDEF     456--REDEF
N$REQ_INIT.DLA.DRELADDR
       447**DCL       447--REDEF
N$REQ_INIT.DVE.EOMCHAR
       484**DCL       485--REDEF
N$REQ_INIT.EAINFO
       478**DCL       478--REDEF
N$REQ_INIT.EAINFOX
       478**DCL       479--REDEF
N$REQ_INIT.EVNTINFO
       479**DCL       479--REDEF
N$REQ_INIT.STATUS
       460**DCL       466--REDEF
NI$DQH.FL$
       979**DCL      1104>>DOWHILE  1105>>ASSIGN
NI$DQH.IOCHANX
       981**DCL       982--REDEF
NI$DQH.MBX$
       990**DCL       991--REDEF
NI$FQ$
       496**DCL       572--IMP-PTR
NI$IBUF$
       496**DCL       572--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       506**DCL       507--REDEF     507--REDEF
NI$IMXMBX_INIT.SIZE
       508**DCL       508--REDEF
NI$REQ_INIT.DCW
       530**DCL       533--REDEF
NI$REQ_INIT.DCW.TALLY
       531**DCL       531--REDEF
NI$REQ_INIT.IDCW.EXTA
       533**DCL       533--REDEF
NI$REQ_INIT.PCW
       535**DCL       539--REDEF
NI$REQ_INIT.SEEK
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:269  
       540**DCL       541--REDEF     542--REDEF
NI$RP$
       544**DCL       574--IMP-PTR
NIM$DEQUEUE
       599**DCL-ENT  1121--CALL
NIM$ENQUEUE
       600**DCL-ENT  1085--CALL
NIO$QUE
       909**DCL-ENT  1077--CALL
NIQ$GET
       908**DCL-ENT  1071--CALL
NI_MBX_INIT.DCW.CONTROL.AE
       566**DCL       566--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       562**DCL       562--REDEF
NOPKTS
      1081**LABEL    1071--CALLALT
ONQUE
       915**DCL      1101<<ASSIGN   1104>>DOWHILE  1107<<ASSIGN   1110<<ASSIGN   1112>>IF
REQ
      1002**DCL      1077<>CALL
REQ.BPMIR
      1047**DCL      1073<<ASSIGN
REQ.BUFADDR
      1011**DCL      1012--REDEF    1012--REDEF
REQ.DLA.DCTX
      1002**DCL      1074<<ASSIGN
REQ.DLA.DRELADDR
      1003**DCL      1003--REDEF
REQ.DQH$
      1024**DCL      1075<<ASSIGN
REQ.DVE.EOMCHAR
      1040**DCL      1041--REDEF
REQ.EAINFO
      1034**DCL      1034--REDEF
REQ.EAINFOX
PL6.E3A0      #006=NIW$DQHSTART File=NIW$MPC.:E05TSI                             WED 07/30/97 03:44 Page:270  
      1034**DCL      1035--REDEF
REQ.EVNTINFO
      1035**DCL      1035--REDEF
REQ.FC
      1005**DCL      1072<<ASSIGN
REQ.NOALT
      1005**DCL      1076<<ASSIGN
REQ.STATUS
      1016**DCL      1022--REDEF
REQ$
       916**DCL      1002--IMP-PTR  1071<>CALL     1072>>ASSIGN   1073>>ASSIGN   1074>>ASSIGN   1075>>ASSIGN
      1076>>ASSIGN   1077>>CALL
SQH.CQ$
      1061**DCL      1085<>CALL     1100>>ASSIGN   1106>>IF       1116<<ASSIGN   1121<>CALL
SQH.DOOR
      1060**DCL      1060--REDEF
SQH.GATE
      1060**DCL      1081<>CALL     1089<>CALL
SQH$
       917**DCL      1060--IMP-PTR  1070<<ASSIGN   1081>>CALL     1085>>CALL     1089>>CALL     1098<<ASSIGN
      1100>>ASSIGN   1106>>IF       1116>>ASSIGN   1121>>CALL
TEMP$
       918**DCL      1100<<ASSIGN   1103>>IF       1104>>DOWHILE  1105<<ASSIGN   1105>>ASSIGN   1106>>IF
      1116>>ASSIGN

PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:271  
     1274        1        /*T***********************************************************/
     1275        2        /*T*                                                         */
     1276        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1277        4        /*T*                                                         */
     1278        5        /*T***********************************************************/
     1279        6        NIW$MPCDQH: PROC ( DCT, DQH$ ) ALTRET ;
     1280        7        /*
     1281        8                Includes
     1282        9        */
     1283       10        %INCLUDE                NI_DATA_C ;
     1284      123        %INCLUDE                NI_DATA_R ;
     1285      560        %INCLUDE                NI_MACROS_C ;
     1286      827        /*
     1287      828                Parameters
     1288      829        */
     1289      830        %NI$DCT                 ( NAME = DCT, STCLASS = PARAM ) ;
     1290      878    1   DCL 1 DQH$              PTR ALIGNED PARAM ;
     1291      879        /*
     1292      880                Symrefs
     1293      881        */
     1294      882    1   DCL 1 IT_CP6UP          UBIN WORD SYMREF ;
     1295      883        %NI$PARTITION           ( NAME=IT_PARTITION, STCLASS=SYMREF ) ;
     1296      891        /*
     1297      892                Auto
     1298      893        */
     1299      894    1   DCL 1 I                 SBIN ALIGNED AUTO ;
     1300      895        /*
     1301      896                Based
     1302      897        */
     1303      898        %NI$DQH                 ( NAME=DQH,           STCLASS="BASED(DQH$)" ) ;
     1304      921        %NI$CHT                 ( NAME="NI$CHT(0:0)", STCLASS="BASED(NI$CHT$)" ) ;
     1305      924        %EJECT ;
PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:272  
     1306      925    1           DQH$ = ADDR(NIL) ;
     1307      926    1           IF  DCT.TYPE ~= %DV_MPC
     1308      927    1           THEN
     1309      928    1              ALTRETURN ;
     1310      929
     1311      930    2           DO  I = 0 TO %N_CHANSPERMPCM1 ;
     1312      931    2              DQH$ = NI$CHT.DQH$(DCT.MPC.IOCHANX(I)) ;
     1313      932    2              IF  DQH$ ~= ADDR(NIL)
     1314      933    2              THEN
     1315      934    2                 IF NOT DQH.STATUS.DOWN
     1316      935    2                 THEN
     1317      936    2                    RETURN ;
     1318      937    2              END ;
     1319      938
     1320      939    1           DQH$ = ADDR(NIL) ;
     1321      940    1           ALTRETURN ;
     1322      941
     1323      942    1   END NIW$MPCDQH ;

PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:273  
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
      No diagnostics issued in procedure NIW$MPCDQH.

   Procedure NIW$MPCDQH requires 37 words for executable code.
   Procedure NIW$MPCDQH requires 8 words of local(AUTO) storage.

    No errors detected in file NIW$MPC.:E05TSI    .

PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:274  

 Object Unit name= NIW$MPCDQH                                 File name= NIW$MPC.:E05TOU
 UTS= JUL 30 '97 03:45:11.40 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    37     45  NIW$MPCDQH

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        2  NIW$MPCDQH

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               N$FQ$                                 NI$CHT$
     NI$FQ$                                NI$IBUF$                              NI$RP$
     B_VECTNIL
PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:275  


     1274        1        /*T***********************************************************/
     1275        2        /*T*                                                         */
     1276        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1277        4        /*T*                                                         */
     1278        5        /*T***********************************************************/
     1279        6        NIW$MPCDQH: PROC ( DCT, DQH$ ) ALTRET ;

      6  0 000000   000000 700200 xent  NIW$MPCDQH   TSX0  ! X66_AUTO_2
         0 000001   000010 000002                    ZERO    8,2

     1280        7        /*
     1281        8                Includes
     1282        9        */
     1283       10        %INCLUDE                NI_DATA_C ;
     1284      123        %INCLUDE                NI_DATA_R ;
     1285      560        %INCLUDE                NI_MACROS_C ;
     1286      827        /*
     1287      828                Parameters
     1288      829        */
     1289      830        %NI$DCT                 ( NAME = DCT, STCLASS = PARAM ) ;
     1290      878    1   DCL 1 DQH$              PTR ALIGNED PARAM ;
     1291      879        /*
     1292      880                Symrefs
     1293      881        */
     1294      882    1   DCL 1 IT_CP6UP          UBIN WORD SYMREF ;
     1295      883        %NI$PARTITION           ( NAME=IT_PARTITION, STCLASS=SYMREF ) ;
     1296      891        /*
     1297      892                Auto
     1298      893        */
     1299      894    1   DCL 1 I                 SBIN ALIGNED AUTO ;
     1300      895        /*
     1301      896                Based
     1302      897        */
     1303      898        %NI$DQH                 ( NAME=DQH,           STCLASS="BASED(DQH$)" ) ;
     1304      921        %NI$CHT                 ( NAME="NI$CHT(0:0)", STCLASS="BASED(NI$CHT$)" ) ;
     1305      924        %EJECT ;
PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:276  
     1306      925    1           DQH$ = ADDR(NIL) ;

    925  0 000002   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000003   200004 470500                    LDP0    @DQH$,,AUTO
         0 000004   000000 756100                    STQ     0,,PR0

     1307      926    1           IF  DCT.TYPE ~= %DV_MPC

    926  0 000005   200003 471500                    LDP1    @DCT,,AUTO
         0 000006   100007 236100                    LDQ     7,,PR1
         0 000007   007700 376007                    ANQ     4032,DL
         0 000010   000700 116007                    CMPQ    448,DL
         0 000011   000013 600000 0                  TZE     s:930

     1308      927    1           THEN
     1309      928    1              ALTRETURN ;

    928  0 000012   000000 702200 xent               TSX2  ! X66_AALT

     1310      929
     1311      930    2           DO  I = 0 TO %N_CHANSPERMPCM1 ;

    930  0 000013   200005 450100                    STZ     I,,AUTO

     1312      931    2              DQH$ = NI$CHT.DQH$(DCT.MPC.IOCHANX(I)) ;

    931  0 000014   200003 470500                    LDP0    @DCT,,AUTO
         0 000015   200005 235100                    LDA     I,,AUTO
         0 000016   000100 101505                    MRL     fill='000'O
         0 000017   000031 000001                    ADSC9   25,A,PR0                 cn=0,n=1
         0 000020   200006 000002                    ADSC9   I+1,,AUTO                cn=0,n=2
         0 000021   200006 220100                    LDX0    I+1,,AUTO
         0 000022   200006 020100                    ADLX0   I+1,,AUTO
         0 000023   000000 471400 xsym               LDP1    NI$CHT$
         0 000024   100000 236110                    LDQ     0,X0,PR1
         0 000025   200004 473500                    LDP3    @DQH$,,AUTO
         0 000026   300000 756100                    STQ     0,,PR3
PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:277  

     1313      932    2              IF  DQH$ ~= ADDR(NIL)

    932  0 000027   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000030   000036 600000 0                  TZE     s:937

     1314      933    2              THEN
     1315      934    2                 IF NOT DQH.STATUS.DOWN

    934  0 000031   300000 471500                    LDP1    0,,PR3
         0 000032   100001 236100                    LDQ     1,,PR1
         0 000033   200000 316003                    CANQ    65536,DU
         0 000034   000036 601000 0                  TNZ     s:937

     1316      935    2                 THEN
     1317      936    2                    RETURN ;

    936  0 000035   000000 702200 xent               TSX2  ! X66_ARET

     1318      937    2              END ;

    937  0 000036   200005 054100                    AOS     I,,AUTO
         0 000037   200005 235100                    LDA     I,,AUTO
         0 000040   000017 115007                    CMPA    15,DL
         0 000041   000014 604400 0                  TMOZ    s:931

     1319      938
     1320      939    1           DQH$ = ADDR(NIL) ;

    939  0 000042   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000043   300000 756100                    STQ     0,,PR3

     1321      940    1           ALTRETURN ;

    940  0 000044   000000 702200 xent               TSX2  ! X66_AALT
     1322      941
     1323      942    1   END NIW$MPCDQH ;
PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:278  

PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:279  
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
      No diagnostics issued in procedure NIW$MPCDQH.
PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:280  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DCT                       4-0-0/w PTR         r     1 @DQH$
    *0-0-0/w STRC(1332)  r     1 DCT                       *0-0-0/w PTR         r     1 DQH$
     5-0-0/w SBIN        r     1 I

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$CHT$                    0-0-0/w PTR         r     1 NI$FQ$
     0-0-0/w PTR         r     1 NI$IBUF$                   0-0-0/w PTR         r     1 NI$RP$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(648)   r     1 DQH                        0-0-0/w STRC(72)    r     1 NI$CHT(0:0)


   Procedure NIW$MPCDQH requires 37 words for executable code.
   Procedure NIW$MPCDQH requires 8 words of local(AUTO) storage.

    No errors detected in file NIW$MPC.:E05TSI    .
PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:281  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:282  
          MINI XREF LISTING

DCT
       839**DCL         6--PROC
DCT.DP
       859**DCL       866--REDEF     869--REDEF     870--REDEF     872--REDEF     872--REDEF     873--REDEF
       874--REDEF     874--REDEF
DCT.MPC.IOCHANX
       867**DCL       867--REDEF     931>>ASSIGN
DCT.TYPE
       849**DCL       926>>IF
DQH.IOCHANX
       909**DCL       910--REDEF
DQH.MBX$
       918**DCL       919--REDEF
DQH.STATUS.DOWN
       907**DCL       934>>IF
DQH$
       878**DCL         6--PROC      907--IMP-PTR   925<<ASSIGN    931<<ASSIGN    932>>IF        934>>IF
       939<<ASSIGN
I
       894**DCL       930<<DOINDEX   931>>ASSIGN
N$DCT$$
       421**DCL       555--IMP-PTR
N$FQ$
       421**DCL       556--IMP-PTR
N$REQ_INIT.BUFADDR
       440**DCL       441--REDEF     441--REDEF
N$REQ_INIT.DLA.DRELADDR
       432**DCL       432--REDEF
N$REQ_INIT.DVE.EOMCHAR
       469**DCL       470--REDEF
N$REQ_INIT.EAINFO
       463**DCL       463--REDEF
PL6.E3A0      #007=NIW$MPCDQH File=NIW$MPC.:E05TSI                               WED 07/30/97 03:45 Page:283  
N$REQ_INIT.EAINFOX
       463**DCL       464--REDEF
N$REQ_INIT.EVNTINFO
       464**DCL       464--REDEF
N$REQ_INIT.STATUS
       445**DCL       451--REDEF
NI$CHT.DQH$
       922**DCL       931>>ASSIGN
NI$CHT$
       480**DCL       922--IMP-PTR   931>>ASSIGN
NI$FQ$
       481**DCL       557--IMP-PTR
NI$IBUF$
       481**DCL       557--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       491**DCL       492--REDEF     492--REDEF
NI$IMXMBX_INIT.SIZE
       493**DCL       493--REDEF
NI$REQ_INIT.DCW
       515**DCL       518--REDEF
NI$REQ_INIT.DCW.TALLY
       516**DCL       516--REDEF
NI$REQ_INIT.IDCW.EXTA
       518**DCL       518--REDEF
NI$REQ_INIT.PCW
       520**DCL       524--REDEF
NI$REQ_INIT.SEEK
       525**DCL       526--REDEF     527--REDEF
NI$RP$
       529**DCL       559--IMP-PTR
NI_MBX_INIT.DCW.CONTROL.AE
       551**DCL       551--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       547**DCL       547--REDEF
