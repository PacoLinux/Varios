VERSION E05

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:1    
        1        1        /*M*   FMF$PMME - Pre and post processing for most FM PMMEs  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7                                                                                  /* */
        8        8        /*X* */
        9        9        /**/
       10       10        /*P*    NAME:  FMF$PMME
       11       11        *       PURPOSE:  Provide pre- and post-processing for most file
       12       12        *         management PMMEs, plus entire processing for several
       13       13        *         miscellaneous ones.
       14       14        */
       15       15        /**/
       16       16        /**/
       17       17        /**/
       18       18        /**/
       19       19        /**/
       20       20        /*F*    NAME:   FMF$PMME
       21       21        *       PURPOSE:  Provide pre- and post-processing for most file
       22       22        *         management PMMEs.
       23       23        */
       24       24        /**/
       25       25        /**/
       26       26        /*D*    NAME:   FMF$PMME
       27       27                CALL:   CALL FMF$PMME(FPTCODE) ALTRET(LOC);
       28       28                INPUT:  FPTCODE - The PMME code (see F_FPTCODE_C)
       29       29                DESCRIPTION:  Called by UDA$PMMENT with the following
       30       30                  items processed:
       31       31                    1 - DCB number validated, B$JIT.DCB$ set up
       32       32                    2 - FPTCODE set to indicate the type of PMME.
       33       33
       34       34                    If the DCB is closed, FMM$DFLOPN is called to perform
       35       35                  a default open.  If already open and was opened by a
       36       36                  vehicle, check that this is the vehicle doing the PMME.
       37       37                  Clear F$DCB.TYC(1) (the wait TYC).  Set F$DCB.AGE from
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:2    
       38       38                  B$JIT.CALCNT to indicate that this DCB was recently
       39       39                  used.  If the file is broken (file inconsistancies), and
       40       40                  the user is trying to update the file, don't allow it
       41       41                  unless FMSEC is on, or this is a system ghost (this keeps
       42       42                  us from getting hung during boots).  We have to make
       43       43                  a special test for journals, because there is no bad
       44       44                  bit in the CFU for them.  Perform the setup necessary
       45       45                  for the specific type of PMME:
       46       46                    M$READ - Check for READ access.  If shared file,
       47       47                             ENQ for read.  Set up DCB fields UBYTES,
       48       48                             UB$ and WAIT.  If no-wait I/O, get a
       49       49                             DO-list entry and initialize it.
       50       50                    M$WRITE - Check for UPD and/or WNEW access.  See M$READ
       51       51                             for other things.
       52       52                    M$WEOF - Check for WNEW access.  If shared file, ENQ
       53       53                             for write.
       54       54                    M$DELREC - Check for DELR access.  If shared file, ENQ
       55       55                             for write.
       56       56                    M$PRECORD, M$PFIL, M$REW - Check for READ, UPD or DELR
       57       57                             access.  Allow access if M$PRECORD and KEYS=NO
       58       58                             and N=0.  If shared file, ENQ for read.
       59       59                    M$EXTEND - Check for WNEW access.  If shared file, ENQ
       60       60                             for write.
       61       61                    Everything else - Make sure there is some access, then
       62       62                             if shared file ENQ for READ.
       63       63
       64       64                  Call HFF$TRAPALT to gain trap control, so that traps
       65       65                  caused by bad parameters will return here and get a
       66       66                  better error message, as well as clean up.
       67       67
       68       68                  Call the appropriate routine to process this, based
       69       69                  on F$DCB.IFMT.  See chart at end of this description.
       70       70
       71       71                  The formatting routines return if no error occurred,
       72       72                  in which case B$JIT.ERR is cleared and the user will
       73       73                  get no error, and they ALTRET with the appropriate
       74       74                  error code in B$JIT.ERR if an error occurred.  In
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:3    
       75       75                  either case, the cleanup is the same.
       76       76
       77       77                  If the file is shared, a DEQ is done.
       78       78
       79       79                  If the PMME was wait, call the scheduler to wait for
       80       80                  all outstanding wait I/O for this DCB to complete.  If
       81       81                  B$JIT.ERR is zero, look at F$DCB.TYC(1) and if any bits
       82       82                  are set convert to error code and place in JIT.
       83       83                  If B$JIT.ERR was set and the code is a TYC type, set the
       84       84                  appropriate bit in F$DCB.TYC(1).
       85       85
       86       86                  If the PMME was no-wait and no event was requested, return
       87       87                  if B$JIT.ERR is zero or is not a TYC type error.  If it is
       88       88                  a TYC type, set the appropriate bit in F$DCB.TYC(0) and
       89       89                  return.
       90       90
       91       91                  For no-wait with event:
       92       92                    If B$JIT.ERR is zero, return if no DO-list, else move
       93       93                    DCB info to DO-list block and mark it as complete.
       94       94                    If B$JIT.ERR is not a TYC type error, release the
       95       95                    DO-list block if one exists.
       96       96                    If B$JIT.ERR is a TYC-type error, set the appropriate
       97       97                    bit in F$DCB.TYC(0) and in the DO-list block, clear
       98       98                    B$JIT.ERR, then move DCB info to DO-list and mark it
       99       99                    complete.
      100      100
      101      101                  Return to caller.
      102      102
      103      103
      104      104             The following types of DCB exist when open - -
      105      105
      106      106         IFMT    MEDIA ASN      IASN     ORG      ACS      *
      107      107         ------- ----- -------- -------- -------- -------
      108      108         CON     CON   FILE     FILE     CONSEC   SEQ/DIR  Disk file CONSEC.
      109      109         KEY     KEY   FILE     FILE     KEYED    SEQ/DIR  Disk file KEYED.
      110      110         RAN     RAN   FILE     FILE     RANDOM   SEQ/DIR  Disk file RANDOM.
      111      111         URFILE  CON   FILE     FILE     UR       SEQ/DIR  Disk file UR.
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:4    
      112      112         REL     REL   FILE     FILE     RELATIVE SEQ/DIR  Disk file RELATIVE.
      113      113         KEY     KEY   FILE     FILE     INDEXED  SEQ/DIR  Disk file INDEXED.
      114      114         RAN     RAN   FILE     FILE     IDS      SEQ/DIR  Disk file IDS.
      115      115         CON     CON   FILE     FILE     SYMBIONT SEQ/DIR  Disk file SYMBIONT, IN.
      116      116         CON     SYMB  FILE     FILE     SYMBIONT SEQ/DIR  Disk file SYMBIONT, not IN.
      117      117         RAN     RAN   FILE     FILE     any disk BLOCK    Disk file block access.
      118      118         CON     CON   FILE     FILE     CONSEC   JRNL     Disk file Journal.
      119      119         CONUBLK CON   FILE     FILE     CONSEC   UBLOCK   Disk file CONSEC,ublock.
      120      120         RAN           DEVICE   FMDIAG                     Disk pack.
      121      121         RAN           DEVICE   FILE     SYMBIONT BLOCK    Disk file EFT symbiont MOVE.
      122      122         TAPE          TAPE     TAPE      t1               Tape file not UR.
      123      123         URFILE  TAPE  TAPE     TAPE     UR                Tape file UR.
      124      124         TAPE          DEVICE   TAPE      t2               Tape device.
      125      125         NO            DEVICE   0                          Device NO.
      126      126         URSTRM        DEVICE   STREAM   UR                Device LO etc.
      127      127         TTYSTRM       DEVICE   STREAM   TERMINAL          Device LO etc.
      128      128         FPSTRM        DEVICE   STREAM   FPRG              Device LO etc.
      129      129         URDEV   DEV   DEVICE   DEVICE   UR                Local Resource LP/CP
      130      130         TTY     DEV   DEVICE   DEVICE   any               Remote Resource any
      131      131         REMOTE  DEV   any      DEVICE   any               Remote data (ISO FTAM)
      132      132         JCLOUT  CON   DEVICE   FILE     CONSEC   SEQ      Device JE/JF
      133      133         URDEV   SYMB  DEVICE   FILE     SYMBIONT SEQ      Device dd@wsn
      134      134         TTY     CG    COMGROUP COMGROUP TERMINAL          Comgroup
      135      135         FPRG    CG    COMGROUP COMGROUP FPRG              Comgroup
      136      136         TTY     UC    DEVICE   DEVICE   TERMINAL          M$UC for T/S user.
      137      137         TTY     OCCG  COMGROUP COMGROUP TERMINAL          M$UC for Console Ghost.
      138      138         FPRG    CG    COMGROUP COMGROUP FPRG              M$UC for TP user.
      139      139         NO      CON   DEVICE   FILE     CONSEC   SEQ      M$UC in Batch, CCfile open.
      140      140         NO      CON   DEVICE   0        CONSEC   SEQ      M$UC in Batch, CCfile closed
      141      141
      142      142         -       SYMB  0        FILE     SYMBIONT SEQ      "Secret" DCB for LDEV.
      143      143         NO      CON   DEVICE   FILE     CONSEC   SEQ      "Secret" DCB, online XEQ.
      144      144        ------------------------------------------------------------------------
      145      145        o  t1  --  Tape File Organizations are --
      146      146                   CONSEC, KEYED, RANDOM, RELATIVE, INDEXED, IDS,
      147      147                   RESTRICT, FIXED, VARIABLE, UNDEF
      148      148        o  t2  --  Tape Device Organizations are --
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:5    
      149      149                   FIXED, VARIABLE, UNDEF, FREE
      150      150        o  IASN  --  This field describes how some of the innards of the DCB
      151      151                      are to be interpreted - buffers, etc.
      152      152                   o  FILE means disk with buffers used for blocking and
      153      153                         described by buffer DA's.
      154      154                   o  TAPE means tape with buffers used for blocking and
      155      155                         managed by tape code.
      156      156                   o  DEVICE means if any buffers exist they are transient
      157      157                         for aligning user buffers.
      158      158                   o  COMGROUP means no buffers.
      159      159                   o  FMDIAG means no buffers.
      160      160                   o  0 means no buffers.
      161      161                   o  STREAM means this DCB has no innards, but its CFU$ points
      162      162                         to a DCB which does have innards.
      163      163        o  IASN=STREAM --  These DCB's point to other DCB's.  The MEDIA of the
      164      164                         pointed-to DCB may be --
      165      165                   o     UC or OCCG   if pointed-to DCB is interactive M$UC.
      166      166                   o     CON   if pointed-to DCB is interactive XEQ-file or
      167      167                               batch M$UC control-command.
      168      168                   o     NO   if pointed-to DCB is batch M$UC after end of
      169      169                              commands, or interactive M$UC of hung-up user.
      170      170                   o     SYMB   if pointed-to DCB is "secret" DCB for logical
      171      171                                device.
      172      172        */
      173      173        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:6    
      174      174        FMF$PMME: PROC(FPTCODE);
      175      175        /**/
      176      176        /* PARAMETERS */
      177      177        /**/
      178      178    1   DCL FPTCODE SBIN WORD;
      179      179        /**/
      180      180        /* INCLUDE FILES */
      181      181        /**/
      182      182        %INCLUDE B$JIT;
      183      785        %MACRO F$DCB(BASED=BASED);
      184      786        %INCLUDE F$DCB;
      185      835        %MEND;
      186      836        %INCLUDE B_MAGIC_C;
      187      954        %INCLUDE F$CP6V_C;
      188     1180        %INCLUDE FM$MACROS;
      189     1555        %INCLUDE FM_DATA_R;
      190     1569        %INCLUDE FM_CACHE_R;
      191     1581        %INCLUDE FM_CACHE_C;
      192     1647        %INCLUDE F_ERRORS_C;
      193     1887        %INCLUDE UD_ERRORS_C;
      194     1929        %INCLUDE F_CODE_R;
      195     1939        %INCLUDE F_FPTCODE_C;
      196     1975        %INCLUDE CP_6_SUBS;
      197     2515        %INCLUDE HF_LOCK_C;
      198     2529        %INCLUDE F_FMTCODE_C;
      199     2563        %INCLUDE SS_SCHED_C;
      200     2796        %INCLUDE B$USER;
      201     3012        %B$USERREFS;
      202     3016        %INCLUDE B_SEGIDS_C;
      203     3555        %INCLUDE B_STRINGS_C;
      204     3684        %INCLUDE UE_CP6;
      205     4375        %INCLUDE UE_ERRORS_C;
      206     4393        %INCLUDE K_DATA_R;
      207     5104        %INCLUDE KV$VDO;
      208     6119        %KV_VDOMRKTYP_E;
      209     6125        %KV_VDO_E;
      210     6161        %K$RWPARM (NAME=RWPARM);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:7    
      211     6477        %INCLUDE NK$LDCT;
      212     6579        %INCLUDE NK_LDCT_R;
      213     6588        %INCLUDE KC_CP6;
      214     7148        %INCLUDE KC$CP6V_C;
      215     7268        %INCLUDE KQ_MAC_C;
      216     9818        %INCLUDE KQ_SUBS_C;
      217    10118        %INCLUDE JG_GHOSTS_C;
      218    10208        /**/
      219    10209        /* SUBSTITUTIONS */
      220    10210        /**/
      221    10211        %SUB FCG#='0615'O;
      222    10212        %SUB MID#='06'O;
      223    10213        %SUB_EXC;
      224    10260        /**/
      225    10261        /* EXTERNAL ROUTINES */
      226    10262        /**/
      227    10263    1   DCL FAG$GEXT ENTRY ALTRET;
      228    10264    1   DCL FMG$KPMME ENTRY(1) ALTRET;
      229    10265    1   DCL FMH$CPMME ENTRY(3) ALTRET;
      230    10266    1   DCL FMH$MAPJRNL ENTRY(2);
      231    10267    1   DCL FMH$UBLOCK ENTRY(3) ALTRET;
      232    10268    1   DCL FMI$DSWRITE ENTRY(1);
      233    10269    1   DCL FMI$RAN ENTRY(1) ALTRET;
      234    10270    1   DCL FMJ$REL ENTRY(1) ALTRET;
      235    10271    1   DCL FMB$IOSPIN ENTRY;
      236    10272    1   DCL FMD$FLSHBUF ENTRY(1);
      237    10273    1   DCL FMD$WRTCACHE ENTRY(1);
      238    10274    1   DCL FMD$WRTSVNW ENTRY(1);
      239    10275    1   DCL FMD$WRTSV ENTRY(1);
      240    10276    1   DCL FMD$RELBUF ENTRY(1);
      241    10277    1   DCL FMD$DECRYPT_BUFFER ENTRY(1);
      242    10278    1   DCL FMM$DFLOPN ENTRY;
      243    10279    1   DCL FMM$SCRUB ENTRY(1);
      244    10280    1   DCL FMO$GETDOMAIN ENTRY(1);
      245    10281    1   DCL FMP$CLSJ ENTRY;
      246    10282    1   DCL FTT$TRUNC ENTRY ALTRET;
      247    10283    1   DCL FTW$WRAT ENTRY(3) ALTRET;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:8    
      248    10284    1   DCL FSD$JE ENTRY(2) ALTRET;
      249    10285    1   DCL FSE$GR ENTRY(2) ALTRET;
      250    10286    1   DCL FSE$GRSTRM ENTRY(2) ALTRET;
      251    10287    1   DCL FSE$NC ENTRY(2) ALTRET;
      252    10288    1   DCL FSE$UR ENTRY(2) ALTRET;
      253    10289    1   DCL FSE$URFILE ENTRY(2) ALTRET;
      254    10290    1   DCL FSE$URSTREAM ENTRY(2) ALTRET;
      255    10291    1   DCL FSE$TTY ENTRY(2) ALTRET;
      256    10292    1   DCL FSE$TTYSTREAM ENTRY(2) ALTRET;
      257    10293    1   DCL FSE$FPRG ENTRY(2) ALTRET;
      258    10294    1   DCL FSE$FPSTREAM ENTRY(2) ALTRET;
      259    10295    1   DCL HFC$CACHECLR ENTRY;
      260    10296    1   DCL HFF$TRAPALT ENTRY ALTRET;
      261    10297    1   DCL HFF$DSIZ ENTRY(2) ALTRET;
      262    10298    1   DCL HFF$ERASE ENTRY(1) ALTRET;
      263    10299    1   DCL HFF$NIL ENTRY(1) ALTRET;
      264    10300    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      265    10301    1   DCL KCO$EXTEND ENTRY ALTRET;
      266    10302    1   DCL KIS$OSI_TRUNC ENTRY ALTRET;
      267    10303    1   DCL KIA$COMP ENTRY(2);
      268    10304    1   DCL KIA$FCNOU ENTRY (3) ALTRET;
      269    10305    1   DCL KQC$ABTRD ENTRY(2) ALTRET;
      270    10306    1   DCL KQX$LDASR ENTRY(1);
      271    10307    1   DCL MMH$MAP_DS ENTRY(8) ALTRET;
      272    10308    1   DCL MMH$SHARE_DS ENTRY(8) ALTRET;
      273    10309    1   DCL MMH$FDS ENTRY(4)ALTRET;
      274    10310    1   DCL MMJ$FPPCHAIN ENTRY(3);
      275    10311    1   DCL NAI$WRITE ENTRY(1);
      276    10312    1   DCL SC_FMF92 ENTRY CONV(2,0);
      277    10313    1   DCL SSR$REG ENTRY(3) ALTRET;
      278    10314    1   DCL SSV$EVENT ENTRY(7);
      279    10315    1   DCL SSV$INITDO ENTRY(6);
      280    10316    1   DCL SSV$SCHDDO ENTRY(2);
      281    10317    1   DCL SSV$XXDO ENTRY(3) ALTRET;
      282    10318    1   DCL UDB$PMMEXIT1 ENTRY;
      283    10319    1   DCL UDN$MAGIC ENTRY;
      284    10320    1   DCL UQB$MENQSB ENTRY(1)ALTRET;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:9    
      285    10321    1   DCL UQB$MENQXB ENTRY(1)ALTRET;
      286    10322    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      287    10323        /**/
      288    10324        /* LOCAL AUTOMATIC STORAGE */
      289    10325        /**/
      290    10326    1   DCL JDCB$ PTR;
      291    10327    1   DCL BCDCB$ PTR;
      292    10328    1   DCL 1 BCDCB REDEF BCDCB$,
      293    10329    1         2 * BIT(24),
      294    10330    1         2 SID BIT(12);
      295    10331    1   DCL CFU$ PTR;
      296    10332    1   DCL I SBIN WORD;
      297    10333    1   DCL USR UBIN(9);
      298    10334    1   DCL CODE UBIN;
      299    10335    1   DCL EVENT UBIN;
      300    10336    1   DCL ENTFLG UBIN;
      301    10337    1   DCL CG$ PTR;
      302    10338    1   DCL STA$ PTR;
      303    10339    1   DCL LDCT$ PTR;
      304    10340        %B$JRNLERR (NAME=JRNLECCI,STCLASS="",PARONLY=1);
      305    10348        /**/
      306    10349        /* EXTERNAL DATA */
      307    10350        /**/
      308    10351        /* EXTERNAL DATA */
      309    10352        /**/
      310    10353    1   DCL B$JIT$ PTR SYMREF READONLY;
      311    10354    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      312    10355    1   DCL B$PS0$ PTR SYMREF READONLY;
      313    10356    1   DCL B$PS1$ PTR SYMREF READONLY;
      314    10357    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      315    10358    1   DCL B$PS2$ PTR SYMREF READONLY;
      316    10359    1   DCL B$IS$ PTR SYMREF;
      317    10360    1   DCL LS0UBIN REDEF B$IS$ UBIN;
      318    10361    1   DCL B$PPUT$ PTR SYMREF;
      319    10362        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
      320    10455    1   DCL MM_SHAREDSUSE SBIN SYMREF;
      321    10456    1   DCL S_ASFGATE UBIN SYMREF;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:10   
      322    10457    1   DCL S_UDLGATE SBIN SYMREF;
      323    10458    1   DCL S_CUN SBIN SYMREF;
      324    10459        /**/
      325    10460        /* BASED STRUCTURES */
      326    10461        /**/
      327    10462        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      328    10801    1   DCL 1 BITS ALIGNED BASED,
      329    10802    1         2 B(0:35) BIT(1) UNAL;
      330    10803    1   DCL CHARS CHAR(I) BASED;
      331    10804    1   DCL 1 MM$PPUT(0:0) BASED(B$PPUT$) ALIGNED,
      332    10805    1         2 * BIT(18),
      333    10806    1         2 PPNO UBIN HALF UNAL;
      334    10807        /**/
      335    10808        /* CONSTANT STORAGE */
      336    10809        /**/
      337    10810        %ERRCODE (NAME=ERRREAD,COD#=%E$READ);
      338    10814        %ERRCODE (NAME=ERRWRITE,COD#=%E$WRITE);
      339    10818        %ERRCODE (NAME=ERRDELREC,COD#=%E$DELREC);
      340    10822        %ERRCODE (NAME=ERRPOS,COD#=%E$POS);
      341    10826        %ERRCODE (NAME=ERREXTEND,COD#=%E$EXTEND);
      342    10830        %ERRCODE (NAME=ERRDOMAIN,COD#=%E$DOMAIN);
      343    10834        %ERRCODE (NAME=ERRJRNL,COD#=%E$JRNLCLSD);
      344    10838        %ERRCODE (NAME=ERRDMY,COD#=0);
      345    10842        %ERRCODE (NAME=ERREOF,COD#=%E$EOF);
      346    10846        %ERRCODE (NAME=ERRMTRAP,COD#=%E$MTRAP);
      347    10850        %ERRCODE (NAME=ERRPMMEINT,COD#=%E$PMMEINT);
      348    10854        %ERRCODE (NAME=ERRSHRDS2BIG,COD#=%E$SHRDS2BIG);
      349    10858        %ERRCODE (NAME=ERRNOEVENT,COD#=%E$NOEVENT);
      350    10862        %ERRCODE (NAME=ERRBROKEN, COD#=%E$BROKEN);
      351    10866        %ERRCODE (NAME=ERRNOACCT,MID#="'16'O",COD#=%E$NOKEY);
      352    10870        %ERRCODE (NAME=ERRINVVFC,COD#=%E$INVVFC);
      353    10874        %ERRCODE (NAME=ERRNOCODE,COD#=0);
      354    10878        %ERRCODE (NAME=ERREOD,COD#=%E$EOD);
      355    10882    1   DCL 1 ERRDMYFMI CONSTANT,
      356    10883    1         2 * BIT(12) INIT('0615'O),
      357    10884    1         2 * BIT(6) INIT('11'O),
      358    10885    1         2 * BIT(18) INIT('0'B);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:11   
      359    10886    1   DCL USRJRNERR(0:19) UBIN(9) UNAL CONSTANT INIT (
      360    10887        /* Errors caused by the program, not to be reported to the journal owner */
      361    10888    1   %E$LD, %E$MTRAP, %E$CDALRT, %E$BOF, %E$EOF, %E$NOCONT, %E$USGRANS,
      362    10889    1   %E$BADVECT0, %E$BADVECT1, %E$BADVECT2, %E$BADVECT3, %E$BADVECT4,
      363    10890    1   %E$BADVECT5, %E$BADVECT6, %E$BADVECT7, %E$BADVECT8, %E$BADVECT9,
      364    10891    1   %E$NOEVENT, 0*0);
      365    10892    1   DCL USRJRNERRS REDEF USRJRNERR CHAR(20);
      366    10893    1   DCL USRTJNERR(0:7) UBIN(9) UNAL CONSTANT INIT (
      367    10894        /* Same thing, but tape errors, which don't fit in a byte. */
      368    10895    1   %(E$NOTJRNLOWNER-512), %(E$CANTTRANSLATE-512), %(E$NOFPOOL-512),
      369    10896    1   %(E$SMALLRECL-512), 0*0);
      370    10897    1   DCL USRTJNERRS REDEF USRTJNERR CHAR(8);
      371    10898        /**/
      372    10899        /* BASED STRUCTURES */
      373    10900        /**/
      374    10901        %B$ECCBI;
      375    10904        %F$DCB (BASED="BASED(JDCB$)");
      376    10954        %FM$CFU (BASED="BASED(CFU$)");
      377    10960        %FM$CFUJ (BASED="BASED(CFU$)");
      378    10965        %FM$CFUR (BASED="BASED(CFU$)");
      379    10968        %FPT$READ_V (BASED="BASED(B$PS0$)");
      380    10975        %FPT$WRITE_V (BASED="BASED(B$PS0$)");
      381    10981        %FPT$PRECORD_V (BASED="BASED(B$PS0$)");
      382    10986        %FPT$EXTEND_V (BASED="BASED(B$PS0$)");
      383    10989        %NK$LDCT;
      384    11035        %KQ_CG (FPTN=KQ$CG,STCLASS=BASED);
      385    11774        %FMC$CACHE(ARRAY=YES);
      386    11797        %SET LISTSUB='1'B;
      387    11798        %SET LISTMAC='1'B;
      388    11799        /**/
      389    11800    1           JDCB$=B$JIT.DCB$;               /* POINTER TO CURRENT DCB             */
      390    11801    1           BCDCB$=JDCB$;
      391    11802    1           BCDCB.SID=%RONCSID;             /* BYPASS CACHE POINTER               */
      392    11803    2           IF NOT F$DCB.FCD THEN DO;       /* MUST DO IMPLICIT OPEN              */
      393    11804    2              IF F$DCB.FUN=0 THEN
      394    11805    2                 IF FPTCODE=1 /* FPTWRITE */ THEN
      395    11806    2                    F$DCB.FUN=%CREATE#;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:12   
      396    11807    2              CALL FMO$GETDOMAIN(I);
      397    11808    2              F$DCB.WSR=I;                 /* Set current domain                 */
      398    11809    2              CALL FMM$DFLOPN;
      399    11810    2              IF NOT(F$DCB.FCD) THEN RETURN;
      400    11811    2              END;
      401    11812    1           ELSE
      402    11813    2              IF F$DCB.FFLG.EXEC THEN DO;  /* EXECUTE ONLY                       */
      403    11814    2                 CALL FMO$GETDOMAIN(I);
      404    11815    3                 IF F$DCB.WSR~=I THEN DO;
      405    11816    3                    B$JIT.ERR=ERRDOMAIN;
      406    11817    3                    GOTO ERRXIT;
      407    11818    3                    END;
      408    11819    2                 END;
      409    11820        /*E*   ERROR:  FMF-E$DOMAIN-2
      410    11821        *       MESSAGE: DCB %%DC %opened by another domain
      411    11822        *      DESCRIPTION:  This DCB, connected to an execute-only file,
      412    11823        *        was opened by another domain and may not be accessed from
      413    11824        *        this domain.
      414    11825        */
      415    11826    1           F$DCB.TYC(1)='0'B;              /* CLEAR WAIT TYC                     */
      416    11827        /**/
      417    11828    1           F$DCB.AGE=B$JIT.CALCNT;
      418    11829        /**/
      419    11830    2           DO CASE(FPTCODE);
      420    11831    2            CASE(0 /* FPTREAD */);             /* M$READ                             */
      421    11832    2              F$DCB.ARS=0;
      422    11833    2              IF NOT(F$DCB.FFLG.READ)
      423    11834    2              THEN                         /* NOT ALLOWED TO READ                */
      424    11835    3              DO;
      425    11836    3   NOREAD:       B$JIT.ERR=ERRREAD;
      426    11837    3                 GOTO ERRXIT;
      427    11838    3                 END;
      428    11839        /*E*   ERROR:  FMF-E$READ-2
      429    11840        *       MESSAGE: You are not allowed to read% from %UF%
      430    11841        */
      431    11842        /**/
      432    11843    2              IF F$DCB.SHARED THEN
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:13   
      433    11844    2                 CALL ENQRD ALTRET(ERRDEQ);
      434    11845    3   RDWRT:     CALL HFF$DSIZ(B$PS2$,F$DCB.UBYTES) WHENRETURN DO; /* # BYTES TO XFER */
      435    11846    3                 F$DCB.UB$=B$PS2$;         /* POINTER TO USER BUFFER             */
      436    11847    3                 IF (FPTCODE = 1 /* FPTWRITE */) AND
      437    11848    3                   (F$DCB.UBYTES=0) AND (F$DCB.DVBYTE.VFC)
      438    11849    4                 THEN DO;
      439    11850    4                    B$JIT.ERR = ERRINVVFC;
      440    11851    4                    GOTO ERROR;
      441    11852    4                    END;
      442    11853        /*E*    ERROR:   FMF-E$INVVFC-2
      443    11854                MESSAGE: The WRITE has VFC=YES but BUF is NIL
      444    11855         */
      445    11856    3                 END;
      446    11857    3              WHENALTRETURN DO;
      447    11858    3                 F$DCB.UB$=ADDR(B$JIT$);   /* ANY HANDY CONSTANT                 */
      448    11859    3                 END;
      449    11860    2              F$DCB.WAIT=BITBIN(FPT$READ_V.WAIT);
      450    11861    3              IF F$DCB.WAIT=0 THEN DO;     /* NO-WAIT                            */
      451    11862                      %LOCK (G#=F_DCBLOCK);
             11863    3   CALL HFC$LOCK(F_DCBLOCK);
      452    11865    3                 IF NOT(BCDCB$->F$DCB.TYC.EGV(0)) THEN
      453    11866    3                    BCDCB$->F$DCB.TYC(0)='0'B;
      454    11867                      %UNLOCK (G#=F_DCBLOCK);
             11868    3   CALL HFC$UNLOCK(F_DCBLOCK);
      455    11870    3                 EVENT=FPT$READ_V.EVENT;
      456    11871    4                 IF EVENT~=0 THEN DO;
      457    11872    4                    CALL UDN$MAGIC;        /* Get ptr to ECCB                    */
      458    11873    5                    IF NOT B_MPT.ECCB$->B$ECCBI.FLAGS(%ECC_EVENT#) THEN DO;
      459    11874    5                       B$JIT.ERR=ERRNOEVENT;
      460    11875    5                       GOTO ERROR;
      461    11876    5                       END;
      462    11877        /*E*  ERROR: FMF-E$NOEVENT-2
      463    11878              MESSAGE: No event handler specified
      464    11879              MESSAGE1: You can't read or write no-wait with an event without
      465    11880                        an event handler defined
      466    11881        */
      467    11882    5                    IF F$DCB.ASN=%FILE# THEN DO;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:14   
      468    11883    5                       CALL FMO$GETDOMAIN(I);
      469    11884    5                       CALL SSV$INITDO(B$JIT.DO$,I,%SUBC_IO#,FPT$READ_V.EVENT,
      470    11885    5                         ENTADDR(NIL),3);
      471    11886    5                       B$JIT.DO$->B$DO.IOCOMP='0'B;
      472    11887    5                       B$JIT.DO$->B$DO.IOCOMP.CNTR=1;
      473    11888    5                       END;
      474    11889    4                    END;
      475    11890    3                 END;
      476    11891        /**/
      477    11892    2            CASE(1 /* FPTWRITE */);            /* M$WRITE                            */
      478    11893    3              IF NOT(F$DCB.FFLG.UPD) AND NOT(F$DCB.FFLG.WNEW) THEN DO;
      479    11894    3   ERRWR:        B$JIT.ERR=ERRWRITE;
      480    11895    3                 GOTO ERRXIT;
      481    11896    3                 END;
      482    11897        /*E*   ERROR:  FMF-E$WRITE-2
      483    11898        *       MESSAGE: You are not allowed to write% to %UF%
      484    11899        */
      485    11900    2              CALL CHKBAD ALTRET(ERRXIT);
      486    11901    2              IF F$DCB.SHARED THEN
      487    11902    2                 CALL ENQWR ALTRET(ERRDEQ);
      488    11903    2              GOTO RDWRT;
      489    11904        /**/
      490    11905    2            CASE(7 /* FPTWEOF */);             /* M$WEOF                             */
      491    11906    2              F$DCB.WAIT=1;
      492    11907    2              IF NOT(F$DCB.FFLG.WNEW) THEN GOTO ERRWR;
      493    11908    2              CALL CHKBAD ALTRET(ERRXIT);
      494    11909    2              F$DCB.UBYTES=0;
      495    11910    2              IF F$DCB.SHARED THEN
      496    11911    2                 CALL ENQWR ALTRET(ERRDEQ);
      497    11912                                                /*                                    */
      498    11913    2            CASE(2 /* FPTDELREC */);           /* M$DELREC                           */
      499    11914    2              F$DCB.WAIT=1;
      500    11915    2              IF NOT(F$DCB.FFLG.DELR)
      501    11916    2              THEN
      502    11917    3              DO;
      503    11918    3                 B$JIT.ERR=ERRDELREC;
      504    11919    3                 GOTO ERRXIT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:15   
      505    11920    3                 END;
      506    11921        /*E*   ERROR:  FMF-E$DELREC-2
      507    11922        *       MESSAGE: You are not allowed to delete records% from %UF%
      508    11923        */
      509    11924    2              CALL CHKBAD ALTRET(ERRXIT);
      510    11925    3              IF F$DCB.ASN=%DEVICE# THEN DO;
      511    11926    4                 CALL HFF$DSIZ(B$PS2$,F$DCB.UBYTES) WHENRETURN DO;
      512    11927    4                    F$DCB.UB$=B$PS2$;
      513    11928    4                    END;
      514    11929    3                 END;
      515    11930    2              IF F$DCB.SHARED THEN
      516    11931    2                 CALL ENQWR ALTRET(ERRDEQ);
      517    11932        /**/
      518    11933    2            CASE(3 /* FPTPREC */,4 /* FPTPFIL */,6 /* FPTREW */);
             11933                     /* M$PRECORD, M$PFIL AND M$REW        */
      519    11934    2              F$DCB.WAIT=1;
      520    11935    2              IF F$DCB.IASN = %OD# THEN
      521    11936    2                 GOTO PREC_ERR;
      522    11937    2              IF (NOT F$DCB.FFLG.READ) AND (NOT F$DCB.FFLG.UPD) AND
      523    11938    3                (NOT F$DCB.FFLG.DELR) THEN DO;
      524    11939    4                 IF FPTCODE=3 /* FPTPREC */ THEN DO;
      525    11940    4                    IF FPT$PRECORD_V.BOF OR FPT$PRECORD_V.EOF THEN
      526    11941    4                       GOTO PREC_ERR;      /* Not allowed to PFIL                */
      527    11942    4                    IF F$DCB.FFLG THEN
      528    11943    4                       IF (NOT FPT$PRECORD_V.KEYS) AND FPT$PRECORD_V.N=0 AND
      529    11944    4                         (NOT FPT$PRECORD_V.KEYR) THEN
      530    11945    4                          GOTO PRECOK;
      531    11946    4                    END;                   /* IF FPTCODE=FPTPREC                 */
      532    11947    3   PREC_ERR:     B$JIT.ERR=ERRPOS;
      533    11948    3                 GOTO ERRXIT;
      534    11949    3                 END;
      535    11950        /*E*   ERROR:  FMF-E$POS-2
      536    11951        *       MESSAGE: You are not allowed to position% in %UF%
      537    11952        */
      538    11953    2   PRECOK:    IF F$DCB.SHARED THEN
      539    11954    2                 CALL ENQRD ALTRET(ERRDEQ);
      540    11955        /**/
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:16   
      541    11956    2            CASE(5 /* FPTEXTEND */);           /* M$EXTEND                           */
      542    11957    2              F$DCB.WAIT=1;
      543    11958    2              IF (NOT F$DCB.FFLG.WNEW AND FPT$EXTEND_V.SIZ~=0)
      544    11959    2                OR (F$DCB.IASN = %OD#)
      545    11960    3                OR (F$DCB.ASN=%COMGROUP# AND NOT F$DCB.AU) THEN DO;
      546    11961    3                 B$JIT.ERR=ERREXTEND;
      547    11962    3                 GOTO ERRXIT;
      548    11963    3                 END;
      549    11964        /*E*   ERROR:  FMF-E$EXTEND-2
      550    11965        *       MESSAGE: You are not allowed to extend %UF
      551    11966        */
      552    11967    2              CALL EXTEND ALTRET(ERRDEQ);
      553    11968    2              GOTO DONE;
      554    11969        /**/
      555    11970    2            CASE(ELSE);                    /* EVERYTHING ELSE                    */
      556    11971    2              F$DCB.WAIT=1;
      557    11972    2              IF NOT F$DCB.FFLG THEN
      558    11973    2                 GOTO NOREAD;    /* ERROR CODE NOT QUITE RIGHT, BUT WHO CARES    */
      559    11974    2              IF F$DCB.SHARED THEN
      560    11975    2                 CALL ENQRD ALTRET(ERRDEQ);
      561    11976        /**/
      562    11977    2            END;
      563    11978        /**/
      564    11979        /* VECTOR OFF ON DCB.IFMT */
      565    11980        /**/
      566    11981    1   VEC:    CALL HFF$TRAPALT ALTRET(MEMTRAP); /* GO TO ALTRET IF MEM TRAP         */
      567    11982    2           DO CASE(F$DCB.IFMT);
      568    11983    2            CASE(1/*FMTCON#*/,18/*FMTSYMB#*/); /* CONSEC or SYMB disk file           */
      569    11984    2              CALL FMH$CPMME(FPTCODE,FPT$READ_V) ALTRET(ERROR);
      570    11985    2            CASE(21/*FMTCONUBLK#*/);           /* CONSEC file, ACS=UBLOCK            */
      571    11986    2              CALL FMH$UBLOCK(FPTCODE,FPT$READ_V) ALTRET(ERROR);
      572    11987    2            CASE(2/*FMTKEY#*/);                /* KEYED AND INDEXED DISK FILE        */
      573    11988    2              CALL FMG$KPMME(FPTCODE) ALTRET(ERROR);
      574    11989    2            CASE(3/*FMTRAN#*/);      /* RANDOM AND IDS DISK FILES, OR DEVICE PACK    */
      575    11990    2              CALL FMI$RAN(FPTCODE) ALTRET(ERROR);
      576    11991    2            CASE(4/*FMTREL#*/);                /* RELATIVE DISK FILES                */
      577    11992    2              CALL FMJ$REL(FPTCODE) ALTRET(ERROR);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:17   
      578    11993    2            CASE (5/*FMTTAPE#*/, 26 /*FMTOD*/);
             11993                     /* Tape and Optical Disk Files        */
      579    11994    2              CALL FTW$WRAT(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      580    11995    2            CASE(7/*FMTNO#*/);                 /* NO-DEVICE                          */
      581    11996    3              IF FPTCODE=0 /* FPTREAD */ THEN DO;
      582    11997    3                 B$JIT.ERR=ERREOF;
      583    11998    3                 GOTO ERROR;
      584    11999    3                 END;
      585    12000    2            CASE(9/*FMTJCLOUT#*/);             /* CREATING JE OR JF FILES            */
      586    12001    2              CALL FSD$JE(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      587    12002    2            CASE(15/*FMTURDEV#*/);             /* Unit record device                 */
      588    12003    2              CALL FSE$UR(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      589    12004    2            CASE(11/*FMTURFILE#*/);            /* Unit record file                   */
      590    12005    2              CALL FSE$URFILE(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      591    12006    2            CASE(16/*FMTURSTRM#*/);  /* UNIT-RECORD FORMATTING WITH STREAMED DCB     */
      592    12007    2              CALL FSE$URSTREAM(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      593    12008    2            CASE(14/*FMTTTY#*/);               /* TTY FORMATTING                     */
      594    12009    2              CALL FSE$TTY(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      595    12010    2            CASE(17/*FMTTTYSTRM#*/);           /* TTY FORMATTING WITH STREAMED DCB   */
      596    12011    2              CALL FSE$TTYSTREAM(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      597    12012    2            CASE(19/*FMTFPRG#*/);              /* FPRG FORMATTING                    */
      598    12013    2              CALL FSE$FPRG(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      599    12014    2            CASE(20/*FMTFPSTRM#*/);            /* FPRG FORMATTING WITH STREAMED DCB  */
      600    12015    2              CALL FSE$FPSTREAM(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      601    12016    2            CASE(22/*FMTARRAYPROCESSOR#*/);
      602    12017    2              CALL NAI$WRITE(FPTCODE);
      603    12018    2              RETURN;
      604    12019    2            CASE(23 /*FMTGR*/);           /* GRAPHIC FORMATTING WITH NO STREAM DCB   */
      605    12020    2              CALL FSE$GR (FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      606    12021    2            CASE(24 /*FMTGRSTRM*/);            /* GRAPHIC FORMATTING WITH STREAM DCB */
      607    12022    2              CALL FSE$GRSTRM (FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      608    12023    2            CASE(25 /*FMTNC*/);
      609    12024    2              CALL FSE$NC (FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
      610    12025    2            CASE(27 /*FMTREMOTE*/);
      611    12026    2              CALL FTAM_WAIT(FPTCODE) ALTRET(ERROR);
      612    12027    2            CASE(ELSE);                    /* ILLEGAL IFMT                       */
      613    12028    2              CALL SC_FMF92;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:18   
      614    12029    2              RETURN;
      615    12030        /*S*    SCREECH_CODE:   FMF-S$FM92
      616    12031        *      TYPE:   SUA
      617    12032        *      MESSAGE:  Illegal DCB.IFMT */
      618    12033    2            END;
      619    12034    1           GOTO DONE;                      /* SUCCESSFUL COMPLETION              */
      620    12035        /**/
      621    12036    1   MEMTRAP: CALL FMD$FLSHBUF(0);           /* GET RID OF DATA BUFFER             */
      622    12037    1           IF B$JIT.ERR.CODE=%E$BADVECT2 AND (FPTCODE=0 /* FPTREAD */ OR
      623    12038    1             FPTCODE=1 /* FPTWRITE */) THEN
      624    12039    1              B$JIT.ERR=ERRMTRAP;          /* CHANGE ERROR TO BAD BUFFER         */
      625    12040    2           ELSE DO;
      626    12041    2              B$JIT.ERR.FCG='0615'O;          /* PUT IN FMF TO GET BETTER ERROR     */
      627    12042    2              B$JIT.ERR.MID='06'O;
      628    12043    2              END;
      629    12044    1           GOTO ERROR;
      630    12045        /*E*    ERROR:   FMF-E$BADVECT0-2
      631    12046        *       MESSAGE:  Trap accessing V area of FPT%, DCB %DC%
      632    12047        */
      633    12048        /*E*    ERROR:  FMF-E$BADVECT1-2
      634    12049        *       MESSAGE:  Trap accessing KEY parameter%, file %UF%%, DCB %DC%
      635    12050        *       MESSAGE1: KEY location not accessible or not large enough
      636    12051        */
      637    12052        /*E*    ERROR:  FMF-E$BADVECT2-2
      638    12053        *       MESSAGE:  Trap accessing LKEY parameter%, file %UF%%, DCB %DC%
      639    12054        *       MESSAGE1: The LKEY parameter for M$DELREC is not large enough
      640    12055                       or is inaccessible
      641    12056        */
      642    12057        /*E*    ERROR:  FMF-E$BADVECT3-2
      643    12058        *       MESSAGE: STATION parameter% for %UF% inaccessible or not large enough
      644    12059        */
      645    12060        /**/
      646    12061    1   ERRDEQ: CALL DEQ;
      647    12062    1   ERRXIT: RETURN;
      648    12063        /**/
      649    12064    1   DONE:   B$JIT.ERR='0'B;                 /* CLEAR ANY OLD ERROR                */
      650    12065    1   ERROR:  ;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:19   
      651    12066    1           IF F$DCB.DECRYPT AND (NOT B$JIT.ERR OR B$JIT.ERR.CODE = %E$LD) THEN
      652    12067    1              CALL FMD$DECRYPT_BUFFER(FPT$READ_V.SEED);
      653    12068    2           IF F$DCB.SHARED THEN DO;
      654    12069    2              IF F$DCB.IASN = %FILE# THEN
      655    12070    3              DO I = 0 TO 4;
      656    12071    3                 IF NOT F$DCB.BFR.CVM(I) AND F$DCB.BFR1.CX(I) > 0 AND
      657    12072    3                   F$DCB.BFR.BUFUP(I) THEN
      658    12073    3                    CALL FMD$WRTCACHE(I);
      659    12074    3                 END;
      660    12075    2              CALL DEQ;
      661    12076    2              END;
      662    12077    1           CODE=B$JIT.ERR.CODE;
      663    12078    2           IF F$DCB.WAIT~=0 THEN DO;
      664    12079        /* WAIT OPERATION */
      665    12080    2              IF BCDCB$->F$DCB.FCN(1) THEN /* REG IF ANY I/O                     */
      666    12081    2                 CALL SSR$REG(%SS_IIP,BCDCB$->F$DCB.FCN(1));
      667    12082    2              IF S$CU$->B$U.ASYNCH&%U_CACHE THEN
      668    12083    2                 CALL CACHECLR;            /* Clear the cache                    */
      669    12084    3              IF CODE=0 THEN DO;
      670    12085                                           /* No JIT.ERR - set JIT.ERR from TYC, if   */
      671    12086                                           /* we're not processing a tape I/O error   */
      672    12087    4                 IF F$DCB.OLDIOERR = 0 OR F$DCB.OLDIOERR = 3 THEN DO;
      673    12088    4   CHKTYC:          F$DCB.TYC(1)=BCDCB$->F$DCB.TYC(1)&'377777777777'O;
      674    12089    4                    IF F$DCB.TYC(1) THEN   /* DO NOTHING IF NO BITS SET          */
      675    12090    5                    DO I=1 TO F_TYCMAX;
      676    12091    6                       IF ADDR(F$DCB.TYC(1))->BITS.B(I) THEN DO;
      677    12092    6                          IF F$DCB.ORG=%RANDOM# OR F$DCB.ORG=%IDS# THEN
      678    12093    6                             B$JIT.ERR=ERRDMYFMI;
      679    12094    6                          ELSE
      680    12095    6                             B$JIT.ERR=ERRDMY;
      681    12096    6                          B$JIT.ERR.CODE=F_CODE(I);
      682    12097    6                          B$JIT.ERR.SEV=F_SEV(I);
      683    12098    6                          RETURN;
      684    12099    6                          END;
      685    12100    5                       END;
      686    12101    4                    END;
      687    12102    3                 END;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:20   
      688    12103    2              ELSE
      689    12104    2                 IF CODE <= F_TYCMAX
      690    12105    2                   AND (F$DCB.IASN ~= %TAPE# /* Already set for free tape        */
      691    12106    2                   OR F$DCB.TAPTYP.MANAGED OR F$DCB.ASN ~= %DEVICE#)
      692    12107    2                 THEN
      693    12108    2                    F$DCB.TYC(1)=(BCDCB$->F$DCB.TYC(1)|F_TYCBITS(CODE))&
      694    12109    2                      '377777777777'O;     /* REMOVE EGV                         */
      695    12110    2                 ELSE
      696    12111    2                    F$DCB.TYC(1)=BCDCB$->F$DCB.TYC(1)&'377777777777'O; /* RESET EGV */
      697    12112    2              IF F$DCB.IFMT=19/*FMTFPRG#*/ OR F$DCB.IFMT=20/*FMTFPSTRM#*/
      698    12113    2              THEN CALL UDB$PMMEXIT1;      /*dont set "m" bit in jit.err*/
      699    12114    2              ELSE RETURN;
      700    12115    2              END;                         /* END OF WAIT CODE                   */
      701    12116        /**/
      702    12117    2           IF EVENT=0 THEN DO;
      703    12118        /* NO-WAIT NO EVENT */
      704    12119    2              IF CODE=0 OR CODE>F_TYCMAX THEN RETURN;
      705    12120                   %LOCK (G#=F_DCBLOCK);
             12121    2   CALL HFC$LOCK(F_DCBLOCK);
      706    12123    2              BCDCB$->F$DCB.TYC(0)=BCDCB$->F$DCB.TYC(0)|F_TYCBITS(CODE);
      707    12124                   %UNLOCK (G#=F_DCBLOCK);
             12125    2   CALL HFC$UNLOCK(F_DCBLOCK);
      708    12127    2              B$JIT.ERR='0'B;              /* REPORT ERROR AT CHECK, NOT NOW     */
      709    12128    2              RETURN;
      710    12129    2              END;                         /* END OF NO-WAIT NO-EVENT            */
      711    12130        /**/
      712    12131        /* NO-WAIT EVENT */
      713    12132        /**/
      714    12133    1           IF CODE=0 THEN
      715    12134    1              IF B$JIT.DO$=ADDR(NIL) THEN RETURN;
      716    12135    2              ELSE DO;
      717    12136                      %LOCK (G#=S_UDLGATE);
             12137    2   CALL HFC$LOCK(S_UDLGATE);
      718    12139    2   COMPDO:       B$JIT.DO$->B$DO.IOCOMP.CNTR=B$JIT.DO$->B$DO.IOCOMP.CNTR-1;
      719    12140    2                 IF FPTCODE=0 /* FPTREAD */ THEN
      720    12141    2                    B$JIT.DO$->B$DO.IOCOMP.ARS=F$DCB.ARS;
      721    12142    2                 B$JIT.DO$->B$DO.IOCOMP.DVE.DVBYTE=F$DCB.DVBYTE;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:21   
      722    12143    2                 B$JIT.DO$->B$DO.IOCOMP.DVE.EOMCHAR=F$DCB.EOMCHAR;
      723    12144                      %UNLOCK (G#=S_UDLGATE);
             12145    2   CALL HFC$UNLOCK(S_UDLGATE);
      724    12147    3                 DO INHIBIT;
      725    12148    3                    IF B$JIT.DO$->B$DO.IOCOMP.CNTR=0 THEN /* ALL I/O DONE        */
      726    12149    3                       CALL SSV$SCHDDO(B$JIT.DO$,S_CUN);
      727    12150    3                    END;
      728    12151    2                 B$JIT.DO$=ADDR(NIL);
      729    12152    2                 RETURN;
      730    12153    2                 END;
      731    12154    2           IF CODE>F_TYCMAX THEN DO;
      732    12155    3              IF B$JIT.DO$~=ADDR(NIL) THEN DO;
      733    12156    3                 USR=S_CUN;
      734    12157    3                 CALL SSV$XXDO(USR,B$JIT.DO$); /* GET RID OF DO-LIST             */
      735    12158    3                 B$JIT.DO$=ADDR(NIL);
      736    12159    3                 END;
      737    12160    2              RETURN;
      738    12161    2              END;
      739    12162    2           IF B$JIT.DO$~=ADDR(NIL) THEN DO;
      740    12163                   %LOCK (G#=F_DCBLOCK);
             12164    2   CALL HFC$LOCK(F_DCBLOCK);
      741    12166    2              BCDCB$->F$DCB.TYC(0)=BCDCB$->F$DCB.TYC(0)|F_TYCBITS(CODE);
      742    12167                   %UNLOCK (G#=F_DCBLOCK);
             12168    2   CALL HFC$UNLOCK(F_DCBLOCK);
      743    12170                   %LOCK (G#=S_UDLGATE);
             12171    2   CALL HFC$LOCK(S_UDLGATE);
      744    12173    2              B$JIT.DO$->B$DO.IOCOMP.TYC=B$JIT.DO$->B$DO.IOCOMP.TYC|F_TYCBITS(CODE);
      745    12174    2              B$JIT.ERR='0'B;              /* DON'T REPORT ERROR ON THIS PMME    */
      746    12175    2              GOTO COMPDO;
      747    12176    2              END;
      748    12177    1           RETURN;
      749    12178        /**/
      750    12179        /**/
      751    12180        /**/
      752    12181    1   FMF$PEOF: ENTRY(FPTCODE);  /* ENTER HERE FROM OPEN TO POSITION
      753    12182                                       FILES TO EOF FOR FILE EXTENSION */
      754    12183    1           JDCB$=B$JIT.DCB$;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:22   
      755    12184    1           BCDCB$=JDCB$;              /* DON'T NEED BYPASS CACHE ON THIS PATH    */
      756    12185    1           F$DCB.WAIT=1;
      757    12186    1           CFU$=F$DCB.CFU$;
      758    12187    1           IF F$DCB.SHARED THEN
      759    12188    1              CALL ENQRD ALTRET(ERRDEQ);
      760    12189    1           F$DCB.TYC(1)='0'B;
      761    12190    1           IF F$DCB.IASN~=%FILE# THEN      /* This shouldn't happen              */
      762    12191    1              GOTO VEC;
      763    12192        /**/
      764    12193    2           DO CASE(F$DCB.IORG);
      765    12194    2            CASE(%CONSEC#,%UR#);
      766    12195    2              CALL FMH$CPMME(8 /* PFILEOF */,0) ALTRET(ERROR);
      767    12196    2            CASE(%KEYED#);
      768    12197    2              CALL FMG$KPMME(8 /* PFILEOF */) ALTRET(ERROR);
      769    12198    2            CASE(%RANDOM#);
      770    12199    2              CALL FMI$RAN(8 /* PFILEOF */) ALTRET(ERROR);
      771    12200    2            CASE(%RELATIVE#);
      772    12201    2              CALL FMJ$REL(8 /* PFILEOF */) ALTRET(ERROR);
      773    12202    2            END;
      774    12203    1           GOTO DONE;
      775    12204        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:23   
      776    12205        /**/
      777    12206        /**/
      778    12207        /**/
      779    12208    1   FMF$REMOTE: ENTRY(FPTCODE);        /* Enter here to open or close an FTAM DCB */
      780    12209
      781    12210    1           JDCB$=B$JIT.DCB$;
      782    12211    1           F$DCB.FTAM.USR=B$JIT.USER;
      783    12212    1           CODE=FPTCODE+100;
      784    12213    1           F$DCB.CFU$=ADDR(FPTCODE);       /* Point to possible open fpt ptrs    */
      785    12214    1           IF CODE>200 THEN CODE=100;      /* Make a pointer looki like an open  */
      786    12215    1           CALL FTAM_WAIT(CODE);
      787    12216    1           RETURN;
      788    12217        /**/
      789    12218        /**/
      790    12219    1   FTAM_WAIT: PROC(FTAMCODE) ALTRET;
      791    12220
      792    12221    2   DCL FTAMCODE SBIN;
      793    12222    2   DCL FM_FTAM_USER STATIC SYMDEF UBIN INIT(%BITBIN('106124101115'O));
      794    12223
      795    12224    2           USR=FM_FTAM_USER;
      796    12225    2           IF USR=0 OR USR~=FM_FTAM_USER THEN B$JIT.ERR=ERRNOEVENT;
      797    12226    3           ELSE DO;
      798    12227    3              F$DCB.FTAM.PMME=FPTCODE;
      799    12228    3              B$JIT.ERR=ERRNOCODE;
      800    12229    3              CALL SSV$EVENT(USR,%USERWSR,%SUBC_COMIO#,F$DCB.FTAM,0);
      801    12230    4              DO WHILE B$JIT.ERR=ERRNOCODE;
      802    12231    4                 CALL SSR$REG(%SS_SL,25,25);
      803    12232    4                 IF FM_FTAM_USER~=USR THEN B$JIT.ERR=ERRNOEVENT;
      804    12233    4                 END;
      805    12234    3              END;
      806    12235    2           IF B$JIT.ERR THEN ALTRETURN;
      807    12236    2   END FTAM_WAIT;
      808    12237        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:24   
      809    12238        /**/
      810    12239        /**/
      811    12240        /*D*      NAME:       EXTEND
      812    12241                  CALL:       CALL EXTEND ALTRET(LOC);
      813    12242                  DESCRIPTION: Process the M$EXTEND PMME for all files
      814    12243        */
      815    12244        /**/
      816    12245        /**/
      817    12246        /**/
      818    12247    1   EXTEND: PROC ALTRET;
      819    12248        /**/
      820    12249    2   DCL RECS UBIN;
      821    12250    2   DCL GRANS SBIN;
      822    12251    2   DCL DSSID UBIN;
      823    12252    2   DCL WSQ UBIN;
      824    12253    2   DCL I SBIN;
      825    12254        /**/
      826    12255    2           IF F$DCB.IASN~=%FILE# OR
      827    12256    2             F$DCB.IORG~=%RANDOM# AND F$DCB.IORG~=%RELATIVE# THEN
      828    12257    2              RETURN;
      829    12258        /**/
      830    12259    2           CFU$=F$DCB.CFU$;
      831    12260    2           IF F$DCB.WSR=7 THEN WSQ=%USERWSQ;
      832    12261    2           ELSE WSQ=F$DCB.WSR;
      833    12262    2           DSSID=LS0UBIN+F$DCB.ACS;
      834    12263    2           GRANS=FM$CFU.NRECS;
      835    12264    2           IF F$DCB.ORG~=%RANDOM# OR FM$CFUR.HEADPP#=0 THEN
      836    12265    2              DSSID=0;
      837    12266    2           ELSE RECS=FM$CFUR.HEADPP#;
      838    12267    3           IF FPT$EXTEND_V.SIZ=0 THEN DO;
      839    12268    4              IF DSSID~=0 THEN DO;
      840    12269    4                 CALL MMH$MAP_DS(WSQ,DSSID,GRANS*1024-1,B$JIT.ERR,,
      841    12270    4                   RECS,,GRANS)ALTRET(MMDSERR);
      842    12271    4                 F$DCB.NRECS=FM$CFU.NRECS;
      843    12272    4                 END;
      844    12273    3              RETURN;
      845    12274    3              END;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:25   
      846    12275    3           IF DSSID~=0 THEN DO;
      847    12276    3              IF GRANS+FPT$EXTEND_V.SIZ>256 THEN GOTO SHRDS2BIG;
      848    12277    3              CALL MMH$SHARE_DS(WSQ,DSSID,FPT$EXTEND_V.SIZ*1024,B$JIT.ERR,,
      849    12278    3                RECS/*HEAD*/,GRANS/*TAIL*/,I)ALTRET(MMDSERR);
      850    12279    3              END;
      851    12280    2           IF F$DCB.SHARED THEN
      852    12281    2              CALL ENQWR ALTRET(ERR);
      853    12282        /**/
      854    12283        /**/
      855    12284    2           FM$CFU.FMOD='1'B;
      856    12285    3           IF F$DCB.ASN=%COMGROUP# THEN DO;
      857    12286    3              F$DCB.XTNSIZE=FPT$EXTEND_V.SIZ;
      858    12287    3              CALL KCO$EXTEND ALTRET(ERR);
      859    12288    3              END;
      860    12289    2           ELSE
      861    12290    3              IF F$DCB.IORG=%RANDOM# THEN DO;
      862    12291    3                 F$DCB.XTNSIZE=FPT$EXTEND_V.SIZ;
      863    12292    3                 IF DSSID=0 OR FM$CFU.UGRANS~=0 THEN CALL FAG$GEXT ALTRET(ERR);
      864    12293    4                 IF DSSID~=0 THEN DO;
      865    12294    4                    MM$PPUT.PPNO(FM$CFUR.TAILPP#)=RECS;
      866    12295    4                    FM$CFUR.TAILPP#=GRANS;
      867    12296    4                    FM$CFU.NRECS=FM$CFU.NRECS+F$DCB.XTNSIZE;
      868    12297    4                    MM_SHAREDSUSE=MM_SHAREDSUSE+F$DCB.XTNSIZE;
      869    12298    4                    F$DCB.NRECS=FM$CFU.NRECS;
      870    12299    4                    END;
      871    12300    3                 END;
      872    12301    3              ELSE DO;
      873    12302    3                 RECS=FM$CFU.NRECS+FPT$EXTEND_V.SIZ;
      874    12303    3                 GRANS=((RECS*((F$DCB.RECL+7)/4)+1021)/1022)-FM$CFU.UGRANS;
      875    12304    4                 IF GRANS>0 THEN DO;
      876    12305    4                    F$DCB.XTNSIZE=GRANS;
      877    12306    4                    CALL FAG$GEXT ALTRET(ERR);
      878    12307    4                    END;
      879    12308    3                 FM$CFU.NRECS=RECS;
      880    12309    3                 F$DCB.NRECS=RECS;
      881    12310    3                 END;
      882    12311    2           B$JIT.ERR='0'B;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:26   
      883    12312    2           RETURN;
      884    12313        /**/
      885    12314    2   ERR:    ;
      886    12315    3           IF DSSID~=0 THEN DO;
      887    12316    3              I=FPT$EXTEND_V.SIZ;
      888    12317    3              CALL MMJ$FPPCHAIN(RECS,GRANS,I);
      889    12318    3              CALL MMH$FDS(WSQ,DSSID,I*1024,I);
      890    12319    3              END;
      891    12320        /**/
      892    12321    2           ALTRETURN;
      893    12322        /**/
      894    12323    2   MMDSERR: B$JIT.ERR=ERRNOCODE|BINBIT(BITBIN(B$JIT.ERR)*8,36);
      895    12324    2           ALTRETURN;
      896    12325        /**/
      897    12326    2   SHRDS2BIG: B$JIT.ERR=ERRSHRDS2BIG;
      898    12327    2           ALTRETURN;
      899    12328        /*E*  ERROR: FMF-E$SHRDS2BIG-2
      900    12329        */
      901    12330        /**/
      902    12331    2   END EXTEND;
      903    12332        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:27   
      904    12333        /*F*    NAME:  FMF$CHECK
      905    12334        *       PURPOSE:  Implement the M$CHECK PMME - wait for all
      906    12335        *         outstanding I/O on a DCB to complete.
      907    12336        */
      908    12337        /**/
      909    12338        /**/
      910    12339        /*D*    NAME: FMF$CHECK
      911    12340        *       CALL: CALL FMF$CHECK;
      912    12341        *       INPUT:  B$JIT.DCB$ - Pointer to DCB
      913    12342        *       DESCRIPTION:  If DCB is marked as having been opened by
      914    12343        *         a vehicle, give an error if this is not the vehicle.
      915    12344        *         Wait for all no-wait type I/O to complete.  Move
      916    12345        *         F$DCB.TYC(0) to F$DCB.TYC(1).  Perform the same operations
      917    12346        *         as FMF$PMME exit logic to set B$JIT.ERR.
      918    12347        */
      919    12348        /**/
      920    12349        /**/
      921    12350    1   FMF$CHECK: ENTRY;
      922    12351    1           JDCB$=B$JIT.DCB$;
      923    12352    1           IF NOT F$DCB.FCD THEN
      924    12353    1              RETURN;
      925    12354    1           B$JIT.ERR='0'B;
      926    12355    2           IF F$DCB.FFLG.EXEC THEN DO;     /* EXECUTE-ONLY                       */
      927    12356    2              CALL FMO$GETDOMAIN(I);
      928    12357    3              IF F$DCB.WSR~=I THEN DO;
      929    12358    3                 B$JIT.ERR=ERRDOMAIN;
      930    12359    3                 GOTO ERRXIT;
      931    12360    3                 END;
      932    12361    2              END;
      933    12362    1           BCDCB$=JDCB$;
      934    12363    1           BCDCB.SID=%RONCSID;             /* BYPASS CACHE POINTER               */
      935    12364    1           IF BCDCB$->F$DCB.FCN(0) THEN
      936    12365    1              CALL SSR$REG(%SS_IIPC,BCDCB$->F$DCB.FCN(0)) ALTRET(PMMEINT);
      937    12366    1           F$DCB.TYC(1)=BCDCB$->F$DCB.TYC(0); /* MOVE TYC                        */
      938    12367    1           F$DCB.TYC(0)='0'B;
      939    12368    1           IF S$CU$->B$U.ASYNCH&%U_CACHE THEN
      940    12369    1              CALL CACHECLR;               /* Clear the cache                    */
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:28   
      941    12370    1           GOTO CHKTYC;
      942    12371        /**/
      943    12372    1   PMMEINT: B$JIT.ERR=ERRPMMEINT;
      944    12373    1           GOTO ERRXIT;
      945    12374        /*E*    ERROR:  FMF-E$PMMEINT-2
      946    12375        *       MESSAGE: Service request interrupted by break or control-y
      947    12376        */
      948    12377        /**/
      949    12378        /**/
      950    12379        /**/
      951    12380    1   FMF$TRUNCM: ENTRY(FPTCODE);
      952    12381    1           ENTFLG=1;                       /* Called directly by monitor         */
      953    12382    1           GOTO TRUNC;
      954    12383        /**/
      955    12384    1   FMF$TRUNC: ENTRY(FPTCODE);
      956    12385    1           ENTFLG=0;                       /* Called via PMME                    */
      957    12386        /**/
      958    12387    1   TRUNC:  JDCB$=B$JIT.DCB$;
      959    12388    1           B$JIT.ERR='0'B;
      960    12389    1   CHKOPN: IF NOT F$DCB.FCD THEN
      961    12390    1              RETURN;                      /* DCB closed                         */
      962    12391    2           IF F$DCB.FFLG.EXEC AND ENTFLG=0 THEN DO;
      963    12392    2              CALL FMO$GETDOMAIN(I);
      964    12393    3              IF F$DCB.WSR~=I THEN DO;
      965    12394    3                 B$JIT.ERR=ERRDOMAIN;
      966    12395    3                 GOTO ERRXIT;
      967    12396    3                 END;
      968    12397    2              END;
      969    12398        /**/
      970    12399    2           IF F$DCB.ASN=%COMGROUP# THEN DO;
      971    12400    3              IF ENTFLG~=0 THEN DO;
      972    12401    3                 CG$=NK$LDCT$(F$DCB.LDCTX)->NK$LDCT.CG$;
      973    12402    3                 STA$=NK$LDCT$(F$DCB.LDCTX)->NK$LDCT.STA$;
      974    12403    3                 CALL KQX$LDASR (CG$->KQ$CG);
      975    12404    3                 CALL KQC$ABTRD (STA$->KQ$STA,%TYC_EOF);
      976    12405    3                 END;
      977    12406    2              END;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:29   
      978    12407    1           IF F$DCB.RESNT.TYP='NC' THEN
      979    12408    1              CALL KIS$OSI_TRUNC;
      980    12409    2           IF F$DCB.RESNT.TYP = 'CL' THEN DO;
      981    12410    2              LDCT$ = NK$LDCT$(F$DCB.LDCTX);
      982    12411    2              RWPARM = K_RWPARM_CON;
      983    12412    2              RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;
      984    12413    2              RWPARM.STR =LDCT$->NK$LDCT.NOWAIT.STREAM;
      985    12414                   %LOCK(G#=LDCT$->NK$LDCT.LOCK);
             12415    2   CALL HFC$LOCK(LDCT$->NK$LDCT.LOCK);
      986    12417    2              CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,RWPARM)
      987    12418    3              WHENRETURN DO;
      988    12419    3                 LDCT$->NK$LDCT.LKFLG.WTMRK = '1'B;
      989    12420    3                 CALL SSR$REG(%SS_CW,LDCT$);
      990    12421                      %LOCK(G#=LDCT$->NK$LDCT.LOCK);
             12422    3   CALL HFC$LOCK(LDCT$->NK$LDCT.LOCK);
      991    12424    3                 END;
      992    12425    3              DO WHILE F$DCB.FCN.CNT(0) > 0;
      993    12426    3                 RWPARM = K_RWPARM_CON;
      994    12427    3                 RWPARM.MSG_ERRCODE = ERREOD;
      995    12428        /*E*    ERROR:   -E$EOD-2
      996    12429        *       MESSAGE:  End-of-data% on %UF%
      997    12430        *       MESSAGE1: An !EOD was read thru the command stream
      998    12431        */
      999    12432    3                 RWPARM.TYC  = %TYC_EOF;
     1000    12433    3                 CALL KIA$COMP(LDCT$->NK$LDCT,RWPARM);
     1001    12434    3                 END;
     1002    12435                   %UNLOCK(G#=LDCT$->NK$LDCT.LOCK);
             12436    2   CALL HFC$UNLOCK(LDCT$->NK$LDCT.LOCK);
     1003    12438    2              END;
     1004    12439    1           IF F$DCB.ASN=%FILE# AND F$DCB.ORG=%RANDOM# AND F$DCB.ACS>%JRNL#
     1005    12440    2             AND F$DCB.FFLG.WNEW AND ENTFLG=0 THEN DO;
     1006    12441    2              IF F$DCB.CFU$->FM$CFU.UGRANS=0 THEN EXIT; /* No file to write to.  */
     1007    12442    2              I=F$DCB.WSR;
     1008    12443    2              IF I=7 THEN I=%USERWSQ;
     1009    12444    2              CALL FMI$DSWRITE (I);
     1010    12445    2              END;
     1011    12446    1           BCDCB$=JDCB$;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:30   
     1012    12447    1           BCDCB.SID=%RONCSID;             /* BYPASS CACHE PTR                   */
     1013    12448    1           IF BCDCB$->F$DCB.FCN(0) THEN    /* WAIT FOR ANY I/O                   */
     1014    12449    1              CALL SSR$REG(%SS_IIP,BCDCB$->F$DCB.FCN(0));
     1015    12450    2           DO CASE(F$DCB.IASN);
     1016    12451    2            CASE (%TAPE#, %OD#);
     1017    12452    2              CALL FTT$TRUNC;
     1018    12453    2              RETURN;
     1019    12454    2            CASE(%DEVICE#);
     1020    12455    3              DO I=0 TO 4;
     1021    12456    3                 CALL FMD$RELBUF(I);
     1022    12457    3                 END;
     1023    12458    2              RETURN;
     1024    12459    2            CASE(%STREAM#);
     1025    12460    2              B$JIT.DCB$=F$DCB.CFU$;       /* POINT TO SECRET DCB                */
     1026    12461    2              IF B$JIT.DCB$=ADDR(NIL) THEN RETURN;
     1027    12462    2              GOTO TRUNC;
     1028    12463    2            END;
     1029    12464    2           DO I=0 TO 4;
     1030    12465    2              IF NOT B$JIT.DCB$->F$DCB.BFR.CVM(I) THEN
     1031    12466    3              DO;
     1032    12467    3                 IF F$DCB.BFR1.CX(I) > 0 THEN
     1033    12468    3                    IF FMC$CACHETBL.USECNT(F$DCB.BFR1.CX(I)) > 1 THEN
     1034    12469    3                       CALL FMD$WRTSV(I);  /* MAKE SURE WE ACTUALLY WRITE        */
     1035    12470        /* TO DISK IF THE GRANULE IS CACHED                                           */
     1036    12471    3                 CALL FMD$FLSHBUF(I);
     1037    12472    3                 END;
     1038    12473    3              ELSE DO;
     1039    12474    3                 CALL ENQWR ALTRET(ERRDEQ);
     1040    12475    4                 IF B$JIT.DCB$->F$DCB.CFU$->FM$CFUJ.UPD THEN DO;
     1041    12476    4                    CALL FMD$WRTSV(I);
     1042    12477    4                    END;
     1043    12478    3                 CALL DEQ;
     1044    12479    3                 CALL FMD$RELBUF(I);
     1045    12480    3                 END;
     1046    12481    2              END;
     1047    12482    1           RETURN;
     1048    12483        /**/
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:31   
     1049    12484        /**/
     1050    12485        /**/
     1051    12486    1   FMF$SETFMA: ENTRY;
     1052    12487    1           B$JIT.DCB$ = B$M$STAR$;
     1053    12488    1           JDCB$ = B$JIT.DCB$;
     1054    12489    1           IF F$DCB.FCD THEN
     1055    12490    1              CALL FMP$CLSJ;
     1056    12491    1           CALL FMM$SCRUB(B$JIT.DCB$);
     1057    12492    1           F$DCB.ASN = %FILE#;
     1058    12493    1           F$DCB.FUN = %IN#;
     1059    12494    1           B$JIT.FACNACS='0'B;
     1060    12495    1           CALL HFF$NILERASE(0) ALTRET(RSET); /* No account specified.           */
     1061    12496    1           CALL HFF$DSIZ(B$PS0$,I);
     1062    12497    1           F$DCB.ACCT = B$PS0$->CHARS;
     1063    12498    2           CALL HFF$NILERASE(1) WHENRETURN DO;
     1064    12499    2              CALL HFF$DSIZ(B$PS1$,I);
     1065    12500    2              F$DCB.PSN = B$PS1$->CHARS;
     1066    12501    2              END;
     1067    12502    2           WHENALTRETURN DO;               /* No packset specified.              */
     1068    12503    2              F$DCB.PSN = ' ';
     1069    12504    2              END;
     1070    12505    1           CALL FMM$DFLOPN;
     1071    12506    1           IF NOT F$DCB.FCD AND B$JIT.ERR.CODE ~= %E$NOFILE THEN
     1072    12507    1              RETURN;
     1073    12508    1           IF F$DCB.FCD THEN
     1074    12509    1              CALL FMP$CLSJ;
     1075    12510    2           IF NOT F$DCB.FFLG THEN DO;
     1076    12511    2              B$JIT.ERR = ERRNOACCT;
     1077    12512    2              RETURN;
     1078    12513    2              END;
     1079    12514    1           B$JIT.ERR = '0'B;
     1080    12515    1           B$JIT.FACCN = F$DCB.ACCT;
     1081    12516    1           B$JIT.FPSN = F$DCB.PSN;
     1082    12517    1           RETURN;
     1083    12518        /**/
     1084    12519    1   RSET:   B$JIT.FACCN=B$JIT.ACCN;         /* Reset account, packset.            */
     1085    12520    1           B$JIT.FPSN=' ';
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:32   
     1086    12521    1           RETURN;
     1087    12522        /**/
     1088    12523        /**/
     1089    12524        /**/
     1090    12525    1   ENQRD:  PROC ALTRET;
     1091    12526    2   DCL TYPE UBIN;
     1092    12527        /**/
     1093    12528    2           TYPE=0;
     1094    12529    2           GOTO COMMON;
     1095    12530    2   ENQWR:  ENTRY ALTRET;
     1096    12531    2           TYPE=1;
     1097    12532    2   COMMON: IF F$DCB.IORG=%RANDOM# AND FPTCODE~=5 /* FPTEXTEND */ THEN
     1098    12533    2              RETURN;                      /* No need to ENQ for star files      */
     1099    12534    2           CFU$=F$DCB.CFU$;
     1100    12535    3           DO CASE(TYPE);
     1101    12536    3            CASE(1);                       /* WRITE - 1 AT A TIME                */
     1102    12537    3              CALL UQB$MENQXB(F$DCB.CFU$)
     1103    12538    3                ALTRET(QERR);
     1104    12539    3            CASE(0);                       /* READ - MANY READERS NO WRITERS     */
     1105    12540    3              CALL UQB$MENQSB(F$DCB.CFU$)
     1106    12541    3                ALTRET(QERR);
     1107    12542    3            END;
     1108    12543    2           F$DCB.ENQF='1'B;
     1109    12544    3           IF F$DCB.ACS~=%JRNL# THEN DO;
     1110    12545    3              IF TYPE = 1 THEN
     1111    12546    4              DO I=0 TO 4;
     1112    12547    5                 IF F$DCB.BFR1.CX(I) > 0 THEN DO;
     1113    12548    5                    IF FMC$CACHETBL.FLAGS.ERR(F$DCB.BFR1.CX(I)) THEN
     1114    12549    5                       CALL FMD$RELBUF(I);
     1115    12550    5                    END;
     1116    12551    5                 ELSE DO;
     1117    12552    5                    IF I ~= 2 THEN
     1118    12553    5                       CALL FMD$RELBUF(I);
     1119    12554    5                    END;
     1120    12555    4                 END;                      /* DO I                               */
     1121    12556    3              ELSE
     1122    12557    3                 IF F$DCB.MODCNT ~= FM$CFU.MODCNT THEN
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:33   
     1123    12558    4                 DO I=0 TO 4;
     1124    12559    5                    IF F$DCB.BFR1.CX(I) > 0 THEN DO;
     1125    12560    5                       IF FMC$CACHETBL.FLAGS.ERR(F$DCB.BFR1.CX(I)) THEN
     1126    12561    5                          CALL FMD$RELBUF(I);
     1127    12562    5                       END;
     1128    12563    5                    ELSE DO;
     1129    12564    5                       IF I ~= 2 THEN
     1130    12565    5                          CALL FMD$RELBUF(I);
     1131    12566    5                       END;
     1132    12567    4                    END;                   /* DO I                               */
     1133    12568        /* If this is a shared file, then we have to do some buffer
     1134    12569        juggling to make sure that the user's buffers are current.
     1135    12570        First of all, if this is a write, then flush out any uncached
     1136    12571        buffers.  This prevents us from writing uncached buffers to
     1137    12572        disk, invalidating the cache.  Also, if there are any buffers
     1138    12573        in error, then flush those out now also.  Next, if this is a
     1139    12574        read, then flush out any uncached buffers only if we weren't
     1140    12575        the last updaters.  Again, flush any cached buffers marked with
     1141    12576        the error flag.  The reason we don't flush buffer 2 is because
     1142    12577        it is the TDA, and shouldn't be updated. */
     1143    12578    3              IF TYPE~=0 THEN              /* Updating                           */
     1144    12579    3                 FM$CFU.MODCNT=FM$CFU.MODCNT+1; /* INCR WRITE COUNT              */
     1145    12580    3              END;
     1146    12581    2           ELSE
     1147    12582    2              IF FPTCODE=8 /* PFILEOF */ THEN
     1148    12583    2                 IF FM$CFUJ.PAGE#=0 THEN
     1149    12584    2                    RETURN;                /* FIRST OPENER - KEEP GOING          */
     1150    12585    3                 ELSE DO;
     1151    12586    3                    B$JIT.ERR='0'B;   /* SOMEONE GOT HERE FIRST - JUST GET OUT   */
     1152    12587    3                    ALTRETURN;
     1153    12588    3                    END;
     1154    12589    3              ELSE DO;                     /* Journal                            */
     1155    12590    4                 IF FM$CFUJ.PAGE#=0 THEN DO;
     1156    12591    4                    B$JIT.ERR=ERRJRNL;
     1157    12592    4                    ALTRETURN;
     1158    12593    4                    END;
     1159    12594    4                 IF NOT F$DCB.OWNER AND FM$CFUJ.ERR_WAIT THEN DO;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:34   
     1160    12595    4                    CALL UQB$MDEQ(F$DCB.CFU$);
     1161    12596    4                    F$DCB.ENQF='0'B;
     1162    12597    4                    CALL SSR$REG(%SS_SL,,5) ALTRET(BRK_EVT);
     1163    12598    4                    GOTO COMMON;
     1164    12599    4                    END;
     1165    12600    3                 CALL FMD$RELBUF(4);       /* THE FIT MAY BE QUITE OLD           */
     1166    12601    3                 CALL FMH$MAPJRNL(1);
     1167    12602    3                 END;
     1168    12603    2           RETURN;
     1169    12604        /*E*    ERROR:  FMF-E$JRNLCLSD-2
     1170    12605        *       MESSAGE: Attempt to access journal% %UF% after owner closed
     1171    12606        */
     1172    12607        /**/
     1173    12608    2   BRK_EVT: ;
     1174    12609    2           B$JIT.JUNK=B$JIT.JUNK|%JJ_BAKIC#; /* Retry PMME                       */
     1175    12610    2           B$JIT.ERR=ERRPMMEINT;
     1176    12611    2           ALTRETURN;
     1177    12612        /**/
     1178    12613    2   QERR:   ;
     1179    12614    2           ALTRETURN;
     1180    12615        /*S*    SCREECH_CODE:   FMF-S$FM98
     1181    12616        *       TYPE:  SNAP
     1182    12617        *      MESSAGE:  ENQ/DEQ error during PMME to shared file */
     1183    12618    2   END ENQRD;
     1184    12619        /**/
     1185    12620        /**/
     1186    12621        /**/
     1187    12622    1   DEQ:    PROC;
     1188    12623    2   DCL IOFLAG SBIN;
     1189    12624        /**/
     1190    12625    2           IF NOT F$DCB.ENQF THEN RETURN;
     1191    12626    2           IOFLAG=0;
     1192    12627    2           IF F$DCB.ACS=%JRNL# THEN
     1193    12628    3              IF FM$CFUJ.PAGE#~=0 THEN DO;
     1194    12629    3                 FM$CFUJ.UPD=F$DCB.BFR.BUFUP(1);
     1195    12630    3                 IF NOT B$JIT.ERR THEN
     1196    12631    3                    FM$CFUJ.ERR_WAIT='0'B; /* Clear error if successful PMME     */
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:35   
     1197    12632    4                 ELSE DO;
     1198    12633    4                    IF B$JIT.ERR.CODE<512
     1199    12634    4                    THEN CALL INDEX(I,BINASC(B$JIT.ERR.CODE),USRJRNERRS)
     1200    12635    5                       WHENRETURN DO; GOTO NO_REG; END;
     1201    12636    4                    ELSE CALL INDEX(I,BINASC(B$JIT.ERR.CODE-512),USRTJNERRS)
     1202    12637    5                       WHENRETURN DO; GOTO NO_REG; END;
     1203    12638    5                    IF NOT FM$CFUJ.ERR_WAIT THEN DO; /* First error              */
     1204    12639    5                       FM$CFUJ.ERR_WAIT='1'B;
     1205    12640    6                       IF NOT F$DCB.OWNER THEN DO;
     1206    12641    6                          JRNLECCI.P#=1;
     1207    12642    6                          JRNLECCI.VOL=FM$CFUJ.VOL;
     1208    12643    6                          I=FM$CFUJ.DMAIN;
     1209    12644    6                          B$JIT.ERR.MON='1'B; /* set MON bit                     */
     1210    12645    6                          CALL SSV$EVENT(FM$CFUJ.USER,I,%SUBC_JRNLERR#,
     1211    12646    6                            F$DCB.CFU$,B$JIT.ERR,ADDR(JRNLECCI),ENTADDR(NIL));
     1212    12647    6                          CALL UQB$MDEQ(F$DCB.CFU$);
     1213    12648    6                          F$DCB.ENQF='0'B;
     1214    12649    6                          B$JIT.ERR='0'B;
     1215    12650    6                          B$JIT.JUNK=B$JIT.JUNK|%JJ_BAKIC#;
     1216    12651    6                          RETURN;
     1217    12652    6                          END;
     1218    12653    5                       END;
     1219    12654    4                    END;
     1220    12655    3                 END;
     1221    12656    2              ELSE;                        /* ACS=%JRNL# and FM$CFUJ.PAGE#=0     */
     1222    12657    2           ELSE                            /* ACS~=%JRNL#                        */
     1223    12658    3           DO I=0 TO 4;
     1224    12659    4              IF F$DCB.BFR.BUFUP(I) AND F$DCB.BFR1.CX(I) = 0 THEN DO;
     1225    12660    4                 CALL FMD$WRTSVNW(I);      /* WRITE NO-WAIT                      */
     1226    12661    4                 IF F$DCB.WAIT=0 THEN
     1227    12662    4                    IOFLAG=IOFLAG+1;
     1228    12663    4                 END;
     1229    12664    3              END;
     1230    12665    2   NO_REG: ;
     1231    12666    2           F$DCB.MODCNT=FM$CFU.MODCNT;
     1232    12667    2           CALL UQB$MDEQ(F$DCB.CFU$);
     1233    12668    2           F$DCB.ENQF='0'B;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:36   
     1234    12669    2           IF IOFLAG~=0 THEN
     1235    12670    2              CALL FMB$IOSPIN;
     1236    12671    2           RETURN;
     1237    12672    2   END DEQ;
     1238    12673        /**/
     1239    12674        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:37   
     1240    12675    1   CHKBAD: PROC ALTRET;
     1241    12676
     1242    12677    2           IF F$DCB.IASN ~= %OD# THEN
     1243    12678    2              IF F$DCB.ASN=%FILE# AND
     1244    12679    2                (F$DCB.CFU$->FM$CFU.B=1 AND F$DCB.ACS~=%JRNL# OR
     1245    12680    2                F$DCB.DESC.BAD) AND
     1246    12681    2                NOT B$JIT.PRIV.ACTIVE.FMSEC AND
     1247    12682    2                S_CUN>%15/*JG_MING#    */ AND
     1248    12683    2                (F$DCB.IFMT=2/*FMTKEY#*/ OR F$DCB.IFMT=4/*FMTREL#*/ OR
     1249    12684    3                F$DCB.IFMT=1/*FMTCON#*/) THEN DO;
     1250    12685    3                 B$JIT.ERR=ERRBROKEN;
     1251    12686    3                 ALTRETURN;
     1252    12687    3                 END;
     1253    12688    2           RETURN;
     1254    12689    2   END CHKBAD;
     1255    12690        /*E*   ERROR:   FMF-E$BROKEN-2
     1256    12691               MESSAGE:  File% %UF% contains inconsistencies, no updates allowed.
     1257    12692               MESSAGE1:  File% %UF% was damaged due to a system error, no
     1258    12693                          updates are allowed unless FMSEC is active.
     1259    12694        */
     1260    12695
     1261    12696        /**/
     1262    12697    1   CACHECLR: PROC;
     1263    12698        /**/
     1264    12699                %LOCK (G=S_ASFGATE);
             12700    2   CALL HFC$LOCK( S_ASFGATE);
     1265    12702    2           S$CU$->B$U.ASYNCH=S$CU$->B$U.ASYNCH&(~%U_CACHE);
     1266    12703                %UNLOCK (G=S_ASFGATE);
             12704    2   CALL HFC$UNLOCK( S_ASFGATE);
     1267    12706    2           CALL HFC$CACHECLR;
     1268    12707    2           RETURN;
     1269    12708    2   END CACHECLR;
     1270    12709        /**/
     1271    12710        /**/
     1272    12711        /**/
     1273    12712        /*E*    ERROR:   -E$OPER-2
     1274    12713        *       MESSAGE:  Tape error, position lost% on %SN%
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:38   
     1275    12714        */
     1276    12715        /*E*    ERROR:   -E$EOT-2
     1277    12716        *       MESSAGE:  End-of-tape% on %SN%
     1278    12717        */
     1279    12718        /*E*    ERROR:   -E$BOT-2
     1280    12719        *       MESSAGE:  Beginning-of-tape% on %SN%
     1281    12720        */
     1282    12721        /*E*    ERROR:   -E$BOF-2
     1283    12722        *       MESSAGE:  Beginning-of-file% on %UF%
     1284    12723        */
     1285    12724        /*E*    ERROR:   -E$BLNKTP-2
     1286    12725        *       MESSAGE:  Blank tape encountered on read% of %SN%
     1287    12726        */
     1288    12727        /*E*    ERROR:   -E$EOF-2
     1289    12728        *       MESSAGE:  End-of-file% on %UF%
     1290    12729        */
     1291    12730        /*E*    ERROR:   -E$LD-2
     1292    12731        *       MESSAGE:  Lost data% on %UF%
     1293    12732        *       MESSAGE1:  Attempt to read more than will fit in your buffer,
     1294    12733                  or write more than is allowed
     1295    12734        */
     1296    12735        /*E*    ERROR:   -E$IOERR-2
     1297    12736        *       MESSAGE:  I/O error% on %UF%
     1298    12737        *       MESSAGE1: A hardware I/O error occurred
     1299    12738        */
     1300    12739        /*E*    ERROR:   -E$DI-2
     1301    12740        *       MESSAGE: Data inconsistency% in file %FN%
     1302    12741        *       MESSAGE1: Due to a hardware error, or file management error,
     1303    12742                          the data for one or more records have been lost.
     1304    12743        */
     1305    12744        /*E*    ERROR:   -E$MTRAP-2
     1306    12745        *       MESSAGE: Buffer inaccessible% for %UF%%, DCB %DC%
     1307    12746        *       MESSAGE1: The buffer does not have the proper memory access
     1308    12747        */
     1309    12748        /*E*    ERROR:   -E$LDSC-2
     1310    12749        *       MESSAGE: Line disconnect or absent comgroup station% on %DC%
     1311    12750        */
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:39   
     1312    12751        /*E*    ERROR:  -E$DACTR-2
     1313    12752        *       MESSAGE: You are deactivated - I/O not permitted% on %DC%
     1314    12753        */
     1315    12754        /*E*    ERROR:   -E$TIMO-2
     1316    12755        *       MESSAGE: Read timed out% on %DC%
     1317    12756        */
     1318    12757        /*E*    ERROR:   -E$PROT-2
     1319    12758        *       MESSAGE:  %%SN %Write-protected
     1320    12759        */
     1321    12760        /*E*    ERROR:   -E$FRAW-2
     1322    12761        *       MESSAGE: Read after forward write on tape% %SN%
     1323    12762        */
     1324    12763        /*E*    ERROR:   -E$LAST-2
     1325    12764        *       MESSAGE: Error occurred on previous operation% on %DC%
     1326    12765        */
     1327    12766        /*E*    ERROR:   -E$CDALRT-2
     1328    12767        *       MESSAGE: Invalid ASCII character detected on write% on DCB %DC%
     1329    12768        */
     1330    12769        /*E*    ERROR:   -E$XTRARD-2
     1331    12770                MESSAGE: Read with read pending% on %DC%
     1332    12771                MESSAGE1: A read was issued when a read was already pending
     1333    12772        */
     1334    12773        /*E*    ERROR:   -E$CGKEYV-2
     1335    12774                MESSAGE: COMGROUP key violation% on %DC%
     1336    12775                MESSAGE1: A COMGROUP read or write illegally specified a station
     1337    12776                          or message type that does not exist
     1338    12777        */
     1339    12778        /*E*    ERROR:   -E$CGLWRV-2
     1340    12779                MESSAGE: COMGROUP LATCHed write violation% on %DC%
     1341    12780                MESSAGE1: A COMGROUP write specified LATCH, but there was
     1342    12781                          no latched input message to use, or the latched
     1343    12782                          input message's spawn or spawn count was exhausted.,
     1344    12783                          or the destination was wild-carded.
     1345    12784        */
     1346    12785        /*E*    ERROR:   -E$CGFULL-2
     1347    12786                MESSAGE: COMGROUP full% - %DC%
     1348    12787                MESSAGE1: When encountered on M$WRITE, this error indicates
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:40   
     1349    12788                          that the designated COMGROUP has no more space.
     1350    12789                          When encountered on M$READ it means that the
     1351    12790                          comgroup has insufficient memory available to
     1352    12791                          process the read request.
     1353    12792        */
     1354    12793        /*E*    ERROR:   -E$CGCRCW-2
     1355    12794                MESSAGE: COMGROUP LATCHed write in progress% on %DC%
     1356    12795                MESSAGE1: An M$READ to COMGROUP with an input message currently
     1357    12796                          latched causes that message to be deleted and its
     1358    12797                          latched writes sent.  This error occurs when a
     1359    12798                          continued latched write is still awaiting its last
     1360    12799                          segment at the time the read is issued.  The latched
     1361    12800                          write must either be finished via M$WRITE, or
     1362    12801                          deleted via M$UNLATCH.
     1363    12802        */
     1364    12803        /*E*    ERROR:   -E$CGCWRV-2
     1365    12804                MESSAGE: COMGROUP continued write or read violation% on %DC%
     1366    12805                MESSAGE1: A COMGROUP write specified continue, but
     1367    12806                          a different message type was specified on
     1368    12807                          this subsequent write, or a wild-carded
     1369    12808                          destination was specified on this first write,
     1370    12809                          or a comgroup read specified CONT and there
     1371    12810                          was no message to continue reading.
     1372    12811        */
     1373    12812        /* The following error appears here only so it will be extracted with the rest
     1374    12813           of the file management errors, and for no other reason.  It belongs to XSA,
     1375    12814           and is only used in XSA$FSF.  It's here because XSA has only one error of its
     1376    12815           very own...this one.
     1377    12816        */
     1378    12817        /*E*     ERROR:   XSA-E$UNFAST-0
     1379    12818                 MESSAGE:    Operation would have "unfasted" your file.
     1380    12819                 MESSAGE1:   The operation you attempted is not supported by XSA, and
     1381    12820                             would have caused XSA to begin using the standard monitor
     1382    12821                             services rather than the fast XSA services.
     1383    12822                 DESCRIPTION:  This error is returned by the fast sequential file access
     1384    12823                             routines when an operation is attempted that would have
     1385    12824                             "unfasted" the file, and the field XSA_PARAM.UNFAST# is
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:41   
     1386    12825                             set.  The error is used nowhere else.
     1387    12826        */
     1388    12827        /**/
     1389    12828    1   END FMF$PMME;
     1390    12829        %EOD;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:42   
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   UE_ERRORS_C.:E05TOU  is referenced.
   UE_CP6.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   F_CODE_R.:E05TOU  cannot be made into a system file and is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM_CACHE_C.:E05TOU  is referenced.
   FM_CACHE_R.:E05TOU  cannot be made into a system file and is referenced.
   FM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMF$PMME.
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:43   

   Procedure FMF$PMME requires 2129 words for executable code.
   Procedure FMF$PMME requires 76 words of local(AUTO) storage.

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:44   

 Object Unit name= FMF$PMME                                   File name= FMF$PMME.:E05TOU
 UTS= JUL 29 '97 16:42:51.92 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     29     35  FMF$PMME
    1   Data  even  none     1      1  FMF$PMME
    2   Proc  even  none  2129   4121  FMF$PMME
    3  RoData even  none    32     40  FMF$PMME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        1  FMF$PMME
     2   1515                  yes      Std        1  FMF$PEOF
     2   1603                  yes      Std        1  FMF$REMOTE
     2   2320                  yes      Std        0  FMF$CHECK
     2   2416                  yes      Std        1  FMF$TRUNCM
     2   2423                  yes      Std        1  FMF$TRUNC
     2   3071                  yes      Std        0  FMF$SETFMA

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      0  FM_FTAM_USER
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:45   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMO$GETDOMAIN
 yes     yes           Std       2 FSE$GRSTRM
 yes     yes           Std       3 SSR$REG
 yes     yes           Std       2 KQC$ABTRD
         yes           Std       0 FMM$DFLOPN
 yes     yes           Std       2 HFF$DSIZ
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 FMH$CPMME
 yes     yes           Std       3 FMH$UBLOCK
 yes     yes           Std       1 FMI$RAN
 yes     yes           Std       1 FMJ$REL
 yes     yes           Std       2 FSE$FPSTREAM
         yes           Std       1 FMD$RELBUF
         yes           Std       1 KQX$LDASR
         yes           Std       1 FMD$WRTSV
 yes     yes           Std       3 FTW$WRAT
 yes     yes           Std       2 FSE$TTYSTREAM
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       3 SSV$XXDO
 yes     yes           Std       2 FSE$UR
 yes     yes           Std       1 HFF$NILERASE
         yes           Std       1 HFC$LOCK
 yes     yes           Std       0 HFF$TRAPALT
         yes           Std       1 NAI$WRITE
 yes     yes           Std       2 FSD$JE
 yes     yes           Std       2 FSE$URFILE
 yes     yes           Std       2 FSE$GR
         yes           Std       1 FMD$WRTCACHE
         yes           Std       1 FMI$DSWRITE
 yes     yes           Std       0 KIS$OSI_TRUNC
 yes     yes           Std       2 FSE$NC
         yes           Std       1 FMM$SCRUB
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:46   
 yes     yes           Std       3 KIA$FCNOU
         yes           Std       0 FMP$CLSJ
         yes           Std       2 KIA$COMP
 yes     yes           Std       0 FTT$TRUNC
         yes           Std       0 UDN$MAGIC
 yes     yes           Std       1 FMG$KPMME
 yes     yes           Std       2 FSE$URSTREAM
 yes     yes           Std       2 FSE$TTY
 yes     yes           Std       2 FSE$FPRG
         yes           Std       1 FMD$DECRYPT_BUFFER
         yes           Std       2 SSV$SCHDDO
         yes           Std       6 SSV$INITDO
         yes           Std       0 UDB$PMMEXIT1
         yes           Std       7 SSV$EVENT
 yes     yes           Std       8 MMH$MAP_DS
 yes     yes           Std       4 MMH$FDS
         yes           Std       3 MMJ$FPPCHAIN
 yes     yes           Std       8 MMH$SHARE_DS
 yes     yes           Std       0 KCO$EXTEND
 yes     yes           Std       0 FAG$GEXT
 yes     yes           Std       1 UQB$MENQXB
 yes     yes           Std       1 UQB$MDEQ
         yes           Std       2 FMH$MAPJRNL
 yes     yes           Std       1 UQB$MENQSB
         yes           Std       0 FMB$IOSPIN
         yes           Std       1 FMD$WRTSVNW
         yes           Std       0 HFC$CACHECLR
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:47   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_FMF92                              F_DCBLOCK                             FMC_CACHE$
     FMC_CACHEPGCNT$                  r    F_CODE                           r    F_SEV
r    F_TYCMAX                         r    F_TYCBITS                             S$CU$
r    K_RWPARM_CON                          N$DCT$$                          r    B$JIT$
r    B$M$STAR$                        r    B$PS0$                           r    B$PS1$
r    B$PS2$                                B$IS$                                 B$PPUT$
     B_MPT                                 MM_SHAREDSUSE                         S_ASFGATE
     S_UDLGATE                             S_CUN                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:48   


        1        1        /*M*   FMF$PMME - Pre and post processing for most FM PMMEs  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7                                                                                  /* */
        8        8        /*X* */
        9        9        /**/
       10       10        /*P*    NAME:  FMF$PMME
       11       11        *       PURPOSE:  Provide pre- and post-processing for most file
       12       12        *         management PMMEs, plus entire processing for several
       13       13        *         miscellaneous ones.
       14       14        */
       15       15        /**/
       16       16        /**/
       17       17        /**/
       18       18        /**/
       19       19        /**/
       20       20        /*F*    NAME:   FMF$PMME
       21       21        *       PURPOSE:  Provide pre- and post-processing for most file
       22       22        *         management PMMEs.
       23       23        */
       24       24        /**/
       25       25        /**/
       26       26        /*D*    NAME:   FMF$PMME
       27       27                CALL:   CALL FMF$PMME(FPTCODE) ALTRET(LOC);
       28       28                INPUT:  FPTCODE - The PMME code (see F_FPTCODE_C)
       29       29                DESCRIPTION:  Called by UDA$PMMENT with the following
       30       30                  items processed:
       31       31                    1 - DCB number validated, B$JIT.DCB$ set up
       32       32                    2 - FPTCODE set to indicate the type of PMME.
       33       33
       34       34                    If the DCB is closed, FMM$DFLOPN is called to perform
       35       35                  a default open.  If already open and was opened by a
       36       36                  vehicle, check that this is the vehicle doing the PMME.
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:49   
       37       37                  Clear F$DCB.TYC(1) (the wait TYC).  Set F$DCB.AGE from
       38       38                  B$JIT.CALCNT to indicate that this DCB was recently
       39       39                  used.  If the file is broken (file inconsistancies), and
       40       40                  the user is trying to update the file, don't allow it
       41       41                  unless FMSEC is on, or this is a system ghost (this keeps
       42       42                  us from getting hung during boots).  We have to make
       43       43                  a special test for journals, because there is no bad
       44       44                  bit in the CFU for them.  Perform the setup necessary
       45       45                  for the specific type of PMME:
       46       46                    M$READ - Check for READ access.  If shared file,
       47       47                             ENQ for read.  Set up DCB fields UBYTES,
       48       48                             UB$ and WAIT.  If no-wait I/O, get a
       49       49                             DO-list entry and initialize it.
       50       50                    M$WRITE - Check for UPD and/or WNEW access.  See M$READ
       51       51                             for other things.
       52       52                    M$WEOF - Check for WNEW access.  If shared file, ENQ
       53       53                             for write.
       54       54                    M$DELREC - Check for DELR access.  If shared file, ENQ
       55       55                             for write.
       56       56                    M$PRECORD, M$PFIL, M$REW - Check for READ, UPD or DELR
       57       57                             access.  Allow access if M$PRECORD and KEYS=NO
       58       58                             and N=0.  If shared file, ENQ for read.
       59       59                    M$EXTEND - Check for WNEW access.  If shared file, ENQ
       60       60                             for write.
       61       61                    Everything else - Make sure there is some access, then
       62       62                             if shared file ENQ for READ.
       63       63
       64       64                  Call HFF$TRAPALT to gain trap control, so that traps
       65       65                  caused by bad parameters will return here and get a
       66       66                  better error message, as well as clean up.
       67       67
       68       68                  Call the appropriate routine to process this, based
       69       69                  on F$DCB.IFMT.  See chart at end of this description.
       70       70
       71       71                  The formatting routines return if no error occurred,
       72       72                  in which case B$JIT.ERR is cleared and the user will
       73       73                  get no error, and they ALTRET with the appropriate
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:50   
       74       74                  error code in B$JIT.ERR if an error occurred.  In
       75       75                  either case, the cleanup is the same.
       76       76
       77       77                  If the file is shared, a DEQ is done.
       78       78
       79       79                  If the PMME was wait, call the scheduler to wait for
       80       80                  all outstanding wait I/O for this DCB to complete.  If
       81       81                  B$JIT.ERR is zero, look at F$DCB.TYC(1) and if any bits
       82       82                  are set convert to error code and place in JIT.
       83       83                  If B$JIT.ERR was set and the code is a TYC type, set the
       84       84                  appropriate bit in F$DCB.TYC(1).
       85       85
       86       86                  If the PMME was no-wait and no event was requested, return
       87       87                  if B$JIT.ERR is zero or is not a TYC type error.  If it is
       88       88                  a TYC type, set the appropriate bit in F$DCB.TYC(0) and
       89       89                  return.
       90       90
       91       91                  For no-wait with event:
       92       92                    If B$JIT.ERR is zero, return if no DO-list, else move
       93       93                    DCB info to DO-list block and mark it as complete.
       94       94                    If B$JIT.ERR is not a TYC type error, release the
       95       95                    DO-list block if one exists.
       96       96                    If B$JIT.ERR is a TYC-type error, set the appropriate
       97       97                    bit in F$DCB.TYC(0) and in the DO-list block, clear
       98       98                    B$JIT.ERR, then move DCB info to DO-list and mark it
       99       99                    complete.
      100      100
      101      101                  Return to caller.
      102      102
      103      103
      104      104             The following types of DCB exist when open - -
      105      105
      106      106         IFMT    MEDIA ASN      IASN     ORG      ACS      *
      107      107         ------- ----- -------- -------- -------- -------
      108      108         CON     CON   FILE     FILE     CONSEC   SEQ/DIR  Disk file CONSEC.
      109      109         KEY     KEY   FILE     FILE     KEYED    SEQ/DIR  Disk file KEYED.
      110      110         RAN     RAN   FILE     FILE     RANDOM   SEQ/DIR  Disk file RANDOM.
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:51   
      111      111         URFILE  CON   FILE     FILE     UR       SEQ/DIR  Disk file UR.
      112      112         REL     REL   FILE     FILE     RELATIVE SEQ/DIR  Disk file RELATIVE.
      113      113         KEY     KEY   FILE     FILE     INDEXED  SEQ/DIR  Disk file INDEXED.
      114      114         RAN     RAN   FILE     FILE     IDS      SEQ/DIR  Disk file IDS.
      115      115         CON     CON   FILE     FILE     SYMBIONT SEQ/DIR  Disk file SYMBIONT, IN.
      116      116         CON     SYMB  FILE     FILE     SYMBIONT SEQ/DIR  Disk file SYMBIONT, not IN.
      117      117         RAN     RAN   FILE     FILE     any disk BLOCK    Disk file block access.
      118      118         CON     CON   FILE     FILE     CONSEC   JRNL     Disk file Journal.
      119      119         CONUBLK CON   FILE     FILE     CONSEC   UBLOCK   Disk file CONSEC,ublock.
      120      120         RAN           DEVICE   FMDIAG                     Disk pack.
      121      121         RAN           DEVICE   FILE     SYMBIONT BLOCK    Disk file EFT symbiont MOVE.
      122      122         TAPE          TAPE     TAPE      t1               Tape file not UR.
      123      123         URFILE  TAPE  TAPE     TAPE     UR                Tape file UR.
      124      124         TAPE          DEVICE   TAPE      t2               Tape device.
      125      125         NO            DEVICE   0                          Device NO.
      126      126         URSTRM        DEVICE   STREAM   UR                Device LO etc.
      127      127         TTYSTRM       DEVICE   STREAM   TERMINAL          Device LO etc.
      128      128         FPSTRM        DEVICE   STREAM   FPRG              Device LO etc.
      129      129         URDEV   DEV   DEVICE   DEVICE   UR                Local Resource LP/CP
      130      130         TTY     DEV   DEVICE   DEVICE   any               Remote Resource any
      131      131         REMOTE  DEV   any      DEVICE   any               Remote data (ISO FTAM)
      132      132         JCLOUT  CON   DEVICE   FILE     CONSEC   SEQ      Device JE/JF
      133      133         URDEV   SYMB  DEVICE   FILE     SYMBIONT SEQ      Device dd@wsn
      134      134         TTY     CG    COMGROUP COMGROUP TERMINAL          Comgroup
      135      135         FPRG    CG    COMGROUP COMGROUP FPRG              Comgroup
      136      136         TTY     UC    DEVICE   DEVICE   TERMINAL          M$UC for T/S user.
      137      137         TTY     OCCG  COMGROUP COMGROUP TERMINAL          M$UC for Console Ghost.
      138      138         FPRG    CG    COMGROUP COMGROUP FPRG              M$UC for TP user.
      139      139         NO      CON   DEVICE   FILE     CONSEC   SEQ      M$UC in Batch, CCfile open.
      140      140         NO      CON   DEVICE   0        CONSEC   SEQ      M$UC in Batch, CCfile closed
      141      141
      142      142         -       SYMB  0        FILE     SYMBIONT SEQ      "Secret" DCB for LDEV.
      143      143         NO      CON   DEVICE   FILE     CONSEC   SEQ      "Secret" DCB, online XEQ.
      144      144        ------------------------------------------------------------------------
      145      145        o  t1  --  Tape File Organizations are --
      146      146                   CONSEC, KEYED, RANDOM, RELATIVE, INDEXED, IDS,
      147      147                   RESTRICT, FIXED, VARIABLE, UNDEF
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:52   
      148      148        o  t2  --  Tape Device Organizations are --
      149      149                   FIXED, VARIABLE, UNDEF, FREE
      150      150        o  IASN  --  This field describes how some of the innards of the DCB
      151      151                      are to be interpreted - buffers, etc.
      152      152                   o  FILE means disk with buffers used for blocking and
      153      153                         described by buffer DA's.
      154      154                   o  TAPE means tape with buffers used for blocking and
      155      155                         managed by tape code.
      156      156                   o  DEVICE means if any buffers exist they are transient
      157      157                         for aligning user buffers.
      158      158                   o  COMGROUP means no buffers.
      159      159                   o  FMDIAG means no buffers.
      160      160                   o  0 means no buffers.
      161      161                   o  STREAM means this DCB has no innards, but its CFU$ points
      162      162                         to a DCB which does have innards.
      163      163        o  IASN=STREAM --  These DCB's point to other DCB's.  The MEDIA of the
      164      164                         pointed-to DCB may be --
      165      165                   o     UC or OCCG   if pointed-to DCB is interactive M$UC.
      166      166                   o     CON   if pointed-to DCB is interactive XEQ-file or
      167      167                               batch M$UC control-command.
      168      168                   o     NO   if pointed-to DCB is batch M$UC after end of
      169      169                              commands, or interactive M$UC of hung-up user.
      170      170                   o     SYMB   if pointed-to DCB is "secret" DCB for logical
      171      171                                device.
      172      172        */
      173      173        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:53   
      174      174        FMF$PMME: PROC(FPTCODE);

    174  2 000000   000000 700200 xent  FMF$PMME     TSX0  ! X66_AUTO_1
         2 000001   000114 000001                    ZERO    76,1

      175      175        /**/
      176      176        /* PARAMETERS */
      177      177        /**/
      178      178    1   DCL FPTCODE SBIN WORD;
      179      179        /**/
      180      180        /* INCLUDE FILES */
      181      181        /**/
      182      182        %INCLUDE B$JIT;
      183      785        %MACRO F$DCB(BASED=BASED);
      184      786        %INCLUDE F$DCB;
      185      835        %MEND;
      186      836        %INCLUDE B_MAGIC_C;
      187      954        %INCLUDE F$CP6V_C;
      188     1180        %INCLUDE FM$MACROS;
      189     1555        %INCLUDE FM_DATA_R;
      190     1569        %INCLUDE FM_CACHE_R;
      191     1581        %INCLUDE FM_CACHE_C;
      192     1647        %INCLUDE F_ERRORS_C;
      193     1887        %INCLUDE UD_ERRORS_C;
      194     1929        %INCLUDE F_CODE_R;
      195     1939        %INCLUDE F_FPTCODE_C;
      196     1975        %INCLUDE CP_6_SUBS;
      197     2515        %INCLUDE HF_LOCK_C;
      198     2529        %INCLUDE F_FMTCODE_C;
      199     2563        %INCLUDE SS_SCHED_C;
      200     2796        %INCLUDE B$USER;
      201     3012        %B$USERREFS;
      202     3016        %INCLUDE B_SEGIDS_C;
      203     3555        %INCLUDE B_STRINGS_C;
      204     3684        %INCLUDE UE_CP6;
      205     4375        %INCLUDE UE_ERRORS_C;
      206     4393        %INCLUDE K_DATA_R;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:54   
      207     5104        %INCLUDE KV$VDO;
      208     6119        %KV_VDOMRKTYP_E;
      209     6125        %KV_VDO_E;
      210     6161        %K$RWPARM (NAME=RWPARM);
      211     6477        %INCLUDE NK$LDCT;
      212     6579        %INCLUDE NK_LDCT_R;
      213     6588        %INCLUDE KC_CP6;
      214     7148        %INCLUDE KC$CP6V_C;
      215     7268        %INCLUDE KQ_MAC_C;
      216     9818        %INCLUDE KQ_SUBS_C;
      217    10118        %INCLUDE JG_GHOSTS_C;
      218    10208        /**/
      219    10209        /* SUBSTITUTIONS */
      220    10210        /**/
      221    10211        %SUB FCG#='0615'O;
      222    10212        %SUB MID#='06'O;
      223    10213        %SUB_EXC;
      224    10260        /**/
      225    10261        /* EXTERNAL ROUTINES */
      226    10262        /**/
      227    10263    1   DCL FAG$GEXT ENTRY ALTRET;
      228    10264    1   DCL FMG$KPMME ENTRY(1) ALTRET;
      229    10265    1   DCL FMH$CPMME ENTRY(3) ALTRET;
      230    10266    1   DCL FMH$MAPJRNL ENTRY(2);
      231    10267    1   DCL FMH$UBLOCK ENTRY(3) ALTRET;
      232    10268    1   DCL FMI$DSWRITE ENTRY(1);
      233    10269    1   DCL FMI$RAN ENTRY(1) ALTRET;
      234    10270    1   DCL FMJ$REL ENTRY(1) ALTRET;
      235    10271    1   DCL FMB$IOSPIN ENTRY;
      236    10272    1   DCL FMD$FLSHBUF ENTRY(1);
      237    10273    1   DCL FMD$WRTCACHE ENTRY(1);
      238    10274    1   DCL FMD$WRTSVNW ENTRY(1);
      239    10275    1   DCL FMD$WRTSV ENTRY(1);
      240    10276    1   DCL FMD$RELBUF ENTRY(1);
      241    10277    1   DCL FMD$DECRYPT_BUFFER ENTRY(1);
      242    10278    1   DCL FMM$DFLOPN ENTRY;
      243    10279    1   DCL FMM$SCRUB ENTRY(1);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:55   
      244    10280    1   DCL FMO$GETDOMAIN ENTRY(1);
      245    10281    1   DCL FMP$CLSJ ENTRY;
      246    10282    1   DCL FTT$TRUNC ENTRY ALTRET;
      247    10283    1   DCL FTW$WRAT ENTRY(3) ALTRET;
      248    10284    1   DCL FSD$JE ENTRY(2) ALTRET;
      249    10285    1   DCL FSE$GR ENTRY(2) ALTRET;
      250    10286    1   DCL FSE$GRSTRM ENTRY(2) ALTRET;
      251    10287    1   DCL FSE$NC ENTRY(2) ALTRET;
      252    10288    1   DCL FSE$UR ENTRY(2) ALTRET;
      253    10289    1   DCL FSE$URFILE ENTRY(2) ALTRET;
      254    10290    1   DCL FSE$URSTREAM ENTRY(2) ALTRET;
      255    10291    1   DCL FSE$TTY ENTRY(2) ALTRET;
      256    10292    1   DCL FSE$TTYSTREAM ENTRY(2) ALTRET;
      257    10293    1   DCL FSE$FPRG ENTRY(2) ALTRET;
      258    10294    1   DCL FSE$FPSTREAM ENTRY(2) ALTRET;
      259    10295    1   DCL HFC$CACHECLR ENTRY;
      260    10296    1   DCL HFF$TRAPALT ENTRY ALTRET;
      261    10297    1   DCL HFF$DSIZ ENTRY(2) ALTRET;
      262    10298    1   DCL HFF$ERASE ENTRY(1) ALTRET;
      263    10299    1   DCL HFF$NIL ENTRY(1) ALTRET;
      264    10300    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      265    10301    1   DCL KCO$EXTEND ENTRY ALTRET;
      266    10302    1   DCL KIS$OSI_TRUNC ENTRY ALTRET;
      267    10303    1   DCL KIA$COMP ENTRY(2);
      268    10304    1   DCL KIA$FCNOU ENTRY (3) ALTRET;
      269    10305    1   DCL KQC$ABTRD ENTRY(2) ALTRET;
      270    10306    1   DCL KQX$LDASR ENTRY(1);
      271    10307    1   DCL MMH$MAP_DS ENTRY(8) ALTRET;
      272    10308    1   DCL MMH$SHARE_DS ENTRY(8) ALTRET;
      273    10309    1   DCL MMH$FDS ENTRY(4)ALTRET;
      274    10310    1   DCL MMJ$FPPCHAIN ENTRY(3);
      275    10311    1   DCL NAI$WRITE ENTRY(1);
      276    10312    1   DCL SC_FMF92 ENTRY CONV(2,0);
      277    10313    1   DCL SSR$REG ENTRY(3) ALTRET;
      278    10314    1   DCL SSV$EVENT ENTRY(7);
      279    10315    1   DCL SSV$INITDO ENTRY(6);
      280    10316    1   DCL SSV$SCHDDO ENTRY(2);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:56   
      281    10317    1   DCL SSV$XXDO ENTRY(3) ALTRET;
      282    10318    1   DCL UDB$PMMEXIT1 ENTRY;
      283    10319    1   DCL UDN$MAGIC ENTRY;
      284    10320    1   DCL UQB$MENQSB ENTRY(1)ALTRET;
      285    10321    1   DCL UQB$MENQXB ENTRY(1)ALTRET;
      286    10322    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      287    10323        /**/
      288    10324        /* LOCAL AUTOMATIC STORAGE */
      289    10325        /**/
      290    10326    1   DCL JDCB$ PTR;
      291    10327    1   DCL BCDCB$ PTR;
      292    10328    1   DCL 1 BCDCB REDEF BCDCB$,
      293    10329    1         2 * BIT(24),
      294    10330    1         2 SID BIT(12);
      295    10331    1   DCL CFU$ PTR;
      296    10332    1   DCL I SBIN WORD;
      297    10333    1   DCL USR UBIN(9);
      298    10334    1   DCL CODE UBIN;
      299    10335    1   DCL EVENT UBIN;
      300    10336    1   DCL ENTFLG UBIN;
      301    10337    1   DCL CG$ PTR;
      302    10338    1   DCL STA$ PTR;
      303    10339    1   DCL LDCT$ PTR;
      304    10340        %B$JRNLERR (NAME=JRNLECCI,STCLASS="",PARONLY=1);
      305    10348        /**/
      306    10349        /* EXTERNAL DATA */
      307    10350        /**/
      308    10351        /* EXTERNAL DATA */
      309    10352        /**/
      310    10353    1   DCL B$JIT$ PTR SYMREF READONLY;
      311    10354    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      312    10355    1   DCL B$PS0$ PTR SYMREF READONLY;
      313    10356    1   DCL B$PS1$ PTR SYMREF READONLY;
      314    10357    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      315    10358    1   DCL B$PS2$ PTR SYMREF READONLY;
      316    10359    1   DCL B$IS$ PTR SYMREF;
      317    10360    1   DCL LS0UBIN REDEF B$IS$ UBIN;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:57   
      318    10361    1   DCL B$PPUT$ PTR SYMREF;
      319    10362        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
      320    10455    1   DCL MM_SHAREDSUSE SBIN SYMREF;
      321    10456    1   DCL S_ASFGATE UBIN SYMREF;
      322    10457    1   DCL S_UDLGATE SBIN SYMREF;
      323    10458    1   DCL S_CUN SBIN SYMREF;
      324    10459        /**/
      325    10460        /* BASED STRUCTURES */
      326    10461        /**/
      327    10462        %KQ_STA (FPTN=KQ$STA,STCLASS=BASED);
      328    10801    1   DCL 1 BITS ALIGNED BASED,
      329    10802    1         2 B(0:35) BIT(1) UNAL;
      330    10803    1   DCL CHARS CHAR(I) BASED;
      331    10804    1   DCL 1 MM$PPUT(0:0) BASED(B$PPUT$) ALIGNED,
      332    10805    1         2 * BIT(18),
      333    10806    1         2 PPNO UBIN HALF UNAL;
      334    10807        /**/
      335    10808        /* CONSTANT STORAGE */
      336    10809        /**/
      337    10810        %ERRCODE (NAME=ERRREAD,COD#=%E$READ);
      338    10814        %ERRCODE (NAME=ERRWRITE,COD#=%E$WRITE);
      339    10818        %ERRCODE (NAME=ERRDELREC,COD#=%E$DELREC);
      340    10822        %ERRCODE (NAME=ERRPOS,COD#=%E$POS);
      341    10826        %ERRCODE (NAME=ERREXTEND,COD#=%E$EXTEND);
      342    10830        %ERRCODE (NAME=ERRDOMAIN,COD#=%E$DOMAIN);
      343    10834        %ERRCODE (NAME=ERRJRNL,COD#=%E$JRNLCLSD);
      344    10838        %ERRCODE (NAME=ERRDMY,COD#=0);
      345    10842        %ERRCODE (NAME=ERREOF,COD#=%E$EOF);
      346    10846        %ERRCODE (NAME=ERRMTRAP,COD#=%E$MTRAP);
      347    10850        %ERRCODE (NAME=ERRPMMEINT,COD#=%E$PMMEINT);
      348    10854        %ERRCODE (NAME=ERRSHRDS2BIG,COD#=%E$SHRDS2BIG);
      349    10858        %ERRCODE (NAME=ERRNOEVENT,COD#=%E$NOEVENT);
      350    10862        %ERRCODE (NAME=ERRBROKEN, COD#=%E$BROKEN);
      351    10866        %ERRCODE (NAME=ERRNOACCT,MID#="'16'O",COD#=%E$NOKEY);
      352    10870        %ERRCODE (NAME=ERRINVVFC,COD#=%E$INVVFC);
      353    10874        %ERRCODE (NAME=ERRNOCODE,COD#=0);
      354    10878        %ERRCODE (NAME=ERREOD,COD#=%E$EOD);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:58   
      355    10882    1   DCL 1 ERRDMYFMI CONSTANT,
      356    10883    1         2 * BIT(12) INIT('0615'O),
      357    10884    1         2 * BIT(6) INIT('11'O),
      358    10885    1         2 * BIT(18) INIT('0'B);
      359    10886    1   DCL USRJRNERR(0:19) UBIN(9) UNAL CONSTANT INIT (
      360    10887        /* Errors caused by the program, not to be reported to the journal owner */
      361    10888    1   %E$LD, %E$MTRAP, %E$CDALRT, %E$BOF, %E$EOF, %E$NOCONT, %E$USGRANS,
      362    10889    1   %E$BADVECT0, %E$BADVECT1, %E$BADVECT2, %E$BADVECT3, %E$BADVECT4,
      363    10890    1   %E$BADVECT5, %E$BADVECT6, %E$BADVECT7, %E$BADVECT8, %E$BADVECT9,
      364    10891    1   %E$NOEVENT, 0*0);
      365    10892    1   DCL USRJRNERRS REDEF USRJRNERR CHAR(20);
      366    10893    1   DCL USRTJNERR(0:7) UBIN(9) UNAL CONSTANT INIT (
      367    10894        /* Same thing, but tape errors, which don't fit in a byte. */
      368    10895    1   %(E$NOTJRNLOWNER-512), %(E$CANTTRANSLATE-512), %(E$NOFPOOL-512),
      369    10896    1   %(E$SMALLRECL-512), 0*0);
      370    10897    1   DCL USRTJNERRS REDEF USRTJNERR CHAR(8);
      371    10898        /**/
      372    10899        /* BASED STRUCTURES */
      373    10900        /**/
      374    10901        %B$ECCBI;
      375    10904        %F$DCB (BASED="BASED(JDCB$)");
      376    10954        %FM$CFU (BASED="BASED(CFU$)");
      377    10960        %FM$CFUJ (BASED="BASED(CFU$)");
      378    10965        %FM$CFUR (BASED="BASED(CFU$)");
      379    10968        %FPT$READ_V (BASED="BASED(B$PS0$)");
      380    10975        %FPT$WRITE_V (BASED="BASED(B$PS0$)");
      381    10981        %FPT$PRECORD_V (BASED="BASED(B$PS0$)");
      382    10986        %FPT$EXTEND_V (BASED="BASED(B$PS0$)");
      383    10989        %NK$LDCT;
      384    11035        %KQ_CG (FPTN=KQ$CG,STCLASS=BASED);
      385    11774        %FMC$CACHE(ARRAY=YES);
      386    11797        %SET LISTSUB='1'B;
      387    11798        %SET LISTMAC='1'B;
      388    11799        /**/
      389    11800    1           JDCB$=B$JIT.DCB$;               /* POINTER TO CURRENT DCB             */

  11800  2 000002   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:59   
         2 000003   000232 236100                    LDQ     154,,PR0
         2 000004   200054 756100                    STQ     JDCB$,,AUTO

      390    11801    1           BCDCB$=JDCB$;

  11801  2 000005   200055 756100                    STQ     BCDCB$,,AUTO

      391    11802    1           BCDCB.SID=%RONCSID;             /* BYPASS CACHE POINTER               */

  11802  2 000006   006124 236007                    LDQ     3156,DL
         2 000007   200055 752103                    STCQ    BCDCB$,'03'O,AUTO

      392    11803    2           IF NOT F$DCB.FCD THEN DO;       /* MUST DO IMPLICIT OPEN              */

  11803  2 000010   200054 471500                    LDP1    JDCB$,,AUTO
         2 000011   100031 236100                    LDQ     25,,PR1
         2 000012   020000 316007                    CANQ    8192,DL
         2 000013   000047 601000 2                  TNZ     s:11813

      393    11804    2              IF F$DCB.FUN=0 THEN

  11804  2 000014   100032 236100                    LDQ     26,,PR1
         2 000015   000777 316003                    CANQ    511,DU
         2 000016   000025 601000 2                  TNZ     s:11807

      394    11805    2                 IF FPTCODE=1 /* FPTWRITE */ THEN

  11805  2 000017   200003 473500                    LDP3    @FPTCODE,,AUTO
         2 000020   300000 235100                    LDA     0,,PR3
         2 000021   000001 115007                    CMPA    1,DL
         2 000022   000025 601000 2                  TNZ     s:11807

      395    11806    2                    F$DCB.FUN=%CREATE#;

  11806  2 000023   000003 236003                    LDQ     3,DU
         2 000024   100032 552120                    STBQ    26,'20'O,PR1

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:60   
      396    11807    2              CALL FMO$GETDOMAIN(I);

  11807  2 000025   200057 633500                    EPPR3   I,,AUTO
         2 000026   200102 453500                    STP3    TYPE+1,,AUTO
         2 000027   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000030   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000031   000000 701000 xent               TSX1    FMO$GETDOMAIN
         2 000032   000000 011000                    NOP     0

      397    11808    2              F$DCB.WSR=I;                 /* Set current domain                 */

  11808  2 000033   200054 470500                    LDP0    JDCB$,,AUTO
         2 000034   200057 236100                    LDQ     I,,AUTO
         2 000035   000022 736000                    QLS     18
         2 000036   000040 552120                    STBQ    32,'20'O,PR0

      398    11809    2              CALL FMM$DFLOPN;

  11809  2 000037   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000040   000000 701000 xent               TSX1    FMM$DFLOPN
         2 000041   000000 011000                    NOP     0

      399    11810    2              IF NOT(F$DCB.FCD) THEN RETURN;

  11810  2 000042   200054 470500                    LDP0    JDCB$,,AUTO
         2 000043   000031 236100                    LDQ     25,,PR0
         2 000044   020000 316007                    CANQ    8192,DL
         2 000045   000072 601000 2                  TNZ     s:11826

  11810  2 000046   000000 702200 xent               TSX2  ! X66_ARET

      400    11811    2              END;
      401    11812    1           ELSE
      402    11813    2              IF F$DCB.FFLG.EXEC THEN DO;  /* EXECUTE ONLY                       */

  11813  2 000047   100004 236100                    LDQ     4,,PR1
         2 000050   002000 316003                    CANQ    1024,DU
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:61   
         2 000051   000072 600000 2                  TZE     s:11826

      403    11814    2                 CALL FMO$GETDOMAIN(I);

  11814  2 000052   200057 633500                    EPPR3   I,,AUTO
         2 000053   200102 453500                    STP3    TYPE+1,,AUTO
         2 000054   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000055   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000056   000000 701000 xent               TSX1    FMO$GETDOMAIN
         2 000057   000000 011000                    NOP     0

      404    11815    3                 IF F$DCB.WSR~=I THEN DO;

  11815  2 000060   200054 470500                    LDP0    JDCB$,,AUTO
         2 000061   000040 236100                    LDQ     32,,PR0
         2 000062   000022 772000                    QRL     18
         2 000063   000777 376007                    ANQ     511,DL
         2 000064   200057 116100                    CMPQ    I,,AUTO
         2 000065   000072 600000 2                  TZE     s:11826

      405    11816    3                    B$JIT.ERR=ERRDOMAIN;

  11816  2 000066   000005 236000 0                  LDQ     ERRDOMAIN
         2 000067   000000 471400 xsym               LDP1    B$JIT$
         2 000070   100012 756100                    STQ     10,,PR1

      406    11817    3                    GOTO ERRXIT;

  11817  2 000071   001031 710000 2                  TRA     ERRXIT

      407    11818    3                    END;
      408    11819    2                 END;
      409    11820        /*E*   ERROR:  FMF-E$DOMAIN-2
      410    11821        *       MESSAGE: DCB %%DC %opened by another domain
      411    11822        *      DESCRIPTION:  This DCB, connected to an execute-only file,
      412    11823        *        was opened by another domain and may not be accessed from
      413    11824        *        this domain.
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:62   
      414    11825        */
      415    11826    1           F$DCB.TYC(1)='0'B;              /* CLEAR WAIT TYC                     */

  11826  2 000072   200054 470500                    LDP0    JDCB$,,AUTO
         2 000073   000002 450100                    STZ     2,,PR0

      416    11827        /**/
      417    11828    1           F$DCB.AGE=B$JIT.CALCNT;

  11828  2 000074   000000 471400 xsym               LDP1    B$JIT$
         2 000075   100267 235100                    LDA     183,,PR1
         2 000076   000114 755100                    STA     76,,PR0

      418    11829        /**/
      419    11830    2           DO CASE(FPTCODE);

  11830  2 000077   200003 473500                    LDP3    @FPTCODE,,AUTO
         2 000100   300000 235100                    LDA     0,,PR3
         2 000101   000010 115007                    CMPA    8,DL
         2 000102   000104 602005 2                  TNC     s:11830+5,AL
         2 000103   000477 710000 2                  TRA     s:11971
         2 000104   000114 710000 2                  TRA     s:11832
         2 000105   000275 710000 2                  TRA     s:11893
         2 000106   000336 710000 2                  TRA     s:11914
         2 000107   000377 710000 2                  TRA     s:11934
         2 000110   000377 710000 2                  TRA     s:11934
         2 000111   000446 710000 2                  TRA     s:11957
         2 000112   000377 710000 2                  TRA     s:11934
         2 000113   000317 710000 2                  TRA     s:11906

      420    11831    2            CASE(0 /* FPTREAD */);             /* M$READ                            */

      421    11832    2              F$DCB.ARS=0;

  11832  2 000114   000000 450100                    STZ     0,,PR0

      422    11833    2              IF NOT(F$DCB.FFLG.READ)
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:63   

  11833  2 000115   000004 234100                    SZN     4,,PR0
         2 000116   000123 604000 2                  TMI     s:11843

      423    11834    2              THEN                         /* NOT ALLOWED TO READ                */
      424    11835    3              DO;

      425    11836    3   NOREAD:       B$JIT.ERR=ERRREAD;

  11836  2 000117   000000 236000 0     NOREAD       LDQ     ERRREAD
         2 000120   000000 470400 xsym               LDP0    B$JIT$
         2 000121   000012 756100                    STQ     10,,PR0

      426    11837    3                 GOTO ERRXIT;

  11837  2 000122   001031 710000 2                  TRA     ERRXIT

      427    11838    3                 END;
      428    11839        /*E*   ERROR:  FMF-E$READ-2
      429    11840        *       MESSAGE: You are not allowed to read% from %UF%
      430    11841        */
      431    11842        /**/
      432    11843    2              IF F$DCB.SHARED THEN

  11843  2 000123   000064 236100                    LDQ     52,,PR0
         2 000124   100000 316003                    CANQ    32768,DU
         2 000125   000130 600000 2                  TZE     RDWRT

      433    11844    2                 CALL ENQRD ALTRET(ERRDEQ);

  11844  2 000126   003250 701000 2                  TSX1    ENQRD
         2 000127   001027 702000 2                  TSX2    ERRDEQ

      434    11845    3   RDWRT:     CALL HFF$DSIZ(B$PS2$,F$DCB.UBYTES) WHENRETURN DO; /* # BYTES TO XFER */

  11845  2 000130   200054 236100       RDWRT        LDQ     JDCB$,,AUTO
         2 000131   000076 036003                    ADLQ    62,DU
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:64   
         2 000132   000000 235000 3                  LDA     0
         2 000133   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000134   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000135   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000136   000000 701000 xent               TSX1    HFF$DSIZ
         2 000137   000161 702000 2                  TSX2    s:11858

      435    11846    3                 F$DCB.UB$=B$PS2$;         /* POINTER TO USER BUFFER             */

  11846  2 000140   000000 236000 xsym               LDQ     B$PS2$
         2 000141   200054 470500                    LDP0    JDCB$,,AUTO
         2 000142   000075 756100                    STQ     61,,PR0

      436    11847    3                 IF (FPTCODE = 1 /* FPTWRITE */) AND

  11847  2 000143   200003 471500                    LDP1    @FPTCODE,,AUTO
         2 000144   100000 235100                    LDA     0,,PR1
         2 000145   000001 115007                    CMPA    1,DL
         2 000146   000160 601000 2                  TNZ     s:11851+1
         2 000147   000076 235100                    LDA     62,,PR0
         2 000150   000160 601000 2                  TNZ     s:11851+1
         2 000151   000003 236100                    LDQ     3,,PR0
         2 000152   100000 316003                    CANQ    32768,DU
         2 000153   000160 600000 2                  TZE     s:11851+1

      437    11848    3                   (F$DCB.UBYTES=0) AND (F$DCB.DVBYTE.VFC)
      438    11849    4                 THEN DO;

      439    11850    4                    B$JIT.ERR = ERRINVVFC;

  11850  2 000154   000017 236000 0                  LDQ     ERRINVVFC
         2 000155   000000 473400 xsym               LDP3    B$JIT$
         2 000156   300012 756100                    STQ     10,,PR3

      440    11851    4                    GOTO ERROR;

  11851  2 000157   001034 710000 2                  TRA     ERROR
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:65   
         2 000160   000164 710000 2                  TRA     s:11860

      441    11852    4                    END;
      442    11853        /*E*    ERROR:   FMF-E$INVVFC-2
      443    11854                MESSAGE: The WRITE has VFC=YES but BUF is NIL
      444    11855         */
      445    11856    3                 END;
      446    11857    3              WHENALTRETURN DO;

      447    11858    3                 F$DCB.UB$=ADDR(B$JIT$);   /* ANY HANDY CONSTANT                 */

  11858  2 000161   000001 236000 3                  LDQ     1
         2 000162   200054 470500                    LDP0    JDCB$,,AUTO
         2 000163   000075 756100                    STQ     61,,PR0

      448    11859    3                 END;

      449    11860    2              F$DCB.WAIT=BITBIN(FPT$READ_V.WAIT);

  11860  2 000164   000000 471400 xsym               LDP1    B$PS0$
         2 000165   100000 236100                    LDQ     0,,PR1
         2 000166   000021 772000                    QRL     17
         2 000167   000001 376007                    ANQ     1,DL
         2 000170   000004 736000                    QLS     4
         2 000171   000064 676100                    ERQ     52,,PR0
         2 000172   000020 376007                    ANQ     16,DL
         2 000173   000064 656100                    ERSQ    52,,PR0

      450    11861    3              IF F$DCB.WAIT=0 THEN DO;     /* NO-WAIT                            */

  11861  2 000174   000064 236100                    LDQ     52,,PR0
         2 000175   000020 316007                    CANQ    16,DL
         2 000176   000510 601000 2                  TNZ     VEC

      451    11862                      %LOCK (G#=F_DCBLOCK);
             11863    3   CALL HFC$LOCK(F_DCBLOCK);

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:66   
  11863  2 000177   000002 630400 3                  EPPR0   2
         2 000200   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000201   000000 701000 xent               TSX1    HFC$LOCK
         2 000202   000000 011000                    NOP     0

      452    11865    3                 IF NOT(BCDCB$->F$DCB.TYC.EGV(0)) THEN

  11865  2 000203   200055 470500                    LDP0    BCDCB$,,AUTO
         2 000204   000001 234100                    SZN     1,,PR0
         2 000205   000207 604000 2                  TMI     s:11868

      453    11866    3                    BCDCB$->F$DCB.TYC(0)='0'B;

  11866  2 000206   000001 450100                    STZ     1,,PR0

      454    11867                      %UNLOCK (G#=F_DCBLOCK);
             11868    3   CALL HFC$UNLOCK(F_DCBLOCK);

  11868  2 000207   000002 630400 3                  EPPR0   2
         2 000210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000211   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000212   000000 011000                    NOP     0

      455    11870    3                 EVENT=FPT$READ_V.EVENT;

  11870  2 000213   000000 470400 xsym               LDP0    B$PS0$
         2 000214   000001 235100                    LDA     1,,PR0
         2 000215   200062 755100                    STA     EVENT,,AUTO

      456    11871    4                 IF EVENT~=0 THEN DO;

  11871  2 000216   000510 600000 2                  TZE     VEC

      457    11872    4                    CALL UDN$MAGIC;        /* Get ptr to ECCB                    */

  11872  2 000217   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000220   000000 701000 xent               TSX1    UDN$MAGIC
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:67   
         2 000221   000000 011000                    NOP     0

      458    11873    5                    IF NOT B_MPT.ECCB$->B$ECCBI.FLAGS(%ECC_EVENT#) THEN DO;

  11873  2 000222   000005 470400 xsym               LDP0    B_MPT+5
         2 000223   000004 236100                    LDQ     4,,PR0
         2 000224   200000 316003                    CANQ    65536,DU
         2 000225   000232 601000 2                  TNZ     s:11882

      459    11874    5                       B$JIT.ERR=ERRNOEVENT;

  11874  2 000226   000014 236000 0                  LDQ     ERRNOEVENT
         2 000227   000000 471400 xsym               LDP1    B$JIT$
         2 000230   100012 756100                    STQ     10,,PR1

      460    11875    5                       GOTO ERROR;

  11875  2 000231   001034 710000 2                  TRA     ERROR

      461    11876    5                       END;
      462    11877        /*E*  ERROR: FMF-E$NOEVENT-2
      463    11878              MESSAGE: No event handler specified
      464    11879              MESSAGE1: You can't read or write no-wait with an event without
      465    11880                        an event handler defined
      466    11881        */
      467    11882    5                    IF F$DCB.ASN=%FILE# THEN DO;

  11882  2 000232   200054 471500                    LDP1    JDCB$,,AUTO
         2 000233   100032 236100                    LDQ     26,,PR1
         2 000234   777000 376007                    ANQ     -512,DL
         2 000235   001000 116007                    CMPQ    512,DL
         2 000236   000510 601000 2                  TNZ     VEC

      468    11883    5                       CALL FMO$GETDOMAIN(I);

  11883  2 000237   200057 633500                    EPPR3   I,,AUTO
         2 000240   200102 453500                    STP3    TYPE+1,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:68   
         2 000241   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000242   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000243   000000 701000 xent               TSX1    FMO$GETDOMAIN
         2 000244   000000 011000                    NOP     0

      469    11884    5                       CALL SSV$INITDO(B$JIT.DO$,I,%SUBC_IO#,FPT$READ_V.EVENT,

  11884  2 000245   000004 237000 3                  LDAQ    4
         2 000246   200106 757100                    STAQ    TYPE+5,,AUTO
         2 000247   000000 236000 xsym               LDQ     B$PS0$
         2 000250   000001 036003                    ADLQ    1,DU
         2 000251   000006 235000 3                  LDA     6
         2 000252   200104 757100                    STAQ    TYPE+3,,AUTO
         2 000253   200057 630500                    EPPR0   I,,AUTO
         2 000254   200103 450500                    STP0    TYPE+2,,AUTO
         2 000255   000000 236000 xsym               LDQ     B$JIT$
         2 000256   000233 036003                    ADLQ    155,DU
         2 000257   200102 756100                    STQ     TYPE+1,,AUTO
         2 000260   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000261   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 000262   000000 701000 xent               TSX1    SSV$INITDO
         2 000263   000000 011000                    NOP     0

      470    11885    5                         ENTADDR(NIL),3);
      471    11886    5                       B$JIT.DO$->B$DO.IOCOMP='0'B;

  11886  2 000264   000000 470400 xsym               LDP0    B$JIT$
         2 000265   000233 471500                    LDP1    155,,PR0
         2 000266   000100 100400                    MLR     fill='000'O
         2 000267   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000270   100006 000024                    ADSC9   6,,PR1                   cn=0,n=20

      472    11887    5                       B$JIT.DO$->B$DO.IOCOMP.CNTR=1;

  11887  2 000271   000233 471500                    LDP1    155,,PR0
         2 000272   000001 235007                    LDA     1,DL
         2 000273   100011 755100                    STA     9,,PR1
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:69   

      473    11888    5                       END;

      474    11889    4                    END;

      475    11890    3                 END;

  11890  2 000274   000510 710000 2                  TRA     VEC

      476    11891        /**/
      477    11892    2            CASE(1 /* FPTWRITE */);            /* M$WRITE                           */

      478    11893    3              IF NOT(F$DCB.FFLG.UPD) AND NOT(F$DCB.FFLG.WNEW) THEN DO;

  11893  2 000275   000004 236100                    LDQ     4,,PR0
         2 000276   040000 316003                    CANQ    16384,DU
         2 000277   000306 601000 2                  TNZ     s:11900
         2 000300   100000 316003                    CANQ    32768,DU
         2 000301   000306 601000 2                  TNZ     s:11900

      479    11894    3   ERRWR:        B$JIT.ERR=ERRWRITE;

  11894  2 000302   000001 236000 0     ERRWR        LDQ     ERRWRITE
         2 000303   000000 470400 xsym               LDP0    B$JIT$
         2 000304   000012 756100                    STQ     10,,PR0

      480    11895    3                 GOTO ERRXIT;

  11895  2 000305   001031 710000 2                  TRA     ERRXIT

      481    11896    3                 END;
      482    11897        /*E*   ERROR:  FMF-E$WRITE-2
      483    11898        *       MESSAGE: You are not allowed to write% to %UF%
      484    11899        */
      485    11900    2              CALL CHKBAD ALTRET(ERRXIT);

  11900  2 000306   004024 701000 2                  TSX1    CHKBAD
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:70   
         2 000307   001031 702000 2                  TSX2    ERRXIT

      486    11901    2              IF F$DCB.SHARED THEN

  11901  2 000310   200054 470500                    LDP0    JDCB$,,AUTO
         2 000311   000064 236100                    LDQ     52,,PR0
         2 000312   100000 316003                    CANQ    32768,DU
         2 000313   000316 600000 2                  TZE     s:11903

      487    11902    2                 CALL ENQWR ALTRET(ERRDEQ);

  11902  2 000314   003253 701000 2                  TSX1    ENQWR
         2 000315   001027 702000 2                  TSX2    ERRDEQ

      488    11903    2              GOTO RDWRT;

  11903  2 000316   000130 710000 2                  TRA     RDWRT

      489    11904        /**/
      490    11905    2            CASE(7 /* FPTWEOF */);             /* M$WEOF                            */

      491    11906    2              F$DCB.WAIT=1;

  11906  2 000317   000020 236007                    LDQ     16,DL
         2 000320   000064 256100                    ORSQ    52,,PR0

      492    11907    2              IF NOT(F$DCB.FFLG.WNEW) THEN GOTO ERRWR;

  11907  2 000321   000004 236100                    LDQ     4,,PR0
         2 000322   100000 316003                    CANQ    32768,DU
         2 000323   000302 600000 2                  TZE     ERRWR

      493    11908    2              CALL CHKBAD ALTRET(ERRXIT);

  11908  2 000324   004024 701000 2                  TSX1    CHKBAD
         2 000325   001031 702000 2                  TSX2    ERRXIT

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:71   
      494    11909    2              F$DCB.UBYTES=0;

  11909  2 000326   200054 470500                    LDP0    JDCB$,,AUTO
         2 000327   000076 450100                    STZ     62,,PR0

      495    11910    2              IF F$DCB.SHARED THEN

  11910  2 000330   000064 236100                    LDQ     52,,PR0
         2 000331   100000 316003                    CANQ    32768,DU
         2 000332   000510 600000 2                  TZE     VEC

      496    11911    2                 CALL ENQWR ALTRET(ERRDEQ);

  11911  2 000333   003253 701000 2                  TSX1    ENQWR
         2 000334   001027 702000 2                  TSX2    ERRDEQ
         2 000335   000510 710000 2                  TRA     VEC

      497    11912                                                /*                                    */
      498    11913    2            CASE(2 /* FPTDELREC */);           /* M$DELREC                          */

      499    11914    2              F$DCB.WAIT=1;

  11914  2 000336   000020 236007                    LDQ     16,DL
         2 000337   000064 256100                    ORSQ    52,,PR0

      500    11915    2              IF NOT(F$DCB.FFLG.DELR)

  11915  2 000340   000004 236100                    LDQ     4,,PR0
         2 000341   200000 316003                    CANQ    65536,DU
         2 000342   000346 601000 2                  TNZ     s:11924

      501    11916    2              THEN
      502    11917    3              DO;

      503    11918    3                 B$JIT.ERR=ERRDELREC;

  11918  2 000343   000002 236000 0                  LDQ     ERRDELREC
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:72   
         2 000344   100012 756100                    STQ     10,,PR1

      504    11919    3                 GOTO ERRXIT;

  11919  2 000345   001031 710000 2                  TRA     ERRXIT

      505    11920    3                 END;
      506    11921        /*E*   ERROR:  FMF-E$DELREC-2
      507    11922        *       MESSAGE: You are not allowed to delete records% from %UF%
      508    11923        */
      509    11924    2              CALL CHKBAD ALTRET(ERRXIT);

  11924  2 000346   004024 701000 2                  TSX1    CHKBAD
         2 000347   001031 702000 2                  TSX2    ERRXIT

      510    11925    3              IF F$DCB.ASN=%DEVICE# THEN DO;

  11925  2 000350   200054 470500                    LDP0    JDCB$,,AUTO
         2 000351   000032 236100                    LDQ     26,,PR0
         2 000352   777000 376007                    ANQ     -512,DL
         2 000353   003000 116007                    CMPQ    1536,DL
         2 000354   000370 601000 2                  TNZ     s:11930

      511    11926    4                 CALL HFF$DSIZ(B$PS2$,F$DCB.UBYTES) WHENRETURN DO;

  11926  2 000355   200054 236100                    LDQ     JDCB$,,AUTO
         2 000356   000076 036003                    ADLQ    62,DU
         2 000357   000000 235000 3                  LDA     0
         2 000360   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000361   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000362   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000363   000000 701000 xent               TSX1    HFF$DSIZ
         2 000364   000370 702000 2                  TSX2    s:11930

      512    11927    4                    F$DCB.UB$=B$PS2$;

  11927  2 000365   000000 236000 xsym               LDQ     B$PS2$
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:73   
         2 000366   200054 470500                    LDP0    JDCB$,,AUTO
         2 000367   000075 756100                    STQ     61,,PR0

      513    11928    4                    END;

      514    11929    3                 END;

      515    11930    2              IF F$DCB.SHARED THEN

  11930  2 000370   200054 470500                    LDP0    JDCB$,,AUTO
         2 000371   000064 236100                    LDQ     52,,PR0
         2 000372   100000 316003                    CANQ    32768,DU
         2 000373   000510 600000 2                  TZE     VEC

      516    11931    2                 CALL ENQWR ALTRET(ERRDEQ);

  11931  2 000374   003253 701000 2                  TSX1    ENQWR
         2 000375   001027 702000 2                  TSX2    ERRDEQ
         2 000376   000510 710000 2                  TRA     VEC

      517    11932        /**/
      518    11933    2            CASE(3 /* FPTPREC */,4 /* FPTPFIL */,6 /* FPTREW */);
             11933                     /* M$PRECORD, M$PFIL AND M$REW        */

      519    11934    2              F$DCB.WAIT=1;

  11934  2 000377   000020 236007                    LDQ     16,DL
         2 000400   000064 256100                    ORSQ    52,,PR0

      520    11935    2              IF F$DCB.IASN = %OD# THEN

  11935  2 000401   000103 236100                    LDQ     67,,PR0
         2 000402   000777 376007                    ANQ     511,DL
         2 000403   000012 116007                    CMPQ    10,DL
         2 000404   000435 600000 2                  TZE     PREC_ERR

      521    11936    2                 GOTO PREC_ERR;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:74   
      522    11937    2              IF (NOT F$DCB.FFLG.READ) AND (NOT F$DCB.FFLG.UPD) AND

  11937  2 000405   000004 234100                    SZN     4,,PR0
         2 000406   000440 604000 2                  TMI     PRECOK
         2 000407   000004 236100                    LDQ     4,,PR0
         2 000410   040000 316003                    CANQ    16384,DU
         2 000411   000440 601000 2                  TNZ     PRECOK
         2 000412   200000 316003                    CANQ    65536,DU
         2 000413   000440 601000 2                  TNZ     PRECOK

      523    11938    3                (NOT F$DCB.FFLG.DELR) THEN DO;

      524    11939    4                 IF FPTCODE=3 /* FPTPREC */ THEN DO;

  11939  2 000414   300000 235100                    LDA     0,,PR3
         2 000415   000003 115007                    CMPA    3,DL
         2 000416   000435 601000 2                  TNZ     PREC_ERR

      525    11940    4                    IF FPT$PRECORD_V.BOF OR FPT$PRECORD_V.EOF THEN

  11940  2 000417   000000 474400 xsym               LDP4    B$PS0$
         2 000420   400000 236100                    LDQ     0,,PR4
         2 000421   020000 316007                    CANQ    8192,DL
         2 000422   000435 601000 2                  TNZ     PREC_ERR
         2 000423   010000 316007                    CANQ    4096,DL
         2 000424   000435 601000 2                  TNZ     PREC_ERR

      526    11941    4                       GOTO PREC_ERR;      /* Not allowed to PFIL                */
      527    11942    4                    IF F$DCB.FFLG THEN

  11942  2 000425   000004 220100                    LDX0    4,,PR0
         2 000426   000435 600000 2                  TZE     PREC_ERR

      528    11943    4                       IF (NOT FPT$PRECORD_V.KEYS) AND FPT$PRECORD_V.N=0 AND

  11943  2 000427   400000 316007                    CANQ    -131072,DL
         2 000430   000435 601000 2                  TNZ     PREC_ERR
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:75   
         2 000431   400001 235100                    LDA     1,,PR4
         2 000432   000435 601000 2                  TNZ     PREC_ERR
         2 000433   200000 316007                    CANQ    65536,DL
         2 000434   000440 600000 2                  TZE     PRECOK

      529    11944    4                         (NOT FPT$PRECORD_V.KEYR) THEN
      530    11945    4                          GOTO PRECOK;
      531    11946    4                    END;                   /* IF FPTCODE=FPTPREC                 */

      532    11947    3   PREC_ERR:     B$JIT.ERR=ERRPOS;

  11947  2 000435   000003 236000 0     PREC_ERR     LDQ     ERRPOS
         2 000436   100012 756100                    STQ     10,,PR1

      533    11948    3                 GOTO ERRXIT;

  11948  2 000437   001031 710000 2                  TRA     ERRXIT

      534    11949    3                 END;
      535    11950        /*E*   ERROR:  FMF-E$POS-2
      536    11951        *       MESSAGE: You are not allowed to position% in %UF%
      537    11952        */
      538    11953    2   PRECOK:    IF F$DCB.SHARED THEN

  11953  2 000440   000064 236100       PRECOK       LDQ     52,,PR0
         2 000441   100000 316003                    CANQ    32768,DU
         2 000442   000510 600000 2                  TZE     VEC

      539    11954    2                 CALL ENQRD ALTRET(ERRDEQ);

  11954  2 000443   003250 701000 2                  TSX1    ENQRD
         2 000444   001027 702000 2                  TSX2    ERRDEQ
         2 000445   000510 710000 2                  TRA     VEC

      540    11955        /**/
      541    11956    2            CASE(5 /* FPTEXTEND */);           /* M$EXTEND                          */

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:76   
      542    11957    2              F$DCB.WAIT=1;

  11957  2 000446   000020 236007                    LDQ     16,DL
         2 000447   000064 256100                    ORSQ    52,,PR0

      543    11958    2              IF (NOT F$DCB.FFLG.WNEW AND FPT$EXTEND_V.SIZ~=0)

  11958  2 000450   000004 236100                    LDQ     4,,PR0
         2 000451   100000 316003                    CANQ    32768,DU
         2 000452   000456 601000 2                  TNZ     s:11958+6
         2 000453   000000 474400 xsym               LDP4    B$PS0$
         2 000454   400000 720100                    LXL0    0,,PR4
         2 000455   000471 601000 2                  TNZ     s:11961
         2 000456   000103 236100                    LDQ     67,,PR0
         2 000457   000777 376007                    ANQ     511,DL
         2 000460   000012 116007                    CMPQ    10,DL
         2 000461   000471 600000 2                  TZE     s:11961
         2 000462   000032 236100                    LDQ     26,,PR0
         2 000463   777000 376007                    ANQ     -512,DL
         2 000464   004000 116007                    CMPQ    2048,DL
         2 000465   000474 601000 2                  TNZ     s:11967
         2 000466   000031 236100                    LDQ     25,,PR0
         2 000467   200000 316003                    CANQ    65536,DU
         2 000470   000474 601000 2                  TNZ     s:11967

      544    11959    2                OR (F$DCB.IASN = %OD#)
      545    11960    3                OR (F$DCB.ASN=%COMGROUP# AND NOT F$DCB.AU) THEN DO;

      546    11961    3                 B$JIT.ERR=ERREXTEND;

  11961  2 000471   000004 236000 0                  LDQ     ERREXTEND
         2 000472   100012 756100                    STQ     10,,PR1

      547    11962    3                 GOTO ERRXIT;

  11962  2 000473   001031 710000 2                  TRA     ERRXIT

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:77   
      548    11963    3                 END;
      549    11964        /*E*   ERROR:  FMF-E$EXTEND-2
      550    11965        *       MESSAGE: You are not allowed to extend %UF
      551    11966        */
      552    11967    2              CALL EXTEND ALTRET(ERRDEQ);

  11967  2 000474   001730 701000 2                  TSX1    EXTEND
         2 000475   001027 702000 2                  TSX2    ERRDEQ

      553    11968    2              GOTO DONE;

  11968  2 000476   001032 710000 2                  TRA     DONE

      554    11969        /**/
      555    11970    2            CASE(ELSE);                    /* EVERYTHING ELSE                    */

      556    11971    2              F$DCB.WAIT=1;

  11971  2 000477   000020 236007                    LDQ     16,DL
         2 000500   000064 256100                    ORSQ    52,,PR0

      557    11972    2              IF NOT F$DCB.FFLG THEN

  11972  2 000501   000004 220100                    LDX0    4,,PR0
         2 000502   000117 600000 2                  TZE     NOREAD

      558    11973    2                 GOTO NOREAD;    /* ERROR CODE NOT QUITE RIGHT, BUT WHO CARES    */
      559    11974    2              IF F$DCB.SHARED THEN

  11974  2 000503   000064 236100                    LDQ     52,,PR0
         2 000504   100000 316003                    CANQ    32768,DU
         2 000505   000510 600000 2                  TZE     VEC

      560    11975    2                 CALL ENQRD ALTRET(ERRDEQ);

  11975  2 000506   003250 701000 2                  TSX1    ENQRD
         2 000507   001027 702000 2                  TSX2    ERRDEQ
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:78   

      561    11976        /**/
      562    11977    2            END;

      563    11978        /**/
      564    11979        /* VECTOR OFF ON DCB.IFMT */
      565    11980        /**/
      566    11981    1   VEC:    CALL HFF$TRAPALT ALTRET(MEMTRAP); /* GO TO ALTRET IF MEM TRAP         */

  11981  2 000510   000002 631400 xsym  VEC          EPPR1   B_VECTNIL+2
         2 000511   000000 701000 xent               TSX1    HFF$TRAPALT
         2 000512   001001 702000 2                  TSX2    MEMTRAP

      567    11982    2           DO CASE(F$DCB.IFMT);

  11982  2 000513   200054 470500                    LDP0    JDCB$,,AUTO
         2 000514   000103 236100                    LDQ     67,,PR0
         2 000515   000033 772000                    QRL     27
         2 000516   000034 116007                    CMPQ    28,DL
         2 000517   000521 602006 2                  TNC     s:11982+6,QL
         2 000520   000775 710000 2                  TRA     s:12028
         2 000521   000775 710000 2                  TRA     s:12028
         2 000522   000555 710000 2                  TRA     s:11984
         2 000523   000575 710000 2                  TRA     s:11988
         2 000524   000602 710000 2                  TRA     s:11990
         2 000525   000607 710000 2                  TRA     s:11992
         2 000526   000614 710000 2                  TRA     s:11994
         2 000527   000775 710000 2                  TRA     s:12028
         2 000530   000624 710000 2                  TRA     s:11996
         2 000531   000775 710000 2                  TRA     s:12028
         2 000532   000633 710000 2                  TRA     s:12001
         2 000533   000775 710000 2                  TRA     s:12028
         2 000534   000653 710000 2                  TRA     s:12005
         2 000535   000775 710000 2                  TRA     s:12028
         2 000536   000775 710000 2                  TRA     s:12028
         2 000537   000673 710000 2                  TRA     s:12009
         2 000540   000643 710000 2                  TRA     s:12003
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:79   
         2 000541   000663 710000 2                  TRA     s:12007
         2 000542   000703 710000 2                  TRA     s:12011
         2 000543   000555 710000 2                  TRA     s:11984
         2 000544   000713 710000 2                  TRA     s:12013
         2 000545   000723 710000 2                  TRA     s:12015
         2 000546   000565 710000 2                  TRA     s:11986
         2 000547   000733 710000 2                  TRA     s:12017
         2 000550   000740 710000 2                  TRA     s:12020
         2 000551   000750 710000 2                  TRA     s:12022
         2 000552   000760 710000 2                  TRA     s:12024
         2 000553   000614 710000 2                  TRA     s:11994
         2 000554   000770 710000 2                  TRA     s:12026

      568    11983    2            CASE(1/*FMTCON#*/,18/*FMTSYMB#*/); /* CONSEC or SYMB disk file          */

      569    11984    2              CALL FMH$CPMME(FPTCODE,FPT$READ_V) ALTRET(ERROR);

  11984  2 000555   000000 236000 xsym               LDQ     B$PS0$
         2 000556   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000557   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000560   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000561   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000562   000000 701000 xent               TSX1    FMH$CPMME
         2 000563   001034 702000 2                  TSX2    ERROR
         2 000564   001000 710000 2                  TRA     s:12034

      570    11985    2            CASE(21/*FMTCONUBLK#*/);           /* CONSEC file, ACS=UBLOCK           */

      571    11986    2              CALL FMH$UBLOCK(FPTCODE,FPT$READ_V) ALTRET(ERROR);

  11986  2 000565   000000 236000 xsym               LDQ     B$PS0$
         2 000566   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000567   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000570   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000571   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000572   000000 701000 xent               TSX1    FMH$UBLOCK
         2 000573   001034 702000 2                  TSX2    ERROR
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:80   
         2 000574   001000 710000 2                  TRA     s:12034

      572    11987    2            CASE(2/*FMTKEY#*/);                /* KEYED AND INDEXED DISK FILE       */

      573    11988    2              CALL FMG$KPMME(FPTCODE) ALTRET(ERROR);

  11988  2 000575   200003 630500                    EPPR0   @FPTCODE,,AUTO
         2 000576   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000577   000000 701000 xent               TSX1    FMG$KPMME
         2 000600   001034 702000 2                  TSX2    ERROR
         2 000601   001000 710000 2                  TRA     s:12034

      574    11989    2            CASE(3/*FMTRAN#*/);      /* RANDOM AND IDS DISK FILES, OR DEVICE PACK   */

      575    11990    2              CALL FMI$RAN(FPTCODE) ALTRET(ERROR);

  11990  2 000602   200003 630500                    EPPR0   @FPTCODE,,AUTO
         2 000603   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000604   000000 701000 xent               TSX1    FMI$RAN
         2 000605   001034 702000 2                  TSX2    ERROR
         2 000606   001000 710000 2                  TRA     s:12034

      576    11991    2            CASE(4/*FMTREL#*/);                /* RELATIVE DISK FILES               */

      577    11992    2              CALL FMJ$REL(FPTCODE) ALTRET(ERROR);

  11992  2 000607   200003 630500                    EPPR0   @FPTCODE,,AUTO
         2 000610   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000611   000000 701000 xent               TSX1    FMJ$REL
         2 000612   001034 702000 2                  TSX2    ERROR
         2 000613   001000 710000 2                  TRA     s:12034

      578    11993    2            CASE (5/*FMTTAPE#*/, 26 /*FMTOD*/);
             11993                     /* Tape and Optical Disk Files        */

      579    11994    2              CALL FTW$WRAT(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:81   
  11994  2 000614   000000 236000 xsym               LDQ     B$PS0$
         2 000615   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000616   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000617   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000620   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000621   000000 701000 xent               TSX1    FTW$WRAT
         2 000622   001034 702000 2                  TSX2    ERROR
         2 000623   001000 710000 2                  TRA     s:12034

      580    11995    2            CASE(7/*FMTNO#*/);                 /* NO-DEVICE                         */

      581    11996    3              IF FPTCODE=0 /* FPTREAD */ THEN DO;

  11996  2 000624   200003 471500                    LDP1    @FPTCODE,,AUTO
         2 000625   100000 235100                    LDA     0,,PR1
         2 000626   001000 601000 2                  TNZ     s:12034

      582    11997    3                 B$JIT.ERR=ERREOF;

  11997  2 000627   000010 236000 0                  LDQ     ERREOF
         2 000630   000000 473400 xsym               LDP3    B$JIT$
         2 000631   300012 756100                    STQ     10,,PR3

      583    11998    3                 GOTO ERROR;

  11998  2 000632   001034 710000 2                  TRA     ERROR

      584    11999    3                 END;
      585    12000    2            CASE(9/*FMTJCLOUT#*/);             /* CREATING JE OR JF FILES           */

      586    12001    2              CALL FSD$JE(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12001  2 000633   000000 236000 xsym               LDQ     B$PS0$
         2 000634   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000635   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000636   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000637   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:82   
         2 000640   000000 701000 xent               TSX1    FSD$JE
         2 000641   001034 702000 2                  TSX2    ERROR
         2 000642   001000 710000 2                  TRA     s:12034

      587    12002    2            CASE(15/*FMTURDEV#*/);             /* Unit record device                */

      588    12003    2              CALL FSE$UR(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12003  2 000643   000000 236000 xsym               LDQ     B$PS0$
         2 000644   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000645   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000646   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000647   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000650   000000 701000 xent               TSX1    FSE$UR
         2 000651   001034 702000 2                  TSX2    ERROR
         2 000652   001000 710000 2                  TRA     s:12034

      589    12004    2            CASE(11/*FMTURFILE#*/);            /* Unit record file                  */

      590    12005    2              CALL FSE$URFILE(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12005  2 000653   000000 236000 xsym               LDQ     B$PS0$
         2 000654   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000655   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000656   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000657   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000660   000000 701000 xent               TSX1    FSE$URFILE
         2 000661   001034 702000 2                  TSX2    ERROR
         2 000662   001000 710000 2                  TRA     s:12034

      591    12006    2            CASE(16/*FMTURSTRM#*/);  /* UNIT-RECORD FORMATTING WITH STREAMED DCB    */

      592    12007    2              CALL FSE$URSTREAM(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12007  2 000663   000000 236000 xsym               LDQ     B$PS0$
         2 000664   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000665   200102 757100                    STAQ    TYPE+1,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:83   
         2 000666   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000667   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000670   000000 701000 xent               TSX1    FSE$URSTREAM
         2 000671   001034 702000 2                  TSX2    ERROR
         2 000672   001000 710000 2                  TRA     s:12034

      593    12008    2            CASE(14/*FMTTTY#*/);               /* TTY FORMATTING                    */

      594    12009    2              CALL FSE$TTY(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12009  2 000673   000000 236000 xsym               LDQ     B$PS0$
         2 000674   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000675   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000676   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000677   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000700   000000 701000 xent               TSX1    FSE$TTY
         2 000701   001034 702000 2                  TSX2    ERROR
         2 000702   001000 710000 2                  TRA     s:12034

      595    12010    2            CASE(17/*FMTTTYSTRM#*/);           /* TTY FORMATTING WITH STREAMED DCB  */

      596    12011    2              CALL FSE$TTYSTREAM(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12011  2 000703   000000 236000 xsym               LDQ     B$PS0$
         2 000704   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000705   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000706   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000707   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000710   000000 701000 xent               TSX1    FSE$TTYSTREAM
         2 000711   001034 702000 2                  TSX2    ERROR
         2 000712   001000 710000 2                  TRA     s:12034

      597    12012    2            CASE(19/*FMTFPRG#*/);              /* FPRG FORMATTING                   */

      598    12013    2              CALL FSE$FPRG(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12013  2 000713   000000 236000 xsym               LDQ     B$PS0$
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:84   
         2 000714   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000715   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000716   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000717   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000720   000000 701000 xent               TSX1    FSE$FPRG
         2 000721   001034 702000 2                  TSX2    ERROR
         2 000722   001000 710000 2                  TRA     s:12034

      599    12014    2            CASE(20/*FMTFPSTRM#*/);            /* FPRG FORMATTING WITH STREAMED DCB */

      600    12015    2              CALL FSE$FPSTREAM(FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12015  2 000723   000000 236000 xsym               LDQ     B$PS0$
         2 000724   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000725   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000726   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000727   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000730   000000 701000 xent               TSX1    FSE$FPSTREAM
         2 000731   001034 702000 2                  TSX2    ERROR
         2 000732   001000 710000 2                  TRA     s:12034

      601    12016    2            CASE(22/*FMTARRAYPROCESSOR#*/);

      602    12017    2              CALL NAI$WRITE(FPTCODE);

  12017  2 000733   200003 630500                    EPPR0   @FPTCODE,,AUTO
         2 000734   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000735   000000 701000 xent               TSX1    NAI$WRITE
         2 000736   000000 011000                    NOP     0

      603    12018    2              RETURN;

  12018  2 000737   000000 702200 xent               TSX2  ! X66_ARET

      604    12019    2            CASE(23 /*FMTGR*/);           /* GRAPHIC FORMATTING WITH NO STREAM DCB  */

      605    12020    2              CALL FSE$GR (FPTCODE,FPT$WRITE_V) ALTRET(ERROR);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:85   

  12020  2 000740   000000 236000 xsym               LDQ     B$PS0$
         2 000741   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000742   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000743   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000744   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000745   000000 701000 xent               TSX1    FSE$GR
         2 000746   001034 702000 2                  TSX2    ERROR
         2 000747   001000 710000 2                  TRA     s:12034

      606    12021    2            CASE(24 /*FMTGRSTRM*/);           /* GRAPHIC FORMATTING WITH STREAM DCB */

      607    12022    2              CALL FSE$GRSTRM (FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12022  2 000750   000000 236000 xsym               LDQ     B$PS0$
         2 000751   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000752   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000753   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000754   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000755   000000 701000 xent               TSX1    FSE$GRSTRM
         2 000756   001034 702000 2                  TSX2    ERROR
         2 000757   001000 710000 2                  TRA     s:12034

      608    12023    2            CASE(25 /*FMTNC*/);

      609    12024    2              CALL FSE$NC (FPTCODE,FPT$WRITE_V) ALTRET(ERROR);

  12024  2 000760   000000 236000 xsym               LDQ     B$PS0$
         2 000761   200003 235100                    LDA     @FPTCODE,,AUTO
         2 000762   200102 757100                    STAQ    TYPE+1,,AUTO
         2 000763   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 000764   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000765   000000 701000 xent               TSX1    FSE$NC
         2 000766   001034 702000 2                  TSX2    ERROR
         2 000767   001000 710000 2                  TRA     s:12034

      610    12025    2            CASE(27 /*FMTREMOTE*/);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:86   

      611    12026    2              CALL FTAM_WAIT(FPTCODE) ALTRET(ERROR);

  12026  2 000770   200003 236100                    LDQ     @FPTCODE,,AUTO
         2 000771   200073 756100                    STQ     JRNLECCI+4,,AUTO
         2 000772   001633 701000 2                  TSX1    FTAM_WAIT
         2 000773   001034 702000 2                  TSX2    ERROR
         2 000774   001000 710000 2                  TRA     s:12034

      612    12027    2            CASE(ELSE);                    /* ILLEGAL IFMT                       */

      613    12028    2              CALL SC_FMF92;

  12028  2 000775   000000 713400 xsym               CLIMB   SC_FMF92
         2 000776   000000 600000 xsid               climb   nvectors=         0

      614    12029    2              RETURN;

  12029  2 000777   000000 702200 xent               TSX2  ! X66_ARET

      615    12030        /*S*    SCREECH_CODE:   FMF-S$FM92
      616    12031        *      TYPE:   SUA
      617    12032        *      MESSAGE:  Illegal DCB.IFMT */
      618    12033    2            END;

      619    12034    1           GOTO DONE;                      /* SUCCESSFUL COMPLETION              */

  12034  2 001000   001032 710000 2                  TRA     DONE

      620    12035        /**/
      621    12036    1   MEMTRAP: CALL FMD$FLSHBUF(0);           /* GET RID OF DATA BUFFER             */

  12036  2 001001   000004 630400 3     MEMTRAP      EPPR0   4
         2 001002   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001003   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 001004   000000 011000                    NOP     0

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:87   
      622    12037    1           IF B$JIT.ERR.CODE=%E$BADVECT2 AND (FPTCODE=0 /* FPTREAD */ OR

  12037  2 001005   000000 470400 xsym               LDP0    B$JIT$
         2 001006   000012 236100                    LDQ     10,,PR0
         2 001007   377770 376007                    ANQ     131064,DL
         2 001010   006460 116007                    CMPQ    3376,DL
         2 001011   001022 601000 2                  TNZ     s:12041
         2 001012   200003 471500                    LDP1    @FPTCODE,,AUTO
         2 001013   100000 235100                    LDA     0,,PR1
         2 001014   001017 600000 2                  TZE     s:12039
         2 001015   000001 115007                    CMPA    1,DL
         2 001016   001022 601000 2                  TNZ     s:12041

      623    12038    1             FPTCODE=1 /* FPTWRITE */) THEN
      624    12039    1              B$JIT.ERR=ERRMTRAP;          /* CHANGE ERROR TO BAD BUFFER         */

  12039  2 001017   000011 236000 0                  LDQ     ERRMTRAP
         2 001020   000012 756100                    STQ     10,,PR0
         2 001021   001026 710000 2                  TRA     s:12044

      625    12040    2           ELSE DO;

      626    12041    2              B$JIT.ERR.FCG='0615'O;          /* PUT IN FMF TO GET BETTER ERROR     */

  12041  2 001022   061500 236003                    LDQ     25408,DU
         2 001023   000012 752160                    STCQ    10,'60'O,PR0

      627    12042    2              B$JIT.ERR.MID='06'O;

  12042  2 001024   000006 236003                    LDQ     6,DU
         2 001025   000012 752110                    STCQ    10,'10'O,PR0

      628    12043    2              END;

      629    12044    1           GOTO ERROR;

  12044  2 001026   001034 710000 2                  TRA     ERROR
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:88   

      630    12045        /*E*    ERROR:   FMF-E$BADVECT0-2
      631    12046        *       MESSAGE:  Trap accessing V area of FPT%, DCB %DC%
      632    12047        */
      633    12048        /*E*    ERROR:  FMF-E$BADVECT1-2
      634    12049        *       MESSAGE:  Trap accessing KEY parameter%, file %UF%%, DCB %DC%
      635    12050        *       MESSAGE1: KEY location not accessible or not large enough
      636    12051        */
      637    12052        /*E*    ERROR:  FMF-E$BADVECT2-2
      638    12053        *       MESSAGE:  Trap accessing LKEY parameter%, file %UF%%, DCB %DC%
      639    12054        *       MESSAGE1: The LKEY parameter for M$DELREC is not large enough
      640    12055                       or is inaccessible
      641    12056        */
      642    12057        /*E*    ERROR:  FMF-E$BADVECT3-2
      643    12058        *       MESSAGE: STATION parameter% for %UF% inaccessible or not large enough
      644    12059        */
      645    12060        /**/
      646    12061    1   ERRDEQ: CALL DEQ;

  12061  2 001027   003561 701000 2     ERRDEQ       TSX1    DEQ
         2 001030   000000 011000                    NOP     0

      647    12062    1   ERRXIT: RETURN;

  12062  2 001031   000000 702200 xent  ERRXIT       TSX2  ! X66_ARET

      648    12063        /**/
      649    12064    1   DONE:   B$JIT.ERR='0'B;                 /* CLEAR ANY OLD ERROR                */

  12064  2 001032   000000 470400 xsym  DONE         LDP0    B$JIT$
         2 001033   000012 450100                    STZ     10,,PR0

  12061  2 001034                       ERROR        null
      650    12065    1   ERROR:  ;
      651    12066    1           IF F$DCB.DECRYPT AND (NOT B$JIT.ERR OR B$JIT.ERR.CODE = %E$LD) THEN

  12066  2 001034   200054 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:89   
         2 001035   000102 236100                    LDQ     66,,PR0
         2 001036   001000 316007                    CANQ    512,DL
         2 001037   001056 600000 2                  TZE     s:12068
         2 001040   000000 471400 xsym               LDP1    B$JIT$
         2 001041   100012 235100                    LDA     10,,PR1
         2 001042   001047 600000 2                  TZE     s:12067
         2 001043   100012 236100                    LDQ     10,,PR1
         2 001044   377770 376007                    ANQ     131064,DL
         2 001045   000070 116007                    CMPQ    56,DL
         2 001046   001056 601000 2                  TNZ     s:12068

      652    12067    1              CALL FMD$DECRYPT_BUFFER(FPT$READ_V.SEED);

  12067  2 001047   000000 236000 xsym               LDQ     B$PS0$
         2 001050   000002 036003                    ADLQ    2,DU
         2 001051   200102 756100                    STQ     TYPE+1,,AUTO
         2 001052   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 001053   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001054   000000 701000 xent               TSX1    FMD$DECRYPT_BUFFER
         2 001055   000000 011000                    NOP     0

      653    12068    2           IF F$DCB.SHARED THEN DO;

  12068  2 001056   200054 470500                    LDP0    JDCB$,,AUTO
         2 001057   000064 236100                    LDQ     52,,PR0
         2 001060   100000 316003                    CANQ    32768,DU
         2 001061   001114 600000 2                  TZE     s:12077

      654    12069    2              IF F$DCB.IASN = %FILE# THEN

  12069  2 001062   000103 236100                    LDQ     67,,PR0
         2 001063   000777 376007                    ANQ     511,DL
         2 001064   000001 116007                    CMPQ    1,DL
         2 001065   001112 601000 2                  TNZ     s:12075

      655    12070    3              DO I = 0 TO 4;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:90   
  12070  2 001066   200057 450100                    STZ     I,,AUTO

      656    12071    3                 IF NOT F$DCB.BFR.CVM(I) AND F$DCB.BFR1.CX(I) > 0 AND

  12071  2 001067   200054 470500                    LDP0    JDCB$,,AUTO
         2 001070   200057 720100                    LXL0    I,,AUTO
         2 001071   000115 236110                    LDQ     77,X0,PR0
         2 001072   040000 316003                    CANQ    16384,DU
         2 001073   001106 601000 2                  TNZ     s:12074
         2 001074   000122 721110                    LXL1    82,X0,PR0
         2 001075   001106 600000 2                  TZE     s:12074
         2 001076   000115 234110                    SZN     77,X0,PR0
         2 001077   001106 605000 2                  TPL     s:12074

      657    12072    3                   F$DCB.BFR.BUFUP(I) THEN
      658    12073    3                    CALL FMD$WRTCACHE(I);

  12073  2 001100   200057 631500                    EPPR1   I,,AUTO
         2 001101   200102 451500                    STP1    TYPE+1,,AUTO
         2 001102   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 001103   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001104   000000 701000 xent               TSX1    FMD$WRTCACHE
         2 001105   000000 011000                    NOP     0

      659    12074    3                 END;

  12074  2 001106   200057 054100                    AOS     I,,AUTO
         2 001107   200057 235100                    LDA     I,,AUTO
         2 001110   000004 115007                    CMPA    4,DL
         2 001111   001067 604400 2                  TMOZ    s:12071

      660    12075    2              CALL DEQ;

  12075  2 001112   003561 701000 2                  TSX1    DEQ
         2 001113   000000 011000                    NOP     0

      661    12076    2              END;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:91   

      662    12077    1           CODE=B$JIT.ERR.CODE;

  12077  2 001114   000000 470400 xsym               LDP0    B$JIT$
         2 001115   000012 236100                    LDQ     10,,PR0
         2 001116   000003 772000                    QRL     3
         2 001117   037777 376007                    ANQ     16383,DL
         2 001120   200061 756100                    STQ     CODE,,AUTO

      663    12078    2           IF F$DCB.WAIT~=0 THEN DO;

  12078  2 001121   200054 471500                    LDP1    JDCB$,,AUTO
         2 001122   100064 236100                    LDQ     52,,PR1
         2 001123   000020 316007                    CANQ    16,DL
         2 001124   001313 600000 2                  TZE     s:12117

      664    12079        /* WAIT OPERATION */
      665    12080    2              IF BCDCB$->F$DCB.FCN(1) THEN /* REG IF ANY I/O                     */

  12080  2 001125   200055 473500                    LDP3    BCDCB$,,AUTO
         2 001126   300074 236100                    LDQ     60,,PR3
         2 001127   000777 316003                    CANQ    511,DU
         2 001130   001141 600000 2                  TZE     s:12082

      666    12081    2                 CALL SSR$REG(%SS_IIP,BCDCB$->F$DCB.FCN(1));

  12081  2 001131   200055 236100                    LDQ     BCDCB$,,AUTO
         2 001132   000007 036000 3                  ADLQ    7
         2 001133   000006 235000 3                  LDA     6
         2 001134   200102 757100                    STAQ    TYPE+1,,AUTO
         2 001135   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 001136   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001137   000000 701000 xent               TSX1    SSR$REG
         2 001140   000000 011000                    NOP     0

      667    12082    2              IF S$CU$->B$U.ASYNCH&%U_CACHE THEN

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:92   
  12082  2 001141   000000 470400 xsym               LDP0    S$CU$
         2 001142   000001 236100                    LDQ     1,,PR0
         2 001143   000003 376000 xsym               ANQ     B_VECTNIL+3
         2 001144   001147 600000 2                  TZE     s:12084

      668    12083    2                 CALL CACHECLR;            /* Clear the cache                    */

  12083  2 001145   004076 701000 2                  TSX1    CACHECLR
         2 001146   000000 011000                    NOP     0

      669    12084    3              IF CODE=0 THEN DO;

  12084  2 001147   200061 235100                    LDA     CODE,,AUTO
         2 001150   001244 601000 2                  TNZ     s:12104

      670    12085                                           /* No JIT.ERR - set JIT.ERR from TYC, if   */
      671    12086                                           /* we're not processing a tape I/O error   */
      672    12087    4                 IF F$DCB.OLDIOERR = 0 OR F$DCB.OLDIOERR = 3 THEN DO;

  12087  2 001151   200054 470500                    LDP0    JDCB$,,AUTO
         2 001152   000102 236100                    LDQ     66,,PR0
         2 001153   140000 316003                    CANQ    49152,DU
         2 001154   001161 600000 2                  TZE     CHKTYC
         2 001155   000102 236100                    LDQ     66,,PR0
         2 001156   140000 376003                    ANQ     49152,DU
         2 001157   140000 116003                    CMPQ    49152,DU
         2 001160   001277 601000 2                  TNZ     s:12112

      673    12088    4   CHKTYC:          F$DCB.TYC(1)=BCDCB$->F$DCB.TYC(1)&'377777777777'O;

  12088  2 001161   200055 470500       CHKTYC       LDP0    BCDCB$,,AUTO
         2 001162   000002 236100                    LDQ     2,,PR0
         2 001163   000031 376000 xsym               ANQ     B_VECTNIL+25
         2 001164   200054 471500                    LDP1    JDCB$,,AUTO
         2 001165   100002 756100                    STQ     2,,PR1

      674    12089    4                    IF F$DCB.TYC(1) THEN   /* DO NOTHING IF NO BITS SET          */
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:93   

  12089  2 001166   001277 600000 2                  TZE     s:12112

      675    12090    5                    DO I=1 TO F_TYCMAX;

  12090  2 001167   000001 235007                    LDA     1,DL
         2 001170   200057 755100                    STA     I,,AUTO
         2 001171   001240 710000 2                  TRA     s:12100+1

      676    12091    6                       IF ADDR(F$DCB.TYC(1))->BITS.B(I) THEN DO;

  12091  2 001172   200057 235100                    LDA     I,,AUTO
         2 001173   001175 605000 2                  TPL     s:12091+3
         2 001174   000044 035003                    ADLA    36,DU
         2 001175   200054 470500                    LDP0    JDCB$,,AUTO
         2 001176   000000 066505                    CMPB    filb='0'B
         2 001177   000002 000001                    BDSC    2,A,PR0                  by=0,bit=0,n=1
         2 001200   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         2 001201   001237 600000 2                  TZE     s:12100

      677    12092    6                          IF F$DCB.ORG=%RANDOM# OR F$DCB.ORG=%IDS# THEN

  12092  2 001202   000032 236100                    LDQ     26,,PR0
         2 001203   777000 376003                    ANQ     -512,DU
         2 001204   003000 116003                    CMPQ    1536,DU
         2 001205   001210 600000 2                  TZE     s:12093
         2 001206   007000 116003                    CMPQ    3584,DU
         2 001207   001214 601000 2                  TNZ     s:12095

      678    12093    6                             B$JIT.ERR=ERRDMYFMI;

  12093  2 001210   000022 236000 0                  LDQ     ERRDMYFMI
         2 001211   000000 471400 xsym               LDP1    B$JIT$
         2 001212   100012 756100                    STQ     10,,PR1
         2 001213   001217 710000 2                  TRA     s:12096

      679    12094    6                          ELSE
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:94   
      680    12095    6                             B$JIT.ERR=ERRDMY;

  12095  2 001214   000007 236000 0                  LDQ     ERRDMY
         2 001215   000000 471400 xsym               LDP1    B$JIT$
         2 001216   100012 756100                    STQ     10,,PR1

      681    12096    6                          B$JIT.ERR.CODE=F_CODE(I);

  12096  2 001217   200057 236100                    LDQ     I,,AUTO
         2 001220   000011 402007                    MPY     9,DL
         2 001221   000000 116003                    CMPQ    0,DU
         2 001222   001224 605000 2                  TPL     s:12096+5
         2 001223   000044 036003                    ADLQ    36,DU
         2 001224   003100 061406                    CSR     bolr='003'O
         2 001225   000000 000011 xsym               BDSC    F_CODE,Q                 by=0,bit=0,n=9
         2 001226   100012 410016                    BDSC    10,,PR1                  by=2,bit=1,n=14

      682    12097    6                          B$JIT.ERR.SEV=F_SEV(I);

  12097  2 001227   200057 235100                    LDA     I,,AUTO
         2 001230   000001 735000                    ALS     1
         2 001231   001233 605000 2                  TPL     s:12097+4
         2 001232   000044 035003                    ADLA    36,DU
         2 001233   003100 061405                    CSR     bolr='003'O
         2 001234   000000 000002 xsym               BDSC    F_SEV,A                  by=0,bit=0,n=2
         2 001235   100012 660003                    BDSC    10,,PR1                  by=3,bit=6,n=3

      683    12098    6                          RETURN;

  12098  2 001236   000000 702200 xent               TSX2  ! X66_ARET

      684    12099    6                          END;
      685    12100    5                       END;

  12100  2 001237   200057 054100                    AOS     I,,AUTO
         2 001240   200057 236100                    LDQ     I,,AUTO
         2 001241   000000 116000 xsym               CMPQ    F_TYCMAX
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:95   
         2 001242   001172 604400 2                  TMOZ    s:12091

      686    12101    4                    END;

      687    12102    3                 END;

  12102  2 001243   001277 710000 2                  TRA     s:12112

      688    12103    2              ELSE
      689    12104    2                 IF CODE <= F_TYCMAX

  12104  2 001244   200061 236100                    LDQ     CODE,,AUTO
         2 001245   001272 604000 2                  TMI     s:12111
         2 001246   000000 116000 xsym               CMPQ    F_TYCMAX
         2 001247   001272 605400 2                  TPNZ    s:12111
         2 001250   200054 470500                    LDP0    JDCB$,,AUTO
         2 001251   000103 236100                    LDQ     67,,PR0
         2 001252   000777 376007                    ANQ     511,DL
         2 001253   000002 116007                    CMPQ    2,DL
         2 001254   001264 601000 2                  TNZ     s:12108
         2 001255   000067 236100                    LDQ     55,,PR0
         2 001256   000010 316003                    CANQ    8,DU
         2 001257   001264 601000 2                  TNZ     s:12108
         2 001260   000032 236100                    LDQ     26,,PR0
         2 001261   777000 376007                    ANQ     -512,DL
         2 001262   003000 116007                    CMPQ    1536,DL
         2 001263   001272 600000 2                  TZE     s:12111

      690    12105    2                   AND (F$DCB.IASN ~= %TAPE# /* Already set for free tape        */
      691    12106    2                   OR F$DCB.TAPTYP.MANAGED OR F$DCB.ASN ~= %DEVICE#)
      692    12107    2                 THEN
      693    12108    2                    F$DCB.TYC(1)=(BCDCB$->F$DCB.TYC(1)|F_TYCBITS(CODE))&

  12108  2 001264   200055 471500                    LDP1    BCDCB$,,AUTO
         2 001265   100002 236100                    LDQ     2,,PR1
         2 001266   000000 276005 xsym               ORQ     F_TYCBITS,AL
         2 001267   000031 376000 xsym               ANQ     B_VECTNIL+25
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:96   
         2 001270   000002 756100                    STQ     2,,PR0
         2 001271   001277 710000 2                  TRA     s:12112

      694    12109    2                      '377777777777'O;     /* REMOVE EGV                         */
      695    12110    2                 ELSE
      696    12111    2                    F$DCB.TYC(1)=BCDCB$->F$DCB.TYC(1)&'377777777777'O; /* RESET EGV */

  12111  2 001272   200055 470500                    LDP0    BCDCB$,,AUTO
         2 001273   000002 236100                    LDQ     2,,PR0
         2 001274   000031 376000 xsym               ANQ     B_VECTNIL+25
         2 001275   200054 471500                    LDP1    JDCB$,,AUTO
         2 001276   100002 756100                    STQ     2,,PR1

      697    12112    2              IF F$DCB.IFMT=19/*FMTFPRG#*/ OR F$DCB.IFMT=20/*FMTFPSTRM#*/

  12112  2 001277   200054 470500                    LDP0    JDCB$,,AUTO
         2 001300   000103 236100                    LDQ     67,,PR0
         2 001301   777000 376003                    ANQ     -512,DU
         2 001302   023000 116003                    CMPQ    9728,DU
         2 001303   001306 600000 2                  TZE     s:12113
         2 001304   024000 116003                    CMPQ    10240,DU
         2 001305   001312 601000 2                  TNZ     s:12114

      698    12113    2              THEN CALL UDB$PMMEXIT1;      /*dont set "m" bit in jit.err*/

  12113  2 001306   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001307   000000 701000 xent               TSX1    UDB$PMMEXIT1
         2 001310   000000 011000                    NOP     0
         2 001311   001313 710000 2                  TRA     s:12117

      699    12114    2              ELSE RETURN;

  12114  2 001312   000000 702200 xent               TSX2  ! X66_ARET

      700    12115    2              END;                         /* END OF WAIT CODE                   */
      701    12116        /**/
      702    12117    2           IF EVENT=0 THEN DO;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:97   

  12117  2 001313   200062 235100                    LDA     EVENT,,AUTO
         2 001314   001343 601000 2                  TNZ     s:12133

      703    12118        /* NO-WAIT NO EVENT */
      704    12119    2              IF CODE=0 OR CODE>F_TYCMAX THEN RETURN;

  12119  2 001315   200061 236100                    LDQ     CODE,,AUTO
         2 001316   001322 600000 2                  TZE     s:12119+5
         2 001317   001322 604000 2                  TMI     s:12119+5
         2 001320   000000 116000 xsym               CMPQ    F_TYCMAX
         2 001321   001323 604400 2                  TMOZ    s:12121

  12119  2 001322   000000 702200 xent               TSX2  ! X66_ARET

      705    12120                   %LOCK (G#=F_DCBLOCK);
             12121    2   CALL HFC$LOCK(F_DCBLOCK);

  12121  2 001323   000002 630400 3                  EPPR0   2
         2 001324   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001325   000000 701000 xent               TSX1    HFC$LOCK
         2 001326   000000 011000                    NOP     0

      706    12123    2              BCDCB$->F$DCB.TYC(0)=BCDCB$->F$DCB.TYC(0)|F_TYCBITS(CODE);

  12123  2 001327   200055 470500                    LDP0    BCDCB$,,AUTO
         2 001330   200061 720100                    LXL0    CODE,,AUTO
         2 001331   000001 236100                    LDQ     1,,PR0
         2 001332   000000 276010 xsym               ORQ     F_TYCBITS,X0
         2 001333   000001 756100                    STQ     1,,PR0

      707    12124                   %UNLOCK (G#=F_DCBLOCK);
             12125    2   CALL HFC$UNLOCK(F_DCBLOCK);

  12125  2 001334   000002 630400 3                  EPPR0   2
         2 001335   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001336   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:98   
         2 001337   000000 011000                    NOP     0

      708    12127    2              B$JIT.ERR='0'B;              /* REPORT ERROR AT CHECK, NOT NOW     */

  12127  2 001340   000000 470400 xsym               LDP0    B$JIT$
         2 001341   000012 450100                    STZ     10,,PR0

      709    12128    2              RETURN;

  12128  2 001342   000000 702200 xent               TSX2  ! X66_ARET

      710    12129    2              END;                         /* END OF NO-WAIT NO-EVENT            */
      711    12130        /**/
      712    12131        /* NO-WAIT EVENT */
      713    12132        /**/
      714    12133    1           IF CODE=0 THEN

  12133  2 001343   200061 236100                    LDQ     CODE,,AUTO
         2 001344   001430 601000 2                  TNZ     s:12154

      715    12134    1              IF B$JIT.DO$=ADDR(NIL) THEN RETURN;

  12134  2 001345   000000 470400 xsym               LDP0    B$JIT$
         2 001346   000233 236100                    LDQ     155,,PR0
         2 001347   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001350   001352 601000 2                  TNZ     s:12137

  12134  2 001351   000000 702200 xent               TSX2  ! X66_ARET

      716    12135    2              ELSE DO;

      717    12136                      %LOCK (G#=S_UDLGATE);
             12137    2   CALL HFC$LOCK(S_UDLGATE);

  12137  2 001352   000010 630400 3                  EPPR0   8
         2 001353   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001354   000000 701000 xent               TSX1    HFC$LOCK
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:99   
         2 001355   000000 011000                    NOP     0

      718    12139    2   COMPDO:       B$JIT.DO$->B$DO.IOCOMP.CNTR=B$JIT.DO$->B$DO.IOCOMP.CNTR-1;

  12139  2 001356   000000 470400 xsym  COMPDO       LDP0    B$JIT$
         2 001357   000233 471500                    LDP1    155,,PR0
         2 001360   100011 235100                    LDA     9,,PR1
         2 001361   000001 135007                    SBLA    1,DL
         2 001362   100011 755100                    STA     9,,PR1

      719    12140    2                 IF FPTCODE=0 /* FPTREAD */ THEN

  12140  2 001363   200003 471500                    LDP1    @FPTCODE,,AUTO
         2 001364   100000 235100                    LDA     0,,PR1
         2 001365   001372 601000 2                  TNZ     s:12142

      720    12141    2                    B$JIT.DO$->B$DO.IOCOMP.ARS=F$DCB.ARS;

  12141  2 001366   000233 473500                    LDP3    155,,PR0
         2 001367   200054 474500                    LDP4    JDCB$,,AUTO
         2 001370   400000 235100                    LDA     0,,PR4
         2 001371   300007 755100                    STA     7,,PR3

      721    12142    2                 B$JIT.DO$->B$DO.IOCOMP.DVE.DVBYTE=F$DCB.DVBYTE;

  12142  2 001372   000233 473500                    LDP3    155,,PR0
         2 001373   200054 474500                    LDP4    JDCB$,,AUTO
         2 001374   400003 236100                    LDQ     3,,PR4
         2 001375   776000 376003                    ANQ     -1024,DU
         2 001376   300010 552140                    STBQ    8,'40'O,PR3

      722    12143    2                 B$JIT.DO$->B$DO.IOCOMP.DVE.EOMCHAR=F$DCB.EOMCHAR;

  12143  2 001377   000233 473500                    LDP3    155,,PR0
         2 001400   400003 236100                    LDQ     3,,PR4
         2 001401   000022 736000                    QLS     18
         2 001402   300010 552120                    STBQ    8,'20'O,PR3
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:100  

      723    12144                      %UNLOCK (G#=S_UDLGATE);
             12145    2   CALL HFC$UNLOCK(S_UDLGATE);

  12145  2 001403   000010 630400 3                  EPPR0   8
         2 001404   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001405   000000 701000 xent               TSX1    HFC$UNLOCK
         2 001406   000000 011000                    NOP     0

      724    12147    3                 DO INHIBIT;

      725    12148    3                    IF B$JIT.DO$->B$DO.IOCOMP.CNTR=0 THEN /* ALL I/O DONE        */

  12148  2 001407   000000 470600 xsym               LDP0  ! B$JIT$
         2 001410   000233 471700                    LDP1  ! 155,,PR0
         2 001411   100011 235300                    LDA   ! 9,,PR1
         2 001412   001424 601200 2                  TNZ   ! s:12151

      726    12149    3                       CALL SSV$SCHDDO(B$JIT.DO$,S_CUN);

  12149  2 001413   000011 236200 3                  LDQ   ! 9
         2 001414   200103 756300                    STQ   ! TYPE+2,,AUTO
         2 001415   000000 236200 xsym               LDQ   ! B$JIT$
         2 001416   000233 036203                    ADLQ  ! 155,DU
         2 001417   200102 756300                    STQ   ! TYPE+1,,AUTO
         2 001420   200102 630700                    EPPR0 ! TYPE+1,,AUTO
         2 001421   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         2 001422   000000 701200 xent               TSX1  ! SSV$SCHDDO
         2 001423   000000 011200                    NOP   ! 0

      727    12150    3                    END;

      728    12151    2                 B$JIT.DO$=ADDR(NIL);

  12151  2 001424   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001425   000000 470400 xsym               LDP0    B$JIT$
         2 001426   000233 756100                    STQ     155,,PR0
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:101  

      729    12152    2                 RETURN;

  12152  2 001427   000000 702200 xent               TSX2  ! X66_ARET

      730    12153    2                 END;
      731    12154    2           IF CODE>F_TYCMAX THEN DO;

  12154  2 001430   001433 604000 2                  TMI     s:12155
         2 001431   000000 116000 xsym               CMPQ    F_TYCMAX
         2 001432   001457 604400 2                  TMOZ    s:12162

      732    12155    3              IF B$JIT.DO$~=ADDR(NIL) THEN DO;

  12155  2 001433   000000 470400 xsym               LDP0    B$JIT$
         2 001434   000233 236100                    LDQ     155,,PR0
         2 001435   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001436   001456 600000 2                  TZE     s:12160

      733    12156    3                 USR=S_CUN;

  12156  2 001437   000000 235000 xsym               LDA     S_CUN
         2 001440   000033 735000                    ALS     27
         2 001441   200060 755100                    STA     USR,,AUTO

      734    12157    3                 CALL SSV$XXDO(USR,B$JIT.DO$); /* GET RID OF DO-LIST             */

  12157  2 001442   000000 236000 xsym               LDQ     B$JIT$
         2 001443   000233 036003                    ADLQ    155,DU
         2 001444   200103 756100                    STQ     TYPE+2,,AUTO
         2 001445   200060 631500                    EPPR1   USR,,AUTO
         2 001446   200102 451500                    STP1    TYPE+1,,AUTO
         2 001447   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 001450   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001451   000000 701000 xent               TSX1    SSV$XXDO
         2 001452   000000 011000                    NOP     0

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:102  
      735    12158    3                 B$JIT.DO$=ADDR(NIL);

  12158  2 001453   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001454   000000 470400 xsym               LDP0    B$JIT$
         2 001455   000233 756100                    STQ     155,,PR0

      736    12159    3                 END;

      737    12160    2              RETURN;

  12160  2 001456   000000 702200 xent               TSX2  ! X66_ARET

      738    12161    2              END;
      739    12162    2           IF B$JIT.DO$~=ADDR(NIL) THEN DO;

  12162  2 001457   000000 470400 xsym               LDP0    B$JIT$
         2 001460   000233 236100                    LDQ     155,,PR0
         2 001461   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001462   001514 600000 2                  TZE     s:12177

      740    12163                   %LOCK (G#=F_DCBLOCK);
             12164    2   CALL HFC$LOCK(F_DCBLOCK);

  12164  2 001463   000002 630400 3                  EPPR0   2
         2 001464   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001465   000000 701000 xent               TSX1    HFC$LOCK
         2 001466   000000 011000                    NOP     0

      741    12166    2              BCDCB$->F$DCB.TYC(0)=BCDCB$->F$DCB.TYC(0)|F_TYCBITS(CODE);

  12166  2 001467   200055 470500                    LDP0    BCDCB$,,AUTO
         2 001470   200061 720100                    LXL0    CODE,,AUTO
         2 001471   000001 236100                    LDQ     1,,PR0
         2 001472   000000 276010 xsym               ORQ     F_TYCBITS,X0
         2 001473   000001 756100                    STQ     1,,PR0

      742    12167                   %UNLOCK (G#=F_DCBLOCK);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:103  
             12168    2   CALL HFC$UNLOCK(F_DCBLOCK);

  12168  2 001474   000002 630400 3                  EPPR0   2
         2 001475   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001476   000000 701000 xent               TSX1    HFC$UNLOCK
         2 001477   000000 011000                    NOP     0

      743    12170                   %LOCK (G#=S_UDLGATE);
             12171    2   CALL HFC$LOCK(S_UDLGATE);

  12171  2 001500   000010 630400 3                  EPPR0   8
         2 001501   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001502   000000 701000 xent               TSX1    HFC$LOCK
         2 001503   000000 011000                    NOP     0

      744    12173    2              B$JIT.DO$->B$DO.IOCOMP.TYC=B$JIT.DO$->B$DO.IOCOMP.TYC|F_TYCBITS(CODE);

  12173  2 001504   000000 470400 xsym               LDP0    B$JIT$
         2 001505   000233 471500                    LDP1    155,,PR0
         2 001506   200061 720100                    LXL0    CODE,,AUTO
         2 001507   100006 236100                    LDQ     6,,PR1
         2 001510   000000 276010 xsym               ORQ     F_TYCBITS,X0
         2 001511   100006 756100                    STQ     6,,PR1

      745    12174    2              B$JIT.ERR='0'B;              /* DON'T REPORT ERROR ON THIS PMME    */

  12174  2 001512   000012 450100                    STZ     10,,PR0

      746    12175    2              GOTO COMPDO;

  12175  2 001513   001356 710000 2                  TRA     COMPDO

      747    12176    2              END;
      748    12177    1           RETURN;

  12177  2 001514   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:104  
      749    12178        /**/
      750    12179        /**/
      751    12180        /**/
      752    12181    1   FMF$PEOF: ENTRY(FPTCODE);  /* ENTER HERE FROM OPEN TO POSITION

  12181  2 001515   000000 700200 xent  FMF$PEOF     TSX0  ! X66_AUTO_1
         2 001516   000114 000001                    ZERO    76,1

      753    12182                                       FILES TO EOF FOR FILE EXTENSION */
      754    12183    1           JDCB$=B$JIT.DCB$;

  12183  2 001517   000000 470400 xsym               LDP0    B$JIT$
         2 001520   000232 236100                    LDQ     154,,PR0
         2 001521   200054 756100                    STQ     JDCB$,,AUTO

      755    12184    1           BCDCB$=JDCB$;              /* DON'T NEED BYPASS CACHE ON THIS PATH    */

  12184  2 001522   200055 756100                    STQ     BCDCB$,,AUTO

      756    12185    1           F$DCB.WAIT=1;

  12185  2 001523   200054 471500                    LDP1    JDCB$,,AUTO
         2 001524   000020 236007                    LDQ     16,DL
         2 001525   100064 256100                    ORSQ    52,,PR1

      757    12186    1           CFU$=F$DCB.CFU$;

  12186  2 001526   100066 236100                    LDQ     54,,PR1
         2 001527   200056 756100                    STQ     CFU$,,AUTO

      758    12187    1           IF F$DCB.SHARED THEN

  12187  2 001530   100064 236100                    LDQ     52,,PR1
         2 001531   100000 316003                    CANQ    32768,DU
         2 001532   001535 600000 2                  TZE     s:12189

      759    12188    1              CALL ENQRD ALTRET(ERRDEQ);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:105  

  12188  2 001533   003250 701000 2                  TSX1    ENQRD
         2 001534   001027 702000 2                  TSX2    ERRDEQ

      760    12189    1           F$DCB.TYC(1)='0'B;

  12189  2 001535   200054 470500                    LDP0    JDCB$,,AUTO
         2 001536   000002 450100                    STZ     2,,PR0

      761    12190    1           IF F$DCB.IASN~=%FILE# THEN      /* This shouldn't happen              */

  12190  2 001537   000103 236100                    LDQ     67,,PR0
         2 001540   000777 376007                    ANQ     511,DL
         2 001541   000001 116007                    CMPQ    1,DL
         2 001542   000510 601000 2                  TNZ     VEC

      762    12191    1              GOTO VEC;
      763    12192        /**/
      764    12193    2           DO CASE(F$DCB.IORG);

  12193  2 001543   000070 236100                    LDQ     56,,PR0
         2 001544   000033 772000                    QRL     27
         2 001545   000077 376007                    ANQ     63,DL
         2 001546   000006 116007                    CMPQ    6,DL
         2 001547   001551 602006 2                  TNC     s:12193+6,QL
         2 001550   001602 710000 2                  TRA     s:12203
         2 001551   001602 710000 2                  TRA     s:12203
         2 001552   001557 710000 2                  TRA     s:12195
         2 001553   001564 710000 2                  TRA     s:12197
         2 001554   001571 710000 2                  TRA     s:12199
         2 001555   001557 710000 2                  TRA     s:12195
         2 001556   001576 710000 2                  TRA     s:12201

      765    12194    2            CASE(%CONSEC#,%UR#);

      766    12195    2              CALL FMH$CPMME(8 /* PFILEOF */,0) ALTRET(ERROR);

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:106  
  12195  2 001557   000003 630400 3                  EPPR0   3
         2 001560   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001561   000000 701000 xent               TSX1    FMH$CPMME
         2 001562   001034 702000 2                  TSX2    ERROR
         2 001563   001602 710000 2                  TRA     s:12203

      767    12196    2            CASE(%KEYED#);

      768    12197    2              CALL FMG$KPMME(8 /* PFILEOF */) ALTRET(ERROR);

  12197  2 001564   000003 630400 3                  EPPR0   3
         2 001565   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001566   000000 701000 xent               TSX1    FMG$KPMME
         2 001567   001034 702000 2                  TSX2    ERROR
         2 001570   001602 710000 2                  TRA     s:12203

      769    12198    2            CASE(%RANDOM#);

      770    12199    2              CALL FMI$RAN(8 /* PFILEOF */) ALTRET(ERROR);

  12199  2 001571   000003 630400 3                  EPPR0   3
         2 001572   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001573   000000 701000 xent               TSX1    FMI$RAN
         2 001574   001034 702000 2                  TSX2    ERROR
         2 001575   001602 710000 2                  TRA     s:12203

      771    12200    2            CASE(%RELATIVE#);

      772    12201    2              CALL FMJ$REL(8 /* PFILEOF */) ALTRET(ERROR);

  12201  2 001576   000003 630400 3                  EPPR0   3
         2 001577   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001600   000000 701000 xent               TSX1    FMJ$REL
         2 001601   001034 702000 2                  TSX2    ERROR

      773    12202    2            END;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:107  
      774    12203    1           GOTO DONE;

  12203  2 001602   001032 710000 2                  TRA     DONE

      775    12204        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:108  
      776    12205        /**/
      777    12206        /**/
      778    12207        /**/
      779    12208    1   FMF$REMOTE: ENTRY(FPTCODE);        /* Enter here to open or close an FTAM DCB */

  12208  2 001603   000000 700200 xent  FMF$REMOTE   TSX0  ! X66_AUTO_1
         2 001604   000114 000001                    ZERO    76,1

      780    12209
      781    12210    1           JDCB$=B$JIT.DCB$;

  12210  2 001605   000000 470400 xsym               LDP0    B$JIT$
         2 001606   000232 236100                    LDQ     154,,PR0
         2 001607   200054 756100                    STQ     JDCB$,,AUTO

      782    12211    1           F$DCB.FTAM.USR=B$JIT.USER;

  12211  2 001610   200054 471500                    LDP1    JDCB$,,AUTO
         2 001611   000000 236100                    LDQ     0,,PR0
         2 001612   000011 772000                    QRL     9
         2 001613   100065 552110                    STBQ    53,'10'O,PR1

      783    12212    1           CODE=FPTCODE+100;

  12212  2 001614   200003 473500                    LDP3    @FPTCODE,,AUTO
         2 001615   300000 235100                    LDA     0,,PR3
         2 001616   000144 035007                    ADLA    100,DL
         2 001617   200061 755100                    STA     CODE,,AUTO

      784    12213    1           F$DCB.CFU$=ADDR(FPTCODE);       /* Point to possible open fpt ptrs    */

  12213  2 001620   200003 236100                    LDQ     @FPTCODE,,AUTO
         2 001621   100066 756100                    STQ     54,,PR1

      785    12214    1           IF CODE>200 THEN CODE=100;      /* Make a pointer looki like an open  */

  12214  2 001622   000311 115007                    CMPA    201,DL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:109  
         2 001623   001626 602000 2                  TNC     s:12215

  12214  2 001624   000144 235007                    LDA     100,DL
         2 001625   200061 755100                    STA     CODE,,AUTO

      786    12215    1           CALL FTAM_WAIT(CODE);

  12215  2 001626   200061 634500                    EPPR4   CODE,,AUTO
         2 001627   200073 454500                    STP4    JRNLECCI+4,,AUTO
         2 001630   001633 701000 2                  TSX1    FTAM_WAIT
         2 001631   000000 011000                    NOP     0

      787    12216    1           RETURN;

  12216  2 001632   000000 702200 xent               TSX2  ! X66_ARET

      788    12217        /**/
      789    12218        /**/
      790    12219    1   FTAM_WAIT: PROC(FTAMCODE) ALTRET;

  12219  2 001633   200072 741300       FTAM_WAIT    STX1  ! JRNLECCI+3,,AUTO

      791    12220
      792    12221    2   DCL FTAMCODE SBIN;
      793    12222    2   DCL FM_FTAM_USER STATIC SYMDEF UBIN INIT(%BITBIN('106124101115'O));
      794    12223
      795    12224    2           USR=FM_FTAM_USER;

  12224  2 001634   000000 235000 1                  LDA     FM_FTAM_USER
         2 001635   000033 735000                    ALS     27
         2 001636   200060 755100                    STA     USR,,AUTO

      796    12225    2           IF USR=0 OR USR~=FM_FTAM_USER THEN B$JIT.ERR=ERRNOEVENT;

  12225  2 001637   200060 236100                    LDQ     USR,,AUTO
         2 001640   777000 316003                    CANQ    -512,DU
         2 001641   001646 600000 2                  TZE     s:12225+7
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:110  
         2 001642   200060 236100                    LDQ     USR,,AUTO
         2 001643   000033 772000                    QRL     27
         2 001644   000000 116000 1                  CMPQ    FM_FTAM_USER
         2 001645   001652 600000 2                  TZE     s:12227

  12225  2 001646   000014 236000 0                  LDQ     ERRNOEVENT
         2 001647   000000 470400 xsym               LDP0    B$JIT$
         2 001650   000012 756100                    STQ     10,,PR0
         2 001651   001722 710000 2                  TRA     s:12235

      797    12226    3           ELSE DO;

      798    12227    3              F$DCB.FTAM.PMME=FPTCODE;

  12227  2 001652   200054 470500                    LDP0    JDCB$,,AUTO
         2 001653   200003 471500                    LDP1    @FPTCODE,,AUTO
         2 001654   100000 236100                    LDQ     0,,PR1
         2 001655   000065 552104                    STBQ    53,'04'O,PR0

      799    12228    3              B$JIT.ERR=ERRNOCODE;

  12228  2 001656   000020 236000 0                  LDQ     ERRNOCODE
         2 001657   000000 473400 xsym               LDP3    B$JIT$
         2 001660   300012 756100                    STQ     10,,PR3

      800    12229    3              CALL SSV$EVENT(USR,%USERWSR,%SUBC_COMIO#,F$DCB.FTAM,0);

  12229  2 001661   000004 236000 3                  LDQ     4
         2 001662   200106 756100                    STQ     TYPE+5,,AUTO
         2 001663   200054 236100                    LDQ     JDCB$,,AUTO
         2 001664   000065 036003                    ADLQ    53,DU
         2 001665   000012 235000 3                  LDA     10
         2 001666   200104 757100                    STAQ    TYPE+3,,AUTO
         2 001667   000013 236000 3                  LDQ     11
         2 001670   200103 756100                    STQ     TYPE+2,,AUTO
         2 001671   200060 634500                    EPPR4   USR,,AUTO
         2 001672   200102 454500                    STP4    TYPE+1,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:111  
         2 001673   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 001674   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 001675   000000 701000 xent               TSX1    SSV$EVENT
         2 001676   000000 011000                    NOP     0

      801    12230    4              DO WHILE B$JIT.ERR=ERRNOCODE;

  12230  2 001677   000000 470400 xsym               LDP0    B$JIT$
         2 001700   000012 236100                    LDQ     10,,PR0
         2 001701   000020 116000 0                  CMPQ    ERRNOCODE
         2 001702   001722 601000 2                  TNZ     s:12235

      802    12231    4                 CALL SSR$REG(%SS_SL,25,25);

  12231  2 001703   000015 630400 3                  EPPR0   13
         2 001704   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001705   000000 701000 xent               TSX1    SSR$REG
         2 001706   000000 011000                    NOP     0

      803    12232    4                 IF FM_FTAM_USER~=USR THEN B$JIT.ERR=ERRNOEVENT;

  12232  2 001707   200060 236100                    LDQ     USR,,AUTO
         2 001710   000033 772000                    QRL     27
         2 001711   000000 116000 1                  CMPQ    FM_FTAM_USER
         2 001712   001716 600000 2                  TZE     s:12233

  12232  2 001713   000014 236000 0                  LDQ     ERRNOEVENT
         2 001714   000000 470400 xsym               LDP0    B$JIT$
         2 001715   000012 756100                    STQ     10,,PR0

      804    12233    4                 END;

  12233  2 001716   000000 470400 xsym               LDP0    B$JIT$
         2 001717   000012 236100                    LDQ     10,,PR0
         2 001720   000020 116000 0                  CMPQ    ERRNOCODE
         2 001721   001703 600000 2                  TZE     s:12231

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:112  
      805    12234    3              END;

      806    12235    2           IF B$JIT.ERR THEN ALTRETURN;

  12235  2 001722   000000 116003                    CMPQ    0,DU
         2 001723   001726 600000 2                  TZE     s:12236

  12235  2 001724   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 001725   000000 702211                    TSX2  ! 0,X1

      807    12236    2   END FTAM_WAIT;

  12236  2 001726   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 001727   000001 702211                    TSX2  ! 1,X1

      808    12237        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:113  
      809    12238        /**/
      810    12239        /**/
      811    12240        /*D*      NAME:       EXTEND
      812    12241                  CALL:       CALL EXTEND ALTRET(LOC);
      813    12242                  DESCRIPTION: Process the M$EXTEND PMME for all files
      814    12243        */
      815    12244        /**/
      816    12245        /**/
      817    12246        /**/
      818    12247    1   EXTEND: PROC ALTRET;

  12247  2 001730   200072 741300       EXTEND       STX1  ! JRNLECCI+3,,AUTO

      819    12248        /**/
      820    12249    2   DCL RECS UBIN;
      821    12250    2   DCL GRANS SBIN;
      822    12251    2   DCL DSSID UBIN;
      823    12252    2   DCL WSQ UBIN;
      824    12253    2   DCL I SBIN;
      825    12254        /**/
      826    12255    2           IF F$DCB.IASN~=%FILE# OR

  12255  2 001731   200054 470500                    LDP0    JDCB$,,AUTO
         2 001732   000103 236100                    LDQ     67,,PR0
         2 001733   000777 376007                    ANQ     511,DL
         2 001734   000001 116007                    CMPQ    1,DL
         2 001735   001744 601000 2                  TNZ     s:12257
         2 001736   000070 236100                    LDQ     56,,PR0
         2 001737   077000 376003                    ANQ     32256,DU
         2 001740   003000 116003                    CMPQ    1536,DU
         2 001741   001745 600000 2                  TZE     s:12259
         2 001742   005000 116003                    CMPQ    2560,DU
         2 001743   001745 600000 2                  TZE     s:12259

      827    12256    2             F$DCB.IORG~=%RANDOM# AND F$DCB.IORG~=%RELATIVE# THEN
      828    12257    2              RETURN;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:114  
  12257  2 001744   000001 702211                    TSX2  ! 1,X1

      829    12258        /**/
      830    12259    2           CFU$=F$DCB.CFU$;

  12259  2 001745   000066 236100                    LDQ     54,,PR0
         2 001746   200056 756100                    STQ     CFU$,,AUTO

      831    12260    2           IF F$DCB.WSR=7 THEN WSQ=%USERWSQ;

  12260  2 001747   000040 236100                    LDQ     32,,PR0
         2 001750   000777 376003                    ANQ     511,DU
         2 001751   000007 116003                    CMPQ    7,DU
         2 001752   001756 601000 2                  TNZ     s:12261

  12260  2 001753   000010 235007                    LDA     8,DL
         2 001754   200076 755100                    STA     WSQ,,AUTO
         2 001755   001762 710000 2                  TRA     s:12262

      832    12261    2           ELSE WSQ=F$DCB.WSR;

  12261  2 001756   000040 236100                    LDQ     32,,PR0
         2 001757   000022 772000                    QRL     18
         2 001760   000777 376007                    ANQ     511,DL
         2 001761   200076 756100                    STQ     WSQ,,AUTO

      833    12262    2           DSSID=LS0UBIN+F$DCB.ACS;

  12262  2 001762   000036 236100                    LDQ     30,,PR0
         2 001763   000777 376007                    ANQ     511,DL
         2 001764   000000 036000 xsym               ADLQ    B$IS$
         2 001765   200075 756100                    STQ     DSSID,,AUTO

      834    12263    2           GRANS=FM$CFU.NRECS;

  12263  2 001766   200056 471500                    LDP1    CFU$,,AUTO
         2 001767   100001 235100                    LDA     1,,PR1
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:115  
         2 001770   200074 755100                    STA     GRANS,,AUTO

      835    12264    2           IF F$DCB.ORG~=%RANDOM# OR FM$CFUR.HEADPP#=0 THEN

  12264  2 001771   000032 236100                    LDQ     26,,PR0
         2 001772   777000 376003                    ANQ     -512,DU
         2 001773   003000 116003                    CMPQ    1536,DU
         2 001774   001777 601000 2                  TNZ     s:12265
         2 001775   100005 220100                    LDX0    5,,PR1
         2 001776   002001 601000 2                  TNZ     s:12266

      836    12265    2              DSSID=0;

  12265  2 001777   200075 450100                    STZ     DSSID,,AUTO
         2 002000   002004 710000 2                  TRA     s:12267

      837    12266    2           ELSE RECS=FM$CFUR.HEADPP#;

  12266  2 002001   100005 236100                    LDQ     5,,PR1
         2 002002   000022 772000                    QRL     18
         2 002003   200073 756100                    STQ     RECS,,AUTO

      838    12267    3           IF FPT$EXTEND_V.SIZ=0 THEN DO;

  12267  2 002004   000000 473400 xsym               LDP3    B$PS0$
         2 002005   300000 720100                    LXL0    0,,PR3
         2 002006   002046 601000 2                  TNZ     s:12275

      839    12268    4              IF DSSID~=0 THEN DO;

  12268  2 002007   200075 236100                    LDQ     DSSID,,AUTO
         2 002010   002044 600000 2                  TZE     s:12273

      840    12269    4                 CALL MMH$MAP_DS(WSQ,DSSID,GRANS*1024-1,B$JIT.ERR,,

  12269  2 002011   000012 735000                    ALS     10
         2 002012   000001 135007                    SBLA    1,DL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:116  
         2 002013   200102 755100                    STA     TYPE+1,,AUTO
         2 002014   200074 634500                    EPPR4   GRANS,,AUTO
         2 002015   200113 454500                    STP4    TYPE+10,,AUTO
         2 002016   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 002017   200112 756100                    STQ     TYPE+9,,AUTO
         2 002020   200073 635500                    EPPR5   RECS,,AUTO
         2 002021   200111 455500                    STP5    TYPE+8,,AUTO
         2 002022   200110 756100                    STQ     TYPE+7,,AUTO
         2 002023   000000 236000 xsym               LDQ     B$JIT$
         2 002024   000012 036003                    ADLQ    10,DU
         2 002025   200107 756100                    STQ     TYPE+6,,AUTO
         2 002026   200102 636500                    EPPR6   TYPE+1,,AUTO
         2 002027   200106 456500                    STP6    TYPE+5,,AUTO
         2 002030   200075 637500                    EPPR7   DSSID,,AUTO
         2 002031   200105 457500                    STP7    TYPE+4,,AUTO
         2 002032   200076 630500                    EPPR0   WSQ,,AUTO
         2 002033   200104 450500                    STP0    TYPE+3,,AUTO
         2 002034   200104 630500                    EPPR0   TYPE+3,,AUTO
         2 002035   000026 631400 xsym               EPPR1   B_VECTNIL+22
         2 002036   000000 701000 xent               TSX1    MMH$MAP_DS
         2 002037   002304 702000 2                  TSX2    MMDSERR

      841    12270    4                   RECS,,GRANS)ALTRET(MMDSERR);
      842    12271    4                 F$DCB.NRECS=FM$CFU.NRECS;

  12271  2 002040   200056 470500                    LDP0    CFU$,,AUTO
         2 002041   200054 471500                    LDP1    JDCB$,,AUTO
         2 002042   000001 235100                    LDA     1,,PR0
         2 002043   100042 755100                    STA     34,,PR1

      843    12272    4                 END;

      844    12273    3              RETURN;

  12273  2 002044   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 002045   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:117  
      845    12274    3              END;
      846    12275    3           IF DSSID~=0 THEN DO;

  12275  2 002046   200075 236100                    LDQ     DSSID,,AUTO
         2 002047   002106 600000 2                  TZE     s:12280

      847    12276    3              IF GRANS+FPT$EXTEND_V.SIZ>256 THEN GOTO SHRDS2BIG;

  12276  2 002050   300000 236100                    LDQ     0,,PR3
         2 002051   777777 376007                    ANQ     -1,DL
         2 002052   200074 036100                    ADLQ    GRANS,,AUTO
         2 002053   000400 116007                    CMPQ    256,DL
         2 002054   002313 605400 2                  TPNZ    SHRDS2BIG

      848    12277    3              CALL MMH$SHARE_DS(WSQ,DSSID,FPT$EXTEND_V.SIZ*1024,B$JIT.ERR,,

  12277  2 002055   300000 236100                    LDQ     0,,PR3
         2 002056   000012 736000                    QLS     10
         2 002057   000020 376000 3                  ANQ     16
         2 002060   200102 756100                    STQ     TYPE+1,,AUTO
         2 002061   200077 634500                    EPPR4   I,,AUTO
         2 002062   200113 454500                    STP4    TYPE+10,,AUTO
         2 002063   200074 635500                    EPPR5   GRANS,,AUTO
         2 002064   200112 455500                    STP5    TYPE+9,,AUTO
         2 002065   200073 636500                    EPPR6   RECS,,AUTO
         2 002066   200111 456500                    STP6    TYPE+8,,AUTO
         2 002067   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 002070   200110 756100                    STQ     TYPE+7,,AUTO
         2 002071   000000 236000 xsym               LDQ     B$JIT$
         2 002072   000012 036003                    ADLQ    10,DU
         2 002073   200107 756100                    STQ     TYPE+6,,AUTO
         2 002074   200102 637500                    EPPR7   TYPE+1,,AUTO
         2 002075   200106 457500                    STP7    TYPE+5,,AUTO
         2 002076   200075 630500                    EPPR0   DSSID,,AUTO
         2 002077   200105 450500                    STP0    TYPE+4,,AUTO
         2 002100   200076 630500                    EPPR0   WSQ,,AUTO
         2 002101   200104 450500                    STP0    TYPE+3,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:118  
         2 002102   200104 630500                    EPPR0   TYPE+3,,AUTO
         2 002103   000026 631400 xsym               EPPR1   B_VECTNIL+22
         2 002104   000000 701000 xent               TSX1    MMH$SHARE_DS
         2 002105   002304 702000 2                  TSX2    MMDSERR

      849    12278    3                RECS/*HEAD*/,GRANS/*TAIL*/,I)ALTRET(MMDSERR);
      850    12279    3              END;

      851    12280    2           IF F$DCB.SHARED THEN

  12280  2 002106   200054 470500                    LDP0    JDCB$,,AUTO
         2 002107   000064 236100                    LDQ     52,,PR0
         2 002110   100000 316003                    CANQ    32768,DU
         2 002111   002114 600000 2                  TZE     s:12284

      852    12281    2              CALL ENQWR ALTRET(ERR);

  12281  2 002112   003253 701000 2                  TSX1    ENQWR
         2 002113   002243 702000 2                  TSX2    ERR

      853    12282        /**/
      854    12283        /**/
      855    12284    2           FM$CFU.FMOD='1'B;

  12284  2 002114   200056 470500                    LDP0    CFU$,,AUTO
         2 002115   004000 236003                    LDQ     2048,DU
         2 002116   000000 256100                    ORSQ    0,,PR0

      856    12285    3           IF F$DCB.ASN=%COMGROUP# THEN DO;

  12285  2 002117   200054 471500                    LDP1    JDCB$,,AUTO
         2 002120   100032 236100                    LDQ     26,,PR1
         2 002121   777000 376007                    ANQ     -512,DL
         2 002122   004000 116007                    CMPQ    2048,DL
         2 002123   002133 601000 2                  TNZ     s:12290

      857    12286    3              F$DCB.XTNSIZE=FPT$EXTEND_V.SIZ;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:119  

  12286  2 002124   000000 473400 xsym               LDP3    B$PS0$
         2 002125   300000 720100                    LXL0    0,,PR3
         2 002126   100037 740100                    STX0    31,,PR1

      858    12287    3              CALL KCO$EXTEND ALTRET(ERR);

  12287  2 002127   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002130   000000 701000 xent               TSX1    KCO$EXTEND
         2 002131   002243 702000 2                  TSX2    ERR

      859    12288    3              END;

  12288  2 002132   002237 710000 2                  TRA     s:12311

      860    12289    2           ELSE
      861    12290    3              IF F$DCB.IORG=%RANDOM# THEN DO;

  12290  2 002133   100070 236100                    LDQ     56,,PR1
         2 002134   077000 376003                    ANQ     32256,DU
         2 002135   003000 116003                    CMPQ    1536,DU
         2 002136   002177 601000 2                  TNZ     s:12302

      862    12291    3                 F$DCB.XTNSIZE=FPT$EXTEND_V.SIZ;

  12291  2 002137   000000 473400 xsym               LDP3    B$PS0$
         2 002140   300000 720100                    LXL0    0,,PR3
         2 002141   100037 740100                    STX0    31,,PR1

      863    12292    3                 IF DSSID=0 OR FM$CFU.UGRANS~=0 THEN CALL FAG$GEXT ALTRET(ERR);

  12292  2 002142   200075 235100                    LDA     DSSID,,AUTO
         2 002143   002147 600000 2                  TZE     s:12292+5
         2 002144   000004 236100                    LDQ     4,,PR0
         2 002145   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 002146   002152 600000 2                  TZE     s:12293

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:120  
  12292  2 002147   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002150   000000 701000 xent               TSX1    FAG$GEXT
         2 002151   002243 702000 2                  TSX2    ERR

      864    12293    4                 IF DSSID~=0 THEN DO;

  12293  2 002152   200075 235100                    LDA     DSSID,,AUTO
         2 002153   002237 600000 2                  TZE     s:12311

      865    12294    4                    MM$PPUT.PPNO(FM$CFUR.TAILPP#)=RECS;

  12294  2 002154   200056 470500                    LDP0    CFU$,,AUTO
         2 002155   000005 720100                    LXL0    5,,PR0
         2 002156   200073 721100                    LXL1    RECS,,AUTO
         2 002157   000000 471400 xsym               LDP1    B$PPUT$
         2 002160   100000 441110                    SXL1    0,X0,PR1

      866    12295    4                    FM$CFUR.TAILPP#=GRANS;

  12295  2 002161   200074 720100                    LXL0    GRANS,,AUTO
         2 002162   000005 440100                    SXL0    5,,PR0

      867    12296    4                    FM$CFU.NRECS=FM$CFU.NRECS+F$DCB.XTNSIZE;

  12296  2 002163   200054 471500                    LDP1    JDCB$,,AUTO
         2 002164   100037 236100                    LDQ     31,,PR1
         2 002165   000022 772000                    QRL     18
         2 002166   000001 036100                    ADLQ    1,,PR0
         2 002167   000001 756100                    STQ     1,,PR0

      868    12297    4                    MM_SHAREDSUSE=MM_SHAREDSUSE+F$DCB.XTNSIZE;

  12297  2 002170   100037 236100                    LDQ     31,,PR1
         2 002171   000022 772000                    QRL     18
         2 002172   000000 036000 xsym               ADLQ    MM_SHAREDSUSE
         2 002173   000000 756000 xsym               STQ     MM_SHAREDSUSE

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:121  
      869    12298    4                    F$DCB.NRECS=FM$CFU.NRECS;

  12298  2 002174   000001 235100                    LDA     1,,PR0
         2 002175   100042 755100                    STA     34,,PR1

      870    12299    4                    END;

      871    12300    3                 END;

  12300  2 002176   002237 710000 2                  TRA     s:12311

      872    12301    3              ELSE DO;

      873    12302    3                 RECS=FM$CFU.NRECS+FPT$EXTEND_V.SIZ;

  12302  2 002177   000000 473400 xsym               LDP3    B$PS0$
         2 002200   300000 236100                    LDQ     0,,PR3
         2 002201   777777 376007                    ANQ     -1,DL
         2 002202   000001 036100                    ADLQ    1,,PR0
         2 002203   200073 756100                    STQ     RECS,,AUTO

      874    12303    3                 GRANS=((RECS*((F$DCB.RECL+7)/4)+1021)/1022)-FM$CFU.UGRANS;

  12303  2 002204   100033 236100                    LDQ     27,,PR1
         2 002205   777777 376007                    ANQ     -1,DL
         2 002206   000007 036007                    ADLQ    7,DL
         2 002207   000002 772000                    QRL     2
         2 002210   200073 402100                    MPY     RECS,,AUTO
         2 002211   001775 036007                    ADLQ    1021,DL
         2 002212   000001 772000                    QRL     1
         2 002213   000777 506007                    DIV     511,DL
         2 002214   200102 756100                    STQ     TYPE+1,,AUTO
         2 002215   000004 236100                    LDQ     4,,PR0
         2 002216   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002217   200103 756100                    STQ     TYPE+2,,AUTO
         2 002220   200102 236100                    LDQ     TYPE+1,,AUTO
         2 002221   200103 136100                    SBLQ    TYPE+2,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:122  
         2 002222   200074 756100                    STQ     GRANS,,AUTO

      875    12304    4                 IF GRANS>0 THEN DO;

  12304  2 002223   002231 604400 2                  TMOZ    s:12308

      876    12305    4                    F$DCB.XTNSIZE=GRANS;

  12305  2 002224   000000 620006                    EAX0    0,QL
         2 002225   100037 740100                    STX0    31,,PR1

      877    12306    4                    CALL FAG$GEXT ALTRET(ERR);

  12306  2 002226   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002227   000000 701000 xent               TSX1    FAG$GEXT
         2 002230   002243 702000 2                  TSX2    ERR

      878    12307    4                    END;

      879    12308    3                 FM$CFU.NRECS=RECS;

  12308  2 002231   200073 235100                    LDA     RECS,,AUTO
         2 002232   200056 470500                    LDP0    CFU$,,AUTO
         2 002233   000001 755100                    STA     1,,PR0

      880    12309    3                 F$DCB.NRECS=RECS;

  12309  2 002234   200073 236100                    LDQ     RECS,,AUTO
         2 002235   200054 471500                    LDP1    JDCB$,,AUTO
         2 002236   100042 756100                    STQ     34,,PR1

      881    12310    3                 END;

      882    12311    2           B$JIT.ERR='0'B;

  12311  2 002237   000000 470400 xsym               LDP0    B$JIT$
         2 002240   000012 450100                    STZ     10,,PR0
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:123  

      883    12312    2           RETURN;

  12312  2 002241   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 002242   000001 702211                    TSX2  ! 1,X1

  12311  2 002243                       ERR          null
      884    12313        /**/
      885    12314    2   ERR:    ;
      886    12315    3           IF DSSID~=0 THEN DO;

  12315  2 002243   200075 235100                    LDA     DSSID,,AUTO
         2 002244   002302 600000 2                  TZE     s:12321

      887    12316    3              I=FPT$EXTEND_V.SIZ;

  12316  2 002245   000000 470400 xsym               LDP0    B$PS0$
         2 002246   000000 236100                    LDQ     0,,PR0
         2 002247   777777 376007                    ANQ     -1,DL
         2 002250   200077 756100                    STQ     I,,AUTO

      888    12317    3              CALL MMJ$FPPCHAIN(RECS,GRANS,I);

  12317  2 002251   200077 631500                    EPPR1   I,,AUTO
         2 002252   200104 451500                    STP1    TYPE+3,,AUTO
         2 002253   200074 633500                    EPPR3   GRANS,,AUTO
         2 002254   200103 453500                    STP3    TYPE+2,,AUTO
         2 002255   200073 634500                    EPPR4   RECS,,AUTO
         2 002256   200102 454500                    STP4    TYPE+1,,AUTO
         2 002257   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002260   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002261   000000 701000 xent               TSX1    MMJ$FPPCHAIN
         2 002262   000000 011000                    NOP     0

      889    12318    3              CALL MMH$FDS(WSQ,DSSID,I*1024,I);

  12318  2 002263   200077 235100                    LDA     I,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:124  
         2 002264   000012 735000                    ALS     10
         2 002265   200102 755100                    STA     TYPE+1,,AUTO
         2 002266   200077 630500                    EPPR0   I,,AUTO
         2 002267   200107 450500                    STP0    TYPE+6,,AUTO
         2 002270   200102 631500                    EPPR1   TYPE+1,,AUTO
         2 002271   200106 451500                    STP1    TYPE+5,,AUTO
         2 002272   200075 633500                    EPPR3   DSSID,,AUTO
         2 002273   200105 453500                    STP3    TYPE+4,,AUTO
         2 002274   200076 634500                    EPPR4   WSQ,,AUTO
         2 002275   200104 454500                    STP4    TYPE+3,,AUTO
         2 002276   200104 630500                    EPPR0   TYPE+3,,AUTO
         2 002277   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 002300   000000 701000 xent               TSX1    MMH$FDS
         2 002301   000000 011000                    NOP     0

      890    12319    3              END;

      891    12320        /**/
      892    12321    2           ALTRETURN;

  12321  2 002302   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 002303   000000 702211                    TSX2  ! 0,X1

      893    12322        /**/
      894    12323    2   MMDSERR: B$JIT.ERR=ERRNOCODE|BINBIT(BITBIN(B$JIT.ERR)*8,36);

  12323  2 002304   000000 470400 xsym  MMDSERR      LDP0    B$JIT$
         2 002305   000012 236100                    LDQ     10,,PR0
         2 002306   000003 736000                    QLS     3
         2 002307   000020 276000 0                  ORQ     ERRNOCODE
         2 002310   000012 756100                    STQ     10,,PR0

      895    12324    2           ALTRETURN;

  12324  2 002311   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 002312   000000 702211                    TSX2  ! 0,X1

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:125  
      896    12325        /**/
      897    12326    2   SHRDS2BIG: B$JIT.ERR=ERRSHRDS2BIG;

  12326  2 002313   000013 236000 0     SHRDS2BIG    LDQ     ERRSHRDS2BIG
         2 002314   000000 474400 xsym               LDP4    B$JIT$
         2 002315   400012 756100                    STQ     10,,PR4

      898    12327    2           ALTRETURN;

  12327  2 002316   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 002317   000000 702211                    TSX2  ! 0,X1

      899    12328        /*E*  ERROR: FMF-E$SHRDS2BIG-2
      900    12329        */
      901    12330        /**/
      902    12331    2   END EXTEND;
      903    12332        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:126  
      904    12333        /*F*    NAME:  FMF$CHECK
      905    12334        *       PURPOSE:  Implement the M$CHECK PMME - wait for all
      906    12335        *         outstanding I/O on a DCB to complete.
      907    12336        */
      908    12337        /**/
      909    12338        /**/
      910    12339        /*D*    NAME: FMF$CHECK
      911    12340        *       CALL: CALL FMF$CHECK;
      912    12341        *       INPUT:  B$JIT.DCB$ - Pointer to DCB
      913    12342        *       DESCRIPTION:  If DCB is marked as having been opened by
      914    12343        *         a vehicle, give an error if this is not the vehicle.
      915    12344        *         Wait for all no-wait type I/O to complete.  Move
      916    12345        *         F$DCB.TYC(0) to F$DCB.TYC(1).  Perform the same operations
      917    12346        *         as FMF$PMME exit logic to set B$JIT.ERR.
      918    12347        */
      919    12348        /**/
      920    12349        /**/
      921    12350    1   FMF$CHECK: ENTRY;

  12350  2 002320   000000 700200 xent  FMF$CHECK    TSX0  ! X66_AUTO_1
         2 002321   000114 000001                    ZERO    76,1

      922    12351    1           JDCB$=B$JIT.DCB$;

  12351  2 002322   000000 470400 xsym               LDP0    B$JIT$
         2 002323   000232 236100                    LDQ     154,,PR0
         2 002324   200054 756100                    STQ     JDCB$,,AUTO

      923    12352    1           IF NOT F$DCB.FCD THEN

  12352  2 002325   200054 471500                    LDP1    JDCB$,,AUTO
         2 002326   100031 236100                    LDQ     25,,PR1
         2 002327   020000 316007                    CANQ    8192,DL
         2 002330   002332 601000 2                  TNZ     s:12354

      924    12353    1              RETURN;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:127  
  12353  2 002331   000000 702200 xent               TSX2  ! X66_ARET

      925    12354    1           B$JIT.ERR='0'B;

  12354  2 002332   000012 450100                    STZ     10,,PR0

      926    12355    2           IF F$DCB.FFLG.EXEC THEN DO;     /* EXECUTE-ONLY                       */

  12355  2 002333   100004 236100                    LDQ     4,,PR1
         2 002334   002000 316003                    CANQ    1024,DU
         2 002335   002356 600000 2                  TZE     s:12362

      927    12356    2              CALL FMO$GETDOMAIN(I);

  12356  2 002336   200057 633500                    EPPR3   I,,AUTO
         2 002337   200102 453500                    STP3    TYPE+1,,AUTO
         2 002340   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002341   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002342   000000 701000 xent               TSX1    FMO$GETDOMAIN
         2 002343   000000 011000                    NOP     0

      928    12357    3              IF F$DCB.WSR~=I THEN DO;

  12357  2 002344   200054 470500                    LDP0    JDCB$,,AUTO
         2 002345   000040 236100                    LDQ     32,,PR0
         2 002346   000022 772000                    QRL     18
         2 002347   000777 376007                    ANQ     511,DL
         2 002350   200057 116100                    CMPQ    I,,AUTO
         2 002351   002356 600000 2                  TZE     s:12362

      929    12358    3                 B$JIT.ERR=ERRDOMAIN;

  12358  2 002352   000005 236000 0                  LDQ     ERRDOMAIN
         2 002353   000000 471400 xsym               LDP1    B$JIT$
         2 002354   100012 756100                    STQ     10,,PR1

      930    12359    3                 GOTO ERRXIT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:128  

  12359  2 002355   001031 710000 2                  TRA     ERRXIT

      931    12360    3                 END;
      932    12361    2              END;
      933    12362    1           BCDCB$=JDCB$;

  12362  2 002356   200054 236100                    LDQ     JDCB$,,AUTO
         2 002357   200055 756100                    STQ     BCDCB$,,AUTO

      934    12363    1           BCDCB.SID=%RONCSID;             /* BYPASS CACHE POINTER               */

  12363  2 002360   006124 236007                    LDQ     3156,DL
         2 002361   200055 752103                    STCQ    BCDCB$,'03'O,AUTO

      935    12364    1           IF BCDCB$->F$DCB.FCN(0) THEN

  12364  2 002362   200055 470500                    LDP0    BCDCB$,,AUTO
         2 002363   000074 236100                    LDQ     60,,PR0
         2 002364   777000 316003                    CANQ    -512,DU
         2 002365   002376 600000 2                  TZE     s:12366

      936    12365    1              CALL SSR$REG(%SS_IIPC,BCDCB$->F$DCB.FCN(0)) ALTRET(PMMEINT);

  12365  2 002366   200055 236100                    LDQ     BCDCB$,,AUTO
         2 002367   000074 036003                    ADLQ    60,DU
         2 002370   000021 235000 3                  LDA     17
         2 002371   200102 757100                    STAQ    TYPE+1,,AUTO
         2 002372   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002373   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002374   000000 701000 xent               TSX1    SSR$REG
         2 002375   002412 702000 2                  TSX2    PMMEINT

      937    12366    1           F$DCB.TYC(1)=BCDCB$->F$DCB.TYC(0); /* MOVE TYC                        */

  12366  2 002376   200055 470500                    LDP0    BCDCB$,,AUTO
         2 002377   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:129  
         2 002400   200054 471500                    LDP1    JDCB$,,AUTO
         2 002401   100002 756100                    STQ     2,,PR1

      938    12367    1           F$DCB.TYC(0)='0'B;

  12367  2 002402   100001 450100                    STZ     1,,PR1

      939    12368    1           IF S$CU$->B$U.ASYNCH&%U_CACHE THEN

  12368  2 002403   000000 473400 xsym               LDP3    S$CU$
         2 002404   300001 236100                    LDQ     1,,PR3
         2 002405   000003 376000 xsym               ANQ     B_VECTNIL+3
         2 002406   002411 600000 2                  TZE     s:12370

      940    12369    1              CALL CACHECLR;               /* Clear the cache                    */

  12369  2 002407   004076 701000 2                  TSX1    CACHECLR
         2 002410   000000 011000                    NOP     0

      941    12370    1           GOTO CHKTYC;

  12370  2 002411   001161 710000 2                  TRA     CHKTYC

      942    12371        /**/
      943    12372    1   PMMEINT: B$JIT.ERR=ERRPMMEINT;

  12372  2 002412   000012 236000 0     PMMEINT      LDQ     ERRPMMEINT
         2 002413   000000 470400 xsym               LDP0    B$JIT$
         2 002414   000012 756100                    STQ     10,,PR0

      944    12373    1           GOTO ERRXIT;

  12373  2 002415   001031 710000 2                  TRA     ERRXIT

      945    12374        /*E*    ERROR:  FMF-E$PMMEINT-2
      946    12375        *       MESSAGE: Service request interrupted by break or control-y
      947    12376        */
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:130  
      948    12377        /**/
      949    12378        /**/
      950    12379        /**/
      951    12380    1   FMF$TRUNCM: ENTRY(FPTCODE);

  12380  2 002416   000000 700200 xent  FMF$TRUNCM   TSX0  ! X66_AUTO_1
         2 002417   000114 000001                    ZERO    76,1

      952    12381    1           ENTFLG=1;                       /* Called directly by monitor         */

  12381  2 002420   000001 235007                    LDA     1,DL
         2 002421   200063 755100                    STA     ENTFLG,,AUTO

      953    12382    1           GOTO TRUNC;

  12382  2 002422   002426 710000 2                  TRA     TRUNC

      954    12383        /**/
      955    12384    1   FMF$TRUNC: ENTRY(FPTCODE);

  12384  2 002423   000000 700200 xent  FMF$TRUNC    TSX0  ! X66_AUTO_1
         2 002424   000114 000001                    ZERO    76,1

      956    12385    1           ENTFLG=0;                       /* Called via PMME                    */

  12385  2 002425   200063 450100                    STZ     ENTFLG,,AUTO

      957    12386        /**/
      958    12387    1   TRUNC:  JDCB$=B$JIT.DCB$;

  12387  2 002426   000000 470400 xsym  TRUNC        LDP0    B$JIT$
         2 002427   000232 236100                    LDQ     154,,PR0
         2 002430   200054 756100                    STQ     JDCB$,,AUTO

      959    12388    1           B$JIT.ERR='0'B;

  12388  2 002431   000012 450100                    STZ     10,,PR0
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:131  

      960    12389    1   CHKOPN: IF NOT F$DCB.FCD THEN

  12389  2 002432   200054 471500       CHKOPN       LDP1    JDCB$,,AUTO
         2 002433   100031 236100                    LDQ     25,,PR1
         2 002434   020000 316007                    CANQ    8192,DL
         2 002435   002437 601000 2                  TNZ     s:12391

      961    12390    1              RETURN;                      /* DCB closed                         */

  12390  2 002436   000000 702200 xent               TSX2  ! X66_ARET

      962    12391    2           IF F$DCB.FFLG.EXEC AND ENTFLG=0 THEN DO;

  12391  2 002437   100004 236100                    LDQ     4,,PR1
         2 002440   002000 316003                    CANQ    1024,DU
         2 002441   002464 600000 2                  TZE     s:12399
         2 002442   200063 235100                    LDA     ENTFLG,,AUTO
         2 002443   002464 601000 2                  TNZ     s:12399

      963    12392    2              CALL FMO$GETDOMAIN(I);

  12392  2 002444   200057 633500                    EPPR3   I,,AUTO
         2 002445   200102 453500                    STP3    TYPE+1,,AUTO
         2 002446   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002447   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002450   000000 701000 xent               TSX1    FMO$GETDOMAIN
         2 002451   000000 011000                    NOP     0

      964    12393    3              IF F$DCB.WSR~=I THEN DO;

  12393  2 002452   200054 470500                    LDP0    JDCB$,,AUTO
         2 002453   000040 236100                    LDQ     32,,PR0
         2 002454   000022 772000                    QRL     18
         2 002455   000777 376007                    ANQ     511,DL
         2 002456   200057 116100                    CMPQ    I,,AUTO
         2 002457   002464 600000 2                  TZE     s:12399
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:132  

      965    12394    3                 B$JIT.ERR=ERRDOMAIN;

  12394  2 002460   000005 236000 0                  LDQ     ERRDOMAIN
         2 002461   000000 471400 xsym               LDP1    B$JIT$
         2 002462   100012 756100                    STQ     10,,PR1

      966    12395    3                 GOTO ERRXIT;

  12395  2 002463   001031 710000 2                  TRA     ERRXIT

      967    12396    3                 END;
      968    12397    2              END;
      969    12398        /**/
      970    12399    2           IF F$DCB.ASN=%COMGROUP# THEN DO;

  12399  2 002464   200054 470500                    LDP0    JDCB$,,AUTO
         2 002465   000032 236100                    LDQ     26,,PR0
         2 002466   777000 376007                    ANQ     -512,DL
         2 002467   004000 116007                    CMPQ    2048,DL
         2 002470   002515 601000 2                  TNZ     s:12407

      971    12400    3              IF ENTFLG~=0 THEN DO;

  12400  2 002471   200063 235100                    LDA     ENTFLG,,AUTO
         2 002472   002515 600000 2                  TZE     s:12407

      972    12401    3                 CG$=NK$LDCT$(F$DCB.LDCTX)->NK$LDCT.CG$;

  12401  2 002473   000051 220100                    LDX0    41,,PR0
         2 002474   000000 471400 xsym               LDP1    N$DCT$$
         2 002475   100000 473510                    LDP3    0,X0,PR1
         2 002476   300027 236100                    LDQ     23,,PR3
         2 002477   200064 756100                    STQ     CG$,,AUTO

      973    12402    3                 STA$=NK$LDCT$(F$DCB.LDCTX)->NK$LDCT.STA$;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:133  
  12402  2 002500   300012 236100                    LDQ     10,,PR3
         2 002501   200065 756100                    STQ     STA$,,AUTO

      974    12403    3                 CALL KQX$LDASR (CG$->KQ$CG);

  12403  2 002502   200064 630500                    EPPR0   CG$,,AUTO
         2 002503   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002504   000000 701000 xent               TSX1    KQX$LDASR
         2 002505   000000 011000                    NOP     0

      975    12404    3                 CALL KQC$ABTRD (STA$->KQ$STA,%TYC_EOF);

  12404  2 002506   000022 236000 3                  LDQ     18
         2 002507   200065 235100                    LDA     STA$,,AUTO
         2 002510   200102 757100                    STAQ    TYPE+1,,AUTO
         2 002511   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002512   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002513   000000 701000 xent               TSX1    KQC$ABTRD
         2 002514   000000 011000                    NOP     0

      976    12405    3                 END;

      977    12406    2              END;

      978    12407    1           IF F$DCB.RESNT.TYP='NC' THEN

  12407  2 002515   200054 470500                    LDP0    JDCB$,,AUTO
         2 002516   000026 220100                    LDX0    22,,PR0
         2 002517   000033 100000 0                  CMPX0   USRTJNERR+3
         2 002520   002524 601000 2                  TNZ     s:12409

      979    12408    1              CALL KIS$OSI_TRUNC;

  12408  2 002521   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002522   000000 701000 xent               TSX1    KIS$OSI_TRUNC
         2 002523   000000 011000                    NOP     0

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:134  
      980    12409    2           IF F$DCB.RESNT.TYP = 'CL' THEN DO;

  12409  2 002524   200054 470500                    LDP0    JDCB$,,AUTO
         2 002525   000026 220100                    LDX0    22,,PR0
         2 002526   000034 100000 0                  CMPX0   USRTJNERR+4
         2 002527   002645 601000 2                  TNZ     s:12439

      981    12410    2              LDCT$ = NK$LDCT$(F$DCB.LDCTX);

  12410  2 002530   000051 221100                    LDX1    41,,PR0
         2 002531   000000 471400 xsym               LDP1    N$DCT$$
         2 002532   100000 236111                    LDQ     0,X1,PR1
         2 002533   200066 756100                    STQ     LDCT$,,AUTO

      982    12411    2              RWPARM = K_RWPARM_CON;

  12411  2 002534   000100 100400                    MLR     fill='000'O
         2 002535   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 002536   200004 000234                    ADSC9   RWPARM,,AUTO             cn=0,n=156

      983    12412    2              RWPARM.MRKTYP = %KV_VDOMRKTYP_ENDACK;

  12412  2 002537   001000 236007                    LDQ     512,DL
         2 002540   200044 552110                    STBQ    RWPARM+32,'10'O,AUTO

      984    12413    2              RWPARM.STR =LDCT$->NK$LDCT.NOWAIT.STREAM;

  12413  2 002541   200066 473500                    LDP3    LDCT$,,AUTO
         2 002542   300010 236100                    LDQ     8,,PR3
         2 002543   000022 772000                    QRL     18
         2 002544   200044 552104                    STBQ    RWPARM+32,'04'O,AUTO

      985    12414                   %LOCK(G#=LDCT$->NK$LDCT.LOCK);
             12415    2   CALL HFC$LOCK(LDCT$->NK$LDCT.LOCK);

  12415  2 002545   200066 236100                    LDQ     LDCT$,,AUTO
         2 002546   000020 036003                    ADLQ    16,DU
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:135  
         2 002547   200102 756100                    STQ     TYPE+1,,AUTO
         2 002550   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002551   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002552   000000 701000 xent               TSX1    HFC$LOCK
         2 002553   000000 011000                    NOP     0

      986    12417    2              CALL KIA$FCNOU(LDCT$->NK$LDCT,%KV_VDO_FNC_RQSDAT,RWPARM)

  12417  2 002554   200004 630500                    EPPR0   RWPARM,,AUTO
         2 002555   200104 450500                    STP0    TYPE+3,,AUTO
         2 002556   000024 236000 3                  LDQ     20
         2 002557   200066 235100                    LDA     LDCT$,,AUTO
         2 002560   200102 757100                    STAQ    TYPE+1,,AUTO
         2 002561   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002562   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002563   000000 701000 xent               TSX1    KIA$FCNOU
         2 002564   002607 702000 2                  TSX2    s:12425

      987    12418    3              WHENRETURN DO;

      988    12419    3                 LDCT$->NK$LDCT.LKFLG.WTMRK = '1'B;

  12419  2 002565   200066 470500                    LDP0    LDCT$,,AUTO
         2 002566   020000 236003                    LDQ     8192,DU
         2 002567   000011 256100                    ORSQ    9,,PR0

      989    12420    3                 CALL SSR$REG(%SS_CW,LDCT$);

  12420  2 002570   200066 630500                    EPPR0   LDCT$,,AUTO
         2 002571   200103 450500                    STP0    TYPE+2,,AUTO
         2 002572   000026 236000 3                  LDQ     22
         2 002573   200102 756100                    STQ     TYPE+1,,AUTO
         2 002574   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002575   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002576   000000 701000 xent               TSX1    SSR$REG
         2 002577   000000 011000                    NOP     0

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:136  
      990    12421                      %LOCK(G#=LDCT$->NK$LDCT.LOCK);
             12422    3   CALL HFC$LOCK(LDCT$->NK$LDCT.LOCK);

  12422  2 002600   200066 236100                    LDQ     LDCT$,,AUTO
         2 002601   000020 036003                    ADLQ    16,DU
         2 002602   200102 756100                    STQ     TYPE+1,,AUTO
         2 002603   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002604   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002605   000000 701000 xent               TSX1    HFC$LOCK
         2 002606   000000 011000                    NOP     0

      991    12424    3                 END;

      992    12425    3              DO WHILE F$DCB.FCN.CNT(0) > 0;

  12425  2 002607   200054 470500                    LDP0    JDCB$,,AUTO
         2 002610   000074 236100                    LDQ     60,,PR0
         2 002611   377000 316003                    CANQ    130560,DU
         2 002612   002636 600000 2                  TZE     s:12436

      993    12426    3                 RWPARM = K_RWPARM_CON;

  12426  2 002613   000100 100400                    MLR     fill='000'O
         2 002614   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         2 002615   200004 000234                    ADSC9   RWPARM,,AUTO             cn=0,n=156

      994    12427    3                 RWPARM.MSG_ERRCODE = ERREOD;

  12427  2 002616   000021 236000 0                  LDQ     ERREOD
         2 002617   200043 756100                    STQ     RWPARM+31,,AUTO

      995    12428        /*E*    ERROR:   -E$EOD-2
      996    12429        *       MESSAGE:  End-of-data% on %UF%
      997    12430        *       MESSAGE1: An !EOD was read thru the command stream
      998    12431        */
      999    12432    3                 RWPARM.TYC  = %TYC_EOF;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:137  
  12432  2 002620   000032 236000 0                  LDQ     USRTJNERR+2
         2 002621   200012 756100                    STQ     RWPARM+6,,AUTO

     1000    12433    3                 CALL KIA$COMP(LDCT$->NK$LDCT,RWPARM);

  12433  2 002622   200004 630500                    EPPR0   RWPARM,,AUTO
         2 002623   200103 450500                    STP0    TYPE+2,,AUTO
         2 002624   200066 236100                    LDQ     LDCT$,,AUTO
         2 002625   200102 756100                    STQ     TYPE+1,,AUTO
         2 002626   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002627   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002630   000000 701000 xent               TSX1    KIA$COMP
         2 002631   000000 011000                    NOP     0

     1001    12434    3                 END;

  12434  2 002632   200054 470500                    LDP0    JDCB$,,AUTO
         2 002633   000074 236100                    LDQ     60,,PR0
         2 002634   377000 316003                    CANQ    130560,DU
         2 002635   002613 601000 2                  TNZ     s:12426

     1002    12435                   %UNLOCK(G#=LDCT$->NK$LDCT.LOCK);
             12436    2   CALL HFC$UNLOCK(LDCT$->NK$LDCT.LOCK);

  12436  2 002636   200066 236100                    LDQ     LDCT$,,AUTO
         2 002637   000020 036003                    ADLQ    16,DU
         2 002640   200102 756100                    STQ     TYPE+1,,AUTO
         2 002641   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002642   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002643   000000 701000 xent               TSX1    HFC$UNLOCK
         2 002644   000000 011000                    NOP     0

     1003    12438    2              END;

     1004    12439    1           IF F$DCB.ASN=%FILE# AND F$DCB.ORG=%RANDOM# AND F$DCB.ACS>%JRNL#

  12439  2 002645   200054 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:138  
         2 002646   000032 236100                    LDQ     26,,PR0
         2 002647   777000 376007                    ANQ     -512,DL
         2 002650   001000 116007                    CMPQ    512,DL
         2 002651   002711 601000 2                  TNZ     s:12446
         2 002652   000032 236100                    LDQ     26,,PR0
         2 002653   777000 376003                    ANQ     -512,DU
         2 002654   003000 116003                    CMPQ    1536,DU
         2 002655   002711 601000 2                  TNZ     s:12446
         2 002656   000036 236100                    LDQ     30,,PR0
         2 002657   000777 376007                    ANQ     511,DL
         2 002660   000005 116007                    CMPQ    5,DL
         2 002661   002711 602000 2                  TNC     s:12446
         2 002662   000004 236100                    LDQ     4,,PR0
         2 002663   100000 316003                    CANQ    32768,DU
         2 002664   002711 600000 2                  TZE     s:12446
         2 002665   200063 235100                    LDA     ENTFLG,,AUTO
         2 002666   002711 601000 2                  TNZ     s:12446

     1005    12440    2             AND F$DCB.FFLG.WNEW AND ENTFLG=0 THEN DO;

     1006    12441    2              IF F$DCB.CFU$->FM$CFU.UGRANS=0 THEN EXIT; /* No file to write to.  */

  12441  2 002667   000066 471500                    LDP1    54,,PR0
         2 002670   100004 236100                    LDQ     4,,PR1
         2 002671   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 002672   002711 600000 2                  TZE     s:12446

     1007    12442    2              I=F$DCB.WSR;

  12442  2 002673   000040 236100                    LDQ     32,,PR0
         2 002674   000022 772000                    QRL     18
         2 002675   000777 376007                    ANQ     511,DL
         2 002676   200057 756100                    STQ     I,,AUTO

     1008    12443    2              IF I=7 THEN I=%USERWSQ;

  12443  2 002677   000007 116007                    CMPQ    7,DL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:139  
         2 002700   002703 601000 2                  TNZ     s:12444

  12443  2 002701   000010 235007                    LDA     8,DL
         2 002702   200057 755100                    STA     I,,AUTO

     1009    12444    2              CALL FMI$DSWRITE (I);

  12444  2 002703   200057 633500                    EPPR3   I,,AUTO
         2 002704   200102 453500                    STP3    TYPE+1,,AUTO
         2 002705   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002706   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002707   000000 701000 xent               TSX1    FMI$DSWRITE
         2 002710   000000 011000                    NOP     0

     1010    12445    2              END;

     1011    12446    1           BCDCB$=JDCB$;

  12446  2 002711   200054 236100                    LDQ     JDCB$,,AUTO
         2 002712   200055 756100                    STQ     BCDCB$,,AUTO

     1012    12447    1           BCDCB.SID=%RONCSID;             /* BYPASS CACHE PTR                   */

  12447  2 002713   006124 236007                    LDQ     3156,DL
         2 002714   200055 752103                    STCQ    BCDCB$,'03'O,AUTO

     1013    12448    1           IF BCDCB$->F$DCB.FCN(0) THEN    /* WAIT FOR ANY I/O                   */

  12448  2 002715   200055 470500                    LDP0    BCDCB$,,AUTO
         2 002716   000074 236100                    LDQ     60,,PR0
         2 002717   777000 316003                    CANQ    -512,DU
         2 002720   002731 600000 2                  TZE     s:12450

     1014    12449    1              CALL SSR$REG(%SS_IIP,BCDCB$->F$DCB.FCN(0));

  12449  2 002721   200055 236100                    LDQ     BCDCB$,,AUTO
         2 002722   000074 036003                    ADLQ    60,DU
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:140  
         2 002723   000006 235000 3                  LDA     6
         2 002724   200102 757100                    STAQ    TYPE+1,,AUTO
         2 002725   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002726   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002727   000000 701000 xent               TSX1    SSR$REG
         2 002730   000000 011000                    NOP     0

     1015    12450    2           DO CASE(F$DCB.IASN);

  12450  2 002731   200054 470500                    LDP0    JDCB$,,AUTO
         2 002732   000103 720100                    LXL0    67,,PR0
         2 002733   000777 360003                    ANX0    511,DU
         2 002734   000013 100003                    CMPX0   11,DU
         2 002735   002737 602010 2                  TNC     s:12450+6,X0
         2 002736   003001 710000 2                  TRA     s:12464
         2 002737   003001 710000 2                  TRA     s:12464
         2 002740   003001 710000 2                  TRA     s:12464
         2 002741   002752 710000 2                  TRA     s:12452
         2 002742   002756 710000 2                  TRA     s:12455
         2 002743   003001 710000 2                  TRA     s:12464
         2 002744   002772 710000 2                  TRA     s:12460
         2 002745   003001 710000 2                  TRA     s:12464
         2 002746   003001 710000 2                  TRA     s:12464
         2 002747   003001 710000 2                  TRA     s:12464
         2 002750   003001 710000 2                  TRA     s:12464
         2 002751   002752 710000 2                  TRA     s:12452

     1016    12451    2            CASE (%TAPE#, %OD#);

     1017    12452    2              CALL FTT$TRUNC;

  12452  2 002752   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002753   000000 701000 xent               TSX1    FTT$TRUNC
         2 002754   000000 011000                    NOP     0

     1018    12453    2              RETURN;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:141  
  12453  2 002755   000000 702200 xent               TSX2  ! X66_ARET

     1019    12454    2            CASE(%DEVICE#);

     1020    12455    3              DO I=0 TO 4;

  12455  2 002756   200057 450100                    STZ     I,,AUTO

     1021    12456    3                 CALL FMD$RELBUF(I);

  12456  2 002757   200057 630500                    EPPR0   I,,AUTO
         2 002760   200102 450500                    STP0    TYPE+1,,AUTO
         2 002761   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 002762   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002763   000000 701000 xent               TSX1    FMD$RELBUF
         2 002764   000000 011000                    NOP     0

     1022    12457    3                 END;

  12457  2 002765   200057 054100                    AOS     I,,AUTO
         2 002766   200057 235100                    LDA     I,,AUTO
         2 002767   000004 115007                    CMPA    4,DL
         2 002770   002757 604400 2                  TMOZ    s:12456

     1023    12458    2              RETURN;

  12458  2 002771   000000 702200 xent               TSX2  ! X66_ARET

     1024    12459    2            CASE(%STREAM#);

     1025    12460    2              B$JIT.DCB$=F$DCB.CFU$;       /* POINT TO SECRET DCB                */

  12460  2 002772   000066 236100                    LDQ     54,,PR0
         2 002773   000000 471400 xsym               LDP1    B$JIT$
         2 002774   100232 756100                    STQ     154,,PR1

     1026    12461    2              IF B$JIT.DCB$=ADDR(NIL) THEN RETURN;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:142  

  12461  2 002775   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002776   003000 601000 2                  TNZ     s:12462

  12461  2 002777   000000 702200 xent               TSX2  ! X66_ARET

     1027    12462    2              GOTO TRUNC;

  12462  2 003000   002426 710000 2                  TRA     TRUNC

     1028    12463    2            END;

     1029    12464    2           DO I=0 TO 4;

  12464  2 003001   200057 450100                    STZ     I,,AUTO

     1030    12465    2              IF NOT B$JIT.DCB$->F$DCB.BFR.CVM(I) THEN

  12465  2 003002   000000 470400 xsym               LDP0    B$JIT$
         2 003003   000232 471500                    LDP1    154,,PR0
         2 003004   200057 720100                    LXL0    I,,AUTO
         2 003005   100115 236110                    LDQ     77,X0,PR1
         2 003006   040000 316003                    CANQ    16384,DU
         2 003007   003037 601000 2                  TNZ     s:12474

     1031    12466    3              DO;

     1032    12467    3                 IF F$DCB.BFR1.CX(I) > 0 THEN

  12467  2 003010   200054 473500                    LDP3    JDCB$,,AUTO
         2 003011   300122 721110                    LXL1    82,X0,PR3
         2 003012   003030 600000 2                  TZE     s:12471

     1033    12468    3                    IF FMC$CACHETBL.USECNT(F$DCB.BFR1.CX(I)) > 1 THEN

  12468  2 003013   300122 236110                    LDQ     82,X0,PR3
         2 003014   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:143  
         2 003015   000006 402007                    MPY     6,DL
         2 003016   000000 474400 xsym               LDP4    FMC_CACHE$
         2 003017   400002 722106                    LXL2    2,QL,PR4
         2 003020   000002 102003                    CMPX2   2,DU
         2 003021   003030 602000 2                  TNC     s:12471

     1034    12469    3                       CALL FMD$WRTSV(I);  /* MAKE SURE WE ACTUALLY WRITE        */

  12469  2 003022   200057 635500                    EPPR5   I,,AUTO
         2 003023   200102 455500                    STP5    TYPE+1,,AUTO
         2 003024   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003025   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003026   000000 701000 xent               TSX1    FMD$WRTSV
         2 003027   000000 011000                    NOP     0

     1035    12470        /* TO DISK IF THE GRANULE IS CACHED                                           */
     1036    12471    3                 CALL FMD$FLSHBUF(I);

  12471  2 003030   200057 630500                    EPPR0   I,,AUTO
         2 003031   200102 450500                    STP0    TYPE+1,,AUTO
         2 003032   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003033   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003034   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 003035   000000 011000                    NOP     0

     1037    12472    3                 END;

  12472  2 003036   003064 710000 2                  TRA     s:12481

     1038    12473    3              ELSE DO;

     1039    12474    3                 CALL ENQWR ALTRET(ERRDEQ);

  12474  2 003037   003253 701000 2                  TSX1    ENQWR
         2 003040   001027 702000 2                  TSX2    ERRDEQ

     1040    12475    4                 IF B$JIT.DCB$->F$DCB.CFU$->FM$CFUJ.UPD THEN DO;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:144  

  12475  2 003041   000000 470400 xsym               LDP0    B$JIT$
         2 003042   000232 471500                    LDP1    154,,PR0
         2 003043   100066 473500                    LDP3    54,,PR1
         2 003044   300005 234100                    SZN     5,,PR3
         2 003045   003054 605000 2                  TPL     s:12478

     1041    12476    4                    CALL FMD$WRTSV(I);

  12476  2 003046   200057 634500                    EPPR4   I,,AUTO
         2 003047   200102 454500                    STP4    TYPE+1,,AUTO
         2 003050   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003051   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003052   000000 701000 xent               TSX1    FMD$WRTSV
         2 003053   000000 011000                    NOP     0

     1042    12477    4                    END;

     1043    12478    3                 CALL DEQ;

  12478  2 003054   003561 701000 2                  TSX1    DEQ
         2 003055   000000 011000                    NOP     0

     1044    12479    3                 CALL FMD$RELBUF(I);

  12479  2 003056   200057 630500                    EPPR0   I,,AUTO
         2 003057   200102 450500                    STP0    TYPE+1,,AUTO
         2 003060   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003061   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003062   000000 701000 xent               TSX1    FMD$RELBUF
         2 003063   000000 011000                    NOP     0

     1045    12480    3                 END;

     1046    12481    2              END;

  12481  2 003064   200057 054100                    AOS     I,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:145  
         2 003065   200057 235100                    LDA     I,,AUTO
         2 003066   000004 115007                    CMPA    4,DL
         2 003067   003002 604400 2                  TMOZ    s:12465

     1047    12482    1           RETURN;

  12482  2 003070   000000 702200 xent               TSX2  ! X66_ARET

     1048    12483        /**/
     1049    12484        /**/
     1050    12485        /**/
     1051    12486    1   FMF$SETFMA: ENTRY;

  12486  2 003071   000000 700200 xent  FMF$SETFMA   TSX0  ! X66_AUTO_1
         2 003072   000114 000001                    ZERO    76,1

     1052    12487    1           B$JIT.DCB$ = B$M$STAR$;

  12487  2 003073   000000 236000 xsym               LDQ     B$M$STAR$
         2 003074   000000 470400 xsym               LDP0    B$JIT$
         2 003075   000232 756100                    STQ     154,,PR0

     1053    12488    1           JDCB$ = B$JIT.DCB$;

  12488  2 003076   200054 756100                    STQ     JDCB$,,AUTO

     1054    12489    1           IF F$DCB.FCD THEN

  12489  2 003077   200054 471500                    LDP1    JDCB$,,AUTO
         2 003100   100031 236100                    LDQ     25,,PR1
         2 003101   020000 316007                    CANQ    8192,DL
         2 003102   003106 600000 2                  TZE     s:12491

     1055    12490    1              CALL FMP$CLSJ;

  12490  2 003103   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003104   000000 701000 xent               TSX1    FMP$CLSJ
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:146  
         2 003105   000000 011000                    NOP     0

     1056    12491    1           CALL FMM$SCRUB(B$JIT.DCB$);

  12491  2 003106   000000 236000 xsym               LDQ     B$JIT$
         2 003107   000232 036003                    ADLQ    154,DU
         2 003110   200102 756100                    STQ     TYPE+1,,AUTO
         2 003111   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003112   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003113   000000 701000 xent               TSX1    FMM$SCRUB
         2 003114   000000 011000                    NOP     0

     1057    12492    1           F$DCB.ASN = %FILE#;

  12492  2 003115   200054 470500                    LDP0    JDCB$,,AUTO
         2 003116   001000 236007                    LDQ     512,DL
         2 003117   000032 552110                    STBQ    26,'10'O,PR0

     1058    12493    1           F$DCB.FUN = %IN#;

  12493  2 003120   000002 236003                    LDQ     2,DU
         2 003121   000032 552120                    STBQ    26,'20'O,PR0

     1059    12494    1           B$JIT.FACNACS='0'B;

  12494  2 003122   000000 220003                    LDX0    0,DU
         2 003123   000000 471400 xsym               LDP1    B$JIT$
         2 003124   100235 440100                    SXL0    157,,PR1

     1060    12495    1           CALL HFF$NILERASE(0) ALTRET(RSET); /* No account specified.           */

  12495  2 003125   000004 630400 3                  EPPR0   4
         2 003126   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003127   000000 701000 xent               TSX1    HFF$NILERASE
         2 003130   003240 702000 2                  TSX2    RSET

     1061    12496    1           CALL HFF$DSIZ(B$PS0$,I);
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:147  

  12496  2 003131   200057 630500                    EPPR0   I,,AUTO
         2 003132   200103 450500                    STP0    TYPE+2,,AUTO
         2 003133   000027 236000 3                  LDQ     23
         2 003134   200102 756100                    STQ     TYPE+1,,AUTO
         2 003135   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003136   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003137   000000 701000 xent               TSX1    HFF$DSIZ
         2 003140   000000 011000                    NOP     0

     1062    12497    1           F$DCB.ACCT = B$PS0$->CHARS;

  12497  2 003141   000000 470400 xsym               LDP0    B$PS0$
         2 003142   200057 720100                    LXL0    I,,AUTO
         2 003143   200054 471500                    LDP1    JDCB$,,AUTO
         2 003144   040100 100540                    MLR     fill='040'O
         2 003145   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 003146   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8

     1063    12498    2           CALL HFF$NILERASE(1) WHENRETURN DO;

  12498  2 003147   000006 630400 3                  EPPR0   6
         2 003150   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003151   000000 701000 xent               TSX1    HFF$NILERASE
         2 003152   003172 702000 2                  TSX2    s:12503

     1064    12499    2              CALL HFF$DSIZ(B$PS1$,I);

  12499  2 003153   200057 630500                    EPPR0   I,,AUTO
         2 003154   200103 450500                    STP0    TYPE+2,,AUTO
         2 003155   000030 236000 3                  LDQ     24
         2 003156   200102 756100                    STQ     TYPE+1,,AUTO
         2 003157   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003160   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003161   000000 701000 xent               TSX1    HFF$DSIZ
         2 003162   000000 011000                    NOP     0

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:148  
     1065    12500    2              F$DCB.PSN = B$PS1$->CHARS;

  12500  2 003163   000000 470400 xsym               LDP0    B$PS1$
         2 003164   200057 720100                    LXL0    I,,AUTO
         2 003165   200054 471500                    LDP1    JDCB$,,AUTO
         2 003166   040100 100540                    MLR     fill='040'O
         2 003167   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 003170   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6

     1066    12501    2              END;

  12501  2 003171   003176 710000 2                  TRA     s:12505

     1067    12502    2           WHENALTRETURN DO;               /* No packset specified.              */

     1068    12503    2              F$DCB.PSN = ' ';

  12503  2 003172   200054 470500                    LDP0    JDCB$,,AUTO
         2 003173   040100 100400                    MLR     fill='040'O
         2 003174   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 003175   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6

     1069    12504    2              END;

     1070    12505    1           CALL FMM$DFLOPN;

  12505  2 003176   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003177   000000 701000 xent               TSX1    FMM$DFLOPN
         2 003200   000000 011000                    NOP     0

     1071    12506    1           IF NOT F$DCB.FCD AND B$JIT.ERR.CODE ~= %E$NOFILE THEN

  12506  2 003201   200054 470500                    LDP0    JDCB$,,AUTO
         2 003202   000031 236100                    LDQ     25,,PR0
         2 003203   020000 316007                    CANQ    8192,DL
         2 003204   003213 601000 2                  TNZ     s:12508
         2 003205   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:149  
         2 003206   100012 236100                    LDQ     10,,PR1
         2 003207   377770 376007                    ANQ     131064,DL
         2 003210   001610 116007                    CMPQ    904,DL
         2 003211   003213 600000 2                  TZE     s:12508

     1072    12507    1              RETURN;

  12507  2 003212   000000 702200 xent               TSX2  ! X66_ARET

     1073    12508    1           IF F$DCB.FCD THEN

  12508  2 003213   000031 236100                    LDQ     25,,PR0
         2 003214   020000 316007                    CANQ    8192,DL
         2 003215   003221 600000 2                  TZE     s:12510

     1074    12509    1              CALL FMP$CLSJ;

  12509  2 003216   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003217   000000 701000 xent               TSX1    FMP$CLSJ
         2 003220   000000 011000                    NOP     0

     1075    12510    2           IF NOT F$DCB.FFLG THEN DO;

  12510  2 003221   200054 470500                    LDP0    JDCB$,,AUTO
         2 003222   000004 220100                    LDX0    4,,PR0
         2 003223   003230 601000 2                  TNZ     s:12514

     1076    12511    2              B$JIT.ERR = ERRNOACCT;

  12511  2 003224   000016 236000 0                  LDQ     ERRNOACCT
         2 003225   000000 471400 xsym               LDP1    B$JIT$
         2 003226   100012 756100                    STQ     10,,PR1

     1077    12512    2              RETURN;

  12512  2 003227   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:150  
     1078    12513    2              END;
     1079    12514    1           B$JIT.ERR = '0'B;

  12514  2 003230   000000 471400 xsym               LDP1    B$JIT$
         2 003231   100012 450100                    STZ     10,,PR1

     1080    12515    1           B$JIT.FACCN = F$DCB.ACCT;

  12515  2 003232   000020 237100                    LDAQ    16,,PR0
         2 003233   100006 757100                    STAQ    6,,PR1

     1081    12516    1           B$JIT.FPSN = F$DCB.PSN;

  12516  2 003234   040100 100500                    MLR     fill='040'O
         2 003235   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         2 003236   100021 000006                    ADSC9   17,,PR1                  cn=0,n=6

     1082    12517    1           RETURN;

  12517  2 003237   000000 702200 xent               TSX2  ! X66_ARET

     1083    12518        /**/
     1084    12519    1   RSET:   B$JIT.FACCN=B$JIT.ACCN;         /* Reset account, packset.            */

  12519  2 003240   000000 470400 xsym  RSET         LDP0    B$JIT$
         2 003241   040100 100500                    MLR     fill='040'O
         2 003242   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         2 003243   000006 000010                    ADSC9   6,,PR0                   cn=0,n=8

     1085    12520    1           B$JIT.FPSN=' ';

  12520  2 003244   040100 100400                    MLR     fill='040'O
         2 003245   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 003246   000021 000006                    ADSC9   17,,PR0                  cn=0,n=6

     1086    12521    1           RETURN;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:151  
  12521  2 003247   000000 702200 xent               TSX2  ! X66_ARET

     1087    12522        /**/
     1088    12523        /**/
     1089    12524        /**/
     1090    12525    1   ENQRD:  PROC ALTRET;

  12525  2 003250   200100 741300       ENQRD        STX1  ! I+1,,AUTO

     1091    12526    2   DCL TYPE UBIN;
     1092    12527        /**/
     1093    12528    2           TYPE=0;

  12528  2 003251   200101 450100                    STZ     TYPE,,AUTO

     1094    12529    2           GOTO COMMON;

  12529  2 003252   003256 710000 2                  TRA     COMMON

     1095    12530    2   ENQWR:  ENTRY ALTRET;

  12530  2 003253   200100 741300       ENQWR        STX1  ! I+1,,AUTO

     1096    12531    2           TYPE=1;

  12531  2 003254   000001 235007                    LDA     1,DL
         2 003255   200101 755100                    STA     TYPE,,AUTO

     1097    12532    2   COMMON: IF F$DCB.IORG=%RANDOM# AND FPTCODE~=5 /* FPTEXTEND */ THEN

  12532  2 003256   200054 470500       COMMON       LDP0    JDCB$,,AUTO
         2 003257   000070 236100                    LDQ     56,,PR0
         2 003260   077000 376003                    ANQ     32256,DU
         2 003261   003000 116003                    CMPQ    1536,DU
         2 003262   003271 601000 2                  TNZ     s:12534
         2 003263   200003 471500                    LDP1    @FPTCODE,,AUTO
         2 003264   100000 235100                    LDA     0,,PR1
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:152  
         2 003265   000005 115007                    CMPA    5,DL
         2 003266   003271 600000 2                  TZE     s:12534

     1098    12533    2              RETURN;                      /* No need to ENQ for star files      */

  12533  2 003267   200100 221300                    LDX1  ! I+1,,AUTO
         2 003270   000001 702211                    TSX2  ! 1,X1

     1099    12534    2           CFU$=F$DCB.CFU$;

  12534  2 003271   000066 236100                    LDQ     54,,PR0
         2 003272   200056 756100                    STQ     CFU$,,AUTO

     1100    12535    3           DO CASE(TYPE);

  12535  2 003273   200101 235100                    LDA     TYPE,,AUTO
         2 003274   000002 115007                    CMPA    2,DL
         2 003275   003277 602005 2                  TNC     s:12535+4,AL
         2 003276   003320 710000 2                  TRA     s:12543
         2 003277   003311 710000 2                  TRA     s:12540
         2 003300   003301 710000 2                  TRA     s:12537

     1101    12536    3            CASE(1);                       /* WRITE - 1 AT A TIME                */

     1102    12537    3              CALL UQB$MENQXB(F$DCB.CFU$)

  12537  2 003301   200054 236100                    LDQ     JDCB$,,AUTO
         2 003302   000066 036003                    ADLQ    54,DU
         2 003303   200102 756100                    STQ     TYPE+1,,AUTO
         2 003304   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003305   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003306   000000 701000 xent               TSX1    UQB$MENQXB
         2 003307   003557 702000 2                  TSX2    QERR
         2 003310   003320 710000 2                  TRA     s:12543

     1103    12538    3                ALTRET(QERR);
     1104    12539    3            CASE(0);                       /* READ - MANY READERS NO WRITERS     */
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:153  

     1105    12540    3              CALL UQB$MENQSB(F$DCB.CFU$)

  12540  2 003311   200054 236100                    LDQ     JDCB$,,AUTO
         2 003312   000066 036003                    ADLQ    54,DU
         2 003313   200102 756100                    STQ     TYPE+1,,AUTO
         2 003314   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003315   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003316   000000 701000 xent               TSX1    UQB$MENQSB
         2 003317   003557 702000 2                  TSX2    QERR

     1106    12541    3                ALTRET(QERR);
     1107    12542    3            END;

     1108    12543    2           F$DCB.ENQF='1'B;

  12543  2 003320   200054 470500                    LDP0    JDCB$,,AUTO
         2 003321   000200 236007                    LDQ     128,DL
         2 003322   000064 256100                    ORSQ    52,,PR0

     1109    12544    3           IF F$DCB.ACS~=%JRNL# THEN DO;

  12544  2 003323   000036 236100                    LDQ     30,,PR0
         2 003324   000777 376007                    ANQ     511,DL
         2 003325   000004 116007                    CMPQ    4,DL
         2 003326   003456 600000 2                  TZE     s:12582

     1110    12545    3              IF TYPE = 1 THEN

  12545  2 003327   200101 235100                    LDA     TYPE,,AUTO
         2 003330   000001 115007                    CMPA    1,DL
         2 003331   003373 601000 2                  TNZ     s:12557

     1111    12546    4              DO I=0 TO 4;

  12546  2 003332   200057 450100                    STZ     I,,AUTO

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:154  
     1112    12547    5                 IF F$DCB.BFR1.CX(I) > 0 THEN DO;

  12547  2 003333   200054 470500                    LDP0    JDCB$,,AUTO
         2 003334   200057 720100                    LXL0    I,,AUTO
         2 003335   000122 721110                    LXL1    82,X0,PR0
         2 003336   003355 600000 2                  TZE     s:12552

     1113    12548    5                    IF FMC$CACHETBL.FLAGS.ERR(F$DCB.BFR1.CX(I)) THEN

  12548  2 003337   000122 236110                    LDQ     82,X0,PR0
         2 003340   777777 376007                    ANQ     -1,DL
         2 003341   000006 402007                    MPY     6,DL
         2 003342   000000 471400 xsym               LDP1    FMC_CACHE$
         2 003343   100004 236106                    LDQ     4,QL,PR1
         2 003344   000002 316007                    CANQ    2,DL
         2 003345   003366 600000 2                  TZE     s:12555

     1114    12549    5                       CALL FMD$RELBUF(I);

  12549  2 003346   200057 633500                    EPPR3   I,,AUTO
         2 003347   200102 453500                    STP3    TYPE+1,,AUTO
         2 003350   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003351   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003352   000000 701000 xent               TSX1    FMD$RELBUF
         2 003353   000000 011000                    NOP     0

     1115    12550    5                    END;

  12550  2 003354   003366 710000 2                  TRA     s:12555

     1116    12551    5                 ELSE DO;

     1117    12552    5                    IF I ~= 2 THEN

  12552  2 003355   200057 235100                    LDA     I,,AUTO
         2 003356   000002 115007                    CMPA    2,DL
         2 003357   003366 600000 2                  TZE     s:12555
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:155  

     1118    12553    5                       CALL FMD$RELBUF(I);

  12553  2 003360   200057 631500                    EPPR1   I,,AUTO
         2 003361   200102 451500                    STP1    TYPE+1,,AUTO
         2 003362   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003363   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003364   000000 701000 xent               TSX1    FMD$RELBUF
         2 003365   000000 011000                    NOP     0

     1119    12554    5                    END;

     1120    12555    4                 END;                      /* DO I                               */

  12555  2 003366   200057 054100                    AOS     I,,AUTO
         2 003367   200057 235100                    LDA     I,,AUTO
         2 003370   000004 115007                    CMPA    4,DL
         2 003371   003333 604400 2                  TMOZ    s:12547
         2 003372   003443 710000 2                  TRA     s:12578

     1121    12556    3              ELSE
     1122    12557    3                 IF F$DCB.MODCNT ~= FM$CFU.MODCNT THEN

  12557  2 003373   200056 471500                    LDP1    CFU$,,AUTO
         2 003374   100006 236100                    LDQ     6,,PR1
         2 003375   000025 772000                    QRL     21
         2 003376   200102 756100                    STQ     TYPE+1,,AUTO
         2 003377   000100 236100                    LDQ     64,,PR0
         2 003400   000022 772000                    QRL     18
         2 003401   200102 116100                    CMPQ    TYPE+1,,AUTO
         2 003402   003443 600000 2                  TZE     s:12578

     1123    12558    4                 DO I=0 TO 4;

  12558  2 003403   200057 450100                    STZ     I,,AUTO

     1124    12559    5                    IF F$DCB.BFR1.CX(I) > 0 THEN DO;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:156  

  12559  2 003404   200054 470500                    LDP0    JDCB$,,AUTO
         2 003405   200057 720100                    LXL0    I,,AUTO
         2 003406   000122 721110                    LXL1    82,X0,PR0
         2 003407   003426 600000 2                  TZE     s:12564

     1125    12560    5                       IF FMC$CACHETBL.FLAGS.ERR(F$DCB.BFR1.CX(I)) THEN

  12560  2 003410   000122 236110                    LDQ     82,X0,PR0
         2 003411   777777 376007                    ANQ     -1,DL
         2 003412   000006 402007                    MPY     6,DL
         2 003413   000000 471400 xsym               LDP1    FMC_CACHE$
         2 003414   100004 236106                    LDQ     4,QL,PR1
         2 003415   000002 316007                    CANQ    2,DL
         2 003416   003437 600000 2                  TZE     s:12567

     1126    12561    5                          CALL FMD$RELBUF(I);

  12561  2 003417   200057 633500                    EPPR3   I,,AUTO
         2 003420   200102 453500                    STP3    TYPE+1,,AUTO
         2 003421   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003422   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003423   000000 701000 xent               TSX1    FMD$RELBUF
         2 003424   000000 011000                    NOP     0

     1127    12562    5                       END;

  12562  2 003425   003437 710000 2                  TRA     s:12567

     1128    12563    5                    ELSE DO;

     1129    12564    5                       IF I ~= 2 THEN

  12564  2 003426   200057 235100                    LDA     I,,AUTO
         2 003427   000002 115007                    CMPA    2,DL
         2 003430   003437 600000 2                  TZE     s:12567

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:157  
     1130    12565    5                          CALL FMD$RELBUF(I);

  12565  2 003431   200057 631500                    EPPR1   I,,AUTO
         2 003432   200102 451500                    STP1    TYPE+1,,AUTO
         2 003433   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003434   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003435   000000 701000 xent               TSX1    FMD$RELBUF
         2 003436   000000 011000                    NOP     0

     1131    12566    5                       END;

     1132    12567    4                    END;                   /* DO I                               */

  12567  2 003437   200057 054100                    AOS     I,,AUTO
         2 003440   200057 235100                    LDA     I,,AUTO
         2 003441   000004 115007                    CMPA    4,DL
         2 003442   003404 604400 2                  TMOZ    s:12559

     1133    12568        /* If this is a shared file, then we have to do some buffer
     1134    12569        juggling to make sure that the user's buffers are current.
     1135    12570        First of all, if this is a write, then flush out any uncached
     1136    12571        buffers.  This prevents us from writing uncached buffers to
     1137    12572        disk, invalidating the cache.  Also, if there are any buffers
     1138    12573        in error, then flush those out now also.  Next, if this is a
     1139    12574        read, then flush out any uncached buffers only if we weren't
     1140    12575        the last updaters.  Again, flush any cached buffers marked with
     1141    12576        the error flag.  The reason we don't flush buffer 2 is because
     1142    12577        it is the TDA, and shouldn't be updated. */
     1143    12578    3              IF TYPE~=0 THEN              /* Updating                           */

  12578  2 003443   200101 235100                    LDA     TYPE,,AUTO
         2 003444   003545 600000 2                  TZE     s:12603

     1144    12579    3                 FM$CFU.MODCNT=FM$CFU.MODCNT+1; /* INCR WRITE COUNT              */

  12579  2 003445   200056 470500                    LDP0    CFU$,,AUTO
         2 003446   000006 236100                    LDQ     6,,PR0
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:158  
         2 003447   000025 772000                    QRL     21
         2 003450   000001 036007                    ADLQ    1,DL
         2 003451   000025 736000                    QLS     21
         2 003452   000006 676100                    ERQ     6,,PR0
         2 003453   777770 376003                    ANQ     -8,DU
         2 003454   000006 656100                    ERSQ    6,,PR0

     1145    12580    3              END;

  12580  2 003455   003545 710000 2                  TRA     s:12603

     1146    12581    2           ELSE
     1147    12582    2              IF FPTCODE=8 /* PFILEOF */ THEN

  12582  2 003456   200003 471500                    LDP1    @FPTCODE,,AUTO
         2 003457   100000 235100                    LDA     0,,PR1
         2 003460   000010 115007                    CMPA    8,DL
         2 003461   003473 601000 2                  TNZ     s:12590

     1148    12583    2                 IF FM$CFUJ.PAGE#=0 THEN

  12583  2 003462   200056 473500                    LDP3    CFU$,,AUTO
         2 003463   300005 720100                    LXL0    5,,PR3
         2 003464   003467 601000 2                  TNZ     s:12586

     1149    12584    2                    RETURN;                /* FIRST OPENER - KEEP GOING          */

  12584  2 003465   200100 221300                    LDX1  ! I+1,,AUTO
         2 003466   000001 702211                    TSX2  ! 1,X1

     1150    12585    3                 ELSE DO;

     1151    12586    3                    B$JIT.ERR='0'B;   /* SOMEONE GOT HERE FIRST - JUST GET OUT   */

  12586  2 003467   000000 474400 xsym               LDP4    B$JIT$
         2 003470   400012 450100                    STZ     10,,PR4

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:159  
     1152    12587    3                    ALTRETURN;

  12587  2 003471   200100 221300                    LDX1  ! I+1,,AUTO
         2 003472   000000 702211                    TSX2  ! 0,X1

     1153    12588    3                    END;
     1154    12589    3              ELSE DO;                     /* Journal                            */

     1155    12590    4                 IF FM$CFUJ.PAGE#=0 THEN DO;

  12590  2 003473   200056 473500                    LDP3    CFU$,,AUTO
         2 003474   300005 720100                    LXL0    5,,PR3
         2 003475   003503 601000 2                  TNZ     s:12594

     1156    12591    4                    B$JIT.ERR=ERRJRNL;

  12591  2 003476   000006 236000 0                  LDQ     ERRJRNL
         2 003477   000000 474400 xsym               LDP4    B$JIT$
         2 003500   400012 756100                    STQ     10,,PR4

     1157    12592    4                    ALTRETURN;

  12592  2 003501   200100 221300                    LDX1  ! I+1,,AUTO
         2 003502   000000 702211                    TSX2  ! 0,X1

     1158    12593    4                    END;
     1159    12594    4                 IF NOT F$DCB.OWNER AND FM$CFUJ.ERR_WAIT THEN DO;

  12594  2 003503   000064 236100                    LDQ     52,,PR0
         2 003504   040000 316007                    CANQ    16384,DL
         2 003505   003535 601000 2                  TNZ     s:12600
         2 003506   300005 236100                    LDQ     5,,PR3
         2 003507   200000 316003                    CANQ    65536,DU
         2 003510   003535 600000 2                  TZE     s:12600

     1160    12595    4                    CALL UQB$MDEQ(F$DCB.CFU$);

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:160  
  12595  2 003511   200054 236100                    LDQ     JDCB$,,AUTO
         2 003512   000066 036003                    ADLQ    54,DU
         2 003513   200102 756100                    STQ     TYPE+1,,AUTO
         2 003514   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003515   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003516   000000 701000 xent               TSX1    UQB$MDEQ
         2 003517   000000 011000                    NOP     0

     1161    12596    4                    F$DCB.ENQF='0'B;

  12596  2 003520   200054 470500                    LDP0    JDCB$,,AUTO
         2 003521   000031 236000 3                  LDQ     25
         2 003522   000064 356100                    ANSQ    52,,PR0

     1162    12597    4                    CALL SSR$REG(%SS_SL,,5) ALTRET(BRK_EVT);

  12597  2 003523   000032 236000 3                  LDQ     26
         2 003524   200104 756100                    STQ     TYPE+3,,AUTO
         2 003525   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 003526   000015 235000 3                  LDA     13
         2 003527   200102 757100                    STAQ    TYPE+1,,AUTO
         2 003530   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003531   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 003532   000000 701000 xent               TSX1    SSR$REG
         2 003533   003547 702000 2                  TSX2    BRK_EVT

     1163    12598    4                    GOTO COMMON;

  12598  2 003534   003256 710000 2                  TRA     COMMON

     1164    12599    4                    END;
     1165    12600    3                 CALL FMD$RELBUF(4);       /* THE FIT MAY BE QUITE OLD           */

  12600  2 003535   000033 630400 3                  EPPR0   27
         2 003536   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003537   000000 701000 xent               TSX1    FMD$RELBUF
         2 003540   000000 011000                    NOP     0
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:161  

     1166    12601    3                 CALL FMH$MAPJRNL(1);

  12601  2 003541   000006 630400 3                  EPPR0   6
         2 003542   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003543   000000 701000 xent               TSX1    FMH$MAPJRNL
         2 003544   000000 011000                    NOP     0

     1167    12602    3                 END;

     1168    12603    2           RETURN;

  12603  2 003545   200100 221300                    LDX1  ! I+1,,AUTO
         2 003546   000001 702211                    TSX2  ! 1,X1

  12597  2 003547                       BRK_EVT      null
     1169    12604        /*E*    ERROR:  FMF-E$JRNLCLSD-2
     1170    12605        *       MESSAGE: Attempt to access journal% %UF% after owner closed
     1171    12606        */
     1172    12607        /**/
     1173    12608    2   BRK_EVT: ;
     1174    12609    2           B$JIT.JUNK=B$JIT.JUNK|%JJ_BAKIC#; /* Retry PMME                       */

  12609  2 003547   000000 470400 xsym               LDP0    B$JIT$
         2 003550   000315 220100                    LDX0    205,,PR0
         2 003551   001000 260003                    ORX0    512,DU
         2 003552   000315 740100                    STX0    205,,PR0

     1175    12610    2           B$JIT.ERR=ERRPMMEINT;

  12610  2 003553   000012 236000 0                  LDQ     ERRPMMEINT
         2 003554   000012 756100                    STQ     10,,PR0

     1176    12611    2           ALTRETURN;

  12611  2 003555   200100 221300                    LDX1  ! I+1,,AUTO
         2 003556   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:162  

  12610  2 003557                       QERR         null
     1177    12612        /**/
     1178    12613    2   QERR:   ;
     1179    12614    2           ALTRETURN;

  12614  2 003557   200100 221300                    LDX1  ! I+1,,AUTO
         2 003560   000000 702211                    TSX2  ! 0,X1

     1180    12615        /*S*    SCREECH_CODE:   FMF-S$FM98
     1181    12616        *       TYPE:  SNAP
     1182    12617        *      MESSAGE:  ENQ/DEQ error during PMME to shared file */
     1183    12618    2   END ENQRD;
     1184    12619        /**/
     1185    12620        /**/
     1186    12621        /**/
     1187    12622    1   DEQ:    PROC;

  12622  2 003561   200072 741300       DEQ          STX1  ! JRNLECCI+3,,AUTO

     1188    12623    2   DCL IOFLAG SBIN;
     1189    12624        /**/
     1190    12625    2           IF NOT F$DCB.ENQF THEN RETURN;

  12625  2 003562   200054 470500                    LDP0    JDCB$,,AUTO
         2 003563   000064 236100                    LDQ     52,,PR0
         2 003564   000200 316007                    CANQ    128,DL
         2 003565   003567 601000 2                  TNZ     s:12626

  12625  2 003566   000001 702211                    TSX2  ! 1,X1

     1191    12626    2           IOFLAG=0;

  12626  2 003567   200073 450100                    STZ     IOFLAG,,AUTO

     1192    12627    2           IF F$DCB.ACS=%JRNL# THEN

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:163  
  12627  2 003570   000036 236100                    LDQ     30,,PR0
         2 003571   000777 376007                    ANQ     511,DL
         2 003572   000004 116007                    CMPQ    4,DL
         2 003573   003747 601000 2                  TNZ     s:12658

     1193    12628    3              IF FM$CFUJ.PAGE#~=0 THEN DO;

  12628  2 003574   200056 471500                    LDP1    CFU$,,AUTO
         2 003575   100005 720100                    LXL0    5,,PR1
         2 003576   003775 600000 2                  TZE     NO_REG

     1194    12629    3                 FM$CFUJ.UPD=F$DCB.BFR.BUFUP(1);

  12629  2 003577   000116 236100                    LDQ     78,,PR0
         2 003600   100005 676100                    ERQ     5,,PR1
         2 003601   400000 376003                    ANQ     -131072,DU
         2 003602   100005 656100                    ERSQ    5,,PR1

     1195    12630    3                 IF NOT B$JIT.ERR THEN

  12630  2 003603   000000 473400 xsym               LDP3    B$JIT$
         2 003604   300012 235100                    LDA     10,,PR3
         2 003605   003611 601000 2                  TNZ     s:12633

     1196    12631    3                    FM$CFUJ.ERR_WAIT='0'B; /* Clear error if successful PMME     */

  12631  2 003606   000034 236000 3                  LDQ     28
         2 003607   100005 356100                    ANSQ    5,,PR1
         2 003610   003775 710000 2                  TRA     NO_REG

     1197    12632    4                 ELSE DO;

     1198    12633    4                    IF B$JIT.ERR.CODE<512

  12633  2 003611   300012 236100                    LDQ     10,,PR3
         2 003612   377770 376007                    ANQ     131064,DL
         2 003613   010000 116007                    CMPQ    4096,DL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:164  
         2 003614   003632 603000 2                  TRC     s:12636

     1199    12634    4                    THEN CALL INDEX(I,BINASC(B$JIT.ERR.CODE),USRJRNERRS)

  12634  2 003615   300012 236100                    LDQ     10,,PR3
         2 003616   000003 772000                    QRL     3
         2 003617   037777 376007                    ANQ     16383,DL
         2 003620   000033 736000                    QLS     27
         2 003621   000035 276000 3                  ORQ     29
         2 003622   200102 756100                    STQ     TYPE+1,,AUTO
         2 003623   000100 124400                    SCM     mask='000'O
         2 003624   000023 000024 0                  ADSC9   USRJRNERR                cn=0,n=20
         2 003625   200102 000001                    ADSC9   TYPE+1,,AUTO             cn=0,n=1
         2 003626   200057 000100                    ARG     I,,AUTO
         2 003627   003631 606400 2                  TTN     s:12635+1

     1200    12635    5                       WHENRETURN DO; GOTO NO_REG; END;

  12635  2 003630   003775 710000 2                  TRA     NO_REG
         2 003631   003647 710000 2                  TRA     s:12638

     1201    12636    4                    ELSE CALL INDEX(I,BINASC(B$JIT.ERR.CODE-512),USRTJNERRS)

  12636  2 003632   300012 236100                    LDQ     10,,PR3
         2 003633   000003 772000                    QRL     3
         2 003634   037777 376007                    ANQ     16383,DL
         2 003635   001000 136007                    SBLQ    512,DL
         2 003636   000033 736000                    QLS     27
         2 003637   000035 276000 3                  ORQ     29
         2 003640   200102 756100                    STQ     TYPE+1,,AUTO
         2 003641   000100 124400                    SCM     mask='000'O
         2 003642   000030 000010 0                  ADSC9   USRTJNERR                cn=0,n=8
         2 003643   200102 000001                    ADSC9   TYPE+1,,AUTO             cn=0,n=1
         2 003644   200057 000100                    ARG     I,,AUTO
         2 003645   003647 606400 2                  TTN     s:12638

     1202    12637    5                       WHENRETURN DO; GOTO NO_REG; END;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:165  

  12637  2 003646   003775 710000 2                  TRA     NO_REG

     1203    12638    5                    IF NOT FM$CFUJ.ERR_WAIT THEN DO; /* First error              */

  12638  2 003647   200056 470500                    LDP0    CFU$,,AUTO
         2 003650   000005 236100                    LDQ     5,,PR0
         2 003651   200000 316003                    CANQ    65536,DU
         2 003652   003775 601000 2                  TNZ     NO_REG

     1204    12639    5                       FM$CFUJ.ERR_WAIT='1'B;

  12639  2 003653   200000 236003                    LDQ     65536,DU
         2 003654   000005 256100                    ORSQ    5,,PR0

     1205    12640    6                       IF NOT F$DCB.OWNER THEN DO;

  12640  2 003655   200054 471500                    LDP1    JDCB$,,AUTO
         2 003656   100064 236100                    LDQ     52,,PR1
         2 003657   040000 316007                    CANQ    16384,DL
         2 003660   003775 601000 2                  TNZ     NO_REG

     1206    12641    6                          JRNLECCI.P#=1;

  12641  2 003661   000001 235007                    LDA     1,DL
         2 003662   200067 755100                    STA     JRNLECCI,,AUTO

     1207    12642    6                          JRNLECCI.VOL=FM$CFUJ.VOL;

  12642  2 003663   000004 236100                    LDQ     4,,PR0
         2 003664   000011 772000                    QRL     9
         2 003665   000777 376007                    ANQ     511,DL
         2 003666   000000 620006                    EAX0    0,QL
         2 003667   200070 740100                    STX0    JRNLECCI+1,,AUTO

     1208    12643    6                          I=FM$CFUJ.DMAIN;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:166  
  12643  2 003670   000005 236100                    LDQ     5,,PR0
         2 003671   000033 772000                    QRL     27
         2 003672   000077 376007                    ANQ     63,DL
         2 003673   200057 756100                    STQ     I,,AUTO

     1209    12644    6                          B$JIT.ERR.MON='1'B; /* set MON bit                     */

  12644  2 003674   000000 473400 xsym               LDP3    B$JIT$
         2 003675   400000 236007                    LDQ     -131072,DL
         2 003676   300012 256100                    ORSQ    10,,PR3

     1210    12645    6                          CALL SSV$EVENT(FM$CFUJ.USER,I,%SUBC_JRNLERR#,

  12645  2 003677   200067 634500                    EPPR4   JRNLECCI,,AUTO
         2 003700   200102 454500                    STP4    TYPE+1,,AUTO
         2 003701   000004 236000 3                  LDQ     4
         2 003702   200111 756100                    STQ     TYPE+8,,AUTO
         2 003703   200102 635500                    EPPR5   TYPE+1,,AUTO
         2 003704   200110 455500                    STP5    TYPE+7,,AUTO
         2 003705   000000 236000 xsym               LDQ     B$JIT$
         2 003706   000012 036003                    ADLQ    10,DU
         2 003707   200107 756100                    STQ     TYPE+6,,AUTO
         2 003710   200054 236100                    LDQ     JDCB$,,AUTO
         2 003711   000066 036003                    ADLQ    54,DU
         2 003712   200106 756100                    STQ     TYPE+5,,AUTO
         2 003713   000005 236000 3                  LDQ     5
         2 003714   200105 756100                    STQ     TYPE+4,,AUTO
         2 003715   200057 636500                    EPPR6   I,,AUTO
         2 003716   200104 456500                    STP6    TYPE+3,,AUTO
         2 003717   200056 236100                    LDQ     CFU$,,AUTO
         2 003720   000036 036000 3                  ADLQ    30
         2 003721   200103 756100                    STQ     TYPE+2,,AUTO
         2 003722   200103 630500                    EPPR0   TYPE+2,,AUTO
         2 003723   000025 631400 xsym               EPPR1   B_VECTNIL+21
         2 003724   000000 701000 xent               TSX1    SSV$EVENT
         2 003725   000000 011000                    NOP     0

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:167  
     1211    12646    6                            F$DCB.CFU$,B$JIT.ERR,ADDR(JRNLECCI),ENTADDR(NIL));
     1212    12647    6                          CALL UQB$MDEQ(F$DCB.CFU$);

  12647  2 003726   200054 236100                    LDQ     JDCB$,,AUTO
         2 003727   000066 036003                    ADLQ    54,DU
         2 003730   200102 756100                    STQ     TYPE+1,,AUTO
         2 003731   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003732   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003733   000000 701000 xent               TSX1    UQB$MDEQ
         2 003734   000000 011000                    NOP     0

     1213    12648    6                          F$DCB.ENQF='0'B;

  12648  2 003735   200054 470500                    LDP0    JDCB$,,AUTO
         2 003736   000031 236000 3                  LDQ     25
         2 003737   000064 356100                    ANSQ    52,,PR0

     1214    12649    6                          B$JIT.ERR='0'B;

  12649  2 003740   000000 471400 xsym               LDP1    B$JIT$
         2 003741   100012 450100                    STZ     10,,PR1

     1215    12650    6                          B$JIT.JUNK=B$JIT.JUNK|%JJ_BAKIC#;

  12650  2 003742   100315 220100                    LDX0    205,,PR1
         2 003743   001000 260003                    ORX0    512,DU
         2 003744   100315 740100                    STX0    205,,PR1

     1216    12651    6                          RETURN;

  12651  2 003745   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 003746   000001 702211                    TSX2  ! 1,X1

     1217    12652    6                          END;
     1218    12653    5                       END;
     1219    12654    4                    END;
     1220    12655    3                 END;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:168  
     1221    12656    2              ELSE;                        /* ACS=%JRNL# and FM$CFUJ.PAGE#=0     */
     1222    12657    2           ELSE                            /* ACS~=%JRNL#                        */
     1223    12658    3           DO I=0 TO 4;

  12658  2 003747   200057 450100                    STZ     I,,AUTO

     1224    12659    4              IF F$DCB.BFR.BUFUP(I) AND F$DCB.BFR1.CX(I) = 0 THEN DO;

  12659  2 003750   200054 470500                    LDP0    JDCB$,,AUTO
         2 003751   200057 720100                    LXL0    I,,AUTO
         2 003752   000115 234110                    SZN     77,X0,PR0
         2 003753   003771 605000 2                  TPL     s:12664
         2 003754   000122 721110                    LXL1    82,X0,PR0
         2 003755   003771 601000 2                  TNZ     s:12664

     1225    12660    4                 CALL FMD$WRTSVNW(I);      /* WRITE NO-WAIT                      */

  12660  2 003756   200057 631500                    EPPR1   I,,AUTO
         2 003757   200102 451500                    STP1    TYPE+1,,AUTO
         2 003760   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 003761   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003762   000000 701000 xent               TSX1    FMD$WRTSVNW
         2 003763   000000 011000                    NOP     0

     1226    12661    4                 IF F$DCB.WAIT=0 THEN

  12661  2 003764   200054 470500                    LDP0    JDCB$,,AUTO
         2 003765   000064 236100                    LDQ     52,,PR0
         2 003766   000020 316007                    CANQ    16,DL
         2 003767   003771 601000 2                  TNZ     s:12664

     1227    12662    4                    IOFLAG=IOFLAG+1;

  12662  2 003770   200073 054100                    AOS     IOFLAG,,AUTO

     1228    12663    4                 END;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:169  
     1229    12664    3              END;

  12664  2 003771   200057 054100                    AOS     I,,AUTO
         2 003772   200057 235100                    LDA     I,,AUTO
         2 003773   000004 115007                    CMPA    4,DL
         2 003774   003750 604400 2                  TMOZ    s:12659

  12659  2 003775                       NO_REG       null
     1230    12665    2   NO_REG: ;
     1231    12666    2           F$DCB.MODCNT=FM$CFU.MODCNT;

  12666  2 003775   200056 470500                    LDP0    CFU$,,AUTO
         2 003776   000006 236100                    LDQ     6,,PR0
         2 003777   000025 772000                    QRL     21
         2 004000   000000 620006                    EAX0    0,QL
         2 004001   200054 471500                    LDP1    JDCB$,,AUTO
         2 004002   100100 740100                    STX0    64,,PR1

     1232    12667    2           CALL UQB$MDEQ(F$DCB.CFU$);

  12667  2 004003   200054 236100                    LDQ     JDCB$,,AUTO
         2 004004   000066 036003                    ADLQ    54,DU
         2 004005   200102 756100                    STQ     TYPE+1,,AUTO
         2 004006   200102 630500                    EPPR0   TYPE+1,,AUTO
         2 004007   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004010   000000 701000 xent               TSX1    UQB$MDEQ
         2 004011   000000 011000                    NOP     0

     1233    12668    2           F$DCB.ENQF='0'B;

  12668  2 004012   200054 470500                    LDP0    JDCB$,,AUTO
         2 004013   000031 236000 3                  LDQ     25
         2 004014   000064 356100                    ANSQ    52,,PR0

     1234    12669    2           IF IOFLAG~=0 THEN

  12669  2 004015   200073 235100                    LDA     IOFLAG,,AUTO
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:170  
         2 004016   004022 600000 2                  TZE     s:12671

     1235    12670    2              CALL FMB$IOSPIN;

  12670  2 004017   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004020   000000 701000 xent               TSX1    FMB$IOSPIN
         2 004021   000000 011000                    NOP     0

     1236    12671    2           RETURN;

  12671  2 004022   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 004023   000001 702211                    TSX2  ! 1,X1

     1237    12672    2   END DEQ;
     1238    12673        /**/
     1239    12674        %EJECT;
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:171  
     1240    12675    1   CHKBAD: PROC ALTRET;

  12675  2 004024   200072 741300       CHKBAD       STX1  ! JRNLECCI+3,,AUTO

     1241    12676
     1242    12677    2           IF F$DCB.IASN ~= %OD# THEN

  12677  2 004025   200054 470500                    LDP0    JDCB$,,AUTO
         2 004026   000103 236100                    LDQ     67,,PR0
         2 004027   000777 376007                    ANQ     511,DL
         2 004030   000012 116007                    CMPQ    10,DL
         2 004031   004075 600000 2                  TZE     s:12688

     1243    12678    2              IF F$DCB.ASN=%FILE# AND

  12678  2 004032   000032 236100                    LDQ     26,,PR0
         2 004033   777000 376007                    ANQ     -512,DL
         2 004034   001000 116007                    CMPQ    512,DL
         2 004035   004075 601000 2                  TNZ     s:12688
         2 004036   000066 471500                    LDP1    54,,PR0
         2 004037   100006 236100                    LDQ     6,,PR1
         2 004040   000002 376003                    ANQ     2,DU
         2 004041   000002 116003                    CMPQ    2,DU
         2 004042   004047 601000 2                  TNZ     s:12678+13
         2 004043   000036 236100                    LDQ     30,,PR0
         2 004044   000777 376007                    ANQ     511,DL
         2 004045   000004 116007                    CMPQ    4,DL
         2 004046   004052 601000 2                  TNZ     s:12678+16
         2 004047   000005 236100                    LDQ     5,,PR0
         2 004050   020000 316007                    CANQ    8192,DL
         2 004051   004075 600000 2                  TZE     s:12688
         2 004052   000000 473400 xsym               LDP3    B$JIT$
         2 004053   300013 236100                    LDQ     11,,PR3
         2 004054   100000 316003                    CANQ    32768,DU
         2 004055   004075 601000 2                  TNZ     s:12688
         2 004056   000000 235000 xsym               LDA     S_CUN
         2 004057   000017 115007                    CMPA    15,DL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:172  
         2 004060   004075 604400 2                  TMOZ    s:12688
         2 004061   000103 236100                    LDQ     67,,PR0
         2 004062   777000 376003                    ANQ     -512,DU
         2 004063   002000 116003                    CMPQ    1024,DU
         2 004064   004071 600000 2                  TZE     s:12685
         2 004065   004000 116003                    CMPQ    2048,DU
         2 004066   004071 600000 2                  TZE     s:12685
         2 004067   001000 116003                    CMPQ    512,DU
         2 004070   004075 601000 2                  TNZ     s:12688

     1244    12679    2                (F$DCB.CFU$->FM$CFU.B=1 AND F$DCB.ACS~=%JRNL# OR
     1245    12680    2                F$DCB.DESC.BAD) AND
     1246    12681    2                NOT B$JIT.PRIV.ACTIVE.FMSEC AND
     1247    12682    2                S_CUN>%15/*JG_MING#    */ AND
     1248    12683    2                (F$DCB.IFMT=2/*FMTKEY#*/ OR F$DCB.IFMT=4/*FMTREL#*/ OR
     1249    12684    3                F$DCB.IFMT=1/*FMTCON#*/) THEN DO;

     1250    12685    3                 B$JIT.ERR=ERRBROKEN;

  12685  2 004071   000015 236000 0                  LDQ     ERRBROKEN
         2 004072   300012 756100                    STQ     10,,PR3

     1251    12686    3                 ALTRETURN;

  12686  2 004073   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 004074   000000 702211                    TSX2  ! 0,X1

     1252    12687    3                 END;
     1253    12688    2           RETURN;

  12688  2 004075   000001 702211                    TSX2  ! 1,X1

     1254    12689    2   END CHKBAD;
     1255    12690        /*E*   ERROR:   FMF-E$BROKEN-2
     1256    12691               MESSAGE:  File% %UF% contains inconsistencies, no updates allowed.
     1257    12692               MESSAGE1:  File% %UF% was damaged due to a system error, no
     1258    12693                          updates are allowed unless FMSEC is active.
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:173  
     1259    12694        */
     1260    12695
     1261    12696        /**/
     1262    12697    1   CACHECLR: PROC;

  12697  2 004076   200072 741300       CACHECLR     STX1  ! JRNLECCI+3,,AUTO

     1263    12698        /**/
     1264    12699                %LOCK (G=S_ASFGATE);
             12700    2   CALL HFC$LOCK( S_ASFGATE);

  12700  2 004077   000037 630400 3                  EPPR0   31
         2 004100   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004101   000000 701000 xent               TSX1    HFC$LOCK
         2 004102   000000 011000                    NOP     0

     1265    12702    2           S$CU$->B$U.ASYNCH=S$CU$->B$U.ASYNCH&(~%U_CACHE);

  12702  2 004103   000003 236000 xsym               LDQ     B_VECTNIL+3
         2 004104   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 004105   000000 470400 xsym               LDP0    S$CU$
         2 004106   000001 376100                    ANQ     1,,PR0
         2 004107   000001 756100                    STQ     1,,PR0

     1266    12703                %UNLOCK (G=S_ASFGATE);
             12704    2   CALL HFC$UNLOCK( S_ASFGATE);

  12704  2 004110   000037 630400 3                  EPPR0   31
         2 004111   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004112   000000 701000 xent               TSX1    HFC$UNLOCK
         2 004113   000000 011000                    NOP     0

     1267    12706    2           CALL HFC$CACHECLR;

  12706  2 004114   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004115   000000 701000 xent               TSX1    HFC$CACHECLR
         2 004116   000000 011000                    NOP     0
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:174  

     1268    12707    2           RETURN;

  12707  2 004117   200072 221300                    LDX1  ! JRNLECCI+3,,AUTO
         2 004120   000001 702211                    TSX2  ! 1,X1

ERRREAD
 Sect OctLoc
   0     000   061506 000702                                                    1...

ERRWRITE
 Sect OctLoc
   0     001   061506 000672                                                    1...

ERRDELREC
 Sect OctLoc
   0     002   061506 000712                                                    1...

ERRPOS
 Sect OctLoc
   0     003   061506 000722                                                    1...

ERREXTEND
 Sect OctLoc
   0     004   061506 000732                                                    1...

ERRDOMAIN
 Sect OctLoc
   0     005   061506 006262                                                    1...

ERRJRNL
 Sect OctLoc
   0     006   061506 001162                                                    1..r

ERRDMY
 Sect OctLoc
   0     007   061506 000002                                                    1...
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:175  

ERREOF
 Sect OctLoc
   0     010   061506 000062                                                    1..2

ERRMTRAP
 Sect OctLoc
   0     011   061506 000132                                                    1..Z

ERRPMMEINT
 Sect OctLoc
   0     012   061506 001232                                                    1...

ERRSHRDS2BIG
 Sect OctLoc
   0     013   061506 002002                                                    1...

ERRNOEVENT
 Sect OctLoc
   0     014   061506 007572                                                    1...

ERRBROKEN
 Sect OctLoc
   0     015   061506 001352                                                    1...

ERRNOACCT
 Sect OctLoc
   0     016   061516 001022                                                    1...

ERRINVVFC
 Sect OctLoc
   0     017   061506 014142                                                    1..b

ERRNOCODE
 Sect OctLoc
   0     020   061506 000002                                                    1...

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:176  
ERREOD
 Sect OctLoc
   0     021   061506 000122                                                    1..R

ERRDMYFMI
 Sect OctLoc
   0     022   061511 000000                                                    1...

USRJRNERR
 Sect OctLoc
   0     023   007013 022004   006113 215644   645646 647650   651652 653654    .....K..........
   0     027   655757 000000                                                    ....

USRTJNERR
 Sect OctLoc
   0     030   305310 320347   000000 000000                                    ........

(unnamed)
 Sect OctLoc
   0     032   004000 000000   116103 040040   103114 040040                    ....NC  CL

FM_FTAM_USER
 Sect OctLoc
   1     000   106124 101115                                                    FTAM

(unnamed)
 Sect OctLoc
   3     000   000000 006000   000000 006000   000000 006000   000012 006000    ................
   3     004   000002 006000   000005 006000   000003 006000   000074 200000    .............<..
   3     010   000000 006000   000000 006000   000010 006000   000011 006000    ................
   3     014   000000 000031   000014 006000   000014 006000   000014 006000    ................
   3     020   001777 776000   000004 006000   000032 006000   000000 000026    ................
   3     024   000023 006000   000000 000047   000025 006000   000000 006000    .......'........
   3     030   000000 006000   777777 777577   000007 006000   000006 006000    ................
   3     034   577777 777777   000040 040040   000005 200000   000000 006000    .....   ........
     1269    12708    2   END CACHECLR;
     1270    12709        /**/
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:177  
     1271    12710        /**/
     1272    12711        /**/
     1273    12712        /*E*    ERROR:   -E$OPER-2
     1274    12713        *       MESSAGE:  Tape error, position lost% on %SN%
     1275    12714        */
     1276    12715        /*E*    ERROR:   -E$EOT-2
     1277    12716        *       MESSAGE:  End-of-tape% on %SN%
     1278    12717        */
     1279    12718        /*E*    ERROR:   -E$BOT-2
     1280    12719        *       MESSAGE:  Beginning-of-tape% on %SN%
     1281    12720        */
     1282    12721        /*E*    ERROR:   -E$BOF-2
     1283    12722        *       MESSAGE:  Beginning-of-file% on %UF%
     1284    12723        */
     1285    12724        /*E*    ERROR:   -E$BLNKTP-2
     1286    12725        *       MESSAGE:  Blank tape encountered on read% of %SN%
     1287    12726        */
     1288    12727        /*E*    ERROR:   -E$EOF-2
     1289    12728        *       MESSAGE:  End-of-file% on %UF%
     1290    12729        */
     1291    12730        /*E*    ERROR:   -E$LD-2
     1292    12731        *       MESSAGE:  Lost data% on %UF%
     1293    12732        *       MESSAGE1:  Attempt to read more than will fit in your buffer,
     1294    12733                  or write more than is allowed
     1295    12734        */
     1296    12735        /*E*    ERROR:   -E$IOERR-2
     1297    12736        *       MESSAGE:  I/O error% on %UF%
     1298    12737        *       MESSAGE1: A hardware I/O error occurred
     1299    12738        */
     1300    12739        /*E*    ERROR:   -E$DI-2
     1301    12740        *       MESSAGE: Data inconsistency% in file %FN%
     1302    12741        *       MESSAGE1: Due to a hardware error, or file management error,
     1303    12742                          the data for one or more records have been lost.
     1304    12743        */
     1305    12744        /*E*    ERROR:   -E$MTRAP-2
     1306    12745        *       MESSAGE: Buffer inaccessible% for %UF%%, DCB %DC%
     1307    12746        *       MESSAGE1: The buffer does not have the proper memory access
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:178  
     1308    12747        */
     1309    12748        /*E*    ERROR:   -E$LDSC-2
     1310    12749        *       MESSAGE: Line disconnect or absent comgroup station% on %DC%
     1311    12750        */
     1312    12751        /*E*    ERROR:  -E$DACTR-2
     1313    12752        *       MESSAGE: You are deactivated - I/O not permitted% on %DC%
     1314    12753        */
     1315    12754        /*E*    ERROR:   -E$TIMO-2
     1316    12755        *       MESSAGE: Read timed out% on %DC%
     1317    12756        */
     1318    12757        /*E*    ERROR:   -E$PROT-2
     1319    12758        *       MESSAGE:  %%SN %Write-protected
     1320    12759        */
     1321    12760        /*E*    ERROR:   -E$FRAW-2
     1322    12761        *       MESSAGE: Read after forward write on tape% %SN%
     1323    12762        */
     1324    12763        /*E*    ERROR:   -E$LAST-2
     1325    12764        *       MESSAGE: Error occurred on previous operation% on %DC%
     1326    12765        */
     1327    12766        /*E*    ERROR:   -E$CDALRT-2
     1328    12767        *       MESSAGE: Invalid ASCII character detected on write% on DCB %DC%
     1329    12768        */
     1330    12769        /*E*    ERROR:   -E$XTRARD-2
     1331    12770                MESSAGE: Read with read pending% on %DC%
     1332    12771                MESSAGE1: A read was issued when a read was already pending
     1333    12772        */
     1334    12773        /*E*    ERROR:   -E$CGKEYV-2
     1335    12774                MESSAGE: COMGROUP key violation% on %DC%
     1336    12775                MESSAGE1: A COMGROUP read or write illegally specified a station
     1337    12776                          or message type that does not exist
     1338    12777        */
     1339    12778        /*E*    ERROR:   -E$CGLWRV-2
     1340    12779                MESSAGE: COMGROUP LATCHed write violation% on %DC%
     1341    12780                MESSAGE1: A COMGROUP write specified LATCH, but there was
     1342    12781                          no latched input message to use, or the latched
     1343    12782                          input message's spawn or spawn count was exhausted.,
     1344    12783                          or the destination was wild-carded.
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:179  
     1345    12784        */
     1346    12785        /*E*    ERROR:   -E$CGFULL-2
     1347    12786                MESSAGE: COMGROUP full% - %DC%
     1348    12787                MESSAGE1: When encountered on M$WRITE, this error indicates
     1349    12788                          that the designated COMGROUP has no more space.
     1350    12789                          When encountered on M$READ it means that the
     1351    12790                          comgroup has insufficient memory available to
     1352    12791                          process the read request.
     1353    12792        */
     1354    12793        /*E*    ERROR:   -E$CGCRCW-2
     1355    12794                MESSAGE: COMGROUP LATCHed write in progress% on %DC%
     1356    12795                MESSAGE1: An M$READ to COMGROUP with an input message currently
     1357    12796                          latched causes that message to be deleted and its
     1358    12797                          latched writes sent.  This error occurs when a
     1359    12798                          continued latched write is still awaiting its last
     1360    12799                          segment at the time the read is issued.  The latched
     1361    12800                          write must either be finished via M$WRITE, or
     1362    12801                          deleted via M$UNLATCH.
     1363    12802        */
     1364    12803        /*E*    ERROR:   -E$CGCWRV-2
     1365    12804                MESSAGE: COMGROUP continued write or read violation% on %DC%
     1366    12805                MESSAGE1: A COMGROUP write specified continue, but
     1367    12806                          a different message type was specified on
     1368    12807                          this subsequent write, or a wild-carded
     1369    12808                          destination was specified on this first write,
     1370    12809                          or a comgroup read specified CONT and there
     1371    12810                          was no message to continue reading.
     1372    12811        */
     1373    12812        /* The following error appears here only so it will be extracted with the rest
     1374    12813           of the file management errors, and for no other reason.  It belongs to XSA,
     1375    12814           and is only used in XSA$FSF.  It's here because XSA has only one error of its
     1376    12815           very own...this one.
     1377    12816        */
     1378    12817        /*E*     ERROR:   XSA-E$UNFAST-0
     1379    12818                 MESSAGE:    Operation would have "unfasted" your file.
     1380    12819                 MESSAGE1:   The operation you attempted is not supported by XSA, and
     1381    12820                             would have caused XSA to begin using the standard monitor
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:180  
     1382    12821                             services rather than the fast XSA services.
     1383    12822                 DESCRIPTION:  This error is returned by the fast sequential file access
     1384    12823                             routines when an operation is attempted that would have
     1385    12824                             "unfasted" the file, and the field XSA_PARAM.UNFAST# is
     1386    12825                             set.  The error is used nowhere else.
     1387    12826        */
     1388    12827        /**/
     1389    12828    1   END FMF$PMME;
     1390    12829        %EOD;

PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:181  
--  Include file information  --

   JG_GHOSTS_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   UE_ERRORS_C.:E05TOU  is referenced.
   UE_CP6.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   F_CODE_R.:E05TOU  cannot be made into a system file and is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   FM_CACHE_C.:E05TOU  is referenced.
   FM_CACHE_R.:E05TOU  cannot be made into a system file and is referenced.
   FM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMF$PMME.
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:182  

 **** Variables and constants ****

  ****  Section 000 RoData FMF$PMME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    15-0-0/b STRC        r     1 ERRBROKEN                  2-0-0/b STRC        r     1 ERRDELREC
     7-0-0/b STRC        r     1 ERRDMY                    22-0-0/b STRC        r     1 ERRDMYFMI
     5-0-0/b STRC        r     1 ERRDOMAIN                 21-0-0/b STRC        r     1 ERREOD
    10-0-0/b STRC        r     1 ERREOF                     4-0-0/b STRC        r     1 ERREXTEND
    17-0-0/b STRC        r     1 ERRINVVFC                  6-0-0/b STRC        r     1 ERRJRNL
    11-0-0/b STRC        r     1 ERRMTRAP                  16-0-0/b STRC        r     1 ERRNOACCT
    20-0-0/b STRC        r     1 ERRNOCODE                 14-0-0/b STRC        r     1 ERRNOEVENT
    12-0-0/b STRC        r     1 ERRPMMEINT                 3-0-0/b STRC        r     1 ERRPOS
     0-0-0/b STRC        r     1 ERRREAD                   13-0-0/b STRC        r     1 ERRSHRDS2BIG
     1-0-0/b STRC        r     1 ERRWRITE
    23-0-0/b UBIN(9)     r     1 USRJRNERR(0:19)
    23-0-0/c CHAR(20)    r     1 USRJRNERRS
    30-0-0/b UBIN(9)     r     1 USRTJNERR(0:7)
    30-0-0/c CHAR(8)     r     1 USRTJNERRS

  ****  Section 001  Data  FMF$PMME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 FM_FTAM_USER

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @FPTCODE                  73-0-0/w PTR         r     1 @FTAMCODE
    55-0-0/w STRC        r     1 BCDCB                     55-0-0/w PTR         r     1 BCDCB$
    56-0-0/w PTR         r     1 CFU$                      64-0-0/w PTR         r     1 CG$
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:183  
    61-0-0/w UBIN        r     1 CODE                      75-0-0/w UBIN        r     1 DSSID
    63-0-0/w UBIN        r     1 ENTFLG                    62-0-0/w UBIN        r     1 EVENT
    *0-0-0/w SBIN        r     1 FPTCODE                   *0-0-0/w SBIN        r     1 FTAMCODE
    74-0-0/w SBIN        r     1 GRANS                     57-0-0/w SBIN        r     1 I
    77-0-0/w SBIN        r     1 I                         73-0-0/w SBIN        r     1 IOFLAG
    54-0-0/w PTR         r     1 JDCB$                     67-0-0/w STRC(72)    r     1 JRNLECCI
    66-0-0/w PTR         r     1 LDCT$                     73-0-0/w UBIN        r     1 RECS
     4-0-0/d STRC(1404)  r     1 RWPARM                    65-0-0/w PTR         r     1 STA$
   101-0-0/w UBIN        r     1 TYPE                      60-0-0/w UBIN(9)     r     1 USR
    76-0-0/w UBIN        r     1 WSQ

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$IS$                      0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w PTR         r     1 B$M$STAR$                  0-0-0/w PTR         r     1 B$PPUT$
     0-0-0/w PTR         r     1 B$PS0$                     0-0-0/w PTR         r     1 B$PS1$
     0-0-0/w PTR         r     1 B$PS2$                     0-0-0/d STRC(432)   r     1 B_MPT
     0-0-0/w PTR         r     1 FMC_CACHE$                 0-0-0/w PTR         r     1 FMC_CACHEPGCNT$
     0-0-0/b UBIN(9)     r     1 F_CODE(0:24)               0-0-0/b BIT (72)    r     1 F_DCBLOCK
     0-0-0/b UBIN(2)     r     1 F_SEV(0:24)
     0-0-0/b BIT         r     1 F_TYCBITS(0:24)
     0-0-0/w SBIN        r     1 F_TYCMAX                   0-0-0/d STRC(1404)  r     1 K_RWPARM_CON
     0-0-0/w UBIN        r     1 LS0UBIN                    0-0-0/w SBIN        r     1 MM_SHAREDSUSE
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 S$CU$
     0-0-0/w UBIN        r     1 S_ASFGATE                  0-0-0/w SBIN        r     1 S_CUN
     0-0-0/w SBIN        r     1 S_UDLGATE

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(396)   r     1 B$DO                       0-0-0/w STRC(180)   r     1 B$ECCBI
     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(576)   r     1 B$U
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:184  
     0-0-0/w STRC        r     1 BITS                       0-0-0/c ACHR        r     1 CHARS
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(288)   r     1 FM$CFU
     0-0-0/w STRC(288)   r     1 FM$CFUJ                    0-0-0/w STRC(288)   r     1 FM$CFUR
     0-0-0/w STRC(216)   r     1 FMC$CACHETBL(0:0)
     0-0-0/d STRC(72)    r     1 FPT$EXTEND_V               0-0-0/d STRC(108)   r     1 FPT$PRECORD_V
     0-0-0/d STRC(216)   r     1 FPT$READ_V                 0-0-0/d STRC(144)   r     1 FPT$WRITE_V
     0-0-0/d STRC(6516)  r     1 KQ$CG                      0-0-0/d STRC(1296)  r     1 KQ$STA
     0-0-0/w STRC        r     1 MM$PPUT(0:0)
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)


   Procedure FMF$PMME requires 2129 words for executable code.
   Procedure FMF$PMME requires 76 words of local(AUTO) storage.
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:185  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:186  
          MINI XREF LISTING

B$DO.ECCINFO
      2947**DCL      2948--REDEF
B$DO.IOCOMP
      2948**DCL     11886<<ASSIGN
B$DO.IOCOMP.ARS
      2950**DCL     12141<<ASSIGN
B$DO.IOCOMP.CNTR
      2955**DCL     11887<<ASSIGN  12139<<ASSIGN  12139>>ASSIGN  12148>>IF
B$DO.IOCOMP.DVE.DVBYTE
      2952**DCL     12142<<ASSIGN
B$DO.IOCOMP.DVE.EOMCHAR
      2953**DCL     12143<<ASSIGN
B$DO.IOCOMP.TYC
      2949**DCL     12173<<ASSIGN  12173>>ASSIGN
B$ECCBI.FLAGS
     10902**DCL     11873>>IF
B$IS$
     10359**DCL     10360--REDEF
B$JIT.ACCN
       509**DCL     12519>>ASSIGN
B$JIT.CALCNT
       683**DCL     11828>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       603**DCL       603--REDEF
B$JIT.DCB$
       677**DCL     11800>>ASSIGN  12183>>ASSIGN  12210>>ASSIGN  12351>>ASSIGN  12387>>ASSIGN  12460<<ASSIGN
     12461>>IF      12465>>IF      12475>>IF      12487<<ASSIGN  12488>>ASSIGN  12491<>CALL
B$JIT.DO$
       677**DCL     11884<>CALL    11886>>ASSIGN  11887>>ASSIGN  12134>>IF      12139>>ASSIGN  12139>>ASSIGN
     12141>>ASSIGN  12142>>ASSIGN  12143>>ASSIGN  12148>>IF      12149<>CALL    12151<<ASSIGN  12155>>IF
     12157<>CALL    12158<<ASSIGN  12162>>IF      12173>>ASSIGN  12173>>ASSIGN
B$JIT.ERR
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:187  
       509**DCL     11816<<ASSIGN  11836<<ASSIGN  11850<<ASSIGN  11874<<ASSIGN  11894<<ASSIGN  11918<<ASSIGN
     11947<<ASSIGN  11961<<ASSIGN  11997<<ASSIGN  12039<<ASSIGN  12064<<ASSIGN  12066>>IF      12093<<ASSIGN
     12095<<ASSIGN  12127<<ASSIGN  12174<<ASSIGN  12225<<ASSIGN  12228<<ASSIGN  12230>>DOWHILE 12232<<ASSIGN
     12235>>IF      12269<>CALL    12277<>CALL    12311<<ASSIGN  12323<<ASSIGN  12323>>ASSIGN  12326<<ASSIGN
     12354<<ASSIGN  12358<<ASSIGN  12372<<ASSIGN  12388<<ASSIGN  12394<<ASSIGN  12511<<ASSIGN  12514<<ASSIGN
     12586<<ASSIGN  12591<<ASSIGN  12610<<ASSIGN  12630>>IF      12645<>CALL    12649<<ASSIGN  12685<<ASSIGN
B$JIT.ERR.CODE
       510**DCL     12037>>IF      12066>>IF      12077>>ASSIGN  12096<<ASSIGN  12506>>IF      12633>>IF
     12634>>CALLBLT 12636>>CALLBLT
B$JIT.ERR.FCG
       509**DCL     12041<<ASSIGN
B$JIT.ERR.MID
       510**DCL       510--REDEF   12042<<ASSIGN
B$JIT.ERR.MON
       510**DCL     12644<<ASSIGN
B$JIT.ERR.SEV
       510**DCL     12097<<ASSIGN
B$JIT.FACCN
       509**DCL     12515<<ASSIGN  12519<<ASSIGN
B$JIT.FACNACS
       677**DCL     12494<<ASSIGN
B$JIT.FPSN
       590**DCL     12516<<ASSIGN  12520<<ASSIGN
B$JIT.JRESPEAK
       671**DCL       672--REDEF
B$JIT.JUNK
       709**DCL     12609<<ASSIGN  12609>>ASSIGN  12650<<ASSIGN  12650>>ASSIGN
B$JIT.ORIGINATOR_PORT.FROM_CR
       780**DCL       780--REDEF     781--REDEF
B$JIT.PNR
       684**DCL       684--REDEF
B$JIT.PRIV.ACTIVE.FMSEC
       511**DCL     12678>>IF
B$JIT.TSLINE
       778**DCL       779--REDEF
B$JIT.USER
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:188  
       509**DCL     12211>>ASSIGN
B$JIT$
     10353**DCL       504--IMP-PTR 11800>>ASSIGN  11816>>ASSIGN  11828>>ASSIGN  11836>>ASSIGN  11850>>ASSIGN
     11858--ASSIGN  11874>>ASSIGN  11884>>CALL    11886>>ASSIGN  11887>>ASSIGN  11894>>ASSIGN  11918>>ASSIGN
     11947>>ASSIGN  11961>>ASSIGN  11997>>ASSIGN  12037>>IF      12039>>ASSIGN  12041>>ASSIGN  12042>>ASSIGN
     12064>>ASSIGN  12066>>IF      12066>>IF      12077>>ASSIGN  12093>>ASSIGN  12095>>ASSIGN  12096>>ASSIGN
     12097>>ASSIGN  12127>>ASSIGN  12134>>IF      12139>>ASSIGN  12139>>ASSIGN  12141>>ASSIGN  12142>>ASSIGN
     12143>>ASSIGN  12148>>IF      12149>>CALL    12151>>ASSIGN  12155>>IF      12157>>CALL    12158>>ASSIGN
     12162>>IF      12173>>ASSIGN  12173>>ASSIGN  12174>>ASSIGN  12183>>ASSIGN  12210>>ASSIGN  12211>>ASSIGN
     12225>>ASSIGN  12228>>ASSIGN  12230>>DOWHILE 12232>>ASSIGN  12235>>IF      12269>>CALL    12277>>CALL
     12311>>ASSIGN  12323>>ASSIGN  12323>>ASSIGN  12326>>ASSIGN  12351>>ASSIGN  12354>>ASSIGN  12358>>ASSIGN
     12372>>ASSIGN  12387>>ASSIGN  12388>>ASSIGN  12394>>ASSIGN  12460>>ASSIGN  12461>>IF      12465>>IF
     12475>>IF      12487>>ASSIGN  12488>>ASSIGN  12491>>CALL    12494>>ASSIGN  12506>>IF      12511>>ASSIGN
     12514>>ASSIGN  12515>>ASSIGN  12516>>ASSIGN  12519>>ASSIGN  12519>>ASSIGN  12520>>ASSIGN  12586>>ASSIGN
     12591>>ASSIGN  12609>>ASSIGN  12609>>ASSIGN  12610>>ASSIGN  12630>>IF      12633>>IF      12634>>CALLBLT
     12636>>CALLBLT 12644>>ASSIGN  12645>>CALL    12649>>ASSIGN  12650>>ASSIGN  12650>>ASSIGN  12678>>IF
     12685>>ASSIGN
B$M$STAR$
     10354**DCL     12487>>ASSIGN
B$PPUT$
     10361**DCL     10804--IMP-PTR 12294>>ASSIGN
B$PS0$
     10355**DCL     10969--IMP-PTR 10976--IMP-PTR 10982--IMP-PTR 10987--IMP-PTR 11860>>ASSIGN  11870>>ASSIGN
     11884>>CALL    11940>>IF      11940>>IF      11943>>IF      11943>>IF      11943>>IF      11958>>IF
     11984>>CALL    11986>>CALL    11994>>CALL    12001>>CALL    12003>>CALL    12005>>CALL    12007>>CALL
     12009>>CALL    12011>>CALL    12013>>CALL    12015>>CALL    12020>>CALL    12022>>CALL    12024>>CALL
     12067>>CALL    12267>>IF      12276>>IF      12277>>CALL    12286>>ASSIGN  12291>>ASSIGN  12302>>ASSIGN
     12316>>ASSIGN  12496<>CALL    12497>>ASSIGN
B$PS1$
     10356**DCL     12499<>CALL    12500>>ASSIGN
B$PS2$
     10358**DCL     11845<>CALL    11846>>ASSIGN  11926<>CALL    11927>>ASSIGN
B$U.ASYNCH
      2884**DCL     12082>>IF      12368>>IF      12702<<ASSIGN  12702>>ASSIGN
B$U.MISC
      2926**DCL      2927--REDEF
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:189  
B$USER.MISC
      3002**DCL      3003--REDEF
BCDCB.SID
     10330**DCL     11802<<ASSIGN  12363<<ASSIGN  12447<<ASSIGN
BCDCB$
     10327**DCL     10328--REDEF   11801<<ASSIGN  11865>>IF      11866>>ASSIGN  12080>>IF      12081>>CALL
     12088>>ASSIGN  12108>>ASSIGN  12111>>ASSIGN  12123>>ASSIGN  12123>>ASSIGN  12166>>ASSIGN  12166>>ASSIGN
     12184<<ASSIGN  12362<<ASSIGN  12364>>IF      12365>>CALL    12366>>ASSIGN  12446<<ASSIGN  12448>>IF
     12449>>CALL
BITS.B
     10802**DCL     12091>>IF
BRK_EVT IN PROCEDURE ENQRD
     12597**LABEL   12597--CALLALT
B_MPT.AS
     10398**DCL     10401--REDEF
B_MPT.ASDESC
     10430**DCL     10434--REDEF
B_MPT.ECCB
     10413**DCL     10416--REDEF
B_MPT.ECCB$
     10416**DCL     11873>>IF
B_MPT.ECCBDESC
     10448**DCL     10452--REDEF
B_MPT.LS
     10393**DCL     10396--REDEF
B_MPT.LSDESC
     10424**DCL     10428--REDEF
B_MPT.PS
     10403**DCL     10406--REDEF
B_MPT.PSDESC
     10436**DCL     10440--REDEF
B_MPT.SS
     10388**DCL     10391--REDEF
B_MPT.SSDESC
     10418**DCL     10422--REDEF
B_MPT.TCB
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:190  
     10408**DCL     10411--REDEF
B_MPT.TCBDESC
     10442**DCL     10446--REDEF
CACHECLR
     12697**PROC    12083--CALL    12369--CALL
CFU$
     10331**DCL     10955--IMP-PTR 10961--IMP-PTR 10966--IMP-PTR 12186<<ASSIGN  12259<<ASSIGN  12263>>ASSIGN
     12264>>IF      12266>>ASSIGN  12271>>ASSIGN  12284>>ASSIGN  12292>>IF      12294>>ASSIGN  12295>>ASSIGN
     12296>>ASSIGN  12296>>ASSIGN  12298>>ASSIGN  12302>>ASSIGN  12303>>ASSIGN  12308>>ASSIGN  12534<<ASSIGN
     12557>>IF      12579>>ASSIGN  12579>>ASSIGN  12583>>IF      12590>>IF      12594>>IF      12628>>IF
     12629>>ASSIGN  12631>>ASSIGN  12638>>IF      12639>>ASSIGN  12642>>ASSIGN  12643>>ASSIGN  12645>>CALL
     12666>>ASSIGN
CG$
     10337**DCL     12401<<ASSIGN  12403>>CALL
CHARS
     10803**DCL     12497>>ASSIGN  12500>>ASSIGN
CHKBAD
     12675**PROC    11900--CALL    11908--CALL    11924--CALL
CHKTYC
     12088**LABEL   12370--GOTO
CODE
     10334**DCL     12077<<ASSIGN  12084>>IF      12104>>IF      12108>>ASSIGN  12119>>IF      12119>>IF
     12123>>ASSIGN  12133>>IF      12154>>IF      12166>>ASSIGN  12173>>ASSIGN  12212<<ASSIGN  12214>>IF
     12214<<ASSIGN  12215<>CALL
COMMON IN PROCEDURE ENQRD
     12532**LABEL   12529--GOTO    12598--GOTO
COMPDO
     12139**LABEL   12175--GOTO
DEQ
     12622**PROC    12061--CALL    12075--CALL    12478--CALL
DONE
     12064**LABEL   11968--GOTO    12034--GOTO    12203--GOTO
DSSID IN PROCEDURE EXTEND
     12251**DCL     12262<<ASSIGN  12265<<ASSIGN  12268>>IF      12269<>CALL    12275>>IF      12277<>CALL
     12292>>IF      12293>>IF      12315>>IF      12318<>CALL
ENQRD
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:191  
     12525**PROC    11844--CALL    11954--CALL    11975--CALL    12188--CALL
ENQWR IN PROCEDURE ENQRD
     12530**ENTRY   11902--CALL    11911--CALL    11931--CALL    12281--CALL    12474--CALL
ENTFLG
     10336**DCL     12381<<ASSIGN  12385<<ASSIGN  12391>>IF      12400>>IF      12439>>IF
ERR IN PROCEDURE EXTEND
     12311**LABEL   12281--CALLALT 12287--CALLALT 12292--CALLALT 12306--CALLALT
ERRBROKEN
     10863**DCL     12685>>ASSIGN
ERRDELREC
     10819**DCL     11918>>ASSIGN
ERRDEQ
     12061**LABEL   11844--CALLALT 11902--CALLALT 11911--CALLALT 11931--CALLALT 11954--CALLALT 11967--CALLALT
     11975--CALLALT 12188--CALLALT 12474--CALLALT
ERRDMY
     10839**DCL     12095>>ASSIGN
ERRDMYFMI
     10882**DCL     12093>>ASSIGN
ERRDOMAIN
     10831**DCL     11816>>ASSIGN  12358>>ASSIGN  12394>>ASSIGN
ERREOD
     10879**DCL     12427>>ASSIGN
ERREOF
     10843**DCL     11997>>ASSIGN
ERREXTEND
     10827**DCL     11961>>ASSIGN
ERRINVVFC
     10871**DCL     11850>>ASSIGN
ERRJRNL
     10835**DCL     12591>>ASSIGN
ERRMTRAP
     10847**DCL     12039>>ASSIGN
ERRNOACCT
     10867**DCL     12511>>ASSIGN
ERRNOCODE
     10875**DCL     12228>>ASSIGN  12230>>DOWHILE 12323>>ASSIGN
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:192  
ERRNOEVENT
     10859**DCL     11874>>ASSIGN  12225>>ASSIGN  12232>>ASSIGN
ERROR
     12061**LABEL   11851--GOTO    11875--GOTO    11984--CALLALT 11986--CALLALT 11988--CALLALT 11990--CALLALT
     11992--CALLALT 11994--CALLALT 11998--GOTO    12001--CALLALT 12003--CALLALT 12005--CALLALT 12007--CALLALT
     12009--CALLALT 12011--CALLALT 12013--CALLALT 12015--CALLALT 12020--CALLALT 12022--CALLALT 12024--CALLALT
     12026--CALLALT 12044--GOTO    12195--CALLALT 12197--CALLALT 12199--CALLALT 12201--CALLALT
ERRPMMEINT
     10851**DCL     12372>>ASSIGN  12610>>ASSIGN
ERRPOS
     10823**DCL     11947>>ASSIGN
ERRREAD
     10811**DCL     11836>>ASSIGN
ERRSHRDS2BIG
     10855**DCL     12326>>ASSIGN
ERRWR
     11894**LABEL   11907--GOTO
ERRWRITE
     10815**DCL     11894>>ASSIGN
ERRXIT
     12062**LABEL   11817--GOTO    11837--GOTO    11895--GOTO    11900--CALLALT 11908--CALLALT 11919--GOTO
     11924--CALLALT 11948--GOTO    11962--GOTO    12359--GOTO    12373--GOTO    12395--GOTO
EVENT
     10335**DCL     11870<<ASSIGN  11871>>IF      12117>>IF
EXTEND
     12247**PROC    11967--CALL
F$DCB.ACCT
     10915**DCL     12497<<ASSIGN  12515>>ASSIGN
F$DCB.ACS
     10922**DCL     12262>>ASSIGN  12439>>IF      12544>>IF      12627>>IF      12678>>IF
F$DCB.ACTPOS
     10930**DCL     10930--REDEF
F$DCB.AGE
     10949**DCL     11828<<ASSIGN
F$DCB.ARS
     10905**DCL     10905--REDEF   11832<<ASSIGN  12141>>ASSIGN
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:193  
F$DCB.ASN
     10920**DCL     11882>>IF      11925>>IF      11958>>IF      12104>>IF      12285>>IF      12399>>IF
     12439>>IF      12492<<ASSIGN  12678>>IF
F$DCB.ATTR
     10923**DCL     10924--REDEF
F$DCB.AU
     10916**DCL     11958>>IF
F$DCB.BFR.BUFUP
     10949**DCL     12071>>IF      12629>>ASSIGN  12659>>IF
F$DCB.BFR.CVM
     10950**DCL     12071>>IF      12465>>IF
F$DCB.BFR1.CX
     10951**DCL     12071>>IF      12467>>IF      12468>>IF      12547>>IF      12548>>IF      12559>>IF
     12560>>IF      12659>>IF
F$DCB.BORROW
     10938**DCL     10938--REDEF   10938--REDEF   10938--REDEF
F$DCB.CFU$
     10939**DCL     12186>>ASSIGN  12213<<ASSIGN  12259>>ASSIGN  12441>>IF      12460>>ASSIGN  12475>>IF
     12534>>ASSIGN  12537<>CALL    12540<>CALL    12595<>CALL    12645<>CALL    12647<>CALL    12667<>CALL
     12678>>IF
F$DCB.DCBNAME.L
     10952**DCL     10952--IMP-SIZ
F$DCB.DECRYPT
     10945**DCL     12066>>IF
F$DCB.DESC.BAD
     10913**DCL     12678>>IF
F$DCB.DVBYTE
     10908**DCL     12142>>ASSIGN
F$DCB.DVBYTE.VFC
     10908**DCL     11847>>IF
F$DCB.ENQF
     10937**DCL     12543<<ASSIGN  12596<<ASSIGN  12625>>IF      12648<<ASSIGN  12668<<ASSIGN
F$DCB.EOMCHAR
     10909**DCL     10909--REDEF   12143>>ASSIGN
F$DCB.FCD
     10918**DCL     11803>>IF      11810>>IF      12352>>IF      12389>>IF      12489>>IF      12506>>IF
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:194  
     12508>>IF
F$DCB.FCN
     10942**DCL     12080>>IF      12081<>CALL    12364>>IF      12365<>CALL    12448>>IF      12449<>CALL
F$DCB.FCN.CNT
     10942**DCL     12425>>DOWHILE
F$DCB.FFLG
     10909**DCL     11942>>IF      11972>>IF      12510>>IF
F$DCB.FFLG.DELR
     10910**DCL     11915>>IF      11937>>IF
F$DCB.FFLG.EXEC
     10910**DCL     11813>>IF      12355>>IF      12391>>IF
F$DCB.FFLG.READ
     10910**DCL     11833>>IF      11937>>IF
F$DCB.FFLG.UPD
     10910**DCL     11893>>IF      11937>>IF
F$DCB.FFLG.WNEW
     10910**DCL     11893>>IF      11907>>IF      11958>>IF      12439>>IF
F$DCB.FLDID
     10933**DCL     10933--REDEF
F$DCB.FORM$
     10927**DCL     10927--REDEF
F$DCB.FSECT
     10943**DCL     10943--REDEF
F$DCB.FSN
     10920**DCL     10920--REDEF   10920--REDEF   10921--REDEF
F$DCB.FTAM
     10938**DCL     12229<>CALL
F$DCB.FTAM.PMME
     10939**DCL     12227<<ASSIGN
F$DCB.FTAM.USR
     10938**DCL     12211<<ASSIGN
F$DCB.FUN
     10919**DCL     11804>>IF      11806<<ASSIGN  12493<<ASSIGN
F$DCB.HEADER$
     10926**DCL     10926--REDEF
F$DCB.IASN
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:195  
     10946**DCL     11935>>IF      11958>>IF      12069>>IF      12104>>IF      12190>>IF      12255>>IF
     12450>>DOCASE  12677>>IF
F$DCB.IFMT
     10945**DCL     11982>>DOCASE  12112>>IF      12112>>IF      12678>>IF      12678>>IF      12678>>IF
F$DCB.IORG
     10941**DCL     12193>>DOCASE  12255>>IF      12255>>IF      12290>>IF      12532>>IF
F$DCB.IXTNSIZE
     10924**DCL     10924--REDEF
F$DCB.LASTSTA$
     10914**DCL     10914--REDEF
F$DCB.LDCTX
     10927**DCL     12401>>ASSIGN  12402>>ASSIGN  12410>>ASSIGN
F$DCB.LVL
     10939**DCL     10939--REDEF
F$DCB.MODCNT
     10944**DCL     12557>>IF      12666<<ASSIGN
F$DCB.NAME.C
     10914**DCL     10914--REDEF
F$DCB.NOEOF
     10935**DCL     10935--REDEF
F$DCB.NRECS
     10925**DCL     10925--REDEF   12271<<ASSIGN  12298<<ASSIGN  12309<<ASSIGN
F$DCB.NRECX
     10944**DCL     10944--REDEF
F$DCB.OHDR
     10936**DCL     10936--REDEF
F$DCB.OLDIOERR
     10945**DCL     12087>>IF      12087>>IF
F$DCB.ORG
     10919**DCL     10919--REDEF   12092>>IF      12092>>IF      12264>>IF      12439>>IF
F$DCB.OWNER
     10936**DCL     12594>>IF      12640>>IF
F$DCB.PRECNO
     10942**DCL     10942--REDEF
F$DCB.PSN
     10915**DCL     12500<<ASSIGN  12503<<ASSIGN  12516>>ASSIGN
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:196  
F$DCB.RCSZ
     10947**DCL     10947--REDEF
F$DCB.RECL
     10920**DCL     12303>>ASSIGN
F$DCB.RES
     10915**DCL     10915--REDEF
F$DCB.RESNT.TYP
     10915**DCL     12407>>IF      12409>>IF
F$DCB.SETX
     10927**DCL     10927--REDEF
F$DCB.SHARED
     10934**DCL     11843>>IF      11901>>IF      11910>>IF      11930>>IF      11953>>IF      11974>>IF
     12068>>IF      12187>>IF      12280>>IF
F$DCB.TAB$
     10926**DCL     10927--REDEF
F$DCB.TAPTYP.MANAGED
     10940**DCL     12104>>IF
F$DCB.TDA
     10941**DCL     10941--REDEF
F$DCB.TYC
     10905**DCL     11826<<ASSIGN  11866<<ASSIGN  12088<<ASSIGN  12088>>ASSIGN  12089>>IF      12091--IF
     12108<<ASSIGN  12108>>ASSIGN  12111<<ASSIGN  12111>>ASSIGN  12123<<ASSIGN  12123>>ASSIGN  12166<<ASSIGN
     12166>>ASSIGN  12189<<ASSIGN  12366<<ASSIGN  12366>>ASSIGN  12367<<ASSIGN
F$DCB.TYC.EGV
     10905**DCL     11865>>IF
F$DCB.UB$
     10943**DCL     11846<<ASSIGN  11858<<ASSIGN  11927<<ASSIGN
F$DCB.UBYTES
     10943**DCL     11845<>CALL    11847>>IF      11909<<ASSIGN  11926<>CALL
F$DCB.WAIT
     10937**DCL     11860<<ASSIGN  11861>>IF      11906<<ASSIGN  11914<<ASSIGN  11934<<ASSIGN  11957<<ASSIGN
     11971<<ASSIGN  12078>>IF      12185<<ASSIGN  12661>>IF
F$DCB.WSN
     10916**DCL     10916--REDEF
F$DCB.WSR
     10922**DCL     11808<<ASSIGN  11815>>IF      12260>>IF      12261>>ASSIGN  12357>>IF      12393>>IF
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:197  
     12442>>ASSIGN
F$DCB.XTNSIZE
     10922**DCL     12286<<ASSIGN  12291<<ASSIGN  12296>>ASSIGN  12297>>ASSIGN  12305<<ASSIGN
FAG$GEXT
     10263**DCL-ENT 12292--CALL    12306--CALL
FM$CFU.ACCTX
     10956**DCL     10956--REDEF
FM$CFU.B
     10958**DCL     12678>>IF
FM$CFU.FMOD
     10955**DCL     12284<<ASSIGN
FM$CFU.MODCNT
     10957**DCL     12557>>IF      12579<<ASSIGN  12579>>ASSIGN  12666>>ASSIGN
FM$CFU.NRECS
     10956**DCL     12263>>ASSIGN  12271>>ASSIGN  12296<<ASSIGN  12296>>ASSIGN  12298>>ASSIGN  12302>>ASSIGN
     12308<<ASSIGN
FM$CFU.UGRANS
     10957**DCL     12292>>IF      12303>>ASSIGN  12441>>IF
FM$CFUJ.DMAIN
     10962**DCL     12643>>ASSIGN
FM$CFUJ.ERR_WAIT
     10962**DCL     12594>>IF      12631<<ASSIGN  12638>>IF      12639<<ASSIGN
FM$CFUJ.PAGE#
     10962**DCL     12583>>IF      12590>>IF      12628>>IF
FM$CFUJ.UPD
     10961**DCL     12475>>IF      12629<<ASSIGN
FM$CFUJ.USER
     10962**DCL     12645<>CALL
FM$CFUJ.VOL
     10961**DCL     12642>>ASSIGN
FM$CFUR.HEADPP#
     10966**DCL     12264>>IF      12266>>ASSIGN
FM$CFUR.TAILPP#
     10966**DCL     12294>>ASSIGN  12295<<ASSIGN
FMB$IOSPIN
     10271**DCL-ENT 12670--CALL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:198  
FMC$CACHETBL.FLAGS.ERR
     11793**DCL     12548>>IF      12560>>IF
FMC$CACHETBL.USECNT
     11785**DCL     12468>>IF
FMC_CACHE$
      1577**DCL     11776--IMP-PTR 12468>>IF      12548>>IF      12560>>IF
FMC_CACHEPGCNT$
      1578**DCL      1578--IMP-PTR  1578--REDEF
FMD$DECRYPT_BUFFER
     10277**DCL-ENT 12067--CALL
FMD$FLSHBUF
     10272**DCL-ENT 12036--CALL    12471--CALL
FMD$RELBUF
     10276**DCL-ENT 12456--CALL    12479--CALL    12549--CALL    12553--CALL    12561--CALL    12565--CALL
     12600--CALL
FMD$WRTCACHE
     10273**DCL-ENT 12073--CALL
FMD$WRTSV
     10275**DCL-ENT 12469--CALL    12476--CALL
FMD$WRTSVNW
     10274**DCL-ENT 12660--CALL
FMG$KPMME
     10264**DCL-ENT 11988--CALL    12197--CALL
FMH$CPMME
     10265**DCL-ENT 11984--CALL    12195--CALL
FMH$MAPJRNL
     10266**DCL-ENT 12601--CALL
FMH$UBLOCK
     10267**DCL-ENT 11986--CALL
FMI$DSWRITE
     10268**DCL-ENT 12444--CALL
FMI$RAN
     10269**DCL-ENT 11990--CALL    12199--CALL
FMJ$REL
     10270**DCL-ENT 11992--CALL    12201--CALL
FMM$DFLOPN
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:199  
     10278**DCL-ENT 11809--CALL    12505--CALL
FMM$SCRUB
     10279**DCL-ENT 12491--CALL
FMO$GETDOMAIN
     10280**DCL-ENT 11807--CALL    11814--CALL    11883--CALL    12356--CALL    12392--CALL
FMP$CLSJ
     10281**DCL-ENT 12490--CALL    12509--CALL
FM_FTAM_USER IN PROCEDURE FTAM_WAIT
     12222**DCL     12224>>ASSIGN  12225>>IF      12232>>IF
FPT$EXTEND_V.SIZ
     10987**DCL     11958>>IF      12267>>IF      12276>>IF      12277>>CALL    12286>>ASSIGN  12291>>ASSIGN
     12302>>ASSIGN  12316>>ASSIGN
FPT$PRECORD_V.BOF
     10982**DCL     11940>>IF
FPT$PRECORD_V.EOF
     10982**DCL     11940>>IF
FPT$PRECORD_V.KEYR
     10982**DCL     11943>>IF
FPT$PRECORD_V.KEYS
     10982**DCL     11943>>IF
FPT$PRECORD_V.N
     10983**DCL     11943>>IF
FPT$READ_V
     10969**DCL     11984<>CALL    11986<>CALL
FPT$READ_V.DVBYTE.REREAD
     10971**DCL     10972--REDEF
FPT$READ_V.EVENT
     10971**DCL     11870>>ASSIGN  11884<>CALL
FPT$READ_V.INDX
     10971**DCL     10971--REDEF
FPT$READ_V.SEED
     10971**DCL     12067<>CALL
FPT$READ_V.WAIT
     10969**DCL     11860>>ASSIGN
FPT$WRITE_V
     10976**DCL     11994<>CALL    12001<>CALL    12003<>CALL    12005<>CALL    12007<>CALL    12009<>CALL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:200  
     12011<>CALL    12013<>CALL    12015<>CALL    12020<>CALL    12022<>CALL    12024<>CALL
FPT$WRITE_V.DVBYTE.VFC
     10978**DCL     10978--REDEF
FPTCODE
       178**DCL       174--PROC    11805>>IF      11830>>DOCASE  11847>>IF      11939>>IF      11984<>CALL
     11986<>CALL    11988<>CALL    11990<>CALL    11992<>CALL    11994<>CALL    11996>>IF      12001<>CALL
     12003<>CALL    12005<>CALL    12007<>CALL    12009<>CALL    12011<>CALL    12013<>CALL    12015<>CALL
     12017<>CALL    12020<>CALL    12022<>CALL    12024<>CALL    12026<>CALL    12037>>IF      12037>>IF
     12140>>IF      12181--ENTRY   12208--ENTRY   12212>>ASSIGN  12213--ASSIGN  12227>>ASSIGN  12380--ENTRY
     12384--ENTRY   12532>>IF      12582>>IF
FSD$JE
     10284**DCL-ENT 12001--CALL
FSE$FPRG
     10293**DCL-ENT 12013--CALL
FSE$FPSTREAM
     10294**DCL-ENT 12015--CALL
FSE$GR
     10285**DCL-ENT 12020--CALL
FSE$GRSTRM
     10286**DCL-ENT 12022--CALL
FSE$NC
     10287**DCL-ENT 12024--CALL
FSE$TTY
     10291**DCL-ENT 12009--CALL
FSE$TTYSTREAM
     10292**DCL-ENT 12011--CALL
FSE$UR
     10288**DCL-ENT 12003--CALL
FSE$URFILE
     10289**DCL-ENT 12005--CALL
FSE$URSTREAM
     10290**DCL-ENT 12007--CALL
FTAMCODE IN PROCEDURE FTAM_WAIT
     12221**DCL     12219--PROC
FTAM_WAIT
     12219**PROC    12026--CALL    12215--CALL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:201  
FTT$TRUNC
     10282**DCL-ENT 12452--CALL
FTW$WRAT
     10283**DCL-ENT 11994--CALL
F_CODE
      1937**DCL     12096>>ASSIGN
F_DCBLOCK
      1565**DCL     11863<>CALL    11868<>CALL    12121<>CALL    12125<>CALL    12164<>CALL    12168<>CALL
F_SEV
      1937**DCL     12097>>ASSIGN
F_TYCBITS
      1937**DCL     12108>>ASSIGN  12123>>ASSIGN  12166>>ASSIGN  12173>>ASSIGN
F_TYCMAX
      1937**DCL     12090>>DOINDEX 12104>>IF      12119>>IF      12154>>IF
GRANS IN PROCEDURE EXTEND
     12250**DCL     12263<<ASSIGN  12269>>CALL    12269<>CALL    12276>>IF      12277<>CALL    12295>>ASSIGN
     12303<<ASSIGN  12304>>IF      12305>>ASSIGN  12317<>CALL
HFC$CACHECLR
     10295**DCL-ENT 12706--CALL
HFC$LOCK
      2528**DCL-ENT 11863--CALL    12121--CALL    12137--CALL    12164--CALL    12171--CALL    12415--CALL
     12422--CALL    12700--CALL
HFC$UNLOCK
      2528**DCL-ENT 11868--CALL    12125--CALL    12145--CALL    12168--CALL    12436--CALL    12704--CALL
HFF$DSIZ
     10297**DCL-ENT 11845--CALL    11926--CALL    12496--CALL    12499--CALL
HFF$NILERASE
     10300**DCL-ENT 12495--CALL    12498--CALL
HFF$TRAPALT
     10296**DCL-ENT 11981--CALL
I
     10332**DCL     10803--IMP-SIZ 11807<>CALL    11808>>ASSIGN  11814<>CALL    11815>>IF      11883<>CALL
     11884<>CALL    12070<<DOINDEX 12071>>IF      12071>>IF      12071>>IF      12073<>CALL    12090<<DOINDEX
     12091>>IF      12096>>ASSIGN  12097>>ASSIGN  12356<>CALL    12357>>IF      12392<>CALL    12393>>IF
     12442<<ASSIGN  12443>>IF      12443<<ASSIGN  12444<>CALL    12455<<DOINDEX 12456<>CALL    12464<<DOINDEX
     12465>>IF      12467>>IF      12468>>IF      12469<>CALL    12471<>CALL    12476<>CALL    12479<>CALL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:202  
     12496<>CALL    12497>>ASSIGN  12499<>CALL    12500>>ASSIGN  12546<<DOINDEX 12547>>IF      12548>>IF
     12549<>CALL    12552>>IF      12553<>CALL    12558<<DOINDEX 12559>>IF      12560>>IF      12561<>CALL
     12564>>IF      12565<>CALL    12634<<CALLBLT 12636<<CALLBLT 12643<<ASSIGN  12645<>CALL    12658<<DOINDEX
     12659>>IF      12659>>IF      12660<>CALL
I IN PROCEDURE EXTEND
     12253**DCL     12277<>CALL    12316<<ASSIGN  12317<>CALL    12318>>CALL    12318<>CALL
IOFLAG IN PROCEDURE DEQ
     12623**DCL     12626<<ASSIGN  12662<<ASSIGN  12662>>ASSIGN  12669>>IF
JDCB$
     10326**DCL     10905--IMP-PTR 11800<<ASSIGN  11801>>ASSIGN  11803>>IF      11804>>IF      11806>>ASSIGN
     11808>>ASSIGN  11810>>IF      11813>>IF      11815>>IF      11826>>ASSIGN  11828>>ASSIGN  11832>>ASSIGN
     11833>>IF      11843>>IF      11845>>CALL    11846>>ASSIGN  11847>>IF      11847>>IF      11858>>ASSIGN
     11860>>ASSIGN  11861>>IF      11882>>IF      11893>>IF      11893>>IF      11901>>IF      11906>>ASSIGN
     11907>>IF      11909>>ASSIGN  11910>>IF      11914>>ASSIGN  11915>>IF      11925>>IF      11926>>CALL
     11927>>ASSIGN  11930>>IF      11934>>ASSIGN  11935>>IF      11937>>IF      11937>>IF      11937>>IF
     11942>>IF      11953>>IF      11957>>ASSIGN  11958>>IF      11958>>IF      11958>>IF      11958>>IF
     11971>>ASSIGN  11972>>IF      11974>>IF      11982>>DOCASE  12066>>IF      12068>>IF      12069>>IF
     12071>>IF      12071>>IF      12071>>IF      12078>>IF      12087>>IF      12087>>IF      12088>>ASSIGN
     12089>>IF      12091>>IF      12092>>IF      12092>>IF      12104>>IF      12104>>IF      12104>>IF
     12108>>ASSIGN  12111>>ASSIGN  12112>>IF      12112>>IF      12141>>ASSIGN  12142>>ASSIGN  12143>>ASSIGN
     12183<<ASSIGN  12184>>ASSIGN  12185>>ASSIGN  12186>>ASSIGN  12187>>IF      12189>>ASSIGN  12190>>IF
     12193>>DOCASE  12210<<ASSIGN  12211>>ASSIGN  12213>>ASSIGN  12227>>ASSIGN  12229>>CALL    12255>>IF
     12255>>IF      12255>>IF      12259>>ASSIGN  12260>>IF      12261>>ASSIGN  12262>>ASSIGN  12264>>IF
     12271>>ASSIGN  12280>>IF      12285>>IF      12286>>ASSIGN  12290>>IF      12291>>ASSIGN  12296>>ASSIGN
     12297>>ASSIGN  12298>>ASSIGN  12303>>ASSIGN  12305>>ASSIGN  12309>>ASSIGN  12351<<ASSIGN  12352>>IF
     12355>>IF      12357>>IF      12362>>ASSIGN  12366>>ASSIGN  12367>>ASSIGN  12387<<ASSIGN  12389>>IF
     12391>>IF      12393>>IF      12399>>IF      12401>>ASSIGN  12402>>ASSIGN  12407>>IF      12409>>IF
     12410>>ASSIGN  12425>>DOWHILE 12439>>IF      12439>>IF      12439>>IF      12439>>IF      12441>>IF
     12442>>ASSIGN  12446>>ASSIGN  12450>>DOCASE  12460>>ASSIGN  12467>>IF      12468>>IF      12488<<ASSIGN
     12489>>IF      12492>>ASSIGN  12493>>ASSIGN  12497>>ASSIGN  12500>>ASSIGN  12503>>ASSIGN  12506>>IF
     12508>>IF      12510>>IF      12515>>ASSIGN  12516>>ASSIGN  12532>>IF      12534>>ASSIGN  12537>>CALL
     12540>>CALL    12543>>ASSIGN  12544>>IF      12547>>IF      12548>>IF      12557>>IF      12559>>IF
     12560>>IF      12594>>IF      12595>>CALL    12596>>ASSIGN  12625>>IF      12627>>IF      12629>>ASSIGN
     12640>>IF      12645>>CALL    12647>>CALL    12648>>ASSIGN  12659>>IF      12659>>IF      12661>>IF
     12666>>ASSIGN  12667>>CALL    12668>>ASSIGN  12677>>IF      12678>>IF      12678>>IF      12678>>IF
     12678>>IF      12678>>IF      12678>>IF      12678>>IF
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:203  
JRNLECCI
     10344**DCL     12645--CALL
JRNLECCI.P#
     10346**DCL     12641<<ASSIGN
JRNLECCI.VOL
     10346**DCL     12642<<ASSIGN
KCO$EXTEND
     10301**DCL-ENT 12287--CALL
KIA$COMP
     10303**DCL-ENT 12433--CALL
KIA$FCNOU
     10304**DCL-ENT 12417--CALL
KIS$OSI_TRUNC
     10302**DCL-ENT 12408--CALL
KQ$CG
     11050**DCL     12403<>CALL
KQ$CG.AUCTL.DVBYTE.REREAD
     11493**DCL     11494--REDEF
KQ$STA
     10476**DCL     12404<>CALL
KQ$STA.ACTTYC
     10528**DCL     10532--REDEF
KQ$STA.DCBLNK$
     10535**DCL     10538--REDEF   10542--REDEF
KQ$STA.EVCNT
     10621**DCL     10624--REDEF
KQ$STA.EVNT
     10587**DCL     10591--REDEF   10594--REDEF
KQ$STA.OPNBLKED
     10648**DCL     10651--REDEF
KQ$STA.OPNREJ
     10654**DCL     10656--REDEF
KQ$STA.SUCCREAD
     10577**DCL     10581--REDEF
KQ$STA.TCOUNT
     10706**DCL     10712--REDEF
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:204  
KQ$STA.VGOT$
     10691**DCL     10695--REDEF   10699--REDEF
KQC$ABTRD
     10305**DCL-ENT 12404--CALL
KQX$LDASR
     10306**DCL-ENT 12403--CALL
K_RWPARM_CON
      4808**DCL     12411>>ASSIGN  12426>>ASSIGN
K_RWPARM_CON.BLKREC
      4834**DCL      4859--REDEF
K_RWPARM_CON.BLKREC.BLKU#
      4835**DCL      4837--REDEF
K_RWPARM_CON.BLKREC.RECU#
      4847**DCL      4849--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      4874**DCL      4875--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      4882**DCL      4886--REDEF
K_RWPARM_CON.ERR
      4946**DCL      4951--REDEF
K_RWPARM_CON.FC
      4910**DCL      4911--REDEF
K_RWPARM_CON.FLDID
      5092**DCL      5093--REDEF
K_RWPARM_CON.FPT$
      4973**DCL      4980--REDEF
K_RWPARM_CON.KEYTYPE
      5099**DCL      5100--REDEF
K_RWPARM_CON.MSG$
      4809**DCL      4815--REDEF
K_RWPARM_CON.MSGID
      4921**DCL      4926--REDEF
K_RWPARM_CON.MSGIDXT
      4934**DCL      4938--REDEF
K_RWPARM_CON.ORG
      5070**DCL      5071--REDEF
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:205  
K_RWPARM_CON.THDRSZ
      5014**DCL      5018--REDEF
K_RWPARM_CON.VDOFLGS
      5072**DCL      5083--REDEF
LDCT$
     10339**DCL     12410<<ASSIGN  12413>>ASSIGN  12415>>CALL    12417>>CALL    12419>>ASSIGN  12420<>CALL
     12422>>CALL    12433>>CALL    12436>>CALL
LS0UBIN
     10360**DCL     12262>>ASSIGN
MEMTRAP
     12036**LABEL   11981--CALLALT
MM$PPUT.PPNO
     10806**DCL     12294<<ASSIGN
MMDSERR IN PROCEDURE EXTEND
     12323**LABEL   12269--CALLALT 12277--CALLALT
MMH$FDS
     10309**DCL-ENT 12318--CALL
MMH$MAP_DS
     10307**DCL-ENT 12269--CALL
MMH$SHARE_DS
     10308**DCL-ENT 12277--CALL
MMJ$FPPCHAIN
     10310**DCL-ENT 12317--CALL
MM_SHAREDSUSE
     10455**DCL     12297<<ASSIGN  12297>>ASSIGN
N$DCT$$
      6586**DCL      6586--IMP-PTR 12401>>ASSIGN  12402>>ASSIGN  12410>>ASSIGN
NAI$WRITE
     10311**DCL-ENT 12017--CALL
NK$LDCT
     11002**DCL     12417<>CALL    12433<>CALL
NK$LDCT.CG$
     11033**DCL     12401>>ASSIGN
NK$LDCT.DDT$
     11004**DCL     11004--REDEF
NK$LDCT.IOQ$
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:206  
     11003**DCL     11004--REDEF
NK$LDCT.LDCTX
     11005**DCL     11005--REDEF
NK$LDCT.LKFLG.ABORTED
     11017**DCL     11018--REDEF
NK$LDCT.LKFLG.WTMRK
     11018**DCL     12419<<ASSIGN
NK$LDCT.LOCK
     11030**DCL     12415<>CALL    12422<>CALL    12436<>CALL
NK$LDCT.NOWAIT.STREAM
     11013**DCL     12413>>ASSIGN
NK$LDCT.RLCID.LDCTX
     11027**DCL     11027--REDEF
NK$LDCT.STA$
     11023**DCL     11024--REDEF   12402>>ASSIGN
NK$LDCT.SYMB$
     11002**DCL     11002--REDEF   11002--REDEF   11003--REDEF
NK$LDCT$
      6586**DCL     12401>>ASSIGN  12402>>ASSIGN  12410>>ASSIGN
NOREAD
     11836**LABEL   11973--GOTO
NO_REG IN PROCEDURE DEQ
     12659**LABEL   12635--GOTO    12637--GOTO
PMMEINT
     12372**LABEL   12365--CALLALT
PRECOK
     11953**LABEL   11945--GOTO
PREC_ERR
     11947**LABEL   11936--GOTO    11941--GOTO
QERR IN PROCEDURE ENQRD
     12610**LABEL   12537--CALLALT 12540--CALLALT
RDWRT
     11845**LABEL   11903--GOTO
RECS IN PROCEDURE EXTEND
     12249**DCL     12266<<ASSIGN  12269<>CALL    12277<>CALL    12294>>ASSIGN  12302<<ASSIGN  12303>>ASSIGN
     12308>>ASSIGN  12309>>ASSIGN  12317<>CALL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:207  
RSET
     12519**LABEL   12495--CALLALT
RWPARM
      6182**DCL     12411<<ASSIGN  12417<>CALL    12426<<ASSIGN  12433<>CALL
RWPARM.BLKREC
      6208**DCL      6233--REDEF
RWPARM.BLKREC.BLKU#
      6209**DCL      6211--REDEF
RWPARM.BLKREC.RECU#
      6221**DCL      6223--REDEF
RWPARM.DVE.DVBYTE.VFC
      6248**DCL      6249--REDEF
RWPARM.DVE.EOMCHAR
      6256**DCL      6260--REDEF
RWPARM.ERR
      6320**DCL      6325--REDEF
RWPARM.FC
      6284**DCL      6285--REDEF
RWPARM.FLDID
      6466**DCL      6467--REDEF
RWPARM.FPT$
      6347**DCL      6354--REDEF
RWPARM.KEYTYPE
      6473**DCL      6474--REDEF
RWPARM.MRKTYP
      6458**DCL     12412<<ASSIGN
RWPARM.MSG$
      6183**DCL      6189--REDEF
RWPARM.MSGID
      6295**DCL      6300--REDEF
RWPARM.MSGIDXT
      6308**DCL      6312--REDEF
RWPARM.MSG_ERRCODE
      6443**DCL     12427<<ASSIGN
RWPARM.ORG
      6444**DCL      6445--REDEF
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:208  
RWPARM.STR
      6459**DCL     12413<<ASSIGN
RWPARM.THDRSZ
      6388**DCL      6392--REDEF
RWPARM.TYC
      6204**DCL     12432<<ASSIGN
RWPARM.VDOFLGS
      6446**DCL      6457--REDEF
S$CU$
      3013**DCL     12082>>IF      12368>>IF      12702>>ASSIGN  12702>>ASSIGN
SC_FMF92
     10312**DCL-ENT 12028--CALL
SHRDS2BIG IN PROCEDURE EXTEND
     12326**LABEL   12276--GOTO
SSR$REG
     10313**DCL-ENT 12081--CALL    12231--CALL    12365--CALL    12420--CALL    12449--CALL    12597--CALL
SSV$EVENT
     10314**DCL-ENT 12229--CALL    12645--CALL
SSV$INITDO
     10315**DCL-ENT 11884--CALL
SSV$SCHDDO
     10316**DCL-ENT 12149--CALL
SSV$XXDO
     10317**DCL-ENT 12157--CALL
STA$
     10338**DCL     12402<<ASSIGN  12404>>CALL
S_ASFGATE
     10456**DCL     12700<>CALL    12704<>CALL
S_CUN
     10458**DCL     12149<>CALL    12156>>ASSIGN  12678>>IF
S_UDLGATE
     10457**DCL     12137<>CALL    12145<>CALL    12171<>CALL
TRUNC
     12387**LABEL   12382--GOTO    12462--GOTO
TYPE IN PROCEDURE ENQRD
     12526**DCL     12528<<ASSIGN  12531<<ASSIGN  12535>>DOCASE  12545>>IF      12578>>IF
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:209  
UDB$PMMEXIT1
     10318**DCL-ENT 12113--CALL
UDN$MAGIC
     10319**DCL-ENT 11872--CALL
UQB$MDEQ
     10322**DCL-ENT 12595--CALL    12647--CALL    12667--CALL
UQB$MENQSB
     10320**DCL-ENT 12540--CALL
UQB$MENQXB
     10321**DCL-ENT 12537--CALL
USR
     10333**DCL     12156<<ASSIGN  12157<>CALL    12224<<ASSIGN  12225>>IF      12225>>IF      12229<>CALL
     12232>>IF
USRJRNERR
     10886**DCL     10892--REDEF
USRJRNERRS
     10892**DCL     12634>>CALLBLT
USRTJNERR
     10893**DCL     10897--REDEF
USRTJNERRS
     10897**DCL     12636>>CALLBLT
VEC
     11981**LABEL   12191--GOTO
WSQ IN PROCEDURE EXTEND
     12252**DCL     12260<<ASSIGN  12261<<ASSIGN  12269<>CALL    12277<>CALL    12318<>CALL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:210  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:211  
              MINI UREF LISTING

B$DOCONT    2960**DCL
B$ROSEG$   10357**DCL
B$USRT$    3014**DCL
CHKOPN   12389**LABEL
F$CFU$    1566**DCL
FM$SET$    1567**DCL
FMC$CACHEPGCNT    1578**DCL
FMC_CACHEPGCNT    1578**DCL
FMC_CACHEPGCNT$R    1578**DCL
FMC_CACHESIZ    1577**DCL
FMC_CACHESIZN    1577**DCL
FMC_LOCK    1579**DCL
FMC_MASK    1579**DCL
FMC_MASKTBL    1579**DCL
FMC_STATS$    1577**DCL
FMC_TYPTBL$    1577**DCL
FMF$CHECK   12350**ENTRY
FMF$PEOF   12181**ENTRY
FMF$PMME     174**PROC
FMF$REMOTE   12208**ENTRY
FMF$SETFMA   12486**ENTRY
FMF$TRUNC   12384**ENTRY
FMF$TRUNCM   12380**ENTRY
FM_CFUWAIT    1566**DCL
FM_CFUWGRB    1566**DCL
FM_EOP    1564**DCL
FM_FRMAX    1563**DCL
FM_FRZERO    1563**DCL
FM_GCT    1567**DCL
FM_GIP    1567**DCL
FM_GPSDA    1564**DCL
FM_HASH    1565**DCL
PL6.E3A0      #001=FMF$PMME File=FMF$PMME.:E05TSI                                TUE 07/29/97 16:42 Page:212  
FM_MADSDA    1564**DCL
FM_PADSDA    1564**DCL
FM_SRMAX    1563**DCL
FM_SRZERO    1563**DCL
FM_SYSACCTX    1567**DCL
FM_SYSSETX    1567**DCL
FM_TRUNC    1565**DCL
FM_WSQ    1565**DCL
F_CWLK    1566**DCL
F_CWUSER    1566**DCL
HFF$ERASE   10298**DCL-ENT
HFF$NIL   10299**DCL-ENT
K_HEADER    5103**DCL
K_LOCK    5103**DCL
K_NODE#    5103**DCL
NK_CUR    6587**DCL
NK_FHD$    6586**DCL
NK_HLPUN    6587**DCL
NK_MXLOCAL    6586**DCL
NK_MXTOTAL    6586**DCL
NK_NDCT$    6587**DCL

PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:213  
     1391        1        /*T***********************************************************/
     1392        2        /*T*                                                         */
     1393        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1394        4        /*T*                                                         */
     1395        5        /*T***********************************************************/
     1396        6        FMF$ICORRES: PROC(IDCB1,IDCB2,IERR1,IERR2);
     1397        7        /*F*    NAME: FMF$ICORRES
     1398        8                PURPOSE: Internal entry point to M$CORRES for use by
     1399        9                   monitor folk.  Is passed two DCB numbers, returns
     1400       10                   two error words zeroed or containing error reasons.
     1401       11                   See FMF$CORRES for more complete description. */
     1402       12        /*D*    NAME: FMF$ICORRES
     1403       13                CALL: CALL FMF$ICORRES(DCB1,DCB2,ERR1,ERR2);
     1404       14                INPUT: DCB1 and DCB2 are two DCB numbers. (UBIN HALF).
     1405       15                OUTPUT: ERR1 and ERR2 indicate whether DCB1 and DCB2 are
     1406       16                   valid DCB's and whether their assignments correspond.
     1407       17                   If DCBi is zero, ERRi will be zero.
     1408       18                   If DCBi is not a DCB, ERRi will be E$BADDCB#.
     1409       19                   If DCBi is a good DCB, ERRi will be zero, unless both
     1410       20                      DCB's are good and assigned the same place, in which
     1411       21                      case ERR2 will be E$CORRES.
     1412       22         */
     1413       23    1   DCL IDCB1 UBIN HALF HALIGNED;
     1414       24    1   DCL IDCB2 UBIN HALF HALIGNED;
     1415       25    1   DCL IERR1 BIT(36) ALIGNED;
     1416       26    1   DCL IERR2 BIT(36) ALIGNED;
     1417       27        /* LOCAL AUTOMATIC STORAGE */
     1418       28    1   DCL DCB1$ PTR;
     1419       29    1   DCL DCB2$ PTR;
     1420       30    1   DCL ASN1 SBIN;
     1421       31    1   DCL ASN2 SBIN;
     1422       32    1   DCL THEDCB UBIN;
     1423       33    1   DCL ACCT1 CHAR(8);
     1424       34    1   DCL ACCT2 CHAR(8);
     1425       35    1   DCL PSN1 CHAR(6);
     1426       36    1   DCL PSN2 CHAR(6);
     1427       37        /* INCLUDE FILES */
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:214  
     1428       38        %INCLUDE F$DCB;
     1429       87        %INCLUDE B$ROSEG;
     1430      150        %INCLUDE B$JIT;
     1431      753        %INCLUDE F$CP6V_C;
     1432      979        %INCLUDE F_ERRORS_C;
     1433     1219        %INCLUDE UD_ERRORS_C;
     1434     1261        %INCLUDE F_MACROS_C;
     1435     1272        %INCLUDE CP_6_SUBS;
     1436     1812        /* SUBSTITUTIONS */
     1437     1813        %SUB FCG#='0615'O;
     1438     1814        %SUB MID#='06'O;
     1439     1815        /* EXTERNAL DATA */
     1440     1816    1   DCL B$JIT$ PTR SYMREF READONLY;
     1441     1817    1   DCL B$M$UC$ PTR SYMREF READONLY;
     1442     1818    1   DCL B$ROSEG$ PTR SYMREF;
     1443     1819    1   DCL B$PS0$ PTR SYMREF READONLY;
     1444     1820        /* CONSTANT STORAGE */
     1445     1821        %ERRCODE (NAME=ECORRES,COD#=%E$CORRES);
     1446     1825        %ERRCODE (NAME=ERRBADDCB,COD#=%E$BADDCB#);
     1447     1829        /* FPTS */
     1448     1830        %FPT$CORRES_V (BASED="BASED(B$PS0$)");
     1449     1833        /**/
     1450     1834    1           IERR1='0'B; IERR2='0'B;
     1451     1835    1           THEDCB=IDCB1;
     1452     1836    2           IF THEDCB~=0 THEN DO;
     1453     1837    2              CALL CHKDCB ALTRET(ONEBAD);
     1454     1838                                      /* Returns DCB2$ ->THEDCB,  ASN2 =THEDCB.ASN    */
     1455     1839    2              DCB1$=DCB2$; ASN1=ASN2;
     1456     1840    2              THEDCB=IDCB2;
     1457     1841    3              IF THEDCB~=0 THEN DO;
     1458     1842    3                 CALL CHKDCB ALTRET(TWOBAD);
     1459     1843    3                 CALL DOCORRES(IERR2);
     1460     1844    3                 END;
     1461     1845    2              RETURN;
     1462     1846    2   ONEBAD:    IERR1=ERRBADDCB;
     1463     1847    2              END;
     1464     1848                       /* IDCB1 is zero or bad. IERR1 has been set. Look at IDCB2.*/
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:215  
     1465     1849                       /*(We don't need to CORRES, since at most one DCB is good.)*/
     1466     1850    1           THEDCB=IDCB2;
     1467     1851    1           IF THEDCB~=0 THEN CALL CHKDCB ALTRET(TWOBAD);
     1468     1852    1           RETURN;
     1469     1853    1   TWOBAD: IERR2=ERRBADDCB;
     1470     1854    1           RETURN;
     1471     1855    1   FMF$CORRES: ENTRY;
     1472     1856        /*F*    NAME: FMF$CORRES
     1473     1857                PURPOSE: FMF$CORRES performs the M$CORRES PMME.  It is passed
     1474     1858                   two DCB numbers.  If their assignments correspond, it
     1475     1859                   sets B$JIT.ERR to be E$CORRES.  If their assignments
     1476     1860                   differ, it sets B$JIT.ERR zero. */
     1477     1861        /*D*    NAME: FMF$CORRES
     1478     1862                CALL: CALL FMF$CORRES.
     1479     1863                INPUT: $PS0 points to the V area of an M$CORRES FPT.
     1480     1864                   This area contains the numbers of two DCB's.
     1481     1865                OUTPUT: B$JIT.ERR contains E$BADDCB# if either "DCB number"
     1482     1866                            is not the number of a DCB.
     1483     1867                      B$JIT.ERR contains E$CORRES if the assignments of the
     1484     1868                         two DCB's are the same.
     1485     1869                      B$JIT.ERR is zero if the assignments of the two DCB's
     1486     1870                         are different.
     1487     1871         */
     1488     1872        /**/
     1489     1873    1           THEDCB=FPT$CORRES_V.DCB1;
     1490     1874    1           CALL CHKDCB ALTRET(BADDCB);
     1491     1875                                      /* Returns DCB2$ ->THEDCB,  ASN2 =THEDCB.ASN    */
     1492     1876    1           DCB1$=DCB2$; ASN1=ASN2;
     1493     1877    1           THEDCB=FPT$CORRES_V.DCB2;
     1494     1878    1           CALL CHKDCB ALTRET(BADDCB);
     1495     1879    1           CALL DOCORRES(B$JIT.ERR);
     1496     1880    1           RETURN;
     1497     1881    1   BADDCB: B$JIT.ERR=ERRBADDCB;
     1498     1882    1           RETURN;
     1499     1883        /**/
     1500     1884        /*E*   ERROR:   FMF-E$BADDCB#-2
     1501     1885        *       MESSAGE: One or both of the DCB numbers passed to M$CORRES
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:216  
     1502     1886        is for a DCB that doesn't exist
     1503     1887        */
     1504     1888        /**/
     1505     1889        /**/
     1506     1890    1   CHKDCB: PROC ALTRET;
     1507     1891    2           IF THEDCB>B$ROSEG$->B$ROSEG.NUMDCBS THEN ALTRETURN;
     1508     1892    2           DCB2$=B$ROSEG$->B$ROSEG.DCBPTR$->B$RODCB$(THEDCB);
     1509     1893    2           IF DCB2$=ADDR(NIL) THEN ALTRETURN;
     1510     1894    2           IF THEDCB=%M$UC# THEN ASN2=%DEVICE#;
     1511     1895    2           ELSE ASN2=DCB2$->F$DCB.ASN;
     1512     1896    2           RETURN;
     1513     1897    2   END CHKDCB;
     1514     1898        /**/
     1515     1899        /**/
     1516     1900    1   DOCORRES: PROC(ERRWORD);
     1517     1901    2   DCL ERRWORD BIT(36) ALIGNED;
     1518     1902        /**/
     1519     1903    2           IF ASN1~=ASN2 THEN GOTO DIFF;
     1520     1904    3           DO CASE(ASN1);
     1521     1905    3            CASE(0); GOTO DIFF;            /*ASN=0 are no-match.*/
     1522     1906    3            CASE(%FILE#,%TAPE#);
     1523     1907    3              IF DCB1$->F$DCB.NAME~=
     1524     1908    3                DCB2$->F$DCB.NAME
     1525     1909    3              THEN GOTO DIFF;
     1526     1910    3              ACCT1=DCB1$->F$DCB.ACCT;
     1527     1911    3              PSN1=DCB1$->F$DCB.PSN;
     1528     1912    3              PSN2=DCB2$->F$DCB.PSN;
     1529     1913    4              IF ACCT1=' ' THEN DO;
     1530     1914    4                 ACCT1=B$JIT.FACCN;
     1531     1915    4                 IF PSN1=' ' THEN
     1532     1916    4                    PSN1=B$JIT.FPSN;
     1533     1917    4                 END;
     1534     1918    3              ACCT2=DCB2$->F$DCB.ACCT;
     1535     1919    4              IF ACCT2=' ' THEN DO;
     1536     1920    4                 ACCT2=B$JIT.FACCN;
     1537     1921    4                 IF PSN2=' ' THEN
     1538     1922    4                    PSN2=B$JIT.FPSN;
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:217  
     1539     1923    4                 END;
     1540     1924    3              IF ACCT1~=ACCT2 THEN
     1541     1925    3                 GOTO DIFF;
     1542     1926    3              IF PSN1~=PSN2 THEN
     1543     1927    3                 GOTO DIFF;
     1544     1928    3              GOTO SAME;
     1545     1929    3            CASE(%DEVICE#);
     1546     1930                                      /*GETRES ALTRET is dd@wsn; they're all different*/
     1547     1931    3              CALL GETRES(ASN1,DCB1$)ALTRET(DIFF);
     1548     1932    3              CALL GETRES(ASN2,DCB2$)ALTRET(DIFF);
     1549     1933    4              DO SELECT(ASN1+10*ASN2);
     1550     1934                   /*0=Commands(file),1=LP01,2=CP01,3=UC,4=NO,
     1551     1935                      5=MT..,6=MTnn,7=DP,8=etc.*/
     1552     1936    4                 SELECT(00,11,22,33,44);
     1553     1937    4                 GOTO SAME;
     1554     1938    4                 SELECT(66,77);            /*MT/DP same if same nn & same SN*/
     1555     1939    4                 IF SUBSTR(DCB1$->F$DCB.RES,2,2)=
     1556     1940    4                   SUBSTR(DCB2$->F$DCB.RES,2,2) THEN GOTO COMPSN;
     1557     1941    4                 SELECT(55,56,65);         /*MT=MTnn if same SN*/
     1558     1942    4   COMPSN:       ;
     1559     1943    4                 IF DCB1$->F$DCB.PSN=DCB2$->F$DCB.PSN THEN
     1560     1944    4                    GOTO SAME;
     1561     1945    4                 SELECT(88);               /*Others (Streams) same if same RES*/
     1562     1946    4                 IF DCB1$->F$DCB.RES=DCB2$->F$DCB.RES THEN
     1563     1947    4                    GOTO SAME;
     1564     1948    4                 END;
     1565     1949    3              GOTO DIFF;
     1566     1950    3            END;
     1567     1951        /**/
     1568     1952    2   SAME:   ERRWORD=ECORRES;
     1569     1953    2   DIFF:   RETURN;
     1570     1954    2   END DOCORRES;
     1571     1955        /**/
     1572     1956        /*E*   ERROR:   FMF-E$CORRES-2
     1573     1957        *       MESSAGE: The two DCBs are assigned to the same thing
     1574     1958        */
     1575     1959        /**/
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:218  
     1576     1960        /**/
     1577     1961    1   GETRES: PROC(I,DCB$) ALTRET;
     1578     1962    2   DCL I SBIN;
     1579     1963    2   DCL DCB$ PTR;
     1580     1964        /*
     1581     1965         *      OPLABEL tables.
     1582     1966         *      "OPLABEL" is user-specified 2-character oplabel names.
     1583     1967         *      "OPL_xxx" (xxx per user mode ... Batch,Ghost,etc.) is
     1584     1968         *         index defining where the oplabel goes ..
     1585     1969         *         0 = CR01   1 = LP01   2 = CP01   3 = M$UC    4 = NO
     1586     1970         */
     1587     1971    2   DCL OPLABEL CHAR(0)CONSTANT INIT
     1588     1972    2           ('ME NO UC JE JF C1 L1 P1 CR LP CP SI LO PO');
     1589     1973    2   DCL OPL_BAT(0:13) UBIN(9) UNAL CONSTANT INIT
     1590     1974    2           (  1, 4, 4, 9, 9, 0, 1, 2, 0, 1, 2, 0, 1, 2);
     1591     1975    2   DCL OPL_INT(0:13) UBIN(9) UNAL CONSTANT INIT
     1592     1976    2           (  3, 4, 3, 9, 9, 0, 1, 2, 0, 1, 2, 0, 3, 4);
     1593     1977        /**/
     1594     1978    3           IF DCB$=B$M$UC$ THEN DO;
     1595     1979    3              IF B$ROSEG$->B$ROSEG.CR01ID.INT THEN I=3;
     1596     1980    3              ELSE I=4;
     1597     1981    3              RETURN;
     1598     1982    3              END;
     1599     1983    2           IF DCB$->F$DCB.WSN~=' ' THEN ALTRETURN;
     1600     1984    2           CALL INDEX(I,' ',DCB$->F$DCB.RES);
     1601     1985    3           DO CASE(I);
     1602     1986    3            CASE(0,1,3); ALTRETURN;        /* BAD RES NOT EQUAL                  */
     1603     1987    3            CASE(2);
     1604     1988    3              IF SUBSTR(DCB$->F$DCB.RES,2,2)~='  ' THEN ALTRETURN;
     1605     1989    3              CALL INDEX(I,SUBSTR(DCB$->F$DCB.RES,0,2),OPLABEL)
     1606     1990    3                ALTRET(LBLNOT2);
     1607     1991    3              IF B$ROSEG$->B$ROSEG.CR01ID.INT THEN
     1608     1992    3                 I=OPL_INT(I/3);
     1609     1993    3              ELSE I=OPL_BAT(I/3);
     1610     1994    3              IF I=0 THEN IF B$JIT.NEXTCC=%CC_FROMUC# THEN I=3;
     1611     1995    3            CASE(4);
     1612     1996    3   LBLNOT2:   CALL INDEX(I,SUBSTR(DCB$->F$DCB.RES,0,2),
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:219  
     1613     1997    3                'LP CP FT MT LT DP UC');
     1614     1998    4              DO CASE(I);
     1615     1999    4               CASE(0);
     1616     2000    4                 IF DCB$->F$DCB.RES='LP01' THEN I=1;
     1617     2001    4                 ELSE I=8;
     1618     2002    4               CASE(3);
     1619     2003    4                 IF DCB$->F$DCB.RES='CP01' THEN I=2;
     1620     2004    4                 ELSE I=8;
     1621     2005    4               CASE(6,9,12);
     1622     2006    4                 IF SUBSTR(DCB$->F$DCB.RES,2,2)='  ' THEN I=5;
     1623     2007    4                 ELSE I=6;
     1624     2008    4               CASE(15);
     1625     2009    4                 I=7;
     1626     2010    4               CASE(18);
     1627     2011    4                 I=3;
     1628     2012    4               CASE(ELSE);
     1629     2013    4                 I=8;
     1630     2014    4               END;
     1631     2015    3            END;
     1632     2016    2           RETURN;
     1633     2017    2   END GETRES;
     1634     2018        /**/
     1635     2019    1   END FMF$ICORRES;
     1636     2020        %EOD;

PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:220  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMF$ICORRES.

   Procedure FMF$ICORRES requires 386 words for executable code.
   Procedure FMF$ICORRES requires 26 words of local(AUTO) storage.

PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:221  

 Object Unit name= FMF$ICORRES                                File name= FMF$PMME.:E05TOU
 UTS= JUL 29 '97 16:44:33.92 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     29     35  FMF$ICORRES
    1   Proc  even  none   386    602  FMF$ICORRES
    2  RoData even  none     2      2  FMF$ICORRES

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        4  FMF$ICORRES
     1     57                  yes      Std        0  FMF$CORRES

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_4
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    B$JIT$                           r    B$M$UC$                               B$ROSEG$
r    B$PS0$                                B_VECTNIL
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:222  


     1391        1        /*T***********************************************************/
     1392        2        /*T*                                                         */
     1393        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1394        4        /*T*                                                         */
     1395        5        /*T***********************************************************/
     1396        6        FMF$ICORRES: PROC(IDCB1,IDCB2,IERR1,IERR2);

      6  1 000000   000000 700200 xent  FMF$ICORRES  TSX0  ! X66_AUTO_4
         1 000001   000032 000004                    ZERO    26,4

     1397        7        /*F*    NAME: FMF$ICORRES
     1398        8                PURPOSE: Internal entry point to M$CORRES for use by
     1399        9                   monitor folk.  Is passed two DCB numbers, returns
     1400       10                   two error words zeroed or containing error reasons.
     1401       11                   See FMF$CORRES for more complete description. */
     1402       12        /*D*    NAME: FMF$ICORRES
     1403       13                CALL: CALL FMF$ICORRES(DCB1,DCB2,ERR1,ERR2);
     1404       14                INPUT: DCB1 and DCB2 are two DCB numbers. (UBIN HALF).
     1405       15                OUTPUT: ERR1 and ERR2 indicate whether DCB1 and DCB2 are
     1406       16                   valid DCB's and whether their assignments correspond.
     1407       17                   If DCBi is zero, ERRi will be zero.
     1408       18                   If DCBi is not a DCB, ERRi will be E$BADDCB#.
     1409       19                   If DCBi is a good DCB, ERRi will be zero, unless both
     1410       20                      DCB's are good and assigned the same place, in which
     1411       21                      case ERR2 will be E$CORRES.
     1412       22         */
     1413       23    1   DCL IDCB1 UBIN HALF HALIGNED;
     1414       24    1   DCL IDCB2 UBIN HALF HALIGNED;
     1415       25    1   DCL IERR1 BIT(36) ALIGNED;
     1416       26    1   DCL IERR2 BIT(36) ALIGNED;
     1417       27        /* LOCAL AUTOMATIC STORAGE */
     1418       28    1   DCL DCB1$ PTR;
     1419       29    1   DCL DCB2$ PTR;
     1420       30    1   DCL ASN1 SBIN;
     1421       31    1   DCL ASN2 SBIN;
     1422       32    1   DCL THEDCB UBIN;
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:223  
     1423       33    1   DCL ACCT1 CHAR(8);
     1424       34    1   DCL ACCT2 CHAR(8);
     1425       35    1   DCL PSN1 CHAR(6);
     1426       36    1   DCL PSN2 CHAR(6);
     1427       37        /* INCLUDE FILES */
     1428       38        %INCLUDE F$DCB;
     1429       87        %INCLUDE B$ROSEG;
     1430      150        %INCLUDE B$JIT;
     1431      753        %INCLUDE F$CP6V_C;
     1432      979        %INCLUDE F_ERRORS_C;
     1433     1219        %INCLUDE UD_ERRORS_C;
     1434     1261        %INCLUDE F_MACROS_C;
     1435     1272        %INCLUDE CP_6_SUBS;
     1436     1812        /* SUBSTITUTIONS */
     1437     1813        %SUB FCG#='0615'O;
     1438     1814        %SUB MID#='06'O;
     1439     1815        /* EXTERNAL DATA */
     1440     1816    1   DCL B$JIT$ PTR SYMREF READONLY;
     1441     1817    1   DCL B$M$UC$ PTR SYMREF READONLY;
     1442     1818    1   DCL B$ROSEG$ PTR SYMREF;
     1443     1819    1   DCL B$PS0$ PTR SYMREF READONLY;
     1444     1820        /* CONSTANT STORAGE */
     1445     1821        %ERRCODE (NAME=ECORRES,COD#=%E$CORRES);
     1446     1825        %ERRCODE (NAME=ERRBADDCB,COD#=%E$BADDCB#);
     1447     1829        /* FPTS */
     1448     1830        %FPT$CORRES_V (BASED="BASED(B$PS0$)");
     1449     1833        /**/
     1450     1834    1           IERR1='0'B; IERR2='0'B;

   1834  1 000002   200005 470500                    LDP0    @IERR1,,AUTO
         1 000003   000000 450100                    STZ     0,,PR0

   1834  1 000004   200006 471500                    LDP1    @IERR2,,AUTO
         1 000005   100000 450100                    STZ     0,,PR1

     1451     1835    1           THEDCB=IDCB1;

PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:224  
   1835  1 000006   200003 473500                    LDP3    @IDCB1,,AUTO
         1 000007   000100 101500                    MRL     fill='000'O
         1 000010   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2
         1 000011   200013 000004                    ADSC9   THEDCB,,AUTO             cn=0,n=4

     1452     1836    2           IF THEDCB~=0 THEN DO;

   1836  1 000012   200013 235100                    LDA     THEDCB,,AUTO
         1 000013   000042 600000 1                  TZE     s:1850

     1453     1837    2              CALL CHKDCB ALTRET(ONEBAD);

   1837  1 000014   000113 701000 1                  TSX1    CHKDCB
         1 000015   000037 702000 1                  TSX2    ONEBAD

     1454     1838                                      /* Returns DCB2$ ->THEDCB,  ASN2 =THEDCB.ASN    */
     1455     1839    2              DCB1$=DCB2$; ASN1=ASN2;

   1839  1 000016   200010 236100                    LDQ     DCB2$,,AUTO
         1 000017   200007 756100                    STQ     DCB1$,,AUTO

   1839  1 000020   200012 235100                    LDA     ASN2,,AUTO
         1 000021   200011 755100                    STA     ASN1,,AUTO

     1456     1840    2              THEDCB=IDCB2;

   1840  1 000022   200004 470500                    LDP0    @IDCB2,,AUTO
         1 000023   000100 101500                    MRL     fill='000'O
         1 000024   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         1 000025   200013 000004                    ADSC9   THEDCB,,AUTO             cn=0,n=4

     1457     1841    3              IF THEDCB~=0 THEN DO;

   1841  1 000026   200013 235100                    LDA     THEDCB,,AUTO
         1 000027   000036 600000 1                  TZE     s:1845

     1458     1842    3                 CALL CHKDCB ALTRET(TWOBAD);
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:225  

   1842  1 000030   000113 701000 1                  TSX1    CHKDCB
         1 000031   000053 702000 1                  TSX2    TWOBAD

     1459     1843    3                 CALL DOCORRES(IERR2);

   1843  1 000032   200006 236100                    LDQ     @IERR2,,AUTO
         1 000033   200025 756100                    STQ     PSN2+3,,AUTO
         1 000034   000145 701000 1                  TSX1    DOCORRES
         1 000035   000000 011000                    NOP     0

     1460     1844    3                 END;

     1461     1845    2              RETURN;

   1845  1 000036   000000 702200 xent               TSX2  ! X66_ARET

     1462     1846    2   ONEBAD:    IERR1=ERRBADDCB;

   1846  1 000037   000001 236000 0     ONEBAD       LDQ     ERRBADDCB
         1 000040   200005 470500                    LDP0    @IERR1,,AUTO
         1 000041   000000 756100                    STQ     0,,PR0

     1463     1847    2              END;

     1464     1848                       /* IDCB1 is zero or bad. IERR1 has been set. Look at IDCB2.*/
     1465     1849                       /*(We don't need to CORRES, since at most one DCB is good.)*/
     1466     1850    1           THEDCB=IDCB2;

   1850  1 000042   200004 471500                    LDP1    @IDCB2,,AUTO
         1 000043   000100 101500                    MRL     fill='000'O
         1 000044   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
         1 000045   200013 000004                    ADSC9   THEDCB,,AUTO             cn=0,n=4

     1467     1851    1           IF THEDCB~=0 THEN CALL CHKDCB ALTRET(TWOBAD);

   1851  1 000046   200013 235100                    LDA     THEDCB,,AUTO
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:226  
         1 000047   000052 600000 1                  TZE     s:1852

   1851  1 000050   000113 701000 1                  TSX1    CHKDCB
         1 000051   000053 702000 1                  TSX2    TWOBAD

     1468     1852    1           RETURN;

   1852  1 000052   000000 702200 xent               TSX2  ! X66_ARET

     1469     1853    1   TWOBAD: IERR2=ERRBADDCB;

   1853  1 000053   000001 236000 0     TWOBAD       LDQ     ERRBADDCB
         1 000054   200006 470500                    LDP0    @IERR2,,AUTO
         1 000055   000000 756100                    STQ     0,,PR0

     1470     1854    1           RETURN;

   1854  1 000056   000000 702200 xent               TSX2  ! X66_ARET

     1471     1855    1   FMF$CORRES: ENTRY;

   1855  1 000057   000000 700200 xent  FMF$CORRES   TSX0  ! X66_AUTO_4
         1 000060   000032 000004                    ZERO    26,4

     1472     1856        /*F*    NAME: FMF$CORRES
     1473     1857                PURPOSE: FMF$CORRES performs the M$CORRES PMME.  It is passed
     1474     1858                   two DCB numbers.  If their assignments correspond, it
     1475     1859                   sets B$JIT.ERR to be E$CORRES.  If their assignments
     1476     1860                   differ, it sets B$JIT.ERR zero. */
     1477     1861        /*D*    NAME: FMF$CORRES
     1478     1862                CALL: CALL FMF$CORRES.
     1479     1863                INPUT: $PS0 points to the V area of an M$CORRES FPT.
     1480     1864                   This area contains the numbers of two DCB's.
     1481     1865                OUTPUT: B$JIT.ERR contains E$BADDCB# if either "DCB number"
     1482     1866                            is not the number of a DCB.
     1483     1867                      B$JIT.ERR contains E$CORRES if the assignments of the
     1484     1868                         two DCB's are the same.
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:227  
     1485     1869                      B$JIT.ERR is zero if the assignments of the two DCB's
     1486     1870                         are different.
     1487     1871         */
     1488     1872        /**/
     1489     1873    1           THEDCB=FPT$CORRES_V.DCB1;

   1873  1 000061   000000 470400 xsym               LDP0    B$PS0$
         1 000062   000000 236100                    LDQ     0,,PR0
         1 000063   000022 772000                    QRL     18
         1 000064   200013 756100                    STQ     THEDCB,,AUTO

     1490     1874    1           CALL CHKDCB ALTRET(BADDCB);

   1874  1 000065   000113 701000 1                  TSX1    CHKDCB
         1 000066   000107 702000 1                  TSX2    BADDCB

     1491     1875                                      /* Returns DCB2$ ->THEDCB,  ASN2 =THEDCB.ASN    */
     1492     1876    1           DCB1$=DCB2$; ASN1=ASN2;

   1876  1 000067   200010 236100                    LDQ     DCB2$,,AUTO
         1 000070   200007 756100                    STQ     DCB1$,,AUTO

   1876  1 000071   200012 235100                    LDA     ASN2,,AUTO
         1 000072   200011 755100                    STA     ASN1,,AUTO

     1493     1877    1           THEDCB=FPT$CORRES_V.DCB2;

   1877  1 000073   000000 470400 xsym               LDP0    B$PS0$
         1 000074   000000 236100                    LDQ     0,,PR0
         1 000075   777777 376007                    ANQ     -1,DL
         1 000076   200013 756100                    STQ     THEDCB,,AUTO

     1494     1878    1           CALL CHKDCB ALTRET(BADDCB);

   1878  1 000077   000113 701000 1                  TSX1    CHKDCB
         1 000100   000107 702000 1                  TSX2    BADDCB

PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:228  
     1495     1879    1           CALL DOCORRES(B$JIT.ERR);

   1879  1 000101   000000 236000 xsym               LDQ     B$JIT$
         1 000102   000012 036003                    ADLQ    10,DU
         1 000103   200025 756100                    STQ     PSN2+3,,AUTO
         1 000104   000145 701000 1                  TSX1    DOCORRES
         1 000105   000000 011000                    NOP     0

     1496     1880    1           RETURN;

   1880  1 000106   000000 702200 xent               TSX2  ! X66_ARET

     1497     1881    1   BADDCB: B$JIT.ERR=ERRBADDCB;

   1881  1 000107   000001 236000 0     BADDCB       LDQ     ERRBADDCB
         1 000110   000000 470400 xsym               LDP0    B$JIT$
         1 000111   000012 756100                    STQ     10,,PR0

     1498     1882    1           RETURN;

   1882  1 000112   000000 702200 xent               TSX2  ! X66_ARET

     1499     1883        /**/
     1500     1884        /*E*   ERROR:   FMF-E$BADDCB#-2
     1501     1885        *       MESSAGE: One or both of the DCB numbers passed to M$CORRES
     1502     1886        is for a DCB that doesn't exist
     1503     1887        */
     1504     1888        /**/
     1505     1889        /**/
     1506     1890    1   CHKDCB: PROC ALTRET;

   1890  1 000113   200024 741300       CHKDCB       STX1  ! PSN2+2,,AUTO

     1507     1891    2           IF THEDCB>B$ROSEG$->B$ROSEG.NUMDCBS THEN ALTRETURN;

   1891  1 000114   000000 470400 xsym               LDP0    B$ROSEG$
         1 000115   000002 236100                    LDQ     2,,PR0
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:229  
         1 000116   000022 772000                    QRL     18
         1 000117   200013 116100                    CMPQ    THEDCB,,AUTO
         1 000120   000122 603000 1                  TRC     s:1892

   1891  1 000121   000000 702211                    TSX2  ! 0,X1

     1508     1892    2           DCB2$=B$ROSEG$->B$ROSEG.DCBPTR$->B$RODCB$(THEDCB);

   1892  1 000122   000000 471500                    LDP1    0,,PR0
         1 000123   200013 720100                    LXL0    THEDCB,,AUTO
         1 000124   100000 236110                    LDQ     0,X0,PR1
         1 000125   200010 756100                    STQ     DCB2$,,AUTO

     1509     1893    2           IF DCB2$=ADDR(NIL) THEN ALTRETURN;

   1893  1 000126   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000127   000131 601000 1                  TNZ     s:1894

   1893  1 000130   000000 702211                    TSX2  ! 0,X1

     1510     1894    2           IF THEDCB=%M$UC# THEN ASN2=%DEVICE#;

   1894  1 000131   200013 235100                    LDA     THEDCB,,AUTO
         1 000132   000003 115007                    CMPA    3,DL
         1 000133   000137 601000 1                  TNZ     s:1895

   1894  1 000134   000003 235007                    LDA     3,DL
         1 000135   200012 755100                    STA     ASN2,,AUTO
         1 000136   000144 710000 1                  TRA     s:1896

     1511     1895    2           ELSE ASN2=DCB2$->F$DCB.ASN;

   1895  1 000137   200010 471500                    LDP1    DCB2$,,AUTO
         1 000140   100032 236100                    LDQ     26,,PR1
         1 000141   000011 772000                    QRL     9
         1 000142   000777 376007                    ANQ     511,DL
         1 000143   200012 756100                    STQ     ASN2,,AUTO
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:230  

     1512     1896    2           RETURN;

   1896  1 000144   000001 702211                    TSX2  ! 1,X1

     1513     1897    2   END CHKDCB;
     1514     1898        /**/
     1515     1899        /**/
     1516     1900    1   DOCORRES: PROC(ERRWORD);

   1900  1 000145   200024 741300       DOCORRES     STX1  ! PSN2+2,,AUTO

     1517     1901    2   DCL ERRWORD BIT(36) ALIGNED;
     1518     1902        /**/
     1519     1903    2           IF ASN1~=ASN2 THEN GOTO DIFF;

   1903  1 000146   200011 236100                    LDQ     ASN1,,AUTO
         1 000147   200012 116100                    CMPQ    ASN2,,AUTO
         1 000150   000354 601000 1                  TNZ     DIFF

     1520     1904    3           DO CASE(ASN1);

   1904  1 000151   000004 116007                    CMPQ    4,DL
         1 000152   000154 602006 1                  TNC     s:1904+3,QL
         1 000153   000351 710000 1                  TRA     SAME
         1 000154   000160 710000 1                  TRA     s:1905
         1 000155   000161 710000 1                  TRA     s:1907
         1 000156   000161 710000 1                  TRA     s:1907
         1 000157   000243 710000 1                  TRA     s:1931

     1521     1905    3            CASE(0); GOTO DIFF;            /*ASN=0 are no-match.*/

   1905  1 000160   000354 710000 1                  TRA     DIFF

     1522     1906    3            CASE(%FILE#,%TAPE#);

     1523     1907    3              IF DCB1$->F$DCB.NAME~=
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:231  

   1907  1 000161   200007 470500                    LDP0    DCB1$,,AUTO
         1 000162   200010 471500                    LDP1    DCB2$,,AUTO
         1 000163   000100 106500                    CMPC    fill='000'O
         1 000164   000010 000040                    ADSC9   8,,PR0                   cn=0,n=32
         1 000165   100010 000040                    ADSC9   8,,PR1                   cn=0,n=32
         1 000166   000354 601000 1                  TNZ     DIFF

     1524     1908    3                DCB2$->F$DCB.NAME
     1525     1909    3              THEN GOTO DIFF;
     1526     1910    3              ACCT1=DCB1$->F$DCB.ACCT;

   1910  1 000167   000020 237100                    LDAQ    16,,PR0
         1 000170   200014 757100                    STAQ    ACCT1,,AUTO

     1527     1911    3              PSN1=DCB1$->F$DCB.PSN;

   1911  1 000171   040100 100500                    MLR     fill='040'O
         1 000172   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         1 000173   200020 000006                    ADSC9   PSN1,,AUTO               cn=0,n=6

     1528     1912    3              PSN2=DCB2$->F$DCB.PSN;

   1912  1 000174   040100 100500                    MLR     fill='040'O
         1 000175   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
         1 000176   200022 000006                    ADSC9   PSN2,,AUTO               cn=0,n=6

     1529     1913    4              IF ACCT1=' ' THEN DO;

   1913  1 000177   200014 237100                    LDAQ    ACCT1,,AUTO
         1 000200   000000 117000 2                  CMPAQ   0
         1 000201   000214 601000 1                  TNZ     s:1918

     1530     1914    4                 ACCT1=B$JIT.FACCN;

   1914  1 000202   000000 473400 xsym               LDP3    B$JIT$
         1 000203   300006 237100                    LDAQ    6,,PR3
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:232  
         1 000204   200014 757100                    STAQ    ACCT1,,AUTO

     1531     1915    4                 IF PSN1=' ' THEN

   1915  1 000205   040000 106500                    CMPC    fill='040'O
         1 000206   200020 000006                    ADSC9   PSN1,,AUTO               cn=0,n=6
         1 000207   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000210   000214 601000 1                  TNZ     s:1918

     1532     1916    4                    PSN1=B$JIT.FPSN;

   1916  1 000211   040100 100500                    MLR     fill='040'O
         1 000212   300021 000006                    ADSC9   17,,PR3                  cn=0,n=6
         1 000213   200020 000006                    ADSC9   PSN1,,AUTO               cn=0,n=6

     1533     1917    4                 END;

     1534     1918    3              ACCT2=DCB2$->F$DCB.ACCT;

   1918  1 000214   100020 237100                    LDAQ    16,,PR1
         1 000215   200016 757100                    STAQ    ACCT2,,AUTO

     1535     1919    4              IF ACCT2=' ' THEN DO;

   1919  1 000216   200016 237100                    LDAQ    ACCT2,,AUTO
         1 000217   000000 117000 2                  CMPAQ   0
         1 000220   000233 601000 1                  TNZ     s:1924

     1536     1920    4                 ACCT2=B$JIT.FACCN;

   1920  1 000221   000000 473400 xsym               LDP3    B$JIT$
         1 000222   300006 237100                    LDAQ    6,,PR3
         1 000223   200016 757100                    STAQ    ACCT2,,AUTO

     1537     1921    4                 IF PSN2=' ' THEN

   1921  1 000224   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:233  
         1 000225   200022 000006                    ADSC9   PSN2,,AUTO               cn=0,n=6
         1 000226   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000227   000233 601000 1                  TNZ     s:1924

     1538     1922    4                    PSN2=B$JIT.FPSN;

   1922  1 000230   040100 100500                    MLR     fill='040'O
         1 000231   300021 000006                    ADSC9   17,,PR3                  cn=0,n=6
         1 000232   200022 000006                    ADSC9   PSN2,,AUTO               cn=0,n=6

     1539     1923    4                 END;

     1540     1924    3              IF ACCT1~=ACCT2 THEN

   1924  1 000233   200014 237100                    LDAQ    ACCT1,,AUTO
         1 000234   200016 117100                    CMPAQ   ACCT2,,AUTO
         1 000235   000354 601000 1                  TNZ     DIFF

     1541     1925    3                 GOTO DIFF;
     1542     1926    3              IF PSN1~=PSN2 THEN

   1926  1 000236   040100 106500                    CMPC    fill='040'O
         1 000237   200020 000006                    ADSC9   PSN1,,AUTO               cn=0,n=6
         1 000240   200022 000006                    ADSC9   PSN2,,AUTO               cn=0,n=6
         1 000241   000354 601000 1                  TNZ     DIFF

     1543     1927    3                 GOTO DIFF;
     1544     1928    3              GOTO SAME;

   1928  1 000242   000351 710000 1                  TRA     SAME

     1545     1929    3            CASE(%DEVICE#);

     1546     1930                                      /*GETRES ALTRET is dd@wsn; they're all different*/
     1547     1931    3              CALL GETRES(ASN1,DCB1$)ALTRET(DIFF);

   1931  1 000243   200007 630500                    EPPR0   DCB1$,,AUTO
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:234  
         1 000244   200030 450500                    STP0    @I+1,,AUTO
         1 000245   200011 631500                    EPPR1   ASN1,,AUTO
         1 000246   200027 451500                    STP1    @ERRWORD+2,,AUTO
         1 000247   000356 701000 1                  TSX1    GETRES
         1 000250   000354 702000 1                  TSX2    DIFF

     1548     1932    3              CALL GETRES(ASN2,DCB2$)ALTRET(DIFF);

   1932  1 000251   200010 630500                    EPPR0   DCB2$,,AUTO
         1 000252   200030 450500                    STP0    @I+1,,AUTO
         1 000253   200012 631500                    EPPR1   ASN2,,AUTO
         1 000254   200027 451500                    STP1    @ERRWORD+2,,AUTO
         1 000255   000356 701000 1                  TSX1    GETRES
         1 000256   000354 702000 1                  TSX2    DIFF

     1549     1933    4              DO SELECT(ASN1+10*ASN2);

   1933  1 000257   200012 236100                    LDQ     ASN2,,AUTO
         1 000260   000012 402007                    MPY     10,DL
         1 000261   200011 036100                    ADLQ    ASN1,,AUTO
         1 000262   000070 116007                    CMPQ    56,DL
         1 000263   000301 604000 1                  TMI     s:1933+18
         1 000264   000334 600000 1                  TZE     COMPSN
         1 000265   000102 116007                    CMPQ    66,DL
         1 000266   000276 604000 1                  TMI     s:1933+15
         1 000267   000325 600000 1                  TZE     s:1939
         1 000270   000115 116007                    CMPQ    77,DL
         1 000271   000350 604000 1                  TMI     s:1949
         1 000272   000325 600000 1                  TZE     s:1939
         1 000273   000130 116007                    CMPQ    88,DL
         1 000274   000350 601000 1                  TNZ     s:1949
         1 000275   000343 710000 1                  TRA     s:1946
         1 000276   000101 116007                    CMPQ    65,DL
         1 000277   000350 601000 1                  TNZ     s:1949
         1 000300   000334 710000 1                  TRA     COMPSN
         1 000301   000041 116007                    CMPQ    33,DL
         1 000302   000313 604000 1                  TMI     s:1933+28
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:235  
         1 000303   000324 600000 1                  TZE     s:1937
         1 000304   000067 116007                    CMPQ    55,DL
         1 000305   000310 604000 1                  TMI     s:1933+25
         1 000306   000334 600000 1                  TZE     COMPSN
         1 000307   000350 710000 1                  TRA     s:1949
         1 000310   000054 116007                    CMPQ    44,DL
         1 000311   000350 601000 1                  TNZ     s:1949
         1 000312   000324 710000 1                  TRA     s:1937
         1 000313   000013 116007                    CMPQ    11,DL
         1 000314   000321 604000 1                  TMI     s:1933+34
         1 000315   000324 600000 1                  TZE     s:1937
         1 000316   000026 116007                    CMPQ    22,DL
         1 000317   000350 601000 1                  TNZ     s:1949
         1 000320   000324 710000 1                  TRA     s:1937
         1 000321   000000 116003                    CMPQ    0,DU
         1 000322   000350 601000 1                  TNZ     s:1949
         1 000323   000324 710000 1                  TRA     s:1937

     1550     1934                   /*0=Commands(file),1=LP01,2=CP01,3=UC,4=NO,
     1551     1935                      5=MT..,6=MTnn,7=DP,8=etc.*/
     1552     1936    4                 SELECT(00,11,22,33,44);

     1553     1937    4                 GOTO SAME;

   1937  1 000324   000351 710000 1                  TRA     SAME

     1554     1938    4                 SELECT(66,77);            /*MT/DP same if same nn & same SN*/

     1555     1939    4                 IF SUBSTR(DCB1$->F$DCB.RES,2,2)=

   1939  1 000325   200010 470500                    LDP0    DCB2$,,AUTO
         1 000326   200007 471500                    LDP1    DCB1$,,AUTO
         1 000327   100026 236100                    LDQ     22,,PR1
         1 000330   000026 676100                    ERQ     22,,PR0
         1 000331   777777 376007                    ANQ     -1,DL
         1 000332   000334 600000 1                  TZE     COMPSN
         1 000333   000350 710000 1                  TRA     s:1949
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:236  

     1556     1940    4                   SUBSTR(DCB2$->F$DCB.RES,2,2) THEN GOTO COMPSN;
     1557     1941    4                 SELECT(55,56,65);         /*MT=MTnn if same SN*/

   1941  1 000334                       COMPSN       null
     1558     1942    4   COMPSN:       ;
     1559     1943    4                 IF DCB1$->F$DCB.PSN=DCB2$->F$DCB.PSN THEN

   1943  1 000334   200007 470500                    LDP0    DCB1$,,AUTO
         1 000335   200010 471500                    LDP1    DCB2$,,AUTO
         1 000336   040100 106500                    CMPC    fill='040'O
         1 000337   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         1 000340   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
         1 000341   000351 600000 1                  TZE     SAME
         1 000342   000350 710000 1                  TRA     s:1949

     1560     1944    4                    GOTO SAME;
     1561     1945    4                 SELECT(88);               /*Others (Streams) same if same RES*/

     1562     1946    4                 IF DCB1$->F$DCB.RES=DCB2$->F$DCB.RES THEN

   1946  1 000343   200007 470500                    LDP0    DCB1$,,AUTO
         1 000344   200010 471500                    LDP1    DCB2$,,AUTO
         1 000345   000026 236100                    LDQ     22,,PR0
         1 000346   100026 116100                    CMPQ    22,,PR1
         1 000347   000351 600000 1                  TZE     SAME

     1563     1947    4                    GOTO SAME;
     1564     1948    4                 END;

     1565     1949    3              GOTO DIFF;

   1949  1 000350   000354 710000 1                  TRA     DIFF

     1566     1950    3            END;

     1567     1951        /**/
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:237  
     1568     1952    2   SAME:   ERRWORD=ECORRES;

   1952  1 000351   000000 236000 0     SAME         LDQ     ECORRES
         1 000352   200025 470500                    LDP0    @ERRWORD,,AUTO
         1 000353   000000 756100                    STQ     0,,PR0

     1569     1953    2   DIFF:   RETURN;

   1953  1 000354   200024 221300       DIFF         LDX1  ! PSN2+2,,AUTO
         1 000355   000001 702211                    TSX2  ! 1,X1

     1570     1954    2   END DOCORRES;
     1571     1955        /**/
     1572     1956        /*E*   ERROR:   FMF-E$CORRES-2
     1573     1957        *       MESSAGE: The two DCBs are assigned to the same thing
     1574     1958        */
     1575     1959        /**/
     1576     1960        /**/
     1577     1961    1   GETRES: PROC(I,DCB$) ALTRET;

   1961  1 000356   200026 741300       GETRES       STX1  ! @ERRWORD+1,,AUTO

     1578     1962    2   DCL I SBIN;
     1579     1963    2   DCL DCB$ PTR;
     1580     1964        /*
     1581     1965         *      OPLABEL tables.
     1582     1966         *      "OPLABEL" is user-specified 2-character oplabel names.
     1583     1967         *      "OPL_xxx" (xxx per user mode ... Batch,Ghost,etc.) is
     1584     1968         *         index defining where the oplabel goes ..
     1585     1969         *         0 = CR01   1 = LP01   2 = CP01   3 = M$UC    4 = NO
     1586     1970         */
     1587     1971    2   DCL OPLABEL CHAR(0)CONSTANT INIT
     1588     1972    2           ('ME NO UC JE JF C1 L1 P1 CR LP CP SI LO PO');
     1589     1973    2   DCL OPL_BAT(0:13) UBIN(9) UNAL CONSTANT INIT
     1590     1974    2           (  1, 4, 4, 9, 9, 0, 1, 2, 0, 1, 2, 0, 1, 2);
     1591     1975    2   DCL OPL_INT(0:13) UBIN(9) UNAL CONSTANT INIT
     1592     1976    2           (  3, 4, 3, 9, 9, 0, 1, 2, 0, 1, 2, 0, 3, 4);
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:238  
     1593     1977        /**/
     1594     1978    3           IF DCB$=B$M$UC$ THEN DO;

   1978  1 000357   200030 470500                    LDP0    @DCB$,,AUTO
         1 000360   000000 236100                    LDQ     0,,PR0
         1 000361   000000 116000 xsym               CMPQ    B$M$UC$
         1 000362   000377 601000 1                  TNZ     s:1983

     1595     1979    3              IF B$ROSEG$->B$ROSEG.CR01ID.INT THEN I=3;

   1979  1 000363   000000 471400 xsym               LDP1    B$ROSEG$
         1 000364   100114 234100                    SZN     76,,PR1
         1 000365   000372 605000 1                  TPL     s:1980

   1979  1 000366   000003 235007                    LDA     3,DL
         1 000367   200027 473500                    LDP3    @I,,AUTO
         1 000370   300000 755100                    STA     0,,PR3
         1 000371   000375 710000 1                  TRA     s:1981

     1596     1980    3              ELSE I=4;

   1980  1 000372   000004 235007                    LDA     4,DL
         1 000373   200027 473500                    LDP3    @I,,AUTO
         1 000374   300000 755100                    STA     0,,PR3

     1597     1981    3              RETURN;

   1981  1 000375   200026 221300                    LDX1  ! @ERRWORD+1,,AUTO
         1 000376   000001 702211                    TSX2  ! 1,X1

     1598     1982    3              END;
     1599     1983    2           IF DCB$->F$DCB.WSN~=' ' THEN ALTRETURN;

   1983  1 000377   000000 471500                    LDP1    0,,PR0
         1 000400   040000 106500                    CMPC    fill='040'O
         1 000401   100027 000010                    ADSC9   23,,PR1                  cn=0,n=8
         1 000402   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:239  
         1 000403   000405 600000 1                  TZE     s:1984

   1983  1 000404   000000 702211                    TSX2  ! 0,X1

     1600     1984    2           CALL INDEX(I,' ',DCB$->F$DCB.RES);

   1984  1 000405   200027 473500                    LDP3    @I,,AUTO
         1 000406   000000 124500                    SCM     mask='000'O
         1 000407   100026 000004                    ADSC9   22,,PR1                  cn=0,n=4
         1 000410   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000411   300000 000100                    ARG     0,,PR3

     1601     1985    3           DO CASE(I);

   1985  1 000412   300000 235100                    LDA     0,,PR3
         1 000413   000005 115007                    CMPA    5,DL
         1 000414   000416 602005 1                  TNC     s:1985+4,AL
         1 000415   000600 710000 1                  TRA     s:2016
         1 000416   000423 710000 1                  TRA     s:1986
         1 000417   000423 710000 1                  TRA     s:1986
         1 000420   000425 710000 1                  TRA     s:1988
         1 000421   000423 710000 1                  TRA     s:1986
         1 000422   000472 710000 1                  TRA     LBLNOT2

     1602     1986    3            CASE(0,1,3); ALTRETURN;        /* BAD RES NOT EQUAL                  */

   1986  1 000423   200026 221300                    LDX1  ! @ERRWORD+1,,AUTO
         1 000424   000000 702211                    TSX2  ! 0,X1

     1603     1987    3            CASE(2);

     1604     1988    3              IF SUBSTR(DCB$->F$DCB.RES,2,2)~='  ' THEN ALTRETURN;

   1988  1 000425   000000 471500                    LDP1    0,,PR0
         1 000426   100026 720100                    LXL0    22,,PR1
         1 000427   000025 100000 0                  CMPX0   OPL_INT+4
         1 000430   000433 600000 1                  TZE     s:1989
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:240  

   1988  1 000431   200026 221300                    LDX1  ! @ERRWORD+1,,AUTO
         1 000432   000000 702211                    TSX2  ! 0,X1

     1605     1989    3              CALL INDEX(I,SUBSTR(DCB$->F$DCB.RES,0,2),OPLABEL)

   1989  1 000433   000100 120400                    SCD
         1 000434   000002 000051 0                  ADSC9   OPLABEL                  cn=0,n=41
         1 000435   100026 000002                    ADSC9   22,,PR1                  cn=0,n=2
         1 000436   300000 000100                    ARG     0,,PR3
         1 000437   000442 607000 1                  TTF     s:1991
         1 000440   300000 054100                    AOS     0,,PR3
         1 000441   000472 710000 1                  TRA     LBLNOT2

     1606     1990    3                ALTRET(LBLNOT2);
     1607     1991    3              IF B$ROSEG$->B$ROSEG.CR01ID.INT THEN

   1991  1 000442   000000 471400 xsym               LDP1    B$ROSEG$
         1 000443   100114 234100                    SZN     76,,PR1
         1 000444   000453 605000 1                  TPL     s:1993

     1608     1992    3                 I=OPL_INT(I/3);

   1992  1 000445   300000 236100                    LDQ     0,,PR3
         1 000446   000003 506007                    DIV     3,DL
         1 000447   000100 101406                    MRL     fill='000'O
         1 000450   000021 000001 0                  ADSC9   OPL_INT,Q                cn=0,n=1
         1 000451   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
         1 000452   000460 710000 1                  TRA     s:1994

     1609     1993    3              ELSE I=OPL_BAT(I/3);

   1993  1 000453   300000 236100                    LDQ     0,,PR3
         1 000454   000003 506007                    DIV     3,DL
         1 000455   000100 101406                    MRL     fill='000'O
         1 000456   000015 000001 0                  ADSC9   OPL_BAT,Q                cn=0,n=1
         1 000457   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:241  

     1610     1994    3              IF I=0 THEN IF B$JIT.NEXTCC=%CC_FROMUC# THEN I=3;

   1994  1 000460   300000 235100                    LDA     0,,PR3
         1 000461   000600 601000 1                  TNZ     s:2016

   1994  1 000462   000000 471400 xsym               LDP1    B$JIT$
         1 000463   100151 236100                    LDQ     105,,PR1
         1 000464   000777 376003                    ANQ     511,DU
         1 000465   000003 116003                    CMPQ    3,DU
         1 000466   000600 601000 1                  TNZ     s:2016

   1994  1 000467   000003 235007                    LDA     3,DL
         1 000470   300000 755100                    STA     0,,PR3
         1 000471   000600 710000 1                  TRA     s:2016

     1611     1995    3            CASE(4);

     1612     1996    3   LBLNOT2:   CALL INDEX(I,SUBSTR(DCB$->F$DCB.RES,0,2),

   1996  1 000472   200030 470500       LBLNOT2      LDP0    @DCB$,,AUTO
         1 000473   000000 471500                    LDP1    0,,PR0
         1 000474   200027 473500                    LDP3    @I,,AUTO
         1 000475   000100 120400                    SCD
         1 000476   000026 000024 0                  ADSC9   OPL_INT+5                cn=0,n=20
         1 000477   100026 000002                    ADSC9   22,,PR1                  cn=0,n=2
         1 000500   300000 000100                    ARG     0,,PR3
         1 000501   000503 607000 1                  TTF     s:1998
         1 000502   300000 054100                    AOS     0,,PR3

     1613     1997    3                'LP CP FT MT LT DP UC');
     1614     1998    4              DO CASE(I);

   1998  1 000503   300000 235100                    LDA     0,,PR3
         1 000504   000023 115007                    CMPA    19,DL
         1 000505   000507 602005 1                  TNC     s:1998+4,AL
         1 000506   000576 710000 1                  TRA     s:2013
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:242  
         1 000507   000532 710000 1                  TRA     s:2000
         1 000510   000576 710000 1                  TRA     s:2013
         1 000511   000576 710000 1                  TRA     s:2013
         1 000512   000544 710000 1                  TRA     s:2003
         1 000513   000576 710000 1                  TRA     s:2013
         1 000514   000576 710000 1                  TRA     s:2013
         1 000515   000556 710000 1                  TRA     s:2006
         1 000516   000576 710000 1                  TRA     s:2013
         1 000517   000576 710000 1                  TRA     s:2013
         1 000520   000556 710000 1                  TRA     s:2006
         1 000521   000576 710000 1                  TRA     s:2013
         1 000522   000576 710000 1                  TRA     s:2013
         1 000523   000556 710000 1                  TRA     s:2006
         1 000524   000576 710000 1                  TRA     s:2013
         1 000525   000576 710000 1                  TRA     s:2013
         1 000526   000570 710000 1                  TRA     s:2009
         1 000527   000576 710000 1                  TRA     s:2013
         1 000530   000576 710000 1                  TRA     s:2013
         1 000531   000573 710000 1                  TRA     s:2011

     1615     1999    4               CASE(0);

     1616     2000    4                 IF DCB$->F$DCB.RES='LP01' THEN I=1;

   2000  1 000532   000000 471500                    LDP1    0,,PR0
         1 000533   100026 236100                    LDQ     22,,PR1
         1 000534   000033 116000 0                  CMPQ    OPL_INT+10
         1 000535   000541 601000 1                  TNZ     s:2001

   2000  1 000536   000001 235007                    LDA     1,DL
         1 000537   300000 755100                    STA     0,,PR3
         1 000540   000600 710000 1                  TRA     s:2016

     1617     2001    4                 ELSE I=8;

   2001  1 000541   000010 235007                    LDA     8,DL
         1 000542   300000 755100                    STA     0,,PR3
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:243  
         1 000543   000600 710000 1                  TRA     s:2016

     1618     2002    4               CASE(3);

     1619     2003    4                 IF DCB$->F$DCB.RES='CP01' THEN I=2;

   2003  1 000544   000000 471500                    LDP1    0,,PR0
         1 000545   100026 236100                    LDQ     22,,PR1
         1 000546   000034 116000 0                  CMPQ    OPL_INT+11
         1 000547   000553 601000 1                  TNZ     s:2004

   2003  1 000550   000002 235007                    LDA     2,DL
         1 000551   300000 755100                    STA     0,,PR3
         1 000552   000600 710000 1                  TRA     s:2016

     1620     2004    4                 ELSE I=8;

   2004  1 000553   000010 235007                    LDA     8,DL
         1 000554   300000 755100                    STA     0,,PR3
         1 000555   000600 710000 1                  TRA     s:2016

     1621     2005    4               CASE(6,9,12);

     1622     2006    4                 IF SUBSTR(DCB$->F$DCB.RES,2,2)='  ' THEN I=5;

   2006  1 000556   000000 471500                    LDP1    0,,PR0
         1 000557   100026 720100                    LXL0    22,,PR1
         1 000560   000025 100000 0                  CMPX0   OPL_INT+4
         1 000561   000565 601000 1                  TNZ     s:2007

   2006  1 000562   000005 236007                    LDQ     5,DL
         1 000563   300000 756100                    STQ     0,,PR3
         1 000564   000600 710000 1                  TRA     s:2016

     1623     2007    4                 ELSE I=6;

   2007  1 000565   000006 236007                    LDQ     6,DL
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:244  
         1 000566   300000 756100                    STQ     0,,PR3
         1 000567   000600 710000 1                  TRA     s:2016

     1624     2008    4               CASE(15);

     1625     2009    4                 I=7;

   2009  1 000570   000007 236007                    LDQ     7,DL
         1 000571   300000 756100                    STQ     0,,PR3
         1 000572   000600 710000 1                  TRA     s:2016

     1626     2010    4               CASE(18);

     1627     2011    4                 I=3;

   2011  1 000573   000003 236007                    LDQ     3,DL
         1 000574   300000 756100                    STQ     0,,PR3
         1 000575   000600 710000 1                  TRA     s:2016

     1628     2012    4               CASE(ELSE);

     1629     2013    4                 I=8;

   2013  1 000576   000010 236007                    LDQ     8,DL
         1 000577   300000 756100                    STQ     0,,PR3

     1630     2014    4               END;

     1631     2015    3            END;

     1632     2016    2           RETURN;

   2016  1 000600   200026 221300                    LDX1  ! @ERRWORD+1,,AUTO
         1 000601   000001 702211                    TSX2  ! 1,X1

ECORRES
 Sect OctLoc
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:245  
   0     000   061506 001122                                                    1..R

ERRBADDCB
 Sect OctLoc
   0     001   061506 006242                                                    1...

OPLABEL
 Sect OctLoc
   0     002   115105 040116   117040 125103   040112 105040   112106 040103    ME NO UC JE JF C
   0     006   061040 114061   040120 061040   103122 040114   120040 103120    1 L1 P1 CR LP CP
   0     012   040123 111040   114117 040120   117*** ******                     SI LO PO...

OPL_BAT
 Sect OctLoc
   0     015   001004 004011   011000 001002   000001 002000   001002 ******    ................

OPL_INT
 Sect OctLoc
   0     021   003004 003011   011000 001002   000001 002000   003004 ******    ................

(unnamed)
 Sect OctLoc
   0     025   040040 040040   114120 040103   120040 106124   040115 124040        LP CP FT MT
   0     031   114124 040104   120040 125103   114120 060061   103120 060061    LT DP UCLP01CP01

(unnamed)
 Sect OctLoc
   2     000   040040 040040   040040 040040
     1633     2017    2   END GETRES;
     1634     2018        /**/
     1635     2019    1   END FMF$ICORRES;
     1636     2020        %EOD;

PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:246  
--  Include file information  --

   CP_6_SUBS.:E05TOU  is referenced.
   F_MACROS_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMF$ICORRES.
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:247  

 **** Variables and constants ****

  ****  Section 000 RoData FMF$ICORRES

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 ECORRES                    1-0-0/b STRC        r     1 ERRBADDCB
     2-0-0/c CHAR(41)    r     1 OPLABEL                   15-0-0/b UBIN(9)     r     1 OPL_BAT(0:13)
    21-0-0/b UBIN(9)     r     1 OPL_INT(0:13)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    30-0-0/w PTR         r     1 @DCB$                     25-0-0/w PTR         r     1 @ERRWORD
    27-0-0/w PTR         r     1 @I                         3-0-0/w PTR         r     1 @IDCB1
     4-0-0/w PTR         r     1 @IDCB2                     5-0-0/w PTR         r     1 @IERR1
     6-0-0/w PTR         r     1 @IERR2                    14-0-0/c CHAR(8)     r     1 ACCT1
    16-0-0/c CHAR(8)     r     1 ACCT2                     11-0-0/w SBIN        r     1 ASN1
    12-0-0/w SBIN        r     1 ASN2                      *0-0-0/w PTR         r     1 DCB$
     7-0-0/w PTR         r     1 DCB1$                     10-0-0/w PTR         r     1 DCB2$
    *0-0-0/w BIT         r     1 ERRWORD                   *0-0-0/w SBIN        r     1 I
    *0-0-0/h UBIN(18)    r     1 IDCB1                     *0-0-0/h UBIN(18)    r     1 IDCB2
    *0-0-0/w BIT         r     1 IERR1                     *0-0-0/w BIT         r     1 IERR2
    20-0-0/c CHAR(6)     r     1 PSN1                      22-0-0/c CHAR(6)     r     1 PSN2
    13-0-0/w UBIN        r     1 THEDCB

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$UC$
     0-0-0/w PTR         r     1 B$PS0$                     0-0-0/w PTR         r     1 B$ROSEG$

PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:248  
  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w PTR         r     1 B$RODCB$(0:0)
     0-0-0/d STRC(3024)  r     1 B$ROSEG                    0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/d STRC        r     1 FPT$CORRES_V


   Procedure FMF$ICORRES requires 386 words for executable code.
   Procedure FMF$ICORRES requires 26 words of local(AUTO) storage.
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:249  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:250  
          MINI XREF LISTING

ACCT1
        33**DCL      1910<<ASSIGN   1913>>IF       1914<<ASSIGN   1924>>IF
ACCT2
        34**DCL      1918<<ASSIGN   1919>>IF       1920<<ASSIGN   1924>>IF
ASN1
        30**DCL      1839<<ASSIGN   1876<<ASSIGN   1903>>IF       1904>>DOCASE   1931<>CALL     1933>>DOSELCT
ASN2
        31**DCL      1839>>ASSIGN   1876>>ASSIGN   1894<<ASSIGN   1895<<ASSIGN   1903>>IF       1932<>CALL
      1933>>DOSELCT
B$JIT.CPFLAGS1.SLEAZE
       571**DCL       571--REDEF
B$JIT.ERR
       477**DCL      1879<>CALL     1881<<ASSIGN
B$JIT.ERR.MID
       478**DCL       478--REDEF
B$JIT.FACCN
       477**DCL      1914>>ASSIGN   1920>>ASSIGN
B$JIT.FPSN
       558**DCL      1916>>ASSIGN   1922>>ASSIGN
B$JIT.JRESPEAK
       639**DCL       640--REDEF
B$JIT.NEXTCC
       619**DCL      1994>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
       748**DCL       748--REDEF     749--REDEF
B$JIT.PNR
       652**DCL       652--REDEF
B$JIT.TSLINE
       746**DCL       747--REDEF
B$JIT$
      1816**DCL       472--IMP-PTR  1879>>CALL     1881>>ASSIGN   1914>>ASSIGN   1916>>ASSIGN   1920>>ASSIGN
      1922>>ASSIGN   1994>>IF
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:251  
B$M$UC$
      1817**DCL      1978>>IF
B$PS0$
      1819**DCL      1831--IMP-PTR  1873>>ASSIGN   1877>>ASSIGN
B$RODCB$
       134**DCL      1892>>ASSIGN
B$ROSEG.CR01ID.INT
       120**DCL      1979>>IF       1991>>IF
B$ROSEG.DCBPTR$
        98**DCL      1892>>ASSIGN
B$ROSEG.NUMDCBS
       100**DCL      1891>>IF
B$ROSEG$
      1818**DCL      1891>>IF       1892>>ASSIGN   1979>>IF       1991>>IF
BADDCB
      1881**LABEL    1874--CALLALT  1878--CALLALT
CHKDCB
      1890**PROC     1837--CALL     1842--CALL     1851--CALL     1874--CALL     1878--CALL
COMPSN IN PROCEDURE DOCORRES
      1941**LABEL    1940--GOTO
DCB$ IN PROCEDURE GETRES
      1963**DCL      1961--PROC     1978>>IF       1983>>IF       1984>>CALLBLT  1988>>IF       1989>>CALLBLT
      1996>>CALLBLT  2000>>IF       2003>>IF       2006>>IF
DCB1$
        28**DCL      1839<<ASSIGN   1876<<ASSIGN   1907>>IF       1910>>ASSIGN   1911>>ASSIGN   1931<>CALL
      1939>>IF       1943>>IF       1946>>IF
DCB2$
        29**DCL      1839>>ASSIGN   1876>>ASSIGN   1892<<ASSIGN   1893>>IF       1895>>ASSIGN   1907>>IF
      1912>>ASSIGN   1918>>ASSIGN   1932<>CALL     1939>>IF       1943>>IF       1946>>IF
DIFF IN PROCEDURE DOCORRES
      1953**LABEL    1903--GOTO     1905--GOTO     1909--GOTO     1925--GOTO     1927--GOTO     1931--CALLALT
      1932--CALLALT  1949--GOTO
DOCORRES
      1900**PROC     1843--CALL     1879--CALL
ECORRES
      1822**DCL      1952>>ASSIGN
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:252  
ERRBADDCB
      1826**DCL      1846>>ASSIGN   1853>>ASSIGN   1881>>ASSIGN
ERRWORD IN PROCEDURE DOCORRES
      1901**DCL      1900--PROC     1952<<ASSIGN
F$DCB.ACCT
        49**DCL      1910>>ASSIGN   1918>>ASSIGN
F$DCB.ACTPOS
        64**DCL        64--REDEF
F$DCB.ARS
        39**DCL        39--REDEF
F$DCB.ASN
        54**DCL      1895>>ASSIGN
F$DCB.ATTR
        57**DCL        58--REDEF
F$DCB.BORROW
        72**DCL        72--REDEF      72--REDEF      72--REDEF
F$DCB.DCBNAME.L
        86**DCL        86--IMP-SIZ
F$DCB.EOMCHAR
        43**DCL        43--REDEF
F$DCB.FLDID
        67**DCL        67--REDEF
F$DCB.FORM$
        61**DCL        61--REDEF
F$DCB.FSECT
        77**DCL        77--REDEF
F$DCB.FSN
        54**DCL        54--REDEF      54--REDEF      55--REDEF
F$DCB.HEADER$
        60**DCL        60--REDEF
F$DCB.IXTNSIZE
        58**DCL        58--REDEF
F$DCB.LASTSTA$
        48**DCL        48--REDEF
F$DCB.LVL
        73**DCL        73--REDEF
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:253  
F$DCB.NAME
        48**DCL      1907>>IF       1907>>IF
F$DCB.NAME.C
        48**DCL        48--REDEF
F$DCB.NOEOF
        69**DCL        69--REDEF
F$DCB.NRECS
        59**DCL        59--REDEF
F$DCB.NRECX
        78**DCL        78--REDEF
F$DCB.OHDR
        70**DCL        70--REDEF
F$DCB.ORG
        53**DCL        53--REDEF
F$DCB.PRECNO
        76**DCL        76--REDEF
F$DCB.PSN
        49**DCL      1911>>ASSIGN   1912>>ASSIGN   1943>>IF       1943>>IF
F$DCB.RCSZ
        81**DCL        81--REDEF
F$DCB.RES
        49**DCL        49--REDEF    1939>>IF       1939>>IF       1946>>IF       1946>>IF       1984>>CALLBLT
      1988>>IF       1989>>CALLBLT  1996>>CALLBLT  2000>>IF       2003>>IF       2006>>IF
F$DCB.SETX
        61**DCL        61--REDEF
F$DCB.TAB$
        60**DCL        61--REDEF
F$DCB.TDA
        75**DCL        75--REDEF
F$DCB.WSN
        50**DCL        50--REDEF    1983>>IF
FPT$CORRES_V.DCB1
      1831**DCL      1873>>ASSIGN
FPT$CORRES_V.DCB2
      1831**DCL      1877>>ASSIGN
GETRES
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:254  
      1961**PROC     1931--CALL     1932--CALL
I IN PROCEDURE GETRES
      1962**DCL      1961--PROC     1979<<ASSIGN   1980<<ASSIGN   1984<<CALLBLT  1985>>DOCASE   1989<<CALLBLT
      1992<<ASSIGN   1992>>ASSIGN   1993<<ASSIGN   1993>>ASSIGN   1994>>IF       1994<<ASSIGN   1996<<CALLBLT
      1998>>DOCASE   2000<<ASSIGN   2001<<ASSIGN   2003<<ASSIGN   2004<<ASSIGN   2006<<ASSIGN   2007<<ASSIGN
      2009<<ASSIGN   2011<<ASSIGN   2013<<ASSIGN
IDCB1
        23**DCL         6--PROC     1835>>ASSIGN
IDCB2
        24**DCL         6--PROC     1840>>ASSIGN   1850>>ASSIGN
IERR1
        25**DCL         6--PROC     1834<<ASSIGN   1846<<ASSIGN
IERR2
        26**DCL         6--PROC     1834<<ASSIGN   1843<>CALL     1853<<ASSIGN
LBLNOT2 IN PROCEDURE GETRES
      1996**LABEL    1989--CALLALT
ONEBAD
      1846**LABEL    1837--CALLALT
OPLABEL IN PROCEDURE GETRES
      1971**DCL      1989>>CALLBLT
OPL_BAT IN PROCEDURE GETRES
      1973**DCL      1993>>ASSIGN
OPL_INT IN PROCEDURE GETRES
      1975**DCL      1992>>ASSIGN
PSN1
        35**DCL      1911<<ASSIGN   1915>>IF       1916<<ASSIGN   1926>>IF
PSN2
        36**DCL      1912<<ASSIGN   1921>>IF       1922<<ASSIGN   1926>>IF
SAME IN PROCEDURE DOCORRES
      1952**LABEL    1928--GOTO     1937--GOTO     1944--GOTO     1947--GOTO
THEDCB
        32**DCL      1835<<ASSIGN   1836>>IF       1840<<ASSIGN   1841>>IF       1850<<ASSIGN   1851>>IF
      1873<<ASSIGN   1877<<ASSIGN   1891>>IF       1892>>ASSIGN   1894>>IF
TWOBAD
      1853**LABEL    1842--CALLALT  1851--CALLALT
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:255  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FMF$ICORRES File=FMF$PMME.:E05TSI                             TUE 07/29/97 16:44 Page:256  
              MINI UREF LISTING

B$ROAVAIL     137**DCL
FMF$CORRES    1855**ENTRY
FMF$ICORRES       6**PROC

PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:257  
     1637        1        /*T***********************************************************/
     1638        2        /*T*                                                         */
     1639        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1640        4        /*T*                                                         */
     1641        5        /*T***********************************************************/
     1642        6        /*F*    NAME:    FMF$TYC
     1643        7        *       PURPOSE:  Convert a TYC to JIT.ERR */
     1644        8        /**/
     1645        9        /**/
     1646       10        /*D*    NAME:    FMF$TYC
     1647       11        *       CALL:    CALL FMF$TYC(TYC,ERRCODE);
     1648       12        *       INPUT:   TYC - 36 bit TYC to convert
     1649       13        *       OUTPUT:  ERRCODE - The error code in same format as JIT.ERR
     1650       14        *       DESCRIPTION:  ERRCODE is zeroed.  If TYC.EGV is zero, return.
     1651       15        *                Scan TYC from bit 1 to bit 35.  When the first
     1652       16        *                non-zero bit is found, set ERRCODE from F_CODE and
     1653       17        *                F_SEV.
     1654       18        */
     1655       19        /**/
     1656       20        /**/
     1657       21        FMF$TYC: PROC(TYC,ERRCODE);
     1658       22        /* PARAMETERS */
     1659       23    1   DCL 1 TYC ALIGNED,
     1660       24    1         2 B(0:35) BIT(1) UNAL;
     1661       25    1   DCL 1 ERRCODE ALIGNED,
     1662       26    1         2 * BIT(19),
     1663       27    1         2 CODE UBIN(14) UNAL,
     1664       28    1         2 SEV UBIN(3) UNAL;
     1665       29        /* INCLUDE FILES */
     1666       30        %INCLUDE F_CODE_R;
     1667       40        %INCLUDE F_MACROS_C;
     1668       51        /* LOCAL AUTOMATIC STORAGE */
     1669       52    1   DCL I UBIN;
     1670       53        /* SUBSTITUTIONS */
     1671       54        %SUB FCG#='0615'O;
     1672       55        %SUB MID#='06'O;
     1673       56        /* CONSTANT STORAGE */
PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:258  
     1674       57        %ERRCODE (NAME=ERRDMY,COD#=0);
     1675       61        /**/
     1676       62        /**/
     1677       63    1           ERRCODE='0'B;
     1678       64    1           IF TYC.B(0) THEN      /* EGV set - there is something significant     */
     1679       65    2           DO I=1 TO F_TYCMAX;
     1680       66    3              IF TYC.B(I) THEN DO;
     1681       67    3                 ERRCODE=ERRDMY;
     1682       68    3                 ERRCODE.CODE=F_CODE(I);
     1683       69    3                 ERRCODE.SEV=F_SEV(I);
     1684       70    3                 RETURN;
     1685       71    3                 END;
     1686       72    2              END;
     1687       73    1           RETURN;
     1688       74    1   END FMF$TYC;

PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:259  
--  Include file information  --

   F_MACROS_C.:E05TOU  is referenced.
   F_CODE_R.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMF$TYC.

   Procedure FMF$TYC requires 37 words for executable code.
   Procedure FMF$TYC requires 6 words of local(AUTO) storage.

    No errors detected in file FMF$PMME.:E05TSI    .

PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:260  

 Object Unit name= FMF$TYC                                    File name= FMF$PMME.:E05TOU
 UTS= JUL 29 '97 16:44:57.40 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  FMF$TYC
    1   Proc  even  none    37     45  FMF$TYC

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        2  FMF$TYC

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    F_CODE                           r    F_SEV                            r    F_TYCMAX
     B_VECTNIL
PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:261  


     1637        1        /*T***********************************************************/
     1638        2        /*T*                                                         */
     1639        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1640        4        /*T*                                                         */
     1641        5        /*T***********************************************************/
     1642        6        /*F*    NAME:    FMF$TYC
     1643        7        *       PURPOSE:  Convert a TYC to JIT.ERR */
     1644        8        /**/
     1645        9        /**/
     1646       10        /*D*    NAME:    FMF$TYC
     1647       11        *       CALL:    CALL FMF$TYC(TYC,ERRCODE);
     1648       12        *       INPUT:   TYC - 36 bit TYC to convert
     1649       13        *       OUTPUT:  ERRCODE - The error code in same format as JIT.ERR
     1650       14        *       DESCRIPTION:  ERRCODE is zeroed.  If TYC.EGV is zero, return.
     1651       15        *                Scan TYC from bit 1 to bit 35.  When the first
     1652       16        *                non-zero bit is found, set ERRCODE from F_CODE and
     1653       17        *                F_SEV.
     1654       18        */
     1655       19        /**/
     1656       20        /**/
     1657       21        FMF$TYC: PROC(TYC,ERRCODE);

     21  1 000000   000000 700200 xent  FMF$TYC      TSX0  ! X66_AUTO_2
         1 000001   000006 000002                    ZERO    6,2

     1658       22        /* PARAMETERS */
     1659       23    1   DCL 1 TYC ALIGNED,
     1660       24    1         2 B(0:35) BIT(1) UNAL;
     1661       25    1   DCL 1 ERRCODE ALIGNED,
     1662       26    1         2 * BIT(19),
     1663       27    1         2 CODE UBIN(14) UNAL,
     1664       28    1         2 SEV UBIN(3) UNAL;
     1665       29        /* INCLUDE FILES */
     1666       30        %INCLUDE F_CODE_R;
     1667       40        %INCLUDE F_MACROS_C;
     1668       51        /* LOCAL AUTOMATIC STORAGE */
PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:262  
     1669       52    1   DCL I UBIN;
     1670       53        /* SUBSTITUTIONS */
     1671       54        %SUB FCG#='0615'O;
     1672       55        %SUB MID#='06'O;
     1673       56        /* CONSTANT STORAGE */
     1674       57        %ERRCODE (NAME=ERRDMY,COD#=0);
     1675       61        /**/
     1676       62        /**/
     1677       63    1           ERRCODE='0'B;

     63  1 000002   200004 470500                    LDP0    @ERRCODE,,AUTO
         1 000003   000000 450100                    STZ     0,,PR0

     1678       64    1           IF TYC.B(0) THEN      /* EGV set - there is something significant     */

     64  1 000004   200003 471500                    LDP1    @TYC,,AUTO
         1 000005   100000 234100                    SZN     0,,PR1
         1 000006   000044 605000 1                  TPL     s:73

     1679       65    2           DO I=1 TO F_TYCMAX;

     65  1 000007   000001 235007                    LDA     1,DL
         1 000010   200005 755100                    STA     I,,AUTO
         1 000011   000040 710000 1                  TRA     s:72+2

     1680       66    3              IF TYC.B(I) THEN DO;

     66  1 000012   200003 470500                    LDP0    @TYC,,AUTO
         1 000013   200005 235100                    LDA     I,,AUTO
         1 000014   000000 066505                    CMPB    filb='0'B
         1 000015   000000 000001                    BDSC    0,A,PR0                  by=0,bit=0,n=1
         1 000016   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000017   000036 600000 1                  TZE     s:72

     1681       67    3                 ERRCODE=ERRDMY;

     67  1 000020   000000 236000 0                  LDQ     ERRDMY
PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:263  
         1 000021   200004 471500                    LDP1    @ERRCODE,,AUTO
         1 000022   100000 756100                    STQ     0,,PR1

     1682       68    3                 ERRCODE.CODE=F_CODE(I);

     68  1 000023   200005 236100                    LDQ     I,,AUTO
         1 000024   000011 402007                    MPY     9,DL
         1 000025   003100 061406                    CSR     bolr='003'O
         1 000026   000000 000011 xsym               BDSC    F_CODE,Q                 by=0,bit=0,n=9
         1 000027   100000 410016                    BDSC    0,,PR1                   by=2,bit=1,n=14

     1683       69    3                 ERRCODE.SEV=F_SEV(I);

     69  1 000030   200005 235100                    LDA     I,,AUTO
         1 000031   000001 735000                    ALS     1
         1 000032   003100 061405                    CSR     bolr='003'O
         1 000033   000000 000002 xsym               BDSC    F_SEV,A                  by=0,bit=0,n=2
         1 000034   100000 660003                    BDSC    0,,PR1                   by=3,bit=6,n=3

     1684       70    3                 RETURN;

     70  1 000035   000000 702200 xent               TSX2  ! X66_ARET

     1685       71    3                 END;
     1686       72    2              END;

     72  1 000036   000001 035007                    ADLA    1,DL
         1 000037   200005 755100                    STA     I,,AUTO
         1 000040   200005 236100                    LDQ     I,,AUTO
         1 000041   000044 604000 1                  TMI     s:73
         1 000042   000000 116000 xsym               CMPQ    F_TYCMAX
         1 000043   000012 604400 1                  TMOZ    s:66

     1687       73    1           RETURN;

     73  1 000044   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:264  
ERRDMY
 Sect OctLoc
   0     000   061506 000002                                                    1...
     1688       74    1   END FMF$TYC;

PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:265  
--  Include file information  --

   F_MACROS_C.:E05TOU  is referenced.
   F_CODE_R.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMF$TYC.
PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:266  

 **** Variables and constants ****

  ****  Section 000 RoData FMF$TYC

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 ERRDMY

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ERRCODE                   3-0-0/w PTR         r     1 @TYC
    *0-0-0/w STRC        r     1 ERRCODE                    5-0-0/w UBIN        r     1 I
    *0-0-0/w STRC        r     1 TYC

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b UBIN(9)     r     1 F_CODE(0:24)               0-0-0/b UBIN(2)     r     1 F_SEV(0:24)
     0-0-0/w SBIN        r     1 F_TYCMAX


   Procedure FMF$TYC requires 37 words for executable code.
   Procedure FMF$TYC requires 6 words of local(AUTO) storage.

    No errors detected in file FMF$PMME.:E05TSI    .
PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:267  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:268  
          MINI XREF LISTING

ERRCODE
        25**DCL        21--PROC       63<<ASSIGN     67<<ASSIGN
ERRCODE.CODE
        27**DCL        68<<ASSIGN
ERRCODE.SEV
        28**DCL        69<<ASSIGN
ERRDMY
        58**DCL        67>>ASSIGN
F_CODE
        38**DCL        68>>ASSIGN
F_SEV
        38**DCL        69>>ASSIGN
F_TYCMAX
        38**DCL        65>>DOINDEX
I
        52**DCL        65<<DOINDEX    66>>IF         68>>ASSIGN     69>>ASSIGN
TYC
        23**DCL        21--PROC
TYC.B
        24**DCL        64>>IF         66>>IF
PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:269  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FMF$TYC File=FMF$PMME.:E05TSI                                 TUE 07/29/97 16:44 Page:270  
              MINI UREF LISTING

FMF$TYC      21**PROC
F_TYCBITS      38**DCL
