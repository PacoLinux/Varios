VERSION E05

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:1    
        1        1        /*M* KHC$CLOCK contains VDH library clock services. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8        /*F* NAME: Clock_Services
        9        9
       10       10        The clock services provided by the library routines
       11       11        include:
       12       12
       13       13        o Setting, resetting, restarting, and cancelling clocks.
       14       14
       15       15        o Returning the Universal Time Stamp.
       16       16
       17       17        o Returning user execution time.
       18       18        */
       19       19
       20       20        /*D*  CALL:       CALL KHC$CLOCK ( KH$CLK ) ALTRET ( altret_label );
       21       21             PARAMETERS:  KH$CLK contains:
       22       22                           1. function to be performed (see KH_CLKFNC_E)
       23       23                           2. clock timer block context pointer.  This is
       24       24                              a valid pointer if the user allocates it, and
       25       25                              addr(nil) if it's to be allocated by this
       26       26                              module.
       27       27                           3. User supplied pointer to be returned upon
       28       28                              clock expiration (only needed on set clock
       29       29                              operations).
       30       30                           4. User supplied value to be returned upon
       31       31                              clock expiration (only needed on set clock
       32       32                              operations).
       33       33                           5. Flag indicating the origin of the call
       34       34                              (i.e. VDH or a user).  Default is a user.
       35       35                           6. Flag informing clock services whether or not
       36       36                              user keeps CTB pointer.
       37       37                           7. Modification of perm status (used only on
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:2    
       38       38                              reset functions).
       39       39                           8. Discrepancy factor indicating how accurate the
       40       40                              clock need be.
       41       41                           9. Entry address where user is to be entered upon
       42       42                              expiration.
       43       43                          10. Type of period to wait (e.g. min, sec, tmil).
       44       44                          11. Period to wait.
       45       45             ENVIRONMENT: Called by a user or VDH.  This routine immediately
       46       46                          jumps to the user inhibit level.  It only drops
       47       47                          to the user base level while expiring a clock.
       48       48                          Note theat this module houses the main wait routine
       49       49                          for VDH.
       50       50             INPUT:       KH$CLK (see KH$CLK module).
       51       51             OUTPUT:      KH$EXP (see KH$CLK module).
       52       52        */
       53       53
       54       54        /*F* NAME: KHC$CLOCK - Clock Services; Set, Reset & Cancel
       55       55
       56       56        Functions provided by this service are as follows:
       57       57
       58       58        o  Set a one-time clock request.
       59       59
       60       60        o  Set a periodic clock request for a
       61       61        specified interval.
       62       62
       63       63        o  Cancel a clock request.
       64       64
       65       65        o  Reset an existing clock request to
       66       66        expire at a different time, return to a different
       67       67        expiration entry address, or return a different
       68       68        expiration value.
       69       69
       70       70        o  Restart the clock.
       71       71
       72       72        The KHC$CLOCK service obtains parameters from the
       73       73        structure KH$CLK and returns results in the
       74       74        structure KH$EXP.
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:3    
       75       75
       76       76        The form of the call for this service is:
       77       77
       78       78           CALL KHC$CLOCK (kh$clk) ALTRET (label);
       79       79
       80       80        where:
       81       81        */
       82       82
       83       83        /*K* kh$clk
       84       84        is the KH$CLK structure that contains the parameters
       85       85        for this call to KHC$CLOCK.  Please refer to the description
       86       86        of KH$CLK below for details.
       87       87        */
       88       88        KHC$CLOCK: PROC (KH_ARG) ALTRET;
       89       89
       90       90        %INCLUDE LCP_6;
       91     4369        %INCLUDE GH_HARDWARE_M;
       92     4467        %INCLUDE G_JIT_M;
       93     4732        %INCLUDE G_HJIT_M;
       94     4877        %INCLUDE KH$CLK;
       95     5247        %INCLUDE KL_CONTROL_C;
       96     5627        %INCLUDE KHC_MAC_C;
       97     5668        %INCLUDE KH_MACRO_C;
       98     6411        %INCLUDE KH_CLKFNC_E;
       99     6456        %INCLUDE KV$BPC;
      100     6485
      101     6486    1   DCL G$JIT$ PTR SYMREF;
      102     6487    1   DCL KV_B_POOL$ PTR SYMREF;
      103     6488
      104     6489           %INHIBIT_DCLS;
      105     6501
      106     6502           %KV$BPC (STCLASS="BASED(KV_B_POOL$)");
      107     6524
      108     6525           %G$JIT (STCLASS="BASED(G$JIT$)");
      109     6939
      110     6940           %G$LOW_MEM (STCLASS="BASED(G$LOW_MEM$)");
      111     6989
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:4    
      112     6990           %G$MHJIT (STCLASS="BASED(G$MHJIT$)");
      113    13864
      114    13865    1   DCL KH_ARG CHAR(UTS_TIX) PARAM;
      115    13866
      116    13867    1   DCL PARM_TIME2 REDEF KH_ARG UBIN(32);
      117    13868
      118    13869    1   DCL PARM_TIME1 REDEF KH_ARG UBIN;
      119    13870
      120    13871           %KH$CLK (FPTN=KH_CLK,
      121    13872                    FNC=%KH#CLK_SETCLK,
      122    13873                    STCLASS=REDEF KH_ARG);
      123    14022
      124    14023           %KH$CLK (FPTN=KH_SETCLK,
      125    14024                    FNC=%KH#CLK_SETCLK,
      126    14025                    STCLASS=REDEF KH_ARG);
      127    14174
      128    14175           %KH$CLK (FPTN=KH_CANCELCLK,
      129    14176                    FNC=%KH#CLK_CANCEL,
      130    14177                    STCLASS=REDEF KH_ARG);
      131    14326
      132    14327           %KH$CLK (FPTN=KH_RESETCLK,
      133    14328                    FNC=%KH#CLK_RESET,
      134    14329                    STCLASS=REDEF KH_ARG);
      135    14478
      136    14479           %KH$CLK (FPTN=KH_RESTARTCLK,
      137    14480                    FNC=%KH#CLK_RESTART,
      138    14481                    STCLASS=REDEF KH_ARG);
      139    14630
      140    14631           %KH$EXP   (FPTN=FPT_VDH,
      141    14632                      STCLASS=REDEF KH_ARG);
      142    14695
      143    14696           %KH$CTBCTX;
      144    14769
      145    14770           %KH$EXP (FPTN=FPT_USER,
      146    14771                    STCLASS=STATIC);
      147    14834
      148    14835           %KH$CTLTBL (FPTN=KH$CTLTBL,
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:5    
      149    14836                       STCLASS="BASED(KH_CTLTBL$)");
      150    15048
      151    15049           %FPT_WAIT (FPTN=SUSPEND,
      152    15050                       STCLASS=CONSTANT,
      153    15051                      UTYPE=UTS,
      154    15052                      UETIME=UETIME,
      155    15053                      UNITS=UTS_VALUE,
      156    15054                      MODE=SUSP);
      157    15078
      158    15079           %FPT_WAIT (FPTN=ADJUST,
      159    15080                       STCLASS=CONSTANT,
      160    15081                      UTYPE=UTS,
      161    15082                      UNITS=UTS_VALUE,
      162    15083                      MODE=ADJUST);
      163    15107
      164    15108        %EQU YES#='1'B;
      165    15109        %EQU  NO#='0'B;
      166    15110    1   DCL G$MHJIT$ PTR SYMREF;
      167    15111    1   DCL G$LOW_MEM$ PTR SYMREF;
      168    15112    1   DCL KH_CTLTBL$ PTR SYMREF;
      169    15113    1   DCL KH_INHLVL UBIN SYMREF;
      170    15114    1   DCL USER@ EPTR;
      171    15115    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      172    15116    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      173    15117    1   DCL CTB$ PTR;
      174    15118    1   DCL PRD UBIN(32);
      175    15119    1   DCL PRD1 UBIN(32);
      176    15120    1   DCL DWORD UBIN(32) BASED;
      177    15121    1   DCL ACCURACY UBIN WORD;
      178    15122    1   DCL INHWORD UBIN WORD BASED;
      179    15123    1   DCL UTS_TIX UBIN WORD;
      180    15124    1   DCL UETIME UBIN WORD STATIC INIT(0);
      181    15125    1   DCL UTS_VALUE UBIN(32) STATIC;
      182    15126    1   DCL SUSPENDED BIT(1) STATIC ALIGNED INIT ('0'B);
      183    15127
      184    15128    1   DCL CURR_UTS UBIN(32) ALIGNED;
      185    15129    1   DCL 1 CURR_UTSR REDEF CURR_UTS,
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:6    
      186    15130    1         2 DATE UBIN(16),
      187    15131    1         2 TICKS UBIN(16);
      188    15132
      189    15133    1   DCL 1 KH_C STATIC SYMDEF,
      190    15134    1         2 CTBHD$ PTR,
      191    15135    1         2 CTBTL$ PTR,
      192    15136    1         2 DISPATCH$ PTR;
      193    15137
      194    15138    1       INHIBIT_LEVEL = KH_INHLVL;
      195    15139    1      CTB$ = KH_CLK.CTBCTX$;
      196    15140    1      KH_CLK.RESULT = %KH#RES_OK;
      197    15141    1      KV$BPC.CLKC = KV$BPC.CLKC + 1;
      198    15142
      199    15143    2      DO CASE (KH_CLK.FNC);
      200    15144
      201    15145    2      CASE (%KH#CLK_SETCLK, %KH#CLK_SETCLKPERM);
      202    15146
      203    15147                                           /*
      204    15148                                              Validate clock service request
      205    15149                                                                            */
      206    15150
      207    15151    2        IF KH_SETCLK.PRDUNT > %KH#C_MIN
      208    15152    2        OR KH_SETCLK.PRD = 0
      209    15153    2           OR (KH_SETCLK.SBR$ = ENTADDR(NIL)
      210    15154    2            AND KH_SETCLK.VDH_CLK = %NO#)
      211    15155    3        THEN DO;
      212    15156    3          KH_SETCLK.RESULT = %KH#RES_INVREQ;
      213    15157    3          ALTRETURN;
      214    15158    3          END;
      215    15159
      216    15160                                           /*
      217    15161                                              If the user has not pre-allocated
      218    15162                                              the clock timer block, we must
      219    15163                                              get one.  Get it, zero it out,
      220    15164                                              and remember it's dynamic so we
      221    15165                                              can release it (later).
      222    15166                                                                           */
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:7    
      223    15167             %DISABLE;
      224    15171    2        IF KH_SETCLK.CTBCTX$ = ADDR(NIL)
      225    15172    3        THEN DO;
      226    15173    3          CALL KVB$GETSYS (SIZEW(KH$CTBCTX), KH_SETCLK.CTBCTX$)
      227    15174    4          WHENALTRETURN DO;
      228    15175    4            KH_SETCLK.RESULT = %KH#RES_NOCTB;
      229    15176                 %ENABLE;
      230    15182    4            ALTRETURN;
      231    15183    4            END;
      232    15184    3          KV$BPC.CLKCTX = KV$BPC.CLKCTX + 1;
      233    15185    3          KH_SETCLK.CTBCTX$ -> KH$CTBCTX = '0'B;
      234    15186    3          KH_SETCLK.CTBCTX$ -> KH$CTBCTX.DYNAMIC = '1'B;
      235    15187    3          END;
      236    15188    3        ELSE DO;
      237    15189                                           /*
      238    15190                                              User supplied a CTB - zero it.
      239    15191                                                                          */
      240    15192    3          KH_SETCLK.CTBCTX$ -> KH$CTBCTX = '0'B;
      241    15193    3          END;
      242    15194
      243    15195    2        CTB$ = KH_SETCLK.CTBCTX$;
      244    15196
      245    15197           /*
      246    15198           FEP UTS is in units of 2/15 seconds, which means the UTS gets
      247    15199           bumped 7.5 times every second.  Since PL6 doesn't handle decimal
      248    15200           points, we must represent this as: 1/(2/15) or 15/2.  In
      249    15201           order to retain as many decimal places as possible, multiply first.
      250    15202                                                                          */
      251    15203    2        PRD = KH_SETCLK.PRD;
      252    15204    3        DO CASE (KH_SETCLK.PRDUNT);
      253    15205
      254    15206    3          CASE (%KH#C_SEC);
      255    15207    3            PRD1 = PRD * 16;
      256    15208    3            PRD = PRD1 - PRD;
      257    15209    3            CTB$ -> KH$CTBCTX.PRD = PRD / 2;
      258    15210    3            CTB$ -> KH$CTBCTX.ACCURACY = (KH_SETCLK.ACCURACY * 15) / 2;
      259    15211
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:8    
      260    15212    3          CASE (%KH#C_MIN);
      261    15213    3            PRD1 = PRD * 16;
      262    15214    3            PRD = PRD1 - PRD;
      263    15215    3            PRD1 = PRD * 32;
      264    15216    3            CTB$ -> KH$CTBCTX.PRD = PRD1 - PRD - PRD;
      265    15217    3            CTB$ -> KH$CTBCTX.ACCURACY = KH_SETCLK.ACCURACY * 30 * 15;
      266    15218
      267    15219    3          CASE (%KH#C_TMIL);
      268    15220    3            PRD = KH_SETCLK.PRD / 40;
      269    15221    3            CTB$ -> KH$CTBCTX.PRD = KH_SETCLK.PRD / 10 - PRD ;
      270    15222    3            CTB$ -> KH$CTBCTX.ACCURACY = (KH_SETCLK.ACCURACY * 3) / 40;
      271    15223
      272    15224    3          END;
      273    15225
      274    15226                                           /*
      275    15227                                              Disable before we aquire the
      276    15228                                              current time.  This will prevent
      277    15229                                              us from being interrupted
      278    15230                                              before we assign the UTS.
      279    15231                                                                          */
      280    15232                                           /*
      281    15233                                              Get the current UTS and assign
      282    15234                                              the wake-up UTS in the clock
      283    15235                                              timer block.
      284    15236                                                                          */
      285    15237           /*
      286    15238           Get the current 32 bit UTS.  The bottom four bits of the 36-bit UTS
      287    15239           (in L6 clock tick units, i.e., 120th of a second) are ignored.
      288    15240                                                                          */
      289    15241    2        CALL GET_UTS_PARTS;
      290    15242    2        CURR_UTS = CURR_UTS + (UTS_TIX + 8) / 16;
      291    15243    2        CTB$ -> KH$CTBCTX.UTS = CURR_UTS + CTB$ -> KH$CTBCTX.PRD;
      292    15244    2        CTB$ -> KH$CTBCTX.SBR$ = KH_SETCLK.SBR$;
      293    15245    2        CTB$ -> KH$CTBCTX.UID = KH_SETCLK.UID;
      294    15246    2          CTB$ -> KH$CTBCTX.UVAL = KH_SETCLK.UVAL;
      295    15247    2        CTB$ -> KH$CTBCTX.VDH_CLK = KH_SETCLK.VDH_CLK;
      296    15248    2        CTB$ -> KH$CTBCTX.EXPINH = KH_SETCLK.EXPINH;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:9    
      297    15249    2        IF KH_SETCLK.FNC = %KH#CLK_SETCLKPERM
      298    15250    3        THEN DO;
      299    15251    3          CTB$ -> KH$CTBCTX.PERM = %YES#;
      300    15252    3          END;
      301    15253    2        CALL QUEUE_CTB;
      302    15254             %ENABLE;
      303    15260    2        RETURN;
      304    15261
      305    15262        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:10   
      306    15263
      307    15264        /* Remove the specified clock timer block from the clock chain. */
      308    15265
      309    15266    2      CASE (%KH#CLK_CANCEL);
      310    15267
      311    15268             %DISABLE;
      312    15272
      313    15273    2        IF KH_CANCELCLK.NO_CTB = %YES#
      314    15274    3        THEN DO;
      315    15275    3          CALL FIND_UID_UVAL
      316    15276    4          WHENRETURN DO;
      317    15277    4            IF CTB$ ~= KH_C.DISPATCH$
      318    15278    5            THEN DO;
      319    15279    5              ;
      320    15280    5              END;
      321    15281    5            ELSE DO;
      322    15282    5              FPT_USER.ABORT = '1'B;
      323    15283    5              KH_CANCELCLK.RESULT = %KH#RES_EXPIRING;
      324    15284    5              GOTO CANCEL_EXIT;
      325    15285    5              END;
      326    15286    4            END;
      327    15287    4          WHENALTRETURN DO;
      328    15288    4            KH_CANCELCLK.RESULT = %KH#RES_NOQ;
      329    15289    4            GOTO CANCEL_EXIT;
      330    15290    4            END;
      331    15291    3          END;
      332    15292    3        ELSE DO;
      333    15293    3          IF CTB$ ~= KH_C.DISPATCH$
      334    15294    4          THEN DO;
      335    15295    4            CALL FIND_CTB$
      336    15296    5            WHENALTRETURN DO;
      337    15297    5              KH_CANCELCLK.RESULT = %KH#RES_NOQ;
      338    15298    5              GOTO CANCEL_EXIT;
      339    15299    5              END;
      340    15300    4            END;
      341    15301    4          ELSE DO;
      342    15302    4            FPT_USER.ABORT = '1'B;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:11   
      343    15303    4            KH_CANCELCLK.RESULT = %KH#RES_EXPIRING;
      344    15304    4            GOTO CANCEL_EXIT;
      345    15305    4            END;
      346    15306    3          END;
      347    15307                                           /*
      348    15308                                                                          */
      349    15309    2          CALL DEQUEUE_CTB;
      350    15310
      351    15311    2          IF CTB$ -> KH$CTBCTX.DYNAMIC
      352    15312    3          THEN DO;
      353    15313    3            CTB$ -> INHWORD = SIZEW(KH$CTBCTX);
      354    15314    3            CALL KVB$RLSSYS (CTB$ -> INHWORD)
      355    15315    4            WHENRETURN DO;
      356    15316    4              KV$BPC.CLKCTX = KV$BPC.CLKCTX - 1;
      357    15317    4              KH_CANCELCLK.RESULT = %KH#RES_OK;
      358    15318    4              END;
      359    15319    4            WHENALTRETURN DO;
      360    15320    4              KH_CANCELCLK.RESULT = %KH#RES_NOREL;
      361    15321    4              END;
      362    15322    3            END;  /* IF KH$CTBCTX.DYNAMIC */
      363    15323
      364    15324    2   CANCEL_EXIT:;
      365    15325             %ENABLE;
      366    15331    2        IF KH_CANCELCLK.RESULT = %KH#RES_OK
      367    15332    2        THEN
      368    15333    2          RETURN;
      369    15334    2        ELSE
      370    15335    2          ALTRETURN;
      371    15336
      372    15337        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:12   
      373    15338
      374    15339        /* Modify the specified clock timer block to expire at a different
      375    15340           time.  Note that all other clock timer block specifications can
      376    15341           also be modified. */
      377    15342
      378    15343    2      CASE (%KH#CLK_RESET);
      379    15344
      380    15345             %DISABLE;
      381    15349
      382    15350    2        IF KH_RESETCLK.NO_CTB = %YES#
      383    15351    3        THEN DO;
      384    15352    3          CALL FIND_UID_UVAL
      385    15353    4          WHENRETURN DO;
      386    15354    4            IF CTB$ ~= KH_C.DISPATCH$
      387    15355    5            THEN DO;
      388    15356    5              ;
      389    15357    5              END;
      390    15358    5            ELSE DO;
      391    15359    5              FPT_USER.RESET = '1'B;
      392    15360    5              KH_RESETCLK.RESULT = %KH#RES_EXPIRING;
      393    15361    5              GOTO RESET_PARAMS;
      394    15362    5              END;
      395    15363    4            END;
      396    15364    4          WHENALTRETURN DO;
      397    15365    4            KH_RESETCLK.RESULT = %KH#RES_NOQ;
      398    15366    4            GOTO RESET_EXIT;
      399    15367    4            END;
      400    15368    3          END;
      401    15369    3         ELSE DO;
      402    15370    3           IF CTB$ ~= KH_C.DISPATCH$
      403    15371    4           THEN DO;
      404    15372    4             CALL FIND_CTB$
      405    15373    5             WHENALTRETURN DO;
      406    15374    5               KH_RESETCLK.RESULT = %KH#RES_NOQ;
      407    15375    5               GOTO RESET_EXIT;
      408    15376    5               END;
      409    15377    4             END;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:13   
      410    15378    4           ELSE DO;
      411    15379    4             FPT_USER.RESET = '1'B;
      412    15380    4             KH_RESETCLK.RESULT = %KH#RES_EXPIRING;
      413    15381    4             GOTO RESET_PARAMS;
      414    15382    4             END;
      415    15383    3           END;
      416    15384
      417    15385    2        CALL DEQUEUE_CTB;
      418    15386
      419    15387    2   RESET_PARAMS:;
      420    15388
      421    15389
      422    15390    2        IF KH_RESETCLK.SBR$ ~= ENTADDR(NIL)
      423    15391    3        THEN DO;
      424    15392                                         /*
      425    15393                                            Assign new subroutine entry.
      426    15394                                                                        */
      427    15395    3          CTB$ -> KH$CTBCTX.SBR$ = KH_RESETCLK.SBR$;
      428    15396    3          END;
      429    15397    2        IF KH_RESETCLK.UID$ ~= ADDR(NIL)
      430    15398    3        THEN DO;
      431    15399                                         /*
      432    15400                                            Assign new user value.
      433    15401                                                                        */
      434    15402    3          CTB$ -> KH$CTBCTX.UID = KH_RESETCLK.UID;
      435    15403    3          END;
      436    15404                                         /*
      437    15405                                            Convert period and accuracy
      438    15406                                            into UTS form.
      439    15407                                                                        */
      440    15408    2        PRD = KH_RESETCLK.PRD;
      441    15409    3        DO CASE (KH_RESETCLK.PRDUNT);
      442    15410
      443    15411    3          CASE (%KH#C_SEC);
      444    15412    3            PRD1 = PRD * 16;
      445    15413    3            PRD = PRD1 - PRD;
      446    15414    3            CTB$ -> KH$CTBCTX.PRD = PRD / 2;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:14   
      447    15415    3            ACCURACY = (KH_RESETCLK.ACCURACY * 15) / 2;
      448    15416
      449    15417    3          CASE (%KH#C_MIN);
      450    15418    3            PRD1 = PRD * 16;
      451    15419    3            PRD = PRD1 - PRD;
      452    15420    3            PRD1 = PRD * 32;
      453    15421    3            CTB$ -> KH$CTBCTX.PRD = PRD1 - PRD - PRD;
      454    15422    3            ACCURACY = (KH_RESETCLK.ACCURACY * 30 * 15);
      455    15423
      456    15424    3          CASE (%KH#C_TMIL);
      457    15425    3            PRD = KH_SETCLK.PRD / 40;
      458    15426    3            CTB$ -> KH$CTBCTX.PRD = KH_SETCLK.PRD / 10 - PRD ;
      459    15427    3            ACCURACY = (KH_RESETCLK.ACCURACY * 3) / 40;
      460    15428
      461    15429    3          END;
      462    15430                                         /*
      463    15431                                            Assign new accuracy (fuzz)
      464    15432                                            factor.
      465    15433                                                                        */
      466    15434    2          CTB$ -> KH$CTBCTX.ACCURACY = ACCURACY;
      467    15435                                         /*
      468    15436                                            Assign new permanent clock
      469    15437                                            status.
      470    15438                                                                        */
      471    15439    2      IF NOT KH_RESETCLK.PERM & %KH#C_NOCHANGE
      472    15440    2      THEN
      473    15441    2        CTB$ -> KH$CTBCTX.PERM = KH_RESETCLK.PERM;
      474    15442    2        IF NOT KH_RESETCLK.EXPINH & %KH#C_NOCHANGE
      475    15443    2        THEN
      476    15444    2         CTB$ -> KH$CTBCTX.EXPINH = KH_SETCLK.EXPINH;
      477    15445    2      CALL GET_UTS_PARTS;
      478    15446    2      CURR_UTS = CURR_UTS + (UTS_TIX + 8) / 16;
      479    15447    2        CTB$ -> KH$CTBCTX.UTS = CURR_UTS + CTB$ -> KH$CTBCTX.PRD;
      480    15448
      481    15449                                       /*
      482    15450                                          If this reset is interrupting
      483    15451                                          the dispatch of this block,
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:15   
      484    15452                                          allow the dispatch routine to
      485    15453                                          queue the block after this
      486    15454                                          interrupt completes.
      487    15455                                                                      */
      488    15456    2        IF CTB$ ~= KH_C.DISPATCH$
      489    15457    3        THEN DO;
      490    15458    3          CALL QUEUE_CTB;
      491    15459    3          END;
      492    15460
      493    15461    2   RESET_EXIT:;
      494    15462             %ENABLE;
      495    15468    2        IF KH_RESETCLK.RESULT = %KH#RES_OK
      496    15469    2        THEN
      497    15470    2          RETURN;
      498    15471    2        ELSE
      499    15472    2          ALTRETURN;
      500    15473        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:16   
      501    15474
      502    15475        /* Restart a clock.  This case is essentially a fast reset. */
      503    15476
      504    15477    2      CASE (%KH#CLK_RESTART);
      505    15478
      506    15479             %DISABLE;
      507    15483
      508    15484    2        IF KH_RESTARTCLK.NO_CTB = %YES#
      509    15485    3        THEN DO;
      510    15486    3          CALL FIND_UID_UVAL
      511    15487    4          WHENRETURN DO;
      512    15488    4            IF CTB$ ~= KH_C.DISPATCH$
      513    15489    5            THEN DO;
      514    15490    5              ;
      515    15491    5              END;
      516    15492    5            ELSE DO;
      517    15493    5              FPT_USER.RESET = '1'B;
      518    15494    5              KH_RESTARTCLK.RESULT = %KH#RES_EXPIRING;
      519    15495    5              GOTO RESTART_EXIT;
      520    15496    5              END;
      521    15497    4            END;
      522    15498    4          WHENALTRETURN DO;
      523    15499    4            KH_RESTARTCLK.RESULT = %KH#RES_NOQ;
      524    15500    4            GOTO RESTART_EXIT;
      525    15501    4            END;
      526    15502    3          END;
      527    15503    3         ELSE DO;
      528    15504    3           IF CTB$ ~= KH_C.DISPATCH$
      529    15505    4           THEN DO;
      530    15506    4             CALL FIND_CTB$
      531    15507    5             WHENALTRETURN DO;
      532    15508    5               KH_RESTARTCLK.RESULT = %KH#RES_NOQ;
      533    15509    5               GOTO RESTART_EXIT;
      534    15510    5               END;
      535    15511    4             END;
      536    15512    4           ELSE DO;
      537    15513    4             FPT_USER.RESET = '1'B;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:17   
      538    15514    4             KH_RESTARTCLK.RESULT = %KH#RES_EXPIRING;
      539    15515    4            GOTO RESTART_EXIT;
      540    15516    4             END;
      541    15517    3           END;
      542    15518
      543    15519    2        CALL DEQUEUE_CTB;
      544    15520
      545    15521
      546    15522    2      CALL GET_UTS_PARTS;
      547    15523    2      CURR_UTS = CURR_UTS + (UTS_TIX + 8) / 16;
      548    15524    2        CTB$ -> KH$CTBCTX.UTS = CURR_UTS + CTB$ -> KH$CTBCTX.PRD;
      549    15525
      550    15526                                       /*
      551    15527                                          If this reset is interrupting
      552    15528                                          the dispatch of this block,
      553    15529                                          allow the dispatch routine to
      554    15530                                          queue the block after this
      555    15531                                          interrupt completes.
      556    15532                                                                      */
      557    15533    2        IF CTB$ ~= KH_C.DISPATCH$
      558    15534    3        THEN DO;
      559    15535    3          CALL QUEUE_CTB;
      560    15536    3          END;
      561    15537
      562    15538    2   RESTART_EXIT:;
      563    15539             %ENABLE;
      564    15545    2        IF KH_RESTARTCLK.RESULT = %KH#RES_OK
      565    15546    2        THEN
      566    15547    2          RETURN;
      567    15548    2        ELSE
      568    15549    2          ALTRETURN;
      569    15550        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:18   
      570    15551    2      CASE (ELSE);
      571    15552             /* SNAP */
      572    15553
      573    15554    2      END;
      574    15555
      575    15556    1      RETURN;
      576    15557
      577    15558        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:19   
      578    15559    1   KHC$WAIT: ENTRY ALTRET;
      579    15560
      580    15561    1          INHIBIT_LEVEL = KH_INHLVL;
      581    15562             %DISABLE;
      582    15566    1        CALL GET_UTS_PARTS;
      583    15567    1        CURR_UTS = CURR_UTS + (UTS_TIX + 8) / 16;
      584    15568    1          IF KH_C.CTBHD$ = ADDR(NIL)
      585    15569    1          THEN
      586    15570    1            UTS_VALUE = CURR_UTS + 10;
      587    15571    1          ELSE
      588    15572    1        UTS_VALUE = KH_C.CTBHD$ -> KH$CTBCTX.UTS;
      589    15573    1        UETIME = 0;
      590    15574                                           /*
      591    15575                                             Is it necessary to go to sleep?
      592    15576                                             If so, suspend.
      593    15577                                                                          */
      594    15578    1        IF CURR_UTS < UTS_VALUE
      595    15579    2        THEN DO;
      596    15580    2        SUSPENDED = '1'B;
      597    15581             %ENABLE;
      598    15587    2        UTS_VALUE = UTS_VALUE + G$MHJIT.BOOTUTS;
      599    15588    2        CALL M$WAIT (SUSPEND);
      600    15589             %DISABLE;
      601    15593    2        SUSPENDED = '0'B;
      602    15594    2          END;
      603    15595                                           /*
      604    15596                                             If residual time is 0, assume a
      605    15597                                             clock needs to be serviced.  If
      606    15598                                             it's ~0, assume we were kicked
      607    15599                                             off the wait by a VDH event.
      608    15600                                                                          */
      609    15601    1        IF UETIME = 0
      610    15602    2        THEN DO;
      611    15603               %ENABLE;
      612    15609    2          RETURN;
      613    15610    2          END;
      614    15611    2        ELSE DO;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:20   
      615    15612               %ENABLE;
      616    15618    2          ALTRETURN;
      617    15619    2          END;
      618    15620
      619    15621        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:21   
      620    15622    1   KHC$DISPATCH: ENTRY ( KH_ARG ) ALTRET;
      621    15623
      622    15624    1          INHIBIT_LEVEL = KH_INHLVL;
      623    15625           %DISABLE;
      624    15629    1      IF FPT_VDH.VDH_CLK = %YES#
      625    15630    1      AND FPT_VDH.CTBCTX$ ~= ADDR(NIL)
      626    15631    2      THEN DO;
      627    15632    2        CTB$ = FPT_VDH.CTBCTX$;
      628    15633    2        FPT_USER = FPT_VDH;
      629    15634    2        CALL FINISH_EXPIRATION;
      630    15635    2        END;
      631    15636                                           /*
      632    15637                                             Anything left on the queue?
      633    15638                                                                          */
      634    15639
      635    15640    1      IF KH_C.CTBHD$ = ADDR(NIL)
      636    15641    2      THEN DO;
      637    15642    2        GOTO DSPCH_ALTRET_;
      638    15643    2        END;
      639    15644
      640    15645    1        CALL GET_UTS_PARTS;
      641    15646    1        CURR_UTS = CURR_UTS + ( UTS_TIX + 8 ) / 16;
      642    15647    1      CTB$ = KH_C.CTBHD$;
      643    15648                                           /*
      644    15649                                             Check if it's time to service the
      645    15650                                             queue head (i.e. the next clock
      646    15651                                             to expire).
      647    15652                                                                          */
      648    15653    2   TIMEOUT: DO WHILE ( CTB$ ~= ADDR(NIL)
      649    15654    2        AND CTB$ -> KH$CTBCTX.TOKEN = %KH#C_ACTIVE
      650    15655    2        AND ( CURR_UTS >= CTB$ -> KH$CTBCTX.UTS
      651    15656    2        OR CTB$ -> KH$CTBCTX.UTS <= (CTB$ -> KH$CTBCTX.ACCURACY
      652    15657    2       + CURR_UTS) ) );
      653    15658    2          KH_C.DISPATCH$ = CTB$;
      654    15659    2          CALL DEQUEUE_CTB;
      655    15660
      656    15661    2        IF CTB$ -> KH$CTBCTX.SBR$ = ENTADDR(NIL)
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:22   
      657    15662    3          THEN DO;
      658    15663    3            FPT_VDH.VDH_CLK = %YES#;
      659    15664    3          CALL INIT_EXP (FPT_VDH);
      660    15665    3          KH_C.DISPATCH$ = ADDR(NIL);
      661    15666                 %ENABLE;
      662    15672    3            RETURN;
      663    15673    3            END;
      664    15674    3          ELSE DO;
      665    15675    3              CALL INIT_EXP (FPT_USER);
      666    15676    3              FPT_USER.VDH_CLK = %NO#;
      667    15677    3              USER@ = CTB$ -> KH$CTBCTX.SBR$;
      668    15678    3               IF NOT CTB$ -> KH$CTBCTX.EXPINH
      669    15679    4               THEN DO;
      670    15680                   %ENABLE;
      671    15686    4               END;
      672    15687    3              CALL USER@ (FPT_USER);
      673    15688    3               IF NOT CTB$ -> KH$CTBCTX.EXPINH
      674    15689    4               THEN DO;
      675    15690                   %DISABLE;
      676    15694    4               END;
      677    15695    3              CALL FINISH_EXPIRATION;
      678    15696    3            END;
      679    15697    2          CTB$ = KH_C.CTBHD$;
      680    15698    2        END;   /* IF KH_C.CTBHD$ -> KH$CTBCTX.TOKEN = %KH#C_ACTIVE; */
      681    15699
      682    15700                                           /*
      683    15701                                             No more clocks to do right now.
      684    15702                                             Altret to VDH indicating the fact.
      685    15703                                                                          */
      686    15704    1   DSPCH_ALTRET_:;
      687    15705           %ENABLE;
      688    15711    1      ALTRETURN;
      689    15712
      690    15713        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:23   
      691    15714
      692    15715        /* Copy pertinent info from KH$CTBCTX into KH$EXP in preparation to
      693    15716           report that a clock is expiring. */
      694    15717
      695    15718    1   INIT_EXP: PROC (MY_EXP);
      696    15719
      697    15720        %KH$EXP (FPTN = MY_EXP,
      698    15721                 STCLASS = PARAM);
      699    15784
      700    15785    2            MY_EXP.ABORT = %NO#;
      701    15786    2            MY_EXP.RESET = %NO#;
      702    15787    2            MY_EXP.DELETE = %NO#;
      703    15788    2            MY_EXP.UID = CTB$ -> KH$CTBCTX.UID;
      704    15789    2            MY_EXP.CTBCTX$ = CTB$;
      705    15790    2            MY_EXP.UVAL = CTB$ -> KH$CTBCTX.UVAL;
      706    15791    2            KV$BPC.CLKE = KV$BPC.CLKE + 1;
      707    15792
      708    15793    2            RETURN;
      709    15794    2   END INIT_EXP;
      710    15795        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:24   
      711    15796
      712    15797        /* Expire the clocks (i.e. those which are due) based on the current
      713    15798           UTS. */
      714    15799
      715    15800    1   FINISH_EXPIRATION: PROC;
      716    15801                                           /*
      717    15802                                              This is a potential problem area
      718    15803                                              If the user has a self-allocated
      719    15804                                              CTB, it must be retained for the
      720    15805                                              duration of the program.  If not
      721    15806                                              the block could be released, and
      722    15807                                              reallocated for another CTB or
      723    15808                                              some other block.  This means
      724    15809                                              clock services has no way of
      725    15810                                              knowing what to do as far as
      726    15811                                              release is concerned.  Since
      727    15812                                              users allocate CTBs to save
      728    15813                                              CLK SVC time, they will be
      729    15814                                              required to hold onto them.
      730    15815                                                                          */
      731    15816    2            KH_C.DISPATCH$ = ADDR(NIL);
      732    15817                                           /*
      733    15818                                              If cancel or reset are set it
      734    15819                                              was already dequeued.
      735    15820                                                                          */
      736    15821    2            IF NOT FPT_USER.DELETE
      737    15822    3            THEN DO;
      738    15823    3              IF CTB$ -> KH$CTBCTX.PERM = %YES#
      739    15824    3              AND NOT (FPT_USER.ABORT OR FPT_USER.RESET)
      740    15825    4              THEN DO;
      741    15826    4                CTB$ -> KH$CTBCTX.UTS = CTB$ -> KH$CTBCTX.UTS
      742    15827    4                                          + CTB$ -> KH$CTBCTX.PRD;
      743    15828    4                CALL QUEUE_CTB;
      744    15829    4                END;
      745    15830    4              ELSE DO;
      746    15831    4                IF FPT_USER.RESET
      747    15832    5                THEN DO;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:25   
      748    15833    5                  CALL QUEUE_CTB;
      749    15834    5                  FPT_USER.RESET = '0'B;
      750    15835    5                  END;
      751    15836    5                ELSE DO;
      752    15837                                             /*
      753    15838                                                If Clock Services allocated the
      754    15839                                                CTB, then release it.
      755    15840                                                                            */
      756    15841    5                  IF CTB$ -> KH$CTBCTX.DYNAMIC
      757    15842    6                  THEN DO;
      758    15843    6                    CTB$ -> INHWORD = SIZEW(KH$CTBCTX);
      759    15844    6                    CALL KVB$RLSSYS (CTB$ -> INHWORD)
      760    15845    7                    WHENALTRETURN DO;
      761    15846        /*N*               CALL M$WRTSYSLOG (FPT_WRTSYSLOG); */
      762    15847    7                      END;
      763    15848    6                    KV$BPC.CLKCTX = KV$BPC.CLKCTX - 1;
      764    15849    6                    END;  /* ~ CTB$ -> KH$CTBCTX.DYNAMIC */
      765    15850    5                END;  /* ELSE DO */
      766    15851    4              END;  /* ELSE DO */
      767    15852    3            END;  /* IF ~ FPT_USER.DELETE */
      768    15853
      769    15854    2        RETURN;
      770    15855    2   END FINISH_EXPIRATION;
      771    15856        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:26   
      772    15857    1   FIND_CTB$: PROC ALTRET;
      773    15858    2   DCL C$ PTR;
      774    15859
      775    15860    2      C$ = KH_C.CTBHD$;
      776    15861    3      DO WHILE (C$ ~= ADDR(NIL));
      777    15862    3        IF C$ = CTB$
      778    15863    3        THEN
      779    15864    3          RETURN;
      780    15865    3        C$ = C$ -> KH$CTBCTX.FLNK$;
      781    15866    3        END;
      782    15867
      783    15868    2      ALTRETURN;
      784    15869    2   END FIND_CTB$;
      785    15870        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:27   
      786    15871    1   FIND_UID_UVAL: PROC ALTRET;
      787    15872
      788    15873    2   DCL C$ PTR;
      789    15874
      790    15875    2      C$ = KH_C.CTBHD$;
      791    15876
      792    15877    3      DO WHILE (C$ ~= ADDR(NIL));
      793    15878    3        IF ADDR(C$ -> KH$CTBCTX.UID) -> DWORD = ADDR(KH_CLK.UID) -> DWORD
      794    15879    3        AND C$ -> KH$CTBCTX.UVAL = KH_CLK.UVAL
      795    15880    4        THEN DO;
      796    15881    4          CTB$ = C$;
      797    15882    4          RETURN;
      798    15883    4          END;
      799    15884    4        ELSE DO;
      800    15885    4          C$ = C$ -> KH$CTBCTX.FLNK$;
      801    15886    4          END;
      802    15887    3        END;
      803    15888
      804    15889    2      ALTRETURN;
      805    15890    2   END FIND_UID_UVAL;
      806    15891        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:28   
      807    15892
      808    15893             /* QUEUE_CTB  (Enter here disabled) */
      809    15894    1   QUEUE_CTB: PROC ALTRET;
      810    15895
      811    15896    2   DCL C$ PTR;
      812    15897
      813    15898    2      CTB$ -> KH$CTBCTX.FLNK$ = ADDR(NIL);
      814    15899    2      CTB$ -> KH$CTBCTX.BLNK$ = ADDR(NIL);
      815    15900
      816    15901                                           /*
      817    15902                                             Nothing on queue
      818    15903                                                                          */
      819    15904    2      IF KH_C.CTBHD$ = ADDR(NIL)
      820    15905    3      THEN DO;
      821    15906    3        KH_C.CTBHD$ = CTB$;
      822    15907    3        KH_C.CTBTL$ = CTB$;
      823    15908    3        END;
      824    15909    3      ELSE DO;
      825    15910                                           /*
      826    15911                                             Make this the last queue entry
      827    15912                                                                          */
      828    15913    3        IF CTB$ -> KH$CTBCTX.UTS >= KH_C.CTBTL$ -> KH$CTBCTX.UTS
      829    15914    4        THEN DO;
      830    15915    4          KH_C.CTBTL$ -> KH$CTBCTX.FLNK$ = CTB$;
      831    15916    4          CTB$ -> KH$CTBCTX.BLNK$ = KH_C.CTBTL$;
      832    15917    4          KH_C.CTBTL$ = CTB$;
      833    15918    4          END;
      834    15919    4        ELSE DO;
      835    15920                                           /*
      836    15921                                             Make this the 1st queue entry
      837    15922                                                                          */
      838    15923    4          IF KH_C.CTBHD$ -> KH$CTBCTX.UTS >= CTB$ -> KH$CTBCTX.UTS
      839    15924    5          THEN DO;
      840    15925    5            CTB$ -> KH$CTBCTX.FLNK$ = KH_C.CTBHD$;
      841    15926    5            KH_C.CTBHD$ -> KH$CTBCTX.BLNK$ = CTB$;
      842    15927    5            KH_C.CTBHD$ = CTB$;
      843    15928    5            UTS_VALUE = CTB$ -> KH$CTBCTX.UTS;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:29   
      844    15929    5            IF SUSPENDED
      845    15930    6            THEN DO;
      846    15931    6        UTS_VALUE = UTS_VALUE + G$MHJIT.BOOTUTS;
      847    15932    6              CALL M$WAIT (ADJUST);
      848    15933    6              END;
      849    15934    5            END;
      850    15935    5          ELSE DO;
      851    15936    5            C$ = KH_C.CTBHD$ -> KH$CTBCTX.FLNK$;
      852    15937    6            DO WHILE (C$ ~= ADDR(NIL));
      853    15938    6              IF CTB$ -> KH$CTBCTX.UTS < C$ -> KH$CTBCTX.UTS
      854    15939    7              THEN DO;
      855    15940    7                CTB$ -> KH$CTBCTX.FLNK$ = C$;
      856    15941    7                CTB$ -> KH$CTBCTX.BLNK$ = C$ -> KH$CTBCTX.BLNK$;
      857    15942    7                C$ -> KH$CTBCTX.BLNK$ = CTB$;
      858    15943    7                C$ = CTB$ -> KH$CTBCTX.BLNK$;
      859    15944    7                C$ -> KH$CTBCTX.FLNK$ = CTB$;
      860    15945    7                C$ = ADDR(NIL);
      861    15946    7                END;
      862    15947    7              ELSE DO;
      863    15948    7                C$ = C$ -> KH$CTBCTX.FLNK$;
      864    15949    7                END;
      865    15950
      866    15951    6              END;
      867    15952    5            END;
      868    15953    4          END;
      869    15954    3        END;
      870    15955    2        CTB$ -> KH$CTBCTX.TOKEN = %KH#C_ACTIVE;
      871    15956    2        RETURN;
      872    15957
      873    15958    2   END QUEUE_CTB;
      874    15959        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:30   
      875    15960
      876    15961             /* DEQUEUE CTB  (Enter here disabled) */
      877    15962
      878    15963    1   DEQUEUE_CTB: PROC ALTRET;
      879    15964
      880    15965    2        IF CTB$ = KH_C.CTBHD$
      881    15966    3      THEN DO;
      882    15967    3        KH_C.CTBHD$ = KH_C.CTBHD$ -> KH$CTBCTX.FLNK$;
      883    15968    3          IF KH_C.CTBHD$ ~= ADDR(NIL)
      884    15969    3          THEN
      885    15970    3            KH_C.CTBHD$ -> KH$CTBCTX.BLNK$ = ADDR(NIL);
      886    15971    3          ELSE
      887    15972    3            KH_C.CTBTL$ = ADDR(NIL);
      888    15973    3        END;
      889    15974    3      ELSE DO;
      890    15975    3        IF CTB$ = KH_C.CTBTL$
      891    15976    4        THEN DO;
      892    15977    4          KH_C.CTBTL$ = KH_C.CTBTL$ -> KH$CTBCTX.BLNK$;
      893    15978    4          IF KH_C.CTBTL$ ~= ADDR(NIL)
      894    15979    4          THEN
      895    15980    4            KH_C.CTBTL$ -> KH$CTBCTX.FLNK$ = ADDR(NIL);
      896    15981    4          ELSE
      897    15982    4            KH_C.CTBHD$ = ADDR(NIL);
      898    15983    4          END;
      899    15984    4        ELSE DO;
      900    15985    4        IF CTB$ -> KH$CTBCTX.BLNK$ ~= ADDR(NIL)
      901    15986    4        THEN
      902    15987    4          CTB$ -> KH$CTBCTX.BLNK$ -> KH$CTBCTX.FLNK$
      903    15988    4                 = CTB$ -> KH$CTBCTX.FLNK$;
      904    15989    4        IF CTB$ -> KH$CTBCTX.FLNK$ ~= ADDR(NIL)
      905    15990    4        THEN
      906    15991    4          CTB$ -> KH$CTBCTX.FLNK$ -> KH$CTBCTX.BLNK$
      907    15992    4                 = CTB$ -> KH$CTBCTX.BLNK$;
      908    15993    4          END;
      909    15994    3        END;
      910    15995
      911    15996    2      CTB$ -> KH$CTBCTX.TOKEN = %KH#C_INACTIVE;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:31   
      912    15997    2      RETURN;
      913    15998
      914    15999    2   END DEQUEUE_CTB;
      915    16000        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:32   
      916    16001
      917    16002             /* CHECK_CTB */
      918    16003
      919    16004    1   CHECK_CTB: PROC ALTRET;
      920    16005
      921    16006    2   DCL C$ PTR;
      922    16007
      923    16008    2      C$ = KH_C.CTBHD$;
      924    16009    3      DO WHILE (C$ ~= ADDR(NIL));
      925    16010    3        IF C$ = CTB$
      926    16011    4        THEN DO;
      927    16012    4          IF CTB$ -> KH$CTBCTX.SBR$ = ENTADDR(NIL)
      928    16013    4          OR CTB$ -> KH$CTBCTX.TOKEN = %KH#C_INACTIVE
      929    16014    5          THEN DO;
      930    16015                 /* SNAP */
      931    16016    5            KH_CLK.RESULT = %KH#RES_BADQ;
      932    16017    5            ALTRETURN;
      933    16018    5            END;
      934    16019    5          ELSE DO;
      935    16020    5            RETURN;
      936    16021    5            END;
      937    16022    4          END;
      938    16023    4        ELSE DO;
      939    16024    4          C$ = C$ -> KH$CTBCTX.FLNK$;
      940    16025    4          END;
      941    16026    3        END;
      942    16027
      943    16028           /* SNAP */
      944    16029    2      KH_CLK.RESULT = %KH#RES_NOQ;
      945    16030    2      ALTRETURN;
      946    16031
      947    16032    2   END CHECK_CTB;
      948    16033        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:33   
      949    16034        /*F* NAME: Return_UTS - KCH$UTS KHC$DLTUTS KHC$TIMEn KHC$DLTTIMEn
      950    16035
      951    16036        These services return the UTS (Universal Time Stamp) into
      952    16037        an area specified by the user.
      953    16038        It is not necessary to disable interrupts before calling
      954    16039        these services; the services compensate for any interrupts that occur.
      955    16040
      956    16041        KHC$UTS returns the top 32 bits of the (36-bit) current real time.
      957    16042        The returned value is in units of .133 second.
      958    16043
      959    16044        KHC$DLTUTS calculates the difference between the current UTS and the
      960    16045        value passed as a parameter (the results of a previous call to
      961    16046        KHC$UTS).  The result is stored in the same 2-word area as the
      962    16047        parameter.
      963    16048
      964    16049        KHC$TIME1 returns the low 16 bits of the current real time.
      965    16050        The returned value is in units of 1/120 second.
      966    16051
      967    16052        KHC$TIME2 returns the low 32 bits of the current real time.
      968    16053        The returned value is in units of 1/120 second.
      969    16054
      970    16055        KHC$DLTTIME1 calculates the difference between the current UTS and the
      971    16056        value passed as a parameter (the results of a previous call to
      972    16057        KHC$TIME1).  The result is stored in the same 1-word area as the
      973    16058        parameter.
      974    16059
      975    16060        KHC$DLTTIME2 calculates the difference between the current UTS and the
      976    16061        value passed as a parameter (the results of a previous call to
      977    16062        KHC$TIME2).  The result is stored in the same 1-word area as the
      978    16063        parameter.
      979    16064
      980    16065        The form of the call for these services is
      981    16066
      982    16067            CALL KHC$routine (arg) ALTRET (label);
      983    16068
      984    16069        where:
      985    16070
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:34   
      986    16071        arg - is either a one-word or two-word area as explained above.
      987    16072        */
      988    16073    1   KHC$UTS: ENTRY(KH_ARG) ALTRET;
      989    16074    1      CALL GET_UTS_PARTS;
      990    16075    1      PARM_TIME2 = CURR_UTS+(UTS_TIX+8)/16;
      991    16076    1      RETURN;
      992    16077
      993    16078    1   KHC$DLTUTS: ENTRY(KH_ARG) ALTRET;
      994    16079    1      CALL GET_UTS_PARTS;
      995    16080    1      PARM_TIME2 = CURR_UTS+(UTS_TIX+8)/16-PARM_TIME2;
      996    16081    1      RETURN;
      997    16082
      998    16083    1   KHC$TIME1: ENTRY (KH_ARG) ALTRET;
      999    16084    1      CALL GET_UTS_PARTS;
     1000    16085    1      PARM_TIME1 = CURR_UTSR.TICKS*16 + UTS_TIX;
     1001    16086    1      RETURN;
     1002    16087
     1003    16088    1   KHC$TIME2: ENTRY (KH_ARG) ALTRET;
     1004    16089    1      CALL GET_UTS_PARTS;
     1005    16090    1      PARM_TIME2 = CURR_UTS*16 + UTS_TIX;
     1006    16091    1      RETURN;
     1007    16092
     1008    16093    1   KHC$DLTTIME1: ENTRY (KH_ARG) ALTRET;
     1009    16094    1      CALL GET_UTS_PARTS;
     1010    16095    1      PARM_TIME1 = CURR_UTSR.TICKS*16 + UTS_TIX - PARM_TIME1;
     1011    16096    1      RETURN;
     1012    16097
     1013    16098    1   KHC$DLTTIME2: ENTRY (KH_ARG) ALTRET;
     1014    16099    1      CALL GET_UTS_PARTS;
     1015    16100    1      PARM_TIME2 = CURR_UTS*16 + UTS_TIX - PARM_TIME2;
     1016    16101    1      RETURN;
     1017    16102
     1018    16103        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:35   
     1019    16104        /*I*   NAME: GET_UTS_PARTS.
     1020    16105               PURPOSE: Sets CURR_UTS to the contents of MHJIT.UTS and UTS_TIX
     1021    16106                        to a corresponding sum of MHJIT.TICKS and LOW_MEM.WDTC.
     1022    16107        */
     1023    16108
     1024    16109    1   GET_UTS_PARTS: PROC;
     1025    16110    2   DCL 1 TEMP,
     1026    16111    2      2 TOP UBIN(16),
     1027    16112    2      2 BTM UBIN(16);
     1028    16113    2   DCL DWORD UBIN(32) BASED ALIGNED;
     1029    16114
     1030    16115    2      TEMP = '0'B;
     1031    16116    3      DO WHILE ADDR(TEMP)->DWORD~=PINCRW(ADDR(G$MHJIT.UTS),1)->DWORD;
     1032    16117    3         ADDR(TEMP)->DWORD = PINCRW(ADDR(G$MHJIT.UTS),1)->DWORD;
     1033    16118        /* MHJIT.TICKS is in the word after UTS. Loading TEMP with a LDI instruction
     1034    16119           allows us to check that no interrupts occur while computing UTS_TIX. */
     1035    16120
     1036    16121    3         CURR_UTS = G$MHJIT.UTS;
     1037    16122    3         UTS_TIX = TEMP.BTM + G$MHJIT.WDT_INIT - G$LOW_MEM.WDT_CURR;
     1038    16123    3      END;
     1039    16124    2      RETURN;
     1040    16125    2   END GET_UTS_PARTS;
     1041    16126
     1042    16127        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:36   
     1043    16128        /*F* NAME: Return_Execution Time - KHC$XEQn KHC$DLTXEQn
     1044    16129
     1045    16130        These services return the elapsed execution time for the current user
     1046    16131        without incurring the overhead required for an MCL.  These
     1047    16132        services are useful for statistics gathering.  The value returned is
     1048    16133        expressed in clock-ticks (1/120 second).
     1049    16134        It is not necessary to disable interrupts before calling
     1050    16135        these services; the services compensate for any interrupts that occur.
     1051    16136
     1052    16137        KHC$XEQ1 returns the execution time in a 1-word result area.
     1053    16138
     1054    16139        KHC$XEQ2 returns the execution time in a 2-word result area.
     1055    16140
     1056    16141        KHC$DLTXEQ1 calculates the difference between the execution time and a
     1057    16142        value passed as a parameter (the results of a previous call to
     1058    16143        KHC$XEQ1).  The result is returned in a 1-word area.
     1059    16144
     1060    16145        KHC$DLTXEQ2 calculates the difference between the execution time and a
     1061    16146        value passed as a parameter (the results of a previous call to
     1062    16147        KHC$XEQ2).  The result is returned in a 2-word area.
     1063    16148
     1064    16149        The form of the call for these services is
     1065    16150
     1066    16151
     1067    16152        The form of the call for these services is
     1068    16153
     1069    16154            CALL KHC$routine (arg) ALTRET (label);
     1070    16155
     1071    16156        where:
     1072    16157
     1073    16158        arg - is either a one-word or two-word area as explained above.
     1074    16159        */
     1075    16160
     1076    16161    1   KHC$XEQ1: ENTRY (KH_ARG) ALTRET;
     1077    16162
     1078    16163    1      CALL GET_XEQ_TIME;
     1079    16164    1      PARM_TIME1 = CURR_UTS;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:37   
     1080    16165    1      RETURN;
     1081    16166
     1082    16167    1   KHC$XEQ2: ENTRY (KH_ARG) ALTRET;
     1083    16168    1      CALL GET_XEQ_TIME;
     1084    16169    1      PARM_TIME2 = CURR_UTS;
     1085    16170    1      RETURN;
     1086    16171
     1087    16172    1   KHC$DLTXEQ1: ENTRY (KH_ARG) ALTRET;
     1088    16173    1      CALL GET_XEQ_TIME;
     1089    16174    1      PARM_TIME1 = CURR_UTSR.TICKS - PARM_TIME1;
     1090    16175    1      RETURN;
     1091    16176
     1092    16177    1   KHC$DLTXEQ2: ENTRY (KH_ARG) ALTRET;
     1093    16178    1      CALL GET_XEQ_TIME;
     1094    16179    1      PARM_TIME2 = CURR_UTS-PARM_TIME2;
     1095    16180    1      RETURN;
     1096    16181
     1097    16182        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:38   
     1098    16183        /*I*   NAME: GET_XEQ_TIME.
     1099    16184               PURPOSE: Computes current user xeq time into CURR_UTS.
     1100    16185        */
     1101    16186
     1102    16187    1   GET_XEQ_TIME: PROC;
     1103    16188
     1104    16189    2   DCL TUEXT UBIN;
     1105    16190    2   DCL IDELT UBIN;
     1106    16191    2   DCL UWORD UBIN BASED ALIGNED;
     1107    16192
     1108    16193    3      DO UNTIL IDELT=G$JIT.IDELTAT;
     1109    16194    3         IDELT = G$JIT.IDELTAT;
     1110    16195    3         TUEXT = PINCRW(ADDR(G$JIT.TUEXT),1)->UWORD;
     1111    16196    3         CURR_UTS = G$MHJIT.WDT_INIT-G$LOW_MEM.WDT_CURR+
     1112    16197    3           G$JIT.TUEXT+G$JIT.TUSVT+G$JIT.XTIME+G$JIT.STIME;
     1113    16198    3   TRASH_THE_REGS:; /* So that the next test isn't a NOP */
     1114    16199    3         IF TUEXT~=PINCRW(ADDR(G$JIT.TUEXT),1)->UWORD THEN IDELT=0;
     1115    16200    3         END;
     1116    16201    2      RETURN;
     1117    16202
     1118    16203    2   GET_XEQ_DUMMY_ENTRY: ENTRY;
     1119    16204        /* Dummy entry to make TRASH_THE_REGS do that */
     1120    16205    2      GOTO TRASH_THE_REGS;
     1121    16206
     1122    16207    2   END GET_XEQ_TIME;
     1123    16208    1   END KHC$CLOCK;
     1124    16209
     1125    16210

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:39   
--  Include file information  --

   KV$BPC.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   G_HJIT_M.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   GH_HARDWARE_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KHC$CLOCK.

   Procedure KHC$CLOCK requires 2100 words for executable code.
   Procedure KHC$CLOCK requires 30 words of local(AUTO) storage.

    No errors detected in file KHC$CLOCK.:E05TSI    .

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:40   

 Object Unit name= KHC$CLOCK                                  File name= KHC$CLOCK.:E05TOU
 UTS= JUL 30 '97 00:28:08.40 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Data  even  none    16     10  KHC$CLOCK
    1  RoData even  UTS     20     14  KHC$CLOCK
    2   Proc  even  none  2100    834  KHC$CLOCK
    3  RoData even  none     4      4  KHC$CLOCK

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  KHC$CLOCK
     2    391          yes     yes      Std        0  KHC$WAIT
     2    42D          yes     yes      Std        1  KHC$DISPATCH
     2    700          yes     yes      Std        1  KHC$UTS
     2    716          yes     yes      Std        1  KHC$DLTUTS
     2    72D          yes     yes      Std        1  KHC$TIME1
     2    740          yes     yes      Std        1  KHC$TIME2
     2    758          yes     yes      Std        1  KHC$DLTTIME1
     2    76C          yes     yes      Std        1  KHC$DLTTIME2
     2    7B6          yes     yes      Std        1  KHC$XEQ1
     2    7C6          yes     yes      Std        1  KHC$XEQ2
     2    7D6          yes     yes      Std        1  KHC$DLTXEQ1
     2    7E7          yes     yes      Std        1  KHC$DLTXEQ2

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0      A  KH_C
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:41   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 KHI$DISABLE
 yes     yes           Std       2 KVB$GETSYS
         yes           Std       0 KHI$ENABLE
 yes     yes           Std       2 KVB$RLSSYS
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_AALT
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     G$JIT$                                KV_B_POOL$                            G$MHJIT$
     G$LOW_MEM$                            KH_CTLTBL$                            KH_INHLVL
r    G$ROS$
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:42   


        1        1        /*M* KHC$CLOCK contains VDH library clock services. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /**/
        8        8        /*F* NAME: Clock_Services
        9        9
       10       10        The clock services provided by the library routines
       11       11        include:
       12       12
       13       13        o Setting, resetting, restarting, and cancelling clocks.
       14       14
       15       15        o Returning the Universal Time Stamp.
       16       16
       17       17        o Returning user execution time.
       18       18        */
       19       19
       20       20        /*D*  CALL:       CALL KHC$CLOCK ( KH$CLK ) ALTRET ( altret_label );
       21       21             PARAMETERS:  KH$CLK contains:
       22       22                           1. function to be performed (see KH_CLKFNC_E)
       23       23                           2. clock timer block context pointer.  This is
       24       24                              a valid pointer if the user allocates it, and
       25       25                              addr(nil) if it's to be allocated by this
       26       26                              module.
       27       27                           3. User supplied pointer to be returned upon
       28       28                              clock expiration (only needed on set clock
       29       29                              operations).
       30       30                           4. User supplied value to be returned upon
       31       31                              clock expiration (only needed on set clock
       32       32                              operations).
       33       33                           5. Flag indicating the origin of the call
       34       34                              (i.e. VDH or a user).  Default is a user.
       35       35                           6. Flag informing clock services whether or not
       36       36                              user keeps CTB pointer.
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:43   
       37       37                           7. Modification of perm status (used only on
       38       38                              reset functions).
       39       39                           8. Discrepancy factor indicating how accurate the
       40       40                              clock need be.
       41       41                           9. Entry address where user is to be entered upon
       42       42                              expiration.
       43       43                          10. Type of period to wait (e.g. min, sec, tmil).
       44       44                          11. Period to wait.
       45       45             ENVIRONMENT: Called by a user or VDH.  This routine immediately
       46       46                          jumps to the user inhibit level.  It only drops
       47       47                          to the user base level while expiring a clock.
       48       48                          Note theat this module houses the main wait routine
       49       49                          for VDH.
       50       50             INPUT:       KH$CLK (see KH$CLK module).
       51       51             OUTPUT:      KH$EXP (see KH$CLK module).
       52       52        */
       53       53
       54       54        /*F* NAME: KHC$CLOCK - Clock Services; Set, Reset & Cancel
       55       55
       56       56        Functions provided by this service are as follows:
       57       57
       58       58        o  Set a one-time clock request.
       59       59
       60       60        o  Set a periodic clock request for a
       61       61        specified interval.
       62       62
       63       63        o  Cancel a clock request.
       64       64
       65       65        o  Reset an existing clock request to
       66       66        expire at a different time, return to a different
       67       67        expiration entry address, or return a different
       68       68        expiration value.
       69       69
       70       70        o  Restart the clock.
       71       71
       72       72        The KHC$CLOCK service obtains parameters from the
       73       73        structure KH$CLK and returns results in the
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:44   
       74       74        structure KH$EXP.
       75       75
       76       76        The form of the call for this service is:
       77       77
       78       78           CALL KHC$CLOCK (kh$clk) ALTRET (label);
       79       79
       80       80        where:
       81       81        */
       82       82
       83       83        /*K* kh$clk
       84       84        is the KH$CLK structure that contains the parameters
       85       85        for this call to KHC$CLOCK.  Please refer to the description
       86       86        of KH$CLK below for details.
       87       87        */
       88       88        KHC$CLOCK: PROC (KH_ARG) ALTRET;

     88   2 000000  D380 0000 0000  xent KHC$CLOCK       LNJ,B5   X6A_AUTO_1
          2 000003       001E 0001                       DC       30,1

       89       89
       90       90        %INCLUDE LCP_6;
       91     4369        %INCLUDE GH_HARDWARE_M;
       92     4467        %INCLUDE G_JIT_M;
       93     4732        %INCLUDE G_HJIT_M;
       94     4877        %INCLUDE KH$CLK;
       95     5247        %INCLUDE KL_CONTROL_C;
       96     5627        %INCLUDE KHC_MAC_C;
       97     5668        %INCLUDE KH_MACRO_C;
       98     6411        %INCLUDE KH_CLKFNC_E;
       99     6456        %INCLUDE KV$BPC;
      100     6485
      101     6486    1   DCL G$JIT$ PTR SYMREF;
      102     6487    1   DCL KV_B_POOL$ PTR SYMREF;
      103     6488
      104     6489           %INHIBIT_DCLS;
      105     6501
      106     6502           %KV$BPC (STCLASS="BASED(KV_B_POOL$)");
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:45   
      107     6524
      108     6525           %G$JIT (STCLASS="BASED(G$JIT$)");
      109     6939
      110     6940           %G$LOW_MEM (STCLASS="BASED(G$LOW_MEM$)");
      111     6989
      112     6990           %G$MHJIT (STCLASS="BASED(G$MHJIT$)");
      113    13864
      114    13865    1   DCL KH_ARG CHAR(UTS_TIX) PARAM;
      115    13866
      116    13867    1   DCL PARM_TIME2 REDEF KH_ARG UBIN(32);
      117    13868
      118    13869    1   DCL PARM_TIME1 REDEF KH_ARG UBIN;
      119    13870
      120    13871           %KH$CLK (FPTN=KH_CLK,
      121    13872                    FNC=%KH#CLK_SETCLK,
      122    13873                    STCLASS=REDEF KH_ARG);
      123    14022
      124    14023           %KH$CLK (FPTN=KH_SETCLK,
      125    14024                    FNC=%KH#CLK_SETCLK,
      126    14025                    STCLASS=REDEF KH_ARG);
      127    14174
      128    14175           %KH$CLK (FPTN=KH_CANCELCLK,
      129    14176                    FNC=%KH#CLK_CANCEL,
      130    14177                    STCLASS=REDEF KH_ARG);
      131    14326
      132    14327           %KH$CLK (FPTN=KH_RESETCLK,
      133    14328                    FNC=%KH#CLK_RESET,
      134    14329                    STCLASS=REDEF KH_ARG);
      135    14478
      136    14479           %KH$CLK (FPTN=KH_RESTARTCLK,
      137    14480                    FNC=%KH#CLK_RESTART,
      138    14481                    STCLASS=REDEF KH_ARG);
      139    14630
      140    14631           %KH$EXP   (FPTN=FPT_VDH,
      141    14632                      STCLASS=REDEF KH_ARG);
      142    14695
      143    14696           %KH$CTBCTX;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:46   
      144    14769
      145    14770           %KH$EXP (FPTN=FPT_USER,
      146    14771                    STCLASS=STATIC);
      147    14834
      148    14835           %KH$CTLTBL (FPTN=KH$CTLTBL,
      149    14836                       STCLASS="BASED(KH_CTLTBL$)");
      150    15048
      151    15049           %FPT_WAIT (FPTN=SUSPEND,
      152    15050                       STCLASS=CONSTANT,
      153    15051                      UTYPE=UTS,
      154    15052                      UETIME=UETIME,
      155    15053                      UNITS=UTS_VALUE,
      156    15054                      MODE=SUSP);
      157    15078
      158    15079           %FPT_WAIT (FPTN=ADJUST,
      159    15080                       STCLASS=CONSTANT,
      160    15081                      UTYPE=UTS,
      161    15082                      UNITS=UTS_VALUE,
      162    15083                      MODE=ADJUST);
      163    15107
      164    15108        %EQU YES#='1'B;
      165    15109        %EQU  NO#='0'B;
      166    15110    1   DCL G$MHJIT$ PTR SYMREF;
      167    15111    1   DCL G$LOW_MEM$ PTR SYMREF;
      168    15112    1   DCL KH_CTLTBL$ PTR SYMREF;
      169    15113    1   DCL KH_INHLVL UBIN SYMREF;
      170    15114    1   DCL USER@ EPTR;
      171    15115    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
      172    15116    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
      173    15117    1   DCL CTB$ PTR;
      174    15118    1   DCL PRD UBIN(32);
      175    15119    1   DCL PRD1 UBIN(32);
      176    15120    1   DCL DWORD UBIN(32) BASED;
      177    15121    1   DCL ACCURACY UBIN WORD;
      178    15122    1   DCL INHWORD UBIN WORD BASED;
      179    15123    1   DCL UTS_TIX UBIN WORD;
      180    15124    1   DCL UETIME UBIN WORD STATIC INIT(0);
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:47   
      181    15125    1   DCL UTS_VALUE UBIN(32) STATIC;
      182    15126    1   DCL SUSPENDED BIT(1) STATIC ALIGNED INIT ('0'B);
      183    15127
      184    15128    1   DCL CURR_UTS UBIN(32) ALIGNED;
      185    15129    1   DCL 1 CURR_UTSR REDEF CURR_UTS,
      186    15130    1         2 DATE UBIN(16),
      187    15131    1         2 TICKS UBIN(16);
      188    15132
      189    15133    1   DCL 1 KH_C STATIC SYMDEF,
      190    15134    1         2 CTBHD$ PTR,
      191    15135    1         2 CTBTL$ PTR,
      192    15136    1         2 DISPATCH$ PTR;
      193    15137
      194    15138    1       INHIBIT_LEVEL = KH_INHLVL;

  15138   2 000005  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 000008  EF47 0006                            STR,R6   INHIBIT_LEVEL,AUTO

      195    15139    1      CTB$ = KH_CLK.CTBCTX$;

  15139   2 00000A  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 00000C  DC86                                 LDB,B5   ,B6
          2 00000D  DFC7 000A                            STB,B5   CTB$,AUTO

      196    15140    1      KH_CLK.RESULT = %KH#RES_OK;

  15140   2 00000F  87C6 0005                            CLH      5,B6

      197    15141    1      KV$BPC.CLKC = KV$BPC.CLKC + 1;

  15141   2 000011  CC80 0000 0000  xsym                 LDB,B4   KV_B_POOL$
          2 000014  8AC4 0019                            INC      25,B4
          2 000016  8EC4 0018                            CAD      24,B4

      198    15142
      199    15143    2      DO CASE (KH_CLK.FNC);

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:48   
  15143   2 000018  B846 0005                            LDR,R3   5,B6
          2 00001A  B570 00FF                            AND,R3   255,IMO
          2 00001C  3D08                                 CMV,R3   8
          2 00001D  0281 0370                            BGE      s:15556,PREL
          2 00001F  A830 0000 0025  02                   LDR,R2   s:15143+13,R3
          2 000022  83A0 0000 002D  02                   JMP      s:15151,R2
          2 000025       0361                            DC       s:15556,PREL
          2 000026       0000                            DC       s:15151,PREL
          2 000027       0000                            DC       s:15151,PREL
          2 000028       011A                            DC       s:15269,PREL
          2 000029       01B0                            DC       s:15346,PREL
          2 00002A       0361                            DC       s:15556,PREL
          2 00002B       0361                            DC       s:15556,PREL
          2 00002C       02D6                            DC       s:15480,PREL

      200    15144
      201    15145    2      CASE (%KH#CLK_SETCLK, %KH#CLK_SETCLKPERM);

      202    15146
      203    15147                                           /*
      204    15148                                              Validate clock service request
      205    15149                                                                            */
      206    15150
      207    15151    2        IF KH_SETCLK.PRDUNT > %KH#C_MIN

  15151   2 00002D  D846 0006                            LDR,R5   6,B6
          2 00002F  D570 00FF                            AND,R5   255,IMO
          2 000031  5D02                                 CMV,R5   2
          2 000032  0301 0010                            BG       s:15156,PREL
          2 000034  C846 000A                            LDR,R4   10,B6
          2 000036  4901 000C                            BEZ,R4   s:15156,PREL
          2 000038  BCC6 0008                            LDB,B3   8,B6
          2 00003A  BD80 0000 0000  03                   CMB,B3   0
          2 00003D  0981 000B                            BNE      s:15168,PREL
          2 00003F  89C6 0006                            CMZ      6,B6
          2 000041  0801 0007                            BAL      s:15168,PREL

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:49   
      208    15152    2        OR KH_SETCLK.PRD = 0
      209    15153    2           OR (KH_SETCLK.SBR$ = ENTADDR(NIL)
      210    15154    2            AND KH_SETCLK.VDH_CLK = %NO#)
      211    15155    3        THEN DO;

      212    15156    3          KH_SETCLK.RESULT = %KH#RES_INVREQ;

  15156   2 000043  4C06                                 LDV,R4   6
          2 000044  C7C6 0005                            STH,R4   5,B6

      213    15157    3          ALTRETURN;

  15157   2 000046  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      214    15158    3          END;
      215    15159
      216    15160                                           /*
      217    15161                                              If the user has not pre-allocated
      218    15162                                              the clock timer block, we must
      219    15163                                              get one.  Get it, zero it out,
      220    15164                                              and remember it's dynamic so we
      221    15165                                              can release it (later).
      222    15166                                                                           */
      223    15167             %DISABLE;

  15168   2 000049  EF47 0007                            STR,R6   DISABLE_LEVEL,AUTO

  15169   2 00004B  ABC7 0007                            LAB,B2   DISABLE_LEVEL,AUTO
          2 00004D  AFC7 001A                            STB,B2   C$+2,AUTO
          2 00004F  BBC7 001A                            LAB,B3   C$+2,AUTO
          2 000051  CBF0 0100                            LAB,B4   256,IMO
          2 000053  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000056       0001                            DC       s:15171,PREL

      224    15171    2        IF KH_SETCLK.CTBCTX$ = ADDR(NIL)

  15171   2 000057  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:50   
          2 000059  8D86                                 CMN      ,B6
          2 00005A  0981 003C                            BNE      s:15192,PREL

      225    15172    3        THEN DO;

      226    15173    3          CALL KVB$GETSYS (SIZEW(KH$CTBCTX), KH_SETCLK.CTBCTX$)

  15173   2 00005C  DBF0 000E                            LAB,B5   14,IMO
          2 00005E  EFC7 001C                            STB,B6   C$+4,AUTO
          2 000060  DFC7 001A                            STB,B5   C$+2,AUTO
          2 000062  BBC7 001A                            LAB,B3   C$+2,AUTO
          2 000064  CBF0 0200                            LAB,B4   512,IMO
          2 000066  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000069       0003                            DC       s:15175,PREL
          2 00006A  0F81 0015                            B        s:15184,PREL

      227    15174    4          WHENALTRETURN DO;

      228    15175    4            KH_SETCLK.RESULT = %KH#RES_NOCTB;

  15175   2 00006C  6C01                                 LDV,R6   1
          2 00006D  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 00006F  E7C6 0005                            STH,R6   5,B6

      229    15176                 %ENABLE;

  15177   2 000071  D847 0007                            LDR,R5   DISABLE_LEVEL,AUTO
          2 000073  D947 0006                            CMR,R5   INHIBIT_LEVEL,AUTO
          2 000075  0901 0007                            BE       s:15182,PREL

  15179   2 000077  CBF0 0000                            LAB,B4   0,IMO
          2 000079  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00007C       0001                            DC       s:15182,PREL

      230    15182    4            ALTRETURN;

  15182   2 00007D  C380 0000 0000  xent                 LNJ,B4   X6A_AALT
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:51   

      231    15183    4            END;
      232    15184    3          KV$BPC.CLKCTX = KV$BPC.CLKCTX + 1;

  15184   2 000080  EC80 0000 0000  xsym                 LDB,B6   KV_B_POOL$
          2 000083  8AC6 0017                            INC      23,B6
          2 000085  8EC6 0016                            CAD      22,B6

      233    15185    3          KH_SETCLK.CTBCTX$ -> KH$CTBCTX = '0'B;

  15185   2 000087  DCC7 0004                            LDB,B5   @KH_ARG,AUTO
          2 000089  CC85                                 LDB,B4   ,B5
          2 00008A  5C1C                                 LDV,R5   28
          2 00008B  0021                                 ALR      ;
          2 00008C       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 00008E       4004 0000                                ALPHANUM(0,B4,,R5,FILL)

      234    15186    3          KH_SETCLK.CTBCTX$ -> KH$CTBCTX.DYNAMIC = '1'B;

  15186   2 000090  437F                                 CSYNC    s:15185+8,SPREL
          2 000091  EC85                                 LDB,B6   ,B5
          2 000092  8946 000C                            LBT,'0040'X       12,B6
          2 000094       0040

      235    15187    3          END;

  15187   2 000095  0F81 0008                            B        s:15195,PREL

      236    15188    3        ELSE DO;

      237    15189                                           /*
      238    15190                                              User supplied a CTB - zero it.
      239    15191                                                                          */
      240    15192    3          KH_SETCLK.CTBCTX$ -> KH$CTBCTX = '0'B;

  15192   2 000097  DC86                                 LDB,B5   ,B6
          2 000098  5C1C                                 LDV,R5   28
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:52   
          2 000099  0021                                 ALR      ;
          2 00009A       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 00009C       4005 0000                                ALPHANUM(0,B5,,R5,FILL)

      241    15193    3          END;

      242    15194
      243    15195    2        CTB$ = KH_SETCLK.CTBCTX$;

  15195   2 00009E  437F                                 CSYNC    s:15192+6,SPREL
          2 00009F  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0000A1  DC86                                 LDB,B5   ,B6
          2 0000A2  DFC7 000A                            STB,B5   CTB$,AUTO

      244    15196
      245    15197           /*
      246    15198           FEP UTS is in units of 2/15 seconds, which means the UTS gets
      247    15199           bumped 7.5 times every second.  Since PL6 doesn't handle decimal
      248    15200           points, we must represent this as: 1/(2/15) or 15/2.  In
      249    15201           order to retain as many decimal places as possible, multiply first.
      250    15202                                                                          */
      251    15203    2        PRD = KH_SETCLK.PRD;

  15203   2 0000A4  F846 000A                            LDR,R7   10,B6
          2 0000A6  6C00                                 LDV,R6   0
          2 0000A7  8D47 000C                            SDI      PRD,AUTO

      252    15204    3        DO CASE (KH_SETCLK.PRDUNT);

  15204   2 0000A9  B846 0006                            LDR,R3   6,B6
          2 0000AB  B570 00FF                            AND,R3   255,IMO
          2 0000AD  3D03                                 CMV,R3   3
          2 0000AE  0281 004F                            BGE      s:15241,PREL
          2 0000B0  A830 0000 00B6  02                   LDR,R2   s:15204+13,R3
          2 0000B3  83A0 0000 00B9  02                   JMP      s:15207,R2
          2 0000B6       002A                            DC       s:15220,PREL
          2 0000B7       0000                            DC       s:15207,PREL
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:53   
          2 0000B8       0012                            DC       s:15213,PREL

      253    15205
      254    15206    3          CASE (%KH#C_SEC);

      255    15207    3            PRD1 = PRD * 16;

  15207   2 0000B9  7084                                 DOL,R7   4
          2 0000BA  8D47 000E                            SDI      PRD1,AUTO

      256    15208    3            PRD = PRD1 - PRD;

  15208   2 0000BC  84C7 000C                            SID      PRD,AUTO
          2 0000BE  8D47 000C                            SDI      PRD,AUTO

      257    15209    3            CTB$ -> KH$CTBCTX.PRD = PRD / 2;

  15209   2 0000C0  70C1                                 DOR,R7   1
          2 0000C1  8D45 0006                            SDI      6,B5

      258    15210    3            CTB$ -> KH$CTBCTX.ACCURACY = (KH_SETCLK.ACCURACY * 15) / 2;

  15210   2 0000C3  C2C6 0007                            LLH,R4   7,B6
          2 0000C5  4F0F                                 MLV,R4   15
          2 0000C6  4041                                 SOR,R4   1
          2 0000C7  C7C5 000C                            STH,R4   12,B5
          2 0000C9  0F81 0034                            B        s:15241,PREL

      259    15211
      260    15212    3          CASE (%KH#C_MIN);

      261    15213    3            PRD1 = PRD * 16;

  15213   2 0000CB  7084                                 DOL,R7   4
          2 0000CC  8D47 000E                            SDI      PRD1,AUTO

      262    15214    3            PRD = PRD1 - PRD;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:54   

  15214   2 0000CE  84C7 000C                            SID      PRD,AUTO
          2 0000D0  8D47 000C                            SDI      PRD,AUTO

      263    15215    3            PRD1 = PRD * 32;

  15215   2 0000D2  7085                                 DOL,R7   5
          2 0000D3  8D47 000E                            SDI      PRD1,AUTO

      264    15216    3            CTB$ -> KH$CTBCTX.PRD = PRD1 - PRD - PRD;

  15216   2 0000D5  84C7 000C                            SID      PRD,AUTO
          2 0000D7  84C7 000C                            SID      PRD,AUTO
          2 0000D9  8D45 0006                            SDI      6,B5

      265    15217    3            CTB$ -> KH$CTBCTX.ACCURACY = KH_SETCLK.ACCURACY * 30 * 15;

  15217   2 0000DB  C2C6 0007                            LLH,R4   7,B6
          2 0000DD  CB70 01C2                            MUL,R4   450,IMO
          2 0000DF  C7C5 000C                            STH,R4   12,B5
          2 0000E1  0F81 001C                            B        s:15241,PREL

      266    15218
      267    15219    3          CASE (%KH#C_TMIL);

      268    15220    3            PRD = KH_SETCLK.PRD / 40;

  15220   2 0000E3  F846 000A                            LDR,R7   10,B6
          2 0000E5  6C00                                 LDV,R6   0
          2 0000E6  F370 0028                            DIV,R7   40,IMO
          2 0000E8  E857                                 LDR,R6   R7
          2 0000E9  70F0                                 DAR,R7   16
          2 0000EA  8D47 000C                            SDI      PRD,AUTO

      269    15221    3            CTB$ -> KH$CTBCTX.PRD = KH_SETCLK.PRD / 10 - PRD ;

  15221   2 0000EC  F846 000A                            LDR,R7   10,B6
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:55   
          2 0000EE  6C00                                 LDV,R6   0
          2 0000EF  F370 000A                            DIV,R7   10,IMO
          2 0000F1  E857                                 LDR,R6   R7
          2 0000F2  70F0                                 DAR,R7   16
          2 0000F3  84C7 000C                            SID      PRD,AUTO
          2 0000F5  8D45 0006                            SDI      6,B5

      270    15222    3            CTB$ -> KH$CTBCTX.ACCURACY = (KH_SETCLK.ACCURACY * 3) / 40;

  15222   2 0000F7  C2C6 0007                            LLH,R4   7,B6
          2 0000F9  4F03                                 MLV,R4   3
          2 0000FA  C370 0028                            DIV,R4   40,IMO
          2 0000FC  C7C5 000C                            STH,R4   12,B5

      271    15223
      272    15224    3          END;

      273    15225
      274    15226                                           /*
      275    15227                                              Disable before we aquire the
      276    15228                                              current time.  This will prevent
      277    15229                                              us from being interrupted
      278    15230                                              before we assign the UTS.
      279    15231                                                                          */
      280    15232                                           /*
      281    15233                                              Get the current UTS and assign
      282    15234                                              the wake-up UTS in the clock
      283    15235                                              timer block.
      284    15236                                                                          */
      285    15237           /*
      286    15238           Get the current 32 bit UTS.  The bottom four bits of the 36-bit UTS
      287    15239           (in L6 clock tick units, i.e., 120th of a second) are ignored.
      288    15240                                                                          */
      289    15241    2        CALL GET_UTS_PARTS;

  15241   2 0000FE  E3C0 0686                            LNJ,B6   s:0,PREL
          2 000100       0001                            DC       s:15242,PREL
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:56   

      290    15242    2        CURR_UTS = CURR_UTS + (UTS_TIX + 8) / 16;

  15242   2 000101  E847 0011                            LDR,R6   UTS_TIX,AUTO
          2 000103  6E08                                 ADV,R6   8
          2 000104  6044                                 SOR,R6   4
          2 000105  F856                                 LDR,R7   R6
          2 000106  6C00                                 LDV,R6   0
          2 000107  8447 0012                            AID      CURR_UTS,AUTO
          2 000109  8D47 0012                            SDI      CURR_UTS,AUTO

      291    15243    2        CTB$ -> KH$CTBCTX.UTS = CURR_UTS + CTB$ -> KH$CTBCTX.PRD;

  15243   2 00010B  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 00010D  8446 0006                            AID      6,B6
          2 00010F  8D46 0004                            SDI      4,B6

      292    15244    2        CTB$ -> KH$CTBCTX.SBR$ = KH_SETCLK.SBR$;

  15244   2 000111  DCC7 0004                            LDB,B5   @KH_ARG,AUTO
          2 000113  CCC5 0008                            LDB,B4   8,B5
          2 000115  CFC6 0008                            STB,B4   8,B6

      293    15245    2        CTB$ -> KH$CTBCTX.UID = KH_SETCLK.UID;

  15245   2 000117  8CC5 0002                            LDI      2,B5
          2 000119  8D46 000A                            SDI      10,B6

      294    15246    2          CTB$ -> KH$CTBCTX.UVAL = KH_SETCLK.UVAL;

  15246   2 00011B  D845 0004                            LDR,R5   4,B5
          2 00011D  DF46 000D                            STR,R5   13,B6

      295    15247    2        CTB$ -> KH$CTBCTX.VDH_CLK = KH_SETCLK.VDH_CLK;

  15247   2 00011F  C845 0006                            LDR,R4   6,B5
          2 000121  4048                                 SOR,R4   8
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:57   
          2 000122  CAC6 000C                            SRM,R4,'0080'X    12,B6
          2 000124       0080

      296    15248    2        CTB$ -> KH$CTBCTX.EXPINH = KH_SETCLK.EXPINH;

  15248   2 000125  C845 0006                            LDR,R4   6,B5
          2 000127  4048                                 SOR,R4   8
          2 000128  CAC6 000C                            SRM,R4,'0008'X    12,B6
          2 00012A       0008

      297    15249    2        IF KH_SETCLK.FNC = %KH#CLK_SETCLKPERM

  15249   2 00012B  C845 0005                            LDR,R4   5,B5
          2 00012D  C570 00FF                            AND,R4   255,IMO
          2 00012F  4D02                                 CMV,R4   2
          2 000130  0981 0004                            BNE      s:15253,PREL

      298    15250    3        THEN DO;

      299    15251    3          CTB$ -> KH$CTBCTX.PERM = %YES#;

  15251   2 000132  8946 000C                            LBT,'0010'X       12,B6
  15251   2 000134       0010

      300    15252    3          END;

      301    15253    2        CALL QUEUE_CTB;

  15253   2 000135  E3C0 04AA                            LNJ,B6   s:0,PREL
          2 000137       0001                            DC       s:15255,PREL

      302    15254             %ENABLE;

  15255   2 000138  E847 0007                            LDR,R6   DISABLE_LEVEL,AUTO
          2 00013A  E947 0006                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 00013C  0901 0007                            BE       s:15260,PREL

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:58   
  15257   2 00013E  CBF0 0000                            LAB,B4   0,IMO
          2 000140  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000143       0001                            DC       s:15260,PREL

      303    15260    2        RETURN;

  15260   2 000144  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      304    15261
      305    15262        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:59   
      306    15263
      307    15264        /* Remove the specified clock timer block from the clock chain. */
      308    15265
      309    15266    2      CASE (%KH#CLK_CANCEL);

      310    15267
      311    15268             %DISABLE;

  15269   2 000147  EF47 0007                            STR,R6   DISABLE_LEVEL,AUTO

  15270   2 000149  BBC7 0007                            LAB,B3   DISABLE_LEVEL,AUTO
          2 00014B  BFC7 001A                            STB,B3   C$+2,AUTO
          2 00014D  BBC7 001A                            LAB,B3   C$+2,AUTO
          2 00014F  CBF0 0100                            LAB,B4   256,IMO
          2 000151  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000154       0001                            DC       s:15273,PREL

      312    15272
      313    15273    2        IF KH_CANCELCLK.NO_CTB = %YES#

  15273   2 000155  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000157  82C6 0006                            LB,'4000'X        6,B6
          2 000159       4000
          2 00015A  0581 0023                            BBF      s:15293,PREL

      314    15274    3        THEN DO;

      315    15275    3          CALL FIND_UID_UVAL

  15275   2 00015C  E3C0 0458                            LNJ,B6   s:0,PREL
          2 00015E       0017                            DC       s:15288,PREL

      316    15276    4          WHENRETURN DO;

      317    15277    4            IF CTB$ ~= KH_C.DISPATCH$

  15277   2 00015F  ECC7 000A                            LDB,B6   CTB$,AUTO
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:60   
          2 000161  ED80 0000 000E  00                   CMB,B6   KH_C+4
          2 000164  0901 0003                            BE       s:15282,PREL

      318    15278    5            THEN DO;

      319    15279    5              ;
      320    15280    5              END;

  15280   2 000166  0F81 000C                            B        s:15284+2,PREL

      321    15281    5            ELSE DO;

      322    15282    5              FPT_USER.ABORT = '1'B;

  15282   2 000168  8900 0000 0005  00                   LBT,'4000'X       FPT_USER+5
  15282   2 00016B       4000

      323    15283    5              KH_CANCELCLK.RESULT = %KH#RES_EXPIRING;

  15283   2 00016C  6C07                                 LDV,R6   7
          2 00016D  DCC7 0004                            LDB,B5   @KH_ARG,AUTO
          2 00016F  E7C5 0005                            STH,R6   5,B5

      324    15284    5              GOTO CANCEL_EXIT;

  15284   2 000171  0F81 0053                            B        s:15322,PREL
          2 000173  0F81 0008                            B        s:15291,PREL

      325    15285    5              END;
      326    15286    4            END;
      327    15287    4          WHENALTRETURN DO;

      328    15288    4            KH_CANCELCLK.RESULT = %KH#RES_NOQ;

  15288   2 000175  6C03                                 LDV,R6   3
          2 000176  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000178  E7C6 0005                            STH,R6   5,B6
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:61   

      329    15289    4            GOTO CANCEL_EXIT;

  15289   2 00017A  0F81 004A                            B        s:15322,PREL

      330    15290    4            END;
      331    15291    3          END;

  15291   2 00017C  0F81 001F                            B        s:15309,PREL

      332    15292    3        ELSE DO;

      333    15293    3          IF CTB$ ~= KH_C.DISPATCH$

  15293   2 00017E  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 000180  DD80 0000 000E  00                   CMB,B5   KH_C+4
          2 000183  0901 000F                            BE       s:15302,PREL

      334    15294    4          THEN DO;

      335    15295    4            CALL FIND_CTB$

  15295   2 000185  E3C0 0412                            LNJ,B6   s:0,PREL
          2 000187       0003                            DC       s:15297,PREL
          2 000188  0F81 0008                            B        s:15300,PREL

      336    15296    5            WHENALTRETURN DO;

      337    15297    5              KH_CANCELCLK.RESULT = %KH#RES_NOQ;

  15297   2 00018A  6C03                                 LDV,R6   3
          2 00018B  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 00018D  E7C6 0005                            STH,R6   5,B6

      338    15298    5              GOTO CANCEL_EXIT;

  15298   2 00018F  0F81 0035                            B        s:15322,PREL
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:62   

      339    15299    5              END;
      340    15300    4            END;

  15300   2 000191  0F81 000A                            B        s:15309,PREL

      341    15301    4          ELSE DO;

      342    15302    4            FPT_USER.ABORT = '1'B;

  15302   2 000193  8900 0000 0005  00                   LBT,'4000'X       FPT_USER+5
  15302   2 000196       4000

      343    15303    4            KH_CANCELCLK.RESULT = %KH#RES_EXPIRING;

  15303   2 000197  6C07                                 LDV,R6   7
          2 000198  E7C6 0005                            STH,R6   5,B6

      344    15304    4            GOTO CANCEL_EXIT;

  15304   2 00019A  0F81 002A                            B        s:15322,PREL

      345    15305    4            END;
      346    15306    3          END;
      347    15307                                           /*
      348    15308                                                                          */
      349    15309    2          CALL DEQUEUE_CTB;

  15309   2 00019C  E3C0 04CF                            LNJ,B6   s:0,PREL
          2 00019E       0001                            DC       s:15311,PREL

      350    15310
      351    15311    2          IF CTB$ -> KH$CTBCTX.DYNAMIC

  15311   2 00019F  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 0001A1  82C6 000C                            LB,'0040'X        12,B6
          2 0001A3       0040
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:63   
          2 0001A4  0581 0020                            BBF      s:15322,PREL

      352    15312    3          THEN DO;

      353    15313    3            CTB$ -> INHWORD = SIZEW(KH$CTBCTX);

  15313   2 0001A6  6C0E                                 LDV,R6   14
          2 0001A7  EF06                                 STR,R6   ,B6

      354    15314    3            CALL KVB$RLSSYS (CTB$ -> INHWORD)

  15314   2 0001A8  BBC7 000A                            LAB,B3   CTB$,AUTO
          2 0001AA  CBF0 0100                            LAB,B4   256,IMO
          2 0001AC  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 0001AF       0011                            DC       s:15320,PREL

      355    15315    4            WHENRETURN DO;

      356    15316    4              KV$BPC.CLKCTX = KV$BPC.CLKCTX - 1;

  15316   2 0001B0  EC80 0000 0000  xsym                 LDB,B6   KV_B_POOL$
          2 0001B3  8CC6 0016                            LDI      22,B6
          2 0001B5  8470 FFFF FFFF                       AID      -1,IMO
          2 0001B8  8D46 0016                            SDI      22,B6

      357    15317    4              KH_CANCELCLK.RESULT = %KH#RES_OK;

  15317   2 0001BA  DCC7 0004                            LDB,B5   @KH_ARG,AUTO
          2 0001BC  87C5 0005                            CLH      5,B5

      358    15318    4              END;

  15318   2 0001BE  0F81 0006                            B        s:15322,PREL

      359    15319    4            WHENALTRETURN DO;

      360    15320    4              KH_CANCELCLK.RESULT = %KH#RES_NOREL;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:64   

  15320   2 0001C0  6C04                                 LDV,R6   4
          2 0001C1  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0001C3  E7C6 0005                            STH,R6   5,B6

      361    15321    4              END;

      362    15322    3            END;  /* IF KH$CTBCTX.DYNAMIC */

  15320   2                              CANCEL_EXIT     null
      363    15323
      364    15324    2   CANCEL_EXIT:;
      365    15325             %ENABLE;

  15326   2 0001C5  E847 0007            CANCEL_EXIT     LDR,R6   DISABLE_LEVEL,AUTO
          2 0001C7  E947 0006                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 0001C9  0901 0007                            BE       s:15331,PREL

  15328   2 0001CB  CBF0 0000                            LAB,B4   0,IMO
          2 0001CD  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0001D0       0001                            DC       s:15331,PREL

      366    15331    2        IF KH_CANCELCLK.RESULT = %KH#RES_OK

  15331   2 0001D1  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0001D3  E2C6 0005                            LLH,R6   5,B6
          2 0001D5  6981 0004                            BNEZ,R6  s:15335,PREL

      367    15332    2        THEN
      368    15333    2          RETURN;

  15333   2 0001D7  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      369    15334    2        ELSE
      370    15335    2          ALTRETURN;

  15335   2 0001DA  C380 0000 0000  xent                 LNJ,B4   X6A_AALT
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:65   

      371    15336
      372    15337        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:66   
      373    15338
      374    15339        /* Modify the specified clock timer block to expire at a different
      375    15340           time.  Note that all other clock timer block specifications can
      376    15341           also be modified. */
      377    15342
      378    15343    2      CASE (%KH#CLK_RESET);

      379    15344
      380    15345             %DISABLE;

  15346   2 0001DD  EF47 0007                            STR,R6   DISABLE_LEVEL,AUTO

  15347   2 0001DF  BBC7 0007                            LAB,B3   DISABLE_LEVEL,AUTO
          2 0001E1  BFC7 001A                            STB,B3   C$+2,AUTO
          2 0001E3  BBC7 001A                            LAB,B3   C$+2,AUTO
          2 0001E5  CBF0 0100                            LAB,B4   256,IMO
          2 0001E7  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0001EA       0001                            DC       s:15350,PREL

      381    15349
      382    15350    2        IF KH_RESETCLK.NO_CTB = %YES#

  15350   2 0001EB  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0001ED  82C6 0006                            LB,'4000'X        6,B6
          2 0001EF       4000
          2 0001F0  0581 0023                            BBF      s:15370,PREL

      383    15351    3        THEN DO;

      384    15352    3          CALL FIND_UID_UVAL

  15352   2 0001F2  E3C0 03C2                            LNJ,B6   s:0,PREL
          2 0001F4       0017                            DC       s:15365,PREL

      385    15353    4          WHENRETURN DO;

      386    15354    4            IF CTB$ ~= KH_C.DISPATCH$
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:67   

  15354   2 0001F5  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 0001F7  ED80 0000 000E  00                   CMB,B6   KH_C+4
          2 0001FA  0901 0003                            BE       s:15359,PREL

      387    15355    5            THEN DO;

      388    15356    5              ;
      389    15357    5              END;

  15357   2 0001FC  0F81 000C                            B        s:15361+2,PREL

      390    15358    5            ELSE DO;

      391    15359    5              FPT_USER.RESET = '1'B;

  15359   2 0001FE  8900 0000 0005  00                   LBT,'2000'X       FPT_USER+5
  15359   2 000201       2000

      392    15360    5              KH_RESETCLK.RESULT = %KH#RES_EXPIRING;

  15360   2 000202  6C07                                 LDV,R6   7
          2 000203  DCC7 0004                            LDB,B5   @KH_ARG,AUTO
          2 000205  E7C5 0005                            STH,R6   5,B5

      393    15361    5              GOTO RESET_PARAMS;

  15361   2 000207  0F81 002D                            B        s:15380,PREL
          2 000209  0F81 0008                            B        s:15368,PREL

      394    15362    5              END;
      395    15363    4            END;
      396    15364    4          WHENALTRETURN DO;

      397    15365    4            KH_RESETCLK.RESULT = %KH#RES_NOQ;

  15365   2 00020B  6C03                                 LDV,R6   3
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:68   
          2 00020C  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 00020E  E7C6 0005                            STH,R6   5,B6

      398    15366    4            GOTO RESET_EXIT;

  15366   2 000210  0F81 00DA                            B        s:15459,PREL

      399    15367    4            END;
      400    15368    3          END;

  15368   2 000212  0F81 001F                            B        s:15385,PREL

      401    15369    3         ELSE DO;

      402    15370    3           IF CTB$ ~= KH_C.DISPATCH$

  15370   2 000214  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 000216  DD80 0000 000E  00                   CMB,B5   KH_C+4
          2 000219  0901 000F                            BE       s:15379,PREL

      403    15371    4           THEN DO;

      404    15372    4             CALL FIND_CTB$

  15372   2 00021B  E3C0 037C                            LNJ,B6   s:0,PREL
          2 00021D       0003                            DC       s:15374,PREL
          2 00021E  0F81 0008                            B        s:15377,PREL

      405    15373    5             WHENALTRETURN DO;

      406    15374    5               KH_RESETCLK.RESULT = %KH#RES_NOQ;

  15374   2 000220  6C03                                 LDV,R6   3
          2 000221  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000223  E7C6 0005                            STH,R6   5,B6

      407    15375    5               GOTO RESET_EXIT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:69   

  15375   2 000225  0F81 00C5                            B        s:15459,PREL

      408    15376    5               END;
      409    15377    4             END;

  15377   2 000227  0F81 000A                            B        s:15385,PREL

      410    15378    4           ELSE DO;

      411    15379    4             FPT_USER.RESET = '1'B;

  15379   2 000229  8900 0000 0005  00                   LBT,'2000'X       FPT_USER+5
  15379   2 00022C       2000

      412    15380    4             KH_RESETCLK.RESULT = %KH#RES_EXPIRING;

  15380   2 00022D  6C07                                 LDV,R6   7
          2 00022E  E7C6 0005                            STH,R6   5,B6

      413    15381    4             GOTO RESET_PARAMS;

  15381   2 000230  0F81 0004                            B        s:15380,PREL

      414    15382    4             END;
      415    15383    3           END;
      416    15384
      417    15385    2        CALL DEQUEUE_CTB;

  15385   2 000232  E3C0 0439                            LNJ,B6   s:0,PREL
          2 000234       0001                            DC       s:15380,PREL

  15380   2                              RESET_PARAMS    null
      418    15386
      419    15387    2   RESET_PARAMS:;
      420    15388
      421    15389
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:70   
      422    15390    2        IF KH_RESETCLK.SBR$ ~= ENTADDR(NIL)

  15390   2 000235  ECC7 0004            RESET_PARAMS    LDB,B6   @KH_ARG,AUTO
          2 000237  DCC6 0008                            LDB,B5   8,B6
          2 000239  DD80 0000 0000  03                   CMB,B5   0
          2 00023C  0901 0005                            BE       s:15397,PREL

      423    15391    3        THEN DO;

      424    15392                                         /*
      425    15393                                            Assign new subroutine entry.
      426    15394                                                                        */
      427    15395    3          CTB$ -> KH$CTBCTX.SBR$ = KH_RESETCLK.SBR$;

  15395   2 00023E  CCC7 000A                            LDB,B4   CTB$,AUTO
          2 000240  DFC4 0008                            STB,B5   8,B4

      428    15396    3          END;

      429    15397    2        IF KH_RESETCLK.UID$ ~= ADDR(NIL)

  15397   2 000242  8DC6 0002                            CMN      2,B6
          2 000244  0901 0007                            BE       s:15408,PREL

      430    15398    3        THEN DO;

      431    15399                                         /*
      432    15400                                            Assign new user value.
      433    15401                                                                        */
      434    15402    3          CTB$ -> KH$CTBCTX.UID = KH_RESETCLK.UID;

  15402   2 000246  8CC6 0002                            LDI      2,B6
          2 000248  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 00024A  8D45 000A                            SDI      10,B5

      435    15403    3          END;

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:71   
      436    15404                                         /*
      437    15405                                            Convert period and accuracy
      438    15406                                            into UTS form.
      439    15407                                                                        */
      440    15408    2        PRD = KH_RESETCLK.PRD;

  15408   2 00024C  F846 000A                            LDR,R7   10,B6
          2 00024E  6C00                                 LDV,R6   0
          2 00024F  8D47 000C                            SDI      PRD,AUTO

      441    15409    3        DO CASE (KH_RESETCLK.PRDUNT);

  15409   2 000251  B846 0006                            LDR,R3   6,B6
          2 000253  B570 00FF                            AND,R3   255,IMO
          2 000255  3D03                                 CMV,R3   3
          2 000256  0281 0055                            BGE      s:15434,PREL
          2 000258  A830 0000 025E  02                   LDR,R2   s:15409+13,R3
          2 00025B  83A0 0000 0261  02                   JMP      s:15412,R2
          2 00025E       002E                            DC       s:15425,PREL
          2 00025F       0000                            DC       s:15412,PREL
          2 000260       0014                            DC       s:15418,PREL

      442    15410
      443    15411    3          CASE (%KH#C_SEC);

      444    15412    3            PRD1 = PRD * 16;

  15412   2 000261  7084                                 DOL,R7   4
          2 000262  8D47 000E                            SDI      PRD1,AUTO

      445    15413    3            PRD = PRD1 - PRD;

  15413   2 000264  84C7 000C                            SID      PRD,AUTO
          2 000266  8D47 000C                            SDI      PRD,AUTO

      446    15414    3            CTB$ -> KH$CTBCTX.PRD = PRD / 2;

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:72   
  15414   2 000268  70C1                                 DOR,R7   1
          2 000269  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 00026B  8D45 0006                            SDI      6,B5

      447    15415    3            ACCURACY = (KH_RESETCLK.ACCURACY * 15) / 2;

  15415   2 00026D  D2C6 0007                            LLH,R5   7,B6
          2 00026F  5F0F                                 MLV,R5   15
          2 000270  5041                                 SOR,R5   1
          2 000271  DF47 0010                            STR,R5   ACCURACY,AUTO
          2 000273  0F81 0038                            B        s:15434,PREL

      448    15416
      449    15417    3          CASE (%KH#C_MIN);

      450    15418    3            PRD1 = PRD * 16;

  15418   2 000275  7084                                 DOL,R7   4
          2 000276  8D47 000E                            SDI      PRD1,AUTO

      451    15419    3            PRD = PRD1 - PRD;

  15419   2 000278  84C7 000C                            SID      PRD,AUTO
          2 00027A  8D47 000C                            SDI      PRD,AUTO

      452    15420    3            PRD1 = PRD * 32;

  15420   2 00027C  7085                                 DOL,R7   5
          2 00027D  8D47 000E                            SDI      PRD1,AUTO

      453    15421    3            CTB$ -> KH$CTBCTX.PRD = PRD1 - PRD - PRD;

  15421   2 00027F  84C7 000C                            SID      PRD,AUTO
          2 000281  84C7 000C                            SID      PRD,AUTO
          2 000283  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 000285  8D45 0006                            SDI      6,B5

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:73   
      454    15422    3            ACCURACY = (KH_RESETCLK.ACCURACY * 30 * 15);

  15422   2 000287  D2C6 0007                            LLH,R5   7,B6
          2 000289  DB70 01C2                            MUL,R5   450,IMO
          2 00028B  DF47 0010                            STR,R5   ACCURACY,AUTO
          2 00028D  0F81 001E                            B        s:15434,PREL

      455    15423
      456    15424    3          CASE (%KH#C_TMIL);

      457    15425    3            PRD = KH_SETCLK.PRD / 40;

  15425   2 00028F  F846 000A                            LDR,R7   10,B6
          2 000291  6C00                                 LDV,R6   0
          2 000292  F370 0028                            DIV,R7   40,IMO
          2 000294  E857                                 LDR,R6   R7
          2 000295  70F0                                 DAR,R7   16
          2 000296  8D47 000C                            SDI      PRD,AUTO

      458    15426    3            CTB$ -> KH$CTBCTX.PRD = KH_SETCLK.PRD / 10 - PRD ;

  15426   2 000298  F846 000A                            LDR,R7   10,B6
          2 00029A  6C00                                 LDV,R6   0
          2 00029B  F370 000A                            DIV,R7   10,IMO
          2 00029D  E857                                 LDR,R6   R7
          2 00029E  70F0                                 DAR,R7   16
          2 00029F  84C7 000C                            SID      PRD,AUTO
          2 0002A1  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 0002A3  8D45 0006                            SDI      6,B5

      459    15427    3            ACCURACY = (KH_RESETCLK.ACCURACY * 3) / 40;

  15427   2 0002A5  D2C6 0007                            LLH,R5   7,B6
          2 0002A7  5F03                                 MLV,R5   3
          2 0002A8  D370 0028                            DIV,R5   40,IMO
          2 0002AA  DF47 0010                            STR,R5   ACCURACY,AUTO

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:74   
      460    15428
      461    15429    3          END;

      462    15430                                         /*
      463    15431                                            Assign new accuracy (fuzz)
      464    15432                                            factor.
      465    15433                                                                        */
      466    15434    2          CTB$ -> KH$CTBCTX.ACCURACY = ACCURACY;

  15434   2 0002AC  E847 0010                            LDR,R6   ACCURACY,AUTO
          2 0002AE  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 0002B0  E7C5 000C                            STH,R6   12,B5

      467    15435                                         /*
      468    15436                                            Assign new permanent clock
      469    15437                                            status.
      470    15438                                                                        */
      471    15439    2      IF NOT KH_RESETCLK.PERM & %KH#C_NOCHANGE

  15439   2 0002B2  D846 0006                            LDR,R5   6,B6
          2 0002B4  5002                                 SOL,R5   2
          2 0002B5  D570 C000                            AND,R5   -16384,IMO
          2 0002B7  D570 4000                            AND,R5   16384,IMO
          2 0002B9  5981 0007                            BNEZ,R5  s:15442,PREL

      472    15440    2      THEN
      473    15441    2        CTB$ -> KH$CTBCTX.PERM = KH_RESETCLK.PERM;

  15441   2 0002BB  D846 0006                            LDR,R5   6,B6
          2 0002BD  5049                                 SOR,R5   9
          2 0002BE  DAC5 000C                            SRM,R5,'0010'X    12,B5
          2 0002C0       0010

      474    15442    2        IF NOT KH_RESETCLK.EXPINH & %KH#C_NOCHANGE

  15442   2 0002C1  D846 0006                            LDR,R5   6,B6
          2 0002C3  5004                                 SOL,R5   4
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:75   
          2 0002C4  D570 C000                            AND,R5   -16384,IMO
          2 0002C6  D570 4000                            AND,R5   16384,IMO
          2 0002C8  5981 0007                            BNEZ,R5  s:15445,PREL

      475    15443    2        THEN
      476    15444    2         CTB$ -> KH$CTBCTX.EXPINH = KH_SETCLK.EXPINH;

  15444   2 0002CA  D846 0006                            LDR,R5   6,B6
          2 0002CC  5048                                 SOR,R5   8
          2 0002CD  DAC5 000C                            SRM,R5,'0008'X    12,B5
          2 0002CF       0008

      477    15445    2      CALL GET_UTS_PARTS;

  15445   2 0002D0  E3C0 04B4                            LNJ,B6   s:0,PREL
          2 0002D2       0001                            DC       s:15446,PREL

      478    15446    2      CURR_UTS = CURR_UTS + (UTS_TIX + 8) / 16;

  15446   2 0002D3  E847 0011                            LDR,R6   UTS_TIX,AUTO
          2 0002D5  6E08                                 ADV,R6   8
          2 0002D6  6044                                 SOR,R6   4
          2 0002D7  F856                                 LDR,R7   R6
          2 0002D8  6C00                                 LDV,R6   0
          2 0002D9  8447 0012                            AID      CURR_UTS,AUTO
          2 0002DB  8D47 0012                            SDI      CURR_UTS,AUTO

      479    15447    2        CTB$ -> KH$CTBCTX.UTS = CURR_UTS + CTB$ -> KH$CTBCTX.PRD;

  15447   2 0002DD  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 0002DF  8446 0006                            AID      6,B6
          2 0002E1  8D46 0004                            SDI      4,B6

      480    15448
      481    15449                                       /*
      482    15450                                          If this reset is interrupting
      483    15451                                          the dispatch of this block,
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:76   
      484    15452                                          allow the dispatch routine to
      485    15453                                          queue the block after this
      486    15454                                          interrupt completes.
      487    15455                                                                      */
      488    15456    2        IF CTB$ ~= KH_C.DISPATCH$

  15456   2 0002E3  ED80 0000 000E  00                   CMB,B6   KH_C+4
          2 0002E6  0901 0004                            BE       s:15459,PREL

      489    15457    3        THEN DO;

      490    15458    3          CALL QUEUE_CTB;

  15458   2 0002E8  E3C0 02F7                            LNJ,B6   s:0,PREL
          2 0002EA       0001                            DC       s:15459,PREL

      491    15459    3          END;

  15456   2                              RESET_EXIT      null
      492    15460
      493    15461    2   RESET_EXIT:;
      494    15462             %ENABLE;

  15463   2 0002EB  E847 0007            RESET_EXIT      LDR,R6   DISABLE_LEVEL,AUTO
          2 0002ED  E947 0006                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 0002EF  0901 0007                            BE       s:15468,PREL

  15465   2 0002F1  CBF0 0000                            LAB,B4   0,IMO
          2 0002F3  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0002F6       0001                            DC       s:15468,PREL

      495    15468    2        IF KH_RESETCLK.RESULT = %KH#RES_OK

  15468   2 0002F7  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0002F9  E2C6 0005                            LLH,R6   5,B6
          2 0002FB  6981 0004                            BNEZ,R6  s:15472,PREL

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:77   
      496    15469    2        THEN
      497    15470    2          RETURN;

  15470   2 0002FD  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      498    15471    2        ELSE
      499    15472    2          ALTRETURN;

  15472   2 000300  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      500    15473        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:78   
      501    15474
      502    15475        /* Restart a clock.  This case is essentially a fast reset. */
      503    15476
      504    15477    2      CASE (%KH#CLK_RESTART);

      505    15478
      506    15479             %DISABLE;

  15480   2 000303  EF47 0007                            STR,R6   DISABLE_LEVEL,AUTO

  15481   2 000305  BBC7 0007                            LAB,B3   DISABLE_LEVEL,AUTO
          2 000307  BFC7 001A                            STB,B3   C$+2,AUTO
          2 000309  BBC7 001A                            LAB,B3   C$+2,AUTO
          2 00030B  CBF0 0100                            LAB,B4   256,IMO
          2 00030D  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000310       0001                            DC       s:15484,PREL

      507    15483
      508    15484    2        IF KH_RESTARTCLK.NO_CTB = %YES#

  15484   2 000311  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000313  82C6 0006                            LB,'4000'X        6,B6
          2 000315       4000
          2 000316  0581 0023                            BBF      s:15504,PREL

      509    15485    3        THEN DO;

      510    15486    3          CALL FIND_UID_UVAL

  15486   2 000318  E3C0 029C                            LNJ,B6   s:0,PREL
          2 00031A       0017                            DC       s:15499,PREL

      511    15487    4          WHENRETURN DO;

      512    15488    4            IF CTB$ ~= KH_C.DISPATCH$

  15488   2 00031B  ECC7 000A                            LDB,B6   CTB$,AUTO
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:79   
          2 00031D  ED80 0000 000E  00                   CMB,B6   KH_C+4
          2 000320  0901 0003                            BE       s:15493,PREL

      513    15489    5            THEN DO;

      514    15490    5              ;
      515    15491    5              END;

  15491   2 000322  0F81 000C                            B        s:15495+2,PREL

      516    15492    5            ELSE DO;

      517    15493    5              FPT_USER.RESET = '1'B;

  15493   2 000324  8900 0000 0005  00                   LBT,'2000'X       FPT_USER+5
  15493   2 000327       2000

      518    15494    5              KH_RESTARTCLK.RESULT = %KH#RES_EXPIRING;

  15494   2 000328  6C07                                 LDV,R6   7
          2 000329  DCC7 0004                            LDB,B5   @KH_ARG,AUTO
          2 00032B  E7C5 0005                            STH,R6   5,B5

      519    15495    5              GOTO RESTART_EXIT;

  15495   2 00032D  0F81 0048                            B        s:15536,PREL
          2 00032F  0F81 0008                            B        s:15502,PREL

      520    15496    5              END;
      521    15497    4            END;
      522    15498    4          WHENALTRETURN DO;

      523    15499    4            KH_RESTARTCLK.RESULT = %KH#RES_NOQ;

  15499   2 000331  6C03                                 LDV,R6   3
          2 000332  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000334  E7C6 0005                            STH,R6   5,B6
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:80   

      524    15500    4            GOTO RESTART_EXIT;

  15500   2 000336  0F81 003F                            B        s:15536,PREL

      525    15501    4            END;
      526    15502    3          END;

  15502   2 000338  0F81 001F                            B        s:15519,PREL

      527    15503    3         ELSE DO;

      528    15504    3           IF CTB$ ~= KH_C.DISPATCH$

  15504   2 00033A  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 00033C  DD80 0000 000E  00                   CMB,B5   KH_C+4
          2 00033F  0901 000F                            BE       s:15513,PREL

      529    15505    4           THEN DO;

      530    15506    4             CALL FIND_CTB$

  15506   2 000341  E3C0 0256                            LNJ,B6   s:0,PREL
          2 000343       0003                            DC       s:15508,PREL
          2 000344  0F81 0008                            B        s:15511,PREL

      531    15507    5             WHENALTRETURN DO;

      532    15508    5               KH_RESTARTCLK.RESULT = %KH#RES_NOQ;

  15508   2 000346  6C03                                 LDV,R6   3
          2 000347  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000349  E7C6 0005                            STH,R6   5,B6

      533    15509    5               GOTO RESTART_EXIT;

  15509   2 00034B  0F81 002A                            B        s:15536,PREL
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:81   

      534    15510    5               END;
      535    15511    4             END;

  15511   2 00034D  0F81 000A                            B        s:15519,PREL

      536    15512    4           ELSE DO;

      537    15513    4             FPT_USER.RESET = '1'B;

  15513   2 00034F  8900 0000 0005  00                   LBT,'2000'X       FPT_USER+5
  15513   2 000352       2000

      538    15514    4             KH_RESTARTCLK.RESULT = %KH#RES_EXPIRING;

  15514   2 000353  6C07                                 LDV,R6   7
          2 000354  E7C6 0005                            STH,R6   5,B6

      539    15515    4            GOTO RESTART_EXIT;

  15515   2 000356  0F81 001F                            B        s:15536,PREL

      540    15516    4             END;
      541    15517    3           END;
      542    15518
      543    15519    2        CALL DEQUEUE_CTB;

  15519   2 000358  E3C0 0313                            LNJ,B6   s:0,PREL
          2 00035A       0001                            DC       s:15522,PREL

      544    15520
      545    15521
      546    15522    2      CALL GET_UTS_PARTS;

  15522   2 00035B  E3C0 0429                            LNJ,B6   s:0,PREL
          2 00035D       0001                            DC       s:15523,PREL

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:82   
      547    15523    2      CURR_UTS = CURR_UTS + (UTS_TIX + 8) / 16;

  15523   2 00035E  E847 0011                            LDR,R6   UTS_TIX,AUTO
          2 000360  6E08                                 ADV,R6   8
          2 000361  6044                                 SOR,R6   4
          2 000362  F856                                 LDR,R7   R6
          2 000363  6C00                                 LDV,R6   0
          2 000364  8447 0012                            AID      CURR_UTS,AUTO
          2 000366  8D47 0012                            SDI      CURR_UTS,AUTO

      548    15524    2        CTB$ -> KH$CTBCTX.UTS = CURR_UTS + CTB$ -> KH$CTBCTX.PRD;

  15524   2 000368  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 00036A  8446 0006                            AID      6,B6
          2 00036C  8D46 0004                            SDI      4,B6

      549    15525
      550    15526                                       /*
      551    15527                                          If this reset is interrupting
      552    15528                                          the dispatch of this block,
      553    15529                                          allow the dispatch routine to
      554    15530                                          queue the block after this
      555    15531                                          interrupt completes.
      556    15532                                                                      */
      557    15533    2        IF CTB$ ~= KH_C.DISPATCH$

  15533   2 00036E  ED80 0000 000E  00                   CMB,B6   KH_C+4
          2 000371  0901 0004                            BE       s:15536,PREL

      558    15534    3        THEN DO;

      559    15535    3          CALL QUEUE_CTB;

  15535   2 000373  E3C0 026C                            LNJ,B6   s:0,PREL
          2 000375       0001                            DC       s:15536,PREL

      560    15536    3          END;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:83   

  15533   2                              RESTART_EXIT    null
      561    15537
      562    15538    2   RESTART_EXIT:;
      563    15539             %ENABLE;

  15540   2 000376  E847 0007            RESTART_EXIT    LDR,R6   DISABLE_LEVEL,AUTO
          2 000378  E947 0006                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 00037A  0901 0007                            BE       s:15545,PREL

  15542   2 00037C  CBF0 0000                            LAB,B4   0,IMO
          2 00037E  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000381       0001                            DC       s:15545,PREL

      564    15545    2        IF KH_RESTARTCLK.RESULT = %KH#RES_OK

  15545   2 000382  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000384  E2C6 0005                            LLH,R6   5,B6
          2 000386  6981 0004                            BNEZ,R6  s:15549,PREL

      565    15546    2        THEN
      566    15547    2          RETURN;

  15547   2 000388  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      567    15548    2        ELSE
      568    15549    2          ALTRETURN;

  15549   2 00038B  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      569    15550        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:84   
      570    15551    2      CASE (ELSE);

      571    15552             /* SNAP */
      572    15553
      573    15554    2      END;

      574    15555
      575    15556    1      RETURN;

  15556   2 00038E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      576    15557
      577    15558        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:85   
      578    15559    1   KHC$WAIT: ENTRY ALTRET;

  15559   2 000391  D380 0000 0000  xent KHC$WAIT        LNJ,B5   X6A_AUTO_1
          2 000394       001E 0001                       DC       30,1

      579    15560
      580    15561    1          INHIBIT_LEVEL = KH_INHLVL;

  15561   2 000396  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 000399  EF47 0006                            STR,R6   INHIBIT_LEVEL,AUTO

      581    15562             %DISABLE;

  15563   2 00039B  EF47 0007                            STR,R6   DISABLE_LEVEL,AUTO

  15564   2 00039D  EBC7 0007                            LAB,B6   DISABLE_LEVEL,AUTO
          2 00039F  EFC7 001A                            STB,B6   C$+2,AUTO
          2 0003A1  BBC7 001A                            LAB,B3   C$+2,AUTO
          2 0003A3  CBF0 0100                            LAB,B4   256,IMO
          2 0003A5  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0003A8       0001                            DC       s:15566,PREL

      582    15566    1        CALL GET_UTS_PARTS;

  15566   2 0003A9  E3C0 03DB                            LNJ,B6   s:0,PREL
          2 0003AB       0001                            DC       s:15567,PREL

      583    15567    1        CURR_UTS = CURR_UTS + (UTS_TIX + 8) / 16;

  15567   2 0003AC  E847 0011                            LDR,R6   UTS_TIX,AUTO
          2 0003AE  6E08                                 ADV,R6   8
          2 0003AF  6044                                 SOR,R6   4
          2 0003B0  F856                                 LDR,R7   R6
          2 0003B1  6C00                                 LDV,R6   0
          2 0003B2  8447 0012                            AID      CURR_UTS,AUTO
          2 0003B4  8D47 0012                            SDI      CURR_UTS,AUTO

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:86   
      584    15568    1          IF KH_C.CTBHD$ = ADDR(NIL)

  15568   2 0003B6  8D80 0000 000A  00                   CMN      KH_C
          2 0003B9  0981 0009                            BNE      s:15572,PREL

      585    15569    1          THEN
      586    15570    1            UTS_VALUE = CURR_UTS + 10;

  15570   2 0003BB  8470 0000 000A                       AID      10,IMO
          2 0003BE  8D00 0000 0007  00                   SDI      UTS_VALUE
          2 0003C1  0F81 0009                            B        s:15573,PREL

      587    15571    1          ELSE
      588    15572    1        UTS_VALUE = KH_C.CTBHD$ -> KH$CTBCTX.UTS;

  15572   2 0003C3  EC80 0000 000A  00                   LDB,B6   KH_C
          2 0003C6  8CC6 0004                            LDI      4,B6
          2 0003C8  8D00 0000 0007  00                   SDI      UTS_VALUE

      589    15573    1        UETIME = 0;

  15573   2 0003CB  8700 0000 0006  00                   CL       UETIME

      590    15574                                           /*
      591    15575                                             Is it necessary to go to sleep?
      592    15576                                             If so, suspend.
      593    15577                                                                          */
      594    15578    1        IF CURR_UTS < UTS_VALUE

  15578   2 0003CE  8CC7 0012                            LDI      CURR_UTS,AUTO
          2 0003D0  8480 0000 0007  00                   SID      UTS_VALUE
          2 0003D3  0601 0036                            BCT      s:15601,PREL

      595    15579    2        THEN DO;

      596    15580    2        SUSPENDED = '1'B;

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:87   
  15580   2 0003D5  8900 0000 0009  00                   LBT,'8000'X       SUSPENDED
  15580   2 0003D8       8000

      597    15581             %ENABLE;

  15582   2 0003D9  E847 0007                            LDR,R6   DISABLE_LEVEL,AUTO
          2 0003DB  E947 0006                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 0003DD  0901 0007                            BE       s:15587,PREL

  15584   2 0003DF  CBF0 0000                            LAB,B4   0,IMO
          2 0003E1  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0003E4       0001                            DC       s:15587,PREL

      598    15587    2        UTS_VALUE = UTS_VALUE + G$MHJIT.BOOTUTS;

  15587   2 0003E5  EC80 0000 0000  xsym                 LDB,B6   G$MHJIT$
          2 0003E8  8C80 0000 0007  00                   LDI      UTS_VALUE
          2 0003EB  8446 035A                            AID      858,B6
          2 0003ED  8D00 0000 0007  00                   SDI      UTS_VALUE

      599    15588    2        CALL M$WAIT (SUSPEND);

  15588   2 0003F0  BB80 0000 0000  01                   LAB,B3   SUSPEND
          2 0003F3  B870 0CC5                            LDR,R3   3269,IMO
          2 0003F5  0001                                 MCL
          2 0003F6       0000                            DC       s:15588+6,PREL

      600    15589             %DISABLE;

  15590   2 0003F7  E847 0006                            LDR,R6   INHIBIT_LEVEL,AUTO
          2 0003F9  EF47 0007                            STR,R6   DISABLE_LEVEL,AUTO

  15591   2 0003FB  EBC7 0007                            LAB,B6   DISABLE_LEVEL,AUTO
          2 0003FD  EFC7 001A                            STB,B6   C$+2,AUTO
          2 0003FF  BBC7 001A                            LAB,B3   C$+2,AUTO
          2 000401  CBF0 0100                            LAB,B4   256,IMO
          2 000403  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:88   
          2 000406       0001                            DC       s:15593,PREL

      601    15593    2        SUSPENDED = '0'B;

  15593   2 000407  8700 0000 0009  00                   CL       SUSPENDED

      602    15594    2          END;

      603    15595                                           /*
      604    15596                                             If residual time is 0, assume a
      605    15597                                             clock needs to be serviced.  If
      606    15598                                             it's ~0, assume we were kicked
      607    15599                                             off the wait by a VDH event.
      608    15600                                                                          */
      609    15601    1        IF UETIME = 0

  15601   2 00040A  E800 0000 0006  00                   LDR,R6   UETIME
          2 00040D  6981 0010                            BNEZ,R6  s:15613,PREL

      610    15602    2        THEN DO;

      611    15603               %ENABLE;

  15604   2 00040F  D847 0007                            LDR,R5   DISABLE_LEVEL,AUTO
          2 000411  D947 0006                            CMR,R5   INHIBIT_LEVEL,AUTO
          2 000413  0901 0007                            BE       s:15609,PREL

  15606   2 000415  CBF0 0000                            LAB,B4   0,IMO
          2 000417  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00041A       0001                            DC       s:15609,PREL

      612    15609    2          RETURN;

  15609   2 00041B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      613    15610    2          END;
      614    15611    2        ELSE DO;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:89   

      615    15612               %ENABLE;

  15613   2 00041E  D847 0007                            LDR,R5   DISABLE_LEVEL,AUTO
          2 000420  D947 0006                            CMR,R5   INHIBIT_LEVEL,AUTO
          2 000422  0901 0007                            BE       s:15618,PREL

  15615   2 000424  CBF0 0000                            LAB,B4   0,IMO
          2 000426  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000429       0001                            DC       s:15618,PREL

      616    15618    2          ALTRETURN;

  15618   2 00042A  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      617    15619    2          END;
      618    15620
      619    15621        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:90   
      620    15622    1   KHC$DISPATCH: ENTRY ( KH_ARG ) ALTRET;

  15622   2 00042D  D380 0000 0000  xent KHC$DISPATCH    LNJ,B5   X6A_AUTO_1
          2 000430       001E 0001                       DC       30,1

      621    15623
      622    15624    1          INHIBIT_LEVEL = KH_INHLVL;

  15624   2 000432  E800 0000 0000  xsym                 LDR,R6   KH_INHLVL
          2 000435  EF47 0006                            STR,R6   INHIBIT_LEVEL,AUTO

      623    15625           %DISABLE;

  15626   2 000437  EF47 0007                            STR,R6   DISABLE_LEVEL,AUTO

  15627   2 000439  EBC7 0007                            LAB,B6   DISABLE_LEVEL,AUTO
          2 00043B  EFC7 001A                            STB,B6   C$+2,AUTO
          2 00043D  BBC7 001A                            LAB,B3   C$+2,AUTO
          2 00043F  CBF0 0100                            LAB,B4   256,IMO
          2 000441  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000444       0001                            DC       s:15629,PREL

      624    15629    1      IF FPT_VDH.VDH_CLK = %YES#

  15629   2 000445  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000447  89C6 0005                            CMZ      5,B6
          2 000449  0881 0014                            BAGE     s:15640,PREL
          2 00044B  8DC6 0003                            CMN      3,B6
          2 00044D  0901 0010                            BE       s:15640,PREL

      625    15630    1      AND FPT_VDH.CTBCTX$ ~= ADDR(NIL)
      626    15631    2      THEN DO;

      627    15632    2        CTB$ = FPT_VDH.CTBCTX$;

  15632   2 00044F  DCC6 0003                            LDB,B5   3,B6
          2 000451  DFC7 000A                            STB,B5   CTB$,AUTO
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:91   

      628    15633    2        FPT_USER = FPT_VDH;

  15633   2 000453  AB86                                 LAB,B2   ,B6
          2 000454  2C00                                 LDV,R2   0
          2 000455  6C0C                                 LDV,R6   12
          2 000456  BB80 0000 0000  00                   LAB,B3   FPT_USER
          2 000459  3C00                                 LDV,R3   0
          2 00045A  0008                                 MMM

      629    15634    2        CALL FINISH_EXPIRATION;

  15634   2 00045B  E3C0 00E2                            LNJ,B6   s:0,PREL
          2 00045D       0001                            DC       s:15640,PREL

      630    15635    2        END;

      631    15636                                           /*
      632    15637                                             Anything left on the queue?
      633    15638                                                                          */
      634    15639
      635    15640    1      IF KH_C.CTBHD$ = ADDR(NIL)

  15640   2 00045E  8D80 0000 000A  00                   CMN      KH_C
          2 000461  0981 0003                            BNE      s:15645,PREL

      636    15641    2      THEN DO;

      637    15642    2        GOTO DSPCH_ALTRET_;

  15642   2 000463  0F81 00A8                            B        s:15683,PREL

      638    15643    2        END;
      639    15644
      640    15645    1        CALL GET_UTS_PARTS;

  15645   2 000465  E3C0 031F                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:92   
          2 000467       0001                            DC       s:15646,PREL

      641    15646    1        CURR_UTS = CURR_UTS + ( UTS_TIX + 8 ) / 16;

  15646   2 000468  E847 0011                            LDR,R6   UTS_TIX,AUTO
          2 00046A  6E08                                 ADV,R6   8
          2 00046B  6044                                 SOR,R6   4
          2 00046C  F856                                 LDR,R7   R6
          2 00046D  6C00                                 LDV,R6   0
          2 00046E  8447 0012                            AID      CURR_UTS,AUTO
          2 000470  8D47 0012                            SDI      CURR_UTS,AUTO

      642    15647    1      CTB$ = KH_C.CTBHD$;

  15647   2 000472  EC80 0000 000A  00                   LDB,B6   KH_C
          2 000475  EFC7 000A                            STB,B6   CTB$,AUTO

      643    15648                                           /*
      644    15649                                             Check if it's time to service the
      645    15650                                             queue head (i.e. the next clock
      646    15651                                             to expire).
      647    15652                                                                          */
      648    15653    2   TIMEOUT: DO WHILE ( CTB$ ~= ADDR(NIL)

  15653   2 000477  0F81 007C            TIMEOUT         B        s:15698,PREL

      649    15654    2        AND CTB$ -> KH$CTBCTX.TOKEN = %KH#C_ACTIVE
      650    15655    2        AND ( CURR_UTS >= CTB$ -> KH$CTBCTX.UTS
      651    15656    2        OR CTB$ -> KH$CTBCTX.UTS <= (CTB$ -> KH$CTBCTX.ACCURACY
      652    15657    2       + CURR_UTS) ) );
      653    15658    2          KH_C.DISPATCH$ = CTB$;

  15658   2 000479  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 00047B  EF80 0000 000E  00                   STB,B6   KH_C+4

      654    15659    2          CALL DEQUEUE_CTB;

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:93   
  15659   2 00047E  E3C0 01ED                            LNJ,B6   s:0,PREL
          2 000480       0001                            DC       s:15661,PREL

      655    15660
      656    15661    2        IF CTB$ -> KH$CTBCTX.SBR$ = ENTADDR(NIL)

  15661   2 000481  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 000483  DCC6 0008                            LDB,B5   8,B6
          2 000485  DD80 0000 0000  03                   CMB,B5   0
          2 000488  0981 0020                            BNE      s:15675,PREL

      657    15662    3          THEN DO;

      658    15663    3            FPT_VDH.VDH_CLK = %YES#;

  15663   2 00048A  CCC7 0004                            LDB,B4   @KH_ARG,AUTO
          2 00048C  8944 0005                            LBT,'8000'X       5,B4
          2 00048E       8000

      659    15664    3          CALL INIT_EXP (FPT_VDH);

  15664   2 00048F  CFC7 0016                            STB,B4   CURR_UTS+4,AUTO
          2 000491  E3C0 0089                            LNJ,B6   s:0,PREL
          2 000493       0001                            DC       s:15665,PREL

      660    15665    3          KH_C.DISPATCH$ = ADDR(NIL);

  15665   2 000494  EB80 0000 0000                       LAB,B6   0
          2 000497  EF80 0000 000E  00                   STB,B6   KH_C+4

      661    15666                 %ENABLE;

  15667   2 00049A  E847 0007                            LDR,R6   DISABLE_LEVEL,AUTO
          2 00049C  E947 0006                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 00049E  0901 0007                            BE       s:15672,PREL

  15669   2 0004A0  CBF0 0000                            LAB,B4   0,IMO
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:94   
          2 0004A2  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0004A5       0001                            DC       s:15672,PREL

      662    15672    3            RETURN;

  15672   2 0004A6  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      663    15673    3            END;
      664    15674    3          ELSE DO;

      665    15675    3              CALL INIT_EXP (FPT_USER);

  15675   2 0004A9  CB80 0000 0000  00                   LAB,B4   FPT_USER
          2 0004AC  CFC7 0016                            STB,B4   CURR_UTS+4,AUTO
          2 0004AE  E3C0 006C                            LNJ,B6   s:0,PREL
          2 0004B0       0001                            DC       s:15676,PREL

      666    15676    3              FPT_USER.VDH_CLK = %NO#;

  15676   2 0004B1  8800 0000 0005  00                   LBF,'8000'X       FPT_USER+5
  15676   2 0004B4       8000

      667    15677    3              USER@ = CTB$ -> KH$CTBCTX.SBR$;

  15677   2 0004B5  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 0004B7  DCC6 0008                            LDB,B5   8,B6
          2 0004B9  DFC7 0008                            STB,B5   USER@,AUTO

      668    15678    3               IF NOT CTB$ -> KH$CTBCTX.EXPINH

  15678   2 0004BB  82C6 000C                            LB,'0008'X        12,B6
  15678   2 0004BD       0008
          2 0004BE  0501 000D                            BBT      s:15687,PREL

      669    15679    4               THEN DO;

      670    15680                   %ENABLE;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:95   

  15681   2 0004C0  E847 0007                            LDR,R6   DISABLE_LEVEL,AUTO
          2 0004C2  E947 0006                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 0004C4  0901 0007                            BE       s:15687,PREL

  15683   2 0004C6  CBF0 0000                            LAB,B4   0,IMO
          2 0004C8  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0004CB       0001                            DC       s:15687,PREL

      671    15686    4               END;

      672    15687    3              CALL USER@ (FPT_USER);

  15687   2 0004CC  BB80 0000 0002  03                   LAB,B3   +2
          2 0004CF  9CC7 0008                            LDB,B1   USER@,AUTO
          2 0004D1  CBF0 0100                            LAB,B4   256,IMO
          2 0004D3  E381                                 LNJ,B6   ,B1
          2 0004D4       0001                            DC       s:15688,PREL

      673    15688    3               IF NOT CTB$ -> KH$CTBCTX.EXPINH

  15688   2 0004D5  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 0004D7  82C6 000C                            LB,'0008'X        12,B6
          2 0004D9       0008
          2 0004DA  0501 0011                            BBT      s:15695,PREL

      674    15689    4               THEN DO;

      675    15690                   %DISABLE;

  15691   2 0004DC  E847 0006                            LDR,R6   INHIBIT_LEVEL,AUTO
          2 0004DE  EF47 0007                            STR,R6   DISABLE_LEVEL,AUTO

  15692   2 0004E0  DBC7 0007                            LAB,B5   DISABLE_LEVEL,AUTO
          2 0004E2  DFC7 001A                            STB,B5   C$+2,AUTO
          2 0004E4  BBC7 001A                            LAB,B3   C$+2,AUTO
          2 0004E6  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:96   
          2 0004E8  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0004EB       0001                            DC       s:15695,PREL

      676    15694    4               END;

      677    15695    3              CALL FINISH_EXPIRATION;

  15695   2 0004EC  E3C0 0051                            LNJ,B6   s:0,PREL
          2 0004EE       0001                            DC       s:15697,PREL

      678    15696    3            END;

      679    15697    2          CTB$ = KH_C.CTBHD$;

  15697   2 0004EF  EC80 0000 000A  00                   LDB,B6   KH_C
          2 0004F2  EFC7 000A                            STB,B6   CTB$,AUTO

      680    15698    2        END;   /* IF KH_C.CTBHD$ -> KH$CTBCTX.TOKEN = %KH#C_ACTIVE; */

  15698   2 0004F4  8DC7 000A                            CMN      CTB$,AUTO
          2 0004F6  0901 0015                            BE       s:15683,PREL
          2 0004F8  82C6 000C                            LB,'0020'X        12,B6
          2 0004FA       0020
          2 0004FB  0581 0010                            BBF      s:15683,PREL
          2 0004FD  8CC7 0012                            LDI      CURR_UTS,AUTO
          2 0004FF  84C6 0004                            SID      4,B6
          2 000501  0601 FF77                            BCT      s:15658,PREL
          2 000503  F2C6 000C                            LLH,R7   12,B6
          2 000505  6C00                                 LDV,R6   0
          2 000506  8447 0012                            AID      CURR_UTS,AUTO
          2 000508  84C6 0004                            SID      4,B6
          2 00050A  0601 FF6E                            BCT      s:15658,PREL

  15683   2                              DSPCH_ALTRET_   null
      681    15699
      682    15700                                           /*
      683    15701                                             No more clocks to do right now.
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:97   
      684    15702                                             Altret to VDH indicating the fact.
      685    15703                                                                          */
      686    15704    1   DSPCH_ALTRET_:;
      687    15705           %ENABLE;

  15706   2 00050C  E847 0007            DSPCH_ALTRET_   LDR,R6   DISABLE_LEVEL,AUTO
          2 00050E  E947 0006                            CMR,R6   INHIBIT_LEVEL,AUTO
          2 000510  0901 0007                            BE       s:15711,PREL

  15708   2 000512  CBF0 0000                            LAB,B4   0,IMO
          2 000514  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000517       0001                            DC       s:15711,PREL

      688    15711    1      ALTRETURN;

  15711   2 000518  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      689    15712
      690    15713        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:98   
      691    15714
      692    15715        /* Copy pertinent info from KH$CTBCTX into KH$EXP in preparation to
      693    15716           report that a clock is expiring. */
      694    15717
      695    15718    1   INIT_EXP: PROC (MY_EXP);

  15718   2 00051B  EFC7 0014            INIT_EXP        STB,B6   CURR_UTS+2,AUTO

      696    15719
      697    15720        %KH$EXP (FPTN = MY_EXP,
      698    15721                 STCLASS = PARAM);
      699    15784
      700    15785    2            MY_EXP.ABORT = %NO#;

  15785   2 00051D  DCC7 0016                            LDB,B5   @MY_EXP,AUTO
          2 00051F  8845 0005                            LBF,'4000'X       5,B5
          2 000521       4000

      701    15786    2            MY_EXP.RESET = %NO#;

  15786   2 000522  8845 0005                            LBF,'2000'X       5,B5
  15786   2 000524       2000

      702    15787    2            MY_EXP.DELETE = %NO#;

  15787   2 000525  8845 0005                            LBF,'1000'X       5,B5
  15787   2 000527       1000

      703    15788    2            MY_EXP.UID = CTB$ -> KH$CTBCTX.UID;

  15788   2 000528  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 00052A  8CC6 000A                            LDI      10,B6
          2 00052C  8D05                                 SDI      ,B5

      704    15789    2            MY_EXP.CTBCTX$ = CTB$;

  15789   2 00052D  EFC5 0003                            STB,B6   3,B5
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:99   

      705    15790    2            MY_EXP.UVAL = CTB$ -> KH$CTBCTX.UVAL;

  15790   2 00052F  D846 000D                            LDR,R5   13,B6
          2 000531  DF45 0002                            STR,R5   2,B5

      706    15791    2            KV$BPC.CLKE = KV$BPC.CLKE + 1;

  15791   2 000533  CC80 0000 0000  xsym                 LDB,B4   KV_B_POOL$
          2 000536  8AC4 001B                            INC      27,B4
          2 000538  8EC4 001A                            CAD      26,B4

      707    15792
      708    15793    2            RETURN;

  15793   2 00053A  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 00053C  C3C6 0001                            LNJ,B4   1,B6

      709    15794    2   END INIT_EXP;
      710    15795        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:100  
      711    15796
      712    15797        /* Expire the clocks (i.e. those which are due) based on the current
      713    15798           UTS. */
      714    15799
      715    15800    1   FINISH_EXPIRATION: PROC;

  15800   2 00053E  EFC7 0014            FINISH_EXPIRATI*STB,B6   CURR_UTS+2,AUTO

      716    15801                                           /*
      717    15802                                              This is a potential problem area
      718    15803                                              If the user has a self-allocated
      719    15804                                              CTB, it must be retained for the
      720    15805                                              duration of the program.  If not
      721    15806                                              the block could be released, and
      722    15807                                              reallocated for another CTB or
      723    15808                                              some other block.  This means
      724    15809                                              clock services has no way of
      725    15810                                              knowing what to do as far as
      726    15811                                              release is concerned.  Since
      727    15812                                              users allocate CTBs to save
      728    15813                                              CLK SVC time, they will be
      729    15814                                              required to hold onto them.
      730    15815                                                                          */
      731    15816    2            KH_C.DISPATCH$ = ADDR(NIL);

  15816   2 000540  DB80 0000 0000                       LAB,B5   0
          2 000543  DF80 0000 000E  00                   STB,B5   KH_C+4

      732    15817                                           /*
      733    15818                                              If cancel or reset are set it
      734    15819                                              was already dequeued.
      735    15820                                                                          */
      736    15821    2            IF NOT FPT_USER.DELETE

  15821   2 000546  8280 0000 0005  00                   LB,'1000'X        FPT_USER+5
  15821   2 000549       1000
          2 00054A  0501 0049                            BBT      s:15854,PREL
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:101  

      737    15822    3            THEN DO;

      738    15823    3              IF CTB$ -> KH$CTBCTX.PERM = %YES#

  15823   2 00054C  CCC7 000A                            LDB,B4   CTB$,AUTO
          2 00054E  82C4 000C                            LB,'0010'X        12,B4
          2 000550       0010
          2 000551  0581 0018                            BBF      s:15831,PREL
          2 000553  8280 0000 0005  00                   LB,'4000'X        FPT_USER+5
          2 000556       4000
          2 000557  0501 0012                            BBT      s:15831,PREL
          2 000559  8280 0000 0005  00                   LB,'2000'X        FPT_USER+5
          2 00055C       2000
          2 00055D  0501 000C                            BBT      s:15831,PREL

      739    15824    3              AND NOT (FPT_USER.ABORT OR FPT_USER.RESET)
      740    15825    4              THEN DO;

      741    15826    4                CTB$ -> KH$CTBCTX.UTS = CTB$ -> KH$CTBCTX.UTS

  15826   2 00055F  8CC4 0004                            LDI      4,B4
          2 000561  8444 0006                            AID      6,B4
          2 000563  8D44 0004                            SDI      4,B4

      742    15827    4                                          + CTB$ -> KH$CTBCTX.PRD;
      743    15828    4                CALL QUEUE_CTB;

  15828   2 000565  E3C0 007A                            LNJ,B6   s:0,PREL
          2 000567       0001                            DC       s:15829,PREL

      744    15829    4                END;

  15829   2 000568  0F81 002B                            B        s:15854,PREL

      745    15830    4              ELSE DO;

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:102  
      746    15831    4                IF FPT_USER.RESET

  15831   2 00056A  8280 0000 0005  00                   LB,'2000'X        FPT_USER+5
  15831   2 00056D       2000
          2 00056E  0581 000A                            BBF      s:15841,PREL

      747    15832    5                THEN DO;

      748    15833    5                  CALL QUEUE_CTB;

  15833   2 000570  E3C0 006F                            LNJ,B6   s:0,PREL
          2 000572       0001                            DC       s:15834,PREL

      749    15834    5                  FPT_USER.RESET = '0'B;

  15834   2 000573  8800 0000 0005  00                   LBF,'2000'X       FPT_USER+5
  15834   2 000576       2000

      750    15835    5                  END;

  15835   2 000577  0F81 001C                            B        s:15854,PREL

      751    15836    5                ELSE DO;

      752    15837                                             /*
      753    15838                                                If Clock Services allocated the
      754    15839                                                CTB, then release it.
      755    15840                                                                            */
      756    15841    5                  IF CTB$ -> KH$CTBCTX.DYNAMIC

  15841   2 000579  82C4 000C                            LB,'0040'X        12,B4
  15841   2 00057B       0040
          2 00057C  0581 0017                            BBF      s:15854,PREL

      757    15842    6                  THEN DO;

      758    15843    6                    CTB$ -> INHWORD = SIZEW(KH$CTBCTX);
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:103  

  15843   2 00057E  6C0E                                 LDV,R6   14
          2 00057F  EF04                                 STR,R6   ,B4

      759    15844    6                    CALL KVB$RLSSYS (CTB$ -> INHWORD)

  15844   2 000580  BBC7 000A                            LAB,B3   CTB$,AUTO
          2 000582  CBF0 0100                            LAB,B4   256,IMO
          2 000584  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000587       0003                            DC       s:15848,PREL
          2 000588  0F81 0001                            B        s:15848,PREL

      760    15845    7                    WHENALTRETURN DO;

      761    15846        /*N*               CALL M$WRTSYSLOG (FPT_WRTSYSLOG); */
      762    15847    7                      END;

      763    15848    6                    KV$BPC.CLKCTX = KV$BPC.CLKCTX - 1;

  15848   2 00058A  EC80 0000 0000  xsym                 LDB,B6   KV_B_POOL$
          2 00058D  8CC6 0016                            LDI      22,B6
          2 00058F  8470 FFFF FFFF                       AID      -1,IMO
          2 000592  8D46 0016                            SDI      22,B6

      764    15849    6                    END;  /* ~ CTB$ -> KH$CTBCTX.DYNAMIC */

      765    15850    5                END;  /* ELSE DO */

      766    15851    4              END;  /* ELSE DO */

      767    15852    3            END;  /* IF ~ FPT_USER.DELETE */

      768    15853
      769    15854    2        RETURN;

  15854   2 000594  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 000596  C3C6 0001                            LNJ,B4   1,B6
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:104  

      770    15855    2   END FINISH_EXPIRATION;
      771    15856        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:105  
      772    15857    1   FIND_CTB$: PROC ALTRET;

  15857   2 000598  EFC7 0014            FIND_CTB$       STB,B6   CURR_UTS+2,AUTO

      773    15858    2   DCL C$ PTR;
      774    15859
      775    15860    2      C$ = KH_C.CTBHD$;

  15860   2 00059A  DC80 0000 000A  00                   LDB,B5   KH_C
          2 00059D  DFC7 0016                            STB,B5   C$,AUTO

      776    15861    3      DO WHILE (C$ ~= ADDR(NIL));

  15861   2 00059F  0F81 000E                            B        s:15866,PREL

      777    15862    3        IF C$ = CTB$

  15862   2 0005A1  ECC7 0016                            LDB,B6   C$,AUTO
          2 0005A3  EDC7 000A                            CMB,B6   CTB$,AUTO
          2 0005A5  0981 0005                            BNE      s:15865,PREL

      778    15863    3        THEN
      779    15864    3          RETURN;

  15864   2 0005A7  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 0005A9  C3C6 0001                            LNJ,B4   1,B6

      780    15865    3        C$ = C$ -> KH$CTBCTX.FLNK$;

  15865   2 0005AB  DC86                                 LDB,B5   ,B6
          2 0005AC  DFC7 0016                            STB,B5   C$,AUTO

      781    15866    3        END;

  15866   2 0005AE  8DC7 0016                            CMN      C$,AUTO
          2 0005B0  09F1                                 BNE      s:15862,SPREL

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:106  
      782    15867
      783    15868    2      ALTRETURN;

  15868   2 0005B1  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 0005B3  B806                                 LDR,R3   ,B6
          2 0005B4  C3B6                                 LNJ,B4   ,B6,R3

      784    15869    2   END FIND_CTB$;
      785    15870        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:107  
      786    15871    1   FIND_UID_UVAL: PROC ALTRET;

  15871   2 0005B5  EFC7 0014            FIND_UID_UVAL   STB,B6   CURR_UTS+2,AUTO

      787    15872
      788    15873    2   DCL C$ PTR;
      789    15874
      790    15875    2      C$ = KH_C.CTBHD$;

  15875   2 0005B7  DC80 0000 000A  00                   LDB,B5   KH_C
          2 0005BA  DFC7 0016                            STB,B5   C$,AUTO

      791    15876
      792    15877    3      DO WHILE (C$ ~= ADDR(NIL));

  15877   2 0005BC  0F81 001C                            B        s:15887,PREL

      793    15878    3        IF ADDR(C$ -> KH$CTBCTX.UID) -> DWORD = ADDR(KH_CLK.UID) -> DWORD

  15878   2 0005BE  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0005C0  DCC7 0016                            LDB,B5   C$,AUTO
          2 0005C2  8CC5 000A                            LDI      10,B5
          2 0005C4  84C6 0002                            SID      2,B6
          2 0005C6  6981 000F                            BNEZ,R6  s:15885,PREL
          2 0005C8  7981 000D                            BNEZ,R7  s:15885,PREL
          2 0005CA  E845 000D                            LDR,R6   13,B5
          2 0005CC  E946 0004                            CMR,R6   4,B6
          2 0005CE  0981 0007                            BNE      s:15885,PREL

      794    15879    3        AND C$ -> KH$CTBCTX.UVAL = KH_CLK.UVAL
      795    15880    4        THEN DO;

      796    15881    4          CTB$ = C$;

  15881   2 0005D0  DFC7 000A                            STB,B5   CTB$,AUTO

      797    15882    4          RETURN;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:108  

  15882   2 0005D2  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 0005D4  C3C6 0001                            LNJ,B4   1,B6

      798    15883    4          END;
      799    15884    4        ELSE DO;

      800    15885    4          C$ = C$ -> KH$CTBCTX.FLNK$;

  15885   2 0005D6  CC85                                 LDB,B4   ,B5
          2 0005D7  CFC7 0016                            STB,B4   C$,AUTO

      801    15886    4          END;

      802    15887    3        END;

  15887   2 0005D9  8DC7 0016                            CMN      C$,AUTO
          2 0005DB  09E3                                 BNE      s:15878,SPREL

      803    15888
      804    15889    2      ALTRETURN;

  15889   2 0005DC  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 0005DE  B806                                 LDR,R3   ,B6
          2 0005DF  C3B6                                 LNJ,B4   ,B6,R3

      805    15890    2   END FIND_UID_UVAL;
      806    15891        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:109  
      807    15892
      808    15893             /* QUEUE_CTB  (Enter here disabled) */
      809    15894    1   QUEUE_CTB: PROC ALTRET;

  15894   2 0005E0  EFC7 0016            QUEUE_CTB       STB,B6   C$,AUTO

      810    15895
      811    15896    2   DCL C$ PTR;
      812    15897
      813    15898    2      CTB$ -> KH$CTBCTX.FLNK$ = ADDR(NIL);

  15898   2 0005E2  DB80 0000 0000                       LAB,B5   0
          2 0005E5  CCC7 000A                            LDB,B4   CTB$,AUTO
          2 0005E7  DF84                                 STB,B5   ,B4

      814    15899    2      CTB$ -> KH$CTBCTX.BLNK$ = ADDR(NIL);

  15899   2 0005E8  EB80 0000 0000                       LAB,B6   0
          2 0005EB  EFC4 0002                            STB,B6   2,B4

      815    15900
      816    15901                                           /*
      817    15902                                             Nothing on queue
      818    15903                                                                          */
      819    15904    2      IF KH_C.CTBHD$ = ADDR(NIL)

  15904   2 0005ED  8D80 0000 000A  00                   CMN      KH_C
          2 0005F0  0981 0009                            BNE      s:15913,PREL

      820    15905    3      THEN DO;

      821    15906    3        KH_C.CTBHD$ = CTB$;

  15906   2 0005F2  CF80 0000 000A  00                   STB,B4   KH_C

      822    15907    3        KH_C.CTBTL$ = CTB$;

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:110  
  15907   2 0005F5  CF80 0000 000C  00                   STB,B4   KH_C+2

      823    15908    3        END;

  15908   2 0005F8  0F81 006A                            B        s:15955,PREL

      824    15909    3      ELSE DO;

      825    15910                                           /*
      826    15911                                             Make this the last queue entry
      827    15912                                                                          */
      828    15913    3        IF CTB$ -> KH$CTBCTX.UTS >= KH_C.CTBTL$ -> KH$CTBCTX.UTS

  15913   2 0005FA  BC80 0000 000C  00                   LDB,B3   KH_C+2
          2 0005FD  8CC4 0004                            LDI      4,B4
          2 0005FF  84C3 0004                            SID      4,B3
          2 000601  0681 000C                            BCF      s:15923,PREL

      829    15914    4        THEN DO;

      830    15915    4          KH_C.CTBTL$ -> KH$CTBCTX.FLNK$ = CTB$;

  15915   2 000603  CF83                                 STB,B4   ,B3

      831    15916    4          CTB$ -> KH$CTBCTX.BLNK$ = KH_C.CTBTL$;

  15916   2 000604  EC80 0000 000C  00                   LDB,B6   KH_C+2
          2 000607  EFC4 0002                            STB,B6   2,B4

      832    15917    4          KH_C.CTBTL$ = CTB$;

  15917   2 000609  CF80 0000 000C  00                   STB,B4   KH_C+2

      833    15918    4          END;

  15918   2 00060C  0F81 0056                            B        s:15955,PREL

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:111  
      834    15919    4        ELSE DO;

      835    15920                                           /*
      836    15921                                             Make this the 1st queue entry
      837    15922                                                                          */
      838    15923    4          IF KH_C.CTBHD$ -> KH$CTBCTX.UTS >= CTB$ -> KH$CTBCTX.UTS

  15923   2 00060E  AC80 0000 000A  00                   LDB,B2   KH_C
          2 000611  8CC2 0004                            LDI      4,B2
          2 000613  84C4 0004                            SID      4,B4
          2 000615  0681 0025                            BCF      s:15936,PREL

      839    15924    5          THEN DO;

      840    15925    5            CTB$ -> KH$CTBCTX.FLNK$ = KH_C.CTBHD$;

  15925   2 000617  AF84                                 STB,B2   ,B4

      841    15926    5            KH_C.CTBHD$ -> KH$CTBCTX.BLNK$ = CTB$;

  15926   2 000618  DC80 0000 000A  00                   LDB,B5   KH_C
          2 00061B  CFC5 0002                            STB,B4   2,B5

      842    15927    5            KH_C.CTBHD$ = CTB$;

  15927   2 00061D  CF80 0000 000A  00                   STB,B4   KH_C

      843    15928    5            UTS_VALUE = CTB$ -> KH$CTBCTX.UTS;

  15928   2 000620  8CC4 0004                            LDI      4,B4
          2 000622  8D00 0000 0007  00                   SDI      UTS_VALUE

      844    15929    5            IF SUSPENDED

  15929   2 000625  8980 0000 0009  00                   CMZ      SUSPENDED
          2 000628  0881 003A                            BAGE     s:15955,PREL

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:112  
      845    15930    6            THEN DO;

      846    15931    6        UTS_VALUE = UTS_VALUE + G$MHJIT.BOOTUTS;

  15931   2 00062A  EC80 0000 0000  xsym                 LDB,B6   G$MHJIT$
          2 00062D  8446 035A                            AID      858,B6
          2 00062F  8D00 0000 0007  00                   SDI      UTS_VALUE

      847    15932    6              CALL M$WAIT (ADJUST);

  15932   2 000632  BB80 0000 000A  01                   LAB,B3   ADJUST
          2 000635  B870 0CC5                            LDR,R3   3269,IMO
          2 000637  0001                                 MCL
          2 000638       0000                            DC       s:15932+6,PREL

      848    15933    6              END;

      849    15934    5            END;

  15934   2 000639  0F81 0029                            B        s:15955,PREL

      850    15935    5          ELSE DO;

      851    15936    5            C$ = KH_C.CTBHD$ -> KH$CTBCTX.FLNK$;

  15936   2 00063B  9C82                                 LDB,B1   ,B2
          2 00063C  9FC7 0018                            STB,B1   C$,AUTO

      852    15937    6            DO WHILE (C$ ~= ADDR(NIL));

  15937   2 00063E  0F81 0021                            B        s:15951,PREL

      853    15938    6              IF CTB$ -> KH$CTBCTX.UTS < C$ -> KH$CTBCTX.UTS

  15938   2 000640  ECC7 0018                            LDB,B6   C$,AUTO
          2 000642  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 000644  8CC5 0004                            LDI      4,B5
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:113  
          2 000646  84C6 0004                            SID      4,B6
          2 000648  0601 0014                            BCT      s:15948,PREL

      854    15939    7              THEN DO;

      855    15940    7                CTB$ -> KH$CTBCTX.FLNK$ = C$;

  15940   2 00064A  EF85                                 STB,B6   ,B5

      856    15941    7                CTB$ -> KH$CTBCTX.BLNK$ = C$ -> KH$CTBCTX.BLNK$;

  15941   2 00064B  CCC6 0002                            LDB,B4   2,B6
          2 00064D  CFC5 0002                            STB,B4   2,B5

      857    15942    7                C$ -> KH$CTBCTX.BLNK$ = CTB$;

  15942   2 00064F  DFC6 0002                            STB,B5   2,B6

      858    15943    7                C$ = CTB$ -> KH$CTBCTX.BLNK$;

  15943   2 000651  CCC5 0002                            LDB,B4   2,B5
          2 000653  CFC7 0018                            STB,B4   C$,AUTO

      859    15944    7                C$ -> KH$CTBCTX.FLNK$ = CTB$;

  15944   2 000655  DF84                                 STB,B5   ,B4

      860    15945    7                C$ = ADDR(NIL);

  15945   2 000656  EB80 0000 0000                       LAB,B6   0
          2 000659  EFC7 0018                            STB,B6   C$,AUTO

      861    15946    7                END;

  15946   2 00065B  0F81 0004                            B        s:15951,PREL

      862    15947    7              ELSE DO;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:114  

      863    15948    7                C$ = C$ -> KH$CTBCTX.FLNK$;

  15948   2 00065D  CC86                                 LDB,B4   ,B6
          2 00065E  CFC7 0018                            STB,B4   C$,AUTO

      864    15949    7                END;

      865    15950
      866    15951    6              END;

  15951   2 000660  8DC7 0018                            CMN      C$,AUTO
          2 000662  09DE                                 BNE      s:15938,SPREL

      867    15952    5            END;

      868    15953    4          END;

      869    15954    3        END;

      870    15955    2        CTB$ -> KH$CTBCTX.TOKEN = %KH#C_ACTIVE;

  15955   2 000663  ECC7 000A                            LDB,B6   CTB$,AUTO
          2 000665  8946 000C                            LBT,'0020'X       12,B6
          2 000667       0020

      871    15956    2        RETURN;

  15956   2 000668  ECC7 0016                            LDB,B6   C$,AUTO
          2 00066A  C3C6 0001                            LNJ,B4   1,B6

      872    15957
      873    15958    2   END QUEUE_CTB;
      874    15959        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:115  
      875    15960
      876    15961             /* DEQUEUE CTB  (Enter here disabled) */
      877    15962
      878    15963    1   DEQUEUE_CTB: PROC ALTRET;

  15963   2 00066C  EFC7 0014            DEQUEUE_CTB     STB,B6   CURR_UTS+2,AUTO

      879    15964
      880    15965    2        IF CTB$ = KH_C.CTBHD$

  15965   2 00066E  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 000670  DD80 0000 000A  00                   CMB,B5   KH_C
          2 000673  0981 001C                            BNE      s:15975,PREL

      881    15966    3      THEN DO;

      882    15967    3        KH_C.CTBHD$ = KH_C.CTBHD$ -> KH$CTBCTX.FLNK$;

  15967   2 000675  CC80 0000 000A  00                   LDB,B4   KH_C
          2 000678  BC84                                 LDB,B3   ,B4
          2 000679  BF80 0000 000A  00                   STB,B3   KH_C

      883    15968    3          IF KH_C.CTBHD$ ~= ADDR(NIL)

  15968   2 00067C  8D80 0000 000A  00                   CMN      KH_C
          2 00067F  0901 0008                            BE       s:15972,PREL

      884    15969    3          THEN
      885    15970    3            KH_C.CTBHD$ -> KH$CTBCTX.BLNK$ = ADDR(NIL);

  15970   2 000681  CB80 0000 0000                       LAB,B4   0
          2 000684  CFC3 0002                            STB,B4   2,B3
          2 000686  0F81 0039                            B        s:15996,PREL

      886    15971    3          ELSE
      887    15972    3            KH_C.CTBTL$ = ADDR(NIL);

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:116  
  15972   2 000688  CB80 0000 0000                       LAB,B4   0
          2 00068B  CF80 0000 000C  00                   STB,B4   KH_C+2

      888    15973    3        END;

  15973   2 00068E  0F81 0031                            B        s:15996,PREL

      889    15974    3      ELSE DO;

      890    15975    3        IF CTB$ = KH_C.CTBTL$

  15975   2 000690  DD80 0000 000C  00                   CMB,B5   KH_C+2
          2 000693  0981 001C                            BNE      s:15985,PREL

      891    15976    4        THEN DO;

      892    15977    4          KH_C.CTBTL$ = KH_C.CTBTL$ -> KH$CTBCTX.BLNK$;

  15977   2 000695  CC80 0000 000C  00                   LDB,B4   KH_C+2
          2 000698  BCC4 0002                            LDB,B3   2,B4
          2 00069A  BF80 0000 000C  00                   STB,B3   KH_C+2

      893    15978    4          IF KH_C.CTBTL$ ~= ADDR(NIL)

  15978   2 00069D  8D80 0000 000C  00                   CMN      KH_C+2
          2 0006A0  0901 0007                            BE       s:15982,PREL

      894    15979    4          THEN
      895    15980    4            KH_C.CTBTL$ -> KH$CTBCTX.FLNK$ = ADDR(NIL);

  15980   2 0006A2  CB80 0000 0000                       LAB,B4   0
          2 0006A5  CF83                                 STB,B4   ,B3
          2 0006A6  0F81 0019                            B        s:15996,PREL

      896    15981    4          ELSE
      897    15982    4            KH_C.CTBHD$ = ADDR(NIL);

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:117  
  15982   2 0006A8  CB80 0000 0000                       LAB,B4   0
          2 0006AB  CF80 0000 000A  00                   STB,B4   KH_C

      898    15983    4          END;

  15983   2 0006AE  0F81 0011                            B        s:15996,PREL

      899    15984    4        ELSE DO;

      900    15985    4        IF CTB$ -> KH$CTBCTX.BLNK$ ~= ADDR(NIL)

  15985   2 0006B0  8DC5 0002                            CMN      2,B5
          2 0006B2  0901 0005                            BE       s:15989,PREL

      901    15986    4        THEN
      902    15987    4          CTB$ -> KH$CTBCTX.BLNK$ -> KH$CTBCTX.FLNK$

  15987   2 0006B4  CCC5 0002                            LDB,B4   2,B5
          2 0006B6  BC85                                 LDB,B3   ,B5
          2 0006B7  BF84                                 STB,B3   ,B4

      903    15988    4                 = CTB$ -> KH$CTBCTX.FLNK$;
      904    15989    4        IF CTB$ -> KH$CTBCTX.FLNK$ ~= ADDR(NIL)

  15989   2 0006B8  8D85                                 CMN      ,B5
          2 0006B9  0901 0006                            BE       s:15996,PREL

      905    15990    4        THEN
      906    15991    4          CTB$ -> KH$CTBCTX.FLNK$ -> KH$CTBCTX.BLNK$

  15991   2 0006BB  EC85                                 LDB,B6   ,B5
          2 0006BC  CCC5 0002                            LDB,B4   2,B5
          2 0006BE  CFC6 0002                            STB,B4   2,B6

      907    15992    4                 = CTB$ -> KH$CTBCTX.BLNK$;
      908    15993    4          END;

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:118  
      909    15994    3        END;

      910    15995
      911    15996    2      CTB$ -> KH$CTBCTX.TOKEN = %KH#C_INACTIVE;

  15996   2 0006C0  8845 000C                            LBF,'0020'X       12,B5
  15996   2 0006C2       0020

      912    15997    2      RETURN;

  15997   2 0006C3  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 0006C5  C3C6 0001                            LNJ,B4   1,B6

      913    15998
      914    15999    2   END DEQUEUE_CTB;
      915    16000        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:119  
      916    16001
      917    16002             /* CHECK_CTB */
      918    16003
      919    16004    1   CHECK_CTB: PROC ALTRET;

  16004   2 0006C7  EFC7 0014            CHECK_CTB       STB,B6   CURR_UTS+2,AUTO

      920    16005
      921    16006    2   DCL C$ PTR;
      922    16007
      923    16008    2      C$ = KH_C.CTBHD$;

  16008   2 0006C9  DC80 0000 000A  00                   LDB,B5   KH_C
          2 0006CC  DFC7 0016                            STB,B5   C$,AUTO

      924    16009    3      DO WHILE (C$ ~= ADDR(NIL));

  16009   2 0006CE  0F81 0025                            B        s:16026,PREL

      925    16010    3        IF C$ = CTB$

  16010   2 0006D0  ECC7 0016                            LDB,B6   C$,AUTO
          2 0006D2  EDC7 000A                            CMB,B6   CTB$,AUTO
          2 0006D4  0981 001C                            BNE      s:16024,PREL

      926    16011    4        THEN DO;

      927    16012    4          IF CTB$ -> KH$CTBCTX.SBR$ = ENTADDR(NIL)

  16012   2 0006D6  DCC7 000A                            LDB,B5   CTB$,AUTO
          2 0006D8  CCC5 0008                            LDB,B4   8,B5
          2 0006DA  CD80 0000 0000  03                   CMB,B4   0
          2 0006DD  0901 0006                            BE       s:16016,PREL
          2 0006DF  82C5 000C                            LB,'0020'X        12,B5
          2 0006E1       0020
          2 0006E2  0501 000A                            BBT      s:16020,PREL

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:120  
      928    16013    4          OR CTB$ -> KH$CTBCTX.TOKEN = %KH#C_INACTIVE
      929    16014    5          THEN DO;

      930    16015                 /* SNAP */
      931    16016    5            KH_CLK.RESULT = %KH#RES_BADQ;

  16016   2 0006E4  6C02                                 LDV,R6   2
          2 0006E5  BCC7 0004                            LDB,B3   @KH_ARG,AUTO
          2 0006E7  E7C3 0005                            STH,R6   5,B3

      932    16017    5            ALTRETURN;

  16017   2 0006E9  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 0006EB  B806                                 LDR,R3   ,B6
          2 0006EC  C3B6                                 LNJ,B4   ,B6,R3

      933    16018    5            END;
      934    16019    5          ELSE DO;

      935    16020    5            RETURN;

  16020   2 0006ED  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 0006EF  C3C6 0001                            LNJ,B4   1,B6

      936    16021    5            END;
      937    16022    4          END;
      938    16023    4        ELSE DO;

      939    16024    4          C$ = C$ -> KH$CTBCTX.FLNK$;

  16024   2 0006F1  DC86                                 LDB,B5   ,B6
          2 0006F2  DFC7 0016                            STB,B5   C$,AUTO

      940    16025    4          END;

      941    16026    3        END;

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:121  
  16026   2 0006F4  8DC7 0016                            CMN      C$,AUTO
          2 0006F6  09DA                                 BNE      s:16010,SPREL

      942    16027
      943    16028           /* SNAP */
      944    16029    2      KH_CLK.RESULT = %KH#RES_NOQ;

  16029   2 0006F7  6C03                                 LDV,R6   3
          2 0006F8  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0006FA  E7C6 0005                            STH,R6   5,B6

      945    16030    2      ALTRETURN;

  16030   2 0006FC  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 0006FE  B806                                 LDR,R3   ,B6
          2 0006FF  C3B6                                 LNJ,B4   ,B6,R3

      946    16031
      947    16032    2   END CHECK_CTB;
      948    16033        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:122  
      949    16034        /*F* NAME: Return_UTS - KCH$UTS KHC$DLTUTS KHC$TIMEn KHC$DLTTIMEn
      950    16035
      951    16036        These services return the UTS (Universal Time Stamp) into
      952    16037        an area specified by the user.
      953    16038        It is not necessary to disable interrupts before calling
      954    16039        these services; the services compensate for any interrupts that occur.
      955    16040
      956    16041        KHC$UTS returns the top 32 bits of the (36-bit) current real time.
      957    16042        The returned value is in units of .133 second.
      958    16043
      959    16044        KHC$DLTUTS calculates the difference between the current UTS and the
      960    16045        value passed as a parameter (the results of a previous call to
      961    16046        KHC$UTS).  The result is stored in the same 2-word area as the
      962    16047        parameter.
      963    16048
      964    16049        KHC$TIME1 returns the low 16 bits of the current real time.
      965    16050        The returned value is in units of 1/120 second.
      966    16051
      967    16052        KHC$TIME2 returns the low 32 bits of the current real time.
      968    16053        The returned value is in units of 1/120 second.
      969    16054
      970    16055        KHC$DLTTIME1 calculates the difference between the current UTS and the
      971    16056        value passed as a parameter (the results of a previous call to
      972    16057        KHC$TIME1).  The result is stored in the same 1-word area as the
      973    16058        parameter.
      974    16059
      975    16060        KHC$DLTTIME2 calculates the difference between the current UTS and the
      976    16061        value passed as a parameter (the results of a previous call to
      977    16062        KHC$TIME2).  The result is stored in the same 1-word area as the
      978    16063        parameter.
      979    16064
      980    16065        The form of the call for these services is
      981    16066
      982    16067            CALL KHC$routine (arg) ALTRET (label);
      983    16068
      984    16069        where:
      985    16070
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:123  
      986    16071        arg - is either a one-word or two-word area as explained above.
      987    16072        */
      988    16073    1   KHC$UTS: ENTRY(KH_ARG) ALTRET;

  16073   2 000700  D380 0000 0000  xent KHC$UTS         LNJ,B5   X6A_AUTO_1
          2 000703       001E 0001                       DC       30,1

      989    16074    1      CALL GET_UTS_PARTS;

  16074   2 000705  E3C0 007F                            LNJ,B6   s:0,PREL
          2 000707       0001                            DC       s:16075,PREL

      990    16075    1      PARM_TIME2 = CURR_UTS+(UTS_TIX+8)/16;

  16075   2 000708  E847 0011                            LDR,R6   UTS_TIX,AUTO
          2 00070A  6E08                                 ADV,R6   8
          2 00070B  6044                                 SOR,R6   4
          2 00070C  F856                                 LDR,R7   R6
          2 00070D  6C00                                 LDV,R6   0
          2 00070E  8447 0012                            AID      CURR_UTS,AUTO
          2 000710  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000712  8D06                                 SDI      ,B6

      991    16076    1      RETURN;

  16076   2 000713  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      992    16077
      993    16078    1   KHC$DLTUTS: ENTRY(KH_ARG) ALTRET;

  16078   2 000716  D380 0000 0000  xent KHC$DLTUTS      LNJ,B5   X6A_AUTO_1
          2 000719       001E 0001                       DC       30,1

      994    16079    1      CALL GET_UTS_PARTS;

  16079   2 00071B  E3C0 0069                            LNJ,B6   s:0,PREL
          2 00071D       0001                            DC       s:16080,PREL
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:124  

      995    16080    1      PARM_TIME2 = CURR_UTS+(UTS_TIX+8)/16-PARM_TIME2;

  16080   2 00071E  E847 0011                            LDR,R6   UTS_TIX,AUTO
          2 000720  6E08                                 ADV,R6   8
          2 000721  6044                                 SOR,R6   4
          2 000722  F856                                 LDR,R7   R6
          2 000723  6C00                                 LDV,R6   0
          2 000724  8447 0012                            AID      CURR_UTS,AUTO
          2 000726  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000728  8486                                 SID      ,B6
          2 000729  8D06                                 SDI      ,B6

      996    16081    1      RETURN;

  16081   2 00072A  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      997    16082
      998    16083    1   KHC$TIME1: ENTRY (KH_ARG) ALTRET;

  16083   2 00072D  D380 0000 0000  xent KHC$TIME1       LNJ,B5   X6A_AUTO_1
          2 000730       001E 0001                       DC       30,1

      999    16084    1      CALL GET_UTS_PARTS;

  16084   2 000732  E3C0 0052                            LNJ,B6   s:0,PREL
          2 000734       0001                            DC       s:16085,PREL

     1000    16085    1      PARM_TIME1 = CURR_UTSR.TICKS*16 + UTS_TIX;

  16085   2 000735  E847 0013                            LDR,R6   CURR_UTS+1,AUTO
          2 000737  6004                                 SOL,R6   4
          2 000738  EA47 0011                            ADD,R6   UTS_TIX,AUTO
          2 00073A  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 00073C  EF06                                 STR,R6   ,B6

     1001    16086    1      RETURN;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:125  

  16086   2 00073D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1002    16087
     1003    16088    1   KHC$TIME2: ENTRY (KH_ARG) ALTRET;

  16088   2 000740  D380 0000 0000  xent KHC$TIME2       LNJ,B5   X6A_AUTO_1
          2 000743       001E 0001                       DC       30,1

     1004    16089    1      CALL GET_UTS_PARTS;

  16089   2 000745  E3C0 003F                            LNJ,B6   s:0,PREL
          2 000747       0001                            DC       s:16090,PREL

     1005    16090    1      PARM_TIME2 = CURR_UTS*16 + UTS_TIX;

  16090   2 000748  F847 0011                            LDR,R7   UTS_TIX,AUTO
          2 00074A  6C00                                 LDV,R6   0
          2 00074B  8D47 001A                            SDI      C$+2,AUTO
          2 00074D  8CC7 0012                            LDI      CURR_UTS,AUTO
          2 00074F  7084                                 DOL,R7   4
          2 000750  8447 001A                            AID      C$+2,AUTO
          2 000752  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000754  8D06                                 SDI      ,B6

     1006    16091    1      RETURN;

  16091   2 000755  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1007    16092
     1008    16093    1   KHC$DLTTIME1: ENTRY (KH_ARG) ALTRET;

  16093   2 000758  D380 0000 0000  xent KHC$DLTTIME1    LNJ,B5   X6A_AUTO_1
          2 00075B       001E 0001                       DC       30,1

     1009    16094    1      CALL GET_UTS_PARTS;

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:126  
  16094   2 00075D  E3C0 0027                            LNJ,B6   s:0,PREL
          2 00075F       0001                            DC       s:16095,PREL

     1010    16095    1      PARM_TIME1 = CURR_UTSR.TICKS*16 + UTS_TIX - PARM_TIME1;

  16095   2 000760  E847 0013                            LDR,R6   CURR_UTS+1,AUTO
          2 000762  6004                                 SOL,R6   4
          2 000763  EA47 0011                            ADD,R6   UTS_TIX,AUTO
          2 000765  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000767  E206                                 SUB,R6   ,B6
          2 000768  EF06                                 STR,R6   ,B6

     1011    16096    1      RETURN;

  16096   2 000769  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1012    16097
     1013    16098    1   KHC$DLTTIME2: ENTRY (KH_ARG) ALTRET;

  16098   2 00076C  D380 0000 0000  xent KHC$DLTTIME2    LNJ,B5   X6A_AUTO_1
          2 00076F       001E 0001                       DC       30,1

     1014    16099    1      CALL GET_UTS_PARTS;

  16099   2 000771  E3C0 0013                            LNJ,B6   s:0,PREL
          2 000773       0001                            DC       s:16100,PREL

     1015    16100    1      PARM_TIME2 = CURR_UTS*16 + UTS_TIX - PARM_TIME2;

  16100   2 000774  F847 0011                            LDR,R7   UTS_TIX,AUTO
          2 000776  6C00                                 LDV,R6   0
          2 000777  8D47 001A                            SDI      C$+2,AUTO
          2 000779  8CC7 0012                            LDI      CURR_UTS,AUTO
          2 00077B  7084                                 DOL,R7   4
          2 00077C  8447 001A                            AID      C$+2,AUTO
          2 00077E  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 000780  8486                                 SID      ,B6
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:127  
          2 000781  8D06                                 SDI      ,B6

     1016    16101    1      RETURN;

  16101   2 000782  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1017    16102
     1018    16103        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:128  
     1019    16104        /*I*   NAME: GET_UTS_PARTS.
     1020    16105               PURPOSE: Sets CURR_UTS to the contents of MHJIT.UTS and UTS_TIX
     1021    16106                        to a corresponding sum of MHJIT.TICKS and LOW_MEM.WDTC.
     1022    16107        */
     1023    16108
     1024    16109    1   GET_UTS_PARTS: PROC;

  16109   2 000785  EFC7 0014            GET_UTS_PARTS   STB,B6   CURR_UTS+2,AUTO

     1025    16110    2   DCL 1 TEMP,
     1026    16111    2      2 TOP UBIN(16),
     1027    16112    2      2 BTM UBIN(16);
     1028    16113    2   DCL DWORD UBIN(32) BASED ALIGNED;
     1029    16114
     1030    16115    2      TEMP = '0'B;

  16115   2 000787  8747 0016                            CL       TEMP,AUTO
          2 000789  8747 0017                            CL       TUEXT+1,AUTO

     1031    16116    3      DO WHILE ADDR(TEMP)->DWORD~=PINCRW(ADDR(G$MHJIT.UTS),1)->DWORD;

  16116   2 00078B  DC80 0000 0000  xsym                 LDB,B5   G$MHJIT$
          2 00078E  8CC7 0016                            LDI      TEMP,AUTO
          2 000790  84C5 0357                            SID      855,B5
          2 000792  6981 0003                            BNEZ,R6  s:16117,PREL
          2 000794  7901 001D                            BEZ,R7   s:16124,PREL

     1032    16117    3         ADDR(TEMP)->DWORD = PINCRW(ADDR(G$MHJIT.UTS),1)->DWORD;

  16117   2 000796  EC80 0000 0000  xsym                 LDB,B6   G$MHJIT$
          2 000799  8CC6 0357                            LDI      855,B6
          2 00079B  8D47 0016                            SDI      TEMP,AUTO

     1033    16118        /* MHJIT.TICKS is in the word after UTS. Loading TEMP with a LDI instruction
     1034    16119           allows us to check that no interrupts occur while computing UTS_TIX. */
     1035    16120
     1036    16121    3         CURR_UTS = G$MHJIT.UTS;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:129  

  16121   2 00079D  8CC6 0356                            LDI      854,B6
          2 00079F  8D47 0012                            SDI      CURR_UTS,AUTO

     1037    16122    3         UTS_TIX = TEMP.BTM + G$MHJIT.WDT_INIT - G$LOW_MEM.WDT_CURR;

  16122   2 0007A1  D847 0017                            LDR,R5   TUEXT+1,AUTO
          2 0007A3  DA46 0359                            ADD,R5   857,B6
          2 0007A5  DC80 0000 0000  xsym                 LDB,B5   G$LOW_MEM$
          2 0007A8  D245 0017                            SUB,R5   23,B5
          2 0007AA  DF47 0011                            STR,R5   UTS_TIX,AUTO

     1038    16123    3      END;

  16123   2 0007AC  8CC7 0016                            LDI      TEMP,AUTO
          2 0007AE  84C6 0357                            SID      855,B6
          2 0007B0  69E6                                 BNEZ,R6  s:16117,SPREL
          2 0007B1  79E5                                 BNEZ,R7  s:16117,SPREL

     1039    16124    2      RETURN;

  16124   2 0007B2  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 0007B4  C3C6 0001                            LNJ,B4   1,B6

     1040    16125    2   END GET_UTS_PARTS;
     1041    16126
     1042    16127        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:130  
     1043    16128        /*F* NAME: Return_Execution Time - KHC$XEQn KHC$DLTXEQn
     1044    16129
     1045    16130        These services return the elapsed execution time for the current user
     1046    16131        without incurring the overhead required for an MCL.  These
     1047    16132        services are useful for statistics gathering.  The value returned is
     1048    16133        expressed in clock-ticks (1/120 second).
     1049    16134        It is not necessary to disable interrupts before calling
     1050    16135        these services; the services compensate for any interrupts that occur.
     1051    16136
     1052    16137        KHC$XEQ1 returns the execution time in a 1-word result area.
     1053    16138
     1054    16139        KHC$XEQ2 returns the execution time in a 2-word result area.
     1055    16140
     1056    16141        KHC$DLTXEQ1 calculates the difference between the execution time and a
     1057    16142        value passed as a parameter (the results of a previous call to
     1058    16143        KHC$XEQ1).  The result is returned in a 1-word area.
     1059    16144
     1060    16145        KHC$DLTXEQ2 calculates the difference between the execution time and a
     1061    16146        value passed as a parameter (the results of a previous call to
     1062    16147        KHC$XEQ2).  The result is returned in a 2-word area.
     1063    16148
     1064    16149        The form of the call for these services is
     1065    16150
     1066    16151
     1067    16152        The form of the call for these services is
     1068    16153
     1069    16154            CALL KHC$routine (arg) ALTRET (label);
     1070    16155
     1071    16156        where:
     1072    16157
     1073    16158        arg - is either a one-word or two-word area as explained above.
     1074    16159        */
     1075    16160
     1076    16161    1   KHC$XEQ1: ENTRY (KH_ARG) ALTRET;

  16161   2 0007B6  D380 0000 0000  xent KHC$XEQ1        LNJ,B5   X6A_AUTO_1
          2 0007B9       001E 0001                       DC       30,1
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:131  

     1077    16162
     1078    16163    1      CALL GET_XEQ_TIME;

  16163   2 0007BB  E3C0 003C                            LNJ,B6   s:0,PREL
          2 0007BD       0001                            DC       s:16164,PREL

     1079    16164    1      PARM_TIME1 = CURR_UTS;

  16164   2 0007BE  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0007C0  E847 0013                            LDR,R6   CURR_UTS+1,AUTO
          2 0007C2  EF06                                 STR,R6   ,B6

     1080    16165    1      RETURN;

  16165   2 0007C3  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1081    16166
     1082    16167    1   KHC$XEQ2: ENTRY (KH_ARG) ALTRET;

  16167   2 0007C6  D380 0000 0000  xent KHC$XEQ2        LNJ,B5   X6A_AUTO_1
          2 0007C9       001E 0001                       DC       30,1

     1083    16168    1      CALL GET_XEQ_TIME;

  16168   2 0007CB  E3C0 002C                            LNJ,B6   s:0,PREL
          2 0007CD       0001                            DC       s:16169,PREL

     1084    16169    1      PARM_TIME2 = CURR_UTS;

  16169   2 0007CE  8CC7 0012                            LDI      CURR_UTS,AUTO
          2 0007D0  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0007D2  8D06                                 SDI      ,B6

     1085    16170    1      RETURN;

  16170   2 0007D3  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:132  

     1086    16171
     1087    16172    1   KHC$DLTXEQ1: ENTRY (KH_ARG) ALTRET;

  16172   2 0007D6  D380 0000 0000  xent KHC$DLTXEQ1     LNJ,B5   X6A_AUTO_1
          2 0007D9       001E 0001                       DC       30,1

     1088    16173    1      CALL GET_XEQ_TIME;

  16173   2 0007DB  E3C0 001C                            LNJ,B6   s:0,PREL
          2 0007DD       0001                            DC       s:16174,PREL

     1089    16174    1      PARM_TIME1 = CURR_UTSR.TICKS - PARM_TIME1;

  16174   2 0007DE  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
          2 0007E0  E847 0013                            LDR,R6   CURR_UTS+1,AUTO
          2 0007E2  E206                                 SUB,R6   ,B6
          2 0007E3  EF06                                 STR,R6   ,B6

     1090    16175    1      RETURN;

  16175   2 0007E4  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1091    16176
     1092    16177    1   KHC$DLTXEQ2: ENTRY (KH_ARG) ALTRET;

  16177   2 0007E7  D380 0000 0000  xent KHC$DLTXEQ2     LNJ,B5   X6A_AUTO_1
          2 0007EA       001E 0001                       DC       30,1

     1093    16178    1      CALL GET_XEQ_TIME;

  16178   2 0007EC  E3C0 000B                            LNJ,B6   s:0,PREL
          2 0007EE       0001                            DC       s:16179,PREL

     1094    16179    1      PARM_TIME2 = CURR_UTS-PARM_TIME2;

  16179   2 0007EF  ECC7 0004                            LDB,B6   @KH_ARG,AUTO
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:133  
          2 0007F1  8CC7 0012                            LDI      CURR_UTS,AUTO
          2 0007F3  8486                                 SID      ,B6
          2 0007F4  8D06                                 SDI      ,B6

     1095    16180    1      RETURN;

  16180   2 0007F5  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1096    16181
     1097    16182        %EJECT;
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:134  
     1098    16183        /*I*   NAME: GET_XEQ_TIME.
     1099    16184               PURPOSE: Computes current user xeq time into CURR_UTS.
     1100    16185        */
     1101    16186
     1102    16187    1   GET_XEQ_TIME: PROC;

  16187   2 0007F8  EFC7 0014            GET_XEQ_TIME    STB,B6   CURR_UTS+2,AUTO

     1103    16188
     1104    16189    2   DCL TUEXT UBIN;
     1105    16190    2   DCL IDELT UBIN;
     1106    16191    2   DCL UWORD UBIN BASED ALIGNED;
     1107    16192
     1108    16193    3      DO UNTIL IDELT=G$JIT.IDELTAT;

     1109    16194    3         IDELT = G$JIT.IDELTAT;

  16194   2 0007FA  EC80 0000 0000                       LDB,B6   0
          2 0007FD  E846 006F                            LDR,R6   111,B6
          2 0007FF  EF47 0017                            STR,R6   IDELT,AUTO

     1110    16195    3         TUEXT = PINCRW(ADDR(G$JIT.TUEXT),1)->UWORD;

  16195   2 000801  D846 0025                            LDR,R5   37,B6
          2 000803  DF47 0016                            STR,R5   TUEXT,AUTO

     1111    16196    3         CURR_UTS = G$MHJIT.WDT_INIT-G$LOW_MEM.WDT_CURR+

  16196   2 000805  DC80 0000 0000  xsym                 LDB,B5   G$MHJIT$
          2 000808  CC80 0000 0000  xsym                 LDB,B4   G$LOW_MEM$
          2 00080B  C845 0359                            LDR,R4   857,B5
          2 00080D  C244 0017                            SUB,R4   23,B4
          2 00080F  E854                                 LDR,R6   R4
          2 000810  70F0                                 DAR,R7   16
          2 000811  8446 0024                            AID      36,B6
          2 000813  8446 0026                            AID      38,B6
          2 000815  8446 006A                            AID      106,B6
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:135  
          2 000817  8446 006C                            AID      108,B6
          2 000819  8D47 0012                            SDI      CURR_UTS,AUTO

  16196   2                              TRASH_THE_REGS  null
     1112    16197    3           G$JIT.TUEXT+G$JIT.TUSVT+G$JIT.XTIME+G$JIT.STIME;
     1113    16198    3   TRASH_THE_REGS:; /* So that the next test isn't a NOP */
     1114    16199    3         IF TUEXT~=PINCRW(ADDR(G$JIT.TUEXT),1)->UWORD THEN IDELT=0;

  16199   2 00081B  EC80 0000 0000  xsym TRASH_THE_REGS  LDB,B6   G$JIT$
          2 00081E  E847 0016                            LDR,R6   TUEXT,AUTO
          2 000820  E946 0025                            CMR,R6   37,B6
          2 000822  0901 0003                            BE       s:16200,PREL

  16199   2 000824  8747 0017                            CL       IDELT,AUTO

     1115    16200    3         END;

  16200   2 000826  F847 0017                            LDR,R7   IDELT,AUTO
          2 000828  6C00                                 LDV,R6   0
          2 000829  84C6 006E                            SID      110,B6
          2 00082B  69CF                                 BNEZ,R6  s:16194,SPREL
          2 00082C  79CE                                 BNEZ,R7  s:16194,SPREL

     1116    16201    2      RETURN;

  16201   2 00082D  ECC7 0014                            LDB,B6   CURR_UTS+2,AUTO
          2 00082F  C3C6 0001                            LNJ,B4   1,B6

     1117    16202
     1118    16203    2   GET_XEQ_DUMMY_ENTRY: ENTRY;

  16203   2 000831  EFC7 0014            GET_XEQ_DUMMY_E*STB,B6   CURR_UTS+2,AUTO

     1119    16204        /* Dummy entry to make TRASH_THE_REGS do that */
     1120    16205    2      GOTO TRASH_THE_REGS;

  16205   2 000833  0FE8                                 B        s:16196,SPREL
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:136  
     1121    16206
     1122    16207    2   END GET_XEQ_TIME;
     1123    16208    1   END KHC$CLOCK;
     1124    16209
     1125    16210

PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:137  
--  Include file information  --

   KV$BPC.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KHC_MAC_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   G_HJIT_M.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   GH_HARDWARE_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KHC$CLOCK.
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:138  

 **** Variables and constants ****

  ****  Section 000  Data  KHC$CLOCK

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(96)    r     1 FPT_USER                   A-0-0/w STRC(96)    r     1 KH_C
     9-0-0/w BIT         r     1 SUSPENDED                  6-0-0/w UBIN(16)    r     1 UETIME
     7-0-0/w UBIN(32)    r     1 UTS_VALUE

  ****  Section 001 RoData KHC$CLOCK

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     A-0-0/w STRC(160)   r     1 ADJUST                     0-0-0/w STRC(160)   r     1 SUSPEND

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KH_ARG                   16-0-0/w PTR         r     1 @MY_EXP
    10-0-0/w UBIN(16)    r     1 ACCURACY                  16-0-0/w PTR         r     1 C$
    16-0-0/w PTR         r     1 C$                        18-0-0/w PTR         r     1 C$
    16-0-0/w PTR         r     1 C$                         A-0-0/w PTR         r     1 CTB$
    12-0-0/w UBIN(32)    r     1 CURR_UTS                  12-0-0/w STRC(32)    r     1 CURR_UTSR
     7-0-0/w UBIN(16)    r     1 DISABLE_LEVEL             *0-0-0/w STRC(96)    r     1 FPT_VDH
    17-0-0/w UBIN(16)    r     1 IDELT                      6-0-0/w UBIN(16)    r     1 INHIBIT_LEVEL
    *0-0-0/w ACHR        r     1 KH_ARG                    *0-0-0/w STRC(128)   r     1 KH_CANCELCLK
    *0-0-0/w STRC(176)   r     1 KH_CLK                    *0-0-0/w STRC(176)   r     1 KH_RESETCLK
    *0-0-0/w STRC(128)   r     1 KH_RESTARTCLK             *0-0-0/w STRC(176)   r     1 KH_SETCLK
    *0-0-0/w STRC(96)    r     1 MY_EXP                    *0-0-0/w UBIN(16)    r     1 PARM_TIME1
    *0-0-0/w UBIN(32)    r     1 PARM_TIME2                 C-0-0/w UBIN(32)    r     1 PRD
     E-0-0/w UBIN(32)    r     1 PRD1                      16-0-0/w STRC(32)    r     1 TEMP
    16-0-0/w UBIN(16)    r     1 TUEXT                      8-0-0/w EPTR        r     1 USER@
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:139  
    11-0-0/w UBIN(16)    r     1 UTS_TIX

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$JIT$                     0-0-0/w PTR         r     1 G$LOW_MEM$
     0-0-0/w PTR         r     1 G$MHJIT$                   0-0-0/w PTR         r     1 KH_CTLTBL$
     0-0-0/w UBIN(16)    r     1 KH_INHLVL                  0-0-0/w PTR         r     1 KV_B_POOL$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(32)    r     1 DWORD                      0-0-0/w UBIN(32)    r     1 DWORD
     0-0-0/w STRC(5616)  r     1 G$JIT                      0-0-0/w STRC(4096)  r     1 G$LOW_MEM
     0-0-0/w STRC(27232) r     1 G$MHJIT                    0-0-0/w UBIN(16)    r     1 INHWORD
     0-0-0/w STRC(224)   r     1 KH$CTBCTX                  0-0-0/w ASTR(1824)  r     1 KV$BPC
     0-0-0/w UBIN(16)    r     1 UWORD


   Procedure KHC$CLOCK requires 2100 words for executable code.
   Procedure KHC$CLOCK requires 30 words of local(AUTO) storage.

    No errors detected in file KHC$CLOCK.:E05TSI    .
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:140  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:141  
          MINI XREF LISTING

ACCURACY
     15121**DCL     15415<<ASSIGN  15422<<ASSIGN  15427<<ASSIGN  15434>>ASSIGN
ADJUST
     15096**DCL     15932<>CALL
ADJUST.V
     15100**DCL     15099--DCLINIT
C$ IN PROCEDURE CHECK_CTB
     16006**DCL     16008<<ASSIGN  16009>>DOWHILE 16010>>IF      16024<<ASSIGN  16024>>ASSIGN
C$ IN PROCEDURE FIND_CTB$
     15858**DCL     15860<<ASSIGN  15861>>DOWHILE 15862>>IF      15865<<ASSIGN  15865>>ASSIGN
C$ IN PROCEDURE FIND_UID_UVAL
     15873**DCL     15875<<ASSIGN  15877>>DOWHILE 15878>>IF      15878>>IF      15881>>ASSIGN  15885<<ASSIGN
     15885>>ASSIGN
C$ IN PROCEDURE QUEUE_CTB
     15896**DCL     15936<<ASSIGN  15937>>DOWHILE 15938>>IF      15940>>ASSIGN  15941>>ASSIGN  15942>>ASSIGN
     15943<<ASSIGN  15944>>ASSIGN  15945<<ASSIGN  15948<<ASSIGN  15948>>ASSIGN
CANCEL_EXIT
     15320**LABEL   15284--GOTO    15289--GOTO    15298--GOTO    15304--GOTO
CTB$
     15117**DCL     15139<<ASSIGN  15195<<ASSIGN  15209>>ASSIGN  15210>>ASSIGN  15216>>ASSIGN  15217>>ASSIGN
     15221>>ASSIGN  15222>>ASSIGN  15243>>ASSIGN  15243>>ASSIGN  15244>>ASSIGN  15245>>ASSIGN  15246>>ASSIGN
     15247>>ASSIGN  15248>>ASSIGN  15251>>ASSIGN  15277>>IF      15293>>IF      15311>>IF      15313>>ASSIGN
     15314>>CALL    15354>>IF      15370>>IF      15395>>ASSIGN  15402>>ASSIGN  15414>>ASSIGN  15421>>ASSIGN
     15426>>ASSIGN  15434>>ASSIGN  15441>>ASSIGN  15444>>ASSIGN  15447>>ASSIGN  15447>>ASSIGN  15456>>IF
     15488>>IF      15504>>IF      15524>>ASSIGN  15524>>ASSIGN  15533>>IF      15632<<ASSIGN  15647<<ASSIGN
     15653>>DOWHILE 15653>>DOWHILE 15653>>DOWHILE 15653>>DOWHILE 15653>>DOWHILE 15658>>ASSIGN  15661>>IF
     15677>>ASSIGN  15678>>IF      15688>>IF      15697<<ASSIGN  15788>>ASSIGN  15789>>ASSIGN  15790>>ASSIGN
     15823>>IF      15826>>ASSIGN  15826>>ASSIGN  15826>>ASSIGN  15841>>IF      15843>>ASSIGN  15844>>CALL
     15862>>IF      15881<<ASSIGN  15898>>ASSIGN  15899>>ASSIGN  15906>>ASSIGN  15907>>ASSIGN  15913>>IF
     15915>>ASSIGN  15916>>ASSIGN  15917>>ASSIGN  15923>>IF      15925>>ASSIGN  15926>>ASSIGN  15927>>ASSIGN
     15928>>ASSIGN  15938>>IF      15940>>ASSIGN  15941>>ASSIGN  15942>>ASSIGN  15943>>ASSIGN  15944>>ASSIGN
     15955>>ASSIGN  15965>>IF      15975>>IF      15985>>IF      15987>>ASSIGN  15987>>ASSIGN  15989>>IF
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:142  
     15991>>ASSIGN  15991>>ASSIGN  15996>>ASSIGN  16010>>IF      16012>>IF      16012>>IF
CURR_UTS
     15128**DCL     15129--REDEF   15242<<ASSIGN  15242>>ASSIGN  15243>>ASSIGN  15446<<ASSIGN  15446>>ASSIGN
     15447>>ASSIGN  15523<<ASSIGN  15523>>ASSIGN  15524>>ASSIGN  15567<<ASSIGN  15567>>ASSIGN  15570>>ASSIGN
     15578>>IF      15646<<ASSIGN  15646>>ASSIGN  15653>>DOWHILE 15653>>DOWHILE 16075>>ASSIGN  16080>>ASSIGN
     16090>>ASSIGN  16100>>ASSIGN  16121<<ASSIGN  16164>>ASSIGN  16169>>ASSIGN  16179>>ASSIGN  16196<<ASSIGN
CURR_UTSR.TICKS
     15131**DCL     16085>>ASSIGN  16095>>ASSIGN  16174>>ASSIGN
DEQUEUE_CTB
     15963**PROC    15309--CALL    15385--CALL    15519--CALL    15659--CALL
DISABLE_LEVEL
      6499**DCL     15168<<ASSIGN  15169<>CALL    15177>>IF      15255>>IF      15269<<ASSIGN  15270<>CALL
     15326>>IF      15346<<ASSIGN  15347<>CALL    15463>>IF      15480<<ASSIGN  15481<>CALL    15540>>IF
     15563<<ASSIGN  15564<>CALL    15582>>IF      15590<<ASSIGN  15591<>CALL    15604>>IF      15613>>IF
     15626<<ASSIGN  15627<>CALL    15667>>IF      15681>>IF      15691<<ASSIGN  15692<>CALL    15706>>IF
DSPCH_ALTRET_
     15683**LABEL   15642--GOTO
DWORD
     15120**DCL     15878>>IF      15878>>IF
DWORD IN PROCEDURE GET_UTS_PARTS
     16113**DCL     16116>>DOWHILE 16116>>DOWHILE 16117<<ASSIGN  16117>>ASSIGN
FIND_CTB$
     15857**PROC    15295--CALL    15372--CALL    15506--CALL
FIND_UID_UVAL
     15871**PROC    15275--CALL    15352--CALL    15486--CALL
FINISH_EXPIRATION
     15800**PROC    15634--CALL    15695--CALL
FPT_USER
     14785**DCL     15633<<ASSIGN  15675<>CALL    15687<>CALL
FPT_USER.ABORT
     14807**DCL     15282<<ASSIGN  15302<<ASSIGN  15823>>IF
FPT_USER.DELETE
     14824**DCL     15821>>IF
FPT_USER.RESET
     14819**DCL     15359<<ASSIGN  15379<<ASSIGN  15493<<ASSIGN  15513<<ASSIGN  15823>>IF      15831>>IF
     15834<<ASSIGN
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:143  
FPT_USER.UID
     14791**DCL     14792--REDEF
FPT_USER.VDH_CLK
     14803**DCL     15676<<ASSIGN
FPT_VDH
     14646**DCL     15633>>ASSIGN  15664<>CALL
FPT_VDH.CTBCTX$
     14661**DCL     15629>>IF      15632>>ASSIGN
FPT_VDH.UID
     14652**DCL     14653--REDEF
FPT_VDH.VDH_CLK
     14664**DCL     15629>>IF      15663<<ASSIGN
G$JIT.ERRLOG
      6869**DCL      6872--REDEF
G$JIT.IDELTAT
      6708**DCL     16193>>DOUNTIL 16194>>ASSIGN
G$JIT.JSUNIT
      6608**DCL      6609--REDEF
G$JIT.MCLS
      6607**DCL      6607--REDEF
G$JIT.STIME
      6707**DCL     16196>>ASSIGN
G$JIT.TMRZ
      6876**DCL      6877--REDEF
G$JIT.TUEXT
      6601**DCL     16195--ASSIGN  16196>>ASSIGN  16199--IF
G$JIT.TUSVT
      6602**DCL     16196>>ASSIGN
G$JIT.USER_EXTIME
      6600**DCL      6601--REDEF
G$JIT.USER_MEMTIME
      6603**DCL      6603--REDEF
G$JIT.USER_SVTIME
      6602**DCL      6602--REDEF
G$JIT.XTIME
      6707**DCL     16196>>ASSIGN
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:144  
G$JIT$
      6486**DCL      6539--IMP-PTR 16193>>DOUNTIL 16194>>ASSIGN  16195>>ASSIGN  16196>>ASSIGN  16196>>ASSIGN
     16196>>ASSIGN  16196>>ASSIGN  16199>>IF
G$LOW_MEM.IV.IL$
      6982**DCL      6982--REDEF
G$LOW_MEM.IV.INT.I#00$
      6982**DCL      6982--REDEF
G$LOW_MEM.IV.INT.I#01$
      6982**DCL      6982--REDEF
G$LOW_MEM.IV.INT.I#02$
      6983**DCL      6983--REDEF
G$LOW_MEM.IV.INT.I#03$
      6983**DCL      6983--REDEF
G$LOW_MEM.IV.INT.I#04$
      6983**DCL      6984--REDEF
G$LOW_MEM.IV.INT.I#05$
      6984**DCL      6984--REDEF
G$LOW_MEM.IV.INT.I#61$
      6985**DCL      6985--REDEF
G$LOW_MEM.IV.INT.I#62$
      6985**DCL      6985--REDEF
G$LOW_MEM.IV.INT.I#63$
      6985**DCL      6985--REDEF
G$LOW_MEM.TV.T#01$
      6970**DCL      6970--REDEF
G$LOW_MEM.TV.T#02$
      6970**DCL      6970--REDEF
G$LOW_MEM.TV.T#03$
      6969**DCL      6969--REDEF
G$LOW_MEM.TV.T#05$
      6969**DCL      6969--REDEF
G$LOW_MEM.TV.T#06$
      6968**DCL      6968--REDEF
G$LOW_MEM.TV.T#07$
      6968**DCL      6968--REDEF
G$LOW_MEM.TV.T#08$
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:145  
      6967**DCL      6968--REDEF
G$LOW_MEM.TV.T#09$
      6967**DCL      6967--REDEF
G$LOW_MEM.TV.T#10$
      6967**DCL      6967--REDEF
G$LOW_MEM.TV.T#12$
      6966**DCL      6966--REDEF
G$LOW_MEM.TV.T#13$
      6966**DCL      6966--REDEF
G$LOW_MEM.TV.T#14$
      6965**DCL      6965--REDEF
G$LOW_MEM.TV.T#15$
      6965**DCL      6965--REDEF
G$LOW_MEM.TV.T#16$
      6964**DCL      6965--REDEF
G$LOW_MEM.TV.T#17$
      6964**DCL      6964--REDEF
G$LOW_MEM.TV.T#19$
      6963**DCL      6964--REDEF
G$LOW_MEM.TV.T#20$
      6963**DCL      6963--REDEF
G$LOW_MEM.TV.T#21$
      6963**DCL      6963--REDEF
G$LOW_MEM.TV.T#22$
      6962**DCL      6962--REDEF
G$LOW_MEM.TV.T#23$
      6962**DCL      6962--REDEF
G$LOW_MEM.TV.T#24$
      6961**DCL      6962--REDEF
G$LOW_MEM.TV.T#25$
      6961**DCL      6961--REDEF
G$LOW_MEM.TV.T#26$
      6961**DCL      6961--REDEF
G$LOW_MEM.TV.T#27$
      6960**DCL      6960--REDEF
G$LOW_MEM.TV.T#28$
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:146  
      6960**DCL      6960--REDEF
G$LOW_MEM.TV.T#29$
      6959**DCL      6960--REDEF
G$LOW_MEM.TV.T#30$
      6959**DCL      6959--REDEF
G$LOW_MEM.TV.T#31$
      6959**DCL      6959--REDEF
G$LOW_MEM.TV.T#32$
      6958**DCL      6958--REDEF
G$LOW_MEM.TV.T#33$
      6958**DCL      6958--REDEF
G$LOW_MEM.WDT_CURR
      6946**DCL     16122>>ASSIGN  16196>>ASSIGN
G$LOW_MEM$
     15111**DCL      6945--IMP-PTR 16122>>ASSIGN  16196>>ASSIGN
G$MHJIT.BOOTUTS
     13337**DCL     15587>>ASSIGN  15931>>ASSIGN
G$MHJIT.INTCON.HHJIT
     13469**DCL     13469--REDEF
G$MHJIT.INTCON.P$$
     13442**DCL     13442--REDEF
G$MHJIT.ISA_BIGFOOT.P$$
     10387**DCL     10387--REDEF
G$MHJIT.ISA_DBINH.P$$
     11601**DCL     11601--REDEF
G$MHJIT.ISA_IDLE.P$$
      8482**DCL      8482--REDEF
G$MHJIT.ISA_LVL10.P$$
     11904**DCL     11904--REDEF
G$MHJIT.ISA_LVL11.P$$
     12207**DCL     12207--REDEF
G$MHJIT.ISA_LVL12.P$$
     12510**DCL     12510--REDEF
G$MHJIT.ISA_LVL5.P$$
     10690**DCL     10690--REDEF
G$MHJIT.ISA_OV.P$$
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:147  
     10084**DCL     10084--REDEF
G$MHJIT.ISA_PFS.P$$
      9755**DCL      9755--REDEF
G$MHJIT.ISA_RT_CLOCK.P$$
     13117**DCL     13117--REDEF
G$MHJIT.ISA_SATYR_RCV.P$$
     10994**DCL     10994--REDEF
G$MHJIT.ISA_SATYR_TRN.P$$
     11298**DCL     11298--REDEF
G$MHJIT.ISA_SCHD.P$$
     12813**DCL     12813--REDEF
G$MHJIT.ISA_WDOG.P$$
      9863**DCL      9863--REDEF
G$MHJIT.TSA_DB.ISA.P$$
      9085**DCL      9085--REDEF
G$MHJIT.TSA_DB.P$$
      8956**DCL      8956--REDEF    8957--REDEF
G$MHJIT.TSA_HND.ISA.P$$
     13663**DCL     13663--REDEF
G$MHJIT.TSA_HND.P$$
     13534**DCL     13534--REDEF   13535--REDEF
G$MHJIT.TSA_MON.ISA.P$$
      8697**DCL      8697--REDEF
G$MHJIT.TSA_MON.P$$
      8568**DCL      8568--REDEF    8569--REDEF
G$MHJIT.TSA_OV.ISA.P$$
      9473**DCL      9473--REDEF
G$MHJIT.TSA_OV.P$$
      9344**DCL      9344--REDEF    9345--REDEF
G$MHJIT.UTS
     13336**DCL     16116--DOWHILE 16117--ASSIGN  16121>>ASSIGN
G$MHJIT.WDT_INIT
     13337**DCL     16122>>ASSIGN  16196>>ASSIGN
G$MHJIT$
     15110**DCL      7007--IMP-PTR 15587>>ASSIGN  15931>>ASSIGN  16116>>DOWHILE 16117>>ASSIGN  16121>>ASSIGN
     16122>>ASSIGN  16196>>ASSIGN
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:148  
GET_UTS_PARTS
     16109**PROC    15241--CALL    15445--CALL    15522--CALL    15566--CALL    15645--CALL    16074--CALL
     16079--CALL    16084--CALL    16089--CALL    16094--CALL    16099--CALL
GET_XEQ_TIME
     16187**PROC    16163--CALL    16168--CALL    16173--CALL    16178--CALL
IDELT IN PROCEDURE GET_XEQ_TIME
     16190**DCL     16193>>DOUNTIL 16194<<ASSIGN  16199<<ASSIGN
INHIBIT_LEVEL
      6496**DCL     15138<<ASSIGN  15168>>ASSIGN  15177>>IF      15255>>IF      15269>>ASSIGN  15326>>IF
     15346>>ASSIGN  15463>>IF      15480>>ASSIGN  15540>>IF      15561<<ASSIGN  15563>>ASSIGN  15582>>IF
     15590>>ASSIGN  15604>>IF      15613>>IF      15624<<ASSIGN  15626>>ASSIGN  15667>>IF      15681>>IF
     15691>>ASSIGN  15706>>IF
INHWORD
     15122**DCL     15313<<ASSIGN  15314<>CALL    15843<<ASSIGN  15844<>CALL
INIT_EXP
     15718**PROC    15664--CALL    15675--CALL
KH$CTBCTX
     14710**DCL     15173--CALL    15185<<ASSIGN  15192<<ASSIGN  15313--ASSIGN  15843--ASSIGN
KH$CTBCTX.ACCURACY
     14739**DCL     15210<<ASSIGN  15217<<ASSIGN  15222<<ASSIGN  15434<<ASSIGN  15653>>DOWHILE
KH$CTBCTX.BLNK$
     14719**DCL     15899<<ASSIGN  15916<<ASSIGN  15926<<ASSIGN  15941<<ASSIGN  15941>>ASSIGN  15942<<ASSIGN
     15943>>ASSIGN  15970<<ASSIGN  15977>>ASSIGN  15985>>IF      15987>>ASSIGN  15991<<ASSIGN  15991>>ASSIGN
KH$CTBCTX.DYNAMIC
     14745**DCL     15186<<ASSIGN  15311>>IF      15841>>IF
KH$CTBCTX.EXPINH
     14762**DCL     15248<<ASSIGN  15444<<ASSIGN  15678>>IF      15688>>IF
KH$CTBCTX.FLNK$
     14716**DCL     15865>>ASSIGN  15885>>ASSIGN  15898<<ASSIGN  15915<<ASSIGN  15925<<ASSIGN  15936>>ASSIGN
     15940<<ASSIGN  15944<<ASSIGN  15948>>ASSIGN  15967>>ASSIGN  15980<<ASSIGN  15987<<ASSIGN  15987>>ASSIGN
     15989>>IF      15991>>ASSIGN  16024>>ASSIGN
KH$CTBCTX.PERM
     14758**DCL     15251<<ASSIGN  15441<<ASSIGN  15823>>IF
KH$CTBCTX.PRD
     14726**DCL     15209<<ASSIGN  15216<<ASSIGN  15221<<ASSIGN  15243>>ASSIGN  15414<<ASSIGN  15421<<ASSIGN
     15426<<ASSIGN  15447>>ASSIGN  15524>>ASSIGN  15826>>ASSIGN
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:149  
KH$CTBCTX.SBR$
     14730**DCL     15244<<ASSIGN  15395<<ASSIGN  15661>>IF      15677>>ASSIGN  16012>>IF
KH$CTBCTX.TOKEN
     14749**DCL     15653>>DOWHILE 15955<<ASSIGN  15996<<ASSIGN  16012>>IF
KH$CTBCTX.UID
     14734**DCL     14735--REDEF   15245<<ASSIGN  15402<<ASSIGN  15788>>ASSIGN  15878--IF
KH$CTBCTX.UTS
     14722**DCL     15243<<ASSIGN  15447<<ASSIGN  15524<<ASSIGN  15572>>ASSIGN  15653>>DOWHILE 15653>>DOWHILE
     15826<<ASSIGN  15826>>ASSIGN  15913>>IF      15913>>IF      15923>>IF      15923>>IF      15928>>ASSIGN
     15938>>IF      15938>>IF
KH$CTBCTX.UVAL
     14765**DCL     15246<<ASSIGN  15790>>ASSIGN  15878>>IF
KH$CTBCTX.VDH_CLK
     14742**DCL     15247<<ASSIGN
KHI$DISABLE
      6493**DCL-ENT 15169--CALL    15270--CALL    15347--CALL    15481--CALL    15564--CALL    15591--CALL
     15627--CALL    15692--CALL
KHI$ENABLE
      6492**DCL-ENT 15179--CALL    15257--CALL    15328--CALL    15465--CALL    15542--CALL    15584--CALL
     15606--CALL    15615--CALL    15669--CALL    15683--CALL    15708--CALL
KH_ARG
     13865**DCL        88--PROC    13867--REDEF   13869--REDEF   13887--REDEF   14039--REDEF   14191--REDEF
     14343--REDEF   14495--REDEF   14646--REDEF   15622--ENTRY   16073--ENTRY   16078--ENTRY   16083--ENTRY
     16088--ENTRY   16093--ENTRY   16098--ENTRY   16161--ENTRY   16167--ENTRY   16172--ENTRY   16177--ENTRY
KH_C.CTBHD$
     15134**DCL     15568>>IF      15572>>ASSIGN  15640>>IF      15647>>ASSIGN  15697>>ASSIGN  15860>>ASSIGN
     15875>>ASSIGN  15904>>IF      15906<<ASSIGN  15923>>IF      15925>>ASSIGN  15926>>ASSIGN  15927<<ASSIGN
     15936>>ASSIGN  15965>>IF      15967<<ASSIGN  15967>>ASSIGN  15968>>IF      15970>>ASSIGN  15982<<ASSIGN
     16008>>ASSIGN
KH_C.CTBTL$
     15135**DCL     15907<<ASSIGN  15913>>IF      15915>>ASSIGN  15916>>ASSIGN  15917<<ASSIGN  15972<<ASSIGN
     15975>>IF      15977<<ASSIGN  15977>>ASSIGN  15978>>IF      15980>>ASSIGN
KH_C.DISPATCH$
     15136**DCL     15277>>IF      15293>>IF      15354>>IF      15370>>IF      15456>>IF      15488>>IF
     15504>>IF      15533>>IF      15658<<ASSIGN  15665<<ASSIGN  15816<<ASSIGN
KH_CANCELCLK.NO_CTB
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:150  
     14267**DCL     15273>>IF
KH_CANCELCLK.RESULT
     14218**DCL     15283<<ASSIGN  15288<<ASSIGN  15297<<ASSIGN  15303<<ASSIGN  15317<<ASSIGN  15320<<ASSIGN
     15331>>IF
KH_CANCELCLK.UID
     14207**DCL     14208--REDEF   14209--REDEF
KH_CLK.CTBCTX$
     13893**DCL     15139>>ASSIGN
KH_CLK.FNC
     13929**DCL     15143>>DOCASE
KH_CLK.RESULT
     13914**DCL     15140<<ASSIGN  16016<<ASSIGN  16029<<ASSIGN
KH_CLK.UID
     13903**DCL     13904--REDEF   13905--REDEF   15878--IF
KH_CLK.UVAL
     13910**DCL     15878>>IF
KH_CTLTBL$
     15112**DCL     14853--IMP-PTR
KH_INHLVL
     15113**DCL     15138>>ASSIGN  15561>>ASSIGN  15624>>ASSIGN
KH_RESETCLK.ACCURACY
     14457**DCL     15415>>ASSIGN  15422>>ASSIGN  15427>>ASSIGN
KH_RESETCLK.EXPINH
     14442**DCL     15442>>IF
KH_RESETCLK.NO_CTB
     14419**DCL     15350>>IF
KH_RESETCLK.PERM
     14432**DCL     15439>>IF      15441>>ASSIGN
KH_RESETCLK.PRD
     14464**DCL     15408>>ASSIGN
KH_RESETCLK.PRDUNT
     14446**DCL     15409>>DOCASE
KH_RESETCLK.RESULT
     14370**DCL     15360<<ASSIGN  15365<<ASSIGN  15374<<ASSIGN  15380<<ASSIGN  15468>>IF
KH_RESETCLK.SBR$
     14460**DCL     15390>>IF      15395>>ASSIGN
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:151  
KH_RESETCLK.UID
     14359**DCL     14360--REDEF   14361--REDEF   15402>>ASSIGN
KH_RESETCLK.UID$
     14360**DCL     15397>>IF
KH_RESTARTCLK.NO_CTB
     14571**DCL     15484>>IF
KH_RESTARTCLK.RESULT
     14522**DCL     15494<<ASSIGN  15499<<ASSIGN  15508<<ASSIGN  15514<<ASSIGN  15545>>IF
KH_RESTARTCLK.UID
     14511**DCL     14512--REDEF   14513--REDEF
KH_SETCLK.ACCURACY
     14153**DCL     15210>>ASSIGN  15217>>ASSIGN  15222>>ASSIGN
KH_SETCLK.CTBCTX$
     14045**DCL     15171>>IF      15173<>CALL    15185>>ASSIGN  15186>>ASSIGN  15192>>ASSIGN  15195>>ASSIGN
KH_SETCLK.EXPINH
     14138**DCL     15248>>ASSIGN  15444>>ASSIGN
KH_SETCLK.FNC
     14081**DCL     15249>>IF
KH_SETCLK.PRD
     14160**DCL     15151>>IF      15203>>ASSIGN  15220>>ASSIGN  15221>>ASSIGN  15425>>ASSIGN  15426>>ASSIGN
KH_SETCLK.PRDUNT
     14142**DCL     15151>>IF      15204>>DOCASE
KH_SETCLK.RESULT
     14066**DCL     15156<<ASSIGN  15175<<ASSIGN
KH_SETCLK.SBR$
     14156**DCL     15151>>IF      15244>>ASSIGN
KH_SETCLK.UID
     14055**DCL     14056--REDEF   14057--REDEF   15245>>ASSIGN
KH_SETCLK.UVAL
     14062**DCL     15246>>ASSIGN
KH_SETCLK.VDH_CLK
     14111**DCL     15151>>IF      15247>>ASSIGN
KV$BPC.BITMAPSIZ
      6518**DCL      6521--IMP-SIZ
KV$BPC.CLKC
      6512**DCL     15141<<ASSIGN  15141>>ASSIGN
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:152  
KV$BPC.CLKCTX
      6512**DCL     15184<<ASSIGN  15184>>ASSIGN  15316<<ASSIGN  15316>>ASSIGN  15848<<ASSIGN  15848>>ASSIGN
KV$BPC.CLKE
      6512**DCL     15791<<ASSIGN  15791>>ASSIGN
KVB$GETSYS
     15115**DCL-ENT 15173--CALL
KVB$RLSSYS
     15116**DCL-ENT 15314--CALL    15844--CALL
KV_B_POOL$
      6487**DCL      6507--IMP-PTR 15141>>ASSIGN  15141>>ASSIGN  15184>>ASSIGN  15184>>ASSIGN  15316>>ASSIGN
     15316>>ASSIGN  15791>>ASSIGN  15791>>ASSIGN  15848>>ASSIGN  15848>>ASSIGN
M$WAIT
      4334**DCL-ENT 15588--CALL    15932--CALL
MY_EXP IN PROCEDURE INIT_EXP
     15735**DCL     15718--PROC
MY_EXP.ABORT IN PROCEDURE INIT_EXP
     15757**DCL     15785<<ASSIGN
MY_EXP.CTBCTX$ IN PROCEDURE INIT_EXP
     15750**DCL     15789<<ASSIGN
MY_EXP.DELETE IN PROCEDURE INIT_EXP
     15774**DCL     15787<<ASSIGN
MY_EXP.RESET IN PROCEDURE INIT_EXP
     15769**DCL     15786<<ASSIGN
MY_EXP.UID IN PROCEDURE INIT_EXP
     15741**DCL     15742--REDEF   15788<<ASSIGN
MY_EXP.UVAL IN PROCEDURE INIT_EXP
     15746**DCL     15790<<ASSIGN
PARM_TIME1
     13869**DCL     16085<<ASSIGN  16095<<ASSIGN  16095>>ASSIGN  16164<<ASSIGN  16174<<ASSIGN  16174>>ASSIGN
PARM_TIME2
     13867**DCL     16075<<ASSIGN  16080<<ASSIGN  16080>>ASSIGN  16090<<ASSIGN  16100<<ASSIGN  16100>>ASSIGN
     16169<<ASSIGN  16179<<ASSIGN  16179>>ASSIGN
PRD
     15118**DCL     15203<<ASSIGN  15207>>ASSIGN  15208<<ASSIGN  15208>>ASSIGN  15209>>ASSIGN  15213>>ASSIGN
     15214<<ASSIGN  15214>>ASSIGN  15215>>ASSIGN  15216>>ASSIGN  15216>>ASSIGN  15220<<ASSIGN  15221>>ASSIGN
     15408<<ASSIGN  15412>>ASSIGN  15413<<ASSIGN  15413>>ASSIGN  15414>>ASSIGN  15418>>ASSIGN  15419<<ASSIGN
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:153  
     15419>>ASSIGN  15420>>ASSIGN  15421>>ASSIGN  15421>>ASSIGN  15425<<ASSIGN  15426>>ASSIGN
PRD1
     15119**DCL     15207<<ASSIGN  15208>>ASSIGN  15213<<ASSIGN  15214>>ASSIGN  15215<<ASSIGN  15216>>ASSIGN
     15412<<ASSIGN  15413>>ASSIGN  15418<<ASSIGN  15419>>ASSIGN  15420<<ASSIGN  15421>>ASSIGN
QUEUE_CTB
     15894**PROC    15253--CALL    15458--CALL    15535--CALL    15828--CALL    15833--CALL
RESET_EXIT
     15456**LABEL   15366--GOTO    15375--GOTO
RESET_PARAMS
     15380**LABEL   15361--GOTO    15381--GOTO
RESTART_EXIT
     15533**LABEL   15495--GOTO    15500--GOTO    15509--GOTO    15515--GOTO
SUSPEND
     15067**DCL     15588<>CALL
SUSPEND.V
     15071**DCL     15070--DCLINIT
SUSPENDED
     15126**DCL     15580<<ASSIGN  15593<<ASSIGN  15929>>IF
TEMP IN PROCEDURE GET_UTS_PARTS
     16110**DCL     16115<<ASSIGN  16116--DOWHILE 16117--ASSIGN
TEMP.BTM IN PROCEDURE GET_UTS_PARTS
     16112**DCL     16122>>ASSIGN
TRASH_THE_REGS IN PROCEDURE GET_XEQ_TIME
     16196**LABEL   16205--GOTO
TUEXT IN PROCEDURE GET_XEQ_TIME
     16189**DCL     16195<<ASSIGN  16199>>IF
UETIME
     15124**DCL     15071--DCLINIT 15573<<ASSIGN  15601>>IF
USER@
     15114**DCL     15677<<ASSIGN  15687>>CALL
UTS_TIX
     15123**DCL     13865--IMP-SIZ 15242>>ASSIGN  15446>>ASSIGN  15523>>ASSIGN  15567>>ASSIGN  15646>>ASSIGN
     16075>>ASSIGN  16080>>ASSIGN  16085>>ASSIGN  16090>>ASSIGN  16095>>ASSIGN  16100>>ASSIGN  16122<<ASSIGN
UTS_VALUE
     15125**DCL     15070--DCLINIT 15099--DCLINIT 15570<<ASSIGN  15572<<ASSIGN  15578>>IF      15587<<ASSIGN
     15587>>ASSIGN  15928<<ASSIGN  15931<<ASSIGN  15931>>ASSIGN
PL6.E3A0      #001=KHC$CLOCK File=KHC$CLOCK.:E05TSI                              WED 07/30/97 00:28 Page:154  
UWORD IN PROCEDURE GET_XEQ_TIME
     16191**DCL     16195>>ASSIGN  16199>>IF
